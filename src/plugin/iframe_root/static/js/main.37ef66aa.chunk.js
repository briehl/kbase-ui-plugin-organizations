(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{132:function(e,t,r){},145:function(e,t,r){e.exports=r(310)},150:function(e,t,r){},158:function(e,t,r){},160:function(e,t,r){},162:function(e,t,r){},164:function(e,t,r){},220:function(e,t,r){},222:function(e,t,r){},237:function(e,t,r){},244:function(e,t,r){},246:function(e,t,r){},248:function(e,t,r){},250:function(e,t,r){},252:function(e,t,r){},256:function(e,t,r){},258:function(e,t,r){},260:function(e,t,r){},262:function(e,t,r){},264:function(e,t,r){},278:function(e,t,r){},281:function(e,t,r){},283:function(e,t,r){},285:function(e,t,r){},288:function(e,t,r){},290:function(e,t,r){},292:function(e,t,r){},294:function(e,t,r){},296:function(e,t,r){},298:function(e,t,r){},300:function(e,t,r){},302:function(e,t,r){},310:function(e,t,r){"use strict";r.r(t);var n,a,i,s,o,c,u,l,E,d,m,p,v,h,O,R,f,w,S,g,_=r(0),A=r.n(_),N=r(18),T=r.n(N),I=(r(150),r(6)),b=r(7),y=r(13),C=r(11),D=r(12),k=r(315),M=r(218),U=r(325),V=r(17),j=r(67),z=r(134),L=r(2),G=r(69),x=r(88);!function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.NEW=1]="NEW",e[e.DIRTY=2]="DIRTY",e[e.CLEAN=3]="CLEAN"}(a||(a={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(i||(i={})),function(e){e[e.OK=0]="OK",e[e.ERROR=1]="ERROR",e[e.REQUIRED_MISSING=2]="REQUIRED_MISSING"}(s||(s={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(o||(o={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(c||(c={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(u||(u={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(l||(l={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(E||(E={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(d||(d={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(p||(p={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(v||(v={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(O||(O={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(f||(f={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(S||(S={})),function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR"}(g||(g={}));var P,B=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,s=e.info;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,a))).name="AppException",r.code=n,r.message=a,r.detail=i,r.info=s,Error.captureStackTrace&&Error.captureStackTrace(Object(G.a)(Object(G.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(D.a)(t,e),t}(Object(x.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_JOIN_REQUEST=31]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=32]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=33]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=34]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=35]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=36]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=37]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=38]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=39]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=40]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=41]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=42]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST=43]="VIEW_ORG_ACCEPT_INBOX_REQUEST",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_START=44]="VIEW_ORG_ACCEPT_INBOX_REQUEST_START",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS=45]="VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR=46]="VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_INBOX_REQUEST=47]="VIEW_ORG_REJECT_INBOX_REQUEST",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_START=48]="VIEW_ORG_REJECT_INBOX_REQUEST_START",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS=49]="VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR=50]="VIEW_ORG_REJECT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=51]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=52]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=53]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=54]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=55]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=56]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=57]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=58]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=59]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=60]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=61]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=62]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.ADD_ORG_LOAD=63]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=64]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=65]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=66]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=67]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=68]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=69]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=70]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH=71]="ADD_ORG_UPDATE_GRAVATAR_HASH",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS=72]="ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR=73]="ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR",e[e.ADD_ORG_UPDATE_ID=74]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=75]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=76]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=77]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=78]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=79]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=80]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=81]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=82]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=83]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=84]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_EVALUATE=85]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=86]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=87]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=88]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=89]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=90]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=91]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=92]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=93]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=94]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=95]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=96]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=97]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=98]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=99]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=100]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=101]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=102]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=103]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH=104]="EDIT_ORG_UPDATE_GRAVATAR_HASH",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS=105]="EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR=106]="EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=107]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=108]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=109]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=110]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=111]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=112]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_EVALUATE=113]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=114]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=115]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=116]="AUTH_CHECK",e[e.AUTH_CHECK_START=117]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=118]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=119]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=120]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=121]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=122]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=123]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=124]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=125]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=126]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=127]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=128]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=129]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=130]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=131]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=132]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=133]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=134]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=135]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=136]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=137]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=138]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=139]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=140]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=141]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=142]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=143]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=144]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=145]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=146]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=147]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=148]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=149]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=150]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=151]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=152]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=153]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=154]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=155]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=156]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=157]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=158]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=159]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=160]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=161]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=162]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=163]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=164]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=165]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=166]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=167]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=168]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=169]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=170]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=171]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=172]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=173]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=174]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=175]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=176]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=177]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=178]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=179]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=180]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=181]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=182]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.MANAGE_MEMBERSHIP_UNLOAD=183]="MANAGE_MEMBERSHIP_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD=184]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=185]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=186]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=187]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=188]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=189]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=190]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=191]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=192]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=193]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=194]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=195]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=196]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.DASHBOARD_LOAD=197]="DASHBOARD_LOAD",e[e.DASHBOARD_LOAD_START=198]="DASHBOARD_LOAD_START",e[e.DASHBOARD_LOAD_SUCCESS=199]="DASHBOARD_LOAD_SUCCESS",e[e.DASHBOARD_LOAD_ERROR=200]="DASHBOARD_LOAD_ERROR",e[e.DASHBOARD_UNLOAD=201]="DASHBOARD_UNLOAD",e[e.DASHBOARD_REFRESH=202]="DASHBOARD_REFRESH",e[e.DASHBOARD_REFRESH_START=203]="DASHBOARD_REFRESH_START",e[e.DASHBOARD_REFRESH_SUCCESS=204]="DASHBOARD_REFRESH_SUCCESS",e[e.DASHBOARD_REFRESH_ERROR=205]="DASHBOARD_REFRESH_ERROR",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST=206]="DASHBOARD_CANCEL_OUTBOX_REQUEST",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_START=207]="DASHBOARD_CANCEL_OUTBOX_REQUEST_START",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS=208]="DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR=209]="DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST=210]="DASHBOARD_ACCEPT_INBOX_REQUEST",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_START=211]="DASHBOARD_ACCEPT_INBOX_REQUEST_START",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS=212]="DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR=213]="DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR",e[e.DASHBOARD_REJECT_INBOX_REQUEST=214]="DASHBOARD_REJECT_INBOX_REQUEST",e[e.DASHBOARD_REJECT_INBOX_REQUEST_START=215]="DASHBOARD_REJECT_INBOX_REQUEST_START",e[e.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS=216]="DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_REJECT_INBOX_REQUEST_ERROR=217]="DASHBOARD_REJECT_INBOX_REQUEST_ERROR",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST=218]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_START=219]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_START",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_SUCCESS=220]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_ERROR=221]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_ERROR",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST=222]="DASHBOARD_REJECT_ORG_INBOX_REQUEST",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_START=223]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_START",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_SUCCESS=224]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_ERROR=225]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=226]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=227]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=228]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=229]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=230]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=231]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=232]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=233]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=234]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=235]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=236]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=237]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=238]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=239]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=240]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=241]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=242]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.GLOBAL_ACCESS_NARRATIVE=243]="GLOBAL_ACCESS_NARRATIVE",e[e.GLOBAL_ACCESS_NARRATIVE_START=244]="GLOBAL_ACCESS_NARRATIVE_START",e[e.GLOBAL_ACCESS_NARRATIVE_SUCCESS=245]="GLOBAL_ACCESS_NARRATIVE_SUCCESS",e[e.GLOBAL_ACCESS_NARRATIVE_ERROR=246]="GLOBAL_ACCESS_NARRATIVE_ERROR",e[e.NOTIFICATIONS_LOAD=247]="NOTIFICATIONS_LOAD",e[e.NOTIFICATIONS_LOAD_START=248]="NOTIFICATIONS_LOAD_START",e[e.NOTIFICATIONS_LOAD_SUCCESS=249]="NOTIFICATIONS_LOAD_SUCCESS",e[e.NOTIFICATIONS_LOAD_ERROR=250]="NOTIFICATIONS_LOAD_ERROR",e[e.NOTIFICATIONS_UNLOAD=251]="NOTIFICATIONS_UNLOAD",e[e.NOTIFICATIONS_READ=252]="NOTIFICATIONS_READ",e[e.NOTIFICATIONS_READ_START=253]="NOTIFICATIONS_READ_START",e[e.NOTIFICATIONS_READ_SUCCESS=254]="NOTIFICATIONS_READ_SUCCESS",e[e.NOTIFICATIONS_READ_ERROR=255]="NOTIFICATIONS_READ_ERROR"}(P||(P={}));var q=function(e,t){switch(t.type){case P.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{saveState:o.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case P.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.UNEDITED,saveState:o.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case P.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{saveState:o.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveError without view model"),e)}(e,t);case P.ADD_ORG_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case P.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:i.UNEDITED,validationState:{type:s.OK,validatedAt:new Date},saveState:o.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case P.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case P.ADD_ORG_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case P.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:a.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:a.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{gravatarHash:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.gravatarHash,{syncState:a.DIRTY,value:t.gravatarHash,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateGravatarHashSuccess without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{gravatarHash:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.gravatarHash,{syncState:a.DIRTY,value:t.gravatarHash,validationState:t.error})})})})})}):(console.warn("attempting updateGravatarHashError without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:a.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e);case P.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:a.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:a.DIRTY})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:a.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:a.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case P.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:i.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.isPrivate,{value:t.isPrivate,syncState:a.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case P.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case P.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.ERROR,message:"TODO: form error",validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};function W(){return{type:s.OK,validatedAt:new Date}}function H(e){return e.editedOrganization.name.syncState===a.DIRTY?i.EDITED:e.editedOrganization.id.syncState===a.DIRTY?i.EDITED:e.editedOrganization.gravatarHash.syncState===a.DIRTY?i.EDITED:e.editedOrganization.isPrivate.syncState===a.DIRTY?i.EDITED:e.editedOrganization.description.syncState===a.DIRTY?i.EDITED:i.UNEDITED}var Q=function(e,t){switch(t.type){case P.EDIT_ORG_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case P.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:i.UNEDITED,validationState:W(),saveState:o.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case P.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case P.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{saveState:o.SAVING})})})}):e}(e);case P.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:i.UNEDITED,saveState:o.SAVED,editedOrganization:{id:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.id,{syncState:a.CLEAN}),name:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{syncState:a.CLEAN}),gravatarHash:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.gravatarHash,{syncState:a.CLEAN}),isPrivate:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{syncState:a.CLEAN}),description:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{syncState:a.CLEAN})}})})})}):e}(e);case P.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{saveState:o.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case P.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.name!==n.name.remoteValue?a.DIRTY:a.CLEAN;var i=Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:r,validationState:W()})})})})})}),s=H(i.views.editOrgView.viewModel);return Object(L.a)({},i,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},i.views.editOrgView,{viewModel:Object(L.a)({},i.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case P.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:i.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:a.DIRTY,validationState:t.error})})})})})}):e}(e,t);case P.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:i.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{gravatarHash:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.gravatarHash,{value:t.gravatarHash,syncState:a.DIRTY,validationState:W()})})})})})}),n=H(r.views.editOrgView.viewModel);return Object(L.a)({},r,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},r.views.editOrgView,{viewModel:Object(L.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case P.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:i.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{gravatarHash:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.gravatarHash,{value:t.gravatarHash,syncState:a.DIRTY,validationState:t.error})})})})})}):e}(e,t);case P.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.isPrivate!==n.isPrivate.remoteValue?a.DIRTY:a.CLEAN;var s=Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:i.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{value:t.isPrivate,syncState:r,validationState:W()})})})})})}),o=H(s.views.editOrgView.viewModel);return Object(L.a)({},s,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},s.views.editOrgView,{viewModel:Object(L.a)({},s.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case P.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.description!==n.description.remoteValue?a.DIRTY:a.CLEAN;var s=Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:i.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:r,validationState:W()})})})})})}),o=H(s.views.editOrgView.viewModel);return Object(L.a)({},s,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},s.views.editOrgView,{viewModel:Object(L.a)({},s.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case P.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:i.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:a.DIRTY,validationState:t.error})})})})})}):e}(e,t);case P.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):e}(e);case P.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.ERROR,message:"Validation errors",validatedAt:new Date}})})})}):e}(e);default:return null}};function F(e,t){switch(t.type){case P.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:Object(L.a)({},e.views.viewOrgView,{viewModel:Object(L.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}var J=function(e,t){switch(t.type){case P.VIEW_ORG_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case P.VIEW_ORG_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,relation:t.relation,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox}}})})}(e,t);case P.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case P.VIEW_ORG_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case P.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrative.workspaceId});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:Object(L.a)({},e.views.viewOrgView,{viewModel:Object(L.a)({},e.views.viewOrgView.viewModel,{organization:Object(L.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r})})})})})}(e,t);case P.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:Object(L.a)({},e.views.viewOrgView,{viewModel:Object(L.a)({},e.views.viewOrgView.viewModel,{organization:t.organization})})})}):e}(e,t)}return F(e,t)};function Y(e,t){switch(t.type){case P.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.searchTerms,s=r.sortBy,o=r.sortDirection,c=r.filter,u=r.totalCount,l=r.filteredCount,E=r.selectedOrganizationId,d=r.error,m=r.searching;return Object(L.a)({},e,{loadingState:h.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,searchTerms:i,sortBy:s,sortDirection:o,filter:c,totalCount:u,filteredCount:l,selectedOrganizationId:E,error:d,searching:m}})}(e,t);case P.BROWSE_ORGS_SEARCH:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})}(e,t);case P.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{searching:!0})})}(e);case P.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{organizations:t.organizations,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})}(e,t);case P.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{searching:!1,error:t.error})})}(e,t);case P.BROWSE_ORGS_SORT_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{sortBy:t.sortBy,sortDirection:t.sortDirection,searching:!0})})}(e,t);case P.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{filter:r,searching:!0})})}(e,t);default:return null}}var K=function(e,t){switch(t.type){case P.AUTH_CHECK_START:return function(e,t){return Object(L.a)({},e,{auth:{status:d.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case P.AUTH_AUTHORIZED:return function(e,t){return Object(L.a)({},e,{auth:{status:d.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case P.AUTH_UNAUTHORIZED:return function(e,t){return Object(L.a)({},e,{auth:{status:d.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case P.AUTH_CHECK_ERROR:return function(e,t){return Object(L.a)({},e,{auth:{status:d.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var X=function(e,t){switch(t.type){case P.APP_SUCCESS:return function(e,t){return Object(L.a)({},e,{app:{status:p.READY,config:t.config}})}(e,t);default:return null}};var Z=function(e,t){switch(t.type){case P.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case P.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case P.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case P.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case P.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:Object(L.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(L.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var $,ee=function(e,t){switch(t.type){case P.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:h.LOADING,viewModel:null,error:null})})})}(e);case P.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:h.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case P.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:h.ERROR,viewModel:null,error:t.error})})})}(e,t);case P.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:h.NONE,viewModel:null,error:null})})})}(e);case P.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=c.ADMIN,e):e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{viewModel:Object(L.a)({},e.views.viewMembersView.viewModel,{organization:Object(L.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case P.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=c.MEMBER,e):e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{viewModel:Object(L.a)({},e.views.viewMembersView.viewModel,{organization:Object(L.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}},te=r(4),re=r.n(te),ne=r(15);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}($||($={}));Object(x.a)(Error);var ae,ie,se,oe=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).name="GroupException",r.originalError=e,r}return Object(D.a)(t,e),t}(B),ce=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(D.a)(t,e),t}(B),ue=function(){function e(t){var r=t.token,n=t.url;Object(I.a)(this,e),this.token=r,this.url=n}return Object(b.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"getGroups",value:function(){var e=this;(new Date).getTime();return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new oe(e)});case"text/plain":return e.text().then(function(e){throw new ce(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a,i,s;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new oe(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new ce(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new oe(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new ce(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{gravatarhash:e.gravatarhash}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{gravatarhash:t.gravatarhash},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"getRequest",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===$.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===$.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===$.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r,n){var a;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function le(e){var t=function(e){switch(e){case"Invite":return ae.INVITATION;case"Request":return ae.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return ie.USER;case"workspace":return ie.WORKSPACE;case"catalogmethod":return ie.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,se.OPEN);switch(r){case ie.USER:return ae.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ie.WORKSPACE:return ae.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ie.APP:return ae.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(ae||(ae={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(ie||(ie={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(se||(se={}));var Ee,de,me,pe=function(){function e(t){Object(I.a)(this,e),this.params=t,this.groupsClient=new ue({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(b.a)(e,[{key:"getRequest",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=le(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOutboundRequests",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t,r,n,a=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return le(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",le(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return le(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return le(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCombinedRequestInboxForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getGroupRequests(t,{includeClosed:!1,sortDirection:$.DESCENDING});case 4:e.t0=function(e){return le(e)},n=e.sent.map(e.t0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(1),n=[];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return le(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t,r,n,a=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return le(e)}).filter(function(e){return e.type===ae.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboundRequests",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t,r,n,a=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return le(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:$.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",le(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:$.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return le(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:$.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return le(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",le(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",le(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",le(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",le(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",le(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return le(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),ve=function(){function e(){Object(I.a)(this,e)}return Object(b.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:s.REQUIRED_MISSING,message:"Organization id may not be empty",validatedAt:new Date}];if(e.match(/\s/))return[e,{type:s.ERROR,message:"Organization id may not contain a space",validatedAt:new Date}];if(e.length>100)return[e,{type:s.ERROR,message:"Organization id may not be longer than 100 characters",validatedAt:new Date}];return e.match(/^[a-z0-9-]+$/)?[e,{type:s.OK,validatedAt:new Date}]:[e,{type:s.ERROR,message:'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash "-"',validatedAt:new Date}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:s.REQUIRED_MISSING,message:"Organization name may not be empty",validatedAt:new Date}]:e.length>256?[e,{type:s.ERROR,message:"Organization name may not be longer than 256 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgGravatarHash",value:function(e){if(!e)return[null,{type:s.OK,validatedAt:new Date}];if(0===e.length)return[e,{type:s.OK,validatedAt:new Date}];if(e.length>32)return[e,{type:s.ERROR,message:"Organization gravatar hash may not be longer than 32 characters",validatedAt:new Date}];if(e.length<32)return[e,{type:s.ERROR,message:"Organization gravatar hash may not be shorter than 32 characters",validatedAt:new Date}];return/^[a-f0-9]+$/.test(e)?[e,{type:s.OK,validatedAt:new Date}]:[e,{type:s.ERROR,message:"Organization gravatar hash must consist only of the lower case hexadecimal characters a-f and 0-9",validatedAt:new Date}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:s.ERROR,message:"Organization description may not be empty",validatedAt:new Date}]:e.length>4096?[e,{type:s.ERROR,message:"Organization description may not be longer than 4,096 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}}]),e}();function he(e,t,r,n){if(t===e.owner.username)return{type:de.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:de.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:de.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:de.NONE};switch(a.type){case Ee.MEMBER:return{type:de.MEMBER};case Ee.ADMIN:return{type:de.ADMIN};case Ee.OWNER:return{type:de.OWNER};default:return{type:de.NONE}}}function Oe(e,t){var r={username:e.owner.name,joinedAt:new Date(e.owner.joined),type:Ee.OWNER,title:"Owner"},n=[].concat(e.admins.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:Ee.ADMIN,title:e.custom.title}})).concat(e.members.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:Ee.MEMBER,title:e.custom.title}})),a=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:function(e){switch(e){case"None":return me.NONE;case"Read":return me.VIEW;case"Write":return me.EDIT;case"Admin":return me.ADMIN;case"Own":return me.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}(e.perm)}});return{id:e.id,name:e.name,isPrivate:e.private,isMember:e.ismember,gravatarHash:e.custom.gravatarhash||null,description:e.custom.description,owner:r,members:n,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),narratives:a,apps:[]}}function Re(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.owner.username)||t.test(e.owner.username)})})}function fe(e,t,r){var n=r===v.ASCENDING?1:-1;switch(t){case"created":return e.slice().sort(function(e,t){return n*(e.createdAt.getTime()-t.createdAt.getTime())});case"name":return e.slice().sort(function(e,t){return n*e.name.localeCompare(t.name)});case"owner":return e.slice().sort(function(e,t){return n*e.owner.username.localeCompare(t.owner.username)});default:return console.warn("unimplemented sort field: "+t),e}}function we(e,t,r){switch(t){case"all":return e;case"notMemberOf":return e.filter(function(e){return!(e.members.findIndex(function(e){return e.username===r})>=0)&&e.owner.username!==r});case"memberOf":return e.filter(function(e){return e.members.findIndex(function(e){return e.username===r})>=0||e.owner.username===r});case"owned":return e.filter(function(e){return e.owner.username===r});case"notOwned":return e.filter(function(e){return e.owner.username!==r});default:return console.warn("unknown filter : "+t),e}}ve.nonPrintableRe=/[\000-\031]/,function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(Ee||(Ee={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.MEMBER_REQUEST_PENDING=2]="MEMBER_REQUEST_PENDING",e[e.MEMBER_INVITATION_PENDING=3]="MEMBER_INVITATION_PENDING",e[e.MEMBER=4]="MEMBER",e[e.ADMIN=5]="ADMIN",e[e.OWNER=6]="OWNER"}(de||(de={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(me||(me={}));var Se=function(){function e(t){Object(I.a)(this,e),this.params=t,this.groupsClient=new ue({url:this.params.groupsServiceURL,token:this.params.token}),this.organizations=new Map}return Object(b.a)(e,[{key:"getOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.organizations.has(t)){e.next=2;break}return e.abrupt("return",this.organizations.get(t));case 2:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){var n=Oe(e,r.params.username);return r.organizations.set(t,n),n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllOrgs",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t,r;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroups();case 2:return t=e.sent,r=t.map(function(e){return e.id}),e.abrupt("return",this.getOrgs(r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t,r=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs();case 2:return t=e.sent,e.abrupt("return",t.filter(function(e){return e.owner.username===r.params.username||!!e.members.find(function(e){return e.username===r.params.username})}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs();case 2:return r=e.sent,n=we(r,t.filter,t.username),a=Re(n,t.searchTerms),i=fe(a,t.sortBy,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs();case 2:return e.sent,r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=6,r.getGroups();case 6:return n=e.sent,a=n.filter(function(e){return e.owner.name===t||(!!e.members.find(function(e){return e.name===t})||!!e.admins.find(function(e){return e.name===t}))}),i=a.map(function(e){return Oe(e)}),e.abrupt("return",{organizations:i,total:i.length});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",le(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new ue({url:this.params.groupsServiceURL,token:this.params.token}),t.id.validationState.type===s.OK&&t.name.validationState.type===s.OK&&t.gravatarHash.validationState.type===s.OK&&t.description.validationState.type===s.OK&&t.isPrivate.validationState.type===s.OK){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.abrupt("return",n.createGroup({id:t.id.value,name:t.name.value,gravatarhash:t.gravatarHash.value,description:t.description.value,isPrivate:t.isPrivate.value}).then(function(e){return Oe(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,gravatarhash:r.gravatarHash,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return ve.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return ve.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return ve.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembershipToGroup",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",le(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ue({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",le(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(e,t){return new ue({url:this.params.groupsServiceURL,token:this.params.token}).memberToAdmin({groupId:e,member:t})}},{key:"adminToMember",value:function(e,t){return new ue({url:this.params.groupsServiceURL,token:this.params.token}).adminToMember({groupId:e,member:t})}},{key:"removeMember",value:function(e,t){return new ue({url:this.params.groupsServiceURL,token:this.params.token}).removeMember({groupId:e,member:t})}}]),e}();function ge(e,t){if(t)return me.OWNER;switch(e){case"r":return me.VIEW;case"w":return me.EDIT;case"a":return me.ADMIN;default:throw new Error("Invalid workspace user permission: "+e)}}var _e=function(e,t){switch(t.type){case P.INVITE_USER_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:h.LOADING})})})}(e);case P.INVITE_USER_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:h.SUCCESS,error:null,viewModel:{editState:R.EDITING,users:t.users,organization:t.organization,selectedUser:null}})})})}(e,t);case P.INVITE_USER_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:h.SUCCESS,error:t.error,viewModel:null})})})}(e,t);case P.INVITE_USER_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:h.NONE,error:null,viewModel:null})})})}(e);case P.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{users:t.users})})})})}(e,t);case P.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})})})}(e,t);case P.INVITE_USER_SEND_INVITATION_START:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{editState:R.SENDING})})})})}(e);case P.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");var r=e.views.inviteUserView.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=de.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=de.MEMBER_INVITATION_PENDING),e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{editState:R.SUCCESS,selectedUser:n,users:i})})})})}(e);case P.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{editState:R.ERROR})})})})}(e);default:return null}};var Ae=function(e,t){switch(t.type){case P.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case P.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,editableMemberProfile:t.editableMemberProfile}}})})}(e,t);case P.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:h.LOADING,error:t.error,viewModel:null}})})}(e,t);case P.MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);default:return null}};function Ne(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{viewModel:Object(L.a)({},e.views.requestNarrativeView.viewModel,{saveState:o.SAVING})})})})}var Te=function(e,t){switch(t.type){case P.REQUEST_ADD_NARRATIVE_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{loadingState:h.LOADING,error:null,viewModel:null})})})}(e);case P.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,saveState:o.SAVED}})})})}(e,t);case P.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{loadingState:h.ERROR,error:t.error,viewModel:null})})})}(e,t);case P.REQUEST_ADD_NARRATIVE_SEND_START:return Ne(e);case P.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");var r=Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{viewModel:Object(L.a)({},e.views.requestNarrativeView.viewModel,{saveState:o.SAVED})})})}),n=r.views.requestNarrativeView.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=f.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=f.REQUESTED),e}),r}(e,t);case P.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return Ne(e);case P.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{error:null,viewModel:Object(L.a)({},e.views.requestNarrativeView.viewModel,{selectedNarrative:t.narrative})})})})}(e,t);case P.REQUEST_ADD_NARRATIVE_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);default:return null}};function Ie(e,t){switch(t.type){case P.DASHBOARD_LOAD_START:return{loadingState:h.LOADING,error:null,viewModel:null};case P.DASHBOARD_LOAD_SUCCESS:return function(e,t){return{loadingState:h.SUCCESS,error:null,viewModel:{refreshState:h.NONE,organizations:t.organizations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,pendingAdminRequests:t.pendingGroupRequests}}}(0,t);case P.DASHBOARD_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{loadingState:h.ERROR,error:t.error,viewModel:null})}(e,t);case P.DASHBOARD_UNLOAD:return{loadingState:h.NONE,error:null,viewModel:null};case P.DASHBOARD_REFRESH_START:return function(e,t){return e.viewModel?Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{refreshState:h.LOADING})}):e}(e);case P.DASHBOARD_REFRESH_SUCCESS:return function(e,t){return Object(L.a)({},e,{error:null,viewModel:{refreshState:h.SUCCESS,organizations:t.organizations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,pendingAdminRequests:t.pendingGroupRequests}})}(e,t);case P.DASHBOARD_REFRESH_ERROR:return function(e,t){return e.viewModel?Object(L.a)({},e,{error:t.error,viewModel:Object(L.a)({},e.viewModel,{refreshState:h.ERROR})}):e}(e,t);case P.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{requestOutbox:t.requests})})}(e,t);case P.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{requestInbox:t.requests,organizations:t.organizations})})}(e,t);case P.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(L.a)({},e,{viewModel:Object(L.a)({},e.viewModel,{requestInbox:t.requests})})}(e,t);default:return null}}var be=function(e,t){switch(t.type){case P.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{users:Object(L.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case P.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{orgs:Object(L.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case P.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{narratives:{byId:new Map(r.byId)}})})}(e,t);default:return null}};var ye=function(e,t){switch(t.type){case P.ORGANIZATION_CENTRIC_VIEW_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case P.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:Object(L.a)({},e.views.organizationCentricView,{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,pendingJoinRequest:t.pendingJoinRequest,pendingJoinInvitation:t.pendingJoinInvitation,relation:t.relation}})})})}(e,t);case P.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:Object(L.a)({},e.views.organizationCentricView,{loadingState:h.ERROR,error:t.error,viewModel:null})})})}(e,t);case P.ORGANIZATION_CENTRIC_VIEW_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);default:return null}};function Ce(e,t){switch(t.type){case P.GLOBAL_ACCESS_NARRATIVE_SUCCESS:return function(e,t){var r=e.entities.narratives.byId;return r.set(t.narrative.workspaceId,t.narrative),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{narratives:Object(L.a)({},e.entities.narratives,{byId:r})})})}(e,t);default:return null}}function De(e,t){switch(t.type){case P.NOTIFICATIONS_LOAD_SUCCESS:return function(e,t){var r=new Map;return t.notifications.forEach(function(e){r.set(e.id,e)}),Object(L.a)({},e,{db:Object(L.a)({},e.db,{notifications:{all:t.notifications,byId:r}})})}(e,t);case P.NOTIFICATIONS_UNLOAD:return function(e,t){return Object(L.a)({},e,{db:Object(L.a)({},e.db,{notifications:{all:[],byId:new Map}})})}(e);case P.NOTIFICATIONS_READ_SUCCESS:return function(e,t){var r=e.db.notifications,n=r.all,a=r.byId,i=n.filter(function(e){return e.id!==t.notificationId}),s=new Map(a);return s.delete(t.notificationId),Object(L.a)({},e,{db:Object(L.a)({},e.db,{notifications:{all:i,byId:s}})})}(e,t);default:return null}}var ke,Me=function(e,t){return q(e,t)||Q(e,t)||function(e,t){var r=Y(e.views.browseOrgsView,t);return r?Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:r})}):null}(e,t)||J(e,t)||K(e,t)||X(e,t)||Z(e,t)||ee(e,t)||_e(e,t)||Ae(e,t)||Te(e,t)||function(e,t){var r=Ie(e.views.dashboardView,t);return r?Object(L.a)({},e,{views:Object(L.a)({},e.views,{dashboardView:r})}):null}(e,t)||be(e,t)||ye(e,t)||Ce(e,t)||De(e,t)||e},Ue=(r(158),r(135)),Ve=r(73),je=r(327),ze=(r(160),r(328)),Le=(r(162),r(164),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:"./nouserpic.png";case"silhouette":case"mysteryman":default:return"./nouserpic.png"}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return _.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(_.Component)),Ge=r(22);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(ke||(ke={}));var xe=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={view:ke.COMPACT},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case ke.COMPACT:return ke.NORMAL;case ke.NORMAL:return ke.COMPACT}}(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case Ee.OWNER:return _.createElement("span",null,_.createElement(Ge.a,{type:"crown"})," owner");case Ee.ADMIN:return _.createElement("span",null,_.createElement(Ge.a,{type:"unlock"})," admin");case Ee.MEMBER:return _.createElement("span",null,_.createElement(Ge.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){return _.createElement("div",{className:"Owner View-COMPACT"},_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===ke.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===ke.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(Le,{user:this.props.user,size:this.props.avatarSize||30})),_.createElement("div",{className:"infoCol"},_.createElement("div",{className:"name"},_.createElement("a",{href:"#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769")))}},{key:"renderNormal",value:function(){return _.createElement("div",{className:"Owner View-NORMAL"},_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===ke.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===ke.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(Le,{user:this.props.user,size:this.props.avatarSize||30})),_.createElement("div",{className:"infoCol"},_.createElement("div",{className:"name"},_.createElement("a",{href:"#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),_.createElement("div",{className:"role"},this.renderRole()),_.createElement("div",{className:"joinedAt"},_.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt)),_.createElement("div",{className:"title"},this.props.user.title||_.createElement("i",null,"no title in user profile")),_.createElement("div",{className:"organization"},this.props.user.organization||_.createElement("i",null,"no organization in user profile")),_.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||_.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case ke.COMPACT:return this.renderCompact();case ke.NORMAL:return this.renderNormal()}}}]),t}(_.Component),Pe=function(){function e(t){var r=t.url,n=t.token;Object(I.a)(this,e),this.url=r,this.token=n}return Object(b.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var t=Object(ne.a)(re.a.mark(function t(r){return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.profileCache.has(r)){t.next=2;break}return t.abrupt("return",Promise.resolve(e.profileCache.get(r)));case 2:return t.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",[r]))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0][0]}));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",e))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}},{key:"getAllUsers",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:""}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}},{key:"searchUsers",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:e}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}}]),e}();function Be(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}Pe.profileCache=new Map;var qe=function(){function e(t){Object(I.a)(this,e),this.params=t,this.userProfileClient=new Pe({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(b.a)(e,[{key:"getUser",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=Be(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return Be(e)}),a.forEach(function(e){var t=Be(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),We=r(19),He=function(e){function t(e){var r;if(Object(I.a)(this,t),r=Object(y.a)(this,Object(C.a)(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"callFunc",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(I.a)(this,e),this.url=r,this.token=n||null,this.module=a}return Object(b.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i,s,o;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=13;break}return e.next=3,t.json();case 3:if(r=e.sent,n=r.result,a=r.error,!n){e.next=10;break}return e.abrupt("return",[n,null]);case 10:return e.abrupt("return",[null,a]);case 11:e.next=15;break;case 13:if(204!==t.status){e.next=15;break}return e.abrupt("return",[null,null]);case 15:if(500!==t.status){e.next=28;break}if("application/json"!==t.headers.get("Content-Type")){e.next=24;break}return e.next=19,t.json();case 19:return i=e.sent,s=i.error,e.abrupt("return",[null,s]);case 24:return e.next=26,t.text();case 26:return o=e.sent,e.abrupt("return",[null,{code:0,name:"Internal Server Error (for real)",message:"The service experienced an internal error",error:o}]);case 28:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){return n.processResponse(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),Qe=r(74),Fe=r.n(Qe),Je=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(function(e){function t(e){var r;if(Object(I.a)(this,t),r=Object(y.a)(this,Object(C.a)(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(function(){function e(t){var r=t.url,n=t.token;Object(I.a)(this,e),this.url=r,this.token=n||null}return Object(b.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}()));Je.module="ServiceWizard";var Ye,Ke,Xe=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(I.a)(this,e),this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(b.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new Fe.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var s=(new Date).getTime()-a;s>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+s))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):Fe.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),Ze=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"listNarratives",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(We.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,s=t.rpcContext;if(Object(I.a)(this,e),this.token=r,this.timeout=i||1e4,this.rpcContext=s||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(b.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return Xe.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new Je({url:e.url,token:e.token});return Fe.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new He({module:n.module_name,url:n.url,token:r.token});return Fe.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}());function $e(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function et(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:$e(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:1===e[6],lockStatus:e[7],metadata:e[8]}}function tt(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:$e(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}Ze.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(Ye||(Ye={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(Ke||(Ke={}));var rt=function(){function e(t){Object(I.a)(this,e),this.params=t}return Object(b.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i,s,o,c,u,l;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ze({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new Se({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),a=new pe({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:return i=e.sent,s=Object(We.a)(i,3),o=s[0],c=s[1],u=s[2],l=c.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",o.narratives.map(function(e){return{workspaceInfo:et(e.ws),objectInfo:tt(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){var t;return t=-1!==l.indexOf(e.workspaceInfo.id)?Ye.ASSOCIATED:u.find(function(t){return t.resourceType===ie.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?Ye.REQUESTED:Ye.NONE,{workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,status:t,modifiedAt:e.workspaceInfo.modifiedAt}}).sort(function(e,t){return e.title.localeCompare(t.title)}));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"workspaceToNarrative",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i,s,o,c,u,l,E,d;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new He({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,Promise.all([r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:1}],includeMetadata:1,ignoreErrors:0}]),r.callFunc("get_workspace_info",[{id:t}])]);case 4:if(n=e.sent,a=Object(We.a)(n,2),i=Object(We.a)(a[0],2),s=Object(We.a)(i[0],1),s[0],o=i[1],c=Object(We.a)(a[1],2),u=Object(We.a)(c[0],1),l=u[0],E=c[1],!o&&!E){e.next=16;break}return e.abrupt("return",null);case 16:return d=et(l),e.abrupt("return",{workspaceId:d.id,title:d.metadata.narrative_nice_name||"Unknown",permission:ge(d.userPermission,d.owner===this.params.username),isPublic:d.globalReadPermission});case 20:return e.prev=20,e.t0=e.catch(1),e.abrupt("return",null);case 23:case"end":return e.stop()}},e,this,[[1,20]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getNarrative",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i,s,o,c,u,l,E,d,m;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new He({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,Promise.all([r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:1}],includeMetadata:1,ignoreErrors:0}]),r.callFunc("get_workspace_info",[{id:t}])]);case 4:if(n=e.sent,a=Object(We.a)(n,2),i=Object(We.a)(a[0],2),s=i[0],o=i[1],c=Object(We.a)(a[1],2),u=c[0],l=c[1],!o&&!l){e.next=14;break}return e.abrupt("return",{workspaceId:t,access:Ke.NONE});case 14:E=et(u[0]),d=tt(s[0].infos[0]),e.t0=E.userPermission,e.next="n"===e.t0?19:"r"===e.t0?25:"w"===e.t0?27:"a"===e.t0?29:31;break;case 19:if(!E.globalReadPermission){e.next=24;break}return m=Ke.VIEW,e.abrupt("break",32);case 24:throw new Error("Cannot have no access and no global read permission!");case 25:return m=Ke.VIEW,e.abrupt("break",32);case 27:return m=Ke.EDIT,e.abrupt("break",32);case 29:return m=E.owner===this.params.username?Ke.OWNER:Ke.ADMIN,e.abrupt("break",32);case 31:throw new Error("Unknown workspace permission: "+E.userPermission);case 32:return e.abrupt("return",{workspaceId:E.id,access:m,isPublic:E.globalReadPermission,objectId:d.id,title:E.metadata.narrative_nice_name||"Unknown",owner:E.owner,lastSavedAt:d.savedAt,lastSavedBy:d.savedBy});case 35:throw e.prev=35,e.t1=e.catch(1),console.error("Error fetching narrative!",e.t1),e.t1;case 39:case"end":return e.stop()}},e,this,[[1,35]])}));return function(t){return e.apply(this,arguments)}}()}]),e}();function nt(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,s=i.token,i.username,o=a.app.config,c=new qe({token:s,userProfileServiceURL:o.services.UserProfile.url}),t.prev=3,t.next=6,c.getUser(e);case 6:u=t.sent,r((E=u,{type:P.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((l={code:"error",message:t.t0.message},{type:P.ENTITY_USER_LOADER_ERROR,error:l}));case 13:case"end":return t.stop()}var l,E},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function at(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new rt({token:s,username:o,workspaceServiceURL:c.services.Workspace.url,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=3,t.next=6,u.getNarrative(e);case 6:l=t.sent,r({type:P.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:l}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:P.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}var it=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.user?_.createElement(xe,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):_.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(_.Component);var st=Object(V.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(nt(t))}}})(it),ot=r(109),ct=r.n(ot),ut=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderDefault",value:function(){return _.createElement("img",{style:{width:this.props.size,height:this.props.size},src:"unicorn-64.png"})}},{key:"renderUnicornify",value:function(){var e="https://unicornify.pictures/avatar/"+ct()(this.props.organizationId)+"?s="+this.props.size;return _.createElement("img",{style:{width:this.props.size,height:this.props.size},src:e})}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultInitial",value:function(){var e=this.charAt(this.props.organizationName,0).toUpperCase(),t=ct()(this.props.organizationId).substr(0,6);return _.createElement("svg",{width:this.props.size,height:this.props.size,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},_.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:this.props.size-12,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"render",value:function(){return this.renderDefaultInitial()}}]),t}(_.Component),lt=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderOrgAvatar",value:function(e){return _.createElement(ut,{gravatarHash:e.gravatarHash,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderRelation",value:function(e){return _.createElement("div",null,"disabled")}},{key:"renderAdminInfo",value:function(e){return _.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(e){return _.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderRelationInfo",value:function(e){return _.createElement("div",null,"disabled")}},{key:"renderOrg",value:function(e,t){return _.createElement("div",{className:"row organizationCard",key:String(t)},_.createElement("div",{className:"col2"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},this.renderOrgAvatar(e))),_.createElement("div",{className:"col1"},_.createElement("div",{className:"infoTable"},_.createElement("div",{className:"orgName infoTableRow"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},e.name)),_.createElement("div",{className:"orgOwner infoTableRow"},_.createElement("div",{className:"infoTableCol1"},_.createElement("span",{className:"field-label"},"owner")),_.createElement("div",{className:"infoTableCol2"},_.createElement(st,{member:e.owner,avatarSize:30}))),_.createElement("div",{className:"orgCreated infoTableRow"},_.createElement("div",{className:"infoTableCol1"},_.createElement("span",{className:"field-label"},"established")),_.createElement("div",{className:"infoTableCol2"},_.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))))))}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,r){return e.renderOrg(t,r)}):_.createElement(ze.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return _.createElement("div",{className:"Organizations"},_.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(_.Component);var Et=Object(V.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");return{organizations:e.views.browseOrgsView.viewModel.organizations}})(lt),dt=(r(220),r(319)),mt=r(62),pt=r(317),vt=(r(222),function(e){function t(){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return _.createElement(Ge.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"render",value:function(){return _.createElement("div",{className:"Header"},_.createElement("div",{className:"defaultCrumbs"},_.createElement(je.a,{to:"/"},_.createElement(Ge.a,{type:"team",style:{verticalAlign:"middle"}})," ",_.createElement("span",{"data-test":"orgs-label"},"Orgs")),this.buildSeparator()),_.createElement("div",{className:"userColumn"},_.createElement("div",{className:"breadcrumbs"},this.props.breadcrumbs),_.createElement("div",{className:"buttons"},this.props.buttons)))}}]),t}(_.Component)),ht=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).searchInput=_.createRef(),r.searchButton=_.createRef(),r.state={searchInput:"",showInfo:!1},r.props.onSearchOrgs([]),r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onShowInfo",value:function(){dt.a.info({title:"Organizations Browser Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the organizations browser..."))})}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){this.props.onSortOrgs(e.target.value,this.props.sortDirection)}},{key:"onSortByChange2",value:function(e){this.props.onSortOrgs(e,this.props.sortDirection)}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onSortDirectionChange2",value:function(e){this.props.onSortOrgs(this.props.sortBy,e)}},{key:"onFilterChange",value:function(e){this.props.onFilterOrgs(e.target.value)}},{key:"onFilterChange2",value:function(e){this.props.onFilterOrgs(e)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?_.createElement("span",null,"No organizations in the system"):0===this.props.filteredCount?_.createElement("span",null,"No organizations found out of"," ",this.props.totalCount," ","available."):this.props.totalCount===this.props.filteredCount?_.createElement("span",null,"Showing all"," ",this.props.totalCount," ","organizations"):_.createElement("span",null,"Showing"," ",this.props.filteredCount," ","out of"," ",this.props.totalCount," ","organizations")}},{key:"renderSearchIcon",value:function(){return this.props.searching?_.createElement(Ge.a,{type:"loading"}):_.createElement(Ge.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return _.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},_.createElement("input",{placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),_.createElement(mt.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),_.createElement(mt.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}))}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,"Browse and Search Organizations"),_.createElement(Ge.a,{type:"right",style:{margin:"0 4px"}}),_.createElement("span",{style:{fontWeight:"normal",fontStyle:"italic"}},this.renderSearchFeedback())),t=_.createElement(_.Fragment,null,_.createElement(je.a,{to:"/newOrganization"},_.createElement(mt.a,{icon:"plus-circle"},"Create Organization")),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderSearchFilter",value:function(){return _.createElement("div",null,_.createElement("span",{className:"field-label"},"sort by"),_.createElement(pt.a,{onChange:this.onSortByChange2.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},_.createElement(pt.a.Option,{value:"name",key:"name"},"Org name"),_.createElement(pt.a.Option,{value:"owner",key:"owner"},"Owner"),_.createElement(pt.a.Option,{value:"created",key:"created"},"Date created")),_.createElement(pt.a,{onChange:this.onSortDirectionChange2.bind(this),style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},_.createElement(pt.a.Option,{value:v.ASCENDING,key:"name"},_.createElement(Ge.a,{type:"sort-ascending"}),"Ascending"),_.createElement(pt.a.Option,{value:v.DESCENDING,key:"owner"},_.createElement(Ge.a,{type:"sort-descending"}),"Descending")),_.createElement("span",{className:"field-label",style:{marginLeft:"10px"}},"filter"),_.createElement(pt.a,{onChange:this.onFilterChange2.bind(this),defaultValue:this.props.filter,style:{width:"16em"},dropdownMatchSelectWidth:!0},_.createElement(pt.a.Option,{value:"all",key:"all"},"All"),_.createElement(pt.a.Option,{value:"memberOf",key:"memberOf"},"You are a member of"),_.createElement(pt.a.Option,{value:"notMemberOf",key:"memberOf"},"You are not a member of"),_.createElement(pt.a.Option,{value:"owned",key:"owned"},"Owned by you"),_.createElement(pt.a.Option,{value:"notOwned",key:"notOwned"},"Not owned by you")))}},{key:"renderOrganizations",value:function(){return this.props.error?_.createElement(ze.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):_.createElement(Et,null)}},{key:"render",value:function(){return _.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},this.renderHeader(),_.createElement("div",{className:"searchBarRow"},_.createElement("div",{className:"searchBarCol"},this.renderSearchBar()),_.createElement("div",{className:"sortCol"},this.renderSearchFilter())),_.createElement("div",{className:"bodyRow scrollable-flex-column"},_.createElement("div",{className:"col2 scrollable-flex-column"},this.renderOrganizations())))}}]),t}(_.Component);function Ot(e,t){return{type:P.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t}}function Rt(e){return{type:P.BROWSE_ORGS_SEARCH_ERROR,error:e}}function ft(){return function(e,t){e({type:P.BROWSE_ORGS_LOAD_START}),e(function(e){return{type:P.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:e}}({rawOrganizations:[],organizations:[],totalCount:0,filteredCount:0,sortBy:"name",sortDirection:v.ASCENDING,filter:"all",searchTerms:[],selectedOrganizationId:null,searching:!1,error:null}))}}function wt(e){return function(t,r){t({type:P.BROWSE_ORGS_SEARCH_START});var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,s=i.token,o=i.username,c=n.app.config;if(null!==a.viewModel){var u=a.viewModel,l=u.sortBy,E=u.sortDirection,d=u.filter;return new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}).queryOrgs({searchTerms:e,sortBy:l,sortDirection:E,filter:d,username:o}).then(function(e){var r=e.organizations,n=e.total;t(Ot(r,n))}).catch(function(e){console.error("Error querying orgs",e.name,e.message),t(Rt({code:e.name,message:e.message}))})}t(Rt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function St(e,t){return function(r,n){r(function(e,t){return{type:P.BROWSE_ORGS_SORT_START,sortBy:e,sortDirection:t}}(e,t));var a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,c=s.username,u=a.app.config,l=new Se({token:o,username:c,groupsServiceURL:u.services.Groups.url});if(null!==i.viewModel){var E=i.viewModel,d=E.searchTerms,m=E.filter;return l.queryOrgs({searchTerms:d,sortBy:e,sortDirection:t,filter:m,username:c}).then(function(e){var t=e.organizations,n=e.total;r(Ot(t,n))}).catch(function(e){r(Rt({code:e.name,message:e.message}))})}r(Rt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function gt(e){return function(t,r){t(function(e){return{type:P.BROWSE_ORGS_FILTER_START,filter:e}}(e));var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,s=i.token,o=i.username,c=n.app.config,u=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url});if(null!==a.viewModel){var l=a.viewModel,E=l.searchTerms,d=l.sortBy,m=l.sortDirection;return u.queryOrgs({searchTerms:E,sortBy:d,sortDirection:m,filter:e,username:o}).then(function(e){var r=e.organizations,n=e.total;t(Ot(r,n))}).catch(function(e){t(Rt({code:e.name,message:e.message}))})}t(Rt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}var _t=Object(V.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.error;return t.searchTerms,t.selectedOrganizationId,{organizations:r,totalCount:t.totalCount,filteredCount:t.filteredCount,sortBy:t.sortBy,sortDirection:t.sortDirection,filter:t.filter,error:n,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(wt(t))},onSortOrgs:function(t,r){e(St(t,r))},onFilterOrgs:function(t){e(gt(t))}}})(ht),At=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Fetching your orgs and other things...")}},{key:"renderError",value:function(){if(this.props.view.error)return _.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return _.createElement(_t,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var Nt=Object(V.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(ft())},onUnload:function(){e({type:P.BROWSE_ORGS_UNLOAD})}}})(At);function Tt(e){return{type:P.ADD_ORG_SAVE_ERROR,error:e}}function It(){return{type:P.ADD_ORG_EVALUATE_ERRORS}}function bt(e){return{type:P.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function yt(e,t){return{type:P.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function Ct(){return function(e,t){e({type:P.ADD_ORG_LOAD_START});var r,n={id:{value:"",remoteValue:null,syncState:a.CLEAN,validationState:ve.validateOrgId("")[1]},name:{value:"",remoteValue:null,syncState:a.CLEAN,validationState:ve.validateOrgName("")[1]},gravatarHash:{value:"",remoteValue:null,syncState:a.CLEAN,validationState:ve.validateOrgGravatarHash("")[1]},description:{value:"",remoteValue:null,syncState:a.CLEAN,validationState:ve.validateOrgDescription("")[1]},isPrivate:{value:!1,remoteValue:null,syncState:a.CLEAN,validationState:{type:s.OK,validatedAt:new Date}}};e((r=n,{type:P.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(kt())}}function Dt(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:P.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.addOrgView.viewModel.newOrganization,o=r.app.config,c=new Se({token:a,username:i,groupsServiceURL:o.services.Groups.url});s?c.addOrg(s,i).then(function(t){e(function(e){return{type:P.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",s,t),e(Tt({code:t.code||t.name,message:t.message,exception:t}))}):e(Tt({code:"app",message:"The new organization data does not yet exist"}))}else e(Tt({code:"invalid",message:"Unexpected condition: no view model"}))}}function kt(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState.type===s.OK&&a.id.validationState.type===s.OK&&a.gravatarHash.validationState.type===s.OK&&a.description.validationState.type===s.OK?e({type:P.ADD_ORG_EVALUATE_OK}):e(It())}else e(Tt({code:"invalid",message:"Unexpected condition: no view model"}))}}function Mt(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new Se({token:r,username:n,groupsServiceURL:a.services.Groups.url})}function Ut(e){return function(t){var r=ve.validateOrgName(e),n=Object(We.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:P.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:P.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(kt())}}function Vt(e){return function(t){var r,n=ve.validateOrgGravatarHash(e),a=Object(We.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:P.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,gravatarHash:e,error:t}}(i,o)):t((r=i,{type:P.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,gravatarHash:r})),t(kt())}}var jt=function(){function e(t,r){Object(I.a)(this,e),this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(b.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),zt=null;function Lt(e){return function(t,r){t(function(e){return{type:P.ADD_ORG_UPDATE_ID_PASS,id:e}}(e));var n=ve.validateOrgId(e),a=Object(We.a)(n,2),i=a[0],o=a[1];if(o.type!==s.OK)return t(yt(i,o)),void t(kt());var c=r().views.addOrgView.viewModel;if(c){var u=c.newOrganization.id.validationState.validatedAt,l=(new Date).getTime();if(u)if(l-u.getTime()<500)return void(zt||(zt=new jt(500,function(){t(function(e,t){var r=t(),n=r.views.addOrgView.viewModel;if(n){var a=n.newOrganization.id,i=ve.validateOrgId(a.value),o=Object(We.a)(i,2),c=o[0],u=o[1];if(u.type!==s.OK)return e(yt(c,u)),void e(kt());var l=Mt(t());l.orgExists(c).then(function(t){e(t?yt(c,{type:s.ERROR,message:"This org id is already in use",validatedAt:new Date}):bt(c)),e(kt())})}})})));zt&&zt.cancel(),zt=null,Mt(r()).orgExists(i).then(function(e){t(e?yt(i,{type:s.ERROR,validatedAt:new Date,message:"This org id is already in use"}):bt(i)),t(kt())})}}}function Gt(e){return function(t,r){Mt(r());var n=ve.validateOrgDescription(e),a=Object(We.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:P.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(i,o)):t(function(e){return{type:P.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(i)),t(kt())}}var xt=r(313),Pt=r(66),Bt=r.n(Pt),qt=r(320),Wt=r(322),Ht=(r(237),function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,showError:!0},r.gravatarEmail=_.createRef(),r.origin=document.location.origin,r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onShowInfo",value:function(){dt.a.info({title:"New Organization Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"As a KBase user, you may create your own organizations."),_.createElement("p",null,"Once you have created an Organization, you will be the sole owner of it, forever."),_.createElement("p",null,"In order to create an Org, you need to complete the following fields."),_.createElement("dl",null,_.createElement("dt",null,"name"),_.createElement("dd",null,"The organization ",_.createElement("i",null,"name")," is whatever you wish to have your Org known as. It may be composed of any text (including unicode characters) up to 200 characters in length. You may also change it at any time."),_.createElement("dt",null,"logo"),_.createElement("dd",null,_.createElement("p",null,"Logo support has undergone a redesign, but has not yet been implemented. The new design supports direct image upload, and removes gravatar support."),_.createElement("p",null,"For now, gravatar is the only support for org logo"),_.createElement("p",null,'In order to display a custom logo for your organization, you need to associate your Organization with an avatar hosted with the Gravatar service. To do so, simply enter the email address associated with your gravatar and press the update button. This will calculate a new "gravatar hash" and associate it with your organization.')),_.createElement("dt",null,"id"),_.createElement("dd",null,_.createElement("p",null,"Your Org ",_.createElement("i",null,"id")," forms a url endpoint for your org as well as the identifier used throughout KBase to, well, identify your organization uniquely among all current and future organizations. As such, the Org ID may not be changed once created."),_.createElement("p",null,"The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also restricted to 100 characters in length.")),_.createElement("dt",null,"description"),_.createElement("dd",null,_.createElement("p",null,"Up to 4000 characters, a description allows you to express to other KBase users the purpose, history, associations, and science domain of your Org."),_.createElement("p",null,'The description is in "markdown" format, and the editor will show you a preview of the rendered description.'))))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){dt.a.confirm({title:"Leave the editor?",content:_.createElement("div",null,_.createElement("p",null,"You have entered information for this new organization."),_.createElement("p",null,"If you leave the editor without first saving, the new organization ",_.createElement("i",null,"will not be created"),"."),_.createElement("p",null,_.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===i.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===o.NEW||this.props.saveState===o.READY||this.props.saveState===o.SAVED)}},{key:"isModified",value:function(){return this.props.editState===i.EDITED&&this.props.saveState===o.NEW}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case a.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===a.DIRTY?_.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderForm",value:function(){return _.createElement("form",{id:"newOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},_.createElement("div",{className:"row"},_.createElement("div",{className:"col1 field-label"},"name"),_.createElement("div",{className:"col2"},_.createElement(qt.a,{value:this.props.newOrganization.name.value||"",className:this.calcFieldClass(this.props.newOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.newOrganization.name))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1 field-label"},"id"),_.createElement("div",{className:"col2"},_.createElement(qt.a,{value:this.props.newOrganization.id.value||"",className:this.calcFieldClass(this.props.newOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.newOrganization.id))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1 field-label"},"is private?"),_.createElement("div",{className:"col2"},_.createElement(Wt.a,{checked:this.props.newOrganization.isPrivate.value,className:this.calcFieldClass(this.props.newOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.newOrganization.isPrivate))),_.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},_.createElement("div",{className:"col1 field-label"},"description"),_.createElement("div",{className:"col2"},_.createElement("textarea",{value:this.props.newOrganization.description.value||"",className:this.calcFieldClass(this.props.newOrganization.description),onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.newOrganization.description))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1"}),_.createElement("div",{className:"col2"})))}},{key:"renderOrgAvatar",value:function(e){return _.createElement(ut,{gravatarHash:null,size:64,organizationName:e.name.value,organizationId:e.id.value})}},{key:"renderIsPrivate",value:function(e){return e?_.createElement("span",null,_.createElement(Ge.a,{type:"lock"})," ","Private"):_.createElement("span",null,_.createElement(Ge.a,{type:"global"})," ","Public")}},{key:"renderPreview",value:function(){return _.createElement("form",{className:"preview"},_.createElement("div",{className:"row"},_.createElement("div",{className:"col2"},_.createElement("div",{className:"name"},this.props.newOrganization.name.value||""))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col2"},_.createElement("div",{className:"id"},_.createElement("span",{style:{color:"silver"}},this.origin,"/#orgs/viewOrganization/"),this.props.newOrganization.id.value||_.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col2"},_.createElement("div",{className:"name"},this.renderIsPrivate(this.props.newOrganization.isPrivate.value)))),_.createElement("div",{className:"row",style:{flex:"1 1 0px"}},_.createElement("div",{className:"col2"},_.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:Bt()(this.props.newOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return _.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderHeader",value:function(){var e,t=this.props.newOrganization.name.value||_.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");this.props.error&&(e=_.createElement(mt.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}));var r=_.createElement(_.Fragment,null,_.createElement("span",null,_.createElement(Ge.a,{type:"plus-circle"})," ",'Adding a New Org "',t,'"')),n=_.createElement(_.Fragment,null,_.createElement(mt.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}),e);return _.createElement(vt,{breadcrumbs:r,buttons:n})}},{key:"renderLoadingHeader",value:function(){var e=_.createElement("span",null,"Loading New Org Editor...");return _.createElement(vt,{breadcrumbs:e})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return _.createElement("div",{key:"line_"+t},e)})),t&&(t=_.createElement("div",null,_.createElement("div",null,"trace"),t)),_.createElement(dt.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},_.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),_.createElement("div",null,this.props.error.message),t)}}},{key:"render",value:function(){return this.state.cancelToBrowser?_.createElement(xt.a,{push:!0,to:"/organizations"}):this.props.saveState===o.SAVED?_.createElement(xt.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):this.props.newOrganization?_.createElement("div",{className:"NewOrganization"},this.renderHeader(),_.createElement("div",{className:"mainRow"},_.createElement("div",{className:"editorColumn"},_.createElement("h3",null,"Editor"),this.renderForm()),_.createElement("div",{className:"previewColumn"},_.createElement("h3",null,"Preview"),this.renderPreview())),this.renderError()):_.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(_.Component));var Qt=Object(V.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(Dt())},onUpdateName:function(t){e(Ut(t))},onUpdateGravatarHash:function(t){e(Vt(t))},onUpdateId:function(t){e(Lt(t))},onUpdateDescription:function(t){e(Gt(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:P.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(kt())}}(t))}}})(Ht),Ft=(r(244),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return _.createElement("div",null,"Error!",_.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case h.SUCCESS:default:return _.createElement(Qt,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component));var Jt=Object(V.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(Ct())},onUnload:function(){e({type:P.ADD_ORG_UNLOAD})}}})(Ft),Yt=function(){function e(t){Object(I.a)(this,e),this.params=t}return Object(b.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n,a,i,s,o,c;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Se({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),n=new pe({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(s=e.sent,(o=he(a,this.params.username,i,s)).type!==de.ADMIN&&o.type!==de.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:c=e.sent,e.next=19;break;case 18:c=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:s,relation:o,groupRequests:c});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationsForUser",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t,r,n,a,i,s=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Se({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),r=new pe({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,t.getOwnOrgs();case 4:return n=e.sent,e.next=7,r.getOutboundRequests();case 7:return a=e.sent,e.next=10,r.getInboundRequests();case 10:return i=e.sent,e.next=13,Promise.all(n.map(function(){var e=Object(ne.a)(re.a.mark(function e(t){var n,o,c,l;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.find(function(e){return e.organizationId===t.id&&e.type===u.REQUEST&&e.resourceType===ie.USER}),o=i.find(function(e){return e.organizationId===t.id&&e.type===u.INVITATION&&e.resourceType===ie.USER}),(c=he(t,s.params.username,n||null,o)).type!==de.ADMIN&&c.type!==de.OWNER){e.next=9;break}return e.next=6,r.getPendingOrganizationRequestsForOrg(t.id);case 6:l=e.sent,e.next=10;break;case 9:l=null;case 10:return e.abrupt("return",{organization:t,request:n,invitation:o,relation:c,groupRequests:l});case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();function Kt(e){return{type:P.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrative:e}}function Xt(e){return{type:P.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function Zt(e){return{type:P.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e}}function $t(e){return{type:P.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function er(e){return{type:P.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function tr(){return{type:P.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function rr(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,p,v,h,O;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Yt({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),l=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,u.getOrganizationForUser(e);case 7:if(E=t.sent,d=E.organization,(m=E.relation).type!==de.OWNER&&m.type!==de.ADMIN){t.next=19;break}return t.next=13,l.getPendingOrganizationRequestsForOrg(e);case 13:return p=t.sent,t.next=16,l.getOrganizationInvitationsForOrg(e);case 16:v=t.sent,t.next=21;break;case 19:p=null,v=null;case 21:return t.next=23,l.getCombinedRequestInboxForOrg(e);case 23:return h=t.sent,t.next=26,l.getRequestOutboxForOrg(e);case 26:O=t.sent,r((f=d,w=m,S=p,g=v,_=h,A=O,{type:P.VIEW_ORG_LOAD_SUCCESS,organization:f,relation:w,groupRequests:S,groupInvitations:g,requestInbox:_,requestOutbox:A})),t.next=33;break;case 30:t.prev=30,t.t0=t.catch(4),r((R={code:t.t0.name,message:t.t0.message},{type:P.VIEW_ORG_LOAD_ERROR,error:R}));case 33:case"end":return t.stop()}var R,f,w,S,g,_,A},t,this,[[4,30]])}));return function(e,r){return t.apply(this,arguments)}}()}function nr(){return function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var a,i,s,o,c,u,l;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=r()).views.viewOrgView.viewModel){e.next=4;break}return t(er({type:n.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=a.views.viewOrgView.viewModel.organization,l=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),e.prev=6,e.next=9,l.requestMembershipToGroup(u.id);case 9:t({type:P.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(rr(u.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(er({type:n.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,this,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function ar(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,a){var i,s,o,c,u,l,E;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:P.VIEW_ORG_JOIN_REQUEST_START}),(i=a()).views.viewOrgView.viewModel){t.next=5;break}return r(er({type:n.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,i.views.viewOrgView.viewModel.organization,l=new pe({token:o,username:c,groupsServiceURL:u.services.Groups.url}),t.prev=7,t.next=10,l.cancelRequest(e);case 10:E=t.sent,r({type:P.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(rr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:n.ERROR,message:t.t0.message},{type:P.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function ir(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,a){var i,s,o,c,u,l,E;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(tr()),(i=a()).views.viewOrgView.viewModel){t.next=5;break}return r(er({type:n.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,i.views.viewOrgView.viewModel.organization,l=new pe({token:o,username:c,groupsServiceURL:u.services.Groups.url}),t.prev=7,t.next=10,l.acceptJoinInvitation(e);case 10:E=t.sent,r({type:P.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(rr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:P.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function sr(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,a){var i,s,o,c,u,l,E;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(tr()),(i=a()).views.viewOrgView.viewModel){t.next=5;break}return r(er({type:n.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,i.views.viewOrgView.viewModel.organization,l=new pe({token:o,username:c,groupsServiceURL:u.services.Groups.url}),t.prev=7,t.next=10,l.rejectJoinInvitation(e);case 10:E=t.sent,r({type:P.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(rr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:P.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}r(246);var or,cr=r(311),ur=r(316),lr=r(326),Er=r(321);r(248);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(or||(or={}));var dr=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={view:or.COMPACT},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case or.COMPACT:return or.NORMAL;case or.NORMAL:return or.COMPACT}}(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case Ee.OWNER:return _.createElement("span",null,_.createElement(Ge.a,{type:"crown"})," owner");case Ee.ADMIN:return _.createElement("span",null,_.createElement(Ge.a,{type:"unlock"})," admin");case Ee.MEMBER:return _.createElement("span",null,_.createElement(Ge.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){return _.createElement("div",{className:"Member View-COMPACT"},_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===or.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===or.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(Le,{user:this.props.user,size:this.props.avatarSize||30})),_.createElement("div",{className:"infoCol"},_.createElement("div",{className:"name"},_.createElement("a",{href:"#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),_.createElement("div",{className:"role"},this.renderRole()),_.createElement("div",{className:"joinedAt"},_.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt))))}},{key:"renderNormal",value:function(){return _.createElement("div",{className:"Member View-NORMAL"},_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===or.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===or.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(Le,{user:this.props.user,size:this.props.avatarSize||30})),_.createElement("div",{className:"infoCol"},_.createElement("div",{className:"name"},_.createElement("a",{href:"#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),_.createElement("div",{className:"role"},this.renderRole()),_.createElement("div",{className:"joinedAt"},_.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt)),_.createElement("div",{className:"title"},this.props.user.title||_.createElement("i",null,"no title in user profile")),_.createElement("div",{className:"organization"},this.props.user.organization||_.createElement("i",null,"no organization in user profile")),_.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||_.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case or.COMPACT:return this.renderCompact();case or.NORMAL:return this.renderNormal()}}}]),t}(_.Component),mr=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.user?_.createElement(dr,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):_.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(_.Component);var pr,vr=Object(V.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(nt(t))}}})(mr),hr=r(324);r(250);!function(e){e[e.NONE=0]="NONE",e[e.MANAGE_MEMBERSHIP=1]="MANAGE_MEMBERSHIP",e[e.VIEW_MEMBERS=2]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=3]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=4]="VIEW_ORGANIZATION",e[e.EDIT_ORGANIZATION=5]="EDIT_ORGANIZATION",e[e.INVITE_USER=6]="INVITE_USER"}(pr||(pr={}));var Or=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={navigateTo:pr.NONE},r.relation=r.getUserRelation(),r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"getUserRelation",value:function(){var e=this.props.currentUsername,t=this.props.organization;if(e===t.owner.username)return{type:de.OWNER};var r=t.members.find(function(t){return t.username===e});if(!r)return this.props.pendingJoinRequest&&this.props.pendingJoinRequest.user===e?{type:de.MEMBER_REQUEST_PENDING,requestId:this.props.pendingJoinRequest.id}:this.props.pendingJoinInvitation&&this.props.pendingJoinInvitation.user===e?{type:de.MEMBER_INVITATION_PENDING,requestId:this.props.pendingJoinInvitation.id}:{type:de.VIEW};switch(r.type){case c.MEMBER:return{type:de.MEMBER};case c.ADMIN:return{type:de.ADMIN};case c.OWNER:return{type:de.OWNER};default:return{type:de.NONE}}}},{key:"onJoinClick",value:function(){this.props.onJoinOrg(),hr.a.success("Join request has been submitted")}},{key:"onCancelJoinRequest",value:function(){var e=this.relation;this.props.onCancelJoinRequest(e.requestId),hr.a.success("Submitted cancellation request")}},{key:"onAcceptInvitation",value:function(){var e=this.relation;this.props.onAcceptInvitation(e.requestId),hr.a.success("Invitation acceptance has been sent")}},{key:"onRejectInvitation",value:function(){var e=this.relation;this.props.onRejectInvitation(e.requestId),hr.a.success("Invitation rejection has been sent")}},{key:"onNavigateToMembership",value:function(){this.setState({navigateTo:pr.MANAGE_MEMBERSHIP})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:pr.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:pr.MANAGE_REQUESTS})}},{key:"onNavigateToEditOrganization",value:function(){this.setState({navigateTo:pr.EDIT_ORGANIZATION})}},{key:"onNavigateToInviteUser",value:function(){this.setState({navigateTo:pr.INVITE_USER})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:pr.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({navigateTo:pr.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:pr.VIEW_MEMBERS});break;case"editOrg":this.setState({navigateTo:pr.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({navigateTo:pr.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:pr.MANAGE_REQUESTS})}}},{key:"renderOrgAvatar",value:function(e){return _.createElement(ut,{gravatarHash:e.gravatarHash,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderRelation",value:function(){this.props.organization;switch(this.relation.type){case de.NONE:return _.createElement("span",null,_.createElement(Ge.a,{type:"stop"}),"None");case de.VIEW:return _.createElement("div",null,_.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it, you may request membership"},_.createElement("div",{style:{textAlign:"center"}},_.createElement(Ge.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization")),_.createElement("div",{style:{textAlign:"center"}},_.createElement(mt.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization")));case de.MEMBER_REQUEST_PENDING:return _.createElement("div",null,_.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have requested membership in this Organization"},"   ",_.createElement("div",{style:{textAlign:"center"}},_.createElement("span",null,_.createElement(Ge.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",_.createElement("b",null,"request")," is pending"," ",_.createElement(Ge.a,{type:"question-circle"})))),_.createElement("div",{style:{textAlign:"center"}},_.createElement(mt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case de.MEMBER_INVITATION_PENDING:return _.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this Organization"},_.createElement("div",{style:{textAlign:"center"}},_.createElement("div",null,_.createElement(Ge.a,{type:"user",style:{color:"blue"}}),"You have been ",_.createElement("b",null,"invited")," to join this Organization"),_.createElement("div",null,_.createElement(mt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),_.createElement(mt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"))));case de.MEMBER:var e=_.createElement(lr.a,{onClick:this.onMenuClick.bind(this)},_.createElement(lr.a.Item,{key:"manageMyMembership"},"Manage My Membership"));return _.createElement("div",{className:"relationRow"},_.createElement("div",{className:"relationLabel"},_.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},_.createElement("div",null,_.createElement(Ge.a,{type:"user"}),"You are a ",_.createElement("b",null,"member")," of this Organization"))),_.createElement("div",{className:"relationMenu"},_.createElement("div",null,_.createElement(Er.a,{overlay:e,trigger:["click"]},_.createElement(mt.a,{shape:"circle"},_.createElement(Ge.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case de.ADMIN:var t=_.createElement(lr.a,{onClick:this.onMenuClick.bind(this)},_.createElement(lr.a.Item,{key:"manageMyMembership"},"Manage My Membership"),_.createElement(lr.a.Item,{key:"viewMembers"},"Members"),_.createElement(lr.a.Item,{key:"manageRequests"},"Manage Requests"),_.createElement(lr.a.Item,{key:"editOrg"},"Edit this Org"),_.createElement(lr.a.Item,{key:"inviteUser"},"Invite User"));return _.createElement("div",{className:"relationRow"},_.createElement("div",{className:"relationLabel"},_.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an Administrator for this organization"},_.createElement("div",null,_.createElement(Ge.a,{type:"unlock"}),"You are a ",_.createElement("b",null,"administrator")," of this Organization"))),_.createElement("div",{className:"relationMenu"},_.createElement("div",null,_.createElement(Er.a,{overlay:t,trigger:["click"]},_.createElement(mt.a,{shape:"circle"},_.createElement(Ge.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case de.OWNER:var r=_.createElement(lr.a,{onClick:this.onMenuClick.bind(this)},_.createElement(lr.a.Item,{key:"viewMembers"},"Members"),_.createElement(lr.a.Item,{key:"manageRequests"},"Manage Requests"),_.createElement(lr.a.Item,{key:"editOrg"},"Edit this Org"),_.createElement(lr.a.Item,{key:"inviteUser"},"Invite User"));return _.createElement("div",{className:"relationRow"},_.createElement("div",{className:"relationLabel"},_.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this organization"},_.createElement("div",null,_.createElement(Ge.a,{type:"crown",style:{color:"gold"}})," ","You ",_.createElement("b",null,"own")," this Organization"))),_.createElement("div",{className:"relationMenu"},_.createElement("div",null,_.createElement(Er.a,{overlay:r,trigger:["click"]},_.createElement(mt.a,{shape:"circle"},_.createElement(Ge.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))))}}},{key:"renderOrgInfo",value:function(){var e=this.props.organization;return _.createElement(_.Fragment,null,_.createElement("div",{className:"name"},e.name),_.createElement("div",{className:"owner"},_.createElement(st,{member:e.owner,avatarSize:20})))}},{key:"getRelationClass",value:function(e){switch(this.relation.type){case de.NONE:return"relationRequest";case de.VIEW:return"relationRequest relationNonMember";case de.MEMBER_REQUEST_PENDING:return"relationRequest relationRequestPending";case de.MEMBER_INVITATION_PENDING:return"relationRequest relationInvitationPending";case de.MEMBER:return"relationRequest relationMember";case de.ADMIN:return"relationRequest relationAdmin";case de.OWNER:return"relationRequest relationOwner"}}},{key:"render",value:function(){switch(this.state.navigateTo){case pr.MANAGE_MEMBERSHIP:return _.createElement(xt.a,{push:!0,to:"/membership/"+this.props.organization.id});case pr.VIEW_MEMBERS:return _.createElement(xt.a,{push:!0,to:"/viewMembers/"+this.props.organization.id});case pr.EDIT_ORGANIZATION:return _.createElement(xt.a,{push:!0,to:"/editOrganization/"+this.props.organization.id});case pr.MANAGE_REQUESTS:return _.createElement(xt.a,{push:!0,to:"/manageOrganizationRequests/"+this.props.organization.id});case pr.INVITE_USER:return _.createElement(xt.a,{push:!0,to:"/inviteUser/"+this.props.organization.id});case pr.VIEW_ORGANIZATION:return _.createElement(xt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id})}return _.createElement("div",{className:"OrganizationHeader"},_.createElement("div",{className:"avatar"},this.renderOrgAvatar(this.props.organization)),_.createElement("div",{className:"orgInfo"},this.renderOrgInfo()),_.createElement("div",{className:"yourRelation "+this.getRelationClass(this.props.organization)},this.renderRelation()))}}]),t}(_.Component);var Rr=Object(V.b)(function(e,t){var r=e.views.organizationCentricView.viewModel,n=e.auth.authorization.username;if(!r)throw new Error("View model is unexpectedly missing");return{organization:r.organization,pendingJoinRequest:r.pendingJoinRequest,pendingJoinInvitation:r.pendingJoinInvitation,currentUsername:n}},function(e){return{onJoinOrg:function(){e(nr())},onCancelJoinRequest:function(t){e(ar(t))},onAcceptInvitation:function(t){e(ir(t))},onRejectInvitation:function(t){e(sr(t))}}})(Or);function fr(e){var t=e.organization,r=e.pendingJoinRequest,n=e.pendingJoinInvitation,a=e.relation;return{type:P.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,organization:t,pendingJoinRequest:r,pendingJoinInvitation:n,relation:a}}var wr=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Loading header...")}},{key:"renderError",value:function(e){return _.createElement("div",null,"Error!",_.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return _.createElement(Rr,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var Sr,gr=Object(V.b)(function(e,t){return{view:e.views.organizationCentricView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,p;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.ORGANIZATION_CENTRIC_VIEW_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),l=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,u.getOrg(e);case 7:return E=t.sent,t.next=10,l.getUserRequestForOrg(e);case 10:return d=t.sent,t.next=13,l.getUserInvitationForOrg(e);case 13:m=t.sent,p=he(E,o,d,m),r(fr({organization:E,relation:p,pendingJoinRequest:d,pendingJoinInvitation:m})),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(4),r((v={code:t.t0.name,message:t.t0.message},{type:P.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,error:v}));case 21:case"end":return t.stop()}var v},t,this,[[4,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:P.ORGANIZATION_CENTRIC_VIEW_UNLOAD})}}})(wr),_r=r(323);r(252);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Sr||(Sr={}));var Ar=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={view:Sr.COMPACT},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case Sr.COMPACT:return Sr.NORMAL;case Sr.NORMAL:return Sr.COMPACT}}(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?_.createElement(cr.a,{title:"This narrative is viewable by all KBase users",placement:"right"},_.createElement("span",{style:{cursor:"help"}},_.createElement(Ge.a,{type:"globe"})," Public Narrative")):_.createElement(cr.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},_.createElement("span",{style:{cursor:"help"}},_.createElement(Ge.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case Ke.VIEW:t="View-Only";break;case Ke.EDIT:t="Edit";break;case Ke.ADMIN:t="Admin";break;case Ke.OWNER:t="Owner";break;default:t="Unknown"}return _.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return _.createElement(_.Fragment,null,_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Sr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===Sr.NORMAL?"up":"down")}))),_.createElement("div",{className:"mainCol"},_.createElement("div",{className:"title"},_.createElement("a",{href:"//narrative/"+e.workspaceId,target:"_blank"},e.title)),_.createElement("div",null,this.renderPublicPermission(e)),_.createElement("div",null,_.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e))))}},{key:"renderNormal",value:function(e){return _.createElement(_.Fragment,null,_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Sr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===Sr.NORMAL?"up":"down")}))),_.createElement("div",{className:"mainCol"},_.createElement("div",{className:"title"},_.createElement("a",{href:"//narrative/"+e.workspaceId,target:"_blank"},e.title)),_.createElement("div",null,this.renderPublicPermission(e)),_.createElement("div",null,_.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),_.createElement("div",null,_.createElement("span",{className:"field-label"},"owner"),e.owner),_.createElement("div",null,_.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),_.createElement("div",null,_.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===Ke.NONE)return _.createElement("div",null,"You don't have access to this Narrative");switch(this.state.view){case Sr.COMPACT:return _.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case Sr.NORMAL:return _.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(_.Component),Nr=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.narrative?_.createElement(Ar,{narrative:this.props.narrative}):_.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(_.Component);var Tr=Object(V.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(at(t))}}})(Nr),Ir=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case me.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=_.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you can obtain personal View-Only access by clicking this button",r=_.createElement(mt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=_.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=_.createElement(mt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for Access"));break;case me.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=_.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=_.createElement(mt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case me.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=_.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=_.createElement(mt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case me.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=_.createElement("span",null,"Admin");break;case me.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=_.createElement("span",null,"Owner");break;default:t=_.createElement("span",null,"Unknown")}return _.createElement(_.Fragment,null,_.createElement(cr.a,{title:n,placement:"right"},_.createElement("span",{style:{cursor:"help"}},_.createElement("span",{className:"field-label"},"your permission"),t))," ",_.createElement(cr.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?_.createElement(cr.a,{title:"This narrative is viewable by all KBase users",placement:"right"},_.createElement("span",{style:{cursor:"help"}},_.createElement(Ge.a,{type:"globe"})," Public Narrative")):_.createElement(cr.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},_.createElement("span",{style:{cursor:"help"}},_.createElement(Ge.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return e.permission===me.NONE?_.createElement(_.Fragment,null,_.createElement("div",{className:"title"},e.title),_.createElement("div",null,this.renderNarrativePermission(e))):_.createElement(Tr,{workspaceId:e.workspaceId})}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=_.createElement(_r.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),_.createElement("div",null,this.renderNarrative(),e)}}]),t}(_.Component),br=r(47),yr=r.n(br);function Cr(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:P.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:P.DASHBOARD_CANCEL_OUTBOX_REQUEST_START}),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,u.cancelRequest(e.id);case 8:return t.sent,t.next=11,u.getOutboundRequests();case 11:l=t.sent,r({type:P.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS,requests:l}),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),r({type:P.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 18:case"end":return t.stop()}},t,this,[[5,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function Dr(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),s=Math.abs(i);if(s<7776e3){if(0===s)return"now";s<60?(t=i,r=s,n="second"):s<3600?(t=Math.round(i/60),r=Math.round(s/60),n="minute"):s<86400?(t=Math.round(i/3600),r=Math.round(s/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(s/86400),n="day"),r>1&&(n+="s");var o=null,c=null;return t<0?o="in":t>0&&(c="ago"),(o?o+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var kr;r(256);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(kr||(kr={}));var Mr=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={view:kr.COMPACT},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case kr.COMPACT:return kr.NORMAL;case kr.NORMAL:return kr.COMPACT}}(this.state.view)})}},{key:"renderAvatar",value:function(e){return _.createElement(ut,{gravatarHash:e.gravatarHash,size:32,organizationName:e.name,organizationId:e.id})}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(e){return _.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderNormal",value:function(){var e=this.props.organization;return _.createElement("div",{className:"OrganizationCompact",key:e.id},_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===kr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===kr.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),_.createElement("div",{className:"bodyCol"},_.createElement("div",{className:"orgName"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},e.name)),_.createElement("div",{className:"orgOwner"},_.createElement("span",{className:"field-label"},"owner"),_.createElement("span",null,_.createElement(st,{member:e.owner,avatarSize:30}))),_.createElement("div",{className:"orgCreated"},_.createElement("span",{className:"field-label"},"established"),_.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))))}},{key:"renderCompact",value:function(){var e=this.props.organization;return _.createElement("div",{className:"OrganizationCompact",key:e.id},_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===kr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===kr.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),_.createElement("div",{className:"bodyCol"},_.createElement("div",{className:"orgName"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},e.name))))}},{key:"render",value:function(){switch(this.state.view){case kr.COMPACT:return _.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case kr.NORMAL:return _.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(_.Component),Ur=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.organization?_.createElement(Mr,{organization:this.props.organization}):_.createElement("div",null,"Loading org...")}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(_.Component);var Vr,jr=Object(V.b)(function(e,t){return{organization:e.entities.orgs.byId.get(t.organizationId)}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.ENTITY_ORGANIZATION_LOADER_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,u.getOrg(e);case 6:l=t.sent,r((d=l,{type:P.ENTITY_ORGANIZATION_LOADER_SUCCESS,organization:d})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:"error",message:t.t0.message},{type:P.ENTITY_ORGANIZATION_LOADER_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Ur);r(258);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Vr||(Vr={}));var zr=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={view:Vr.COMPACT},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case Vr.COMPACT:return Vr.NORMAL;case Vr.NORMAL:return Vr.COMPACT}}(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?_.createElement(cr.a,{title:"This narrative is viewable by all KBase users",placement:"right"},_.createElement("span",{style:{cursor:"help"}},_.createElement(Ge.a,{type:"globe"})," Public Narrative")):_.createElement(cr.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},_.createElement("span",{style:{cursor:"help"}},_.createElement(Ge.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case Ke.VIEW:t="View-Only";break;case Ke.EDIT:t="Edit";break;case Ke.ADMIN:t="Admin";break;case Ke.OWNER:t="Owner";break;default:t="Unknown"}return _.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return _.createElement(_.Fragment,null,_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Vr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===Vr.NORMAL?"up":"down")}))),_.createElement("div",{className:"iconCol"},_.createElement(Ge.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),_.createElement("div",{className:"mainCol"},_.createElement("div",{className:"title"},_.createElement("a",{href:"//narrative/"+e.workspaceId,target:"_blank"},e.title))))}},{key:"renderNormal",value:function(e){return _.createElement(_.Fragment,null,_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Vr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===Vr.NORMAL?"up":"down")}))),_.createElement("div",{className:"iconCol"},_.createElement(Ge.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),_.createElement("div",{className:"mainCol"},_.createElement("div",{className:"title"},_.createElement("a",{href:"//narrative/"+e.workspaceId,target:"_blank"},e.title)),_.createElement("div",null,this.renderPublicPermission(e)),_.createElement("div",null,_.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),_.createElement("div",null,_.createElement("span",{className:"field-label"},"owner"),e.owner),_.createElement("div",null,_.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),_.createElement("div",null,_.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===Ke.NONE)return _.createElement("div",null,_.createElement(Ge.a,{type:"exclamation-circle",style:{color:"orange"}})," ","You don't have access to this Narrative");switch(this.state.view){case Vr.COMPACT:return _.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case Vr.NORMAL:return _.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(_.Component),Lr=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.narrative?_.createElement(zr,{narrative:this.props.narrative}):_.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(_.Component);var Gr,xr=Object(V.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(at(t))}}})(Lr);r(260);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Gr||(Gr={}));var Pr=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={view:Gr.COMPACT},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case Gr.COMPACT:return Gr.NORMAL;case Gr.NORMAL:return Gr.COMPACT}}(this.state.view)})}},{key:"renderCompact",value:function(){return _.createElement(_.Fragment,null,_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Gr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===Gr.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(Le,{user:this.props.user,size:this.props.avatarSize||30})),_.createElement("div",{className:"infoCol"},_.createElement("div",{className:"name"},_.createElement("a",{href:"#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769")))}},{key:"renderNormal",value:function(){return _.createElement(_.Fragment,null,_.createElement("div",{className:"controlCol"},_.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Gr.NORMAL?"pressed":"")},_.createElement(Ge.a,{type:"".concat(this.state.view===Gr.NORMAL?"up":"down")}))),_.createElement("div",{className:"avatarCol"},_.createElement(Le,{user:this.props.user,size:this.props.avatarSize||30})),_.createElement("div",{className:"infoCol"},_.createElement("div",{className:"name"},_.createElement("a",{href:"#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),_.createElement("div",{className:"organization"},this.props.user.organization||_.createElement("i",null,"no organization in user profile")),_.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||_.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case Gr.COMPACT:return _.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case Gr.NORMAL:return _.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(_.Component),Br=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.user?_.createElement(Pr,{user:this.props.user,avatarSize:this.props.avatarSize}):_.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(_.Component);var qr=Object(V.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(nt(t))}}})(Br),Wr=(r(262),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onAcceptRequest",value:function(){this.props.onAcceptInboxRequest(this.props.request)}},{key:"onRejectRequest",value:function(){this.props.onRejectInboxRequest(this.props.request)}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.APP:return"SHOW APP";case ie.USER:return"";case ie.WORKSPACE:return _.createElement("div",null,_.createElement("div",{className:"miniDetail"},_.createElement(xr,{workspaceId:parseInt(e.narrativeId,10)})))}case ae.INVITATION:switch(e.resourceType){case ie.USER:return _.createElement("div",null,_.createElement("div",{className:"miniDetail"},_.createElement(qr,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return _.createElement(qr,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.APP:return"REQUEST to associate App";case ie.USER:return"REQUEST to join Organization";case ie.WORKSPACE:return"REQUEST to associate Narrative"}case ae.INVITATION:switch(e.resourceType){case ie.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.APP:return"SHOW APP";case ie.USER:return"";case ie.WORKSPACE:return _.createElement("div",null,_.createElement("div",{className:"miniDetail"},_.createElement(xr,{workspaceId:parseInt(e.narrativeId,10)})),_.createElement("div",{className:"cardSectionHeader"},"with organization"))}case ae.INVITATION:switch(e.resourceType){case ie.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return _.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),_.createElement("div",{className:"miniDetail"},_.createElement(jr,{organizationId:e.organizationId})),_.createElement("div",{className:"cardSectionHeader"},"from"),_.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){var t;return this.props.showOrg&&(t=_.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"with organization"),_.createElement("div",{className:"miniDetail"},_.createElement(jr,{organizationId:e.organizationId})))),_.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),_.createElement("div",{className:"miniDetail"},_.createElement(xr,{workspaceId:parseInt(e.narrativeId,10)})),t,_.createElement("div",{className:"cardSectionHeader"},"from"),_.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return _.createElement("div",{style:{textAlign:"center"}},_.createElement(mt.a.Group,{style:{marginTop:"4px"}},_.createElement(mt.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},_.createElement(Ge.a,{type:"check"}),"Accept"),_.createElement(mt.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},_.createElement(Ge.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return _.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),_.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),_.createElement("div",{className:"miniDetail"},_.createElement(jr,{organizationId:e.organizationId})),_.createElement("div",{className:"cardSectionHeader"},"from"),_.createElement(qr,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.USER:return this.renderJoinRequest(e);case ie.WORKSPACE:return this.renderWorkspaceRequest(e);case ie.APP:return _.createElement(_.Fragment,null,_.createElement("div",null,"apps not supported yet"))}case ae.INVITATION:switch(e.resourceType){case ie.USER:return this.renderUserInvitation(e);case ie.WORKSPACE:case ie.APP:return _.createElement(_.Fragment,null,_.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return _.createElement("div",{key:e.id,className:"InboxRequest"},_.createElement("div",{className:"requestHeader"},_.createElement("div",{className:"requestHeaderRow"},_.createElement("div",{className:"requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),_.createElement("div",{className:"requestHeaderExpireAt"},_.createElement("span",{className:"field-label"},"expires")," ",Dr(e.expireAt)))),_.createElement("div",{className:"requestBody"},this.renderBody()))}}]),t}(_.Component));var Hr=Object(V.b)(function(e,t){return{}},function(e){return{onRejectInboxRequest:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:P.DASHBOARD_REJECT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:P.DASHBOARD_REJECT_INBOX_REQUEST_START}),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,u.denyRequest(e.id);case 8:return t.sent,t.next=11,u.getInboundRequests();case 11:l=t.sent,r({type:P.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS,requests:l}),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),r({type:P.DASHBOARD_REJECT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 18:case"end":return t.stop()}},t,this,[[5,15]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Wr),Qr=(r(264),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.APP:return"SHOW APP";case ie.USER:return"";case ie.WORKSPACE:return _.createElement("div",null,_.createElement("div",{className:"miniDetail"},_.createElement(xr,{workspaceId:parseInt(e.narrativeId,10)})))}case ae.INVITATION:switch(e.resourceType){case ie.USER:return _.createElement("div",null,_.createElement("div",{className:"miniDetail"},_.createElement(qr,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return _.createElement(qr,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.APP:return"REQUEST to associate App";case ie.USER:return"REQUEST to join Organization";case ie.WORKSPACE:return"REQUEST to associate Narrative"}case ae.INVITATION:switch(e.resourceType){case ie.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.APP:return"SHOW APP";case ie.USER:return"";case ie.WORKSPACE:return _.createElement("div",null,_.createElement("div",{className:"miniDetail"},_.createElement(xr,{workspaceId:parseInt(e.narrativeId,10)})),_.createElement("div",{className:"cardSectionHeader"},"with organization"))}case ae.INVITATION:switch(e.resourceType){case ie.USER:return _.createElement(qr,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){var t;return this.props.showOrg&&(t=_.createElement("div",{className:"miniDetail"},_.createElement(jr,{organizationId:e.organizationId}))),_.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),t,this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return this.props.showOrg&&_.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"with organization"),_.createElement("div",{className:"miniDetail"},_.createElement(jr,{organizationId:e.organizationId}))),_.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),_.createElement("div",{className:"miniDetail"},_.createElement(xr,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return _.createElement("div",{style:{textAlign:"center"}},_.createElement(mt.a.Group,{style:{marginTop:"4px"}},_.createElement(mt.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},_.createElement(Ge.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){var t;return this.props.showOrg&&(t=_.createElement("div",{className:"miniDetail"},_.createElement(jr,{organizationId:e.organizationId}))),_.createElement(_.Fragment,null,_.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),t,_.createElement("div",{className:"cardSectionHeader"},"sent to"),_.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case ae.REQUEST:switch(e.resourceType){case ie.USER:return this.renderJoinRequest(e);case ie.WORKSPACE:return this.renderWorkspaceRequest(e);case ie.APP:return _.createElement(_.Fragment,null,_.createElement("div",null,"apps not supported yet"))}case ae.INVITATION:switch(e.resourceType){case ie.USER:return this.renderUserInvitation(e);case ie.WORKSPACE:case ie.APP:return _.createElement(_.Fragment,null,_.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return _.createElement("div",{key:e.id,className:"OutboxRequest"},_.createElement("div",{className:"requestHeader"},_.createElement("div",{className:"requestHeaderRow"},_.createElement("div",{className:"requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),_.createElement("div",{className:"requestHeaderExpireAt"},_.createElement("span",{className:"field-label"},"expires")," ",Dr(e.expireAt)))),_.createElement("div",{className:"requestBody"},this.renderBody()))}}]),t}(_.Component));var Fr,Jr=Object(V.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e(Cr(t))}}})(Qr);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(Fr||(Fr={}));var Yr=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Fr.NONE,requestAccess:{narrative:null}},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({navigateTo:Fr.REQUEST_ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){dt.a.info({title:"View Organization Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the organizations viewer..."))})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return _.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.relation.type===de.ADMIN||this.props.relation.type===de.OWNER)return _.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",_.createElement(je.a,{to:"/editOrganization/".concat(this.props.organization.id)},_.createElement(mt.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.relation.type===de.ADMIN||this.props.relation.type===de.OWNER)return _.createElement(je.a,{to:"/editOrganization/".concat(this.props.organization.id)},_.createElement(mt.a,{icon:"edit"},"Edit"))}},{key:"renderOrg",value:function(){if(this.props.organization)return _.createElement("div",{className:"org"},_.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:Bt()(this.props.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return _.createElement("div",{className:"ownerTable"},_.createElement("div",{className:"proprietorCol"},_.createElement("div",{className:"owner"},_.createElement("a",{href:"#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return _.createElement(gr,{organizationId:this.props.organization.id})}},{key:"renderOrgAvatar",value:function(e){return _.createElement(ut,{gravatarHash:e.gravatarHash,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderRelation",value:function(e){switch(e.type){case de.NONE:return _.createElement("span",null,_.createElement(Ge.a,{type:"stop"}),"None");case de.VIEW:return _.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},_.createElement("div",null,_.createElement(Ge.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),_.createElement("div",{style:{marginTop:"10px"}},_.createElement(mt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case de.MEMBER_REQUEST_PENDING:return _.createElement("div",null,_.createElement("div",null,_.createElement(Ge.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",_.createElement("b",null,"request")," is pending"),_.createElement("div",null,_.createElement(mt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case de.MEMBER_INVITATION_PENDING:return _.createElement("div",null,_.createElement("div",null,_.createElement(Ge.a,{type:"user",style:{color:"blue"}}),"You have been ",_.createElement("b",null,"invited")," to join this Organization"),_.createElement("div",{style:{marginTop:"10px"}},_.createElement(mt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),_.createElement(mt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case de.MEMBER:return _.createElement("span",null,_.createElement(Ge.a,{type:"user"}),"Member");case de.ADMIN:return _.createElement("span",null,_.createElement(Ge.a,{type:"unlock"}),"Admin");case de.OWNER:return _.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},_.createElement("span",null,_.createElement(Ge.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===de.OWNER||this.props.relation.type===de.ADMIN||this.props.relation.type===de.MEMBER)}},{key:"renderMembers",value:function(){if(!this.isMember())return _.createElement("p",{className:"message"},"Sorry, organization membership restricted to members only");var e,t=_.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No members, yet; what is an Organization without people?");return e=0===this.props.organization.members.length?_.createElement(ze.a,{type:"info",message:t}):this.props.organization.members.map(function(e){return _.createElement("div",{className:"row",key:e.username},_.createElement("div",{className:"col0"},_.createElement(vr,{member:e,avatarSize:50})))}),_.createElement("div",{className:"infoTable"},e)}},{key:"renderInfo",value:function(){if(this.props.organization)return _.createElement(ur.a,{title:_.createElement("span",null,_.createElement(Ge.a,{type:"info-circle"})," info"),headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard"},_.createElement("div",null,_.createElement("div",null,_.createElement("div",{className:"label"},"owner")),_.createElement("div",{className:"ownerTable"},_.createElement(vr,{member:this.props.organization.owner,avatarSize:50})),_.createElement("div",{className:"infoTable"},_.createElement("div",{className:"row"},_.createElement("div",{className:"col1"},_.createElement("span",{className:"label"},"established")),_.createElement("div",{className:"col2"},_.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.createdAt)))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1"},_.createElement("span",{className:"label"},"last updated")),_.createElement("div",{className:"col2"},_.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.modifiedAt)))))))}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.relation,r=this.props.groupRequests,n=this.props.groupInvitations;if((t.type===de.ADMIN||t.type===de.OWNER)&&(null!==r&&null!==n))return e=r.length?_.createElement("div",null,"group has no pending requests"):_.createElement("div",null,_.createElement("div",null,_.createElement(Ge.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",_.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",_.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),_.createElement("div",null,_.createElement(je.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},_.createElement(mt.a,null,"Manage Requests")))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1"},_.createElement("span",{className:"label"},"admin")),_.createElement("div",{className:"col2"},_.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?_.createElement("div",null,_.createElement("div",null,_.createElement(Ge.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",_.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",_.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),_.createElement("div",null,_.createElement(je.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},_.createElement(mt.a,null,"Manage Requests")))):_.createElement("div",{className:"message"},"No pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case de.NONE:case de.VIEW:return"infoBox";case de.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case de.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case de.MEMBER:case de.ADMIN:case de.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return _.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.relation;if(e.type===de.ADMIN||e.type===de.OWNER){var t=this.props,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=_.createElement("span",null,_.createElement(Ge.a,{type:"unlock"})," ","group requests"," ",_.createElement("span",{className:"titleCount"},"(",a,")"));return _.createElement("div",{className:"adminTasksBox"},_.createElement(ur.a,{className:"slimCard adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.organization&&this.props.relation.type===de.VIEW)return _.createElement(mt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderHeader",value:function(){var e=_.createElement("div",{style:{flex:"0 0 auto"}},_.createElement("span",null,this.props.organization&&this.props.organization.name)),t=_.createElement(_.Fragment,null,this.renderEditButton(),this.renderJoinButton(),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=_.createElement("span",null,"Loading Org...");return _.createElement(vt,{breadcrumbs:e})}},{key:"renderMembersCard",value:function(){var e=[_.createElement(je.a,{key:"viewMembers",to:"/viewMembers/".concat(this.props.organization.id)},_.createElement(mt.a,{onClick:this.onViewMembers.bind(this),icon:"team"}))];if(this.props.organization){var t;t=this.isMember()?_.createElement("span",{className:"titleCount"},"(",this.props.organization.members.length,")"):"";var r=_.createElement("span",null,_.createElement(Ge.a,{type:"team"}),"members",t);return _.createElement(ur.a,{className:"slimCard membersCard",headStyle:{backgroundColor:"gray",color:"white"},title:r,extra:e},this.renderMembers())}}},{key:"renderNotificationsCard",value:function(){var e=_.createElement("span",{className:"titleCount"},"(0)"),t=_.createElement("span",null,_.createElement(Ge.a,{type:"notification"}),"notifications",e);return _.createElement(ur.a,{className:"slimCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:t},"not yet implemented")}},{key:"onAcceptRequest",value:function(e){this.props.onAcceptRequest(e)}},{key:"renderInboxCard",value:function(){var e=this;if(this.props.relation.type===de.ADMIN||this.props.relation.type===de.OWNER){var t,r=this.props.requestInbox.length,n=_.createElement("span",null,_.createElement(Ge.a,{type:"inbox"}),"inbox",_.createElement("span",{className:"titleCount"},"(",r,")"));return t=0===this.props.requestInbox.length?_.createElement("div",{className:"message"},"No pending organization requests for you"):this.props.requestInbox.map(function(t){return _.createElement(_.Fragment,{key:t.id},_.createElement(Hr,{request:t,showOrg:!1,onAcceptInboxRequest:e.onAcceptRequest.bind(e)}))}),_.createElement(ur.a,{className:"slimCard outboxCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:n,extra:[]},t)}}},{key:"renderOutboxCard",value:function(){var e,t=this.props.requestOutbox.length,r=_.createElement("span",null,_.createElement(Ge.a,{type:"export"}),"outbox",_.createElement("span",{className:"titleCount"},"(",t,")"));return e=0===this.props.requestOutbox.length?_.createElement("div",{className:"message"},"No pending organization requests from you"):this.props.requestOutbox.map(function(e){return _.createElement(_.Fragment,{key:e.id},_.createElement(Jr,{request:e,showOrg:!1}))}),_.createElement(ur.a,{className:"slimCard outboxCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:r,extra:[]},e)}},{key:"renderNarrativeMenu",value:function(e){var t,r=this,n=this.props.relation;n.type===de.OWNER||(n.type,de.ADMIN);switch(n.type){case de.NONE:break;case de.VIEW:case de.MEMBER_REQUEST_PENDING:case de.MEMBER_INVITATION_PENDING:case de.MEMBER:break;case de.ADMIN:case de.OWNER:t=_.createElement(lr.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},_.createElement(lr.a.Item,{key:"removeNarrative"},_.createElement(Ge.a,{type:"delete"})," Remove Narrative from Organization"))}if(t)return _.createElement(Er.a,{overlay:t,trigger:["click"]},_.createElement(mt.a,{shape:"circle"},_.createElement(Ge.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}})))}},{key:"renderNarratives",value:function(){var e=this;if(!this.isMember())return _.createElement(ur.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:_.createElement("span",null,_.createElement(Ge.a,{type:"folder-open"})," narratives")},_.createElement("p",{style:{textAlign:"center",fontStyle:"italic"}},"Sorry, Narratives are restricted to members only"));var t=[_.createElement(je.a,{key:"requestAddNarrative",to:"/requestAddNarrative/".concat(this.props.organization.id)},_.createElement(mt.a,{onClick:this.onRequestAddNarrative.bind(this)},_.createElement(Ge.a,{type:"plus"})," Add a Narrative"))];if(0===this.props.organization.narratives.length){var r=_.createElement("div",{className:"message"},"Sorry, no Narratives are yet associated with this Organization");return _.createElement(ur.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:_.createElement("span",null,_.createElement(Ge.a,{type:"folder-open"})," narratives (none)"),extra:t},_.createElement(ze.a,{type:"info",message:r}))}var n=this.props.organization.narratives.map(function(t){return _.createElement("div",{className:"narrative",key:String(t.workspaceId)},_.createElement("div",{className:"dataCol"},_.createElement(Ir,{narrative:t,onGetViewAccess:e.props.onGetViewAccess})),_.createElement("div",{className:"buttonCol"},e.renderNarrativeMenu(t)))}),a=this.props.organization.narratives.length,i=_.createElement("span",null,_.createElement(Ge.a,{type:"folder-open"}),"narratives"," ",_.createElement("span",{className:"titleCount"},"(",a,")"));return _.createElement(ur.a,{className:"slimCard narratives narrativesCard scrollable-flex-column",headStyle:{backgroundColor:"gray",color:"white"},title:i,extra:t},_.createElement("div",{className:"narrativesTable"},n))}},{key:"render",value:function(){switch(this.state.navigateTo){case Fr.REQUEST_ADD_NARRATIVE:return _.createElement(xt.a,{to:"/requestAddNarrative"});case Fr.NONE:}if(this.state.requestAccess.narrative&&this.props.organization){var e=this.props.relation;e.type===de.MEMBER||e.type===de.ADMIN||(e.type,de.OWNER)}return"undefined"!==typeof this.props.organization?_.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),_.createElement("div",{className:"mainRow  scrollable-flex-column"},_.createElement("div",{className:"mainColumn  scrollable-flex-column"},_.createElement("div",{className:"orgRow"},this.renderOrg()),_.createElement("div",{className:"narrativesRow scrollable-flex-column"},this.renderNarratives())),_.createElement("div",{className:"infoColumn"},_.createElement("div",{className:"infoBox"},this.renderInfo()),this.renderNotificationsCard(),this.renderInboxCard(),this.renderOutboxCard(),this.renderMembersCard())),void 0):_.createElement("div",{className:"ViewOrganization"},this.renderLoadingHeader(),"Loading...")}}]),t}(_.Component);var Kr=Object(V.b)(function(e,t){if(!e.views.viewOrgView.viewModel)throw new Error("argh, view model missing");var r=e.views.viewOrgView.viewModel;return{organization:r.organization,relation:r.relation,groupRequests:r.groupRequests,groupInvitations:r.groupInvitations,requestInbox:r.requestInbox,requestOutbox:r.requestOutbox}},function(e){return{onViewOrg:function(t){e(rr(t))},onJoinOrg:function(){e(nr())},onCancelJoinRequest:function(t){e(ar(t))},onAcceptInvitation:function(t){e(ir(t))},onRejectInvitation:function(t){e(sr(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:P.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Xt({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=a.views.viewOrgView.viewModel.organization){t.next=9;break}return r(Xt({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:return l=u.id,E=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,E.removeNarrativeFromOrg(l,e.workspaceId);case 14:r(Kt(e)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(11),r(Xt({code:t.t0.name,message:t.t0.message}));case 20:case"end":return t.stop()}},t,this,[[11,17]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:P.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r($t({code:"error",message:"No view model"})),t.abrupt("return");case 5:if(i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=a.views.viewOrgView.viewModel.organization){t.next=8;break}return t.abrupt("return");case 8:return l=u.id,E=String(e.workspaceId),d=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,d.grantNarrativeAccess(l,E);case 14:return t.next=16,d.getOrg(l);case 16:m=t.sent,r(Zt(m)),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r($t({code:"error",message:t.t0.message}));case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onAcceptRequest:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:P.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:P.VIEW_ORG_ACCEPT_INBOX_REQUEST_START}),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),new Yt({token:s,username:o,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=6,t.next=9,u.acceptRequest(e.id);case 9:return t.sent,t.next=12,u.getCombinedRequestInboxForOrg(e.organizationId);case 12:l=t.sent,r({type:P.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,requests:l}),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(6),r({type:P.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 19:case"end":return t.stop()}},t,this,[[6,16]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Yr),Xr=r(314),Zr=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){var e=_.createElement("div",null,"Loading your Organization..."," ",_.createElement(Xr.a,null));return _.createElement(ze.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return _.createElement("div",null,"Error!",_.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return _.createElement(Kr,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var $r=Object(V.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(rr(t))},onUnload:function(){e({type:P.VIEW_ORG_UNLOAD})}}})(Zr);function en(){return{type:P.EDIT_ORG_EVALUATE_ERRORS}}function tn(e){return{type:P.EDIT_ORG_SAVE_ERROR,error:e}}function rn(e){return function(t,r){t({type:P.EDIT_ORG_LOAD_START});var n=r(),i=n.auth.authorization,o=i.token,c=i.username,u=n.app.config;return new Se({token:o,username:c,groupsServiceURL:u.services.Groups.url}).getOrg(e).then(function(e){var r,n,i={id:{value:e.id,remoteValue:e.id,syncState:a.NEW,validationState:ve.validateOrgId(e.id)[1]},name:{value:e.name,remoteValue:e.name,syncState:a.NEW,validationState:ve.validateOrgName(e.name)[1]},gravatarHash:{value:e.gravatarHash,remoteValue:e.gravatarHash,syncState:a.NEW,validationState:ve.validateOrgGravatarHash(e.gravatarHash)[1]},description:{value:e.description,remoteValue:e.description,syncState:a.NEW,validationState:ve.validateOrgDescription(e.description)[1]},isPrivate:{value:e.isPrivate,remoteValue:e.isPrivate,syncState:a.NEW,validationState:{type:s.OK,validatedAt:new Date}}};t((r=i,n=e,{type:P.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:P.EDIT_ORG_LOAD_ERROR,error:r}))})}}function nn(){return function(e,t){e({type:P.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.editOrgView.viewModel,o=s.organization,c=s.editedOrganization,u=r.app.config,l=new Se({token:a,username:i,groupsServiceURL:u.services.Groups.url});if(c){var E={name:c.name.value,gravatarHash:c.gravatarHash.value,description:c.description.value,isPrivate:c.isPrivate.value};l.updateOrg(o.id,E).then(function(){e({type:P.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",c,t),e(tn({code:"invalid",message:t.message}))})}else e(tn({code:"app",message:"The new organization data does not yet exist"}))}}function an(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState.type===s.OK&&n.gravatarHash.validationState.type===s.OK&&n.description.validationState.type===s.OK?e({type:P.EDIT_ORG_EVALUATE_OK}):e(en())}}function sn(e){return function(t){var r=ve.validateOrgName(e),n=Object(We.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:P.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:P.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(an())}}function on(e){return function(t){var r=ve.validateOrgGravatarHash(e),n=Object(We.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:P.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,gravatarHash:e,error:t}}(a,i)):t(function(e){return{type:P.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,gravatarHash:e}}(a)),t(an())}}function cn(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,c=n.app.config,u=(new Se({token:i,username:o,groupsServiceURL:c.services.Groups.url}),ve.validateOrgDescription(e)),l=Object(We.a)(u,2),E=l[0],d=l[1];d.type!==s.OK?t(function(e,t){return{type:P.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(E,d)):t(function(e){return{type:P.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(E)),t(an())}}r(278);var un,ln=r(142),En=r.n(ln);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(un||(un={}));var dn=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:un.NONE},r.gravatarEmail=_.createRef(),r.origin=document.location.origin,r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onShowInfo",value:function(){dt.a.info({title:"Organization Editor Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the organizations editor..."))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){dt.a.confirm({title:"Leave the editor?",content:_.createElement("div",null,_.createElement("p",null,"You have made changes on this edit form."),_.createElement("p",null,"If you leave the editor without saving, any ",_.createElement("i",null,"changes they will be lost"),"."),_.createElement("p",null,_.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){dt.a.confirm({title:"Leave the editor?",content:_.createElement("div",null,_.createElement("p",null,"You have made changes on this edit form."),_.createElement("p",null,"If you leave the editor without saving, any ",_.createElement("i",null,"changes they will be lost"),"."),_.createElement("p",null,_.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===i.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===o.NEW||this.props.saveState===o.READY||this.props.saveState===o.SAVED)}},{key:"isModified",value:function(){return this.props.editState===i.EDITED&&(this.props.saveState===o.NEW||this.props.saveState===o.READY)}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case a.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===a.DIRTY?_.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderForm",value:function(){return _.createElement("form",{id:"editOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},_.createElement("div",{className:"row"},_.createElement("div",{className:"col1 field-label"},_.createElement(cr.a,{title:"This is the name for your organization as you want KBase users to see it"},"name")),_.createElement("div",{className:"col2"},_.createElement(qt.a,{value:this.props.editedOrganization.name.value||"",className:this.calcFieldClass(this.props.editedOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.name))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1 field-label"},"id"),_.createElement("div",{className:"col2"},_.createElement(qt.a,{value:this.props.editedOrganization.id.value||"",className:this.calcFieldClass(this.props.editedOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.id))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1 field-label"},"is private?"),_.createElement("div",{className:"col2"},_.createElement(Wt.a,{checked:this.props.editedOrganization.isPrivate.value,className:this.calcFieldClass(this.props.editedOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.isPrivate))),_.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},_.createElement("div",{className:"col1 field-label"},"description"),_.createElement("div",{className:"col2"},_.createElement(En.a,{value:this.props.editedOrganization.description.value||"",className:this.calcFieldClass(this.props.editedOrganization.description),onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.description))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col1"}),_.createElement("div",{className:"col2"})))}},{key:"renderIsPrivate",value:function(e){return e?_.createElement("span",null,_.createElement(Ge.a,{type:"lock"})," ","Private"):_.createElement("span",null,_.createElement(Ge.a,{type:"global"})," ","Public")}},{key:"renderPreview",value:function(){return _.createElement("form",{className:"preview"},_.createElement("div",{className:"row"},_.createElement("div",{className:"col2"},_.createElement("div",{className:"name"},this.props.editedOrganization.name.value||""))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col2"},_.createElement("div",{className:"id"},_.createElement("span",{style:{color:"silver"}},this.origin,"/#orgs/viewOrganization/"),this.props.editedOrganization.id.value||_.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),_.createElement("div",{className:"row"},_.createElement("div",{className:"col2"},_.createElement("div",{className:"isPrivate"},this.renderIsPrivate(this.props.editedOrganization.isPrivate.value)))),_.createElement("div",{className:"row",style:{flex:"1 1 0px"}},_.createElement("div",{className:"col2"},_.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:Bt()(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return _.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderOrgName",value:function(e){if(0===e.length)return _.createElement("span",{style:{fontStyle:"italic"}},"org name missing");var t=e;return e.length>=25&&(t=e.slice(0,25)+"\u2026"),_.createElement(je.a,{to:"/viewOrganization/".concat(this.props.organization.id)},_.createElement("span",{style:{fontWeight:"bold"}},t))}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,this.renderOrgName(this.props.editedOrganization.name.value),_.createElement(Ge.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),_.createElement(Ge.a,{type:"tool"})," ",_.createElement("span",{style:{fontSize:"120%"}},"Edit Organization"))),t=_.createElement(_.Fragment,null,_.createElement(mt.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),_.createElement(mt.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=_.createElement("span",null,"Loading Org Editor...");return _.createElement(vt,{breadcrumbs:e})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return _.createElement(gr,{organizationId:this.props.organization.id})}},{key:"render",value:function(){return this.state.cancelToBrowser?_.createElement(xt.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?_.createElement(xt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):this.props.editedOrganization?_.createElement("div",{className:"EditOrganization"},this.renderHeader(),this.renderOrgHeader(),_.createElement("div",{className:"mainRow"},_.createElement("div",{className:"editorColumn"},_.createElement("h3",null,"Editor"),this.renderForm()),_.createElement("div",{className:"previewColumn"},_.createElement("h3",null,"Preview"),this.renderPreview()))):_.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader())}}]),t}(_.Component);var mn=Object(V.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(nn())},onUpdateName:function(t){e(sn(t))},onUpdateGravatarHash:function(t){e(on(t))},onUpdateDescription:function(t){e(cn(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:P.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(an())}}(t))}}})(dn),pn=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Fetching your orgs and other stuff...")}},{key:"renderError",value:function(){if(this.props.view.error)return _.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return _.createElement(mn,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var vn=Object(V.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(rn(t))},onUnload:function(){e({type:P.EDIT_ORG_UNLOAD})}}})(pn),hn=(r(281),function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).tokenRef=_.createRef(),r.props.checkAuth(),r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return _.createElement("div",{className:"Auth-form"},"Token: ",_.createElement("input",{ref:this.tokenRef}),_.createElement(mt.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return _.createElement("div",{className:"Auth-toolbar"},"Logged in as ",_.createElement("b",null,_.createElement("span",null,this.props.authorization.authorization.realname)," (",_.createElement("span",null,this.props.authorization.authorization.username)),")"," ",_.createElement(mt.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case d.NONE:case d.CHECKING:return _.createElement("div",null);case d.AUTHORIZED:return _.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case d.UNAUTHORIZED:return _.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},_.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case d.ERROR:return _.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},_.createElement("p",null,"Error"),this.props.authorization.message);default:return _.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case d.NONE:case d.CHECKING:return _.createElement("div",null);case d.AUTHORIZED:return _.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case d.UNAUTHORIZED:return _.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},_.createElement("p",null,"Not authorized!"));case d.ERROR:return _.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},_.createElement("p",null,"Error: ??"));default:return _.createElement("div",null)}}},{key:"render",value:function(){return _.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(_.Component)),On=r(90),Rn="",fn="api/V2/token",wn="api/V2/me",Sn=function(){function e(t){var r=t.url;Object(I.a)(this,e),this.url=r}return Object(b.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([Rn]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([fn]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([wn]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function gn(e){return{type:P.AUTH_CHECK_ERROR,error:e}}function _n(e,t,r,n){return{type:P.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function An(){return{type:P.AUTH_UNAUTHORIZED}}function Nn(){return function(e,t){e({type:P.AUTH_CHECK_START});var r=t().app.config.services.Auth.url,n=On.get("kbase_session");if(n){var a=new Sn({url:r});Promise.all([a.getTokenInfo(n),a.getMe(n)]).then(function(t){var r=Object(We.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(_n(n,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(gn({code:"error",message:t.message}))})}else e(An())}}var Tn=Object(V.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(Nn())},onRemoveAuthorization:function(){e(function(e,t){On.remove("kbase_session"),e(An())})},onAddAuthorization:function(t){e(function(e){return function(t,r){var n=r().app.config.services.Auth.url;On.set("kbase_session",e);var a=new Sn({url:n});Promise.all([a.getTokenInfo(e),a.getMe(e)]).then(function(r){var n=Object(We.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(_n(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(gn({code:"error",message:e.message}))})}}(t))}}})(hn),In=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(I.a)(this,e),this.name=r,this.onSuccess=n,this.onError=a},bn=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).started=new Date,r.timeout=e.timeout||5e3,r}return Object(D.a)(t,e),t}(In),yn=function(){function e(t){var r=t.name,n=t.payload,a=t.channel;Object(I.a)(this,e),this.name=r,this.payload=n,this.id=yr()(),this.created=new Date,this.channel=a,this.envelope=null}return Object(b.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channel:this.channel},name:this.name,payload:this.payload}}}]),e}(),Cn=function(){function e(t){if(Object(I.a)(this,e),this.window=t.window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||yr()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(b.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",e));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new In({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new yn({name:e,payload:t,channel:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new yn({name:e,payload:t,channel:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,s=function(){var r=i.value,n=(c=Object(We.a)(r,2))[0];0===c[1].filter(function(e){if(e instanceof bn){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},o=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var c;s()}}catch(u){n=!0,a=u}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new bn({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new bn({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),Dn=function(){function e(){Object(I.a)(this,e),this.params=null,this.channel=new Cn({window:window,host:document.location.origin})}return Object(b.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:yr()(),params:{groupsServiceURL:"services/groups",userProfileServiceURL:"services/user_profile/rpc",workspaceServiceURL:"services/ws",serviceWizardURL:"services/service_wizard",feedsServiceURL:"services/feeds",authServiceURL:"services/auth"},parentHost:document.location.origin}}}]),e}(),kn=function(){function e(){Object(I.a)(this,e)}return Object(b.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}}]),e}();function Mn(e){return{type:P.APP_SUCCESS,config:e}}r(283);var Un=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).props.onAppStart(),r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.status===p.NONE?_.createElement("div",{className:"KBaseIntegration"},"Loading..."):_.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(_.Component);var Vn=Object(V.b)(function(e,t){return{status:e.app.status}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new kn).getParamsFromIFrame();if(r)e(Mn({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL},Auth:{url:r.params.authServiceURL}}}));else{var n=(new Dn).getParamsFromIFrame();e(Mn({baseUrl:"",services:{Groups:{url:n.params.groupsServiceURL},UserProfile:{url:n.params.userProfileServiceURL},Workspace:{url:n.params.workspaceServiceURL},ServiceWizard:{url:n.params.serviceWizardURL},Feeds:{url:n.params.feedsServiceURL},Auth:{url:n.params.authServiceURL}}}))}})}}})(Un);function jn(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,p,v;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),l=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,Promise.all([u.getOrg(e),l.getPendingOrganizationRequestsForOrg(e),l.getOrganizationInvitationsForOrg(e)]);case 6:E=t.sent,d=Object(We.a)(E,3),m=d[0],p=d[1],v=d[2],r((O=m,R=p,f=v,{type:P.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,organization:O,requests:R,invitations:f})),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),r((h={code:t.t0.name,message:t.t0.message},{type:P.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,error:h}));case 17:case"end":return t.stop()}var h,O,R,f},t,this,[[3,14]])}));return function(e,r){return t.apply(this,arguments)}}()}r(285);var zn=r(312),Ln=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){dt.a.info({title:"Manage Requests Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:_.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,_.createElement(je.a,{to:"/viewOrganization/".concat(this.props.viewModel.organization.id)},_.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.viewModel.organization.name))),_.createElement(Ge.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),_.createElement(Ge.a,{type:"tool"})," ",_.createElement("span",{style:{fontSize:"120%"}},"Managing Org Requests"))),t=_.createElement(_.Fragment,null,_.createElement(mt.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=_.createElement("span",null,"Loading Org Editor...");return _.createElement(vt,{breadcrumbs:e})}},{key:"niceElapsed",value:function(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),s=Math.abs(i);if(s<7776e3){if(0===s)return"now";s<60?(t=i,r=s,n="second"):s<3600?(t=Math.round(i/60),r=Math.round(s/60),n="minute"):s<86400?(t=Math.round(i/3600),r=Math.round(s/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(s/86400),n="day"),r>1&&(n+="s");var o=null,c=null;return t<0?o="in":t>0&&(c="ago"),(o?o+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=_.createElement("span",null,_.createElement(Ge.a,{type:"user"}),_.createElement(Ge.a,{type:"arrow-right"}),_.createElement(Ge.a,{type:"team"})," ","Request to Join Group"),n=[_.createElement(mt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),_.createElement(mt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return _.createElement(ur.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},_.createElement("table",{className:"pendingRequestsTable"},_.createElement("tbody",null,_.createElement("tr",null,_.createElement("th",null,"from"),_.createElement("td",{className:"requester"},_.createElement(qr,{userId:e.requester,avatarSize:50}))),_.createElement("tr",null,_.createElement("th",null,"sent"),_.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),_.createElement("tr",null,_.createElement("th",null,"expires"),_.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=_.createElement("span",null,_.createElement(Ge.a,{type:"team"}),_.createElement(Ge.a,{type:"mail"}),_.createElement(Ge.a,{type:"arrow-right"}),_.createElement(Ge.a,{type:"user"})," ","Invitation to Join Group"),n=[_.createElement(mt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e.id)}},"Cancel")];return _.createElement(ur.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},_.createElement("table",{className:"pendingRequestsTable"},_.createElement("tbody",null,_.createElement("tr",null,_.createElement("th",null,"invitation to"),_.createElement("td",{className:"requester"},_.createElement(qr,{userId:e.user,avatarSize:30}))),_.createElement("tr",null,_.createElement("th",null,"sent"),_.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),_.createElement("tr",null,_.createElement("th",null,"expires"),_.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case me.NONE:return"None";case me.VIEW:return"View Only";case me.EDIT:return"Edit";case me.ADMIN:return"Admin";case me.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=_.createElement("span",null,_.createElement(Ge.a,{type:"file"}),_.createElement(Ge.a,{type:"arrow-right"}),_.createElement(Ge.a,{type:"team"})," ","Request to Add Narrative"),a=[_.createElement(mt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e.id)}},"Approve"),_.createElement(mt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e.id)}},"Deny")];return t=_.createElement(xr,{workspaceId:parseInt(e.narrativeId,10)}),_.createElement(ur.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},_.createElement("table",{className:"pendingRequestsTable"},_.createElement("tbody",null,_.createElement("tr",null,_.createElement("th",null,"from"),_.createElement("td",{className:"requester"},_.createElement(qr,{userId:e.requester,avatarSize:30}))),_.createElement("tr",null,_.createElement("th",null,"narrative"),_.createElement("td",{className:"narrative"},t)),_.createElement("tr",null,_.createElement("th",null,"sent"),_.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),_.createElement("tr",null,_.createElement("th",null,"expires"),_.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=_.createElement("span",null,_.createElement(Ge.a,{type:"appstore"}),_.createElement(Ge.a,{type:"arrow-right"}),_.createElement(Ge.a,{type:"team"})," ","Request to Add App"),n=[_.createElement(mt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),_.createElement(mt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return _.createElement(ur.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},_.createElement("table",{className:"pendingRequestsTable"},_.createElement("tbody",null,_.createElement("tr",null,_.createElement("th",null,"from"),_.createElement("td",{className:"requester"},_.createElement(qr,{userId:e.requester,avatarSize:50}))),_.createElement("tr",null,_.createElement("th",null,"app"),_.createElement("td",{className:"requester"},e.appId)),_.createElement("tr",null,_.createElement("th",null,"sent"),_.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),_.createElement("tr",null,_.createElement("th",null,"expires"),_.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequest",value:function(e){switch(e.type){case u.REQUEST:switch(e.resourceType){case l.USER:return this.renderRequestJoinRequest(e);case l.WORKSPACE:return this.renderRequestNarrativeRequest(e);case l.APP:return this.renderRequestAppRequest(e);default:throw new Error("Unsupported resource type: "+e.resourceType)}case u.INVITATION:switch(e.resourceType){case l.USER:return this.renderRequestJoinInvitation(e);case l.WORKSPACE:throw new Error("Workspace invitations are not supported");case l.APP:throw new Error("App invitations are not supported");default:throw new Error("Unsupported resource type: "+e.resourceType)}}}},{key:"renderRequests",value:function(){var e=this,t=this.props.viewModel.requests;return 0===t.length?_.createElement(ze.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending requests for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"renderInvitations",value:function(){var e=this,t=this.props.viewModel.invitations;return 0===t.length?_.createElement(ze.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending invitations for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"render",value:function(){if(this.state.cancelToBrowser)return _.createElement(zn.a,{push:!0,to:"/organizations"});if(this.state.cancelToViewer)return _.createElement(zn.a,{push:!0,to:"/viewOrganization/"+this.props.viewModel.organization.id});var e=this.props.viewModel.invitations.length,t=this.props.viewModel.requests.length;return _.createElement("div",{className:"ManageGroupRequests"},this.renderHeader(),_.createElement(gr,{organizationId:this.props.viewModel.organization.id}),_.createElement("div",{className:"row"},_.createElement("div",{className:"pendingCol"},_.createElement("h2",null,"Requests (",t,")"),_.createElement("div",{className:"pendingRequests"},this.renderRequests())),_.createElement("div",{className:"historyCol"},_.createElement("h2",null,"Invitations (",e,")"),this.renderInvitations())))}}]),t}(_.Component);var Gn=Object(V.b)(function(e,t){var r=e.views.manageOrganizationRequestsView;if(!r.viewModel)throw new Error("view state not loaded!");return{viewModel:r.viewModel}},function(e){return{onAcceptJoinRequest:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.views.manageOrganizationRequestsView,u=a.app.config,l=new pe({token:s,username:o,groupsServiceURL:u.services.Groups.url}),c){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,t.next=7,l.acceptRequest(e);case 7:E=t.sent,r((m=E,{type:P.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,request:m})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:P.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,error:d}));case 14:case"end":return t.stop()}var d,m},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onDenyJoinRequest:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.views.manageOrganizationRequestsView,u=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return l=new pe({token:s,username:o,groupsServiceURL:u.services.Groups.url}),t.prev=4,t.next=7,l.denyRequest(e);case 7:E=t.sent,r((m=E,{type:P.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,request:m})),c.viewModel&&r(jn(c.viewModel.organization.id)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:P.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,error:d}));case 15:case"end":return t.stop()}var d,m},t,this,[[4,12]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onCancelJoinInvitation:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.views.manageOrganizationRequestsView,u=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return l=new pe({token:s,username:o,groupsServiceURL:u.services.Groups.url}),t.prev=4,t.next=7,l.cancelRequest(e);case 7:t.sent,c.viewModel&&r(jn(c.viewModel.organization.id)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((E={code:t.t0.name,message:t.t0.message},{type:P.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,error:E}));case 14:case"end":return t.stop()}var E},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,u.grantViewAccess(e);case 6:l=t.sent,r((d=l,{type:P.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,request:d})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:P.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Ln),xn=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.SUCCESS:return _.createElement(Gn,null)}}},{key:"componentDidMount",value:function(){switch(this.props.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var Pn=Object(V.b)(function(e,t){return{loadingState:e.views.manageOrganizationRequestsView.loadingState}},function(e){return{onLoad:function(t){e(jn(t))},onUnload:function(){e({type:P.ADMIN_MANAGE_REQUESTS_UNLOAD})}}})(xn);function Bn(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.VIEW_MEMBERS_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Yt({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),t.prev=3,t.next=6,u.getOrganizationForUser(e);case 6:l=t.sent,E=l.organization,d=l.relation,r((p=E,v=d,{type:P.VIEW_MEMBERS_LOAD_SUCCESS,organization:p,relation:v})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),r((m={code:t.t0.name,message:t.t0.message},{type:P.VIEW_MEMBERS_LOAD_ERROR,error:m}));case 15:case"end":return t.stop()}var m,p,v},t,this,[[3,12]])}));return function(e,r){return t.apply(this,arguments)}}()}function qn(e){return function(t,r){t({type:P.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Se({token:i,username:s,groupsServiceURL:o.services.Groups.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:P.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:P.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function Wn(e){return function(t,r){t({type:P.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Se({token:i,username:s,groupsServiceURL:o.services.Groups.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:P.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:P.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function Hn(e){return function(t,r){t({type:P.VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Se({token:i,username:s,groupsServiceURL:o.services.Groups.url}).removeMember(c.organization.id,e).then(function(){t({type:P.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS}),t(Bn(c.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:P.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(132);var Qn=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={over:!1},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderPromoteButton",value:function(){var e=this;switch(this.props.member.type){case Ee.MEMBER:return _.createElement(mt.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onPromoteMemberToAdmin(e.props.member.username)}},_.createElement(Ge.a,{type:"unlock"}),"Promote to Admin");case Ee.ADMIN:return _.createElement(mt.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onDemoteAdminToMember(e.props.member.username)}},_.createElement(Ge.a,{type:"user"}),"Demote to Member");case Ee.OWNER:return}}},{key:"renderMemberButtons",value:function(e){var t=this;if(this.props.relation.type===de.OWNER||this.props.relation.type===de.ADMIN)return _.createElement("div",null,_.createElement("div",null,_.createElement(mt.a,{type:"danger",disabled:!this.state.over,style:{width:"100%"},onClick:function(){t.props.onRemoveMember(e.username)}},_.createElement(Ge.a,{type:"delete"}),"Remove from Org")),_.createElement("div",null,this.renderPromoteButton()))}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.props.onRemoveMember(t.username)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=_.createElement(lr.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},_.createElement(lr.a.Item,{key:"promoteToAdmin"},_.createElement(Ge.a,{type:"unlock"}),"Promote to Admin"),_.createElement(lr.a.Item,{key:"removeMember"},_.createElement(Ge.a,{type:"delete"}),"Remove Member"));return _.createElement("div",null,_.createElement(Er.a,{overlay:r,trigger:["click"]},_.createElement(mt.a,{icon:"ellipsis"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=_.createElement(lr.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},_.createElement(lr.a.Item,{key:"demoteToMember"},_.createElement(Ge.a,{type:"user"}),"Demote to Member"));return _.createElement("div",null,_.createElement(Er.a,{overlay:r,trigger:["click"]},_.createElement(mt.a,{icon:"ellipsis"})))}},{key:"renderOwnerMenu",value:function(e){}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===de.OWNER||this.props.relation.type===de.ADMIN)switch(this.props.member.type){case Ee.OWNER:return this.renderOwnerMenu(e);case Ee.ADMIN:return this.renderAdminMenu(e);case Ee.MEMBER:return this.renderMemberMenu(e)}}},{key:"onMouseOver",value:function(){this.setState({over:!0})}},{key:"onMouseOut",value:function(){this.setState({over:!1})}},{key:"render",value:function(){return _.createElement("div",{key:this.props.member.username,className:"memberRow",onMouseEnter:this.onMouseOver.bind(this),onMouseLeave:this.onMouseOut.bind(this)},_.createElement("div",{style:{flex:"1 1 0px"}},_.createElement(vr,{member:this.props.member,avatarSize:50,key:this.props.member.username})),_.createElement("div",{style:{flex:"0 0 10em",textAlign:"right"}},this.renderMemberOptions(this.props.member)))}}]),t}(_.Component),Fn=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onPromoteMemberToAdmin",value:function(e){this.props.onPromoteMemberToAdmin(e)}},{key:"onDemoteAdminToMember",value:function(e){this.props.onDemoteAdminToMember(e)}},{key:"onShowInfo",value:function(){dt.a.info({title:"View Members Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the view members tool..."))})}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===de.OWNER||this.props.relation.type===de.ADMIN||this.props.relation.type===de.MEMBER)}},{key:"isAdmin",value:function(){return!!this.props.organization&&(this.props.relation.type===de.OWNER||this.props.relation.type===de.ADMIN)}},{key:"renderOrgName",value:function(e){return e.length<25?e:_.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,_.createElement(je.a,{to:"/viewOrganization/".concat(this.props.organization.id)},_.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),_.createElement(Ge.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),_.createElement(Ge.a,{type:"team"})," ",_.createElement("span",{style:{fontSize:"120%"}},"Viewing Org Members"))),t=_.createElement(_.Fragment,null,_.createElement(mt.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderMembersToolbar",value:function(){switch(this.props.relation.type){case de.NONE:return _.createElement("div",{className:"toolbar"},_.createElement(mt.a,null,_.createElement(Ge.a,{type:"plus"}),"Join"));case de.MEMBER:return _.createElement("div",{className:"toolbar"});case de.ADMIN:case de.OWNER:return _.createElement("div",{className:"toolbar"},_.createElement(je.a,{to:"/inviteUser/"+this.props.organization.id},_.createElement(mt.a,null,_.createElement(Ge.a,{type:"mail"})," Invite a User")))}}},{key:"renderMembers",value:function(){var e,t=this;return this.isMember()?(e=0===this.props.organization.members.length?_.createElement("p",{className:"message"},"This organization has no members"):this.props.organization.members.map(function(e){return _.createElement(_.Fragment,{key:e.username},_.createElement(Qn,{member:e,relation:t.props.relation,organization:t.props.organization,onPromoteMemberToAdmin:t.props.onPromoteMemberToAdmin,onDemoteAdminToMember:t.props.onDemoteAdminToMember,onRemoveMember:t.props.onRemoveMember}))}),_.createElement("div",{className:"table infoTable"},_.createElement("div",{className:"row"},_.createElement("div",{className:"col0",style:{display:"flex",flexDirection:"column",overflowY:"auto"}},e)))):_.createElement("p",{className:"message"},"Sorry, organization membership restricted to members only")}},{key:"renderAdminsToolbar",value:function(){return _.createElement("div",{className:"toolbar"})}},{key:"renderOrganizationHeader",value:function(){return _.createElement(gr,{organizationId:this.props.organization.id})}},{key:"componentWillUnmount",value:function(){this.props.onViewMembersUnload()}},{key:"render",value:function(){return this.state.cancelToBrowser?_.createElement(zn.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?_.createElement(zn.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):_.createElement("div",{className:"ViewMembers"},this.renderHeader(),this.renderOrganizationHeader(),_.createElement("div",{className:"body"},_.createElement("div",{className:"membersCol"},_.createElement("h2",null,"Members"),this.renderMembersToolbar(),this.renderMembers()),_.createElement("div",{className:"otherCol"},_.createElement("h2",null,"Pending Members"),this.renderAdminsToolbar(),_.createElement("p",null,"This space to provide a list of user requests and invitations. This will allow this view to provide all user management tools in one place."),_.createElement("p",null,"In progress... currently renders the requests but does not provide actions (buttons)."))))}}]),t}(_.Component);var Jn=Object(V.b)(function(e,t){if(!e.views.viewMembersView||null===e.views.viewMembersView.viewModel)throw new Error("Runtime Error - view members view is not defined!");var r=e.views.viewMembersView.viewModel;return{organization:r.organization,relation:r.relation}},function(e){return{onViewMembersUnload:function(){e({type:P.VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(qn(t))},onDemoteAdminToMember:function(t){e(Wn(t))},onRemoveMember:function(t){e(Hn(t))}}})(Fn),Yn=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.state){case h.NONE:case h.LOADING:return this.renderLoading();case h.SUCCESS:return _.createElement(Jn,null)}}},{key:"componentDidMount",value:function(){switch(this.props.state){case h.NONE:this.props.onViewMembersLoad(this.props.organizationId)}}}]),t}(_.Component);var Kn=Object(V.b)(function(e,t){return{state:e.views.viewMembersView.loadingState}},function(e){return{onViewMembersLoad:function(t){e(Bn(t))}}})(Yn);function Xn(e){return{type:P.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Zn(e){return{type:P.INVITE_USER_SELECT_USER_ERROR,error:e}}function $n(e){return function(t,r){t({type:P.INVITE_USER_SELECT_USER_START});var n=r(),a=n.views.inviteUserView.viewModel,i=n.auth.authorization,s=i.token,o=(i.username,n.app.config);a?new qe({token:s,userProfileServiceURL:o.services.UserProfile.url}).getUser(e).then(function(e){var r=function(e,t){if(e.username===t.owner.username)return de.OWNER;var r=t.members.find(function(t){return t.username===e.username});if(r)switch(r.type){case c.ADMIN:return de.ADMIN;case c.OWNER:return de.OWNER;case c.MEMBER:return de.MEMBER}return de.VIEW}(e,a.organization);t(function(e,t){return{type:P.INVITE_USER_SELECT_USER_SUCCESS,user:e,relation:t}}(e,r))}).catch(function(e){t(Zn({code:e.name,message:e.message}))}):t(Zn({code:"invalid state",message:"select user invalid state -- no view value"}))}}function ea(){return function(e,t){e({type:P.INVITE_USER_SEND_INVITATION_START});var r=t(),n=r.auth.authorization,a=n.token,i=n.username,s=r.app.config,o=r.views.inviteUserView,c=o.loadingState,u=o.viewModel;o.error;if(c===h.SUCCESS&&null!==u){var l=u,E=l.selectedUser,d=l.organization.id;if(E)new pe({token:a,username:i,groupsServiceURL:s.services.Groups.url}).inviteUserToJoinOrg(d,E.user.username).then(function(t){e({type:P.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){var r;e((r={code:t.name,message:t.message},{type:P.INVITE_USER_SEND_INVITATION_ERROR,error:r}))})}}}r(288),r(290);var ta=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return _.createElement("div",{className:"User"},_.createElement("div",{className:"avatarCol"},_.createElement(Le,{user:this.props.user,size:this.props.avatarSize||30})),_.createElement("div",{className:"infoCol"},_.createElement("div",{className:"name"},_.createElement("a",{href:"#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),_.createElement("div",{className:"organization"},this.props.user.organization||_.createElement("i",null,"no organization in user profile")),_.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||_.createElement("i",null,"no location information in user profile"))))}}]),t}(_.Component),ra=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).lastSearchAt=null,r.searchInput=_.createRef(),r.searchButton=_.createRef(),r.state={cancelToViewMembers:!1,cancelToBrowser:!1,cancelToViewer:!1,autocompleteMessage:""},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onClickCancelToViewMembers",value:function(){this.setState({cancelToViewMembers:!0})}},{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"onShowInfo",value:function(){dt.a.info({title:"Invite User Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the invite user tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:_.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,_.createElement(je.a,{to:"/viewOrganization/".concat(this.props.organization.id)},_.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),_.createElement(Ge.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),_.createElement(Ge.a,{type:"tool"})," ",_.createElement("span",{style:{fontSize:"120%"}},"Invite a User to Join Org"))),t=_.createElement(_.Fragment,null,_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return _.createElement(ze.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?_.createElement(ze.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===de.NONE?_.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},_.createElement("div",{className:"name "},t.realname," (",t.username,")")):_.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},_.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return _.createElement("div",{className:"orgInfo"},_.createElement("div",{className:"name"},_.createElement("span",{className:"field-label"},"name"),_.createElement("span",null,this.props.organization.name)),_.createElement("div",{className:"description"},_.createElement("span",{className:"field-label"},"description"),_.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===de.VIEW?e=_.createElement(mt.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=_.createElement(mt.a,{disabled:!0,type:"primary"},"Send Invitation"),t=_.createElement("div",null,"User may not be invited because:",_.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=_.createElement(ze.a,{type:"warning",message:t,showIcon:!0})):(e=_.createElement(mt.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),_.createElement("div",{className:"invitationForm"},_.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),_.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case R.NONE:return _.createElement("div",null,"NONE");case R.EDITING:return _.createElement("div",null,"EDITING");case R.SENDABLE:return _.createElement("div",null,"SENDABLE");case R.SENDING:return _.createElement("div",null,"SENDING");case R.SUCCESS:return _.createElement("div",null,"SENT SUCCESSFULLY");case R.ERROR:return _.createElement("div",null,"ERROR SENDING");default:return _.createElement("div",null,"Bad State")}}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return _.createElement(gr,{organizationId:this.props.organization.id})}},{key:"renderRelation",value:function(e){switch(e){case de.NONE:return _.createElement("span",null,_.createElement(Ge.a,{type:"stop"}),"None");case de.VIEW:return _.createElement("span",null,_.createElement(Ge.a,{type:"stop"})," Not a member");case de.MEMBER_REQUEST_PENDING:return _.createElement("span",null,_.createElement(Ge.a,{type:"user",style:{color:"orange"}})," User's membership ",_.createElement("b",null,"request")," is pending");case de.MEMBER_INVITATION_PENDING:return _.createElement("span",null,_.createElement(Ge.a,{type:"user",style:{color:"blue"}})," User has been ",_.createElement("b",null,"invited")," to join");case de.MEMBER:return _.createElement("span",null,_.createElement(Ge.a,{type:"user"})," User is a ",_.createElement("b",null,"member")," of this organization");case de.ADMIN:return _.createElement("span",null,_.createElement(Ge.a,{type:"unlock"}),"User is an ",_.createElement("b",null,"admin")," of this organization");case de.OWNER:return _.createElement("span",null,_.createElement(Ge.a,{type:"crown"})," User is the ",_.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?_.createElement("div",{className:"selectedUser"},_.createElement("p",{className:"noSelection"},"No user yet selected")):_.createElement("div",{className:"selectedUser"},_.createElement(ta,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return _.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return _.createElement(Ge.a,{type:"search"})}},{key:"render",value:function(){return this.state.cancelToViewMembers?_.createElement(xt.a,{push:!0,to:"/viewMembers/"+this.props.organization.id}):this.state.cancelToBrowser?_.createElement(xt.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?_.createElement(xt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):_.createElement("div",{className:"InviteUser scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),_.createElement("div",{className:"row scrollable-flex-column"},_.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},_.createElement("h3",null,"Select User to Invite"),_.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},_.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),_.createElement(mt.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),_.createElement("div",{className:"usersTable"},this.renderUsers())),_.createElement("div",{className:"col1 lastCol"},_.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(_.Component);ra.searchDebounce=200;var na=ra;var aa=Object(V.b)(function(e,t){if(!e.views.inviteUserView||null===e.views.inviteUserView.viewModel)throw new Error("Runtime Error - invite members view is not defined!");var r=e.views.inviteUserView.viewModel;return{organization:r.organization,users:r.users,selectedUser:r.selectedUser,editState:r.editState}},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,u,l,E,d,m,p,v,h,O,R;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:P.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(Xn(null)),t.abrupt("return");case 4:if(a=n(),i=a.views.inviteUserView.viewModel,s=a.auth.authorization,o=s.token,s.username,u=a.app.config,null!==i){t.next=7;break}return t.abrupt("return");case 7:return l=i.organization,E=new qe({token:o,userProfileServiceURL:u.services.UserProfile.url}),d=l.owner.username,m=[],p=[],v=[],h=[],l.members.forEach(function(e){switch(e.type){case c.MEMBER:p.push(e.username);case c.ADMIN:m.push(e.username)}}),t.prev=16,t.next=19,E.searchUsers(e);case 19:O=t.sent,R=O.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?de.OWNER:m.indexOf(t)>=0?de.ADMIN:v.indexOf(t)>=0?de.MEMBER_INVITATION_PENDING:h.indexOf(t)>=0?de.MEMBER_REQUEST_PENDING:p.indexOf(t)>=0?de.MEMBER:de.NONE}}),r(Xn(R)),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(16),r((f={code:t.t0.name,message:t.t0.message},{type:P.INVITE_USER_SEARCH_USERS_ERROR,error:f}));case 27:case"end":return t.stop()}var f},t,this,[[16,24]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){e($n(t))},onSendInvitation:function(){e(ea())}}})(na),ia=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Loading Users...")}},{key:"renderError",value:function(){return _.createElement("div",null,"Error!")}},{key:"render",value:function(){switch(this.props.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return _.createElement(aa,null)}}},{key:"componentDidMount",value:function(){switch(this.props.loadingState){case h.NONE:this.props.onInviteUserLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var sa=Object(V.b)(function(e,t){return{loadingState:e.views.inviteUserView.loadingState}},function(e){return{onInviteUserLoad:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,u.getOrg(e);case 6:l=t.sent,r((d=l,{type:P.INVITE_USER_LOAD_SUCCESS,organization:d,users:null})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:P.INVITE_USER_LOAD_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:P.INVITE_USER_UNLOAD})}}})(ia),oa=(r(292),function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"doCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"doCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"doLeaveOrg",value:function(){alert("this will leave you the org")}},{key:"canSave",value:function(){return!1}},{key:"doShowInfo",value:function(){dt.a.info({title:"Manage My Membership Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the view to help you manage your membership..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:_.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,_.createElement(je.a,{to:"/viewOrganization/".concat(this.props.organization.id)},_.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),_.createElement(Ge.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),_.createElement(Ge.a,{type:"user"})," ",_.createElement("span",{style:{fontSize:"120%"}},"Manage your membership"))),t=_.createElement(_.Fragment,null,_.createElement(mt.a,{icon:"save",form:"editMembershipForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),_.createElement(mt.a,{type:"danger",icon:"frown",onClick:this.doLeaveOrg.bind(this)},"Leave Organization..."),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return _.createElement(gr,{organizationId:this.props.organization.id})}},{key:"render",value:function(){return this.state.cancelToBrowser?_.createElement(xt.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?_.createElement(xt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):_.createElement("div",{className:"ManageMembership"},this.renderHeader(),this.renderOrgHeader(),_.createElement("h3",null,"Edit Organization Profile"),_.createElement("div",{className:"body"},_.createElement("div",{className:"col1"},_.createElement("div",{className:"editorTable"},_.createElement("div",{className:"editorTable-row"},_.createElement("div",{className:"editorTable-labelCol"},_.createElement("span",{className:"field-label"},"title")),_.createElement("div",{className:"editorTable-controlCol"},_.createElement(qt.a,null))))),_.createElement("div",{className:"col2"},_.createElement("div",null,"org user profile here"))),_.createElement("h3",null,"User Profile"),_.createElement("p",null,"Your user profile is ..."))}}]),t}(_.Component));var ca=Object(V.b)(function(e,t){if(!e.views.manageMembershipView.viewModel)throw new Error("View model missing");return{username:e.auth.authorization.username,organization:e.views.manageMembershipView.viewModel.organization}},function(e){return{}})(oa);function ua(e){return{type:P.MANAGE_MEMBERSHIP_LOAD_ERROR,error:e}}var la=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Loading membership editor...")}},{key:"renderError",value:function(e){return _.createElement("div",null,"Error!",_.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return _.createElement(ca,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var Ea,da=Object(V.b)(function(e,t){return{view:e.views.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var i,o,c,u,l,E,d,m,p;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.MANAGE_MEMBERSHIP_LOAD_START}),i=n(),o=i.auth.authorization,c=o.token,u=o.username,l=i.app.config,E=new Se({token:c,username:u,groupsServiceURL:l.services.Groups.url}),t.prev=3,t.next=6,E.getOrg(e);case 6:if(d=t.sent,m=d.members.find(function(e){return e.username===u})){t.next=12;break}return console.error("did not find member",u,d),r(ua({code:"notfound",message:'The member "'+u+'" was not found in this org'})),t.abrupt("return");case 12:p={title:{value:m.title,remoteValue:m.title,syncState:a.NEW,validationState:{type:s.OK,validatedAt:new Date}}},r((v=d,h=p,{type:P.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:v,editableMemberProfile:h})),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(3),console.error("Error :(",t.t0),r(ua({code:t.t0.name,message:t.t0.message}));case 20:case"end":return t.stop()}var v,h},t,this,[[3,16]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:P.MANAGE_MEMBERSHIP_UNLOAD})}}})(la);r(294);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Ea||(Ea={}));var ma=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={navigateTo:Ea.NONE},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"doCancelToBrowser",value:function(){this.setState({navigateTo:Ea.BROWSER})}},{key:"doCancelToViewer",value:function(){this.setState({navigateTo:Ea.VIEWER})}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doShowInfo",value:function(){dt.a.info({title:"Request to Add Narrative Help",width:"50em",content:_.createElement("div",null,_.createElement("p",null,"This is the view to help you request the addition of a narrative to this org..."))})}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return _.createElement(gr,{organizationId:this.props.organization.id})}},{key:"renderOrgName",value:function(e){return e.length<25?e:_.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,_.createElement(je.a,{to:"/viewOrganization/".concat(this.props.organization.id)},_.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),_.createElement(Ge.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),_.createElement(Ge.a,{type:"plus"})," ",_.createElement("span",{style:{fontSize:"120%"}},"Add Narrative to Org"))),t=_.createElement(_.Fragment,null,_.createElement(mt.a,{icon:"undo",type:"danger",onClick:this.doCancelToViewer.bind(this)},"Return to this Org"),_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderNarratives",value:function(){var e=this;return 0===this.props.narratives.length?_.createElement("div",{className:"message"},"You do not have any Narratives"):this.props.narratives.map(function(t,r){var n=["narrative"];return!(!e.props.selectedNarrative||t.workspaceId!==e.props.selectedNarrative.workspaceId)&&n.push("selected"),t.status===f.ASSOCIATED?(n.push("narrativeInOrg"),_.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},_.createElement("div",{className:"title"},t.title||"n/a"," (associated)"))):t.status===f.REQUESTED?(n.push("narrativeInOrg"),_.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},_.createElement("div",{className:"title"},t.title||"n/a"," (request pending)"))):(n.push("narrativeNotInOrg"),_.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},_.createElement("div",{className:"title"},t.title||"n/a")))})}},{key:"onSearchSubmit",value:function(){console.log("searching...")}},{key:"renderSearchIcon",value:function(){return this.props.searching?_.createElement(Ge.a,{type:"loading"}):_.createElement(Ge.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return _.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSearchSubmit.bind(this)},_.createElement("input",{placeholder:"Search your Narratives",autoFocus:!0}),_.createElement(mt.a,{className:"button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"onSortByChange",value:function(){}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return _.createElement("div",{className:"filterSortBar"},_.createElement("span",{className:"field-label"},"sort by"),_.createElement(pt.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},_.createElement(pt.a.Option,{value:"title",key:"title"},"Title"),_.createElement(pt.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")),_.createElement(pt.a,{onChange:this.onSortDirectionChange.bind(this),style:{width:"4em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},_.createElement(pt.a.Option,{value:v.ASCENDING,key:"name"},_.createElement(Ge.a,{type:"sort-ascending"})),_.createElement(pt.a.Option,{value:v.DESCENDING,key:"owner"},_.createElement(Ge.a,{type:"sort-descending"}))))}},{key:"renderNarrativeSelector",value:function(){return _.createElement("div",{className:"narrativeSelector scrollable-flex-column"},_.createElement("div",{style:{display:"flex",flexDirection:"row"}},_.createElement("div",{style:{flex:"0 0 10em"}},this.renderSearchBar()),_.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),_.createElement("div",{className:"narratives scrollable-flex-column"},_.createElement("div",{className:"narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===f.ASSOCIATED?_.createElement(ze.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===f.REQUESTED?_.createElement(ze.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===de.ADMIN||this.props.relation.type===de.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",_.createElement(mt.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?_.createElement("div",{className:"selectedNarrative"},_.createElement("div",{className:"title"},this.props.selectedNarrative.title),_.createElement("div",null,_.createElement("i",null,"last modified")," ",Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.selectedNarrative.modifiedAt))):_.createElement(ze.a,{type:"info",message:"Select a narrative on the left to show it here and be able to add it to this organization."})}},{key:"render",value:function(){switch(this.state.navigateTo){case Ea.BROWSER:return _.createElement(xt.a,{push:!0,to:"/organizations"});case Ea.VIEWER:return _.createElement(xt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id});case Ea.NONE:}return _.createElement("div",{className:"RequestNarrative scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),_.createElement("div",{className:"body scrollable-flex-column"},_.createElement("div",{className:"selectNarrativeCol scrollable-flex-column"},_.createElement("h3",null,"Select a Narrative"),this.renderNarrativeSelector()),_.createElement("div",{className:"selectedNarrativeCol"},_.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),_.createElement("div",{className:"selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),_.createElement("div",{className:"footer"}))}}]),t}(_.Component);function pa(e){return function(t,r){t({type:P.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:P.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}var va=Object(V.b)(function(e,t){if(null===e.views.requestNarrativeView.viewModel)throw new Error("view value is not defined!");var r=e.views.requestNarrativeView.viewModel;return{organization:r.organization,relation:r.relation,narratives:r.narratives,selectedNarrative:r.selectedNarrative,searching:!1,sortBy:"title",sortDirection:v.ASCENDING,filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(ne.a)(re.a.mark(function r(n,a){var i,s,o,c,u,l,E;return re.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:P.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,l=new Se({token:o,username:c,groupsServiceURL:u.services.Groups.url}),r.prev=3,r.next=6,l.addOrRequestNarrativeToGroup(e,t.workspaceId);case 6:E=r.sent,n((m=E,{type:P.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:m})),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n((d={code:r.t0.name,message:r.t0.message},{type:P.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 13:case"end":return r.stop()}var d,m},r,this,[[3,10]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(pa(t))}}})(ma),ha=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){return _.createElement("div",null,"Loading Your Narratives...")}},{key:"renderError",value:function(e){return _.createElement("div",null,"Error!",_.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return _.createElement(va,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var Oa=Object(V.b)(function(e,t){return{view:e.views.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,p,v,h,O,R;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Se({token:s,username:o,groupsServiceURL:c.services.Groups.url}),l=new rt({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url}),E=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,Promise.all([u.getOrg(e),l.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,m=Object(We.a)(d,4),p=m[0],v=m[1],h=m[2],O=m[3],R=he(p,o,h,O),r((w=p,S=v,g=R,{type:P.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:w,narratives:S,relation:g})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((f={code:t.t0.name,message:t.t0.message},{type:P.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:f}));case 22:case"end":return t.stop()}var f,w,S,g},t,this,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:P.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(ha),Ra=(r(296),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return this.props.user?this.props.render(this.props.user):_.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(_.Component));var fa,wa,Sa=Object(V.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(nt(t))}}})(Ra),ga=(r(298),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderAvatar",value:function(e){return _.createElement(ut,{gravatarHash:e.gravatarHash,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderRelation",value:function(){switch(this.props.organization.relation.type){case de.NONE:return _.createElement("span",null,_.createElement(Ge.a,{type:"stop"}),"None");case de.VIEW:return _.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},_.createElement("span",null,_.createElement(Ge.a,{type:"stop"})," You are not a member - view organization to join"));case de.MEMBER_REQUEST_PENDING:return _.createElement("span",null,_.createElement(Ge.a,{type:"user",style:{color:"orange"}})," Your membership ",_.createElement("b",null,"request")," is pending");case de.MEMBER_INVITATION_PENDING:return _.createElement("span",null,_.createElement(Ge.a,{type:"user",style:{color:"blue"}})," You have been ",_.createElement("b",null,"invited")," to join");case de.MEMBER:return _.createElement("span",null,_.createElement(Ge.a,{type:"user"})," You are a ",_.createElement("b",null,"member")," of this organization");case de.ADMIN:return _.createElement("span",null,_.createElement(Ge.a,{type:"unlock"}),"Admin");case de.OWNER:return _.createElement(cr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},_.createElement("span",null,_.createElement(Ge.a,{type:"crown"})," You are the ",_.createElement("b",null,"owner")," of this Organization"))}}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(){var e=this.props.organization.organization;return _.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderRelationInfo",value:function(){switch(this.props.organization.relation.type){case de.NONE:case de.VIEW:return _.createElement("div",null,"Only members may view membership information");case de.MEMBER:return _.createElement("div",null,this.renderMemberCount());case de.MEMBER_REQUEST_PENDING:case de.MEMBER_INVITATION_PENDING:return _.createElement("div",null,"Only members may view membership information");case de.ADMIN:case de.OWNER:return _.createElement("div",null,this.renderMemberCount())}}},{key:"renderAdminInfo",value:function(){if(this.props.organization.relation.type===de.OWNER||this.props.organization.relation.type===de.ADMIN){var e,t=this.props.organization.groupRequests;return t&&t.length>0&&(e=_.createElement("div",null,_.createElement(Ge.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," ","there"," ",t.length>1?"are":"is"," ",_.createElement("b",null,t.length," pending request",t.length>1?"s":""))),_.createElement("div",{className:"admin"},e)}}},{key:"renderPrivate",value:function(){return this.props.organization.organization.isPrivate?_.createElement("span",null,_.createElement(Ge.a,{type:"lock"})," ","private"):_.createElement("span",null,_.createElement(Ge.a,{type:"global"})," ","public")}},{key:"renderMemberCompact",value:function(e){return _.createElement(Sa,{userId:e.username,render:function(t){return _.createElement("a",{href:"/#people/"+e.username,target:"_blank"},t.realname," \u2768",e.username,"\u2769")}})}},{key:"render",value:function(){var e=this.props.organization.organization;return _.createElement("div",{className:"OrganizationBlock",key:e.id},_.createElement("div",{className:"avatarCol"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),_.createElement("div",{className:"bodyCol"},_.createElement("div",{className:"orgName"},_.createElement(je.a,{to:"/viewOrganization/".concat(e.id)},e.name)),_.createElement("div",null,this.renderPrivate()),_.createElement("div",null,this.renderRelation()),_.createElement("div",null,this.renderRelationInfo()),_.createElement("div",null,this.renderAdminInfo()),_.createElement("div",{className:"orgOwner"},_.createElement("span",{className:"field-label"},"owner"),_.createElement("span",{className:"field-value"},this.renderMemberCompact(e.owner))),_.createElement("div",{className:"orgCreated"},_.createElement("span",{className:"field-label"},"established"),_.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))))}}]),t}(_.Component)),_a=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,{code:"feeds-exception",message:e.message,detail:e.message,info:new Map}))).name="FeedsException",r.originalError=e,r}return Object(D.a)(t,e),t}(B),Aa=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(D.a)(t,e),t}(B),Na=function(){function e(t){Object(I.a)(this,e),this.params=t}return Object(b.a)(e,[{key:"put",value:function(e,t){var r=this.baseURLPath().concat(e).join("/");return fetch(r,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new _a(e)});case"text/plain":return e.text().then(function(e){throw new Aa(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a,i,s;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new _a(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new Aa(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"postWithResult",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a,i,s;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new _a(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new Aa(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a,i,s,o;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.from(r.entries()).map(function(e){var t=Object(We.a)(e,2),r=t[0],n=t[1];return[r,encodeURIComponent(n)].join("=")}).join("&"),a=this.baseURLPath().concat(t).join("/")+"?"+n,e.next=4,fetch(a,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 4:if(500!==(i=e.sent).status){e.next=20;break}e.t0=i.headers.get("Content-Type"),e.next="application/json"===e.t0?9:"text/plain"===e.t0?13:17;break;case 9:return e.next=11,i.json();case 11:throw s=e.sent,new _a(s);case 13:return e.next=15,i.text();case 15:throw o=e.sent,new Aa(o);case 17:throw new Error("Unexpected content type: "+i.headers.get("Content-Type"));case 18:e.next=27;break;case 20:if(200!==i.status){e.next=26;break}return e.next=23,i.json();case 23:return e.abrupt("return",e.sent);case 26:throw new Error("Unexpected response: "+i.status+" : "+i.statusText);case 27:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"baseURLPath",value:function(){return[this.params.url,"api","V1"]}},{key:"getNotifications",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.count,(n=new Map).set("n",String(r)),e.next=5,this.get(["notifications"],n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"seeNotifications",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postWithResult(["notifications","see"],t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Ta(e){switch(e){case"alert":return fa.ALERT;case"error":return fa.ERROR;case"warning":return fa.WARNING;case"request":return fa.REQUEST;default:throw new Error("Invalid level value: "+e)}}function Ia(e){if(!e.context||!e.context.resourcetype)return wa.UNKNOWN;switch(e.verb){case"requested":switch(e.context.resourcetype){case"user":return wa.JOIN_REQUEST;case"workspace":return wa.NARRATIVE_ASSOCIATION_REQUEST;case"app":return wa.APP_ASSOCIATION_REQUEST}case"invited":switch(e.context.resourcetype){case"user":return wa.JOIN_INVITATION}}return wa.UNKNOWN}!function(e){e[e.ALERT=0]="ALERT",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.REQUEST=3]="REQUEST"}(fa||(fa={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JOIN_REQUEST=1]="JOIN_REQUEST",e[e.JOIN_INVITATION=2]="JOIN_INVITATION",e[e.NARRATIVE_ASSOCIATION_REQUEST=3]="NARRATIVE_ASSOCIATION_REQUEST",e[e.APP_ASSOCIATION_REQUEST=4]="APP_ASSOCIATION_REQUEST",e[e.MESSAGE=5]="MESSAGE"}(wa||(wa={}));var ba=function(){function e(t){Object(I.a)(this,e),this.params=t,this.feedsClient=new Na({token:this.params.token,url:this.params.feedsServiceURL})}return Object(b.a)(e,[{key:"getNotifications",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,e.abrupt("return",t.user.feed.map(function(e){var t=e.id,r=e.actor,n=e.verb,a=e.object,i=e.target,s=e.source,o=e.level,c=e.seen,u=e.created,l=e.expires,E=e.external_key,d=e.context;return{id:t,actor:r,verb:n,object:a,target:i,source:s,level:Ta(o),seen:c,createdAt:new Date(u),expiresAt:new Date(l),externalKey:E,context:d}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationNotifications",value:function(){var e=Object(ne.a)(re.a.mark(function e(){var t,r=this;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,e.abrupt("return",t.user.feed.filter(function(e){var t=e.actor;return"groupsservice"===e.source&&t!==r.params.username}).map(function(e){return{id:e.id,from:e.actor,createdAt:new Date(e.created),expiresAt:new Date(e.expires),level:Ta(e.level),read:e.seen,organizationId:e.object,type:Ia(e),regarding:e.target}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"seeNotification",value:function(){var e=Object(ne.a)(re.a.mark(function e(t){var r,n;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.seeNotifications({note_ids:[t]});case 2:return r=e.sent,n=r.seen_notes,r.unauthorized_notes,e.abrupt("return",n[0]);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),ya=(r(300),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onReadNotification",value:function(e){this.props.onRead(e.id)}},{key:"renderType",value:function(e){switch(e){case wa.JOIN_INVITATION:return"You have been invited to Join";case wa.JOIN_REQUEST:return"Request to Join";case wa.UNKNOWN:return"UNKNOWN";case wa.NARRATIVE_ASSOCIATION_REQUEST:return"Request to associate Narrative";case wa.APP_ASSOCIATION_REQUEST:return"Request to associate App";default:return"UNKNOWN NOTIFICATION TYPE"}}},{key:"renderInvitationToOrg",value:function(e){var t=this;return _.createElement("div",{className:"notification",key:e.id},_.createElement("div",{className:"mainCol"},_.createElement("div",null,"You have been invited to Join"),_.createElement("div",null,_.createElement(jr,{organizationId:e.organizationId})),_.createElement("div",null,_.createElement("span",{className:"field-label"},"by")),_.createElement("div",null,_.createElement(qr,{userId:e.from,avatarSize:30}))),_.createElement("div",{className:"actionCol"},_.createElement(mt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){t.onReadNotification.call(t,e)}})))}},{key:"renderRequestToJoinToOrg",value:function(e){var t=this;return _.createElement("div",{className:"notification",key:e.id},_.createElement("div",{className:"mainCol"},_.createElement("div",null,"Request to Join"),_.createElement("div",null,_.createElement(jr,{organizationId:e.organizationId})),_.createElement("div",null,_.createElement("span",{className:"field-label"},"from")),_.createElement("div",null,_.createElement(qr,{userId:e.from,avatarSize:30}))),_.createElement("div",{className:"actionCol"},_.createElement(mt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){t.onReadNotification.call(t,e)}})))}},{key:"renderNarrativeAssociationRequest",value:function(e){var t=this,r=parseInt(e.regarding[0],10);return _.createElement("div",{className:"notification",key:e.id},_.createElement("div",{className:"mainCol"},_.createElement("div",null,"Request to associate Narrative"),_.createElement("div",null,_.createElement(xr,{workspaceId:r})),_.createElement("div",null,_.createElement("span",{className:"field-label"},"with")),_.createElement("div",null,_.createElement(jr,{organizationId:e.organizationId})),_.createElement("div",null,_.createElement("span",{className:"field-label"},"by")),_.createElement("div",null,_.createElement(qr,{userId:e.from,avatarSize:30}))),_.createElement("div",{className:"actionCol"},_.createElement(mt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){t.onReadNotification.call(t,e)}})))}},{key:"renderNotification",value:function(e){switch(e.type){case wa.JOIN_INVITATION:return this.renderInvitationToOrg(e);case wa.JOIN_REQUEST:return this.renderRequestToJoinToOrg(e);case wa.UNKNOWN:return"UNKNOWN";case wa.NARRATIVE_ASSOCIATION_REQUEST:return this.renderNarrativeAssociationRequest(e);case wa.APP_ASSOCIATION_REQUEST:return"Request to associate App";default:return"UNKNOWN NOTIFICATION TYPE"}}},{key:"renderNotificationx",value:function(e){var t=this;return _.createElement("div",{className:"notification",key:e.id},_.createElement("div",{className:"mainCol"},_.createElement("div",null,this.renderType(e.type)),_.createElement("div",null,_.createElement(qr,{userId:e.from,avatarSize:30})),_.createElement("div",null,_.createElement(jr,{organizationId:e.organizationId}))),_.createElement("div",{className:"actionCol"},_.createElement(mt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){t.onReadNotification.call(t,e)}})))}},{key:"renderNotifications",value:function(){var e=this;return this.props.notifications.map(function(t){return e.renderNotification(t)})}},{key:"renderHeader",value:function(){return _.createElement("span",null,"You have"," ",this.props.notifications.length," ","unread organization notification",1===this.props.notifications.length?"":"s")}},{key:"renderMain",value:function(){return 0===this.props.notifications.length?_.createElement("div",{className:"message"},"No unread notifications"):_.createElement("div",{className:"Notifications"},_.createElement("div",{className:"header"},this.renderHeader()),_.createElement("div",{className:"body"},this.renderNotifications()))}},{key:"render",value:function(){return _.createElement("div",{className:"Notifications"},this.renderMain())}}]),t}(_.Component));var Ca,Da=Object(V.b)(function(e){return{notifications:e.db.notifications.all}},function(e){return{onRead:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:P.NOTIFICATIONS_READ_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new ba({token:s,username:o,feedsServiceURL:c.services.Feeds.url}),t.prev=3,t.next=6,u.seeNotification(e);case 6:t.sent,r({type:P.NOTIFICATIONS_READ_SUCCESS,notificationId:e}),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),console.error("error",t.t0),r({type:P.NOTIFICATIONS_READ_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 14:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(ya);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.NEW_ORG=2]="NEW_ORG"}(Ca||(Ca={}));var ka=function(e){function t(e){var r;return Object(I.a)(this,t),(r=Object(y.a)(this,Object(C.a)(t).call(this,e))).state={navigateTo:Ca.NONE},r}return Object(D.a)(t,e),Object(b.a)(t,[{key:"onNavigateToBrowser",value:function(){this.setState({navigateTo:Ca.BROWSER})}},{key:"onNavigateToNewOrg",value:function(){this.setState({navigateTo:Ca.NEW_ORG})}},{key:"onRefresh",value:function(){this.props.onRefresh()}},{key:"onShowInfo",value:function(){dt.a.info({title:"Dashboard",width:"50em",content:_.createElement("div",null,_.createElement("div",{className:"helpTitle"},"Welcome to KBase Organizations!"),_.createElement("p",null,"This is your Organizations Dashboard. It is your quick stop to see what happening with all of your Organizations, or to get involved with new ones."),_.createElement("div",{className:"helpSectionTitle"},"Your Organizations"),_.createElement("p",null,"... to do ..."),_.createElement("div",{className:"helpSectionTitle"},"Notifications"),_.createElement("p",null,'All unready messages you have from any organization will visible in this section. Each notification may be closed (read) by clicking the red "x" in the upper right corner.'),_.createElement("p",null,"For access to all your notifications, and more control over them, visit your ",_.createElement("a",{href:"/#feeds"},"feeds"),"."),_.createElement("div",{className:"helpSectionTitle"},"Inbox"),_.createElement("p",null,"... to do ..."),_.createElement("div",{className:"helpSectionTitle"},"Outbox"),_.createElement("p",null,"... to do ..."),_.createElement("div",{className:"helpSectionTitle"},"Organization Inbox"),_.createElement("p",null,"... to do ..."),_.createElement("div",{className:"helpSectionTitle"},"+ New"),_.createElement("p",null,"... to do ..."),_.createElement("div",{className:"helpSectionTitle"},"Browse All"),_.createElement("p",null,"... to do ..."),_.createElement("div",{className:"helpSectionTitle"},"Refresh"),_.createElement("p",null,"... to do ..."))})}},{key:"renderHeader",value:function(){var e=_.createElement(_.Fragment,null,_.createElement("span",null,"Your Orgs Dashboard")),t=_.createElement(_.Fragment,null,_.createElement(mt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return _.createElement(vt,{breadcrumbs:e,buttons:t})}},{key:"renderOrganizations",value:function(){if(0===this.props.viewModel.organizations.length){var e=_.createElement("div",null,_.createElement("p",null,"You are not associated with any Organizations"),_.createElement("p",null,"To get started, you can create a"," ",_.createElement(mt.a,{onClick:this.onNavigateToNewOrg.bind(this)},_.createElement(Ge.a,{type:"plus"})," ","New")," ","Organization, or"," ",_.createElement(mt.a,{onClick:this.onNavigateToBrowser.bind(this)},"Browse All")," ","organizations to find one to join."));return _.createElement(ze.a,{type:"info",message:e})}return this.props.viewModel.organizations.map(function(e){return _.createElement("div",{key:e.organization.id},_.createElement(ga,{organization:e}))})}},{key:"renderRefreshButton",value:function(){switch(this.props.viewModel.refreshState){case h.LOADING:return _.createElement(mt.a,{key:"refresh"},_.createElement(Ge.a,{type:"sync",spin:!0})," ","Refreshing...");default:return _.createElement(mt.a,{key:"refresh",onClick:this.onRefresh.bind(this)},_.createElement(Ge.a,{type:"reload"})," ","Refresh")}}},{key:"renderOrganizationsCard",value:function(){var e=_.createElement("div",null,_.createElement(mt.a,{key:"newOrgButton",onClick:this.onNavigateToNewOrg.bind(this)},_.createElement(Ge.a,{type:"plus"})," ","New")," ",_.createElement(mt.a,{key:"browseButton",onClick:this.onNavigateToBrowser.bind(this)},"Browse All")," ",this.renderRefreshButton());return _.createElement(ur.a,{title:"Your Organizations",headStyle:{backgroundColor:"gray",color:"white"},bodyStyle:{minHeight:"0",flex:"1 1 0px",display:"flex",flexDirection:"column"},className:"slimCard yourOrgsCard scrollable-flex-column",extra:e},_.createElement("div",{className:"scrollable-flex-column",style:{overflow:"auto"}},this.renderOrganizations()))}},{key:"renderPendingNotifications",value:function(){return _.createElement(Da,null)}},{key:"renderNotificationsCard",value:function(){var e=_.createElement("span",null,"Notifications (",2,")");return _.createElement(ur.a,{title:e,headStyle:{backgroundColor:"gray",color:"white"},bodyStyle:{maxHeight:"30em",display:"flex",flexDirection:"column"},className:"slimCard notificationsCard"},this.renderPendingNotifications())}},{key:"renderRequestRequester",value:function(e){return _.createElement(qr,{userId:e.requester,avatarSize:30})}},{key:"renderPendingRequestsSentCard",value:function(){return _.createElement(ur.a,{title:"Outbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard pendingRequestsCard"},this.renderPendingRequestsSent())}},{key:"renderPendingRequestsReceivedCard",value:function(){return _.createElement(ur.a,{title:"Inbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard pendingInvitationsCard"},this.renderPendingRequestsReceived())}},{key:"isAdmin",value:function(){return this.props.viewModel.organizations.some(function(e){var t=e.relation;return t.type===de.OWNER||t.type===de.ADMIN})}},{key:"renderPendingAdminTasksCard",value:function(){if(this.isAdmin())return _.createElement(ur.a,{title:"Organization Inbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard pendingAdminTasksCard"},this.renderPendingAdminRequests())}},{key:"renderPendingRequestsSent",value:function(){return 0===this.props.viewModel.requestOutbox.length?_.createElement("div",{className:"message"},"No pending requests"):this.props.viewModel.requestOutbox.map(function(e,t){return _.createElement("div",{key:t},_.createElement(Jr,{request:e,showOrg:!0}))})}},{key:"onAcceptInboxRequest",value:function(e){this.props.onAcceptInboxRequest(e)}},{key:"renderPendingAdminRequests",value:function(){var e=this,t=this.props.viewModel.pendingAdminRequests;return 0===t.length?_.createElement("div",{className:"message"},"No pending organization requests"):t.map(function(t,r){return _.createElement(_.Fragment,{key:r},_.createElement(Hr,{request:t,showOrg:!0,onAcceptInboxRequest:e.onAcceptInboxRequest.bind(e)}))})}},{key:"renderPendingRequestsReceived",value:function(){var e=this;return 0===this.props.viewModel.requestInbox.length?_.createElement("div",{className:"message"},"No pending invitations"):this.props.viewModel.requestInbox.map(function(t){return _.createElement(_.Fragment,{key:t.id},_.createElement(Hr,{request:t,showOrg:!0,onAcceptInboxRequest:e.onAcceptInboxRequest.bind(e)}))})}},{key:"componentDidCatch",value:function(e,t){}},{key:"render",value:function(){switch(this.state.navigateTo){case Ca.BROWSER:return _.createElement(xt.a,{to:"/organizations"});case Ca.NEW_ORG:return _.createElement(xt.a,{to:"/newOrganization"})}return _.createElement("div",{className:"Dashboard scrollable-flex-column"},this.renderHeader(),_.createElement("div",{className:"body scrollable-flex-column"},_.createElement("div",{className:"col1 scrollable-flex-column"},this.renderOrganizationsCard()),_.createElement("div",{className:"col2 scrollable-flex-column"},this.renderNotificationsCard(),this.renderPendingRequestsReceivedCard(),this.renderPendingRequestsSentCard(),this.renderPendingAdminTasksCard())))}}]),t}(_.Component);var Ma=Object(V.b)(function(e,t){var r=e.views.dashboardView,n=e.auth.authorization.username;if(null===r.viewModel)throw new Error("view model is null!");return{viewModel:r.viewModel,currentUser:n}},function(e){return{onAcceptInboxRequest:function(t){e(function(e){return function(){var t=Object(ne.a)(re.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d;return re.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:P.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:P.DASHBOARD_ACCEPT_INBOX_REQUEST_START}),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new pe({token:s,username:o,groupsServiceURL:c.services.Groups.url}),l=new Yt({token:s,username:o,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=6,t.next=9,u.acceptRequest(e.id);case 9:return t.sent,t.next=12,u.getInboundRequests();case 12:return E=t.sent,t.next=15,l.getOrganizationsForUser();case 15:d=t.sent,r({type:P.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS,requests:E,organizations:d}),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(6),r({type:P.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 22:case"end":return t.stop()}},t,this,[[6,19]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onCancelOutboxRequest:function(t){e(Cr(t))},onRefresh:function(){e(function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a,i,s,o,u,l,E,d,m,p,v;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:P.DASHBOARD_REFRESH_START}),(n=r()).views.dashboardView,a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,u=new Yt({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url,workspaceServiceURL:o.services.Workspace.url,serviceWizardURL:o.services.ServiceWizard.url}),l=new pe({token:i,username:s,groupsServiceURL:o.services.Groups.url}),e.prev=4,e.next=7,u.getOrganizationsForUser();case 7:return E=e.sent,e.next=10,l.getOutboundRequests();case 10:return d=e.sent,e.next=13,l.getInboundRequests();case 13:return m=e.sent,p=E.filter(function(e){var t=e.organization;return t.owner.username===s||!!t.members.find(function(e){return e.username===s&&e.type===c.ADMIN})}).map(function(e){return e.organization.id}),e.next=17,l.getPendingOrganizationRequests(p);case 17:v=e.sent,t((O=E,R=m,f=d,w=v,{type:P.DASHBOARD_REFRESH_SUCCESS,organizations:O,requestInbox:R,requestOutbox:f,pendingGroupRequests:w})),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),t((h={code:g.ERROR,message:e.t0.message,detail:"",at:new Date,id:yr()()},{type:P.DASHBOARD_REFRESH_ERROR,error:h}));case 24:case"end":return e.stop()}var h,O,R,f,w},e,this,[[4,21]])}));return function(t,r){return e.apply(this,arguments)}}())}}})(ka),Ua=r(318),Va=(r(302),function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderDetail",value:function(){return _.createElement("table",{className:"errorTable"},_.createElement("tr",null,_.createElement("th",null,_.createElement("span",{className:"field-label"},"generated at")),_.createElement("td",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.error.at))),_.createElement("tr",null,_.createElement("th",null,_.createElement("span",{className:"field-label"},"error id")),_.createElement("td",null,_.createElement("span",{style:{fontFamily:"monospace"}},this.props.error.id))),_.createElement("tr",null,_.createElement("th",null,_.createElement("span",{className:"field-label"},"explanation")),_.createElement("td",null,this.props.error.detail)))}},{key:"renderInfo",value:function(){return this.props.error.info?_.createElement("div",null,"additional info here ..."):_.createElement("div",{style:{textAlign:"left",fontStyle:"italic"}},"No additional information")}},{key:"render",value:function(){var e=_.createElement("div",null,_.createElement("p",null,this.props.error.message),_.createElement(Ua.a,{bordered:!1,style:{backgroundColor:"transparent"}},_.createElement(Ua.a.Panel,{header:"detail",key:"1",style:{backgroundColor:"transparent"}},this.renderDetail())),_.createElement(Ua.a,{bordered:!1,style:{backgroundColor:"transparent"}},_.createElement(Ua.a.Panel,{header:"additional info",key:"1",style:{backgroundColor:"transparent"}},this.renderInfo())));return _.createElement(ze.a,{type:"error",showIcon:!0,message:"Error",className:"Error",description:e})}}]),t}(_.Component)),ja=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"renderLoading",value:function(){var e=_.createElement("div",{style:{textAlign:"center"}},"Loading Organizations..."," ",_.createElement(Xr.a,null));return _.createElement(ze.a,{type:"info",message:e,style:{width:"30em",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return _.createElement(Va,{error:this.props.view.error})}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return _.createElement(Ma,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(_.Component);var za=Object(V.b)(function(e,t){return{view:e.views.dashboardView}},function(e){return{onLoad:function(){e(function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a,i,s,o,u,l,E,d,m,p,v;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:P.DASHBOARD_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,u=new Yt({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url,workspaceServiceURL:o.services.Workspace.url,serviceWizardURL:o.services.ServiceWizard.url}),l=new pe({token:i,username:s,groupsServiceURL:o.services.Groups.url}),e.prev=4,e.next=7,u.getOrganizationsForUser();case 7:return E=e.sent,e.next=10,l.getOutboundRequests();case 10:return d=e.sent,e.next=13,l.getInboundRequests();case 13:return m=e.sent,p=E.filter(function(e){var t=e.organization;return t.owner.username===s||!!t.members.find(function(e){return e.username===s&&e.type===c.ADMIN})}).map(function(e){return e.organization.id}),e.next=17,l.getPendingOrganizationRequests(p);case 17:v=e.sent,t((O=E,R=m,f=d,w=v,{type:P.DASHBOARD_LOAD_SUCCESS,organizations:O,requestInbox:R,requestOutbox:f,pendingGroupRequests:w})),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),t((h={code:g.ERROR,message:e.t0.message,detail:"",at:new Date,id:yr()()},{type:P.DASHBOARD_LOAD_ERROR,error:h}));case 24:case"end":return e.stop()}var h,O,R,f,w},e,this,[[4,21]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:P.DASHBOARD_UNLOAD})}}})(ja),La=function(){function e(){Object(I.a)(this,e)}return Object(b.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map}},db:{notifications:{all:[],byId:new Map}},views:{browseOrgsView:{loadingState:h.NONE,error:null,viewModel:null},organizationCentricView:{loadingState:h.NONE,error:null,viewModel:null},addOrgView:{loadingState:h.NONE,error:null,viewModel:null},editOrgView:{loadingState:h.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null},viewMembersView:{loadingState:h.NONE,error:null,viewModel:null},inviteUserView:{loadingState:h.NONE,error:null,viewModel:null},manageMembershipView:{loadingState:h.NONE,error:null,viewModel:null},requestNarrativeView:{loadingState:h.NONE,error:null,viewModel:null},dashboardView:{loadingState:h.NONE,error:null,viewModel:null},viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}},auth:{status:d.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:p.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Feeds:{url:""},Auth:{url:""}}}},updateOrg:{pending:!1}}}}]),e}(),Ga=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"componentWillMount",value:function(){this.props.onLoad()}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}},{key:"render",value:function(){return this.props.children}}]),t}(_.Component);var xa=Object(V.b)(function(e,t){return{}},function(e){return{onLoad:function(){e(function(){var e=Object(ne.a)(re.a.mark(function e(t,r){var n,a,i,s,o,c,u;return re.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:P.NOTIFICATIONS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=new ba({token:i,username:s,feedsServiceURL:o.services.Feeds.url}),e.prev=3,e.next=6,c.getOrganizationNotifications();case 6:u=e.sent,t((E=u,{type:P.NOTIFICATIONS_LOAD_SUCCESS,notifications:E})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("error",e.t0),t((l={code:e.t0.name,message:e.t0.message},{type:P.NOTIFICATIONS_LOAD_ERROR,error:l}));case 14:case"end":return e.stop()}var l,E},e,this,[[3,10]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:P.NOTIFICATIONS_UNLOAD})}}})(Ga);Ue.a.add(Ve.c,Ve.b,Ve.a,Ve.d);var Pa=!!window.frameElement,Ba=La.makeInitialState(),qa=Object(j.d)(Me,Ba,Object(j.c)(Object(j.a)(z.a))),Wa=function(e){function t(e){return Object(I.a)(this,t),Object(y.a)(this,Object(C.a)(t).call(this,e))}return Object(D.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){return A.a.createElement(V.a,{store:qa},A.a.createElement(Vn,null,A.a.createElement(Tn,{hosted:Pa},A.a.createElement(xa,null,A.a.createElement(U.a,{basename:"/orgs/"},A.a.createElement("div",{className:"App scrollable-flex-column"},A.a.createElement("div",{className:"App-body scrollable-flex-column"},A.a.createElement(k.a,null,A.a.createElement(M.a,{path:"/",exact:!0,component:za}),A.a.createElement(M.a,{path:"/organizations",component:Nt}),A.a.createElement(M.a,{path:"/newOrganization",component:Jt}),A.a.createElement(M.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return A.a.createElement($r,{organizationId:t})}}),A.a.createElement(M.a,{path:"/editOrganization/:id",component:function(e){var t=e.match.params.id;return A.a.createElement(vn,{organizationId:t})}}),A.a.createElement(M.a,{path:"/manageOrganizationRequests/:id",component:function(e){var t=e.match.params.id;return A.a.createElement(Pn,{organizationId:t})}}),A.a.createElement(M.a,{path:"/viewMembers/:id",component:function(e){var t=e.match.params.id;return A.a.createElement(Kn,{organizationId:t})}}),A.a.createElement(M.a,{path:"/inviteUser/:id",component:function(e){var t=e.match.params.id;return A.a.createElement(sa,{organizationId:t})}}),A.a.createElement(M.a,{path:"/membership/:id",component:function(e){var t=e.match.params.id;return A.a.createElement(da,{organizationId:t})}}),A.a.createElement(M.a,{path:"/requestAddNarrative/:id",component:function(e){var t=e.match.params.id;return A.a.createElement(Oa,{organizationId:t})}})))))))))}}]),t}(_.Component);r(304),r(306),r(308);T.a.render(A.a.createElement(Wa,null),document.getElementById("root"))}},[[145,2,1]]]);
//# sourceMappingURL=main.37ef66aa.chunk.js.map