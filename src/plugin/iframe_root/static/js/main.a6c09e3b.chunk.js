(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{115:function(e,t,r){e.exports=r.p+"static/media/nouserpic.9af42ba9.png"},155:function(e,t,r){e.exports=r(337)},160:function(e,t,r){},168:function(e,t,r){},170:function(e,t,r){},174:function(e,t,r){},176:function(e,t,r){},227:function(e,t,r){},241:function(e,t,r){},243:function(e,t,r){},245:function(e,t,r){},252:function(e,t,r){},262:function(e,t,r){},264:function(e,t,r){},266:function(e,t,r){},268:function(e,t,r){},270:function(e,t,r){},272:function(e,t,r){},274:function(e,t,r){},278:function(e,t,r){},280:function(e,t,r){},282:function(e,t,r){},284:function(e,t,r){},286:function(e,t,r){},288:function(e,t,r){},302:function(e,t,r){},304:function(e,t,r){},306:function(e,t,r){},308:function(e,t,r){},310:function(e,t,r){},312:function(e,t,r){},314:function(e,t,r){},316:function(e,t,r){},318:function(e,t,r){},320:function(e,t,r){},322:function(e,t,r){},324:function(e,t,r){},326:function(e,t,r){},329:function(e,t,r){},337:function(e,t,r){"use strict";r.r(t);var n,a,i,s,o,c,l,u,E,d,v,m,p,O,R,h,w,_,g,S,f,A,N,I,b=r(0),T=r.n(b),y=r(16),M=r.n(y),C=(r(160),r(4)),D=r(5),V=r(10),k=r(7),U=r(9),z=r(345),j=r(238),G=r(340),L=r(356),P=r(15),x=r(62),B=r(146),W=r(2),q=r(69),H=r(92);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.NEW=1]="NEW",e[e.DIRTY=2]="DIRTY",e[e.CLEAN=3]="CLEAN"}(i||(i={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(s||(s={})),function(e){e[e.OK=0]="OK",e[e.ERROR=1]="ERROR",e[e.REQUIRED_MISSING=2]="REQUIRED_MISSING"}(o||(o={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(c||(c={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(l||(l={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(u||(u={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(E||(E={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(d||(d={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(v||(v={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(p||(p={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(O||(O={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(_||(_={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(g||(g={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(S||(S={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.PRIVATE_INACCESSIBLE=1]="PRIVATE_INACCESSIBLE"}(f||(f={})),function(e){e[e.NONE=0]="NONE",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS"}(A||(A={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.OK=2]="OK",e[e.ERROR=3]="ERROR"}(N||(N={})),function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR"}(I||(I={}));var F,Q=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,s=e.info;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,a))).code=void 0,r.message=void 0,r.detail=void 0,r.trace=void 0,r.errors=void 0,r.info=void 0,r.name="AppException",r.code=n,r.message=a,r.detail=i,r.info=s,Error.captureStackTrace&&Error.captureStackTrace(Object(q.a)(Object(q.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(U.a)(t,e),t}(Object(H.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_RELOAD=31]="VIEW_ORG_RELOAD",e[e.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS=32]="VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS",e[e.VIEW_ORG_LOAD_NORMAL_SUCCESS=33]="VIEW_ORG_LOAD_NORMAL_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST=34]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=35]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=36]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=37]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=38]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=39]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=40]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=41]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=42]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=43]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=44]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=45]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST=46]="VIEW_ORG_ACCEPT_INBOX_REQUEST",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_START=47]="VIEW_ORG_ACCEPT_INBOX_REQUEST_START",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS=48]="VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR=49]="VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_INBOX_REQUEST=50]="VIEW_ORG_REJECT_INBOX_REQUEST",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_START=51]="VIEW_ORG_REJECT_INBOX_REQUEST_START",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS=52]="VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR=53]="VIEW_ORG_REJECT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=54]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=55]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=56]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=57]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=58]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=59]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=60]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=61]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=62]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=63]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=64]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=65]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.VIEW_ORG_SORT_NARRATIVES=66]="VIEW_ORG_SORT_NARRATIVES",e[e.VIEW_ORG_SORT_NARRATIVES_START=67]="VIEW_ORG_SORT_NARRATIVES_START",e[e.VIEW_ORG_SORT_NARRATIVES_SUCCESS=68]="VIEW_ORG_SORT_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SORT_NARRATIVES_ERROR=69]="VIEW_ORG_SORT_NARRATIVES_ERROR",e[e.VIEW_ORG_SEARCH_NARRATIVES=70]="VIEW_ORG_SEARCH_NARRATIVES",e[e.VIEW_ORG_SEARCH_NARRATIVES_START=71]="VIEW_ORG_SEARCH_NARRATIVES_START",e[e.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS=72]="VIEW_ORG_SEARCH_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SEARCH_NARRATIVES_ERROR=73]="VIEW_ORG_SEARCH_NARRATIVES_ERROR",e[e.VIEW_ORG_SORT_MEMBERS=74]="VIEW_ORG_SORT_MEMBERS",e[e.VIEW_ORG_SORT_MEMBERS_START=75]="VIEW_ORG_SORT_MEMBERS_START",e[e.VIEW_ORG_SORT_MEMBERS_SUCCESS=76]="VIEW_ORG_SORT_MEMBERS_SUCCESS",e[e.VIEW_ORG_SORT_MEMBERS_ERROR=77]="VIEW_ORG_SORT_MEMBERS_ERROR",e[e.VIEW_ORG_SEARCH_MEMBERS=78]="VIEW_ORG_SEARCH_MEMBERS",e[e.VIEW_ORG_SEARCH_MEMBERS_START=79]="VIEW_ORG_SEARCH_MEMBERS_START",e[e.VIEW_ORG_SEARCH_MEMBERS_SUCCESS=80]="VIEW_ORG_SEARCH_MEMBERS_SUCCESS",e[e.VIEW_ORG_SEARCH_MEMBERS_ERROR=81]="VIEW_ORG_SEARCH_MEMBERS_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD=82]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START=83]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS=84]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR=85]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD=86]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION=87]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION=88]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START=89]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS=90]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR=91]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=92]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=93]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=94]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=95]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=96]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=97]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=98]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=99]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST=100]="VIEW_PRIVATE_ORG_JOIN_REQUEST",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_START=101]="VIEW_PRIVATE_ORG_JOIN_REQUEST_START",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS=102]="VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR=103]="VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD=104]="VIEW_ORG_VIEW_MEMBERS_LOAD",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_START=105]="VIEW_ORG_VIEW_MEMBERS_LOAD_START",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS=106]="VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR=107]="VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_UNLOAD=108]="VIEW_ORG_VIEW_MEMBERS_UNLOAD",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER=109]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START=110]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=111]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR=112]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN=113]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=114]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=115]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=116]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER=117]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=118]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=119]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=120]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.ADD_ORG_LOAD=121]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=122]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=123]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=124]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=125]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=126]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=127]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=128]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_LOGO_URL=129]="ADD_ORG_UPDATE_LOGO_URL",e[e.ADD_ORG_UPDATE_LOGO_URL_SUCCESS=130]="ADD_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.ADD_ORG_UPDATE_LOGO_URL_ERROR=131]="ADD_ORG_UPDATE_LOGO_URL_ERROR",e[e.ADD_ORG_UPDATE_ID=132]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=133]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=134]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=135]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=136]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=137]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=138]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=139]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=140]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=141]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=142]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_UPDATE_HOME_URL=143]="ADD_ORG_UPDATE_HOME_URL",e[e.ADD_ORG_UPDATE_HOME_URL_SUCCESS=144]="ADD_ORG_UPDATE_HOME_URL_SUCCESS",e[e.ADD_ORG_UPDATE_HOME_URL_ERROR=145]="ADD_ORG_UPDATE_HOME_URL_ERROR",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS=146]="ADD_ORG_UPDATE_RESEARCH_INTERESTS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=147]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=148]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.ADD_ORG_EVALUATE=149]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=150]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=151]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=152]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=153]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=154]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=155]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=156]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=157]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=158]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=159]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=160]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=161]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=162]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=163]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=164]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=165]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=166]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=167]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_LOGO_URL=168]="EDIT_ORG_UPDATE_LOGO_URL",e[e.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS=169]="EDIT_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_LOGO_URL_ERROR=170]="EDIT_ORG_UPDATE_LOGO_URL_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=171]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=172]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=173]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=174]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=175]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=176]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_UPDATE_HOME_URL=177]="EDIT_ORG_UPDATE_HOME_URL",e[e.EDIT_ORG_UPDATE_HOME_URL_SUCCESS=178]="EDIT_ORG_UPDATE_HOME_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_HOME_URL_ERROR=179]="EDIT_ORG_UPDATE_HOME_URL_ERROR",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS=180]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=181]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=182]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.EDIT_ORG_EVALUATE=183]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=184]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=185]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=186]="AUTH_CHECK",e[e.AUTH_CHECK_START=187]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=188]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=189]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=190]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=191]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=192]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=193]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=194]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=195]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=196]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=197]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=198]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=199]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=200]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=201]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=202]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=203]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=204]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=205]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=206]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=207]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=208]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=209]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=210]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=211]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=212]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=213]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=214]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=215]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=216]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=217]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=218]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=219]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=220]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=221]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=222]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=223]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=224]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=225]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=226]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=227]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=228]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=229]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=230]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=231]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=232]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=233]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=234]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=235]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=236]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=237]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=238]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=239]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=240]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=241]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=242]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=243]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=244]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=245]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=246]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=247]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=248]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=249]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=250]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=251]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=252]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.MANAGE_MEMBERSHIP_UNLOAD=253]="MANAGE_MEMBERSHIP_UNLOAD",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG=254]="MANAGE_MEMBERSHIP_LEAVE_ORG",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED=255]="MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_START=256]="MANAGE_MEMBERSHIP_LEAVE_ORG_START",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS=257]="MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR=258]="MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE=259]="MANAGE_MEMBERSHIP_UPDATE_TITLE",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_START=260]="MANAGE_MEMBERSHIP_UPDATE_TITLE_START",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS=261]="MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR=262]="MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR",e[e.MANAGE_MEMBERSHIP_SAVE=263]="MANAGE_MEMBERSHIP_SAVE",e[e.MANAGE_MEMBERSHIP_SAVE_START=264]="MANAGE_MEMBERSHIP_SAVE_START",e[e.MANAGE_MEMBERSHIP_SAVE_SUCCESS=265]="MANAGE_MEMBERSHIP_SAVE_SUCCESS",e[e.MANAGE_MEMBERSHIP_SAVE_ERROR=266]="MANAGE_MEMBERSHIP_SAVE_ERROR",e[e.MANAGE_MEMBERSHIP_EVALUATE=267]="MANAGE_MEMBERSHIP_EVALUATE",e[e.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS=268]="MANAGE_MEMBERSHIP_EVALUATE_SUCCESS",e[e.MANAGE_MEMBERSHIP_EVALUATE_ERROR=269]="MANAGE_MEMBERSHIP_EVALUATE_ERROR",e[e.REQUEST_ADD_NARRATIVE_LOAD=270]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=271]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=272]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=273]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=274]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=275]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=276]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=277]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=278]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=279]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=280]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=281]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=282]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.REQUEST_ADD_NARRATIVE_SORT=283]="REQUEST_ADD_NARRATIVE_SORT",e[e.REQUEST_ADD_NARRATIVE_SORT_START=284]="REQUEST_ADD_NARRATIVE_SORT_START",e[e.REQUEST_ADD_NARRATIVE_SORT_SUCCESS=285]="REQUEST_ADD_NARRATIVE_SORT_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SORT_ERROR=286]="REQUEST_ADD_NARRATIVE_SORT_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=287]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=288]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=289]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=290]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=291]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=292]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=293]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=294]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=295]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=296]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=297]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=298]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=299]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=300]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=301]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=302]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=303]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.ENTITY_ORGANIZATION_LOAD=304]="ENTITY_ORGANIZATION_LOAD",e[e.ENTITY_ORGANIZATION_LOAD_START=305]="ENTITY_ORGANIZATION_LOAD_START",e[e.ENTITY_ORGANIZATION_LOAD_SUCCESS=306]="ENTITY_ORGANIZATION_LOAD_SUCCESS",e[e.ENTITY_ORGANIZATION_LOAD_ERROR=307]="ENTITY_ORGANIZATION_LOAD_ERROR",e[e.GLOBAL_ACCESS_NARRATIVE=308]="GLOBAL_ACCESS_NARRATIVE",e[e.GLOBAL_ACCESS_NARRATIVE_START=309]="GLOBAL_ACCESS_NARRATIVE_START",e[e.GLOBAL_ACCESS_NARRATIVE_SUCCESS=310]="GLOBAL_ACCESS_NARRATIVE_SUCCESS",e[e.GLOBAL_ACCESS_NARRATIVE_ERROR=311]="GLOBAL_ACCESS_NARRATIVE_ERROR",e[e.NOTIFICATIONS_LOAD=312]="NOTIFICATIONS_LOAD",e[e.NOTIFICATIONS_LOAD_START=313]="NOTIFICATIONS_LOAD_START",e[e.NOTIFICATIONS_LOAD_SUCCESS=314]="NOTIFICATIONS_LOAD_SUCCESS",e[e.NOTIFICATIONS_LOAD_ERROR=315]="NOTIFICATIONS_LOAD_ERROR",e[e.NOTIFICATIONS_UNLOAD=316]="NOTIFICATIONS_UNLOAD",e[e.NOTIFICATIONS_READ=317]="NOTIFICATIONS_READ",e[e.NOTIFICATIONS_READ_START=318]="NOTIFICATIONS_READ_START",e[e.NOTIFICATIONS_READ_SUCCESS=319]="NOTIFICATIONS_READ_SUCCESS",e[e.NOTIFICATIONS_READ_ERROR=320]="NOTIFICATIONS_READ_ERROR",e[e.DATA_SERVICE_LOAD=321]="DATA_SERVICE_LOAD",e[e.DATA_SERVICE_LOAD_START=322]="DATA_SERVICE_LOAD_START",e[e.DATA_SERVICE_LOAD_SUCCESS=323]="DATA_SERVICE_LOAD_SUCCESS",e[e.DATA_SERVICE_LOAD_ERROR=324]="DATA_SERVICE_LOAD_ERROR",e[e.DATA_SERVICE_UNLOAD=325]="DATA_SERVICE_UNLOAD",e[e.DATA_SERVICE_LOAD_REFRESH=326]="DATA_SERVICE_LOAD_REFRESH",e[e.DATA_SERVICE_LOAD_REFRESH_START=327]="DATA_SERVICE_LOAD_REFRESH_START",e[e.DATA_SERVICE_LOAD_REFRESH_SUCCESS=328]="DATA_SERVICE_LOAD_REFRESH_SUCCESS",e[e.DATA_SERVICE_LOAD_REFRESH_ERROR=329]="DATA_SERVICE_LOAD_REFRESH_ERROR"}(F||(F={}));var J=function(e,t){switch(t.type){case F.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case F.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.UNEDITED,saveState:c.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case F.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveError without view model"),e)}(e,t);case F.ADD_ORG_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{editState:s.UNEDITED,validationState:{type:o.OK,validatedAt:new Date},saveState:c.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case F.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case F.ADD_ORG_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Logo URL without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:t.error})})})})})}):(console.warn("attempting Logo URL error without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Home URL (success) without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:t.error})})})})})}):(console.warn("attempting update to home url without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Research Interests without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:t.error})})})})})}):(console.warn("attempting update to research interests (error) without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e);case F.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:i.DIRTY})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.isPrivate,{value:t.isPrivate,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case F.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{validationState:{type:o.OK,validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case F.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{validationState:{type:o.ERROR,message:"TODO: form error",validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};function Z(){return{type:o.OK,validatedAt:new Date}}function Y(e){return e.editedOrganization.name.syncState===i.DIRTY?s.EDITED:e.editedOrganization.id.syncState===i.DIRTY?s.EDITED:e.editedOrganization.logoUrl.syncState===i.DIRTY?s.EDITED:e.editedOrganization.homeUrl.syncState===i.DIRTY?s.EDITED:e.editedOrganization.researchInterests.syncState===i.DIRTY?s.EDITED:e.editedOrganization.isPrivate.syncState===i.DIRTY?s.EDITED:e.editedOrganization.description.syncState===i.DIRTY?s.EDITED:s.UNEDITED}var K=function(e,t){switch(t.type){case F.EDIT_ORG_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{editState:s.UNEDITED,validationState:Z(),saveState:c.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case F.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.EDIT_ORG_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVING})})})}):e}(e);case F.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.UNEDITED,saveState:c.SAVED,editedOrganization:{id:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.id,{syncState:i.CLEAN}),name:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{syncState:i.CLEAN}),logoUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{syncState:i.CLEAN}),homeUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{syncState:i.CLEAN}),researchInterests:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{syncState:i.CLEAN}),isPrivate:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{syncState:i.CLEAN}),description:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{syncState:i.CLEAN})}})})})}):e}(e);case F.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.name!==n.name.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:r,validationState:Z()})})})})})}),s=Y(a.views.editOrgView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},a.views.editOrgView,{viewModel:Object(W.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case F.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:Z()})})})})})}),n=Y(r.views.editOrgView.viewModel);return Object(W.a)({},r,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},r.views.editOrgView,{viewModel:Object(W.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case F.EDIT_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:Z()})})})})})}),n=Y(r.views.editOrgView.viewModel);return Object(W.a)({},r,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},r.views.editOrgView,{viewModel:Object(W.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case F.EDIT_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:Z()})})})})})}),n=Y(r.views.editOrgView.viewModel);return Object(W.a)({},r,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},r.views.editOrgView,{viewModel:Object(W.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.isPrivate!==n.isPrivate.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{value:t.isPrivate,syncState:r,validationState:Z()})})})})})}),o=Y(a.views.editOrgView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},a.views.editOrgView,{viewModel:Object(W.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case F.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.description!==n.description.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:r,validationState:Z()})})})})})}),o=Y(a.views.editOrgView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},a.views.editOrgView,{viewModel:Object(W.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case F.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{validationState:{type:o.OK,validatedAt:new Date}})})})}):e}(e);case F.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{validationState:{type:o.ERROR,message:"Validation errors",validatedAt:new Date}})})})}):e}(e);default:return null}};function X(e,t){switch(t.type){case F.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}var $=function(e,t){switch(t.type){case F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==f.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(W.a)({},e,{type:l.ADMIN}):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},r,{organization:Object(W.a)({},r.organization,{members:n})})})})})}(e,t);case F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==f.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(W.a)({},e,{type:l.MEMBER}):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},r,{organization:Object(W.a)({},r.organization,{members:n})})})})})}(e,t);case F.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==f.NORMAL)return e;var n=r.organization.members.filter(function(e){return e.username!==t.memberUsername}),a=r.members.filter(function(e){return e.username!==t.memberUsername});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},r,{organization:Object(W.a)({},r.organization,{members:n}),members:a})})})})}(e,t);case F.VIEW_ORG_SORT_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{sortMembersBy:t.sortBy,members:t.members})})})}):e}(e,t);case F.VIEW_ORG_SEARCH_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{searchMembersBy:t.searchBy,members:t.members})})})}):e}(e,t);default:return null}};function ee(e,t){switch(t.type){case F.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}function te(e,t){switch(t.type){case F.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{requestOutbox:t.requests})})})}):e}(e,t);default:return null}}function re(e,t){switch(t.type){case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:{manageRelatedOrganizationsView:{state:N.OK,error:null,viewModel:{kind:A.MANAGE_RELATED_ORGS,relatedOrganizations:e.views.viewOrgView.viewModel.organization.relatedOrganizations,organization:e.views.viewOrgView.viewModel.organization,organizations:t.organizations,selectedOrganization:null}}}})})})}):e}(e,t);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:{state:N.NONE,error:null,viewModel:null}})})})})}):e}(e);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.organizations.map(function(e){return e.organization.id===t.selectedOrganization.organization.id?e.isSelected=!0:e.isSelected=!1,e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{selectedOrganization:t.selectedOrganization,organizations:r})})})})})})})}(e,t);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.organizations,n=e.views.viewOrgView.viewModel.organization.relatedOrganizations.concat([t.organizationId]),a=r.map(function(e){return n.includes(e.organization.id)?e.isRelated=!0:e.isRelated=!1,e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:n}),subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{organizations:a})})})})})})})}(e,t);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId}),n=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.organizations.filter(function(e){return e.organization.id===t.organizationId&&(e.isRelated=!1),e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r}),subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{organizations:n})})})})})})})}(e,t);default:return null}}function ne(e,t){switch(t.type){case F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r})})})})})}(e,t);default:return null}}var ae=function(e,t){switch(t.type){case F.VIEW_ORG_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.VIEW_ORG_LOAD_NORMAL_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{kind:f.NORMAL,organization:t.organization,relation:t.relation,openRequest:t.openRequest,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,sortNarrativesBy:t.narrativesSortBy,searchNarrativesBy:"",narratives:t.narratives,sortMembersBy:t.sortMembersBy,members:t.members,searchMembersBy:"",subViews:{manageRelatedOrganizationsView:{state:N.NONE,viewModel:null,error:null}}}}})})}(e,t);case F.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{kind:f.PRIVATE_INACCESSIBLE,organization:t.organization,relation:t.relation,requestOutbox:t.requestOutbox}}})})}(e,t);case F.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.VIEW_ORG_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrative.workspaceId});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r})})})})})}(e,t);case F.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:t.organization})})})}):e}(e,t);case F.VIEW_ORG_SORT_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{sortNarrativesBy:t.sortBy,narratives:t.narratives})})})}):e}(e,t);case F.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{searchNarrativesBy:t.searchBy,narratives:t.narratives})})})}):e}(e,t)}return X(e,t)||ee(e,t)||te(e,t)||$(e,t)||re(e,t)||ne(e,t)};function ie(e,t){switch(t.type){case F.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.openRequests,s=r.searchTerms,o=r.sortField,c=r.sortDirection,l=r.filter,u=r.totalCount,E=r.filteredCount,d=r.selectedOrganizationId,v=r.error,m=r.searching;return Object(W.a)({},e,{loadingState:R.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,openRequests:i,searchTerms:s,sortField:o,sortDirection:c,filter:l,totalCount:u,filteredCount:E,selectedOrganizationId:d,error:v,searching:m}})}(e,t);case F.BROWSE_ORGS_SEARCH:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})}(e,t);case F.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{searching:!0})})}(e);case F.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{organizations:t.organizations,openRequests:t.openRequests,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})}(e,t);case F.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{searching:!1,error:t.error})})}(e,t);case F.BROWSE_ORGS_SORT_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{sortField:t.sortField,sortDirection:t.sortDirection,searching:!0})})}(e,t);case F.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{filter:r,searching:!0})})}(e,t);case F.BROWSE_ORGS_UNLOAD:return{loadingState:R.NONE,error:null,viewModel:null};default:return null}}var se=function(e,t){switch(t.type){case F.AUTH_CHECK_START:return function(e,t){return Object(W.a)({},e,{auth:{status:v.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case F.AUTH_AUTHORIZED:return function(e,t){return Object(W.a)({},e,{auth:{status:v.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case F.AUTH_UNAUTHORIZED:return function(e,t){return Object(W.a)({},e,{auth:{status:v.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case F.AUTH_CHECK_ERROR:return function(e,t){return Object(W.a)({},e,{auth:{status:v.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var oe=function(e,t){switch(t.type){case F.APP_SUCCESS:return function(e,t){return Object(W.a)({},e,{app:{status:p.READY,config:t.config}})}(e,t);default:return null}};var ce=function(e,t){switch(t.type){case F.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case F.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case F.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:Object(W.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(W.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var le,ue=function(e,t){switch(t.type){case F.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.LOADING,viewModel:null,error:null})})})}(e);case F.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case F.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.ERROR,viewModel:null,error:t.error})})})}(e,t);case F.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.NONE,viewModel:null,error:null})})})}(e);case F.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.ADMIN,e):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{viewModel:Object(W.a)({},e.views.viewMembersView.viewModel,{organization:Object(W.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case F.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.MEMBER,e):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{viewModel:Object(W.a)({},e.views.viewMembersView.viewModel,{organization:Object(W.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}},Ee=r(22),de=r(3),ve=r.n(de),me=r(6);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(le||(le={}));Object(H.a)(Error);var pe,Oe,Re,he=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).originalError=void 0,r.name="GroupException",r.originalError=e,r}return Object(U.a)(t,e),t}(Q),we=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(U.a)(t,e),t}(Q),_e=function(){function e(t){var r=t.token,n=t.url;Object(C.a)(this,e),this.token=void 0,this.url=void 0,this.token=r,this.url=n}return Object(D.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"listGroups",value:function(){var e=Object(me.a)(ve.a.mark(function e(){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGroups",value:function(){var e=this;return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200===e.status)return e.json().then(function(e){return e});if(204===e.status){return null}throw new Error("Unexpected response: "+e.status+" : "+e.statusText)}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new he(e)});case"text/plain":return e.text().then(function(e){throw new we(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new he(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new we(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new he(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new we(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{logourl:e.logoUrl,researchinterests:e.researchInterests,homeurl:e.homeUrl}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{logourl:t.logoUrl,homeurl:t.homeUrl,researchinterests:t.researchInterests},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"addRelatedGroup",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,!(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i={custom:{relatedgroups:a.join(",")}},e.next=10,this.put(["group",t,"update"],i);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRelatedGroup",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i=a.filter(function(e){return e!==r}),s={custom:{relatedgroups:i.join(",")}},e.next=11,this.put(["group",t,"update"],s);case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getRequest",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===le.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===le.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===le.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r,n){var a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"updateMember",value:function(e){var t=e.groupId,r=e.memberUsername,n=e.update,a=["group",t,"user",r,"update"];return this.put(a,{custom:n})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}},{key:"visitGroup",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupId,n=["group",r,"visit"],e.abrupt("return",this.put(n,null));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequests",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupIds,n=["request","groups",r.join(","),"new"],e.next=4,this.get(n);case 4:for(a=e.sent,i=new Map,s=Object.entries(a),o=0;o<s.length;o++)c=s[o],l=Object(Ee.a)(c,2),u=l[0],E=l[1],i.set(u,E);return e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function ge(e){var t=function(e){switch(e){case"Invite":return pe.INVITATION;case"Request":return pe.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return Oe.USER;case"workspace":return Oe.WORKSPACE;case"catalogmethod":return Oe.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,Re.OPEN);switch(r){case Oe.USER:return pe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case Oe.WORKSPACE:return pe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case Oe.APP:return pe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(pe||(pe={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(Oe||(Oe={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(Re||(Re={}));var Se,fe,Ae,Ne,Ie,be=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.cache=void 0,this.params=t,this.groupsClient=new _e({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(D.a)(e,[{key:"getRequest",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=ge(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOutboundRequests",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t,r,n,a=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ge(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ge(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ge(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ge(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCombinedRequestInboxForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getGroupRequests(t,{includeClosed:!1,sortDirection:le.DESCENDING});case 4:e.t0=function(e){return ge(e)},n=e.sent.map(e.t0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(1),n=[];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ge(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t,r,n,a=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ge(e)}).filter(function(e){return e.type===pe.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboundRequests",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t,r,n,a=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ge(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:le.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ge(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:le.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return ge(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:le.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return ge(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ge(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ge(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ge(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ge(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ge(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return ge(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),Te=function(){function e(){Object(C.a)(this,e)}return Object(D.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:o.REQUIRED_MISSING,message:"Organization id may not be empty",validatedAt:new Date}];if(e.match(/\s/))return[e,{type:o.ERROR,message:"Organization id may not contain a space",validatedAt:new Date}];if(e.length>100)return[e,{type:o.ERROR,message:"Organization id may not be longer than 100 characters",validatedAt:new Date}];return e.match(/^[a-z0-9-]+$/)?[e,{type:o.OK,validatedAt:new Date}]:[e,{type:o.ERROR,message:'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash "-"',validatedAt:new Date}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:o.REQUIRED_MISSING,message:"Organization name may not be empty",validatedAt:new Date}]:e.length>256?[e,{type:o.ERROR,message:"Organization name may not be longer than 256 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgLogoUrl",value:function(e){return null===e?[e,{type:o.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:o.ERROR,message:"Logo url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgHomeUrl",value:function(e){return null===e?[e,{type:o.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:o.ERROR,message:"Home url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgResearchInterests",value:function(e){return 0===e.length?[name,{type:o.REQUIRED_MISSING,message:"Research Interests may not be empty",validatedAt:new Date}]:e.length>280?[e,{type:o.ERROR,message:"Research Interests may not be longer than 280 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:o.ERROR,message:"Organization description may not be empty",validatedAt:new Date}]:e.length>4096?[e,{type:o.ERROR,message:"Organization description may not be longer than 4,096 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateMemberTitle",value:function(e){return e.length>100?[e,{type:o.ERROR,message:"member title may not be longer than ".concat(100," characters"),validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}}]),e}();function ye(e,t,r,n){if(e.kind===Ne.INACCESSIBLE_PRIVATE)return r&&r.user===t?{type:Se.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:Se.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:Se.NONE};if(t===e.owner.username)return{type:Se.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:Se.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:Se.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:Se.NONE};switch(a.type){case fe.MEMBER:return{type:Se.MEMBER};case fe.ADMIN:return{type:Se.ADMIN};case fe.OWNER:return{type:Se.OWNER};default:return{type:Se.NONE}}}function Me(e){switch(e){case"None":return Ae.NONE;case"Read":return Ae.VIEW;case"Write":return Ae.EDIT;case"Admin":return Ae.ADMIN;case"Own":return Ae.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}function Ce(e,t){var r={username:e.owner.name,joinedAt:new Date(e.owner.joined),lastVisitedAt:e.owner.lastvisit?new Date(e.owner.lastvisit):null,type:fe.OWNER,title:"Owner"},n=[].concat(e.admins.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:fe.ADMIN,title:e.custom.title}})).concat(e.members.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:fe.MEMBER,title:e.custom.title}})),a=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:Me(e.perm),createdAt:new Date(e.narrcreate),updatedAt:new Date(e.moddate),description:e.description}});return{kind:Ne.NORMAL,id:e.id,name:e.name,isPrivate:e.private,isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,relation:je(e.role),logoUrl:e.custom.logourl||null,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||"",description:e.custom.description,owner:r,areMembersPrivate:e.privatemembers,members:n,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,narratives:a,apps:[],memberCount:e.memcount,narrativeCount:e.rescount.workspace||0,appCount:e.rescount.catalogmethod||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}function De(e,t){return{kind:Ne.INACCESSIBLE_PRIVATE,id:e.id,isPrivate:e.private,relation:je(e.role)}}function Ve(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.researchInterests||"")||t.test(e.owner.username)})})}function ke(e){var t=e.getTime();return Math.round(t/864e5)}function Ue(e,t,r,n){switch(e){case"created":return t*(ke(r.createdAt)-ke(n.createdAt));case"modified":case"changed":return t*(ke(r.modifiedAt)-ke(n.modifiedAt));case"name":return t*r.name.localeCompare(n.name);case"owner":return t*r.owner.username.localeCompare(n.owner.username);case"narrativeCount":return t*(r.narrativeCount-n.narrativeCount);case"memberCount":return t*(r.memberCount-n.memberCount);default:return console.warn("unimplemented sort field: "+e),0}}function ze(e,t,r){var n=r===O.ASCENDING?1:-1;return e.slice().sort(function(e,r){return Ue(t,n,e,r)||Ue("name",1,e,r)})}function je(e){switch(e){case"None":return Se.NONE;case"Member":return Se.MEMBER;case"Admin":return Se.ADMIN;case"Owner":return Se.OWNER;default:throw new Error("Unknown role: "+e)}}function Ge(e,t,r){var n=t.roleType,a=t.roles,i=t.privacy;return e.filter(function(e){return function(e){switch(n){case"myorgs":return[Se.MEMBER,Se.ADMIN,Se.OWNER].includes(e.relation);case"notmyorgs":return![Se.MEMBER,Se.ADMIN,Se.OWNER].includes(e.relation);case"all":default:return!0}}(e)&&function(e){return 0===a.length||a.some(function(t){switch(t){case"member":return e.relation===Se.MEMBER;case"admin":return e.relation===Se.ADMIN;case"owner":return e.relation===Se.OWNER;default:return!1}})}(e)&&function(e){switch(i){case"public":return!e.isPrivate;case"private":return e.isPrivate;case"any":return!0;default:return!1}}(e)})}function Le(e){switch(e){case"name":return function(e,t){return e.title.localeCompare(t.title)};case"updated":return function(e,t){return t.updatedAt.getTime()-e.updatedAt.getTime()};default:case"added":return function(e,t){return t.updatedAt.getTime()-e.updatedAt.getTime()}}}function Pe(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=Le(t)(e,r);return 0===n&&"name"!==t?Le("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.title)})})}(e,t.searchBy),t.sortBy)}function xe(e){switch(e){case"name":return function(e,t){return e.username.localeCompare(t.username)};default:case"added":return function(e,t){return t.joinedAt.getTime()-e.joinedAt.getTime()}}}function Be(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=xe(t)(e,r);return 0===n&&"name"!==t?xe("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.username)||t.test(e.title||"")})})}(e,t.searchBy),t.sortBy)}Te.nonPrintableRe=/[\000-\031]/,function(e){e.NONE="NONE",e.VIEW="VIEW",e.MEMBER_REQUEST_PENDING="MEMBER_REQUEST_PENDING",e.MEMBER_INVITATION_PENDING="MEMBER_INVITATION_PENDING",e.MEMBER="MEMBER",e.ADMIN="ADMIN",e.OWNER="OWNER"}(Se||(Se={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(fe||(fe={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(Ae||(Ae={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.INACCESSIBLE_PRIVATE=1]="INACCESSIBLE_PRIVATE"}(Ne||(Ne={})),function(e){e.INAPPLICABLE="INAPPLICABLE",e.NONE="NONE",e.OLD="OLD",e.NEW="NEW"}(Ie||(Ie={}));var We=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.organizations=void 0,this.params=t,this.groupsClient=new _e({url:this.params.groupsServiceURL,token:this.params.token}),this.organizations=new Map}return Object(D.a)(e,[{key:"getOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.organizations.has(t)){e.next=2;break}return e.abrupt("return",this.organizations.get(t));case 2:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){var n;return n="None"===e.role&&e.private?De(e,r.params.username):Ce(e,r.params.username),r.organizations.set(t,n),n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganization",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.organizations.has(t)){e.next=5;break}if((r=this.organizations.get(t)).kind===Ne.NORMAL){e.next=4;break}throw new Error("Inaccessible Organization");case 4:return e.abrupt("return",r);case 5:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){if("None"===e.role&&e.private)throw new Error("Inaccessible Organization");var r=Ce(e,n.params.username);return n.organizations.set(t,r),r}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllOrgs",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t,r;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroups();case 2:return t=e.sent,r=t.map(function(e){return e.id}),e.abrupt("return",this.getOrgs(r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t,r;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return t=e.sent,r=t.filter(function(e){return e.relation!==Se.NONE}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listGroupToBriefOrganization",value:function(e){return{id:e.id,name:e.name,logoUrl:e.custom.logourl||null,isPrivate:e.private,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||null,owner:{username:e.owner,lastVisitedAt:null,type:fe.OWNER,joinedAt:new Date(e.createdate),title:"Owner"},relation:je(e.role),isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,memberCount:e.memcount||0,narrativeCount:e.rescount.workspace||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}},{key:"getAllOrgs2",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t,r,n=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.listGroups();case 2:return t=e.sent,r=t.map(function(e){return n.listGroupToBriefOrganization(e)}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=Ge(r,t.filter,t.username),a=Ve(n,t.searchTerms),i=ze(a,t.sortField,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=r.filter(function(e){return e.relation!==Se.NONE}),e.abrupt("return",{organizations:n,total:n.length});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",ge(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),t.id.validationState.type===o.OK&&t.name.validationState.type===o.OK&&t.logoUrl.validationState.type===o.OK&&t.description.validationState.type===o.OK&&t.isPrivate.validationState.type===o.OK){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.abrupt("return",n.createGroup({id:t.id.value,name:t.name.value,logoUrl:t.logoUrl.value,homeUrl:t.homeUrl.value,researchInterests:t.researchInterests.value,description:t.description.value,isPrivate:t.isPrivate.value}).then(function(e){return Ce(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,logoUrl:r.logoUrl,homeUrl:r.homeUrl,researchInterests:r.researchInterests,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return Te.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return Te.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return Te.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembership",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",ge(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",ge(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.memberToAdmin({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"adminToMember",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.adminToMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.removeMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateMember",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r,n){var a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",a.updateMember({groupId:t,memberUsername:r,update:n}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"visitOrg",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.visitGroup({groupId:r}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestsStatus",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E,d,v,m,p;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationIds,n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:r});case 4:for(a=e.sent,i=new Map,s=!0,o=!1,c=void 0,e.prev=9,l=a.entries()[Symbol.iterator]();!(s=(u=l.next()).done);s=!0)E=u.value,d=Object(Ee.a)(E,2),v=d[0],m=d[1],p=qe(m),i.set(v,p);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),o=!0,c=e.t0;case 17:e.prev=17,e.prev=18,s||null==l.return||l.return();case 20:if(e.prev=20,!o){e.next=23;break}throw c;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestStatus",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E,d;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:[r]});case 4:a=e.sent,i=!0,s=!1,o=void 0,e.prev=8,c=a.entries()[Symbol.iterator]();case 10:if(i=(l=c.next()).done){e.next=19;break}return u=l.value,E=Object(Ee.a)(u,2),E[0],d=E[1],e.abrupt("return",qe(d));case 16:i=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),s=!0,o=e.t0;case 25:e.prev=25,e.prev=26,i||null==c.return||c.return();case 28:if(e.prev=28,!s){e.next=31;break}throw o;case 31:return e.finish(28);case 32:return e.finish(25);case 33:throw new Error("expected request status, got none");case 34:case"end":return e.stop()}},e,this,[[8,21,25,33],[26,,28,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addRelatedOrganization",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.addRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeRelatedOrganization",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new _e({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.removeRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function qe(e){switch(e.new){case"None":return Ie.NONE;case"Old":return Ie.OLD;case"New":return Ie.NEW;default:throw new Error("Invalid open request status: "+e)}}var He=function(e,t){switch(t.type){case F.INVITE_USER_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{loadingState:R.LOADING})})})}(e);case F.INVITE_USER_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{loadingState:R.SUCCESS,error:null,viewModel:{editState:w.EDITING,users:t.users,organization:t.organization,selectedUser:null}})})})}(e,t);case F.INVITE_USER_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{loadingState:R.SUCCESS,error:t.error,viewModel:null})})})}(e,t);case F.INVITE_USER_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{loadingState:R.NONE,error:null,viewModel:null})})})}(e);case F.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{viewModel:Object(W.a)({},e.views.inviteUserView.viewModel,{users:t.users})})})})}(e,t);case F.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{viewModel:Object(W.a)({},e.views.inviteUserView.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})})})}(e,t);case F.INVITE_USER_SEND_INVITATION_START:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{viewModel:Object(W.a)({},e.views.inviteUserView.viewModel,{editState:w.SENDING})})})})}(e);case F.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");var r=e.views.inviteUserView.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=Se.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=Se.MEMBER_INVITATION_PENDING),e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{viewModel:Object(W.a)({},e.views.inviteUserView.viewModel,{editState:w.SUCCESS,selectedUser:n,users:i})})})})}(e);case F.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{inviteUserView:Object(W.a)({},e.views.inviteUserView,{viewModel:Object(W.a)({},e.views.inviteUserView.viewModel,{editState:w.ERROR})})})})}(e);default:return null}};function Fe(){return{type:o.OK,validatedAt:new Date}}function Qe(e){return e.editableMemberProfile.title.syncState===i.DIRTY?s.EDITED:s.UNEDITED}var Je=function(e,t){switch(t.type){case F.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,editableMemberProfile:t.editableMemberProfile,editState:s.UNEDITED,saveState:c.NEW,validationState:Fe()}}})})}(e,t);case F.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r,n=e.views.manageMembershipView.viewModel.editableMemberProfile;r=t.title!==n.title.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{editableMemberProfile:Object(W.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile,{title:{value:t.title,remoteValue:t.title,syncState:r,validationState:Fe()}})})})})}),s=Qe(a.views.manageMembershipView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},a.views.manageMembershipView,{viewModel:Object(W.a)({},a.views.manageMembershipView.viewModel,{editState:s})})})})}(e,t);case F.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r=Qe(e.views.manageMembershipView.viewModel);return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{editState:r,validationState:{type:o.OK,validatedAt:new Date}})})})})}(e);case F.MANAGE_MEMBERSHIP_EVALUATE_ERROR:return function(e,t){return e.views.manageMembershipView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{validationState:{type:o.ERROR,message:"Validation error(s)",validatedAt:new Date}})})})}):e}(e);case F.MANAGE_MEMBERSHIP_SAVE_SUCCESS:return function(e,t){return e.views.manageMembershipView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{editState:s.UNEDITED,saveState:c.SAVED,editableMemberProfile:{title:Object(W.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile.title,{syncState:i.CLEAN})}})})})}):e}(e);default:return null}};function Ze(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{viewModel:Object(W.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVING})})})})}var Ye=function(e,t){switch(t.type){case F.REQUEST_ADD_NARRATIVE_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{loadingState:R.LOADING,error:null,viewModel:null})})})}(e);case F.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,saveState:c.SAVED}})})})}(e,t);case F.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{loadingState:R.ERROR,error:t.error,viewModel:null})})})}(e,t);case F.REQUEST_ADD_NARRATIVE_SEND_START:return Ze(e);case F.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{viewModel:Object(W.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVED})})})}),n=r.views.requestNarrativeView.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=_.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=_.REQUESTED),e}),r}(e,t);case F.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return Ze(e);case F.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{error:null,viewModel:Object(W.a)({},e.views.requestNarrativeView.viewModel,{selectedNarrative:t.narrative})})})})}(e,t);case F.REQUEST_ADD_NARRATIVE_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:return function(e,t){var r=e.views.requestNarrativeView.viewModel;return null===r?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{viewModel:Object(W.a)({},r,{narratives:t.narratives})})})})}(e,t);default:return null}};function Ke(e,t){switch(t.type){case F.ENTITY_ORGANIZATION_LOAD_SUCCESS:return function(e,t){var r=new Map(e.entities.organizations.byId);return r.set(t.organization.id,t.organization),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{organizations:Object(W.a)({},e.entities.organizations.byId,{byId:r})})})}(e,t);default:return null}}function Xe(e,t){switch(t.type){case F.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{users:Object(W.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case F.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{orgs:Object(W.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case F.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{narratives:{byId:new Map(r.byId)}})})}(e,t)}return Ke(e,t)}var $e=function(e,t){switch(t.type){case F.ORGANIZATION_CENTRIC_VIEW_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:Object(W.a)({},e.views.organizationCentricView,{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,pendingJoinRequest:t.pendingJoinRequest,pendingJoinInvitation:t.pendingJoinInvitation,relation:t.relation}})})})}(e,t);case F.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:Object(W.a)({},e.views.organizationCentricView,{loadingState:R.ERROR,error:t.error,viewModel:null})})})}(e,t);case F.ORGANIZATION_CENTRIC_VIEW_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);default:return null}};function et(e,t){switch(t.type){case F.GLOBAL_ACCESS_NARRATIVE_SUCCESS:return function(e,t){var r=e.entities.narratives.byId;return r.set(t.narrative.workspaceId,t.narrative),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{narratives:Object(W.a)({},e.entities.narratives,{byId:r})})})}(e,t);default:return null}}function tt(e,t){switch(t.type){case F.NOTIFICATIONS_LOAD_SUCCESS:return function(e,t){var r=new Map;return t.notifications.forEach(function(e){r.set(e.id,e)}),Object(W.a)({},e,{db:Object(W.a)({},e.db,{notifications:{all:t.notifications,byId:r}})})}(e,t);case F.NOTIFICATIONS_UNLOAD:return function(e,t){return Object(W.a)({},e,{db:Object(W.a)({},e.db,{notifications:{all:[],byId:new Map}})})}(e);case F.NOTIFICATIONS_READ_SUCCESS:return function(e,t){var r=e.db.notifications,n=r.all,a=r.byId,i=n.filter(function(e){return e.id!==t.notificationId}),s=new Map(a);return s.delete(t.notificationId),Object(W.a)({},e,{db:Object(W.a)({},e.db,{notifications:{all:i,byId:s}})})}(e,t);default:return null}}function rt(e,t){switch(t.type){case F.DATA_SERVICE_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{db:Object(W.a)({},e.db)})}(e);default:return null}}var nt,at=function(e,t){return J(e,t)||K(e,t)||function(e,t){var r=ie(e.views.browseOrgsView,t);return r?Object(W.a)({},e,{views:Object(W.a)({},e.views,{browseOrgsView:r})}):null}(e,t)||ae(e,t)||se(e,t)||oe(e,t)||ce(e,t)||ue(e,t)||He(e,t)||Je(e,t)||Ye(e,t)||Xe(e,t)||$e(e,t)||et(e,t)||tt(e,t)||rt(e,t)||e},it=(r(168),r(147)),st=r(73),ot=(r(170),r(358)),ct=r(342),lt=r(59),ut=r.n(lt),Et=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLogoUrl",value:function(){return this.props.logoUrl?b.createElement("img",{src:this.props.logoUrl,width:this.props.size}):b.createElement("span",null,"n/a")}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultInitial",value:function(){var e=this.charAt(this.props.organizationName,0).toUpperCase(),t=ut()(this.props.organizationId).substr(0,6);return b.createElement("svg",{width:this.props.size,height:this.props.size,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},b.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:this.props.size-12,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogo",value:function(){return this.props.logoUrl?this.renderLogoUrl():this.renderDefaultInitial()}},{key:"render",value:function(){return this.renderLogo()}}]),t}(b.Component),dt=r(339),vt=r(19),mt=r(349),pt=r(355),Ot=r(351),Rt=(r(174),r(176),r(115)),ht=r.n(Rt),wt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:ht.a;case"silhouette":case"mysteryman":default:return ht.a}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return b.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(b.Component);function _t(e){switch(e){case nt.COMPACT:return nt.NORMAL;case nt.NORMAL:return nt.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(nt||(nt={}));var gt=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:nt.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:_t(this.state.view)})}},{key:"renderRole",value:function(){return b.createElement("span",null,b.createElement(vt.a,{type:"crown"})," owner")}},{key:"renderAvatar",value:function(){if(this.props.showAvatar)return b.createElement("div",{className:"Owner-avatarCol"},b.createElement(wt,{user:this.props.user,size:this.props.avatarSize||30}))}},{key:"renderCompact",value:function(){var e=b.createElement("div",null,b.createElement("div",null,this.props.user.realname),b.createElement("div",null,b.createElement("span",null,b.createElement(wt,{user:this.props.user,size:20}))," ",b.createElement("span",null,this.props.user.username)));return b.createElement("div",{className:"Owner-owner"},this.renderAvatar(),b.createElement("div",{className:"Owner-infoCol"},b.createElement("div",{className:"Owner-name"},b.createElement(dt.a,{placement:"bottomRight",title:e},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))))}},{key:"renderNormal",value:function(){return b.createElement("div",{className:"Owner View-NORMAL"},b.createElement("div",{className:"Owner-controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===nt.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===nt.NORMAL?"up":"down")}))),b.createElement("div",{className:"Owner-avatarCol"},b.createElement(wt,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"Owner-infoCol"},b.createElement("div",{className:"Owner-name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),b.createElement("div",{className:"Owner-username"},this.props.user.username),b.createElement("div",{className:"Owner-title"},this.props.user.title||b.createElement("i",null,"no title in user profile")),b.createElement("div",{className:"Owner-organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"Owner-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){return this.renderCompact()}}]),t}(b.Component),St=function(){function e(t){var r=t.url,n=t.token;Object(C.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n||null}return Object(D.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}();St.module=void 0;var ft=function(e){function t(e){var r;if(Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(St),At=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var e=Object(me.a)(ve.a.mark(function e(r){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.profileCache.has(r)){e.next=2;break}return e.abrupt("return",Promise.resolve(t.profileCache.get(r)));case 2:return e.abrupt("return",this.callFunc("get_user_profile",[r]).then(function(e){return e.result[0][0]}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateUserProfile",value:function(){var e=Object(me.a)(ve.a.mark(function e(r){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.profileCache.delete(r.user.username),e.abrupt("return",this.callFunc("update_user_profile",{profile:r}).then(function(){}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("get_user_profile",t).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllUsers",value:function(){var e=Object(me.a)(ve.a.mark(function e(){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:""}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:t}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(ft);function Nt(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}At.module="UserProfile",At.profileCache=new Map;var It=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.userProfileClient=void 0,this.cache=void 0,this.params=t,this.userProfileClient=new At({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(D.a)(e,[{key:"getUser",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=Nt(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return Nt(e)}),a.forEach(function(e){var t=Nt(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),bt=function(e){function t(e){var r;if(Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"callFunc",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(C.a)(this,e),this.url=void 0,this.token=void 0,this.module=void 0,this.url=r,this.token=n||null,this.module=a}return Object(D.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i,s,o;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=13;break}return e.next=3,t.json();case 3:if(r=e.sent,n=r.result,a=r.error,!n){e.next=10;break}return e.abrupt("return",[n,null]);case 10:return e.abrupt("return",[null,a]);case 11:e.next=15;break;case 13:if(204!==t.status){e.next=15;break}return e.abrupt("return",[null,null]);case 15:if(500!==t.status){e.next=28;break}if("application/json"!==t.headers.get("Content-Type")){e.next=24;break}return e.next=19,t.json();case 19:return i=e.sent,s=i.error,e.abrupt("return",[null,s]);case 24:return e.next=26,t.text();case 26:return o=e.sent,e.abrupt("return",[null,{code:0,name:"Internal Server Error (for real)",message:"The service experienced an internal error",error:o}]);case 28:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){return n.processResponse(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),Tt=r(74),yt=r.n(Tt),Mt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(ft);Mt.module="ServiceWizard";var Ct=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(C.a)(this,e),this.cache=void 0,this.cacheLifetime=void 0,this.monitoringFrequency=void 0,this.waiterTimeout=void 0,this.waiterFrequency=void 0,this.isMonitoring=void 0,this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(D.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new yt.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var s=(new Date).getTime()-a;s>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+s))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):yt.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),Dt=function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,s=t.rpcContext;if(Object(C.a)(this,e),this.token=void 0,this.timeout=void 0,this.rpcContext=void 0,this.url=void 0,this.version=void 0,this.token=r,this.timeout=i||1e4,this.rpcContext=s||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(D.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return Ct.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new Mt({url:e.url,token:e.token});return yt.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new bt({module:n.module_name,url:n.url,token:r.token});return yt.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}();Dt.module=void 0;var Vt,kt,Ut,zt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"listNarratives",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(Ee.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(Dt);function jt(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function Gt(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:jt(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:"r"===e[6],lockStatus:e[7],metadata:e[8]}}function Lt(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:jt(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}zt.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(Vt||(Vt={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(kt||(kt={})),function(e){e.TITLE="TITLE",e.LAST_SAVED="LAST_SAVED"}(Ut||(Ut={}));var Pt=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.params=t}return Object(D.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i,s,o,c,l,u;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new zt({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new We({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),a=new be({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:if(i=e.sent,s=Object(Ee.a)(i,3),o=s[0],c=s[1],l=s[2],c.kind!==Ne.INACCESSIBLE_PRIVATE){e.next=12;break}throw new Error("Cannot get own narratives for private inaccessible organization");case 12:return u=c.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",o.narratives.map(function(e){return{workspaceInfo:Gt(e.ws),objectInfo:Lt(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){return{status:-1!==u.indexOf(e.workspaceInfo.id)?Vt.ASSOCIATED:l.find(function(t){return t.resourceType===Oe.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?Vt.REQUESTED:Vt.NONE,narrative:{access:kt.OWNER,isPublic:e.workspaceInfo.globalReadPermission,workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,owner:e.workspaceInfo.owner,lastSavedAt:e.objectInfo.savedAt,lastSavedBy:e.objectInfo.savedBy}}}).sort(function(e,t){return e.narrative.title.localeCompare(t.narrative.title)}));case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSorter",value:function(e){switch(e){case Ut.TITLE:return function(e,t){return e.narrative.title.localeCompare(t.narrative.title)};case Ut.LAST_SAVED:return function(e,t){return t.narrative.lastSavedAt.getTime()-e.narrative.lastSavedAt.getTime()};default:throw new Error("invalid sort spec")}}},{key:"sortOrganizationNarratives",value:function(e,t){var r=this.getSorter(t);return e.sort(r).slice(0)}},{key:"getNarrative",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E,d,v;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new bt({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.callFunc("get_workspace_info",[{id:t}]);case 4:if(n=e.sent,a=Object(Ee.a)(n,2),i=a[0],!a[1]){e.next=10;break}return e.abrupt("return",{workspaceId:t,access:kt.NONE});case 10:if(s=Gt(i[0]),o=s.metadata.narrative){e.next=14;break}return e.abrupt("return",{workspaceId:t,access:kt.NONE});case 14:return c=parseInt(o,10),e.next=17,r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:c}],includeMetadata:1,ignoreErrors:0}]);case 17:if(l=e.sent,u=Object(Ee.a)(l,2),E=u[0],!u[1]){e.next=23;break}return e.abrupt("return",{workspaceId:t,access:kt.NONE});case 23:d=Lt(E[0].infos[0]),e.t0=s.userPermission,e.next="n"===e.t0?27:"r"===e.t0?33:"w"===e.t0?35:"a"===e.t0?37:39;break;case 27:if(!s.globalReadPermission){e.next=32;break}return v=kt.VIEW,e.abrupt("break",40);case 32:throw new Error("Cannot have no access and no global read permission!");case 33:return v=kt.VIEW,e.abrupt("break",40);case 35:return v=kt.EDIT,e.abrupt("break",40);case 37:return v=s.owner===this.params.username?kt.OWNER:kt.ADMIN,e.abrupt("break",40);case 39:throw new Error("Unknown workspace permission: "+s.userPermission);case 40:return e.abrupt("return",{workspaceId:s.id,access:v,isPublic:s.globalReadPermission,objectId:d.id,title:s.metadata.narrative_nice_name||"Unknown",owner:s.owner,lastSavedAt:d.savedAt,lastSavedBy:d.savedBy});case 43:throw e.prev=43,e.t1=e.catch(1),console.error("Error fetching narrative!",e.t1),e.t1;case 47:case"end":return e.stop()}},e,this,[[1,43]])}));return function(t){return e.apply(this,arguments)}}()}]),e}();function xt(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,s=i.token,i.username,o=a.app.config,c=new It({token:s,userProfileServiceURL:o.services.UserProfile.url}),t.prev=3,t.next=6,c.getUser(e);case 6:l=t.sent,r((E=l,{type:F.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((u={code:"error",message:t.t0.message},{type:F.ENTITY_USER_LOADER_ERROR,error:u}));case 13:case"end":return t.stop()}var u,E},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function Bt(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Pt({token:s,username:o,workspaceServiceURL:c.services.Workspace.url,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=3,t.next=6,l.getNarrative(e);case 6:u=t.sent,r({type:F.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:F.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}var Wt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(gt,{user:this.props.user,avatarSize:this.props.avatarSize,showAvatar:this.props.showAvatar}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.username)}}]),t}(b.Component);var qt=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.username)}},function(e){return{onLoad:function(t){e(xt(t))}}})(Wt);r(227);function Ht(e,t){var r,n,a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=new Date,o=Math.round((s.getTime()-e.getTime())/1e3),c=Math.abs(o);if(c<86400*(t||90)){if(0===c)return"now";c<60?(r=o,n=c,a="second"):c<3600?(r=Math.round(o/60),n=Math.round(c/60),a="minute"):c<86400?(r=Math.round(o/3600),n=Math.round(c/3600),a="hour"):(r=Math.round(o/86400),n=Math.round(c/86400),a="day"),n>1&&(a+="s");var l=null,u=null;return r<0?l="in":r>0&&(u="ago"),(l?l+" ":"")+n+" "+a+(u?" "+u:"")}return i&&s.getFullYear()===e.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var Ft=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){if(!1===this.props.showTooltip)return b.createElement("span",null,Ht(this.props.time,30));var e,t=b.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(this.props.time));return e=this.props.tooltipPrefix?b.createElement("span",null,this.props.tooltipPrefix,t):t,b.createElement(dt.a,{placement:"bottomRight",title:e},Ht(this.props.time,30))}}]),t}(b.Component);function Qt(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var Jt=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Qt(this.state.view)})}},{key:"renderLogo",value:function(e){return b.createElement(Et,{logoUrl:e.logoUrl,size:80,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(!e.homeUrl)return b.createElement(dt.a,{placement:"bottomRight",title:"This organization has not set a home page url"},b.createElement(vt.a,{type:"home",style:{color:"rgba(200, 200, 200, 0.3)"}}));var t=b.createElement(b.Fragment,null,b.createElement("p",null,"Home page for this Organization (external to KBase)"));return b.createElement("div",{className:"BriefOrganization-homeUrl"},b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:t},b.createElement("a",{href:e.homeUrl,target:"_blank"},b.createElement(vt.a,{type:"home"}))))}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?b.createElement("span",null,e.narrativeCount):b.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return 1==e.memberCount?b.createElement("span",{style:{color:"gray"}},"\xd8"):b.createElement("span",null,e.memberCount-1)}},{key:"renderRelation",value:function(e){switch(e.relation){case Se.NONE:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},b.createElement("span",null,b.createElement(vt.a,{type:"stop"})));case Se.VIEW:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},b.createElement(vt.a,{type:"stop"}));case Se.MEMBER_REQUEST_PENDING:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"Your membership request is pending"},b.createElement(vt.a,{type:"user",style:{color:"orange"}})," Your membership ",b.createElement("b",null,"request")," is pending");case Se.MEMBER_INVITATION_PENDING:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this organization"},b.createElement(vt.a,{type:"user",style:{color:"blue"}}));case Se.MEMBER:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},b.createElement(vt.a,{type:"user"}));case Se.ADMIN:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an administrator of this organization"},b.createElement(vt.a,{type:"robot"}));case Se.OWNER:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are the owner of this organization"},b.createElement(vt.a,{type:"crown"}))}}},{key:"renderPrivacy",value:function(){return this.props.organization.isPrivate?b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is private - may only be viewed by members"},b.createElement("span",null,b.createElement(vt.a,{type:"unlock"}))):b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is public - may be viewed by any KBase user"},b.createElement("span",null,b.createElement(vt.a,{type:"global"})))}},{key:"renderOrgFreshness",value:function(e){var t;if(e.lastVisitedAt&&e.modifiedAt.getTime()>e.lastVisitedAt.getTime()){t=b.createElement("div",null,b.createElement(dt.a,{placement:"topRight",title:"This org has changed since your last visit to it"},b.createElement("span",{style:{color:"red",fontSize:"120%"}},b.createElement(vt.a,{type:"bell",theme:"filled"}))))}else t=b.createElement("div",null,b.createElement("span",{style:{color:"transparent",fontSize:"120%"}},b.createElement(vt.a,{type:"bell",theme:"filled"})));var r;return r=null,b.createElement("div",null,t,r)}},{key:"renderRequests",value:function(){if(this.props.organization.relation===Se.ADMIN||this.props.organization.relation===Se.OWNER){var e,t;switch(this.props.openRequestsStatus){case Ie.NONE:e="There are no open requests for this organization",t="rgba(200, 200, 200, 0.3)";break;case Ie.NEW:e="There are new requests since you last visited this organization",t="red";break;case Ie.OLD:e="There are open requests for this organization",t="blue";break;case Ie.INAPPLICABLE:return;default:return void console.warn("Invalid open request status: "+this.props.openRequestsStatus)}var r=b.createElement("span",null,e);return b.createElement(dt.a,{placement:"topRight",title:r},b.createElement("span",{style:{color:t,fontSize:"80%"}},b.createElement(vt.a,{type:"mail"})))}}},{key:"renderPermalink",value:function(){var e=b.createElement("div",null,b.createElement("p",null,'Below is the "permalink" for this organization. You may copy this url and use it to access this organization in a web browser.'),b.createElement("p",{style:{fontFamily:"monospace",fontWeight:"bold"}},window.location.origin,"/#org/",this.props.organization.id)),t=b.createElement(pt.a,{onClick:function(t){t.key;mt.a.info({title:"Org Permalink",content:e})}},b.createElement(pt.a.Item,{key:"view"},"View Permalink"));return b.createElement(Ot.a,{overlay:t,trigger:["click","contextMenu"]},b.createElement("a",{href:"/#orgs/"+this.props.organization.id},b.createElement(vt.a,{type:"link"})))}},{key:"renderLogoColumn",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"BriefOrganization-logoRow"},b.createElement(ct.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),b.createElement("div",{className:"BriefOrganization-statusRow"},b.createElement("div",{className:"BriefOrganization-relationCol"},this.renderRelation(e)),b.createElement("div",{className:"BriefOrganization-privacyCol"},this.renderPrivacy()),b.createElement("div",{className:"BriefOrganization-homeLinkCol"},this.renderHomeUrl(e))),b.createElement("div",{className:"BriefOrganization-freshnessRow"},b.createElement("div",{className:"BriefOrganization-orgFreshnessCol"},this.renderOrgFreshness(e)),b.createElement("div",{className:"BriefOrganization-openRequestsCol"},this.renderRequests()),b.createElement("div",{className:"BriefOrganization-openNewRequestsCol"},this.renderPermalink())))}},{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderInfoCol",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),b.createElement("div",{className:"BriefOrganization-orgOwner BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"owner")),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},b.createElement(qt,{username:e.owner.username,avatarSize:16,showAvatar:!1}))),b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"created")),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:this.fullTimestamp(e.createdAt)},b.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))))))}},{key:"renderMemberRow",value:function(e){var t,r=e.memberCount-1;return t=r?1===r?b.createElement("span",null,"There is ",b.createElement("b",null,"1")," member in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,r)," members in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,"no members")," in this organization"),b.createElement(dt.a,{placement:"bottomRight",title:t},b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label"},b.createElement(vt.a,{type:"team"}))),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderMemberCount(e))))}},{key:"renderNarrativeRow",value:function(e){var t,r=e.narrativeCount;return t=r?1===r?b.createElement("span",null,"There is ",b.createElement("b",null,"1")," narrative in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,r)," narratives in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,"no narratives")," in this organization"),b.createElement(dt.a,{placement:"bottomRight",title:t},b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label"},b.createElement(vt.a,{type:"file"}))),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderNarrativeCount(e))))}},{key:"renderModifiedRow",value:function(e){var t=b.createElement("span",null,"This organization was last updated"," ",b.createElement(Ft,{time:e.modifiedAt,showTooltip:!1}));return b.createElement(dt.a,{placement:"bottomRight",title:t},b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label"},b.createElement(vt.a,{type:"save"}))),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},b.createElement(Ft,{time:e.modifiedAt,showTooltip:!1}))))}},{key:"renderStatsCol",value:function(e){return b.createElement(b.Fragment,null,this.renderMemberRow(e),this.renderNarrativeRow(e),this.renderModifiedRow(e))}},{key:"renderNormal",value:function(){var e=this.props.organization;return b.createElement("div",{className:"BriefOrganization"},b.createElement("div",{className:"BriefOrganization-body"},b.createElement("div",{className:"BriefOrganization-logoCol"},this.renderLogoColumn(e)),b.createElement("div",{className:"BriefOrganization-infoCol"},b.createElement("div",{className:"BriefOrganization-infoCol-row"},b.createElement("div",{className:"BriefOrganization-infoCol-col1"},b.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},b.createElement(ct.a,{to:"/viewOrganization/".concat(e.id)},e.name)))),b.createElement("div",{className:"BriefOrganization-infoCol-row"},b.createElement("div",{className:"BriefOrganization-infoCol-col1"},this.renderInfoCol(e)),b.createElement("div",{className:"BriefOrganization-infoCol-col2"},this.renderStatsCol(e))))))}},{key:"render",value:function(){return this.renderNormal()}}]),t}(b.Component),Zt=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderAdminInfo",value:function(e){return b.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,r){var n=e.props.openRequests.get(t.id)||null;return b.createElement("div",{key:String(r),className:"simpleCard"},b.createElement(Jt,{organization:t,openRequestsStatus:n}))}):b.createElement(ot.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return b.createElement("div",{className:"Organizations"},b.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(b.Component);var Yt=Object(P.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");var t=e.views.browseOrgsView.viewModel;return{organizations:t.organizations,openRequests:t.openRequests}})(Zt),Kt=(r(241),r(82)),Xt=r(346),$t=r(353),er=r(357),tr=(r(243),function(e){function t(e,r){var n;return Object(C.a)(this,t),(n=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(D.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return b.createElement(vt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"onMenuSelection",value:function(e){}},{key:"render",value:function(){return b.createElement("div",{className:"Header"},b.createElement("div",{className:"Header-contextual"},b.createElement("div",{className:"Header-userColumn"},b.createElement("div",{className:"Header-breadcrumbs"},this.props.breadcrumbs),b.createElement("div",{className:"Header-buttons"},this.props.buttons))))}}]),t}(b.Component)),rr=r(237),nr=r(240),ar=(r(245),function(e){function t(e,r){var n;return Object(C.a)(this,t),(n=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onMenuSelection",value:function(e){}},{key:"renderMenu",value:function(){return b.createElement(rr.a,{render:function(e){e.history;var t=[];switch(e.location.pathname){case"/organizations":t=["allorgs"];break;case"/newOrganization":t=["neworg"]}return b.createElement(pt.a,{selectedKeys:t,style:{backgroundColor:"transparent"},mode:"horizontal"},b.createElement(pt.a.Item,{key:"allorgs"},b.createElement(nr.a,{to:"/organizations"},"Browse & Search")))}})}},{key:"render",value:function(){return b.createElement("div",{className:"MainMenu"},b.createElement("div",{className:"MainMenu-menu"},this.renderMenu()),b.createElement("div",{className:"MainMenu-buttons"},this.props.buttons))}}]),t}(b.Component)),ir=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).searchInput=void 0,r.searchButton=void 0,r.filterByRoleValues=void 0,r.searchInput=b.createRef(),r.searchButton=b.createRef(),r.filterByRoleValues=[{label:"Member",value:"member"},{label:"Admin",value:"admin"},{label:"Owner",value:"owner"}],r.state={searchInput:"",showInfo:!1,filterByRoleType:"myorgs",filterByRole:[],filterByPrivacy:"any",showAdvancedControls:!1},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearchOrgs([])}},{key:"onShowInfo",value:function(){mt.a.info({title:"Organizations Browser Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the organizations browser..."))})}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){switch(e){case"owner":this.props.onSortOrgs("owner",O.ASCENDING);break;case"name":this.props.onSortOrgs("name",O.ASCENDING);break;case"recentlyAdded":this.props.onSortOrgs("created",O.DESCENDING);break;case"recentlyChanged":this.props.onSortOrgs("changed",O.DESCENDING);break;case"memberCount":this.props.onSortOrgs("memberCount",O.DESCENDING);break;case"narrativeCount":this.props.onSortOrgs("narrativeCount",O.DESCENDING)}}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onFilterByRoleTypeChange",value:function(e){var t;this.setState({filterByRoleType:e.target.value}),"select"===e.target.value?(this.setState({filterByRole:[]}),t=Object(W.a)({},this.props.filter,{roleType:e.target.value})):(t=Object(W.a)({},this.props.filter,{roleType:e.target.value,roles:[]}),this.setState({filterByRole:[]})),this.props.onFilterOrgs(t)}},{key:"onFilterByRoleChange",value:function(e){var t;this.setState({filterByRole:e}),0===e.length?(this.setState({filterByRoleType:"myorgs"}),t=Object(W.a)({},this.props.filter,{roleType:"myorgs",roles:e})):(this.setState({filterByRoleType:"select"}),t=Object(W.a)({},this.props.filter,{roleType:"select",roles:e})),this.props.onFilterOrgs(t)}},{key:"onFilterByPrivacyChange",value:function(e){this.setState({filterByPrivacy:e.target.value});var t=Object(W.a)({},this.props.filter,{privacy:e.target.value});this.props.onFilterOrgs(t)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?b.createElement("span",null,"None available"):0===this.props.filteredCount?b.createElement("span",null,"\xd8 /",this.props.totalCount," ","orgs"):this.props.totalCount===this.props.filteredCount?b.createElement("span",null,b.createElement("b",null,this.props.totalCount)," ","orgs"):b.createElement("span",null,b.createElement("b",null,this.props.filteredCount),"/",this.props.totalCount," ","orgs")}},{key:"renderSearchIcon",value:function(){return this.props.searching?b.createElement(vt.a,{type:"loading"}):b.createElement(vt.a,{type:"search"})}},{key:"renderSearchForm",value:function(){return b.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},b.createElement("input",{className:"OrganizationsBrowser-searchInput",placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),b.createElement(Kt.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),b.createElement(Kt.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}))}},{key:"renderSearchBar",value:function(){return b.createElement("div",{className:"OrganizationsBrowser-searchBarRow"},b.createElement("div",{className:"OrganizationsBrowser-searchBarCol1"},this.renderSearchForm()),b.createElement("div",{className:"OrganizationsBrowser-searchBarCol2"},this.renderSearchFeedback()))}},{key:"renderHeader",value:function(){var e=b.createElement(b.Fragment,null),t=b.createElement(b.Fragment,null,b.createElement(Kt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return b.createElement(tr,{breadcrumbs:e,buttons:t})}},{key:"renderSortByControl",value:function(){return b.createElement(Xt.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,dropdownMatchSelectWidth:!0,style:{width:"10em"}},b.createElement(Xt.a.Option,{value:"recentlyChanged",key:"changed"},"Date Changed"),b.createElement(Xt.a.Option,{value:"recentlyAdded",key:"recent"},"Date Established"),b.createElement(Xt.a.Option,{value:"name",key:"name"},"Org Name"),b.createElement(Xt.a.Option,{value:"memberCount",key:"memberCount"},"# members"),b.createElement(Xt.a.Option,{value:"narrativeCount",key:"narrativeCount"},"# narratives"))}},{key:"onToggleAdvanced",value:function(){if(this.state.showAdvancedControls){this.setState({showAdvancedControls:!1});var e=this.props.filter,t=e.roleType,r=e.roles;e.privacy;["myorgs","all"].includes(t)||(t="myorgs",this.setState({filterByRoleType:"myorgs"})),this.setState({filterByRole:[],filterByPrivacy:"any"}),r=[],"any",this.props.onFilterOrgs({roleType:t,roles:r,privacy:"any"})}else this.setState({showAdvancedControls:!0})}},{key:"renderAdvancedToggle",value:function(){return this.state.showAdvancedControls?b.createElement(vt.a,{type:"ellipsis",className:"IconButton-hover-pressed",onClick:this.onToggleAdvanced.bind(this)}):b.createElement(vt.a,{type:"ellipsis",className:"IconButton-hover",onClick:this.onToggleAdvanced.bind(this)})}},{key:"renderFilterByRole",value:function(){var e={display:"block",height:"30px",lineHeight:"30px"};return this.state.showAdvancedControls?b.createElement(b.Fragment,null,b.createElement($t.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},b.createElement($t.a,{value:"myorgs",style:e},"My Orgs"),b.createElement($t.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle(),b.createElement($t.a,{value:"notmyorgs",style:e},"Not My Orgs"),b.createElement($t.a,{value:"select",style:e},"Specific Role")),b.createElement(er.a.Group,{options:this.filterByRoleValues,value:this.state.filterByRole,className:"OrganizationsBrowser-checkboxGroup",onChange:this.onFilterByRoleChange.bind(this)})):b.createElement(b.Fragment,null,b.createElement($t.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},b.createElement($t.a,{value:"myorgs",style:e},"My Orgs"),b.createElement($t.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle()))}},{key:"renderFilterByPrivacy",value:function(){if(this.state.showAdvancedControls){var e={display:"block",height:"30px",lineHeight:"30px",margin:"0px"};return b.createElement(b.Fragment,null,b.createElement($t.a.Group,{onChange:this.onFilterByPrivacyChange.bind(this),value:this.state.filterByPrivacy},b.createElement($t.a,{value:"any",style:e},"Any"),b.createElement($t.a,{value:"public",style:e},"Public"),b.createElement($t.a,{value:"private",style:e},"Private")))}}},{key:"renderOrganizations",value:function(){return this.props.error?b.createElement(ot.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):b.createElement(Yt,null)}},{key:"renderFilterColumn",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:"field-label"},"sort by"),this.renderSortByControl(),b.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"filter"),this.renderFilterByRole(),this.state.showAdvancedControls?b.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"by privacy"):null,this.renderFilterByPrivacy())}},{key:"renderMenuButtons",value:function(){return b.createElement(b.Fragment,null,b.createElement(ct.a,{to:"/newOrganization"},b.createElement(Kt.a,{icon:"plus-circle",style:{marginRight:"10px"}},"Create Organization"))," ")}},{key:"render",value:function(){return b.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},b.createElement(ar,{buttons:this.renderMenuButtons()}),this.renderSearchBar(),b.createElement("div",{className:"OrganizationsBrowser-bodyRow"},b.createElement("div",{className:"OrganizationsBrowser-bodyCol scrollable-flex-column"},this.renderOrganizations()),b.createElement("div",{className:"OrganizationsBrowser-filterCol"},this.renderFilterColumn())))}}]),t}(b.Component);function sr(e,t){return{type:F.BROWSE_ORGS_SORT_START,sortField:e,sortDirection:t}}function or(e,t,r){return{type:F.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t,openRequests:r}}function cr(e){return{type:F.BROWSE_ORGS_SEARCH_ERROR,error:e}}function lr(e){return{type:F.BROWSE_ORGS_FILTER_START,filter:e}}function ur(){return function(e,t){e({type:F.BROWSE_ORGS_LOAD_START}),e(function(e){return{type:F.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:e}}({rawOrganizations:[],organizations:[],openRequests:new Map,totalCount:0,filteredCount:0,sortField:"changed",sortDirection:O.DESCENDING,filter:{roleType:"myorgs",roles:[],privacy:"any"},searchTerms:[],selectedOrganizationId:null,searching:!1,error:null}))}}var Er=Object(P.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.openRequests,a=t.error;return{organizations:r,openRequests:n,totalCount:t.totalCount,filteredCount:t.filteredCount,filter:t.filter,error:a,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,p,O,R,h,w;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.BROWSE_ORGS_SEARCH_START}),a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,null!==i.viewModel){t.next=5;break}return r(cr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 5:return u=i.viewModel,E=u.sortField,d=u.sortDirection,v=u.filter,m=new We({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,m.queryOrgs({searchTerms:e,sortField:E,sortDirection:d,filter:v,username:c});case 10:if(p=t.sent,O=p.organizations,R=p.total,!((h=O.filter(function(e){return e.relation===Se.ADMIN||e.relation===Se.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,m.getOpenRequestsStatus({organizationIds:h});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(or(O,R,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(cr({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,this,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onSortOrgs:function(t,r){e(function(e,t){return function(){var r=Object(me.a)(ve.a.mark(function r(n,a){var i,s,o,c,l,u,E,d,v,m,p,O,R,h,w;return ve.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n(sr(e,t)),i=a(),s=i.views.browseOrgsView,o=i.auth.authorization,c=o.token,l=o.username,u=i.app.config,E=new We({token:c,username:l,groupsServiceURL:u.services.Groups.url}),null!==s.viewModel){r.next=6;break}return n(cr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),r.abrupt("return");case 6:return d=s.viewModel,v=d.searchTerms,m=d.filter,r.prev=7,r.next=10,E.queryOrgs({searchTerms:v,filter:m,username:l,sortField:e,sortDirection:t});case 10:if(p=r.sent,O=p.organizations,R=p.total,!((h=O.filter(function(e){return e.relation===Se.ADMIN||e.relation===Se.OWNER}).map(function(e){return e.id})).length>0)){r.next=20;break}return r.next=17,E.getOpenRequestsStatus({organizationIds:h});case 17:w=r.sent,r.next=21;break;case 20:w=new Map;case 21:n(or(O,R,w)),r.next=28;break;case 24:r.prev=24,r.t0=r.catch(7),console.error("Error querying orgs",r.t0.name,r.t0.message),n(cr({code:r.t0.name,message:r.t0.message}));case 28:case"end":return r.stop()}},r,this,[[7,24]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onFilterOrgs:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,p,O,R,h,w;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(lr(e)),a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new We({token:o,username:c,groupsServiceURL:l.services.Groups.url}),null!==i.viewModel){t.next=6;break}return r(cr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 6:return E=i.viewModel,d=E.searchTerms,v=E.sortField,m=E.sortDirection,t.prev=7,t.next=10,u.queryOrgs({searchTerms:d,filter:e,username:c,sortField:v,sortDirection:m});case 10:if(p=t.sent,O=p.organizations,R=p.total,!((h=O.filter(function(e){return e.relation===Se.ADMIN||e.relation===Se.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,u.getOpenRequestsStatus({organizationIds:h});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(or(O,R,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(cr({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,this,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(ir),dr=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){return b.createElement("div",null,"Fetching your orgs and other things...")}},{key:"renderError",value:function(){if(this.props.view.error)return b.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return b.createElement(Er,{sortBy:"recentlyChanged"})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var vr=Object(P.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(ur())},onUnload:function(){e({type:F.BROWSE_ORGS_UNLOAD})}}})(dr);function mr(e){return{type:F.ADD_ORG_SAVE_ERROR,error:e}}function pr(){return{type:F.ADD_ORG_EVALUATE_ERRORS}}function Or(e){return{type:F.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function Rr(e,t){return{type:F.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function hr(){return function(e,t){e({type:F.ADD_ORG_LOAD_START});var r,n={id:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Te.validateOrgId("")[1]},name:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Te.validateOrgName("")[1]},logoUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Te.validateOrgLogoUrl("")[1]},homeUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Te.validateOrgHomeUrl("")[1]},researchInterests:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Te.validateOrgResearchInterests("")[1]},description:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Te.validateOrgDescription("")[1]},isPrivate:{value:!1,remoteValue:null,syncState:i.CLEAN,validationState:{type:o.OK,validatedAt:new Date}}};e((r=n,{type:F.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(_r())}}function wr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:F.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.addOrgView.viewModel.newOrganization,o=r.app.config,c=new We({token:a,username:i,groupsServiceURL:o.services.Groups.url});s?c.addOrg(s,i).then(function(t){e(function(e){return{type:F.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",s,t),e(mr({code:t.code||t.name,message:t.message,exception:t}))}):e(mr({code:"app",message:"The new organization data does not yet exist"}))}else e(mr({code:"invalid",message:"Unexpected condition: no view model"}))}}function _r(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState.type===o.OK&&a.id.validationState.type===o.OK&&a.logoUrl.validationState.type===o.OK&&a.homeUrl.validationState.type===o.OK&&a.researchInterests.validationState.type===o.OK&&a.description.validationState.type===o.OK?e({type:F.ADD_ORG_EVALUATE_OK}):e(pr())}else e(mr({code:"invalid",message:"Unexpected condition: no view model"}))}}function gr(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new We({token:r,username:n,groupsServiceURL:a.services.Groups.url})}function Sr(e){return function(t){var r=Te.validateOrgName(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:F.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:F.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(_r())}}function fr(e){return function(t){var r,n=Te.validateOrgLogoUrl(e),a=Object(Ee.a)(n,2),i=a[0],s=a[1];s.type!==o.OK?t(function(e,t){return{type:F.ADD_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(i,s)):t((r=i,{type:F.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:r})),t(_r())}}var Ar=function(){function e(t,r){Object(C.a)(this,e),this.delay=void 0,this.fun=void 0,this.canceled=void 0,this.timer=void 0,this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(D.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),Nr=null;function Ir(e){return function(t,r){t(function(e){return{type:F.ADD_ORG_UPDATE_ID_PASS,id:e}}(e));var n=Te.validateOrgId(e),a=Object(Ee.a)(n,2),i=a[0],s=a[1];if(s.type!==o.OK)return t(Rr(i,s)),void t(_r());var c=r().views.addOrgView.viewModel;if(c){var l=c.newOrganization.id.validationState.validatedAt,u=(new Date).getTime();if(l)if(u-l.getTime()<500)return void(Nr||(Nr=new Ar(500,function(){t(function(e,t){var r=t(),n=r.views.addOrgView.viewModel;if(n){var a=n.newOrganization.id,i=Te.validateOrgId(a.value),s=Object(Ee.a)(i,2),c=s[0],l=s[1];if(l.type!==o.OK)return e(Rr(c,l)),void e(_r());var u=gr(t());u.orgExists(c).then(function(t){e(t?Rr(c,{type:o.ERROR,message:"This org id is already in use",validatedAt:new Date}):Or(c)),e(_r())})}})})));Nr&&Nr.cancel(),Nr=null,gr(r()).orgExists(i).then(function(e){t(e?Rr(i,{type:o.ERROR,validatedAt:new Date,message:"This org id is already in use"}):Or(i)),t(_r())})}}}function br(e){return function(t,r){gr(r());var n=Te.validateOrgDescription(e),a=Object(Ee.a)(n,2),i=a[0],s=a[1];s.type!==o.OK?t(function(e,t){return{type:F.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(i,s)):t(function(e){return{type:F.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(i)),t(_r())}}var Tr=r(343),yr=r(40),Mr=r(350),Cr=(r(252),r(63)),Dr=r.n(Cr),Vr=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,showError:!0},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onShowInfo",value:function(){mt.a.info({title:"New Organization Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"As a KBase user, you may create your own organizations."),b.createElement("p",null,"Once you have created an Organization, you will be the sole owner of it, forever."),b.createElement("p",null,"In order to create an Org, you need to complete the following fields."),b.createElement("dl",null,b.createElement("dt",null,"name"),b.createElement("dd",null,"The organization ",b.createElement("i",null,"name")," is whatever you wish to have your Org known as. It may be composed of any text (including unicode characters) up to 200 characters in length. You may also change it at any time."),b.createElement("dt",null,"logo"),b.createElement("dd",null,b.createElement("p",null,"Logo support has undergone a redesign, but has not yet been implemented. The new design supports direct image upload, and removes gravatar support."),b.createElement("p",null,"For now, gravatar is the only support for org logo"),b.createElement("p",null,'In order to display a custom logo for your organization, you need to associate your Organization with an avatar hosted with the Gravatar service. To do so, simply enter the email address associated with your gravatar and press the update button. This will calculate a new "gravatar hash" and associate it with your organization.')),b.createElement("dt",null,"id"),b.createElement("dd",null,b.createElement("p",null,"Your Org ",b.createElement("i",null,"id")," forms a url endpoint for your org as well as the identifier used throughout KBase to, well, identify your organization uniquely among all current and future organizations. As such, the Org ID may not be changed once created."),b.createElement("p",null,"The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also restricted to 100 characters in length.")),b.createElement("dt",null,"description"),b.createElement("dd",null,b.createElement("p",null,"Up to 4000 characters, a description allows you to express to other KBase users the purpose, history, associations, and science domain of your Org."),b.createElement("p",null,'The description is in "markdown" format, and the editor will show you a preview of the rendered description.'))))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){mt.a.confirm({title:"Leave the editor?",content:b.createElement("div",null,b.createElement("p",null,"You have entered information for this new organization."),b.createElement("p",null,"If you leave the editor without first saving, the new organization ",b.createElement("i",null,"will not be created"),"."),b.createElement("p",null,b.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===s.EDITED&&this.props.saveState===c.NEW}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===o.OK?"":e.syncState===i.DIRTY?b.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderEditor",value:function(){return b.createElement("form",{id:"newOrganizationForm",className:"NewOrganization-editor",onSubmit:this.onSubmit.bind(this)},b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{style:{flex:"1 1 0px"}},b.createElement("h3",null,"Create Your Organization"))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("h3",null,"Preview"))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},b.createElement(dt.a,{title:"This is the name for your organization as you want KBase users to see it"},"Name")),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Mr.a,{value:this.props.newOrganization.name.value||"",className:this.calcFieldClass(this.props.newOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.newOrganization.name))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-name"},this.props.newOrganization.name.value||""))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"ID"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Mr.a,{value:this.props.newOrganization.id.value||"",className:this.calcFieldClass(this.props.newOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.newOrganization.id))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-id"},b.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.newOrganization.id.value||b.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Logo URL"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Mr.a,{value:this.props.newOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.logoUrl))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-logo"},this.renderLogoPreview()))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Home Page URL"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Mr.a,{value:this.props.newOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.homeUrl))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-field-name"},b.createElement("a",{href:this.props.newOrganization.homeUrl.value||"",target:"_blank"},this.props.newOrganization.homeUrl.value||"")))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Is Private?"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(er.a,{checked:this.props.newOrganization.isPrivate.value,className:this.calcFieldClass(this.props.newOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.newOrganization.isPrivate))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.newOrganization.isPrivate.value)))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Research Interests"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Dr.a,{value:this.props.newOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.newOrganization.researchInterests)+" NewOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.newOrganization.researchInterests))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-researchInterests"},this.props.newOrganization.researchInterests.value||""))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"}),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Dr.a,{value:this.props.newOrganization.description.value||"",className:this.calcFieldClass(this.props.newOrganization.description)+" NewOrganization-control-description",autosize:{minRows:5,maxRows:15},onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.newOrganization.description))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-description",dangerouslySetInnerHTML:{__html:yr.Marked.parse(this.props.newOrganization.description.value||"")}}))))}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderLogo",value:function(e){return b.createElement(Et,{logoUrl:null,size:64,organizationName:e.name.value,organizationId:e.id.value})}},{key:"renderIsPrivate",value:function(e){return e?b.createElement("span",null,b.createElement(vt.a,{type:"lock"})," ","Private"):b.createElement("span",null,b.createElement(vt.a,{type:"global"})," ","Public")}},{key:"renderDefaultLogo",value:function(){if(!this.props.newOrganization.name.value||!this.props.newOrganization.id.value)return b.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.newOrganization.name.value,0).toUpperCase(),t=ut()(this.props.newOrganization.id.value).substr(0,6);return b.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},b.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogoPreview",value:function(){return this.props.newOrganization.logoUrl.value?b.createElement("img",{src:this.props.newOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return b.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderHeader",value:function(){var e,t=this.props.newOrganization.name.value||b.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");this.props.error&&(e=b.createElement(Kt.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}));var r=b.createElement(b.Fragment,null,b.createElement("span",null,b.createElement(vt.a,{type:"plus-circle"})," ",'Adding a New Org "',t,'"')),n=b.createElement(b.Fragment,null,b.createElement(Kt.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),b.createElement(Kt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}),e);return b.createElement(tr,{breadcrumbs:r,buttons:n})}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading New Org Editor...");return b.createElement(tr,{breadcrumbs:e})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return b.createElement("div",{key:"line_"+t},e)})),t&&(t=b.createElement("div",null,b.createElement("div",null,"trace"),t)),b.createElement(mt.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},b.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),b.createElement("div",null,this.props.error.message),t)}}},{key:"renderMenuButtons",value:function(){var e;return this.props.error&&(e=b.createElement(Kt.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)})),b.createElement(b.Fragment,null,b.createElement(Kt.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),e)}},{key:"render",value:function(){return this.state.cancelToBrowser?b.createElement(Tr.a,{push:!0,to:"/organizations"}):this.props.saveState===c.SAVED?b.createElement(Tr.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):this.props.newOrganization?b.createElement("div",{className:"NewOrganization"},b.createElement(ar,{buttons:this.renderMenuButtons()}),this.renderEditor(),this.renderError()):b.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(b.Component);var kr=Object(P.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(wr())},onUpdateName:function(t){e(Sr(t))},onUpdateLogoUrl:function(t){e(fr(t))},onUpdateId:function(t){e(Ir(t))},onUpdateDescription:function(t){e(br(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:F.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(_r())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=Te.validateOrgHomeUrl(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.ADD_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:i}):t({type:F.ADD_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a})}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=Te.validateOrgHomeUrl(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a})}}(t))}}})(Vr),Ur=(r(262),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){return b.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case R.SUCCESS:default:return b.createElement(kr,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component));var zr=Object(P.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(hr())},onUnload:function(){e({type:F.ADD_ORG_UNLOAD})}}})(Ur),jr=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.params=t}return Object(D.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n,a,i,s,o,c;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new We({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),n=new be({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(s=e.sent,(o=ye(a,this.params.username,i,s)).type!==Se.ADMIN&&o.type!==Se.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:c=e.sent,e.next=19;break;case 18:c=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:s,relation:o,groupRequests:c});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Gr(){return function(){var e=Object(me.a)(ve.a.mark(function e(t,r){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:F.DATA_SERVICE_LOAD_START}),t({type:F.DATA_SERVICE_LOAD_SUCCESS});case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}function Lr(e){return{type:F.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrative:e}}function Pr(e){return{type:F.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function xr(e){return{type:F.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e}}function Br(e){return{type:F.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function Wr(e,t,r,n,a,i,s,o,c,l,u,E){return{type:F.VIEW_ORG_LOAD_NORMAL_SUCCESS,organization:e,relation:t,openRequest:r,groupRequests:n,groupInvitations:a,requestInbox:i,requestOutbox:s,notifications:o,narrativesSortBy:c,narratives:l,sortMembersBy:u,members:E}}function qr(e,t,r){return{type:F.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,organization:e,relation:t,requestOutbox:r}}function Hr(e){return{type:F.VIEW_ORG_LOAD_ERROR,error:e}}function Fr(e){return{type:F.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function Qr(){return{type:F.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function Jr(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,p,O,R,h,w,_,g,S,f;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=a.db.notifications,l.all,l.byId,u=new jr({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),E=new be({token:s,username:o,groupsServiceURL:c.services.Groups.url}),d=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,u.getOrganizationForUser(e);case 8:if(v=t.sent,m=v.organization,p=v.relation,m.kind===Ne.NORMAL){t.next=17;break}return t.next=14,E.getRequestInboxForOrg(e);case 14:return O=t.sent,r(qr(m,p,O)),t.abrupt("return");case 17:if(p.type!==Se.OWNER&&p.type!==Se.ADMIN){t.next=29;break}return t.next=20,E.getPendingOrganizationRequestsForOrg(e);case 20:return h=t.sent,t.next=23,E.getOrganizationInvitationsForOrg(e);case 23:return w=t.sent,t.next=26,d.getOpenRequestStatus({organizationId:e});case 26:R=t.sent,t.next=32;break;case 29:h=null,w=null,R=Ie.INAPPLICABLE;case 32:return t.next=34,E.getCombinedRequestInboxForOrg(e);case 34:return _=t.sent,t.next=37,E.getRequestOutboxForOrg(e);case 37:g=t.sent,"added",S=Pe(m.narratives,{sortBy:"added",searchBy:""}),"added",f=Be(m.members,{sortBy:"added",searchBy:""}),r(Wr(m,p,R,h,w,_,g,[],"added",S,"added",f)),t.next=48;break;case 45:t.prev=45,t.t0=t.catch(5),r(Hr({code:t.t0.name,message:t.t0.message}));case 48:case"end":return t.stop()}},t,this,[[5,45]])}));return function(e,r){return t.apply(this,arguments)}}()}function Zr(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,p,O,R,h,w,_,g,S,A,N;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new jr({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),u=new be({token:s,username:o,groupsServiceURL:c.services.Groups.url}),E=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=4,d=n(),v=d.views.viewOrgView.viewModel){t.next=10;break}return r(Hr({code:"error",message:"No view model"})),t.abrupt("return");case 10:if(v.kind===f.NORMAL){t.next=13;break}return r(Hr({code:"error",message:"Wrong org view model kind!"})),t.abrupt("return");case 13:return t.next=15,l.getOrganizationForUser(e);case 15:if(m=t.sent,p=m.organization,O=m.relation,p.kind===Ne.NORMAL){t.next=24;break}return t.next=21,u.getRequestInboxForOrg(e);case 21:return R=t.sent,r(qr(p,O,R)),t.abrupt("return");case 24:if(O.type!==Se.OWNER&&O.type!==Se.ADMIN){t.next=36;break}return t.next=27,u.getPendingOrganizationRequestsForOrg(e);case 27:return w=t.sent,t.next=30,u.getOrganizationInvitationsForOrg(e);case 30:return _=t.sent,t.next=33,E.getOpenRequestStatus({organizationId:e});case 33:h=t.sent,t.next=39;break;case 36:w=null,_=null,h=Ie.INAPPLICABLE;case 39:return t.next=41,u.getCombinedRequestInboxForOrg(e);case 41:return g=t.sent,t.next=44,u.getRequestOutboxForOrg(e);case 44:S=t.sent,"added",A=Pe(p.narratives,{sortBy:v.sortNarrativesBy,searchBy:v.searchNarrativesBy}),"added",N=Be(p.members,{sortBy:v.sortMembersBy,searchBy:v.searchMembersBy}),r(Wr(p,O,h,w,_,g,S,[],"added",A,"added",N)),t.next=55;break;case 52:t.prev=52,t.t0=t.catch(4),r(Hr({code:t.t0.name,message:t.t0.message}));case 55:case"end":return t.stop()}},t,this,[[4,52]])}));return function(e,r){return t.apply(this,arguments)}}()}function Yr(){return function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,i,s,o,c,l,u;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r()).views.viewOrgView.viewModel){e.next=4;break}return t(Fr({type:a.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=n.auth.authorization,s=i.token,o=i.username,c=n.app.config,l=n.views.viewOrgView.viewModel.organization,u=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),e.prev=6,e.next=9,u.requestMembership(l.id);case 9:t({type:F.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(Jr(l.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(Fr({type:a.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,this,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function Kr(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var i,s,o,c,l,u,E;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_JOIN_REQUEST_START}),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Fr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new be({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.cancelRequest(e);case 10:E=t.sent,r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:a.ERROR,message:t.t0.message},{type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function Xr(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var i,s,o,c,l,u,E;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Qr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Fr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new be({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.acceptJoinInvitation(e);case 10:E=t.sent,r({type:F.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:F.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function $r(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var i,s,o,c,l,u,E;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Qr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Fr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new be({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.rejectJoinInvitation(e);case 10:E=t.sent,r({type:F.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:F.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function en(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===f.NORMAL){t.next=8;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_START}),s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new be({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.acceptRequest(e);case 14:return t.next=16,u.getCombinedRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}var tn,rn,nn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,{code:"feeds-exception",message:e.message,detail:e.message,info:new Map}))).originalError=void 0,r.name="FeedsException",r.originalError=e,r}return Object(U.a)(t,e),t}(Q),an=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(U.a)(t,e),t}(Q),sn=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.params=t}return Object(D.a)(e,[{key:"put",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.abrupt("return",fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new nn(e)});case"text/plain":return e.text().then(function(e){throw new an(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new nn(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new an(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"postWithResult",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new nn(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new an(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s,o;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.from(r.entries()).map(function(e){var t=Object(Ee.a)(e,2),r=t[0],n=t[1];return[r,encodeURIComponent(n)].join("=")}).join("&"),a=this.baseURLPath().concat(t).join("/")+"?"+n,e.next=4,fetch(a,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 4:if(500!==(i=e.sent).status){e.next=20;break}e.t0=i.headers.get("Content-Type"),e.next="application/json"===e.t0?9:"text/plain"===e.t0?13:17;break;case 9:return e.next=11,i.json();case 11:throw s=e.sent,new nn(s);case 13:return e.next=15,i.text();case 15:throw o=e.sent,new an(o);case 17:throw new Error("Unexpected content type: "+i.headers.get("Content-Type"));case 18:e.next=27;break;case 20:if(200!==i.status){e.next=26;break}return e.next=23,i.json();case 23:return e.abrupt("return",e.sent);case 26:throw new Error("Unexpected response: "+i.status+" : "+i.statusText);case 27:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"baseURLPath",value:function(){return[this.params.url,"api","V1"]}},{key:"getNotifications",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.count,(n=new Map).set("n",String(r)),e.next=5,this.get(["notifications"],n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"seeNotifications",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postWithResult(["notifications","see"],t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function on(e){switch(e){case"alert":return tn.ALERT;case"error":return tn.ERROR;case"warning":return tn.WARNING;case"request":return tn.REQUEST;default:throw new Error("Invalid level value: "+e)}}function cn(e){var t=e.target[0];switch(e.verb){case"requested":switch(t.type){case"user":return rn.JOIN_REQUEST;case"narrative":case"workspace":return rn.NARRATIVE_ASSOCIATION_REQUEST;case"app":return rn.APP_ASSOCIATION_REQUEST}case"updated":switch(t.type){case"narrative":case"workspace":return rn.NARRATIVE_ASSOCIATED}case"accepted":switch(t.type){case"narrative":case"workspace":return rn.NARRATIVE_ACCEPTED;case"user":return rn.USER_ACCEPTED}case"invited":switch(t.type){case"user":return rn.JOIN_INVITATION}default:return console.warn("unknown",e),rn.UNKNOWN}return rn.UNKNOWN}!function(e){e[e.ALERT=0]="ALERT",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.REQUEST=3]="REQUEST"}(tn||(tn={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JOIN_REQUEST=1]="JOIN_REQUEST",e[e.JOIN_INVITATION=2]="JOIN_INVITATION",e[e.USER_JOINED=3]="USER_JOINED",e[e.USER_ACCEPTED=4]="USER_ACCEPTED",e[e.NARRATIVE_ASSOCIATION_REQUEST=5]="NARRATIVE_ASSOCIATION_REQUEST",e[e.NARRATIVE_ASSOCIATED=6]="NARRATIVE_ASSOCIATED",e[e.NARRATIVE_ACCEPTED=7]="NARRATIVE_ACCEPTED",e[e.APP_ASSOCIATION_REQUEST=8]="APP_ASSOCIATION_REQUEST",e[e.APP_ASSOCIATED=9]="APP_ASSOCIATED",e[e.MESSAGE=10]="MESSAGE"}(rn||(rn={}));var ln=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.feedsClient=void 0,this.params=t,this.feedsClient=new sn({token:this.params.token,url:this.params.feedsServiceURL})}return Object(D.a)(e,[{key:"getNotifications",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,e.abrupt("return",t.user.feed.map(function(e){var t=e.id,r=e.actor,n=e.verb,a=e.object,i=e.target,s=e.source,o=e.level,c=e.seen,l=e.created,u=e.expires,E=e.external_key,d=e.context;return{id:t,actor:r,verb:n,object:a,target:i,source:s,level:on(o),seen:c,createdAt:new Date(l),expiresAt:new Date(u),externalKey:E,context:d}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationNotifications",value:function(){var e=Object(me.a)(ve.a.mark(function e(){var t,r=this;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,e.abrupt("return",t.user.feed.filter(function(e){var t=e.actor;return"groupsservice"===e.source&&t.id!==r.params.username}).map(function(e){return{id:e.id,from:e.actor.id,createdAt:new Date(e.created),expiresAt:new Date(e.expires),level:on(e.level),read:e.seen,organizationId:e.object.id,type:cn(e),regarding:e.target}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"seeNotification",value:function(){var e=Object(me.a)(ve.a.mark(function e(t){var r,n;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.seeNotifications({note_ids:[t]});case 2:return r=e.sent,n=r.seen_notes,r.unauthorized_notes,e.abrupt("return",n[0]);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();r(264);var un,En=r(347),dn=r(338);r(266);function vn(e){switch(e){case un.COMPACT:return un.NORMAL;case un.NORMAL:return un.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(un||(un={}));var mn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:un.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:vn(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case fe.OWNER:return b.createElement("span",null,b.createElement(vt.a,{type:"crown"})," owner");case fe.ADMIN:return b.createElement("span",null,b.createElement(vt.a,{type:"unlock"})," admin");case fe.MEMBER:return b.createElement("span",null,b.createElement(vt.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){var e=b.createElement("div",null,this.props.member.username);return b.createElement("div",{className:"Member View-COMPACT"},b.createElement("div",{className:"Member-controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===un.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===un.NORMAL?"up":"down")}))),b.createElement("div",{className:"Member-avatarCol"},b.createElement(wt,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"Member-infoCol"},b.createElement("div",{className:"Member-name"},b.createElement(dt.a,{placement:"bottomRight",title:e},b.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),b.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",b.createElement(Ft,{time:this.props.member.joinedAt})),b.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title)))}},{key:"renderNormal",value:function(){var e=b.createElement("div",null,this.props.member.username);return b.createElement("div",{className:"Member View-NORMAL"},b.createElement("div",{className:"Member-controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===un.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===un.NORMAL?"up":"down")}))),b.createElement("div",{className:"Member-avatarCol"},b.createElement(wt,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"Member-infoCol"},b.createElement("div",{className:"Member-name"},b.createElement(dt.a,{placement:"bottomRight",title:e},b.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),b.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",b.createElement(Ft,{time:this.props.member.joinedAt})),b.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title),b.createElement("div",{className:"Member-organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"Member-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case un.COMPACT:return this.renderCompact();case un.NORMAL:return this.renderNormal()}}}]),t}(b.Component),pn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(mn,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(b.Component);var On,Rn=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(xt(t))}}})(pn),hn=r(352);r(268);!function(e){e[e.NONE=0]="NONE",e[e.MANAGE_MEMBERSHIP=1]="MANAGE_MEMBERSHIP",e[e.VIEW_MEMBERS=2]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=3]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=4]="VIEW_ORGANIZATION",e[e.EDIT_ORGANIZATION=5]="EDIT_ORGANIZATION",e[e.INVITE_USER=6]="INVITE_USER"}(On||(On={}));var wn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).relation=void 0,r.state={navigateTo:On.NONE},r.relation=r.getUserRelation(),r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"getUserRelation",value:function(){var e=this.props.currentUsername,t=this.props.organization;if(e===t.owner.username)return{type:Se.OWNER};var r=t.members.find(function(t){return t.username===e});if(!r)return this.props.pendingJoinRequest&&this.props.pendingJoinRequest.user===e?{type:Se.MEMBER_REQUEST_PENDING,requestId:this.props.pendingJoinRequest.id}:this.props.pendingJoinInvitation&&this.props.pendingJoinInvitation.user===e?{type:Se.MEMBER_INVITATION_PENDING,requestId:this.props.pendingJoinInvitation.id}:{type:Se.VIEW};switch(r.type){case l.MEMBER:return{type:Se.MEMBER};case l.ADMIN:return{type:Se.ADMIN};case l.OWNER:return{type:Se.OWNER};default:return{type:Se.NONE}}}},{key:"onJoinClick",value:function(){this.props.onJoinOrg(),hn.a.success("Join request has been submitted")}},{key:"onCancelJoinRequest",value:function(){var e=this.relation;this.props.onCancelJoinRequest(e.requestId),hn.a.success("Submitted cancellation request")}},{key:"onAcceptInvitation",value:function(){var e=this.relation;this.props.onAcceptInvitation(e.requestId),hn.a.success("Invitation acceptance has been sent")}},{key:"onRejectInvitation",value:function(){var e=this.relation;this.props.onRejectInvitation(e.requestId),hn.a.success("Invitation rejection has been sent")}},{key:"onNavigateToMembership",value:function(){this.setState({navigateTo:On.MANAGE_MEMBERSHIP})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:On.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:On.MANAGE_REQUESTS})}},{key:"onNavigateToEditOrganization",value:function(){this.setState({navigateTo:On.EDIT_ORGANIZATION})}},{key:"onNavigateToInviteUser",value:function(){this.setState({navigateTo:On.INVITE_USER})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:On.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({navigateTo:On.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:On.VIEW_MEMBERS});break;case"editOrg":this.setState({navigateTo:On.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({navigateTo:On.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:On.MANAGE_REQUESTS})}}},{key:"renderLogo",value:function(e){return b.createElement(Et,{logoUrl:e.logoUrl,size:80,organizationName:e.name,organizationId:e.id})}},{key:"renderRelation",value:function(){this.props.organization;switch(this.relation.type){case Se.NONE:return b.createElement("span",null,b.createElement(vt.a,{type:"stop"}),"None");case Se.VIEW:return b.createElement("div",null,b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it, you may request membership"},b.createElement("div",{style:{textAlign:"center"}},b.createElement(vt.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization")),b.createElement("div",{style:{textAlign:"center"}},b.createElement(Kt.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization")));case Se.MEMBER_REQUEST_PENDING:return b.createElement("div",null,b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have requested membership in this Organization"},"   ",b.createElement("div",{style:{textAlign:"center"}},b.createElement("span",null,b.createElement(vt.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",b.createElement("b",null,"request")," is pending"," ",b.createElement(vt.a,{type:"question-circle"})))),b.createElement("div",{style:{textAlign:"center"}},b.createElement(Kt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case Se.MEMBER_INVITATION_PENDING:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this Organization"},b.createElement("div",{style:{textAlign:"center"}},b.createElement("div",null,b.createElement(vt.a,{type:"user",style:{color:"blue"}}),"You have been ",b.createElement("b",null,"invited")," to join this Organization"),b.createElement("div",null,b.createElement(Kt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept"),b.createElement(Kt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject"))));case Se.MEMBER:var e=b.createElement(pt.a,{onClick:this.onMenuClick.bind(this)},b.createElement(pt.a.Item,{key:"manageMyMembership"},"Manage My Membership"));return b.createElement("div",{className:"relationRow"},b.createElement("div",{className:"relationLabel"},b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},b.createElement("div",null,b.createElement(vt.a,{type:"user"}),"You are a ",b.createElement("b",null,"member")," of this Organization"))),b.createElement("div",{className:"relationMenu"},b.createElement("div",null,b.createElement(Ot.a,{overlay:e,trigger:["click"]},b.createElement(Kt.a,{shape:"circle"},b.createElement(vt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case Se.ADMIN:var t=b.createElement(pt.a,{onClick:this.onMenuClick.bind(this)},b.createElement(pt.a.Item,{key:"manageMyMembership"},"Manage My Membership"),b.createElement(pt.a.Item,{key:"editOrg"},"Edit this Org"),b.createElement(pt.a.Item,{key:"inviteUser"},"Invite User"));return b.createElement("div",{className:"relationRow"},b.createElement("div",{className:"relationLabel"},b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an Administrator for this organization"},b.createElement("div",null,b.createElement(vt.a,{type:"unlock"}),"You are a ",b.createElement("b",null,"administrator")," of this Organization"))),b.createElement("div",{className:"relationMenu"},b.createElement("div",null,b.createElement(Ot.a,{overlay:t,trigger:["click"]},b.createElement(Kt.a,{shape:"circle"},b.createElement(vt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case Se.OWNER:var r=b.createElement(pt.a,{onClick:this.onMenuClick.bind(this)},b.createElement(pt.a.Item,{key:"editOrg"},"Edit this Org"),b.createElement(pt.a.Item,{key:"inviteUser"},"Invite User"));return b.createElement("div",{className:"relationRow"},b.createElement("div",{className:"relationLabel"},b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this organization"},b.createElement("div",null,b.createElement(vt.a,{type:"crown",style:{color:"gold"}})," ","You ",b.createElement("b",null,"own")," this Organization"))),b.createElement("div",{className:"relationMenu"},b.createElement("div",null,b.createElement(Ot.a,{overlay:r,trigger:["click"]},b.createElement(Kt.a,{shape:"circle"},b.createElement(vt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))))}}},{key:"renderHomeUrl",value:function(e){if(e.homeUrl)return b.createElement("div",{className:"homeUrl"},b.createElement("a",{href:e.homeUrl,target:"_blank"},b.createElement(vt.a,{type:"home"})," ",e.homeUrl))}},{key:"renderOrgInfo",value:function(){var e=this.props.organization;return b.createElement(b.Fragment,null,b.createElement("div",{className:"name"},e.name),b.createElement("div",null,b.createElement("div",{style:{display:"inline-block",width:"50%",verticalAlign:"top"}},b.createElement("div",null,this.renderHomeUrl(e)),b.createElement("div",{className:"owner"},b.createElement(qt,{username:e.owner.username,avatarSize:20,showAvatar:!0}))),b.createElement("div",{style:{display:"inline-block",width:"50%",verticalAlign:"top"}},b.createElement("div",null,b.createElement("span",{className:"field-label"},"established"),b.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("div",null,b.createElement("span",{className:"field-label"},"last modified"),b.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.modifiedAt))))))}},{key:"getRelationClass",value:function(e){switch(this.relation.type){case Se.NONE:return"relationRequest";case Se.VIEW:return"relationRequest relationNonMember";case Se.MEMBER_REQUEST_PENDING:return"relationRequest relationRequestPending";case Se.MEMBER_INVITATION_PENDING:return"relationRequest relationInvitationPending";case Se.MEMBER:return"relationRequest relationMember";case Se.ADMIN:return"relationRequest relationAdmin";case Se.OWNER:return"relationRequest relationOwner"}}},{key:"render",value:function(){switch(this.state.navigateTo){case On.MANAGE_MEMBERSHIP:return b.createElement(Tr.a,{push:!0,to:"/membership/"+this.props.organization.id});case On.VIEW_MEMBERS:return b.createElement(Tr.a,{push:!0,to:"/viewMembers/"+this.props.organization.id});case On.EDIT_ORGANIZATION:return b.createElement(Tr.a,{push:!0,to:"/editOrganization/"+this.props.organization.id});case On.MANAGE_REQUESTS:return b.createElement(Tr.a,{push:!0,to:"/manageOrganizationRequests/"+this.props.organization.id});case On.INVITE_USER:return b.createElement(Tr.a,{push:!0,to:"/inviteUser/"+this.props.organization.id});case On.VIEW_ORGANIZATION:return b.createElement(Tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id})}return b.createElement("div",{className:"OrganizationHeader"},b.createElement("div",{className:"avatar"},this.renderLogo(this.props.organization)),b.createElement("div",{className:"orgInfo"},this.renderOrgInfo()),b.createElement("div",{className:"yourRelation "+this.getRelationClass(this.props.organization)},this.renderRelation()))}}]),t}(b.Component);var _n=Object(P.b)(function(e,t){var r=e.views.organizationCentricView.viewModel,n=e.auth.authorization.username;if(!r)throw new Error("View model is unexpectedly missing");return{organization:r.organization,pendingJoinRequest:r.pendingJoinRequest,pendingJoinInvitation:r.pendingJoinInvitation,currentUsername:n}},function(e){return{onJoinOrg:function(){e(Yr())},onCancelJoinRequest:function(t){e(Kr(t))},onAcceptInvitation:function(t){e(Xr(t))},onRejectInvitation:function(t){e($r(t))}}})(wn);function gn(e){var t=e.organization,r=e.pendingJoinRequest,n=e.pendingJoinInvitation,a=e.relation;return{type:F.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,organization:t,pendingJoinRequest:r,pendingJoinInvitation:n,relation:a}}function Sn(e){return{type:F.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,error:e}}var fn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){return b.createElement("div",null,"Loading header...")}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return b.createElement(_n,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var An=Object(P.b)(function(e,t){return{view:e.views.organizationCentricView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.ORGANIZATION_CENTRIC_VIEW_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),u=new be({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,l.getOrg(e);case 7:if((E=t.sent).kind===Ne.NORMAL){t.next=11;break}return r(Sn({code:"invalid state",message:'Organization must be of kind "NORMAL"'})),t.abrupt("return");case 11:return t.next=13,u.getUserRequestForOrg(e);case 13:return d=t.sent,t.next=16,u.getUserInvitationForOrg(e);case 16:v=t.sent,m=ye(E,o,d,v),r(gn({organization:E,relation:m,pendingJoinRequest:d,pendingJoinInvitation:v})),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(4),r(Sn({code:t.t0.name,message:t.t0.message}));case 24:case"end":return t.stop()}},t,this,[[4,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:F.ORGANIZATION_CENTRIC_VIEW_UNLOAD})}}})(fn),Nn=r(354),In=(r(270),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){var e=b.createElement("div",null,b.createElement("div",null,this.props.user.realname),b.createElement("div",null,b.createElement("span",null,b.createElement(wt,{user:this.props.user,size:20}))," ",b.createElement("span",null,this.props.user.username)));return b.createElement("div",{className:"UserSimple"},b.createElement(dt.a,{title:e,placement:"bottomRight"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))}}]),t}(b.Component)),bn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(In,{user:this.props.user,avatarSize:this.props.avatarSize}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(b.Component);var Tn,yn=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(xt(t))}}})(bn);r(272);function Mn(e){switch(e){case Tn.COMPACT:return Tn.NORMAL;case Tn.NORMAL:return Tn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Tn||(Tn={}));var Cn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:Tn.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Mn(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement(dt.a,{title:"This narrative is viewable by all KBase users",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(vt.a,{type:"global"})," Public Narrative")):b.createElement(dt.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(vt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t,r;switch(e.access){case kt.VIEW:t="eye",r=b.createElement("span",null,"View-Only (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case kt.EDIT:t="edit",r=b.createElement("span",null,"This narrative is shared with you with ",b.createElement("b",null,"edit")," access (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case kt.ADMIN:t="unlock",r=b.createElement("span",null,"This narrative is shared with you with ",b.createElement("b",null,"access")," - you may edit and re-share this");break;case kt.OWNER:t="crown",r=b.createElement("span",null,"You are the owner of this Narrative")}return b.createElement(dt.a,{placement:"bottomRight",title:r},b.createElement(vt.a,{type:t}))}},{key:"renderGlobalPermission",value:function(e){var t,r;return e.isPublic?(t="global",r="This narrative has been shared publicly - with all KBase users"):(t="lock",r="This narrative is private - only accessible to the owner any users it has been shared with"),b.createElement(dt.a,{placement:"bottomRight",title:r},b.createElement(vt.a,{type:t}))}},{key:"renderNiceElapsed",value:function(e){var t=b.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e));return b.createElement(dt.a,{placement:"bottomRight",title:t},Ht(e))}},{key:"renderCompact",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Tn.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===Tn.NORMAL?"up":"down")}))),b.createElement("div",{className:"mainCol"},b.createElement("div",null,b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",b.createElement("div",{className:"Narrative-owner"},b.createElement(yn,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),b.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),b.createElement("div",null,b.createElement("span",{className:"field-label"},"updated"),b.createElement(Ft,{time:e.lastSavedAt}))))}},{key:"renderNormal",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Tn.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===Tn.NORMAL?"up":"down")}))),b.createElement("div",{className:"mainCol"},b.createElement("div",null,b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",b.createElement("div",{className:"Narrative-owner"},b.createElement(yn,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),b.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),b.createElement("div",null,b.createElement("span",{className:"field-label"},"last saved"),this.renderNiceElapsed(e.lastSavedAt)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"by"),b.createElement(yn,{avatarSize:20,userId:e.lastSavedBy}))))}},{key:"renderNarrative",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"mainCol"},b.createElement("div",null,b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",b.createElement("div",{className:"Narrative-owner"},b.createElement(yn,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),b.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),b.createElement("div",null,b.createElement("span",{className:"field-label"},b.createElement(vt.a,{type:"save"})),b.createElement(Ft,{time:e.lastSavedAt,tooltipPrefix:"last saved "}))))}},{key:"render",value:function(){var e=this.props.narrative;return e.access===kt.NONE?b.createElement("div",null,"You don't have access to this Narrative"):this.renderNarrative(e)}}]),t}(b.Component),Dn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.narrative?b.createElement(Cn,{narrative:this.props.narrative}):b.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(b.Component);var Vn=Object(P.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Bt(t))}}})(Dn),kn=(r(274),function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case Ae.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=b.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you may obtain personal View-Only access by clicking this button",r=b.createElement(Kt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=b.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=b.createElement(Kt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access"));break;case Ae.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=b.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=b.createElement(Kt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case Ae.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=b.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=b.createElement(Kt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case Ae.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=b.createElement("span",null,"Admin");break;case Ae.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=b.createElement("span",null,"Owner");break;default:t=b.createElement("span",null,"Unknown")}return b.createElement(b.Fragment,null,b.createElement(dt.a,{title:n,placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement("span",{className:"field-label"},"your permission"),t))," ",b.createElement(dt.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement(dt.a,{title:"This narrative is viewable by all KBase users",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(vt.a,{type:"global"})," Public Narrative")):b.createElement(dt.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(vt.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return this.props.organization.isMember?e.permission===Ae.NONE?b.createElement(b.Fragment,null,b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},b.createElement("div",{className:"title"},e.title)),b.createElement("div",null,this.renderNarrativePermission(e))):b.createElement(Vn,{workspaceId:e.workspaceId}):b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},b.createElement("div",{className:"title"},e.title))}},{key:"renderResource",value:function(){return b.createElement("div",null,b.createElement("div",null,b.createElement("span",{className:"field-label"},"added"),b.createElement("span",null,b.createElement(Ft,{time:this.props.narrative.createdAt}))))}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=b.createElement(Nn.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),b.createElement("div",{className:"OrganizationNarrative"},b.createElement("div",{className:"OrganizationNarrative-narrativeCol"},this.renderNarrative()),e)}}]),t}(b.Component)),Un=r(43),zn=r.n(Un);function jn(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,s=e.info;return{code:t,message:r,detail:n,id:zn()(),at:new Date,history:a,trace:i,info:s}}function Gn(e){return function(t,r){t({type:F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new We({token:i,username:s,groupsServiceURL:o.services.Groups.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function Ln(e){return function(t,r){t({type:F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new We({token:i,username:s,groupsServiceURL:o.services.Groups.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function Pn(e){return function(t,r){t({type:F.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new We({token:i,username:s,groupsServiceURL:o.services.Groups.url}).removeMember(c.organization.id,e).then(function(){t(Zr(c.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:F.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(278);var xn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={confirmMemberRemoval:null},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onConfirmRemoveMember",value:function(e){this.setState({confirmMemberRemoval:{member:e}})}},{key:"renderConfirmMemberRemoval",value:function(){var e=this;if(this.state.confirmMemberRemoval){var t=this.state.confirmMemberRemoval.member,r=b.createElement(b.Fragment,null,b.createElement("p",null,"Please confirm removal of this member from this organization."),b.createElement("div",{className:"simpleCard",style:{marginBottom:"1em"}},b.createElement(Rn,{member:t,avatarSize:20})),b.createElement("p",null,"This user as well as members of this organization will receive a notification of the removal."),b.createElement("p",null,"Any Narratives associated by this member with this Organization will be unaffected. This member will also retain any Narrative permissions granted through this Organization."));return b.createElement(mt.a,{title:"Confirm Removal of Member",width:"50em",visible:!0,onOk:function(){e.props.onRemoveMember(t.username),e.setState({confirmMemberRemoval:null})},onCancel:function(){e.setState({confirmMemberRemoval:null})},okText:"Confirm"},r)}}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.onConfirmRemoveMember(t)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=b.createElement(pt.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},b.createElement(pt.a.Item,{key:"promoteToAdmin"},b.createElement(vt.a,{type:"unlock"}),"Promote to Admin"),b.createElement(pt.a.Item,{key:"removeMember"},b.createElement(vt.a,{type:"delete"}),"Remove Member"));return b.createElement("div",null,b.createElement(Ot.a,{overlay:r,trigger:["click"]},b.createElement(vt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=b.createElement(pt.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},b.createElement(pt.a.Item,{key:"demoteToMember"},b.createElement(vt.a,{type:"user"}),"Demote to Member"));return b.createElement("div",null,b.createElement(Ot.a,{overlay:r,trigger:["click"]},b.createElement(vt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderOwnerMenu",value:function(e){return b.createElement("div",null)}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===Se.OWNER||this.props.relation.type===Se.ADMIN)switch(e.type){case fe.OWNER:return this.renderOwnerMenu(e);case fe.ADMIN:return this.renderAdminMenu(e);case fe.MEMBER:return this.renderMemberMenu(e)}}},{key:"renderMembers",value:function(){var e,t=this,r=b.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No members");return e=0===this.props.members.length?b.createElement(ot.a,{type:"info",message:r}):this.props.members.map(function(e){var r=["Members-row","simpleCard"];return null!==t.props.organization.lastVisitedAt&&t.props.organization.lastVisitedAt.getTime()<e.joinedAt.getTime()&&r.push("Members-newMember"),b.createElement("div",{className:r.join(" "),key:e.username},b.createElement("div",{className:"Members-member"},b.createElement(Rn,{member:e,avatarSize:50})),b.createElement("div",{className:"Members-menu"},t.renderMemberOptions(e)))}),b.createElement("div",{className:"infoTable"},e)}},{key:"renderSearchBar",value:function(){var e=this;return b.createElement("div",{style:{paddingRight:"6px"}},b.createElement(Mr.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter members by name",onChange:function(t){e.props.onSearchMembers(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return b.createElement(b.Fragment,null,b.createElement("span",{className:"field-label"},"sort"),b.createElement(Xt.a,{onChange:function(t){e.props.onSortMembers(t)},style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortMembersBy},b.createElement(Xt.a.Option,{value:"name",key:"name"},"Name"),b.createElement(Xt.a.Option,{value:"added",key:"added"},"Date Joined")))}},{key:"renderHeader",value:function(){return b.createElement("div",{className:"ViewOrganizationMembers-headerRow"},b.createElement("div",{className:"ViewOrganizationMembers-searchCol"},this.renderSearchBar()),b.createElement("div",{className:"ViewOrganizationMembers-sortCol"},this.renderSortBar()))}},{key:"render",value:function(){var e;return this.state.confirmMemberRemoval&&(e=this.renderConfirmMemberRemoval()),b.createElement(b.Fragment,null,b.createElement("div",{className:"ViewOrganizationMembers scrollable-flex-column"},b.createElement("div",{className:"ViewOrganizationMembers-header"},this.renderHeader()),b.createElement("div",{className:"ViewOrganizationMembers-body scrollable-flex-column"},this.renderMembers())),e)}}]),t}(b.Component);var Bn=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onViewMembersUnload:function(){e({type:F.VIEW_ORG_VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(Gn(t))},onDemoteAdminToMember:function(t){e(Ln(t))},onRemoveMember:function(t){e(Pn(t))},onSearchMembers:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===f.NORMAL){var a=Be(n.organization.members,{sortBy:n.sortMembersBy,searchBy:e});t({type:F.VIEW_ORG_SEARCH_MEMBERS_SUCCESS,searchBy:e,members:a})}else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:jn({code:"error",message:"Wrong org view model kind!"})});else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:jn({code:"error",message:"No view model"})})}}(t))},onSortMembers:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(null!==n)if(n.kind===f.NORMAL){var a=n.organization.members,i=n.searchMembersBy,s=Be(a,{sortBy:e,searchBy:i});t({type:F.VIEW_ORG_SORT_MEMBERS_SUCCESS,members:s,sortBy:e})}else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:jn({code:"error",message:"Wrong org view model kind!"})});else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:jn({code:"error",message:"No view model"})})}}(t))}}})(xn);function Wn(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===f.NORMAL){t.next=8;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:F.VIEW_ORG_REJECT_INBOX_REQUEST_START}),s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new be({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.denyRequest(e);case 14:return t.next=16,u.getRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:F.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:F.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}function qn(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_START}),a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=6;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 6:if(i.kind===f.NORMAL){t.next=9;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 9:return s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new be({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.cancelRequest(e);case 14:return t.next=16,u.getRequestOutboxForOrg(i.organization.id);case 16:E=t.sent,r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:jn({code:"error",message:t.t0.message})});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}var Hn;r(280),r(282);function Fn(e){switch(e){case Hn.COMPACT:return Hn.NORMAL;case Hn.NORMAL:return Hn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Hn||(Hn={}));var Qn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:Hn.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Fn(this.state.view)})}},{key:"renderCompact",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Hn.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===Hn.NORMAL?"up":"down")}))),b.createElement("div",{className:"avatarCol"},b.createElement(wt,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"infoCol"},b.createElement("div",{className:"name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),b.createElement("div",null,this.props.user.username)))}},{key:"renderNormal",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Hn.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===Hn.NORMAL?"up":"down")}))),b.createElement("div",{className:"avatarCol"},b.createElement(wt,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"infoCol"},b.createElement("div",{className:"name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),b.createElement("div",null,this.props.user.username),b.createElement("div",{className:"organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case Hn.COMPACT:return b.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case Hn.NORMAL:return b.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(b.Component),Jn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(Qn,{user:this.props.user,avatarSize:this.props.avatarSize}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(b.Component);var Zn,Yn=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(xt(t))}}})(Jn);r(284);function Kn(e){switch(e){case Zn.COMPACT:return Zn.NORMAL;case Zn.NORMAL:return Zn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Zn||(Zn={}));var Xn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:Zn.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Kn(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement(dt.a,{title:"This narrative is viewable by all KBase users",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(vt.a,{type:"global"})," Public Narrative")):b.createElement(dt.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(vt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case kt.VIEW:t=b.createElement("span",null,"View-Only (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case kt.EDIT:t=b.createElement("span",null,"Edit (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case kt.ADMIN:t="Admin";break;case kt.OWNER:t="Owner";break;default:t="Unknown"}return b.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Zn.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===Zn.NORMAL?"up":"down")}))),b.createElement("div",{className:"iconCol"},b.createElement(vt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),b.createElement("div",{className:"mainCol"},b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",b.createElement("div",{className:"Narrative-owner"},b.createElement(Yn,{avatarSize:20,userId:e.owner}))))}},{key:"renderNormal",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Zn.NORMAL?"pressed":"")},b.createElement(vt.a,{type:"".concat(this.state.view===Zn.NORMAL?"up":"down")}))),b.createElement("div",{className:"iconCol"},b.createElement(vt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),b.createElement("div",{className:"mainCol"},b.createElement("div",{className:"mainCol"},b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",b.createElement("div",{className:"Narrative-owner"},b.createElement(Yn,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},b.createElement(vt.a,{type:"crown"})),b.createElement("div",{className:"Narrative-global"},b.createElement(vt.a,{type:"global"}))),b.createElement("div",null,this.renderPublicPermission(e)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===kt.NONE)return b.createElement("div",null,b.createElement(vt.a,{type:"exclamation-circle",style:{color:"orange"}})," ","You don't have access to this Narrative");switch(this.state.view){case Zn.COMPACT:return b.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case Zn.NORMAL:return b.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(b.Component),$n=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.narrative?b.createElement(Xn,{narrative:this.props.narrative}):b.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(b.Component);var ea=Object(P.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Bt(t))}}})($n),ta=(r(286),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onAcceptRequest",value:function(){this.props.onAcceptInboxRequest(this.props.request)}},{key:"onRejectRequest",value:function(){this.props.onRejectInboxRequest(this.props.request)}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.APP:return"SHOW APP";case Oe.USER:return"";case Oe.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(ea,{workspaceId:parseInt(e.narrativeId,10)})))}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(Yn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return b.createElement(Yn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.APP:return"REQUEST to associate App";case Oe.USER:return"REQUEST to join Organization";case Oe.WORKSPACE:return"REQUEST to associate Narrative"}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.APP:return"SHOW APP";case Oe.USER:return"";case Oe.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(ea,{workspaceId:parseInt(e.narrativeId,10)})),b.createElement("div",{className:"cardSectionHeader"},"with organization"))}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),b.createElement("div",{className:"cardSectionHeader"},"from"),b.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),b.createElement("div",{className:"miniDetail"},b.createElement(ea,{workspaceId:parseInt(e.narrativeId,10)})),b.createElement("div",{className:"cardSectionHeader"},"from"),b.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return b.createElement("div",{style:{textAlign:"center"}},b.createElement(Kt.a.Group,{style:{marginTop:"4px"}},b.createElement(Kt.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},b.createElement(vt.a,{type:"check"}),"Accept"),b.createElement(Kt.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},b.createElement(vt.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),b.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),b.createElement("div",{className:"cardSectionHeader"},"from"),b.createElement(Yn,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.USER:return this.renderJoinRequest(e);case Oe.WORKSPACE:return this.renderWorkspaceRequest(e);case Oe.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"apps not supported yet"))}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return this.renderUserInvitation(e);case Oe.WORKSPACE:case Oe.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return b.createElement("div",{key:e.id,className:"InboxRequest kbCard"},b.createElement("div",{className:"kbCard-header"},b.createElement("div",{className:"InboxRequest-requestHeaderRow"},b.createElement("div",{className:"InboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),b.createElement("div",{className:"InboxRequest-requestHeaderExpireAt"},b.createElement("span",{className:"field-label"},"expires")," ",Ht(e.expireAt)))),b.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(b.Component));var ra=Object(P.b)(function(e,t){return{}},function(e){return{onAcceptInboxRequest:function(t){e(en(t.id))},onRejectInboxRequest:function(t){e(Wn(t.id))}}})(ta),na=(r(288),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.APP:return"SHOW APP";case Oe.USER:return"";case Oe.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(ea,{workspaceId:parseInt(e.narrativeId,10)})))}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(Yn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return b.createElement(Yn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.APP:return"REQUEST to associate App";case Oe.USER:return"REQUEST to join Organization";case Oe.WORKSPACE:return"REQUEST to associate Narrative"}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.APP:return"SHOW APP";case Oe.USER:return"";case Oe.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(ea,{workspaceId:parseInt(e.narrativeId,10)})),b.createElement("div",{className:"cardSectionHeader"},"with organization"))}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return b.createElement(Yn,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),b.createElement("div",{className:"miniDetail"},b.createElement(ea,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return b.createElement("div",{style:{textAlign:"center"}},b.createElement(Kt.a.Group,{style:{marginTop:"4px"}},b.createElement(Kt.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},b.createElement(vt.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),b.createElement("div",{className:"cardSectionHeader"},"sent to"),b.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case pe.REQUEST:switch(e.resourceType){case Oe.USER:return this.renderJoinRequest(e);case Oe.WORKSPACE:return this.renderWorkspaceRequest(e);case Oe.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"apps not supported yet"))}case pe.INVITATION:switch(e.resourceType){case Oe.USER:return this.renderUserInvitation(e);case Oe.WORKSPACE:case Oe.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return b.createElement("div",{key:e.id,className:"OutboxRequest kbCard"},b.createElement("div",{className:"kbCard-header"},b.createElement("div",{className:"OutboxRequest-requestHeaderRow"},b.createElement("div",{className:"OutboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),b.createElement("div",{className:"OutboxRequest-requestHeaderExpireAt"},b.createElement("span",{className:"field-label"},"expires")," ",Ht(e.expireAt)))),b.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(b.Component));var aa=Object(P.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e(qn(t.id))}}})(na),ia=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("/#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){mt.a.info({title:"Manage Requests Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading Org Editor...");return b.createElement(tr,{breadcrumbs:e})}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=b.createElement("span",null,b.createElement(vt.a,{type:"user"}),b.createElement(vt.a,{type:"arrow-right"}),b.createElement(vt.a,{type:"team"})," ","Request to Join Group"),n=[b.createElement(Kt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),b.createElement(Kt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return b.createElement(En.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"from"),b.createElement("td",{className:"requester"},b.createElement(Yn,{userId:e.requester,avatarSize:50}))),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Ht(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=b.createElement("span",null,b.createElement(vt.a,{type:"team"}),b.createElement(vt.a,{type:"mail"}),b.createElement(vt.a,{type:"arrow-right"}),b.createElement(vt.a,{type:"user"})," ","Invitation to Join Group"),n=[b.createElement(Kt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e)}},"Cancel")];return b.createElement(En.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"invitation to"),b.createElement("td",{className:"requester"},b.createElement(Yn,{userId:e.user,avatarSize:30}))),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Ht(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case Ae.NONE:return"None";case Ae.VIEW:return"View Only";case Ae.EDIT:return"Edit";case Ae.ADMIN:return"Admin";case Ae.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=b.createElement("span",null,b.createElement(vt.a,{type:"file"}),b.createElement(vt.a,{type:"arrow-right"}),b.createElement(vt.a,{type:"team"})," ","Request to Add Narrative"),a=[b.createElement(Kt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e)}},"Approve"),b.createElement(Kt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e)}},"Deny")];return t=b.createElement(ea,{workspaceId:parseInt(e.narrativeId,10)}),b.createElement(En.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"from"),b.createElement("td",{className:"requester"},b.createElement(Yn,{userId:e.requester,avatarSize:30}))),b.createElement("tr",null,b.createElement("th",null,"narrative"),b.createElement("td",{className:"narrative"},t)),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Ht(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=b.createElement("span",null,b.createElement(vt.a,{type:"appstore"}),b.createElement(vt.a,{type:"arrow-right"}),b.createElement(vt.a,{type:"team"})," ","Request to Add App"),n=[b.createElement(Kt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),b.createElement(Kt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return b.createElement(En.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"from"),b.createElement("td",{className:"requester"},b.createElement(Yn,{userId:e.requester,avatarSize:50}))),b.createElement("tr",null,b.createElement("th",null,"app"),b.createElement("td",{className:"requester"},e.appId)),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Ht(e.expireAt),")")))))}},{key:"renderInbox",value:function(){var e;if(0===this.props.inbox.length)e=b.createElement("div",{className:"Message"},"No pending requests for you");else{var t=this.props.inbox.map(function(e){return b.createElement("div",{key:e.id},b.createElement(ra,{request:e}))});e=b.createElement("div",{style:{overflowY:"auto"}},t)}return b.createElement(b.Fragment,null,e)}},{key:"renderOutbox",value:function(){var e;if(0===this.props.outbox.length)e=b.createElement("div",{className:"Message"},"No pending requests from you");else{var t=this.props.outbox.map(function(e){return b.createElement("div",{key:e.id},b.createElement(aa,{request:e}))});e=b.createElement("div",{style:{overflowY:"auto"}},t)}return b.createElement(b.Fragment,null,e)}},{key:"isAdmin",value:function(e){return e.type===Se.ADMIN||e.type===Se.OWNER}},{key:"render",value:function(){if(this.isAdmin(this.props.relation)){var e=this.props.outbox.length,t=this.props.inbox.length;return b.createElement("div",{className:"Requests"},b.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"inbox (",t,")"),this.renderInbox(),b.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"outbox (",e,")"),this.renderOutbox())}var r=this.props.outbox.length;return b.createElement("div",{className:"Requests"},b.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"outbox (",r,")"),this.renderOutbox())}}]),t}(b.Component);var sa=Object(P.b)(function(e,t){return{}},function(e){return{onAcceptJoinRequest:function(t){e(en(t.id))},onDenyJoinRequest:function(t){e(Wn(t.id))},onCancelJoinInvitation:function(t){e(qn(t.id))},onGetViewAccess:function(e){}}})(ia);function oa(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,s=e.info;return{code:t,message:r,detail:n,id:zn()(),at:new Date,history:a,trace:i,info:s}}r(302);var ca=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderLogo",value:function(e){return b.createElement(Et,{logoUrl:e.logoUrl,size:30,organizationName:e.name,organizationId:e.id})}},{key:"render",value:function(){var e=this.props.organization;return b.createElement("div",{className:"OrganizationEntity-Accessible "},b.createElement("div",{className:"OrganizationEntity-Accessible-logoCol"},this.renderLogo(e)),b.createElement("div",{className:"OrganizationEntity-Accessible-mainCol"},b.createElement("div",{className:"OrganizationEntity-Accessible-name"},b.createElement("a",{href:"/viewOrganization/".concat(e.id)},e.name)),b.createElement("div",{className:"OrganizationEntity-Accessible-researchInterests"},e.researchInterests),b.createElement("div",{className:"OrganizationEntity-Accessible-owner"},b.createElement(qt,{username:e.owner.username,showAvatar:!1,avatarSize:20}))))}}]),t}(b.Component),la=(r(304),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return b.createElement("div",{className:"OrganizationEntity-Inaccessible "},b.createElement("div",{className:"OrganizationEntity-Inaccessible-logoCol"},b.createElement(vt.a,{type:"lock"})),b.createElement("div",{className:"OrganizationEntity-Inaccessible-mainCol"},b.createElement("div",{className:"OrganizationEntity-Inaccessible-name"},"Private Organization")))}}]),t}(b.Component));var ua=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){if(!this.props.organization)return b.createElement("div",null,b.createElement(vt.a,{type:"loading"}));switch(this.props.organization.kind){case Ne.NORMAL:return b.createElement(ca,{organization:this.props.organization});case Ne.INACCESSIBLE_PRIVATE:return b.createElement(la,{organization:this.props.organization});default:return b.createElement("div",null,"Error: unrecognized org kind")}}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(b.Component);var Ea=Object(P.b)(function(e,t){return{organization:e.entities.organizations.byId.get(t.organizationId)||null}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.ENTITY_ORGANIZATION_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:u=t.sent,r({type:F.ENTITY_ORGANIZATION_LOAD_SUCCESS,organization:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:F.ENTITY_ORGANIZATION_LOAD_ERROR,error:jn({code:t.t0.name,message:t.t0.message})});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(ua),da=(r(306),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.props.onManageRelatedOrgs()}},{key:"renderToolbar",value:function(){return b.createElement("div",{className:"RelatedOrganizations-toolbar"},b.createElement(Kt.a,{onClick:this.onManageRelatedOrgs.bind(this)},"Add Related Org"))}},{key:"onAdminMenu",value:function(e,t){switch(e){case"removeRelation":this.props.onRemoveRelatedOrganization(this.props.organization.id,t)}}},{key:"renderControls",value:function(e){var t=this;if(this.props.organization.isAdmin){var r=b.createElement(pt.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},b.createElement(pt.a.Item,{key:"removeRelation"},b.createElement(vt.a,{type:"delete"}),"Remove"));return b.createElement("div",null,b.createElement(Ot.a,{overlay:r,trigger:["click"]},b.createElement(vt.a,{type:"ellipsis",className:"IconButton-hover"})))}}},{key:"renderBody",value:function(){var e=this;if(0===t.length)return b.createElement("p",null,"Sorry, no related organizations");if(0===this.props.relatedOrganizations.length){var r=b.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No related organizations");return b.createElement(ot.a,{type:"info",message:r})}var n=this.props.relatedOrganizations.map(function(t){return b.createElement("div",{key:t,className:"RelatedOrganizations-orgRow simpleCard"},b.createElement("div",{className:"RelatedOrganizations-orgCol"},b.createElement(Ea,{organizationId:t})),b.createElement("div",{className:"RelatedOrganizations-controlCol"},e.renderControls(t)))});return b.createElement("div",{className:"RelatedOrganizations-organizations"},n)}},{key:"render",value:function(){return b.createElement("div",{className:"RelatedOrganizations scrollable-flex-column"},b.createElement("div",{className:"RelatedOrganizations-bodyRow scrollable-flex-column"},this.renderBody()))}}]),t}(b.Component));var va=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onRemoveRelatedOrganization:function(t,r){e(function(e,t){return function(){var r=Object(me.a)(ve.a.mark(function r(n,a){var i,s,o,c,l,u;return ve.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new We({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:oa({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))}}})(da),ma=r(344);r(308),r(310);var pa=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderRelated",value:function(){if(this.props.selectableOrganization.isRelated)return b.createElement(vt.a,{type:"check",style:{color:"green"}})}},{key:"render",value:function(){return b.createElement("div",{className:"AvailableOrganization"},b.createElement("div",{className:"AvailableOrganization-relatedCol"},this.renderRelated()),b.createElement("div",{className:"AvailableOrganization-orgCol"},b.createElement("div",{className:"AvailableOrganization-logoCol"},b.createElement(Et,{logoUrl:this.props.selectableOrganization.organization.logoUrl,size:30,organizationName:this.props.selectableOrganization.organization.name,organizationId:this.props.selectableOrganization.organization.id})),b.createElement("div",{className:"AvailableOrganization-orgInfoCol"},b.createElement("div",{className:"AvailableOrganization-name"},this.props.selectableOrganization.organization.name),b.createElement("div",{className:"AvailableOrganization-owner"},b.createElement(qt,{username:this.props.selectableOrganization.organization.owner.username,avatarSize:20,showAvatar:!1})))),b.createElement("div",{className:"AvailableOrganization-actionCol"}))}}]),t}(b.Component),Oa=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onAddSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onAddOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"onRemoveSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onRemoveOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"renderAvailableToolbar",value:function(){return b.createElement("div",{className:"ManageRelatedOrganizations-available-toolbar"},b.createElement(Mr.a,{placeholder:"Filter Available Organizations"}))}},{key:"renderAvailableOrgs",value:function(){var e=this;return this.props.organizations.map(function(t){var r=["simpleCard","ManageRelatedOrganizations-availableOrganization"];return t.isSelected&&r.push("ManageRelatedOrganizations-selected"),b.createElement("div",{className:r.join(" "),onClick:function(){e.props.onSelectOrganization(t)},key:t.organization.id},b.createElement(pa,{selectableOrganization:t}))})}},{key:"renderSelectedOrg",value:function(){var e;if(this.props.selectedOrganization)return this.props.selectedOrganization.isRelated?(b.createElement(ot.a,{type:"warning",message:"This org is already associated"}),e=b.createElement(Kt.a,{type:"danger",disabled:null===this.props.selectedOrganization,onClick:this.onRemoveSelectedOrganization.bind(this)},"Remove Organization")):e=b.createElement(Kt.a,{type:"primary",disabled:null===this.props.selectedOrganization,onClick:this.onAddSelectedOrganization.bind(this)},"Add Organization"),b.createElement(b.Fragment,null,b.createElement("div",{className:"ManageRelatedOrganizations-selectedOrganization"},b.createElement(Jt,{organization:this.props.selectedOrganization.organization,openRequestsStatus:null})),b.createElement("div",{className:"ManageRelatedOrganizations-buttonBar"},e))}},{key:"render",value:function(){var e=this;return b.createElement("div",{className:"ManageRelatedOrganizations scrollable-flex-column"},b.createElement("div",{className:"ManageRelatedOrganizations-toolbar"},b.createElement(Kt.a,{onClick:function(){return e.props.onFinish()},type:"danger"},b.createElement(vt.a,{type:"rollback"})," ","Done")),b.createElement("div",{className:"ManageRelatedOrganizations-main scrollable-flex-column"},b.createElement("div",{className:"ManageRelatedOrganizations-availableOrgs"},b.createElement("h3",{style:{textAlign:"center"}},"Available Organizations"),this.renderAvailableToolbar(),b.createElement("div",{className:"ManageRelatedOrganizations-organizations"},this.renderAvailableOrgs())),b.createElement("div",{className:"ManageRelatedOrganizations-relatedOrgs"},b.createElement("h3",{style:{textAlign:"center"}},"Selected Organization"),this.renderSelectedOrg())))}}]),t}(b.Component);var Ra=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.manageRelatedOrganizationsView.viewModel)throw new Error("argh, null subview view model");var n=r.subViews.manageRelatedOrganizationsView.viewModel;return{organization:n.organization,organizations:n.organizations,relatedOrganizations:n.relatedOrganizations,selectedOrganization:n.selectedOrganization}},function(e){return{onSelectOrganization:function(t){e(function(e){return{type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION,selectedOrganization:e}}(t))},onAddOrganization:function(t,r){e(function(e,t){return function(){var r=Object(me.a)(ve.a.mark(function r(n,a){var i,s,o,c,l,u;return ve.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new We({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=5,r.next=8,u.addRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,error:oa({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onRemoveOrganization:function(t,r){e(function(e,t){return function(){var r=Object(me.a)(ve.a.mark(function r(n,a){var i,s,o,c,l,u;return ve.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new We({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:oa({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))}}})(Oa),ha=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading Related Organizations Manager..."," ",b.createElement(ma.a,null));return b.createElement(ot.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case N.NONE:case N.LOADING:return this.renderLoading();case N.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return b.createElement(Ra,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case N.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var wa,_a,ga,Sa=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==f.NORMAL)throw new Error("not the right vm");return{view:r.subViews.manageRelatedOrganizationsView}},function(e){return{onLoad:function(){e(function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s,o,c,l,u,E,d;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,null!==(c=n.views.viewOrgView.viewModel)){e.next=4;break}throw new Error("view is not populated");case 4:if(c.kind===f.NORMAL){e.next=6;break}throw new Error("view is not normal");case 6:return l=c.organization,u=new We({token:i,username:s,groupsServiceURL:o.services.Groups.url}),e.prev=8,e.next=11,u.getAllOrgs2();case 11:E=e.sent,d=E.map(function(e){return{isRelated:l.relatedOrganizations.includes(e.id),isSelected:!1,organization:e}}),t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS,organizations:d}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR,error:oa({code:"error",message:e.t0.message})});case 19:case"end":return e.stop()}},e,this,[[8,16]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD})}}})(ha);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE",e[e.MANAGE_MEMBERSHIP=2]="MANAGE_MEMBERSHIP",e[e.VIEW_MEMBERS=3]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=4]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=5]="VIEW_ORGANIZATION",e[e.EDIT_ORGANIZATION=6]="EDIT_ORGANIZATION",e[e.INVITE_USER=7]="INVITE_USER"}(wa||(wa={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(_a||(_a={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS"}(ga||(ga={}));var fa=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={showInfo:!1,navigateTo:wa.NONE,requestAccess:{narrative:null},accordionState:_a.UP,subView:ga.NORMAL},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.setState({subView:ga.MANAGE_RELATED_ORGS})}},{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.viewModel.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({navigateTo:wa.REQUEST_ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){mt.a.info({title:"View Organization Help",width:"50em",content:b.createElement("div",null,"Organization help here...")})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return b.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.viewModel.relation.type===Se.ADMIN||this.props.viewModel.relation.type===Se.OWNER)return b.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",b.createElement(ct.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},b.createElement(Kt.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.viewModel.relation.type===Se.ADMIN||this.props.viewModel.relation.type===Se.OWNER)return b.createElement(ct.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},b.createElement(Kt.a,{icon:"edit"},"Edit This Organization"))}},{key:"renderOrg",value:function(){if(this.props.viewModel.organization)return b.createElement("div",{className:"ViewOrganization-org-description-org scrollable-flex-column"},b.createElement("div",{className:"ViewOrganization-org-description",dangerouslySetInnerHTML:{__html:yr.Marked.parse(this.props.viewModel.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return b.createElement("div",{className:"ownerTable"},b.createElement("div",{className:"proprietorCol"},b.createElement("div",{className:"owner"},b.createElement("a",{href:"/#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderOrgHeader",value:function(){if(this.props.viewModel.organization)return b.createElement(An,{organizationId:this.props.viewModel.organization.id})}},{key:"renderRelation",value:function(e){switch(e.type){case Se.NONE:return b.createElement("span",null,b.createElement(vt.a,{type:"stop"}),"None");case Se.VIEW:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},b.createElement("div",null,b.createElement(vt.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),b.createElement("div",{style:{marginTop:"10px"}},b.createElement(Kt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case Se.MEMBER_REQUEST_PENDING:return b.createElement("div",null,b.createElement("div",null,b.createElement(vt.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",b.createElement("b",null,"request")," is pending"),b.createElement("div",null,b.createElement(Kt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case Se.MEMBER_INVITATION_PENDING:return b.createElement("div",null,b.createElement("div",null,b.createElement(vt.a,{type:"user",style:{color:"blue"}}),"You have been ",b.createElement("b",null,"invited")," to join this Organization"),b.createElement("div",{style:{marginTop:"10px"}},b.createElement(Kt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),b.createElement(Kt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case Se.MEMBER:return b.createElement("span",null,b.createElement(vt.a,{type:"user"}),"Member");case Se.ADMIN:return b.createElement("span",null,b.createElement(vt.a,{type:"unlock"}),"Admin");case Se.OWNER:return b.createElement(dt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},b.createElement("span",null,b.createElement(vt.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.viewModel.organization&&(this.props.viewModel.relation.type===Se.OWNER||this.props.viewModel.relation.type===Se.ADMIN||this.props.viewModel.relation.type===Se.MEMBER)}},{key:"renderMembers",value:function(){return this.isMember()?b.createElement(Bn,{organization:this.props.viewModel.organization,relation:this.props.viewModel.relation,onReloadOrg:this.props.onReloadOrg}):b.createElement(ot.a,{message:"Membership is only available to members",type:"info"})}},{key:"renderInfo",value:function(){if(this.props.viewModel.organization)return b.createElement(En.a,{title:b.createElement("span",null,b.createElement(vt.a,{type:"info-circle"})," info"),headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard"},b.createElement("div",null,b.createElement("div",null,b.createElement("div",{className:"label"},"owner")),b.createElement("div",{className:"ViewOrganization-ownerTable"},b.createElement(Rn,{member:this.props.viewModel.organization.owner,avatarSize:50})),b.createElement("div",{className:"ViewOrganization-infoTable"},b.createElement("div",{className:"row"},b.createElement("div",{className:"col1"},b.createElement("span",{className:"label"},"established")),b.createElement("div",{className:"col2"},b.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.viewModel.organization.createdAt)))),b.createElement("div",{className:"row"},b.createElement("div",{className:"col1"},b.createElement("span",{className:"label"},"last updated")),b.createElement("div",{className:"col2"},b.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.viewModel.organization.modifiedAt)))))))}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.viewModel.relation,r=this.props.viewModel.groupRequests,n=this.props.viewModel.groupInvitations;if((t.type===Se.ADMIN||t.type===Se.OWNER)&&(null!==r&&null!==n))return e=r.length?b.createElement("div",null,"group has no pending requests"):b.createElement("div",null,b.createElement("div",null,b.createElement(vt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",b.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",b.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),b.createElement("div",null,b.createElement(ct.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},b.createElement(Kt.a,null,"Manage Requests")))),b.createElement("div",{className:"row"},b.createElement("div",{className:"col1"},b.createElement("span",{className:"label"},"admin")),b.createElement("div",{className:"col2"},b.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?b.createElement("div",null,b.createElement("div",null,b.createElement(vt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",b.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",b.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),b.createElement("div",null,b.createElement(ct.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},b.createElement(Kt.a,null,"Manage Requests")))):b.createElement("div",{className:"message"},"No pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case Se.NONE:case Se.VIEW:return"infoBox";case Se.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case Se.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case Se.MEMBER:case Se.ADMIN:case Se.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return b.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.viewModel.relation;if(e.type===Se.ADMIN||e.type===Se.OWNER){var t=this.props.viewModel,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=b.createElement("span",null,b.createElement(vt.a,{type:"unlock"})," ","group requests"," ",b.createElement("span",{className:"ViewOrganization-titleCount"},"(",a,")"));return b.createElement("div",{className:"ViewOrganization-adminTasksBox"},b.createElement(En.a,{className:"slimCard ViewOrganization-adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.viewModel.organization&&this.props.viewModel.relation.type===Se.VIEW)return b.createElement(Kt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading Org...");return b.createElement(tr,{breadcrumbs:e})}},{key:"renderMembersTab",value:function(){return b.createElement("div",{className:"ViewOrganization-membersCol scrollable-flex-column"},this.renderMembersToolbar(),this.renderMembers())}},{key:"onAcceptRequest",value:function(e){this.props.onAcceptRequest(e.id)}},{key:"renderNarrativeMenu",value:function(e){var t,r=this,n=this.props.viewModel.relation;n.type===Se.OWNER||(n.type,Se.ADMIN);switch(n.type){case Se.NONE:break;case Se.VIEW:case Se.MEMBER_REQUEST_PENDING:case Se.MEMBER_INVITATION_PENDING:case Se.MEMBER:break;case Se.ADMIN:case Se.OWNER:t=b.createElement(pt.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},b.createElement(pt.a.Item,{key:"removeNarrative"},b.createElement(vt.a,{type:"delete"})," Remove Narrative from Organization"))}if(t)return b.createElement(Ot.a,{overlay:t,trigger:["click"]},b.createElement(vt.a,{type:"ellipsis",className:"IconButton-hover"}))}},{key:"renderNarratives",value:function(){var e,t=this,r=[];this.props.viewModel.organization.isMember&&r.push(b.createElement(ct.a,{key:"requestAddNarrative",to:"/requestAddNarrative/".concat(this.props.viewModel.organization.id)},b.createElement(Kt.a,{onClick:this.onRequestAddNarrative.bind(this)},b.createElement(vt.a,{type:"plus"})," Add a Narrative"))),e=0===this.props.viewModel.narratives.length?b.createElement("div",{className:"message"},"No Narratives are yet associated with this Organization"):this.props.viewModel.narratives.map(function(e){return b.createElement("div",{className:"narrative simpleCard",key:String(e.workspaceId)},b.createElement("div",{className:"dataCol"},b.createElement(kn,{narrative:e,organization:t.props.viewModel.organization,onGetViewAccess:t.props.onGetViewAccess})),b.createElement("div",{className:"buttonCol"},t.renderNarrativeMenu(e)))});var n=this.props.viewModel.organization.narrativeCount,a=b.createElement("span",{className:"ViewOrganization-narrativesTitle"},b.createElement(vt.a,{type:"folder-open",style:{marginRight:"8px"}}),"Narratives"," ",b.createElement("span",{className:"titleCount"},"(",n,")"));return b.createElement("div",{className:"ViewOrganization-narratives scrollable-flex-column"},b.createElement("div",{className:"ViewOrganization-narrativesHeader"},b.createElement("div",{className:"ViewOrganization-narrativesHeaderCol1"},a),b.createElement("div",{className:"ViewOrganization-narrativesHeaderCol2"},r)),b.createElement("div",{className:"ViewOrganization-narratives-toolbar"},b.createElement("div",{className:"ViewOrganization-narratives-toolbar-searchCol"},this.renderSearchBar()),b.createElement("div",{className:"ViewOrganization-narratives-toolbar-sortCol"},this.renderSortBar())),b.createElement("div",{className:"ViewOrganization-narrativesList"},b.createElement("div",{className:"narrativesTable"},e)))}},{key:"renderSearchBar",value:function(){var e=this;return b.createElement("div",{style:{paddingRight:"6px"}},b.createElement(Mr.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter narratives by title",onChange:function(t){e.props.onSearchNarratives(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return b.createElement(b.Fragment,null,b.createElement("span",{className:"field-label"},"sort"),b.createElement(Xt.a,{onChange:function(t){e.props.onSortNarratives(t)},style:{width:"11em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.viewModel.sortNarrativesBy},b.createElement(Xt.a.Option,{value:"name",key:"name"},"Name"),b.createElement(Xt.a.Option,{value:"added",key:"added"},"Date Added"),b.createElement(Xt.a.Option,{value:"changed",key:"changed"},"Last Changed")))}},{key:"renderMembersToolbar",value:function(){switch(this.props.viewModel.relation.type){case Se.NONE:case Se.MEMBER:return;case Se.ADMIN:case Se.OWNER:return b.createElement("div",{className:"ViewOrganization-tabPaneToolbar"},b.createElement(ct.a,{to:"/inviteUser/"+this.props.viewModel.organization.id},b.createElement(Kt.a,{size:"small"},b.createElement(vt.a,{type:"mail"})," Invite a User")))}}},{key:"renderCombo",value:function(){var e,t=this,r=this.props.viewModel.relation.type===Se.ADMIN||this.props.viewModel.relation.type===Se.OWNER,n=this.props.viewModel.organization.isMember,a=[];if(e=this.props.viewModel.organization.memberCount-1?String(this.props.viewModel.organization.memberCount-1):"\xd8",a.push(b.createElement(dn.a.TabPane,{tab:b.createElement("span",null,b.createElement(vt.a,{type:"team"}),"Members ",b.createElement("span",{className:"ViewOrganization-tabCount"},"(",e,")")),key:"members",style:{flexDirection:"column"}},this.renderMembersTab())),n)if(r){var i=this.props.viewModel.requestInbox.length+this.props.viewModel.requestOutbox.length,s=b.createElement("span",{className:"ViewOrganization-tabCount"},"(",i||"\xd8",")");a.push(b.createElement(dn.a.TabPane,{tab:b.createElement("span",null,b.createElement(vt.a,{type:"inbox"}),"Requests ",s," "),key:"inbox",style:{flexDirection:"column"}},b.createElement(sa,{inbox:this.props.viewModel.requestInbox,outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}else{var o,c=this.props.viewModel.requestOutbox.length;o=c?String(c):"\xd8",a.push(b.createElement(dn.a.TabPane,{tab:b.createElement("span",null,b.createElement(vt.a,{type:"inbox"}),"Requests ",b.createElement("span",{className:"ViewOrganization-tabCount"},"(",o,")")),key:"outbox",style:{flexDirection:"column"}},b.createElement(sa,{inbox:[],outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}var l=this.props.viewModel.organization.relatedOrganizations.length,u=b.createElement("span",null,b.createElement(vt.a,{type:"team"}),"Related Orgs ",b.createElement("span",{className:"ViewOrganization-tabCount"},"(",l,")"));return a.push(b.createElement(dn.a.TabPane,{tab:u,key:"relatedorgs",style:{flexDirection:"column"}},b.createElement(va,{relatedOrganizations:this.props.viewModel.organization.relatedOrganizations,organization:this.props.viewModel.organization,onManageRelatedOrgs:function(){t.onManageRelatedOrgs()}}))),b.createElement(dn.a,{defaultActiveKey:"members",className:"ViewOrganization-tabs",animated:!1,size:"small",tabPosition:"top"},a)}},{key:"renderMenuButtons",value:function(){return b.createElement("span",{className:"ButtonSet"},b.createElement("span",{className:"ButtonSet-button"},this.renderOrgMenu()))}},{key:"onNavigateToMembership",value:function(){this.setState({navigateTo:wa.MANAGE_MEMBERSHIP})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:wa.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:wa.MANAGE_REQUESTS})}},{key:"onNavigateToEditOrganization",value:function(){this.setState({navigateTo:wa.EDIT_ORGANIZATION})}},{key:"onNavigateToInviteUser",value:function(){this.setState({navigateTo:wa.INVITE_USER})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:wa.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({navigateTo:wa.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:wa.VIEW_MEMBERS});break;case"editOrg":this.setState({navigateTo:wa.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({navigateTo:wa.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:wa.MANAGE_REQUESTS});break;case"addNarrative":this.setState({navigateTo:wa.REQUEST_ADD_NARRATIVE});break;case"manageRelatedOrgs":this.setState({subView:ga.MANAGE_RELATED_ORGS})}}},{key:"renderOrgMenu",value:function(){this.props.viewModel.organization;switch(this.props.viewModel.relation.type){case Se.NONE:case Se.VIEW:return b.createElement("span",null,b.createElement(Kt.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization"));case Se.MEMBER_REQUEST_PENDING:return b.createElement("span",null,b.createElement(dt.a,{placement:"bottom",mouseEnterDelay:.5,title:"You have requested to join this Org; you may cancel your join request with this button"},b.createElement(Kt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Join Request")));case Se.MEMBER_INVITATION_PENDING:return b.createElement("div",{className:"ViewOrganization-invitationPendingCard"},b.createElement("span",null,"You have been invited to this organization: "),b.createElement(Kt.a,{icon:"check",type:"default",size:"small",onClick:this.onAcceptInvitation.bind(this)},"Accept"),b.createElement(Kt.a,{icon:"stop",type:"danger",size:"small",onClick:this.onRejectInvitation.bind(this)},"Reject"));case Se.MEMBER:var e=b.createElement(pt.a,{onClick:this.onMenuClick.bind(this)},b.createElement(pt.a.Item,{key:"manageMyMembership"},b.createElement(vt.a,{type:"user"})," ","Manage My Membership"));return b.createElement("span",null,b.createElement(Ot.a,{overlay:e,trigger:["click"]},b.createElement(Kt.a,{shape:"circle"},b.createElement(vt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))));case Se.ADMIN:var t=b.createElement(pt.a,{onClick:this.onMenuClick.bind(this)},b.createElement(pt.a.Item,{key:"manageMyMembership"},b.createElement(vt.a,{type:"user"})," ","Manage My Membership"),b.createElement(pt.a.Item,{key:"editOrg"},b.createElement(vt.a,{type:"edit"})," ","Edit this Org"),b.createElement(pt.a.Item,{key:"inviteUser"},b.createElement(vt.a,{type:"mail"})," ","Invite User"),b.createElement(pt.a.Item,{key:"manageRelatedOrgs"},b.createElement(vt.a,{type:"team"})," ","Manage Related Orgs"));return b.createElement("span",null,b.createElement(Ot.a,{overlay:t,trigger:["click"]},b.createElement(Kt.a,{shape:"circle"},b.createElement(vt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))));case Se.OWNER:var r=b.createElement(pt.a,{onClick:this.onMenuClick.bind(this)},b.createElement(pt.a.Item,{key:"manageMyMembership"},b.createElement(vt.a,{type:"user"})," ","Manage My Membership"),b.createElement(pt.a.Item,{key:"editOrg"},b.createElement(vt.a,{type:"edit"})," ","Edit this Org"),b.createElement(pt.a.Item,{key:"inviteUser"},b.createElement(vt.a,{type:"mail"})," ","Invite User"),b.createElement(pt.a.Item,{key:"addNarrative"},b.createElement(vt.a,{type:"file"})," ","Add Narrative"),b.createElement(pt.a.Item,{key:"manageRelatedOrgs"},b.createElement(vt.a,{type:"team"})," ","Manage Related Orgs"));return b.createElement("span",null,b.createElement(Ot.a,{overlay:r,trigger:["click"]},b.createElement(Kt.a,{shape:"circle"},b.createElement(vt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))}}},{key:"toggleAccordion",value:function(){this.setState({accordionState:this.state.accordionState===_a.UP?_a.DOWN:_a.UP})}},{key:"renderAccordionControl",value:function(){var e;return e=this.state.accordionState===_a.UP?"caret-down":"caret-up",b.createElement("div",{className:"ViewOrganization-accordion",onClick:this.toggleAccordion.bind(this)},b.createElement("div",{className:"ViewOrganization-accordionCol1"},b.createElement("div",{className:"ViewOrganization-accordionRow1"}),b.createElement("div",{className:"ViewOrganization-accordionRow2"}),b.createElement("div",{className:"ViewOrganization-accordionRow3"})),b.createElement("div",{className:"ViewOrganization-accordionCol2"},b.createElement("div",{className:"ViewOrganization-accordionRow1"}),b.createElement("div",{className:"ViewOrganization-accordionRow2"},b.createElement(vt.a,{type:e})),b.createElement("div",{className:"ViewOrganization-accordionRow3"})),b.createElement("div",{className:"ViewOrganization-accordionCol3"},b.createElement("div",{className:"ViewOrganization-accordionRow1"}),b.createElement("div",{className:"ViewOrganization-accordionRow2"}),b.createElement("div",{className:"ViewOrganization-accordionRow3"})))}},{key:"renderNormalView",value:function(){var e,t;return this.state.accordionState===_a.UP?(e="ViewOrganization-orgRow ViewOrganization-accordionClosed",t="ViewOrganization-narrativesRow ViewOrganization-accordionOpen"):(e="ViewOrganization-orgRow ViewOrganization-accordionOpen",t="ViewOrganization-narrativesRow ViewOrganization-accordionClosed"),e+=" scrollable-flex-column",t+=" scrollable-flex-column",b.createElement("div",{className:"ViewOrganization-mainRow scrollable-flex-column"},b.createElement("div",{className:"ViewOrganization-mainColumn  scrollable-flex-column"},b.createElement("div",{className:e,style:{minHeight:"0px"}},this.renderOrg()),b.createElement("div",{className:"ViewOrganization-accordionRow"},this.renderAccordionControl()),b.createElement("div",{className:t},this.renderNarratives())),b.createElement("div",{className:"ViewOrganization-infoColumn"},this.renderCombo()))}},{key:"renderManageRelatedOrgsView",value:function(){var e=this;return b.createElement(Sa,{onFinish:function(){e.setState({subView:ga.NORMAL})}})}},{key:"getSubView",value:function(){switch(this.state.subView){case ga.MANAGE_RELATED_ORGS:return this.renderManageRelatedOrgsView();case ga.NORMAL:default:return this.renderNormalView()}}},{key:"render",value:function(){switch(this.state.navigateTo){case wa.REQUEST_ADD_NARRATIVE:return b.createElement(Tr.a,{to:"/requestAddNarrative/"+this.props.viewModel.organization.id});case wa.MANAGE_MEMBERSHIP:return b.createElement(Tr.a,{push:!0,to:"/membership/"+this.props.viewModel.organization.id});case wa.VIEW_MEMBERS:return b.createElement(Tr.a,{push:!0,to:"/viewMembers/"+this.props.viewModel.organization.id});case wa.EDIT_ORGANIZATION:return b.createElement(Tr.a,{push:!0,to:"/editOrganization/"+this.props.viewModel.organization.id});case wa.MANAGE_REQUESTS:return b.createElement(Tr.a,{push:!0,to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id});case wa.INVITE_USER:return b.createElement(Tr.a,{push:!0,to:"/inviteUser/"+this.props.viewModel.organization.id});case wa.VIEW_ORGANIZATION:return b.createElement(Tr.a,{push:!0,to:"/viewOrganization/"+this.props.viewModel.organization.id});case wa.NONE:}var e=this.props.viewModel.organization;return b.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},b.createElement(ar,{buttons:this.renderMenuButtons()}),b.createElement("div",{style:{borderBottom:"1px silver solid"}},b.createElement(Jt,{organization:e,openRequestsStatus:this.props.viewModel.openRequest})),this.getSubView())}}]),t}(b.Component);var Aa,Na=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");return{viewModel:r}},function(e){return{onViewOrg:function(t){e(Jr(t))},onReloadOrg:function(t){e(Zr(t))},onJoinOrg:function(){e(Yr())},onCancelJoinRequest:function(t){e(Kr(t))},onAcceptInvitation:function(t){e(Xr(t))},onRejectInvitation:function(t){e($r(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Pr({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=a.views.viewOrgView.viewModel.organization){t.next=9;break}return r(Pr({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:return u=l.id,E=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,E.removeNarrativeFromOrg(u,e.workspaceId);case 14:r(Lr(e)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(11),r(Pr({code:t.t0.name,message:t.t0.message}));case 20:case"end":return t.stop()}},t,this,[[11,17]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Br({code:"error",message:"No view model"})),t.abrupt("return");case 5:if((i=a.views.viewOrgView.viewModel).kind===f.NORMAL){t.next=9;break}return r(Br({code:"error",message:"Not NORMAL org"})),t.abrupt("return");case 9:return s=i.organization,o=a.auth.authorization,c=o.token,l=o.username,u=a.app.config,E=s.id,d=String(e.workspaceId),v=new We({token:c,username:l,groupsServiceURL:u.services.Groups.url}),t.prev=14,t.next=17,v.grantNarrativeAccess(E,d);case 17:return t.next=19,v.getOrg(E);case 19:if((m=t.sent).kind===Ne.NORMAL){t.next=23;break}return r(Br({code:"error",message:"Not a NORMAL org"})),t.abrupt("return");case 23:r(Bt(e.workspaceId)),r(xr(m)),t.next=30;break;case 27:t.prev=27,t.t0=t.catch(14),r(Br({code:"error",message:t.t0.message}));case 30:case"end":return t.stop()}},t,this,[[14,27]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onAcceptRequest:function(t){e(en(t))},onReadNotification:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.NOTIFICATIONS_READ_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new ln({token:s,username:o,feedsServiceURL:c.services.Feeds.url}),t.prev=3,t.next=6,l.seeNotification(e);case 6:t.sent,r({type:F.NOTIFICATIONS_READ_SUCCESS,notificationId:e}),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),console.error("error",t.t0),r({type:F.NOTIFICATIONS_READ_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 14:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onSortNarratives:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===f.NORMAL){var i=n.organization.narratives,s=n.searchNarrativesBy,o=Pe(i,{sortBy:e,searchBy:s});t({type:F.VIEW_ORG_SORT_NARRATIVES_SUCCESS,narratives:o,sortBy:e})}else t(Fr({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Fr({type:a.ERROR,message:"Now view model!"}))}}(t))},onSearchNarratives:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===f.NORMAL){var i=Pe(n.organization.narratives,{sortBy:n.sortNarrativesBy,searchBy:e});t({type:F.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS,searchBy:e,narratives:i})}else t(Fr({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Fr({type:a.ERROR,message:"Now view model!"}))}}(t))}}})(fa);r(312);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(Aa||(Aa={}));var Ia=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Aa.NONE,requestAccess:{narrative:null}},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onShowInfo",value:function(){mt.a.info({title:"View Organization Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This organization is ",b.createElement("b",null,"private"),"."),b.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),b.createElement("p",null,"Upon requesting membership, an organization administrator may grant you membership"),b.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."))})}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"renderMessage",value:function(){switch(this.props.relation.type){case Se.NONE:return b.createElement(b.Fragment,null,b.createElement("p",null,"This organization is ",b.createElement("b",null,"private")," and you are not a member."),b.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),b.createElement("p",null,"Upon requesting membership, the organization administrators will be notified."),b.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."));case Se.MEMBER_REQUEST_PENDING:return b.createElement(b.Fragment,null,b.createElement("p",null,"Your membership request to this private organization is pending."));case Se.MEMBER_INVITATION_PENDING:return b.createElement(b.Fragment,null,b.createElement("p",null,"You have been invited to this private organization."));default:return b.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderOrg",value:function(){var e=b.createElement("span",null,"Private Organization"),t=b.createElement(b.Fragment,null,this.renderMessage(),b.createElement("div",null,this.renderJoinButton()));return b.createElement(ot.a,{message:e,description:t,type:"info",showIcon:!0,icon:b.createElement(vt.a,{type:"lock"}),style:{width:"50em",margin:"20px auto"},className:"ViewInaccessiblePrivateOrganization-message"})}},{key:"renderRelationClass",value:function(e){switch(e.type){case Se.NONE:case Se.VIEW:return"infoBox";case Se.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case Se.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case Se.MEMBER:case Se.ADMIN:case Se.OWNER:return"infoBox"}}},{key:"renderJoinButton",value:function(){switch(this.props.relation.type){case Se.NONE:return b.createElement(Kt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization");case Se.MEMBER_REQUEST_PENDING:return b.createElement("div",null,b.createElement("div",null,b.createElement(Kt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case Se.MEMBER_INVITATION_PENDING:return b.createElement("div",null,b.createElement(Kt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation")," ",b.createElement(Kt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"));default:return b.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderHeader",value:function(){var e=b.createElement("div",{style:{flex:"0 0 auto"}}),t=b.createElement(b.Fragment,null,b.createElement(Kt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return b.createElement(tr,{breadcrumbs:e,buttons:t})}},{key:"render",value:function(){return b.createElement("div",{className:"ViewInaccessiblePrivateOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrg())}}]),t}(b.Component);var ba=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.PRIVATE_INACCESSIBLE)throw new Error("argh, wrong org kind");var n=r.organization,a=r.relation,i=r.requestOutbox;return e.db.notifications.all.filter(function(e){return e.organizationId===n.id}),{organization:n,relation:a,requestOutbox:i}},function(e){return{onJoinOrg:function(){e(Yr())},onCancelJoinRequest:function(t){e(Kr(t))},onAcceptInvitation:function(t){e(Xr(t))},onRejectInvitation:function(t){e($r(t))}}})(Ia),Ta=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading your Organization..."," ",b.createElement(ma.a,null));return b.createElement(ot.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return null===this.props.view.viewModel?this.renderError({code:"Null Error",message:"The view model is missing, but should be available"}):this.props.view.viewModel.organization.kind===Ne.INACCESSIBLE_PRIVATE?b.createElement(ba,null):b.createElement(Na,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var ya=Object(P.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(Jr(t))},onUnload:function(){e(function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s,o,c,l;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel){e.next=3;break}throw new Error("view model not defined!?!");case 3:if(l=new We({token:i,username:s,groupsServiceURL:o.services.Groups.url}),c.organization.relation!==Se.MEMBER&&c.organization.relation!==Se.ADMIN&&c.organization.relation!==Se.OWNER){e.next=7;break}return e.next=7,l.visitOrg({organizationId:c.organization.id});case 7:t(Gr()),t({type:F.VIEW_ORG_UNLOAD});case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}())}}})(Ta);function Ma(){return{type:F.EDIT_ORG_EVALUATE_ERRORS}}function Ca(e){return{type:F.EDIT_ORG_SAVE_ERROR,error:e}}function Da(e){return function(t,r){t({type:F.EDIT_ORG_LOAD_START});var n=r(),a=n.auth.authorization,s=a.token,c=a.username,l=n.app.config;return new We({token:s,username:c,groupsServiceURL:l.services.Groups.url}).getOrg(e).then(function(e){if(e.kind!==Ne.NORMAL)throw new Error("May not edit an inaccessible private org!");var r,n,a={id:{value:e.id,remoteValue:e.id,syncState:i.NEW,validationState:Te.validateOrgId(e.id)[1]},name:{value:e.name,remoteValue:e.name,syncState:i.NEW,validationState:Te.validateOrgName(e.name)[1]},logoUrl:{value:e.logoUrl,remoteValue:e.logoUrl,syncState:i.NEW,validationState:Te.validateOrgLogoUrl(e.logoUrl)[1]},homeUrl:{value:e.homeUrl,remoteValue:e.homeUrl,syncState:i.NEW,validationState:Te.validateOrgHomeUrl(e.homeUrl)[1]},researchInterests:{value:e.researchInterests,remoteValue:e.researchInterests,syncState:i.NEW,validationState:Te.validateOrgResearchInterests(e.researchInterests)[1]},description:{value:e.description,remoteValue:e.description,syncState:i.NEW,validationState:Te.validateOrgDescription(e.description)[1]},isPrivate:{value:e.isPrivate,remoteValue:e.isPrivate,syncState:i.NEW,validationState:{type:o.OK,validatedAt:new Date}}};t((r=a,n=e,{type:F.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:F.EDIT_ORG_LOAD_ERROR,error:r}))})}}function Va(){return function(e,t){e({type:F.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.editOrgView.viewModel,o=s.organization,c=s.editedOrganization,l=r.app.config,u=new We({token:a,username:i,groupsServiceURL:l.services.Groups.url});if(c){var E={name:c.name.value,logoUrl:c.logoUrl.value,description:c.description.value,isPrivate:c.isPrivate.value,homeUrl:c.homeUrl.value,researchInterests:c.researchInterests.value};u.updateOrg(o.id,E).then(function(){e({type:F.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",c,t),e(Ca({code:"invalid",message:t.message}))})}else e(Ca({code:"app",message:"The new organization data does not yet exist"}))}}function ka(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState.type===o.OK&&n.logoUrl.validationState.type===o.OK&&n.homeUrl.validationState.type===o.OK&&n.researchInterests.validationState.type===o.OK&&n.description.validationState.type===o.OK?e({type:F.EDIT_ORG_EVALUATE_OK}):e(Ma())}}function Ua(e){return function(t){var r=Te.validateOrgName(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:F.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:F.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(ka())}}function za(e){return function(t){var r=Te.validateOrgLogoUrl(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:F.EDIT_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(a,i)):t(function(e){return{type:F.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:e}}(a)),t(ka())}}function ja(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,s=a.username,c=n.app.config,l=(new We({token:i,username:s,groupsServiceURL:c.services.Groups.url}),Te.validateOrgDescription(e)),u=Object(Ee.a)(l,2),E=u[0],d=u[1];d.type!==o.OK?t(function(e,t){return{type:F.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(E,d)):t(function(e){return{type:F.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(E)),t(ka())}}var Ga;r(314);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Ga||(Ga={}));var La=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:Ga.NONE},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onShowInfo",value:function(){mt.a.info({title:"Organization Editor Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the organizations editor..."))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){mt.a.confirm({title:"Leave the editor?",content:b.createElement("div",null,b.createElement("p",null,"You have made changes on this edit form."),b.createElement("p",null,"If you leave the editor without saving, any ",b.createElement("i",null,"changes they will be lost"),"."),b.createElement("p",null,b.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){mt.a.confirm({title:"Leave the editor?",content:b.createElement("div",null,b.createElement("p",null,"You have made changes on this edit form."),b.createElement("p",null,"If you leave the editor without saving, any ",b.createElement("i",null,"changes they will be lost"),"."),b.createElement("p",null,b.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===s.EDITED&&(this.props.saveState===c.NEW||this.props.saveState===c.READY)}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===o.OK?"":e.syncState===i.DIRTY?b.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderEditor",value:function(){return b.createElement("form",{id:"editOrganizationForm",className:"EditOrganization-editor",onSubmit:this.onSubmit.bind(this)},b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{style:{flex:"1 1 0px"}},b.createElement("h3",null,"Edit Your Organization"))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("h3",null,"Preview"))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},b.createElement(dt.a,{title:"This is the name for your organization as you want KBase users to see it"},"Name")),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Mr.a,{value:this.props.editedOrganization.name.value||"",className:this.calcFieldClass(this.props.editedOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.name))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-name"},this.props.editedOrganization.name.value||""))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"ID"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Mr.a,{value:this.props.editedOrganization.id.value||"",className:this.calcFieldClass(this.props.editedOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.id))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-id"},b.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.editedOrganization.id.value||b.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Logo URL"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Mr.a,{value:this.props.editedOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.logoUrl))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-logo"},this.renderLogoPreview()))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Home Page URL"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Mr.a,{value:this.props.editedOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.homeUrl))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-field-name"},b.createElement("a",{href:this.props.editedOrganization.homeUrl.value||"",target:"_blank"},this.props.editedOrganization.homeUrl.value||"")))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Is Private?"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(er.a,{checked:this.props.editedOrganization.isPrivate.value,className:this.calcFieldClass(this.props.editedOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.isPrivate))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.editedOrganization.isPrivate.value)))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Research Interests"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Dr.a,{value:this.props.editedOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.editedOrganization.researchInterests)+" EditOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.researchInterests))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-researchInterests"},this.props.editedOrganization.researchInterests.value||""))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"}),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Dr.a,{value:this.props.editedOrganization.description.value||"",className:this.calcFieldClass(this.props.editedOrganization.description)+" EditOrganization-control-description",autosize:{minRows:5,maxRows:15},onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.description))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-description",dangerouslySetInnerHTML:{__html:yr.Marked.parse(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderIsPrivate",value:function(e){return e?b.createElement("span",null,b.createElement(vt.a,{type:"lock"})," ","Private"):b.createElement("span",null,b.createElement(vt.a,{type:"global"})," ","Public")}},{key:"renderLogoPreview",value:function(){return this.props.editedOrganization.logoUrl.value?b.createElement("img",{src:this.props.editedOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultLogo",value:function(){if(!this.props.editedOrganization.name.value||!this.props.editedOrganization.id.value)return b.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.editedOrganization.name.value,0).toUpperCase(),t=ut()(this.props.editedOrganization.id.value).substr(0,6);return b.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},b.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return b.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderOrgName",value:function(e){if(0===e.length)return b.createElement("span",{style:{fontStyle:"italic"}},"org name missing");var t=e;return e.length>=25&&(t=e.slice(0,25)+"\u2026"),b.createElement(ct.a,{to:"/viewOrganization/".concat(this.props.organization.id)},b.createElement("span",{style:{fontWeight:"bold"}},t))}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading Org Editor...");return b.createElement(tr,{breadcrumbs:e})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return b.createElement(An,{organizationId:this.props.organization.id})}},{key:"renderMenuButtons",value:function(){return b.createElement("span",{className:"ButtonSet"},b.createElement("span",{className:"ButtonSet-button"},b.createElement(Kt.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")),b.createElement("span",{className:"ButtonSet-button"},b.createElement(Kt.a,{icon:"rollback",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Back to Org")),b.createElement("span",{className:"ButtonSet-button"},b.createElement(Kt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)})))}},{key:"render",value:function(){return this.state.cancelToViewer?b.createElement(Tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):this.props.editedOrganization?b.createElement("div",{className:"EditOrganization"},b.createElement(ar,{buttons:this.renderMenuButtons()}),this.renderOrgHeader(),this.renderEditor()):b.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader())}}]),t}(b.Component);var Pa=Object(P.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(Va())},onUpdateName:function(t){e(Ua(t))},onUpdateLogoUrl:function(t){e(za(t))},onUpdateDescription:function(t){e(ja(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:F.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(ka())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=Te.validateOrgHomeUrl(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.EDIT_ORG_UPDATE_HOME_URL_ERROR,homeUrl:a,error:i}):t({type:F.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a}),t(ka())}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=Te.validateOrgHomeUrl(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a}),t(ka())}}(t))}}})(La),xa=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){return b.createElement("div",null,"Fetching your organizations and other stuff...")}},{key:"renderError",value:function(){if(this.props.view.error)return b.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return b.createElement(Pa,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var Ba=Object(P.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(Da(t))},onUnload:function(){e({type:F.EDIT_ORG_UNLOAD})}}})(xa),Wa=(r(316),function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).tokenRef=void 0,r.tokenRef=b.createRef(),r.props.checkAuth(),r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return b.createElement("div",{className:"Auth-form"},"Token: ",b.createElement("input",{ref:this.tokenRef,style:{width:"30em"}}),b.createElement(Kt.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return b.createElement("div",{className:"Auth-toolbar"},"Logged in as ",b.createElement("b",null,b.createElement("span",null,this.props.authorization.authorization.realname)," (",b.createElement("span",null,this.props.authorization.authorization.username)),")"," ",b.createElement(Kt.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case v.NONE:case v.CHECKING:return b.createElement("div",null);case v.AUTHORIZED:return b.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case v.UNAUTHORIZED:return b.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},b.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case v.ERROR:return b.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},b.createElement("p",null,"Error"),this.props.authorization.message);default:return b.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case v.NONE:case v.CHECKING:return b.createElement("div",null);case v.AUTHORIZED:return b.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case v.UNAUTHORIZED:return b.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},b.createElement("p",null,"Not authorized!"));case v.ERROR:return b.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},b.createElement("p",null,"Error: ??"));default:return b.createElement("div",null)}}},{key:"render",value:function(){return b.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(b.Component)),qa=r(95),Ha="",Fa="api/V2/token",Qa="api/V2/me",Ja=function(){function e(t){var r=t.url;Object(C.a)(this,e),this.url=void 0,this.url=r}return Object(D.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([Ha]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([Fa]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([Qa]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function Za(e){return{type:F.AUTH_CHECK_ERROR,error:e}}function Ya(e,t,r,n){return{type:F.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function Ka(){return{type:F.AUTH_UNAUTHORIZED}}function Xa(){return function(e,t){e({type:F.AUTH_CHECK_START});var r=t().app.config.services.Auth.url,n=qa.get("kbase_session");if(n){var a=new Ja({url:r});Promise.all([a.getTokenInfo(n),a.getMe(n)]).then(function(t){var r=Object(Ee.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(Ya(n,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(Za({code:"error",message:t.message}))})}else e(Ka())}}var $a=Object(P.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(Xa())},onRemoveAuthorization:function(){e(function(e,t){qa.remove("kbase_session"),e(Ka())})},onAddAuthorization:function(t){e(function(e){return function(t,r){var n=r().app.config.services.Auth.url;qa.set("kbase_session",e);var a=new Ja({url:n});Promise.all([a.getTokenInfo(e),a.getMe(e)]).then(function(r){var n=Object(Ee.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(Ya(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(Za({code:"error",message:e.message}))})}}(t))}}})(Wa),ei=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(C.a)(this,e),this.name=void 0,this.onSuccess=void 0,this.onError=void 0,this.name=r,this.onSuccess=n,this.onError=a},ti=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).started=void 0,r.timeout=void 0,r.started=new Date,r.timeout=e.timeout||5e3,r}return Object(U.a)(t,e),t}(ei),ri=function(){function e(t){var r=t.name,n=t.payload,a=t.channelId;Object(C.a)(this,e),this.name=void 0,this.payload=void 0,this.id=void 0,this.created=void 0,this.channelId=void 0,this.envelope=void 0,this.name=r,this.payload=n,this.id=zn()(),this.created=new Date,this.channelId=a,this.envelope=null}return Object(D.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channelId:this.channelId},name:this.name,payload:this.payload}}}]),e}(),ni=function(){function e(t){if(Object(C.a)(this,e),this.window=void 0,this.host=void 0,this.id=void 0,this.awaitingResponse=void 0,this.waitingListeners=void 0,this.listeners=void 0,this.lastId=void 0,this.sentCount=void 0,this.receivedCount=void 0,this.unwelcomeReceivedCount=void 0,this.unwelcomeReceivedCountThreshhold=void 0,this.unwelcomeReceiptWarning=void 0,this.unwelcomeReceiptWarningCount=void 0,this.currentListener=void 0,this.window=t.window||window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||zn()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(D.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("TS No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",t.envelope,t.envelope.channelId,this.id));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new ei({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new ri({name:e,payload:t,channelId:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new ri({name:e,payload:t,channelId:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,s=function(){var r=i.value,n=(c=Object(Ee.a)(r,2))[0];0===c[1].filter(function(e){if(e instanceof ti){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},o=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var c;s()}}catch(l){n=!0,a=l}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new ti({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new ti({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),ai=function(){function e(){Object(C.a)(this,e),this.params=void 0,this.channel=void 0,this.params=null,this.channel=new ni({window:window,host:document.location.origin})}return Object(D.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:zn()(),params:{groupsServiceURL:"/services/groups",userProfileServiceURL:"/services/user_profile/rpc",workspaceServiceURL:"/services/ws",serviceWizardURL:"/services/service_wizard",feedsServiceURL:"/services/feeds",authServiceURL:"/services/auth",originalPath:"",view:null,viewParams:null},parentHost:document.location.origin}}}]),e}(),ii=function(){function e(){Object(C.a)(this,e)}return Object(D.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}},{key:"getChannelID",value:function(){return window.frameElement&&window.frameElement.hasAttribute("data-channel")?window.frameElement.getAttribute("data-channel"):null}},{key:"getIframeElement",value:function(){return window.frameElement||null}}]),e}();function si(e){return{type:F.APP_SUCCESS,config:e}}r(318);var oi=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).channel=void 0,r.channel=null,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"setupChannel",value:function(){this.props.channelId&&(this.channel=new ni({channelId:this.props.channelId}),this.channel.on("navigate",function(e){e.to,e.params},function(e){console.error('Error processing "navigate" message')}),this.channel.start(),this.channel.send("ready",{channelId:this.props.channelId,greeting:"heloooo"}))}},{key:"teardownChannel",value:function(){}},{key:"componentDidMount",value:function(){this.props.onAppStart()}},{key:"componentDidUpdate",value:function(){this.setupChannel()}},{key:"componentWillUnmount",value:function(){this.teardownChannel()}},{key:"render",value:function(){return this.props.status===p.NONE?b.createElement("div",{className:"KBaseIntegration"},"Loading..."):b.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(b.Component);var ci=Object(P.b)(function(e,t){var r=e.app,n=r.status,a=r.config;return{status:n,defaultPath:a.defaultPath,channelId:a.channelId}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new ii).getParamsFromIFrame();if(r){var n,a=r.channelId;switch(r.params.view){case"org":n="/viewOrganization/"+r.params.viewParams.id,window.history.pushState(null,"test",n);break;default:n="/organizations",window.history.pushState(null,"organizations","/organizations")}e(si({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL},Auth:{url:r.params.authServiceURL}},defaultPath:n,channelId:a}))}else e(si({baseUrl:"",services:{Groups:{url:(r=(new ai).getParamsFromIFrame()).params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL},Auth:{url:r.params.authServiceURL}},defaultPath:"/organizations",channelId:null}))})}}})(oi);function li(e){return{type:F.INVITE_USER_LOAD_ERROR,error:e}}function ui(e){return{type:F.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Ei(e){return{type:F.INVITE_USER_SELECT_USER_ERROR,error:e}}function di(e){return function(t,r){t({type:F.INVITE_USER_SELECT_USER_START});var n=r(),a=n.views.inviteUserView.viewModel,i=n.auth.authorization,s=i.token,o=(i.username,n.app.config);a?new It({token:s,userProfileServiceURL:o.services.UserProfile.url}).getUser(e).then(function(e){var r=function(e,t){if(e.username===t.owner.username)return Se.OWNER;var r=t.members.find(function(t){return t.username===e.username});if(r)switch(r.type){case l.ADMIN:return Se.ADMIN;case l.OWNER:return Se.OWNER;case l.MEMBER:return Se.MEMBER}return Se.VIEW}(e,a.organization);t(function(e,t){return{type:F.INVITE_USER_SELECT_USER_SUCCESS,user:e,relation:t}}(e,r))}).catch(function(e){t(Ei({code:e.name,message:e.message}))}):t(Ei({code:"invalid state",message:"select user invalid state -- no view value"}))}}function vi(){return function(e,t){e({type:F.INVITE_USER_SEND_INVITATION_START});var r=t(),n=r.auth.authorization,a=n.token,i=n.username,s=r.app.config,o=r.views.inviteUserView,c=o.loadingState,l=o.viewModel;o.error;if(c===R.SUCCESS&&null!==l){var u=l,E=u.selectedUser,d=u.organization.id;if(E)new be({token:a,username:i,groupsServiceURL:s.services.Groups.url}).inviteUserToJoinOrg(d,E.user.username).then(function(t){e({type:F.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){var r;e((r={code:t.name,message:t.message},{type:F.INVITE_USER_SEND_INVITATION_ERROR,error:r}))})}}}r(320),r(322);var mi=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return b.createElement("div",{className:"User"},b.createElement("div",{className:"avatarCol"},b.createElement(wt,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"infoCol"},b.createElement("div",{className:"name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),b.createElement("div",{className:"organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}}]),t}(b.Component),pi=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).lastSearchAt=void 0,r.searchInput=void 0,r.searchButton=void 0,r.lastSearchAt=null,r.searchInput=b.createRef(),r.searchButton=b.createRef(),r.state={cancelToViewMembers:!1,cancelToBrowser:!1,cancelToViewer:!1,autocompleteMessage:""},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onClickCancelToViewMembers",value:function(){this.setState({cancelToViewMembers:!0})}},{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"onShowInfo",value:function(){mt.a.info({title:"Invite User Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the invite user tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=b.createElement(b.Fragment,null,b.createElement("span",null,b.createElement(ct.a,{to:"/viewOrganization/".concat(this.props.organization.id)},b.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),b.createElement(vt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),b.createElement(vt.a,{type:"tool"})," ",b.createElement("span",{style:{fontSize:"120%"}},"Invite a User to Join Org"))),t=b.createElement(b.Fragment,null);return b.createElement(tr,{breadcrumbs:e,buttons:t})}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return b.createElement(ot.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?b.createElement(ot.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===Se.NONE?b.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},b.createElement("div",{className:"name "},t.realname," (",t.username,")")):b.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},b.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return b.createElement("div",{className:"orgInfo"},b.createElement("div",{className:"name"},b.createElement("span",{className:"field-label"},"name"),b.createElement("span",null,this.props.organization.name)),b.createElement("div",{className:"description"},b.createElement("span",{className:"field-label"},"description"),b.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===Se.VIEW?e=b.createElement(Kt.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=b.createElement(Kt.a,{disabled:!0,type:"primary"},"Send Invitation"),t=b.createElement("div",null,"User may not be invited because:",b.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=b.createElement(ot.a,{type:"warning",message:t,showIcon:!0})):(e=b.createElement(Kt.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),b.createElement("div",{className:"invitationForm"},b.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),b.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case w.NONE:return b.createElement("div",null,"NONE");case w.EDITING:return b.createElement("div",null,"EDITING");case w.SENDABLE:return b.createElement("div",null,"SENDABLE");case w.SENDING:return b.createElement("div",null,"SENDING");case w.SUCCESS:return b.createElement("div",null,"SENT SUCCESSFULLY");case w.ERROR:return b.createElement("div",null,"ERROR SENDING");default:return b.createElement("div",null,"Bad State")}}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return b.createElement(An,{organizationId:this.props.organization.id})}},{key:"renderRelation",value:function(e){switch(e){case Se.NONE:return b.createElement("span",null,b.createElement(vt.a,{type:"stop"}),"None");case Se.VIEW:return b.createElement("span",null,b.createElement(vt.a,{type:"stop"})," Not a member");case Se.MEMBER_REQUEST_PENDING:return b.createElement("span",null,b.createElement(vt.a,{type:"user",style:{color:"orange"}})," User's membership ",b.createElement("b",null,"request")," is pending");case Se.MEMBER_INVITATION_PENDING:return b.createElement("span",null,b.createElement(vt.a,{type:"user",style:{color:"blue"}})," User has been ",b.createElement("b",null,"invited")," to join");case Se.MEMBER:return b.createElement("span",null,b.createElement(vt.a,{type:"user"})," User is a ",b.createElement("b",null,"member")," of this organization");case Se.ADMIN:return b.createElement("span",null,b.createElement(vt.a,{type:"unlock"}),"User is an ",b.createElement("b",null,"admin")," of this organization");case Se.OWNER:return b.createElement("span",null,b.createElement(vt.a,{type:"crown"})," User is the ",b.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?b.createElement("div",{className:"selectedUser"},b.createElement("p",{className:"noSelection"},"No user yet selected")):b.createElement("div",{className:"selectedUser"},b.createElement(mi,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return b.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return b.createElement(vt.a,{type:"search"})}},{key:"renderMenuButtons",value:function(){return b.createElement("div",{className:"ButtonSet"},b.createElement("div",{className:"ButtonSet-button"},b.createElement(Kt.a,{icon:"rollback",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Back to Org")))}},{key:"render",value:function(){return this.state.cancelToViewMembers?b.createElement(Tr.a,{push:!0,to:"/viewMembers/"+this.props.organization.id}):this.state.cancelToBrowser?b.createElement(Tr.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?b.createElement(Tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):b.createElement("div",{className:"InviteUser scrollable-flex-column"},b.createElement(ar,{buttons:this.renderMenuButtons()}),this.renderOrgHeader(),b.createElement("div",{className:"row scrollable-flex-column"},b.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},b.createElement("h3",null,"Select User to Invite"),b.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},b.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),b.createElement(Kt.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),b.createElement("div",{className:"usersTable"},this.renderUsers())),b.createElement("div",{className:"col1 lastCol"},b.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(b.Component);pi.searchDebounce=200;var Oi=pi;var Ri=Object(P.b)(function(e,t){if(!e.views.inviteUserView||null===e.views.inviteUserView.viewModel)throw new Error("Runtime Error - invite members view is not defined!");var r=e.views.inviteUserView.viewModel;return{organization:r.organization,users:r.users,selectedUser:r.selectedUser,editState:r.editState}},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,u,E,d,v,m,p,O,R,h;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(ui(null)),t.abrupt("return");case 4:if(a=n(),i=a.views.inviteUserView.viewModel,s=a.auth.authorization,o=s.token,s.username,c=a.app.config,null!==i){t.next=7;break}return t.abrupt("return");case 7:return u=i.organization,E=new It({token:o,userProfileServiceURL:c.services.UserProfile.url}),d=u.owner.username,v=[],m=[],p=[],O=[],u.members.forEach(function(e){switch(e.type){case l.MEMBER:m.push(e.username);case l.ADMIN:v.push(e.username)}}),t.prev=16,t.next=19,E.searchUsers(e);case 19:R=t.sent,h=R.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?Se.OWNER:v.indexOf(t)>=0?Se.ADMIN:p.indexOf(t)>=0?Se.MEMBER_INVITATION_PENDING:O.indexOf(t)>=0?Se.MEMBER_REQUEST_PENDING:m.indexOf(t)>=0?Se.MEMBER:Se.NONE}}),r(ui(h)),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(16),r((w={code:t.t0.name,message:t.t0.message},{type:F.INVITE_USER_SEARCH_USERS_ERROR,error:w}));case 27:case"end":return t.stop()}var w},t,this,[[16,24]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){e(di(t))},onSendInvitation:function(){e(vi())}}})(Oi),hi=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){return b.createElement("div",null,"Loading Users...")}},{key:"renderError",value:function(){return b.createElement("div",null,"Error!")}},{key:"render",value:function(){switch(this.props.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return b.createElement(Ri,null)}}},{key:"componentDidMount",value:function(){switch(this.props.loadingState){case R.NONE:this.props.onInviteUserLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var wi=Object(P.b)(function(e,t){return{loadingState:e.views.inviteUserView.loadingState}},function(e){return{onInviteUserLoad:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:if((u=t.sent).kind===Ne.NORMAL){t.next=10;break}return r(li({code:"invalid state",message:'Organization kind must be "NORMAL"'})),t.abrupt("return");case 10:r((E=u,{type:F.INVITE_USER_LOAD_SUCCESS,organization:E,users:null})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),r(li({code:t.t0.name,message:t.t0.message}));case 16:case"end":return t.stop()}var E},t,this,[[3,13]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:F.INVITE_USER_UNLOAD})}}})(hi);function _i(e){return{type:F.MANAGE_MEMBERSHIP_LOAD_ERROR,error:e}}function gi(){return function(e,t){var r=t();if(!r.views.manageMembershipView.viewModel)throw new Error("Argh, no view model");r.views.manageMembershipView.viewModel.editableMemberProfile.title.validationState.type===o.OK?e({type:F.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS}):e({type:F.MANAGE_MEMBERSHIP_EVALUATE_ERROR})}}r(324);var Si=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"doLeaveOrg",value:function(){var e=this,t=function(){e.doLeaveOrgConfirmed()}.bind(this);mt.a.confirm({title:"Really leave this organization?",content:b.createElement("p",null,"This is not reversible."),width:"50em",onOk:function(){t()}})}},{key:"doLeaveOrgConfirmed",value:function(){this.props.onLeaveOrganization(this.props.organization.id)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onTitleChange",value:function(e){e.persist(),this.props.onUpdateTitle(e.target.value)}},{key:"doShowInfo",value:function(){mt.a.info({title:"Manage My Membership Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the view to help you manage your membership..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=b.createElement(b.Fragment,null,b.createElement("span",null,b.createElement(ct.a,{to:"/viewOrganization/".concat(this.props.organization.id)},b.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),b.createElement(vt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),b.createElement(vt.a,{type:"user"})," ",b.createElement("span",{style:{fontSize:"120%"}},"Manage your membership"))),t=b.createElement(b.Fragment,null,b.createElement(Kt.a,{type:"danger",icon:"frown",onClick:this.doLeaveOrg.bind(this)},"Leave Organization...")," ");return b.createElement(tr,{breadcrumbs:e,buttons:t})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return b.createElement(An,{organizationId:this.props.organization.id})}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"ManageMembership-validation-error"}switch(e.syncState){case i.DIRTY:return"ManageMembership-sync-dirty";default:return"ManageMembership-validation-ok"}}},{key:"renderEditor",value:function(){return b.createElement("form",{id:"editMembership",className:"ManageMembership-editorTable",onSubmit:this.onSubmit.bind(this)},b.createElement("div",{className:"ManageMembership-headerRow"},b.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Edit"),b.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Preview")),b.createElement("div",{className:"ManageMembership-editorTable-row"},b.createElement("div",{className:"ManageMembership-editCol ManageMembership-editCell"},b.createElement("div",{className:"ManageMembership-editorTable-labelCol"},b.createElement("span",{className:"field-label ManageMembership-titleLabel"},"title")),b.createElement("div",{className:"ManageMembership-editorTable-controlCol"},b.createElement(Mr.a,{value:this.props.editableMemberProfile.title.value||"",className:this.calcFieldClass(this.props.editableMemberProfile.title),onChange:this.onTitleChange.bind(this)}))),b.createElement("div",{className:"ManageMembership-previewCol ManageMembership-previewCell"},b.createElement("div",{className:"ManageMembership-titlePreview"},this.props.editableMemberProfile.title.value))),b.createElement("div",{className:"ManageMembership-editorFooter"},b.createElement(Kt.a,{icon:"save",form:"editMembership",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")))}},{key:"render",value:function(){return b.createElement("div",{className:"ManageMembership"},this.renderOrgHeader(),this.renderHeader(),b.createElement("h3",null,"Edit Your Membership Profile"),b.createElement("div",{className:"ManageMembership-body"},this.renderEditor()))}}]),t}(b.Component);var fi=Object(P.b)(function(e,t){if(!e.views.manageMembershipView.viewModel)throw new Error("View model missing");var r=e.auth.authorization.username,n=e.views.manageMembershipView.viewModel;return{username:r,organization:n.organization,editableMemberProfile:n.editableMemberProfile,editState:n.editState,saveState:n.saveState,validationState:n.validationState}},function(e){return{onLeaveOrganization:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r({type:F.MANAGE_MEMBERSHIP_LEAVE_ORG_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url});try{l.removeMember(e,o),r({type:F.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS})}catch(u){console.error("ERROR leaving org",u),r({type:F.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,error:{code:u.name,message:u.message}})}case 4:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUpdateTitle:function(t){e(function(e){return function(t){var r=Te.validateMemberTitle(e),n=Object(Ee.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,error:jn({code:"invalid",message:i.message})}):t({type:F.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,title:a}),t(gi())}}(t))},onSave:function(){e(function(){var e=Object(me.a)(ve.a.mark(function e(t,r){var n,a,i,s,o,c,l,u,E,d;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:F.MANAGE_MEMBERSHIP_SAVE_START}),(n=r()).views.manageMembershipView.viewModel){e.next=4;break}throw new Error("Argh, no view model?!?");case 4:return a=n.auth.authorization,i=a.token,s=a.username,o=n.views.manageMembershipView.viewModel,c=o.organization,l=o.editableMemberProfile,u=n.app.config,E={title:l.title.value},d=new We({token:i,username:s,groupsServiceURL:u.services.Groups.url}),e.prev=7,e.next=10,d.updateMember(c.id,s,E);case 10:t({type:F.MANAGE_MEMBERSHIP_SAVE_SUCCESS}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(7),console.error("error saving member profile",e.t0),t({type:F.MANAGE_MEMBERSHIP_SAVE_ERROR,error:jn({code:"error",message:e.t0.message})});case 17:t(gi());case 18:case"end":return e.stop()}},e,this,[[7,13]])}));return function(t,r){return e.apply(this,arguments)}}())}}})(Si),Ai=r(348),Ni=(r(326),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderDetail",value:function(){return b.createElement("table",{className:"errorTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,b.createElement("span",{className:"field-label"},"generated at")),b.createElement("td",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.error.at))),b.createElement("tr",null,b.createElement("th",null,b.createElement("span",{className:"field-label"},"error id")),b.createElement("td",null,b.createElement("span",{style:{fontFamily:"monospace"}},this.props.error.id))),b.createElement("tr",null,b.createElement("th",null,b.createElement("span",{className:"field-label"},"explanation")),b.createElement("td",null,this.props.error.detail))))}},{key:"renderInfo",value:function(){return this.props.error.info?b.createElement("div",null,"additional info here ..."):b.createElement("div",{style:{textAlign:"left",fontStyle:"italic"}},"No additional information")}},{key:"render",value:function(){var e=b.createElement("div",null,b.createElement("p",null,this.props.error.message),b.createElement(Ai.a,{bordered:!1,style:{backgroundColor:"transparent"}},b.createElement(Ai.a.Panel,{header:"detail",key:"1",style:{backgroundColor:"transparent"}},this.renderDetail())),b.createElement(Ai.a,{bordered:!1,style:{backgroundColor:"transparent"}},b.createElement(Ai.a.Panel,{header:"additional info",key:"1",style:{backgroundColor:"transparent"}},this.renderInfo())));return b.createElement(ot.a,{type:"error",showIcon:!0,message:"Error",className:"Error",description:e})}}]),t}(b.Component)),Ii=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoadingNone",value:function(){return b.createElement("div",null,"Loading membership editor (none)...")}},{key:"renderLoading",value:function(){return b.createElement("div",null,"Loading membership editor...")}},{key:"renderError",value:function(e){return b.createElement(Ni,{error:e})}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.renderLoadingNone();case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(oa({code:"missing-error",message:"The error appears to be missing"}));default:return b.createElement(fi,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var bi,Ti=Object(P.b)(function(e,t){return{view:e.views.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,s,c,l,u,E,d,v,m;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.MANAGE_MEMBERSHIP_LOAD_START}),a=n(),s=a.auth.authorization,c=s.token,l=s.username,u=a.app.config,E=new We({token:c,username:l,groupsServiceURL:u.services.Groups.url}),t.prev=3,t.next=6,E.getOrg(e);case 6:if((d=t.sent).kind===Ne.NORMAL){t.next=10;break}return r(_i(jn({code:"invalid state",message:'Organization must be of kind "NORMAL"'}))),t.abrupt("return");case 10:if(d.isMember){t.next=13;break}return r(_i(jn({code:"notfound",message:'The user "'+l+'" is not a member of this org'}))),t.abrupt("return");case 13:if(v=d.members.find(function(e){return e.username===l})){t.next=17;break}return r(_i(jn({code:"notfound",message:'The user "'+l+'" was not found in the members list'}))),t.abrupt("return");case 17:m={title:{value:v.title||"",remoteValue:v.title,syncState:i.NEW,validationState:{type:o.OK,validatedAt:new Date}}},r((p=d,O=m,{type:F.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:p,editableMemberProfile:O})),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(3),console.error("Error :(",t.t0),r(_i(jn({code:t.t0.name,message:t.t0.message})));case 25:case"end":return t.stop()}var p,O},t,this,[[3,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:F.MANAGE_MEMBERSHIP_UNLOAD})}}})(Ii);r(329);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(bi||(bi={}));var yi=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={navigateTo:bi.NONE},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"doCancelToBrowser",value:function(){this.setState({navigateTo:bi.BROWSER})}},{key:"doCancelToViewer",value:function(){this.setState({navigateTo:bi.VIEWER})}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doShowInfo",value:function(){mt.a.info({title:"Request to Add Narrative Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the view to help you request the addition of a narrative to this org..."))})}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative.narrative.workspaceId):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return b.createElement(An,{organizationId:this.props.organization.id})}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=b.createElement(b.Fragment,null,b.createElement("span",null,b.createElement(ct.a,{to:"/viewOrganization/".concat(this.props.organization.id)},b.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),b.createElement(vt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),b.createElement(vt.a,{type:"plus"})," ",b.createElement("span",{style:{fontSize:"120%"}},"Add Narrative to Org"))),t=b.createElement(b.Fragment,null,b.createElement(Kt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return b.createElement(tr,{breadcrumbs:e,buttons:t})}},{key:"renderPermission",value:function(e){switch(e.access){case kt.VIEW:return b.createElement("span",null,b.createElement(vt.a,{type:"eye"})," View");case kt.EDIT:return b.createElement("span",null,b.createElement(vt.a,{type:"edit"})," Edit");case kt.ADMIN:return b.createElement("span",null,b.createElement(vt.a,{type:"unlock"})," Admin");case kt.OWNER:return b.createElement("span",null,b.createElement(vt.a,{type:"crown"})," Owner");default:return b.createElement("span",null,"ERROR")}}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement("span",null,b.createElement(vt.a,{type:"global"})," Public"):b.createElement("span",null,b.createElement(vt.a,{type:"lock"})," Private")}},{key:"renderNarrative",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"RequestNarrative-title"},e.title),b.createElement("div",{className:"RequestNarrative-publicPermission"},this.renderPublicPermission(e)),b.createElement("div",{className:"RequestNarrative-modifiedAt"},b.createElement("span",{className:"field-label"},b.createElement(vt.a,{type:"save"}))," ",b.createElement(Ft,{time:e.lastSavedAt,tooltipPrefix:"last saved "})))}},{key:"renderNarratives",value:function(){var e=this;return 0===this.props.narratives.length?b.createElement("div",{className:"message"},"You do not have any Narratives"):this.props.narratives.map(function(t,r){var n,a=t.status,i=t.narrative,s=["RequestNarrative-narrativeCell"];switch(!(!e.props.selectedNarrative||i.workspaceId!==e.props.selectedNarrative.narrative.workspaceId)&&s.push("RequestNarrative-selected"),a){case _.ASSOCIATED:s.push("RequestNarrative-narrativeInOrg"),n=b.createElement(dt.a,{title:"This narrative is already associated with this organization"},b.createElement(vt.a,{type:"check",style:{color:"green"}}));break;case _.REQUESTED:s.push("RequestNarrative-narrativeInOrg"),n=b.createElement(dt.a,{title:"You have already requested that this narrative be added to this organization"},b.createElement(vt.a,{type:"loading",style:{color:"orange"}}));break;default:s.push("RequestNarrative-narrativeNotInOrg")}return b.createElement("div",{className:s.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},b.createElement("div",{className:"RequestNarrative-narrativeFlag"},n),b.createElement("div",{className:"RequestNarrative-narrative"},e.renderNarrative(t.narrative)))})}},{key:"onSearchSubmit",value:function(){console.log("searching...")}},{key:"renderSearchIcon",value:function(){return this.props.searching?b.createElement(vt.a,{type:"loading"}):b.createElement(vt.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return b.createElement("form",{id:"searchForm",className:"RequestNarrative-searchBar",onSubmit:this.onSearchSubmit.bind(this)},b.createElement("input",{placeholder:"Search your Narratives",autoFocus:!0}),b.createElement(Kt.a,{className:"RequestNarrative-button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"renderFeedbackBar",value:function(){return b.createElement("div",null,"Showing"," ",Intl.NumberFormat("en-US",{style:"decimal",useGrouping:!0}).format(this.props.narratives.length)," ","narratives")}},{key:"onSortByChange",value:function(e){switch(e){case"title":this.props.doSortBy(Ut.TITLE);break;case"savedAt":this.props.doSortBy(Ut.LAST_SAVED)}}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return b.createElement("div",{className:"RequestNarrative-filterSortBar"},b.createElement("span",{className:"field-label"},"sort by"),b.createElement(Xt.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},b.createElement(Xt.a.Option,{value:"title",key:"title"},"Title"),b.createElement(Xt.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")))}},{key:"renderNarrativeSelector",value:function(){return b.createElement("div",{className:"RequestNarrative-narrativeSelector scrollable-flex-column"},b.createElement("div",{style:{display:"flex",flexDirection:"row"}},b.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),b.createElement("div",{className:"RequestNarrative-feedbackBar"},this.renderFeedbackBar()),b.createElement("div",{className:"RequestNarrative-narratives scrollable-flex-column"},b.createElement("div",{className:"RequestNarrative-narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===_.ASSOCIATED?b.createElement(ot.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===_.REQUESTED?b.createElement(ot.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===Se.ADMIN||this.props.relation.type===Se.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",b.createElement(Kt.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?b.createElement("div",{className:"RequestNarrative-selectedNarrative"},b.createElement("div",{className:"RequestNarrative-title"},this.props.selectedNarrative.narrative.title),b.createElement("div",null,b.createElement("span",{className:"field-label"},b.createElement(vt.a,{type:"save"}))," ",b.createElement(Ft,{time:this.props.selectedNarrative.narrative.lastSavedAt,tooltipPrefix:"last saved "}))):b.createElement(ot.a,{type:"info",message:"Select a narrative on the left to show it here and be able to add it to this organization."})}},{key:"renderMenuButtons",value:function(){return b.createElement("div",{className:"ButtonSet"},b.createElement("div",{className:"ButtonSet-button"},b.createElement(Kt.a,{icon:"rollback",type:"danger",onClick:this.doCancelToViewer.bind(this)},"Back to Org")),b.createElement("div",{className:"ButtonSet-button"},b.createElement(Kt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)})))}},{key:"render",value:function(){switch(this.state.navigateTo){case bi.BROWSER:return b.createElement(Tr.a,{push:!0,to:"/organizations"});case bi.VIEWER:return b.createElement(Tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id});case bi.NONE:}return b.createElement("div",{className:"RequestNarrative scrollable-flex-column"},b.createElement(ar,{buttons:this.renderMenuButtons()}),this.renderOrgHeader(),b.createElement("div",{className:"RequestNarrative-body scrollable-flex-column"},b.createElement("div",{className:"RequestNarrative-selectNarrativeCol scrollable-flex-column"},b.createElement("h3",null,"Select a Narrative"),this.renderNarrativeSelector()),b.createElement("div",{className:"RequestNarrative-selectedNarrativeCol"},b.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),b.createElement("div",{className:"RequestNarrative-selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),b.createElement("div",{className:"RequestNarrative-footer"}))}}]),t}(b.Component);function Mi(e){return function(t,r){t({type:F.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:F.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}var Ci=Object(P.b)(function(e,t){if(null===e.views.requestNarrativeView.viewModel)throw new Error("view value is not defined!");var r=e.views.requestNarrativeView.viewModel;return{organization:r.organization,relation:r.relation,narratives:r.narratives,selectedNarrative:r.selectedNarrative,searching:!1,sortBy:"title",filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(me.a)(ve.a.mark(function r(n,a){var i,s,o,c,l,u,E;return ve.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:F.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,u=new We({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=3,r.next=6,u.addOrRequestNarrativeToGroup(e,t);case 6:E=r.sent,n((v=E,{type:F.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:v})),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n((d={code:r.t0.name,message:r.t0.message},{type:F.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 13:case"end":return r.stop()}var d,v},r,this,[[3,10]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(Mi(t))},doSortBy:function(t){var r;e((r=t,function(){var e=Object(me.a)(ve.a.mark(function e(t,n){var a,i,s,o,c,l,u,E;return ve.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:F.REQUEST_ADD_NARRATIVE_SORT_START}),a=n(),null!==(i=a.views.requestNarrativeView.viewModel)){e.next=6;break}return t({type:F.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:oa({code:"error",message:"viewmodel missing"})}),e.abrupt("return");case 6:s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new Pt({token:o,username:c,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,workspaceServiceURL:l.services.Workspace.url});try{E=u.sortOrganizationNarratives(i.narratives,r),t({type:F.REQUEST_ADD_NARRATIVE_SORT_SUCCESS,narratives:E})}catch(d){t({type:F.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:oa({code:"error",message:d.message})})}case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()))}}})(yi),Di=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){return b.createElement("div",null,"Loading Your Narratives...")}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return b.createElement(Ci,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var Vi=Object(P.b)(function(e,t){return{view:e.views.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(me.a)(ve.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,p,O,R,h;return ve.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new We({token:s,username:o,groupsServiceURL:c.services.Groups.url}),u=new Pt({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url}),E=new be({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,Promise.all([l.getOrganization(e),u.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,v=Object(Ee.a)(d,4),m=v[0],p=v[1],O=v[2],R=v[3],h=ye(m,o,O,R),r((_=m,g=p,S=h,{type:F.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:_,narratives:g,relation:S})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((w={code:t.t0.name,message:t.t0.message},{type:F.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:w}));case 22:case"end":return t.stop()}var w,_,g,S},t,this,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:F.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(Di),ki=function(){function e(){Object(C.a)(this,e)}return Object(D.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map},organizations:{byId:new Map}},db:{notifications:{all:[],byId:new Map}},views:{browseOrgsView:{loadingState:R.NONE,error:null,viewModel:null},organizationCentricView:{loadingState:R.NONE,error:null,viewModel:null},addOrgView:{loadingState:R.NONE,error:null,viewModel:null},editOrgView:{loadingState:R.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:R.NONE,error:null,viewModel:null},viewMembersView:{loadingState:R.NONE,error:null,viewModel:null},inviteUserView:{loadingState:R.NONE,error:null,viewModel:null},manageMembershipView:{loadingState:R.NONE,error:null,viewModel:null},requestNarrativeView:{loadingState:R.NONE,error:null,viewModel:null},viewOrgView:{loadingState:R.NONE,error:null,viewModel:null}},auth:{status:v.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:p.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Feeds:{url:""},Auth:{url:""}},defaultPath:"",channelId:null}},updateOrg:{pending:!1}}}}]),e}(),Ui=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"componentWillMount",value:function(){this.props.onLoad()}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}},{key:"render",value:function(){return this.props.children}}]),t}(b.Component);var zi=Object(P.b)(function(e,t){return{}},function(e){return{onLoad:function(){e(Gr())},onUnload:function(){e({type:F.DATA_SERVICE_UNLOAD})}}})(Ui),ji=b.createContext(null),Gi=ji.Provider;ji.Consumer;it.a.add(st.c,st.b,st.a,st.d);var Li=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"link",value:function(e,t,r){if(this.options.sanitize){var n;try{n=decodeURIComponent(this.options.unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return r}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return r}var a='<a href="'+e+'"';return t&&(a+=' title="'+t+'"'),a+=' target="_blank">'+r+"</a>"}}]),t}(yr.Renderer);(new yr.MarkedOptions).renderer=new Li,yr.Marked.setOptions({renderer:new Li});var Pi=!!window.frameElement,xi=ki.makeInitialState(),Bi=Object(x.d)(at,xi,Object(x.c)(Object(x.a)(B.a))),Wi=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return T.a.createElement(Gi,{value:{test:"ok"}},T.a.createElement(P.a,{store:Bi},T.a.createElement(ci,null,T.a.createElement($a,{hosted:Pi},T.a.createElement(zi,null,T.a.createElement(L.a,{basename:"/"},T.a.createElement("div",{className:"App scrollable-flex-column"},T.a.createElement("div",{className:"App-body scrollable-flex-column"},T.a.createElement(z.a,null,T.a.createElement(j.a,{path:"/organizations",component:vr}),T.a.createElement(j.a,{path:"/newOrganization",component:zr}),T.a.createElement(j.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return T.a.createElement(ya,{organizationId:t})}}),T.a.createElement(j.a,{path:"/editOrganization/:id",component:function(e){var t=e.match.params.id;return T.a.createElement(Ba,{organizationId:t})}}),T.a.createElement(j.a,{path:"/inviteUser/:id",component:function(e){var t=e.match.params.id;return T.a.createElement(wi,{organizationId:t})}}),T.a.createElement(j.a,{path:"/membership/:id",component:function(e){var t=e.match.params.id;return T.a.createElement(Ti,{organizationId:t})}}),T.a.createElement(j.a,{path:"/requestAddNarrative/:id",component:function(e){var t=e.match.params.id;return T.a.createElement(Vi,{organizationId:t})}}),T.a.createElement(G.a,{from:"/",to:"/organizations",exact:!0}))))))))))}}]),t}(b.Component);r(331),r(333),r(335);M.a.render(T.a.createElement(Wi,null),document.getElementById("root"))}},[[155,2,1]]]);
//# sourceMappingURL=main.a6c09e3b.chunk.js.map