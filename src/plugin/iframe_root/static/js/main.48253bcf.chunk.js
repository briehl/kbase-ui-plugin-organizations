(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{117:function(e,t,r){e.exports=r.p+"static/media/nouserpic.9af42ba9.png"},148:function(e,t,r){},159:function(e,t,r){e.exports=r(340)},164:function(e,t,r){},172:function(e,t,r){},174:function(e,t,r){},176:function(e,t,r){},180:function(e,t,r){},182:function(e,t,r){},236:function(e,t,r){},238:function(e,t,r){},247:function(e,t,r){},254:function(e,t,r){},264:function(e,t,r){},268:function(e,t,r){},270:function(e,t,r){},272:function(e,t,r){},274:function(e,t,r){},276:function(e,t,r){},278:function(e,t,r){},280:function(e,t,r){},282:function(e,t,r){},284:function(e,t,r){},286:function(e,t,r){},288:function(e,t,r){},290:function(e,t,r){},292:function(e,t,r){},294:function(e,t,r){},296:function(e,t,r){},298:function(e,t,r){},312:function(e,t,r){},314:function(e,t,r){},316:function(e,t,r){},318:function(e,t,r){},320:function(e,t,r){},323:function(e,t,r){},325:function(e,t,r){},327:function(e,t,r){},329:function(e,t,r){},332:function(e,t,r){},340:function(e,t,r){"use strict";r.r(t);var n,a,i,o,s,c,l,u,E,d,m,p,v,O,h,R,g,_,f,w,S,A,N=r(0),I=r.n(N),b=r(16),T=r.n(b),y=(r(164),r(4)),C=r(5),M=r(8),D=r(6),U=r(7),k=r(347),V=r(85),j=r(343),z=r(359),L=r(13),G=r(62),P=r(150),x=r(2),B=r(69),W=r(93);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.NEW=1]="NEW",e[e.DIRTY=2]="DIRTY",e[e.CLEAN=3]="CLEAN"}(i||(i={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(o||(o={})),function(e){e[e.OK=0]="OK",e[e.ERROR=1]="ERROR",e[e.REQUIRED_MISSING=2]="REQUIRED_MISSING"}(s||(s={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(c||(c={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(l||(l={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(u||(u={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(E||(E={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(d||(d={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(p||(p={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(v||(v={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(O||(O={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(g||(g={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(_||(_={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(f||(f={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(w||(w={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.PRIVATE_INACCESSIBLE=1]="PRIVATE_INACCESSIBLE"}(S||(S={})),function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR"}(A||(A={}));var q,H=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,o=e.info;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,a))).code=void 0,r.message=void 0,r.detail=void 0,r.trace=void 0,r.errors=void 0,r.info=void 0,r.name="AppException",r.code=n,r.message=a,r.detail=i,r.info=o,Error.captureStackTrace&&Error.captureStackTrace(Object(B.a)(Object(B.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(U.a)(t,e),t}(Object(W.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS=31]="VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS",e[e.VIEW_ORG_LOAD_NORMAL_SUCCESS=32]="VIEW_ORG_LOAD_NORMAL_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST=33]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=34]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=35]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=36]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=37]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=38]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=39]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=40]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=41]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=42]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=43]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=44]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST=45]="VIEW_ORG_ACCEPT_INBOX_REQUEST",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_START=46]="VIEW_ORG_ACCEPT_INBOX_REQUEST_START",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS=47]="VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR=48]="VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_INBOX_REQUEST=49]="VIEW_ORG_REJECT_INBOX_REQUEST",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_START=50]="VIEW_ORG_REJECT_INBOX_REQUEST_START",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS=51]="VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR=52]="VIEW_ORG_REJECT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=53]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=54]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=55]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=56]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=57]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=58]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=59]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=60]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=61]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=62]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=63]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=64]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST=65]="VIEW_PRIVATE_ORG_JOIN_REQUEST",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_START=66]="VIEW_PRIVATE_ORG_JOIN_REQUEST_START",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS=67]="VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR=68]="VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD=69]="VIEW_ORG_VIEW_MEMBERS_LOAD",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_START=70]="VIEW_ORG_VIEW_MEMBERS_LOAD_START",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS=71]="VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR=72]="VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_UNLOAD=73]="VIEW_ORG_VIEW_MEMBERS_UNLOAD",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER=74]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START=75]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=76]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR=77]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN=78]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=79]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=80]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=81]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER=82]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=83]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=84]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=85]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.ADD_ORG_LOAD=86]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=87]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=88]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=89]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=90]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=91]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=92]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=93]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_LOGO_URL=94]="ADD_ORG_UPDATE_LOGO_URL",e[e.ADD_ORG_UPDATE_LOGO_URL_SUCCESS=95]="ADD_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.ADD_ORG_UPDATE_LOGO_URL_ERROR=96]="ADD_ORG_UPDATE_LOGO_URL_ERROR",e[e.ADD_ORG_UPDATE_ID=97]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=98]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=99]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=100]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=101]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=102]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=103]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=104]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=105]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=106]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=107]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_UPDATE_HOME_URL=108]="ADD_ORG_UPDATE_HOME_URL",e[e.ADD_ORG_UPDATE_HOME_URL_SUCCESS=109]="ADD_ORG_UPDATE_HOME_URL_SUCCESS",e[e.ADD_ORG_UPDATE_HOME_URL_ERROR=110]="ADD_ORG_UPDATE_HOME_URL_ERROR",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS=111]="ADD_ORG_UPDATE_RESEARCH_INTERESTS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=112]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=113]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.ADD_ORG_EVALUATE=114]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=115]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=116]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=117]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=118]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=119]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=120]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=121]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=122]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=123]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=124]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=125]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=126]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=127]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=128]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=129]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=130]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=131]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=132]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_LOGO_URL=133]="EDIT_ORG_UPDATE_LOGO_URL",e[e.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS=134]="EDIT_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_LOGO_URL_ERROR=135]="EDIT_ORG_UPDATE_LOGO_URL_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=136]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=137]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=138]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=139]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=140]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=141]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_UPDATE_HOME_URL=142]="EDIT_ORG_UPDATE_HOME_URL",e[e.EDIT_ORG_UPDATE_HOME_URL_SUCCESS=143]="EDIT_ORG_UPDATE_HOME_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_HOME_URL_ERROR=144]="EDIT_ORG_UPDATE_HOME_URL_ERROR",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS=145]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=146]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=147]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.EDIT_ORG_EVALUATE=148]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=149]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=150]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=151]="AUTH_CHECK",e[e.AUTH_CHECK_START=152]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=153]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=154]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=155]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=156]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=157]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=158]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=159]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=160]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=161]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=162]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=163]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=164]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=165]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=166]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=167]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=168]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=169]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=170]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=171]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=172]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=173]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=174]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=175]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=176]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=177]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=178]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=179]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=180]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=181]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=182]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=183]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=184]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=185]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=186]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=187]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=188]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=189]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=190]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=191]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=192]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=193]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=194]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=195]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=196]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=197]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=198]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=199]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=200]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=201]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=202]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=203]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=204]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=205]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=206]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=207]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=208]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=209]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=210]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=211]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=212]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=213]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=214]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=215]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=216]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=217]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.MANAGE_MEMBERSHIP_UNLOAD=218]="MANAGE_MEMBERSHIP_UNLOAD",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG=219]="MANAGE_MEMBERSHIP_LEAVE_ORG",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED=220]="MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_START=221]="MANAGE_MEMBERSHIP_LEAVE_ORG_START",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS=222]="MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR=223]="MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE=224]="MANAGE_MEMBERSHIP_UPDATE_TITLE",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_START=225]="MANAGE_MEMBERSHIP_UPDATE_TITLE_START",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS=226]="MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR=227]="MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR",e[e.MANAGE_MEMBERSHIP_SAVE=228]="MANAGE_MEMBERSHIP_SAVE",e[e.MANAGE_MEMBERSHIP_SAVE_START=229]="MANAGE_MEMBERSHIP_SAVE_START",e[e.MANAGE_MEMBERSHIP_SAVE_SUCCESS=230]="MANAGE_MEMBERSHIP_SAVE_SUCCESS",e[e.MANAGE_MEMBERSHIP_SAVE_ERROR=231]="MANAGE_MEMBERSHIP_SAVE_ERROR",e[e.MANAGE_MEMBERSHIP_EVALUATE=232]="MANAGE_MEMBERSHIP_EVALUATE",e[e.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS=233]="MANAGE_MEMBERSHIP_EVALUATE_SUCCESS",e[e.MANAGE_MEMBERSHIP_EVALUATE_ERROR=234]="MANAGE_MEMBERSHIP_EVALUATE_ERROR",e[e.REQUEST_ADD_NARRATIVE_LOAD=235]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=236]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=237]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=238]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=239]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=240]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=241]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=242]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=243]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=244]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=245]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=246]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=247]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.DASHBOARD_LOAD=248]="DASHBOARD_LOAD",e[e.DASHBOARD_LOAD_START=249]="DASHBOARD_LOAD_START",e[e.DASHBOARD_LOAD_SUCCESS=250]="DASHBOARD_LOAD_SUCCESS",e[e.DASHBOARD_LOAD_ERROR=251]="DASHBOARD_LOAD_ERROR",e[e.DASHBOARD_UNLOAD=252]="DASHBOARD_UNLOAD",e[e.DASHBOARD_REFRESH=253]="DASHBOARD_REFRESH",e[e.DASHBOARD_REFRESH_START=254]="DASHBOARD_REFRESH_START",e[e.DASHBOARD_REFRESH_SUCCESS=255]="DASHBOARD_REFRESH_SUCCESS",e[e.DASHBOARD_REFRESH_ERROR=256]="DASHBOARD_REFRESH_ERROR",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST=257]="DASHBOARD_CANCEL_OUTBOX_REQUEST",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_START=258]="DASHBOARD_CANCEL_OUTBOX_REQUEST_START",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS=259]="DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR=260]="DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST=261]="DASHBOARD_ACCEPT_INBOX_REQUEST",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_START=262]="DASHBOARD_ACCEPT_INBOX_REQUEST_START",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS=263]="DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR=264]="DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR",e[e.DASHBOARD_REJECT_INBOX_REQUEST=265]="DASHBOARD_REJECT_INBOX_REQUEST",e[e.DASHBOARD_REJECT_INBOX_REQUEST_START=266]="DASHBOARD_REJECT_INBOX_REQUEST_START",e[e.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS=267]="DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_REJECT_INBOX_REQUEST_ERROR=268]="DASHBOARD_REJECT_INBOX_REQUEST_ERROR",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST=269]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_START=270]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_START",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_SUCCESS=271]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_ERROR=272]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_ERROR",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST=273]="DASHBOARD_REJECT_ORG_INBOX_REQUEST",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_START=274]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_START",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_SUCCESS=275]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_ERROR=276]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=277]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=278]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=279]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=280]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=281]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=282]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=283]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=284]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=285]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=286]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=287]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=288]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=289]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=290]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=291]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=292]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=293]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.GLOBAL_ACCESS_NARRATIVE=294]="GLOBAL_ACCESS_NARRATIVE",e[e.GLOBAL_ACCESS_NARRATIVE_START=295]="GLOBAL_ACCESS_NARRATIVE_START",e[e.GLOBAL_ACCESS_NARRATIVE_SUCCESS=296]="GLOBAL_ACCESS_NARRATIVE_SUCCESS",e[e.GLOBAL_ACCESS_NARRATIVE_ERROR=297]="GLOBAL_ACCESS_NARRATIVE_ERROR",e[e.NOTIFICATIONS_LOAD=298]="NOTIFICATIONS_LOAD",e[e.NOTIFICATIONS_LOAD_START=299]="NOTIFICATIONS_LOAD_START",e[e.NOTIFICATIONS_LOAD_SUCCESS=300]="NOTIFICATIONS_LOAD_SUCCESS",e[e.NOTIFICATIONS_LOAD_ERROR=301]="NOTIFICATIONS_LOAD_ERROR",e[e.NOTIFICATIONS_UNLOAD=302]="NOTIFICATIONS_UNLOAD",e[e.NOTIFICATIONS_READ=303]="NOTIFICATIONS_READ",e[e.NOTIFICATIONS_READ_START=304]="NOTIFICATIONS_READ_START",e[e.NOTIFICATIONS_READ_SUCCESS=305]="NOTIFICATIONS_READ_SUCCESS",e[e.NOTIFICATIONS_READ_ERROR=306]="NOTIFICATIONS_READ_ERROR",e[e.DATA_SERVICE_LOAD=307]="DATA_SERVICE_LOAD",e[e.DATA_SERVICE_LOAD_START=308]="DATA_SERVICE_LOAD_START",e[e.DATA_SERVICE_LOAD_SUCCESS=309]="DATA_SERVICE_LOAD_SUCCESS",e[e.DATA_SERVICE_LOAD_ERROR=310]="DATA_SERVICE_LOAD_ERROR",e[e.DATA_SERVICE_UNLOAD=311]="DATA_SERVICE_UNLOAD",e[e.DATA_SERVICE_LOAD_REFRESH=312]="DATA_SERVICE_LOAD_REFRESH",e[e.DATA_SERVICE_LOAD_REFRESH_START=313]="DATA_SERVICE_LOAD_REFRESH_START",e[e.DATA_SERVICE_LOAD_REFRESH_SUCCESS=314]="DATA_SERVICE_LOAD_REFRESH_SUCCESS",e[e.DATA_SERVICE_LOAD_REFRESH_ERROR=315]="DATA_SERVICE_LOAD_REFRESH_ERROR"}(q||(q={}));var F=function(e,t){switch(t.type){case q.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case q.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.UNEDITED,saveState:c.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case q.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveError without view model"),e)}(e,t);case q.ADD_ORG_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case q.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:o.UNEDITED,validationState:{type:s.OK,validatedAt:new Date},saveState:c.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case q.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case q.ADD_ORG_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case q.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Logo URL without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:t.error})})})})})}):(console.warn("attempting Logo URL error without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Home URL (success) without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:t.error})})})})})}):(console.warn("attempting update to home url without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Research Interests without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:t.error})})})})})}):(console.warn("attempting update to research interests (error) without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e);case q.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:i.DIRTY})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.isPrivate,{value:t.isPrivate,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case q.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case q.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.ERROR,message:"TODO: form error",validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};function Q(){return{type:s.OK,validatedAt:new Date}}function J(e){return e.editedOrganization.name.syncState===i.DIRTY?o.EDITED:e.editedOrganization.id.syncState===i.DIRTY?o.EDITED:e.editedOrganization.logoUrl.syncState===i.DIRTY?o.EDITED:e.editedOrganization.homeUrl.syncState===i.DIRTY?o.EDITED:e.editedOrganization.researchInterests.syncState===i.DIRTY?o.EDITED:e.editedOrganization.isPrivate.syncState===i.DIRTY?o.EDITED:e.editedOrganization.description.syncState===i.DIRTY?o.EDITED:o.UNEDITED}var Y=function(e,t){switch(t.type){case q.EDIT_ORG_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case q.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:o.UNEDITED,validationState:Q(),saveState:c.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case q.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.EDIT_ORG_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case q.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVING})})})}):e}(e);case q.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.UNEDITED,saveState:c.SAVED,editedOrganization:{id:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.id,{syncState:i.CLEAN}),name:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{syncState:i.CLEAN}),logoUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{syncState:i.CLEAN}),homeUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{syncState:i.CLEAN}),researchInterests:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{syncState:i.CLEAN}),isPrivate:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{syncState:i.CLEAN}),description:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{syncState:i.CLEAN})}})})})}):e}(e);case q.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.name!==n.name.remoteValue?i.DIRTY:i.CLEAN;var a=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:r,validationState:Q()})})})})})}),o=J(a.views.editOrgView.viewModel);return Object(x.a)({},a,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},a.views.editOrgView,{viewModel:Object(x.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case q.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:Q()})})})})})}),n=J(r.views.editOrgView.viewModel);return Object(x.a)({},r,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},r.views.editOrgView,{viewModel:Object(x.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case q.EDIT_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:Q()})})})})})}),n=J(r.views.editOrgView.viewModel);return Object(x.a)({},r,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},r.views.editOrgView,{viewModel:Object(x.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case q.EDIT_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:Q()})})})})})}),n=J(r.views.editOrgView.viewModel);return Object(x.a)({},r,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},r.views.editOrgView,{viewModel:Object(x.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.isPrivate!==n.isPrivate.remoteValue?i.DIRTY:i.CLEAN;var a=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{value:t.isPrivate,syncState:r,validationState:Q()})})})})})}),s=J(a.views.editOrgView.viewModel);return Object(x.a)({},a,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},a.views.editOrgView,{viewModel:Object(x.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.description!==n.description.remoteValue?i.DIRTY:i.CLEAN;var a=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:r,validationState:Q()})})})})})}),s=J(a.views.editOrgView.viewModel);return Object(x.a)({},a,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},a.views.editOrgView,{viewModel:Object(x.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):e}(e);case q.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.ERROR,message:"Validation errors",validatedAt:new Date}})})})}):e}(e);default:return null}};function K(e,t){switch(t.type){case q.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}var X=function(e,t){switch(t.type){case q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==S.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(x.a)({},e,{type:l.ADMIN}):e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},r,{organization:Object(x.a)({},r.organization,{members:n})})})})})}(e,t);case q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==S.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(x.a)({},e,{type:l.MEMBER}):e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},r,{organization:Object(x.a)({},r.organization,{members:n})})})})})}(e,t);case q.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==S.NORMAL)return e;var n=r.organization.members.filter(function(e){return e.username!==t.memberUsername});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},r,{organization:Object(x.a)({},r.organization,{members:n})})})})})}(e,t);default:return null}};function Z(e,t){switch(t.type){case q.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}function $(e,t){switch(t.type){case q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:(console.log("canceling...",t),Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{requestOutbox:t.requests})})})})):e}(e,t);default:return null}}var ee=function(e,t){switch(t.type){case q.VIEW_ORG_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case q.VIEW_ORG_LOAD_NORMAL_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{kind:S.NORMAL,organization:t.organization,relation:t.relation,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox}}})})}(e,t);case q.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{kind:S.PRIVATE_INACCESSIBLE,organization:t.organization,relation:t.relation,requestOutbox:t.requestOutbox}}})})}(e,t);case q.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.VIEW_ORG_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrative.workspaceId});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{organization:Object(x.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r})})})})})}(e,t);case q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{organization:t.organization})})})}):e}(e,t)}return K(e,t)||Z(e,t)||$(e,t)||X(e,t)};function te(e,t){switch(t.type){case q.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.searchTerms,o=r.sortField,s=r.sortDirection,c=r.filter,l=r.totalCount,u=r.filteredCount,E=r.selectedOrganizationId,d=r.error,m=r.searching;return Object(x.a)({},e,{loadingState:h.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,searchTerms:i,sortField:o,sortDirection:s,filter:c,totalCount:l,filteredCount:u,selectedOrganizationId:E,error:d,searching:m}})}(e,t);case q.BROWSE_ORGS_SEARCH:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})}(e,t);case q.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{searching:!0})})}(e);case q.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{organizations:t.organizations,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})}(e,t);case q.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{searching:!1,error:t.error})})}(e,t);case q.BROWSE_ORGS_SORT_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{sortField:t.sortField,sortDirection:t.sortDirection,searching:!0})})}(e,t);case q.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{filter:r,searching:!0})})}(e,t);default:return null}}var re=function(e,t){switch(t.type){case q.AUTH_CHECK_START:return function(e,t){return Object(x.a)({},e,{auth:{status:m.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case q.AUTH_AUTHORIZED:return function(e,t){return Object(x.a)({},e,{auth:{status:m.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case q.AUTH_UNAUTHORIZED:return function(e,t){return Object(x.a)({},e,{auth:{status:m.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case q.AUTH_CHECK_ERROR:return function(e,t){return Object(x.a)({},e,{auth:{status:m.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var ne=function(e,t){switch(t.type){case q.APP_SUCCESS:return function(e,t){return Object(x.a)({},e,{app:{status:v.READY,config:t.config}})}(e,t);default:return null}};var ae=function(e,t){switch(t.type){case q.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case q.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case q.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:Object(x.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(x.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var ie,oe=function(e,t){switch(t.type){case q.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:h.LOADING,viewModel:null,error:null})})})}(e);case q.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:h.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case q.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:h.ERROR,viewModel:null,error:t.error})})})}(e,t);case q.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:h.NONE,viewModel:null,error:null})})})}(e);case q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.ADMIN,e):e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{viewModel:Object(x.a)({},e.views.viewMembersView.viewModel,{organization:Object(x.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.MEMBER,e):e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{viewModel:Object(x.a)({},e.views.viewMembersView.viewModel,{organization:Object(x.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}},se=r(3),ce=r.n(se),le=r(9);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(ie||(ie={}));Object(W.a)(Error);var ue,Ee,de,me=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).originalError=void 0,r.name="GroupException",r.originalError=e,r}return Object(U.a)(t,e),t}(H),pe=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(U.a)(t,e),t}(H),ve=function(){function e(t){var r=t.token,n=t.url;Object(y.a)(this,e),this.token=void 0,this.url=void 0,this.token=r,this.url=n}return Object(C.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"listGroups",value:function(){var e=Object(le.a)(ce.a.mark(function e(){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGroups",value:function(){var e=this;return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200===e.status)return e.json().then(function(e){return e});if(204===e.status){return null}throw new Error("Unexpected response: "+e.status+" : "+e.statusText)}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new me(e)});case"text/plain":return e.text().then(function(e){throw new pe(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a,i,o;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new me(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new pe(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new me(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new pe(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{logourl:e.logoUrl,researchinterests:e.researchInterests,homeurl:e.homeUrl}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{logourl:t.logoUrl,homeurl:t.homeUrl,researchinterests:t.researchInterests},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"getRequest",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===ie.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===ie.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===ie.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r,n){var a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"updateMember",value:function(e){var t=e.groupId,r=e.memberUsername,n=e.update,a=["group",t,"user",r,"update"];return this.put(a,{custom:n})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function Oe(e){var t=function(e){switch(e){case"Invite":return ue.INVITATION;case"Request":return ue.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return Ee.USER;case"workspace":return Ee.WORKSPACE;case"catalogmethod":return Ee.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,de.OPEN);switch(r){case Ee.USER:return ue.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case Ee.WORKSPACE:return ue.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case Ee.APP:return ue.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(ue||(ue={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(Ee||(Ee={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(de||(de={}));var he,Re,ge,_e,fe=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.cache=void 0,this.params=t,this.groupsClient=new ve({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(C.a)(e,[{key:"getRequest",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=Oe(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOutboundRequests",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t,r,n,a=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return Oe(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",Oe(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCombinedRequestInboxForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getGroupRequests(t,{includeClosed:!1,sortDirection:ie.DESCENDING});case 4:e.t0=function(e){return Oe(e)},n=e.sent.map(e.t0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(1),n=[];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t,r,n,a=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return Oe(e)}).filter(function(e){return e.type===ue.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboundRequests",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t,r,n,a=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return r=e.sent,console.log("targeted requests",r),(n=r.map(function(e){return Oe(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",Oe(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:ie.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return Oe(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return Oe(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),we=function(){function e(){Object(y.a)(this,e)}return Object(C.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:s.REQUIRED_MISSING,message:"Organization id may not be empty",validatedAt:new Date}];if(e.match(/\s/))return[e,{type:s.ERROR,message:"Organization id may not contain a space",validatedAt:new Date}];if(e.length>100)return[e,{type:s.ERROR,message:"Organization id may not be longer than 100 characters",validatedAt:new Date}];return e.match(/^[a-z0-9-]+$/)?[e,{type:s.OK,validatedAt:new Date}]:[e,{type:s.ERROR,message:'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash "-"',validatedAt:new Date}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:s.REQUIRED_MISSING,message:"Organization name may not be empty",validatedAt:new Date}]:e.length>256?[e,{type:s.ERROR,message:"Organization name may not be longer than 256 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgLogoUrl",value:function(e){return null===e?[e,{type:s.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:s.ERROR,message:"Logo url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgHomeUrl",value:function(e){return null===e?[e,{type:s.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:s.ERROR,message:"Home url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgResearchInterests",value:function(e){return 0===e.length?[name,{type:s.REQUIRED_MISSING,message:"Research Interests may not be empty",validatedAt:new Date}]:e.length>280?[e,{type:s.ERROR,message:"Research Interests may not be longer than 280 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:s.ERROR,message:"Organization description may not be empty",validatedAt:new Date}]:e.length>4096?[e,{type:s.ERROR,message:"Organization description may not be longer than 4,096 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateMemberTitle",value:function(e){return e.length>100?[e,{type:s.ERROR,message:"member title may not be longer than ".concat(100," characters"),validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}}]),e}();function Se(e,t,r,n){if(e.kind===_e.INACCESSIBLE_PRIVATE)return r&&r.user===t?{type:he.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:he.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:he.NONE};if(t===e.owner.username)return{type:he.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:he.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:he.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:he.NONE};switch(a.type){case Re.MEMBER:return{type:he.MEMBER};case Re.ADMIN:return{type:he.ADMIN};case Re.OWNER:return{type:he.OWNER};default:return{type:he.NONE}}}function Ae(e){switch(e){case"None":return ge.NONE;case"Read":return ge.VIEW;case"Write":return ge.EDIT;case"Admin":return ge.ADMIN;case"Own":return ge.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}function Ne(e,t){var r={username:e.owner.name,joinedAt:new Date(e.owner.joined),type:Re.OWNER,title:"Owner"},n=[].concat(e.admins.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:Re.ADMIN,title:e.custom.title}})).concat(e.members.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:Re.MEMBER,title:e.custom.title}})),a=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:Ae(e.perm)}});return{kind:_e.NORMAL,id:e.id,name:e.name,isPrivate:e.private,isMember:"None"!==e.role,relation:ye(e.role),logoUrl:e.custom.logourl||null,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||"",description:e.custom.description,owner:r,areMembersPrivate:e.privatemembers,members:n,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),narratives:a,apps:[],memberCount:e.memcount,narrativeCount:e.rescount.workspace||0,appCount:e.rescount.catalogmethod||0}}function Ie(e,t){return{kind:_e.INACCESSIBLE_PRIVATE,id:e.id,isPrivate:e.private,relation:ye(e.role)}}function be(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.owner)})})}function Te(e,t,r){var n=r===O.ASCENDING?1:-1;switch(t){case"created":return e.slice().sort(function(e,t){return n*(e.createdAt.getTime()-t.createdAt.getTime())});case"modified":case"changed":return e.slice().sort(function(e,t){return n*(e.modifiedAt.getTime()-t.modifiedAt.getTime())});case"name":return e.slice().sort(function(e,t){return n*e.name.localeCompare(t.name)});case"owner":return e.slice().sort(function(e,t){return n*e.owner.localeCompare(t.owner)});default:return console.warn("unimplemented sort field: "+t),e}}function ye(e){switch(e){case"None":return he.NONE;case"Member":return he.MEMBER;case"Admin":return he.ADMIN;case"Owner":return he.OWNER;default:throw new Error("Unknown role: "+e)}}function Ce(e,t,r){var n=t.roleType,a=t.roles,i=t.privacy;return e.filter(function(e){return function(e){switch(n){case"myorgs":return[he.MEMBER,he.ADMIN,he.OWNER].includes(e.relation);case"notmyorgs":return![he.MEMBER,he.ADMIN,he.OWNER].includes(e.relation);case"all":default:return!0}}(e)&&function(e){return 0===a.length||a.some(function(t){switch(t){case"member":return e.relation===he.MEMBER;case"admin":return e.relation===he.ADMIN;case"owner":return e.relation===he.OWNER;default:return!1}})}(e)&&function(e){switch(i){case"public":return!e.private;case"private":return e.private;case"any":return!0;default:return!1}}(e)})}we.nonPrintableRe=/[\000-\031]/,function(e){e.NONE="NONE",e.VIEW="VIEW",e.MEMBER_REQUEST_PENDING="MEMBER_REQUEST_PENDING",e.MEMBER_INVITATION_PENDING="MEMBER_INVITATION_PENDING",e.MEMBER="MEMBER",e.ADMIN="ADMIN",e.OWNER="OWNER"}(he||(he={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(Re||(Re={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(ge||(ge={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.INACCESSIBLE_PRIVATE=1]="INACCESSIBLE_PRIVATE"}(_e||(_e={}));var Me=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.organizations=void 0,this.params=t,this.groupsClient=new ve({url:this.params.groupsServiceURL,token:this.params.token}),this.organizations=new Map}return Object(C.a)(e,[{key:"getOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.organizations.has(t)){e.next=2;break}return e.abrupt("return",this.organizations.get(t));case 2:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){var n;return"None"===e.role&&e.private?(console.log("PRIVATE?",e),n=Ie(e,r.params.username)):n=Ne(e,r.params.username),r.organizations.set(t,n),n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganization",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.organizations.has(t)){e.next=5;break}if((r=this.organizations.get(t)).kind===_e.NORMAL){e.next=4;break}throw new Error("Inaccessible Organization");case 4:return e.abrupt("return",r);case 5:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){if("None"===e.role&&e.private)throw new Error("Inaccessible Organization");var r=Ne(e,n.params.username);return n.organizations.set(t,r),r}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllOrgs",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t,r;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroups();case 2:return t=e.sent,r=t.map(function(e){return e.id}),e.abrupt("return",this.getOrgs(r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t,r;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return t=e.sent,r=t.filter(function(e){return e.relation!==he.NONE}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listGroupToBriefOrganization",value:function(e){return{id:e.id,name:e.name,logoUrl:e.custom.logourl||null,private:e.private,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||null,owner:e.owner,relation:ye(e.role),createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),memberCount:e.memcount||0,narrativeCount:e.rescount.workspace||0}}},{key:"getAllOrgs2",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t,r,n=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.listGroups();case 2:return t=e.sent,r=t.map(function(e){return n.listGroupToBriefOrganization(e)}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=Ce(r,t.filter,t.username),a=be(n,t.searchTerms),i=Te(a,t.sortField,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=r.filter(function(e){return e.relation!==he.NONE}),e.abrupt("return",{organizations:n,total:n.length});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",Oe(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),t.id.validationState.type===s.OK&&t.name.validationState.type===s.OK&&t.logoUrl.validationState.type===s.OK&&t.description.validationState.type===s.OK&&t.isPrivate.validationState.type===s.OK){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.abrupt("return",n.createGroup({id:t.id.value,name:t.name.value,logoUrl:t.logoUrl.value,homeUrl:t.homeUrl.value,researchInterests:t.researchInterests.value,description:t.description.value,isPrivate:t.isPrivate.value}).then(function(e){return Ne(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,logoUrl:r.logoUrl,homeUrl:r.homeUrl,researchInterests:r.researchInterests,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return we.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return we.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return we.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembershipToGroup",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",Oe(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.memberToAdmin({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"adminToMember",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.adminToMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.removeMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateMember",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r,n){var a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new ve({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",a.updateMember({groupId:t,memberUsername:r,update:n}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}();function De(e,t){if(t)return ge.OWNER;switch(e){case"r":return ge.VIEW;case"w":return ge.EDIT;case"a":return ge.ADMIN;default:throw new Error("Invalid workspace user permission: "+e)}}var Ue=function(e,t){switch(t.type){case q.INVITE_USER_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:h.LOADING})})})}(e);case q.INVITE_USER_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:h.SUCCESS,error:null,viewModel:{editState:g.EDITING,users:t.users,organization:t.organization,selectedUser:null}})})})}(e,t);case q.INVITE_USER_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:h.SUCCESS,error:t.error,viewModel:null})})})}(e,t);case q.INVITE_USER_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:h.NONE,error:null,viewModel:null})})})}(e);case q.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{users:t.users})})})})}(e,t);case q.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})})})}(e,t);case q.INVITE_USER_SEND_INVITATION_START:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{editState:g.SENDING})})})})}(e);case q.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");var r=e.views.inviteUserView.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=he.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=he.MEMBER_INVITATION_PENDING),e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{editState:g.SUCCESS,selectedUser:n,users:i})})})})}(e);case q.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{editState:g.ERROR})})})})}(e);default:return null}};function ke(){return{type:s.OK,validatedAt:new Date}}function Ve(e){return e.editableMemberProfile.title.syncState===i.DIRTY?o.EDITED:o.UNEDITED}var je=function(e,t){switch(t.type){case q.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case q.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,editableMemberProfile:t.editableMemberProfile,editState:o.UNEDITED,saveState:c.NEW,validationState:ke()}}})})}(e,t);case q.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case q.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r,n=e.views.manageMembershipView.viewModel.editableMemberProfile;r=t.title!==n.title.remoteValue?i.DIRTY:i.CLEAN;var a=Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:Object(x.a)({},e.views.manageMembershipView,{viewModel:Object(x.a)({},e.views.manageMembershipView.viewModel,{editableMemberProfile:Object(x.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile,{title:{value:t.title,remoteValue:t.title,syncState:r,validationState:ke()}})})})})}),o=Ve(a.views.manageMembershipView.viewModel);return Object(x.a)({},a,{views:Object(x.a)({},e.views,{manageMembershipView:Object(x.a)({},a.views.manageMembershipView,{viewModel:Object(x.a)({},a.views.manageMembershipView.viewModel,{editState:o})})})})}(e,t);case q.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r=Ve(e.views.manageMembershipView.viewModel);return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:Object(x.a)({},e.views.manageMembershipView,{viewModel:Object(x.a)({},e.views.manageMembershipView.viewModel,{editState:r,validationState:{type:s.OK,validatedAt:new Date}})})})})}(e);case q.MANAGE_MEMBERSHIP_EVALUATE_ERROR:return function(e,t){return e.views.manageMembershipView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:Object(x.a)({},e.views.manageMembershipView,{viewModel:Object(x.a)({},e.views.manageMembershipView.viewModel,{validationState:{type:s.ERROR,message:"Validation error(s)",validatedAt:new Date}})})})}):e}(e);case q.MANAGE_MEMBERSHIP_SAVE_SUCCESS:return function(e,t){return e.views.manageMembershipView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:Object(x.a)({},e.views.manageMembershipView,{viewModel:Object(x.a)({},e.views.manageMembershipView.viewModel,{editState:o.UNEDITED,saveState:c.SAVED,editableMemberProfile:{title:Object(x.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile.title,{syncState:i.CLEAN})}})})})}):e}(e);default:return null}};function ze(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{viewModel:Object(x.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVING})})})})}var Le=function(e,t){switch(t.type){case q.REQUEST_ADD_NARRATIVE_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{loadingState:h.LOADING,error:null,viewModel:null})})})}(e);case q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,saveState:c.SAVED}})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{loadingState:h.ERROR,error:t.error,viewModel:null})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_SEND_START:return ze(e);case q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{viewModel:Object(x.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVED})})})}),n=r.views.requestNarrativeView.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=_.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=_.REQUESTED),e}),r}(e,t);case q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return ze(e);case q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{error:null,viewModel:Object(x.a)({},e.views.requestNarrativeView.viewModel,{selectedNarrative:t.narrative})})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);default:return null}};function Ge(e,t){switch(t.type){case q.DASHBOARD_LOAD_START:return{loadingState:h.LOADING,error:null,viewModel:null};case q.DASHBOARD_LOAD_SUCCESS:return function(e,t){return{loadingState:h.SUCCESS,error:null,viewModel:{refreshState:h.NONE,organizations:t.organizations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,pendingAdminRequests:t.pendingGroupRequests}}}(0,t);case q.DASHBOARD_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{loadingState:h.ERROR,error:t.error,viewModel:null})}(e,t);case q.DASHBOARD_UNLOAD:return{loadingState:h.NONE,error:null,viewModel:null};case q.DASHBOARD_REFRESH_START:return function(e,t){return e.viewModel?Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{refreshState:h.LOADING})}):e}(e);case q.DASHBOARD_REFRESH_SUCCESS:return function(e,t){return Object(x.a)({},e,{error:null,viewModel:{refreshState:h.SUCCESS,organizations:t.organizations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,pendingAdminRequests:t.pendingGroupRequests}})}(e,t);case q.DASHBOARD_REFRESH_ERROR:return function(e,t){return e.viewModel?Object(x.a)({},e,{error:t.error,viewModel:Object(x.a)({},e.viewModel,{refreshState:h.ERROR})}):e}(e,t);case q.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{requestOutbox:t.requests})})}(e,t);case q.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{requestInbox:t.requests,organizations:t.organizations})})}(e,t);case q.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{requestInbox:t.requests})})}(e,t);default:return null}}var Pe=function(e,t){switch(t.type){case q.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{users:Object(x.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case q.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{orgs:Object(x.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case q.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{narratives:{byId:new Map(r.byId)}})})}(e,t);default:return null}};var xe=function(e,t){switch(t.type){case q.ORGANIZATION_CENTRIC_VIEW_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case q.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:Object(x.a)({},e.views.organizationCentricView,{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,pendingJoinRequest:t.pendingJoinRequest,pendingJoinInvitation:t.pendingJoinInvitation,relation:t.relation}})})})}(e,t);case q.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:Object(x.a)({},e.views.organizationCentricView,{loadingState:h.ERROR,error:t.error,viewModel:null})})})}(e,t);case q.ORGANIZATION_CENTRIC_VIEW_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);default:return null}};function Be(e,t){switch(t.type){case q.GLOBAL_ACCESS_NARRATIVE_SUCCESS:return function(e,t){var r=e.entities.narratives.byId;return r.set(t.narrative.workspaceId,t.narrative),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{narratives:Object(x.a)({},e.entities.narratives,{byId:r})})})}(e,t);default:return null}}function We(e,t){switch(t.type){case q.NOTIFICATIONS_LOAD_SUCCESS:return function(e,t){var r=new Map;return t.notifications.forEach(function(e){r.set(e.id,e)}),Object(x.a)({},e,{db:Object(x.a)({},e.db,{notifications:{all:t.notifications,byId:r}})})}(e,t);case q.NOTIFICATIONS_UNLOAD:return function(e,t){return Object(x.a)({},e,{db:Object(x.a)({},e.db,{notifications:{all:[],byId:new Map}})})}(e);case q.NOTIFICATIONS_READ_SUCCESS:return function(e,t){var r=e.db.notifications,n=r.all,a=r.byId,i=n.filter(function(e){return e.id!==t.notificationId}),o=new Map(a);return o.delete(t.notificationId),Object(x.a)({},e,{db:Object(x.a)({},e.db,{notifications:{all:i,byId:o}})})}(e,t);default:return null}}function qe(e,t){switch(t.type){case q.DATA_SERVICE_LOAD_SUCCESS:return function(e,t){var r=new Map,n=t.profile.profile.plugins.organizations;return n&&Object.keys(n.orgSettings).map(function(e){var t=n.orgSettings[e];r.set(e,{lastVisitedAt:new Date(t.settings.lastVisitedAt)})}),Object(x.a)({},e,{db:Object(x.a)({},e.db,{lastVisited:{byId:r}})})}(e,t);default:return null}}var He,Fe=function(e,t){return F(e,t)||Y(e,t)||function(e,t){var r=te(e.views.browseOrgsView,t);return r?Object(x.a)({},e,{views:Object(x.a)({},e.views,{browseOrgsView:r})}):null}(e,t)||ee(e,t)||re(e,t)||ne(e,t)||ae(e,t)||oe(e,t)||Ue(e,t)||je(e,t)||Le(e,t)||function(e,t){var r=Ge(e.views.dashboardView,t);return r?Object(x.a)({},e,{views:Object(x.a)({},e.views,{dashboardView:r})}):null}(e,t)||Pe(e,t)||xe(e,t)||Be(e,t)||We(e,t)||qe(e,t)||e},Qe=(r(172),r(151)),Je=r(73),Ye=(r(174),r(360)),Ke=(r(176),r(344)),Xe=r(52),Ze=r.n(Xe),$e=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderDefault",value:function(){return N.createElement("img",{style:{width:this.props.size,height:this.props.size},src:"unicorn-64.png"})}},{key:"renderLogoUrl",value:function(){return this.props.logoUrl?N.createElement("img",{src:this.props.logoUrl,width:this.props.size}):N.createElement("span",null,"n/a")}},{key:"renderUnicornify",value:function(){var e="https://unicornify.pictures/avatar/"+Ze()(this.props.organizationId)+"?s="+this.props.size;return N.createElement("img",{style:{width:this.props.size,height:this.props.size},src:e})}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultInitial",value:function(){var e=this.charAt(this.props.organizationName,0).toUpperCase(),t=Ze()(this.props.organizationId).substr(0,6);return N.createElement("svg",{width:this.props.size,height:this.props.size,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},N.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:this.props.size-12,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogo",value:function(){return this.props.logoUrl?this.renderLogoUrl():this.renderDefaultInitial()}},{key:"render",value:function(){return this.renderLogo()}}]),t}(N.Component),et=r(342),tt=r(33),rt=(r(180),r(182),r(117)),nt=r.n(rt),at=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:nt.a;case"silhouette":case"mysteryman":default:return nt.a}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return N.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(N.Component);function it(e){switch(e){case He.COMPACT:return He.NORMAL;case He.NORMAL:return He.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(He||(He={}));var ot=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={view:He.COMPACT},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onToggleView",value:function(){this.setState({view:it(this.state.view)})}},{key:"renderRole",value:function(){return N.createElement("span",null,N.createElement(tt.a,{type:"crown"})," owner")}},{key:"renderCompact",value:function(){return N.createElement("div",{className:"Owner-owner"},N.createElement("div",{className:"Owner-avatarCol"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||30})),N.createElement("div",{className:"Owner-infoCol"},N.createElement("div",{className:"Owner-name"},N.createElement(et.a,{placement:"bottomRight",title:this.props.user.username},N.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))))}},{key:"renderNormal",value:function(){return N.createElement("div",{className:"Owner View-NORMAL"},N.createElement("div",{className:"Owner-controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===He.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===He.NORMAL?"up":"down")}))),N.createElement("div",{className:"Owner-avatarCol"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||30})),N.createElement("div",{className:"Owner-infoCol"},N.createElement("div",{className:"Owner-name"},N.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),N.createElement("div",{className:"Owner-username"},this.props.user.username),N.createElement("div",{className:"Owner-title"},this.props.user.title||N.createElement("i",null,"no title in user profile")),N.createElement("div",{className:"Owner-organization"},this.props.user.organization||N.createElement("i",null,"no organization in user profile")),N.createElement("div",{className:"Owner-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||N.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){return this.renderCompact()}}]),t}(N.Component),st=function(){function e(t){var r=t.url,n=t.token;Object(y.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n||null}return Object(C.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}();st.module=void 0;var ct=function(e){function t(e){var r;if(Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(st),lt=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var e=Object(le.a)(ce.a.mark(function e(r){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.profileCache.has(r)){e.next=2;break}return e.abrupt("return",Promise.resolve(t.profileCache.get(r)));case 2:return e.abrupt("return",this.callFunc("get_user_profile",[r]).then(function(e){return e.result[0][0]}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateUserProfile",value:function(){var e=Object(le.a)(ce.a.mark(function e(r){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.profileCache.delete(r.user.username),e.abrupt("return",this.callFunc("update_user_profile",{profile:r}).then(function(){}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("get_user_profile",t).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllUsers",value:function(){var e=Object(le.a)(ce.a.mark(function e(){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:""}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:t}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(ct);function ut(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}lt.module="UserProfile",lt.profileCache=new Map;var Et=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.userProfileClient=void 0,this.cache=void 0,this.params=t,this.userProfileClient=new lt({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(C.a)(e,[{key:"getUser",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=ut(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return ut(e)}),a.forEach(function(e){var t=ut(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),dt=r(20),mt=function(e){function t(e){var r;if(Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"callFunc",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(y.a)(this,e),this.url=void 0,this.token=void 0,this.module=void 0,this.url=r,this.token=n||null,this.module=a}return Object(C.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i,o,s;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=13;break}return e.next=3,t.json();case 3:if(r=e.sent,n=r.result,a=r.error,!n){e.next=10;break}return e.abrupt("return",[n,null]);case 10:return e.abrupt("return",[null,a]);case 11:e.next=15;break;case 13:if(204!==t.status){e.next=15;break}return e.abrupt("return",[null,null]);case 15:if(500!==t.status){e.next=28;break}if("application/json"!==t.headers.get("Content-Type")){e.next=24;break}return e.next=19,t.json();case 19:return i=e.sent,o=i.error,e.abrupt("return",[null,o]);case 24:return e.next=26,t.text();case 26:return s=e.sent,e.abrupt("return",[null,{code:0,name:"Internal Server Error (for real)",message:"The service experienced an internal error",error:s}]);case 28:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){return n.processResponse(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),pt=r(74),vt=r.n(pt),Ot=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(ct);Ot.module="ServiceWizard";var ht=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(y.a)(this,e),this.cache=void 0,this.cacheLifetime=void 0,this.monitoringFrequency=void 0,this.waiterTimeout=void 0,this.waiterFrequency=void 0,this.isMonitoring=void 0,this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(C.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new vt.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var o=(new Date).getTime()-a;o>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+o))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):vt.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),Rt=function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,o=t.rpcContext;if(Object(y.a)(this,e),this.token=void 0,this.timeout=void 0,this.rpcContext=void 0,this.url=void 0,this.version=void 0,this.token=r,this.timeout=i||1e4,this.rpcContext=o||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(C.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return ht.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new Ot({url:e.url,token:e.token});return vt.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new mt({module:n.module_name,url:n.url,token:r.token});return vt.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}();Rt.module=void 0;var gt,_t,ft=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"listNarratives",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(dt.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(Rt);function wt(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function St(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:wt(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:"r"===e[6],lockStatus:e[7],metadata:e[8]}}function At(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:wt(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}ft.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(gt||(gt={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(_t||(_t={}));var Nt=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.params=t}return Object(C.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i,o,s,c,l,u;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ft({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new Me({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),a=new fe({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:if(i=e.sent,o=Object(dt.a)(i,3),s=o[0],c=o[1],l=o[2],c.kind!==_e.INACCESSIBLE_PRIVATE){e.next=12;break}throw new Error("Cannot get own narratives for private inaccessible organization");case 12:return u=c.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",s.narratives.map(function(e){return{workspaceInfo:St(e.ws),objectInfo:At(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){var t;return t=-1!==u.indexOf(e.workspaceInfo.id)?gt.ASSOCIATED:l.find(function(t){return t.resourceType===Ee.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?gt.REQUESTED:gt.NONE,{workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,status:t,modifiedAt:e.workspaceInfo.modifiedAt}}).sort(function(e,t){return e.title.localeCompare(t.title)}));case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"workspaceToNarrative",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i,o,s,c,l,u,E,d;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new mt({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,Promise.all([r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:1}],includeMetadata:1,ignoreErrors:0}]),r.callFunc("get_workspace_info",[{id:t}])]);case 4:if(n=e.sent,a=Object(dt.a)(n,2),i=Object(dt.a)(a[0],2),o=Object(dt.a)(i[0],1),o[0],s=i[1],c=Object(dt.a)(a[1],2),l=Object(dt.a)(c[0],1),u=l[0],E=c[1],!s&&!E){e.next=16;break}return e.abrupt("return",null);case 16:return d=St(u),e.abrupt("return",{workspaceId:d.id,title:d.metadata.narrative_nice_name||"Unknown",permission:De(d.userPermission,d.owner===this.params.username),isPublic:d.globalReadPermission});case 20:return e.prev=20,e.t0=e.catch(1),e.abrupt("return",null);case 23:case"end":return e.stop()}},e,this,[[1,20]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getNarrative",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i,o,s,c,l,u,E,d,m;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new mt({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.callFunc("get_workspace_info",[{id:t}]);case 4:if(n=e.sent,a=Object(dt.a)(n,2),i=a[0],!a[1]){e.next=10;break}return e.abrupt("return",{workspaceId:t,access:_t.NONE});case 10:if(o=St(i[0]),s=o.metadata.narrative){e.next=14;break}return e.abrupt("return",{workspaceId:t,access:_t.NONE});case 14:return c=parseInt(s,10),e.next=17,r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:c}],includeMetadata:1,ignoreErrors:0}]);case 17:if(l=e.sent,u=Object(dt.a)(l,2),E=u[0],!u[1]){e.next=23;break}return e.abrupt("return",{workspaceId:t,access:_t.NONE});case 23:d=At(E[0].infos[0]),e.t0=o.userPermission,e.next="n"===e.t0?27:"r"===e.t0?33:"w"===e.t0?35:"a"===e.t0?37:39;break;case 27:if(!o.globalReadPermission){e.next=32;break}return m=_t.VIEW,e.abrupt("break",40);case 32:throw new Error("Cannot have no access and no global read permission!");case 33:return m=_t.VIEW,e.abrupt("break",40);case 35:return m=_t.EDIT,e.abrupt("break",40);case 37:return m=o.owner===this.params.username?_t.OWNER:_t.ADMIN,e.abrupt("break",40);case 39:throw new Error("Unknown workspace permission: "+o.userPermission);case 40:return e.abrupt("return",{workspaceId:o.id,access:m,isPublic:o.globalReadPermission,objectId:d.id,title:o.metadata.narrative_nice_name||"Unknown",owner:o.owner,lastSavedAt:d.savedAt,lastSavedBy:d.savedBy});case 43:throw e.prev=43,e.t1=e.catch(1),console.error("Error fetching narrative!",e.t1),e.t1;case 47:case"end":return e.stop()}},e,this,[[1,43]])}));return function(t){return e.apply(this,arguments)}}()}]),e}();function It(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,o=i.token,i.username,s=a.app.config,c=new Et({token:o,userProfileServiceURL:s.services.UserProfile.url}),t.prev=3,t.next=6,c.getUser(e);case 6:l=t.sent,r((E=l,{type:q.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((u={code:"error",message:t.t0.message},{type:q.ENTITY_USER_LOADER_ERROR,error:u}));case 13:case"end":return t.stop()}var u,E},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function bt(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_ORGANIZATION_LOADER_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:u=t.sent,r((d=u,{type:q.ENTITY_ORGANIZATION_LOADER_SUCCESS,organization:d})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:"error",message:t.t0.message},{type:q.ENTITY_ORGANIZATION_LOADER_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function Tt(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Nt({token:o,username:s,workspaceServiceURL:c.services.Workspace.url,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=3,t.next=6,l.getNarrative(e);case 6:u=t.sent,r({type:q.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:q.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}var yt=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.user?N.createElement(ot,{user:this.props.user,avatarSize:this.props.avatarSize}):N.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.username)}}]),t}(N.Component);var Ct=Object(L.b)(function(e,t){return{user:e.entities.users.byId.get(t.username)}},function(e){return{onLoad:function(t){e(It(t))}}})(yt);function Mt(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var Dt=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Mt(this.state.view)})}},{key:"renderLogo",value:function(e){return N.createElement($e,{logoUrl:e.logoUrl,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(e.homeUrl){var t=N.createElement(N.Fragment,null,N.createElement("p",null,"Home page for this Organization (external to KBase)"));return N.createElement("div",{className:"BriefOrganization-homeUrl"},N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:t},N.createElement("a",{href:e.homeUrl,target:"_blank"},N.createElement(tt.a,{type:"home"})," ","Home Page")))}}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?N.createElement("span",null,e.narrativeCount):N.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return 1==e.memberCount?N.createElement("span",{style:{color:"gray"}},"\xd8"):N.createElement("span",null,e.memberCount-1)}},{key:"renderRelation",value:function(e){switch(e.relation){case he.NONE:return N.createElement("span",null,N.createElement(tt.a,{type:"stop"})," ","You are ",N.createElement("b",null,"not a member"));case he.VIEW:return N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},N.createElement("span",null,N.createElement(tt.a,{type:"stop"})," You are not a member - view organization to join"));case he.MEMBER_REQUEST_PENDING:return N.createElement("span",null,N.createElement(tt.a,{type:"user",style:{color:"orange"}})," Your membership ",N.createElement("b",null,"request")," is pending");case he.MEMBER_INVITATION_PENDING:return N.createElement("span",null,N.createElement(tt.a,{type:"user",style:{color:"blue"}})," You have been ",N.createElement("b",null,"invited")," to join");case he.MEMBER:return N.createElement("span",null,N.createElement(tt.a,{type:"user"})," You are a ",N.createElement("b",null,"member"));case he.ADMIN:return N.createElement("span",null,N.createElement(tt.a,{type:"unlock"})," You are an ",N.createElement("b",null,"admin"));case he.OWNER:return N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},N.createElement("span",null,N.createElement(tt.a,{type:"crown"})," You are the ",N.createElement("b",null,"owner")))}}},{key:"renderPrivacy",value:function(){return this.props.organization.private?N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is private - may only be viewed by members"},N.createElement("span",null,N.createElement(tt.a,{type:"unlock"})," ",N.createElement("span",null,"Private"))):N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is public - may be viewed by any KBase user"},N.createElement("span",null,N.createElement(tt.a,{type:"global"})," ",N.createElement("span",null,"Public")))}},{key:"renderNormal",value:function(){var e=this.props.organization;return N.createElement("div",{className:"BriefOrganization"},N.createElement("div",{className:"BriefOrganization-body"},N.createElement("div",{className:"BriefOrganization-logoCol"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e)),this.renderFreshness(e)),N.createElement("div",{className:"BriefOrganization-infoCol"},N.createElement("div",{className:"BriefOrganization-infoCol-row"},N.createElement("div",{className:"BriefOrganization-infoCol-col1"},N.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},e.name)))),N.createElement("div",{className:"BriefOrganization-infoCol-row"},N.createElement("div",{className:"BriefOrganization-infoCol-col1"},N.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),N.createElement("div",{className:"BriefOrganization-homeUrl BriefOrganization-infoTableRow"},this.renderHomeUrl(e)),N.createElement("div",{className:"BriefOrganization-privacy"},this.renderPrivacy()),N.createElement("div",null,this.renderRelation(e))),N.createElement("div",{className:"BriefOrganization-infoCol-col2"},N.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},N.createElement("div",{className:"BriefOrganization-infoTableCol1"},N.createElement("span",{className:"field-label"},"members")),N.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderMemberCount(e))),N.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},N.createElement("div",{className:"BriefOrganization-infoTableCol1"},N.createElement("span",{className:"field-label"},"narratives")),N.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderNarrativeCount(e)))),N.createElement("div",{className:"BriefOrganization-infoCol-col3"},N.createElement("div",{className:"BriefOrganization-orgOwner BriefOrganization-infoTableRow"},N.createElement("div",{className:"BriefOrganization-infoTableCol1"},N.createElement("span",{className:"field-label"},"owner")),N.createElement("div",{className:"BriefOrganization-infoTableCol2"},N.createElement(Ct,{username:e.owner,avatarSize:16}))),N.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},N.createElement("div",{className:"BriefOrganization-infoTableCol1"},N.createElement("span",{className:"field-label"},"established")),N.createElement("div",{className:"BriefOrganization-infoTableCol2"},N.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))),N.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},N.createElement("div",{className:"BriefOrganization-infoTableCol1"},N.createElement("span",{className:"field-label"},"last changed")),N.createElement("div",{className:"BriefOrganization-infoTableCol2"},N.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.modifiedAt)))))))))}},{key:"renderFreshness",value:function(e){var t,r=this.props.lastVisitedAt;if(r&&e.modifiedAt.getTime()>r.getTime()){t=N.createElement("div",null,N.createElement(et.a,{placement:"topRight",title:"This org has changed since your last visit to it"},N.createElement("span",{style:{color:"red"}},"\u25cf")))}else t=N.createElement("div",null,N.createElement("span",{style:{color:"transparent"}},"\u25cf"));var n;return n=null,N.createElement("div",null,t,n)}},{key:"renderCompact",value:function(){var e=this.props.organization;return N.createElement("div",{className:"BriefOrganization"},N.createElement("div",{className:"BriefOrganization-body"},N.createElement("div",{className:"BriefOrganization-freshnessCol"},this.renderFreshness(e)),N.createElement("div",{className:"BriefOrganization-logoCol"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),N.createElement("div",{className:"BriefOrganization-infoCol"},N.createElement("div",{className:"BriefOrganization-infoTable"},N.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},e.name)),N.createElement("div",{className:"BriefOrganization-homeUrl BriefOrganization-infoTableRow"},this.renderHomeUrl(e)),N.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),N.createElement("div",null,this.renderRelation(e)),N.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},N.createElement("div",{className:"BriefOrganization-infoTableCol1"},N.createElement("span",{className:"field-label"},"established")),N.createElement("div",{className:"BriefOrganization-infoTableCol2"},N.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))),N.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},N.createElement("div",{className:"BriefOrganization-infoTableCol1"},N.createElement("span",{className:"field-label"},"last changed")),N.createElement("div",{className:"BriefOrganization-infoTableCol2"},N.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.modifiedAt)))),N.createElement("div",{className:"BriefOrganization-infoTableRow"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===n.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===n.NORMAL?"up":"down")})))))))}},{key:"render",value:function(){return this.renderNormal()}}]),t}(N.Component),Ut=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderAdminInfo",value:function(e){return N.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderOrgs",value:function(){return this.props.organizations.length>0?this.props.organizations.map(function(e,t){var r=e.organization,n=e.lastVisitedAt;return N.createElement("div",{key:String(t),className:"simpleCard"},N.createElement(Dt,{organization:r,lastVisitedAt:n}))}):N.createElement(Ye.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return N.createElement("div",{className:"Organizations"},N.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(N.Component);var kt=Object(L.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");var t=e.db.lastVisited.byId;return{organizations:e.views.browseOrgsView.viewModel.organizations.map(function(e){var r=t.get(e.id)||null;return r&&r.lastVisitedAt?{organization:e,lastVisitedAt:r.lastVisitedAt}:{organization:e,lastVisitedAt:null}})}})(Ut),Vt=(r(236),r(351)),jt=r(82),zt=r(349),Lt=r(356),Gt=r(358),Pt=r(361),xt=r(233),Bt=(r(238),r(357)),Wt=function(e){function t(e,r){var n;return Object(y.a)(this,t),(n=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(C.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return N.createElement(tt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"onMenuSelection",value:function(e){console.log("here",e.key)}},{key:"renderMenu",value:function(){return N.createElement(Bt.a,{onClick:this.onMenuSelection.bind(this),selectedKeys:[this.state.currentMenuItem],mode:"horizontal"},N.createElement(Bt.a.Item,{key:"allorgs"},"Organizations"))}},{key:"renderMenu3",value:function(){var e=this;return Object(Pt.a)(function(t){var r=t.history;return N.createElement(Bt.a,{onClick:function(e){!function(e){switch(e){case"myorgs":r.push("/dashboard");case"allorgs":r.push("/organizations")}}(e.key)},selectedKeys:[e.state.currentMenuItem],mode:"horizontal"},N.createElement(Bt.a.Item,{key:"myorgs"},"My Organizations"),N.createElement(Bt.a.Item,{key:"allorgs"},"All Organizations"))})}},{key:"renderMenu4",value:function(){return N.createElement(xt.a,{render:function(e){var t=e.history;var r=[];switch(e.location.pathname){case"/dashboard":r=["myorgs"];break;case"/organizations":r=["allorgs"]}return N.createElement(Bt.a,{onClick:function(e){!function(e){switch(console.log("navigate to ...",e),e){case"myorgs":console.log("my orgs?",e,t),t.push("/dashboard");case"allorgs":t.push("/organizations")}}(e.key)},selectedKeys:r,mode:"horizontal"},N.createElement(Bt.a.Item,{key:"myorgs"},"My Organizations"),N.createElement(Bt.a.Item,{key:"allorgs"},"All Organizations"))}})}},{key:"renderMenu2",value:function(){return N.createElement("div",null,this.props.test,":",N.createElement("span",{style:{padding:"4px",marginRight:"4px"}},N.createElement(Ke.a,{to:"/"},N.createElement("span",{"data-test":"orgs-label"},"My Organizations"))),N.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},N.createElement(Ke.a,{to:"/organizations"},N.createElement("span",{"data-test":"orgs-label"},"All Organizations"))))}},{key:"renderMenu5",value:function(){return N.createElement(N.Fragment,null,N.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},N.createElement(Ke.a,{to:"/organizations"},N.createElement("span",{"data-test":"orgs-label"},"Organizations"))),N.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},N.createElement(Ke.a,{to:"/newOrganization"},N.createElement("span",{"data-test":"orgs-label"},"Create New Organization"))))}},{key:"render",value:function(){return N.createElement("div",{className:"Header"},N.createElement("div",{className:"Header-contextual"},N.createElement("div",{className:"Header-userColumn"},N.createElement("div",{className:"Header-breadcrumbs"},this.props.breadcrumbs),N.createElement("div",{className:"Header-buttons"},this.props.buttons))))}}]),t}(N.Component),qt=r(235),Ht=(r(247),function(e){function t(e,r){var n;return Object(y.a)(this,t),(n=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onMenuSelection",value:function(e){}},{key:"renderMenu",value:function(){return N.createElement(Bt.a,{onClick:this.onMenuSelection.bind(this),selectedKeys:[this.state.currentMenuItem],mode:"horizontal"},N.createElement(Bt.a.Item,{key:"myorgs"},"My Organizations"),N.createElement(Bt.a.Item,{key:"allorgs"},"All Organizations"))}},{key:"renderMenu3",value:function(){var e=this;return Object(Pt.a)(function(t){var r=t.history;return N.createElement(Bt.a,{onClick:function(e){!function(e){switch(e){case"myorgs":r.push("/dashboard");case"allorgs":r.push("/organizations")}}(e.key)},selectedKeys:[e.state.currentMenuItem],mode:"horizontal"},N.createElement(Bt.a.Item,{key:"myorgs"},"My Organizations"),N.createElement(Bt.a.Item,{key:"allorgs"},"All Organizations"))})}},{key:"renderMenu4",value:function(){return N.createElement(xt.a,{render:function(e){var t=e.history;var r=[];switch(e.location.pathname){case"/dashboard":r=["myorgs"];break;case"/organizations":r=["allorgs"]}return N.createElement(Bt.a,{onClick:function(e){!function(e){switch(console.log("navigate to ...",e),e){case"myorgs":console.log("my orgs?",e,t),t.push("/dashboard");case"allorgs":t.push("/organizations")}}(e.key)},selectedKeys:r,mode:"horizontal"},N.createElement(Bt.a.Item,{key:"myorgs"},"My Organizations"),N.createElement(Bt.a.Item,{key:"allorgs"},"All Organizations"))}})}},{key:"renderMenu6",value:function(){return N.createElement(xt.a,{render:function(e){e.history;var t=[];switch(e.location.pathname){case"/dashboard":t=["myorgs"];break;case"/organizations":t=["allorgs"];break;case"/newOrganization":t=["neworg"]}return N.createElement(Bt.a,{selectedKeys:t,style:{backgroundColor:"transparent"},mode:"horizontal"},N.createElement(Bt.a.Item,{key:"allorgs"},N.createElement(qt.a,{to:"/organizations"},"Organizations")),N.createElement(Bt.a.Item,{key:"neworg"},N.createElement(qt.a,{to:"/newOrganization"},"Create New Organization")))}})}},{key:"renderMenu5",value:function(){return N.createElement(N.Fragment,null,N.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},N.createElement(Ke.a,{to:"/organizations"},N.createElement("span",{"data-test":"orgs-label"},"Organizations"))),N.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},N.createElement(Ke.a,{to:"/newOrganization"},N.createElement("span",{"data-test":"orgs-label"},"Create New Organization"))))}},{key:"render",value:function(){return N.createElement("div",{className:"MainMenu"},N.createElement("div",{className:"MainMenu-menu"},this.renderMenu6()),N.createElement("div",{className:"MainMenu-buttons"},this.props.buttons))}}]),t}(N.Component)),Ft=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).searchInput=void 0,r.searchButton=void 0,r.filterByRoleValues=void 0,r.searchInput=N.createRef(),r.searchButton=N.createRef(),r.filterByRoleValues=[{label:"Member",value:"member"},{label:"Admin",value:"admin"},{label:"Owner",value:"owner"}],r.state={searchInput:"",showInfo:!1,filterByRoleType:"myorgs",filterByRole:[],filterByPrivacy:"any",showAdvancedControls:!1},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearchOrgs([])}},{key:"onShowInfo",value:function(){Vt.a.info({title:"Organizations Browser Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the organizations browser..."))})}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){switch(e){case"owner":this.props.onSortOrgs("owner",O.ASCENDING);break;case"name":this.props.onSortOrgs("name",O.ASCENDING);break;case"recentlyAdded":this.props.onSortOrgs("created",O.DESCENDING);break;case"recentlyChanged":this.props.onSortOrgs("changed",O.DESCENDING)}}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onFilterByRoleTypeChange",value:function(e){var t;this.setState({filterByRoleType:e.target.value}),"select"===e.target.value?(this.setState({filterByRole:[]}),t=Object(x.a)({},this.props.filter,{roleType:e.target.value})):t=Object(x.a)({},this.props.filter,{roleType:e.target.value,roles:[]}),this.props.onFilterOrgs(t)}},{key:"onFilterByRoleChange",value:function(e){var t;this.setState({filterByRole:e}),0===e.length?(this.setState({filterByRoleType:"myorgs"}),t=Object(x.a)({},this.props.filter,{roleType:"myorgs",roles:e})):(this.setState({filterByRoleType:"select"}),t=Object(x.a)({},this.props.filter,{roleType:"select",roles:e})),this.props.onFilterOrgs(t)}},{key:"onFilterByPrivacyChange",value:function(e){this.setState({filterByPrivacy:e.target.value});var t=Object(x.a)({},this.props.filter,{privacy:e.target.value});this.props.onFilterOrgs(t)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?N.createElement("span",null,"No organizations in the system"):0===this.props.filteredCount?N.createElement("span",null,"No organizations found out of"," ",this.props.totalCount," ","available."):this.props.totalCount===this.props.filteredCount?N.createElement("span",null,"Showing all"," ",this.props.totalCount):N.createElement("span",null,"Found"," ",this.props.filteredCount," ","out of"," ",this.props.totalCount)}},{key:"renderSearchIcon",value:function(){return this.props.searching?N.createElement(tt.a,{type:"loading"}):N.createElement(tt.a,{type:"search"})}},{key:"renderSearchForm",value:function(){return N.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},N.createElement("input",{className:"OrganizationsBrowser-searchInput",placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),N.createElement(jt.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),N.createElement(jt.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}))}},{key:"renderSearchBar",value:function(){return N.createElement("div",{className:"OrganizationsBrowser-searchBarRow"},N.createElement("div",{className:"OrganizationsBrowser-searchBarCol1"}),N.createElement("div",{className:"OrganizationsBrowser-searchBarCol2"},this.renderSearchForm()),N.createElement("div",{className:"OrganizationsBrowser-searchBarCol3"},this.renderSearchFeedback()))}},{key:"renderHeader",value:function(){var e=N.createElement(N.Fragment,null),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderSortByControl",value:function(){return N.createElement(zt.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,dropdownMatchSelectWidth:!0,style:{width:"10em"}},N.createElement(zt.a.Option,{value:"recentlyChanged",key:"changed"},"Date Changed"),N.createElement(zt.a.Option,{value:"recentlyAdded",key:"recent"},"Date Established"),N.createElement(zt.a.Option,{value:"name",key:"name"},"Org Name"))}},{key:"onToggleAdvanced",value:function(){if(this.state.showAdvancedControls){this.setState({showAdvancedControls:!1});var e=this.props.filter,t=e.roleType,r=e.roles;e.privacy;["myorgs","all"].includes(t)||(t="myorgs",this.setState({filterByRoleType:"myorgs"})),this.setState({filterByRole:[],filterByPrivacy:"any"}),r=[],"any",this.props.onFilterOrgs({roleType:t,roles:r,privacy:"any"})}else this.setState({showAdvancedControls:!0})}},{key:"renderAdvancedToggle",value:function(){return this.state.showAdvancedControls?N.createElement(tt.a,{type:"ellipsis",className:"IconButton-hover-pressed",onClick:this.onToggleAdvanced.bind(this)}):N.createElement(tt.a,{type:"ellipsis",className:"IconButton-hover",onClick:this.onToggleAdvanced.bind(this)})}},{key:"renderFilterByRole",value:function(){var e={display:"block",height:"30px",lineHeight:"30px"};return this.state.showAdvancedControls?N.createElement(N.Fragment,null,N.createElement(Lt.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},N.createElement(Lt.a,{value:"myorgs",style:e},"My Orgs"),N.createElement(Lt.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle(),N.createElement(Lt.a,{value:"notmyorgs",style:e},"Not My Orgs"),N.createElement(Lt.a,{value:"select",style:e},"Specific Role")),N.createElement(Gt.a.Group,{options:this.filterByRoleValues,value:this.state.filterByRole,className:"OrganizationsBrowser-checkboxGroup",onChange:this.onFilterByRoleChange.bind(this)})):N.createElement(N.Fragment,null,N.createElement(Lt.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},N.createElement(Lt.a,{value:"myorgs",style:e},"My Orgs"),N.createElement(Lt.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle()))}},{key:"renderFilterByPrivacy",value:function(){if(this.state.showAdvancedControls){var e={display:"block",height:"30px",lineHeight:"30px",margin:"0px"};return N.createElement(N.Fragment,null,N.createElement(Lt.a.Group,{onChange:this.onFilterByPrivacyChange.bind(this),value:this.state.filterByPrivacy},N.createElement(Lt.a,{value:"any",style:e},"Any"),N.createElement(Lt.a,{value:"public",style:e},"Public"),N.createElement(Lt.a,{value:"private",style:e},"Private")))}}},{key:"renderOrganizations",value:function(){return this.props.error?N.createElement(Ye.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):N.createElement(kt,null)}},{key:"renderFilterColumn",value:function(){return N.createElement(N.Fragment,null,N.createElement("div",{className:"field-label"},"sort by"),this.renderSortByControl(),N.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"filter"),this.renderFilterByRole(),this.state.showAdvancedControls?N.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"by privacy"):null,this.renderFilterByPrivacy())}},{key:"renderMenuButtons",value:function(){return N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)})}},{key:"render",value:function(){return N.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},N.createElement(Ht,{buttons:this.renderMenuButtons()}),this.renderSearchBar(),N.createElement("div",{className:"OrganizationsBrowser-bodyRow"},N.createElement("div",{className:"OrganizationsBrowser-bodyCol scrollable-flex-column"},this.renderOrganizations()),N.createElement("div",{className:"OrganizationsBrowser-filterCol"},this.renderFilterColumn())))}}]),t}(N.Component);function Qt(e,t){return{type:q.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t}}function Jt(e){return{type:q.BROWSE_ORGS_SEARCH_ERROR,error:e}}function Yt(){return function(e,t){e({type:q.BROWSE_ORGS_LOAD_START}),e(function(e){return{type:q.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:e}}({rawOrganizations:[],organizations:[],totalCount:0,filteredCount:0,sortField:"changed",sortDirection:O.DESCENDING,filter:{roleType:"myorgs",roles:[],privacy:"any"},searchTerms:[],selectedOrganizationId:null,searching:!1,error:null}))}}function Kt(e){return function(t,r){t({type:q.BROWSE_ORGS_SEARCH_START});var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config;if(null!==a.viewModel){var l=a.viewModel,u=l.sortField,E=l.sortDirection,d=l.filter;return new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}).queryOrgs({searchTerms:e,sortField:u,sortDirection:E,filter:d,username:s}).then(function(e){var r=e.organizations,n=e.total;t(Qt(r,n))}).catch(function(e){console.error("Error querying orgs",e.name,e.message),t(Jt({code:e.name,message:e.message}))})}t(Jt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function Xt(e,t){return function(r,n){r(function(e,t){return{type:q.BROWSE_ORGS_SORT_START,sortField:e,sortDirection:t}}(e,t));var a=n(),i=a.views.browseOrgsView,o=a.auth.authorization,s=o.token,c=o.username,l=a.app.config,u=new Me({token:s,username:c,groupsServiceURL:l.services.Groups.url});if(null!==i.viewModel){var E=i.viewModel,d=E.searchTerms,m=E.filter;return u.queryOrgs({searchTerms:d,sortField:e,sortDirection:t,filter:m,username:c}).then(function(e){var t=e.organizations,n=e.total;r(Qt(t,n))}).catch(function(e){r(Jt({code:e.name,message:e.message}))})}r(Jt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function Zt(e){return function(t,r){t(function(e){return{type:q.BROWSE_ORGS_FILTER_START,filter:e}}(e));var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url});if(null!==a.viewModel){var u=a.viewModel,E=u.searchTerms,d=u.sortField,m=u.sortDirection;return l.queryOrgs({searchTerms:E,sortField:d,sortDirection:m,filter:e,username:s}).then(function(e){var r=e.organizations,n=e.total;t(Qt(r,n))}).catch(function(e){t(Jt({code:e.name,message:e.message}))})}t(Jt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}var $t=Object(L.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.error;return{organizations:r,totalCount:t.totalCount,filteredCount:t.filteredCount,filter:t.filter,error:n,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(Kt(t))},onSortOrgs:function(t,r){e(Xt(t,r))},onFilterOrgs:function(t){e(Zt(t))}}})(Ft),er=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,"Fetching your orgs and other things...")}},{key:"renderError",value:function(){if(this.props.view.error)return N.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return N.createElement($t,{sortBy:"recentlyChanged"})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var tr=Object(L.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(Yt())},onUnload:function(){e({type:q.BROWSE_ORGS_UNLOAD})}}})(er);function rr(e){return{type:q.ADD_ORG_SAVE_ERROR,error:e}}function nr(){return{type:q.ADD_ORG_EVALUATE_ERRORS}}function ar(e){return{type:q.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function ir(e,t){return{type:q.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function or(){return function(e,t){e({type:q.ADD_ORG_LOAD_START});var r,n={id:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:we.validateOrgId("")[1]},name:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:we.validateOrgName("")[1]},logoUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:we.validateOrgLogoUrl("")[1]},homeUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:we.validateOrgHomeUrl("")[1]},researchInterests:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:we.validateOrgResearchInterests("")[1]},description:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:we.validateOrgDescription("")[1]},isPrivate:{value:!1,remoteValue:null,syncState:i.CLEAN,validationState:{type:s.OK,validatedAt:new Date}}};e((r=n,{type:q.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(cr())}}function sr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:q.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,o=r.views.addOrgView.viewModel.newOrganization,s=r.app.config,c=new Me({token:a,username:i,groupsServiceURL:s.services.Groups.url});o?c.addOrg(o,i).then(function(t){e(function(e){return{type:q.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",o,t),e(rr({code:t.code||t.name,message:t.message,exception:t}))}):e(rr({code:"app",message:"The new organization data does not yet exist"}))}else e(rr({code:"invalid",message:"Unexpected condition: no view model"}))}}function cr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState.type===s.OK&&a.id.validationState.type===s.OK&&a.logoUrl.validationState.type===s.OK&&a.homeUrl.validationState.type===s.OK&&a.researchInterests.validationState.type===s.OK&&a.description.validationState.type===s.OK?e({type:q.ADD_ORG_EVALUATE_OK}):e(nr())}else e(rr({code:"invalid",message:"Unexpected condition: no view model"}))}}function lr(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new Me({token:r,username:n,groupsServiceURL:a.services.Groups.url})}function ur(e){return function(t){var r=we.validateOrgName(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:q.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:q.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(cr())}}function Er(e){return function(t){var r,n=we.validateOrgLogoUrl(e),a=Object(dt.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:q.ADD_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(i,o)):t((r=i,{type:q.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:r})),t(cr())}}var dr=function(){function e(t,r){Object(y.a)(this,e),this.delay=void 0,this.fun=void 0,this.canceled=void 0,this.timer=void 0,this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(C.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),mr=null;function pr(e){return function(t,r){t(function(e){return{type:q.ADD_ORG_UPDATE_ID_PASS,id:e}}(e));var n=we.validateOrgId(e),a=Object(dt.a)(n,2),i=a[0],o=a[1];if(o.type!==s.OK)return t(ir(i,o)),void t(cr());var c=r().views.addOrgView.viewModel;if(c){var l=c.newOrganization.id.validationState.validatedAt,u=(new Date).getTime();if(l)if(u-l.getTime()<500)return void(mr||(mr=new dr(500,function(){t(function(e,t){var r=t(),n=r.views.addOrgView.viewModel;if(n){var a=n.newOrganization.id,i=we.validateOrgId(a.value),o=Object(dt.a)(i,2),c=o[0],l=o[1];if(l.type!==s.OK)return e(ir(c,l)),void e(cr());var u=lr(t());u.orgExists(c).then(function(t){e(t?ir(c,{type:s.ERROR,message:"This org id is already in use",validatedAt:new Date}):ar(c)),e(cr())})}})})));mr&&mr.cancel(),mr=null,lr(r()).orgExists(i).then(function(e){t(e?ir(i,{type:s.ERROR,validatedAt:new Date,message:"This org id is already in use"}):ar(i)),t(cr())})}}}function vr(e){return function(t,r){lr(r());var n=we.validateOrgDescription(e),a=Object(dt.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:q.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(i,o)):t(function(e){return{type:q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(i)),t(cr())}}var Or=r(345),hr=r(41),Rr=r(352),gr=(r(254),r(63)),_r=r.n(gr),fr=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,showError:!0},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onShowInfo",value:function(){Vt.a.info({title:"New Organization Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"As a KBase user, you may create your own organizations."),N.createElement("p",null,"Once you have created an Organization, you will be the sole owner of it, forever."),N.createElement("p",null,"In order to create an Org, you need to complete the following fields."),N.createElement("dl",null,N.createElement("dt",null,"name"),N.createElement("dd",null,"The organization ",N.createElement("i",null,"name")," is whatever you wish to have your Org known as. It may be composed of any text (including unicode characters) up to 200 characters in length. You may also change it at any time."),N.createElement("dt",null,"logo"),N.createElement("dd",null,N.createElement("p",null,"Logo support has undergone a redesign, but has not yet been implemented. The new design supports direct image upload, and removes gravatar support."),N.createElement("p",null,"For now, gravatar is the only support for org logo"),N.createElement("p",null,'In order to display a custom logo for your organization, you need to associate your Organization with an avatar hosted with the Gravatar service. To do so, simply enter the email address associated with your gravatar and press the update button. This will calculate a new "gravatar hash" and associate it with your organization.')),N.createElement("dt",null,"id"),N.createElement("dd",null,N.createElement("p",null,"Your Org ",N.createElement("i",null,"id")," forms a url endpoint for your org as well as the identifier used throughout KBase to, well, identify your organization uniquely among all current and future organizations. As such, the Org ID may not be changed once created."),N.createElement("p",null,"The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also restricted to 100 characters in length.")),N.createElement("dt",null,"description"),N.createElement("dd",null,N.createElement("p",null,"Up to 4000 characters, a description allows you to express to other KBase users the purpose, history, associations, and science domain of your Org."),N.createElement("p",null,'The description is in "markdown" format, and the editor will show you a preview of the rendered description.'))))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Vt.a.confirm({title:"Leave the editor?",content:N.createElement("div",null,N.createElement("p",null,"You have entered information for this new organization."),N.createElement("p",null,"If you leave the editor without first saving, the new organization ",N.createElement("i",null,"will not be created"),"."),N.createElement("p",null,N.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===o.EDITED&&this.props.saveState===c.NEW}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===i.DIRTY?N.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderEditor",value:function(){return N.createElement("form",{id:"newOrganizationForm",className:"NewOrganization-editor",onSubmit:this.onSubmit.bind(this)},N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{style:{flex:"1 1 0px"}},N.createElement("h3",null,"Create Your Organization"))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("h3",null,"Preview"))),N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{className:"NewOrganization-formLabel field-label"},N.createElement(et.a,{title:"This is the name for your organization as you want KBase users to see it"},"Name")),N.createElement("div",{className:"NewOrganization-formControl"},N.createElement(Rr.a,{value:this.props.newOrganization.name.value||"",className:this.calcFieldClass(this.props.newOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.newOrganization.name))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("div",{className:"NewOrganization-preview-name"},this.props.newOrganization.name.value||""))),N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{className:"NewOrganization-formLabel field-label"},"ID"),N.createElement("div",{className:"NewOrganization-formControl"},N.createElement(Rr.a,{value:this.props.newOrganization.id.value||"",className:this.calcFieldClass(this.props.newOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.newOrganization.id))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("div",{className:"NewOrganization-preview-id"},N.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.newOrganization.id.value||N.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{className:"NewOrganization-formLabel field-label"},"Logo URL"),N.createElement("div",{className:"NewOrganization-formControl"},N.createElement(Rr.a,{value:this.props.newOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.logoUrl))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("div",{className:"NewOrganization-preview-logo"},this.renderLogoPreview()))),N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{className:"NewOrganization-formLabel field-label"},"Home Page URL"),N.createElement("div",{className:"NewOrganization-formControl"},N.createElement(Rr.a,{value:this.props.newOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.homeUrl))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("div",{className:"NewOrganization-field-name"},N.createElement("a",{href:this.props.newOrganization.homeUrl.value||"",target:"_blank"},this.props.newOrganization.homeUrl.value||"")))),N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{className:"NewOrganization-formLabel field-label"},"Is Private?"),N.createElement("div",{className:"NewOrganization-formControl"},N.createElement(Gt.a,{checked:this.props.newOrganization.isPrivate.value,className:this.calcFieldClass(this.props.newOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.newOrganization.isPrivate))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("div",{className:"NewOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.newOrganization.isPrivate.value)))),N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{className:"NewOrganization-formLabel field-label"},"Research Interests"),N.createElement("div",{className:"NewOrganization-formControl"},N.createElement(_r.a,{value:this.props.newOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.newOrganization.researchInterests)+" NewOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.newOrganization.researchInterests))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("div",{className:"NewOrganization-preview-researchInterests"},this.props.newOrganization.researchInterests.value||""))),N.createElement("div",{className:"NewOrganization-row"},N.createElement("div",{className:"NewOrganization-col1"},N.createElement("div",{className:"NewOrganization-formLabel field-label"}),N.createElement("div",{className:"NewOrganization-formControl"},N.createElement(_r.a,{value:this.props.newOrganization.description.value||"",className:this.calcFieldClass(this.props.newOrganization.description)+" NewOrganization-control-description",autosize:{minRows:5,maxRows:15},onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.newOrganization.description))),N.createElement("div",{className:"NewOrganization-col2"},N.createElement("div",{className:"NewOrganization-preview-description",dangerouslySetInnerHTML:{__html:hr.Marked.parse(this.props.newOrganization.description.value||"")}}))))}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderLogo",value:function(e){return N.createElement($e,{logoUrl:null,size:64,organizationName:e.name.value,organizationId:e.id.value})}},{key:"renderIsPrivate",value:function(e){return e?N.createElement("span",null,N.createElement(tt.a,{type:"lock"})," ","Private"):N.createElement("span",null,N.createElement(tt.a,{type:"global"})," ","Public")}},{key:"renderDefaultLogo",value:function(){if(!this.props.newOrganization.name.value||!this.props.newOrganization.id.value)return N.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.newOrganization.name.value,0).toUpperCase(),t=Ze()(this.props.newOrganization.id.value).substr(0,6);return N.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},N.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogoPreview",value:function(){return this.props.newOrganization.logoUrl.value?N.createElement("img",{src:this.props.newOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return N.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderHeader",value:function(){var e,t=this.props.newOrganization.name.value||N.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");this.props.error&&(e=N.createElement(jt.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}));var r=N.createElement(N.Fragment,null,N.createElement("span",null,N.createElement(tt.a,{type:"plus-circle"})," ",'Adding a New Org "',t,'"')),n=N.createElement(N.Fragment,null,N.createElement(jt.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}),e);return N.createElement(Wt,{breadcrumbs:r,buttons:n})}},{key:"renderLoadingHeader",value:function(){var e=N.createElement("span",null,"Loading New Org Editor...");return N.createElement(Wt,{breadcrumbs:e})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return N.createElement("div",{key:"line_"+t},e)})),t&&(t=N.createElement("div",null,N.createElement("div",null,"trace"),t)),N.createElement(Vt.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},N.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),N.createElement("div",null,this.props.error.message),t)}}},{key:"render",value:function(){return this.state.cancelToBrowser?N.createElement(Or.a,{push:!0,to:"/organizations"}):this.props.saveState===c.SAVED?N.createElement(Or.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):this.props.newOrganization?N.createElement("div",{className:"NewOrganization"},this.renderHeader(),this.renderEditor(),this.renderError()):N.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(N.Component);var wr=Object(L.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(sr())},onUpdateName:function(t){e(ur(t))},onUpdateLogoUrl:function(t){e(Er(t))},onUpdateId:function(t){e(pr(t))},onUpdateDescription:function(t){e(vr(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(cr())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=we.validateOrgHomeUrl(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.ADD_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:i}):t({type:q.ADD_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a})}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=we.validateOrgHomeUrl(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a})}}(t))}}})(fr),Sr=(r(264),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return N.createElement("div",null,"Error!",N.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case h.SUCCESS:default:return N.createElement(wr,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component));var Ar=Object(L.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(or())},onUnload:function(){e({type:q.ADD_ORG_UNLOAD})}}})(Sr),Nr=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.params=t}return Object(C.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n,a,i,o,s,c;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Me({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),n=new fe({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(o=e.sent,(s=Se(a,this.params.username,i,o)).type!==he.ADMIN&&s.type!==he.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:c=e.sent,e.next=19;break;case 18:c=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:o,relation:s,groupRequests:c});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Ir(e,t,r){if("string"===typeof t)t=t.split(".");else if(!(t instanceof Array))throw new TypeError("Invalid type for key: "+typeof t);for(var n=0;n<t.length;n+=1){if(void 0===e||"object"!==typeof e||null===e)return r;e=e[t[n]]}return void 0===e?r:e}var br=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(y.a)(this,e),this.obj=void 0,this.obj=t}return Object(C.a)(e,[{key:"getItem",value:function(e,t){return Ir(this.obj,e,t)}},{key:"hasItem",value:function(e){return function(e,t){if("string"===typeof t)t=t.split(".");else if(!(t instanceof Array))throw new TypeError("Invalid type for key: "+typeof t);for(var r=0;r<t.length;r+=1){if(void 0===e||"object"!==typeof e||null===e)return!1;e=e[t[r]]}return void 0!==e}(this.obj,e)}},{key:"setItem",value:function(e,t){return function(e,t,r){if("string"===typeof t)t=t.split(".");else if(!(t instanceof Array))throw new TypeError("Invalid type for key: "+typeof t);if(0!==t.length){for(var n,a=t[t.length-1],i=0;i<t.length-1;i+=1)void 0===e[n=t[i]]&&(e[n]={}),e=e[n];return e[a]=r,r}}(this.obj,e,t)}},{key:"incrItem",value:function(e,t){return function(e,t,r){if("string"===typeof t)t=t.split(".");else if(!(t instanceof Array))throw new TypeError("Invalid type for key: "+typeof t);if(0!==t.length){r=void 0===r?1:r;for(var n=t[t.length-1],a=0;a<t.length-1;a+=1){var i=t[a];void 0===e[i]&&(e[i]={}),e=e[i]}if(void 0===e[n])e[n]=r;else{if("number"!==typeof e[n])throw new Error("Can only increment a number");e[n]+=r}return e[n]}}(this.obj,e,t)}},{key:"deleteItem",value:function(e){return function(e,t){if("string"===typeof t)t=t.split(".");else if(!(t instanceof Array))throw new TypeError("Invalid type for key: "+typeof t);if(0===t.length)return!1;for(var r=t[t.length-1],n=0;n<t.length-1;n+=1){var a=t[n];if(void 0===e[a])return!1;e=e[a]}return void 0!==e[r]&&(delete e[r],!0)}(this.obj,e)}},{key:"toJSON",value:function(){return Object.assign({},this.obj)}}]),e}(),Tr=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.userProfileClient=void 0,this.params=t,this.userProfileClient=new lt({url:this.params.userProfileServiceURL,token:this.params.token})}return Object(C.a)(e,[{key:"getProfile",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.userProfileClient.getUserProfile(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setLastVisitedAt",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getProfile(this.params.username);case 2:return n=e.sent,(a=new br({user:n.user,profile:{plugins:Ir(n,"profile.plugins",{})}})).setItem("profile.plugins.organizations.orgSettings."+t,{settings:{lastVisitedAt:r.toISOString()}}),e.next=7,this.userProfileClient.updateUserProfile(a.toJSON());case 7:return e.abrupt("return");case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),yr=r(38),Cr=r.n(yr);function Mr(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,o=e.info;return{code:t,message:r,detail:n,id:Cr()(),at:new Date,history:a,trace:i,info:o}}function Dr(){return function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a,i,o,s,c,l;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:q.DATA_SERVICE_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new Tr({token:i,username:o,userProfileServiceURL:s.services.UserProfile.url}),e.prev=3,e.next=6,c.getProfile(o);case 6:l=e.sent,t({type:q.DATA_SERVICE_LOAD_SUCCESS,profile:l}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("error",e.t0),t((u=Mr({code:e.t0.name,message:e.t0.name}),{type:q.DATA_SERVICE_LOAD_ERROR,error:u}));case 14:case"end":return e.stop()}var u},e,this,[[3,10]])}));return function(t,r){return e.apply(this,arguments)}}()}function Ur(e){return{type:q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrative:e}}function kr(e){return{type:q.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function Vr(e){return{type:q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e}}function jr(e){return{type:q.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function zr(e,t,r,n,a,i,o){return{type:q.VIEW_ORG_LOAD_NORMAL_SUCCESS,organization:e,relation:t,groupRequests:r,groupInvitations:n,requestInbox:a,requestOutbox:i,notifications:o}}function Lr(e){return{type:q.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function Gr(){return{type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function Pr(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p,v,O,h,R,g;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=a.db.notifications,l.all,l.byId,u=new Nr({token:o,username:s,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),E=new fe({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,u.getOrganizationForUser(e);case 7:if(d=t.sent,m=d.organization,p=d.relation,m.kind===_e.NORMAL){t.next=16;break}return t.next=13,E.getRequestInboxForOrg(e);case 13:return v=t.sent,r((f=m,w=p,S=v,{type:q.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,organization:f,relation:w,requestOutbox:S})),t.abrupt("return");case 16:if(p.type!==he.OWNER&&p.type!==he.ADMIN){t.next=25;break}return t.next=19,E.getPendingOrganizationRequestsForOrg(e);case 19:return O=t.sent,t.next=22,E.getOrganizationInvitationsForOrg(e);case 22:h=t.sent,t.next=27;break;case 25:O=null,h=null;case 27:return t.next=29,E.getCombinedRequestInboxForOrg(e);case 29:return R=t.sent,t.next=32,E.getRequestOutboxForOrg(e);case 32:g=t.sent,r(zr(m,p,O,h,R,g,[])),t.next=39;break;case 36:t.prev=36,t.t0=t.catch(4),r((_={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_LOAD_ERROR,error:_}));case 39:case"end":return t.stop()}var _,f,w,S},t,this,[[4,36]])}));return function(e,r){return t.apply(this,arguments)}}()}function xr(){return function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,i,o,s,c,l,u;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r()).views.viewOrgView.viewModel){e.next=4;break}return t(Lr({type:a.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config,l=n.views.viewOrgView.viewModel.organization,u=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),e.prev=6,e.next=9,u.requestMembershipToGroup(l.id);case 9:t({type:q.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(Pr(l.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(Lr({type:a.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,this,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function Br(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_JOIN_REQUEST_START}),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Lr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new fe({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.cancelRequest(e);case 10:E=t.sent,r({type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(Pr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:a.ERROR,message:t.t0.message},{type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function Wr(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Gr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Lr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new fe({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.acceptJoinInvitation(e);case 10:E=t.sent,r({type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(Pr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function qr(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Gr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Lr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new fe({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.rejectJoinInvitation(e);case 10:E=t.sent,r({type:q.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(Pr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function Hr(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),t.abrupt("return");case 5:if(i.kind===S.NORMAL){t.next=8;break}return r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_START}),o=a.auth.authorization,s=o.token,c=o.username,l=a.app.config,u=new fe({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.acceptRequest(e);case 14:return t.next=16,u.getCombinedRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}function Fr(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),t.abrupt("return");case 5:if(i.kind===S.NORMAL){t.next=8;break}return r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:q.VIEW_ORG_REJECT_INBOX_REQUEST_START}),o=a.auth.authorization,s=o.token,c=o.username,l=a.app.config,u=new fe({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.denyRequest(e);case 14:return t.next=16,u.getRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:q.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:q.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}function Qr(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_START}),a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=6;break}return r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),t.abrupt("return");case 6:if(i.kind===S.NORMAL){t.next=9;break}return r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 9:return o=a.auth.authorization,s=o.token,c=o.username,l=a.app.config,u=new fe({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.cancelRequest(e);case 14:return t.next=16,u.getRequestOutboxForOrg(i.organization.id);case 16:E=t.sent,r({type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:Mr({code:"error",message:t.t0.message})});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}var Jr,Yr,Kr=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,{code:"feeds-exception",message:e.message,detail:e.message,info:new Map}))).originalError=void 0,r.name="FeedsException",r.originalError=e,r}return Object(U.a)(t,e),t}(H),Xr=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(U.a)(t,e),t}(H),Zr=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.params=t}return Object(C.a)(e,[{key:"put",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.abrupt("return",fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new Kr(e)});case"text/plain":return e.text().then(function(e){throw new Xr(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a,i,o;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new Kr(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new Xr(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"postWithResult",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a,i,o;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new Kr(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new Xr(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a,i,o,s;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.from(r.entries()).map(function(e){var t=Object(dt.a)(e,2),r=t[0],n=t[1];return[r,encodeURIComponent(n)].join("=")}).join("&"),a=this.baseURLPath().concat(t).join("/")+"?"+n,e.next=4,fetch(a,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 4:if(500!==(i=e.sent).status){e.next=20;break}e.t0=i.headers.get("Content-Type"),e.next="application/json"===e.t0?9:"text/plain"===e.t0?13:17;break;case 9:return e.next=11,i.json();case 11:throw o=e.sent,new Kr(o);case 13:return e.next=15,i.text();case 15:throw s=e.sent,new Xr(s);case 17:throw new Error("Unexpected content type: "+i.headers.get("Content-Type"));case 18:e.next=27;break;case 20:if(200!==i.status){e.next=26;break}return e.next=23,i.json();case 23:return e.abrupt("return",e.sent);case 26:throw new Error("Unexpected response: "+i.status+" : "+i.statusText);case 27:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"baseURLPath",value:function(){return[this.params.url,"api","V1"]}},{key:"getNotifications",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.count,(n=new Map).set("n",String(r)),e.next=5,this.get(["notifications"],n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"seeNotifications",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postWithResult(["notifications","see"],t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function $r(e){switch(e){case"alert":return Jr.ALERT;case"error":return Jr.ERROR;case"warning":return Jr.WARNING;case"request":return Jr.REQUEST;default:throw new Error("Invalid level value: "+e)}}function en(e){var t=e.target[0];switch(e.verb){case"requested":switch(t.type){case"user":return Yr.JOIN_REQUEST;case"narrative":case"workspace":return Yr.NARRATIVE_ASSOCIATION_REQUEST;case"app":return Yr.APP_ASSOCIATION_REQUEST}case"updated":switch(t.type){case"narrative":case"workspace":return Yr.NARRATIVE_ASSOCIATED}case"accepted":switch(t.type){case"narrative":case"workspace":return Yr.NARRATIVE_ACCEPTED;case"user":return Yr.USER_ACCEPTED}case"invited":switch(t.type){case"user":return Yr.JOIN_INVITATION}default:return console.log("unknown??",e),Yr.UNKNOWN}return Yr.UNKNOWN}!function(e){e[e.ALERT=0]="ALERT",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.REQUEST=3]="REQUEST"}(Jr||(Jr={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JOIN_REQUEST=1]="JOIN_REQUEST",e[e.JOIN_INVITATION=2]="JOIN_INVITATION",e[e.USER_JOINED=3]="USER_JOINED",e[e.USER_ACCEPTED=4]="USER_ACCEPTED",e[e.NARRATIVE_ASSOCIATION_REQUEST=5]="NARRATIVE_ASSOCIATION_REQUEST",e[e.NARRATIVE_ASSOCIATED=6]="NARRATIVE_ASSOCIATED",e[e.NARRATIVE_ACCEPTED=7]="NARRATIVE_ACCEPTED",e[e.APP_ASSOCIATION_REQUEST=8]="APP_ASSOCIATION_REQUEST",e[e.APP_ASSOCIATED=9]="APP_ASSOCIATED",e[e.MESSAGE=10]="MESSAGE"}(Yr||(Yr={}));var tn=function(){function e(t){Object(y.a)(this,e),this.params=void 0,this.feedsClient=void 0,this.params=t,this.feedsClient=new Zr({token:this.params.token,url:this.params.feedsServiceURL})}return Object(C.a)(e,[{key:"getNotifications",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,e.abrupt("return",t.user.feed.map(function(e){var t=e.id,r=e.actor,n=e.verb,a=e.object,i=e.target,o=e.source,s=e.level,c=e.seen,l=e.created,u=e.expires,E=e.external_key,d=e.context;return{id:t,actor:r,verb:n,object:a,target:i,source:o,level:$r(s),seen:c,createdAt:new Date(l),expiresAt:new Date(u),externalKey:E,context:d}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationNotifications",value:function(){var e=Object(le.a)(ce.a.mark(function e(){var t,r=this;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,e.abrupt("return",t.user.feed.filter(function(e){var t=e.actor;return"groupsservice"===e.source&&t.id!==r.params.username}).map(function(e){return{id:e.id,from:e.actor.id,createdAt:new Date(e.created),expiresAt:new Date(e.expires),level:$r(e.level),read:e.seen,organizationId:e.object.id,type:en(e),regarding:e.target}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"seeNotification",value:function(){var e=Object(le.a)(ce.a.mark(function e(t){var r,n;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.seeNotifications({note_ids:[t]});case 2:return r=e.sent,n=r.seen_notes,r.unauthorized_notes,e.abrupt("return",n[0]);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();r(268);var rn,nn=r(348),an=r(353),on=r(341);r(270);function sn(e){switch(e){case rn.COMPACT:return rn.NORMAL;case rn.NORMAL:return rn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(rn||(rn={}));var cn=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={view:rn.COMPACT},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onToggleView",value:function(){this.setState({view:sn(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case Re.OWNER:return N.createElement("span",null,N.createElement(tt.a,{type:"crown"})," owner");case Re.ADMIN:return N.createElement("span",null,N.createElement(tt.a,{type:"unlock"})," admin");case Re.MEMBER:return N.createElement("span",null,N.createElement(tt.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){return N.createElement("div",{className:"Member View-COMPACT"},N.createElement("div",{className:"Member-controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===rn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===rn.NORMAL?"up":"down")}))),N.createElement("div",{className:"Member-avatarCol"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||30})),N.createElement("div",{className:"Member-infoCol"},N.createElement("div",{className:"Member-name"},N.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),N.createElement("div",{className:"Member-role"},this.renderRole()),N.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title)))}},{key:"renderNormal",value:function(){return N.createElement("div",{className:"Member View-NORMAL"},N.createElement("div",{className:"Member-controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===rn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===rn.NORMAL?"up":"down")}))),N.createElement("div",{className:"Member-avatarCol"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||30})),N.createElement("div",{className:"Member-infoCol"},N.createElement("div",{className:"Member-name"},N.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),N.createElement("div",{className:"Member-role"},this.renderRole()),N.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title),N.createElement("div",{className:"Member-joinedAt"},N.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt)),N.createElement("div",{className:"Member-organization"},this.props.user.organization||N.createElement("i",null,"no organization in user profile")),N.createElement("div",{className:"Member-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||N.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case rn.COMPACT:return this.renderCompact();case rn.NORMAL:return this.renderNormal()}}}]),t}(N.Component),ln=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.user?N.createElement(cn,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):N.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(N.Component);var un,En=Object(L.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(It(t))}}})(ln),dn=r(354);r(272);!function(e){e[e.NONE=0]="NONE",e[e.MANAGE_MEMBERSHIP=1]="MANAGE_MEMBERSHIP",e[e.VIEW_MEMBERS=2]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=3]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=4]="VIEW_ORGANIZATION",e[e.EDIT_ORGANIZATION=5]="EDIT_ORGANIZATION",e[e.INVITE_USER=6]="INVITE_USER"}(un||(un={}));var mn=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).relation=void 0,r.state={navigateTo:un.NONE},r.relation=r.getUserRelation(),r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"getUserRelation",value:function(){var e=this.props.currentUsername,t=this.props.organization;if(e===t.owner.username)return{type:he.OWNER};var r=t.members.find(function(t){return t.username===e});if(!r)return this.props.pendingJoinRequest&&this.props.pendingJoinRequest.user===e?{type:he.MEMBER_REQUEST_PENDING,requestId:this.props.pendingJoinRequest.id}:this.props.pendingJoinInvitation&&this.props.pendingJoinInvitation.user===e?{type:he.MEMBER_INVITATION_PENDING,requestId:this.props.pendingJoinInvitation.id}:{type:he.VIEW};switch(r.type){case l.MEMBER:return{type:he.MEMBER};case l.ADMIN:return{type:he.ADMIN};case l.OWNER:return{type:he.OWNER};default:return{type:he.NONE}}}},{key:"onJoinClick",value:function(){this.props.onJoinOrg(),dn.a.success("Join request has been submitted")}},{key:"onCancelJoinRequest",value:function(){var e=this.relation;this.props.onCancelJoinRequest(e.requestId),dn.a.success("Submitted cancellation request")}},{key:"onAcceptInvitation",value:function(){var e=this.relation;this.props.onAcceptInvitation(e.requestId),dn.a.success("Invitation acceptance has been sent")}},{key:"onRejectInvitation",value:function(){var e=this.relation;this.props.onRejectInvitation(e.requestId),dn.a.success("Invitation rejection has been sent")}},{key:"onNavigateToMembership",value:function(){this.setState({navigateTo:un.MANAGE_MEMBERSHIP})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:un.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:un.MANAGE_REQUESTS})}},{key:"onNavigateToEditOrganization",value:function(){this.setState({navigateTo:un.EDIT_ORGANIZATION})}},{key:"onNavigateToInviteUser",value:function(){this.setState({navigateTo:un.INVITE_USER})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:un.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({navigateTo:un.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:un.VIEW_MEMBERS});break;case"editOrg":this.setState({navigateTo:un.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({navigateTo:un.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:un.MANAGE_REQUESTS})}}},{key:"renderLogo",value:function(e){return N.createElement($e,{logoUrl:e.logoUrl,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderRelation",value:function(){this.props.organization;switch(this.relation.type){case he.NONE:return N.createElement("span",null,N.createElement(tt.a,{type:"stop"}),"None");case he.VIEW:return N.createElement("div",null,N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it, you may request membership"},N.createElement("div",{style:{textAlign:"center"}},N.createElement(tt.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization")),N.createElement("div",{style:{textAlign:"center"}},N.createElement(jt.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization")));case he.MEMBER_REQUEST_PENDING:return N.createElement("div",null,N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have requested membership in this Organization"},"   ",N.createElement("div",{style:{textAlign:"center"}},N.createElement("span",null,N.createElement(tt.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",N.createElement("b",null,"request")," is pending"," ",N.createElement(tt.a,{type:"question-circle"})))),N.createElement("div",{style:{textAlign:"center"}},N.createElement(jt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case he.MEMBER_INVITATION_PENDING:return N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this Organization"},N.createElement("div",{style:{textAlign:"center"}},N.createElement("div",null,N.createElement(tt.a,{type:"user",style:{color:"blue"}}),"You have been ",N.createElement("b",null,"invited")," to join this Organization"),N.createElement("div",null,N.createElement(jt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept"),N.createElement(jt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject"))));case he.MEMBER:var e=N.createElement(Bt.a,{onClick:this.onMenuClick.bind(this)},N.createElement(Bt.a.Item,{key:"manageMyMembership"},"Manage My Membership"));return N.createElement("div",{className:"relationRow"},N.createElement("div",{className:"relationLabel"},N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},N.createElement("div",null,N.createElement(tt.a,{type:"user"}),"You are a ",N.createElement("b",null,"member")," of this Organization"))),N.createElement("div",{className:"relationMenu"},N.createElement("div",null,N.createElement(an.a,{overlay:e,trigger:["click"]},N.createElement(jt.a,{shape:"circle"},N.createElement(tt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case he.ADMIN:var t=N.createElement(Bt.a,{onClick:this.onMenuClick.bind(this)},N.createElement(Bt.a.Item,{key:"manageMyMembership"},"Manage My Membership"),N.createElement(Bt.a.Item,{key:"viewMembers"},"Members"),N.createElement(Bt.a.Item,{key:"editOrg"},"Edit this Org"),N.createElement(Bt.a.Item,{key:"inviteUser"},"Invite User"));return N.createElement("div",{className:"relationRow"},N.createElement("div",{className:"relationLabel"},N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an Administrator for this organization"},N.createElement("div",null,N.createElement(tt.a,{type:"unlock"}),"You are a ",N.createElement("b",null,"administrator")," of this Organization"))),N.createElement("div",{className:"relationMenu"},N.createElement("div",null,N.createElement(an.a,{overlay:t,trigger:["click"]},N.createElement(jt.a,{shape:"circle"},N.createElement(tt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case he.OWNER:var r=N.createElement(Bt.a,{onClick:this.onMenuClick.bind(this)},N.createElement(Bt.a.Item,{key:"viewMembers"},"Members"),N.createElement(Bt.a.Item,{key:"editOrg"},"Edit this Org"),N.createElement(Bt.a.Item,{key:"inviteUser"},"Invite User"));return N.createElement("div",{className:"relationRow"},N.createElement("div",{className:"relationLabel"},N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this organization"},N.createElement("div",null,N.createElement(tt.a,{type:"crown",style:{color:"gold"}})," ","You ",N.createElement("b",null,"own")," this Organization"))),N.createElement("div",{className:"relationMenu"},N.createElement("div",null,N.createElement(an.a,{overlay:r,trigger:["click"]},N.createElement(jt.a,{shape:"circle"},N.createElement(tt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))))}}},{key:"renderHomeUrl",value:function(e){if(e.homeUrl)return N.createElement("div",{className:"homeUrl"},N.createElement("a",{href:e.homeUrl,target:"_blank"},N.createElement(tt.a,{type:"home"})," ",e.homeUrl))}},{key:"renderOrgInfo",value:function(){var e=this.props.organization;return N.createElement(N.Fragment,null,N.createElement("div",{className:"name"},e.name),N.createElement("div",null,N.createElement("div",{style:{display:"inline-block",width:"50%",verticalAlign:"top"}},N.createElement("div",null,this.renderHomeUrl(e)),N.createElement("div",{className:"owner"},N.createElement(Ct,{username:e.owner.username,avatarSize:20}))),N.createElement("div",{style:{display:"inline-block",width:"50%",verticalAlign:"top"}},N.createElement("div",null,N.createElement("span",{className:"field-label"},"established"),N.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("div",null,N.createElement("span",{className:"field-label"},"last modified"),N.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.modifiedAt))))))}},{key:"getRelationClass",value:function(e){switch(this.relation.type){case he.NONE:return"relationRequest";case he.VIEW:return"relationRequest relationNonMember";case he.MEMBER_REQUEST_PENDING:return"relationRequest relationRequestPending";case he.MEMBER_INVITATION_PENDING:return"relationRequest relationInvitationPending";case he.MEMBER:return"relationRequest relationMember";case he.ADMIN:return"relationRequest relationAdmin";case he.OWNER:return"relationRequest relationOwner"}}},{key:"render",value:function(){switch(this.state.navigateTo){case un.MANAGE_MEMBERSHIP:return N.createElement(Or.a,{push:!0,to:"/membership/"+this.props.organization.id});case un.VIEW_MEMBERS:return N.createElement(Or.a,{push:!0,to:"/viewMembers/"+this.props.organization.id});case un.EDIT_ORGANIZATION:return N.createElement(Or.a,{push:!0,to:"/editOrganization/"+this.props.organization.id});case un.MANAGE_REQUESTS:return N.createElement(Or.a,{push:!0,to:"/manageOrganizationRequests/"+this.props.organization.id});case un.INVITE_USER:return N.createElement(Or.a,{push:!0,to:"/inviteUser/"+this.props.organization.id});case un.VIEW_ORGANIZATION:return N.createElement(Or.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id})}return N.createElement("div",{className:"OrganizationHeader"},N.createElement("div",{className:"avatar"},this.renderLogo(this.props.organization)),N.createElement("div",{className:"orgInfo"},this.renderOrgInfo()),N.createElement("div",{className:"yourRelation "+this.getRelationClass(this.props.organization)},this.renderRelation()))}}]),t}(N.Component);var pn=Object(L.b)(function(e,t){var r=e.views.organizationCentricView.viewModel,n=e.auth.authorization.username;if(!r)throw new Error("View model is unexpectedly missing");return{organization:r.organization,pendingJoinRequest:r.pendingJoinRequest,pendingJoinInvitation:r.pendingJoinInvitation,currentUsername:n}},function(e){return{onJoinOrg:function(){e(xr())},onCancelJoinRequest:function(t){e(Br(t))},onAcceptInvitation:function(t){e(Wr(t))},onRejectInvitation:function(t){e(qr(t))}}})(mn);function vn(e){var t=e.organization,r=e.pendingJoinRequest,n=e.pendingJoinInvitation,a=e.relation;return{type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,organization:t,pendingJoinRequest:r,pendingJoinInvitation:n,relation:a}}function On(e){return{type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,error:e}}var hn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,"Loading header...")}},{key:"renderError",value:function(e){return N.createElement("div",null,"Error!",N.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return N.createElement(pn,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var Rn,gn=Object(L.b)(function(e,t){return{view:e.views.organizationCentricView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),u=new fe({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,l.getOrg(e);case 7:if((E=t.sent).kind===_e.NORMAL){t.next=11;break}return r(On({code:"invalid state",message:'Organization must be of kind "NORMAL"'})),t.abrupt("return");case 11:return t.next=13,u.getUserRequestForOrg(e);case 13:return d=t.sent,t.next=16,u.getUserInvitationForOrg(e);case 16:m=t.sent,p=Se(E,s,d,m),r(vn({organization:E,relation:p,pendingJoinRequest:d,pendingJoinInvitation:m})),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(4),r(On({code:t.t0.name,message:t.t0.message}));case 24:case"end":return t.stop()}},t,this,[[4,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.ORGANIZATION_CENTRIC_VIEW_UNLOAD})}}})(hn),_n=r(355);r(274),r(276);function fn(e){switch(e){case Rn.COMPACT:return Rn.NORMAL;case Rn.NORMAL:return Rn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Rn||(Rn={}));var wn=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={view:Rn.COMPACT},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onToggleView",value:function(){this.setState({view:fn(this.state.view)})}},{key:"renderCompact",value:function(){return N.createElement(N.Fragment,null,N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Rn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===Rn.NORMAL?"up":"down")}))),N.createElement("div",{className:"avatarCol"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||30})),N.createElement("div",{className:"infoCol"},N.createElement("div",{className:"name"},N.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),N.createElement("div",null,this.props.user.username)))}},{key:"renderNormal",value:function(){return N.createElement(N.Fragment,null,N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Rn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===Rn.NORMAL?"up":"down")}))),N.createElement("div",{className:"avatarCol"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||30})),N.createElement("div",{className:"infoCol"},N.createElement("div",{className:"name"},N.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),N.createElement("div",null,this.props.user.username),N.createElement("div",{className:"organization"},this.props.user.organization||N.createElement("i",null,"no organization in user profile")),N.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||N.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case Rn.COMPACT:return N.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case Rn.NORMAL:return N.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(N.Component),Sn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.user?N.createElement(wn,{user:this.props.user,avatarSize:this.props.avatarSize}):N.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(N.Component);var An,Nn=Object(L.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(It(t))}}})(Sn);function In(e){switch(e){case An.COMPACT:return An.NORMAL;case An.NORMAL:return An.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(An||(An={}));var bn=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={view:An.COMPACT},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onToggleView",value:function(){this.setState({view:In(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?N.createElement(et.a,{title:"This narrative is viewable by all KBase users",placement:"right"},N.createElement("span",{style:{cursor:"help"}},N.createElement(tt.a,{type:"global"})," Public Narrative")):N.createElement(et.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},N.createElement("span",{style:{cursor:"help"}},N.createElement(tt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case _t.VIEW:t=N.createElement("span",null,"View-Only (",N.createElement("i",null,"visit narrative to request additional access"),")");break;case _t.EDIT:t=N.createElement("span",null,"Edit (",N.createElement("i",null,"visit narrative to request additional access"),")");break;case _t.ADMIN:t="Admin";break;case _t.OWNER:t="Owner";break;default:t="Unknown"}return N.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===An.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===An.NORMAL?"up":"down")}))),N.createElement("div",{className:"mainCol"},N.createElement("div",{className:"title"},N.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),N.createElement("div",null,this.renderPublicPermission(e)),N.createElement("div",null,N.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e))))}},{key:"renderNormal",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===An.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===An.NORMAL?"up":"down")}))),N.createElement("div",{className:"mainCol"},N.createElement("div",{className:"title"},N.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),N.createElement("div",null,this.renderPublicPermission(e)),N.createElement("div",null,N.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),N.createElement("div",null,N.createElement("span",{className:"field-label"},"owner"),N.createElement("div",{style:{display:"inline-block"}},N.createElement(Nn,{avatarSize:20,userId:e.owner}))),N.createElement("div",null,N.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),N.createElement("div",null,N.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===_t.NONE)return console.log("NO ACCESS",e),N.createElement("div",null,"You don't have access to this Narrative");switch(this.state.view){case An.COMPACT:return N.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case An.NORMAL:return N.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(N.Component),Tn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.narrative?N.createElement(bn,{narrative:this.props.narrative}):N.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(N.Component);var yn=Object(L.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Tt(t))}}})(Tn),Cn=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case ge.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=N.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you can obtain personal View-Only access by clicking this button",r=N.createElement(jt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=N.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=N.createElement(jt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access"));break;case ge.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=N.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=N.createElement(jt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case ge.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=N.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=N.createElement(jt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case ge.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=N.createElement("span",null,"Admin");break;case ge.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=N.createElement("span",null,"Owner");break;default:t=N.createElement("span",null,"Unknown")}return N.createElement(N.Fragment,null,N.createElement(et.a,{title:n,placement:"right"},N.createElement("span",{style:{cursor:"help"}},N.createElement("span",{className:"field-label"},"your permission"),t))," ",N.createElement(et.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return console.log("narr",e),e.isPublic?N.createElement(et.a,{title:"This narrative is viewable by all KBase users",placement:"right"},N.createElement("span",{style:{cursor:"help"}},N.createElement(tt.a,{type:"global"})," Public Narrative")):N.createElement(et.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},N.createElement("span",{style:{cursor:"help"}},N.createElement(tt.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return e.permission===ge.NONE?N.createElement(N.Fragment,null,N.createElement("div",{className:"title"},e.title),N.createElement("div",null,this.renderNarrativePermission(e))):N.createElement(yn,{workspaceId:e.workspaceId})}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=N.createElement(_n.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),N.createElement("div",null,this.renderNarrative(),e)}}]),t}(N.Component);function Mn(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),o=Math.abs(i);if(o<7776e3){if(0===o)return"now";o<60?(t=i,r=o,n="second"):o<3600?(t=Math.round(i/60),r=Math.round(o/60),n="minute"):o<86400?(t=Math.round(i/3600),r=Math.round(o/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(o/86400),n="day"),r>1&&(n+="s");var s=null,c=null;return t<0?s="in":t>0&&(c="ago"),(s?s+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var Dn;r(278);function Un(e){switch(e){case Dn.COMPACT:return Dn.NORMAL;case Dn.NORMAL:return Dn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Dn||(Dn={}));var kn=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={view:Dn.COMPACT},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Un(this.state.view)})}},{key:"renderLogo",value:function(e){return N.createElement($e,{logoUrl:e.logoUrl,size:32,organizationName:e.name,organizationId:e.id})}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(e){return N.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderNormal",value:function(e){return N.createElement("div",{className:"OrganizationCompact",key:e.id},N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Dn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===Dn.NORMAL?"up":"down")}))),N.createElement("div",{className:"avatarCol"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),N.createElement("div",{className:"bodyCol"},N.createElement("div",{className:"orgName"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},e.name)),N.createElement("div",{className:"orgOwner"},N.createElement("span",{className:"field-label"},"owner"),N.createElement("span",null,N.createElement(Ct,{username:e.owner.username,avatarSize:30}))),N.createElement("div",{className:"orgCreated"},N.createElement("span",{className:"field-label"},"established"),N.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))))}},{key:"renderCompact",value:function(e){return N.createElement("div",{className:"OrganizationCompact",key:e.id},N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Dn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===Dn.NORMAL?"up":"down")}))),N.createElement("div",{className:"avatarCol"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),N.createElement("div",{className:"bodyCol"},N.createElement("div",{className:"orgName"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(e.id)},e.name))))}},{key:"render",value:function(){var e=this.props.organization;if(e.kind!==_e.NORMAL)return N.createElement("div",null,"Private Organization");switch(this.state.view){case Dn.COMPACT:return N.createElement("div",{className:"User View-COMPACT"},this.renderCompact(e));case Dn.NORMAL:return N.createElement("div",{className:"User View-NORMAL"},this.renderNormal(e))}}}]),t}(N.Component),Vn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.organization?N.createElement(kn,{organization:this.props.organization}):N.createElement("div",null,"Loading org...")}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(N.Component);var jn,zn=Object(L.b)(function(e,t){return{organization:e.entities.orgs.byId.get(t.organizationId)}},function(e){return{onLoad:function(t){e(bt(t))}}})(Vn);r(280);function Ln(e){switch(e){case jn.COMPACT:return jn.NORMAL;case jn.NORMAL:return jn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(jn||(jn={}));var Gn=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={view:jn.COMPACT},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Ln(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return console.log("narr",e),e.isPublic?N.createElement(et.a,{title:"This narrative is viewable by all KBase users",placement:"right"},N.createElement("span",{style:{cursor:"help"}},N.createElement(tt.a,{type:"global"})," Public Narrative")):N.createElement(et.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},N.createElement("span",{style:{cursor:"help"}},N.createElement(tt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case _t.VIEW:t=N.createElement("span",null,"View-Only (",N.createElement("i",null,"visit narrative to request additional access"),")");break;case _t.EDIT:t=N.createElement("span",null,"Edit (",N.createElement("i",null,"visit narrative to request additional access"),")");break;case _t.ADMIN:t="Admin";break;case _t.OWNER:t="Owner";break;default:t="Unknown"}return N.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===jn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===jn.NORMAL?"up":"down")}))),N.createElement("div",{className:"iconCol"},N.createElement(tt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),N.createElement("div",{className:"mainCol"},N.createElement("div",{className:"title"},N.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))))}},{key:"renderNormal",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"controlCol"},N.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===jn.NORMAL?"pressed":"")},N.createElement(tt.a,{type:"".concat(this.state.view===jn.NORMAL?"up":"down")}))),N.createElement("div",{className:"iconCol"},N.createElement(tt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),N.createElement("div",{className:"mainCol"},N.createElement("div",{className:"title"},N.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),N.createElement("div",null,this.renderPublicPermission(e)),N.createElement("div",null,N.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),N.createElement("div",null,N.createElement("span",{className:"field-label"},"owner"),N.createElement(Nn,{avatarSize:20,userId:e.owner})),N.createElement("div",null,N.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),N.createElement("div",null,N.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===_t.NONE)return N.createElement("div",null,N.createElement(tt.a,{type:"exclamation-circle",style:{color:"orange"}})," ","You don't have access to this Narrative");switch(this.state.view){case jn.COMPACT:return N.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case jn.NORMAL:return N.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(N.Component),Pn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.narrative?N.createElement(Gn,{narrative:this.props.narrative}):N.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(N.Component);var xn=Object(L.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Tt(t))}}})(Pn),Bn=(r(282),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(Nn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return N.createElement(Nn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"REQUEST to associate App";case Ee.USER:return"REQUEST to join Organization";case Ee.WORKSPACE:return"REQUEST to associate Narrative"}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})),N.createElement("div",{className:"cardSectionHeader"},"with organization"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return N.createElement(Nn,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){var t;return this.props.showOrg&&(t=N.createElement("div",{className:"miniDetail"},N.createElement(zn,{organizationId:e.organizationId}))),N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),t,this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return this.props.showOrg&&N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"with organization"),N.createElement("div",{className:"miniDetail"},N.createElement(zn,{organizationId:e.organizationId}))),N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return N.createElement("div",{style:{textAlign:"center"}},N.createElement(jt.a.Group,{style:{marginTop:"4px"}},N.createElement(jt.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},N.createElement(tt.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){var t;return this.props.showOrg&&(t=N.createElement("div",{className:"miniDetail"},N.createElement(zn,{organizationId:e.organizationId}))),N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),t,N.createElement("div",{className:"cardSectionHeader"},"sent to"),N.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.USER:return this.renderJoinRequest(e);case Ee.WORKSPACE:return this.renderWorkspaceRequest(e);case Ee.APP:return N.createElement(N.Fragment,null,N.createElement("div",null,"apps not supported yet"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return this.renderUserInvitation(e);case Ee.WORKSPACE:case Ee.APP:return N.createElement(N.Fragment,null,N.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return N.createElement("div",{key:e.id,className:"OutboxRequest kbCard"},N.createElement("div",{className:"kbCard-header"},N.createElement("div",{className:"OutboxRequest-requestHeaderRow"},N.createElement("div",{className:"OutboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),N.createElement("div",{className:"OutboxRequest-requestHeaderExpireAt"},N.createElement("span",{className:"field-label"},"expires")," ",Mn(e.expireAt)))),N.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(N.Component));var Wn=Object(L.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_START}),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new fe({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,l.cancelRequest(e.id);case 8:return t.sent,t.next=11,l.getOutboundRequests();case 11:u=t.sent,r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS,requests:u}),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 18:case"end":return t.stop()}},t,this,[[5,15]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Bn),qn=(r(284),r(286),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return N.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||20})," ",this.props.user.realname)}}]),t}(N.Component)),Hn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.user?N.createElement(qn,{user:this.props.user,avatarSize:this.props.avatarSize}):N.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(N.Component);var Fn=Object(L.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(It(t))}}})(Hn),Qn=(r(288),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLogo",value:function(e){return N.createElement($e,{logoUrl:e.logoUrl,size:16,organizationName:e.name,organizationId:e.id})}},{key:"render",value:function(){return this.props.organization.kind===_e.INACCESSIBLE_PRIVATE?N.createElement("div",null,"Private Organization"):N.createElement("span",{className:"OrganizationInline"},N.createElement(Ke.a,{to:"/viewOrganization/".concat(this.props.organization.id)},this.props.organization.name))}}]),t}(N.Component)),Jn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.organization?N.createElement(Qn,{organization:this.props.organization}):N.createElement("div",null,"Loading org...")}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(N.Component);var Yn=Object(L.b)(function(e,t){return{organization:e.entities.orgs.byId.get(t.organizationId)}},function(e){return{onLoad:function(t){e(bt(t))}}})(Jn),Kn=(r(290),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){var e=this.props.narrative;return e.access===_t.NONE?N.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},"inaccessible narrative"):N.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)}}]),t}(N.Component)),Xn=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return this.props.narrative?N.createElement(Kn,{narrative:this.props.narrative}):N.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(N.Component);var Zn=Object(L.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Tt(t))}}})(Xn),$n=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onReadNotification",value:function(e){this.props.onRead(e.id)}},{key:"renderInvitationToOrg",value:function(e){return N.createElement("div",{className:"notification",key:e.id},N.createElement("div",{className:"mainCol"},N.createElement("div",null,"You have been invited to join ",N.createElement(Yn,{organizationId:e.organizationId}))))}},{key:"renderUserAcceptedNotification",value:function(e){var t;return t=this.props.showOrg?N.createElement(Yn,{organizationId:e.organizationId}):N.createElement("span",null,"this organization"),N.createElement("div",{className:"notification",key:e.id},N.createElement("div",{className:"mainCol"},N.createElement("div",null,"Your membership request has been accepted for ",t)))}},{key:"renderRequestToJoinToOrg",value:function(e){var t;return this.props.showOrg&&(t=N.createElement("span",null," ",N.createElement(Yn,{organizationId:e.organizationId})," ")),N.createElement("div",{className:"notification",key:e.id},N.createElement("div",{className:"mainCol"},N.createElement("div",null,"Request to join your organization",t," ","from"," ",N.createElement(Fn,{userId:e.from,avatarSize:20}))))}},{key:"renderNarrativeAssociationRequest",value:function(e){var t,r=parseInt(e.regarding[0].id,10);return this.props.showOrg&&(t=N.createElement("span",null," ","with organization"," ",N.createElement(Yn,{organizationId:e.organizationId})," ")),N.createElement("div",{className:"notification",key:e.id},N.createElement("div",{className:"mainCol"},N.createElement("div",null,"Request to associate Narrative"," ",N.createElement(Zn,{workspaceId:r}),t," ","from"," ",N.createElement(Fn,{userId:e.from,avatarSize:20}))))}},{key:"renderNarrativeAssociated",value:function(e){var t,r=parseInt(e.regarding[0].id,10);return this.props.showOrg&&(t=N.createElement("span",null," ","with organization"," ",N.createElement(Yn,{organizationId:e.organizationId})," ")),N.createElement("div",{className:"notification",key:e.id},N.createElement("div",{className:"mainCol"},N.createElement("div",null,"New Narrative"," ",N.createElement(Zn,{workspaceId:r})," ","associated",t)))}},{key:"renderNarrativeAccepted",value:function(e){var t,r=parseInt(e.regarding[0].id,10);return this.props.showOrg&&(t=N.createElement("span",null," ","into organization"," ",N.createElement(Yn,{organizationId:e.organizationId}))),N.createElement("div",{className:"notification",key:e.id},N.createElement("div",{className:"mainCol"},N.createElement("div",null,"Your Narrative"," ",N.createElement(Zn,{workspaceId:r})," ","was accepted",t)))}},{key:"renderNotificationHeader",value:function(e){var t=this;return N.createElement("div",{className:"Notifications-notificationHeader"},N.createElement("div",{className:"Notifications-notificationHeaderDate"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),N.createElement("div",{className:"Notifications-notificationHeaderTimeAgo"},Mn(e.createdAt)),N.createElement("div",{className:"Notifications-notificationHeaderReadButton"},N.createElement(jt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){t.onReadNotification.call(t,e)}})))}},{key:"renderNotification",value:function(e){switch(e.type){case Yr.JOIN_INVITATION:return this.renderInvitationToOrg(e);case Yr.JOIN_REQUEST:return this.renderRequestToJoinToOrg(e);case Yr.UNKNOWN:return"UNKNOWN";case Yr.NARRATIVE_ASSOCIATION_REQUEST:return this.renderNarrativeAssociationRequest(e);case Yr.NARRATIVE_ASSOCIATED:return this.renderNarrativeAssociated(e);case Yr.NARRATIVE_ACCEPTED:return this.renderNarrativeAccepted(e);case Yr.APP_ASSOCIATION_REQUEST:return"Request to associate App";case Yr.USER_ACCEPTED:return this.renderUserAcceptedNotification(e);default:return"UNKNOWN NOTIFICATION TYPE"}}},{key:"renderNotifications",value:function(){var e=this;return this.props.notifications.map(function(t){return N.createElement("div",{className:"kbCard",key:t.id},N.createElement("div",{className:"kbCard-header"},e.renderNotificationHeader(t)),N.createElement("div",{className:"kbCard-body"},e.renderNotification(t)))})}},{key:"renderHeader",value:function(){return N.createElement("span",null,"You have"," ",this.props.notifications.length," ","unread notification",1===this.props.notifications.length?"":"s")}},{key:"renderMain",value:function(){return 0===this.props.notifications.length?N.createElement("div",{className:"message"},"No unread notifications"):N.createElement(N.Fragment,null,N.createElement("div",{className:"Notifications-header"},this.renderHeader()),N.createElement("div",{className:"Notifications-body scrollable-flex-column"},N.createElement("div",{className:"Notifications-innerBody"},this.renderNotifications())))}},{key:"render",value:function(){return N.createElement("div",{className:"Notifications scrollable-flex-column"},this.renderMain())}}]),t}(N.Component);function ea(e){return function(t,r){t({type:q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new Me({token:i,username:o,groupsServiceURL:s.services.Groups.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function ta(e){return function(t,r){t({type:q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new Me({token:i,username:o,groupsServiceURL:s.services.Groups.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function ra(e){return function(t,r){t({type:q.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new Me({token:i,username:o,groupsServiceURL:s.services.Groups.url}).removeMember(c.organization.id,e).then(function(){t(function(e){return{type:q.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(292);var na=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onConfirmRemoveMember",value:function(e){var t=this;Vt.a.confirm({title:"Really remove this user?",content:N.createElement("p",null,"This is not reversible."),width:"50em",onOk:function(){t.props.onRemoveMember(e)}})}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.onConfirmRemoveMember(t.username)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=N.createElement(Bt.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},N.createElement(Bt.a.Item,{key:"promoteToAdmin"},N.createElement(tt.a,{type:"unlock"}),"Promote to Admin"),N.createElement(Bt.a.Item,{key:"removeMember"},N.createElement(tt.a,{type:"delete"}),"Remove Member"));return N.createElement("div",null,N.createElement(an.a,{overlay:r,trigger:["click"]},N.createElement(tt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=N.createElement(Bt.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},N.createElement(Bt.a.Item,{key:"demoteToMember"},N.createElement(tt.a,{type:"user"}),"Demote to Member"));return N.createElement("div",null,N.createElement(an.a,{overlay:r,trigger:["click"]},N.createElement(tt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderOwnerMenu",value:function(e){return N.createElement("div",null)}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===he.OWNER||this.props.relation.type===he.ADMIN)switch(e.type){case Re.OWNER:return this.renderOwnerMenu(e);case Re.ADMIN:return this.renderAdminMenu(e);case Re.MEMBER:return this.renderMemberMenu(e)}}},{key:"renderMembers",value:function(){var e,t=this,r=N.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No members.");return e=0===this.props.organization.members.length?N.createElement(Ye.a,{type:"info",message:r}):this.props.organization.members.map(function(e){return N.createElement("div",{className:"Members-row simpleCard",key:e.username},N.createElement("div",{className:"Members-member"},N.createElement(En,{member:e,avatarSize:50})),N.createElement("div",{className:"Members-menu"},t.renderMemberOptions(e)))}),N.createElement("div",{className:"infoTable"},e)}},{key:"render",value:function(){return N.createElement(N.Fragment,null,this.renderMembers())}}]),t}(N.Component);var aa=Object(L.b)(function(e,t){return{}},function(e){return{onViewMembersUnload:function(){e({type:q.VIEW_ORG_VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(ea(t))},onDemoteAdminToMember:function(t){e(ta(t))},onRemoveMember:function(t){e(ra(t))}}})(na),ia=(r(294),r(296),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onAcceptRequest",value:function(){this.props.onAcceptInboxRequest(this.props.request)}},{key:"onRejectRequest",value:function(){this.props.onRejectInboxRequest(this.props.request)}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(Nn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return N.createElement(Nn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"REQUEST to associate App";case Ee.USER:return"REQUEST to join Organization";case Ee.WORKSPACE:return"REQUEST to associate Narrative"}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})),N.createElement("div",{className:"cardSectionHeader"},"with organization"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),N.createElement("div",{className:"cardSectionHeader"},"from"),N.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})),N.createElement("div",{className:"cardSectionHeader"},"from"),N.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return N.createElement("div",{style:{textAlign:"center"}},N.createElement(jt.a.Group,{style:{marginTop:"4px"}},N.createElement(jt.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},N.createElement(tt.a,{type:"check"}),"Accept"),N.createElement(jt.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},N.createElement(tt.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),N.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),N.createElement("div",{className:"cardSectionHeader"},"from"),N.createElement(Nn,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.USER:return this.renderJoinRequest(e);case Ee.WORKSPACE:return this.renderWorkspaceRequest(e);case Ee.APP:return N.createElement(N.Fragment,null,N.createElement("div",null,"apps not supported yet"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return this.renderUserInvitation(e);case Ee.WORKSPACE:case Ee.APP:return N.createElement(N.Fragment,null,N.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return N.createElement("div",{key:e.id,className:"InboxRequest kbCard"},N.createElement("div",{className:"kbCard-header"},N.createElement("div",{className:"InboxRequest-requestHeaderRow"},N.createElement("div",{className:"InboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),N.createElement("div",{className:"InboxRequest-requestHeaderExpireAt"},N.createElement("span",{className:"field-label"},"expires")," ",Mn(e.expireAt)))),N.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(N.Component));var oa=Object(L.b)(function(e,t){return{}},function(e){return{onAcceptInboxRequest:function(t){e(Hr(t.id))},onRejectInboxRequest:function(t){e(Fr(t.id))}}})(ia),sa=(r(298),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(Nn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return N.createElement(Nn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"REQUEST to associate App";case Ee.USER:return"REQUEST to join Organization";case Ee.WORKSPACE:return"REQUEST to associate Narrative"}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return N.createElement("div",null,N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})),N.createElement("div",{className:"cardSectionHeader"},"with organization"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return N.createElement(Nn,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),N.createElement("div",{className:"miniDetail"},N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return N.createElement("div",{style:{textAlign:"center"}},N.createElement(jt.a.Group,{style:{marginTop:"4px"}},N.createElement(jt.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},N.createElement(tt.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){return N.createElement(N.Fragment,null,N.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),N.createElement("div",{className:"cardSectionHeader"},"sent to"),N.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.USER:return this.renderJoinRequest(e);case Ee.WORKSPACE:return this.renderWorkspaceRequest(e);case Ee.APP:return N.createElement(N.Fragment,null,N.createElement("div",null,"apps not supported yet"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return this.renderUserInvitation(e);case Ee.WORKSPACE:case Ee.APP:return N.createElement(N.Fragment,null,N.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return N.createElement("div",{key:e.id,className:"OutboxRequest kbCard"},N.createElement("div",{className:"kbCard-header"},N.createElement("div",{className:"OutboxRequest-requestHeaderRow"},N.createElement("div",{className:"OutboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),N.createElement("div",{className:"OutboxRequest-requestHeaderExpireAt"},N.createElement("span",{className:"field-label"},"expires")," ",Mn(e.expireAt)))),N.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(N.Component));var ca=Object(L.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e(Qr(t.id))}}})(sa),la=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("/#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){Vt.a.info({title:"Manage Requests Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:N.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderLoadingHeader",value:function(){var e=N.createElement("span",null,"Loading Org Editor...");return N.createElement(Wt,{breadcrumbs:e})}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=N.createElement("span",null,N.createElement(tt.a,{type:"user"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"team"})," ","Request to Join Group"),n=[N.createElement(jt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return N.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"from"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.requester,avatarSize:50}))),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=N.createElement("span",null,N.createElement(tt.a,{type:"team"}),N.createElement(tt.a,{type:"mail"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"user"})," ","Invitation to Join Group"),n=[N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e)}},"Cancel")];return N.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"invitation to"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.user,avatarSize:30}))),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case ge.NONE:return"None";case ge.VIEW:return"View Only";case ge.EDIT:return"Edit";case ge.ADMIN:return"Admin";case ge.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=N.createElement("span",null,N.createElement(tt.a,{type:"file"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"team"})," ","Request to Add Narrative"),a=[N.createElement(jt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e)}},"Approve"),N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e)}},"Deny")];return t=N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)}),N.createElement(nn.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"from"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.requester,avatarSize:30}))),N.createElement("tr",null,N.createElement("th",null,"narrative"),N.createElement("td",{className:"narrative"},t)),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=N.createElement("span",null,N.createElement(tt.a,{type:"appstore"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"team"})," ","Request to Add App"),n=[N.createElement(jt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return N.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"from"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.requester,avatarSize:50}))),N.createElement("tr",null,N.createElement("th",null,"app"),N.createElement("td",{className:"requester"},e.appId)),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderInbox",value:function(){var e;if(0===this.props.inbox.length)e=N.createElement("div",{className:"message"},"No pending organization requests for you");else{var t=this.props.inbox.map(function(e){return N.createElement("div",{key:e.id},N.createElement(oa,{request:e}))});e=N.createElement("div",{style:{overflowY:"auto"}},t)}return N.createElement(N.Fragment,null,e)}},{key:"renderOutbox",value:function(){var e;if(0===this.props.outbox.length)e=N.createElement("div",{className:"message"},"No pending organization requests from you");else{var t=this.props.outbox.map(function(e){return N.createElement("div",{key:e.id},N.createElement(ca,{request:e}))});e=N.createElement("div",{style:{overflowY:"auto"}},t)}return N.createElement(N.Fragment,null,e)}},{key:"render",value:function(){var e=this.props.outbox.length,t=this.props.inbox.length;return N.createElement("div",{className:"Requests"},N.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"inbox (",t,")"),this.renderInbox(),N.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"outbox (",e,")"),this.renderOutbox())}}]),t}(N.Component);var ua,Ea=Object(L.b)(function(e,t){return{}},function(e){return{onAcceptJoinRequest:function(t){e(Hr(t.id))},onDenyJoinRequest:function(t){e(Fr(t.id))},onCancelJoinInvitation:function(t){e(Qr(t.id))},onGetViewAccess:function(e){}}})(la);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(ua||(ua={}));var da=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={showInfo:!1,navigateTo:ua.NONE,requestAccess:{narrative:null}},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({navigateTo:ua.REQUEST_ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){Vt.a.info({title:"View Organization Help",width:"50em",content:N.createElement("div",null,"Organization help here...")})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return N.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.relation.type===he.ADMIN||this.props.relation.type===he.OWNER)return N.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",N.createElement(Ke.a,{to:"/editOrganization/".concat(this.props.organization.id)},N.createElement(jt.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.relation.type===he.ADMIN||this.props.relation.type===he.OWNER)return N.createElement(Ke.a,{to:"/editOrganization/".concat(this.props.organization.id)},N.createElement(jt.a,{icon:"edit"},"Edit This Organization"))}},{key:"renderOrg",value:function(){if(this.props.organization)return N.createElement("div",{className:"ViewOrganization-org-description-org scrollable-flex-column"},N.createElement("div",{className:"ViewOrganization-org-description",dangerouslySetInnerHTML:{__html:hr.Marked.parse(this.props.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return N.createElement("div",{className:"ownerTable"},N.createElement("div",{className:"proprietorCol"},N.createElement("div",{className:"owner"},N.createElement("a",{href:"/#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return N.createElement(gn,{organizationId:this.props.organization.id})}},{key:"renderRelation",value:function(e){switch(e.type){case he.NONE:return N.createElement("span",null,N.createElement(tt.a,{type:"stop"}),"None");case he.VIEW:return N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},N.createElement("div",null,N.createElement(tt.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),N.createElement("div",{style:{marginTop:"10px"}},N.createElement(jt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case he.MEMBER_REQUEST_PENDING:return N.createElement("div",null,N.createElement("div",null,N.createElement(tt.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",N.createElement("b",null,"request")," is pending"),N.createElement("div",null,N.createElement(jt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case he.MEMBER_INVITATION_PENDING:return N.createElement("div",null,N.createElement("div",null,N.createElement(tt.a,{type:"user",style:{color:"blue"}}),"You have been ",N.createElement("b",null,"invited")," to join this Organization"),N.createElement("div",{style:{marginTop:"10px"}},N.createElement(jt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),N.createElement(jt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case he.MEMBER:return N.createElement("span",null,N.createElement(tt.a,{type:"user"}),"Member");case he.ADMIN:return N.createElement("span",null,N.createElement(tt.a,{type:"unlock"}),"Admin");case he.OWNER:return N.createElement(et.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},N.createElement("span",null,N.createElement(tt.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===he.OWNER||this.props.relation.type===he.ADMIN||this.props.relation.type===he.MEMBER)}},{key:"renderMembers",value:function(){return this.isMember()?N.createElement(aa,{organization:this.props.organization,relation:this.props.relation}):N.createElement("p",{className:"message"},"Organization membership restricted to members only")}},{key:"renderInfo",value:function(){if(this.props.organization)return N.createElement(nn.a,{title:N.createElement("span",null,N.createElement(tt.a,{type:"info-circle"})," info"),headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard"},N.createElement("div",null,N.createElement("div",null,N.createElement("div",{className:"label"},"owner")),N.createElement("div",{className:"ownerTable"},N.createElement(En,{member:this.props.organization.owner,avatarSize:50})),N.createElement("div",{className:"infoTable"},N.createElement("div",{className:"row"},N.createElement("div",{className:"col1"},N.createElement("span",{className:"label"},"established")),N.createElement("div",{className:"col2"},N.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.createdAt)))),N.createElement("div",{className:"row"},N.createElement("div",{className:"col1"},N.createElement("span",{className:"label"},"last updated")),N.createElement("div",{className:"col2"},N.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.modifiedAt)))))))}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.relation,r=this.props.groupRequests,n=this.props.groupInvitations;if((t.type===he.ADMIN||t.type===he.OWNER)&&(null!==r&&null!==n))return e=r.length?N.createElement("div",null,"group has no pending requests"):N.createElement("div",null,N.createElement("div",null,N.createElement(tt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",N.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",N.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),N.createElement("div",null,N.createElement(Ke.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},N.createElement(jt.a,null,"Manage Requests")))),N.createElement("div",{className:"row"},N.createElement("div",{className:"col1"},N.createElement("span",{className:"label"},"admin")),N.createElement("div",{className:"col2"},N.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?N.createElement("div",null,N.createElement("div",null,N.createElement(tt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",N.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",N.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),N.createElement("div",null,N.createElement(Ke.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},N.createElement(jt.a,null,"Manage Requests")))):N.createElement("div",{className:"message"},"No pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case he.NONE:case he.VIEW:return"infoBox";case he.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case he.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case he.MEMBER:case he.ADMIN:case he.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return N.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.relation;if(e.type===he.ADMIN||e.type===he.OWNER){var t=this.props,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=N.createElement("span",null,N.createElement(tt.a,{type:"unlock"})," ","group requests"," ",N.createElement("span",{className:"titleCount"},"(",a,")"));return N.createElement("div",{className:"adminTasksBox"},N.createElement(nn.a,{className:"slimCard adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.organization&&this.props.relation.type===he.VIEW)return N.createElement(jt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderHeader",value:function(){var e=N.createElement("div",{style:{flex:"0 0 auto"}}),t=N.createElement(N.Fragment,null,this.renderEditButton(),this.renderJoinButton(),N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=N.createElement("span",null,"Loading Org...");return N.createElement(Wt,{breadcrumbs:e})}},{key:"renderMembersCard",value:function(){var e=[N.createElement(Ke.a,{key:"viewMembers",to:"/viewMembers/".concat(this.props.organization.id)},N.createElement(jt.a,{onClick:this.onViewMembers.bind(this),icon:"team"}))];if(this.props.organization){var t;t=this.isMember()?N.createElement("span",{className:"titleCount"},"(",this.props.organization.members.length,")"):"";var r=N.createElement("span",null,N.createElement(tt.a,{type:"team"}),"members",t);return N.createElement(nn.a,{className:"slimCard membersCard",headStyle:{backgroundColor:"gray",color:"white"},title:r,extra:e},this.renderMembers())}}},{key:"renderMembersTab",value:function(){return N.createElement("div",{className:"scrollable-flex-column"},N.createElement("div",{className:"ViewOrganization-tabPaneToolbar"},this.renderMembersToolbar()),this.renderMembers())}},{key:"onReadNotification",value:function(e){this.props.onReadNotification(e)}},{key:"renderNotificationsCard",value:function(){N.createElement("span",{className:"titleCount"},"(0)");var e,t=N.createElement("span",null,N.createElement(tt.a,{type:"notification"}),"notifications");return e=0===this.props.notifications.length?N.createElement("div",{className:"message"},"No unread notifications"):N.createElement($n,{notifications:this.props.notifications,showOrg:!1,onRead:this.onReadNotification.bind(this)}),N.createElement(nn.a,{className:"slimCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:t},e)}},{key:"renderNotificationsTab",value:function(){var e;N.createElement("span",{className:"titleCount"},"(0)"),N.createElement("span",null,N.createElement(tt.a,{type:"notification"}),"notifications");return e=0===this.props.notifications.length?N.createElement("div",{className:"message"},"No unread notifications"):N.createElement($n,{notifications:this.props.notifications,showOrg:!1,onRead:this.onReadNotification.bind(this)}),N.createElement(N.Fragment,null,e)}},{key:"renderFeedTab",value:function(){var e;N.createElement("span",{className:"titleCount"},"(0)"),N.createElement("span",null,N.createElement(tt.a,{type:"notification"}),"notifications");e=0===this.props.notifications.length?N.createElement("div",{className:"message"},"No unread notifications"):N.createElement($n,{notifications:this.props.notifications,showOrg:!1,onRead:this.onReadNotification.bind(this)});var t=[N.createElement(jt.a,{key:"feeds",size:"small",href:"/#feeds",target:" _blank"},N.createElement(tt.a,{type:"notification"})," ","View All Your KBase Feeds")];return N.createElement(N.Fragment,null,N.createElement("div",{className:"ViewOrganization-tabPaneToolbar"},t),N.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"updates"),N.createElement("p",{className:"message"},"** org updates not yet available **"),N.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"notifications"),e)}},{key:"onAcceptRequest",value:function(e){this.props.onAcceptRequest(e.id)}},{key:"renderOutboxCard",value:function(){var e,t=this.props.requestOutbox.length,r=N.createElement("span",null,N.createElement(tt.a,{type:"export"}),"outbox",N.createElement("span",{className:"titleCount"},"(",t,")"));if(0===this.props.requestOutbox.length)e=N.createElement("div",{className:"message"},"No pending organization requests from you");else{var n=this.props.requestOutbox.map(function(e){return N.createElement(N.Fragment,{key:e.id},N.createElement(Wn,{request:e,showOrg:!1}))});e=N.createElement("div",{style:{maxHeight:"30em",overflowY:"auto"}},n)}return N.createElement(nn.a,{className:"slimCard outboxCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:r,extra:[]},e)}},{key:"renderOutboxTabHeader",value:function(){return N.createElement("div",{className:"ViewOrganization-tabPaneToolbar"}," ")}},{key:"renderOutboxTab",value:function(){var e;if(0===this.props.requestOutbox.length)e=N.createElement("div",{className:"message"},"No pending organization requests from you");else{var t=this.props.requestOutbox.map(function(e){return N.createElement(N.Fragment,{key:e.id},N.createElement(Wn,{request:e,showOrg:!1}))});e=N.createElement("div",{style:{overflowY:"auto"}},t)}return N.createElement(N.Fragment,null,N.createElement("div",{className:"ViewOrganization-tabPageToolbar"}),e)}},{key:"renderNarrativeMenu",value:function(e){var t,r=this,n=this.props.relation;n.type===he.OWNER||(n.type,he.ADMIN);switch(n.type){case he.NONE:break;case he.VIEW:case he.MEMBER_REQUEST_PENDING:case he.MEMBER_INVITATION_PENDING:case he.MEMBER:break;case he.ADMIN:case he.OWNER:t=N.createElement(Bt.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},N.createElement(Bt.a.Item,{key:"removeNarrative"},N.createElement(tt.a,{type:"delete"})," Remove Narrative from Organization"))}if(t)return N.createElement(an.a,{overlay:t,trigger:["click"]},N.createElement(tt.a,{type:"ellipsis",className:"IconButton-hover"}))}},{key:"renderNarratives",value:function(){var e=this;if(!this.isMember())return N.createElement(nn.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:N.createElement("span",null,N.createElement(tt.a,{type:"folder-open"})," narratives")},N.createElement("p",{style:{textAlign:"center",fontStyle:"italic"}},"Narratives are restricted to members only"));var t=[N.createElement(Ke.a,{key:"requestAddNarrative",to:"/requestAddNarrative/".concat(this.props.organization.id)},N.createElement(jt.a,{onClick:this.onRequestAddNarrative.bind(this)},N.createElement(tt.a,{type:"plus"})," Add a Narrative"))];if(0===this.props.organization.narratives.length){var r=N.createElement("div",{className:"message"},"No Narratives are yet associated with this Organization");return N.createElement(nn.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:N.createElement("span",null,N.createElement(tt.a,{type:"folder-open"})," narratives (\xd8)"),extra:t},N.createElement(Ye.a,{type:"info",message:r}))}var n=this.props.organization.narratives.map(function(t){return N.createElement("div",{className:"narrative simpleCard",key:String(t.workspaceId)},N.createElement("div",{className:"dataCol"},N.createElement(Cn,{narrative:t,onGetViewAccess:e.props.onGetViewAccess})),N.createElement("div",{className:"buttonCol"},e.renderNarrativeMenu(t)))}),a=this.props.organization.narratives.length,i=N.createElement("span",null,N.createElement(tt.a,{type:"folder-open"}),"narratives"," ",N.createElement("span",{className:"titleCount"},"(",a,")"));return N.createElement(nn.a,{className:"slimCard narratives narrativesCard scrollable-flex-column",headStyle:{backgroundColor:"gray",color:"white"},title:i,extra:t},N.createElement("div",{className:"narrativesTable"},n))}},{key:"renderMembersToolbar",value:function(){switch(this.props.relation.type){case he.NONE:case he.MEMBER:return N.createElement("div",{className:"toolbar"});case he.ADMIN:case he.OWNER:return N.createElement("div",{className:"toolbar"},N.createElement(Ke.a,{to:"/inviteUser/"+this.props.organization.id},N.createElement(jt.a,{size:"small"},N.createElement(tt.a,{type:"mail"})," Invite a User")))}}},{key:"renderCombo",value:function(){var e=this.props.relation.type===he.ADMIN||this.props.relation.type===he.OWNER,t=this.props.organization.isMember;if(!t)return N.createElement("p",{style:{fontStyle:"italic"}},"The membership list is only available to members.");var r,n=[];if(r=this.props.organization.memberCount-1?String(this.props.organization.memberCount-1):"\xd8",n.push(N.createElement(on.a.TabPane,{tab:N.createElement("span",null,N.createElement(tt.a,{type:"team"}),"Members ",N.createElement("span",{className:"ViewOrganization-tabCount"},"(",r,")")),key:"members",style:{flexDirection:"column"}},this.renderMembersTab())),t)if(e){var a=this.props.requestInbox.length+this.props.requestOutbox.length,i=N.createElement("span",{className:"ViewOrganization-tabCount"},"(",a||"\xd8",")");n.push(N.createElement(on.a.TabPane,{tab:N.createElement("span",null,N.createElement(tt.a,{type:"inbox"}),"Requests ",i," "),key:"inbox",style:{flexDirection:"column"}},N.createElement(Ea,{inbox:this.props.requestInbox,outbox:this.props.requestOutbox})))}else{var o,s=this.props.requestOutbox.length;o=s?String(s):"\xd8",n.push(N.createElement(on.a.TabPane,{tab:N.createElement("span",null,N.createElement(tt.a,{type:"inbox"}),"Requests ",N.createElement("span",{className:"ViewOrganization-tabCount"},"(",o,")")),key:"outbox",style:{flexDirection:"column"}},this.renderOutboxTabHeader(),N.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"outbox"),this.renderOutboxTab()))}return N.createElement(on.a,{defaultActiveKey:"news",className:"ViewOrganization-tabs",animated:!1,size:"small",tabPosition:"top"},n)}},{key:"renderMenuButtons",value:function(){return N.createElement(N.Fragment,null,this.renderEditButton(),N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}))}},{key:"render",value:function(){switch(this.state.navigateTo){case ua.REQUEST_ADD_NARRATIVE:return N.createElement(Or.a,{to:"/requestAddNarrative"});case ua.NONE:}if(this.state.requestAccess.narrative&&this.props.organization){var e=this.props.relation;e.type===he.MEMBER||e.type===he.ADMIN||(e.type,he.OWNER)}return"undefined"!==typeof this.props.organization?N.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},N.createElement(Ht,{buttons:this.renderMenuButtons()}),this.renderOrgHeader(),N.createElement("div",{className:"mainRow scrollable-flex-column"},N.createElement("div",{className:"mainColumn  scrollable-flex-column"},N.createElement("div",{className:"orgRow",style:{minHeight:"0px"}},this.renderOrg()),N.createElement("div",{className:"narrativesRow scrollable-flex-column"},this.renderNarratives())),N.createElement("div",{className:"infoColumn"},this.renderCombo())),void 0):N.createElement("div",{className:"ViewOrganization"},this.renderLoadingHeader(),"Loading...")}}]),t}(N.Component);var ma,pa=Object(L.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.NORMAL)throw new Error("argh, wrong org kind");var n=r.organization,a=r.relation,i=r.groupRequests,o=r.groupInvitations,s=r.requestInbox,c=r.requestOutbox,l=e.db.notifications.all.filter(function(e){return e.organizationId===n.id});return{organization:n,relation:a,groupRequests:i,groupInvitations:o,requestInbox:s,requestOutbox:c,notifications:l}},function(e){return{onViewOrg:function(t){e(Pr(t))},onJoinOrg:function(){e(xr())},onCancelJoinRequest:function(t){e(Qr(t))},onAcceptInvitation:function(t){e(Hr(t))},onRejectInvitation:function(t){e(Fr(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(kr({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=a.views.viewOrgView.viewModel.organization){t.next=9;break}return r(kr({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:return u=l.id,E=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,E.removeNarrativeFromOrg(u,e.workspaceId);case 14:r(Ur(e)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(11),r(kr({code:t.t0.name,message:t.t0.message}));case 20:case"end":return t.stop()}},t,this,[[11,17]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(jr({code:"error",message:"No view model"})),t.abrupt("return");case 5:if((i=a.views.viewOrgView.viewModel).kind===S.NORMAL){t.next=9;break}return r(jr({code:"error",message:"Not NORMAL org"})),t.abrupt("return");case 9:return o=i.organization,s=a.auth.authorization,c=s.token,l=s.username,u=a.app.config,E=o.id,d=String(e.workspaceId),m=new Me({token:c,username:l,groupsServiceURL:u.services.Groups.url}),t.prev=14,t.next=17,m.grantNarrativeAccess(E,d);case 17:return t.next=19,m.getOrg(E);case 19:if((p=t.sent).kind===_e.NORMAL){t.next=23;break}return r(jr({code:"error",message:"Not a NORMAL org"})),t.abrupt("return");case 23:r(Tt(e.workspaceId)),r(Vr(p)),t.next=30;break;case 27:t.prev=27,t.t0=t.catch(14),r(jr({code:"error",message:t.t0.message}));case 30:case"end":return t.stop()}},t,this,[[14,27]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onAcceptRequest:function(t){e(Hr(t))},onReadNotification:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.NOTIFICATIONS_READ_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new tn({token:o,username:s,feedsServiceURL:c.services.Feeds.url}),t.prev=3,t.next=6,l.seeNotification(e);case 6:t.sent,r({type:q.NOTIFICATIONS_READ_SUCCESS,notificationId:e}),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),console.error("error",t.t0),r({type:q.NOTIFICATIONS_READ_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 14:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(da);r(312);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(ma||(ma={}));var va=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={showInfo:!1,navigateTo:ma.NONE,requestAccess:{narrative:null}},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onShowInfo",value:function(){Vt.a.info({title:"View Organization Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This organization is ",N.createElement("b",null,"private"),"."),N.createElement("p",null,"Nothing about this organization may be revealed to non-members."),N.createElement("p",null,"You may request membership"),N.createElement("p",null,"Upon requesting membership, the organization administrators may grant you membership"),N.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."))})}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"renderMessage",value:function(){switch(this.props.relation.type){case he.NONE:return N.createElement(N.Fragment,null,N.createElement("p",null,"This organization is ",N.createElement("b",null,"private")," and you are not a member."),N.createElement("p",null,"Nothing about a private organization may be revealed to a non-member."),N.createElement("p",null,"However, you may request membership"),N.createElement("p",null,"Upon requesting membership, the organization administrators will be notified."),N.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."));case he.MEMBER_REQUEST_PENDING:return N.createElement(N.Fragment,null,N.createElement("p",null,"Your membership request to this private organization is pending."));case he.MEMBER_INVITATION_PENDING:return N.createElement(N.Fragment,null,N.createElement("p",null,"You have been invited to this private organization."));default:return N.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderOrg",value:function(){var e=N.createElement("span",null,"Private Organization"),t=N.createElement(N.Fragment,null,this.renderMessage(),N.createElement("div",null,this.renderJoinButton()));return N.createElement(Ye.a,{message:e,description:t,type:"info",style:{width:"50em",margin:"20px auto"},className:"ViewInaccessiblePrivateOrganization-message"})}},{key:"renderRelationClass",value:function(e){switch(e.type){case he.NONE:case he.VIEW:return"infoBox";case he.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case he.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case he.MEMBER:case he.ADMIN:case he.OWNER:return"infoBox"}}},{key:"renderJoinButton",value:function(){switch(this.props.relation.type){case he.NONE:return N.createElement(jt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization");case he.MEMBER_REQUEST_PENDING:return N.createElement("div",null,N.createElement("div",null,N.createElement(jt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case he.MEMBER_INVITATION_PENDING:return N.createElement("div",null,N.createElement(jt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation")," ",N.createElement(jt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"));default:return N.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderHeader",value:function(){var e=N.createElement("div",{style:{flex:"0 0 auto"}}),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"render",value:function(){return N.createElement("div",{className:"ViewInaccessiblePrivateOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrg())}}]),t}(N.Component);var Oa=Object(L.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.PRIVATE_INACCESSIBLE)throw new Error("argh, wrong org kind");var n=r.organization,a=r.relation,i=r.requestOutbox;return e.db.notifications.all.filter(function(e){return e.organizationId===n.id}),{organization:n,relation:a,requestOutbox:i}},function(e){return{onJoinOrg:function(){e(xr())},onCancelJoinRequest:function(t){e(Br(t))},onAcceptInvitation:function(t){e(Wr(t))},onRejectInvitation:function(t){e(qr(t))}}})(va),ha=r(346),Ra=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){var e=N.createElement("div",null,"Loading your Organization..."," ",N.createElement(ha.a,null));return N.createElement(Ye.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return N.createElement("div",null,"Error!",N.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return null===this.props.view.viewModel?this.renderError({code:"Null Error",message:"The view model is missing, but should be available"}):this.props.view.viewModel.organization.kind===_e.INACCESSIBLE_PRIVATE?N.createElement(Oa,null):N.createElement(pa,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var ga=Object(L.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(Pr(t))},onUnload:function(){e(function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a,i,o,s,c,l,u;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,(c=n.db.notifications).all,c.byId,l=n.views.viewOrgView.viewModel){e.next=3;break}throw new Error("view model not defined!?!");case 3:return u=new Tr({token:i,username:o,userProfileServiceURL:s.services.UserProfile.url}),e.next=6,u.setLastVisitedAt(l.organization.id,new Date);case 6:t(Dr()),t({type:q.VIEW_ORG_UNLOAD});case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}())}}})(Ra);function _a(){return{type:q.EDIT_ORG_EVALUATE_ERRORS}}function fa(e){return{type:q.EDIT_ORG_SAVE_ERROR,error:e}}function wa(e){return function(t,r){t({type:q.EDIT_ORG_LOAD_START});var n=r(),a=n.auth.authorization,o=a.token,c=a.username,l=n.app.config;return new Me({token:o,username:c,groupsServiceURL:l.services.Groups.url}).getOrg(e).then(function(e){if(e.kind!==_e.NORMAL)throw new Error("May not edit an inaccessible private org!");var r,n,a={id:{value:e.id,remoteValue:e.id,syncState:i.NEW,validationState:we.validateOrgId(e.id)[1]},name:{value:e.name,remoteValue:e.name,syncState:i.NEW,validationState:we.validateOrgName(e.name)[1]},logoUrl:{value:e.logoUrl,remoteValue:e.logoUrl,syncState:i.NEW,validationState:we.validateOrgLogoUrl(e.logoUrl)[1]},homeUrl:{value:e.homeUrl,remoteValue:e.homeUrl,syncState:i.NEW,validationState:we.validateOrgHomeUrl(e.homeUrl)[1]},researchInterests:{value:e.researchInterests,remoteValue:e.researchInterests,syncState:i.NEW,validationState:we.validateOrgResearchInterests(e.researchInterests)[1]},description:{value:e.description,remoteValue:e.description,syncState:i.NEW,validationState:we.validateOrgDescription(e.description)[1]},isPrivate:{value:e.isPrivate,remoteValue:e.isPrivate,syncState:i.NEW,validationState:{type:s.OK,validatedAt:new Date}}};t((r=a,n=e,{type:q.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:q.EDIT_ORG_LOAD_ERROR,error:r}))})}}function Sa(){return function(e,t){e({type:q.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,o=r.views.editOrgView.viewModel,s=o.organization,c=o.editedOrganization,l=r.app.config,u=new Me({token:a,username:i,groupsServiceURL:l.services.Groups.url});if(c){var E={name:c.name.value,logoUrl:c.logoUrl.value,description:c.description.value,isPrivate:c.isPrivate.value,homeUrl:c.homeUrl.value,researchInterests:c.researchInterests.value};u.updateOrg(s.id,E).then(function(){e({type:q.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",c,t),e(fa({code:"invalid",message:t.message}))})}else e(fa({code:"app",message:"The new organization data does not yet exist"}))}}function Aa(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState.type===s.OK&&n.logoUrl.validationState.type===s.OK&&n.homeUrl.validationState.type===s.OK&&n.researchInterests.validationState.type===s.OK&&n.description.validationState.type===s.OK?e({type:q.EDIT_ORG_EVALUATE_OK}):e(_a())}}function Na(e){return function(t){var r=we.validateOrgName(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:q.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(Aa())}}function Ia(e){return function(t){var r=we.validateOrgLogoUrl(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(a,i)):t(function(e){return{type:q.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:e}}(a)),t(Aa())}}function ba(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,c=n.app.config,l=(new Me({token:i,username:o,groupsServiceURL:c.services.Groups.url}),we.validateOrgDescription(e)),u=Object(dt.a)(l,2),E=u[0],d=u[1];d.type!==s.OK?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(E,d)):t(function(e){return{type:q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(E)),t(Aa())}}var Ta;r(314);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Ta||(Ta={}));var ya=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:Ta.NONE},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onShowInfo",value:function(){Vt.a.info({title:"Organization Editor Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the organizations editor..."))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Vt.a.confirm({title:"Leave the editor?",content:N.createElement("div",null,N.createElement("p",null,"You have made changes on this edit form."),N.createElement("p",null,"If you leave the editor without saving, any ",N.createElement("i",null,"changes they will be lost"),"."),N.createElement("p",null,N.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){Vt.a.confirm({title:"Leave the editor?",content:N.createElement("div",null,N.createElement("p",null,"You have made changes on this edit form."),N.createElement("p",null,"If you leave the editor without saving, any ",N.createElement("i",null,"changes they will be lost"),"."),N.createElement("p",null,N.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===o.EDITED&&(this.props.saveState===c.NEW||this.props.saveState===c.READY)}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===i.DIRTY?N.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderEditor",value:function(){return N.createElement("form",{id:"editOrganizationForm",className:"EditOrganization-editor",onSubmit:this.onSubmit.bind(this)},N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{style:{flex:"1 1 0px"}},N.createElement("h3",null,"Edit Your Organization"))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("h3",null,"Preview"))),N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{className:"EditOrganization-formLabel field-label"},N.createElement(et.a,{title:"This is the name for your organization as you want KBase users to see it"},"Name")),N.createElement("div",{className:"EditOrganization-formControl"},N.createElement(Rr.a,{value:this.props.editedOrganization.name.value||"",className:this.calcFieldClass(this.props.editedOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.name))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("div",{className:"EditOrganization-preview-name"},this.props.editedOrganization.name.value||""))),N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{className:"EditOrganization-formLabel field-label"},"ID"),N.createElement("div",{className:"EditOrganization-formControl"},N.createElement(Rr.a,{value:this.props.editedOrganization.id.value||"",className:this.calcFieldClass(this.props.editedOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.id))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("div",{className:"EditOrganization-preview-id"},N.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.editedOrganization.id.value||N.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{className:"EditOrganization-formLabel field-label"},"Logo URL"),N.createElement("div",{className:"EditOrganization-formControl"},N.createElement(Rr.a,{value:this.props.editedOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.logoUrl))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("div",{className:"EditOrganization-preview-logo"},this.renderLogoPreview()))),N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{className:"EditOrganization-formLabel field-label"},"Home Page URL"),N.createElement("div",{className:"EditOrganization-formControl"},N.createElement(Rr.a,{value:this.props.editedOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.homeUrl))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("div",{className:"EditOrganization-field-name"},N.createElement("a",{href:this.props.editedOrganization.homeUrl.value||"",target:"_blank"},this.props.editedOrganization.homeUrl.value||"")))),N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{className:"EditOrganization-formLabel field-label"},"Is Private?"),N.createElement("div",{className:"EditOrganization-formControl"},N.createElement(Gt.a,{checked:this.props.editedOrganization.isPrivate.value,className:this.calcFieldClass(this.props.editedOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.isPrivate))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("div",{className:"EditOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.editedOrganization.isPrivate.value)))),N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{className:"EditOrganization-formLabel field-label"},"Research Interests"),N.createElement("div",{className:"EditOrganization-formControl"},N.createElement(_r.a,{value:this.props.editedOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.editedOrganization.researchInterests)+" EditOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.researchInterests))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("div",{className:"EditOrganization-preview-researchInterests"},this.props.editedOrganization.researchInterests.value||""))),N.createElement("div",{className:"EditOrganization-row"},N.createElement("div",{className:"EditOrganization-col1"},N.createElement("div",{className:"EditOrganization-formLabel field-label"}),N.createElement("div",{className:"EditOrganization-formControl"},N.createElement(_r.a,{value:this.props.editedOrganization.description.value||"",className:this.calcFieldClass(this.props.editedOrganization.description)+" EditOrganization-control-description",autosize:{minRows:5,maxRows:15},onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.description))),N.createElement("div",{className:"EditOrganization-col2"},N.createElement("div",{className:"EditOrganization-preview-description",dangerouslySetInnerHTML:{__html:hr.Marked.parse(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderIsPrivate",value:function(e){return e?N.createElement("span",null,N.createElement(tt.a,{type:"lock"})," ","Private"):N.createElement("span",null,N.createElement(tt.a,{type:"global"})," ","Public")}},{key:"renderLogoPreview",value:function(){return this.props.editedOrganization.logoUrl.value?N.createElement("img",{src:this.props.editedOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultLogo",value:function(){if(!this.props.editedOrganization.name.value||!this.props.editedOrganization.id.value)return N.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.editedOrganization.name.value,0).toUpperCase(),t=Ze()(this.props.editedOrganization.id.value).substr(0,6);return N.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},N.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return N.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderOrgName",value:function(e){if(0===e.length)return N.createElement("span",{style:{fontStyle:"italic"}},"org name missing");var t=e;return e.length>=25&&(t=e.slice(0,25)+"\u2026"),N.createElement(Ke.a,{to:"/viewOrganization/".concat(this.props.organization.id)},N.createElement("span",{style:{fontWeight:"bold"}},t))}},{key:"renderHeader",value:function(){var e=N.createElement(N.Fragment,null,N.createElement("span",null,N.createElement(tt.a,{type:"tool"})," ",N.createElement("span",{style:{fontSize:"120%"}},"Edit Organization"))),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),N.createElement(jt.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Cancel"),N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=N.createElement("span",null,"Loading Org Editor...");return N.createElement(Wt,{breadcrumbs:e})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return N.createElement(gn,{organizationId:this.props.organization.id})}},{key:"render",value:function(){return this.state.cancelToBrowser?N.createElement(Or.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?N.createElement(Or.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):this.props.editedOrganization?N.createElement("div",{className:"EditOrganization"},this.renderOrgHeader(),this.renderHeader(),this.renderEditor()):N.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader())}}]),t}(N.Component);var Ca=Object(L.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(Sa())},onUpdateName:function(t){e(Na(t))},onUpdateLogoUrl:function(t){e(Ia(t))},onUpdateDescription:function(t){e(ba(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Aa())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=we.validateOrgHomeUrl(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.EDIT_ORG_UPDATE_HOME_URL_ERROR,homeUrl:a,error:i}):t({type:q.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a}),t(Aa())}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=we.validateOrgHomeUrl(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a}),t(Aa())}}(t))}}})(ya),Ma=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,"Fetching your organizations and other stuff...")}},{key:"renderError",value:function(){if(this.props.view.error)return N.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return N.createElement(Ca,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var Da=Object(L.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(wa(t))},onUnload:function(){e({type:q.EDIT_ORG_UNLOAD})}}})(Ma),Ua=(r(316),function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).tokenRef=void 0,r.tokenRef=N.createRef(),r.props.checkAuth(),r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return N.createElement("div",{className:"Auth-form"},"Token: ",N.createElement("input",{ref:this.tokenRef,style:{width:"30em"}}),N.createElement(jt.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return N.createElement("div",{className:"Auth-toolbar"},"Logged in as ",N.createElement("b",null,N.createElement("span",null,this.props.authorization.authorization.realname)," (",N.createElement("span",null,this.props.authorization.authorization.username)),")"," ",N.createElement(jt.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return N.createElement("div",null);case m.AUTHORIZED:return N.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case m.UNAUTHORIZED:return N.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},N.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case m.ERROR:return N.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},N.createElement("p",null,"Error"),this.props.authorization.message);default:return N.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return N.createElement("div",null);case m.AUTHORIZED:return N.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case m.UNAUTHORIZED:return N.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},N.createElement("p",null,"Not authorized!"));case m.ERROR:return N.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},N.createElement("p",null,"Error: ??"));default:return N.createElement("div",null)}}},{key:"render",value:function(){return N.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(N.Component)),ka=r(96),Va="",ja="api/V2/token",za="api/V2/me",La=function(){function e(t){var r=t.url;Object(y.a)(this,e),this.url=void 0,this.url=r}return Object(C.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([Va]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([ja]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([za]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function Ga(e){return{type:q.AUTH_CHECK_ERROR,error:e}}function Pa(e,t,r,n){return{type:q.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function xa(){return{type:q.AUTH_UNAUTHORIZED}}function Ba(){return function(e,t){e({type:q.AUTH_CHECK_START});var r=t().app.config.services.Auth.url,n=ka.get("kbase_session");if(n){var a=new La({url:r});Promise.all([a.getTokenInfo(n),a.getMe(n)]).then(function(t){var r=Object(dt.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(Pa(n,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(Ga({code:"error",message:t.message}))})}else e(xa())}}var Wa=Object(L.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(Ba())},onRemoveAuthorization:function(){e(function(e,t){ka.remove("kbase_session"),e(xa())})},onAddAuthorization:function(t){e(function(e){return function(t,r){var n=r().app.config.services.Auth.url;ka.set("kbase_session",e);var a=new La({url:n});Promise.all([a.getTokenInfo(e),a.getMe(e)]).then(function(r){var n=Object(dt.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(Pa(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(Ga({code:"error",message:e.message}))})}}(t))}}})(Ua),qa=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(y.a)(this,e),this.name=void 0,this.onSuccess=void 0,this.onError=void 0,this.name=r,this.onSuccess=n,this.onError=a},Ha=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).started=void 0,r.timeout=void 0,r.started=new Date,r.timeout=e.timeout||5e3,r}return Object(U.a)(t,e),t}(qa),Fa=function(){function e(t){var r=t.name,n=t.payload,a=t.channel;Object(y.a)(this,e),this.name=void 0,this.payload=void 0,this.id=void 0,this.created=void 0,this.channel=void 0,this.envelope=void 0,this.name=r,this.payload=n,this.id=Cr()(),this.created=new Date,this.channel=a,this.envelope=null}return Object(C.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channel:this.channel},name:this.name,payload:this.payload}}}]),e}(),Qa=function(){function e(t){if(Object(y.a)(this,e),this.window=void 0,this.host=void 0,this.id=void 0,this.awaitingResponse=void 0,this.waitingListeners=void 0,this.listeners=void 0,this.lastId=void 0,this.sentCount=void 0,this.receivedCount=void 0,this.unwelcomeReceivedCount=void 0,this.unwelcomeReceivedCountThreshhold=void 0,this.unwelcomeReceiptWarning=void 0,this.unwelcomeReceiptWarningCount=void 0,this.currentListener=void 0,this.window=t.window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||Cr()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(C.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",e));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new qa({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new Fa({name:e,payload:t,channel:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new Fa({name:e,payload:t,channel:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,o=function(){var r=i.value,n=(c=Object(dt.a)(r,2))[0];0===c[1].filter(function(e){if(e instanceof Ha){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},s=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c;o()}}catch(l){n=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new Ha({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new Ha({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),Ja=function(){function e(){Object(y.a)(this,e),this.params=void 0,this.channel=void 0,this.params=null,this.channel=new Qa({window:window,host:document.location.origin})}return Object(C.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:Cr()(),params:{groupsServiceURL:"/services/groups",userProfileServiceURL:"/services/user_profile/rpc",workspaceServiceURL:"/services/ws",serviceWizardURL:"/services/service_wizard",feedsServiceURL:"/services/feeds",authServiceURL:"/services/auth",originalPath:"",view:null,viewParams:null},parentHost:document.location.origin}}}]),e}(),Ya=function(){function e(){Object(y.a)(this,e)}return Object(C.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}}]),e}();function Ka(e){return{type:q.APP_SUCCESS,config:e}}r(318);var Xa=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){this.props.onAppStart()}},{key:"render",value:function(){return this.props.status===v.NONE?N.createElement("div",{className:"KBaseIntegration"},"Loading..."):N.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(N.Component);var Za=Object(L.b)(function(e,t){var r=e.app;return{status:r.status,defaultPath:r.config.defaultPath}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new Ya).getParamsFromIFrame();if(r){var n;switch(r.params.view){case"org":n="/viewOrganization/"+r.params.viewParams.id,window.history.pushState(null,"test",n);break;default:n="/organizations",window.history.pushState(null,"organizations","/organizations")}e(Ka({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL},Auth:{url:r.params.authServiceURL}},defaultPath:n}))}else e(Ka({baseUrl:"",services:{Groups:{url:(r=(new Ja).getParamsFromIFrame()).params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL},Auth:{url:r.params.authServiceURL}},defaultPath:"/organizations"}))})}}})(Xa);function $a(e){return{type:q.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,error:e}}function ei(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p,v;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),u=new fe({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,Promise.all([l.getOrg(e),u.getPendingOrganizationRequestsForOrg(e),u.getOrganizationInvitationsForOrg(e)]);case 6:if(E=t.sent,d=Object(dt.a)(E,3),m=d[0],p=d[1],v=d[2],m.kind===_e.NORMAL){t.next=14;break}return r($a({code:"invalid state",message:'Organization must be of kind "NORMAL"'})),t.abrupt("return");case 14:r((O=m,h=p,R=v,{type:q.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,organization:O,requests:h,invitations:R})),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(3),r($a({code:t.t0.name,message:t.t0.message}));case 20:case"end":return t.stop()}var O,h,R},t,this,[[3,17]])}));return function(e,r){return t.apply(this,arguments)}}()}r(320);var ti=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("/#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){Vt.a.info({title:"Manage Requests Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:N.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=N.createElement(N.Fragment,null,N.createElement("span",null,N.createElement(Ke.a,{to:"/viewOrganization/".concat(this.props.viewModel.organization.id)},N.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.viewModel.organization.name))),N.createElement(tt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),N.createElement(tt.a,{type:"tool"})," ",N.createElement("span",{style:{fontSize:"120%"}},"Managing Org Requests"))),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=N.createElement("span",null,"Loading Org Editor...");return N.createElement(Wt,{breadcrumbs:e})}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=N.createElement("span",null,N.createElement(tt.a,{type:"user"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"team"})," ","Request to Join Group"),n=[N.createElement(jt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return N.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"from"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.requester,avatarSize:50}))),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=N.createElement("span",null,N.createElement(tt.a,{type:"team"}),N.createElement(tt.a,{type:"mail"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"user"})," ","Invitation to Join Group"),n=[N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e.id)}},"Cancel")];return N.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"invitation to"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.user,avatarSize:30}))),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case ge.NONE:return"None";case ge.VIEW:return"View Only";case ge.EDIT:return"Edit";case ge.ADMIN:return"Admin";case ge.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=N.createElement("span",null,N.createElement(tt.a,{type:"file"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"team"})," ","Request to Add Narrative"),a=[N.createElement(jt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e.id)}},"Approve"),N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e.id)}},"Deny")];return t=N.createElement(xn,{workspaceId:parseInt(e.narrativeId,10)}),N.createElement(nn.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"from"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.requester,avatarSize:30}))),N.createElement("tr",null,N.createElement("th",null,"narrative"),N.createElement("td",{className:"narrative"},t)),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=N.createElement("span",null,N.createElement(tt.a,{type:"appstore"}),N.createElement(tt.a,{type:"arrow-right"}),N.createElement(tt.a,{type:"team"})," ","Request to Add App"),n=[N.createElement(jt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),N.createElement(jt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return N.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},N.createElement("table",{className:"pendingRequestsTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,"from"),N.createElement("td",{className:"requester"},N.createElement(Nn,{userId:e.requester,avatarSize:50}))),N.createElement("tr",null,N.createElement("th",null,"app"),N.createElement("td",{className:"requester"},e.appId)),N.createElement("tr",null,N.createElement("th",null,"sent"),N.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),N.createElement("tr",null,N.createElement("th",null,"expires"),N.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Mn(e.expireAt),")")))))}},{key:"renderRequest",value:function(e){switch(e.type){case u.REQUEST:switch(e.resourceType){case E.USER:return this.renderRequestJoinRequest(e);case E.WORKSPACE:return this.renderRequestNarrativeRequest(e);case E.APP:return this.renderRequestAppRequest(e);default:throw new Error("Unsupported resource type: "+e.resourceType)}case u.INVITATION:switch(e.resourceType){case E.USER:return this.renderRequestJoinInvitation(e);case E.WORKSPACE:throw new Error("Workspace invitations are not supported");case E.APP:throw new Error("App invitations are not supported");default:throw new Error("Unsupported resource type: "+e.resourceType)}}}},{key:"renderRequests",value:function(){var e=this,t=this.props.viewModel.requests;return 0===t.length?N.createElement(Ye.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending requests for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"renderInvitations",value:function(){var e=this,t=this.props.viewModel.invitations;return 0===t.length?N.createElement(Ye.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending invitations for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"render",value:function(){if(this.state.cancelToBrowser)return N.createElement(j.a,{push:!0,to:"/organizations"});if(this.state.cancelToViewer)return N.createElement(j.a,{push:!0,to:"/viewOrganization/"+this.props.viewModel.organization.id});var e=this.props.viewModel.invitations.length,t=this.props.viewModel.requests.length;return N.createElement("div",{className:"ManageGroupRequests"},this.renderHeader(),N.createElement(gn,{organizationId:this.props.viewModel.organization.id}),N.createElement("div",{className:"row"},N.createElement("div",{className:"pendingCol"},N.createElement("h2",null,"Requests (",t,")"),N.createElement("div",{className:"pendingRequests"},this.renderRequests())),N.createElement("div",{className:"historyCol"},N.createElement("h2",null,"Invitations (",e,")"),this.renderInvitations())))}}]),t}(N.Component);var ri=Object(L.b)(function(e,t){var r=e.views.manageOrganizationRequestsView;if(!r.viewModel)throw new Error("view state not loaded!");return{viewModel:r.viewModel}},function(e){return{onAcceptJoinRequest:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.views.manageOrganizationRequestsView,l=a.app.config,u=new fe({token:o,username:s,groupsServiceURL:l.services.Groups.url}),c){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,t.next=7,u.acceptRequest(e);case 7:E=t.sent,r((m=E,{type:q.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,request:m})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,error:d}));case 14:case"end":return t.stop()}var d,m},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onDenyJoinRequest:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.views.manageOrganizationRequestsView,l=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return u=new fe({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=4,t.next=7,u.denyRequest(e);case 7:E=t.sent,r((m=E,{type:q.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,request:m})),c.viewModel&&r(ei(c.viewModel.organization.id)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,error:d}));case 15:case"end":return t.stop()}var d,m},t,this,[[4,12]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onCancelJoinInvitation:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.views.manageOrganizationRequestsView,l=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return u=new fe({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=4,t.next=7,u.cancelRequest(e);case 7:t.sent,c.viewModel&&r(ei(c.viewModel.organization.id)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((E={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,error:E}));case 14:case"end":return t.stop()}var E},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.grantViewAccess(e);case 6:u=t.sent,console.log("view access granted",u),r((d=u,{type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,request:d})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,error:E}));case 14:case"end":return t.stop()}var E,d},t,this,[[3,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(ti),ni=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.SUCCESS:return N.createElement(ri,null)}}},{key:"componentDidMount",value:function(){switch(this.props.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var ai=Object(L.b)(function(e,t){return{loadingState:e.views.manageOrganizationRequestsView.loadingState}},function(e){return{onLoad:function(t){e(ei(t))},onUnload:function(){e({type:q.ADMIN_MANAGE_REQUESTS_UNLOAD})}}})(ni);function ii(e){return{type:q.VIEW_MEMBERS_LOAD_ERROR,error:e}}function oi(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.VIEW_MEMBERS_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Nr({token:o,username:s,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),t.prev=3,t.next=6,l.getOrganizationForUser(e);case 6:if(u=t.sent,E=u.organization,d=u.relation,E.kind===_e.NORMAL){t.next=12;break}return r(ii({code:"invalid state",message:'Organization must be of kind "NORMAL"'})),t.abrupt("return");case 12:r((m=E,p=d,{type:q.VIEW_MEMBERS_LOAD_SUCCESS,organization:m,relation:p})),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(3),r(ii({code:t.t0.name,message:t.t0.message}));case 18:case"end":return t.stop()}var m,p},t,this,[[3,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function si(e){return function(t,r){t({type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Me({token:i,username:o,groupsServiceURL:s.services.Groups.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function ci(e){return function(t,r){t({type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Me({token:i,username:o,groupsServiceURL:s.services.Groups.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function li(e){return function(t,r){t({type:q.VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Me({token:i,username:o,groupsServiceURL:s.services.Groups.url}).removeMember(c.organization.id,e).then(function(){t({type:q.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS}),t(oi(c.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(148);var ui=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={over:!1},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderPromoteButton",value:function(){var e=this;switch(this.props.member.type){case Re.MEMBER:return N.createElement(jt.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onPromoteMemberToAdmin(e.props.member.username)}},N.createElement(tt.a,{type:"unlock"}),"Promote to Admin");case Re.ADMIN:return N.createElement(jt.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onDemoteAdminToMember(e.props.member.username)}},N.createElement(tt.a,{type:"user"}),"Demote to Member");case Re.OWNER:return}}},{key:"renderMemberButtons",value:function(e){var t=this;if(this.props.relation.type===he.OWNER||this.props.relation.type===he.ADMIN)return N.createElement("div",null,N.createElement("div",null,N.createElement(jt.a,{type:"danger",disabled:!this.state.over,style:{width:"100%"},onClick:function(){t.props.onRemoveMember(e.username)}},N.createElement(tt.a,{type:"delete"}),"Remove from Org")),N.createElement("div",null,this.renderPromoteButton()))}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.props.onRemoveMember(t.username)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=N.createElement(Bt.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},N.createElement(Bt.a.Item,{key:"promoteToAdmin"},N.createElement(tt.a,{type:"unlock"}),"Promote to Admin"),N.createElement(Bt.a.Item,{key:"removeMember"},N.createElement(tt.a,{type:"delete"}),"Remove Member"));return N.createElement("div",null,N.createElement(an.a,{overlay:r,trigger:["click"]},N.createElement(jt.a,{icon:"ellipsis"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=N.createElement(Bt.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},N.createElement(Bt.a.Item,{key:"demoteToMember"},N.createElement(tt.a,{type:"user"}),"Demote to Member"));return N.createElement("div",null,N.createElement(an.a,{overlay:r,trigger:["click"]},N.createElement(tt.a,{type:"ellipsis"})))}},{key:"renderOwnerMenu",value:function(e){}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===he.OWNER||this.props.relation.type===he.ADMIN)switch(this.props.member.type){case Re.OWNER:return this.renderOwnerMenu(e);case Re.ADMIN:return this.renderAdminMenu(e);case Re.MEMBER:return this.renderMemberMenu(e)}}},{key:"onMouseOver",value:function(){this.setState({over:!0})}},{key:"onMouseOut",value:function(){this.setState({over:!1})}},{key:"render",value:function(){return N.createElement("div",{key:this.props.member.username,className:"memberRow",onMouseEnter:this.onMouseOver.bind(this),onMouseLeave:this.onMouseOut.bind(this)},N.createElement("div",{style:{flex:"1 1 0px"}},N.createElement(En,{member:this.props.member,avatarSize:50,key:this.props.member.username})),N.createElement("div",{style:{flex:"0 0 10em",textAlign:"right"}},this.renderMemberOptions(this.props.member)))}}]),t}(N.Component),Ei=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onPromoteMemberToAdmin",value:function(e){this.props.onPromoteMemberToAdmin(e)}},{key:"onDemoteAdminToMember",value:function(e){this.props.onDemoteAdminToMember(e)}},{key:"onShowInfo",value:function(){Vt.a.info({title:"View Members Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the view members tool..."))})}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===he.OWNER||this.props.relation.type===he.ADMIN||this.props.relation.type===he.MEMBER)}},{key:"isAdmin",value:function(){return!!this.props.organization&&(this.props.relation.type===he.OWNER||this.props.relation.type===he.ADMIN)}},{key:"renderOrgName",value:function(e){return e.length<25?e:N.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=N.createElement(N.Fragment,null,N.createElement("span",null,N.createElement(Ke.a,{to:"/viewOrganization/".concat(this.props.organization.id)},N.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),N.createElement(tt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),N.createElement(tt.a,{type:"team"})," ",N.createElement("span",{style:{fontSize:"120%"}},"Viewing Org Members"))),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderMembersToolbar",value:function(){switch(this.props.relation.type){case he.NONE:return N.createElement("div",{className:"toolbar"},N.createElement(jt.a,null,N.createElement(tt.a,{type:"plus"}),"Join"));case he.MEMBER:return N.createElement("div",{className:"toolbar"});case he.ADMIN:case he.OWNER:return N.createElement("div",{className:"toolbar"},N.createElement(Ke.a,{to:"/inviteUser/"+this.props.organization.id},N.createElement(jt.a,null,N.createElement(tt.a,{type:"mail"})," Invite a User")))}}},{key:"renderMembers",value:function(){var e,t=this;return this.isMember()?(e=0===this.props.organization.members.length?N.createElement("p",{className:"message"},"This organization has no members"):this.props.organization.members.map(function(e){return N.createElement("div",{key:e.username,className:"simpleCard"},N.createElement(ui,{member:e,relation:t.props.relation,organization:t.props.organization,onPromoteMemberToAdmin:t.props.onPromoteMemberToAdmin,onDemoteAdminToMember:t.props.onDemoteAdminToMember,onRemoveMember:t.props.onRemoveMember}))}),N.createElement("div",{className:"table infoTable"},N.createElement("div",{className:"row"},N.createElement("div",{className:"col0",style:{display:"flex",flexDirection:"column",overflowY:"auto"}},e)))):N.createElement("p",{className:"message"},"Sorry, organization membership restricted to members only")}},{key:"renderAdminsToolbar",value:function(){return N.createElement("div",{className:"toolbar"})}},{key:"renderOrganizationHeader",value:function(){return N.createElement(gn,{organizationId:this.props.organization.id})}},{key:"componentWillUnmount",value:function(){this.props.onViewMembersUnload()}},{key:"render",value:function(){return this.state.cancelToBrowser?N.createElement(j.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?N.createElement(j.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):N.createElement("div",{className:"ViewMembers"},this.renderHeader(),this.renderOrganizationHeader(),N.createElement("div",{className:"body"},N.createElement("div",{className:"membersCol"},N.createElement("h2",null,"Members"),this.renderMembersToolbar(),this.renderMembers()),N.createElement("div",{className:"otherCol"},N.createElement("h2",null,"Pending Members"),this.renderAdminsToolbar(),N.createElement("p",null,"This space to provide a list of user requests and invitations. This will allow this view to provide all user management tools in one place."),N.createElement("p",null,"In progress... currently renders the requests but does not provide actions (buttons)."))))}}]),t}(N.Component);var di=Object(L.b)(function(e,t){if(!e.views.viewMembersView||null===e.views.viewMembersView.viewModel)throw new Error("Runtime Error - view members view is not defined!");var r=e.views.viewMembersView.viewModel;return{organization:r.organization,relation:r.relation}},function(e){return{onViewMembersUnload:function(){e({type:q.VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(si(t))},onDemoteAdminToMember:function(t){e(ci(t))},onRemoveMember:function(t){e(li(t))}}})(Ei),mi=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.state){case h.NONE:case h.LOADING:return this.renderLoading();case h.SUCCESS:return N.createElement(di,null)}}},{key:"componentDidMount",value:function(){switch(this.props.state){case h.NONE:this.props.onViewMembersLoad(this.props.organizationId)}}}]),t}(N.Component);var pi=Object(L.b)(function(e,t){return{state:e.views.viewMembersView.loadingState}},function(e){return{onViewMembersLoad:function(t){e(oi(t))}}})(mi);function vi(e){return{type:q.INVITE_USER_LOAD_ERROR,error:e}}function Oi(e){return{type:q.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function hi(e){return{type:q.INVITE_USER_SELECT_USER_ERROR,error:e}}function Ri(e){return function(t,r){t({type:q.INVITE_USER_SELECT_USER_START});var n=r(),a=n.views.inviteUserView.viewModel,i=n.auth.authorization,o=i.token,s=(i.username,n.app.config);a?new Et({token:o,userProfileServiceURL:s.services.UserProfile.url}).getUser(e).then(function(e){var r=function(e,t){if(e.username===t.owner.username)return he.OWNER;var r=t.members.find(function(t){return t.username===e.username});if(r)switch(r.type){case l.ADMIN:return he.ADMIN;case l.OWNER:return he.OWNER;case l.MEMBER:return he.MEMBER}return he.VIEW}(e,a.organization);t(function(e,t){return{type:q.INVITE_USER_SELECT_USER_SUCCESS,user:e,relation:t}}(e,r))}).catch(function(e){t(hi({code:e.name,message:e.message}))}):t(hi({code:"invalid state",message:"select user invalid state -- no view value"}))}}function gi(){return function(e,t){e({type:q.INVITE_USER_SEND_INVITATION_START});var r=t(),n=r.auth.authorization,a=n.token,i=n.username,o=r.app.config,s=r.views.inviteUserView,c=s.loadingState,l=s.viewModel;s.error;if(c===h.SUCCESS&&null!==l){var u=l,E=u.selectedUser,d=u.organization.id;if(E)new fe({token:a,username:i,groupsServiceURL:o.services.Groups.url}).inviteUserToJoinOrg(d,E.user.username).then(function(t){e({type:q.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){var r;e((r={code:t.name,message:t.message},{type:q.INVITE_USER_SEND_INVITATION_ERROR,error:r}))})}}}r(323),r(325);var _i=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return N.createElement("div",{className:"User"},N.createElement("div",{className:"avatarCol"},N.createElement(at,{user:this.props.user,size:this.props.avatarSize||30})),N.createElement("div",{className:"infoCol"},N.createElement("div",{className:"name"},N.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),N.createElement("div",{className:"organization"},this.props.user.organization||N.createElement("i",null,"no organization in user profile")),N.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||N.createElement("i",null,"no location information in user profile"))))}}]),t}(N.Component),fi=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).lastSearchAt=void 0,r.searchInput=void 0,r.searchButton=void 0,r.lastSearchAt=null,r.searchInput=N.createRef(),r.searchButton=N.createRef(),r.state={cancelToViewMembers:!1,cancelToBrowser:!1,cancelToViewer:!1,autocompleteMessage:""},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"onClickCancelToViewMembers",value:function(){this.setState({cancelToViewMembers:!0})}},{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"onShowInfo",value:function(){Vt.a.info({title:"Invite User Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the invite user tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:N.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=N.createElement(N.Fragment,null,N.createElement("span",null,N.createElement(Ke.a,{to:"/viewOrganization/".concat(this.props.organization.id)},N.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),N.createElement(tt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),N.createElement(tt.a,{type:"tool"})," ",N.createElement("span",{style:{fontSize:"120%"}},"Invite a User to Join Org"))),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return N.createElement(Ye.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?N.createElement(Ye.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===he.NONE?N.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},N.createElement("div",{className:"name "},t.realname," (",t.username,")")):N.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},N.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return N.createElement("div",{className:"orgInfo"},N.createElement("div",{className:"name"},N.createElement("span",{className:"field-label"},"name"),N.createElement("span",null,this.props.organization.name)),N.createElement("div",{className:"description"},N.createElement("span",{className:"field-label"},"description"),N.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===he.VIEW?e=N.createElement(jt.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=N.createElement(jt.a,{disabled:!0,type:"primary"},"Send Invitation"),t=N.createElement("div",null,"User may not be invited because:",N.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=N.createElement(Ye.a,{type:"warning",message:t,showIcon:!0})):(e=N.createElement(jt.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),N.createElement("div",{className:"invitationForm"},N.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),N.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case g.NONE:return N.createElement("div",null,"NONE");case g.EDITING:return N.createElement("div",null,"EDITING");case g.SENDABLE:return N.createElement("div",null,"SENDABLE");case g.SENDING:return N.createElement("div",null,"SENDING");case g.SUCCESS:return N.createElement("div",null,"SENT SUCCESSFULLY");case g.ERROR:return N.createElement("div",null,"ERROR SENDING");default:return N.createElement("div",null,"Bad State")}}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return N.createElement(gn,{organizationId:this.props.organization.id})}},{key:"renderRelation",value:function(e){switch(e){case he.NONE:return N.createElement("span",null,N.createElement(tt.a,{type:"stop"}),"None");case he.VIEW:return N.createElement("span",null,N.createElement(tt.a,{type:"stop"})," Not a member");case he.MEMBER_REQUEST_PENDING:return N.createElement("span",null,N.createElement(tt.a,{type:"user",style:{color:"orange"}})," User's membership ",N.createElement("b",null,"request")," is pending");case he.MEMBER_INVITATION_PENDING:return N.createElement("span",null,N.createElement(tt.a,{type:"user",style:{color:"blue"}})," User has been ",N.createElement("b",null,"invited")," to join");case he.MEMBER:return N.createElement("span",null,N.createElement(tt.a,{type:"user"})," User is a ",N.createElement("b",null,"member")," of this organization");case he.ADMIN:return N.createElement("span",null,N.createElement(tt.a,{type:"unlock"}),"User is an ",N.createElement("b",null,"admin")," of this organization");case he.OWNER:return N.createElement("span",null,N.createElement(tt.a,{type:"crown"})," User is the ",N.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?N.createElement("div",{className:"selectedUser"},N.createElement("p",{className:"noSelection"},"No user yet selected")):N.createElement("div",{className:"selectedUser"},N.createElement(_i,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return N.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return N.createElement(tt.a,{type:"search"})}},{key:"render",value:function(){return this.state.cancelToViewMembers?N.createElement(Or.a,{push:!0,to:"/viewMembers/"+this.props.organization.id}):this.state.cancelToBrowser?N.createElement(Or.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?N.createElement(Or.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):N.createElement("div",{className:"InviteUser scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),N.createElement("div",{className:"row scrollable-flex-column"},N.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},N.createElement("h3",null,"Select User to Invite"),N.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},N.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),N.createElement(jt.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),N.createElement("div",{className:"usersTable"},this.renderUsers())),N.createElement("div",{className:"col1 lastCol"},N.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(N.Component);fi.searchDebounce=200;var wi=fi;var Si=Object(L.b)(function(e,t){if(!e.views.inviteUserView||null===e.views.inviteUserView.viewModel)throw new Error("Runtime Error - invite members view is not defined!");var r=e.views.inviteUserView.viewModel;return{organization:r.organization,users:r.users,selectedUser:r.selectedUser,editState:r.editState}},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,u,E,d,m,p,v,O,h,R;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(Oi(null)),t.abrupt("return");case 4:if(a=n(),i=a.views.inviteUserView.viewModel,o=a.auth.authorization,s=o.token,o.username,c=a.app.config,null!==i){t.next=7;break}return t.abrupt("return");case 7:return u=i.organization,E=new Et({token:s,userProfileServiceURL:c.services.UserProfile.url}),d=u.owner.username,m=[],p=[],v=[],O=[],u.members.forEach(function(e){switch(e.type){case l.MEMBER:p.push(e.username);case l.ADMIN:m.push(e.username)}}),t.prev=16,t.next=19,E.searchUsers(e);case 19:h=t.sent,R=h.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?he.OWNER:m.indexOf(t)>=0?he.ADMIN:v.indexOf(t)>=0?he.MEMBER_INVITATION_PENDING:O.indexOf(t)>=0?he.MEMBER_REQUEST_PENDING:p.indexOf(t)>=0?he.MEMBER:he.NONE}}),r(Oi(R)),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(16),r((g={code:t.t0.name,message:t.t0.message},{type:q.INVITE_USER_SEARCH_USERS_ERROR,error:g}));case 27:case"end":return t.stop()}var g},t,this,[[16,24]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){e(Ri(t))},onSendInvitation:function(){e(gi())}}})(wi),Ai=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,"Loading Users...")}},{key:"renderError",value:function(){return N.createElement("div",null,"Error!")}},{key:"render",value:function(){switch(this.props.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return N.createElement(Si,null)}}},{key:"componentDidMount",value:function(){switch(this.props.loadingState){case h.NONE:this.props.onInviteUserLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var Ni=Object(L.b)(function(e,t){return{loadingState:e.views.inviteUserView.loadingState}},function(e){return{onInviteUserLoad:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:if((u=t.sent).kind===_e.NORMAL){t.next=10;break}return r(vi({code:"invalid state",message:'Organization kind must be "NORMAL"'})),t.abrupt("return");case 10:r((E=u,{type:q.INVITE_USER_LOAD_SUCCESS,organization:E,users:null})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),r(vi({code:t.t0.name,message:t.t0.message}));case 16:case"end":return t.stop()}var E},t,this,[[3,13]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.INVITE_USER_UNLOAD})}}})(Ai);function Ii(e){return{type:q.MANAGE_MEMBERSHIP_LOAD_ERROR,error:e}}function bi(){return function(e,t){var r=t();if(!r.views.manageMembershipView.viewModel)throw new Error("Argh, no view model");r.views.manageMembershipView.viewModel.editableMemberProfile.title.validationState.type===s.OK?e({type:q.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS}):e({type:q.MANAGE_MEMBERSHIP_EVALUATE_ERROR})}}r(327);var Ti=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"doLeaveOrg",value:function(){var e=this,t=function(){e.doLeaveOrgConfirmed()}.bind(this);Vt.a.confirm({title:"Really leave this organization?",content:N.createElement("p",null,"This is not reversible."),width:"50em",onOk:function(){t()}})}},{key:"doLeaveOrgConfirmed",value:function(){this.props.onLeaveOrganization(this.props.organization.id)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onTitleChange",value:function(e){e.persist(),this.props.onUpdateTitle(e.target.value)}},{key:"doShowInfo",value:function(){Vt.a.info({title:"Manage My Membership Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the view to help you manage your membership..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:N.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=N.createElement(N.Fragment,null,N.createElement("span",null,N.createElement(Ke.a,{to:"/viewOrganization/".concat(this.props.organization.id)},N.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),N.createElement(tt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),N.createElement(tt.a,{type:"user"})," ",N.createElement("span",{style:{fontSize:"120%"}},"Manage your membership"))),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{type:"danger",icon:"frown",onClick:this.doLeaveOrg.bind(this)},"Leave Organization...")," ",N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return N.createElement(gn,{organizationId:this.props.organization.id})}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"ManageMembership-validation-error"}switch(e.syncState){case i.DIRTY:return"ManageMembership-sync-dirty";default:return"ManageMembership-validation-ok"}}},{key:"renderEditor",value:function(){return N.createElement("form",{id:"editMembership",className:"ManageMembership-editorTable",onSubmit:this.onSubmit.bind(this)},N.createElement("div",{className:"ManageMembership-headerRow"},N.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Edit"),N.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Preview")),N.createElement("div",{className:"ManageMembership-editorTable-row"},N.createElement("div",{className:"ManageMembership-editCol ManageMembership-editCell"},N.createElement("div",{className:"ManageMembership-editorTable-labelCol"},N.createElement("span",{className:"field-label ManageMembership-titleLabel"},"title")),N.createElement("div",{className:"ManageMembership-editorTable-controlCol"},N.createElement(Rr.a,{value:this.props.editableMemberProfile.title.value||"",className:this.calcFieldClass(this.props.editableMemberProfile.title),onChange:this.onTitleChange.bind(this)}))),N.createElement("div",{className:"ManageMembership-previewCol ManageMembership-previewCell"},N.createElement("div",{className:"ManageMembership-titlePreview"},this.props.editableMemberProfile.title.value))),N.createElement("div",{className:"ManageMembership-editorFooter"},N.createElement(jt.a,{icon:"save",form:"editMembership",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")))}},{key:"render",value:function(){return N.createElement("div",{className:"ManageMembership"},this.renderOrgHeader(),this.renderHeader(),N.createElement("h3",null,"Edit Your Membership Profile"),N.createElement("div",{className:"ManageMembership-body"},this.renderEditor()))}}]),t}(N.Component);var yi=Object(L.b)(function(e,t){if(!e.views.manageMembershipView.viewModel)throw new Error("View model missing");var r=e.auth.authorization.username,n=e.views.manageMembershipView.viewModel;return{username:r,organization:n.organization,editableMemberProfile:n.editableMemberProfile,editState:n.editState,saveState:n.saveState,validationState:n.validationState}},function(e){return{onLeaveOrganization:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r({type:q.MANAGE_MEMBERSHIP_LEAVE_ORG_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url});try{l.removeMember(e,s),r({type:q.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS})}catch(u){console.error("ERROR leaving org",u),r({type:q.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,error:{code:u.name,message:u.message}})}case 4:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUpdateTitle:function(t){e(function(e){return function(t){var r=we.validateMemberTitle(e),n=Object(dt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,error:Mr({code:"invalid",message:i.message})}):t({type:q.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,title:a}),t(bi())}}(t))},onSave:function(){e(function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var n,a,i,o,s,c,l,u,E,d;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:q.MANAGE_MEMBERSHIP_SAVE_START}),(n=r()).views.manageMembershipView.viewModel){e.next=4;break}throw new Error("Argh, no view model?!?");case 4:return a=n.auth.authorization,i=a.token,o=a.username,s=n.views.manageMembershipView.viewModel,c=s.organization,l=s.editableMemberProfile,u=n.app.config,E={title:l.title.value},d=new Me({token:i,username:o,groupsServiceURL:u.services.Groups.url}),e.prev=7,e.next=10,d.updateMember(c.id,o,E);case 10:t({type:q.MANAGE_MEMBERSHIP_SAVE_SUCCESS}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(7),console.error("error saving member profile",e.t0),t({type:q.MANAGE_MEMBERSHIP_SAVE_ERROR,error:Mr({code:"error",message:e.t0.message})});case 17:t(bi());case 18:case"end":return e.stop()}},e,this,[[7,13]])}));return function(t,r){return e.apply(this,arguments)}}())}}})(Ti),Ci=r(350),Mi=(r(329),function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderDetail",value:function(){return N.createElement("table",{className:"errorTable"},N.createElement("tbody",null,N.createElement("tr",null,N.createElement("th",null,N.createElement("span",{className:"field-label"},"generated at")),N.createElement("td",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.error.at))),N.createElement("tr",null,N.createElement("th",null,N.createElement("span",{className:"field-label"},"error id")),N.createElement("td",null,N.createElement("span",{style:{fontFamily:"monospace"}},this.props.error.id))),N.createElement("tr",null,N.createElement("th",null,N.createElement("span",{className:"field-label"},"explanation")),N.createElement("td",null,this.props.error.detail))))}},{key:"renderInfo",value:function(){return this.props.error.info?N.createElement("div",null,"additional info here ..."):N.createElement("div",{style:{textAlign:"left",fontStyle:"italic"}},"No additional information")}},{key:"render",value:function(){var e=N.createElement("div",null,N.createElement("p",null,this.props.error.message),N.createElement(Ci.a,{bordered:!1,style:{backgroundColor:"transparent"}},N.createElement(Ci.a.Panel,{header:"detail",key:"1",style:{backgroundColor:"transparent"}},this.renderDetail())),N.createElement(Ci.a,{bordered:!1,style:{backgroundColor:"transparent"}},N.createElement(Ci.a.Panel,{header:"additional info",key:"1",style:{backgroundColor:"transparent"}},this.renderInfo())));return N.createElement(Ye.a,{type:"error",showIcon:!0,message:"Error",className:"Error",description:e})}}]),t}(N.Component));var Di=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoadingNone",value:function(){return N.createElement("div",null,"Loading membership editor (none)...")}},{key:"renderLoading",value:function(){return N.createElement("div",null,"Loading membership editor...")}},{key:"renderError",value:function(e){return N.createElement(Mi,{error:e})}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:return this.renderLoadingNone();case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(function(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,o=e.info;return{code:t,message:r,detail:n,id:Cr()(),at:new Date,history:a,trace:i,info:o}}({code:"missing-error",message:"The error appears to be missing"}));default:return N.createElement(yi,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var Ui,ki=Object(L.b)(function(e,t){return{view:e.views.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,o,c,l,u,E,d,m,p;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.MANAGE_MEMBERSHIP_LOAD_START}),a=n(),o=a.auth.authorization,c=o.token,l=o.username,u=a.app.config,E=new Me({token:c,username:l,groupsServiceURL:u.services.Groups.url}),t.prev=3,t.next=6,E.getOrg(e);case 6:if((d=t.sent).kind===_e.NORMAL){t.next=10;break}return r(Ii(Mr({code:"invalid state",message:'Organization must be of kind "NORMAL"'}))),t.abrupt("return");case 10:if(d.isMember){t.next=13;break}return r(Ii(Mr({code:"notfound",message:'The user "'+l+'" is not a member of this org'}))),t.abrupt("return");case 13:if(m=d.members.find(function(e){return e.username===l})){t.next=17;break}return r(Ii(Mr({code:"notfound",message:'The user "'+l+'" was not found in the members list'}))),t.abrupt("return");case 17:p={title:{value:m.title,remoteValue:m.title,syncState:i.NEW,validationState:{type:s.OK,validatedAt:new Date}}},r((v=d,O=p,{type:q.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:v,editableMemberProfile:O})),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(3),console.error("Error :(",t.t0),r(Ii(Mr({code:t.t0.name,message:t.t0.message})));case 25:case"end":return t.stop()}var v,O},t,this,[[3,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.MANAGE_MEMBERSHIP_UNLOAD})}}})(Di);r(332);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Ui||(Ui={}));var Vi=function(e){function t(e){var r;return Object(y.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e))).state={navigateTo:Ui.NONE},r}return Object(U.a)(t,e),Object(C.a)(t,[{key:"doCancelToBrowser",value:function(){this.setState({navigateTo:Ui.BROWSER})}},{key:"doCancelToViewer",value:function(){this.setState({navigateTo:Ui.VIEWER})}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doShowInfo",value:function(){Vt.a.info({title:"Request to Add Narrative Help",width:"50em",content:N.createElement("div",null,N.createElement("p",null,"This is the view to help you request the addition of a narrative to this org..."))})}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return N.createElement(gn,{organizationId:this.props.organization.id})}},{key:"renderOrgName",value:function(e){return e.length<25?e:N.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=N.createElement(N.Fragment,null,N.createElement("span",null,N.createElement(Ke.a,{to:"/viewOrganization/".concat(this.props.organization.id)},N.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),N.createElement(tt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),N.createElement(tt.a,{type:"plus"})," ",N.createElement("span",{style:{fontSize:"120%"}},"Add Narrative to Org"))),t=N.createElement(N.Fragment,null,N.createElement(jt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return N.createElement(Wt,{breadcrumbs:e,buttons:t})}},{key:"renderNarratives",value:function(){var e=this;return 0===this.props.narratives.length?N.createElement("div",{className:"message"},"You do not have any Narratives"):this.props.narratives.map(function(t,r){var n=["narrative"];return!(!e.props.selectedNarrative||t.workspaceId!==e.props.selectedNarrative.workspaceId)&&n.push("selected"),t.status===_.ASSOCIATED?(n.push("narrativeInOrg"),N.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},N.createElement("div",{className:"title"},t.title||"n/a"," (associated)"))):t.status===_.REQUESTED?(n.push("narrativeInOrg"),N.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},N.createElement("div",{className:"title"},t.title||"n/a"," (request pending)"))):(n.push("narrativeNotInOrg"),N.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},N.createElement("div",{className:"title"},t.title||"n/a")))})}},{key:"onSearchSubmit",value:function(){console.log("searching...")}},{key:"renderSearchIcon",value:function(){return this.props.searching?N.createElement(tt.a,{type:"loading"}):N.createElement(tt.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return N.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSearchSubmit.bind(this)},N.createElement("input",{placeholder:"Search your Narratives",autoFocus:!0}),N.createElement(jt.a,{className:"button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"onSortByChange",value:function(){}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return N.createElement("div",{className:"filterSortBar"},N.createElement("span",{className:"field-label"},"sort by"),N.createElement(zt.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},N.createElement(zt.a.Option,{value:"title",key:"title"},"Title"),N.createElement(zt.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")),N.createElement(zt.a,{onChange:this.onSortDirectionChange.bind(this),style:{width:"4em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},N.createElement(zt.a.Option,{value:O.ASCENDING,key:"name"},N.createElement(tt.a,{type:"sort-ascending"})),N.createElement(zt.a.Option,{value:O.DESCENDING,key:"owner"},N.createElement(tt.a,{type:"sort-descending"}))))}},{key:"renderNarrativeSelector",value:function(){return N.createElement("div",{className:"narrativeSelector scrollable-flex-column"},N.createElement("div",{style:{display:"flex",flexDirection:"row"}},N.createElement("div",{style:{flex:"0 0 10em"}},this.renderSearchBar()),N.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),N.createElement("div",{className:"narratives scrollable-flex-column"},N.createElement("div",{className:"narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===_.ASSOCIATED?N.createElement(Ye.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===_.REQUESTED?N.createElement(Ye.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===he.ADMIN||this.props.relation.type===he.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",N.createElement(jt.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?N.createElement("div",{className:"selectedNarrative"},N.createElement("div",{className:"title"},this.props.selectedNarrative.title),N.createElement("div",null,N.createElement("i",null,"last modified")," ",Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.selectedNarrative.modifiedAt))):N.createElement(Ye.a,{type:"info",message:"Select a narrative on the left to show it here and be able to add it to this organization."})}},{key:"render",value:function(){switch(this.state.navigateTo){case Ui.BROWSER:return N.createElement(Or.a,{push:!0,to:"/organizations"});case Ui.VIEWER:return N.createElement(Or.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id});case Ui.NONE:}return N.createElement("div",{className:"RequestNarrative scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),N.createElement("div",{className:"body scrollable-flex-column"},N.createElement("div",{className:"selectNarrativeCol scrollable-flex-column"},N.createElement("h3",null,"Select a Narrative"),this.renderNarrativeSelector()),N.createElement("div",{className:"selectedNarrativeCol"},N.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),N.createElement("div",{className:"selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),N.createElement("div",{className:"footer"}))}}]),t}(N.Component);function ji(e){return function(t,r){t({type:q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}var zi=Object(L.b)(function(e,t){if(null===e.views.requestNarrativeView.viewModel)throw new Error("view value is not defined!");var r=e.views.requestNarrativeView.viewModel;return{organization:r.organization,relation:r.relation,narratives:r.narratives,selectedNarrative:r.selectedNarrative,searching:!1,sortBy:"title",sortDirection:O.ASCENDING,filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(le.a)(ce.a.mark(function r(n,a){var i,o,s,c,l,u,E;return ce.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:q.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,u=new Me({token:s,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=3,r.next=6,u.addOrRequestNarrativeToGroup(e,t.workspaceId);case 6:E=r.sent,n((m=E,{type:q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:m})),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n((d={code:r.t0.name,message:r.t0.message},{type:q.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 13:case"end":return r.stop()}var d,m},r,this,[[3,10]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(ji(t))}}})(Vi),Li=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"renderLoading",value:function(){return N.createElement("div",null,"Loading Your Narratives...")}},{key:"renderError",value:function(e){return N.createElement("div",null,"Error!",N.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return N.createElement(zi,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(N.Component);var Gi=Object(L.b)(function(e,t){return{view:e.views.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(ce.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p,v,O,h,R;return ce.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Me({token:o,username:s,groupsServiceURL:c.services.Groups.url}),u=new Nt({token:o,username:s,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url}),E=new fe({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,Promise.all([l.getOrganization(e),u.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,m=Object(dt.a)(d,4),p=m[0],v=m[1],O=m[2],h=m[3],R=Se(p,s,O,h),r((_=p,f=v,w=R,{type:q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:_,narratives:f,relation:w})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((g={code:t.t0.name,message:t.t0.message},{type:q.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:g}));case 22:case"end":return t.stop()}var g,_,f,w},t,this,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(Li),Pi=function(){function e(){Object(y.a)(this,e)}return Object(C.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map}},db:{notifications:{all:[],byId:new Map},lastVisited:{byId:new Map}},views:{browseOrgsView:{loadingState:h.NONE,error:null,viewModel:null},organizationCentricView:{loadingState:h.NONE,error:null,viewModel:null},addOrgView:{loadingState:h.NONE,error:null,viewModel:null},editOrgView:{loadingState:h.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null},viewMembersView:{loadingState:h.NONE,error:null,viewModel:null},inviteUserView:{loadingState:h.NONE,error:null,viewModel:null},manageMembershipView:{loadingState:h.NONE,error:null,viewModel:null},requestNarrativeView:{loadingState:h.NONE,error:null,viewModel:null},dashboardView:{loadingState:h.NONE,error:null,viewModel:null},viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}},auth:{status:m.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:v.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Feeds:{url:""},Auth:{url:""}},defaultPath:""}},updateOrg:{pending:!1}}}}]),e}(),xi=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"componentWillMount",value:function(){this.props.onLoad()}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}},{key:"render",value:function(){return this.props.children}}]),t}(N.Component);var Bi=Object(L.b)(function(e,t){return{}},function(e){return{onLoad:function(){e(Dr())},onUnload:function(){e({type:q.DATA_SERVICE_UNLOAD})}}})(xi),Wi=N.createContext(null),qi=Wi.Provider;Wi.Consumer;Qe.a.add(Je.c,Je.b,Je.a,Je.d);var Hi=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"link",value:function(e,t,r){if(this.options.sanitize){var n;try{n=decodeURIComponent(this.options.unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return r}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return r}var a='<a href="'+e+'"';return t&&(a+=' title="'+t+'"'),a+=' target="_blank">'+r+"</a>"}}]),t}(hr.Renderer);(new hr.MarkedOptions).renderer=new Hi,hr.Marked.setOptions({renderer:new Hi});var Fi=!!window.frameElement,Qi=Pi.makeInitialState(),Ji=Object(G.d)(Fe,Qi,Object(G.c)(Object(G.a)(P.a))),Yi=function(e){function t(e){return Object(y.a)(this,t),Object(M.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return I.a.createElement(qi,{value:{test:"ok"}},I.a.createElement(L.a,{store:Ji},I.a.createElement(Za,null,I.a.createElement(Wa,{hosted:Fi},I.a.createElement(Bi,null,I.a.createElement(z.a,{basename:"/"},I.a.createElement("div",{className:"App scrollable-flex-column"},I.a.createElement("div",{className:"App-body scrollable-flex-column"},I.a.createElement(k.a,null,I.a.createElement(V.a,{path:"/organizations",component:tr}),I.a.createElement(V.a,{path:"/newOrganization",component:Ar}),I.a.createElement(V.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return I.a.createElement(ga,{organizationId:t})}}),I.a.createElement(V.a,{path:"/editOrganization/:id",component:function(e){var t=e.match.params.id;return I.a.createElement(Da,{organizationId:t})}}),I.a.createElement(V.a,{path:"/manageOrganizationRequests/:id",component:function(e){var t=e.match.params.id;return I.a.createElement(ai,{organizationId:t})}}),I.a.createElement(V.a,{path:"/viewMembers/:id",component:function(e){var t=e.match.params.id;return I.a.createElement(pi,{organizationId:t})}}),I.a.createElement(V.a,{path:"/inviteUser/:id",component:function(e){var t=e.match.params.id;return I.a.createElement(Ni,{organizationId:t})}}),I.a.createElement(V.a,{path:"/membership/:id",component:function(e){var t=e.match.params.id;return I.a.createElement(ki,{organizationId:t})}}),I.a.createElement(V.a,{path:"/requestAddNarrative/:id",component:function(e){var t=e.match.params.id;return I.a.createElement(Gi,{organizationId:t})}}),I.a.createElement(j.a,{from:"/",to:"/organizations",exact:!0}))))))))))}}]),t}(N.Component);r(334),r(336),r(338);T.a.render(I.a.createElement(Yi,null),document.getElementById("root"))}},[[159,2,1]]]);
//# sourceMappingURL=main.48253bcf.chunk.js.map