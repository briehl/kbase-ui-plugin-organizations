{"version":3,"sources":["types/index.tsx","redux/actions/index.tsx","redux/reducers/addOrg.ts","redux/reducers/editOrg.ts","redux/reducers/viewOrg.ts","redux/reducers/searchOrgs.ts","redux/reducers/auth.ts","redux/reducers/app.ts","redux/reducers/index.tsx","components/Organizations.tsx","containers/Organizations.tsx","components/Header.tsx","components/OrganizationsBrowser.tsx","data/userProfile.ts","data/groups.tsx","data/workspace.ts","data/model.ts","redux/actions/viewOrg.ts","redux/actions/searchOrgs.ts","containers/OrganizationsBrowser.tsx","redux/actions/addOrg.ts","components/NewOrganization.tsx","containers/NewOrganization.tsx","components/ViewOrganization.tsx","containers/ViewOrganization.tsx","redux/actions/editOrg.ts","components/EditOrganization.tsx","containers/EditOrganization.tsx","components/Auth.tsx","data/auth.ts","redux/actions/auth.ts","containers/Auth.tsx","lib/windowChannel.ts","lib/IFrameSimulator.ts","lib/IFrameIntegration.ts","redux/actions/app.ts","components/KBaseIntegration.tsx","containers/KBaseIntegration.tsx","App.tsx","index.tsx"],"names":["UIErrorType","AuthState","EditOrgState","EditState","SaveState","ValidationState","FieldState","ViewOrgState","AppState","SortDirection","ActionFlag","reducer","state","action","type","ADD_ORG_START","Object","objectSpread","addOrg","saveState","SAVING","addOrgStart","ADD_ORG_SUCCESS","editState","UNEDITED","SAVED","addOrgSuccess","ADD_ORG_ERROR","SAVE_ERROR","error","addOrgError","ADD_ORG_EDIT_START","validationState","NONE","NEW","newOrganization","id","value","status","name","description","addOrgEditStart","ADD_ORG_EDIT_FINISH","addOrgEditFinish","ADD_ORG_UPDATE_NAME_SUCCESS","EDITED","EDITED_OK","addOrgUpdateNameSuccess","ADD_ORG_UPDATE_NAME_ERROR","EDITED_ERROR","addOrgUpdateNameError","ADD_ORG_UPDATE_ID_SUCCESS","addOrgUpdateIdSuccess","ADD_ORG_UPDATE_ID_ERROR","addOrgUpdateIdError","ADD_ORG_UPDATE_DESCRIPTION_SUCCESS","addOrgUpdateDescriptionSuccess","ADD_ORG_UPDATE_DESCRIPTION_ERROR","addOrgUpdateDescriptionError","ADD_ORG_EVALUATE_OK","VALID","addOrgEvaluateOk","ADD_ORG_EVALUATE_ERRORS","INVALID","addOrgEvaluateErrors","EDIT_ORG_START","editOrg","FETCHING","editOrgStart","EDIT_ORG_SUCCESS","READY","editedOrganization","organization","editOrgSuccess","EDIT_ORG_ERROR","ERROR","editOrgError","EDIT_ORG_UPDATE_NAME_SUCCESS","console","log","updateNameSuccess","EDIT_ORG_UPDATE_NAME_ERROR","updateNameError","EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS","updateDescriptionSuccess","EDIT_ORG_UPDATE_DESCRIPTION_ERROR","updateDescriptionError","VIEW_ORG_FETCH_START","viewOrg","types","viewOrgStart","VIEW_ORG_FETCH_SUCCESS","viewOrgSuccess","VIEW_ORG_FETCH_ERROR","viewOrgError","VIEW_ORG_STOP","viewOrgStop","SEARCH_ORGS_START","searchTerms","filter","sortBy","sortDirection","auth","authorization","username","searching","searchOrgsStart","SEARCH_ORGS_SUCCESS","organizations","totalCount","filteredCount","length","searchOrgsSuccess","SEARCH_ORGS_ERROR","searchOrgsError","SORT_ORGS_START","sortOrgsStart","FILTER_ORGS_START","filterOrgsStart","AUTH_CHECK_START","CHECKING","token","realname","roles","authCheckStart","AUTH_AUTHORIZED","AUTHORIZED","authAuthorized","AUTH_UNAUTHORIZED","UNAUTHORIZED","authUnauthorized","AUTH_CHECK_ERROR","authCheckError","APP_SUCCESS","app","config","appSuccess","addOrgReducer","editOrgReducer","searchOrgsReducer","viewOrgReducer","authReducer","appReducer","Organizations","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","org","index","react","className","key","String","NavLink","to","concat","href","target","owner","_this2","map","renderOrg","renderOrgs","React","connect","Header","children","fa","style","verticalAlign","marginLeft","marginRight","title","flex","display","flexDirection","alignItems","buildSeparator","OrganizationsBrowser","searchInput","searchButton","onSearchOrgs","current","split","currentSearchInputValue","setState","e","preventDefault","doSearch","onSortOrgs","onFilterOrgs","onSearchInputChange","renderSortArea2","renderFilterArea2","group_default","a","onChange","onSortByChange","bind","es_radio","marginTop","onSortDirectionChange","ASCENDING","icon","DESCENDING","onFilterChange","onSubmit","placeholder","autoFocus","ref","tooltip","theme","alignSelf","es_button","disabled","haveSearchInput","form","htmlType","renderSearchIcon","onClick","onClearSearch","renderSearchFeedback","src_components_Header","justifyContent","renderHeader","renderSearchBar","renderControlArea","containers_Organizations","UserProfileClient","_ref","url","createClass","method","param","version","Math","random","slice","params","fetch","mode","cache","headers","Authorization","Content-Type","Accept","body","JSON","stringify","makeEmptyPayload","then","response","Error","statusText","json","info","makePayload","result","usernames","GroupsClient","_ref2","newGroup","WorkspaceClient","Model","group","profile","createdate","moddate","user","createdAt","Date","modifiedAt","groups","profiles","briefGroupToBriefOrg","get","query","groupsServiceURL","userProfileClient","userProfileServiceURL","workspaceServiceURL","getGroups","owners","reduce","set","Map","keys","getUserProfiles","Array","from","profileMap","groupsToOrgs","orgs","direction","sort","b","localeCompare","warn","applySort","searchTermsRe","term","RegExp","every","termRe","test","applyOrgSearch","applyFilter","total","getGroupById","getUserProfile","userProfile","Promise","reject","newOrg","_this3","createGroup","groupToOrg","orgUpdate","_this4","resolve","timeout","window","setTimeout","getOrg","Validation","validateOrgId","validateOrgName","validateOrgDescription","message","match","viewOrgFetch","dispatch","getState","_getState","services","Groups","UserProfile","Workspace","catch","err","code","searchOrgs","_getState$auth$author","queryOrgs","sortOrgs","_getState2","_getState2$auth$autho","filterOrgs","_getState3","_getState3$auth$autho","_ref3","actions","AddOrgEvaluateErrors","addOrgEdit","addOrgEvaluate","model","addOrgUpdateName","_Validation$validateO","_Validation$validateO2","slicedToArray","validatedName","addOrgUpdateId","_Validation$validateO3","_Validation$validateO4","validatedId","newModelFromState","getGroup","addOrgUpdateDescription","_getState4","_model$validateOrgDes","_model$validateOrgDes2","validatedDescription","NewOrganization","canceling","origin","document","location","onAddOrgEdit","onAddOrg","persist","onUpdateName","onUpdateDescription","onUpdateId","onNameChange","color","onIdChange","minHeight","maxHeight","onDescriptionChange","fontStyle","dangerouslySetInnerHTML","__html","marked","_this$props","label","orgName","canSave","onClickCancel","Redirect","push","renderForm","renderPreview","renderLoadingHeader","_ref$addOrg","ViewOrganization","onViewOrg","renderEditRow","textAlign","Intl","DateTimeFormat","format","renderEditButton","renderInfo","_ref$viewOrg","editOrgSaveError","EDIT_ORG_SAVE_ERROR","editableOrg","editOrgUpdateName","_model$validateOrgNam","_model$validateOrgNam2","editOrgUpdateNameSuccess","editOrgUpdateNameError","editOrgUpdateDescription","orgDescription","editOrgUpdateDescriptionSuccess","editOrgUpdateDescriptionError","editOrgSave","EDIT_ORG_SAVE_START","organizationUpdate","updateOrg","EDIT_ORG_SAVE_SUCCESS","editOrgSaveSuccess","EditOrganization","onEditOrg","onUpdateOrg","readOnly","_ref$editOrg","Auth","tokenRef","checkAuth","onRemoveAuthorization","onAddAuthorization","onLoginClick","onLogoutClick","authStatus","buildAuthToolbar","buildAuthForm","env","buildAuthDev","buildAuthProd2","endpoints","AuthClient","path","join","makePath","Cookies","all","getTokenInfo","getMe","account","desc","_state$auth","_ref4","_ref5","_ref6","Listener","onSuccess","onError","WaitingListener","started","Message","payload","channel","uuidv4","created","envelope","Channel","host","channelId","awaitingResponse","waitingListeners","listeners","lastId","sentCount","receivedCount","unwelcomeReceivedCount","unwelcomeReceivedCountThreshhold","unwelcomeReceiptWarning","unwelcomeReceiptWarningCount","currentListener","messageEvent","data","has","delete","handler","ex","awaiting","forEach","listener","messageId","success","listen","postMessage","getMessage","sendMessage","sendRequest","now","getTime","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_loop","elapsed","_iterator","entries","Symbol","iterator","next","done","return","size","startMonitor","listenOnce","sent","received","_this5","receiveMessage","addEventListener","removeEventListener","IFrameSimulator","frameId","uuid","parentHost","IFrameIntegration","frameElement","hasAttribute","getAttribute","parse","decodeURIComponent","KBaseIntegration","onAppStart","iframeParams","getParamsFromIFrame","baseUrl","fakeIframeParams","library","add","faSpinner","faSearch","initialState","rawOrganizations","selectedOrganizationId","pending","store","createStore","theReducer","compose","applyMiddleware","thunk","App","react_default","createElement","es","containers_Auth","containers_KBaseIntegration","HashRouter","basename","Route","component","containers_ViewOrganization","containers_EditOrganization","exact","Component","ReactDOM","render","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.98dace3e.chunk.js","sourcesContent":["import { ViewOrganizationState } from \"../components/ViewOrganization\";\nimport { types } from \"util\";\n\n/* Types from the organization service (approximately) */\n\n/*\n    Organization\n*/\n\nexport interface OrganizationUpdate {\n    name: string\n    description: string\n}\n\nexport enum UIErrorType {\n    NONE = 0,\n    INFO,\n    WARNING,\n    ERROR\n}\n\nexport interface UIError {\n    type: UIErrorType,\n    message?: string\n}\n\nexport interface NewOrganization {\n    id: {\n        value: string,\n        status: FieldState,\n        error: UIError\n    }\n    name: {\n        value: string,\n        status: FieldState,\n        error: UIError\n    }\n    description: {\n        value: string,\n        status: FieldState,\n        error: UIError\n    }\n}\n\nexport interface BriefOrganization {\n    id: string\n    name: string\n    owner: {\n        username: string,\n        realname: string\n    }\n    createdAt: Date\n    modifiedAt: Date\n}\n\nexport interface Organization {\n    id: string\n    name: string\n    description: string\n    owner: {\n        username: string,\n        realname: string\n    }\n    createdAt: Date\n    modifiedAt: Date\n}\n\nexport interface EditedOrganization {\n    id: {\n        value: string,\n        error?: UIError\n    }\n    name: {\n        value: string,\n        error?: UIError\n    }\n    description: {\n        value: string,\n        error?: UIError\n    }\n}\n\n/*\n    Collection of organizations\n*/\n\nexport type Organizations = Array<Organization>\n\n\n/* REDUX */\n\nexport enum AuthState {\n    NONE = 0,\n    CHECKING,\n    AUTHORIZED,\n    UNAUTHORIZED,\n    ERROR\n}\n\nexport interface UserAuthorization {\n    token: string,\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\nexport interface Authorization {\n    status: AuthState\n    authorization: UserAuthorization\n}\n\n// export enum Filter {\n//     All = 1,\n//     Yours\n// }\n\n\nexport enum EditOrgState {\n    NONE = 0,\n    FETCHING,\n    READY,\n    EDITING_CAN_SAVE,\n    EDITING_ERRORS,\n    SAVING,\n    SAVED,\n    ERROR\n}\n\n// export enum AddOrgState {\n//     NONE = 0,\n//     READY,\n//     UNEDITED_OK,\n//     UNEDITED_\n//     EDITED_OK,\n//     EDITED_ERRORS,\n//     SAVING,\n//     SAVED,\n//     ERROR\n// }\n\nexport enum EditState {\n    NONE = 'NONE',\n    UNEDITED = 'UNEDITED',\n    EDITED = 'EDITED'\n}\n\n// TODO: or CLEAN to replace new and saved\nexport enum SaveState {\n    NONE = 'NONE',\n    NEW = 'NEW',\n    READY = 'READY',\n    SAVING = 'SAVING',\n    SAVED = 'SAVED',\n    SAVE_ERROR = 'SAVE_ERROR'\n}\n\nexport enum ValidationState {\n    NONE = 'NONE',\n    VALID = 'VALID',\n    INVALID = 'INVALID'\n}\n\nexport enum FieldState {\n    NONE = 0,\n    UNEDITED_OK,\n    UNEDITED_ERROR,\n    EDITED_OK,\n    EDITED_ERROR,\n    EDITED_WARNING\n}\n\nexport enum ViewOrgState {\n    NONE = 0,\n    INITIAL,\n    FETCHING,\n    READY,\n    ERROR\n}\n\nexport enum AppState {\n    NONE = 0,\n    LOADING,\n    READY,\n    ERROR\n}\n\nexport enum SortDirection {\n    ASCENDING = 'asc',\n    DESCENDING = 'desc'\n}\n\n\nexport interface StoreState {\n    rawOrganizations: Array<BriefOrganization>\n    organizations: Array<BriefOrganization>\n    totalCount: number\n    filteredCount: number\n    sortBy: string\n    sortDirection: SortDirection\n    filter: string\n    searchTerms: Array<string>\n    selectedOrganizationId: string | null\n    auth: Authorization\n    error: AppError | null\n    searching: boolean\n    app: {\n        status: AppState,\n        config: AppConfig,\n        error?: AppError\n    },\n    addOrg: {\n        editState: EditState,\n        saveState: SaveState,\n        validationState: ValidationState,\n        newOrganization: NewOrganization\n        error?: AppError\n    }\n    updateOrg: {\n        pending: boolean\n    }\n    viewOrg: {\n        state: ViewOrgState\n        organization?: Organization\n        error?: AppError\n    }\n    editOrg: {\n        state: EditOrgState\n        error?: AppError\n        editedOrganization?: EditedOrganization\n    }\n}\n\n/* COMPONENT PROPS */\nexport interface OrganizationsProps {\n    organizations: Array<BriefOrganization>\n}\n\nexport interface OrganizationsState {\n    searchTerms: Array<string>\n}\n\nexport interface OrganizationsBrowserProps {\n    onSearchOrgs: (searchTerms: Array<string>) => void;\n    onSortOrgs: (sortBy: string, sortDirection: SortDirection) => void;\n    onFilterOrgs: (filter: string) => void;\n    totalCount: number;\n    filteredCount: number;\n    sortBy: string;\n    sortDirection: SortDirection;\n    filter: string;\n    searching: boolean;\n}\n\nexport interface OrganizationsBrowserState {\n    searchInput: string\n}\n\n// ADD ORG\n\nexport interface NewOrganizationProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    newOrganization: NewOrganization,\n    onAddOrgEdit: () => void,\n    onAddOrg: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nexport interface ViewOrganizationProps {\n    state: ViewOrgState\n    id: string,\n    organization?: Organization\n    error?: AppError\n    username: string,\n    onViewOrg: (id: string) => void\n}\n\nexport interface EditOrganizationProps {\n    id: string,\n    state: EditOrgState\n    organization?: Organization\n    editedOrganization?: EditedOrganization\n    error?: AppError\n    onEditOrg: (id: string) => void\n    onUpdateOrg: () => void\n    onUpdateName: (name: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\n\nexport interface AppError {\n    code: string,\n    message: string\n}\n\nexport interface AppConfig {\n    baseUrl: string,\n    services: {\n        Groups: {\n            url: string\n        },\n        UserProfile: {\n            url: string\n        },\n        Workspace: {\n            url: string\n        }\n    }\n}\n\nexport interface AuthProps {\n    authStatus: AuthState,\n    token: string | null,\n    username: string | null,\n    realname: string | null,\n    env: string,\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nexport interface KBaseIntegrationProps {\n    status: AppState,\n    onAppStart: () => void\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport * as types from '../../types';\nimport { Model } from '../../data/model'\n\nexport enum ActionFlag {\n    APP = 1,\n    APP_START,\n    APP_SUCCESS,\n    // APP_SUCCESS_IFRAME,\n    // APP_SUCCESS_SOLO,\n    APP_ERROR,\n\n    SORT_ORGS,\n    SORT_ORGS_START,\n\n    FILTER_ORGS,\n    FILTER_ORGS_START,\n\n    SEARCH_ORGS,\n    SEARCH_ORGS_START,\n    SEARCH_ORGS_SUCCESS,\n    SEARCH_ORGS_ERROR,\n\n    UPDATE_ORG,\n    UPDATE_ORG_START,\n    UPDATE_ORG_SUCCESS,\n    UPDATE_ORG_ERROR,\n\n    // viewing org\n    VIEW_ORG_FETCH,\n    VIEW_ORG_FETCH_START,\n    VIEW_ORG_FETCH_SUCCESS,\n    VIEW_ORG_FETCH_ERROR,\n    VIEW_ORG_STOP,\n    // editing org\n    EDIT_ORG,\n    EDIT_ORG_START,\n    EDIT_ORG_SUCCESS,\n    EDIT_ORG_ERROR,\n    EDIT_ORG_SAVE,\n    EDIT_ORG_SAVE_START,\n    EDIT_ORG_SAVE_SUCCESS,\n    EDIT_ORG_SAVE_ERROR,\n    // edit org, field level updates\n    EDIT_ORG_UPDATE_NAME,\n    EDIT_ORG_UPDATE_NAME_SUCCESS,\n    EDIT_ORG_UPDATE_NAME_ERROR,\n    EDIT_ORG_UPDATE_DESCRIPTION,\n    EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    // add org fields\n    ADD_ORG_EDIT,\n    ADD_ORG_EDIT_START,\n    ADD_ORG_EDIT_FINISH,\n\n    ADD_ORG_UPDATE_NAME,\n    ADD_ORG_UPDATE_NAME_SUCCESS,\n    ADD_ORG_UPDATE_NAME_ERROR,\n    ADD_ORG_UPDATE_ID,\n    ADD_ORG_UPDATE_ID_SUCCESS,\n    ADD_ORG_UPDATE_ID_ERROR,\n    ADD_ORG_UPDATE_DESCRIPTION,\n    ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n    ADD_ORG_EVALUATE,\n    ADD_ORG_EVALUATE_OK,\n    ADD_ORG_EVALUATE_ERRORS,\n\n    ADD_ORG,\n    ADD_ORG_START,\n    ADD_ORG_SUCCESS,\n    ADD_ORG_ERROR,\n\n    // Auth\n    AUTH_CHECK,\n    AUTH_CHECK_START,\n    AUTH_CHECK_ERROR,\n    AUTH_AUTHORIZED,\n    AUTH_UNAUTHORIZED,\n    AUTH_REMOVE_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION\n}\n\n\n// // Update an org\n\n// // export interface UpdateOrg  extends Action {\n// //     type: ActionFlag.UPDATE_ORG,\n// //     orgUpdate: types.OrganizationUpdate\n// // }\n\n// // export function updateOrg(orgUpdate: types.OrganizationUpdate) : UpdateOrg {\n// //     return {\n// //         type: ActionFlag.UPDATE_ORG,\n// //         orgUpdate: orgUpdate\n// //     }\n// // }\n\n\n// export interface UpdateOrgStart extends Action {\n//     type: ActionFlag.UPDATE_ORG_START\n// }\n\n// export function updateOrgStart(): UpdateOrgStart {\n//     return {\n//         type: ActionFlag.UPDATE_ORG_START\n//     }\n// }\n\n// export interface UpdateOrgSuccess extends Action {\n//     type: ActionFlag.UPDATE_ORG_SUCCESS,\n//     organization: types.Organization\n// }\n\n// export function updateOrgSuccess(org: types.Organization): UpdateOrgSuccess {\n//     return {\n//         type: ActionFlag.UPDATE_ORG_SUCCESS,\n//         organization: org\n//     }\n// }\n\n// export interface UpdateOrgError extends Action {\n//     type: ActionFlag.UPDATE_ORG_ERROR,\n//     error: types.AppError\n// }\n// export function updateOrgError(error: types.AppError): UpdateOrgError {\n//     return {\n//         type: ActionFlag.UPDATE_ORG_ERROR,\n//         error: error\n//     }\n// }\n\n\n// // export interface UpdateOrg extends Action {\n// //     type: ActionFlag.UPDATE_ORG,\n// //     orgUpdate: types.OrganizationUpdate\n// // }\n\n// // export function updateOrg(orgUpdate: types.OrganizationUpdate) {\n// //     return (dispatch: ThunkDispatch<types.StoreState, void, Action>, getState : () => types.StoreState)  => {\n// //         dispatch(updateOrgStart())\n\n// //         const {auth: {token}} = getState()\n// //         const model = new Model({token})\n\n// //         return model.updateOrg(orgUpdate)\n// //             .then((org: types.Organization) => {\n// //                 // TODO: also total.\n// //                 dispatch(updateOrgSuccess(org))\n// //             })\n// //             .catch((error) => {\n// //                 dispatch(updateOrgError({\n// //                     code: error.name,\n// //                     message: error.message\n// //                 }))\n// //             })\n// //     }\n// // }\n\n\n\n// // org name update\n\n// export interface UpdateName extends Action {\n//     type: ActionFlag.EDIT_ORG_UPDATE_NAME,\n//     name: string\n// }\n\n// export interface UpdateNameSuccess extends Action {\n//     type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n//     name: string\n// }\n\n// export function updateNameSuccess(name: string): UpdateNameSuccess {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n//         name: name\n//     }\n// }\n\n// // export class UpdateNameSuccess {\n// //     static type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS = ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS\n// //     static createAction(name: string) {\n// //         return {\n// //             type: this.type,\n// //             name: name\n// //         }\n// //     }\n// //     static reducer(state: types.StoreState,\n// //                    action: actions.UpdateNameSuccess): types.StoreState {\n// //             // just brute force it ... destructuring would be brutal.\n// //             const newState = {...state}\n// //             newState.editOrg.editedOrganization = {...state.editOrg.editedOrganization!, name: action.name}\n// //             console.log('here2!', action.name, newState)\n// //             return newState\n// //         }\n// //     }\n\n// // }\n\n// export interface UpdateNameError extends Action {\n//     type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n//     error: types.AppError\n// }\n\n// export function updateNameError(error: types.AppError): UpdateNameError {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n//         error: error\n//     }\n// }\n\n// export function updateName(name: string) {\n//     return (dispatch: ThunkDispatch<types.StoreState, void, Action>,\n//         getState: () => types.StoreState) => {\n//         // validate the name\n\n//         let errorMessage;\n\n//         if (name.length === 0) {\n//             errorMessage = 'The organization name may not be empty'\n//         }\n\n//         if (errorMessage) {\n//             dispatch(updateNameError({\n//                 code: 'invalid',\n//                 message: errorMessage\n//             }))\n//         } else {\n//             dispatch(updateNameSuccess(name))\n//         }\n//     }\n// }\n\n","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, UIErrorType, FieldState, ValidationState } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    AddOrgEditStart, AddOrgEditFinish,\n    AddOrgUpdateNameSuccess, AddOrgUpdateNameError,\n    AddOrgUpdateIdSuccess, AddOrgUpdateIdError,\n    AddOrgUpdateDescriptionSuccess, AddOrgUpdateDescriptionError,\n    AddOrgError, AddOrgStart, AddOrgSuccess, AddOrgEvaluateOK, AddOrgEvaluateErrors\n} from '../actions/addOrg'\n\n// ADD ORG\n\nexport function addOrgStart(state: StoreState, action: AddOrgStart): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            saveState: SaveState.SAVING\n        }\n    }\n}\n\nexport function addOrgSuccess(state: StoreState, action: AddOrgSuccess): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            editState: EditState.UNEDITED,\n            saveState: SaveState.SAVED\n        }\n    }\n}\n\nexport function addOrgError(state: StoreState, action: AddOrgError): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            saveState: SaveState.SAVE_ERROR,\n            error: action.error\n        }\n    }\n}\n\nexport function addOrgEvaluateOk(state: StoreState, action: AddOrgEvaluateOK): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            validationState: ValidationState.VALID\n        }\n    }\n}\n\nexport function addOrgEvaluateErrors(state: StoreState, action: AddOrgEvaluateErrors): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            validationState: ValidationState.INVALID\n        }\n    }\n}\n\nexport function addOrgEditStart(state: StoreState, action: AddOrgEditStart) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.UNEDITED,\n            validationState: ValidationState.NONE,\n            saveState: SaveState.NEW,\n            newOrganization: {\n                id: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                name: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                description: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEditFinish(state: StoreState, action: AddOrgEditFinish) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.UNEDITED\n        }\n    }\n}\n\n// Name\nexport function addOrgUpdateNameSuccess(state: StoreState, action: AddOrgUpdateNameSuccess) {\n    // console.log('hmm', EditState.EDITED)\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                name: {\n                    value: action.name,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateNameError(state: StoreState, action: AddOrgUpdateNameError) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                name: {\n                    value: action.name,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\n// Id\n\nexport function addOrgUpdateIdSuccess(state: StoreState, action: AddOrgUpdateIdSuccess) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                id: {\n                    value: action.id,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateIdError(state: StoreState, action: AddOrgUpdateIdError) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                id: {\n                    value: action.id,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateDescriptionSuccess(state: StoreState, action: AddOrgUpdateDescriptionSuccess) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                description: {\n                    value: action.description,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateDescriptionError(state: StoreState, action: AddOrgUpdateDescriptionError) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                description: {\n                    value: action.description,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.ADD_ORG_START:\n            return addOrgStart(state, action as AddOrgStart)\n        case ActionFlag.ADD_ORG_SUCCESS:\n            return addOrgSuccess(state, action as AddOrgSuccess)\n        case ActionFlag.ADD_ORG_ERROR:\n            return addOrgError(state, action as AddOrgError)\n        case ActionFlag.ADD_ORG_EDIT_START:\n            return addOrgEditStart(state, action as AddOrgEditStart)\n        case ActionFlag.ADD_ORG_EDIT_FINISH:\n            return addOrgEditFinish(state, action as AddOrgEditFinish)\n        case ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS:\n            return addOrgUpdateNameSuccess(state, action as AddOrgUpdateNameSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_NAME_ERROR:\n            return addOrgUpdateNameError(state, action as AddOrgUpdateNameError)\n        case ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS:\n            return addOrgUpdateIdSuccess(state, action as AddOrgUpdateIdSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_ID_ERROR:\n            return addOrgUpdateIdError(state, action as AddOrgUpdateIdError)\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return addOrgUpdateDescriptionSuccess(state, action as AddOrgUpdateDescriptionSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR:\n            return addOrgUpdateDescriptionError(state, action as AddOrgUpdateDescriptionError)\n        case ActionFlag.ADD_ORG_EVALUATE_OK:\n            return addOrgEvaluateOk(state, action as AddOrgEvaluateOK)\n        case ActionFlag.ADD_ORG_EVALUATE_ERRORS:\n            return addOrgEvaluateErrors(state, action as AddOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action, bindActionCreators } from 'redux'\nimport {\n    EditOrgStart, EditOrgSuccess, EditOrgError,\n    EditOrgUpdateNameSuccess, EditOrgUpdateNameError, EditOrgUpdateDescriptionSuccess, EditOrgUpdateDescriptionError, EditOrgSaveStart, EditOrgSaveSuccess, EditOrgSaveError\n} from '../actions/editOrg'\nimport { StoreState, EditOrgState } from '../../types'\nimport { ActionFlag } from '../actions'\n\nfunction editOrgStart(state: StoreState, action: EditOrgStart): StoreState {\n    return { ...state, editOrg: { state: EditOrgState.FETCHING } }\n}\n\nfunction editOrgSuccess(state: StoreState, action: EditOrgSuccess): StoreState {\n    return { ...state, editOrg: { state: EditOrgState.READY, editedOrganization: action.organization } }\n}\n\nfunction editOrgError(state: StoreState, action: EditOrgError): StoreState {\n    return { ...state, editOrg: { state: EditOrgState.ERROR, error: action.error } }\n}\n\n// saving\n\nfunction editOrgSaveStart(state: StoreState, action: EditOrgSaveStart): StoreState {\n    return {...state, editOrg: {...state.editOrg, state: EditOrgState.SAVING}}\n}\n\nfunction editOrgSaveSuccess(state: StoreState, action: EditOrgSaveSuccess): StoreState {\n    return {...state, editOrg: {...state.editOrg, state: EditOrgState.SAVED}}\n}\n\nfunction editOrgSaveError(state: StoreState, action: EditOrgSaveError): StoreState {\n    return {...state, editOrg: {...state.editOrg,\n                                state: EditOrgState.ERROR,\n                                error: action.error}}\n}\n\n// export function updateOrgStart(state: StoreState, action: actions.UpdateOrgStart): types.StoreState {\n//     return { ...state, updateOrg: { pending: true } }\n// }\n\n// export function updateOrgSuccess(state: types.StoreState, action: actions.UpdateOrgStart): types.StoreState {\n//     return { ...state, updateOrg: { pending: false, editedOrganization: action. } }\n// }\n\n// export function updateOrgError(state: types.StoreState, action: actions.UpdateOrgError): types.StoreState {\n//     return { ...state, error: action.error }\n// }\n\nfunction updateNameSuccess(state: StoreState, action: EditOrgUpdateNameSuccess): StoreState {\n    // just brute force it ... destructuring would be brutal.\n    console.log('success!', action.name)\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization!,\n                name: {\n                    value: action.name\n                }\n            }\n        }\n    }\n}\n\nfunction updateNameError(state: StoreState, action: EditOrgUpdateNameError): StoreState {\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization!,\n                name: {\n                    value: action.name,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nfunction updateDescriptionSuccess(state: StoreState, action: EditOrgUpdateDescriptionSuccess): StoreState {\n    // just brute force it ... destructuring would be brutal.\n    console.log('success!', action.description)\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization!,\n                description: {\n                    value: action.description\n                }\n            }\n        }\n    }\n}\n\nfunction updateDescriptionError(state: StoreState, action: EditOrgUpdateDescriptionError): StoreState {\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization!,\n                description: {\n                    value: action.description,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.EDIT_ORG_START:\n            return editOrgStart(state, action as EditOrgStart)\n        case ActionFlag.EDIT_ORG_SUCCESS:\n            return editOrgSuccess(state, action as EditOrgSuccess)\n        case ActionFlag.EDIT_ORG_ERROR:\n            return editOrgError(state, action as EditOrgError)\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS:\n            return updateNameSuccess(state, action as EditOrgUpdateNameSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR:\n            return updateNameError(state, action as EditOrgUpdateNameError)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return updateDescriptionSuccess(state, action as EditOrgUpdateDescriptionSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:\n            return updateDescriptionError(state, action as EditOrgUpdateDescriptionError)\n        default:\n            return null\n    }\n}\n\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/viewOrg'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport { Organizations, Organization } from '../../types'\nimport { Model } from '../../data/model'\n\n\nexport function viewOrgStart(state: types.StoreState,\n    action: actions.ViewOrgStart): types.StoreState {\n    return {\n        ...state,\n        viewOrg: { ...state.viewOrg, state: types.ViewOrgState.FETCHING }\n    }\n}\n\nexport function viewOrgSuccess(state: types.StoreState,\n    action: actions.ViewOrgSuccess): types.StoreState {\n    return {\n        ...state,\n        viewOrg: {\n            ...state.viewOrg,\n            state: types.ViewOrgState.READY,\n            organization: action.organization\n        }\n    }\n}\n\nexport function viewOrgError(state: types.StoreState,\n    action: actions.ViewOrgError): types.StoreState {\n    return {\n        ...state,\n        viewOrg: {\n            ...state.viewOrg,\n            state: types.ViewOrgState.ERROR,\n            error: action.error\n        }\n    }\n}\n\nexport function viewOrgStop(state: types.StoreState, action: actions.ViewOrgStop): types.StoreState {\n    return {\n        ...state,\n        viewOrg: {\n            state: types.ViewOrgState.NONE\n        }\n    }\n}\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_FETCH_START:\n            return viewOrgStart(state, action as actions.ViewOrgStart)\n        case ActionFlag.VIEW_ORG_FETCH_SUCCESS:\n            return viewOrgSuccess(state, action as actions.ViewOrgSuccess)\n        case ActionFlag.VIEW_ORG_FETCH_ERROR:\n            return viewOrgError(state, action as actions.ViewOrgError)\n        case ActionFlag.VIEW_ORG_STOP:\n            return viewOrgStop(state, action as actions.ViewOrgStop)\n        default:\n            return null\n    }\n}\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/searchOrgs'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport { Organizations, Organization } from '../../types'\nimport { Model } from '../../data/model'\n\nexport function applyOrgSearch(orgs: Organizations, searchTerms: Array<string>) {\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTerms.every((term) => {\n            // todo : make more efficient!!!\n            return (new RegExp(term, 'i').test(org.name));\n        })\n    })\n\n    return {\n        organizations: filteredOrgs,\n        totalCount: orgs.length,\n        filteredCount: filteredOrgs.length\n    }\n}\n\n// TODO:\n// dispatch the start of the request\n// do the request\n// dispatch the success (will be same for all queries?)\n// dispatch the error\n// FOR NOW:\n// do it here...\nexport function searchOrgsStart(state: types.StoreState, action: actions.SearchOrgsStart): types.StoreState {\n\n    const query: Query = {\n        searchTerms: action.searchTerms,\n        filter: state.filter,\n        sortBy: state.sortBy,\n        sortDirection: state.sortDirection,\n        username: state.auth.authorization.username\n    }\n    // const result = queryOrgs(state.rawOrganizations, query)\n\n    return {\n        ...state,\n        // organizations: result.organizations, \n        // totalCount: result.total, \n        // filteredCount: result.organizations.length,\n        searching: true,\n        searchTerms: action.searchTerms\n    }\n}\n\nexport function searchOrgsSuccess(state: types.StoreState, action: actions.SearchOrgsSuccess): types.StoreState {\n    return {\n        ...state,\n        searching: false,\n        organizations: action.organizations,\n        totalCount: action.totalCount,\n        filteredCount: action.organizations.length\n    }\n}\n\nexport function searchOrgsError(state: types.StoreState, action: actions.SearchOrgsError): types.StoreState {\n    return { ...state, error: action.error }\n}\n\n\nexport function sortOrgsStart(state: types.StoreState, action: actions.SortOrgsStart): types.StoreState {\n    const query: Query = {\n        searchTerms: state.searchTerms,\n        filter: state.filter,\n        sortBy: action.sortBy,\n        sortDirection: action.sortDirection,\n        username: state.auth.authorization.username\n    }\n    // const result = queryOrgs(state.rawOrganizations, query)\n\n    return {\n        ...state,\n        // organizations: result.organizations, \n        // totalCount: result.total, \n        // filteredCount: result.organizations.length,\n        searching: true,\n        sortBy: action.sortBy,\n        sortDirection: action.sortDirection\n    }\n}\n\n\ninterface Query {\n    searchTerms: Array<string>,\n    username: string,\n    sortBy: string,\n    sortDirection: types.SortDirection,\n    filter: string\n}\n\ninterface QueryResults {\n    organizations: Organizations,\n    total: number\n}\n\nexport function filterOrgsStart(state: types.StoreState,\n    action: actions.FilterOrgsStart): types.StoreState {\n    const { filter } = action\n\n    return {\n        ...state,\n        searching: true,\n        filter\n    }\n}\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.SEARCH_ORGS_START:\n            return searchOrgsStart(state, action as actions.SearchOrgsStart)\n        case ActionFlag.SEARCH_ORGS_SUCCESS:\n            return searchOrgsSuccess(state, action as actions.SearchOrgsSuccess)\n        case ActionFlag.SEARCH_ORGS_ERROR:\n            return searchOrgsError(state, action as actions.SearchOrgsError)\n        // case ActionFlag.SORT_ORGS_STAR:\n        //     return sortOrgs(state, action as actions.SortOrgs)\n        case ActionFlag.SORT_ORGS_START:\n            return sortOrgsStart(state, action as actions.SortOrgsStart)\n        case ActionFlag.FILTER_ORGS_START:\n            return filterOrgsStart(state, action as actions.FilterOrgsStart)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\n\nimport { ActionFlag } from '../actions'\nimport { StoreState, AuthState } from '../../types'\nimport { AuthCheckStart, AuthAuthorized, AuthUnauthorized, AuthCheckError } from '../actions/auth';\n\nexport function authCheckStart(state: StoreState, action: AuthCheckStart): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.CHECKING,\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authCheckError(state: StoreState, action: AuthCheckError): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.ERROR,\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authAuthorized(state: StoreState, action: AuthAuthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.AUTHORIZED,\n            authorization: {\n                token: action.token,\n                username: action.username,\n                realname: action.realname,\n                roles: action.roles\n            }\n        }\n    }\n}\n\nexport function authUnauthorized(state: StoreState, action: AuthUnauthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.UNAUTHORIZED,\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.AUTH_CHECK_START:\n            return authCheckStart(state, action as AuthCheckStart)\n        case ActionFlag.AUTH_AUTHORIZED:\n            return authAuthorized(state, action as AuthAuthorized)\n        case ActionFlag.AUTH_UNAUTHORIZED:\n            return authUnauthorized(state, action as AuthUnauthorized)\n        case ActionFlag.AUTH_CHECK_ERROR:\n            return authCheckError(state, action as AuthCheckError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { ActionFlag } from '../actions'\nimport { AppSuccess } from '../actions/app';\nimport { StoreState, AppState } from '../../types';\n\nexport function appSuccess(state: StoreState, action: AppSuccess): StoreState {\n    return {\n        ...state,\n        app: {\n            status: AppState.READY,\n            config: action.config\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.APP_SUCCESS:\n            return appSuccess(state, action as AppSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport { Organizations, Organization } from '../../types'\nimport { Model } from '../../data/model'\nimport addOrgReducer from './addOrg'\nimport editOrgReducer from './editOrg'\nimport viewOrgReducer from './viewOrg'\nimport searchOrgsReducer from './searchOrgs'\nimport authReducer from './auth'\nimport appReducer from './app'\n\n\nexport function reducer(state: types.StoreState, action: Action): types.StoreState {\n    return addOrgReducer(state, action) ||\n        editOrgReducer(state, action) ||\n        searchOrgsReducer(state, action) ||\n        viewOrgReducer(state, action) ||\n        authReducer(state, action) ||\n        appReducer(state, action) ||\n        state;\n}\n\nexport default reducer","import * as React from 'react';\nimport './Organizations.css';\nimport * as types from '../types';\nimport { NavLink } from 'react-router-dom';\n\n// TODO: need more ergonomic way to resolve the common issue of data types interfering with \n// component types.\n// import * as types from '../types';\n\n\n\nclass Organizations extends React.Component<types.OrganizationsProps, types.OrganizationsState> {\n\n    constructor(props: types.OrganizationsProps) {\n        super(props)\n\n        this.state = {\n            searchTerms: []\n        }\n    }\n\n    // <table className=\"Organizations-info-table\">\n    //                     <tbody>\n    //                         {/* <tr>\n    //                             <th>established</th>\n    //                             <td>{Intl.DateTimeFormat('en-US').format(org.createdAt)}</td>\n    //                         </tr> */}\n    //                         <tr>\n    //                             <th>owner</th>\n    //                             <td><a href=\"#people/{org.owner.username}\" target=\"_blank\">{org.owner.realname} ❨{org.owner.username}❩</a></td>\n    //                         </tr>\n    //                         {/* <tr>\n    //                             <th>last updated</th>\n    //                             <td>{Intl.DateTimeFormat('en-US').format(org.modifiedAt)}</td>\n    //                         </tr> */}\n    //                     </tbody>\n    //                 </table>\n\n    renderOrg(org: types.BriefOrganization, index: Number) {\n        return (\n            <div className=\"row\" key={String(index)}>\n                <div className=\"col1\">\n                    <div className=\"orgName\">\n                        <NavLink to={`/viewOrganization/${org.id}`}>{org.name}</NavLink>\n                    </div>\n                    <div className=\"orgOwner\">\n                        <span className=\"field-label\">owner</span>\n                        <a href=\"#people/{org.owner.username}\" target=\"_blank\">{org.owner.realname} ❨{org.owner.username}❩</a>\n                    </div>\n                </div>\n                <div className=\"col2\">\n\n                </div>\n            </div>\n        )\n    }\n\n    renderOrgs() {\n        if (this.props.organizations.length > 0) {\n            return (\n                this.props.organizations.map((org: types.BriefOrganization, index) => {\n                    return (\n                        this.renderOrg(org, index)\n                    )\n                })\n            )\n        } else {\n            return (\n                <div>Sorry, no orgs</div>\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Organizations\">\n                {this.renderOrgs()}\n            </div>\n        )\n    }\n}\n\nexport default Organizations;","import Organizations from '../components/Organizations';\nimport {StoreState, OrganizationsProps} from '../types';\nimport {connect} from 'react-redux';\n\nexport function mapStateToProps(state: StoreState): OrganizationsProps {\n    const {organizations} = state;\n    return {\n        organizations\n    }\n}\n\nexport default connect(mapStateToProps)(Organizations);","import * as React from 'react';\nimport { NavLink } from 'react-router-dom'\nimport './Header.css';\nimport { FaUsers, FaChevronRight } from 'react-icons/fa'\n\nexport interface HeaderProps {\n    title: string;\n}\n\nclass Header extends React.Component<HeaderProps, object> {\n\n    buildSeparator() {\n        if (this.props.children) {\n            return (\n                <FaChevronRight style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n            )\n        }\n    }\n\n    render() {\n        const { title } = this.props;\n\n        return (\n            <div className=\"Header\">\n                <div style={{ flex: '0 0 auto' }}>\n                    <NavLink to=\"/organizations\">\n                        <FaUsers style={{ verticalAlign: 'middle' }} />\n                        {' '}\n                        Orgs\n                    </NavLink>\n                </div>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    {this.buildSeparator()}\n                    {this.props.children}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Header;","import * as React from 'react';\nimport { NavLink } from 'react-router-dom'\n\nimport Organizations from '../containers/Organizations';\nimport * as types from '../types';\n\nimport './OrganizationsBrowser.css';\nimport { FaSearch, FaSpinner } from 'react-icons/fa'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { Button, Icon, Radio, Tooltip } from 'antd'\nimport Header from './Header';\nimport RadioGroup from 'antd/lib/radio/group';\nimport { RadioChangeEvent } from 'antd/lib/radio';\n\n\nclass OrganizationsBrowser extends React.Component<types.OrganizationsBrowserProps, types.OrganizationsBrowserState> {\n\n    searchInput: React.RefObject<HTMLInputElement>;\n    searchButton: React.RefObject<Button>;\n\n    constructor(props: types.OrganizationsBrowserProps) {\n        super(props)\n\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.state = {\n            searchInput: ''\n        }\n\n        this.props.onSearchOrgs([])\n    }\n\n    doSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        const searchTerms = this.searchInput.current.value.split(/[\\s+]/)\n        // dispatch the search event\n        this.props.onSearchOrgs(searchTerms);\n    }\n\n    haveSearchInput() {\n        if (this.state.searchInput && this.state.searchInput.length > 0) {\n            return true\n        }\n        return false\n    }\n\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.setState({ searchInput: currentSearchInputValue })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.doSearch()\n    }\n\n    onSortByChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(e.target.value, this.props.sortDirection)\n    }\n\n    onSortDirectionChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(this.props.sortBy, e.target.value)\n    }\n\n    onFilterChange(e: RadioChangeEvent) {\n        this.props.onFilterOrgs(e.target.value)\n    }\n\n    onClearSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        this.searchInput.current.value = ''\n        this.onSearchInputChange()\n        // this.searchButton.current!.handleClick(new MouseEvent<HTMLButtonElement>('click'))\n        // const event = new Event('change', { bubbles: true })\n        // this.searchInput.current.dispatchEvent(event)\n        this.doSearch()\n    }\n\n    renderControlArea() {\n        return (\n            <div className=\"OrganizationsBrowser-controlArea\">\n                {/* {this.renderSortArea()} */}\n                {this.renderSortArea2()}\n                {this.renderFilterArea2()}\n            </div>\n        )\n    }\n\n    renderSortArea2() {\n        return (\n            <div className=\"controlGroup\">\n                <div className=\"header\">\n                    sort\n                </div>\n                <RadioGroup onChange={this.onSortByChange.bind(this)} value={this.props.sortBy}>\n                    <Radio className=\"radio\" value=\"name\">Org name</Radio>\n                    <Radio className=\"radio\" value=\"owner\">Owner</Radio>\n                </RadioGroup>\n\n                <div style={{ marginTop: '10px' }}>\n                    <RadioGroup onChange={this.onSortDirectionChange.bind(this)} value={this.props.sortDirection}>\n                        <Radio className=\"radio\" value={types.SortDirection.ASCENDING}><Icon type=\"sort-ascending\" /> Ascending</Radio>\n                        <Radio className=\"radio\" value={types.SortDirection.DESCENDING}><Icon type=\"sort-descending\" /> Descending</Radio>\n                    </RadioGroup>\n                </div>\n            </div>\n        )\n    }\n\n    renderFilterArea2() {\n        return (\n            <div className=\"controlGroup\">\n                <div className=\"header\">\n                    filter\n                </div>\n                <RadioGroup onChange={this.onFilterChange.bind(this)} value={this.props.filter}>\n                    <Radio className=\"radio\" value=\"all\">All</Radio>\n                    <Radio className=\"radio\" value=\"owned\">Owned by you</Radio>\n                    <Radio className=\"radio\" value=\"notOwned\">Owned by others</Radio>\n                </RadioGroup>\n            </div>\n        )\n    }\n\n    renderSearchFeedback() {\n        if (this.props.totalCount === 0) {\n            return (\n                <span>\n                    No organizations in the system\n                </span>\n            )\n        }\n        if (this.props.filteredCount === 0) {\n            return (\n                <span>\n                    No organizations found out of\n                    {' '}\n                    {this.props.totalCount}\n                    {' '}\n                    available.\n                </span>\n            )\n\n        }\n        if (this.props.totalCount === this.props.filteredCount) {\n            return (\n                <span>\n                    Showing all\n                {' '}\n                    {this.props.totalCount}\n                    {' '}\n                    organizations\n                </span>\n            )\n        }\n\n        return (\n            <span>\n                Found\n                {' '}\n                {this.props.filteredCount}\n                {' '}\n                out of\n                {' '}\n                {this.props.totalCount}\n                {' '}\n                organizations\n            </span>\n        )\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchBar() {\n        return (\n            <form id=\"searchForm\" className=\"OrganizationsBrowser-searchBar\" onSubmit={this.onSubmit.bind(this)}>\n\n                <input\n                    placeholder=\"Search Organizations\"\n                    onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                    ref={this.searchInput}></input>\n                <Tooltip\n                    title=\"Enter one or more words to search organizations by name or owner\">\n                    <Icon type=\"info-circle\" theme=\"twoTone\" style={{ alignSelf: 'end' }} />\n                    {/* <Icon type=\"info\" style={{ alignSelf: 'end' }} /> */}\n                </Tooltip>\n                <Button\n                    disabled={!this.haveSearchInput()}\n                    ref={this.searchButton}\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                    Search\n                </Button>\n                <Button\n                    onClick={this.onClearSearch.bind(this)}\n                    disabled={!this.haveSearchInput()}\n                >\n                    Show all\n                </Button>\n                <div className=\"message\">\n                    {this.renderSearchFeedback()}\n                </div>\n            </form>\n        )\n    }\n\n    renderHeader() {\n        return (\n            <Header title=\"Organizations\">\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Browse and Search Organizations\n                            </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end' }}>\n                        <NavLink to=\"/newOrganization\"><Button icon=\"plus-circle\">Create Organization</Button></NavLink>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"OrganizationsBrowser\">\n                {this.renderHeader()}\n                <div className=\"searchBarRow\">\n                    <div className=\"col1\">\n                    </div>\n                    <div className=\"col2\">\n                        {this.renderSearchBar()}\n                    </div>\n                </div>\n                <div className=\"bodyRow\">\n                    <div className=\"col1\">\n                        {this.renderControlArea()}\n                    </div>\n                    <div className=\"col2\">\n                        <Organizations />\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default OrganizationsBrowser","\nexport interface User {\n    username: string,\n    realname: string,\n    thumbnail: string\n}\n\nexport interface UserProfile {\n    user: User,\n    profile: any\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport class UserProfileClient {\n    url: string;\n    token: string\n\n    constructor({ url, token }: { url: string, token: string }) {\n        this.url = url\n        this.token = token\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'UserProfile.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'UserProfile.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n    getVersion(): Promise<any> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makeEmptyPayload('version'))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((info) => {\n                console.log('info', info)\n            })\n    }\n\n    getUserProfile(username: string): Promise<UserProfile> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('get_user_profile', [username]))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0][0] as UserProfile\n            })\n    }\n\n    getUserProfiles(usernames: Array<string>): Promise<Array<UserProfile>> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('get_user_profile', usernames))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0] as Array<UserProfile>\n            })\n    }\n}","import { string } from \"prop-types\";\n\nexport interface GroupsServiceInfo {\n    servname: string;\n    version: string;\n    servertime: number;\n    gitcommithash: string\n}\n\nexport interface BriefGroup {\n    id: string;\n    name: string;\n    owner: string;\n    type: string;\n    // createdAt: number;\n    // modifiedAt: number\n}\n\nexport type GroupList = Array<BriefGroup>\n\nexport type Username = string;\n\nexport interface WorkspaceInfo {\n    wsid: number\n    name: string\n    narrname: string\n    public: boolean\n    admin: boolean\n}\n\nexport interface Group {\n    id: string\n    name: string\n    owner: Username\n    type: string\n    admins: Array<Username>\n    members: Array<Username>\n    description: string\n    createdate: number\n    moddate: number\n    workspaces: Array<WorkspaceInfo>\n}\n\nexport interface NewGroup {\n    id: string\n    name: string\n    type: string\n    description: string\n}\n\nexport interface Request {\n    id: string\n    groupid: string\n    requester: Username\n    type: string\n    status: string\n    targetuser: Username\n    targetws: number\n    createddate: number\n    expireddate: number\n    moddate: number\n}\n\nexport interface ErrorInfo {\n    appcode: number\n    apperror: string\n    callid: string\n    httpcode: number\n    httpstatus: string\n    message: string\n    time: number\n}\n\nexport interface ErrorResult {\n    error: ErrorInfo\n}\n\n// Error types: (appcode)\n// 10000\tAuthentication failed\n// 10010\tNo authentication token\n// 10020\tInvalid token\n// 20000\tUnauthorized\n// 30000\tMissing input parameter\n// 30001\tIllegal input parameter\n// 30010\tIllegal user name\n// 40000\tGroup already exists\n// 40010\tRequest already exists\n// 40020\tUser already group member\n// 40030\tWorkspace already in group\n// 50000\tNo such group\n// 50010\tNo such request\n// 50020\tNo such user\n// 50030\tNo such workspace\n// 60000\tUnsupported operation\n\nexport class GroupsClient {\n    token: string;\n    url: string;\n\n    constructor({ token, url }: { token: string, url: string }) {\n        this.token = token\n        this.url = url\n    }\n\n    getInfo(): Promise<GroupsServiceInfo> {\n        return fetch(this.url + '/', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json();\n            })\n            .then((result) => {\n                return result as GroupsServiceInfo;\n            });\n    }\n\n    getGroups(): Promise<GroupList> {\n        return fetch(this.url + '/group', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result: GroupList) => {\n                return result.filter(({ type }) => type === 'Organization')\n            })\n    }\n\n    getGroupById(id: string): Promise<Group> {\n        return fetch(this.url + '/group/' + id, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status === 404) {\n                    return null\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Group\n            })\n    }\n\n    createGroup(newGroup: NewGroup): Promise<Group> {\n        return fetch(this.url + '/group/' + newGroup.id, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n            body: JSON.stringify({\n                name: newGroup.name,\n                type: newGroup.type,\n                description: newGroup.description\n            })\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as Group\n            })\n    }\n}","\n// export interface User {\n//     username: string,\n//     realname: string,\n//     thumbnail: string\n// }\n\n// export interface UserProfile {\n//     user: User,\n//     profile: any\n// }\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport class WorkspaceClient {\n    url: string;\n    token: string\n\n    constructor({ url, token }: { url: string, token: string }) {\n        this.url = url\n        this.token = token\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'Workspace.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'Workspace.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n    getVersion(): Promise<any> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makeEmptyPayload('ver'))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    // getUserProfile(username: string): Promise<UserProfile> {\n    //     return fetch(this.url, {\n    //         method: 'POST',\n    //         mode: 'cors',\n    //         cache: 'no-store',\n    //         headers: {\n    //             Authorization: this.token,\n    //             'Content-Type': 'application/json',\n    //             Accept: 'application/json'\n    //         },\n    //         body: JSON.stringify(this.makePayload('get_user_profile', [username]))\n    //     })\n    //         .then((response) => {\n    //             if (response.status !== 200) {\n    //                 throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n    //             }\n    //             console.log('response...', response)\n    //             return response.json()\n    //         })\n    //         .then(([profile]) => {\n    //             return profile as UserProfile\n    //         })\n    // }\n}","import {\n    Organization, BriefOrganization, NewOrganization, OrganizationUpdate,\n    UIError,\n    UIErrorType,\n    SortDirection\n} from '../types';\n// import { organizations } from './data';\nimport { UserProfileClient, UserProfile } from './userProfile'\nimport { GroupsClient, Group, GroupList, BriefGroup } from './groups'\nimport { WorkspaceClient } from './workspace';\nimport { string } from 'prop-types';\n\nexport function applyOrgSearch(orgs: Array<BriefOrganization>, searchTerms: Array<string>): Array<BriefOrganization> {\n    const searchTermsRe = searchTerms.map((term) => {\n        return new RegExp(term, 'i')\n    })\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTermsRe.every((termRe) => {\n            return termRe.test(org.name) ||\n                termRe.test(org.owner.username) ||\n                termRe.test(org.owner.realname)\n        })\n    })\n\n    return filteredOrgs\n}\n\nfunction applySort(organizations: Array<BriefOrganization>, sortBy: string, sortDirection: SortDirection): Array<BriefOrganization> {\n    const direction = sortDirection === SortDirection.ASCENDING ? 1 : -1\n    switch (sortBy) {\n        // case 'createdAt':\n        //     return  organizations.slice().sort((a, b) => {\n        //         return direction * (a.createdAt.getTime() - b.createdAt.getTime())\n        //     })\n        // case 'modifiedAt':\n        //     return organizations.slice().sort((a, b) => {\n        //         return direction * (a.modifiedAt.getTime() - b.modifiedAt.getTime())\n        //     })\n        case 'name':\n            return organizations.slice().sort((a, b) => {\n                return direction * a.name.localeCompare(b.name)\n            })\n        case 'owner':\n            return organizations.slice().sort((a, b) => {\n                return direction * a.owner.username.localeCompare(b.owner.username)\n            })\n        default:\n            console.warn('unimplemented sort field: ' + sortBy)\n            return organizations;\n    }\n}\n\nfunction applyFilter(organizations: Array<BriefOrganization>, filter: string, username: string): Array<BriefOrganization> {\n    switch (filter) {\n        case 'all':\n            return organizations\n            break\n        case 'owned':\n            return organizations.filter((org) => (org.owner.username === username))\n        case 'notOwned':\n            return organizations.filter((org) => (org.owner.username !== username))\n        default:\n            console.warn('unknown filter : ' + filter)\n            return organizations\n    }\n}\n\nexport interface Query {\n    searchTerms: Array<string>\n    username: string\n    sortBy: string\n    sortDirection: SortDirection\n    filter: string\n}\n\nexport interface QueryResults {\n    organizations: Array<BriefOrganization>\n    total: number\n}\n\nfunction wait(timeout: number) {\n    return new Promise((resolve) => {\n        window.setTimeout(() => {\n            resolve(true)\n        }, timeout)\n    })\n}\n\n// export function newOrg(state: StoreState, action: actions.AddOrg): StoreState {\n//     const {organizations, auth:{username}} = state;\n//     const org: Organization = {\n//         ...action.newOrg,\n//         createdAt: new Date(),\n//         modifiedAt: new Date(),\n//         owner: username\n//     }\n//     organizations.push(org)\n//     return {...state, organizations}\n// }\n\ninterface ModelParams {\n    token: string,\n    groupsServiceURL: string,\n    userProfileServiceURL: string,\n    workspaceServiceURL: string\n}\n\nexport class Model {\n    // organizations: Organizations\n    // token: string\n    // groupsServiceURL: string\n    // userProfileServiceURL: string\n    // workspaceServiceURL: string\n    params: ModelParams\n\n\n    constructor(params: ModelParams) {\n        // this.organizations = organizations;\n        this.params = params;\n    }\n\n    groupToOrg(group: Group, profile: UserProfile): Organization {\n        const { id, name, owner, description, createdate, moddate } = group\n        return {\n            id: id,\n            name: name,\n            description: description,\n            owner: {\n                username: owner,\n                realname: profile.user.realname,\n            },\n            createdAt: new Date(createdate),\n            modifiedAt: new Date(moddate)\n        }\n    }\n\n    briefGroupToBriefOrg(group: BriefGroup, profile: UserProfile): BriefOrganization {\n        const { id, name, owner } = group\n        return { id, name, owner: { username: owner, realname: profile.user.realname }, createdAt: new Date(), modifiedAt: new Date() }\n    }\n\n    groupsToOrgs(groups: GroupList, profiles: Map<string, UserProfile>): Array<BriefOrganization> {\n        return groups.map((group) => {\n            return this.briefGroupToBriefOrg(group, profiles.get(group.owner)!)\n        })\n    }\n\n    queryOrgs(query: Query): Promise<QueryResults> {\n        const groups = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        const userProfileClient = new UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n        const workspaceClient = new WorkspaceClient({\n            url: this.params.workspaceServiceURL,\n            token: this.params.token\n        })\n        return groups.getGroups()\n            .then((groups) => {\n                // Add user profiles to groups.\n                // We do it here so that search can extend into user real names and possibly\n                // other user profile attributes \n                const owners = groups.reduce((owners, group) => {\n                    owners.set(group.owner, true)\n                    return owners;\n                }, new Map<string, boolean>()).keys()\n                return userProfileClient.getUserProfiles(Array.from(owners))\n                    .then((profiles) => {\n                        const profileMap = profiles.reduce((profileMap, profile) => {\n                            profileMap.set(profile.user.username, profile)\n                            return profileMap\n                        }, new Map<string, UserProfile>())\n                        return this.groupsToOrgs(groups, profileMap)\n                    })\n            })\n            .then((orgs) => {\n                const filtered = applyFilter(orgs, query.filter, query.username)\n                const searched = applyOrgSearch(filtered, query.searchTerms)\n                const sorted = applySort(searched, query.sortBy, query.sortDirection)\n\n                return {\n                    organizations: sorted,\n                    total: orgs.length\n                }\n            })\n    }\n\n    getOrg(id: string): Promise<Organization> {\n        const groups = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        const userProfileClient = new UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n        return groups.getGroupById(id)\n            .then((group) => {\n                return userProfileClient.getUserProfile(group.owner)\n                    .then((userProfile) => {\n                        return {\n                            id: group.id,\n                            name: group.name,\n                            description: group.description,\n                            createdAt: new Date(group.createdate),\n                            modifiedAt: new Date(group.moddate),\n                            owner: {\n                                username: group.owner,\n                                realname: userProfile.user.realname\n                            }\n                        }\n                    })\n\n            })\n    }\n\n    getGroup(id: string): Promise<Group> {\n        if (id.length === 0) {\n            return Promise.reject(new Error('Group id may not be an empty string'))\n        }\n        const groups = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groups.getGroupById(id)\n            .then((group) => {\n                return group\n            })\n    }\n\n    addOrg(newOrg: NewOrganization, username: string): Promise<Organization> {\n        const groups = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const userProfileClient = new UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n        if ((newOrg.id.error && newOrg.id.error.type === UIErrorType.ERROR) ||\n            (newOrg.name.error && newOrg.name.error.type === UIErrorType.ERROR) ||\n            (newOrg.description.error && newOrg.description.error.type === UIErrorType.ERROR)) {\n            return Promise.reject(new Error('One or more fields are invalid'))\n        }\n\n        return groups.createGroup({\n            id: newOrg.id.value,\n            name: newOrg.name.value,\n            description: newOrg.description.value,\n            type: 'Organization'\n        })\n            .then((group) => {\n                return userProfileClient.getUserProfile(group.owner)\n                    .then((userProfile) => {\n                        return this.groupToOrg(group, userProfile)\n                    })\n            })\n    }\n\n    // TODO this is fake until update is implemented on the back end\n    updateOrg(id: string, orgUpdate: OrganizationUpdate): Promise<Organization> {\n        return new Promise<Organization>((resolve) => {\n            return wait(200)\n                .then(() => {\n                    return this.getOrg(id)\n                })\n        })\n    }\n\n    validateOrgId(id: string): [string, UIError] {\n        return Validation.validateOrgId(id);\n    }\n\n    validateOrgName(name: string): [string, UIError] {\n        return Validation.validateOrgName(name)\n    }\n\n    validateOrgDescription(description: string): [string, UIError] {\n        return Validation.validateOrgDescription(description);\n    }\n}\n\nexport class Validation {\n    static validateOrgId(id: string): [string, UIError] {\n        // May not be empty\n        if (id.length === 0) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not be empty'\n                }]\n        }\n        // No spaces\n        if (id.match(/\\s/)) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not contain a space'\n                }]\n        }\n        // May not exceed maximum size\n        // todo: what is the real limit?\n        if (id.length > 100) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not be longer than 100 characters'\n                }]\n        }\n\n        // May not contain non-alphanumeric and underscore\n        const alphaRe = /^[a-zA-Z0-9_]+$/\n        if (!id.match(alphaRe)) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may only contain alphanumeric (a-z, A-Z, 0-9) and underscore (_)'\n                }\n            ]\n        }\n\n        return [id, {\n            type: UIErrorType.NONE\n        }]\n    }\n\n    static validateOrgName(name: string): [string, UIError] {\n        if (name.length === 0) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be empty'\n                }]\n        }\n        if (name.length > 256) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be longer than 256 characters'\n                }]\n        }\n        return [\n            name, {\n                type: UIErrorType.NONE\n            }]\n    }\n\n    static validateOrgDescription(name: string): [string, UIError] {\n        if (name.length === 0) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization description may not be empty'\n                }]\n        }\n        // TODO: Is there really a limit?\n        if (name.length > 4096) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be longer than 4,096 characters'\n                }]\n        }\n        return [\n            name, {\n                type: UIErrorType.NONE\n            }]\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState, Organization, EditedOrganization,\n    AppError, UIError, BriefOrganization, SortDirection\n} from '../../types'\nimport { Model } from '../../data/model'\n\n\n// VIEW ORG\n\nexport interface ViewOrgStart extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH_START\n}\n\nexport function viewOrgStart() {\n    return {\n        type: ActionFlag.VIEW_ORG_FETCH_START\n    }\n}\n\nexport interface ViewOrgStop extends Action {\n    type: ActionFlag.VIEW_ORG_STOP\n}\n\nexport function viewOrgStop(): ViewOrgStop {\n    return {\n        type: ActionFlag.VIEW_ORG_STOP\n    }\n}\n\nexport interface ViewOrgSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH_SUCCESS,\n    organization: Organization\n}\n\nexport function viewOrgSuccess(org: Organization): ViewOrgSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_FETCH_SUCCESS,\n        organization: org\n    }\n}\n\nexport interface ViewOrgError extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH_ERROR,\n    error: AppError\n}\nexport function viewOrgError(error: AppError): ViewOrgError {\n    return {\n        type: ActionFlag.VIEW_ORG_FETCH_ERROR,\n        error: error\n    }\n}\n\nexport interface ViewOrgFetch extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH,\n    id: string\n}\n\nexport function viewOrgFetch(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewOrgStart())\n\n        const { auth: { authorization: { token } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        return model.getOrg(id)\n            .then((org) => {\n                dispatch(viewOrgSuccess(org))\n            })\n            .catch((err) => {\n                dispatch(viewOrgError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n\n\nexport interface SortOrgs extends Action<ActionFlag.SORT_ORGS> {\n    type: ActionFlag.SORT_ORGS,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsStart extends Action<ActionFlag.SORT_ORGS_START> {\n    type: ActionFlag.SORT_ORGS_START,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport function sortOrgsStart(sortBy: string, sortDirection: SortDirection): SortOrgsStart {\n    return {\n        type: ActionFlag.SORT_ORGS_START,\n        sortBy: sortBy,\n        sortDirection: sortDirection\n    }\n}\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState, Organization, EditedOrganization,\n    AppError, UIError, BriefOrganization, SortDirection\n} from '../../types'\nimport { Model } from '../../data/model'\nimport { viewOrgStop } from './viewOrg'\n\n\nexport interface SortOrgs extends Action<ActionFlag.SORT_ORGS> {\n    type: ActionFlag.SORT_ORGS,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsStart extends Action<ActionFlag.SORT_ORGS_START> {\n    type: ActionFlag.SORT_ORGS_START,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport function sortOrgsStart(sortBy: string, sortDirection: SortDirection): SortOrgsStart {\n    return {\n        type: ActionFlag.SORT_ORGS_START,\n        sortBy: sortBy,\n        sortDirection: sortDirection\n    }\n}\n\n// SEARCH (FETCH) ORGS\n\n\n\n// Called upon the start of a search call\n// Sets the ui state to enable a spinner\n// and also search query data to be reflected in the ui\nexport interface SearchOrgsStart extends Action<ActionFlag.SEARCH_ORGS_START> {\n    type: ActionFlag.SEARCH_ORGS_START,\n    searchTerms: Array<string>\n}\n\nexport function searchOrgsStart(searchTerms: Array<string>): SearchOrgsStart {\n    return {\n        type: ActionFlag.SEARCH_ORGS_START,\n        searchTerms: searchTerms\n    }\n}\n\n// Called upon successful completion of a search\n// Sets the organizations found\nexport interface SearchOrgsSuccess extends Action<ActionFlag.SEARCH_ORGS_SUCCESS> {\n    type: ActionFlag.SEARCH_ORGS_SUCCESS,\n    organizations: Array<BriefOrganization>,\n    totalCount: number\n}\n\nexport function searchOrgsSuccess(organizations: Array<BriefOrganization>, totalCount: number): SearchOrgsSuccess {\n    return {\n        type: ActionFlag.SEARCH_ORGS_SUCCESS,\n        organizations: organizations,\n        totalCount: totalCount\n    }\n}\n\n// Called upon a search error\n// Sets error state\nexport interface SearchOrgsError extends Action<ActionFlag.SEARCH_ORGS_ERROR> {\n    type: ActionFlag.SEARCH_ORGS_ERROR,\n    error: AppError\n}\n\nexport function searchOrgsError(error: AppError): SearchOrgsError {\n    return {\n        type: ActionFlag.SEARCH_ORGS_ERROR,\n        error: error\n    }\n}\n\n\nexport interface SearchOrgs extends Action<ActionFlag.SEARCH_ORGS> {\n    type: ActionFlag.SEARCH_ORGS,\n    searchTerms: Array<string>\n}\n\n// TODO: proper typing here \nexport function searchOrgs(searchTerms: Array<string>) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchOrgsStart(searchTerms))\n        dispatch(viewOrgStop())\n\n        const { sortBy, sortDirection, filter,\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        return model.queryOrgs({\n            searchTerms: searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function sortOrgs(sortBy: string, sortDirection: SortDirection) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sortOrgsStart(sortBy, sortDirection))\n\n        const { searchTerms, filter,\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        return model.queryOrgs({\n            searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function filterOrgs(filter: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(filterOrgsStart(filter))\n\n        const { searchTerms, sortBy, sortDirection,\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        return model.queryOrgs({\n            searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\n\n\n\n// Filter orgs\nexport interface FilterOrgs extends Action<ActionFlag.FILTER_ORGS> {\n    type: ActionFlag.FILTER_ORGS,\n    filter: string\n}\n\nexport interface FilterOrgsStart extends Action<ActionFlag.FILTER_ORGS_START> {\n    type: ActionFlag.FILTER_ORGS_START,\n    filter: string\n}\n\nexport function filterOrgsStart(filter: string): FilterOrgsStart {\n    return {\n        type: ActionFlag.FILTER_ORGS_START,\n        filter: filter\n    }\n}\n\n","import OrganizationsBrowser from '../components/OrganizationsBrowser'\nimport { StoreState, SortDirection } from '../types'\nimport * as actions from '../redux/actions/searchOrgs'\nimport { Dispatch } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { connect } from 'react-redux'\nimport { Model, Query } from '../data/model'\n//\n// Typing for the mapState and mapDispatch\n//\nexport interface LinkStateProps {\n    totalCount: number,\n    filteredCount: number\n    sortBy: string,\n    sortDirection: SortDirection,\n    filter: string,\n    searching: boolean\n}\n\nexport interface LinkDispatchProps {\n    onSearchOrgs: (searchTerms: Array<string>) => void,\n    onSortOrgs: (sortBy: string, sortDirection: SortDirection) => void,\n    onFilterOrgs: (filter: string) => void\n}\n\n\n// note second arg is the component props, but we don't have any component props to merge in.\nexport function mapStateToProps({ totalCount, filteredCount, sortBy, sortDirection, filter, searching }: StoreState): LinkStateProps {\n    return {\n        totalCount,\n        filteredCount,\n        sortBy,\n        sortDirection,\n        filter,\n        searching\n    }\n}\n\n// function onSortOrgs(sortBy: string, sortDescending: boolean) : Dispatch<actions.SortOrgs> {\n//     dispatch(actions.sortOrgs(sortBy, sortDescending))\n// }\n\n// note second arg is the component props, but we don't have any to merge in.\n// export function mapDispatchToProps(dispatch: actions.SearchOrgs | Dispatch<actions.SortOrgs> | Dispatch<actions.FilterOrgs>) : LinkDispatchProps {\n//     return {\n//         onSearchOrgs: (searchTerms) => {\n\n//             dispatch(actions.searchOrgs(searchTerms))\n\n\n\n//         },\n//         onSortOrgs: (sortBy, sortDescending) => {\n//             dispatch(actions.sortOrgs(sortBy, sortDescending))\n//         },\n//         onFilterOrgs: (filter) => {\n//             dispatch(actions.filterOrgs(filter))\n//         }\n//     }\n// }\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.SearchOrgs | actions.SortOrgs | actions.FilterOrgs>): LinkDispatchProps {\n    return {\n        onSearchOrgs: (searchTerms: Array<string>) => {\n            // TODO proper typing here\n            dispatch(actions.searchOrgs(searchTerms) as any)\n        },\n        onSortOrgs: (sortBy: string, sortDirection: SortDirection) => {\n            // TODO proper typing here\n            dispatch(actions.sortOrgs(sortBy, sortDirection) as any)\n        },\n        onFilterOrgs: (filter: string) => {\n            dispatch(actions.filterOrgs(filter) as any)\n        }\n    }\n}\n\n// export function mapDispatchToProps(dispatch: Dispatch<any>) : LinkDispatchProps {\n//     return {\n//         onSearchOrgs: (searchTerms) => {\n//             dispatch(actions.searchOrgs(searchTerms))\n//         },\n//         onSortOrgs: (sortBy, sortDescending) => {\n//             dispatch(actions.sortOrgs(sortBy, sortDescending))\n//         }\n//     }\n// }\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OrganizationsBrowser)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, Organization, AppError, UIError, UIErrorType, FieldState } from '../../types'\nimport { Model, Validation } from '../../data/model'\n\n// ACTIONS\n\nexport interface AddOrg extends Action {\n    type: ActionFlag.ADD_ORG\n}\n\nexport interface AddOrgStart extends Action {\n    type: ActionFlag.ADD_ORG_START\n}\n\nexport interface AddOrgSuccess extends Action {\n    type: ActionFlag.ADD_ORG_SUCCESS,\n    organization: Organization\n}\n\nexport interface AddOrgError extends Action<ActionFlag.ADD_ORG_ERROR> {\n    type: ActionFlag.ADD_ORG_ERROR,\n    error: AppError\n}\n\n// Editing\n\nexport interface AddOrgEdit extends Action<ActionFlag.ADD_ORG_EDIT> {\n    type: ActionFlag.ADD_ORG_EDIT;\n}\n\nexport interface AddOrgEditStart {\n    type: ActionFlag.ADD_ORG_EDIT_START\n}\n\nexport interface AddOrgEditFinish {\n    type: ActionFlag.ADD_ORG_EDIT_FINISH\n}\n\n// Evaluating state of form \n\nexport interface AddOrgEvaluate extends Action<ActionFlag.ADD_ORG_EVALUATE> {\n    type: ActionFlag.ADD_ORG_EVALUATE\n}\n\nexport interface AddOrgEvaluateOK extends Action<ActionFlag.ADD_ORG_EVALUATE_OK> {\n    type: ActionFlag.ADD_ORG_EVALUATE_OK\n}\n\nexport interface AddOrgEvaluateErrors extends Action<ActionFlag.ADD_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n}\n\n// Updating name field\n\nexport interface AddOrgUpdateName extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface AddOrgUpdateNameSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface AddOrgUpdateNameError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: UIError\n}\n\n// Updating id Field\n\nexport interface AddOrgUpdateId extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID,\n    id: string\n}\n\nexport interface AddOrgUpdateIdSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n    id: string\n}\n\nexport interface AddOrgUpdateIdError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n    id: string,\n    error: UIError\n}\n\n// Updating description field\n\nexport interface AddOrgUpdateDescription extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface AddOrgUpdateDescriptionSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface AddOrgUpdateDescriptionError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: UIError\n}\n\n\n// ACTION CREATORS\n\nexport function addOrgStart(): AddOrgStart {\n    return {\n        type: ActionFlag.ADD_ORG_START\n    }\n}\n\nexport function addOrgSuccess(org: Organization): AddOrgSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_SUCCESS,\n        organization: org\n    }\n}\n\nexport function addOrgError(error: AppError): AddOrgError {\n    return {\n        type: ActionFlag.ADD_ORG_ERROR,\n        error: error\n    }\n}\n\nexport function addOrgEditStart() {\n    return {\n        type: ActionFlag.ADD_ORG_EDIT_START\n    }\n}\n\nexport function addOrgEditFinish() {\n    return {\n        type: ActionFlag.ADD_ORG_EDIT_FINISH\n    }\n}\n\n// Evaluate\n\nexport function addOrgEvaluateOk(): AddOrgEvaluateOK {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_OK\n    }\n}\n\nexport function AddOrgEvaluateErrors(): AddOrgEvaluateErrors {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Update Name\n\nexport function addOrgUpdateNameSuccess(name: string): AddOrgUpdateNameSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function addOrgUpdateNameError(name: string, error: UIError): AddOrgUpdateNameError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\nexport function addOrgUpdateIdSuccess(id: string): AddOrgUpdateIdSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n        id: id\n    }\n}\n\nexport function addOrgUpdateIdError(id: string, error: UIError): AddOrgUpdateIdError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n        id: id,\n        error: error\n    }\n}\n\nexport function addOrgUpdateDescriptionSuccess(description: string): AddOrgUpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function addOrgUpdateDescriptionError(description: string, error: UIError): AddOrgUpdateDescriptionError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function addOrgEdit() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(addOrgEditStart())\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrg() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(addOrgStart())\n\n        const { auth: { authorization: { token, username } },\n            addOrg: { newOrganization },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        if (!newOrganization) {\n            dispatch(addOrgError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        model.addOrg(newOrganization, username)\n            .then((org: Organization) => {\n                console.log('added', org)\n                dispatch(addOrgSuccess(org))\n            })\n            .catch((error) => {\n                console.error('error adding', newOrganization, error)\n                dispatch(addOrgError({\n                    code: 'invalid',\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function addOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const { addOrg: { newOrganization } } = getState()\n\n        const { addOrg: editState } = getState()\n\n        if (!newOrganization) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.name.status !== FieldState.EDITED_OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.id.status !== FieldState.EDITED_OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.description.status !== FieldState.EDITED_OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(addOrgEvaluateOk())\n    }\n}\n\nfunction newModelFromState(state: StoreState) {\n    const { auth: { authorization: { token } },\n        app: { config } } = state\n    return new Model({\n        token,\n        groupsServiceURL: config.services.Groups.url,\n        userProfileServiceURL: config.services.UserProfile.url,\n        workspaceServiceURL: config.services.Workspace.url\n    })\n}\n\nexport function addOrgUpdateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(addOrgUpdateNameError(validatedName, error))\n        } else {\n            dispatch(addOrgUpdateNameSuccess(validatedName))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrgUpdateId(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const [validatedId, error] = Validation.validateOrgId(id)\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(addOrgUpdateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n        const model = newModelFromState(getState())\n        model.getGroup(validatedId)\n            .then((org) => {\n                if (org) {\n                    console.log('org??', org)\n                    dispatch(addOrgUpdateIdError(validatedId, {\n                        type: UIErrorType.ERROR,\n                        message: 'This org id is already in use'\n                    }))\n                } else {\n                    dispatch(addOrgUpdateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function addOrgUpdateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>,\n        getState: () => StoreState) => {\n        const { auth: { authorization: { token } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n        const [validatedDescription, error] = model.validateOrgDescription(description)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(addOrgUpdateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(addOrgUpdateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}","import * as React from 'react'\nimport { Redirect } from 'react-router-dom';\nimport marked from 'marked';\n\nimport { NewOrganizationProps, SaveState, ValidationState, EditState } from '../types';\n\nimport './NewOrganization.css'\nimport { Button, Icon } from 'antd';\nimport Header from './Header';\n\nexport interface NewOrganizationState {\n    canceling: boolean;\n\n    // pendingOrganization: PendingOrganization\n}\n\nclass NewOrganization extends React.Component<NewOrganizationProps, NewOrganizationState> {\n\n    origin: string;\n\n    constructor(props: NewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            canceling: false\n        }\n\n        this.origin = document.location!.origin\n\n        this.props.onAddOrgEdit()\n    }\n\n    onClickCancel() {\n        this.setState({ canceling: true })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        console.log('submitted')\n        this.props.onAddOrg();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value);\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value);\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateId(e.target.value);\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState === ValidationState.VALID &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    renderForm() {\n        return (\n            <form id=\"newOrganizationForm\" className=\"editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">name</div>\n                    <div className=\"col2\">\n                        <input value={this.props.newOrganization.name.value || ''}\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.props.newOrganization.name.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.name.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">id</div>\n                    <div className=\"col2\">\n                        <input value={this.props.newOrganization.id.value || ''}\n                            onChange={this.onIdChange.bind(this)} />\n                        {this.props.newOrganization.id.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.id.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\" style={{ flex: '1 1 0px', minHeight: '30em', maxHeight: '60em' }}>\n                    <div className=\"col1 field-label\">description</div>\n                    <div className=\"col2\">\n                        <textarea value={this.props.newOrganization.description.value || ''}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.props.newOrganization.description.error ? (<div style={{ color: 'red' }}>{this.props.newOrganization.description.error.message}</div>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\"></div>\n                    <div className=\"col2\">\n                        {/* <div className=\"footer\">\n                            <Button form=\"newOrganizationForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\">Save</Button>\n                            <Button type=\"danger\"\n                                onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n                        </div> */}\n                    </div>\n                </div>\n            </form>\n        )\n    }\n\n    renderPreview() {\n        return <form className=\"preview\">\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"name\">\n                        {this.props.newOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"id\">\n                        <span style={{ color: 'silver' }}>{this.origin}/#orgs/organizations/</span>\n                        {this.props.newOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"description\"\n                        dangerouslySetInnerHTML={({ __html: marked(this.props.newOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        </form>\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    renderHeader() {\n        const orgName = this.props.newOrganization!.name.value || (<span style={{ fontStyle: 'italic', color: 'gray' }}>org name will appear here when you edit the name field</span>)\n        return (\n            <Header title=\"Organizations\">\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            {/* <FaPlusCircle style={{ verticalAlign: 'middle' }} /> */}\n                            <Icon type=\"plus-circle\" />\n                            {' '}\n                            Editing New Org \"\n                            {orgName}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        {/* {this.renderState()} */}\n                        <Button icon=\"save\"\n                            form=\"newOrganizationForm\"\n                            key=\"submit\"\n                            disabled={!this.canSave.call(this)}\n                            htmlType=\"submit\">\n                            {/* <Icon type=\"save\" /> */}\n                            {/* <FaSave style={{ verticalAlign: 'center' }} /> */}\n                            Save\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancel.bind(this)}>\n                            {/* <FaUndo style={{ verticalAlign: 'center' }} />  */}\n                            Return to Orgs\n                        </Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderFooter() {\n        return (\n            <div className=\"footerRow\">\n                <div className=\"editorColumn\">\n                    <div className=\"row\">\n                        <div className=\"col1\">\n                        </div>\n                        <div className=\"col2\">\n                            <div className=\"footer\">\n                                <Button form=\"newOrganizationForm\"\n                                    key=\"submit\"\n                                    htmlType=\"submit\">Save</Button>\n                                <Button type=\"danger\"\n                                    onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"previewColumn\">\n\n                </div>\n            </div>\n        )\n    }\n\n    renderLoadingHeader() {\n        return (\n            <Header title=\"Organizations\">\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Loading New Org Editor...\n                        </span>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    render() {\n        if (this.state.canceling) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (!this.props.newOrganization) {\n            return (\n                <div className=\"NewOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"NewOrganization\">\n                {this.renderHeader()}\n                <div className=\"mainRow\">\n                    <div className=\"editorColumn\">\n                        <h3>Editor</h3>\n                        {this.renderForm()}\n                    </div>\n                    <div className=\"previewColumn\">\n                        <h3>Preview</h3>\n                        {this.renderPreview()}\n                    </div>\n                </div>\n                {/* {this.renderFooter()} */}\n            </div>\n        )\n    }\n}\n\nexport default NewOrganization","import { Dispatch } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState } from '../types';\nimport {\n    AddOrg, addOrg,\n    addOrgUpdateName, addOrgUpdateId, addOrgUpdateDescription, addOrgEdit\n} from '../redux/actions/addOrg';\n\nimport NewOrganization from '../components/NewOrganization';\n\ninterface OwnProps {\n}\n\nexport interface StateProps {\n}\n\nexport interface DispatchProps {\n    onAddOrg: () => void,\n    onAddOrgEdit: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nexport function mapStateToProps({ addOrg: { editState, saveState, validationState, newOrganization } }: StoreState): StateProps {\n    return {\n        editState,\n        saveState,\n        validationState,\n        newOrganization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<AddOrg>): DispatchProps {\n    return {\n        onAddOrgEdit: () => {\n            dispatch(addOrgEdit() as any)\n        },\n        onAddOrg: () => {\n            dispatch(addOrg() as any)\n        },\n        onUpdateName: (name) => {\n            dispatch(addOrgUpdateName(name) as any)\n        },\n        onUpdateId: (id) => {\n            dispatch(addOrgUpdateId(id) as any)\n        },\n        onUpdateDescription: (description) => {\n            dispatch(addOrgUpdateDescription(description) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(NewOrganization)","import * as React from 'react'\nimport marked from 'marked'\nimport { NavLink } from 'react-router-dom'\n\nimport './ViewOrganization.css'\n\nimport * as types from '../types'\nimport { Button } from 'antd';\nimport Header from './Header';\n\nexport interface ViewOrganizationState {\n}\n\nclass ViewOrganization extends React.Component<types.ViewOrganizationProps, ViewOrganizationState> {\n    constructor(props: types.ViewOrganizationProps) {\n        super(props)\n\n        this.props.onViewOrg(this.props.id)\n    }\n\n    buildFooter() {\n        return (\n            <div>\n                {this.renderEditRow()}\n                {/* <p style={{ textAlign: 'center' }}>\n                    You may also  <NavLink to={`/organizations`}><Button type=\"danger\" icon=\"undo\">Return to Orgs</Button></NavLink> to the organizations browser.\n                </p> */}\n            </div>\n        )\n    }\n\n    renderEditRow() {\n        if (this.props.organization!.owner.username === this.props.username) {\n            return (\n                <p style={{ textAlign: 'center' }}>\n                    As the owner of this group, you may <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink> it.\n                </p>\n            )\n        }\n    }\n\n    renderEditButton() {\n        if (this.props.organization!.owner.username === this.props.username) {\n            return (\n                <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink>\n            )\n        }\n    }\n\n    renderOrg() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <form className=\"table\">\n                <div className=\"row\">\n                    <div className=\"col2\">\n                        <div className=\"name\">\n                            {this.props.organization.name}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col2\">\n                        <div className=\"id\">\n                            <span className=\"label\">permalink</span>{' '}\n                            <span className=\"permalinkBase\">https://narrative.kbase.us/organizations/</span>{this.props.organization.id}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"row\" style={{ flex: '1 1 0px' }}>\n                    <div className=\"col2\">\n                        <div className=\"description\"\n                            dangerouslySetInnerHTML={({ __html: marked(this.props.organization.description || '') })}\n                        />\n                    </div>\n                </div>\n                {/* <div className=\"row\">\n                    <div className=\"col2\">\n                        {this.buildFooter()}\n                    </div>\n                </div> */}\n            </form>\n        )\n    }\n\n    renderInfo() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <form className=\"table infoTable\">\n                <div className=\"row\">\n                    <div className=\"col1\">\n                        <span className=\"label\">owner</span>\n                    </div>\n                    <div className=\"col2\">\n                        <div className=\"owner\">\n                            <a href=\"#people/{org.owner.username}\" target=\"_blank\">{this.props.organization.owner.realname} ❨{this.props.organization.owner.username}❩</a>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\">\n                        <span className=\"label\">established</span>\n                    </div>\n                    <div className=\"col2\">\n                        <div className=\"createdAt\">\n                            {Intl.DateTimeFormat('en-US').format(this.props.organization.createdAt)}\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                    <div className=\"col1\">\n                        <span className=\"label\">last updated</span>\n                    </div>\n                    <div className=\"col2\">\n                        <div className=\"modifiedAt\">\n                            {Intl.DateTimeFormat('en-US').format(this.props.organization.modifiedAt)}\n                        </div>\n                    </div>\n                </div>\n            </form>\n        )\n    }\n\n    renderHeader() {\n        return (\n            <Header title=\"Organizations\">\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Viewing Org \"\n                            {this.props.organization && this.props.organization.name}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end' }}>\n                        {this.renderEditButton()}\n                        <NavLink to={`/organizations`}><Button type=\"danger\" icon=\"undo\">Return to Orgs</Button></NavLink>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderLoadingHeader() {\n        return (\n            <Header title=\"Organizations\">\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Loading Org...\n                        </span>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    render() {\n        if (typeof this.props.organization !== 'undefined') {\n            return (\n                <div className=\"ViewOrganization\">\n                    {this.renderHeader()}\n                    <div className=\"mainRow\">\n                        <div className=\"mainColumn\">\n                            {this.renderOrg()}\n                        </div>\n                        <div className=\"infoColumn\">\n                            <div className=\"infoBox\">\n                                {this.renderInfo()}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )\n        }\n        return (\n            <div className=\"ViewOrganization\">\n                {this.renderLoadingHeader()}\n                Loading...\n            </div>\n        )\n    }\n}\n\nexport default ViewOrganization","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../types'\nimport * as actions from '../redux/actions/viewOrg'\n\nimport ViewOrganization from '../components/ViewOrganization'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n    id: string\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    id: string,\n    state: types.ViewOrgState\n    organization?: types.Organization\n    error?: types.AppError,\n    username: string\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onViewOrg: (id: string) => void\n}\n\n// hmm this bit would be for the interface for the wrapped component.\n// can't really do that here, but _could_ export the interfaces above\n// and compose them thus in the wrapped component. But the wrapped component\n// should know nothing about this business\n// type Props = StateProps & DispatchProps & OwnProps\n\n\nfunction mapStateToProps({ viewOrg: { state, organization, error }, auth: { authorization: { username } } }: types.StoreState,\n    { id }: OwnProps): StateProps {\n    // TODO: of course this really needs to be an async fetch of the org info!\n    return {\n        id, state, organization, error, username\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.ViewOrgFetch>): DispatchProps {\n    return {\n        onViewOrg: (id: string) => {\n            dispatch(actions.viewOrgFetch(id) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(ViewOrganization)\n\n// export default connect(mapStateToProps, mapDispatchToProps)(ViewOrganization) \n\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState, Organization, EditedOrganization,\n    AppError, UIError\n} from '../../types'\nimport { Model } from '../../data/model'\n\n// ACTIONS\n\n// Top level action which triggers an edit org session (load org)\nexport interface EditOrg extends Action {\n    type: ActionFlag.EDIT_ORG,\n    id: string\n}\n\nexport interface EditOrgStart extends Action {\n    type: ActionFlag.EDIT_ORG_START\n}\n\nexport interface EditOrgSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_SUCCESS,\n    organization: EditedOrganization\n}\n\nexport interface EditOrgError extends Action {\n    type: ActionFlag.EDIT_ORG_ERROR,\n    error: AppError\n}\n\n// Saving an edited org\nexport interface EditOrgSave extends Action {\n    type: ActionFlag.EDIT_ORG_SAVE\n}\n\nexport interface EditOrgSaveStart extends Action {\n    type: ActionFlag.EDIT_ORG_SAVE_START\n}\n\nexport interface EditOrgSaveSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_SAVE_SUCCESS,\n    organization: Organization\n}\n\nexport interface EditOrgSaveError extends Action {\n    type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Editing fields\n\n// Edit name\nexport interface EditOrgUpdateName extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface EditOrgUpdateNameSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface EditOrgUpdateNameError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: UIError\n}\n\n// Edit description\nexport interface EditOrgUpdateDescription extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION,\n    name: string\n}\n\nexport interface EditOrgUpdateDescriptionSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: UIError\n}\n\n// Edit description\n\n// ACTION CREATORS\n\n// Setting up editor\n\nexport function editOrgStart(): EditOrgStart {\n    return {\n        type: ActionFlag.EDIT_ORG_START\n    }\n}\n\nexport function editOrgSuccess(org: EditedOrganization): EditOrgSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_SUCCESS,\n        organization: org\n    }\n}\n\nexport function editOrgError(error: AppError) {\n    return {\n        type: ActionFlag.EDIT_ORG_ERROR,\n        error: error\n    }\n}\n\n// Saving modified org\n\nexport function editOrgSaveStart(): EditOrgSaveStart {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_START\n    }\n}\n\nexport function editOrgSaveSuccess(organization: Organization): EditOrgSaveSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function editOrgSaveError(error: AppError): EditOrgSaveError {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n\n// Editing fields\n\n// Edit name\n\nexport function editOrgUpdateNameSuccess(name: string): EditOrgUpdateNameSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function editOrgUpdateNameError(name: string, error: UIError): EditOrgUpdateNameError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\n// Edit name\n\nexport function editOrgUpdateDescriptionSuccess(description: string): EditOrgUpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function editOrgUpdateDescriptionError(description: string, error: UIError): EditOrgUpdateDescriptionError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function editOrg(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(editOrgStart())\n\n        const { auth: { authorization: { token } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        return model.getOrg(id)\n            .then((org) => {\n                const editableOrg: EditedOrganization = {\n                    id: {\n                        value: org.id\n                    },\n                    name: {\n                        value: org.name\n                    },\n                    description: {\n                        value: org.description\n                    }\n                }\n                dispatch(editOrgSuccess(editableOrg))\n            })\n            .catch((err) => {\n                dispatch(editOrgError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function editOrgUpdateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const { auth: { authorization: { token } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        const [orgName, error] = model.validateOrgName(name)\n        // TODO: a better of satisfying TS\n        if (orgName !== null) {\n            dispatch(editOrgUpdateNameSuccess(orgName))\n        }\n        if (error !== null) {\n            dispatch(editOrgUpdateNameError(orgName, error))\n        }\n    }\n}\n\nexport function editOrgUpdateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const { auth: { authorization: { token } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        const [orgDescription, error] = model.validateOrgDescription(description)\n        // TODO: a better of satisfying TS\n        if (orgDescription !== null) {\n            dispatch(editOrgUpdateDescriptionSuccess(orgDescription))\n        }\n        if (error !== null) {\n            dispatch(editOrgUpdateDescriptionError(orgDescription, error))\n        }\n    }\n}\n\nexport function editOrgSave() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(editOrgSaveStart())\n\n        const { editOrg: { editedOrganization },\n            auth: { authorization: { token } },\n            app: { config } } = getState()\n        const model = new Model({\n            token,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        if (!editedOrganization) {\n            dispatch(editOrgSaveError({\n                code: 'app',\n                message: 'Missing edited organization!'\n            }))\n            return\n        }\n\n        if (editedOrganization.name.error || editedOrganization.description.error) {\n            dispatch(editOrgSaveError({\n                code: 'invalid',\n                message: 'One or more of the edited fields have an error'\n            }))\n            return\n        }\n\n        const organizationUpdate = {\n            name: editedOrganization.name.value,\n            description: editedOrganization.description.value\n        }\n\n        model.updateOrg(editedOrganization.id.value, organizationUpdate)\n            .then((organization) => {\n                dispatch(editOrgSaveSuccess(organization))\n            })\n            .catch((err) => {\n                dispatch(editOrgSaveError({\n                    code: 'error-saving',\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\nimport { Redirect } from 'react-router-dom';\nimport marked from 'marked';\n\nimport * as types from '../types';\n\nimport './EditOrganization.css'\nimport { Button, Tooltip } from 'antd';\nimport Header from './Header';\nimport { FaPencilAlt } from 'react-icons/fa';\n\nexport interface EditedOrganization {\n    id: string,\n    name: string,\n    description: string\n}\n\nexport interface EditOrganizationState {\n    canceling: boolean;\n\n    // editedOrganization?: EditedOrganization\n}\n\nclass EditOrganization extends React.Component<types.EditOrganizationProps, EditOrganizationState> {\n\n    constructor(props: types.EditOrganizationProps) {\n        super(props)\n\n        this.state = {\n            canceling: false\n        }\n\n        this.props.onEditOrg(this.props.id)\n    }\n\n    onClickCancel() {\n        this.setState({ canceling: true })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        this.props.onUpdateOrg();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value)\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value)\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        // this.props.onUpdateId(e.target.value)\n    }\n\n    renderForm() {\n        if (!this.props.editedOrganization) {\n            return\n        }\n        return (\n            <form id=\"editOrganizationForm\" className=\"editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">name</div>\n                    <div className=\"col2\">\n                        <input value={this.props.editedOrganization.name.value}\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.props.editedOrganization.name.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.name.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">id</div>\n                    <div className=\"col2\">\n                        <Tooltip title=\"The id may not be changed\">\n                            <input value={this.props.editedOrganization.id.value}\n                                readOnly />\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"row\" style={{ flex: '1 1 0px', minHeight: '30em', maxHeight: '60em' }}>\n                    <div className=\"col1 field-label\">description</div>\n                    <div className=\"col2\">\n                        <textarea value={this.props.editedOrganization.description.value}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.props.editedOrganization.description.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.description.error.message}</span>) : ''}\n                    </div>\n                </div>\n                {/* <div className=\"row\">\n                    <div className=\"col1\"></div>\n                    <div className=\"col2\">\n                        <div className=\"footer\">\n                            <Button icon=\"save\"\n                                form=\"editOrganizationForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\">Save</Button>\n                            <Button type=\"danger\" icon=\"undo\"\n                                onClick={this.onClickCancel.bind(this)}>Cancel &amp; Return to Orgs</Button>\n                        </div>\n                    </div>\n                </div> */}\n\n            </form>\n        )\n    }\n\n    renderPreview() {\n        if (!this.props.editedOrganization) {\n            return\n        }\n        return <form className=\"preview\">\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"name\">\n                        {this.props.editedOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"id\">\n                        <span style={{ color: 'silver' }}>https://narrative.kbase.us/organizations/</span>{this.props.editedOrganization.id.value || ''}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\" style={{ flex: '1 1 0px', minHeight: '30em', maxHeight: '60em' }}>\n                <div className=\"col2\">\n                    <div className=\"description\"\n                        dangerouslySetInnerHTML={({ __html: marked(this.props.editedOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        </form>\n    }\n\n    renderHeader() {\n        return (\n            <Header title=\"Organizations\">\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            <FaPencilAlt style={{ verticalAlign: 'middle' }} />\n                            {' '}\n                            Editing Org \"\n                            {this.props.editedOrganization!.name.value}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end' }}>\n                        <Button\n                            icon=\"save\"\n                            form=\"editOrganizationForm\"\n                            key=\"submit\"\n                            htmlType=\"submit\">\n                            Save\n                        </Button>\n                        <Button\n                            type=\"danger\"\n                            icon=\"undo\"\n                            onClick={this.onClickCancel.bind(this)}>\n                            Cancel &amp; Return to Org\n                        </Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderLoadingHeader() {\n        return (\n            <Header title=\"Organizations\">\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Loading Org...\n                        </span>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    render() {\n        if (this.state.canceling) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.id} />\n        }\n        if (!this.props.editedOrganization) {\n            return (\n                <div className=\"EditOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"EditOrganization\">\n                {this.renderHeader()}\n                <div className=\"mainRow\">\n                    <div className=\"editorColumn\">\n                        <h3>Editor</h3>\n                        {this.renderForm()}\n                    </div>\n                    <div className=\"previewColumn\">\n                        <h3>Preview</h3>\n                        {this.renderPreview()}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default EditOrganization\n","import {Dispatch} from 'redux'\nimport {connect} from 'react-redux'\n\nimport { EditOrgState, Organization, EditedOrganization, AppError, StoreState } from '../types'\nimport {EditOrg, editOrg, editOrgUpdateName, editOrgUpdateDescription} from '../redux/actions/editOrg'\n\nimport EditOrganization from '../components/EditOrganization'\nimport { editOrgSave } from '../redux/actions/editOrg';\n\ninterface OwnProps {\n    id: string\n}\ninterface StateProps {\n    state: EditOrgState\n    organization?: Organization\n    editedOrganization?: EditedOrganization\n    error?: AppError\n}\n\ninterface DispatchProps {\n    onEditOrg: (id: string) => void,\n    onUpdateOrg: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nfunction mapStateToProps({editOrg: {state, error, editedOrganization}}: StoreState, \n                         {id}: OwnProps): StateProps {\n    return {state, error, editedOrganization}\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<EditOrg>): DispatchProps {\n    return {\n        onEditOrg: (id) => {\n            dispatch(editOrg(id) as any)\n        },\n        onUpdateOrg: () => {\n            dispatch(editOrgSave() as any)\n        },\n        onUpdateName: (name) => {\n            dispatch(editOrgUpdateName(name) as any)\n        },\n        onUpdateDescription: (description) => {\n            dispatch(editOrgUpdateDescription(description) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(EditOrganization)\n","import * as React from 'react'\nimport './Auth.css'\n\nimport * as types from '../types'\nimport { Button } from 'antd';\n\n\nexport interface AuthState {\n\n}\n\nclass Auth extends React.Component<types.AuthProps, AuthState> {\n\n    tokenRef: React.RefObject<HTMLInputElement>\n\n    constructor(props: types.AuthProps) {\n        super(props)\n\n        this.tokenRef = React.createRef()\n\n        this.props.checkAuth()\n    }\n\n    onLogoutClick() {\n        this.props.onRemoveAuthorization()\n    }\n\n    onLoginClick() {\n        if (this.tokenRef.current === null) {\n            return\n        }\n        const token = this.tokenRef.current.value\n        if (token.length === 0) {\n            return\n        }\n        console.log('authorizagin with', token)\n        this.props.onAddAuthorization(token)\n    }\n\n    buildAuthForm() {\n        return (\n            <div className=\"Auth-form\">\n                Token: <input ref={this.tokenRef} />\n                <Button\n                    icon=\"save\"\n                    htmlType=\"submit\"\n                    onClick={this.onLoginClick.bind(this)} >\n                    Assign Token\n                </Button>\n            </div>\n        )\n    }\n\n    buildAuthToolbar() {\n        return (\n            <div className=\"Auth-toolbar\">\n                Logged in as <b><span>{this.props.realname}</span> (<span>{this.props.username}</span></b>)\n                {' '}\n                <Button icon=\"logout\" onClick={this.onLogoutClick.bind(this)}>Sign out</Button>\n            </div>\n        )\n    }\n\n    buildAuthDev() {\n        switch (this.props.authStatus) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized\">\n                        {this.buildAuthToolbar()}\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized\">\n                        <p>Not authorized! Enter a user token below</p>\n                        {this.buildAuthForm()}\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-unauthorized\">\n                        <p>Error</p>\n\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n    }\n\n    buildAuthProd2() {\n        switch (this.props.authStatus) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized\">\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized\">\n                        <p>Not authorized!</p>\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-error\">\n                        <p>Error: ??</p>\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n\n    }\n\n    // buildAuthProd() {\n    //     if (this.props.token) {\n    //         return (\n    //             <div className=\"Auth Auth-authorized\">\n    //                 {this.props.children}\n    //             </div>\n    //         )\n    //     } else {\n    //         return (\n    //             <div className=\"Auth Auth-unauthorized\">\n    //                 <p>Not authorized!</p>\n    //             </div>\n    //         )\n    //     }\n    // }\n\n    render() {\n        return (\n            <div className=\"Auth\">\n                {this.props.env === 'dev' ? this.buildAuthDev() : this.buildAuthProd2()}\n            </div>\n        )\n\n    }\n}\n\nexport default Auth","\nexport interface RootInfo {\n    version: string,\n    servertime: number\n}\n\ninterface AuthEndpoints {\n    root: string,\n    tokenInfo: string,\n    apiMe: string,\n    me: string,\n    loginStart: string,\n    loginChoice: string,\n    loginCreate: string,\n    loginUsernameSuggest: string,\n    loginPick: string,\n    loginCancel: string,\n    logout: string,\n    linkStart: string,\n    linkCancel: string,\n    linkChoice: string,\n    linkPick: string,\n    linkRemove: string,\n    tokens: string,\n    tokensRevoke: string,\n    tokensRevokeAll: string,\n    userSearch: string,\n    adminUserSearch: string,\n    adminUser: string\n}\n\nconst endpoints: AuthEndpoints = {\n    root: '',\n    tokenInfo: 'api/V2/token',\n    apiMe: 'api/V2/me',\n    me: 'me',\n    loginStart: 'login/start',\n    logout: 'logout',\n    loginChoice: 'login/choice',\n    loginCreate: 'login/create',\n    loginUsernameSuggest: 'login/suggestname',\n    loginPick: 'login/pick',\n    loginCancel: 'login/cancel',\n    linkStart: 'link/start',\n    linkCancel: 'link/cancel',\n    linkChoice: 'link/choice',\n    linkPick: 'link/pick',\n    linkRemove: 'me/unlink',\n    tokens: 'tokens',\n    tokensRevoke: 'tokens/revoke',\n    tokensRevokeAll: 'tokens/revokeall',\n    userSearch: 'api/V2/users/search',\n    adminUserSearch: 'api/V2/admin/search',\n    adminUser: 'api/V2/admin/user'\n}\n\nexport interface TokenInfo {\n    created: number,\n    expires: number,\n    id: string,\n    name: string | null,\n    token: string,\n    type: string,\n    user: string,\n    cachefor: number\n}\n\nexport interface Identity {\n    id: string,\n    provider: string,\n    username: string\n}\n\nexport interface Role {\n    id: string,\n    desc: string\n}\n\nexport interface Account {\n    created: number,\n    customroles: Array<string>,\n    display: string,\n    email: string,\n    idents: Array<Identity>,\n    lastLogin: number,\n    local: boolean,\n    roles: Array<Role>,\n    user: string\n}\nexport class AuthClient {\n    url: string;\n\n    constructor({ url }: { url: string }) {\n        this.url = url\n    }\n\n    makePath(path: Array<string> | string): string {\n        if (typeof path === 'string') {\n            return [this.url].concat([path]).join('/');\n        }\n        return [this.url].concat(path).join('/');\n    }\n\n\n    root(): Promise<RootInfo> {\n        return fetch(this.makePath([endpoints.root]), {\n            headers: {\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                console.log('root info', result)\n                return result as RootInfo\n            })\n    }\n\n    getTokenInfo(token: string): Promise<TokenInfo> {\n        return fetch(this.makePath([endpoints.tokenInfo]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as TokenInfo\n            })\n    }\n\n    getMe(token: string): Promise<Account> {\n        return fetch(this.makePath([endpoints.apiMe]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as Account\n            })\n    }\n\n\n    // getInfo() : Promise<GroupsServiceInfo> {\n    //     return fetch(this.url + '/', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json();\n    //         })\n    //         .then((result) => {\n    //             return result as GroupsServiceInfo;\n    //         });\n    // }\n\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport * as Cookies from 'es-cookie'\n\nimport { ActionFlag } from './index'\nimport { AppError, StoreState } from '../../types';\nimport { AuthClient, TokenInfo, Account } from '../../data/auth';\n\n// Action Definitions\n\nexport interface AuthCheck extends Action {\n    type: ActionFlag.AUTH_CHECK\n}\n\nexport interface AuthCheckStart extends Action {\n    type: ActionFlag.AUTH_CHECK_START\n}\n\nexport interface AuthCheckError extends Action {\n    type: ActionFlag.AUTH_CHECK_ERROR,\n    error: AppError\n}\n\nexport interface AuthAuthorized extends Action {\n    type: ActionFlag.AUTH_AUTHORIZED,\n    token: string\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\nexport interface AuthUnauthorized extends Action {\n    type: ActionFlag.AUTH_UNAUTHORIZED\n}\n\nexport interface AuthRemoveAuthorization extends Action {\n    type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n}\n\nexport interface AuthAddAuthorization extends Action {\n    type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n    token: string\n}\n\n// Action Creators\n\n\nexport function authCheckStart(): AuthCheckStart {\n    return {\n        type: ActionFlag.AUTH_CHECK_START\n    }\n}\n\nexport function authCheckError(error: AppError): AuthCheckError {\n    return {\n        type: ActionFlag.AUTH_CHECK_ERROR,\n        error\n    }\n}\n\nexport function authAuthorized(token: string, username: string, realname: string, roles: Array<string>): AuthAuthorized {\n    return {\n        type: ActionFlag.AUTH_AUTHORIZED,\n        token, username, realname, roles\n    }\n}\n\nexport function authUnauthorized(): AuthUnauthorized {\n    return {\n        type: ActionFlag.AUTH_UNAUTHORIZED\n    }\n}\n\n// export function authRemoveAuthorization(): AuthRemoveAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n//     }\n// }\n\n// export function authAddAuthorization(token: string): AuthAddAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n//         token: token\n//     }\n// }\n\n// Action Thunks\n\nexport function checkAuth() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(authCheckStart())\n\n        // TODO: get the auth from the kbase-ui integration api, perhaps a postmessage call\n\n        const token = Cookies.get('kbase_session')\n        if (!token) {\n            dispatch(authUnauthorized())\n            return\n        }\n        const auth = new AuthClient({ url: '/services/auth' })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n    }\n}\n\nexport function authRemoveAuthorization() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // remove cookie\n        Cookies.remove('kbase_session')\n\n        // remove auth in state\n        dispatch(authUnauthorized())\n    }\n}\n\nexport function authAddAuthorization(token: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // add cookie\n        Cookies.set('kbase_session', token)\n\n        // TODO: get auth info\n        const auth = new AuthClient({ url: '/services/auth' })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, AuthState } from '../types'\nimport Auth from '../components/Auth'\nimport * as actions from '../redux/actions/auth'\n\nexport interface OwnProps {\n    env: string\n}\n\ninterface StateProps {\n    authStatus: AuthState,\n    token: string | null,\n    username: string | null,\n    realname: string | null,\n}\n\ninterface DispatchProps {\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const { auth: { status, authorization } } = state\n    return {\n        authStatus: status,\n        token: authorization.token || null,\n        username: authorization.username || null,\n        realname: authorization.realname || null\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        checkAuth: () => {\n            dispatch(actions.checkAuth() as any)\n        },\n        onRemoveAuthorization: () => {\n            dispatch(actions.authRemoveAuthorization() as any)\n        },\n        onAddAuthorization: (token: string) => {\n            dispatch(actions.authAddAuthorization(token) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Auth)","\nimport uuidv4 from 'uuid/v4'\n\ninterface ListenerParams {\n    name: string,\n    onSuccess: (payload: Payload) => void,\n    onError: (error: Error) => void\n}\n\nclass Listener {\n    name: string;\n    onSuccess: (payload: Payload) => void;\n    onError: (error: Error) => void;\n\n    constructor({ name, onSuccess, onError }: ListenerParams) {\n        this.name = name;\n        this.onSuccess = onSuccess;\n        this.onError = onError;\n    }\n}\n\ntype Payload = any;\n\ninterface WaitingListenerParams extends ListenerParams {\n    timeout?: number\n}\n\nclass WaitingListener extends Listener {\n    started: Date;\n    timeout: number;\n\n    constructor(params: WaitingListenerParams) {\n        super(params);\n        this.started = new Date();\n        this.timeout = params.timeout || 5000;\n    }\n}\n\ninterface Envelope {\n    channelId: string\n    id: string\n}\n\nclass Message {\n    name: string;\n    payload: any;\n    id: string;\n    created: Date;\n    channel: any\n    envelope: Envelope | null\n\n    constructor({ name, payload, channel }: { name: string, payload: any, channel: any }) {\n        this.name = name\n        this.payload = payload\n        this.id = uuidv4()\n        this.created = new Date()\n        this.channel = channel\n        this.envelope = null;\n    }\n\n    getMessage() {\n        return {\n            envelope: {\n                id: this.id,\n                created: this.created,\n                channel: this.channel\n            },\n            name: this.name,\n            payload: this.payload\n        };\n    }\n}\n\ninterface Handler {\n    started: Date,\n    handler: (response: any) => any\n}\n\ninterface ChannelParams {\n    window: Window,\n    host: string,\n    channelId?: string\n}\n\nexport class Channel {\n    window: Window\n    host: string\n    id: string\n    awaitingResponse: Map<string, Handler>\n    waitingListeners: Map<string, Array<Listener>>\n    listeners: Map<string, Array<Listener>>\n    lastId: number\n    sentCount: number\n    receivedCount: number\n    unwelcomeReceivedCount: number\n    unwelcomeReceivedCountThreshhold: number\n    unwelcomeReceiptWarning: boolean\n    unwelcomeReceiptWarningCount: number\n    currentListener: ((message: MessageEvent) => void) | null\n\n    constructor(params: ChannelParams) {\n        // The given window upon which we will listen for messages.\n        this.window = params.window;\n\n        // The host for the window; required for postmessage\n        if (this.window.document === null) {\n            throw new Error('No document')\n        }\n        if (this.window.document.location === null) {\n            throw new Error('No location')\n        }\n        this.host = params.host || this.window.document.location.origin;\n\n        // The channel id. Used to filter all messages received to\n        // this channel.\n        this.id = params.channelId || uuidv4()\n\n\n        this.awaitingResponse = new Map<string, Handler>()\n        this.waitingListeners = new Map<string, Array<Listener>>()\n        this.listeners = new Map<string, Array<Listener>>()\n\n        this.lastId = 0\n        this.sentCount = 0\n        this.receivedCount = 0\n\n        this.unwelcomeReceivedCount = 0\n        this.unwelcomeReceivedCountThreshhold = 100\n        this.unwelcomeReceiptWarning = true\n        this.unwelcomeReceiptWarningCount = 0\n        this.currentListener = null\n    }\n\n    genId() {\n        this.lastId += 1;\n        return 'msg_' + String(this.lastId);\n    }\n\n    receiveMessage(messageEvent: MessageEvent) {\n        const message = messageEvent.data as Message;\n        // console.log('* received', message);\n        // ignore messages not to/from the registered ids.\n        // if (!message.envelope.to === this.hostId) {\n        //     return;\n        // }\n        // if (!message.envelope.from === this.clientId) {\n        //     return;\n        // }\n        if (!message) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message data; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!message.envelope) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message envelope, not from KBase; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!(message.envelope.channelId === this.id)) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('Message envelope does not match this channel\\'s id', messageEvent);\n            }\n            return;\n        }\n        if (this.unwelcomeReceiptWarningCount > this.unwelcomeReceivedCountThreshhold) {\n            this.unwelcomeReceiptWarning = false;\n            console.warn('Unwelcome message warning disabled after ' + this.unwelcomeReceiptWarningCount + ' instances.');\n        }\n\n        // A message sent as a request will have registered a response handler\n        // in the awaitingResponse hash, using a generated id as the key.\n        // TODO: to to rethink using the message id here. Perhaps somehting like a\n        // chain of ids, the root of which is the origination id, which is the one\n        // known here when it it is sent; the message \"id\" should be assigned whenver\n        // a message is sent, but a response  message would include the original\n        // message in the \"chain\"...\n\n        // We can also have awaiting responses without an originating request.\n        // These are useful for, e.g., a promise which awaits a message to be sent\n        // within some window...\n        if (message.envelope.id && this.awaitingResponse.has(message.envelope.id)) {\n            try {\n                const response = this.awaitingResponse.get(message.envelope.id)\n                this.awaitingResponse.delete(message.envelope.id)\n                if (response) {\n                    response.handler(message.payload)\n                }\n            } catch (ex) {\n                console.error('Error handling response for message ', message, ex);\n            }\n        }\n\n        // and also awaiting by message name. Like a listener, but they are only used\n        // once.\n        if (this.waitingListeners.has(message.name)) {\n            const awaiting = this.waitingListeners.get(message.name)!\n            this.waitingListeners.delete(message.name)\n            awaiting.forEach((listener) => {\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n\n        // Otherwise, permanently registered handlers are found in the listeners for the\n        // message name.\n        if (this.listeners.has(message.name)) {\n            this.listeners.get(message.name)!.forEach((listener) => {\n                if (!listener.onSuccess) {\n                    console.warn('no handler for listener!', listener);\n                }\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n    }\n\n    listen(listener: Listener) {\n        if (!this.listeners.has(listener.name)) {\n            this.listeners.set(listener.name, [])\n        }\n        this.listeners.get(listener.name)!.push(listener)\n    }\n\n    on(messageId: string, success: (payload: any) => any, error: (error: Error) => void) {\n        this.listen(new Listener({\n            name: messageId,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    sendMessage(message: Message) {\n        this.window.postMessage(message.getMessage(), this.host);\n    }\n\n    send(name: string, payload: Payload) {\n        const message = new Message({ name, payload, channel: this.id });\n        this.sendMessage(message);\n    }\n\n    sendRequest(message: Message, handler: (response: any) => any) {\n        this.awaitingResponse.set('message.id', {\n            started: new Date(),\n            handler: handler\n        })\n\n        this.sendMessage(message);\n    }\n\n    request(name: string, payload: Payload) {\n        return new Promise((resolve, reject) => {\n            try {\n                this.sendRequest(new Message({ name, payload, channel: this.id }), (response: any) => {\n                    resolve(response);\n                });\n            } catch (ex) {\n                reject(ex);\n            }\n        });\n    }\n\n    startMonitor() {\n        window.setTimeout(() => {\n            const now = new Date().getTime();\n\n            // first take care of listeners awaiting a message.\n            for (const [id, listeners] of this.waitingListeners.entries()) {\n                const newListeners = listeners.filter((listener) => {\n                    if (listener instanceof WaitingListener) {\n                        const elapsed = now - listener.started.getTime();\n                        // console.log('elapsed?', listener instanceof WaitingListener, elapsed, listener.timeout);\n                        if (elapsed > listener.timeout) {\n                            try {\n                                if (listener.onError) {\n                                    listener.onError(new Error('timout after ' + elapsed));\n                                }\n                            } catch (ex) {\n                                console.error('Error calling error handler', id, ex);\n                            }\n                            return false;\n                        } else {\n                            return true;\n                        }\n                    } else {\n                        return true;\n                    }\n                });\n                if (newListeners.length === 0) {\n                    this.waitingListeners.delete(id)\n                }\n            }\n\n            if (this.waitingListeners.size > 0) {\n                this.startMonitor()\n            }\n        }, 100);\n    }\n\n    listenOnce(listener: WaitingListener) {\n        if (!this.waitingListeners.has(listener.name)) {\n            this.waitingListeners.set(listener.name, [])\n        }\n        this.waitingListeners.get(listener.name)!.push(listener);\n        if (listener.timeout) {\n            this.startMonitor();\n        }\n    }\n\n    once(name: string, success: (payload: Payload) => void, error: (error: Error) => void) {\n        this.listenOnce(new WaitingListener({\n            name: name,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    when(name: string, timeout: number) {\n        return new Promise((resolve, reject) => {\n            return this.listenOnce(new WaitingListener({\n                name: name,\n                timeout: timeout,\n                onSuccess: (payload) => {\n                    resolve(payload);\n                },\n                onError: (error) => {\n                    reject(error);\n                }\n            }));\n        });\n    }\n\n    stats() {\n        return {\n            sent: this.sentCount,\n            received: this.receivedCount\n        };\n    }\n\n    attach(window: Window) {\n        this.window = window;\n    }\n\n    start() {\n        this.currentListener = (message: MessageEvent) => {\n            this.receiveMessage(message);\n        };\n        this.window.addEventListener('message', this.currentListener, false);\n    }\n\n    stop() {\n        if (this.currentListener) {\n            this.window.removeEventListener('message', this.currentListener, false);\n        }\n    }\n}\n","import uuid from 'uuid/v4'\nimport { Channel } from './windowChannel'\nimport { runInThisContext } from 'vm';\n\nexport interface IFrameParams {\n    channelId: string,\n    frameId: string,\n    params: {\n        groupsServiceURL: string,\n        userProfileServiceURL: string,\n        workspaceServiceURL: string\n    },\n    parentHost: string\n}\n/*\n channelId: \"3b33179e-8a6d-4ae9-bc95-af4c0492eaa6\"\nframeId: \"frame_kb_html_be553ee5-645c-4737-80ba-dcb642632f0c\"\nhostId: \"host_kb_html_9a3b5d5d-bb92-43ff-a443-73267aa31323\"\nparams: {}\nparentHost: \"https://ci.kbase.us\"\n\n*/\n\n/*\nIFrameSimulator\nThis little doozey allows us to create a simulated iframe. We can query it for\n the params placed on the iframe, and talk to it via the window channel -- it has \n its own window channel.\n Good thing we designed the channel for multiple channels per window.\n*/\nclass IFrameSimulator {\n    params: IFrameParams | null\n    channel: Channel\n\n    constructor() {\n        this.params = null\n\n        // create a window channel.\n\n        this.channel = new Channel({\n            window: window,\n            host: document.location!.origin\n        })\n\n    }\n\n    getParamsFromIFrame(): IFrameParams {\n        return {\n            channelId: this.channel.id,\n            frameId: uuid(),\n            params: {\n                groupsServiceURL: 'services/groups',\n                userProfileServiceURL: 'services/user_profile/rpc',\n                workspaceServiceURL: 'services/ws'\n            },\n            parentHost: document.location!.origin\n        }\n    }\n}\n\n\n\nexport default IFrameSimulator","export interface IFrameParams {\n    channelId: string,\n    frameId: string,\n    params: {\n        groupsServiceURL: string,\n        userProfileServiceURL: string,\n        workspaceServiceURL: string\n    },\n    parentHost: string\n}\n\nexport class IFrameIntegration {\n    getParamsFromIFrame() {\n        if (!window.frameElement) {\n            return null\n        }\n        if (!window.frameElement.hasAttribute('data-params')) {\n            // throw new Error('No params found in window!!');\n            return null\n        }\n        const params = window.frameElement.getAttribute('data-params');\n        if (params === null) {\n            // throw new Error('No params found in window!')\n            return null\n        }\n        return JSON.parse(decodeURIComponent(params)) as IFrameParams\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as types from '../../types'\nimport IFrameSimulator, { IFrameParams } from '../../lib/IFrameSimulator';\nimport { IFrameIntegration } from '../../lib/IFrameIntegration';\n\n// Action Definitions\n\n// export interface AppStart extends Action {\n//     type: ActionFlag.APP_START,\n\n// }\n\nexport interface AppSuccess extends Action {\n    type: ActionFlag.APP_SUCCESS,\n    config: types.AppConfig\n}\n\nexport interface AppError extends Action {\n    type: ActionFlag.APP_ERROR,\n    error: AppError\n}\n\n// Action Creators\n\nexport function appSuccess(config: types.AppConfig): AppSuccess {\n    return {\n        type: ActionFlag.APP_SUCCESS,\n        config: config\n    }\n}\n\nexport function appError(error: AppError): AppError {\n    return {\n        type: ActionFlag.APP_ERROR,\n        error: error\n    }\n}\n\n// Action Thunks\n\nexport function appStart() {\n    return (dispatch: ThunkDispatch<types.StoreState, void, Action>, getState: () => types.StoreState) => {\n        // check and see if we are in an iframe\n        const iframeParams = new IFrameIntegration().getParamsFromIFrame()\n\n        if (iframeParams) {\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: iframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: iframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: iframeParams.params.userProfileServiceURL\n                    }\n                }\n            }))\n        } else {\n            const fakeIframeParams = new IFrameSimulator().getParamsFromIFrame()\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: fakeIframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: fakeIframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: fakeIframeParams.params.workspaceServiceURL\n                    }\n                }\n            }))\n        }\n\n\n        // if so, get the params\n\n        // if not, use the fake to get it\n    }\n}\n","import * as React from 'react'\nimport './KBaseIntegration.css'\n\nimport { KBaseIntegrationProps, AppState } from '../types'\nimport { } from '../lib/IFrameSimulator'\n\nclass KBaseIntegration extends React.Component<KBaseIntegrationProps, object> {\n    constructor(props: KBaseIntegrationProps) {\n        super(props)\n\n        // const params = this.getParamsFromIFrame()\n\n        // console.log('params', params)\n\n        this.props.onAppStart()\n    }\n\n    render() {\n        // TODO: some test like \n        // {this.props.env === 'dev' ? this.buildAuthDev() : this.buildAuthProd()}\n\n        if (this.props.status === AppState.NONE) {\n            return (\n                <div className=\"KBaseIntegration\">\n                    Loading...\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"KBaseIntegration\">\n                    {this.props.children}\n                </div>\n            )\n        }\n    }\n\n    // getParamsFromIFrame() {\n    //     if (!window.frameElement) {\n    //         return null\n    //     }\n    //     if (!window.frameElement.hasAttribute('data-params')) {\n    //         // throw new Error('No params found in window!!');\n    //         return null\n    //     }\n    //     const params = window.frameElement.getAttribute('data-params');\n    //     if (params === null) {\n    //         // throw new Error('No params found in window!')\n    //         return null\n    //     }\n    //     return JSON.parse(decodeURIComponent(params));\n    // }\n}\n\nexport default KBaseIntegration","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../types'\nimport * as actions from '../redux/actions/app'\n\nimport KBaseIntegration from '../components/KBaseIntegration'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    status: types.AppState\n}\n\ninterface DispatchProps {\n    onAppStart: () => void\n}\n\nexport function mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const { app: { status } } = state\n    return {\n        status\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAppStart: () => {\n            dispatch(actions.appStart() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(KBaseIntegration)","import React, { Component } from 'react';\nimport { Route } from 'react-router';\nimport { BrowserRouter, Redirect, HashRouter } from 'react-router-dom';\n\n// redux\nimport { Provider } from 'react-redux';\nimport { createStore, applyMiddleware, compose } from 'redux';\nimport thunk from 'redux-thunk'\n\nimport * as types from './types';\nimport { SortOrgs } from './redux/actions/viewOrg';\nimport theReducer from './redux/reducers';\n\n// the app and subcomponents\nimport './App.css';\n\n// fontawesome setup\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faSpinner, faSearch } from '@fortawesome/free-solid-svg-icons'\nlibrary.add(faSpinner, faSearch)\n\nimport Header from './components/Header';\nimport OrganizationsBrowser from './containers/OrganizationsBrowser';\nimport NewOrganization from './containers/NewOrganization';\nimport ViewOrganization from './containers/ViewOrganization';\nimport EditOrganization from './containers/EditOrganization'\nimport Auth from './containers/Auth'\nimport KBaseIntegration from './containers/KBaseIntegration'\n// import { types } from 'util';\n\n// Put the redux store together\n// Just for prototyping --- This is super naive and will change!\n// import {organizations} from './data/temp';\n\n// TODO: determine the environment\n\nconst inIframe = false\nconst deployEnvironment = 'prod'\n\n\nfunction makeEmptyNewOrganization(): types.NewOrganization {\n  return {\n    id: {\n      value: '',\n      status: types.FieldState.NONE,\n      error: {\n        type: types.UIErrorType.NONE\n      }\n    },\n    name: {\n      value: '',\n      status: types.FieldState.NONE,\n      error: {\n        type: types.UIErrorType.NONE\n      }\n    },\n    description: {\n      value: '',\n      status: types.FieldState.NONE,\n      error: {\n        type: types.UIErrorType.NONE\n      }\n    }\n  }\n}\n\n// Set up initial state \n// TODO: move to own file\nconst initialState: types.StoreState = {\n  rawOrganizations: [],\n  organizations: [],\n  totalCount: 0,\n  filteredCount: 0,\n  sortBy: 'name',\n  sortDirection: types.SortDirection.ASCENDING,\n  filter: 'all',\n  searchTerms: [],\n  selectedOrganizationId: null,\n  auth: {\n    status: types.AuthState.NONE,\n    authorization: {\n      token: '',\n      username: '',\n      realname: '',\n      roles: []\n    }\n  },\n  error: null,\n  searching: false,\n  app: {\n    status: types.AppState.NONE,\n    config: {\n      baseUrl: '',\n      services: {\n        Groups: {\n          url: ''\n        },\n        UserProfile: {\n          url: ''\n        },\n        Workspace: {\n          url: ''\n        }\n      }\n    }\n  },\n  addOrg: {\n    editState: types.EditState.NONE,\n    saveState: types.SaveState.NONE,\n    validationState: types.ValidationState.NONE,\n    newOrganization: makeEmptyNewOrganization()\n  },\n  updateOrg: {\n    pending: false\n  },\n  viewOrg: {\n    state: types.ViewOrgState.NONE\n  },\n  editOrg: {\n    state: types.EditOrgState.NONE\n  }\n}\n\n// TODO: remove the cast of reducer to any...\n// const middleware = [thunk]\n// const store = createStore<StoreState, SortOrgs, null, null>(theReducer as any, initialState, applyMiddleware(thunk));\nconst store = createStore(theReducer as any, initialState as any, compose(applyMiddleware(thunk)))\n\nclass App extends Component {\n\n  constructor(props: any) {\n    super(props)\n\n  }\n\n  buildInner() {\n\n  }\n\n  buildDev() {\n\n  }\n\n  buildProd() {\n\n  }\n\n  render() {\n    return (\n      <Provider store={store}>\n        <Auth env={deployEnvironment}>\n          <KBaseIntegration>\n            <HashRouter basename=\"/orgs/\">\n              <div className=\"App\">\n                <div className=\"App-body\">\n                  <Route path=\"/organizations\" component={OrganizationsBrowser} />\n                  <Route path=\"/newOrganization\" component={NewOrganization} />\n                  {/* The destructuring below is ugly, but effective */}\n                  <Route path=\"/viewOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ViewOrganization id={id} />} />\n                  <Route path=\"/editOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <EditOrganization id={id} />} />\n                  <Redirect from=\"/\" to=\"/organizations\" exact={true} />\n                </div>\n              </div>\n            </HashRouter>\n          </KBaseIntegration>\n        </Auth>\n      </Provider>\n\n    )\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport 'typeface-oxygen';\nimport 'normalize.css';\nimport 'antd/dist/antd.css'\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}