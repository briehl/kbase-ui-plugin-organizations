(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{133:function(e,t,r){},145:function(e,t,r){e.exports=r(294)},150:function(e,t,r){},159:function(e,t,r){},217:function(e,t,r){},219:function(e,t,r){},221:function(e,t,r){},236:function(e,t,r){},238:function(e,t,r){},240:function(e,t,r){},242:function(e,t,r){},244:function(e,t,r){},246:function(e,t,r){},248:function(e,t,r){},267:function(e,t,r){},269:function(e,t,r){},273:function(e,t,r){},275:function(e,t,r){},277:function(e,t,r){},280:function(e,t,r){},282:function(e,t,r){},284:function(e,t,r){},286:function(e,t,r){},294:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),i=r(15),o=r.n(i),s=(r(150),r(9)),c=r(11),l=r(14),u=r(12),E=r(13),m=r(298),d=r(215),p=r(309),v=r(297),h=r(18),R=r(60),f=r(136),O=r(3),g=r(65),S=r(89),_=(r(156),r(159),r(308)),A=r(16),N=r(295),T=r(310),w=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"getAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderAvatar",value:function(e){return n.createElement("img",{style:{width:64,height:64},src:this.getAvatarUrl(e)})}},{key:"renderRelation",value:function(e){switch(e.relation.type){case D.NONE:return n.createElement("span",null,n.createElement(A.a,{type:"stop"}),"None");case D.VIEW:return n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},n.createElement("span",null,n.createElement(A.a,{type:"stop"})," You are not a member - view group to join"));case D.MEMBER_REQUEST_PENDING:return n.createElement("span",null,n.createElement(A.a,{type:"user",style:{color:"orange"}})," Your membership ",n.createElement("b",null,"request")," is pending");case D.MEMBER_INVITATION_PENDING:return n.createElement("span",null,n.createElement(A.a,{type:"user",style:{color:"blue"}})," You have been ",n.createElement("b",null,"invited")," to join");case D.MEMBER:return n.createElement("span",null,n.createElement(A.a,{type:"user"})," You are a ",n.createElement("b",null,"member")," of this organization");case D.ADMIN:return n.createElement("span",null,n.createElement(A.a,{type:"unlock"}),"Admin");case D.OWNER:return n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},n.createElement("span",null,n.createElement(A.a,{type:"crown"})," You are the ",n.createElement("b",null,"owner")," of this Organization"))}}},{key:"renderAdminInfo",value:function(e){var t;if(e.relation.type===D.OWNER||e.relation.type===D.ADMIN)return e.adminRequests.length>0&&(t=n.createElement("div",null,n.createElement(A.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," ","there"," ",e.adminRequests.length>1?"are":"is"," ",n.createElement("b",null,e.adminRequests.length," pending request",e.adminRequests.length>1?"s":""))),n.createElement("div",{className:"admin"},t)}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(e){return n.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderRelationInfo",value:function(e){switch(e.relation.type){case D.NONE:case D.VIEW:return n.createElement("div",null,"Only members may view membership information");case D.MEMBER:return n.createElement("div",null,this.renderMemberCount(e));case D.MEMBER_REQUEST_PENDING:case D.MEMBER_INVITATION_PENDING:return n.createElement("div",null,"Only members may view membership information");case D.ADMIN:case D.OWNER:return n.createElement("div",null,this.renderMemberCount(e))}}},{key:"renderOrg",value:function(e,t){return n.createElement("div",{className:"row organization",key:String(t)},n.createElement("div",{className:"col2"},n.createElement(_.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),n.createElement("div",{className:"col1"},n.createElement("div",{className:"orgName"},n.createElement(_.a,{to:"/viewOrganization/".concat(e.id)},e.name)),n.createElement("div",{className:"orgOwner"},n.createElement("span",{className:"field-label"},"owner"),n.createElement("span",{className:"field-value"},n.createElement("a",{href:"/#people/"+e.owner.user.username,target:"_blank"},e.owner.user.realname," \u2768",e.owner.user.username,"\u2769"))),n.createElement("div",{className:"orgCreated"},n.createElement("span",{className:"field-label"},"established"),n.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("div",{className:"relation"},this.renderRelation(e)),this.renderRelationInfo(e),this.renderAdminInfo(e)))}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,r){return e.renderOrg(t,r)}):n.createElement(T.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return n.createElement("div",{className:"Organizations"},n.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(n.Component);var I,y,D,b,U,C,k,M,V,z,G,j,L,P,x,q,W,H,B,Q,J,F,Y,K=Object(h.b)(function(e){if(null===e.browseOrgs.view)throw new Error("view not ready");return{organizations:e.browseOrgs.view.organizations}})(w);!function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(I||(I={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(y||(y={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.MEMBER_REQUEST_PENDING=2]="MEMBER_REQUEST_PENDING",e[e.MEMBER_INVITATION_PENDING=3]="MEMBER_INVITATION_PENDING",e[e.MEMBER=4]="MEMBER",e[e.ADMIN=5]="ADMIN",e[e.OWNER=6]="OWNER"}(D||(D={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(b||(b={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(U||(U={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(C||(C={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(k||(k={})),function(e){e[e.NONE=0]="NONE",e[e.FETCHING=1]="FETCHING",e[e.READY=2]="READY",e[e.EDITING_CAN_SAVE=3]="EDITING_CAN_SAVE",e[e.EDITING_ERRORS=4]="EDITING_ERRORS",e[e.SAVING=5]="SAVING",e[e.SAVED=6]="SAVED",e[e.ERROR=7]="ERROR"}(M||(M={})),function(e){e.NONE="NONE",e.NEW="NEW",e.DIRTY="DIRTY",e.CLEAN="CLEAN"}(V||(V={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(z||(z={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(G||(G={})),function(e){e.NONE="NONE",e.VALID="VALID",e.INVALID="INVALID",e.DIRTY="DIRTY"}(j||(j={})),function(e){e[e.NONE=0]="NONE",e[e.UNEDITED_OK=1]="UNEDITED_OK",e[e.UNEDITED_ERROR=2]="UNEDITED_ERROR",e[e.EDITED_OK=3]="EDITED_OK",e[e.EDITED_ERROR=4]="EDITED_ERROR",e[e.EDITED_WARNING=5]="EDITED_WARNING"}(L||(L={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(P||(P={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(x||(x={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(q||(q={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(W||(W={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(H||(H={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(B||(B={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(Q||(Q={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(J||(J={})),function(e){e[e.NONE=0]="NONE",e[e.READ=1]="READ",e[e.WRITE=2]="WRITE",e[e.ADMIN=3]="ADMIN",e[e.OWN=4]="OWN"}(F||(F={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(Y||(Y={}));var Z,X=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,o=e.info;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,a))).name="AppException",r.code=n,r.message=a,r.detail=i,r.info=o,Error.captureStackTrace&&Error.captureStackTrace(Object(g.a)(Object(g.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(E.a)(t,e),t}(Object(S.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.SORT_ORGS=5]="SORT_ORGS",e[e.SORT_ORGS_START=6]="SORT_ORGS_START",e[e.FILTER_ORGS=7]="FILTER_ORGS",e[e.FILTER_ORGS_START=8]="FILTER_ORGS_START",e[e.SEARCH_ORGS=9]="SEARCH_ORGS",e[e.SEARCH_ORGS_START=10]="SEARCH_ORGS_START",e[e.SEARCH_ORGS_SUCCESS=11]="SEARCH_ORGS_SUCCESS",e[e.SEARCH_ORGS_ERROR=12]="SEARCH_ORGS_ERROR",e[e.UPDATE_ORG=13]="UPDATE_ORG",e[e.UPDATE_ORG_START=14]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=15]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=16]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_FETCH=17]="VIEW_ORG_FETCH",e[e.VIEW_ORG_FETCH_START=18]="VIEW_ORG_FETCH_START",e[e.VIEW_ORG_FETCH_SUCCESS=19]="VIEW_ORG_FETCH_SUCCESS",e[e.VIEW_ORG_FETCH_ERROR=20]="VIEW_ORG_FETCH_ERROR",e[e.VIEW_ORG_STOP=21]="VIEW_ORG_STOP",e[e.VIEW_ORG_JOIN_REQUEST=22]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=23]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=24]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=25]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=26]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=27]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=28]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=29]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=30]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=31]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=32]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=33]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=34]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=35]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=36]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=37]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=38]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=39]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=40]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=41]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.ADD_ORG_LOAD=42]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=43]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=44]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=45]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=46]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=47]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=48]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=49]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH=50]="ADD_ORG_UPDATE_GRAVATAR_HASH",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS=51]="ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR=52]="ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR",e[e.ADD_ORG_UPDATE_ID=53]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=54]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=55]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=56]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=57]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=58]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=59]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=60]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_EVALUATE=61]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=62]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=63]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=64]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=65]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=66]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=67]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_EDIT=68]="EDIT_ORG_EDIT",e[e.EDIT_ORG_EDIT_START=69]="EDIT_ORG_EDIT_START",e[e.EDIT_ORG_EDIT_SUCCESS=70]="EDIT_ORG_EDIT_SUCCESS",e[e.EDIT_ORG_EDIT_ERROR=71]="EDIT_ORG_EDIT_ERROR",e[e.EDIT_ORG_SAVE=72]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=73]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=74]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=75]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=76]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=77]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=78]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH=79]="EDIT_ORG_UPDATE_GRAVATAR_HASH",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS=80]="EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR=81]="EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=82]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=83]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=84]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_EVALUATE=85]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=86]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=87]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=88]="AUTH_CHECK",e[e.AUTH_CHECK_START=89]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=90]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=91]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=92]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=93]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=94]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=95]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=96]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=97]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=98]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=99]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=100]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=101]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=102]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=103]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=104]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=105]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=106]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=107]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=108]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=109]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=110]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=111]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=112]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=113]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=114]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=115]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=116]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=117]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=118]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=119]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=120]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=121]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=122]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=123]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=124]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=125]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=126]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=127]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=128]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=129]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=130]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=131]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=132]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=133]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=134]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=135]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_READY=136]="INVITE_USER_LOAD_READY",e[e.INVITE_USER_LOAD_ERROR=137]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=138]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=139]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=140]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=141]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=142]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=143]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=144]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=145]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=146]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=147]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=148]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=149]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=150]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=151]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=152]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=153]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=154]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_LOAD=155]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=156]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=157]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=158]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=159]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=160]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=161]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=162]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=163]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=164]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=165]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=166]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=167]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR"}(Z||(Z={}));var $=function(e,t){switch(t.type){case Z.ADD_ORG_SAVE:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{saveState:G.SAVING})})}):(console.warn("attempting saveStart without view model"),e)}(e);case Z.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.UNEDITED,saveState:G.SAVED})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case Z.ADD_ORG_SAVE_ERROR:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{saveState:G.SAVE_ERROR,error:t.error})})}):(console.warn("attempting saveSuccess without view model"),e)}(e,t);case Z.ADD_ORG_LOAD_START:return function(e,t){return Object(O.a)({},e,{addOrgView:{loadingStatus:W.LOADING,error:null,viewModel:null}})}(e);case Z.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(O.a)({},e,{addOrgView:{loadingStatus:W.SUCCESS,error:null,viewModel:{editState:z.UNEDITED,validationState:j.NONE,saveState:G.NEW,error:null,newOrganization:t.newOrganization}}})}(e,t);case Z.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(O.a)({},e,{addOrgView:{loadingStatus:W.SUCCESS,error:t.error,viewModel:null}})}(e,t);case Z.ADD_ORG_UNLOAD:return function(e,t){return Object(O.a)({},e,{addOrgView:{loadingStatus:W.NONE,error:null,viewModel:null}})}(e);case Z.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{name:{value:t.name,validationState:j.VALID,editState:z.EDITED,validatedAt:new Date,error:{type:I.NONE}}})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{name:{value:t.name,validationState:j.INVALID,editState:z.EDITED,validatedAt:new Date,error:t.error}})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{gravatarHash:{value:t.gravatarHash,validationState:j.VALID,editState:z.EDITED,validatedAt:new Date,error:{type:I.NONE}}})})})}):(console.warn("attempting updateGravatarHashSuccess without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{gravatarHash:{value:t.gravatarHash,validationState:j.INVALID,editState:z.EDITED,validatedAt:new Date,error:t.error}})})})}):(console.warn("attempting updateGravatarHashError without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{id:{value:t.id,validationState:j.VALID,editState:z.EDITED,validatedAt:new Date,error:{type:I.NONE}}})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{id:{value:t.id,validationState:j.INVALID,editState:z.EDITED,validatedAt:new Date,error:t.error}})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{id:Object(O.a)({},e.addOrgView.viewModel.newOrganization.id,{value:t.id,editState:z.EDITED})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{description:{value:t.description,validationState:j.VALID,editState:z.EDITED,validatedAt:new Date,error:{type:I.NONE}}})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case Z.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{editState:z.EDITED,newOrganization:Object(O.a)({},e.addOrgView.viewModel.newOrganization,{description:{value:t.description,validationState:j.INVALID,editState:z.EDITED,validatedAt:new Date,error:t.error}})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case Z.ADD_ORG_EVALUATE_OK:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{validationState:j.VALID})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case Z.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.addOrgView.viewModel?Object(O.a)({},e,{addOrgView:Object(O.a)({},e.addOrgView,{viewModel:Object(O.a)({},e.addOrgView.viewModel,{validationState:j.INVALID})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};var ee=function(e,t){switch(t.type){case Z.EDIT_ORG_EDIT_START:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.UNEDITED,validationState:j.NONE,saveState:G.NEW,organizationId:t.id,editedOrganization:{id:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}},name:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}},gravatarHash:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}},description:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}}}})})}(e,t);case Z.EDIT_ORG_EDIT_SUCCESS:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editedOrganization:t.editedOrganization,organization:t.organization,editState:z.UNEDITED})})}(e,t);case Z.EDIT_ORG_SAVE_START:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{saveState:G.SAVING})})}(e);case Z.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.UNEDITED,saveState:G.SAVED})})}(e);case Z.EDIT_ORG_SAVE_ERROR:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{saveState:G.SAVE_ERROR,error:t.error})})}(e,t);case Z.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.EDITED,editedOrganization:Object(O.a)({},e.editOrg.editedOrganization,{name:{value:t.name,validationState:j.VALID,editState:z.EDITED,validatedAt:new Date,error:{type:I.NONE}}})})})}(e,t);case Z.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.EDITED,editedOrganization:Object(O.a)({},e.editOrg.editedOrganization,{name:{value:t.name,validationState:j.INVALID,editState:z.EDITED,validatedAt:new Date,error:t.error}})})})}(e,t);case Z.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.EDITED,editedOrganization:Object(O.a)({},e.editOrg.editedOrganization,{gravatarHash:{value:t.gravatarHash,validationState:j.VALID,editState:z.EDITED,validatedAt:new Date,error:{type:I.NONE}}})})})}(e,t);case Z.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.EDITED,editedOrganization:Object(O.a)({},e.editOrg.editedOrganization,{gravatarHash:{value:t.gravatarHash,validationState:j.INVALID,editState:z.EDITED,validatedAt:new Date,error:t.error}})})})}(e,t);case Z.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.EDITED,editedOrganization:Object(O.a)({},e.editOrg.editedOrganization,{description:{value:t.description,validationState:j.VALID,editState:z.EDITED,validatedAt:new Date,error:{type:I.NONE}}})})})}(e,t);case Z.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{editState:z.EDITED,editedOrganization:Object(O.a)({},e.editOrg.editedOrganization,{description:{value:t.description,validationState:j.INVALID,editState:z.EDITED,validatedAt:new Date,error:t.error}})})})}(e,t);case Z.EDIT_ORG_EVALUATE_OK:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{validationState:j.VALID})})}(e);case Z.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return Object(O.a)({},e,{editOrg:Object(O.a)({},e.editOrg,{validationState:j.INVALID})})}(e);default:return null}};var te=function(e,t){switch(t.type){case Z.VIEW_ORG_FETCH_START:return function(e,t){return Object(O.a)({},e,{viewOrg:Object(O.a)({},e.viewOrg,{state:P.FETCHING})})}(e);case Z.VIEW_ORG_FETCH_SUCCESS:return function(e,t){return Object(O.a)({},e,{viewOrg:Object(O.a)({},e.viewOrg,{state:P.READY,organization:t.organization})})}(e,t);case Z.VIEW_ORG_FETCH_ERROR:return function(e,t){return Object(O.a)({},e,{viewOrg:Object(O.a)({},e.viewOrg,{state:P.ERROR,error:t.error})})}(e,t);case Z.VIEW_ORG_STOP:return function(e,t){return Object(O.a)({},e,{viewOrg:{state:P.NONE}})}(e);case Z.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.viewOrg.organization)return e;var r=e.viewOrg.organization.narratives.filter(function(e){return e.workspaceId!==t.narrative.workspaceId});return Object(O.a)({},e,{viewOrg:Object(O.a)({},e.viewOrg,{organization:Object(O.a)({},e.viewOrg.organization,{narratives:r})})})}(e,t);default:return null}};var re=function(e,t){switch(t.type){case Z.SEARCH_ORGS_START:return function(e,t){if(null===e.browseOrgs.view)return console.warn("Cannot start browseOrgs view"),e;var r=e.browseOrgs.view;return r.filter,r.sortBy,r.sortDirection,t.searchTerms,e.auth.authorization.username,Object(O.a)({},e,{browseOrgs:Object(O.a)({},e.browseOrgs,{state:B.SEARCHING,error:null,view:Object(O.a)({},e.browseOrgs.view,{selectedOrganizationId:null,searchTerms:t.searchTerms})})})}(e,t);case Z.SEARCH_ORGS_SUCCESS:return function(e,t){return null===e.browseOrgs.view?(console.warn("Cannot start browseOrgs view"),e):Object(O.a)({},e,{browseOrgs:Object(O.a)({},e.browseOrgs,{state:B.SUCCESS,error:null,view:Object(O.a)({},e.browseOrgs.view,{organizations:t.organizations,totalCount:t.totalCount,filteredCount:t.organizations.length})})})}(e,t);case Z.SEARCH_ORGS_ERROR:return function(e,t){return e.browseOrgs.view?Object(O.a)({},e,{browseOrgs:Object(O.a)({},e.browseOrgs,{error:t.error,state:B.ERROR,view:Object(O.a)({},e.browseOrgs.view,{searching:!1})})}):Object(O.a)({},e,{browseOrgs:Object(O.a)({},e.browseOrgs,{error:t.error})})}(e,t);case Z.SORT_ORGS_START:return function(e,t){if(null===e.browseOrgs.view)return console.warn("Cannot start browseOrgs view"),e;var r=e.browseOrgs.view;return r.searchTerms,r.filter,e.auth.authorization.username,t.sortBy,t.sortDirection,Object(O.a)({},e,{browseOrgs:Object(O.a)({},e.browseOrgs,{state:B.SEARCHING,error:null,view:Object(O.a)({},e.browseOrgs.view,{sortBy:t.sortBy,sortDirection:t.sortDirection})})})}(e,t);case Z.FILTER_ORGS_START:return function(e,t){if(null===e.browseOrgs.view)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(O.a)({},e,{browseOrgs:Object(O.a)({},e.browseOrgs,{state:B.SEARCHING,error:null,view:Object(O.a)({},e.browseOrgs.view,{filter:r})})})}(e,t);default:return null}};var ne=function(e,t){switch(t.type){case Z.AUTH_CHECK_START:return function(e,t){return Object(O.a)({},e,{auth:{status:k.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case Z.AUTH_AUTHORIZED:return function(e,t){return Object(O.a)({},e,{auth:{status:k.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case Z.AUTH_UNAUTHORIZED:return function(e,t){return Object(O.a)({},e,{auth:{status:k.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case Z.AUTH_CHECK_ERROR:return function(e,t){return Object(O.a)({},e,{auth:{status:k.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var ae=function(e,t){switch(t.type){case Z.APP_SUCCESS:return function(e,t){return Object(O.a)({},e,{app:{status:x.READY,config:t.config}})}(e,t);default:return null}};var ie=function(e,t){switch(t.type){case Z.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case Z.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(O.a)({},e,{manageOrganizationRequestsView:{viewState:{organization:t.organization,requests:t.requests},state:W.SUCCESS,error:null}})}(e,t);case Z.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(O.a)({},e,{manageOrganizationRequestsView:{viewState:null,state:W.ERROR,error:t.error}})}(e,t);case Z.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(O.a)({},e,{manageOrganizationRequestsView:{state:W.NONE,viewState:null,error:null}})}(e);case Z.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.manageOrganizationRequestsView.viewState)return e;var r=e.manageOrganizationRequestsView.viewState.organization.adminRequests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(O.a)({},e,{manageOrganizationRequestsView:Object(O.a)({},e.manageOrganizationRequestsView,{viewState:Object(O.a)({},e.manageOrganizationRequestsView.viewState,{organization:Object(O.a)({},e.manageOrganizationRequestsView.viewState.organization,{adminRequests:r})})})})}(e,t);default:return null}};var oe=function(e,t){switch(t.type){case Z.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(O.a)({},e,{viewMembersView:Object(O.a)({},e.viewMembersView,{state:H.LOADING,view:null,error:null})})}(e);case Z.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(O.a)({},e,{viewMembersView:Object(O.a)({},e.viewMembersView,{state:H.SUCCESS,view:{organization:t.organization},error:null})})}(e,t);case Z.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(O.a)({},e,{viewMembersView:Object(O.a)({},e.viewMembersView,{state:H.ERROR,view:null,error:t.error})})}(e,t);case Z.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(O.a)({},e,{viewMembersView:Object(O.a)({},e.viewMembersView,{state:H.NONE,view:null,error:null})})}(e);case Z.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.viewMembersView.view)return e;var r=e.viewMembersView.view.organization.members.map(function(e){return e.user.username===t.memberUsername?(e.type=y.ADMIN,e):e}),n=Object(O.a)({},e);return n.viewMembersView.view.organization.members=r,n}(e,t);case Z.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.viewMembersView.view)return e;var r=e.viewMembersView.view.organization.members.map(function(e){return e.user.username===t.memberUsername?(e.type=y.MEMBER,e):e}),n=Object(O.a)({},e);return n.viewMembersView.view.organization.members=r,n}(e,t);default:return null}};var se=function(e,t){switch(t.type){case Z.INVITE_USER_LOAD_START:return function(e,t){return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{loadingState:W.LOADING})})}(e);case Z.INVITE_USER_LOAD_READY:return function(e,t){return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{loadingState:W.SUCCESS,error:null,value:{editState:Q.EDITING,users:t.users,organization:t.organization,selectedUser:null}})})}(e,t);case Z.INVITE_USER_LOAD_ERROR:return function(e,t){return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{loadingState:W.SUCCESS,error:t.error,value:null})})}(e,t);case Z.INVITE_USER_UNLOAD:return function(e,t){return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{loadingState:W.NONE,error:null,value:null})})}(e);case Z.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){if(null===e.inviteUserView.value)throw new Error("view value is null");return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{value:Object(O.a)({},e.inviteUserView.value,{users:t.users})})})}(e,t);case Z.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){if(null===e.inviteUserView.value)throw new Error("view value is null");return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{value:Object(O.a)({},e.inviteUserView.value,{selectedUser:{user:t.user,relation:t.relation}})})})}(e,t);case Z.INVITE_USER_SEND_INVITATION_START:return function(e,t){if(null===e.inviteUserView.value)throw new Error("view value is null");return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{value:Object(O.a)({},e.inviteUserView.value,{editState:Q.SENDING})})})}(e);case Z.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.inviteUserView.value)throw new Error("view value is null");var r=e.inviteUserView.value,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=D.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=D.MEMBER_INVITATION_PENDING),e});return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{value:Object(O.a)({},e.inviteUserView.value,{editState:Q.SUCCESS,selectedUser:n,users:i})})})}(e);case Z.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){if(null===e.inviteUserView.value)throw new Error("view value is null");return Object(O.a)({},e,{inviteUserView:Object(O.a)({},e.inviteUserView,{value:Object(O.a)({},e.inviteUserView.value,{editState:Q.ERROR})})})}(e);default:return null}};var ce=function(e,t){switch(t.type){case Z.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(O.a)({},e,{manageMembershipView:{loading:!0,error:null,value:null}})}(e);case Z.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(O.a)({},e,{manageMembershipView:{loading:!1,error:null,value:{organization:t.organization}}})}(e,t);case Z.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(O.a)({},e,{manageMembershipView:{loading:!1,error:t.error,value:null}})}(e,t);default:return null}};function le(e,t){return Object(O.a)({},e,{requestNarrativeView:Object(O.a)({},e.requestNarrativeView,{status:Y.SENDING})})}var ue=function(e,t){switch(t.type){case Z.REQUEST_ADD_NARRATIVE_LOAD_START:return function(e,t){return Object(O.a)({},e,{requestNarrativeView:Object(O.a)({},e.requestNarrativeView,{status:Y.LOADING,error:null,value:null})})}(e);case Z.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return Object(O.a)({},e,{requestNarrativeView:Object(O.a)({},e.requestNarrativeView,{status:Y.LOADED,error:null,value:{organization:t.organization,narratives:t.narratives,selectedNarrative:null}})})}(e,t);case Z.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return Object(O.a)({},e,{requestNarrativeView:Object(O.a)({},e.requestNarrativeView,{status:Y.ERROR,error:t.error,value:null})})}(e,t);case Z.REQUEST_ADD_NARRATIVE_SEND_START:return le(e);case Z.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){var r=Object(O.a)({},e,{requestNarrativeView:Object(O.a)({},e.requestNarrativeView,{status:Y.SENT})}),n=r.requestNarrativeView.value.selectedNarrative;return!0===t.request?r.requestNarrativeView.value.narratives=r.requestNarrativeView.value.narratives.map(function(e){return e.workspaceId===n.workspaceId&&(e.status=J.ASSOCIATED),e}):r.requestNarrativeView.value.narratives=r.requestNarrativeView.value.narratives.map(function(e){return e.workspaceId===n.workspaceId&&(e.status=J.REQUESTED),e}),r}(e,t);case Z.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return le(e);case Z.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){return null===e.requestNarrativeView.value?e:Object(O.a)({},e,{requestNarrativeView:Object(O.a)({},e.requestNarrativeView,{error:null,value:Object(O.a)({},e.requestNarrativeView.value,{selectedNarrative:t.narrative})})})}(e,t);case Z.REQUEST_ADD_NARRATIVE_UNLOAD:return function(e,t){return Object(O.a)({},e,{requestNarrativeView:{status:Y.NONE,error:null,value:null}})}(e);default:return null}};var Ee,me=function(e,t){return $(e,t)||ee(e,t)||re(e,t)||te(e,t)||ne(e,t)||ae(e,t)||ie(e,t)||oe(e,t)||se(e,t)||ce(e,t)||ue(e,t)||e},de=(r(217),r(69)),pe=r(73),ve=(r(219),r(301)),he=r(35),Re=r(300),fe=(r(221),r(112)),Oe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"buildSeparator",value:function(){if(this.props.children)return n.createElement(fe.a,{style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"render",value:function(){return n.createElement("div",{className:"Header"},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement(_.a,{to:"/organizations"},n.createElement(fe.b,{style:{verticalAlign:"middle"}})," ",n.createElement("span",{"data-test":"orgs-label"},"Orgs"))),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},this.buildSeparator(),this.props.children))}}]),t}(n.Component),ge=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).searchInput=n.createRef(),r.searchButton=n.createRef(),r.state={searchInput:"",showInfo:!1},r.props.onSearchOrgs([]),r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onShowInfo",value:function(){ve.a.info({title:"Organizations Browser Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the organizations browser..."))})}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){this.props.onSortOrgs(e.target.value,this.props.sortDirection)}},{key:"onSortByChange2",value:function(e){this.props.onSortOrgs(e,this.props.sortDirection)}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onSortDirectionChange2",value:function(e){this.props.onSortOrgs(this.props.sortBy,e)}},{key:"onFilterChange",value:function(e){this.props.onFilterOrgs(e.target.value)}},{key:"onFilterChange2",value:function(e){this.props.onFilterOrgs(e)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?n.createElement("span",null,"No organizations in the system"):0===this.props.filteredCount?n.createElement("span",null,"No organizations found out of"," ",this.props.totalCount," ","available."):this.props.totalCount===this.props.filteredCount?n.createElement("span",null,"Showing all"," ",this.props.totalCount," ","organizations"):n.createElement("span",null,"Showing"," ",this.props.filteredCount," ","out of"," ",this.props.totalCount," ","organizations")}},{key:"renderSearchIcon",value:function(){return this.props.searching?n.createElement(A.a,{type:"loading"}):n.createElement(A.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return n.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},n.createElement("input",{placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),n.createElement(he.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),n.createElement(he.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}))}},{key:"renderHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,"Browse and Search Organizations"),n.createElement(A.a,{type:"right",style:{margin:"0 4px"}}),n.createElement("span",{style:{fontWeight:"normal",fontStyle:"italic"}},this.renderSearchFeedback())),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end"}},n.createElement(_.a,{to:"/newOrganization"},n.createElement(he.a,{icon:"plus-circle"},"Create Organization")),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}))))}},{key:"renderSearchFilter",value:function(){return n.createElement("div",null,n.createElement("span",{className:"field-label"},"sort by"),n.createElement(Re.a,{onChange:this.onSortByChange2.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},n.createElement(Re.a.Option,{value:"name",key:"name"},"Org name"),n.createElement(Re.a.Option,{value:"owner",key:"owner"},"Owner"),n.createElement(Re.a.Option,{value:"created",key:"created"},"Date created")),n.createElement(Re.a,{onChange:this.onSortDirectionChange2.bind(this),style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},n.createElement(Re.a.Option,{value:q.ASCENDING,key:"name"},n.createElement(A.a,{type:"sort-ascending"}),"Ascending"),n.createElement(Re.a.Option,{value:q.DESCENDING,key:"owner"},n.createElement(A.a,{type:"sort-descending"}),"Descending")),n.createElement("span",{className:"field-label",style:{marginLeft:"10px"}},"filter"),n.createElement(Re.a,{onChange:this.onFilterChange2.bind(this),defaultValue:this.props.filter,style:{width:"16em"},dropdownMatchSelectWidth:!0},n.createElement(Re.a.Option,{value:"all",key:"all"},"All"),n.createElement(Re.a.Option,{value:"memberOf",key:"memberOf"},"You are a member of"),n.createElement(Re.a.Option,{value:"owned",key:"owned"},"Owned by you"),n.createElement(Re.a.Option,{value:"notOwned",key:"notOwned"},"Not owned by you"),n.createElement(Re.a.Option,{value:"pending",key:"pending"},"Pending request or invitation"),n.createElement(Re.a.Option,{value:"groupPending",key:"groupPending"},"Pending group requests")))}},{key:"renderOrganizations",value:function(){return this.props.error?n.createElement(T.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):n.createElement(K,null)}},{key:"render",value:function(){return n.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},this.renderHeader(),n.createElement("div",{className:"searchBarRow"},n.createElement("div",{className:"searchBarCol"},this.renderSearchBar()),n.createElement("div",{className:"sortCol"},this.renderSearchFilter())),n.createElement("div",{className:"bodyRow scrollable-flex-column"},n.createElement("div",{className:"col2 scrollable-flex-column"},this.renderOrganizations())))}}]),t}(n.Component),Se=r(22),_e=r.n(Se),Ae=r(31),Ne=r(17),Te=function(){function e(t){var r=t.url,n=t.token;Object(s.a)(this,e),this.url=r,this.token=n}return Object(c.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var t=Object(Ae.a)(_e.a.mark(function t(r){return _e.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.profileCache.has(r)){t.next=2;break}return t.abrupt("return",Promise.resolve(e.profileCache.get(r)));case 2:return t.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",[r]))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0][0]}));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(t){var r=[],n=[];return t.forEach(function(t){e.profileCache.has(t)?r.push(e.profileCache.get(t)):n.push(t)}),0===n.length?Promise.resolve(r):fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",n))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]}).then(function(t){return t.forEach(function(t){e.profileCache.set(t.user.username,t)}),t.concat(r)})}},{key:"getAllUsers",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:""}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}},{key:"searchUsers",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:e}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}}]),e}();Te.profileCache=new Map,function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(Ee||(Ee={}));Object(S.a)(Error);var we=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).name="GroupException",r.originalError=e,r}return Object(E.a)(t,e),t}(X),Ie=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(E.a)(t,e),t}(X),ye=function(){function e(t){var r=t.token,n=t.url;Object(s.a)(this,e),this.token=r,this.url=n}return Object(c.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"getGroups",value:function(){var e=this;(new Date).getTime();return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new we(e)});case"text/plain":return e.text().then(function(e){throw new Ie(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(Ae.a)(_e.a.mark(function e(t,r){var n,a,i,o;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new we(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new Ie(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(Ae.a)(_e.a.mark(function e(t){var r,n,a,i;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new we(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new Ie(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){return this.put(["group",e.id],{name:e.name,custom:{gravatarhash:e.gravatarhash},description:e.description})}},{key:"updateGroup",value:function(e,t){return fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify({name:t.name,custom:{gravatarhash:t.gravatarhash},description:t.description})}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"getRequest",value:function(){var e=Object(Ae.a)(_e.a.mark(function e(t){var r;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===Ee.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===Ee.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===Ee.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestJoinGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}}]),e}(),De=r(74),be=r.n(De),Ue=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(function(e){function t(e){var r;if(Object(s.a)(this,t),r=Object(l.a)(this,Object(u.a)(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(function(){function e(t){var r=t.url,n=t.token;Object(s.a)(this,e),this.url=r,this.token=n||null}return Object(c.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}()));Ue.module="ServiceWizard";var Ce=function(e){function t(e){var r;if(Object(s.a)(this,t),r=Object(l.a)(this,Object(u.a)(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"callFunc",value:function(){var e=Object(Ae.a)(_e.a.mark(function e(t,r){return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){if(200===e.status)return e.json().then(function(e){var t=e.result,r=e.error;return t?[t,null]:[null,r]});if(204===e.status)return[null,null];if(500===e.status){if("application/json"!==e.headers.get("Content-Type"))return e.text().then(function(e){return[null,e]});e.json().then(function(e){return e.error?[null,e.error]:[null,e]})}throw new Error("Unexpected response: "+e.status+", "+e.statusText)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(s.a)(this,e),this.url=r,this.token=n||null,this.module=a}return Object(c.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}()),ke=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(s.a)(this,e),this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(c.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new be.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var o=(new Date).getTime()-a;o>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+o))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):be.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),Me=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"listNarratives",value:function(){var e=Object(Ae.a)(_e.a.mark(function e(t){var r,n,a;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(Ne.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,o=t.rpcContext;if(Object(s.a)(this,e),this.token=r,this.timeout=i||1e4,this.rpcContext=o||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(c.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return ke.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new Ue({url:e.url,token:e.token});return be.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new Ce({module:n.module_name,url:n.url,token:r.token});return be.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}());function Ve(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function ze(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:Ve(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:1===e[6],lockStatus:e[7],metadata:e[8]}}function Ge(e){switch(e){case"Invite":return b.INVITATION;case"Request":return b.REQUEST;default:throw new Error("unknown request type: "+e)}}function je(e){switch(e){case"user":return U.USER;case"workspace":return U.WORKSPACE;case"catalogmethod":return U.APP;default:throw new Error("unknown resource type: "+e)}}function Le(e){switch(e){case"None":return F.NONE;case"Read":return F.READ;case"Write":return F.WRITE;case"Admin":return F.ADMIN;case"Own":return F.OWN;default:throw new Error("Invalid groups user permission: "+e)}}function Pe(e){switch(e){case"r":return F.READ;case"w":return F.WRITE;case"a":return F.ADMIN;default:throw new Error("Invalid workspace user permission: "+e)}}Me.module="NarrativeService";var xe=function(){function e(t){Object(s.a)(this,e),this.params=t,this.cachedOrgs=null}return Object(c.a)(e,[{key:"getPendingRequests",value:function(){var e=new ye({url:this.params.groupsServiceURL,token:this.params.token});return Promise.all([e.getCreatedRequests({includeClosed:!1,sortDirection:Ee.DESCENDING}).then(function(e){return e}),e.getTargetedRequests({includeClosed:!1,sortDirection:Ee.DESCENDING}).then(function(e){return e})]).then(function(e){var t=Object(Ne.a)(e,2);return{requests:t[0],invitations:t[1]}})}},{key:"workspaceToNarrative",value:function(){var e=Object(Ae.a)(_e.a.mark(function e(t){var r,n,a,i,o,s,c,l,u,E,m;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ce({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,Promise.all([r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:1}],includeMetadata:1,ignoreErrors:0}]),r.callFunc("get_workspace_info",[{id:t}])]);case 4:if(n=e.sent,a=Object(Ne.a)(n,2),i=Object(Ne.a)(a[0],2),o=Object(Ne.a)(i[0],1),o[0],s=i[1],c=Object(Ne.a)(a[1],2),l=Object(Ne.a)(c[0],1),u=l[0],E=c[1],!s&&!E){e.next=17;break}return console.warn("narrative not accessible",s,E),e.abrupt("return",null);case 17:return m=ze(u),e.abrupt("return",{workspaceId:m.id,title:m.metadata.narrative_nice_name||"Unknown",permission:Pe(m.userPermission),isPublic:!1});case 21:return e.prev=21,e.t0=e.catch(1),console.warn("narrative not accessible",e.t0),e.abrupt("return",null);case 25:case"end":return e.stop()}},e,this,[[1,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"groupRequestToOrgRequest",value:function(){var e=Object(Ae.a)(_e.a.mark(function e(t){var r,n,a,i,o,s,c=this;return _e.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Te({url:this.params.userProfileServiceURL,token:this.params.token}),n=[t.requester],"user"===t.resourcetype&&n.push(t.resource),t.resourcetype,e.next=6,r.getUserProfiles(n);case 6:a=e.sent,i=Ge(t.type),o=je(t.resourcetype),t.status,s=C.OPEN,e.t0=o,e.next=e.t0===U.USER?13:e.t0===U.WORKSPACE?18:e.t0===U.APP?19:24;break;case 13:if(i!==b.REQUEST){e.next=17;break}return e.abrupt("return",{id:t.id,groupId:t.groupid,resourceType:o,requester:this.profileToUser(a[0]),type:i,status:s,user:this.profileToUser(a[1]),createdAt:new Date(t.createdate),expireAt:new Date(t.expiredate),modifiedAt:new Date(t.moddate)});case 17:return e.abrupt("return",{id:t.id,groupId:t.groupid,resourceType:o,requester:this.profileToUser(a[0]),type:i,status:s,user:this.profileToUser(a[1]),createdAt:new Date(t.createdate),expireAt:new Date(t.expiredate),modifiedAt:new Date(t.moddate)});case 18:return e.abrupt("return",this.workspaceToNarrative(parseInt(t.resource,10)).then(function(e){return b.REQUEST,{id:t.id,groupId:t.groupid,resourceType:o,requester:c.profileToUser(a[0]),type:i,status:s,workspace:t.resource,narrative:e,createdAt:new Date(t.createdate),expireAt:new Date(t.expiredate),modifiedAt:new Date(t.moddate)}}));case 19:if(i!==b.REQUEST){e.next=23;break}return e.abrupt("return",{id:t.id,groupId:t.groupid,resourceType:o,requester:this.profileToUser(a[0]),type:i,status:s,app:t.resource,createdAt:new Date(t.createdate),expireAt:new Date(t.expiredate),modifiedAt:new Date(t.moddate)});case 23:return e.abrupt("return",{id:t.id,groupId:t.groupid,resourceType:o,requester:this.profileToUser(a[0]),type:i,status:s,app:t.resource,createdAt:new Date(t.createdate),expireAt:new Date(t.expiredate),modifiedAt:new Date(t.moddate)});case 24:throw new Error("resource type not handled yet: "+t.resourcetype);case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(e){var t=this,r=new ye({url:this.params.groupsServiceURL,token:this.params.token});return Promise.all([r.getGroupRequests(e,{includeClosed:!1,sortDirection:Ee.DESCENDING}),r.getCreatedRequests({includeClosed:!1,sortDirection:Ee.DESCENDING})]).then(function(r){var n=Object(Ne.a)(r,2),a=n[0],i=n[1].filter(function(t){return t.groupid===e});return Promise.all(a.concat(i).map(function(e){return t.groupRequestToOrgRequest(e)}))})}},{key:"grantViewAccess",value:function(e){var t=this,r=new ye({url:this.params.groupsServiceURL,token:this.params.token});return r.grantReadAccessToRequestedResource({requestId:e}).then(function(){return r.getRequest(e)}).then(function(e){return t.groupRequestToOrgRequest(e)})}},{key:"membersAndAdminsToMembers",value:function(e,t,r){var n=this;return e.map(function(e){var t=r.get(e);if("undefined"===typeof t)throw new Error("Member without profile!");return{type:y.MEMBER,user:n.profileToUser(t)}}).concat(t.map(function(e){var t=r.get(e);if("undefined"===typeof t)throw new Error("Admin without profile");return{type:y.ADMIN,user:n.profileToUser(t)}})).sort(function(e,t){return e.user.realname.localeCompare(t.user.realname)})}},{key:"getGroupMembers",value:function(e,t){var r=this;return e.members.map(function(e){var n=t.get(e);if("undefined"===typeof n)throw new Error("Member without profile!");return{type:y.MEMBER,user:r.profileToUser(n)}}).concat(e.admins.map(function(e){var n=t.get(e);if("undefined"===typeof n)throw new Error("Admin without profile");return{type:y.ADMIN,user:r.profileToUser(n)}})).sort(function(e,t){return e.user.realname.localeCompare(t.user.realname)})}},{key:"groupToOrg",value:function(e,t){var r=this,n=e.id;e.name,e.owner,e.description,e.createdate,e.moddate;t===e.owner?D.OWNER:D.VIEW;var a=new Te({url:this.params.userProfileServiceURL,token:this.params.token}),i=[];return e.members&&(i=e.members.slice()),e.admins&&(i=i.concat(e.admins)),i.push(e.owner),Promise.all([t===e.owner||e.admins.indexOf(t)>=0?r.getPendingAdminRequests([e.id]):Promise.resolve(new Map),this.getPendingRequests()]).then(function(o){var s=Object(Ne.a)(o,2),c=s[0],l=s[1],u=l.requests,E=l.invitations,m=new Map;u.forEach(function(e){"Request"===e.type&&"user"===e.resourcetype&&e.requester===t&&m.set(e.groupid,e)});var d=new Map;return E.forEach(function(e){"Invite"===e.type&&"user"===e.resourcetype&&e.resource===t&&d.set(e.groupid,e)}),a.getUserProfiles(i).then(function(t){var a=t.reduce(function(e,t){return e.set(t.user.username,t),e},new Map),i=a.get(e.owner);if(!i)throw new Error("No profile for owner!");var o,s=r.getGroupMembers(e,a).sort(function(e,t){return e.user.realname.localeCompare(t.user.realname)});o=r.params.username===e.owner?{type:D.OWNER}:e.admins.indexOf(r.params.username)>=0?{type:D.ADMIN}:e.members.indexOf(r.params.username)>=0?{type:D.MEMBER}:m.has(e.id)?{type:D.MEMBER_REQUEST_PENDING,requestId:m.get(e.id).id}:d.has(e.id)?{type:D.MEMBER_INVITATION_PENDING,requestId:d.get(e.id).id}:{type:D.VIEW};var l,u=e.resources.workspace.map(function(e){return{title:e.narrname,workspaceId:parseInt(e.rid,10),permission:Le(e.perm),isPublic:!!e.public}}),E=e.resources.catalogmethod.map(function(e){return{id:e.rid}});return l=function(){return o.type===D.ADMIN||o.type===D.OWNER?r.getPendingOrganizationRequests(e.id).then(function(t){return{id:e.id,name:e.name,gravatarHash:e.custom&&e.custom.gravatarhash||null,description:e.description,createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),owner:{type:y.OWNER,user:r.profileToUser(i)},relation:o,members:s,adminRequests:c.has(n)?c.get(n):[],narratives:u,apps:E}}):Promise.resolve({id:e.id,name:e.name,gravatarHash:e.custom&&e.custom.gravatarhash||null,description:e.description,createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),owner:{type:y.OWNER,user:r.profileToUser(i)},relation:o,members:s,adminRequests:[],narratives:u,apps:E})},new Promise(function(e,t){try{return e(l())}catch(r){t(r)}})})})}},{key:"getPendingAdminRequests",value:function(e){var t=this;return Promise.all(e.map(function(e){return t.getPendingOrganizationRequests(e).then(function(t){return{groupId:e,requests:t}})})).then(function(e){var t=new Map;return e.forEach(function(e){var r=e.groupId,n=e.requests;t.set(r,n)}),t})}},{key:"groupsToOrgs",value:function(e,t){var r=this,n=new Te({url:this.params.userProfileServiceURL,token:this.params.token}),a=e.reduce(function(e,t){return e.set(t.owner,!0),t.members.forEach(function(t){return e.set(t,!0)}),t.admins.forEach(function(t){return e.set(t,!0)}),e},new Map).keys(),i=e.filter(function(e){var r=e.owner,n=e.admins;return r===t||n.indexOf(t)>=0}).map(function(e){return e.id});return Promise.all([n.getUserProfiles(Array.from(a)),this.getPendingRequests(),this.getPendingAdminRequests(i)]).then(function(n){var a=Object(Ne.a)(n,3),i=a[0],o=a[1],s=o.requests,c=o.invitations,l=a[2],u=i.reduce(function(e,t){return e.set(t.user.username,t),e},new Map),E=new Map;s.forEach(function(e){"Request"===e.type&&"user"===e.resourcetype&&e.requester===t&&E.set(e.groupid,e)});var m=new Map;return c.forEach(function(e){"Invite"===e.type&&"user"===e.resourcetype&&e.resource===t&&m.set(e.groupid,e)}),Promise.all(e.map(function(e){var t,n=e.id,a=e.name,i=e.description,o=e.createdate,s=e.moddate,c=(e.owner,e.members),d=e.admins,p=e.custom.gravatarhash,v=r.membersAndAdminsToMembers(c,d,u);t=r.params.username===e.owner?{type:D.OWNER}:e.admins.indexOf(r.params.username)>=0?{type:D.ADMIN}:e.members.indexOf(r.params.username)>=0?{type:D.MEMBER}:E.has(e.id)?{type:D.MEMBER_REQUEST_PENDING,requestId:E.get(e.id).id}:m.has(e.id)?{type:D.MEMBER_INVITATION_PENDING,requestId:m.get(e.id).id}:{type:D.VIEW};var h=e.resources.workspace.map(function(e){return{title:e.narrname,workspaceId:parseInt(e.rid,10),permission:Le(e.perm),isPublic:!!e.public}}),R=e.resources.catalogmethod.map(function(e){return{id:e.rid}});return{id:n,name:a,description:i,gravatarHash:p||null,owner:{type:y.OWNER,user:r.profileToUser(u.get(e.owner))},createdAt:new Date(o),modifiedAt:new Date(s),relation:t,members:v,adminRequests:l.has(n)?l.get(n):[],narratives:h,apps:R}}))})}},{key:"getOrgs",value:function(e){var t=this;return this.cachedOrgs?Promise.resolve(this.cachedOrgs):new ye({url:this.params.groupsServiceURL,token:this.params.token}).getGroups().then(function(r){return t.groupsToOrgs(r,e)})}},{key:"queryOrgs",value:function(e){(new Date).getTime();return this.getOrgs(e.username).then(function(t){return{organizations:function(e,t,r){var n=r===q.ASCENDING?1:-1;switch(t){case"created":return e.slice().sort(function(e,t){return n*(e.createdAt.getTime()-t.createdAt.getTime())});case"name":return e.slice().sort(function(e,t){return n*e.name.localeCompare(t.name)});case"owner":return e.slice().sort(function(e,t){return n*e.owner.user.username.localeCompare(t.owner.user.username)});default:return console.warn("unimplemented sort field: "+t),e}}(function(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.owner.user.username)||t.test(e.owner.user.realname)})})}(function(e,t,r){switch(t){case"all":return e;case"memberOf":return e.filter(function(e){return e.members.findIndex(function(e){return e.user.username===r})>=0});case"owned":return e.filter(function(e){return e.owner.user.username===r});case"notOwned":return e.filter(function(e){return e.owner.user.username!==r});case"pending":return e.filter(function(e){return e.relation.type===D.MEMBER_INVITATION_PENDING||e.relation.type===D.MEMBER_REQUEST_PENDING});case"groupPending":return e.filter(function(e){return(e.relation.type===D.ADMIN||e.relation.type===D.OWNER)&&e.adminRequests&&e.adminRequests.length>0});default:return console.warn("unknown filter : "+t),e}}(t,e.filter,e.username),e.searchTerms),e.sortBy,e.sortDirection),total:t.length}})}},{key:"profileToUser",value:function(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}},{key:"getOrg",value:function(e){var t=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).getGroupById(e).then(function(e){return t.groupToOrg(e,t.params.username)})}},{key:"getGroup",value:function(e){return 0===e.length?Promise.reject(new Error("Group id may not be an empty string")):new ye({url:this.params.groupsServiceURL,token:this.params.token}).getGroupById(e).then(function(e){return e})}},{key:"groupExists",value:function(e){return new ye({url:this.params.groupsServiceURL,token:this.params.token}).groupExists(e).then(function(e){return e.exists})}},{key:"addOrg",value:function(e,t){var r=this,n=new ye({url:this.params.groupsServiceURL,token:this.params.token});return e.id.error&&e.id.error.type===I.ERROR||e.name.error&&e.name.error.type===I.ERROR||e.gravatarHash.error&&e.gravatarHash.error.type===I.ERROR||e.description.error&&e.description.error.type===I.ERROR?Promise.reject(new Error("One or more fields are invalid")):n.createGroup({id:e.id.value,name:e.name.value,gravatarhash:e.gravatarHash.value,description:e.description.value}).then(function(e){return r.groupToOrg(e,t)})}},{key:"updateOrg",value:function(e,t){return new ye({url:this.params.groupsServiceURL,token:this.params.token}).updateGroup(e,{name:t.name,gravatarhash:t.gravatarHash,description:t.description})}},{key:"requestMembershipToGroup",value:function(e){var t=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).requestMembership({groupId:e}).then(function(e){return t.groupRequestToOrgRequest(e)}).catch(function(e){throw e})}},{key:"addOrRequestNarrativeToGroup",value:function(e,t){var r=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).addOrRequestNarrative({groupId:e,workspaceId:t.workspaceId}).then(function(e){return!0===e.complete?Promise.resolve(!0):r.groupRequestToOrgRequest(e)}).catch(function(e){throw e})}},{key:"removeNarrativeFromGroup",value:function(e,t){return new ye({url:this.params.groupsServiceURL,token:this.params.token}).deleteResource(e,"workspace",String(t))}},{key:"cancelRequest",value:function(e){var t=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).cancelRequest({requestId:e}).then(function(e){return t.groupRequestToOrgRequest(e)})}},{key:"acceptRequest",value:function(e){var t=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).acceptRequest({requestId:e}).then(function(e){return t.groupRequestToOrgRequest(e)})}},{key:"denyRequest",value:function(e){var t=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).denyRequest({requestId:e}).then(function(e){return t.groupRequestToOrgRequest(e)})}},{key:"acceptJoinInvitation",value:function(e){var t=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).acceptRequest({requestId:e}).then(function(e){return t.groupRequestToOrgRequest(e)})}},{key:"rejectJoinInvitation",value:function(e){var t=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).denyRequest({requestId:e}).then(function(e){return t.groupRequestToOrgRequest(e)})}},{key:"memberToAdmin",value:function(e,t){return new ye({url:this.params.groupsServiceURL,token:this.params.token}).memberToAdmin({groupId:e,member:t})}},{key:"adminToMember",value:function(e,t){return new ye({url:this.params.groupsServiceURL,token:this.params.token}).adminToMember({groupId:e,member:t})}},{key:"removeMember",value:function(e,t){return new ye({url:this.params.groupsServiceURL,token:this.params.token}).removeMember({groupId:e,member:t})}},{key:"requestJoinGroup",value:function(e,t){var r=this;return new ye({url:this.params.groupsServiceURL,token:this.params.token}).requestJoinGroup({groupId:e,username:t}).then(function(e){return r.groupRequestToOrgRequest(e)})}},{key:"validateOrgId",value:function(e){return qe.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return qe.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return qe.validateOrgDescription(e)}},{key:"searchUsers",value:function(e){return new Te({url:this.params.userProfileServiceURL,token:this.params.token}).searchUsers(e.query).then(function(t){return t.filter(function(t){var r=t.username;return-1===e.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}})})}},{key:"getUser",value:function(e){var t=this;return new Te({url:this.params.userProfileServiceURL,token:this.params.token}).getUserProfile(e).then(function(e){return t.profileToUser(e)})}},{key:"getOwnNarratives",value:function(e){var t=new Me({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4});return Promise.all([t.listNarratives("mine"),this.getOrg(e),this.getPendingRequests()]).then(function(e){var t=Object(Ne.a)(e,3),r=t[0],n=t[1],a=t[2],i=a.requests,o=(a.invitations,n.narratives.map(function(e){return e.workspaceId}));return r.narratives.map(function(e){return{workspaceInfo:ze(e.ws),objectInfo:function(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:Ve(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){var t;return t=-1!==o.indexOf(e.workspaceInfo.id)?J.ASSOCIATED:i.find(function(t){return"workspace"===t.resourcetype&&t.resource===String(e.workspaceInfo.id)})?J.REQUESTED:J.NONE,{workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,status:t,modifiedAt:e.workspaceInfo.modifiedAt}}).sort(function(e,t){return e.title.localeCompare(t.title)})})}}]),e}(),qe=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,null,[{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:I.ERROR,message:"Organization id may not be empty"}];if(e.match(/\s/))return[e,{type:I.ERROR,message:"Organization id may not contain a space"}];if(e.length>100)return[e,{type:I.ERROR,message:"Organization id may not be longer than 100 characters"}];return e.match(/^[a-zA-Z0-9_]+$/)?[e,{type:I.NONE}]:[e,{type:I.ERROR,message:"Organization id may only contain alphanumeric (a-z, A-Z, 0-9) and underscore (_)"}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:I.ERROR,message:"Organization name may not be empty"}]:e.length>256?[e,{type:I.ERROR,message:"Organization name may not be longer than 256 characters"}]:[e,{type:I.NONE}]}},{key:"validateOrgGravatarHash",value:function(e){return 0===e.length?[e,{type:I.NONE}]:e.length>32?[e,{type:I.ERROR,message:"Organization gravatar hash may not be longer than 32 characters"}]:[e,{type:I.NONE}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[e,{type:I.ERROR,message:"Organization description may not be empty"}]:e.length>4096?[e,{type:I.ERROR,message:"Organization name may not be longer than 4,096 characters"}]:[e,{type:I.NONE}]}}]),e}(),We=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,null,[{key:"makeEmptyEditableOrganization",value:function(){return{id:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}},name:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}},gravatarHash:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}},description:{value:"",validationState:j.NONE,editState:z.NONE,validatedAt:null,error:{type:I.NONE}}}}}]),e}();function He(e){return{type:Z.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function Be(e){return function(t,r){t({type:Z.VIEW_ORG_REMOVE_NARRATIVE_START});var n=r();if(n.viewOrg.organization){var a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.viewOrg.organization;if(c){var l=c.id;new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).removeNarrativeFromGroup(l,e.workspaceId).then(function(r){t(function(e){return{type:Z.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrative:e}}(e))}).catch(function(e){t(He({code:e.name,message:e.message}))})}else t(He({code:"bad state",message:"View orgs does not have an org"}))}else t(He({code:"bad state",message:"View orgs does not have an org"}))}}function Qe(e){return{type:Z.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function Je(e){return{type:Z.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:e}}function Fe(){return{type:Z.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function Ye(e){return{type:Z.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:e}}function Ke(e){return function(t,r){t({type:Z.VIEW_ORG_FETCH_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config;new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).getOrg(e).then(function(e){t(function(e){return{type:Z.VIEW_ORG_FETCH_SUCCESS,organization:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.VIEW_ORG_FETCH_ERROR,error:r}))})}}function Ze(){return function(e,t){var r=t(),n=r.auth.authorization,a=n.token,i=n.username,o=r.app.config,s=r.viewOrg.organization,c=new xe({token:a,username:i,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url,workspaceServiceURL:o.services.Workspace.url,serviceWizardURL:o.services.ServiceWizard.url});"undefined"!==typeof s?c.requestMembershipToGroup(s.id).then(function(){e({type:Z.VIEW_ORG_JOIN_REQUEST_SUCCESS}),e(Ke(s.id))}).catch(function(t){e(Qe({type:I.ERROR,message:t.message}))}):e(Qe({type:I.ERROR,message:"Org not currently defined"}))}}function Xe(e){return function(t,r){t({type:Z.VIEW_ORG_JOIN_REQUEST_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.viewOrg.organization,l=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});"undefined"!==typeof c?l.cancelRequest(e).then(function(e){t({type:Z.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),t(Ke(e.groupId))}).catch(function(e){t(Je({type:I.ERROR,message:e.message}))}):t(Je({type:I.ERROR,message:"Org not currently defined"}))}}function $e(e){return function(t,r){t(Fe());var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.viewOrg.organization,l=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});"undefined"!==typeof c?l.acceptJoinInvitation(e).then(function(e){t({type:Z.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),t(Ke(e.groupId))}).catch(function(e){t(Ye(e))}):t(Ye({code:"undefined",message:"Org not currently defined"}))}}function et(e){return function(t,r){t(Fe());var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.viewOrg.organization,l=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});"undefined"!==typeof c?l.rejectJoinInvitation(e).then(function(e){t({type:Z.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),t(Ke(e.groupId))}).catch(function(e){var r;t((r=e,{type:Z.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:r}))}):t(Ye({code:"undefined",message:"Org not currently defined"}))}}function tt(e,t){return{type:Z.SEARCH_ORGS_SUCCESS,organizations:e,totalCount:t}}function rt(e){return{type:Z.SEARCH_ORGS_ERROR,error:e}}function nt(e){return function(t,r){t(function(e){return{type:Z.SEARCH_ORGS_START,searchTerms:e}}(e)),t({type:Z.VIEW_ORG_STOP});var n=r(),a=n.browseOrgs,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config;if(null!==a.view){var l=a.view,u=l.sortBy,E=l.sortDirection,m=l.filter;return new xe({token:o,username:s,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}).queryOrgs({searchTerms:e,sortBy:u,sortDirection:E,filter:m,username:s}).then(function(e){var r=e.organizations,n=e.total;t(tt(r,n))}).catch(function(e){console.error("Error querying orgs",e.name,e.message),t(rt({code:e.name,message:e.message}))})}t(rt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function at(e,t){return function(r,n){r(function(e,t){return{type:Z.SORT_ORGS_START,sortBy:e,sortDirection:t}}(e,t));var a=n(),i=a.browseOrgs,o=a.auth.authorization,s=o.token,c=o.username,l=a.app.config,u=new xe({token:s,username:c,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url,serviceWizardURL:l.services.ServiceWizard.url});if(null!==i.view){var E=i.view,m=E.searchTerms,d=E.filter;return u.queryOrgs({searchTerms:m,sortBy:e,sortDirection:t,filter:d,username:c}).then(function(e){var t=e.organizations,n=e.total;r(tt(t,n))}).catch(function(e){r(rt({code:e.name,message:e.message}))})}r(rt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function it(e){return function(t,r){t(function(e){return{type:Z.FILTER_ORGS_START,filter:e}}(e));var n=r(),a=n.browseOrgs,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config,l=new xe({token:o,username:s,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url});if(null!==a.view){var u=a.view,E=u.searchTerms,m=u.sortBy,d=u.sortDirection;return l.queryOrgs({searchTerms:E,sortBy:m,sortDirection:d,filter:e,username:s}).then(function(e){var r=e.organizations,n=e.total;t(tt(r,n))}).catch(function(e){t(rt({code:e.name,message:e.message}))})}t(rt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}var ot=Object(h.b)(function(e){if(e.browseOrgs.view){var t=e.browseOrgs,r=t.state,n=t.error,a=t.view;return{totalCount:a.totalCount,filteredCount:a.filteredCount,sortBy:a.sortBy,sortDirection:a.sortDirection,filter:a.filter,error:n,searching:r===B.SEARCHING}}return{totalCount:0,filteredCount:0,sortBy:"",sortDirection:q.ASCENDING,filter:"",error:null,searching:e.browseOrgs.state===B.SEARCHING}},function(e){return{onSearchOrgs:function(t){e(nt(t))},onSortOrgs:function(t,r){e(at(t,r))},onFilterOrgs:function(t){e(it(t))}}})(ge);function st(e){return{type:Z.ADD_ORG_SAVE_ERROR,error:e}}function ct(){return{type:Z.ADD_ORG_EVALUATE_ERRORS}}function lt(e){return{type:Z.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function ut(e,t){return{type:Z.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function Et(){return function(e,t){e({type:Z.ADD_ORG_LOAD_START});var r,n={id:{value:"",editState:z.NONE,validationState:j.NONE,validatedAt:null,error:{type:I.NONE}},name:{value:"",editState:z.NONE,validationState:j.NONE,validatedAt:null,error:{type:I.NONE}},gravatarHash:{value:"",editState:z.NONE,validationState:j.NONE,validatedAt:null,error:{type:I.NONE}},description:{value:"",editState:z.NONE,validationState:j.NONE,validatedAt:null,error:{type:I.NONE}}};e((r=n,{type:Z.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(dt())}}function mt(){return function(e,t){var r=t();if(r.addOrgView.viewModel){e({type:Z.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,o=r.addOrgView.viewModel.newOrganization,s=r.app.config,c=new xe({token:a,username:i,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});o?c.addOrg(o,i).then(function(t){e(function(e){return{type:Z.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",o,t),e(st({code:t.code||t.name,message:t.message,exception:t}))}):e(st({code:"app",message:"The new organization data does not yet exist"}))}else e(st({code:"invalid",message:"Unexpected condition: no view model"}))}}function dt(){return function(e,t){var r=t();if(r.addOrgView.viewModel){var n=r.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState===j.VALID&&a.id.validationState===j.VALID&&a.gravatarHash.validationState===j.VALID&&a.description.validationState===j.VALID?e({type:Z.ADD_ORG_EVALUATE_OK}):e(ct())}else e(st({code:"invalid",message:"Unexpected condition: no view model"}))}}function pt(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new xe({token:r,username:n,groupsServiceURL:a.services.Groups.url,userProfileServiceURL:a.services.UserProfile.url,workspaceServiceURL:a.services.Workspace.url,serviceWizardURL:a.services.ServiceWizard.url})}function vt(e){return function(t){var r=qe.validateOrgName(e),n=Object(Ne.a)(r,2),a=n[0],i=n[1];i.type===I.ERROR?t(function(e,t){return{type:Z.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:Z.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(dt())}}function ht(e){return function(t){var r,n=qe.validateOrgGravatarHash(e),a=Object(Ne.a)(n,2),i=a[0],o=a[1];o.type===I.ERROR?t(function(e,t){return{type:Z.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,gravatarHash:e,error:t}}(i,o)):t((r=i,{type:Z.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,gravatarHash:r})),t(dt())}}var Rt=function(){function e(t,r){Object(s.a)(this,e),this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(c.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),ft=null;function Ot(e){return function(t,r){var n=qe.validateOrgId(e),a=Object(Ne.a)(n,2),i=a[0],o=a[1];if(o.type===I.ERROR)return t(ut(i,o)),void t(dt());var s=r().addOrgView.viewModel;if(s){var c=s.newOrganization.id.validatedAt,l=(new Date).getTime();if(c)if(l-c.getTime()<500)return t(function(e){return{type:Z.ADD_ORG_UPDATE_ID_PASS,id:e}}(i)),void(ft||(ft=new Rt(500,function(){t(function(e,t){var r=t(),n=r.addOrgView.viewModel;if(n){var a=n.newOrganization.id,i=qe.validateOrgId(a.value),o=Object(Ne.a)(i,2),s=o[0],c=o[1];if(c.type===I.ERROR)return e(ut(s,c)),void e(dt());var l=pt(t());l.groupExists(s).then(function(t){e(t?ut(s,{type:I.ERROR,message:"This org id is already in use"}):lt(s)),e(dt())})}})})));ft&&ft.cancel(),ft=null,pt(r()).groupExists(i).then(function(e){t(e?ut(i,{type:I.ERROR,message:"This org id is already in use"}):lt(i)),t(dt())})}}}function gt(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).validateOrgDescription(e),l=Object(Ne.a)(c,2),u=l[0],E=l[1];E.type===I.ERROR?t(function(e,t){return{type:Z.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(u,E)):t(function(e){return{type:Z.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(u)),t(dt())}}var St=r(59),_t=r.n(St),At=r(302),Nt=r(88),Tt=r.n(Nt),wt=(r(236),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={cancelToBrowser:!1,showError:!0},r.gravatarEmail=n.createRef(),r.origin=document.location.origin,r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onShowInfo",value:function(){ve.a.info({title:"New Organization Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"As a KBase user, you may create your own organizations."),n.createElement("p",null,"Once you have created an Organization, you will be the sole owner of it, forever."),n.createElement("p",null,"In order to create an Org, you need to complete the following fields."),n.createElement("dl",null,n.createElement("dt",null,"name"),n.createElement("dd",null,"The organization ",n.createElement("i",null,"name")," is whatever you wish to have your Org known as. It may be composed of any text (including unicode characters) up to 200 characters in length. You may also change it at any time."),n.createElement("dt",null,"gravatar"),n.createElement("dd",null,"You should associate your Organization with an avatar hosted with the Gravatar service. To do so, simply enter the email address associated with your gravatar into the first"),n.createElement("dt",null,"id"),n.createElement("dd",null,n.createElement("p",null,"Your Org ",n.createElement("i",null,"id")," forms a url endpoint for your org as well as the identifier used throughout KBase to, well, identify your organization uniquely among all current and future organizations. As such, the Org ID may not be changed once created."),n.createElement("p",null,"The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also restricted to 100 characters in length.")),n.createElement("dt",null,"description"),n.createElement("dd",null,n.createElement("p",null,"Up to 4000 characters, a description allows you to express to other KBase users the purpose, history, associations, and science domain of your Org."),n.createElement("p",null,'The description is in "markdown" format, and the editor will show you a preview of the rendered description.'))))})}},{key:"onGravatarEmailSync",value:function(){var e;e=this.gravatarEmail.current?this.gravatarEmail.current.value:"n/a";var t=Tt()(e);this.props.onUpdateGravatarHash(t)}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){ve.a.confirm({title:"Leave the editor?",content:n.createElement("div",null,n.createElement("p",null,"You have entered information for this new organization."),n.createElement("p",null,"If you leave the editor without first saving, the new organization ",n.createElement("i",null,"will not be created"),"."),n.createElement("p",null,n.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onGravatarHashChange",value:function(e){e.persist(),this.props.onUpdateGravatarHash(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===z.EDITED&&this.props.validationState===j.VALID&&(this.props.saveState===G.NEW||this.props.saveState===G.READY||this.props.saveState===G.SAVED)}},{key:"isModified",value:function(){return this.props.editState===z.EDITED&&this.props.saveState===G.NEW}},{key:"renderForm",value:function(){return n.createElement("form",{id:"newOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},n.createElement("div",{className:"row"},n.createElement("div",{className:"col1 field-label"},"name"),n.createElement("div",{className:"col2"},n.createElement(At.a,{value:this.props.newOrganization.name.value||"",onChange:this.onNameChange.bind(this)}),this.props.newOrganization.name.error?n.createElement("span",{style:{color:"red"}},this.props.newOrganization.name.error.message):"")),n.createElement("div",{className:"row gravatarHash"},n.createElement("div",{className:"col1 field-label"},"gravatar hash"),n.createElement("div",{className:"col2"},n.createElement("div",{style:{display:"flex",flexDirection:"row",marginBottom:"4px"}},n.createElement("div",{style:{flex:"1 1 0px"}},n.createElement("input",{ref:this.gravatarEmail,placeholder:"Provide your gravatar-linked email address, if any"})),n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement(he.a,{icon:"arrow-down",style:{height:"100%"},onClick:this.onGravatarEmailSync.bind(this)}))),n.createElement(At.a,{value:this.props.newOrganization.gravatarHash.value||"",onChange:this.onGravatarHashChange.bind(this)}),this.props.newOrganization.gravatarHash.error?n.createElement("span",{style:{color:"red"}},this.props.newOrganization.gravatarHash.error.message):"")),n.createElement("div",{className:"row"},n.createElement("div",{className:"col1 field-label"},"id"),n.createElement("div",{className:"col2"},n.createElement(At.a,{value:this.props.newOrganization.id.value||"",onChange:this.onIdChange.bind(this)}),this.props.newOrganization.id.error?n.createElement("span",{style:{color:"red"}},this.props.newOrganization.id.error.message):"")),n.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},n.createElement("div",{className:"col1 field-label"},"description"),n.createElement("div",{className:"col2"},n.createElement("textarea",{value:this.props.newOrganization.description.value||"",onChange:this.onDescriptionChange.bind(this)}),this.props.newOrganization.description.error?n.createElement("div",{style:{color:"red"}},this.props.newOrganization.description.error.message):"")),n.createElement("div",{className:"row"},n.createElement("div",{className:"col1"}),n.createElement("div",{className:"col2"})))}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash.value)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash.value+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return n.createElement("img",{style:{width:64,height:64},src:this.getOrgAvatarUrl(e)})}},{key:"renderPreview",value:function(){return n.createElement("form",{className:"preview"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col2"},n.createElement("div",{className:"name"},this.props.newOrganization.name.value||""))),n.createElement("div",{className:"row"},n.createElement("div",{className:"col2"},n.createElement("div",{className:"gravatarHash"},this.renderOrgAvatar(this.props.newOrganization)))),n.createElement("div",{className:"row"},n.createElement("div",{className:"col2"},n.createElement("div",{className:"id"},n.createElement("span",{style:{color:"silver"}},this.origin,"/#orgs/organizations/"),this.props.newOrganization.id.value||n.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),n.createElement("div",{className:"row",style:{flex:"1 1 0px"}},n.createElement("div",{className:"col2"},n.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:_t()(this.props.newOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return n.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderHeader",value:function(){var e,t=this.props.newOrganization.name.value||n.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");return this.props.error&&(e=n.createElement(he.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)})),n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,n.createElement(A.a,{type:"plus-circle"})," ",'Adding a New Org "',t,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},n.createElement(he.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToBrowser.bind(this)},"Return to Orgs Browser"),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}),e)))}},{key:"renderLoadingHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,"Loading New Org Editor..."))))}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return n.createElement("div",{key:"line_"+t},e)})),t&&(t=n.createElement("div",null,n.createElement("div",null,"trace"),t)),n.createElement(ve.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},n.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),n.createElement("div",null,this.props.error.message),t)}}},{key:"render",value:function(){return this.state.cancelToBrowser?n.createElement(v.a,{push:!0,to:"/organizations"}):this.props.saveState===G.SAVED?n.createElement(v.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):this.props.newOrganization?n.createElement("div",{className:"NewOrganization"},this.renderHeader(),n.createElement("div",{className:"mainRow"},n.createElement("div",{className:"editorColumn"},n.createElement("h3",null,"Editor"),this.renderForm()),n.createElement("div",{className:"previewColumn"},n.createElement("h3",null,"Preview"),this.renderPreview())),this.renderError()):n.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(n.Component));var It=Object(h.b)(function(e){if(!e.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(mt())},onUpdateName:function(t){e(vt(t))},onUpdateGravatarHash:function(t){e(ht(t))},onUpdateId:function(t){e(Ot(t))},onUpdateDescription:function(t){e(gt(t))}}})(wt),yt=(r(238),function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return n.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return n.createElement("div",null,"Error!",n.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingStatus){case W.NONE:return this.props.onLoad(),this.renderLoading();case W.LOADING:return this.renderLoading();case W.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case W.SUCCESS:default:return n.createElement(It,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(n.Component));var Dt,bt=Object(h.b)(function(e,t){return{view:e.addOrgView}},function(e){return{onLoad:function(){e(Et())},onUnload:function(){e({type:Z.ADD_ORG_UNLOAD})}}})(yt),Ut=(r(240),r(299)),Ct=r(306),kt=r(303),Mt=(r(242),function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:"./nouserpic.png";case"silhouette":case"mysteryman":default:return"./nouserpic.png"}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return n.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(n.Component)),Vt=(r(244),function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderRole",value:function(){switch(this.props.member.type){case y.OWNER:return n.createElement("span",null,n.createElement(A.a,{type:"crown"})," owner");case y.ADMIN:return n.createElement("span",null,n.createElement(A.a,{type:"unlock"})," admin");case y.MEMBER:return n.createElement("span",null,n.createElement(A.a,{type:"user"})," member")}}},{key:"render",value:function(){return n.createElement("div",{className:"Member"},n.createElement("div",{className:"avatarCol"},n.createElement(Mt,{user:this.props.member.user,size:this.props.avatarSize||30})),n.createElement("div",{className:"infoCol"},n.createElement("div",{className:"name"},n.createElement("a",{href:"#people/"+this.props.member.user.username,target:"_blank"},this.props.member.user.realname)," ","\u2768",this.props.member.user.username,"\u2769"),n.createElement("div",{className:"role"},this.renderRole()),n.createElement("div",{className:"title"},this.props.member.user.title||n.createElement("i",null,"no title in user profile")),n.createElement("div",{className:"organization"},this.props.member.user.organization||n.createElement("i",null,"no organization in user profile")),n.createElement("div",{className:"location"},[this.props.member.user.city,this.props.member.user.state,this.props.member.user.country].filter(function(e){return e}).join(", ")||n.createElement("i",null,"no location information in user profile"))))}}]),t}(n.Component)),zt=r(307);r(246);!function(e){e[e.NONE=0]="NONE",e[e.MANAGE_MEMBERSHIP=1]="MANAGE_MEMBERSHIP",e[e.VIEW_MEMBERS=2]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=3]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=4]="VIEW_ORGANIZATION",e[e.EDIT_ORGANIZATION=5]="EDIT_ORGANIZATION",e[e.INVITE_USER=6]="INVITE_USER"}(Dt||(Dt={}));var Gt=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={navigateTo:Dt.NONE},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onJoinClick",value:function(){this.props.onJoinOrg(),zt.a.success("Join request has been submitted")}},{key:"onCancelJoinRequest",value:function(){var e=this.props.organization.relation;this.props.onCancelJoinRequest(e.requestId),zt.a.success("Submitted cancellation request")}},{key:"onAcceptInvitation",value:function(){var e=this.props.organization.relation;this.props.onAcceptInvitation(e.requestId),zt.a.success("Invitation acceptance has been sent")}},{key:"onRejectInvitation",value:function(){var e=this.props.organization.relation;this.props.onRejectInvitation(e.requestId),zt.a.success("Invitation rejection has been sent")}},{key:"onNavigateToMembership",value:function(){this.setState({navigateTo:Dt.MANAGE_MEMBERSHIP})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:Dt.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:Dt.MANAGE_REQUESTS})}},{key:"onNavigateToEditOrganization",value:function(){this.setState({navigateTo:Dt.EDIT_ORGANIZATION})}},{key:"onNavigateToInviteUser",value:function(){this.setState({navigateTo:Dt.INVITE_USER})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:Dt.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({navigateTo:Dt.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:Dt.VIEW_MEMBERS});break;case"editOrg":this.setState({navigateTo:Dt.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({navigateTo:Dt.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:Dt.MANAGE_REQUESTS})}}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return n.createElement("img",{style:{width:64,height:64},onClick:this.onNavigateToViewOrganization.bind(this),className:"avatarImage",src:this.getOrgAvatarUrl(this.props.organization)})}},{key:"renderRelation",value:function(){switch(this.props.organization.relation.type){case D.NONE:return n.createElement("span",null,n.createElement(A.a,{type:"stop"}),"None");case D.VIEW:return n.createElement("div",null,n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it, you may request membership"},n.createElement("div",{style:{textAlign:"center"}},n.createElement(A.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization")),n.createElement("div",{style:{textAlign:"center"}},n.createElement(he.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization")));case D.MEMBER_REQUEST_PENDING:return n.createElement("div",null,n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have requested membership in this Organization"},"   ",n.createElement("div",{style:{textAlign:"center"}},n.createElement("span",null,n.createElement(A.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",n.createElement("b",null,"request")," is pending"," ",n.createElement(A.a,{type:"question-circle"})))),n.createElement("div",{style:{textAlign:"center"}},n.createElement(he.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case D.MEMBER_INVITATION_PENDING:return n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this Organization"},n.createElement("div",null,n.createElement(A.a,{type:"user",style:{color:"blue"}}),"You have been ",n.createElement("b",null,"invited")," to join this Organization"),n.createElement("div",{style:{textAlign:"center"}},n.createElement(he.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),n.createElement(he.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case D.MEMBER:var e=n.createElement(Ct.a,{onClick:this.onMenuClick.bind(this)},n.createElement(Ct.a.Item,{key:"manageMyMembership"},"Manage My Membership"));return n.createElement("div",{className:"relationRow"},n.createElement("div",{className:"relationLabel"},n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},n.createElement("div",null,n.createElement(A.a,{type:"user"}),"You are a ",n.createElement("b",null,"member")," of this Organization"))),n.createElement("div",{className:"relationMenu"},n.createElement("div",null,n.createElement(kt.a,{overlay:e,trigger:["click"]},n.createElement(he.a,{shape:"circle"},n.createElement(A.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case D.ADMIN:var t=n.createElement(Ct.a,{onClick:this.onMenuClick.bind(this)},n.createElement(Ct.a.Item,{key:"manageMyMembership"},"Manage My Membership"),n.createElement(Ct.a.Item,{key:"viewMembers"},"Members"),n.createElement(Ct.a.Item,{key:"manageRequests"},"Requests and Invitations"),n.createElement(Ct.a.Item,{key:"editOrg"},"Edit this Org"),n.createElement(Ct.a.Item,{key:"inviteUser"},"Invite User"));return n.createElement("div",{className:"relationRow"},n.createElement("div",{className:"relationLabel"},n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are and Administrator for this group"},n.createElement("div",null,n.createElement(A.a,{type:"unlock"}),"You are a ",n.createElement("b",null,"administrator")," of this Organization"))),n.createElement("div",{className:"relationMenu"},n.createElement("div",null,n.createElement(kt.a,{overlay:t,trigger:["click"]},n.createElement(he.a,{shape:"circle"},n.createElement(A.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case D.OWNER:var r=n.createElement(Ct.a,{onClick:this.onMenuClick.bind(this)},n.createElement(Ct.a.Item,{key:"viewMembers"},"Members"),n.createElement(Ct.a.Item,{key:"manageRequests"},"Requests and Invitations"),n.createElement(Ct.a.Item,{key:"editOrg"},"Edit this Org"),n.createElement(Ct.a.Item,{key:"inviteUser"},"Invite User"));return n.createElement("div",{className:"relationRow"},n.createElement("div",{className:"relationLabel"},n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this group"},n.createElement("div",null,n.createElement(A.a,{type:"crown",style:{color:"gold"}})," ","You ",n.createElement("b",null,"own")," this Organization"))),n.createElement("div",{className:"relationMenu"},n.createElement("div",null,n.createElement(kt.a,{overlay:r,trigger:["click"]},n.createElement(he.a,{shape:"circle"},n.createElement(A.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))))}}},{key:"renderOrgInfo",value:function(){var e=this.props.organization;return n.createElement("div",null,n.createElement("div",{className:"name"},e.name),n.createElement("div",{className:"owner"},n.createElement("span",{className:"field-label"},"owner"),n.createElement("a",{href:"#people/"+e.owner.user.username,target:"_blank"},e.owner.user.realname)," ","\u2768",e.owner.user.username,"\u2769"))}},{key:"getRelationClass",value:function(e){switch(e.relation.type){case D.NONE:return"relationRequest";case D.VIEW:return"relationRequest relationNonMember";case D.MEMBER_REQUEST_PENDING:return"relationRequest relationRequestPending";case D.MEMBER_INVITATION_PENDING:return"relationRequest relationInvitationPending";case D.MEMBER:return"relationRequest relationMember";case D.ADMIN:return"relationRequest relationAdmin";case D.OWNER:return"relationRequest relationOwner"}}},{key:"render",value:function(){switch(this.state.navigateTo){case Dt.MANAGE_MEMBERSHIP:return n.createElement(v.a,{push:!0,to:"/membership/"+this.props.organization.id});case Dt.VIEW_MEMBERS:return n.createElement(v.a,{push:!0,to:"/viewMembers/"+this.props.organization.id});case Dt.EDIT_ORGANIZATION:return n.createElement(v.a,{push:!0,to:"/editOrganization/"+this.props.organization.id});case Dt.MANAGE_REQUESTS:return n.createElement(v.a,{push:!0,to:"/manageOrganizationRequests/"+this.props.organization.id});case Dt.INVITE_USER:return n.createElement(v.a,{push:!0,to:"/inviteUser/"+this.props.organization.id});case Dt.VIEW_ORGANIZATION:return n.createElement(v.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id})}return n.createElement("div",{className:"OrganizationHeader"},n.createElement("div",{className:"avatar"},this.renderOrgAvatar(this.props.organization)),n.createElement("div",{className:"orgInfo"},this.renderOrgInfo()),n.createElement("div",{className:"yourRelation "+this.getRelationClass(this.props.organization)},this.renderRelation()))}}]),t}(n.Component);var jt,Lt=Object(h.b)(function(e,t){return{}},function(e){return{onJoinOrg:function(){e(Ze())},onCancelJoinRequest:function(t){e(Xe(t))},onAcceptInvitation:function(t){e($e(t))},onRejectInvitation:function(t){e(et(t))}}})(Gt),Pt=r(110),xt=r(305),qt=r(304),Wt=(r(248),function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderNarrativePermission",value:function(){switch(this.props.narrative.permission){case F.NONE:return"None";case F.READ:return"View and Copy";case F.WRITE:return"View, Copy, Save, Run";case F.ADMIN:return"View, Copy, Save, Run, Manage Sharing";case F.OWN:return"View, Copy, Save, Run, Manage Sharing, Own"}}},{key:"render",value:function(){var e=this,t={display:"block"};return n.createElement(xt.a,{className:"RequestAccess",title:"Request Access to Narrative",placement:"right",width:500,closable:!0,visible:!0,onClose:function(){e.props.onClose.call(e)}},n.createElement("p",null,"You are requesting additional share access to narrative ",n.createElement("b",null,this.props.narrative.title)),n.createElement("div",{className:"title"},"Current Access"),n.createElement("div",null,this.renderNarrativePermission()),n.createElement("div",{className:"title"},"Requested Permission"),n.createElement("div",null,n.createElement(qt.a.Group,null,n.createElement(qt.a,{value:"view",style:t},"View Only (can view, copy)"),n.createElement(qt.a,{value:"edit",style:t},"Edit (also can edit, run)"),n.createElement(qt.a,{value:"admin",style:t},"Admin (also can control sharing)"))),n.createElement("p",{style:{marginTop:"10px"}},"This request will be sent to all Organization admins, with whom the narrative will be automatically shared read-only."))}}]),t}(n.Component));!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(jt||(jt={}));var Ht=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={showInfo:!1,navigateTo:jt.NONE,requestAccess:{narrative:null}},r.props.onViewOrg(r.props.id),r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){if(this.props.organization){var e=this.props.organization.relation;this.props.onCancelJoinRequest(e.requestId)}}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.organization.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.organization.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({navigateTo:jt.REQUEST_ADD_NARRATIVE})}},{key:"onGetViewAccess",value:function(e){console.log("so you want view access?")}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){ve.a.info({title:"View Organization Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the organizations viewer..."))})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return n.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.organization.owner.user.username===this.props.username)return n.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",n.createElement(_.a,{to:"/editOrganization/".concat(this.props.organization.id)},n.createElement(he.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.organization.owner.user.username===this.props.username)return n.createElement(_.a,{to:"/editOrganization/".concat(this.props.organization.id)},n.createElement(he.a,{icon:"edit"},"Edit"))}},{key:"renderOrg",value:function(){if(this.props.organization)return n.createElement("div",{className:"org"},n.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:_t()(this.props.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return n.createElement("div",{className:"ownerTable"},n.createElement("div",{className:"avatarCol"},n.createElement(Mt,{user:e.owner.user,size:60})),n.createElement("div",{className:"proprietorCol"},n.createElement("div",{className:"owner"},n.createElement("a",{href:"#people/"+e.owner.user.username,target:"_blank"},e.owner.user.realname)," ","\u2768",e.owner.user.username,"\u2769"),n.createElement("div",{className:"profileOrganization"},e.owner.user.organization),n.createElement("div",{className:"profileOrganization"},e.owner.user.city,", ",e.owner.user.state,", ",e.owner.user.country)))}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return n.createElement(Lt,{organization:this.props.organization})}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return n.createElement("img",{style:{width:64,height:64},src:this.getOrgAvatarUrl(e)})}},{key:"renderRelation",value:function(e){switch(e.relation.type){case D.NONE:return n.createElement("span",null,n.createElement(A.a,{type:"stop"}),"None");case D.VIEW:return n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},n.createElement("div",null,n.createElement(A.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),n.createElement("div",{style:{marginTop:"10px"}},n.createElement(he.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case D.MEMBER_REQUEST_PENDING:return n.createElement("div",null,n.createElement("div",null,n.createElement(A.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",n.createElement("b",null,"request")," is pending"),n.createElement("div",null,n.createElement(he.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case D.MEMBER_INVITATION_PENDING:return n.createElement("div",null,n.createElement("div",null,n.createElement(A.a,{type:"user",style:{color:"blue"}}),"You have been ",n.createElement("b",null,"invited")," to join this Organization"),n.createElement("div",{style:{marginTop:"10px"}},n.createElement(he.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),n.createElement(he.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case D.MEMBER:return n.createElement("span",null,n.createElement(A.a,{type:"user"}),"Member");case D.ADMIN:return n.createElement("span",null,n.createElement(A.a,{type:"unlock"}),"Admin");case D.OWNER:return n.createElement(N.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},n.createElement("span",null,n.createElement(A.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.organization.relation.type===D.OWNER||this.props.organization.relation.type===D.ADMIN||this.props.organization.relation.type===D.MEMBER)}},{key:"renderMembers",value:function(){var e;if(this.props.organization)return this.isMember()?(e=0===this.props.organization.members.length?n.createElement("p",{style:{fontStyle:"italic",textAlign:"center"}},"This organization has no members"):this.props.organization.members.map(function(e){return n.createElement(n.Fragment,{key:e.user.username},n.createElement(Vt,{member:e,avatarSize:50}))}),n.createElement("div",{className:"table infoTable"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col0"},e)))):n.createElement("i",null,"Sorry, group membership restricted to members only")}},{key:"renderInfo",value:function(){if(this.props.organization)return n.createElement(Ut.a,{title:n.createElement("span",null,n.createElement(A.a,{type:"info-circle"})," info"),className:"slimCard"},n.createElement("div",null,n.createElement("div",null,n.createElement("div",{className:"label"},"owner")),n.createElement("div",{className:"ownerTable"},n.createElement("div",{className:"avatarCol"},n.createElement(Mt,{user:this.props.organization.owner.user,size:60})),n.createElement("div",{className:"proprietorCol"},n.createElement("div",{className:"owner"},n.createElement("a",{href:"#people/"+this.props.organization.owner.user.username,target:"_blank"},this.props.organization.owner.user.realname)," ","\u2768",this.props.organization.owner.user.username,"\u2769"),n.createElement("div",{className:"profileOrganization"},this.props.organization.owner.user.organization),n.createElement("div",{className:"profileOrganization"},this.props.organization.owner.user.city,", ",this.props.organization.owner.user.state,", ",this.props.organization.owner.user.country))),n.createElement("div",{className:"infoTable"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col1"},n.createElement("span",{className:"label"},"established")),n.createElement("div",{className:"col2"},n.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.createdAt)))),n.createElement("div",{className:"row"},n.createElement("div",{className:"col1"},n.createElement("span",{className:"label"},"last updated")),n.createElement("div",{className:"col2"},n.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.modifiedAt)))))))}},{key:"renderAdminRequestsRow",value:function(e){var t;if(e&&(e.relation&&(e.relation.type===D.ADMIN||e.relation.type===D.OWNER)))return t=e.adminRequests.length?n.createElement("div",null,"group has no pending requests"):n.createElement("div",null,n.createElement("div",null,n.createElement(A.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",n.createElement("span",{style:{fontWeight:"bold"}},e.adminRequests.length)," ","pending request",e.adminRequests.length>1?"s":""),n.createElement("div",null,n.createElement(_.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},n.createElement(he.a,null,"Manage Requests")))),n.createElement("div",{className:"row"},n.createElement("div",{className:"col1"},n.createElement("span",{className:"label"},"admin")),n.createElement("div",{className:"col2"},n.createElement("div",{className:"relation"},t)))}},{key:"renderAdminRequests",value:function(e){return e.adminRequests.length?n.createElement("div",null,n.createElement("div",null,n.createElement(A.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.adminRequests.length>1?"are":"is"," ",n.createElement("span",{style:{fontWeight:"bold"}},e.adminRequests.length)," ","pending request",e.adminRequests.length>1?"s":""),n.createElement("div",null,n.createElement(_.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},n.createElement(he.a,null,"Manage Requests")))):n.createElement("div",null,"There are no pending requests")}},{key:"renderRelationClass",value:function(e){switch(e.relation.type){case D.NONE:case D.VIEW:return"infoBox";case D.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case D.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case D.MEMBER:case D.ADMIN:case D.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){if(this.props.organization)return n.createElement("form",{className:"table infoTable"},this.renderAdminRequestsRow(this.props.organization))}},{key:"renderAdminTasks",value:function(){if(this.props.organization){var e=this.props.organization;if(e.relation.type===D.ADMIN||e.relation.type===D.OWNER)return n.createElement("div",{className:"adminTasksBox"},n.createElement(Ut.a,{className:"slimCard adminTasksCard",title:n.createElement("span",null,n.createElement(A.a,{type:"team"})," admin tasks")},this.renderAdminRequests(this.props.organization)))}}},{key:"renderJoinButton",value:function(){if(this.props.organization&&this.props.organization.relation.type===D.VIEW)return n.createElement(he.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,'Viewing Org "',this.props.organization&&this.props.organization.name,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end"}},this.renderEditButton(),n.createElement(_.a,{to:"/organizations"},n.createElement(he.a,{type:"danger",icon:"undo"},"Return to Orgs")),this.renderJoinButton(),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}))))}},{key:"renderLoadingHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,"Loading Org..."))))}},{key:"renderMemberCard",value:function(){var e,t=[n.createElement(_.a,{key:"viewMembers",to:"/viewMembers/".concat(this.props.organization.id)},n.createElement(he.a,{onClick:this.onViewMembers.bind(this),icon:"team"}))];if(this.props.organization)return e=this.isMember()?n.createElement("span",{style:{color:"rgba(150, 150, 150, 1)"}},"(",this.props.organization.members.length,")"):"",n.createElement(Ut.a,{className:"slimCard membersCard",title:n.createElement("span",null,n.createElement(A.a,{type:"team"})," members ",e),extra:t},this.renderMembers())}},{key:"renderNarrativePermission",value:function(e){var t,r,a,i=this;switch(e.permission){case F.NONE:e.isPublic?(a="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=n.createElement("span",null,"View Only (public)"),r=n.createElement(he.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i,e)}},"Request View Access")):(a="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=n.createElement("span",null,"No Access"),r=n.createElement(he.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i,e)}},"Request View Access"));break;case F.READ:a="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=n.createElement("span",null,"View Only"),r=n.createElement(he.a,{size:"small",onClick:function(){i.onRequestShare.call(i,e)}},"Request Additional Access");break;case F.WRITE:a="You have Edit access to this narrative narrative; you may view, edit, and run, but not share it",t=n.createElement("span",null,"Edit"),r=n.createElement(he.a,{size:"small",onClick:function(){i.onRequestShare.call(i,e)}},"Request Admin Access");break;case F.ADMIN:a="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=n.createElement("span",null,"Admin");break;case F.OWN:a="You are the Owner of this narrative; you may view, edit, run, and share it",t=n.createElement("span",null,"Owner");break;default:t=n.createElement("span",null,"Unknown")}return n.createElement(N.a,{title:a,placement:"right"},n.createElement("span",{style:{cursor:"help"}},n.createElement("span",{className:"field-label"},"your permission"),t," ",r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?n.createElement(N.a,{title:"This narrative is viewable by all KBase users",placement:"right"},n.createElement("span",{style:{cursor:"help"}},n.createElement(Pt.a,{icon:"globe"})," Public Narrative")):n.createElement(N.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},n.createElement("span",{style:{cursor:"help"}},n.createElement(Pt.a,{icon:"user-lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(e){return e.permission===F.NONE?n.createElement(n.Fragment,null,n.createElement("div",{className:"title"},e.title),n.createElement("div",null,this.renderPublicPermission(e)),n.createElement("div",null,this.renderNarrativePermission(e)),n.createElement("div",null,n.createElement("i",null,"One-liner abstract?")),n.createElement("div",null,n.createElement("i",null,"created, saved info here?"))):n.createElement(n.Fragment,null,n.createElement("div",{className:"title"},n.createElement("a",{href:"https://ci.kbase.us/narrative/ws."+e.workspaceId+".obj.1",target:"_blank"},e.title)),n.createElement("div",null,this.renderPublicPermission(e)),n.createElement("div",null,this.renderNarrativePermission(e)),n.createElement("div",null,n.createElement("i",null,"One-liner abstract?")),n.createElement("div",null,n.createElement("i",null,"created, saved info here?")))}},{key:"renderNarrativeMenu",value:function(e){var t=this;if(!this.props.organization)return n.createElement("div",null,"sorry, no org yet");var r;this.props.organization.relation.type===D.OWNER||(this.props.organization.relation.type,D.ADMIN);switch(this.props.organization.relation.type){case D.NONE:break;case D.VIEW:case D.MEMBER_REQUEST_PENDING:case D.MEMBER_INVITATION_PENDING:case D.MEMBER:break;case D.ADMIN:case D.OWNER:r=n.createElement(Ct.a,{onClick:function(r){var n=r.key;t.onNarrativeMenu(n,e)}},n.createElement(Ct.a.Item,{key:"removeNarrative"},n.createElement(A.a,{type:"delete"})," Remove Narrative from Organization"))}return r?n.createElement(kt.a,{overlay:r,trigger:["click"]},n.createElement(he.a,{shape:"circle"},n.createElement(A.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))):void 0}},{key:"renderNarratives",value:function(){var e=this;if(!this.isMember())return n.createElement(Ut.a,{className:"slimCard  narratives",title:n.createElement("span",null,n.createElement(A.a,{type:"folder-open"})," narratives")},n.createElement("p",{style:{textAlign:"center",fontStyle:"italic"}},"Sorry, Narratives are restricted to members only"));if(!this.props.organization)return n.createElement("div",null,"sorry, no org yet");var t=[n.createElement(_.a,{key:"requestAddNarrative",to:"/requestAddNarrative/".concat(this.props.organization.id)},n.createElement(he.a,{onClick:this.onRequestAddNarrative.bind(this)},n.createElement(A.a,{type:"plus"})," Add a Narrative"))];if(0===this.props.organization.narratives.length)return n.createElement(Ut.a,{className:"slimCard  narratives",title:n.createElement("span",null,n.createElement(A.a,{type:"folder-open"})," narratives (none)"),extra:t},n.createElement("div",null,"sorry, no narratives"));var r=this.props.organization.narratives.map(function(t){return n.createElement("div",{className:"narrative",key:String(t.workspaceId)},n.createElement("div",{className:"dataCol"},e.renderNarrative(t)),n.createElement("div",{className:"buttonCol"},e.renderNarrativeMenu(t)))}),a=this.props.organization.narratives.length;return n.createElement(Ut.a,{className:"slimCard narratives narrativesCard scrollable-flex-column",title:n.createElement("span",null,n.createElement(A.a,{type:"folder-open"})," narratives (",a,")"),extra:t},n.createElement("div",{className:"narrativesTable"},r))}},{key:"render",value:function(){var e,t=this;switch(this.state.navigateTo){case jt.REQUEST_ADD_NARRATIVE:return n.createElement(v.a,{to:"/requestAddNarrative"});case jt.NONE:}if(this.state.requestAccess.narrative&&this.props.organization){var r=this.props.organization.members.find(function(e){return e.user.username===t.props.username});r&&(e=n.createElement(Wt,{narrative:this.state.requestAccess.narrative,organization:this.props.organization,member:r,onClose:function(){t.onCloseRequestAccess.call(t)}}))}return"undefined"!==typeof this.props.organization?n.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),n.createElement("div",{className:"mainRow  scrollable-flex-column"},n.createElement("div",{className:"mainColumn  scrollable-flex-column"},n.createElement("div",{className:"orgRow"},this.renderOrg()),n.createElement("div",{className:"narrativesRow scrollable-flex-column"},this.renderNarratives())),n.createElement("div",{className:"infoColumn"},this.renderAdminTasks(),n.createElement("div",{className:"infoBox"},this.renderInfo()),this.renderMemberCard())),e):n.createElement("div",{className:"ViewOrganization"},this.renderLoadingHeader(),"Loading...")}}]),t}(n.Component);var Bt=Object(h.b)(function(e,t){var r=e.viewOrg,n=r.state,a=r.organization,i=r.error,o=e.auth.authorization.username;return{id:t.id,state:n,organization:a,error:i,username:o}},function(e){return{onViewOrg:function(t){e(Ke(t))},onJoinOrg:function(){e(Ze())},onCancelJoinRequest:function(t){e(Xe(t))},onAcceptInvitation:function(t){e($e(t))},onRejectInvitation:function(t){e(et(t))},onRemoveNarrative:function(t){e(Be(t))}}})(Ht);function Qt(){return{type:Z.EDIT_ORG_EVALUATE_ERRORS}}function Jt(e){return{type:Z.EDIT_ORG_SAVE_ERROR,error:e}}function Ft(e){return function(t,r){var n;t((n=e,{type:Z.EDIT_ORG_EDIT_START,id:n}));var a=r(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config;return new xe({token:o,username:s,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}).getOrg(e).then(function(e){var r,n,a={id:{value:e.id,validationState:j.VALID,editState:z.NONE,validatedAt:null,error:{type:I.NONE,message:""}},name:{value:e.name,validationState:j.VALID,editState:z.NONE,validatedAt:null,error:{type:I.NONE,message:""}},gravatarHash:{value:e.gravatarHash,validationState:j.VALID,editState:z.NONE,validatedAt:null,error:{type:I.NONE,message:""}},description:{value:e.description,validationState:j.VALID,editState:z.NONE,validatedAt:null,error:{type:I.NONE,message:""}}};t((r=a,n=e,{type:Z.EDIT_ORG_EDIT_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:Z.EDIT_ORG_EDIT_ERROR,error:r}))})}}function Yt(){return function(e,t){e({type:Z.EDIT_ORG_SAVE_START});var r=t(),n=r.auth.authorization,a=n.token,i=n.username,o=r.editOrg,s=o.organizationId,c=o.editedOrganization,l=r.app.config,u=new xe({token:a,username:i,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url,serviceWizardURL:l.services.ServiceWizard.url});if(c){var E={name:c.name.value,gravatarHash:c.gravatarHash.value,description:c.description.value};u.updateOrg(s,E).then(function(){e({type:Z.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",c,t),e(Jt({code:"invalid",message:t.message}))})}else e(Jt({code:"app",message:"The new organization data does not yet exist"}))}}function Kt(){return function(e,t){var r=t().editOrg.editedOrganization;r&&r.name.validationState===j.VALID&&r.gravatarHash.validationState===j.VALID&&r.description.validationState===j.VALID?e({type:Z.EDIT_ORG_EVALUATE_OK}):e(Qt())}}function Zt(e){return function(t){var r=qe.validateOrgName(e),n=Object(Ne.a)(r,2),a=n[0],i=n[1];i.type===I.ERROR?t(function(e,t){return{type:Z.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:Z.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(Kt())}}function Xt(e){return function(t){var r,n=qe.validateOrgGravatarHash(e),a=Object(Ne.a)(n,2),i=a[0],o=a[1];o.type===I.ERROR?t(function(e,t){return{type:Z.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,gravatarHash:e,error:t}}(i,o)):t((r=i,{type:Z.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,gravatarHash:r})),t(Kt())}}function $t(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).validateOrgDescription(e),l=Object(Ne.a)(c,2),u=l[0],E=l[1];E.type===I.ERROR?t(function(e,t){return{type:Z.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(u,E)):t(function(e){return{type:Z.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(u)),t(Kt())}}var er;r(267);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(er||(er={}));var tr=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:er.NONE},r.gravatarEmail=n.createRef(),r.origin=document.location.origin,r.props.onEditOrgEdit(r.props.id),r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onShowInfo",value:function(){ve.a.info({title:"Organization Editor Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the organizations editor..."))})}},{key:"onGravatarEmailSync",value:function(){var e;e=this.gravatarEmail.current?this.gravatarEmail.current.value:"n/a";var t=Tt()(e);this.props.onUpdateGravatarHash(t)}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){ve.a.confirm({title:"Leave the editor?",content:n.createElement("div",null,n.createElement("p",null,"You have made changes on this edit form."),n.createElement("p",null,"If you leave the editor without saving, any ",n.createElement("i",null,"changes they will be lost"),"."),n.createElement("p",null,n.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){ve.a.confirm({title:"Leave the editor?",content:n.createElement("div",null,n.createElement("p",null,"You have made changes on this edit form."),n.createElement("p",null,"If you leave the editor without saving, any ",n.createElement("i",null,"changes they will be lost"),"."),n.createElement("p",null,n.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onGravatarHashChange",value:function(e){e.persist(),this.props.onUpdateGravatarHash(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"canSave",value:function(){return this.props.editState===z.EDITED&&this.props.validationState===j.VALID&&(this.props.saveState===G.NEW||this.props.saveState===G.READY||this.props.saveState===G.SAVED)}},{key:"isModified",value:function(){return this.props.editState===z.EDITED&&(this.props.saveState===G.NEW||this.props.saveState===G.READY)}},{key:"renderForm",value:function(){return n.createElement("form",{id:"editOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},n.createElement("div",{className:"row"},n.createElement("div",{className:"col1 field-label"},"name"),n.createElement("div",{className:"col2"},n.createElement("input",{value:this.props.editedOrganization.name.value||"",onChange:this.onNameChange.bind(this)}),this.props.editedOrganization.name.error?n.createElement("span",{style:{color:"red"}},this.props.editedOrganization.name.error.message):"")),n.createElement("div",{className:"row gravatarHash"},n.createElement("div",{className:"col1 field-label"},"gravatar hash"),n.createElement("div",{className:"col2"},n.createElement("div",{style:{display:"flex",flexDirection:"row",marginBottom:"4px"}},n.createElement("div",{style:{flex:"1 1 0px"}},n.createElement("input",{ref:this.gravatarEmail,placeholder:"Provide your gravatar-linked email address, if any"})),n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement(he.a,{icon:"arrow-down",style:{height:"100%"},onClick:this.onGravatarEmailSync.bind(this)}))),n.createElement("input",{value:this.props.editedOrganization.gravatarHash.value||"",onChange:this.onGravatarHashChange.bind(this)}),this.props.editedOrganization.gravatarHash.error?n.createElement("span",{style:{color:"red"}},this.props.editedOrganization.gravatarHash.error.message):"")),n.createElement("div",{className:"row"},n.createElement("div",{className:"col1 field-label"},"id"),n.createElement("div",{className:"col2"},n.createElement("input",{value:this.props.editedOrganization.id.value||"",onChange:this.onIdChange.bind(this)}),this.props.editedOrganization.id.error?n.createElement("span",{style:{color:"red"}},this.props.editedOrganization.id.error.message):"")),n.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},n.createElement("div",{className:"col1 field-label"},"description"),n.createElement("div",{className:"col2"},n.createElement("textarea",{value:this.props.editedOrganization.description.value||"",onChange:this.onDescriptionChange.bind(this)}),this.props.editedOrganization.description.error?n.createElement("div",{style:{color:"red"}},this.props.editedOrganization.description.error.message):"")),n.createElement("div",{className:"row"},n.createElement("div",{className:"col1"}),n.createElement("div",{className:"col2"})))}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash.value)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash.value+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return n.createElement("img",{style:{width:64,height:64},src:this.getOrgAvatarUrl(e)})}},{key:"renderPreview",value:function(){return n.createElement("form",{className:"preview"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col2"},n.createElement("div",{className:"name"},this.props.editedOrganization.name.value||""))),n.createElement("div",{className:"row"},n.createElement("div",{className:"col2"},n.createElement("div",{className:"gravatarHash"},this.renderOrgAvatar(this.props.editedOrganization)))),n.createElement("div",{className:"row"},n.createElement("div",{className:"col2"},n.createElement("div",{className:"id"},n.createElement("span",{style:{color:"silver"}},this.origin,"/#orgs/organizations/"),this.props.editedOrganization.id.value||n.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),n.createElement("div",{className:"row",style:{flex:"1 1 0px"}},n.createElement("div",{className:"col2"},n.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:_t()(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return n.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderHeader",value:function(){var e=this.props.editedOrganization.name.value||n.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,n.createElement(A.a,{type:"edit"})," ",'Editing Org "',e,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},n.createElement(he.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToBrowser.bind(this)},"Return to Orgs Browser"),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}))))}},{key:"renderLoadingHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,"Loading Org Editor..."))))}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return n.createElement(Lt,{organization:this.props.organization})}},{key:"render",value:function(){return this.state.cancelToBrowser?n.createElement(v.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?n.createElement(v.a,{push:!0,to:"/viewOrganization/"+this.props.id}):this.props.editedOrganization?n.createElement("div",{className:"EditOrganization"},this.renderHeader(),this.renderOrgHeader(),n.createElement("div",{className:"mainRow"},n.createElement("div",{className:"editorColumn"},n.createElement("h3",null,"Editor"),this.renderForm()),n.createElement("div",{className:"previewColumn"},n.createElement("h3",null,"Preview"),this.renderPreview()))):n.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader())}}]),t}(n.Component);var rr=Object(h.b)(function(e){var t=e.editOrg;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgEdit:function(t){e(Ft(t))},onEditOrgSave:function(){e(Yt())},onUpdateName:function(t){e(Zt(t))},onUpdateGravatarHash:function(t){e(Xt(t))},onUpdateDescription:function(t){e($t(t))}}})(tr),nr=(r(269),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).tokenRef=n.createRef(),r.props.checkAuth(),r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return n.createElement("div",{className:"Auth-form"},"Token: ",n.createElement("input",{ref:this.tokenRef}),n.createElement(he.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return n.createElement("div",{className:"Auth-toolbar"},"Logged in as ",n.createElement("b",null,n.createElement("span",null,this.props.authorization.authorization.realname)," (",n.createElement("span",null,this.props.authorization.authorization.username)),")"," ",n.createElement(he.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case k.NONE:case k.CHECKING:return n.createElement("div",null);case k.AUTHORIZED:return n.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case k.UNAUTHORIZED:return n.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},n.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case k.ERROR:return n.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},n.createElement("p",null,"Error"),this.props.authorization.message);default:return n.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case k.NONE:case k.CHECKING:return n.createElement("div",null);case k.AUTHORIZED:return n.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case k.UNAUTHORIZED:return n.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},n.createElement("p",null,"Not authorized!"));case k.ERROR:return n.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},n.createElement("p",null,"Error: ??"));default:return n.createElement("div",null)}}},{key:"render",value:function(){return n.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(n.Component)),ar=r(91),ir="",or="api/V2/token",sr="api/V2/me",cr=function(){function e(t){var r=t.url;Object(s.a)(this,e),this.url=r}return Object(c.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([ir]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([or]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([sr]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function lr(e){return{type:Z.AUTH_CHECK_ERROR,error:e}}function ur(e,t,r,n){return{type:Z.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function Er(){return{type:Z.AUTH_UNAUTHORIZED}}function mr(){return function(e,t){e({type:Z.AUTH_CHECK_START});var r=ar.get("kbase_session");if(r){var n=new cr({url:"/services/auth"});Promise.all([n.getTokenInfo(r),n.getMe(r)]).then(function(t){var n=Object(Ne.a)(t,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(ur(r,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(lr({code:"error",message:t.message}))})}else e(Er())}}var dr=Object(h.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(mr())},onRemoveAuthorization:function(){e(function(e,t){ar.remove("kbase_session"),e(Er())})},onAddAuthorization:function(t){e(function(e){return function(t,r){ar.set("kbase_session",e);var n=new cr({url:"/services/auth"});Promise.all([n.getTokenInfo(e),n.getMe(e)]).then(function(r){var n=Object(Ne.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(ur(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(lr({code:"error",message:e.message}))})}}(t))}}})(nr),pr=r(71),vr=r.n(pr),hr=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(s.a)(this,e),this.name=r,this.onSuccess=n,this.onError=a},Rr=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).started=new Date,r.timeout=e.timeout||5e3,r}return Object(E.a)(t,e),t}(hr),fr=function(){function e(t){var r=t.name,n=t.payload,a=t.channel;Object(s.a)(this,e),this.name=r,this.payload=n,this.id=vr()(),this.created=new Date,this.channel=a,this.envelope=null}return Object(c.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channel:this.channel},name:this.name,payload:this.payload}}}]),e}(),Or=function(){function e(t){if(Object(s.a)(this,e),this.window=t.window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||vr()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(c.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",e));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new hr({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new fr({name:e,payload:t,channel:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new fr({name:e,payload:t,channel:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,o=function(){var r=i.value,n=(c=Object(Ne.a)(r,2))[0];0===c[1].filter(function(e){if(e instanceof Rr){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},s=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c;o()}}catch(l){n=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new Rr({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new Rr({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),gr=function(){function e(){Object(s.a)(this,e),this.params=null,this.channel=new Or({window:window,host:document.location.origin})}return Object(c.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:vr()(),params:{groupsServiceURL:"services/groups",userProfileServiceURL:"services/user_profile/rpc",workspaceServiceURL:"services/ws",serviceWizardURL:"services/service_wizard"},parentHost:document.location.origin}}}]),e}(),Sr=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}}]),e}();function _r(e){return{type:Z.APP_SUCCESS,config:e}}r(273);var Ar=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).props.onAppStart(),r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.props.status===x.NONE?n.createElement("div",{className:"KBaseIntegration"},"Loading..."):n.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(n.Component);var Nr=Object(h.b)(function(e,t){return{status:e.app.status}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new Sr).getParamsFromIFrame();if(r)e(_r({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL}}}));else{var n=(new gr).getParamsFromIFrame();e(_r({baseUrl:"",services:{Groups:{url:n.params.groupsServiceURL},UserProfile:{url:n.params.userProfileServiceURL},Workspace:{url:n.params.workspaceServiceURL},ServiceWizard:{url:n.params.serviceWizardURL}}}))}})}}})(Ar);function Tr(e){return function(t,r){t({type:Z.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});Promise.all([c.grantViewAccess(e)]).then(function(e){var r=Object(Ne.a)(e,1)[0];t(function(e){return{type:Z.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,request:e}}(r))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,error:r}))})}}function wr(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});Promise.all([c.getOrg(e),c.getPendingOrganizationRequests(e)]).then(function(e){var r=Object(Ne.a)(e,2),n=r[0],a=r[1];t(function(e,t){return{type:Z.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,organization:e,requests:t}}(n,a))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,error:r}))})}}function Ir(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.manageOrganizationRequestsView,c=n.app.config,l=new xe({token:i,username:o,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url});s&&Promise.all([l.acceptRequest(e)]).then(function(e){var r=Object(Ne.a)(e,1)[0];t(function(e){return{type:Z.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,request:e}}(r)),s.viewState&&t(wr(s.viewState.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,error:r}))})}}function yr(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.manageOrganizationRequestsView,c=n.app.config,l=new xe({token:i,username:o,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url});s&&Promise.all([l.denyRequest(e)]).then(function(e){var r=Object(Ne.a)(e,1)[0];t(function(e){return{type:Z.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,request:e}}(r)),s.viewState&&t(wr(s.viewState.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,error:r}))})}}function Dr(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.manageOrganizationRequestsView,c=n.app.config,l=new xe({token:i,username:o,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url});s&&Promise.all([l.cancelRequest(e)]).then(function(e){var r=Object(Ne.a)(e,1)[0];t(function(e){return{type:Z.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS,request:e}}(r)),s.viewState&&t(wr(s.viewState.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,error:r}))})}}r(275);var br=r(296),Ur=(r(277),function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.createElement("div",{className:"User"},n.createElement("div",{className:"avatarCol"},n.createElement(Mt,{user:this.props.user,size:this.props.avatarSize||30})),n.createElement("div",{className:"infoCol"},n.createElement("div",{className:"name"},n.createElement("a",{href:"#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),n.createElement("div",{className:"organization"},this.props.user.organization||n.createElement("i",null,"no organization in user profile")),n.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||n.createElement("i",null,"no location information in user profile"))))}}]),t}(n.Component)),Cr=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){ve.a.info({title:"Manage Requests Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,n.createElement(A.a,{type:"tool"})," ",n.createElement("span",{style:{fontSize:"120%"}},"Managing Requests"),' for Org "',this.props.viewState.organization.name,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToBrowser.bind(this)},"Return to Orgs Browser"),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}))))}},{key:"renderLoadingHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,"Loading Org Editor..."))))}},{key:"niceElapsed",value:function(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),o=Math.abs(i);if(o<7776e3){if(0===o)return"now";o<60?(t=i,r=o,n="second"):o<3600?(t=Math.round(i/60),r=Math.round(o/60),n="minute"):o<86400?(t=Math.round(i/3600),r=Math.round(o/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(o/86400),n="day"),r>1&&(n+="s");var s=null,c=null;return t<0?s="in":t>0&&(c="ago"),(s?s+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=n.createElement("span",null,n.createElement(A.a,{type:"user"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"team"})," ","Request to Join Group"),a=[n.createElement(he.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),n.createElement(he.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return n.createElement(Ut.a,{key:e.id,title:r,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"from"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.requester,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=n.createElement("span",null,n.createElement(A.a,{type:"team"}),n.createElement(A.a,{type:"mail"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"user"})," ","Invitation to Join Group"),a=[n.createElement(he.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e.id)}},"Cancel")];return n.createElement(Ut.a,{key:e.id,title:r,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"invitation to"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.user,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case F.NONE:return"None";case F.READ:return"View Only";case F.WRITE:return"Edit";case F.ADMIN:return"Admin";case F.OWN:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,a=n.createElement("span",null,n.createElement(A.a,{type:"file"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"team"})," ","Request to Add Narrative"),i=[n.createElement(he.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e.id)}},"Approve"),n.createElement(he.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e.id)}},"Deny")];return t=e.narrative?n.createElement("div",null,n.createElement("div",null,n.createElement("a",{href:"/narrative/ws."+e.narrative.workspaceId+".obj.1",target:"_blank"},e.narrative.title)),n.createElement("div",null,n.createElement("span",{className:"field-label"},"your access")," ",this.renderNarrativePermission(e.narrative.permission)),n.createElement("div",null,n.createElement("span",{className:"field-label"},"public?")," ",e.narrative.isPublic?"yes":"no")):n.createElement("span",null,"You don't have access to this narrative"," ",n.createElement(he.a,{onClick:function(){r.onGetViewAccess.call(r,e.id)}},"Click for View Access")),n.createElement(Ut.a,{key:e.id,title:a,hoverable:!0,actions:i,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"from"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.requester,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"workspace"),n.createElement("td",{className:"workspace"},e.workspace)),n.createElement("tr",null,n.createElement("th",null,"narrative"),n.createElement("td",{className:"narrative"},t)),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=n.createElement("span",null,n.createElement(A.a,{type:"appstore"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"team"})," ","Request to Add App"),a=[n.createElement(he.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),n.createElement(he.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return n.createElement(Ut.a,{key:e.id,title:r,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"from"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.requester,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"app"),n.createElement("td",{className:"requester"},e.app)),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequest",value:function(e){switch(e.type){case b.REQUEST:switch(e.resourceType){case U.USER:return this.renderRequestJoinRequest(e);case U.WORKSPACE:return this.renderRequestNarrativeRequest(e);case U.APP:return this.renderRequestAppRequest(e);default:throw new Error("Unsupported resource type: "+e.resourceType)}case b.INVITATION:switch(e.resourceType){case U.USER:return this.renderRequestJoinInvitation(e);case U.WORKSPACE:throw new Error("Workspace invitations are not supported");case U.APP:throw new Error("App invitations are not supported");default:throw new Error("Unsupported resource type: "+e.resourceType)}}}},{key:"renderRequests",value:function(){var e=this,t=this.props.viewState.organization.adminRequests.filter(function(e){return e.type===b.REQUEST});return 0===t.length?n.createElement(T.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending requests for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"renderInvitations",value:function(){var e=this,t=this.props.viewState.organization.adminRequests.filter(function(e){return e.type===b.INVITATION});return 0===t.length?n.createElement(T.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending invitations for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"render",value:function(){if(this.state.cancelToBrowser)return n.createElement(br.a,{push:!0,to:"/organizations"});if(this.state.cancelToViewer)return n.createElement(br.a,{push:!0,to:"/viewOrganization/"+this.props.viewState.organization.id});var e=this.props.viewState.organization.adminRequests.filter(function(e){return e.type===b.INVITATION}).length,t=this.props.viewState.organization.adminRequests.filter(function(e){return e.type===b.REQUEST}).length;return n.createElement("div",{className:"ManageGroupRequests"},this.renderHeader(),n.createElement(Lt,{organization:this.props.viewState.organization}),n.createElement("div",{className:"row"},n.createElement("div",{className:"pendingCol"},n.createElement("h2",null,"Requests (",t,")"),n.createElement("div",{className:"pendingRequests"},this.renderRequests())),n.createElement("div",{className:"historyCol"},n.createElement("h2",null,"Invitations (",e,")"),this.renderInvitations())))}}]),t}(n.Component);var kr=Object(h.b)(function(e,t){var r=e.manageOrganizationRequestsView;if(!r.viewState)throw new Error("view state not loaded!");return{viewState:r.viewState}},function(e){return{onAcceptJoinRequest:function(t){e(Ir(t))},onDenyJoinRequest:function(t){e(yr(t))},onCancelJoinInvitation:function(t){e(Dr(t))},onGetViewAccess:function(t){e(Tr(t))}}})(Cr),Mr=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return n.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.loadingState){case W.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case W.LOADING:return this.renderLoading();case W.SUCCESS:return n.createElement(kr,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(n.Component);var Vr=Object(h.b)(function(e,t){return{loadingState:e.manageOrganizationRequestsView.state}},function(e){return{onLoad:function(t){e(wr(t))},onUnload:function(){e({type:Z.ADMIN_MANAGE_REQUESTS_UNLOAD})}}})(Mr);function zr(e){return function(t,r){t({type:Z.VIEW_MEMBERS_LOAD_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config;new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).getOrg(e).then(function(e){var r;t((r=e,{type:Z.VIEW_MEMBERS_LOAD_SUCCESS,organization:r}))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.VIEW_MEMBERS_LOAD_ERROR,error:r}))})}}function Gr(e){return function(t,r){t({type:Z.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.viewMembersView.view;if(null===c)throw new Error("view is not populated");new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:Z.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function jr(e){return function(t,r){t({type:Z.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.viewMembersView.view;if(null===c)throw new Error("view is not populated");new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:Z.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function Lr(e){return function(t,r){t({type:Z.VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.viewMembersView.view;if(null===c)throw new Error("view is not populated");new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).removeMember(c.organization.id,e).then(function(){t({type:Z.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS}),t(zr(c.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(133);var Pr=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={over:!1},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderPromoteButton",value:function(){var e=this;switch(this.props.member.type){case y.MEMBER:return n.createElement(he.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onPromoteMemberToAdmin(e.props.member.user.username)}},n.createElement(A.a,{type:"unlock"}),"Promote to Admin");case y.ADMIN:return n.createElement(he.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onDemoteAdminToMember(e.props.member.user.username)}},n.createElement(A.a,{type:"user"}),"Demote to Member");case y.OWNER:return}}},{key:"renderMemberButtons",value:function(e){var t=this;if(this.props.organization.relation.type===D.OWNER||this.props.organization.relation.type===D.ADMIN)return n.createElement("div",null,n.createElement("div",null,n.createElement(he.a,{type:"danger",disabled:!this.state.over,style:{width:"100%"},onClick:function(){t.props.onRemoveMember(e.user.username)}},n.createElement(A.a,{type:"delete"}),"Remove from Org")),n.createElement("div",null,this.renderPromoteButton()))}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.props.onRemoveMember(t.username)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=n.createElement(Ct.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e.user)}},n.createElement(Ct.a.Item,{key:"promoteToAdmin"},n.createElement(A.a,{type:"unlock"}),"Promote to Admin"),n.createElement(Ct.a.Item,{key:"removeMember"},n.createElement(A.a,{type:"delete"}),"Remove Member"));return n.createElement("div",null,n.createElement(kt.a,{overlay:r,trigger:["click"]},n.createElement(he.a,{icon:"ellipsis"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=n.createElement(Ct.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e.user)}},n.createElement(Ct.a.Item,{key:"demoteToMember"},n.createElement(A.a,{type:"user"}),"Demote to Member"));return n.createElement("div",null,n.createElement(kt.a,{overlay:r,trigger:["click"]},n.createElement(he.a,{icon:"ellipsis"})))}},{key:"renderOwnerMenu",value:function(e){}},{key:"renderMemberOptions",value:function(e){if(this.props.organization.relation.type===D.OWNER||this.props.organization.relation.type===D.ADMIN)switch(this.props.member.type){case y.OWNER:return this.renderOwnerMenu(e);case y.ADMIN:return this.renderAdminMenu(e);case y.MEMBER:return this.renderMemberMenu(e)}}},{key:"onMouseOver",value:function(){this.setState({over:!0})}},{key:"onMouseOut",value:function(){this.setState({over:!1})}},{key:"render",value:function(){return n.createElement("div",{key:this.props.member.user.username,className:"memberRow",onMouseEnter:this.onMouseOver.bind(this),onMouseLeave:this.onMouseOut.bind(this)},n.createElement("div",{style:{flex:"1 1 0px"}},n.createElement(Vt,{member:this.props.member,avatarSize:50,key:this.props.member.user.username})),n.createElement("div",{style:{flex:"0 0 10em",textAlign:"right"}},this.renderMemberOptions(this.props.member)))}}]),t}(n.Component);r(280);function xr(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),o=Math.abs(i);if(o<7776e3){if(0===o)return"now";o<60?(t=i,r=o,n="second"):o<3600?(t=Math.round(i/60),r=Math.round(o/60),n="minute"):o<86400?(t=Math.round(i/3600),r=Math.round(o/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(o/86400),n="day"),r>1&&(n+="s");var s=null,c=null;return t<0?s="in":t>0&&(c="ago"),(s?s+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var qr=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderRequestJoinRequest",value:function(e){var t=n.createElement("span",null,n.createElement(A.a,{type:"user"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"team"})," ","Request to Join Group");return n.createElement(Ut.a,{key:e.id,title:t,hoverable:!0,actions:[],headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"from"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.requester,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",xr(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=n.createElement("span",null,n.createElement(A.a,{type:"team"}),n.createElement(A.a,{type:"mail"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"user"})," ","Invitation to Join Group");return n.createElement(Ut.a,{key:e.id,title:t,hoverable:!0,actions:[],headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"invitation to"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.user,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",xr(e.expireAt),")")))))}},{key:"renderRequestNarrativeRequest",value:function(e){var t=n.createElement("span",null,n.createElement(A.a,{type:"file"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"team"})," ","Request to Add Narrative");return n.createElement(Ut.a,{key:e.id,title:t,hoverable:!0,actions:[],headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"from"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.requester,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"narrative"),n.createElement("td",{className:"narrative"},e.workspace)),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",xr(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=n.createElement("span",null,n.createElement(A.a,{type:"appstore"}),n.createElement(A.a,{type:"arrow-right"}),n.createElement(A.a,{type:"team"})," ","Request to Add App");return n.createElement(Ut.a,{key:e.id,title:t,hoverable:!0,actions:[],headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},n.createElement("table",{className:"pendingRequestsTable"},n.createElement("tbody",null,n.createElement("tr",null,n.createElement("th",null,"from"),n.createElement("td",{className:"requester"},n.createElement(Ur,{user:e.requester,avatarSize:50}))),n.createElement("tr",null,n.createElement("th",null,"app"),n.createElement("td",{className:"requester"},e.app)),n.createElement("tr",null,n.createElement("th",null,"sent"),n.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),n.createElement("tr",null,n.createElement("th",null,"expires"),n.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",xr(e.expireAt),")")))))}},{key:"renderRequest",value:function(){var e=this.props.request;switch(e.type){case b.REQUEST:switch(e.resourceType){case U.USER:return this.renderRequestJoinRequest(e);case U.WORKSPACE:return this.renderRequestNarrativeRequest(e);case U.APP:return this.renderRequestAppRequest(e);default:throw new Error("Unsupported resource type: "+e.resourceType)}case b.INVITATION:switch(e.resourceType){case U.USER:return this.renderRequestJoinInvitation(e);case U.WORKSPACE:throw new Error("Workspace invitations are not supported");case U.APP:throw new Error("App invitations are not supported");default:throw new Error("Unsupported resource type: "+e.resourceType)}}}},{key:"render",value:function(){return n.createElement("div",{className:"Request"},this.renderRequest())}}]),t}(n.Component),Wr=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onPromoteMemberToAdmin",value:function(e){this.props.onPromoteMemberToAdmin(e)}},{key:"onDemoteAdminToMember",value:function(e){this.props.onDemoteAdminToMember(e)}},{key:"onShowInfo",value:function(){ve.a.info({title:"View Members Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the view members tool..."))})}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.organization.relation.type===D.OWNER||this.props.organization.relation.type===D.ADMIN||this.props.organization.relation.type===D.MEMBER)}},{key:"isAdmin",value:function(){return!!this.props.organization&&(this.props.organization.relation.type===D.OWNER||this.props.organization.relation.type===D.ADMIN)}},{key:"renderHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,n.createElement(A.a,{type:"tool"})," ",'Viewing Members for Org "',this.props.organization.name,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToBrowser.bind(this)},"Return to Orgs Browser"),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}))))}},{key:"renderMembersToolbar",value:function(){switch(this.props.organization.relation.type){case D.NONE:return n.createElement("div",{className:"toolbar"},n.createElement(he.a,null,n.createElement(A.a,{type:"plus"}),"Join"));case D.MEMBER:return n.createElement("div",{className:"toolbar"});case D.ADMIN:case D.OWNER:return n.createElement("div",{className:"toolbar"},n.createElement(_.a,{to:"/inviteUser/"+this.props.organization.id},n.createElement(he.a,null,n.createElement(A.a,{type:"mail"})," Invite a User")))}}},{key:"renderMembers",value:function(){var e,t=this;return this.isMember()?(e=0===this.props.organization.members.length?n.createElement("p",{className:"message"},"This organization has no members"):this.props.organization.members.map(function(e){return n.createElement(n.Fragment,{key:e.user.username},n.createElement(Pr,{member:e,organization:t.props.organization,onPromoteMemberToAdmin:t.props.onPromoteMemberToAdmin,onDemoteAdminToMember:t.props.onDemoteAdminToMember,onRemoveMember:t.props.onRemoveMember}))}),n.createElement("div",{className:"table infoTable"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col0",style:{display:"flex",flexDirection:"column",overflowY:"auto"}},e)))):n.createElement("p",{className:"message"},"Sorry, group membership restricted to members only")}},{key:"renderPendingMembers",value:function(){if(!this.isAdmin())return n.createElement(T.a,{type:"info",showIcon:!0,message:"Sorry, pending group membership restricted to admin members only"});var e=this.props.organization.adminRequests.filter(function(e){return e.resourceType===U.USER});return 0===e.length?n.createElement(T.a,{type:"info",message:"No pending member requests or invitations"}):e.map(function(e){return n.createElement("div",{key:e.id},n.createElement(qr,{request:e}))})}},{key:"renderAdminsToolbar",value:function(){return n.createElement("div",{className:"toolbar"})}},{key:"renderAdminButtons",value:function(e){var t=this;if(this.props.organization.relation.type===D.OWNER||this.props.organization.relation.type===D.ADMIN)return n.createElement("div",null,n.createElement("div",null,n.createElement(he.a,{type:"danger",style:{width:"100%"}},n.createElement(A.a,{type:"delete"}),"Remove from Org")),n.createElement("div",null,n.createElement(he.a,{style:{width:"100%"},onClick:function(){t.onDemoteAdminToMember.call(t,e.user.username)}},n.createElement(A.a,{type:"user"}),"Demote to Member")))}},{key:"renderAdmins",value:function(){var e,t=this,r=this.props.organization.members.filter(function(e){return e.type===y.ADMIN});return e=0===r.length?n.createElement("p",{style:{fontStyle:"italic",textAlign:"center"}},"This organization has no admins"):r.map(function(e){return n.createElement("div",{key:e.user.username,style:{flex:"0 0 auto",display:"flex",flexDirection:"row"}},n.createElement("div",{style:{flex:"1 1 0px"}},n.createElement(Vt,{member:e,avatarSize:50,key:e.user.username})),n.createElement("div",{style:{flex:"0 0 10em"}},t.renderAdminButtons(e)))}),n.createElement("div",{className:"table infoTable"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col0",style:{display:"flex",flexDirection:"column",overflowY:"auto"}},e)))}},{key:"renderOrganizationHeader",value:function(){return n.createElement(Lt,{organization:this.props.organization})}},{key:"componentWillUnmount",value:function(){this.props.onViewMembersUnload()}},{key:"render",value:function(){return this.state.cancelToBrowser?n.createElement(br.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?n.createElement(br.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):n.createElement("div",{className:"ViewMembers"},this.renderHeader(),this.renderOrganizationHeader(),n.createElement("div",{className:"body"},n.createElement("div",{className:"membersCol"},n.createElement("h2",null,"Members"),this.renderMembersToolbar(),this.renderMembers()),n.createElement("div",{className:"otherCol"},n.createElement("h2",null,"Pending Members"),this.renderAdminsToolbar(),n.createElement("p",null,"This space to provide a list of user requests and invitations. This will allow this view to provide all user management tools in one place."),n.createElement("p",null,"In progress... currently renders the requests but does not provide actions (buttons)."),this.renderPendingMembers())))}}]),t}(n.Component);var Hr=Object(h.b)(function(e,t){if(!e.viewMembersView||null===e.viewMembersView.view)throw new Error("Runtime Error - view members view is not defined!");return{organization:e.viewMembersView.view.organization}},function(e){return{onViewMembersUnload:function(){e({type:Z.VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(Gr(t))},onDemoteAdminToMember:function(t){e(jr(t))},onRemoveMember:function(t){e(Lr(t))}}})(Wr),Br=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return n.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.state){case H.NONE:return this.props.onViewMembersLoad(this.props.organizationId),this.renderLoading();case H.LOADING:return this.renderLoading();case H.SUCCESS:return n.createElement(Hr,null)}}}]),t}(n.Component);var Qr=Object(h.b)(function(e,t){return{state:e.viewMembersView.state}},function(e){return{onViewMembersLoad:function(t){e(zr(t))}}})(Br);function Jr(e){return function(t,r){t({type:Z.INVITE_USER_LOAD_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});Promise.all([c.getOrg(e),null]).then(function(e){var r,n=Object(Ne.a)(e,2),a=n[0];n[1];t((r=a,{type:Z.INVITE_USER_LOAD_READY,organization:r,users:null}))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.INVITE_USER_LOAD_ERROR,error:r}))})}}function Fr(e){return{type:Z.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Yr(e){return function(t,r){if(t({type:Z.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){var n=r(),a=n.inviteUserView.value,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config;if(null!==a){var l=a.organization,u=new xe({token:o,username:s,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}),E=l.owner.user.username,m=[],d=[],p=[],v=[];l.members.forEach(function(e){switch(e.type){case y.MEMBER:d.push(e.user.username);case y.ADMIN:m.push(e.user.username)}}),l.adminRequests.forEach(function(e){if(e.resourceType===U.USER)switch(e.type){case b.INVITATION:p.push(e.user.username);break;case b.REQUEST:v.push(e.requester.username)}}),Promise.all([u.searchUsers(e)]).then(function(e){var r=Object(Ne.a)(e,1)[0].map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===E?D.OWNER:m.indexOf(t)>=0?D.ADMIN:p.indexOf(t)>=0?D.MEMBER_INVITATION_PENDING:v.indexOf(t)>=0?D.MEMBER_REQUEST_PENDING:d.indexOf(t)>=0?D.MEMBER:D.NONE}});t(Fr(r))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.INVITE_USER_SEARCH_USERS_ERROR,error:r}))})}}else t(Fr(null))}}function Kr(e){return{type:Z.INVITE_USER_SELECT_USER_ERROR,error:e}}function Zr(e,t){var r=e;return r.resourceType===U.USER&&r.type===b.REQUEST&&r.requester.username===t}function Xr(e,t){var r=e;return!(r.resourceType!==U.USER||r.type!==b.INVITATION||!r.user||r.user.username!==t)}function $r(e){return function(t,r){t({type:Z.INVITE_USER_SELECT_USER_START});var n=r(),a=n.inviteUserView.value,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config;a?new xe({token:o,username:s,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}).getUser(e).then(function(e){var r=function(e,t){if(e.username===t.owner.user.username)return D.OWNER;var r=t.members.find(function(t){return t.user.username===e.username});if(r)switch(r.type){case y.ADMIN:return D.ADMIN;case y.OWNER:return D.OWNER;case y.MEMBER:return D.MEMBER}var n=!0,a=!1,i=void 0;try{for(var o,s=t.adminRequests[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;if(Xr(c,e.username))return D.MEMBER_INVITATION_PENDING;if(Zr(c,e.username))return D.MEMBER_REQUEST_PENDING}}catch(l){a=!0,i=l}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return D.VIEW}(e,a.organization);t(function(e,t){return{type:Z.INVITE_USER_SELECT_USER_SUCCESS,user:e,relation:t}}(e,r))}).catch(function(e){t(Kr({code:e.name,message:e.message}))}):t(Kr({code:"invalid state",message:"select user invalid state -- no view value"}))}}function en(){return function(e,t){e({type:Z.INVITE_USER_SEND_INVITATION_START});var r=t(),n=r.auth.authorization,a=n.token,i=n.username,o=r.app.config,s=r.inviteUserView,c=s.loadingState,l=s.value;s.error;if(c===W.SUCCESS&&null!==l){var u=l,E=u.selectedUser,m=u.organization.id;if(E)new xe({token:a,username:i,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url,workspaceServiceURL:o.services.Workspace.url,serviceWizardURL:o.services.ServiceWizard.url}).requestJoinGroup(m,E.user.username).then(function(t){e({type:Z.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){var r;e((r={code:t.name,message:t.message},{type:Z.INVITE_USER_SEND_INVITATION_ERROR,error:r}))})}}}r(282);var tn=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).lastSearchAt=null,r.searchInput=n.createRef(),r.searchButton=n.createRef(),r.state={cancelToViewMembers:!1,cancelToBrowser:!1,cancelToViewer:!1,autocompleteMessage:""},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"onClickCancelToViewMembers",value:function(){this.setState({cancelToViewMembers:!0})}},{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"onShowInfo",value:function(){ve.a.info({title:"Invite User Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the invite user tool..."))})}},{key:"renderHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,n.createElement(A.a,{type:"mail"})," ",'Invite a User to join Org "',this.props.organization.name,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewMembers.bind(this)},"Return to Org Members"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToBrowser.bind(this)},"Return to Orgs Browser"),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}))))}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return n.createElement(T.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?n.createElement(T.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===D.NONE?n.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},n.createElement("div",{className:"name "},t.realname," (",t.username,")")):n.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},n.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return n.createElement("div",{className:"orgInfo"},n.createElement("div",{className:"name"},n.createElement("span",{className:"field-label"},"name"),n.createElement("span",null,this.props.organization.name)),n.createElement("div",{className:"description"},n.createElement("span",{className:"field-label"},"description"),n.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===D.VIEW?e=n.createElement(he.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=n.createElement(he.a,{disabled:!0,type:"primary"},"Send Invitation"),t=n.createElement("div",null,"User may not be invited because:",n.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=n.createElement(T.a,{type:"warning",message:t,showIcon:!0})):(e=n.createElement(he.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),n.createElement("div",{className:"invitationForm"},n.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),n.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.state){case Q.NONE:return n.createElement("div",null,"NONE");case Q.EDITING:return n.createElement("div",null,"EDITING");case Q.SENDABLE:return n.createElement("div",null,"SENDABLE");case Q.SENDING:return n.createElement("div",null,"SENDING");case Q.SUCCESS:return n.createElement("div",null,"SENT SUCCESSFULLY");case Q.ERROR:return n.createElement("div",null,"ERROR SENDING");default:return n.createElement("div",null,"Bad State")}}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return n.createElement(Lt,{organization:this.props.organization})}},{key:"renderRelation",value:function(e){switch(e){case D.NONE:return n.createElement("span",null,n.createElement(A.a,{type:"stop"}),"None");case D.VIEW:return n.createElement("span",null,n.createElement(A.a,{type:"stop"})," Not a member");case D.MEMBER_REQUEST_PENDING:return n.createElement("span",null,n.createElement(A.a,{type:"user",style:{color:"orange"}})," User's membership ",n.createElement("b",null,"request")," is pending");case D.MEMBER_INVITATION_PENDING:return n.createElement("span",null,n.createElement(A.a,{type:"user",style:{color:"blue"}})," User has been ",n.createElement("b",null,"invited")," to join");case D.MEMBER:return n.createElement("span",null,n.createElement(A.a,{type:"user"})," User is a ",n.createElement("b",null,"member")," of this organization");case D.ADMIN:return n.createElement("span",null,n.createElement(A.a,{type:"unlock"}),"User is an ",n.createElement("b",null,"admin")," of this organization");case D.OWNER:return n.createElement("span",null,n.createElement(A.a,{type:"crown"})," User is the ",n.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?n.createElement("div",{className:"selectedUser"},n.createElement("p",{className:"noSelection"},"No user yet selected")):n.createElement("div",{className:"selectedUser"},n.createElement(Ur,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return n.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return n.createElement(A.a,{type:"search"})}},{key:"render",value:function(){return this.state.cancelToViewMembers?n.createElement(v.a,{push:!0,to:"/viewMembers/"+this.props.organization.id}):this.state.cancelToBrowser?n.createElement(v.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?n.createElement(v.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):n.createElement("div",{className:"InviteUser scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),n.createElement("div",{className:"row scrollable-flex-column"},n.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},n.createElement("h3",null,"Select User to Invite"),n.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},n.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),n.createElement(he.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),n.createElement("div",{className:"usersTable"},this.renderUsers())),n.createElement("div",{className:"col1 lastCol"},n.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(n.Component);tn.searchDebounce=200;var rn=tn;var nn=Object(h.b)(function(e,t){return{organization:e.inviteUserView.value.organization,users:e.inviteUserView.value.users,selectedUser:e.inviteUserView.value.selectedUser,state:e.inviteUserView.value.editState}},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(Yr({query:r,excludedUsers:n}))},onSelectUser:function(t){e($r(t))},onSendInvitation:function(){e(en())}}})(rn),an=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return n.createElement("div",null,"Loading Users...")}},{key:"renderError",value:function(){return n.createElement("div",null,"Error!")}},{key:"render",value:function(){switch(this.props.loadingState){case W.NONE:return this.props.onInviteUserLoad(this.props.organizationId),this.renderLoading();case W.LOADING:return this.renderLoading();case W.ERROR:return this.renderError();case W.SUCCESS:return n.createElement(nn,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(n.Component);var on=Object(h.b)(function(e,t){return{loadingState:e.inviteUserView.loadingState}},function(e){return{onInviteUserLoad:function(t){e(Jr(t))},onUnload:function(){e({type:Z.INVITE_USER_UNLOAD})}}})(an),sn=(r(284),function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"doCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"doCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"doShowInfo",value:function(){ve.a.info({title:"Manage My Membership Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the view to help you manage your membership..."))})}},{key:"renderHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,n.createElement(A.a,{type:"tool"})," ",'Managing your membership in the Organization "',this.props.organization.name,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.doCancelToViewer.bind(this)},"Return to this Org"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.doCancelToBrowser.bind(this)},"Return to Orgs Browser"),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}))))}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return n.createElement(Lt,{organization:this.props.organization})}},{key:"render",value:function(){return this.state.cancelToBrowser?n.createElement(v.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?n.createElement(v.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):n.createElement("div",{className:"ManageMembership"},this.renderHeader(),this.renderOrgHeader(),n.createElement("div",{className:"body"},n.createElement("div",{className:"col1"},n.createElement("div",null,"editing area here")),n.createElement("div",{className:"col2"},n.createElement("div",null,"org user profile here"))))}}]),t}(n.Component));function cn(e,t){return function(t,r){t({type:Z.MANAGE_MEMBERSHIP_LOAD_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config;new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url}).getOrg(e).then(function(e){var r;t((r=e,{type:Z.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:r}))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Z.MANAGE_MEMBERSHIP_LOAD_ERROR,error:r}))})}}var ln=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return n.createElement("div",null,"Loading...")}},{key:"renderError",value:function(e){return n.createElement("div",null,"Error: ",e.message)}},{key:"render",value:function(){return this.props.view.loading?this.renderLoading():this.props.view.error?this.renderError(this.props.view.error):this.props.view.value?n.createElement(sn,{organization:this.props.view.value.organization}):(this.props.onLoad(this.props.organizationId),this.renderLoading())}}]),t}(n.Component);var un,En=Object(h.b)(function(e,t){return{view:e.manageMembershipView}},function(e){return{onLoad:function(t){e(cn(t))}}})(ln);r(286);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(un||(un={}));var mn=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={navigateTo:un.NONE},r}return Object(E.a)(t,e),Object(c.a)(t,[{key:"doCancelToBrowser",value:function(){this.setState({navigateTo:un.BROWSER})}},{key:"doCancelToViewer",value:function(){this.setState({navigateTo:un.VIEWER})}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doShowInfo",value:function(){ve.a.info({title:"Request to Add Narrative Help",width:"50em",content:n.createElement("div",null,n.createElement("p",null,"This is the view to help you request the addition of a narrative to this org..."))})}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return n.createElement(Lt,{organization:this.props.organization})}},{key:"renderHeader",value:function(){return n.createElement(Oe,null,n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},n.createElement("div",{style:{flex:"0 0 auto"}},n.createElement("span",null,n.createElement(A.a,{type:"tool"})," ",'Managing your membership in the Organization "',this.props.organization.name,'"')),n.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.doCancelToViewer.bind(this)},"Return to this Org"),n.createElement(he.a,{icon:"undo",type:"danger",onClick:this.doCancelToBrowser.bind(this)},"Return to Orgs Browser"),n.createElement(he.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}))))}},{key:"renderNarratives",value:function(){var e=this;return this.props.narratives.map(function(t,r){return t.status===J.ASSOCIATED?n.createElement("div",{className:"narrative narrativeInOrg",onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},n.createElement("div",{className:"title"},t.title||"n/a"," (associated)")):t.status===J.REQUESTED?n.createElement("div",{className:"narrative narrativeInOrg",onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},n.createElement("div",{className:"title"},t.title||"n/a"," (request pending)")):n.createElement("div",{className:"narrative narrativeNotInOrg",onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},n.createElement("div",{className:"title"},t.title||"n/a"))})}},{key:"renderSelectNarrative",value:function(){return n.createElement("div",{className:"narrativeSelector scrollable-flex-column"},n.createElement("div",{className:"narratives scrollable-flex-column"},n.createElement("div",{className:"narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===J.ASSOCIATED?n.createElement("i",null,"This Narrative is associated with this Organization"):this.props.selectedNarrative.status===J.REQUESTED?n.createElement("i",null,"You have requested to associate this Narrative with this Organization"):(e=this.props.organization.relation.type===D.ADMIN||this.props.organization.relation.type===D.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",n.createElement(he.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?n.createElement("div",{className:"selectedNarrative"},n.createElement("div",{className:"title"},this.props.selectedNarrative.title),n.createElement("div",null,n.createElement("i",null,"last modified")," ",Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.selectedNarrative.modifiedAt))):n.createElement("div",null,n.createElement("i",null,"Select a narrative on the left to show it here and be able to add it to this organization."))}},{key:"render",value:function(){switch(this.state.navigateTo){case un.BROWSER:return n.createElement(v.a,{push:!0,to:"/organizations"});case un.VIEWER:return n.createElement(v.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id});case un.NONE:}return n.createElement("div",{className:"RequestNarrative scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),n.createElement("div",{className:"body scrollable-flex-column"},n.createElement("div",{className:"selectNarrativeCol scrollable-flex-column"},n.createElement("h3",null,"Select a Narrative"),this.renderSelectNarrative()),n.createElement("div",{className:"selectedNarrativeCol"},n.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),n.createElement("div",{className:"selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),n.createElement("div",{className:"footer"}))}}]),t}(n.Component);function dn(e){return function(t,r){t({type:Z.REQUEST_ADD_NARRATIVE_LOAD_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});Promise.all([c.getOrg(e),c.getOwnNarratives(e)]).then(function(e){var r=Object(Ne.a)(e,2),n=r[0],a=r[1];t(function(e,t){return{type:Z.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:e,narratives:t}}(n,a))}).catch(function(e){var r;console.error("loading error",e),t((r={code:e.name,message:e.message},{type:Z.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:r}))})}}function pn(e){return function(t,r){t({type:Z.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config;new xe({token:i,username:o,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url,serviceWizardURL:s.services.ServiceWizard.url});t(function(e){return{type:Z.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}function vn(e,t){return function(r,n){r({type:Z.REQUEST_ADD_NARRATIVE_SEND_START});var a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new xe({token:o,username:s,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url});Promise.all([l.addOrRequestNarrativeToGroup(e,t)]).then(function(e){var t=Object(Ne.a)(e,1)[0];r(function(e){return{type:Z.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:e}}(t))}).catch(function(e){var t;console.error("loading error",e),r((t={code:e.name,message:e.message},{type:Z.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:t}))})}}var hn=Object(h.b)(function(e,t){var r=e.requestNarrativeView;if(null===r.value)throw new Error("view value is not defined!");return{organization:r.value.organization,narratives:r.value.narratives,selectedNarrative:r.value.selectedNarrative}},function(e){return{doSendRequest:function(t,r){e(vn(t,r))},doSelectNarrative:function(t){e(pn(t))}}})(mn),Rn=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"renderLoading",value:function(){return n.createElement("div",null,"Loading Your Narratives...")}},{key:"renderError",value:function(e){return n.createElement("div",null,"Error!",n.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.status){case Y.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case Y.LOADING:return this.renderLoading();case Y.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return n.createElement(hn,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(n.Component);var fn=Object(h.b)(function(e,t){return{view:e.requestNarrativeView}},function(e){return{onLoad:function(t){e(dn(t))},onUnload:function(){e({type:Z.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(Rn),On=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,null,[{key:"makeInitialState",value:function(){return{browseOrgs:{state:B.NONE,error:null,view:{rawOrganizations:[],organizations:[],totalCount:0,filteredCount:0,sortBy:"name",sortDirection:q.ASCENDING,filter:"all",searchTerms:[],selectedOrganizationId:null,searching:!1}},auth:{status:k.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:x.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""}}}},addOrgView:{loadingStatus:W.NONE,error:null,viewModel:null},updateOrg:{pending:!1},viewOrg:{state:P.NONE},editOrg:{organizationId:"",editState:z.NONE,saveState:G.NONE,validationState:j.NONE,editedOrganization:We.makeEmptyEditableOrganization(),organization:null},manageOrganizationRequestsView:{state:W.NONE,error:null,viewState:null},viewMembersView:{state:H.NONE,error:null,view:null},inviteUserView:{loadingState:W.NONE,value:null,error:null},manageMembershipView:{loading:!1,error:null,value:null},requestNarrativeView:{status:Y.NONE,error:null,value:null}}}}]),e}();de.b.add(pe.c,pe.b,pe.a,pe.d);var gn=!!window.frameElement,Sn=On.makeInitialState(),_n=Object(R.d)(me,Sn,Object(R.c)(Object(R.a)(f.a))),An=function(e){function t(e){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).call(this,e))}return Object(E.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement(h.a,{store:_n},a.a.createElement(dr,{hosted:gn},a.a.createElement(Nr,null,a.a.createElement(p.a,{basename:"/orgs/"},a.a.createElement("div",{className:"App scrollable-flex-column"},a.a.createElement("div",{className:"App-body scrollable-flex-column"},a.a.createElement(m.a,null,a.a.createElement(d.a,{path:"/organizations",component:ot}),a.a.createElement(d.a,{path:"/newOrganization",component:bt}),a.a.createElement(d.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return a.a.createElement(Bt,{id:t})}}),a.a.createElement(d.a,{path:"/editOrganization/:id",component:function(e){var t=e.match.params.id;return a.a.createElement(rr,{id:t})}}),a.a.createElement(d.a,{path:"/manageOrganizationRequests/:id",component:function(e){var t=e.match.params.id;return a.a.createElement(Vr,{organizationId:t})}}),a.a.createElement(d.a,{path:"/viewMembers/:id",component:function(e){var t=e.match.params.id;return a.a.createElement(Qr,{organizationId:t})}}),a.a.createElement(d.a,{path:"/inviteUser/:id",component:function(e){var t=e.match.params.id;return a.a.createElement(on,{organizationId:t})}}),a.a.createElement(d.a,{path:"/membership/:id",component:function(e){var t=e.match.params.id;return a.a.createElement(En,{organizationId:t})}}),a.a.createElement(d.a,{path:"/requestAddNarrative/:id",component:function(e){var t=e.match.params.id;return a.a.createElement(fn,{organizationId:t})}}),a.a.createElement(v.a,{from:"/",to:"/organizations",exact:!0}))))))))}}]),t}(n.Component);r(288),r(290),r(292);o.a.render(a.a.createElement(An,null),document.getElementById("root"))}},[[145,2,1]]]);
//# sourceMappingURL=main.c14b49c7.chunk.js.map