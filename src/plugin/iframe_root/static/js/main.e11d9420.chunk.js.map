{"version":3,"sources":["components/entities/nouserpic.png","types/index.tsx","redux/actions/index.ts","redux/reducers/addOrg.ts","redux/reducers/editOrg.ts","redux/reducers/viewOrganization/acceptInboxRequest.ts","redux/reducers/viewOrganization/viewMembers.ts","redux/reducers/viewOrganization/denyInboxRequest.ts","redux/reducers/viewOrganization/cancelOutboxRequests.ts","redux/reducers/viewOrg.ts","redux/reducers/browseOrgs.ts","redux/reducers/auth.ts","redux/reducers/app.ts","redux/reducers/manageOrganizationRequests.ts","redux/reducers/viewMembers.ts","data/apis/groups.ts","data/models/requests.ts","data/models/organization/model.ts","data/models/organization/validation.ts","redux/reducers/inviteUser.ts","redux/reducers/manageMembership.ts","redux/reducers/requestAddNarrative.ts","redux/reducers/entities.ts","redux/reducers/organizationCentric.ts","redux/reducers/global.ts","redux/reducers/notifications.ts","redux/reducers/dataServices.ts","redux/reducers/index.tsx","components/entities/Owner.tsx","components/OrgLogo.tsx","components/entities/Avatar.tsx","data/apis/serviceClient.ts","data/apis/userProfile.ts","data/models/user.ts","data/apis/genericClient.ts","data/apis/serviceWizard.ts","data/apis/dynamicServiceClient.ts","data/apis/narrativeService.ts","data/models/narrative.ts","data/apis/workspaceUtils.ts","redux/actions/entities.ts","components/entities/OwnerContainer.tsx","lib/time.ts","components/NiceElapsedTime.tsx","components/views/organizationHeader/BriefOrganization.tsx","components/views/browseOrgs/organizations/component.tsx","components/views/browseOrgs/organizations/container.tsx","components/Header.tsx","components/menu/component.tsx","components/views/browseOrgs/component.tsx","redux/actions/browseOrgs.ts","components/views/browseOrgs/container.tsx","components/views/browseOrgs/loader.tsx","redux/actions/addOrg.ts","components/views/newOrganization/component.tsx","components/views/newOrganization/container.tsx","components/views/newOrganization/loader.tsx","data/models/uber.ts","redux/actions/dataServices.ts","redux/actions/viewOrg.ts","redux/actions/viewOrganization/acceptInboxRequest.ts","data/apis/feeds.ts","data/models/feeds.ts","components/entities/Member.tsx","components/entities/MemberContainer.tsx","components/views/organizationHeader/component.tsx","components/views/organizationHeader/container.tsx","redux/actions/organizationCentric.ts","components/views/organizationHeader/loader.tsx","components/entities/UserSimple.tsx","components/entities/UserSimpleContainer.tsx","components/entities/narrative/component.tsx","components/entities/narrative/reduxAdapter.tsx","components/OrganizationNarrative.tsx","redux/actions/viewOrganization/viewMembers.ts","components/views/viewOrganization/accessible/members/component.tsx","components/views/viewOrganization/accessible/members/reduxAdapter.tsx","redux/actions/viewOrganization/denyInboxRequest.ts","lib/error.ts","redux/actions/viewOrganization/cancelOutboxRequest.ts","components/entities/User.tsx","components/entities/UserContainer.tsx","components/entities/Narrative.tsx","components/entities/NarrativeContainer.tsx","components/views/viewOrganization/accessible/requests/InboxRequest.tsx","components/views/viewOrganization/accessible/requests/InboxRequestContainer.tsx","components/views/viewOrganization/accessible/requests/OutboxRequest.tsx","components/views/viewOrganization/accessible/requests/OutboxRequestContainer.tsx","components/views/viewOrganization/accessible/requests/component.tsx","components/views/viewOrganization/accessible/requests/container.tsx","components/views/viewOrganization/accessible/component.tsx","components/views/viewOrganization/accessible/container.tsx","components/views/viewOrganization/inaccessible/component.tsx","redux/actions/notifications.ts","components/views/viewOrganization/inaccessible/container.tsx","components/views/viewOrganization/loader.tsx","redux/actions/editOrg.ts","components/views/editOrganization/component.tsx","components/views/editOrganization/container.tsx","components/views/editOrganization/loader.tsx","components/Auth.tsx","data/auth.ts","redux/actions/auth.ts","containers/Auth.tsx","lib/windowChannel.ts","lib/IFrameSimulator.ts","lib/IFrameIntegration.ts","redux/actions/app.ts","components/KBaseIntegration.tsx","containers/KBaseIntegration.tsx","redux/actions/inviteUser.ts","components/User.tsx","components/views/inviteUser/component.tsx","components/views/inviteUser/container.tsx","components/views/inviteUser/loader.tsx","redux/actions/manageMembership.ts","components/views/manageMembership/component.tsx","components/views/manageMembership/container.tsx","combo/error/component.tsx","combo/error/api.ts","components/views/manageMembership/loader.tsx","components/views/requestAddNarrative/component.tsx","redux/actions/requestAddNarrative.ts","components/views/requestAddNarrative/container.tsx","components/views/requestAddNarrative/loader.tsx","redux/state.tsx","components/dataServices/component.tsx","components/dataServices/storeAdapter.tsx","AppContext.tsx","App.tsx","index.tsx"],"names":["module","exports","__webpack_require__","p","ComponentView","UIErrorType","SyncState","EditState","ValidationErrorType","SaveState","MemberType","RequestType","RequestResourceType","RequestStatus","AuthState","ViewOrgState","AppState","SortDirection","ComponentLoadingState","BrowseOrgsState","InviteUserViewState","NarrativeState","ProcessingState","RequestNarrativeState","ViewOrgViewModelKind","ErrorCode","ActionFlag","AppException","_Error","_ref","_this","code","message","detail","info","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","trace","errors","name","Error","captureStackTrace","assertThisInitialized","stack","indexOf","split","inherits","wrapNativeSuper","reducer","state","action","type","ADD_ORG_SAVE","views","addOrgView","viewModel","objectSpread","saveState","SAVING","console","warn","saveStart","ADD_ORG_SAVE_SUCCESS","editState","UNEDITED","SAVED","saveSuccess","ADD_ORG_SAVE_ERROR","SAVE_ERROR","error","saveError","ADD_ORG_LOAD_START","loadingState","LOADING","loadStart","ADD_ORG_LOAD_SUCCESS","SUCCESS","validationState","OK","validatedAt","Date","NEW","newOrganization","loadSuccess","ADD_ORG_LOAD_ERROR","loadError","ADD_ORG_UNLOAD","NONE","unload","ADD_ORG_UPDATE_NAME_SUCCESS","EDITED","value","syncState","DIRTY","updateNameSuccess","ADD_ORG_UPDATE_NAME_ERROR","updateNameError","ADD_ORG_UPDATE_LOGO_URL_SUCCESS","logoUrl","updateLogoUrlSuccess","ADD_ORG_UPDATE_LOGO_URL_ERROR","updateLogoUrlError","ADD_ORG_UPDATE_HOME_URL_SUCCESS","homeUrl","updateHomeUrlSuccess","ADD_ORG_UPDATE_HOME_URL_ERROR","updateHomeUrlError","ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS","researchInterests","updateResearchInterestsSuccess","ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR","updateResearchInterestsError","ADD_ORG_UPDATE_ID_SUCCESS","id","updateIdSuccess","ADD_ORG_UPDATE_ID_ERROR","updateIdError","ADD_ORG_UPDATE_ID_PASS","updateIdPass","ADD_ORG_UPDATE_DESCRIPTION_SUCCESS","description","updateDescriptionSuccess","ADD_ORG_UPDATE_DESCRIPTION_ERROR","updateDescriptionError","ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS","isPrivate","updateIsPrivateSuccess","ADD_ORG_EVALUATE_OK","addOrgEvaluateOk","ADD_ORG_EVALUATE_ERRORS","ERROR","addOrgEvaluateErrors","validationStateOk","evaluateEditorState","editedOrganization","EDIT_ORG_LOAD_START","editOrgView","EDIT_ORG_LOAD_SUCCESS","organization","EDIT_ORG_LOAD_ERROR","EDIT_ORG_UNLOAD","EDIT_ORG_SAVE_START","editOrgSaveStart","EDIT_ORG_SAVE_SUCCESS","CLEAN","editOrgSaveSuccess","EDIT_ORG_SAVE_ERROR","editOrgSaveError","EDIT_ORG_UPDATE_NAME_SUCCESS","editedOrg","remoteValue","newState","editOrgUpdateNameSuccess","EDIT_ORG_UPDATE_NAME_ERROR","editOrgUpdateNameError","EDIT_ORG_UPDATE_LOGO_URL_SUCCESS","editOrgUpdateLogoUrlSuccess","EDIT_ORG_UPDATE_LOGO_URL_ERROR","editOrgUpdateLogoUrlError","EDIT_ORG_UPDATE_HOME_URL_SUCCESS","editOrgUpdateHomeUrlSuccess","EDIT_ORG_UPDATE_HOME_URL_ERROR","editOrgUpdateHomeUrlError","EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS","EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR","EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS","EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS","EDIT_ORG_UPDATE_DESCRIPTION_ERROR","editOrgUpdateDescriptionError","EDIT_ORG_EVALUATE_OK","editOrgEvaluateOk","EDIT_ORG_EVALUATE_ERRORS","editOrgEvaluateErrors","VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS","viewOrgView","kind","NORMAL","requestInbox","requests","acceptInboxRequestSuccess","VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS","members","map","member","username","memberUsername","ADMIN","promoteToAdminSuccess","VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS","MEMBER","demoteToMemberSuccess","VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS","filter","removeMemberSuccess","VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS","rejectInboxRequestSuccess","VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS","requestOutbox","cancelRequestSuccess","VIEW_ORG_LOAD_START","types","VIEW_ORG_LOAD_NORMAL_SUCCESS","relation","openRequest","groupRequests","groupInvitations","loadNormalSuccess","VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS","PRIVATE_INACCESSIBLE","loadInaccessiblePrivateSuccess","VIEW_ORG_LOAD_ERROR","VIEW_ORG_UNLOAD","VIEW_ORG_REMOVE_NARRATIVE_SUCCESS","newNarratives","narratives","narrative","workspaceId","removeNarrativeSuccess","VIEW_ORG_ACCESS_NARRATIVE_SUCCESS","accessNarrativeSuccess","acceptInboxRequest","denyInboxRequest","cancelOutboxRequest","viewMembers","localReducer","BROWSE_ORGS_LOAD_SUCCESS","_action$defaultViewMo","defaultViewModel","rawOrganizations","organizations","openRequests","searchTerms","sortField","sortDirection","totalCount","filteredCount","selectedOrganizationId","searching","BROWSE_ORGS_SEARCH","searchOrgs","BROWSE_ORGS_SEARCH_START","searchOrgsStart","BROWSE_ORGS_SEARCH_SUCCESS","length","searchOrgsSuccess","BROWSE_ORGS_SEARCH_ERROR","searchOrgsError","BROWSE_ORGS_SORT_START","sortOrgsStart","BROWSE_ORGS_FILTER_START","filterOrgsStart","BROWSE_ORGS_UNLOAD","AUTH_CHECK_START","auth","status","CHECKING","authorization","token","realname","roles","authCheckStart","AUTH_AUTHORIZED","AUTHORIZED","authAuthorized","AUTH_UNAUTHORIZED","UNAUTHORIZED","authUnauthorized","AUTH_CHECK_ERROR","authCheckError","APP_SUCCESS","app","READY","config","appSuccess","ADMIN_MANAGE_REQUESTS_LOAD_START","ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS","manageOrganizationRequestsView","invitations","ADMIN_MANAGE_REQUESTS_LOAD_ERROR","ADMIN_MANAGE_REQUESTS_UNLOAD","ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS","newRequests","request","getViewAccessSuccess","VIEW_MEMBERS_LOAD_START","viewMembersView","VIEW_MEMBERS_LOAD_SUCCESS","VIEW_MEMBERS_LOAD_ERROR","VIEW_MEMBERS_UNLOAD","VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS","VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS","GroupException","_AppException","apperror","Map","httpcode","httpstatus","appcode","callid","time","originalError","ServerException","_AppException2","_this2","GroupsClient","url","createClass","key","fetch","headers","Authorization","Accept","mode","then","response","json","result","exists","_listGroups","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","next","abrupt","stop","apply","arguments","_this3","Promise","all","group","getGroupById","path","body","concat","join","Content-Type","method","JSON","stringify","statusText","get","text","_post","_callee2","errorText","_context2","sent","t0","_x","_x2","_get","_callee3","_context3","_x3","newGroup","payload","private","custom","logourl","researchinterests","homeurl","put","groupUpdate","_getRequest","_callee4","requestId","_context4","_x4","groupId","params","query","URLSearchParams","includeClosed","append","DESCENDING","startAt","String","getTime","toString","complete","_grantResourceAccess","_callee5","resourceType","resourceId","_context5","post","_x5","_x6","_x7","_ref2","_ref3","_ref4","_ref5","_ref6","_ref7","_ref8","update","_ref9","_ref10","_visitGroup","_callee6","_ref11","_context6","_x8","_getOpenRequests","_callee7","_ref12","groupIds","requestStatuses","_arr","_i","_ref15","_ref14","_groupId","requestStatus","_context7","entries","slicedToArray","set","_x9","groupRequestToOrgRequest","requestType","INVITATION","REQUEST","stringToRequestType","USER","WORKSPACE","APP","stringToResourceType","resourcetype","OPEN","organizationId","groupid","requester","user","resource","createdAt","createdate","expireAt","expiredate","modifiedAt","moddate","narrativeId","appId","UserRelationToOrganization","UserWorkspacePermission","OrganizationKind","RequestsModel","groupsClient","cache","groupsApi","groupsServiceURL","grequest","has","getRequest","_getOutboundRequests","grequests","getCreatedRequests","forEach","_getUserRequestForOrg","find","r","_getPendingRequestsForOrg","_getRequestInboxForOrg","getTargetedRequests","_getCombinedRequestInboxForOrg","getGroupRequests","t1","_getRequestOutboxForOrg","_getOrganizationInvitations","_callee8","_context8","_getOrganizationInvitationsForOrg","_callee9","_context9","getOrganizationInvitations","invitation","_getInboundRequests","_callee10","_context10","_getUserInvitationForOrg","_callee11","_context11","_getPendingOrganizationRequestsForOrg","_callee12","_context12","_getPendingOrganizationRequests","_callee13","allRequests","_context13","reduce","_x10","_cancelRequest","_callee14","_context14","cancelRequest","_x11","_acceptRequest","_callee15","_context15","acceptRequest","_x12","_denyRequest","_callee16","_context16","denyRequest","_x13","_acceptJoinInvitation","_callee17","_context17","_x14","_rejectJoinInvitation","_callee18","_context18","_x15","_inviteUserToJoinOrg","_callee19","_context19","inviteUserToGroup","_x16","_x17","Validation","s","firstNonPrintable","search","nonPrintableRe","beforeStart","before","slice","after","REQUIRED_MISSING","match","title","determineRelation","org","INACCESSIBLE_PRIVATE","MEMBER_REQUEST_PENDING","MEMBER_INVITATION_PENDING","owner","OWNER","groupPermissionToWorkspacePermission","groupsPermission","VIEW","EDIT","groupToOrganization","currentUser","joinedAt","joined","lastVisitedAt","lastvisit","admins","admin","resources","workspace","parseInt","rid","narrname","isPublic","public","permission","perm","narrcreate","updatedAt","isMember","role","groupRoleToUserRelation","areMembersPrivate","privatemembers","apps","memberCount","memcount","narrativeCount","rescount","appCount","catalogmethod","groupToPrivateOrganization","applySearch","orgs","searchTermsRe","term","RegExp","every","termRe","test","dateDays","d","t","Math","round","applySortComparison","direction","b","localeCompare","applySort","ASCENDING","sort","applyFilter","roleType","privacy","includes","applyRoleType","some","applyRole","applyPrivacy","OrganizationModel","_getOrg","_getOrganization","_getOrgs","ids","getOrg","_getAllOrgs","groups","getGroups","getOrgs","_getOwnOrgs","ownOrgs","getAllOrgs2","_getAllOrgs2","_this4","listGroups","listGroupToBriefOrganization","_queryOrgs","filtered","searched","sorted","total","_ownOrgs","_grantViewAccess","req","grantReadAccessToRequestedResource","requestModel","_addOrg","newOrg","reject","createGroup","_orgExists","groupExists","_updateOrg","orgUpdate","updateGroup","validateOrgId","validateOrgName","validateOrgDescription","_removeNarrativeFromOrg","deleteResource","_grantNarrativeAccess","grantResourceAccess","_requestMembership","requestMembership","_addOrRequestNarrativeToGroup","addOrRequestNarrative","_x18","_memberToAdmin","memberToAdmin","_x19","_x20","_adminToMember","adminToMember","_x21","_x22","_removeMember","removeMember","_x23","_x24","_updateMember","_callee20","_context20","updateMember","_x25","_x26","_x27","_visitOrg","_callee21","_context21","visitGroup","_x28","_getOpenRequestsStatus","_callee22","organizationIds","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","_context22","getOpenRequests","undefined","Symbol","iterator","done","stringToRequestStatus","return","finish","_x29","_getOpenRequestStatus","_callee23","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_context23","_x30","new","OLD","INVITE_USER_LOAD_START","inviteUserView","INVITE_USER_LOAD_SUCCESS","EDITING","users","selectedUser","INVITE_USER_LOAD_ERROR","INVITE_USER_UNLOAD","INVITE_USER_SEARCH_USERS_SUCCESS","searchUsersSuccess","INVITE_USER_SELECT_USER_SUCCESS","selectUserSuccess","INVITE_USER_SEND_INVITATION_START","SENDING","sendInvitationStart","INVITE_USER_SEND_INVITATION_SUCCESS","_state$views$inviteUs","orgModel","newUsers","sendInvitationSuccess","INVITE_USER_SEND_INVITATION_ERROR","sendInvitationError","editableMemberProfile","MANAGE_MEMBERSHIP_LOAD_START","manageMembershipView","MANAGE_MEMBERSHIP_LOAD_SUCCESS","MANAGE_MEMBERSHIP_LOAD_ERROR","MANAGE_MEMBERSHIP_UNLOAD","MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS","editedMember","updateTitleSuccess","MANAGE_MEMBERSHIP_EVALUATE_SUCCESS","evaluateSuccess","MANAGE_MEMBERSHIP_EVALUATE_ERROR","evaluateError","MANAGE_MEMBERSHIP_SAVE_SUCCESS","sendRequestStart","requestNarrativeView","REQUEST_ADD_NARRATIVE_LOAD_START","REQUEST_ADD_NARRATIVE_LOAD_SUCCESS","selectedNarrative","REQUEST_ADD_NARRATIVE_LOAD_ERROR","REQUEST_ADD_NARRATIVE_SEND_START","REQUEST_ADD_NARRATIVE_SEND_SUCCESS","orgNarrative","ASSOCIATED","REQUESTED","sendRequestSuccess","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS","selectNarrativeSuccess","REQUEST_ADD_NARRATIVE_UNLOAD","REQUEST_ADD_NARRATIVE_SORT_SUCCESS","sortSuccess","ENTITY_USER_LOADER_SUCCESS","entities","byId","userLoaderSuccess","ENTITY_ORGANIZATION_LOADER_SUCCESS","orgsMap","organizationLoaderSuccess","ENTITY_NARRATIVE_LOAD_SUCCESS","loadNarrativeSuccess","ORGANIZATION_CENTRIC_VIEW_LOAD_START","organizationCentricView","ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS","pendingJoinRequest","pendingJoinInvitation","ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR","ORGANIZATION_CENTRIC_VIEW_UNLOAD","GLOBAL_ACCESS_NARRATIVE_SUCCESS","narrativesById","NOTIFICATIONS_LOAD_SUCCESS","notificationsById","notifications","notification","db","NOTIFICATIONS_UNLOAD","NOTIFICATIONS_READ_SUCCESS","_state$db$notificatio","allNotifications","notificationId","delete","readSuccess","DATA_SERVICE_LOAD_SUCCESS","View","addOrgReducer","editOrgReducer","browseOrgsView","browseOrgsReducer","viewOrgReducer","authReducer","appReducer","manageOrganizatiopRequests","inviteUser","manageMembership","requestAddNarrative","organizationCentric","global","dataServices","OrgLogo","props","react","src","width","size","inString","position","c1","charCodeAt","c2","substring","initial","charAt","organizationName","toUpperCase","color","md5","substr","height","style","border","x","y","dy","textAnchor","dominantBaseline","fontSize","fill","fontFamily","renderLogoUrl","renderDefaultInitial","renderLogo","React","Avatar","_React$Component","avatarOption","gravatarDefault","gravatarHash","noUserPic","avatarUrl","getAvatarUrl","reverseView","v","COMPACT","Owner","view","setState","icon","showAvatar","className","components_entities_Avatar","avatarSize","tooltip","renderAvatar","es_tooltip","placement","href","target","onClick","onToggleView","bind","city","country","renderCompact","ServiceClient","param","version","constructor","random","AuthorizedServiceClient","_ServiceClient","func","makePayload","UserProfileClient","_AuthorizedServiceCli","makeEmptyPayload","_getUserProfile","profileCache","resolve","callFunc","_updateUserProfile","profile","_getUserProfiles","usernames","_getAllUsers","_searchUsers","profileToUser","jobTitle","userdata","jobTitleOther","synced","UserModel","userProfileClient","userProfileServiceURL","_getUser","userProfile","getUserProfile","_getUsers","toFetch","userProfiles","push","getUserProfiles","searchUsers","excludedUsers","AuthorizedGenericClient","_GenericClient","_callFunc2","processResponse","GenericClient","_processResponse","_error","_error2","_callFunc","ServiceWizardClient","theResult","moduleCache","Cache","itemLifetime","monitoringFrequency","waiterTimeout","waiterFrequency","cacheLifetime","isMonitoring","window","setTimeout","newCache","cacheRenewed","keys","item","isExpired","runMonitor","cacheItem","reserved","cached","Bluebird","started","waiter","reserveAndFetch","fetcher","catch","err","elapsed","reserveItem","fetchPromise","setItem","finally","isCancelled","isReserved","reserveWaiter","DynamicServiceClient","timeout","rpcContext","moduleId","getModule","getItemWithWait","getCached","client","getServiceStatus","module_name","funcName","_this5","lookupModule","serviceStatus","NarrativeAccess","Sort","NarrativeServiceClient","_DynamicServiceClient","_listNarratives","iso8601ToDate","dateString","dateParts","exec","TypeError","offset","newDateString","workspaceInfoToObject","wsInfo","objectCount","userPermission","globalReadPermission","lockStatus","metadata","objectInfoToObject","data","majorVersion","minorVersion","savedAt","savedBy","workspaceName","checksum","ref","NarrativeModel","_getOwnNarratives","narrativeServiceClient","requestClient","narrativesResult","pendingRequests","workspacesInOrg","serviceWizardURL","listNarratives","getPendingRequestsForOrg","nar","workspaceInfo","workspaceApi","ws","objectInfo","is_temporary","access","objectId","narrative_nice_name","lastSavedAt","lastSavedBy","TITLE","LAST_SAVED","sorter","getSorter","_getNarrative","workspaceClient","rawWorkspaceInfo","_objectId","rawObjectInfo","_access","workspaceServiceURL","objects","wsid","objid","includeMetadata","ignoreErrors","infos","userLoader","userId","dispatch","getState","_getState","_getState$auth$author","model","_user","ENTITY_USER_LOADER_START","userModel","services","UserProfile","getUser","ENTITY_USER_LOADER_ERROR","loadNarrative","_getState3","_getState3$auth$autho","narrativeClient","_narrative","ENTITY_NARRATIVE_LOAD_START","narrativeModel","Workspace","Groups","ServiceWizard","getNarrative","ENTITY_NARRATIVE_LOAD_ERROR","Loader","Owner_Owner","onLoad","connect","actions","niceElapsed","someDate","absoluteAfter","measure","measureAbs","unit","compactDate","nowDate","elapsedAbs","abs","prefix","suffix","getFullYear","Intl","DateTimeFormat","month","day","format","year","NiceElapsedTime","showTooltip","hour","minute","timeZoneName","BriefOrganization","OrgLogo_OrgLogo","mouseEnterDelay","newAlert","requestsAlert","iconColor","openRequestsStatus","INAPPLICABLE","permalink","fontWeight","location","origin","menu","es_menu","Modal","content","Item","dropdown","overlay","trigger","NavLink","to","renderRelation","renderPrivacy","renderHomeUrl","renderOrgFreshness","renderRequests","renderPermalink","second","OwnerContainer","fullTimestamp","memberCountTooltip","renderMemberCount","count","renderNarrativeCount","NiceElapsedTime_NiceElapsedTime","renderMemberRow","renderNarrativeRow","renderModifiedRow","renderLogoColumn","renderInfoCol","renderStatsCol","renderNormal","Organizations","singular","plural","index","BriefOrganization_BriefOrganization","es_alert","maxWidth","margin","overflowY","display","flexDirection","renderOrgs","_state$views$browseOr","Header","context","currentMenuItem","breadcrumbs","verticalAlign","marginLeft","marginRight","e","buttons","MainMenu","es_Route","render","history","selectedKeys","pathname","backgroundColor","Link","renderMenu","OrganizationsBrowser","searchInput","searchButton","filterByRoleValues","label","showInfo","filterByRoleType","filterByRole","filterByPrivacy","showAdvancedControls","onSearchOrgs","current","currentSearchInputValue","preventDefault","doSearch","onSortOrgs","sortBy","newFilter","onFilterOrgs","checkedValues","onSearchInputChange","onSubmit","placeholder","onChange","autoFocus","es_button","disabled","haveSearchInput","form","htmlType","renderSearchIcon","onClearSearch","renderSearchForm","renderSearchFeedback","shape","onShowInfo","src_components_Header","es_select","onSortByChange","defaultValue","dropdownMatchSelectWidth","Option","_this$props$filter","onToggleAdvanced","radioStyle","lineHeight","es_radio","Group","onFilterByRoleTypeChange","renderAdvancedToggle","es_checkbox","options","onFilterByRoleChange","onFilterByPrivacyChange","container","renderSortByControl","marginTop","renderFilterByRole","renderFilterByPrivacy","components_menu_component","renderMenuButtons","renderSearchBar","renderOrganizations","renderFilterColumn","load","BROWSE_ORGS_LOAD_START","storeState","_storeState$views$bro","_browseOrgsView$viewM","orgClient","_organizations","adminOrgs","_openRequests","queryOrgs","getOpenRequestsStatus","_getState2","_getState2$auth$autho","_browseOrgsView$viewM2","_organizations2","_openRequests2","_browseOrgsView$viewM3","_organizations3","_openRequests3","renderLoading","renderError","browseOrgs_container","onUnload","AddOrgEvaluateErrors","validateOrgLogoUrl","validateOrgHomeUrl","validateOrgResearchInterests","addOrgEvaluate","addOrg","ADD_ORG_SAVE_START","_state$auth$authoriza","exception","_state$views$addOrgVi","orgModelFromState","_state$auth$authoriza2","updateName","_Validation$validateO","_Validation$validateO2","validatedName","updateLogoUrl","_Validation$validateO3","_Validation$validateO4","validatedLogoUrl","Debouncer","delay","fun","canceled","timer","startWaiting","clearTimeout","activeDebouncer","updateId","_Validation$validateO9","_Validation$validateO10","validatedId","lastValidatedAt","now","_Validation$validateO11","_Validation$validateO12","orgExists","cancel","updateDescription","_Validation$validateO13","_Validation$validateO14","validatedDescription","NewOrganization","cancelToBrowser","showError","document","isModified","confirm","onOk","onCancel","okText","cancelText","onSave","persist","onUpdateName","onUpdateDescription","onUpdateId","onUpdateLogoUrl","onUpdateHomeUrl","onUpdateResearchInterests","onUpdateIsPrivate","checked","field","flex","input","calcFieldClass","onNameChange","renderFieldError","onIdChange","fontStyle","onLogoUrlChange","renderLogoPreview","onHomeUrlChange","onIsPrivateChange","renderIsPrivate","TextArea_default","autosize","minRows","maxRows","onResearchInterestsChange","onDescriptionChange","dangerouslySetInnerHTML","__html","Marked","parse","renderDefaultLogo","_this$props","errorButton","orgName","toggleError","canSave","line","modal","visible","okType","es_Redirect","renderEditor","renderLoadingHeader","updateIsPrivate","_Validation$validateO5","_Validation$validateO6","validatedHomeUrl","updateHomeUrl","_Validation$validateO7","_Validation$validateO8","validatedResearchInterests","updateResearchInterests","Component","newOrganization_container","UberModel","_getOrganizationForUser","getUserRequestForOrg","getUserInvitationForOrg","getPendingOrganizationRequestsForOrg","DATA_SERVICE_LOAD_START","removeNarrativeError","VIEW_ORG_REMOVE_NARRATIVE_ERROR","accessNarrativeError","VIEW_ORG_ACCESS_NARRATIVE_ERROR","viewOrgJoinRequestError","VIEW_ORG_JOIN_REQUEST_ERROR","acceptJoinInvitationStart","VIEW_ORG_ACCEPT_JOIN_INVITATION_START","_getState2$db$notific","uberClient","_organization","_relation","_requestInbox2","_openRequest","orgRequests","orgInvitations","_requestInbox","_requestOutbox","uberModel","getOrganizationForUser","getRequestInboxForOrg","getOrganizationInvitationsForOrg","getOpenRequestStatus","getCombinedRequestInboxForOrg","getRequestOutboxForOrg","viewOrgJoinRequest","_state$auth$authoriza3","VIEW_ORG_JOIN_REQUEST_SUCCESS","viewOrgCancelJoinRequest","_state$auth$authoriza4","newRequest","VIEW_ORG_JOIN_REQUEST_START","VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR","acceptJoinInvitation","_state$auth$authoriza5","VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS","VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR","rejectJoinInvitation","_state$auth$authoriza6","VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS","VIEW_ORG_REJECT_JOIN_INVITATION_ERROR","inbox","VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR","VIEW_ORG_ACCEPT_INBOX_REQUEST_START","Level","OrganizationNotificationType","FeedsException","FeedsClient","_put","baseURLPath","_postWithResult","queryString","Array","from","k","encodeURIComponent","_getNotifications","_seeNotifications","postWithResult","convertLevel","level","ALERT","WARNING","convertNotificationType","verb","JOIN_REQUEST","NARRATIVE_ASSOCIATION_REQUEST","APP_ASSOCIATION_REQUEST","NARRATIVE_ASSOCIATED","NARRATIVE_ACCEPTED","USER_ACCEPTED","JOIN_INVITATION","UNKNOWN","feedsClient","feedsApi","feedsServiceURL","getNotifications","feed","actor","object","source","seen","created","expires","external_key","expiresAt","externalKey","_getOrganizationNotifications","read","regarding","_seeNotification","seen_notes","seeNotifications","note_ids","unauthorized_notes","Member","userTooltip","renderRole","components_entities_Member","NavigateTo","OrganizationHeader","navigateTo","getUserRelation","currentUsername","onJoinOrg","success","onCancelJoinRequest","onAcceptInvitation","onRejectInvitation","MANAGE_MEMBERSHIP","VIEW_MEMBERS","MANAGE_REQUESTS","EDIT_ORGANIZATION","INVITE_USER","VIEW_ORGANIZATION","textAlign","onJoinClick","spin","onMenuClick","theme","adminMenu","ownerMenu","renderOrgInfo","getRelationClass","organizationHeader_container","User","entities_UserSimple","Narrative","cursor","iconType","UserSimpleContainer","renderUserPermission","renderGlobalPermission","renderNiceElapsed","renderNarrative","component_Narrative","OrganizationNarrative","requestAccess","onGetViewAccess","shareButton","permissionTooltip","buttonTooltip","onRequestAccess","renderNarrativePermission","reduxAdapter","accessModal","drawer","closable","onClose","onCloseRequestAccess","renderResource","promoteToAdmin","VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START","VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR","demoteToMember","VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START","VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR","VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START","_getState4","_getState4$auth$autho","VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR","Members","onRemoveMember","onPromoteMemberToAdmin","onConfirmRemoveMember","onDemoteAdminToMember","onMemberMenu","onAdminMenu","renderOwnerMenu","renderAdminMenu","renderMemberMenu","MemberContainer","renderMemberOptions","renderMembers","onViewMembersUnload","VIEW_ORG_VIEW_MEMBERS_UNLOAD","adminUsername","ViewMembers","VIEW_ORG_REJECT_INBOX_REQUEST_START","VIEW_ORG_REJECT_INBOX_REQUEST_ERROR","makeError","uuid","at","_requests","VIEW_ORG_CANCEL_JOIN_REQUEST_START","components_entities_User","UserContainer","renderPublicPermission","Narrative_Narrative","Request","onAcceptInboxRequest","onRejectInboxRequest","NarrativeContainer","renderRequestRequester","renderRequestOptions","onAcceptRequest","onRejectRequest","renderRequestReceivedSubject","renderJoinRequest","renderWorkspaceRequest","renderUserInvitation","renderBody","acceptActions","rejectActions","InboxRequest","onCancelOutboxRequest","alert","onCancelRequest","cancelActions","OutboxRequest","ManageGroupRequests","cancelToViewer","onAcceptJoinRequest","onDenyJoinRequest","onCancelJoinInvitation","open","card","hoverable","headStyle","marginBottom","narrativeAccess","InboxRequestContainer","outbox","OutboxRequestContainer","isAdmin","outboxCount","inboxCount","renderInbox","renderOutbox","AccordionState","cancelRequestActions","ViewOrganization","accordionState","UP","REQUEST_ADD_NARRATIVE","onRemoveNarrative","renderEditRow","organizationHeader_loader","members_reduxAdapter","inner","twoToneColor","renderGroupRequestsRow","renderGroupRequests","extras","onViewMembers","extra","renderMembersToolbar","onNarrativeMenu","onRequestAddNarrative","narrativesTable","OrganizationNarrative_OrganizationNarrative","renderNarrativeMenu","tabs","es_tabs","TabPane","tab","renderMembersTab","totalRequestCount","totalRequests","requests_container","titleCount","outboxSize","defaultActiveKey","animated","tabPosition","renderOrgMenu","DOWN","toggleAccordion","orgRowClass","narrativesRowClass","borg","borderBottom","minHeight","renderOrg","renderAccordionControl","renderNarratives","renderCombo","ownProps","onViewOrg","VIEW_ORG_REMOVE_NARRATIVE_START","removeNarrativeFromOrg","VIEW_ORG_ACCESS_NARRATIVE_START","grantNarrativeAccess","acceptInboxRequestActions","onReadNotification","NOTIFICATIONS_READ_START","feedsModel","Feeds","seeNotification","NOTIFICATIONS_READ_ERROR","notificationActions","renderMessage","renderJoinButton","renderHeader","padding","inaccessible_container","accessible_container","visitOrg","editableOrg","editOrgSave","_state$views$editOrgV","updateOrg","editOrgEvaluate","editOrgUpdateDescriptionSuccess","EditOrganization","onEditOrgSave","onClickCancelToViewer","renderOrgHeader","editOrganization_container","Auth","tokenRef","checkAuth","onRemoveAuthorization","onAddAuthorization","onLoginClick","onLogoutClick","buildAuthToolbar","children","buildAuthForm","hosted","buildAuthProd","buildAuthDev","endpoints","AuthClient","makePath","Cookies","getTokenInfo","getMe","account","desc","Listener","onSuccess","onError","WaitingListener","Message","channel","envelope","uuidv4","Channel","host","awaitingResponse","waitingListeners","listeners","lastId","sentCount","receivedCount","unwelcomeReceivedCount","unwelcomeReceivedCountThreshhold","unwelcomeReceiptWarning","unwelcomeReceiptWarningCount","currentListener","channelId","messageEvent","handler","ex","awaiting","listener","messageId","listen","postMessage","getMessage","sendMessage","sendRequest","_loop","startMonitor","listenOnce","received","receiveMessage","addEventListener","removeEventListener","IFrameSimulator","frameId","authServiceURL","originalPath","viewParams","parentHost","IFrameIntegration","frameElement","hasAttribute","getAttribute","decodeURIComponent","KBaseIntegration","onAppStart","_state$app","defaultPath","iframeParams","getParamsFromIFrame","pushState","baseUrl","selectUserError","INVITE_USER_SELECT_USER_ERROR","selectUser","selectedUsername","INVITE_USER_SELECT_USER_START","sendInvitation","_getState4$views$invi","inviteUserToJoinOrg","InviteUser","lastSearchAt","cancelToViewMembers","autocompleteMessage","onSendInvitation","doSearchUsers","searchDebounce","onSearchUsers","onSelectUser","renderOrgName","showIcon","button","SENDABLE","src_components_User","renderSearchButton","renderUsers","renderSelectedUser","renderInvitationForm","renderFooter","userClient","adminUsers","invited","requested","_users","orgUsers","INVITE_USER_SEARCH_USERS_START","INVITE_USER_SEARCH_USERS_ERROR","InviteUserLoader","inviteUser_container","onInviteUserLoad","evaluate","ManageMembership","confirmed","doLeaveOrgConfirmed","onLeaveOrganization","onUpdateTitle","doLeaveOrg","doShowInfo","onTitleChange","_state$views$manageMe","MANAGE_MEMBERSHIP_LEAVE_ORG_START","MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS","MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR","_Validation$validateM","validateMemberTitle","_Validation$validateM2","validatedTitle","MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR","MANAGE_MEMBERSHIP_SAVE_START","MANAGE_MEMBERSHIP_SAVE_ERROR","collapse","bordered","Panel","header","renderDetail","renderInfo","component_Error","renderLoadingNone","manageMembership_container","thisMember","editableProfile","RequestAddNarrative","BROWSER","VIEWER","doSelectNarrative","doSendRequest","flag","classNames","log","onSearchSubmit","NumberFormat","useGrouping","doSortBy","renderFilterSortBar","renderFeedbackBar","buttonLabel","canSendRequest","doCancelToViewer","renderNarrativeSelector","renderSelectedNarrative","renderSelectedNarrativeButton","selectNarrative","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START","_state$views$requestN","_request2","addOrRequestNarrativeToGroup","REQUEST_ADD_NARRATIVE_SEND_ERROR","REQUEST_ADD_NARRATIVE_SORT_START","REQUEST_ADD_NARRATIVE_SORT_ERROR","sortOrganizationNarratives","requestAddNarrative_container","_narratives","_request","getOrganization","getOwnNarratives","StateInstances","pending","DataServices","DATA_SERVICE_UNLOAD","AppContextProvider","Provider","Consumer","library","add","faSpinner","faSearch","faGlobe","faUserLock","DescriptionRenderer","sanitize","prot","unescape","replace","toLowerCase","out","Renderer","MarkedOptions","renderer","setOptions","initialState","makeInitialState","store","createStore","theReducer","compose","applyMiddleware","thunk","App","react_default","createElement","es","containers_KBaseIntegration","containers_Auth","storeAdapter","BrowserRouter","basename","Switch","Route","component","viewOrganization_loader","editOrganization_loader","inviteUser_loader","manageMembership_loader","requestAddNarrative_loader","Redirect","exact","ReactDOM","src_App_0","getElementById"],"mappings":"6EAAAA,EAAAC,QAAiBC,EAAAC,EAAuB,yzBCiB5BC,EAKAC,EAYAC,EAOAC,EAeAC,EAsEAC,EAsBAC,EA0EAC,EAKAC,EAMAC,EAgEAC,EAsBAC,EAQAC,EAOAC,EAKAC,EA8BAC,EA6BAC,EAmDAC,EA0BAC,EAQAC,EAsEAC,EAuGAC,8KA/nBArB,wEAKAC,4GAYAC,sGAOAC,8EAeAC,uGAsEAC,8HAsBAC,yFA0EAC,gFAKAC,yFAMAC,iJAgEAC,6JAsBAC,yIAQAC,8GAOAC,8DAKAC,kHA8BAC,sHA6BAC,sKAmDAC,uGA0BAC,wHAQAC,4JAsEAC,kGAuGAC,uDA4BL,IC5qBKC,ED4qBCC,EAAb,SAAAC,GAOI,SAAAD,EAAAE,GAA0H,IAAAC,EAA5GC,EAA4GF,EAA5GE,KAAMC,EAAsGH,EAAtGG,QAASC,EAA6FJ,EAA7FI,OAAQC,EAAqFL,EAArFK,KAAqF,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAV,IACtHG,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAR,GAAAa,KAAAH,KAAML,KAPVD,UAM0H,EAAAD,EAL1HE,aAK0H,EAAAF,EAJ1HG,YAI0H,EAAAH,EAH1HW,WAG0H,EAAAX,EAF1HY,YAE0H,EAAAZ,EAD1HI,UAC0H,EAEtHJ,EAAKa,KAAO,eACZb,EAAKC,KAAOA,EACZD,EAAKE,QAAUA,EACfF,EAAKG,OAASA,EACdH,EAAKI,KAAOA,EAERU,MAAMC,mBACND,MAAMC,kBAANV,OAAAW,EAAA,EAAAX,QAAAW,EAAA,EAAAX,CAAAL,IAA8BH,GAG9BG,EAAKiB,QACDjB,EAAKiB,MAAMC,QAAQ,OAAS,EAC5BlB,EAAKW,MAAQX,EAAKiB,MAAME,MAAM,MAE9BnB,EAAKW,MAAQ,CAACX,EAAKiB,QAhB2FjB,EAP9H,OAAAK,OAAAe,EAAA,EAAAf,CAAAR,EAAAC,GAAAD,EAAA,CAAAQ,OAAAgB,EAAA,EAAAhB,CAAkCS,kBC5qBtBlB,mynBCksBG0B,MAjER,SAAiBC,EAAmBC,GAIvC,OAAQA,EAAOC,MACX,KAAK7B,EAAW8B,aACZ,OAhnBL,SAAmBH,EAAmBC,GACzC,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELE,UAAWpD,EAAUqD,gBAXjCC,QAAQC,KAAK,2CACNX,GA6mBIY,CAAUZ,GACrB,KAAK3B,EAAWwC,qBACZ,OA9lBL,SAAqBb,EAAmBC,GAC3C,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAU6D,SACrBP,UAAWpD,EAAU4D,eAZjCN,QAAQC,KAAK,6CACNX,GA2lBIiB,CAAYjB,GACvB,KAAK3B,EAAW6C,mBACZ,OA3kBL,SAAmBlB,EAAmBC,GACzC,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAGDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELE,UAAWpD,EAAU+D,WACrBC,MAAOnB,EAAOmB,eAb1BV,QAAQC,KAAK,2CACNX,GAwkBIqB,CAAUrB,EAAOC,GAE5B,KAAK5B,EAAWiD,mBACZ,OAzgBL,SAAmBtB,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAY,CACRkB,aAAc1D,EAAsB2D,QACpCJ,MAAO,KACPd,UAAW,UAigBRmB,CAAUzB,GACrB,KAAK3B,EAAWqD,qBACZ,OA7fL,SAAqB1B,EAAmBC,GAC3C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAY,CACRkB,aAAc1D,EAAsB8D,QACpCP,MAAO,KACPd,UAAW,CACPQ,UAAW5D,EAAU6D,SACrBa,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,MAErBvB,UAAWpD,EAAU4E,IACrBZ,MAAO,KACPa,gBAAiBhC,EAAOgC,sBA6ezBC,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAW8D,mBACZ,OAzeL,SAAmBnC,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAY,CACRkB,aAAc1D,EAAsB8D,QACpCP,MAAOnB,EAAOmB,MACdd,UAAW,UAieR8B,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAWgE,eACZ,OA7dL,SAAgBrC,EAAmBC,GACtC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAY,CACRkB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,UAqdRiC,CAAOvC,GAElB,KAAK3B,EAAWmE,4BACZ,OAjdL,SAA2BxC,EAAmBC,GACjD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX3C,KAAKR,OAAAyB,EAAA,EAAAzB,CAAA,GACEkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB3C,KADpD,CAEAoD,MAAOzC,EAAOX,KACdqD,UAAW1F,EAAU2F,MACrBhB,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mBApBzCrB,QAAQC,KAAK,mDACNX,GA8cI6C,CAAkB7C,EAAOC,GACpC,KAAK5B,EAAWyE,0BACZ,OA9aL,SAAyB9C,EAAmBC,GAC/C,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX3C,KAAKR,OAAAyB,EAAA,EAAAzB,CAAA,GACEkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB3C,KADpD,CAEAoD,MAAOzC,EAAOX,KACdqD,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,mBAlB5CV,QAAQC,KAAK,iDACNX,GA2aI+C,CAAgB/C,EAAOC,GAElC,KAAK5B,EAAW2E,gCACZ,OAhZL,SAA8BhD,EAAmBC,GACpD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEXgB,QAAQnE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgBgB,QADjD,CAEHN,UAAW1F,EAAU2F,MACrBF,MAAOzC,EAAOgD,QACdrB,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mBApBzCrB,QAAQC,KAAK,0CACNX,GA6YIkD,CAAqBlD,EAAOC,GACvC,KAAK5B,EAAW8E,8BACZ,OAlXL,SAA4BnD,EAAmBC,GAClD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEXgB,QAAQnE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgBgB,QADjD,CAEHN,UAAW1F,EAAU2F,MACrBF,MAAOzC,EAAOgD,QACdrB,gBAAiB3B,EAAOmB,mBAlB5CV,QAAQC,KAAK,gDACNX,GA+WIoD,CAAmBpD,EAAOC,GAErC,KAAK5B,EAAWgF,gCACZ,OAvVL,SAA8BrD,EAAmBC,GACpD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEXqB,QAAQxE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgBqB,QADjD,CAEHX,UAAW1F,EAAU2F,MACrBF,MAAOzC,EAAOqD,QACd1B,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mBApBzCrB,QAAQC,KAAK,oDACNX,GAoVIuD,CAAqBvD,EAAOC,GACvC,KAAK5B,EAAWmF,8BACZ,OAzTL,SAA4BxD,EAAmBC,GAClD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEXqB,QAAQxE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgBqB,QADjD,CAEHX,UAAW1F,EAAU2F,MACrBF,MAAOzC,EAAOqD,QACd1B,gBAAiB3B,EAAOmB,mBAlB5CV,QAAQC,KAAK,oDACNX,GAsTIyD,CAAmBzD,EAAOC,GAErC,KAAK5B,EAAWqF,0CACZ,OA9RL,SAAwC1D,EAAmBC,GAC9D,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX0B,kBAAkB7E,OAAAyB,EAAA,EAAAzB,CAAA,GACXkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB0B,kBADvC,CAEbhB,UAAW1F,EAAU2F,MACrBF,MAAOzC,EAAO0D,kBACd/B,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mBApBzCrB,QAAQC,KAAK,oDACNX,GA2RI4D,CAA+B5D,EAAOC,GACjD,KAAK5B,EAAWwF,wCACZ,OAhQL,SAAsC7D,EAAmBC,GAC5D,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX0B,kBAAkB7E,OAAAyB,EAAA,EAAAzB,CAAA,GACXkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB0B,kBADvC,CAEbhB,UAAW1F,EAAU2F,MACrBF,MAAOzC,EAAO0D,kBACd/B,gBAAiB3B,EAAOmB,mBAlB5CV,QAAQC,KAAK,sEACNX,GA6PI8D,CAA6B9D,EAAOC,GAE/C,KAAK5B,EAAW0F,0BACZ,OApOL,SAAyB/D,EAAmBC,GAC/C,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX+B,GAAGlF,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB+B,GADtD,CAGErB,UAAW1F,EAAU2F,MACrBhB,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mBApBzCrB,QAAQC,KAAK,iDACNX,GAiOIiE,CAAgBjE,GAC3B,KAAK3B,EAAW6F,wBACZ,OAtML,SAAuBlE,EAAmBC,GAC7C,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX+B,GAAGlF,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB+B,GADtD,CAGErB,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,mBAlB5CV,QAAQC,KAAK,+CACNX,GAmMImE,CAAcnE,EAAOC,GAChC,KAAK5B,EAAW+F,uBACZ,OA3KL,SAAsBpE,EAAmBC,GAC5C,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX+B,GAAGlF,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB+B,GADtD,CAEEtB,MAAOzC,EAAO+D,GACdrB,UAAW1F,EAAU2F,mBAjBzClC,QAAQC,KAAK,iDACNX,GAwKIqE,CAAarE,EAAOC,GAE/B,KAAK5B,EAAWiG,mCACZ,OA9IL,SAAkCtE,EAAmBC,GACxD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEXsC,YAAYzF,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgBsC,YAD7C,CAEP7B,MAAOzC,EAAOsE,YACd5B,UAAW1F,EAAU2F,MACrBhB,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mBApBzCrB,QAAQC,KAAK,0DACNX,GA2IIwE,CAAyBxE,EAAOC,GAC3C,KAAK5B,EAAWoG,iCACZ,OAhHL,SAAgCzE,EAAmBC,GACtD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEXsC,YAAYzF,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgBsC,YAD7C,CAEP7B,MAAOzC,EAAOsE,YACd5B,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,mBAlB5CV,QAAQC,KAAK,wDACNX,GA6GI0E,CAAuB1E,EAAOC,GAEzC,KAAK5B,EAAWsG,kCACZ,OAtFL,SAAgC3E,EAAmBC,GACtD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELQ,UAAW5D,EAAUuF,OACrBR,gBAAgBnD,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBADzB,CAEX2C,UAAU9F,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UAAU2B,gBAAgB2C,UAD/C,CAELlC,MAAOzC,EAAO2E,UACdjC,UAAW1F,EAAU2F,MACrBhB,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mBApBzCrB,QAAQC,KAAK,iDACNX,GAmFI6E,CAAuB7E,EAAOC,GAEzC,KAAK5B,EAAWyG,oBACZ,OApmBL,SAA0B9E,EAAmBC,GAChD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELsB,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,eAbjCrB,QAAQC,KAAK,6CACNX,GAimBI+E,CAAiB/E,GAC5B,KAAK3B,EAAW2G,wBACZ,OA/kBL,SAA8BhF,EAAmBC,GACpD,OAAKD,EAAMI,MAAMC,WAAWC,UAIrBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDC,WAAWvB,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAMI,MAAMC,WADT,CAENC,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMC,WAAWC,UADrB,CAELsB,gBAAiB,CACb1B,KAAM/C,EAAoB8H,MAC1BtG,QAAS,mBACTmD,YAAa,IAAIC,eAdjCrB,QAAQC,KAAK,6CACNX,GA4kBIkF,CAAqBlF,GAChC,QACI,OAAO,OC3pBnB,SAASmF,IAKL,MAJ2B,CACvBjF,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,MA4MzB,SAASqD,EAAoB9E,GACzB,OAAIA,EAAU+E,mBAAmB/F,KAAKqD,YAAc1F,EAAU2F,MACnD1F,EAAUuF,OAGjBnC,EAAU+E,mBAAmBrB,GAAGrB,YAAc1F,EAAU2F,MACjD1F,EAAUuF,OAGjBnC,EAAU+E,mBAAmBpC,QAAQN,YAAc1F,EAAU2F,MACtD1F,EAAUuF,OAGjBnC,EAAU+E,mBAAmB/B,QAAQX,YAAc1F,EAAU2F,MACtD1F,EAAUuF,OAGjBnC,EAAU+E,mBAAmB1B,kBAAkBhB,YAAc1F,EAAU2F,MAChE1F,EAAUuF,OAGjBnC,EAAU+E,mBAAmBT,UAAUjC,YAAc1F,EAAU2F,MACxD1F,EAAUuF,OAGjBnC,EAAU+E,mBAAmBd,YAAY5B,YAAc1F,EAAU2F,MAC1D1F,EAAUuF,OAGdvF,EAAU6D,SA+gBNhB,MA9DR,SAAiBC,EAAmBC,GAIvC,OAAQA,EAAOC,MACX,KAAK7B,EAAWiH,oBACZ,OAltBL,SAAmBtF,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAa,CACThE,aAAc1D,EAAsB2D,QACpCJ,MAAO,KACPd,UAAW,UA0sBRmB,CAAUzB,GACrB,KAAK3B,EAAWmH,sBACZ,OA7rBL,SAAqBxF,EAAmBC,GAC3C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAa,CACThE,aAAc1D,EAAsB8D,QACpCP,MAAO,KACPd,UAAW,CACPQ,UAAW5D,EAAU6D,SACrBa,gBAAiBuD,IAKjB3E,UAAWpD,EAAU4E,IAGrByD,aAAcxF,EAAOwF,aACrBpE,UAAW,KACXgE,mBAAoBpF,EAAOoF,yBAyqB5BnD,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAWqH,oBACZ,OApqBL,SAAmB1F,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAa,CACThE,aAAc1D,EAAsBoH,MACpC7D,MAAOnB,EAAOmB,MACdd,UAAW,UA4pBR8B,CAAUpC,EAAOC,GAE5B,KAAK5B,EAAWsH,gBACZ,OAxpBL,SAAgB3F,EAAmBC,GACtC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAa,CACThE,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,UAgpBRiC,CAAOvC,GAElB,KAAK3B,EAAWuH,oBACZ,OA3oBL,SAA0B5F,EAAmBC,GAChD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELE,UAAWpD,EAAUqD,eAX1BT,EAyoBI6F,CAAiB7F,GAC5B,KAAK3B,EAAWyH,sBACZ,OAznBL,SAA4B9F,EAAmBC,GAClD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAU6D,SACrBP,UAAWpD,EAAU4D,MACrBqE,mBAAoB,CAChBrB,GAAGlF,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBrB,GAD1D,CAEErB,UAAW1F,EAAU8I,QAEzBzG,KAAKR,OAAAyB,EAAA,EAAAzB,CAAA,GACEkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB/F,KADxD,CAEAqD,UAAW1F,EAAU8I,QAEzB9C,QAAQnE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBpC,QADrD,CAEHN,UAAW1F,EAAU8I,QAEzBzC,QAAQxE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB/B,QADrD,CAEHX,UAAW1F,EAAU8I,QAEzBpC,kBAAkB7E,OAAAyB,EAAA,EAAAzB,CAAA,GACXkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB1B,kBAD3C,CAEbhB,UAAW1F,EAAU8I,QAEzBnB,UAAU9F,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBT,UADnD,CAELjC,UAAW1F,EAAU8I,QAEzBxB,YAAYzF,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBd,YADjD,CAEP5B,UAAW1F,EAAU8I,iBAxClC/F,EAunBIgG,CAAmBhG,GAC9B,KAAK3B,EAAW4H,oBACZ,OAxkBL,SAA0BjG,EAAmBC,GAChD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELE,UAAWpD,EAAU+D,WACrBE,UAAWpB,EAAOmB,cAZvBpB,EAskBIkG,CAAiBlG,EAAOC,GAEnC,KAAK5B,EAAW8H,6BACZ,OAleL,SAAkCnG,EAAmBC,GACxD,IAAKD,EAAMI,MAAMmF,YAAYjF,UACzB,OAAON,EAGX,IACI2C,EADEyD,EAAYpG,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAGhD1C,EADA1C,EAAOX,OAAS8G,EAAU9G,KAAK+G,YACnBpJ,EAAU2F,MAEV3F,EAAU8I,MAG1B,IAAMO,EAAQxH,OAAAyB,EAAA,EAAAzB,CAAA,GACPkB,EADO,CAEVI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAGL+E,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEd/F,KAAKR,OAAAyB,EAAA,EAAAzB,CAAA,GACEkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB/F,KADxD,CAEAoD,MAAOzC,EAAOX,KACdqD,UAAWA,EACXf,gBAAiBuD,gBAUnCrE,EAAYsE,EAAoBkB,EAASlG,MAAMmF,YAAYjF,WAEjE,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAwH,EADP,CAEIlG,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLwH,EAASlG,MAAMmF,YADX,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwH,EAASlG,MAAMmF,YAAYjF,UADzB,CAELQ,UAAWA,UAkbZyF,CAAyBvG,EAAOC,GAC3C,KAAK5B,EAAWmI,2BACZ,OA7aL,SAAgCxG,EAAmBC,GACtD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEd/F,KAAKR,OAAAyB,EAAA,EAAAzB,CAAA,GACEkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB/F,KADxD,CAEAoD,MAAOzC,EAAOX,KACdqD,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,kBAlBrCpB,EA2aIyG,CAAuBzG,EAAOC,GAEzC,KAAK5B,EAAWqI,iCACZ,OAlZL,SAAqC1G,EAAmBC,GAC3D,IAAKD,EAAMI,MAAMmF,YAAYjF,UACzB,OAAON,EAGX,IAAMsG,EAAQxH,OAAAyB,EAAA,EAAAzB,CAAA,GACPkB,EADO,CAEVI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEdpC,QAAQnE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBpC,QADrD,CAEHP,MAAOzC,EAAOgD,QACdN,UAAW1F,EAAU2F,MACrBhB,gBAAiBuD,gBAUnCrE,EAAYsE,EAAoBkB,EAASlG,MAAMmF,YAAYjF,WAEjE,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAwH,EADP,CAEIlG,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLwH,EAASlG,MAAMmF,YADX,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwH,EAASlG,MAAMmF,YAAYjF,UADzB,CAELQ,UAAWA,UA0WZ6F,CAA4B3G,EAAOC,GAC9C,KAAK5B,EAAWuI,+BACZ,OArWL,SAAmC5G,EAAmBC,GACzD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEdpC,QAAQnE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBpC,QADrD,CAEHP,MAAOzC,EAAOgD,QACdN,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,kBAlBrCpB,EAmWI6G,CAA0B7G,EAAOC,GAE5C,KAAK5B,EAAWyI,iCACZ,OAxUL,SAAqC9G,EAAmBC,GAC3D,IAAKD,EAAMI,MAAMmF,YAAYjF,UACzB,OAAON,EAGX,IAAMsG,EAAQxH,OAAAyB,EAAA,EAAAzB,CAAA,GACPkB,EADO,CAEVI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEd/B,QAAQxE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB/B,QADrD,CAEHZ,MAAOzC,EAAOqD,QACdX,UAAW1F,EAAU2F,MACrBhB,gBAAiBuD,gBAUnCrE,EAAYsE,EAAoBkB,EAASlG,MAAMmF,YAAYjF,WAEjE,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAwH,EADP,CAEIlG,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLwH,EAASlG,MAAMmF,YADX,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwH,EAASlG,MAAMmF,YAAYjF,UADzB,CAELQ,UAAWA,UAgSZiG,CAA4B/G,EAAOC,GAC9C,KAAK5B,EAAW2I,+BACZ,OA3RL,SAAmChH,EAAmBC,GACzD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEd/B,QAAQxE,OAAAyB,EAAA,EAAAzB,CAAA,GACDkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB/B,QADrD,CAEHZ,MAAOzC,EAAOqD,QACdX,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,kBAlBrCpB,EAyRIiH,CAA0BjH,EAAOC,GAE5C,KAAK5B,EAAW6I,2CACZ,OA9PL,SAAwClH,EAAmBC,GAC9D,IAAKD,EAAMI,MAAMmF,YAAYjF,UACzB,OAAON,EAGX,IAAMsG,EAAQxH,OAAAyB,EAAA,EAAAzB,CAAA,GACPkB,EADO,CAEVI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEd1B,kBAAkB7E,OAAAyB,EAAA,EAAAzB,CAAA,GACXkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB1B,kBAD3C,CAEbjB,MAAOzC,EAAO0D,kBACdhB,UAAW1F,EAAU2F,MACrBhB,gBAAiBuD,gBAUnCrE,EAAYsE,EAAoBkB,EAASlG,MAAMmF,YAAYjF,WAEjE,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAwH,EADP,CAEIlG,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLwH,EAASlG,MAAMmF,YADX,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwH,EAASlG,MAAMmF,YAAYjF,UADzB,CAELQ,UAAWA,UAsNZ8C,CAA+B5D,EAAOC,GACjD,KAAK5B,EAAW8I,yCACZ,OAjNL,SAAsCnH,EAAmBC,GAC5D,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEd1B,kBAAkB7E,OAAAyB,EAAA,EAAAzB,CAAA,GACXkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmB1B,kBAD3C,CAEbjB,MAAOzC,EAAO0D,kBACdhB,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,kBAlBrCpB,EA+MI8D,CAA6B9D,EAAOC,GAE/C,KAAK5B,EAAW+I,mCACZ,OAnGL,SAAgCpH,EAAmBC,GACtD,IAAKD,EAAMI,MAAMmF,YAAYjF,UACzB,OAAON,EAIX,IACI2C,EADEyD,EAAYpG,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAGhD1C,EADA1C,EAAO2E,YAAcwB,EAAUxB,UAAUyB,YAC7BpJ,EAAU2F,MAEV3F,EAAU8I,MAG1B,IAAMO,EAAQxH,OAAAyB,EAAA,EAAAzB,CAAA,GACPkB,EADO,CAEVI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEdT,UAAU9F,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBT,UADnD,CAELlC,MAAOzC,EAAO2E,UACdjC,UAAWA,EACXf,gBAAiBuD,gBAUnCrE,EAAYsE,EAAoBkB,EAASlG,MAAMmF,YAAYjF,WAEjE,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAwH,EADP,CAEIlG,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLwH,EAASlG,MAAMmF,YADX,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwH,EAASlG,MAAMmF,YAAYjF,UADzB,CAELQ,UAAWA,UAkDZ+D,CAAuB7E,EAAOC,GAMzC,KAAK5B,EAAWgJ,oCACZ,OA9LL,SAAkCrH,EAAmBC,GACxD,IAAKD,EAAMI,MAAMmF,YAAYjF,UACzB,OAAON,EAGX,IACI2C,EADEyD,EAAYpG,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAGhD1C,EADA1C,EAAOsE,cAAgB6B,EAAU7B,YAAY8B,YACjCpJ,EAAU2F,MAEV3F,EAAU8I,MAG1B,IAAMO,EAAQxH,OAAAyB,EAAA,EAAAzB,CAAA,GACPkB,EADO,CAEVI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEdd,YAAYzF,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBd,YADjD,CAEP7B,MAAOzC,EAAOsE,YACd5B,UAAWA,EACXf,gBAAiBuD,gBAUnCrE,EAAYsE,EAAoBkB,EAASlG,MAAMmF,YAAYjF,WAEjE,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAwH,EADP,CAEIlG,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLwH,EAASlG,MAAMmF,YADX,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwH,EAASlG,MAAMmF,YAAYjF,UADzB,CAELQ,UAAWA,UA8IZ0D,CAAyBxE,EAAOC,GAC3C,KAAK5B,EAAWiJ,kCACZ,OAzIL,SAAuCtH,EAAmBC,GAC7D,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELQ,UAAW5D,EAAUuF,OACrB4C,mBAAmBvG,OAAAyB,EAAA,EAAAzB,CAAA,GACZkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBADvB,CAEdd,YAAYzF,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YAAYjF,UAAU+E,mBAAmBd,YADjD,CAEP7B,MAAOzC,EAAOsE,YACd5B,UAAW1F,EAAU2F,MACrBhB,gBAAiB3B,EAAOmB,kBAlBrCpB,EAuIIuH,CAA8BvH,EAAOC,GAChD,KAAK5B,EAAWmJ,qBACZ,OAnlBL,SAA2BxH,EAAmBC,GACjD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELsB,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,cAb1B/B,EAilBIyH,CAAkBzH,GAC7B,KAAK3B,EAAWqJ,yBACZ,OA9jBL,SAA+B1H,EAAmBC,GACrD,OAAKD,EAAMI,MAAMmF,YAAYjF,UAItBxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmF,YAAYzG,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMmF,YADR,CAEPjF,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmF,YAAYjF,UADtB,CAELsB,gBAAiB,CACb1B,KAAM/C,EAAoB8H,MAC1BtG,QAAS,oBACTmD,YAAa,IAAIC,cAd1B/B,EA4jBI2H,CAAsB3H,GACjC,QACI,OAAO,OC9vBJ,SAASD,EAAQC,EAAmBC,GAC/C,OAAQA,EAAOC,MACX,KAAK7B,EAAWuJ,sCACZ,OAzBL,SAAmC5H,EAAmBC,GACzD,OAAKD,EAAMI,MAAMyH,YAAYvH,UAGzBN,EAAMI,MAAMyH,YAAYvH,UAAUwH,OAAS3J,EAAqB4J,OACzD/H,EAEJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMyH,YAAYvH,UADtB,CAEL0H,aAAc/H,EAAOgI,iBAb1BjI,EAuBIkI,CAA0BlI,EAAOC,GAC5C,QACI,OAAO,MC8LJF,MAxBf,SAAiBC,EAAmBC,GAIhC,OAAQA,EAAOC,MASX,KAAK7B,EAAW8J,+CACZ,OAjJL,SAA+BnI,EAAmBC,GAAmD,IAG5EK,EACxBN,EADAI,MAASyH,YAAevH,UAG5B,GAAkB,OAAdA,EACA,OAAON,EAIX,GAAIM,EAAUwH,OAAS3J,EAAqB4J,OACxC,OAAO/H,EAKX,IAAMoI,EAAU9H,EAAUmF,aAAa2C,QAAQC,IAAI,SAACC,GAEhD,OAAIA,EAAOC,WAAatI,EAAOuI,eACpB1J,OAAAyB,EAAA,EAAAzB,CAAA,GACAwJ,EADP,CAEIpI,KAAM7C,EAAWoL,QAGdH,IAIf,OAAOxJ,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwB,EADE,CAELmF,aAAa3G,OAAAyB,EAAA,EAAAzB,CAAA,GACNwB,EAAUmF,aADL,CAER2C,QAASA,YA0GdM,CAAsB1I,EAAOC,GACxC,KAAK5B,EAAWsK,+CACZ,OApGL,SAA+B3I,EAAmBC,GAAmD,IAE5EK,EACxBN,EADAI,MAASyH,YAAevH,UAG5B,GAAkB,OAAdA,EACA,OAAON,EAIX,GAAIM,EAAUwH,OAAS3J,EAAqB4J,OACxC,OAAO/H,EAKX,IAAMoI,EAAU9H,EAAUmF,aAAa2C,QAAQC,IAAI,SAACC,GAChD,OAAIA,EAAOC,WAAatI,EAAOuI,eACpB1J,OAAAyB,EAAA,EAAAzB,CAAA,GACAwJ,EADP,CAEIpI,KAAM7C,EAAWuL,SAGdN,IAIf,OAAOxJ,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwB,EADE,CAELmF,aAAa3G,OAAAyB,EAAA,EAAAzB,CAAA,GACNwB,EAAUmF,aADL,CAER2C,QAASA,YA+DdS,CAAsB7I,EAAOC,GACxC,KAAK5B,EAAWyK,4CACZ,OAxDL,SAA6B9I,EAAmBC,GAAiD,IAExEK,EACxBN,EADAI,MAASyH,YAAevH,UAG5B,GAAkB,OAAdA,EACA,OAAON,EAIX,GAAIM,EAAUwH,OAAS3J,EAAqB4J,OACxC,OAAO/H,EAKX,IAAMoI,EAAU9H,EAAUmF,aAAa2C,QAAQW,OAAO,SAACT,GACnD,OAAQA,EAAOC,WAAatI,EAAOuI,iBAGvC,OAAO1J,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwB,EADE,CAELmF,aAAa3G,OAAAyB,EAAA,EAAAzB,CAAA,GACNwB,EAAUmF,aADL,CAER2C,QAASA,YA0BdY,CAAoBhJ,EAAOC,GACtC,QACI,OAAO,OC/LJ,SAASF,EAAQC,EAAmBC,GAC/C,OAAQA,EAAOC,MACX,KAAK7B,EAAW4K,sCACZ,OAzBL,SAAmCjJ,EAAmBC,GACzD,OAAKD,EAAMI,MAAMyH,YAAYvH,UAGzBN,EAAMI,MAAMyH,YAAYvH,UAAUwH,OAAS3J,EAAqB4J,OACzD/H,EAEJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMyH,YAAYvH,UADtB,CAEL0H,aAAc/H,EAAOgI,iBAb1BjI,EAuBIkJ,CAA0BlJ,EAAOC,GAC5C,QACI,OAAO,MCJJ,SAASF,EAAQC,EAAmBC,GAC/C,OAAQA,EAAOC,MACX,KAAK7B,EAAW8K,qCACZ,OA1BL,SAA8BnJ,EAAmBC,GACpD,OAAKD,EAAMI,MAAMyH,YAAYvH,UAGzBN,EAAMI,MAAMyH,YAAYvH,UAAUwH,OAAS3J,EAAqB4J,OACzD/H,EAGJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMyH,YAAYvH,UADtB,CAEL8I,cAAenJ,EAAOgI,iBAd3BjI,EAwBIqJ,CAAqBrJ,EAAOC,GACvC,QACI,OAAO,MCyIJF,OA3Bf,SAAiBC,EAAyBC,GAItC,OAAQA,EAAOC,MACX,KAAK7B,EAAWiL,oBACZ,OA7IL,SAAmBtJ,EAAyBC,GAC/C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAa,CACTtG,aAAcgI,EAA4B/H,QAC1CJ,MAAO,KACPd,UAAW,UAqIRmB,CAAUzB,GACrB,KAAK3B,EAAWmL,6BACZ,OAjIL,SAA2BxJ,EAAyBC,GACvD,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAa,CACTtG,aAAcgI,EAA4B5H,QAC1CP,MAAO,KACPd,UAAW,CACPwH,KAAMyB,EAA2BxB,OACjCtC,aAAcxF,EAAOwF,aACrBgE,SAAUxJ,EAAOwJ,SACjBC,YAAazJ,EAAOyJ,YACpBC,cAAe1J,EAAO0J,cACtBC,iBAAkB3J,EAAO2J,iBACzB5B,aAAc/H,EAAO+H,aACrBoB,cAAenJ,EAAOmJ,oBAiHvBS,CAAkB7J,EAAOC,GACpC,KAAK5B,EAAWyL,2CACZ,OA5GL,SAAwC9J,EAAyBC,GACpE,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAa,CACTtG,aAAcgI,EAA4B5H,QAC1CP,MAAO,KACPd,UAAW,CACPwH,KAAMyB,EAA2BQ,qBACjCtE,aAAcxF,EAAOwF,aACrBgE,SAAUxJ,EAAOwJ,SACjBL,cAAenJ,EAAOmJ,oBAgGvBY,CAA+BhK,EAAOC,GACjD,KAAK5B,EAAW4L,oBACZ,OA3FL,SAAmBjK,EAAyBC,GAC/C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAa,CACTtG,aAAcgI,EAA4BtE,MAC1C7D,MAAOnB,EAAOmB,MACdd,UAAW,UAmFR8B,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAW6L,gBACZ,OA/EL,SAAgBlK,EAAyBC,GAC5C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAa,CACTtG,aAAcgI,EAA4BjH,KAC1ClB,MAAO,KACPd,UAAW,UAuERiC,CAAOvC,GAClB,KAAK3B,EAAW8L,kCACZ,OAnEL,SAAgCnK,EAAyBC,GAC5D,IAAKD,EAAMI,MAAMyH,YAAYvH,UACzB,OAAON,EAGX,GAAIA,EAAMI,MAAMyH,YAAYvH,UAAUwH,OAASyB,EAA2BxB,OACtE,OAAO/H,EAEX,IAAMoK,EAAgBpK,EAAMI,MAAMyH,YAAYvH,UAAUmF,aAAa4E,WAAWtB,OAAO,SAACuB,GACpF,OAAQA,EAAUC,cAAgBtK,EAAOqK,UAAUC,cAEvD,OAAOzL,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMyH,YAAYvH,UADtB,CAELmF,aAAa3G,OAAAyB,EAAA,EAAAzB,CAAA,GACNkB,EAAMI,MAAMyH,YAAYvH,UAAUmF,aAD7B,CAER4E,WAAYD,YA8CjBI,CAAuBxK,EAAOC,GACzC,KAAK5B,EAAWoM,kCACZ,OAxCL,SAAgCzK,EAAyBC,GAC5D,OAAKD,EAAMI,MAAMyH,YAAYvH,UAGzBN,EAAMI,MAAMyH,YAAYvH,UAAUwH,OAASyB,EAA2BxB,OAC/D/H,EAEJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyH,YAAY/I,OAAAyB,EAAA,EAAAzB,CAAA,GACLkB,EAAMI,MAAMyH,YADR,CAEPvH,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMyH,YAAYvH,UADtB,CAELmF,aAAcxF,EAAOwF,qBAb1BzF,EAsCI0K,CAAuB1K,EAAOC,GAG7C,OAAO0K,EAAmB3K,EAAOC,IAC7B2K,EAAiB5K,EAAOC,IACxB4K,EAAoB7K,EAAOC,IAC3B6K,EAAY9K,EAAOC,ICwB3B,SAAS8K,GAAa/K,EAAuBC,GAIzC,OAAQA,EAAOC,MACX,KAAK7B,EAAW2M,yBACZ,OA/BZ,SAAqBhL,EAAuBC,GAA6C,IAAAgL,EAI/EhL,EAHEiL,iBACJC,EAFiFF,EAEjFE,iBAAkBC,EAF+DH,EAE/DG,cAAeC,EAFgDJ,EAEhDI,aAAcC,EAFkCL,EAElCK,YAAaC,EAFqBN,EAErBM,UAAWC,EAFUP,EAEVO,cAAezC,EAFLkC,EAEKlC,OACtF0C,EAHiFR,EAGjFQ,WAAYC,EAHqET,EAGrES,cAAeC,EAHsDV,EAGtDU,uBAAwBvK,EAH8B6J,EAG9B7J,MAAOwK,EAHuBX,EAGvBW,UAG9D,OAAO9M,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIuB,aAAc1D,EAAsB8D,QACpCP,MAAO,KACPd,UAAW,CACP6K,mBAAkBC,gBAAeC,eAAcC,cAAaC,YAAWC,gBAAezC,SACtF0C,aAAYC,gBAAeC,yBAAwBvK,QAAOwK,eAmBnD1J,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAWwN,mBACZ,OAzKL,SAAoB7L,EAAuBC,GAC9C,OAAwB,OAApBD,EAAMM,WACNI,QAAQC,KAAK,gCACNX,GAsBJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIM,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMM,UADJ,CAELqL,uBAAwB,KACxBL,YAAarL,EAAOqL,YACpBM,WAAW,MA0IJE,CAAW9L,EAAOC,GAC7B,KAAK5B,EAAW0N,yBACZ,OAvIL,SAAyB/L,EAAuBC,GACnD,OAAwB,OAApBD,EAAMM,WACNI,QAAQC,KAAK,gCACNX,GAEJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIM,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMM,UADJ,CAELsL,WAAW,MA8HJI,CAAgBhM,GAC3B,KAAK3B,EAAW4N,2BACZ,OA3HL,SAA2BjM,EAAuBC,GACrD,OAAwB,OAApBD,EAAMM,WACNI,QAAQC,KAAK,gCACNX,GAEJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIM,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMM,UADJ,CAEL8K,cAAenL,EAAOmL,cACtBC,aAAcpL,EAAOoL,aACrBI,WAAYxL,EAAOwL,WACnBC,cAAezL,EAAOmL,cAAcc,OACpCN,WAAW,MA8GJO,CAAkBnM,EAAOC,GACpC,KAAK5B,EAAW+N,yBACZ,OAzGL,SAAyBpM,EAAuBC,GACnD,OAAwB,OAApBD,EAAMM,WACNI,QAAQC,KAAK,gCACNX,GAGJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIM,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMM,UADJ,CAELsL,WAAW,EACXxK,MAAOnB,EAAOmB,UA8FPiL,CAAgBrM,EAAOC,GAGlC,KAAK5B,EAAWiO,uBACZ,OA5FL,SAAuBtM,EAAuBC,GACjD,OAAwB,OAApBD,EAAMM,WACNI,QAAQC,KAAK,gCACNX,GAGJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIM,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMM,UADJ,CAELiL,UAAWtL,EAAOsL,UAClBC,cAAevL,EAAOuL,cACtBI,WAAW,MAgFJW,CAAcvM,EAAOC,GAChC,KAAK5B,EAAWmO,yBACZ,OA/DZ,SAAyBxM,EAAuBC,GAC5C,GAAwB,OAApBD,EAAMM,UAEN,OADAI,QAAQC,KAAK,gCACNX,EAHkF,IAMrF+I,EAAW9I,EAAX8I,OAER,OAAOjK,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIM,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMM,UADJ,CAELyI,SACA6C,WAAW,MAkDJa,CAAgBzM,EAAOC,GAClC,KAAK5B,EAAWqO,mBACZ,MA7BD,CACHnL,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MA2BX,QACI,OAAO,MCnIJP,OAff,SAAiBC,EAAmBC,GAChC,OAAQA,EAAOC,MACX,KAAK7B,EAAWsO,iBACZ,OAnEL,SAAwB3M,EAAmBC,GAC9C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4M,KAAM,CACFC,OAAQpP,EAAUqP,SAClBnO,QAAS,GACToO,cAAe,CACXC,MAAO,GACPzE,SAAU,GACV0E,SAAU,GACVC,MAAO,OAyDJC,CAAenN,GAC1B,KAAK3B,EAAW+O,gBACZ,OArCL,SAAwBpN,EAAmBC,GAC9C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4M,KAAM,CACFC,OAAQpP,EAAU4P,WAClB1O,QAAS,GACToO,cAAe,CACXC,MAAO/M,EAAO+M,MACdzE,SAAUtI,EAAOsI,SACjB0E,SAAUhN,EAAOgN,SACjBC,MAAOjN,EAAOiN,UA2BXI,CAAetN,EAAOC,GACjC,KAAK5B,EAAWkP,kBACZ,OAvBL,SAA0BvN,EAAmBC,GAChD,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4M,KAAM,CACFC,OAAQpP,EAAU+P,aAClB7O,QAAS,GACToO,cAAe,CACXC,MAAO,GACPzE,SAAU,GACV0E,SAAU,GACVC,MAAO,OAaJO,CAAiBzN,GAC5B,KAAK3B,EAAWqP,iBACZ,OAzDL,SAAwB1N,EAAmBC,GAC9C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4M,KAAM,CACFC,OAAQpP,EAAUwH,MAClBtG,QAASsB,EAAOmB,MAAMzC,QACtBoO,cAAe,CACXC,MAAO,GACPzE,SAAU,GACV0E,SAAU,GACVC,MAAO,OA+CJS,CAAe3N,EAAOC,GACjC,QACI,OAAO,OCzDJF,OATf,SAAiBC,EAAmBC,GAChC,OAAQA,EAAOC,MACX,KAAK7B,EAAWuP,YACZ,OAbL,SAAoB5N,EAAmBC,GAC1C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI6N,IAAK,CACDhB,OAAQlP,EAASmQ,MACjBC,OAAQ9N,EAAO8N,UAQRC,CAAWhO,EAAOC,GAC7B,QACI,OAAO,OC2FJF,OAjBf,SAAiBC,EAAmBC,GAChC,OAAQA,EAAOC,MACX,KAAK7B,EAAW4P,iCACZ,OA5FL,SACHjO,EACAC,GACA,OAAOD,EAyFQyB,CAAUzB,GACrB,KAAK3B,EAAW6P,mCACZ,OAxFL,SACHlO,EACAC,GACA,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED+N,+BAAgC,CAC5B5M,aAAc1D,EAAsB8D,QACpCP,MAAO,KACPd,UAAW,CACPmF,aAAcxF,EAAOwF,aACrBwC,SAAUhI,EAAOgI,SACjBmG,YAAanO,EAAOmO,kBA2ErBlM,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAWgQ,iCACZ,OAtEL,SACHrO,EACAC,GACA,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED+N,+BAAgC,CAC5B5M,aAAc1D,EAAsBoH,MACpC7D,MAAOnB,EAAOmB,MACdd,UAAW,UA4DR8B,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAWiQ,6BACZ,OAvDL,SAAgBtO,EAAmBC,GACtC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED+N,+BAAgC,CAC5B5M,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,UA+CRiC,CAAOvC,GAClB,KAAK3B,EAAWkQ,8CACZ,OA3CL,SAA8BvO,EAAmBC,GAIpD,IAAKD,EAAMI,MAAM+N,+BAA+B7N,UAC5C,OAAON,EAEX,IACMwO,EADWxO,EAAMI,MAAM+N,+BAA+B7N,UAAU2H,SACzCI,IAAI,SAACoG,GAC9B,OAAIA,EAAQzK,GAAK/D,EAAOwO,QAAQzK,IACrB/D,EAAOwO,QAEXA,IAGX,OAAO3P,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED+N,+BAA+BrP,OAAAyB,EAAA,EAAAzB,CAAA,GACxBkB,EAAMI,MAAM+N,+BADW,CAE1B7N,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GAEHkB,EAAMI,MAAM+N,+BAA+B7N,UAFzC,CAGL2H,SAAUuG,UAmBXE,CAAqB1O,EAAOC,GACvC,QACI,OAAO,OC2DJF,ICmBHnC,GDnBGmC,GAtBf,SAAiBC,EAAmBC,GAIhC,OAAQA,EAAOC,MACX,KAAK7B,EAAWsQ,wBACZ,OAjJL,SAAmB3O,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDwO,gBAAgB9P,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMwO,gBADJ,CAEXrN,aAAc1D,EAAsB2D,QACpClB,UAAW,KACXc,MAAO,WAwIJK,CAAUzB,GACrB,KAAK3B,EAAWwQ,0BACZ,OArHL,SAAqB7O,EAAmBC,GAC3C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDwO,gBAAgB9P,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMwO,gBADJ,CAEXrN,aAAc1D,EAAsB8D,QACpCrB,UAAW,CACPmF,aAAcxF,EAAOwF,aACrBgE,SAAUxJ,EAAOwJ,UAErBrI,MAAO,WAyGJc,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAWyQ,wBACZ,OArGL,SAAmB9O,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDwO,gBAAgB9P,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMwO,gBADJ,CAEXrN,aAAc1D,EAAsBoH,MACpC3E,UAAW,KACXc,MAAOnB,EAAOmB,YA4FXgB,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAW0Q,oBACZ,OAxIL,SAAgB/O,EAAmBC,GACtC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDwO,gBAAgB9P,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMwO,gBADJ,CAEXrN,aAAc1D,EAAsByE,KACpChC,UAAW,KACXc,MAAO,WA+HJmB,CAAOvC,GAClB,KAAK3B,EAAW2Q,sCACZ,OA1FL,SAA+BhP,EAAmBC,GACrD,GAA8C,OAA1CD,EAAMI,MAAMwO,gBAAgBtO,UAC5B,OAAON,EAF6F,IAWlGoI,EAJFpI,EADAI,MAASwO,gBAAmBtO,UAKNmF,aAAa2C,QAAQC,IAAI,SAACC,GAChD,OAAIA,EAAOC,WAAatI,EAAOuI,gBAC3BF,EAAOpI,KAAO7C,EAAWoL,MAClBH,GAEAA,IAIf,OAAOxJ,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDwO,gBAAgB9P,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMwO,gBADJ,CAEXtO,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMwO,gBAAgBtO,UAD1B,CAELmF,aAAa3G,OAAAyB,EAAA,EAAAzB,CAAA,GACNkB,EAAMI,MAAMwO,gBAAgBtO,UAAWmF,aADlC,CAER2C,QAASA,YA4DdM,CAAsB1I,EAAOC,GACxC,KAAK5B,EAAW4Q,sCACZ,OAtDL,SAA+BjP,EAAmBC,GACrD,GAA8C,OAA1CD,EAAMI,MAAMwO,gBAAgBtO,UAC5B,OAAON,EAF6F,IAWlGoI,EAJFpI,EADAI,MAASwO,gBAAmBtO,UAKNmF,aAAa2C,QAAQC,IAAI,SAACC,GAChD,OAAIA,EAAOC,WAAatI,EAAOuI,gBAC3BF,EAAOpI,KAAO7C,EAAWuL,OAClBN,GAEAA,IAIf,OAAOxJ,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDwO,gBAAgB9P,OAAAyB,EAAA,EAAAzB,CAAA,GACTkB,EAAMI,MAAMwO,gBADJ,CAEXtO,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMwO,gBAAgBtO,UAD1B,CAELmF,aAAa3G,OAAAyB,EAAA,EAAAzB,CAAA,GACNkB,EAAMI,MAAMwO,gBAAgBtO,UAAWmF,aADlC,CAER2C,QAASA,YAwBdS,CAAsB7I,EAAOC,GACxC,QACI,OAAO,qDCuBPrC,6EAwCZkB,OAAAgB,EAAA,EAAAhB,CAA+BS,OAAxB,IC1NKjC,GAKAC,GAMAC,GDmNC0R,GAAb,SAAAC,GAEI,SAAAD,EAAY9N,GAAmB,IAAA3C,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAkQ,IAC3BzQ,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAoQ,GAAA/P,KAAAH,KAAM,CACFN,KAAM,kBACNC,QAASyC,EAAMgO,SACfxQ,OAAQwC,EAAMzC,QACdE,KAAM,IAAIwQ,IAAiB,CACvB,CAAC,WAAYjO,EAAMkO,UACnB,CAAC,aAAclO,EAAMmO,YACrB,CAAC,UAAWnO,EAAMoO,SAClB,CAAC,WAAYpO,EAAMgO,UACnB,CAAC,UAAWhO,EAAMzC,SAClB,CAAC,SAAUyC,EAAMqO,QACjB,CAAC,OAAQrO,EAAMsO,YAb3BC,mBAC+B,EAe3BlR,EAAKa,KAAO,iBACZb,EAAKkR,cAAgBvO,EAhBM3C,EAFnC,OAAAK,OAAAe,EAAA,EAAAf,CAAAoQ,EAAAC,GAAAD,EAAA,CAAoC5Q,GA0BvBsR,GAAb,SAAAC,GACI,SAAAD,EAAYhR,GAAgB,IAAAkR,EAAA,OAAAhR,OAAAC,EAAA,EAAAD,CAAAE,KAAA4Q,IACxBE,EAAAhR,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA8Q,GAAAzQ,KAAAH,KAAM,CAAEN,KAAM,mBAAoBC,QAAS,mBAAoBC,OAAQA,MAClEU,KAAO,kBAFYwQ,EADhC,OAAAhR,OAAAe,EAAA,EAAAf,CAAA8Q,EAAAC,GAAAD,EAAA,CAAqCtR,GAOxByR,GAAb,WAII,SAAAA,EAAAvR,GAA4D,IAA9CwO,EAA8CxO,EAA9CwO,MAAOgD,EAAuCxR,EAAvCwR,IAAuClR,OAAAC,EAAA,EAAAD,CAAAE,KAAA+Q,GAAA/Q,KAH5DgO,WAG4D,EAAAhO,KAF5DgR,SAE4D,EACxDhR,KAAKgO,MAAQA,EACbhO,KAAKgR,IAAMA,EANnB,OAAAlR,OAAAmR,EAAA,EAAAnR,CAAAiR,EAAA,EAAAG,IAAA,UAAAxN,MAAA,WAUQ,OAAOyN,MAAMnR,KAAKgR,IAAM,IAAK,CACzBI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,SAELC,KAAK,SAACC,GACH,OAAOA,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MArBvB,CAAAT,IAAA,cAAAxN,MAAA,SAyBgBsB,GACR,OAAOmM,MAAMnR,KAAKgR,IAAM,UAAYhM,EAAK,WACpCwM,KAAK,SAACC,GACH,OAAOA,EAASC,SAEnBF,KAAK,SAACI,GACH,OAAOA,MA/BvB,CAAAV,IAAA,aAAAxN,MAAA,eAAAmO,EAAA/R,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,IAAA,OAAAH,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAG,OAAA,SAoDepB,MAAMnR,KAAKgR,IAAM,SAAU,CAC9BI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,SAELC,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OAET,MADAnM,QAAQU,MAAM,wBAAyBqP,GACjC,IAAIlR,MAAM,yBAEpB,OAAOkR,EAASC,UAhEhC,wBAAAU,EAAAI,SAAAN,EAAAlS,SAAA,yBAAA6R,EAAAY,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,YAAAxN,MAAA,WAqEkE,IAAAiP,EAAA3S,KAC1D,OAAOmR,MAAMnR,KAAKgR,IAAM,SAAU,CAC9BI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,SAELC,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OAET,MADAnM,QAAQU,MAAM,wBAAyBqP,GACjC,IAAIlR,MAAM,yBAEpB,OAAOkR,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOiB,QAAQC,IAAIlB,EAAOtI,IAAI,SAACyJ,GAAD,OAAYH,EAAKI,aAAaD,EAAM9N,SAErEwM,KAAK,SAACG,GACH,OAAOA,MAxFvB,CAAAT,IAAA,eAAAxN,MAAA,SA4FiBsB,GACT,OAAOmM,MAAMnR,KAAKgR,IAAM,UAAYhM,EAAI,CACpCoM,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,SAELC,KAAK,SAACC,GACH,OAAwB,MAApBA,EAAS5D,OACF,KAEJ4D,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MA3GvB,CAAAT,IAAA,MAAAxN,MAAA,SA+GWsP,EAAqBC,GACxB,IAAMjC,EAAO,CAAChR,KAAKgR,KAAKkC,OAAOF,GAAOG,KAAK,KAC3C,OAAOhC,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,MACRJ,KAAMK,KAAKC,UAAUN,KAEpBzB,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OAeN,IAAwB,MAApB4D,EAAS5D,OAChB,OAAO4D,EAASC,OACXF,KAAK,SAACG,GACH,OAAOA,IAEZ,GAAwB,MAApBF,EAAS5D,OAAgB,CAEhC,OADe,KAGf,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAvB7E,OAAQ/B,EAASL,QAAQqC,IAAI,iBACzB,IAAK,mBACD,OAAOhC,EAASC,OACXF,KAAK,SAACG,GACH,MAAM,IAAIzB,GAAeyB,KAErC,IAAK,aACD,OAAOF,EAASiC,OACXlC,KAAK,SAACG,GACH,MAAM,IAAIf,GAAgBe,KAEtC,QACI,MAAM,IAAIpR,MAAM,4BAA8BkR,EAASL,QAAQqC,IAAI,sBAzI/F,CAAAvC,IAAA,OAAAxN,MAAA,eAAAiQ,EAAA7T,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,EAyJkBZ,EAAqBC,GAzJvC,IAAAjC,EAAAS,EAAAE,EAAAkC,EAAA,OAAA9B,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cA0JctB,EAAO,CAAChR,KAAKgR,KAAKkC,OAAOF,GAAOG,KAAK,KA1JnDW,EAAAxB,KAAA,EA2J+BnB,MAAMH,EAAK,CAC9BI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,OACRJ,KAAMA,EAAOK,KAAKC,UAAUN,GAAQ,KAnKhD,UAsKgC,OAXlBxB,EA3JdqC,EAAAC,MAsKqBlG,OAtKrB,CAAAiG,EAAAxB,KAAA,SAAAwB,EAAAE,GAuKoBvC,EAASL,QAAQqC,IAAI,gBAvKzCK,EAAAxB,KAwKqB,qBAxKrBwB,EAAAE,GAAA,EA2KqB,eA3KrBF,EAAAE,GAAA,0BAAAF,EAAAxB,KAAA,GAyKyCb,EAASC,OAzKlD,cAyK0BC,EAzK1BmC,EAAAC,KA0K0B,IAAI7D,GAAeyB,GA1K7C,eAAAmC,EAAAxB,KAAA,GA4K4Cb,EAASiC,OA5KrD,cA4K0BG,EA5K1BC,EAAAC,KA6K0B,IAAInD,GAAgBiD,GA7K9C,cA+K0B,IAAItT,MAAM,4BAA8BkR,EAASL,QAAQqC,IAAI,iBA/KvF,QAAAK,EAAAxB,KAAA,oBAiLuC,MAApBb,EAAS5D,OAjL5B,CAAAiG,EAAAxB,KAAA,gBAAAwB,EAAAxB,KAAA,GAkLyBb,EAASC,OAlLlC,eAAAoC,EAAAvB,OAAA,SAAAuB,EAAAC,MAAA,WAmLuC,MAApBtC,EAAS5D,OAnL5B,CAAAiG,EAAAxB,KAAA,gBAAAwB,EAAAvB,OAAA,SAoLmB,MApLnB,cAsLkB,IAAIhS,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAtLzF,yBAAAM,EAAAtB,SAAAoB,EAAA5T,SAAA,gBAAAiU,EAAAC,GAAA,OAAAP,EAAAlB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,MAAAxN,MAAA,eAAAyQ,EAAArU,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EA0LiBpB,GA1LjB,IAAAhC,EAAAS,EAAAE,EAAAkC,EAAA,OAAA9B,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cA2LctB,EAAO,CAAChR,KAAKgR,KAAKkC,OAAOF,GAAOG,KAAK,KA3LnDkB,EAAA/B,KAAA,EA4L+BnB,MAAMH,EAAK,CAC9BI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QAnMpB,UAsMgC,OAVlB5B,EA5Ld4C,EAAAN,MAsMqBlG,OAtMrB,CAAAwG,EAAA/B,KAAA,SAAA+B,EAAAL,GAuMoBvC,EAASL,QAAQqC,IAAI,gBAvMzCY,EAAA/B,KAwMqB,qBAxMrB+B,EAAAL,GAAA,EA2MqB,eA3MrBK,EAAAL,GAAA,0BAAAK,EAAA/B,KAAA,GAyMyCb,EAASC,OAzMlD,cAyM0BC,EAzM1B0C,EAAAN,KA0M0B,IAAI7D,GAAeyB,GA1M7C,eAAA0C,EAAA/B,KAAA,GA4M4Cb,EAASiC,OA5MrD,cA4M0BG,EA5M1BQ,EAAAN,KA6M0B,IAAInD,GAAgBiD,GA7M9C,cA+M0B,IAAItT,MAAM,4BAA8BkR,EAASL,QAAQqC,IAAI,iBA/MvF,QAAAY,EAAA/B,KAAA,oBAiNuC,MAApBb,EAAS5D,OAjN5B,CAAAwG,EAAA/B,KAAA,gBAAA+B,EAAA/B,KAAA,GAkNyBb,EAASC,OAlNlC,eAAA2C,EAAA9B,OAAA,SAAA8B,EAAAN,MAAA,cAoNkB,IAAIxT,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YApNzF,yBAAAa,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAsU,GAAA,OAAAH,EAAA1B,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,cAAAxN,MAAA,SAwNgB6Q,GAUR,IAAMC,EAAe,CACjBlU,KAAMiU,EAASjU,KACfmU,QAASF,EAAS3O,UAClB8O,OAAQ,CACJC,QAASJ,EAAStQ,QAClB2Q,kBAAmBL,EAAS5P,kBAC5BkQ,QAASN,EAASjQ,UAS1B,OAJIiQ,EAAShP,YAAY2H,OAAS,IAC9BsH,EAAQE,OAAOnP,YAAcgP,EAAShP,aAGnCvF,KAAK8U,IAAW,CAAC,QAASP,EAASvP,IAAKwP,KAjPvD,CAAAtD,IAAA,cAAAxN,MAAA,SAoPgBsB,EAAY+P,GACpB,IAAMP,EAAe,CACjBlU,KAAMyU,EAAYzU,KAClBoU,OAAQ,CACJC,QAASI,EAAY9Q,QACrB4Q,QAASE,EAAYzQ,QACrBsQ,kBAAmBG,EAAYpQ,mBAEnC8P,QAASM,EAAYN,SAOzB,OAHIM,EAAYxP,cACZiP,EAAQE,OAAOnP,YAAcwP,EAAYxP,aAEtC4L,MAAMnR,KAAKgR,IAAM,UAAYhM,EAAK,UAAW,CAChDoM,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,MAGRJ,KAAMK,KAAKC,UAAUiB,KAEpBhD,KAAK,SAACC,GAEH,GAAwB,MAApBA,EAAS5D,OAGb,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,gBApR7F,CAAAtC,IAAA,aAAAxN,MAAA,eAAAsR,EAAAlV,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAgD,EAwRqBC,GAxRrB,IAAAlC,EAAA,OAAAjB,GAAAC,EAAAG,KAAA,SAAAgD,GAAA,cAAAA,EAAA9C,KAAA8C,EAAA7C,MAAA,cAyRcU,EAAO,CAAC,UAAW,KAAMkC,GAzRvCC,EAAA7C,KAAA,EA0RqBtS,KAAKyT,IAAaT,GA1RvC,cAAAmC,EAAA5C,OAAA,SAAA4C,EAAApB,MAAA,wBAAAoB,EAAA3C,SAAAyC,EAAAjV,SAAA,gBAAAoV,GAAA,OAAAJ,EAAAvC,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,mBAAAxN,MAAA,SA6RqB2R,EAAiBC,GAC9B,IAAMC,EAAQ,IAAIC,gBAelB,OAdIF,EAAOG,eACPF,EAAMG,OAAO,SAAU,UAEvBJ,EAAO9I,gBACH8I,EAAO9I,gBAAkB5N,GAAc+W,WACvCJ,EAAMG,OAAO,QAAS,QAEtBH,EAAMG,OAAO,QAAS,QAG1BJ,EAAOM,SACPL,EAAMG,OAAO,cAAeG,OAAOP,EAAOM,QAAQE,YAG/C3E,MAAMnR,KAAKgR,IAAM,UAAYqE,EAAU,aAAeE,EAAMQ,WAAY,CAC3E3E,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAEjF,OAAO/B,EAASC,WA1ThC,CAAAR,IAAA,sBAAAxN,MAAA,SA8TwB4R,GAChB,IAAMC,EAAQ,IAAIC,gBAclB,OAbIF,EAAOG,eACPF,EAAMG,OAAO,SAAU,UAEvBJ,EAAO9I,gBACH8I,EAAO9I,gBAAkB5N,GAAc+W,WACvCJ,EAAMG,OAAO,QAAS,QAEtBH,EAAMG,OAAO,QAAS,QAG1BJ,EAAOM,SACPL,EAAMG,OAAO,cAAeG,OAAOP,EAAOM,QAAQE,YAE/C3E,MAAMnR,KAAKgR,IAAM,qBAAuBuE,EAAMQ,WAAY,CAC7D3E,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAEjF,OAAO/B,EAASC,WA1VhC,CAAAR,IAAA,qBAAAxN,MAAA,SA8VuB4R,GACf,IAAMC,EAAQ,IAAIC,gBAclB,OAbIF,EAAOG,eACPF,EAAMG,OAAO,SAAU,UAEvBJ,EAAO9I,gBACH8I,EAAO9I,gBAAkB5N,GAAc+W,WACvCJ,EAAMG,OAAO,QAAS,QAEtBH,EAAMG,OAAO,QAAS,QAG1BJ,EAAOM,SACPL,EAAMG,OAAO,cAAeG,OAAOP,EAAOM,QAAQE,YAE/C3E,MAAMnR,KAAKgR,IAAM,oBAAsBuE,EAAMQ,WAAY,CAC5D3E,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAEjF,OAAO/B,EAASC,WA1XhC,CAAAR,IAAA,wBAAAxN,MAAA,SA8X0B4R,GAClB,IAAMtE,EAAM,CACRhR,KAAKgR,IACL,QACAsE,EAAOD,QACP,WACA,YACAQ,OAAOP,EAAO/J,cAChB4H,KAAK,KACP,OAAOhC,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,SAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAEjF,OAAO/B,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAIA,EAAOqE,SACArE,MAxZ3B,CAAAT,IAAA,sBAAAxN,MAAA,eAAAuS,EAAAnW,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAiE,EAga8Bb,EAAiBc,EAAsBC,GAharE,IAAApD,EAAA,OAAAjB,GAAAC,EAAAG,KAAA,SAAAkE,GAAA,cAAAA,EAAAhE,KAAAgE,EAAA/D,MAAA,cAiacU,EAAO,CACT,QACAqC,EACA,WACAc,EACAC,EACA,WAvaZC,EAAA9D,OAAA,SAyaevS,KAAKsW,KAAWtD,EAAM,OAzarC,wBAAAqD,EAAA7D,SAAA0D,EAAAlW,SAAA,gBAAAuW,EAAAC,EAAAC,GAAA,OAAAR,EAAAxD,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,iBAAAxN,MAAA,SA4amB2R,EAAiBc,EAAsBC,GAClD,IAAMpF,EAAM,CACRhR,KAAKgR,IACL,QACAqE,EACA,WACAc,EACAC,GACFjD,KAAK,KACP,OAAOhC,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,WAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,gBAhcjG,CAAAtC,IAAA,gBAAAxN,MAAA,SAAAgT,GAqc0E,IAAtDxB,EAAsDwB,EAAtDxB,UACZ,OAAO/D,MAAMnR,KAAKgR,IAAM,eAAiBkE,EAAY,UAAW,CAC5D9D,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,QAEvD,OAAO4D,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MAtdvB,CAAAT,IAAA,gBAAAxN,MAAA,SAAAiT,GA0d0E,IAAtDzB,EAAsDyB,EAAtDzB,UACZ,OAAO/D,MAAMnR,KAAKgR,IAAM,eAAiBkE,EAAY,UAAW,CAC5D9D,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,QAEvD,OAAO4D,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MA3evB,CAAAT,IAAA,qCAAAxN,MAAA,SAAAkT,GA+e4F,IAC9E5D,EAAO,CAAC,UAAW,KAD2D4D,EAAnD1B,UACS,WAC1C,OAAOlV,KAAKsW,KAAWtD,EAAM,QAjfrC,CAAA9B,IAAA,cAAAxN,MAAA,SAAAmT,GAqfwE,IAAtD3B,EAAsD2B,EAAtD3B,UACV,OAAO/D,MAAMnR,KAAKgR,IAAM,eAAiBkE,EAAY,QAAS,CAC1D9D,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,QAEvD,OAAO4D,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MAtgBvB,CAAAT,IAAA,gBAAAxN,MAAA,SAAAoT,GA0gB2F,IAAvEzB,EAAuEyB,EAAvEzB,QAAS/L,EAA8DwN,EAA9DxN,OACf0H,EAAM,CACRhR,KAAKgR,IAAK,QAASqE,EAAS,OAAQ/L,EAAQ,SAC9C6J,KAAK,KACP,OAAOhC,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,OACN8B,OAAQ,QAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,IAAM4D,EAAS+B,gBAxhB/F,CAAAtC,IAAA,gBAAAxN,MAAA,SAAAqT,GA8hB2F,IAAvE1B,EAAuE0B,EAAvE1B,QAAS/L,EAA8DyN,EAA9DzN,OACf0H,EAAM,CACRhR,KAAKgR,IAAK,QAASqE,EAAS,OAAQ/L,EAAQ,SAC9C6J,KAAK,KACP,OAAOhC,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,OACN8B,OAAQ,WAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,IAAM4D,EAAS+B,gBA5iB/F,CAAAtC,IAAA,eAAAxN,MAAA,SAAAsT,GAkjB+H,IAA5G3B,EAA4G2B,EAA5G3B,QAAS7L,EAAmGwN,EAAnGxN,eAAgByN,EAAmFD,EAAnFC,OAC9BjE,EAAO,CACT,QAASqC,EAAS,OAAQ7L,EAAgB,UAG9C,OAAOxJ,KAAK8U,IAAU9B,EAAM,CAAE0B,OAAQuC,MAvjB9C,CAAA/F,IAAA,eAAAxN,MAAA,SAAAwT,GA0jB0F,IAAvE7B,EAAuE6B,EAAvE7B,QAAS/L,EAA8D4N,EAA9D5N,OACd0H,EAAM,CACRhR,KAAKgR,IAAK,QAASqE,EAAS,OAAQ/L,GACtC6J,KAAK,KACP,OAAOhC,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,OACN8B,OAAQ,WAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,IAAM4D,EAAS+B,gBAxkB/F,CAAAtC,IAAA,oBAAAxN,MAAA,SA6kBsB4R,GACd,OAAOnE,MAAMnR,KAAKgR,IAAM,UAAYsE,EAAOD,QAAU,qBAAsB,CACvEjE,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,SAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAEjF,OAAO/B,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MA9lBvB,CAAAT,IAAA,oBAAAxN,MAAA,SAAAyT,GAkmBsG,IAA9E9B,EAA8E8B,EAA9E9B,QAAS9L,EAAqE4N,EAArE5N,SACnByH,EAAM,CACRhR,KAAKgR,IAAK,QAASqE,EAAS,OAAQ9L,GACtC4J,KAAK,KACP,OAAOhC,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKgO,MACpBsD,OAAQ,oBAEZC,KAAM,OACN8B,OAAQ,SAEP7B,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,IAAM4D,EAAS+B,YAE/E,OAAO/B,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MArnBvB,CAAAT,IAAA,aAAAxN,MAAA,eAAA0T,EAAAtX,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAoF,EAAAC,GAAA,IAAAjC,EAAArC,EAAA,OAAAjB,GAAAC,EAAAG,KAAA,SAAAoF,GAAA,cAAAA,EAAAlF,KAAAkF,EAAAjF,MAAA,cAynBuB+C,EAznBvBiC,EAynBuBjC,QACTrC,EAAO,CAAC,QAASqC,EAAS,SA1nBxCkC,EAAAhF,OAAA,SA2nBevS,KAAK8U,IAAU9B,EAAM,OA3nBpC,wBAAAuE,EAAA/E,SAAA6E,EAAArX,SAAA,gBAAAwX,GAAA,OAAAJ,EAAA3E,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,kBAAAxN,MAAA,eAAA+T,EAAA3X,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAyF,EAAAC,GAAA,IAAAC,EAAA5E,EAAArB,EAAAkG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAApG,GAAAC,EAAAG,KAAA,SAAAiG,GAAA,cAAAA,EAAA/F,KAAA+F,EAAA9F,MAAA,cA8nB4BsF,EA9nB5BD,EA8nB4BC,SACd5E,EAAO,CAAC,UAAW,SAAU4E,EAASzE,KAAK,KAAM,OA/nB/DiF,EAAA9F,KAAA,EAgoB6BtS,KAAKyT,IAAST,GAhoB3C,OAkoBQ,IAFMrB,EAhoBdyG,EAAArE,KAioBc8D,EAAkB,IAAIxH,IAjoBpCyH,EAkoB+ChY,OAAOuY,QAAQ1G,GAAtDoG,EAAA,EAAAA,EAAAD,EAAA5K,OAAA6K,IAA+DC,EAAAF,EAAAC,GAAAE,EAAAnY,OAAAwY,GAAA,EAAAxY,CAAAkY,EAAA,GAAnD3C,EAAmD4C,EAAA,GAA1CE,EAA0CF,EAAA,GAC3DJ,EAAgBU,IAAIlD,EAAwB8C,GAnoBxD,OAAAC,EAAA7F,OAAA,SAqoBesF,GAroBf,wBAAAO,EAAA5F,SAAAkF,EAAA1X,SAAA,gBAAAwY,GAAA,OAAAf,EAAAhF,MAAAzS,KAAA0S,YAAA,MAAA3B,EAAA,GC7JO,SAAS0H,GAAyBhJ,GAErC,IAAMiJ,EA9BV,SAA6BxX,GACzB,OAAQA,GACJ,IAAK,SACD,OAAO5C,GAAYqa,WACvB,IAAK,UACD,OAAOra,GAAYsa,QACvB,QACI,MAAM,IAAIrY,MAAM,yBAA2BW,IAuB/B2X,CAAoBpJ,EAAQvO,MAC1CiV,EApBV,SAA8BjV,GAC1B,OAAQA,GACJ,IAAK,OACD,OAAO3C,GAAoBua,KAC/B,IAAK,YACD,OAAOva,GAAoBwa,UAC/B,IAAK,gBACD,OAAOxa,GAAoBya,IAC/B,QACI,MAAM,IAAIzY,MAAM,0BAA4BW,IAW/B+X,CAAqBxJ,EAAQyJ,cAC5Cf,GAAsC1I,EAAQ5B,OAP7CrP,GAAc2a,MASrB,OAAQhD,GACJ,KAAK5X,GAAoBua,KACrB,OAAoBxa,GAAYsa,QACrB,CACH5T,GAAIyK,EAAQzK,GACZoU,eAAgB3J,EAAQ4J,QACxBlD,aAAcA,EACdmD,UAAW7J,EAAQ6J,UACnBpY,KAAMwX,EACN7K,OAAQsK,EACRoB,KAAM9J,EAAQ+J,SACdC,UAAW,IAAI1W,KAAK0M,EAAQiK,YAC5BC,SAAU,IAAI5W,KAAK0M,EAAQmK,YAC3BC,WAAY,IAAI9W,KAAK0M,EAAQqK,UAiBzC,KAAKvb,GAAoBwa,UACrB,OAAoBza,GAAYsa,QACrB,CACH5T,GAAIyK,EAAQzK,GACZoU,eAAgB3J,EAAQ4J,QACxBlD,aAAcA,EACdmD,UAAW7J,EAAQ6J,UACnBpY,KAAMwX,EACN7K,OAAQsK,EACR4B,YAAatK,EAAQ+J,SACrBC,UAAW,IAAI1W,KAAK0M,EAAQiK,YAC5BC,SAAU,IAAI5W,KAAK0M,EAAQmK,YAC3BC,WAAY,IAAI9W,KAAK0M,EAAQqK,UAiBzC,KAAKvb,GAAoBya,IACrB,OAAoB1a,GAAYsa,QACrB,CACH5T,GAAIyK,EAAQzK,GACZoU,eAAgB3J,EAAQ4J,QACxBlD,aAAcA,EACdmD,UAAW7J,EAAQ6J,UACnBpY,KAAMwX,EACN7K,OAAQsK,EACR6B,MAAOvK,EAAQ+J,SACfC,UAAW,IAAI1W,KAAK0M,EAAQiK,YAC5BC,SAAU,IAAI5W,KAAK0M,EAAQmK,YAC3BC,WAAY,IAAI9W,KAAK0M,EAAQqK,UAgBzC,QACI,MAAM,IAAIvZ,MAAM,kCAAoCkP,EAAQyJ,yBAhM5D5a,kFAKAC,2FAMAC,0IA+LL,IC7KKyb,GAgDA5b,GAiBA6b,GA4CAC,GA2CA3b,GDqBC4b,GAAb,WAMI,SAAAA,EAAY9E,GAA8BxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAoa,GAAApa,KAJ1CsV,YAIyC,EAAAtV,KAHzCqa,kBAGyC,EAAAra,KAFzCsa,WAEyC,EACrCta,KAAKsV,OAASA,EACdtV,KAAKqa,aAAe,IAAIE,GAAuB,CAC3CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAEvBhO,KAAKsa,MAAQ,IAAIjK,IAZzB,OAAAvQ,OAAAmR,EAAA,EAAAnR,CAAAsa,EAAA,EAAAlJ,IAAA,aAAAxN,MAAA,eAAAsR,EAAAlV,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EAeqBgD,GAfrB,IAAAuF,EAAAhL,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,WAgBYtS,KAAKsa,MAAMI,IAAIxF,GAhB3B,CAAA9C,EAAAE,KAAA,eAAAF,EAAAG,OAAA,SAiBmBvS,KAAKsa,MAAM7G,IAAIyB,IAjBlC,cAAA9C,EAAAE,KAAA,EAoB+BtS,KAAKqa,aAAaM,WAAWzF,GApB5D,cAoBcuF,EApBdrI,EAAA2B,KAqBctE,EAAUgJ,GAAyBgC,GAEzCza,KAAKsa,MAAM/B,IAAI9I,EAAQzK,GAAIyK,GAvBnC2C,EAAAG,OAAA,SAwBe9C,GAxBf,wBAAA2C,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAe,EAAAvC,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,sBAAAxN,MAAA,eAAAkX,EAAA9a,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,IAAA,IAAAyG,EAAAQ,EAAA5R,EAAAxJ,EAAAO,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cA4Bc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA9B/B8F,EAAAxB,KAAA,EAiCgC+H,EAAaS,mBAAmB,CACpDrF,eAAe,EACfjJ,cAAe+N,GAAwB5E,aAnCnD,cAiCckF,EAjCd/G,EAAAC,MAsCc9K,EAAW4R,EAAUxR,IAAI,SAACoG,GAC5B,OAAOgJ,GAAyBhJ,MAG3BsL,QAAQ,SAACtL,GACThQ,EAAK6a,MAAMI,IAAIjL,EAAQzK,KACxBvF,EAAK6a,MAAM/B,IAAI9I,EAAQzK,GAAIyK,KA5C3CqE,EAAAvB,OAAA,SAgDetJ,GAhDf,wBAAA6K,EAAAtB,SAAAoB,EAAA5T,SAAA,yBAAA4a,EAAAnI,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,uBAAAxN,MAAA,eAAAsX,EAAAlb,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EAmD+BgF,GAnD/B,IAAAiB,EAAAQ,EAAAJ,EAAA,OAAA1I,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAoDc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAtD/BqG,EAAA/B,KAAA,EAyDgC+H,EAAaS,mBAAmB,CACpDrF,eAAe,EACfjJ,cAAe+N,GAAwB5E,aA3DnD,UAyDckF,EAzDdxG,EAAAN,KA+Dc0G,EAAWI,EAAUI,KAAK,SAACC,GAC7B,OAAOA,EAAE7B,UAAYD,IAhEjC,CAAA/E,EAAA/B,KAAA,eAAA+B,EAAA9B,OAAA,SAoEmB,MApEnB,cAAA8B,EAAA9B,OAAA,SAuEekG,GAAyBgC,IAvExC,wBAAApG,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAkU,GAAA,OAAA8G,EAAAvI,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,2BAAAxN,MAAA,eAAAyX,EAAArb,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAgD,EA0EmCmE,GA1EnC,IAAAiB,EAAAQ,EAAA,OAAA9I,GAAAC,EAAAG,KAAA,SAAAgD,GAAA,cAAAA,EAAA9C,KAAA8C,EAAA7C,MAAA,cA2Ec+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA7E/BmH,EAAA7C,KAAA,EAgFgC+H,EAAaS,mBAAmB,CACpDrF,eAAe,EACfjJ,cAAe+N,GAAwB5E,aAlFnD,cAgFckF,EAhFd1F,EAAApB,KAAAoB,EAAA5C,OAAA,SAsFesI,EACF9Q,OAAO,SAACmR,GACL,OAAOA,EAAE7B,UAAYD,IAExB/P,IAAI,SAAC6R,GACF,OAAOzC,GAAyByC,MA3FhD,wBAAA/F,EAAA3C,SAAAyC,EAAAjV,SAAA,gBAAAsU,GAAA,OAAA6G,EAAA1I,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,wBAAAxN,MAAA,eAAA0X,EAAAtb,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAiE,EA+FgCkD,GA/FhC,IAAAiB,EAAAQ,EAAA,OAAA9I,GAAAC,EAAAG,KAAA,SAAAkE,GAAA,cAAAA,EAAAhE,KAAAgE,EAAA/D,MAAA,cAgGc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAlG/BqI,EAAA/D,KAAA,EAqGgC+H,EAAagB,oBAAoB,CACrD5F,eAAe,EACfjJ,cAAe+N,GAAwB5E,aAvGnD,cAqGckF,EArGdxE,EAAAtC,KAAAsC,EAAA9D,OAAA,SA2GesI,EACF9Q,OAAO,SAACmR,GACL,OAAOA,EAAE7B,UAAYD,IAExB/P,IAAI,SAAC6R,GACF,OAAOzC,GAAyByC,MAhHhD,wBAAA7E,EAAA7D,SAAA0D,EAAAlW,SAAA,gBAAAoV,GAAA,OAAAgG,EAAA3I,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,gCAAAxN,MAAA,eAAA4X,EAAAxb,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAoF,EAuHwC+B,GAvHxC,IAAAiB,EAAApR,EAAA,OAAA8I,GAAAC,EAAAG,KAAA,SAAAoF,GAAA,cAAAA,EAAAlF,KAAAkF,EAAAjF,MAAA,cAwHc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA1H/BuJ,EAAAlF,KAAA,EAAAkF,EAAAjF,KAAA,EA8I8B+H,EAAakB,iBAAiBnC,EAAgB,CAC5D3D,eAAe,EACfjJ,cAAe+N,GAAwB5E,aAhJvD,OAAA4B,EAAAvD,GAkJqB,SAACvE,GACF,OAAOgJ,GAAyBhJ,IALxCxG,EA9IZsO,EAAAxD,KAkJiB1K,IAlJjBkO,EAAAvD,IAAAuD,EAAAjF,KAAA,gBAAAiF,EAAAlF,KAAA,EAAAkF,EAAAiE,GAAAjE,EAAA,SAsJYtO,EAAW,GAtJvB,eAAAsO,EAAAhF,OAAA,SAyJetJ,GAzJf,yBAAAsO,EAAA/E,SAAA6E,EAAArX,KAAA,4BAAAuW,GAAA,OAAA+E,EAAA7I,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,yBAAAxN,MAAA,eAAA+X,EAAA3b,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAyF,EA4JiC0B,GA5JjC,IAAAiB,EAAAQ,EAAA,OAAA9I,GAAAC,EAAAG,KAAA,SAAAiG,GAAA,cAAAA,EAAA/F,KAAA+F,EAAA9F,MAAA,cA6Jc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA/J/BoK,EAAA9F,KAAA,EAkKgC+H,EAAaS,mBAAmB,CACpDrF,eAAe,EACfjJ,cAAe+N,GAAwB5E,aApKnD,cAkKckF,EAlKdzC,EAAArE,KAAAqE,EAAA7F,OAAA,SAwKesI,EACF9Q,OAAO,SAACmR,GACL,OAAOA,EAAE7B,UAAYD,IAExB/P,IAAI,SAAC6R,GACF,OAAOzC,GAAyByC,MA7KhD,wBAAA9C,EAAA5F,SAAAkF,EAAA1X,SAAA,gBAAAwW,GAAA,OAAAiF,EAAAhJ,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,6BAAAxN,MAAA,eAAAgY,EAAA5b,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA0J,IAAA,IAAAtB,EAAAQ,EAAA5R,EAAA6H,EAAA9Q,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAAyJ,GAAA,cAAAA,EAAAvJ,KAAAuJ,EAAAtJ,MAAA,cAmLc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QArL/B4N,EAAAtJ,KAAA,EAwLgC+H,EAAaS,mBAAmB,CACpDrF,eAAe,EACfjJ,cAAe+N,GAAwB5E,aA1LnD,cAwLckF,EAxLde,EAAA7H,MA6Lc9K,EAAW4R,EAAUxR,IAAI,SAACoG,GAC5B,OAAOgJ,GAAyBhJ,KACjC1F,OAAO,SAAC0F,GACP,OAAQA,EAAQvO,OAAS5C,GAAYqa,cAGhCoC,QAAQ,SAACtL,GACTqB,EAAKwJ,MAAMI,IAAIjL,EAAQzK,KACxB8L,EAAKwJ,MAAM/B,IAAI9I,EAAQzK,GAAIyK,KArM3CmM,EAAArJ,OAAA,SAyMetJ,GAzMf,wBAAA2S,EAAApJ,SAAAmJ,EAAA3b,SAAA,yBAAA0b,EAAAjJ,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,mCAAAxN,MAAA,eAAAmY,EAAA/b,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA6J,EA4M2C1C,GA5M3C,IAAAhK,EAAA,OAAA2C,GAAAC,EAAAG,KAAA,SAAA4J,GAAA,cAAAA,EAAA1J,KAAA0J,EAAAzJ,MAAA,cAAAyJ,EAAAzJ,KAAA,EA6MkCtS,KAAKgc,6BA7MvC,cA6Mc5M,EA7Md2M,EAAAhI,KAAAgI,EAAAxJ,OAAA,SA8MenD,EAAYrF,OAAO,SAACkS,GACvB,OAAQA,EAAW7C,iBAAmBA,KA/MlD,wBAAA2C,EAAAvJ,SAAAsJ,EAAA9b,SAAA,gBAAAyW,GAAA,OAAAoF,EAAApJ,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,qBAAAxN,MAAA,eAAAwY,EAAApc,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAkK,IAAA,IAAA9B,EAAAQ,EAAA5R,EAAA0J,EAAA3S,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAAiK,GAAA,cAAAA,EAAA/J,KAAA+J,EAAA9J,MAAA,cAoNc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAtN/BoO,EAAA9J,KAAA,EAyNgC+H,EAAagB,oBAAoB,CACrD5F,eAAe,EACfjJ,cAAe+N,GAAwB5E,aA3NnD,cAyNckF,EAzNduB,EAAArI,MA8Nc9K,EAAW4R,EAAUxR,IAAI,SAACoG,GAC5B,OAAOgJ,GAAyBhJ,MAG3BsL,QAAQ,SAACtL,GACTkD,EAAK2H,MAAMI,IAAIjL,EAAQzK,KACxB2N,EAAK2H,MAAM/B,IAAI9I,EAAQzK,GAAIyK,KApO3C2M,EAAA7J,OAAA,SAwOetJ,GAxOf,wBAAAmT,EAAA5J,SAAA2J,EAAAnc,SAAA,yBAAAkc,EAAAzJ,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,0BAAAxN,MAAA,eAAA2Y,EAAAvc,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAqK,EA2OkClD,GA3OlC,IAAAiB,EAAAQ,EAAAJ,EAAA,OAAA1I,GAAAC,EAAAG,KAAA,SAAAoK,GAAA,cAAAA,EAAAlK,KAAAkK,EAAAjK,MAAA,cA4Oc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA9O/BuO,EAAAjK,KAAA,EAiPgC+H,EAAagB,oBAAoB,CACrD5F,eAAe,EACfjJ,cAAe+N,GAAwB5E,aAnPnD,UAiPckF,EAjPd0B,EAAAxI,KAuPc0G,EAAWI,EAAUI,KAAK,SAACC,GAC7B,OAAQA,EAAE7B,UAAYD,IAxPlC,CAAAmD,EAAAjK,KAAA,eAAAiK,EAAAhK,OAAA,SA4PmB,MA5PnB,cAAAgK,EAAAhK,OAAA,SA+PekG,GAAyBgC,IA/PxC,wBAAA8B,EAAA/J,SAAA8J,EAAAtc,SAAA,gBAAAwX,GAAA,OAAA6E,EAAA5J,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,uCAAAxN,MAAA,eAAA8Y,EAAA1c,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAwK,EAkQ+CrD,GAlQ/C,IAAAiB,EAAA1P,EAAA,OAAAoH,GAAAC,EAAAG,KAAA,SAAAuK,GAAA,cAAAA,EAAArK,KAAAqK,EAAApK,MAAA,cAmQc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QArQ/B0O,EAAApK,KAAA,EAwQoC+H,EAAakB,iBAAiBnC,EAAgB,CACtE3D,eAAe,EACfjJ,cAAe+N,GAAwB5E,aA1QnD,cAwQchL,EAxQd+R,EAAA3I,KAAA2I,EAAAnK,OAAA,SA6Qe5H,EAActB,IAAI,SAACoG,GACtB,OAAOgJ,GAAyBhJ,MA9Q5C,wBAAAiN,EAAAlK,SAAAiK,EAAAzc,SAAA,gBAAAwY,GAAA,OAAAgE,EAAA/J,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,iCAAAxN,MAAA,eAAAiZ,EAAA7c,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2K,EAoSyChF,GApSzC,IAAAyC,EAAA1P,EAAAkS,EAAA,OAAA9K,GAAAC,EAAAG,KAAA,SAAA2K,GAAA,cAAAA,EAAAzK,KAAAyK,EAAAxK,MAAA,cAqSc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAvS/B8O,EAAAxK,KAAA,EA0SoCM,QAAQC,IAAI+E,EAASvO,IAAI,SAACgM,GAClD,OAAOgF,EAAakB,iBAAiBlG,EAAS,CAC1CI,eAAe,EACfjJ,cAAe+N,GAAwB5E,gBA7SvD,cA0SchL,EA1SdmS,EAAA/I,KAiTc8I,EAAclS,EAAcoS,OAAO,SAACF,EAAa5T,GACnD,OAAO4T,EAAY3J,OAAOjK,IAC3B,IAnTX6T,EAAAvK,OAAA,SAqTesK,EAAYxT,IAAI,SAACoG,GACpB,OAAOgJ,GAAyBhJ,MAtT5C,wBAAAqN,EAAAtK,SAAAoK,EAAA5c,SAAA,gBAAAgd,GAAA,OAAAL,EAAAlK,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,gBAAAxN,MAAA,eAAAuZ,EAAAnd,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAiL,EA0TwBhI,GA1TxB,IAAAmF,EAAA5K,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAAgL,GAAA,cAAAA,EAAA9K,KAAA8K,EAAA7K,MAAA,cA2Tc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA7T/BmP,EAAA7K,KAAA,EAgU8B+H,EAAa+C,cAAc,CAC7ClI,cAjUZ,cAgUczF,EAhUd0N,EAAApJ,KAAAoJ,EAAA5K,OAAA,SAmUekG,GAAyBhJ,IAnUxC,wBAAA0N,EAAA3K,SAAA0K,EAAAld,SAAA,gBAAAqd,GAAA,OAAAJ,EAAAxK,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,gBAAAxN,MAAA,eAAA4Z,EAAAxd,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAsL,EAsUwBrI,GAtUxB,IAAAmF,EAAA5K,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAAqL,GAAA,cAAAA,EAAAnL,KAAAmL,EAAAlL,MAAA,cAuUc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAzU/BwP,EAAAlL,KAAA,EA4U8B+H,EAAaoD,cAAc,CAC7CvI,cA7UZ,cA4UczF,EA5Ud+N,EAAAzJ,KAAAyJ,EAAAjL,OAAA,SA+UekG,GAAyBhJ,IA/UxC,wBAAA+N,EAAAhL,SAAA+K,EAAAvd,SAAA,gBAAA0d,GAAA,OAAAJ,EAAA7K,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,cAAAxN,MAAA,eAAAia,EAAA7d,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2L,EAkVsB1I,GAlVtB,IAAAmF,EAAA5K,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAA0L,GAAA,cAAAA,EAAAxL,KAAAwL,EAAAvL,MAAA,cAmVc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QArV/B6P,EAAAvL,KAAA,EAwV8B+H,EAAayD,YAAY,CAC3C5I,cAzVZ,cAwVczF,EAxVdoO,EAAA9J,KAAA8J,EAAAtL,OAAA,SA2VekG,GAAyBhJ,IA3VxC,wBAAAoO,EAAArL,SAAAoL,EAAA5d,SAAA,gBAAA+d,GAAA,OAAAJ,EAAAlL,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,uBAAAxN,MAAA,eAAAsa,EAAAle,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAgM,EA8V+B/I,GA9V/B,IAAAmF,EAAA5K,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAA+L,GAAA,cAAAA,EAAA7L,KAAA6L,EAAA5L,MAAA,cA+Vc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAjW/BkQ,EAAA5L,KAAA,EAoW8B+H,EAAaoD,cAAc,CAC7CvI,cArWZ,cAoWczF,EApWdyO,EAAAnK,KAAAmK,EAAA3L,OAAA,SAuWekG,GAAyBhJ,IAvWxC,wBAAAyO,EAAA1L,SAAAyL,EAAAje,SAAA,gBAAAme,GAAA,OAAAH,EAAAvL,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,uBAAAxN,MAAA,eAAA0a,EAAAte,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAoM,EA0W+BnJ,GA1W/B,IAAAmF,EAAA5K,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAAmM,GAAA,cAAAA,EAAAjM,KAAAiM,EAAAhM,MAAA,cA2Wc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA7W/BsQ,EAAAhM,KAAA,EAgX8B+H,EAAayD,YAAY,CAC3C5I,cAjXZ,cAgXczF,EAhXd6O,EAAAvK,KAAAuK,EAAA/L,OAAA,SAmXekG,GAAyBhJ,IAnXxC,wBAAA6O,EAAA9L,SAAA6L,EAAAre,SAAA,gBAAAue,GAAA,OAAAH,EAAA3L,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,sBAAAxN,MAAA,eAAA8a,EAAA1e,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAwM,EAsX8BpJ,EAAiB9L,GAtX/C,IAAA8Q,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAuM,GAAA,cAAAA,EAAArM,KAAAqM,EAAApM,MAAA,cAuXc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAzX/B0Q,EAAAnM,OAAA,SA4Xe8H,EAAasE,kBAAkB,CAClCtJ,UACA9L,aAECiI,KAAK,SAAC/B,GACH,OAAOgJ,GAAyBhJ,MAjYhD,wBAAAiP,EAAAlM,SAAAiM,EAAAze,SAAA,gBAAA4e,EAAAC,GAAA,OAAAL,EAAA/L,MAAAzS,KAAA0S,YAAA,MAAA0H,EAAA,GE/MqB0E,2HAGiBC,GAC9B,IAAMC,EAAoBD,EAAEE,OAAOH,EAAWI,gBAC9C,IAA2B,IAAvBF,EACA,OAAO,EAEX,IAAMG,EAAcH,EAAoB,EAAI,EAAI,EAAIA,EAAoB,EAClEI,EAASL,EAAEM,MAAMF,EAAaH,GAC9BM,EAAQP,EAAEM,MAAML,EAAoB,EAAGA,EAAoB,GACjE,6CAAA9L,OAA8C8L,EAA9C,OAAA9L,OAAqEkM,EAArE,OAAAlM,OAAiFoM,yCAEhEta,GAEjB,GAAkB,IAAdA,EAAGkI,OACH,MAAO,CACHlI,EAAI,CACA9D,KAAM/C,EAAoBohB,iBAC1B5f,QAAS,mCACTmD,YAAa,IAAIC,OAI7B,GAAIiC,EAAGwa,MAAM,MACT,MAAO,CACHxa,EAAI,CACA9D,KAAM/C,EAAoB8H,MAC1BtG,QAAS,0CACTmD,YAAa,IAAIC,OAK7B,GAAIiC,EAAGkI,OAAS,IACZ,MAAO,CACHlI,EAAI,CACA9D,KAAM/C,EAAoB8H,MAC1BtG,QAAS,wDACTmD,YAAa,IAAIC,OAM7B,OAAKiC,EAAGwa,MADQ,gBAWT,CAACxa,EAAI,CACR9D,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,OAXV,CACHiC,EAAI,CACA9D,KAAM/C,EAAoB8H,MAC1BtG,QAAS,mGACTmD,YAAa,IAAIC,+CAWVzC,GACnB,OAAoB,IAAhBA,EAAK4M,OACE,CACH5M,EAAM,CACFY,KAAM/C,EAAoBohB,iBAC1B5f,QAAS,qCACTmD,YAAa,IAAIC,OAGzBzC,EAAK4M,OAAS,IACP,CACH5M,EAAM,CACFY,KAAM/C,EAAoB8H,MAC1BtG,QAAS,0DACTmD,YAAa,IAAIC,OAGtB,CACHzC,EAAM,CACFY,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,kDAIHkB,GACtB,OAAgB,OAAZA,EACO,CACHA,EAAS,CACL/C,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,OAIzBkB,EAAQiJ,OAAS,IACV,CACHjJ,EAAS,CACL/C,KAAM/C,EAAoB8H,MAC1BtG,QAAS,kDACTmD,YAAa,IAAIC,OAGtB,CACHkB,EAAS,CACL/C,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,kDAIHuB,GACtB,OAAgB,OAAZA,EACO,CACHA,EAAS,CACLpD,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,OAIzBuB,EAAQ4I,OAAS,IACV,CACH5I,EAAS,CACLpD,KAAM/C,EAAoB8H,MAC1BtG,QAAS,kDACTmD,YAAa,IAAIC,OAGtB,CACHuB,EAAS,CACLpD,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,4DAIO4B,GAChC,OAAiC,IAA7BA,EAAkBuI,OACX,CACH5M,KAAM,CACFY,KAAM/C,EAAoBohB,iBAC1B5f,QAAS,sCACTmD,YAAa,IAAIC,OAGzB4B,EAAkBuI,OAAS,IACpB,CACHvI,EAAmB,CACfzD,KAAM/C,EAAoB8H,MAC1BtG,QAAS,2DACTmD,YAAa,IAAIC,OAGtB,CACH4B,EAAmB,CACfzD,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,sDAqDCwC,GAC1B,OAA2B,IAAvBA,EAAY2H,OAKL,CAAC5M,KAAM,CACVY,KAAM/C,EAAoB8H,MAC1BtG,QAAS,4CACTmD,YAAa,IAAIC,OAarBwC,EAAY2H,OAAS,KACd,CACH3H,EAAa,CACTrE,KAAM/C,EAAoB8H,MAC1BtG,QAAS,mEACTmD,YAAa,IAAIC,OAGtB,CACHwC,EAAa,CACTrE,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,mDAKF0c,GAEvB,OAAIA,EAAMvS,OADa,IAEZ,CACHuS,EAAO,CACHve,KAAM/C,EAAoB8H,MAC1BtG,QAAO,uCAAAuT,OALI,IAKJ,eACPpQ,YAAa,IAAIC,OAGtB,CACH0c,EAAO,CACHve,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,gBDhE1B,SAAS2c,GACZC,EACApW,EACAkG,EACAwM,GAEA,GAAI0D,EAAI7W,OAASqR,GAAiByF,qBAC9B,OAAInQ,GAAWA,EAAQ8J,OAAShQ,EACrB,CACHrI,KAAM+Y,GAA2B4F,uBACjC3K,UAAWzF,EAAQzK,IAEhBiX,GAAcA,EAAW1C,OAAShQ,EAClC,CACHrI,KAAM+Y,GAA2B6F,0BACjC5K,UAAW+G,EAAWjX,IAGnB,CACH9D,KAAM+Y,GAA2B3W,MAK7C,GAAIiG,IAAaoW,EAAII,MAAMxW,SACvB,MAAO,CACHrI,KAAM+Y,GAA2B+F,OAGrC,IAAM1W,EAASqW,EAAIvW,QAAQ6R,KAAK,SAAC3R,GAC7B,OAAQA,EAAOC,WAAaA,IAEhC,IAAID,EAmBG,OAAImG,GAAWA,EAAQ8J,OAAShQ,EAC5B,CACHrI,KAAM+Y,GAA2B4F,uBACjC3K,UAAWzF,EAAQzK,IAEhBiX,GAAcA,EAAW1C,OAAShQ,EAClC,CACHrI,KAAM+Y,GAA2B6F,0BACjC5K,UAAW+G,EAAWjX,IAGnB,CACH9D,KAAM+Y,GAA2B3W,MA9BrC,OAAQgG,EAAOpI,MACX,KAAK7C,GAAWuL,OACZ,MAAO,CACH1I,KAAM+Y,GAA2BrQ,QAEzC,KAAKvL,GAAWoL,MACZ,MAAO,CACHvI,KAAM+Y,GAA2BxQ,OAEzC,KAAKpL,GAAW2hB,MACZ,MAAO,CACH9e,KAAM+Y,GAA2B+F,OAEzC,QACI,MAAO,CACH9e,KAAM+Y,GAA2B3W,OAqBzD,SAAS2c,GAAqCC,GAC1C,OAAQA,GACJ,IAAK,OACD,OAAOhG,GAAwB5W,KACnC,IAAK,OACD,OAAO4W,GAAwBiG,KACnC,IAAK,QACD,OAAOjG,GAAwBkG,KACnC,IAAK,QACD,OAAOlG,GAAwBzQ,MACnC,IAAK,MACD,OAAOyQ,GAAwB8F,MACnC,QACI,MAAM,IAAIzf,MAAM,mCAAqC2f,IAI1D,SAASG,GAAoBvN,EAAwBwN,GAExD,IAAMP,EAAgB,CAClBxW,SAAUuJ,EAAMiN,MAAMzf,KACtBigB,SAAU,IAAIxd,KAAK+P,EAAMiN,MAAMS,QAC/BC,cAAe3N,EAAMiN,MAAMW,UAAY,IAAI3d,KAAK+P,EAAMiN,MAAMW,WAAa,KACzExf,KAAM7C,GAAW2hB,MACjBP,MAAO,SAILrW,EAA0B,GAE7B8J,OAAOJ,EAAM6N,OAAOtX,IAAI,SAACuX,GACxB,MAAO,CACHrX,SAAUqX,EAAMtgB,KAChBigB,SAAU,IAAIxd,KAAK6d,EAAMJ,QACzBC,cAAeG,EAAMF,UAAY,IAAI3d,KAAK6d,EAAMF,WAAa,KAC7Dxf,KAAM7C,GAAWoL,MACjBgW,MAAOmB,EAAMlM,OAAO+K,UAExBvM,OAAOJ,EAAM1J,QAAQC,IAAI,SAACC,GAC1B,MAAO,CACHC,SAAUD,EAAOhJ,KACjBigB,SAAU,IAAIxd,KAAKuG,EAAOkX,QAC1BC,cAAenX,EAAOoX,UAAY,IAAI3d,KAAKuG,EAAOoX,WAAa,KAC/Dxf,KAAM7C,GAAWuL,OACjB6V,MAAOnW,EAAOoL,OAAO+K,UAIvBpU,EAAuCyH,EAAM+N,UAAUC,UAAUzX,IAAI,SAACxJ,GACxE,MAAO,CACH0L,YAAawV,SAASlhB,EAAKmhB,IAAK,IAChCvB,MAAO5f,EAAKohB,SACZC,SAAUrhB,EAAKshB,OACfC,WAAYnB,GAAqCpgB,EAAKwhB,MACtD5H,UAAW,IAAI1W,KAAKlD,EAAKyhB,YACzBC,UAAW,IAAIxe,KAAKlD,EAAKia,SACzBvU,YAAa1F,EAAK0F,eAM1B,MAAO,CACHuD,KAAMqR,GAAiBpR,OACvB/D,GAAI8N,EAAM9N,GACV1E,KAAMwS,EAAMxS,KACZsF,UAAWkN,EAAM2B,QACjB+M,SAA0B,SAAf1O,EAAM2O,KACjBhX,SAAUiX,GAAwB5O,EAAM2O,MACxCxd,QAAS6O,EAAM4B,OAAOC,SAAW,KACjCrQ,QAASwO,EAAM4B,OAAOG,SAAW,KACjClQ,kBAAmBmO,EAAM4B,OAAOE,mBAAqB,GACrDrP,YAAauN,EAAM4B,OAAOnP,YAC1Bwa,MAAOA,EACP4B,kBAAmB7O,EAAM8O,eACzBxY,QAASA,EACTyQ,WAAY,IAAI9W,KAAK+P,EAAMgH,SAC3BL,UAAW,IAAI1W,KAAK+P,EAAM4G,YAC1B+G,cAAe3N,EAAM4N,UAAY,IAAI3d,KAAK+P,EAAM4N,WAAa,KAC7DrV,WAAYA,EACZwW,KAAM,GACNC,YAAahP,EAAMiP,SACnBC,eAAgBlP,EAAMmP,SAASnB,WAAa,EAC5CoB,SAAUpP,EAAMmP,SAASE,eAAiB,GAI3C,SAASC,GAA2BtP,EAA2CwN,GAClF,MAAO,CACHxX,KAAMqR,GAAiByF,qBACvB5a,GAAI8N,EAAM9N,GACVY,UAAWkN,EAAM2B,QAEjBhK,SAAUiX,GAAwB5O,EAAM2O,OA8DzC,SAASY,GAAYC,EAAgChW,GACxD,IAAMiW,EAAgBjW,EAAYjD,IAAI,SAACmZ,GACnC,OAAO,IAAIC,OAAOD,EAAM,OAY5B,OAVqBF,EAAKvY,OAAO,SAAC4V,GAC9B,OAA2B,IAAvBrT,EAAYY,QAGTqV,EAAcG,MAAM,SAACC,GACxB,OAAOA,EAAOC,KAAKjD,EAAIrf,OACnBqiB,EAAOC,KAAKjD,EAAIhb,mBAAqB,KACrCge,EAAOC,KAAKjD,EAAII,MAAMxW,cAMtC,SAASsZ,GAASC,GACd,IAAMC,EAAID,EAAEhN,UACZ,OAAOkN,KAAKC,MAAMF,EAAC,OAGvB,SAASG,GAAoB3W,EAAmB4W,EAAmBnR,EAAsBoR,GACrF,OAAQ7W,GACJ,IAAK,UACD,OAAO4W,GAAaN,GAAS7Q,EAAEyH,WAAaoJ,GAASO,EAAE3J,YAC3D,IAAK,WACL,IAAK,UACD,OAAO0J,GAAaN,GAAS7Q,EAAE6H,YAAcgJ,GAASO,EAAEvJ,aAC5D,IAAK,OACD,OAAOsJ,EAAYnR,EAAE1R,KAAK+iB,cAAcD,EAAE9iB,MAC9C,IAAK,QAGD,OAAO6iB,EAAYnR,EAAE+N,MAAMxW,SAAS8Z,cAAcD,EAAErD,MAAMxW,UAC9D,IAAK,iBACD,OAAO4Z,GAAanR,EAAEgQ,eAAiBoB,EAAEpB,gBAC7C,IAAK,cACD,OAAOmB,GAAanR,EAAE8P,YAAcsB,EAAEtB,aAC1C,QAEI,OADApgB,QAAQC,KAAK,6BAA+B4K,GACrC,GAInB,SAAS+W,GAAUlX,EAAyCG,EAAmBC,GAC3E,IAAM2W,EAAY3W,IAAkB5N,EAAc2kB,UAAY,GAAK,EACnE,OAAOnX,EAAciT,QAAQmE,KAAK,SAACxR,EAAGoR,GAClC,OAAOF,GAAoB3W,EAAW4W,EAAWnR,EAAGoR,IAAMF,GAAoB,OAAQ,EAAGlR,EAAGoR,KAIpG,SAAS1B,GAAwBD,GAC7B,OAAQA,GACJ,IAAK,OAAQ,OAAOxH,GAA2B3W,KAC/C,IAAK,SAAU,OAAO2W,GAA2BrQ,OACjD,IAAK,QAAS,OAAOqQ,GAA2BxQ,MAChD,IAAK,QAAS,OAAOwQ,GAA2B+F,MAChD,QAAS,MAAM,IAAIzf,MAAM,iBAAmBkhB,IAUpD,SAASgC,GAAYrX,EAArB5M,EAAoG+J,GAAwD,IAA5Fma,EAA4FlkB,EAA5FkkB,SAAUxV,EAAkF1O,EAAlF0O,MAAOyV,EAA2EnkB,EAA3EmkB,QAiD7E,OAAOvX,EAAcrC,OAAO,SAAC4V,GACzB,OAjDJ,SAAuBA,GACnB,OAAQ+D,GACJ,IAAK,SACD,MAAO,CACHzJ,GAA2BrQ,OAC3BqQ,GAA2BxQ,MAC3BwQ,GAA2B+F,OAC7B4D,SAASjE,EAAIlV,UACnB,IAAK,YACD,OAAQ,CACJwP,GAA2BrQ,OAC3BqQ,GAA2BxQ,MAC3BwQ,GAA2B+F,OAC7B4D,SAASjE,EAAIlV,UACnB,IAAK,MACL,QACI,OAAO,GAiCRoZ,CAAclE,IA9BzB,SAAmBA,GACf,OAAqB,IAAjBzR,EAAMhB,QAGHgB,EAAM4V,KAAK,SAACrC,GACf,OAAQA,GACJ,IAAK,SACD,OAAQ9B,EAAIlV,WAAawP,GAA2BrQ,OACxD,IAAK,QACD,OAAQ+V,EAAIlV,WAAawP,GAA2BxQ,MACxD,IAAK,QACD,OAAQkW,EAAIlV,WAAawP,GAA2B+F,MACxD,QACI,OAAO,KAiBU+D,CAAUpE,IAb3C,SAAsBA,GAClB,OAAQgE,GACJ,IAAK,SACD,OAAQhE,EAAIlL,QAChB,IAAK,UACD,OAAOkL,EAAIlL,QACf,IAAK,MACD,OAAO,EACX,QACI,OAAO,GAIgCuP,CAAarE,KCvhB/Cb,GACVI,eAAiB,uBDiChBjF,kNAgDA5b,2FAiBA6b,6HA4CAC,oGA2CA3b,qFAkaL,IAAMylB,GAAb,WAMI,SAAAA,EAAY3O,GAA4BxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAikB,GAAAjkB,KAJxCsV,YAIuC,EAAAtV,KAHvCqa,kBAGuC,EAAAra,KAFvCoM,mBAEuC,EACnCpM,KAAKsV,OAASA,EACdtV,KAAKqa,aAAe,IAAIE,GAAuB,CAC3CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAEvBhO,KAAKoM,cAAgB,IAAIiE,IAZjC,OAAAvQ,OAAAmR,EAAA,EAAAnR,CAAAmkB,EAAA,EAAA/S,IAAA,SAAAxN,MAAA,eAAAwgB,EAAApkB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EAeiBlN,GAfjB,IAAAvF,EAAAO,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,WAgBYtS,KAAKoM,cAAcsO,IAAI1V,GAhBnC,CAAAoN,EAAAE,KAAA,eAAAF,EAAAG,OAAA,SAiBmBvS,KAAKoM,cAAcqH,IAAIzO,IAjB1C,cAAAoN,EAAAG,OAAA,SAmBevS,KAAKqa,aAAatH,aAAa/N,GACjCwM,KAAK,SAACsB,GACH,IAAI6M,EAOJ,OALIA,EADe,SAAf7M,EAAM2O,MAAmB3O,EAAM2B,QACzB2N,GAA2BtP,EAA6CrT,EAAK6V,OAAO/L,UAEpF8W,GAAoBvN,EAA0BrT,EAAK6V,OAAO/L,UAEpE9J,EAAK2M,cAAcmM,IAAIvT,EAAI2a,GACpBA,KA5BvB,wBAAAvN,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAiQ,EAAAzR,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,kBAAAxN,MAAA,eAAAygB,EAAArkB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,EAgC0B5O,GAhC1B,IAAA2a,EAAA7O,EAAA9Q,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,WAiCYtS,KAAKoM,cAAcsO,IAAI1V,GAjCnC,CAAA8O,EAAAxB,KAAA,YAkCkBqN,EAAM3f,KAAKoM,cAAcqH,IAAIzO,IAC3B8D,OAASqR,GAAiBpR,OAnC9C,CAAA+K,EAAAxB,KAAA,cAoCsB,IAAI/R,MAAM,6BApChC,cAAAuT,EAAAvB,OAAA,SAsCmBoN,GAtCnB,cAAA7L,EAAAvB,OAAA,SAwCevS,KAAKqa,aAAatH,aAAa/N,GACjCwM,KAAK,SAACsB,GAEH,GAAmB,SAAfA,EAAM2O,MAAmB3O,EAAM2B,QAC/B,MAAM,IAAIlU,MAAM,6BAGpB,IAAMof,EAAMU,GAAoBvN,EAA0BhC,EAAKwE,OAAO/L,UAEtE,OADAuH,EAAK1E,cAAcmM,IAAIvT,EAAI2a,GACpBA,KAjDvB,wBAAA7L,EAAAtB,SAAAoB,EAAA5T,SAAA,gBAAAkU,GAAA,OAAAiQ,EAAA1R,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,UAAAxN,MAAA,eAAA0gB,EAAAtkB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EAqDkBiQ,GArDlB,IAAA1R,EAAA3S,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA9B,OAAA,SAsDeK,QAAQC,IAAIwR,EAAIhb,IAAI,SAACrE,GACxB,OAAO2N,EAAK2R,OAAOtf,OAvD/B,wBAAAqP,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAsU,GAAA,OAAA8P,EAAA3R,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,aAAAxN,MAAA,eAAA6gB,EAAAzkB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAgD,IAAA,IAAAuP,EAAAH,EAAA,OAAAtS,GAAAC,EAAAG,KAAA,SAAAgD,GAAA,cAAAA,EAAA9C,KAAA8C,EAAA7C,MAAA,cAAA6C,EAAA7C,KAAA,EA4D6BtS,KAAKqa,aAAaoK,YA5D/C,cA4DcD,EA5DdrP,EAAApB,KA6DcsQ,EAAMG,EAAOnb,IAAI,SAACyJ,GACpB,OAAOA,EAAM9N,KA9DzBmQ,EAAA5C,OAAA,SAgEevS,KAAK0kB,QAAQL,IAhE5B,wBAAAlP,EAAA3C,SAAAyC,EAAAjV,SAAA,yBAAAukB,EAAA9R,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,aAAAxN,MAAA,eAAAihB,EAAA7kB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAiE,IAAA,IAAAoM,EAAAsC,EAAA,OAAA7S,GAAAC,EAAAG,KAAA,SAAAkE,GAAA,cAAAA,EAAAhE,KAAAgE,EAAA/D,MAAA,cAAA+D,EAAA/D,KAAA,EAoE2BtS,KAAK6kB,cApEhC,cAoEcvC,EApEdjM,EAAAtC,KAsEc6Q,EAAUtC,EACXvY,OAAO,SAAC4V,GAGL,OAAQA,EAAIlV,WAAawP,GAA2B3W,OA1EpE+S,EAAA9D,OAAA,SA6EeqS,GA7Ef,wBAAAvO,EAAA7D,SAAA0D,EAAAlW,SAAA,yBAAA2kB,EAAAlS,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,+BAAAxN,MAAA,SAsFiCoP,GACzB,MAAO,CACH9N,GAAI8N,EAAM9N,GACV1E,KAAMwS,EAAMxS,KACZ2D,QAAS6O,EAAM4B,OAAOC,SAAW,KACjCF,QAAS3B,EAAM2B,QACfnQ,QAASwO,EAAM4B,OAAOG,SAAW,KACjClQ,kBAAmBmO,EAAM4B,OAAOE,mBAAqB,KACrDmL,MAAO,CACHxW,SAAUuJ,EAAMiN,MAChBU,cAAe,KACfvf,KAAM7C,GAAW2hB,MACjBO,SAAU,IAAIxd,KAAK+P,EAAM4G,YACzB+F,MAAO,SAGXhV,SAAUiX,GAAwB5O,EAAM2O,MACxChI,UAAW,IAAI1W,KAAK+P,EAAM4G,YAC1BG,WAAY,IAAI9W,KAAK+P,EAAMgH,SAC3B2G,cAAe3N,EAAM4N,UAAY,IAAI3d,KAAK+P,EAAM4N,WAAa,KAC7DoB,YAAahP,EAAMiP,UAAY,EAC/BC,eAAgBlP,EAAMmP,SAASnB,WAAa,KA3GxD,CAAA5P,IAAA,cAAAxN,MAAA,eAAAohB,EAAAhlB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAoF,IAAA,IAAAmN,EAAAlC,EAAAyC,EAAA/kB,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAAoF,GAAA,cAAAA,EAAAlF,KAAAkF,EAAAjF,MAAA,cAAAiF,EAAAjF,KAAA,EAgH6BtS,KAAKqa,aAAa2K,aAhH/C,cAgHcR,EAhHdjN,EAAAxD,KAiHcuO,EAAOkC,EAAOnb,IAAI,SAACyJ,GACrB,OAAOiS,EAAKE,6BAA6BnS,KAlHrDyE,EAAAhF,OAAA,SAoHe+P,GApHf,wBAAA/K,EAAA/E,SAAA6E,EAAArX,SAAA,yBAAA8kB,EAAArS,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,YAAAxN,MAAA,eAAAwhB,EAAAplB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAyF,EAuHoBnC,GAvHpB,IAAA+M,EAAA6C,EAAAC,EAAAC,EAAA,OAAAtT,GAAAC,EAAAG,KAAA,SAAAiG,GAAA,cAAAA,EAAA/F,KAAA+F,EAAA9F,MAAA,cAAA8F,EAAA9F,KAAA,EAyH2BtS,KAAK6kB,cAzHhC,cAyHcvC,EAzHdlK,EAAArE,KA2HcoR,EAAW1B,GAAYnB,EAAM/M,EAAMxL,OAAQwL,EAAMhM,UACjD6b,EAAW/C,GAAY8C,EAAU5P,EAAMjJ,aACvC+Y,EAAS/B,GAAU8B,EAAU7P,EAAMhJ,UAAWgJ,EAAM/I,eA7HlE4L,EAAA7F,OAAA,SA+He,CACHnG,cAAeiZ,EACfC,MAAOhD,EAAKpV,SAjIxB,wBAAAkL,EAAA5F,SAAAkF,EAAA1X,SAAA,gBAAAoV,GAAA,OAAA8P,EAAAzS,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,UAAAxN,MAAA,eAAA6hB,EAAAzlB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA0J,EAqIkBpS,GArIlB,IAAA+Y,EAAAsC,EAAA,OAAA7S,GAAAC,EAAAG,KAAA,SAAAyJ,GAAA,cAAAA,EAAAvJ,KAAAuJ,EAAAtJ,MAAA,cAAAsJ,EAAAtJ,KAAA,EAsK2BtS,KAAK6kB,cAtKhC,cAsKcvC,EAtKd1G,EAAA7H,KAyKc6Q,EAAUtC,EAAKvY,OAAO,SAAC4V,GAEzB,OAAQA,EAAIlV,WAAawP,GAA2B3W,OA3KhEsY,EAAArJ,OAAA,SA4Le,CACHnG,cAAewY,EACfU,MAAOV,EAAQ1X,SA9L3B,wBAAA0O,EAAApJ,SAAAmJ,EAAA3b,SAAA,gBAAAuW,GAAA,OAAAgP,EAAA9S,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,kBAAAxN,MAAA,eAAA8hB,EAAA1lB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA6J,EAkM0B5G,GAlM1B,IAAAmF,EAAAoL,EAAA,OAAA1T,GAAAC,EAAAG,KAAA,SAAA4J,GAAA,cAAAA,EAAA1J,KAAA0J,EAAAzJ,MAAA,cAmMc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QArM/B+N,EAAAzJ,KAAA,EAwMc+H,EAAaqL,mCAAmC,CAAExQ,cAxMhE,cAAA6G,EAAAzJ,KAAA,EAyM0B+H,EAAaM,WAAWzF,GAzMlD,cAyMcuQ,EAzMd1J,EAAAhI,KAAAgI,EAAAxJ,OAAA,SA0MeoT,GAAsCF,IA1MrD,wBAAA1J,EAAAvJ,SAAAsJ,EAAA9b,SAAA,gBAAAwW,GAAA,OAAAgP,EAAA/S,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,SAAAxN,MAAA,eAAAkiB,EAAA9lB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAkK,EA6MiB0J,EAA8Btc,GA7M/C,IAAA8Q,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAiK,GAAA,cAAAA,EAAA/J,KAAA+J,EAAA9J,MAAA,UA8Mc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAIlB6X,EAAO7gB,GAAGpC,gBAAgB1B,OAAS/C,EAAoB0E,IACvDgjB,EAAOvlB,KAAKsC,gBAAgB1B,OAAS/C,EAAoB0E,IACzDgjB,EAAO5hB,QAAQrB,gBAAgB1B,OAAS/C,EAAoB0E,IAC5DgjB,EAAOtgB,YAAY3C,gBAAgB1B,OAAS/C,EAAoB0E,IAChEgjB,EAAOjgB,UAAUhD,gBAAgB1B,OAAS/C,EAAoB0E,GAxN3E,CAAAuZ,EAAA9J,KAAA,eAAA8J,EAAA7J,OAAA,SA0NmBK,QAAQkT,OAAO,IAAIvlB,MAAM,oCA1N5C,cAAA6b,EAAA7J,OAAA,SA6Ne8H,EAAa0L,YAAY,CAC5B/gB,GAAI6gB,EAAO7gB,GAAGtB,MACdpD,KAAMulB,EAAOvlB,KAAKoD,MAClBO,QAAS4hB,EAAO5hB,QAAQP,MACxBY,QAASuhB,EAAOvhB,QAAQZ,MACxBiB,kBAAmBkhB,EAAOlhB,kBAAkBjB,MAC5C6B,YAAasgB,EAAOtgB,YAAY7B,MAChCkC,UAAWigB,EAAOjgB,UAAUlC,QAE3B8N,KAAK,SAACsB,GACH,OAAOuN,GAAoBvN,MAvO3C,wBAAAsJ,EAAA5J,SAAA2J,EAAAnc,SAAA,gBAAAyW,EAAAe,GAAA,OAAAoO,EAAAnT,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,YAAAxN,MAAA,eAAAsiB,EAAAlmB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAqK,EA2OoBtX,GA3OpB,IAAAqV,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAoK,GAAA,cAAAA,EAAAlK,KAAAkK,EAAAjK,MAAA,cA4Oc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA9O/BuO,EAAAhK,OAAA,SAgPe8H,EAAa4L,YAAYjhB,GAC3BwM,KAAK,SAAAkF,GACF,OADkBA,EAAb9E,UAjPrB,wBAAA2K,EAAA/J,SAAA8J,EAAAtc,SAAA,gBAAAwY,GAAA,OAAAwN,EAAAvT,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,YAAAxN,MAAA,eAAAwiB,EAAApmB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAwK,EAsPoBzX,EAAYmhB,GAtPhC,IAAA9L,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAuK,GAAA,cAAAA,EAAArK,KAAAqK,EAAApK,MAAA,cAwPc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA1P/B0O,EAAAnK,OAAA,SAgQe8H,EAAa+L,YAAYphB,EAAI,CAChC1E,KAAM6lB,EAAU7lB,KAChB2D,QAASkiB,EAAUliB,QACnBK,QAAS6hB,EAAU7hB,QACnBK,kBAAmBwhB,EAAUxhB,kBAC7BY,YAAa4gB,EAAU5gB,YACvBkP,QAAS0R,EAAUvgB,aAtQ/B,wBAAA8W,EAAAlK,SAAAiK,EAAAzc,SAAA,gBAAAgd,EAAAK,GAAA,OAAA6I,EAAAzT,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,gBAAAxN,MAAA,SA0QkBsB,GACV,OAAO8Z,GAAWuH,cAAcrhB,KA3QxC,CAAAkM,IAAA,kBAAAxN,MAAA,SA8QoBpD,GACZ,OAAOwe,GAAWwH,gBAAgBhmB,KA/Q1C,CAAA4Q,IAAA,yBAAAxN,MAAA,SAkR2B6B,GACnB,OAAOuZ,GAAWyH,uBAAuBhhB,KAnRjD,CAAA2L,IAAA,yBAAAxN,MAAA,eAAA8iB,EAAA1mB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2K,EAsRiCxD,EAAgC7N,GAtRjE,IAAA8O,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAA2K,GAAA,cAAAA,EAAAzK,KAAAyK,EAAAxK,MAAA,cAuRc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAzR/B8O,EAAAvK,OAAA,SA4Re8H,EAAaoM,eAChBrN,EACA,YACAvD,OAAOtK,KA/RnB,wBAAAuR,EAAAtK,SAAAoK,EAAA5c,SAAA,gBAAA0d,EAAAK,GAAA,OAAAyI,EAAA/T,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,uBAAAxN,MAAA,eAAAgjB,EAAA5mB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAiL,EAmS+B7H,EAAiBe,GAnShD,IAAAiE,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAgL,GAAA,cAAAA,EAAA9K,KAAA8K,EAAA7K,MAAA,cAoSc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAtS/BmP,EAAA7K,KAAA,EA0Sc+H,EAAasM,oBAAoBtR,EAAS,YAAae,GA1SrE,cAAA+G,EAAA5K,OAAA,kCAAA4K,EAAA3K,SAAA0K,EAAAld,SAAA,gBAAAme,EAAAI,GAAA,OAAAmI,EAAAjU,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,oBAAAxN,MAAA,eAAAkjB,EAAA9mB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAsL,EA8S4BvY,GA9S5B,IAAAqV,EAAA5K,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAAqL,GAAA,cAAAA,EAAAnL,KAAAmL,EAAAlL,MAAA,cA+Sc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAjT/BwP,EAAAlL,KAAA,EAoT8B+H,EAAawM,kBAAkB,CACjDxR,QAASrQ,IArTrB,cAoTcyK,EApTd+N,EAAAzJ,KAAAyJ,EAAAjL,OAAA,SAuTeoT,GAAsClW,IAvTrD,wBAAA+N,EAAAhL,SAAA+K,EAAAvd,SAAA,gBAAA4e,GAAA,OAAAgI,EAAAnU,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,+BAAAxN,MAAA,eAAAojB,EAAAhnB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2L,EA0TuCvI,EAAiB9J,GA1TxD,IAAA8O,EAAA5K,EAAA,OAAAsC,GAAAC,EAAAG,KAAA,SAAA0L,GAAA,cAAAA,EAAAxL,KAAAwL,EAAAvL,MAAA,cA2Tc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA7T/B6P,EAAAvL,KAAA,EAgU8B+H,EAAa0M,sBAAsB,CACrD1R,QAASA,EACT9J,YAAaA,IAlUzB,WAoUiC,KAJnBkE,EAhUdoO,EAAA9J,MAoUoBiC,SApUpB,CAAA6H,EAAAvL,KAAA,eAAAuL,EAAAtL,OAAA,UAqUmB,GArUnB,cAAAsL,EAAAtL,OAAA,SAuUmBoT,GAAsClW,IAvUzD,wBAAAoO,EAAArL,SAAAoL,EAAA5d,SAAA,gBAAA6e,EAAAmI,GAAA,OAAAF,EAAArU,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,gBAAAxN,MAAA,eAAAujB,EAAAnnB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAgM,EA2UwB5I,EAAiB/L,GA3UzC,IAAA+Q,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAA+L,GAAA,cAAAA,EAAA7L,KAAA6L,EAAA5L,MAAA,cA4Uc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA9U/BkQ,EAAA3L,OAAA,SAiVe8H,EAAa6M,cAAc,CAC9B7R,UACA/L,YAnVZ,wBAAA4U,EAAA1L,SAAAyL,EAAAje,SAAA,gBAAAmnB,EAAAC,GAAA,OAAAH,EAAAxU,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,gBAAAxN,MAAA,eAAA2jB,EAAAvnB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAoM,EAuVwBhJ,EAAiB/L,GAvVzC,IAAA+Q,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAmM,GAAA,cAAAA,EAAAjM,KAAAiM,EAAAhM,MAAA,cAwVc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA1V/BsQ,EAAA/L,OAAA,SA6Ve8H,EAAaiN,cAAc,CAC9BjS,UACA/L,YA/VZ,wBAAAgV,EAAA9L,SAAA6L,EAAAre,SAAA,gBAAAunB,EAAAC,GAAA,OAAAH,EAAA5U,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,eAAAxN,MAAA,eAAA+jB,EAAA3nB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAwM,EAkWuBpJ,EAAiB/L,GAlWxC,IAAA+Q,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAuM,GAAA,cAAAA,EAAArM,KAAAqM,EAAApM,MAAA,cAmWc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QArW/B0Q,EAAAnM,OAAA,SAwWe8H,EAAaqN,aAAa,CAC7BrS,UACA/L,YA1WZ,wBAAAoV,EAAAlM,SAAAiM,EAAAze,SAAA,gBAAA2nB,EAAAC,GAAA,OAAAH,EAAAhV,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,eAAAxN,MAAA,eAAAmkB,EAAA/nB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA6V,EA8WuBzS,EAAiB7L,EAAwByN,GA9WhE,IAAAoD,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAA4V,GAAA,cAAAA,EAAA1V,KAAA0V,EAAAzV,MAAA,cA+Wc+H,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAjX/B+Z,EAAAxV,OAAA,SAoXe8H,EAAa2N,aAAa,CAAE3S,UAAS7L,iBAAgByN,YApXpE,wBAAA8Q,EAAAvV,SAAAsV,EAAA9nB,SAAA,gBAAAioB,EAAAC,EAAAC,GAAA,OAAAN,EAAApV,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,WAAAxN,MAAA,eAAA0kB,EAAAtoB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAoW,EAAA1R,GAAA,IAAAyC,EAAAiB,EAAA,OAAAtI,GAAAC,EAAAG,KAAA,SAAAmW,GAAA,cAAAA,EAAAjW,KAAAiW,EAAAhW,MAAA,cAuXqB8G,EAvXrBzC,EAuXqByC,eACPiB,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QA1X/Bsa,EAAA/V,OAAA,SA4Xe8H,EAAakO,WAAW,CAAElT,QAAS+D,KA5XlD,wBAAAkP,EAAA9V,SAAA6V,EAAAroB,SAAA,gBAAAwoB,GAAA,OAAAJ,EAAA3V,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,wBAAAxN,MAAA,eAAA+kB,EAAA3oB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAyW,EAAA9R,GAAA,IAAA+R,EAAAtO,EAAAhO,EAAAsF,EAAAiX,EAAAC,EAAAC,EAAAC,EAAAC,EAAAjS,EAAAD,EAAAzB,EAAAxH,EAAAsK,EAAA,OAAApG,GAAAC,EAAAG,KAAA,SAAA8W,GAAA,cAAAA,EAAA5W,KAAA4W,EAAA3W,MAAA,cA+XkCqW,EA/XlC/R,EA+XkC+R,gBACpBtO,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAlY/Bib,EAAA3W,KAAA,EAoYmC+H,EAAa6O,gBAAgB,CAAEtR,SAAU+Q,IApY5E,OAsYQ,IAFMtc,EApYd4c,EAAAlV,KAqYcpC,EAAS,IAAItB,IArY3BuY,GAAA,EAAAC,GAAA,EAAAC,OAAAK,EAAAF,EAAA5W,KAAA,EAsYQ0W,EAAgC1c,EAAagM,UAA7C+Q,OAAAC,cAAAT,GAAAI,EAAAD,EAAAzW,QAAAgX,MAAAV,GAAA,EAAwD7R,EAAAiS,EAAAtlB,MAAAoT,EAAAhX,OAAAwY,GAAA,EAAAxY,CAAAiX,EAAA,GAA5C1B,EAA4CyB,EAAA,GAAnCjJ,EAAmCiJ,EAAA,GAC9CqB,EAA+BoR,GAAsB1b,GAC3D8D,EAAO4G,IAAoBlD,EAAS8C,GAxYhD8Q,EAAA3W,KAAA,iBAAA2W,EAAA5W,KAAA,GAAA4W,EAAAjV,GAAAiV,EAAA,SAAAJ,GAAA,EAAAC,EAAAG,EAAAjV,GAAA,QAAAiV,EAAA5W,KAAA,GAAA4W,EAAA5W,KAAA,GAAAuW,GAAA,MAAAG,EAAAS,QAAAT,EAAAS,SAAA,WAAAP,EAAA5W,KAAA,IAAAwW,EAAA,CAAAI,EAAA3W,KAAA,eAAAwW,EAAA,eAAAG,EAAAQ,OAAA,mBAAAR,EAAAQ,OAAA,mBAAAR,EAAA1W,OAAA,SA0YeZ,GA1Yf,yBAAAsX,EAAAzW,SAAAkW,EAAA1oB,KAAA,+CAAA0pB,GAAA,OAAAjB,EAAAhW,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,uBAAAxN,MAAA,eAAAimB,EAAA7pB,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2X,EAAA5S,GAAA,IAAAoC,EAAAiB,EAAAhO,EAAAwd,EAAAC,EAAAC,EAAAC,EAAAC,EAAA3S,EAAAH,EAAAtJ,EAAA,OAAAkE,GAAAC,EAAAG,KAAA,SAAA+X,GAAA,cAAAA,EAAA7X,KAAA6X,EAAA5X,MAAA,cA6YiC8G,EA7YjCpC,EA6YiCoC,eACnBiB,EAAe,IAAIE,GAAuB,CAC5CvJ,IAAKhR,KAAKsV,OAAOkF,iBACjBxM,MAAOhO,KAAKsV,OAAOtH,QAhZ/Bkc,EAAA5X,KAAA,EAkZmC+H,EAAa6O,gBAAgB,CAAEtR,SAAU,CAACwB,KAlZ7E,OAkZc/M,EAlZd6d,EAAAnW,KAAA8V,GAAA,EAAAC,GAAA,EAAAC,OAAAZ,EAAAe,EAAA7X,KAAA,EAAA2X,EAmZwC3d,EAAagM,UAnZrD+Q,OAAAC,YAAA,WAAAQ,GAAAI,EAAAD,EAAA1X,QAAAgX,KAAA,CAAAY,EAAA5X,KAAA,gBAAAgF,EAAA2S,EAAAvmB,MAAAyT,EAAArX,OAAAwY,GAAA,EAAAxY,CAAAwX,EAAA,GAAAH,EAAA,GAmZ6BtJ,EAnZ7BsJ,EAAA,GAAA+S,EAAA3X,OAAA,SAoZmBgX,GAAsB1b,IApZzC,QAAAgc,GAAA,EAAAK,EAAA5X,KAAA,iBAAA4X,EAAA5X,KAAA,iBAAA4X,EAAA7X,KAAA,GAAA6X,EAAAlW,GAAAkW,EAAA,SAAAJ,GAAA,EAAAC,EAAAG,EAAAlW,GAAA,QAAAkW,EAAA7X,KAAA,GAAA6X,EAAA7X,KAAA,GAAAwX,GAAA,MAAAG,EAAAR,QAAAQ,EAAAR,SAAA,WAAAU,EAAA7X,KAAA,IAAAyX,EAAA,CAAAI,EAAA5X,KAAA,eAAAyX,EAAA,eAAAG,EAAAT,OAAA,mBAAAS,EAAAT,OAAA,kBAsZc,IAAIlpB,MAAM,qCAtZxB,yBAAA2pB,EAAA1X,SAAAoX,EAAA5pB,KAAA,+CAAAmqB,GAAA,OAAAR,EAAAlX,MAAAzS,KAAA0S,YAAA,MAAAuR,EAAA,GA0ZA,SAASsF,GAAsB1b,GAC3B,OAAQA,EAAOuc,KACX,IAAK,OAAQ,OAAO5rB,GAAc8E,KAClC,IAAK,MAAO,OAAO9E,GAAc6rB,IACjC,IAAK,MAAO,OAAO7rB,GAAcwE,IACjC,QAAS,MAAM,IAAIzC,MAAM,gCAAkCsN,IExyBpD9M,OAzBf,SAAiBC,EAAyBC,GACtC,OAAQA,EAAOC,MACX,KAAK7B,EAAWirB,uBACZ,OAzLL,SAAmBtpB,EAAyBC,GAC/C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVhoB,aAAcgI,EAA4B/H,cAkLvCC,CAAUzB,GACrB,KAAK3B,EAAWmrB,yBACZ,OA9KL,SAAqBxpB,EAAyBC,GACjD,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVhoB,aAAcgI,EAA4B5H,QAC1CP,MAAO,KACPd,UAAW,CACPQ,UAAWyI,EAA0BkgB,QACrCC,MAAOzpB,EAAOypB,MACdjkB,aAAcxF,EAAOwF,aACrBkkB,aAAc,YAiKfznB,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAWurB,uBACZ,OA5JL,SAAmB5pB,EAAyBC,GAC/C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVhoB,aAAcgI,EAA4B5H,QAC1CP,MAAOnB,EAAOmB,MACdd,UAAW,WAmJR8B,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAWwrB,mBACZ,OA/IL,SAAgB7pB,EAAyBC,GAC5C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVhoB,aAAcgI,EAA4BjH,KAC1ClB,MAAO,KACPd,UAAW,WAsIRiC,CAAOvC,GAClB,KAAK3B,EAAWyrB,iCACZ,OAlIL,SAA4B9pB,EAAyBC,GACxD,GAA6C,OAAzCD,EAAMI,MAAMmpB,eAAejpB,UAC3B,MAAM,IAAIf,MAAM,sBAEpB,OAAOT,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVjpB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmpB,eAAejpB,UADzB,CAELopB,MAAOzpB,EAAOypB,cAsHfK,CAAmB/pB,EAAOC,GACrC,KAAK5B,EAAW2rB,gCACZ,OAjHL,SAA2BhqB,EAAyBC,GACvD,GAA6C,OAAzCD,EAAMI,MAAMmpB,eAAejpB,UAC3B,MAAM,IAAIf,MAAM,sBAEpB,OAAOT,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVjpB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmpB,eAAejpB,UADzB,CAELqpB,aAAc,CACVpR,KAAMtY,EAAOsY,KACb9O,SAAUxJ,EAAOwJ,kBAmGtBwgB,CAAkBjqB,EAAOC,GACpC,KAAK5B,EAAW6rB,kCACZ,OA7FL,SAA6BlqB,EAAyBC,GACzD,GAA6C,OAAzCD,EAAMI,MAAMmpB,eAAejpB,UAC3B,MAAM,IAAIf,MAAM,sBAEpB,OAAOT,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVjpB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmpB,eAAejpB,UADzB,CAELQ,UAAWyI,EAA0B4gB,gBAiFtCC,CAAoBpqB,GAC/B,KAAK3B,EAAWgsB,oCACZ,OA5EL,SAA+BrqB,EAAyBC,GAC3D,GAA6C,OAAzCD,EAAMI,MAAMmpB,eAAejpB,UAC3B,MAAM,IAAIf,MAAM,sBAFgG,IAAA+qB,EAKtCtqB,EAAtEI,MAASmpB,eAAkBjpB,UAAaqpB,EALoEW,EAKpEX,aAAcD,EALsDY,EAKtDZ,MAG9D,IAAKC,EACD,MAAM,IAAIpqB,MAAM,yBAIpB,GAFAoqB,EAAalgB,SAAW8gB,GAAoCzL,2BAEvD4K,EACD,MAAM,IAAInqB,MAAM,iBAEpB,IAAMirB,EAAWd,EAAMrhB,IAAI,SAACkQ,GAIxB,OAHIA,EAAKhQ,WAAaohB,EAAapR,KAAKhQ,WACpCgQ,EAAK9O,SAAW8gB,GAAoCzL,2BAEjDvG,IAGX,OAAOzZ,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVjpB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmpB,eAAejpB,UADzB,CAELQ,UAAWyI,EAA0B5H,QACrCgoB,aAAcA,EACdD,MAAOc,UA2CRC,CAAsBzqB,GACjC,KAAK3B,EAAWqsB,kCACZ,OAtCL,SAA6B1qB,EAAyBC,GACzD,GAA6C,OAAzCD,EAAMI,MAAMmpB,eAAejpB,UAC3B,MAAM,IAAIf,MAAM,sBAEpB,OAAOT,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDmpB,eAAezqB,OAAAyB,EAAA,EAAAzB,CAAA,GACRkB,EAAMI,MAAMmpB,eADL,CAEVjpB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMmpB,eAAejpB,UADzB,CAELQ,UAAWyI,EAA0BtE,cA0BtC0lB,CAAoB3qB,GAC/B,QACI,OAAO,OC9InB,SAASmF,KAKL,MAJ2B,CACvBjF,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,MAuDzB,SAASqD,GAAoB9E,GACzB,OAAIA,EAAUsqB,sBAAsBnM,MAAM9b,YAAc1F,EAAU2F,MACvD1F,EAAUuF,OAGdvF,EAAU6D,SAqGNhB,OAvBf,SAAiBC,EAAmBC,GAChC,OAAQA,EAAOC,MACX,KAAK7B,EAAWwsB,6BACZ,OA9ML,SAAmB7qB,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAsB,CAClBvpB,aAAc1D,EAAsB2D,QACpCJ,MAAO,KACPd,UAAW,UAsMRmB,CAAUzB,GACrB,KAAK3B,EAAW0sB,+BACZ,OAlML,SAAqB/qB,EAAmBC,GAC3C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAsB,CAClBvpB,aAAc1D,EAAsB8D,QACpCP,MAAO,KACPd,UAAW,CACPmF,aAAcxF,EAAOwF,aACrBmlB,sBAAuB3qB,EAAO2qB,sBAC9B9pB,UAAW5D,EAAU6D,SACrBP,UAAWpD,EAAU4E,IACrBJ,gBAAiBuD,WAqLlBjD,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAW2sB,6BACZ,OAhLL,SAAmBhrB,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAsB,CAClBvpB,aAAc1D,EAAsBoH,MACpC7D,MAAOnB,EAAOmB,MACdd,UAAW,UAwKR8B,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAW4sB,yBACZ,OApKL,SAAgBjrB,EAAmBC,GACtC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAsB,CAClBvpB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,UA4JRiC,CAAOvC,GAClB,KAAK3B,EAAW6sB,uCACZ,OAhJL,SAA4BlrB,EAAmBC,GAClD,IAAKD,EAAMI,MAAM0qB,qBAAqBxqB,UAClC,OAAON,EAGX,IACI2C,EADEwoB,EAAenrB,EAAMI,MAAM0qB,qBAAqBxqB,UAAUsqB,sBAG5DjoB,EADA1C,EAAOwe,QAAU0M,EAAa1M,MAAMpY,YACxBpJ,EAAU2F,MAEV3F,EAAU8I,MAE1B,IAAMO,EAAQxH,OAAAyB,EAAA,EAAAzB,CAAA,GACPkB,EADO,CAEVI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAqBhsB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAM0qB,qBADC,CAEhBxqB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAM0qB,qBAAqBxqB,UAD/B,CAELsqB,sBAAsB9rB,OAAAyB,EAAA,EAAAzB,CAAA,GACfkB,EAAMI,MAAM0qB,qBAAqBxqB,UAAUsqB,sBAD7B,CAEjBnM,MAAO,CACH/b,MAAOzC,EAAOwe,MACdpY,YAAapG,EAAOwe,MACpB9b,UAAWA,EACXf,gBAAiBuD,gBAQnCrE,EAAYsE,GAAoBkB,EAASlG,MAAM0qB,qBAAqBxqB,WAE1E,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAwH,EADP,CAEIlG,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAqBhsB,OAAAyB,EAAA,EAAAzB,CAAA,GACdwH,EAASlG,MAAM0qB,qBADF,CAEhBxqB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwH,EAASlG,MAAM0qB,qBAAqBxqB,UADlC,CAELQ,UAAWA,UAoGZsqB,CAAmBprB,EAAOC,GACrC,KAAK5B,EAAWgtB,mCACZ,OAxFZ,SAAyBrrB,EAAmBC,GACxC,IAAKD,EAAMI,MAAM0qB,qBAAqBxqB,UAClC,OAAON,EAGX,IAAMc,EAAYsE,GAAoBpF,EAAMI,MAAM0qB,qBAAqBxqB,WAEvE,OAAOxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAqBhsB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAM0qB,qBADC,CAEhBxqB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAM0qB,qBAAqBxqB,UAD/B,CAELQ,UAAWA,EACXc,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,cAsEtBupB,CAAgBtrB,GAC3B,KAAK3B,EAAWktB,iCACZ,OAhEZ,SAAuBvrB,EAAmBC,GACtC,OAAKD,EAAMI,MAAM0qB,qBAAqBxqB,UAG/BxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAqBhsB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAM0qB,qBADC,CAEhBxqB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAM0qB,qBAAqBxqB,UAD/B,CAELsB,gBAAiB,CACb1B,KAAM/C,EAAoB8H,MAC1BtG,QAAS,sBACTmD,YAAa,IAAIC,cAb1B/B,EA8DIwrB,CAAcxrB,GACzB,KAAK3B,EAAWotB,+BACZ,OA3CL,SAAqBzrB,EAAmBC,GAC3C,OAAKD,EAAMI,MAAM0qB,qBAAqBxqB,UAG/BxB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAED0qB,qBAAqBhsB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAM0qB,qBADC,CAEhBxqB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAM0qB,qBAAqBxqB,UAD/B,CAELQ,UAAW5D,EAAU6D,SACrBP,UAAWpD,EAAU4D,MACrB4pB,sBAAuB,CACnBnM,MAAM3f,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MAAM0qB,qBAAqBxqB,UAAUsqB,sBAAsBnM,MADnE,CAED9b,UAAW1F,EAAU8I,iBAflC/F,EAyCIiB,CAAYjB,GACvB,QACI,OAAO,OCzKZ,SAAS0rB,GAAiB1rB,EAAmBC,GAChD,IAAKD,EAAMI,MAAMurB,qBAAqBrrB,UAClC,MAAM,IAAIf,MAAM,sBAGpB,OAAOT,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDurB,qBAAqB7sB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAMurB,qBADC,CAEhBrrB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMurB,qBAAqBrrB,UAD/B,CAELE,UAAWpD,EAAUqD,eA4J1BV,OAzBf,SAAiBC,EAAmBC,GAChC,OAAQA,EAAOC,MACX,KAAK7B,EAAWutB,iCACZ,OAxML,SAAmB5rB,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAGDurB,qBAAqB7sB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAMurB,qBADC,CAEhBpqB,aAAc1D,EAAsB2D,QACpCJ,MAAO,KACPd,UAAW,WA8LRmB,CAAUzB,GACrB,KAAK3B,EAAWwtB,mCACZ,OA1LL,SAAqB7rB,EAAmBC,GAC3C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDurB,qBAAqB7sB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAMurB,qBADC,CAEhBpqB,aAAc1D,EAAsB8D,QACpCP,MAAO,KACPd,UAAW,CACPmF,aAAcxF,EAAOwF,aACrB4E,WAAYpK,EAAOoK,WACnByhB,kBAAmB,KACnBriB,SAAUxJ,EAAOwJ,SACjBrI,MAAO,KACPZ,UAAWpD,EAAU4D,aA2KtBkB,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAW0tB,iCACZ,OAtKL,SAAmB/rB,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDurB,qBAAqB7sB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAMurB,qBADC,CAEhBpqB,aAAc1D,EAAsBoH,MACpC7D,MAAOnB,EAAOmB,MACdd,UAAW,WA6JR8B,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAW2tB,iCACZ,OAAON,GAAiB1rB,GAC5B,KAAK3B,EAAW4tB,mCACZ,OAvIL,SAA4BjsB,EAAmBC,GAClD,IAAKD,EAAMI,MAAMurB,qBAAqBrrB,UAClC,MAAM,IAAIf,MAAM,sBAGpB,IAAM+G,EAAoBxH,OAAAyB,EAAA,EAAAzB,CAAA,GACnBkB,EADmB,CAEtBI,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDurB,qBAAqB7sB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAMurB,qBADC,CAEhBrrB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMurB,qBAAqBrrB,UAD/B,CAELE,UAAWpD,EAAU4D,cAM/BV,EAAYgG,EAASlG,MAAMurB,qBAAqBrrB,UAEtD,IAAKA,EACD,MAAM,IAAIf,MAAM,sBAGpB,IAAMusB,EAAoBxrB,EAAUwrB,kBAoBpC,OAhBuB,IAAnB7rB,EAAOwO,QACPnO,EAAU+J,WAAa/J,EAAU+J,WAAWhC,IAAI,SAAC6jB,GAI7C,OAHIA,EAAa5hB,UAAUC,cAAgBuhB,EAAmBxhB,UAAUC,cACpE2hB,EAAarf,OAAS7O,EAAemuB,YAElCD,IAGX5rB,EAAU+J,WAAa/J,EAAU+J,WAAWhC,IAAI,SAAC6jB,GAI7C,OAHIA,EAAa5hB,UAAUC,cAAgBuhB,EAAmBxhB,UAAUC,cACpE2hB,EAAarf,OAAS7O,EAAeouB,WAElCF,IAIR5lB,EA0FQ+lB,CAAmBrsB,EAAOC,GACrC,KAAK5B,EAAW0tB,iCACZ,OAAOL,GAAiB1rB,GAC5B,KAAK3B,EAAWiuB,+CACZ,OAtEL,SAAgCtsB,EAAmBC,GACtD,IAAKD,EAAMI,MAAMurB,qBAAqBrrB,UAClC,MAAM,IAAIf,MAAM,sBAEpB,OAAOT,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDurB,qBAAqB7sB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAMurB,qBADC,CAGhBvqB,MAAO,KACPd,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHkB,EAAMI,MAAMurB,qBAAqBrrB,UAD/B,CAELwrB,kBAAmB7rB,EAAOqK,kBAwD3BiiB,CAAuBvsB,EAAOC,GACzC,KAAK5B,EAAWmuB,6BACZ,OAnDL,SAAgBxsB,EAAmBC,GACtC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDurB,qBAAsB,CAClBpqB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,UA2CRiC,CAAOvC,GAClB,KAAK3B,EAAWouB,mCACZ,OAvCZ,SAAqBzsB,EAAmBC,GACpC,IAAMK,EAAYN,EAAMI,MAAMurB,qBAAqBrrB,UACnD,OAAkB,OAAdA,EACON,EAEJlB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDurB,qBAAqB7sB,OAAAyB,EAAA,EAAAzB,CAAA,GACdkB,EAAMI,MAAMurB,qBADC,CAEhBrrB,UAAUxB,OAAAyB,EAAA,EAAAzB,CAAA,GACHwB,EADE,CAEL+J,WAAYpK,EAAOoK,mBA0BpBqiB,CAAY1sB,EAAOC,GAC9B,QACI,OAAO,OC1JJF,OAbf,SAAiBC,EAAmBC,GAChC,OAAQA,EAAOC,MACX,KAAK7B,EAAWsuB,2BACZ,OAtDZ,SAA2B3sB,EAAmBC,GAC1C,IAAMypB,EAAQ1pB,EAAM4sB,SAASlD,MAK7B,OAHAA,EAAMmD,KAAKtV,IAAItX,EAAOsY,KAAKhQ,SAAUtI,EAAOsY,MAGrCzZ,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4sB,SAAS9tB,OAAAyB,EAAA,EAAAzB,CAAA,GACFkB,EAAM4sB,SADL,CAEJlD,MAAM5qB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAM4sB,SAASlD,MADjB,CAEDmD,KAAM,IAAIxd,IAAIqa,EAAMmD,YA0CjBC,CAAkB9sB,EAAOC,GACpC,KAAK5B,EAAW0uB,mCACZ,OAtCZ,SAAmC/sB,EAAmBC,GAClD,IAAM+sB,EAAUhtB,EAAM4sB,SAAStL,KAAKuL,KAGpC,OAFAG,EAAQzV,IAAItX,EAAOwF,aAAazB,GAAI/D,EAAOwF,cAEpC3G,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4sB,SAAS9tB,OAAAyB,EAAA,EAAAzB,CAAA,GACFkB,EAAM4sB,SADL,CAEJtL,KAAKxiB,OAAAyB,EAAA,EAAAzB,CAAA,GACEkB,EAAM4sB,SAAStL,KADlB,CAEAuL,KAAM,IAAIxd,IAAI2d,SA4BXC,CAA0BjtB,EAAOC,GAC5C,KAAK5B,EAAW6uB,8BACZ,OAxBZ,SAA8BltB,EAAmBC,GAC7C,IAAMoK,EAAarK,EAAM4sB,SAASviB,WAGlC,OAFAA,EAAWwiB,KAAKtV,IAAItX,EAAOqK,UAAUC,YAAatK,EAAOqK,WAElDxL,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4sB,SAAS9tB,OAAAyB,EAAA,EAAAzB,CAAA,GACFkB,EAAM4sB,SADL,CAEJviB,WAAY,CACRwiB,KAAM,IAAIxd,IAAIhF,EAAWwiB,WAetBM,CAAqBntB,EAAOC,GACvC,QACI,OAAO,OCkBJF,OAff,SAAiBC,EAAmBC,GAChC,OAAQA,EAAOC,MACX,KAAK7B,EAAW+uB,qCACZ,OAlEL,SAAmBptB,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDitB,wBAAyB,CACrB9rB,aAAc1D,EAAsB2D,QACpCJ,MAAO,KACPd,UAAW,UA0DRmB,CAAUzB,GACrB,KAAK3B,EAAWivB,uCACZ,OAvCL,SAAqBttB,EAAmBC,GAC3C,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDitB,wBAAwBvuB,OAAAyB,EAAA,EAAAzB,CAAA,GACjBkB,EAAMI,MAAMitB,wBADI,CAEnB9rB,aAAc1D,EAAsB8D,QACpCP,MAAO,KACPd,UAAW,CACPmF,aAAcxF,EAAOwF,aACrB8nB,mBAAoBttB,EAAOstB,mBAC3BC,sBAAuBvtB,EAAOutB,sBAC9B/jB,SAAUxJ,EAAOwJ,gBA0BlBvH,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAWovB,qCACZ,OAxDL,SAAmBztB,EAAmBC,GACzC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDitB,wBAAwBvuB,OAAAyB,EAAA,EAAAzB,CAAA,GACjBkB,EAAMI,MAAMitB,wBADI,CAEnB9rB,aAAc1D,EAAsBoH,MACpC7D,MAAOnB,EAAOmB,MACdd,UAAW,WA+CR8B,CAAUpC,EAAOC,GAC5B,KAAK5B,EAAWqvB,iCACZ,OAvBL,SAAgB1tB,EAAmBC,GACtC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDitB,wBAAyB,CACrB9rB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,UAeRiC,CAAOvC,GAClB,QACI,OAAO,OCzDJ,SAASD,GAAQC,EAAmBC,GAC/C,OAAQA,EAAOC,MACX,KAAK7B,EAAWsvB,gCACZ,OAnBL,SAAgC3tB,EAAmBC,GACtD,IAAM2tB,EAAiB5tB,EAAM4sB,SAASviB,WAAWwiB,KAGjD,OAFAe,EAAerW,IAAItX,EAAOqK,UAAUC,YAAatK,EAAOqK,WAEjDxL,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEI4sB,SAAS9tB,OAAAyB,EAAA,EAAAzB,CAAA,GACFkB,EAAM4sB,SADL,CAEJviB,WAAWvL,OAAAyB,EAAA,EAAAzB,CAAA,GACJkB,EAAM4sB,SAASviB,WADZ,CAENwiB,KAAMe,QASHljB,CAAuB1K,EAAOC,GACzC,QACI,OAAO,MC+BJ,SAASF,GAAQC,EAAmBC,GAC/C,OAAQA,EAAOC,MACX,KAAK7B,EAAWwvB,2BACZ,OAvDZ,SAAqB7tB,EAAmBC,GACpC,IAAM6tB,EAAoB,IAAIze,IAK9B,OAJApP,EAAO8tB,cAAchU,QAAQ,SAACiU,GAC1BF,EAAkBvW,IAAIyW,EAAahqB,GAAIgqB,KAGpClvB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIiuB,GAAGnvB,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMiuB,GADX,CAEEF,cAAe,CACXlc,IAAK5R,EAAO8tB,cACZlB,KAAMiB,OA2CH5rB,CAAYlC,EAAOC,GAC9B,KAAK5B,EAAW6vB,qBACZ,OAvCZ,SAAgBluB,EAAmBC,GAC/B,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIiuB,GAAGnvB,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMiuB,GADX,CAEEF,cAAe,CACXlc,IAAK,GACLgb,KAAM,IAAIxd,SAgCP9M,CAAOvC,GAClB,KAAK3B,EAAW8vB,2BACZ,OA5BZ,SAAqBnuB,EAAmBC,GAAyC,IAAAmuB,EAGzEpuB,EADAiuB,GAAMF,cAAiBlc,EAFkDuc,EAElDvc,IAAKgb,EAF6CuB,EAE7CvB,KAE1BwB,EAAmBxc,EAAI9I,OAAO,SAACilB,GACjC,OAAQA,EAAahqB,KAAO/D,EAAOquB,iBAEjCR,EAAoB,IAAIze,IAAIwd,GAElC,OADAiB,EAAkBS,OAAOtuB,EAAOquB,gBACzBxvB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIiuB,GAAGnvB,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMiuB,GADX,CAEEF,cAAe,CACXlc,IAAKwc,EACLxB,KAAMiB,OAaHU,CAAYxuB,EAAOC,GAC9B,QACI,OAAO,MCpDJ,SAASF,GAAQC,EAAmBC,GAC/C,OAAQA,EAAOC,MACX,KAAK7B,EAAWowB,0BACZ,OAZZ,SAAqBzuB,EAAmBC,GACpC,OAAOnB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEIiuB,GAAGnvB,OAAAyB,EAAA,EAAAzB,CAAA,GACIkB,EAAMiuB,MAQF/rB,CAAYlC,GACvB,QACI,OAAO,MCoBJD,ICjCV2uB,GDiCU3uB,GApBR,SAAiBC,EAAmBC,GACvC,OAAO0uB,EAAc3uB,EAAOC,IACxB2uB,EAAe5uB,EAAOC,IjBsMf,SAAiBD,EAAmBC,GAC/C,IAAM4uB,EAAiB9jB,GAAa/K,EAAMI,MAAMyuB,eAAgB5uB,GAChE,OAAK4uB,EAGE/vB,OAAAyB,EAAA,EAAAzB,CAAA,GACAkB,EADP,CAEII,MAAMtB,OAAAyB,EAAA,EAAAzB,CAAA,GACCkB,EAAMI,MADR,CAEDyuB,qBANG,KiBxMPC,CAAkB9uB,EAAOC,IACzB8uB,GAAe/uB,EAAOC,IACtB+uB,GAAYhvB,EAAOC,IACnBgvB,GAAWjvB,EAAOC,IAClBivB,GAA2BlvB,EAAOC,IAClC6K,GAAY9K,EAAOC,IACnBkvB,GAAWnvB,EAAOC,IAClBmvB,GAAiBpvB,EAAOC,IACxBovB,GAAoBrvB,EAAOC,IAC3B2sB,GAAS5sB,EAAOC,IAChBqvB,GAAoBtvB,EAAOC,IAC3BsvB,GAAOvvB,EAAOC,IACd8tB,GAAc/tB,EAAOC,IACrBuvB,GAAaxvB,EAAOC,IACpBD,gFEvBayvB,eACjB,SAAAA,EAAYC,GAAsB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAywB,GAAA3wB,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2wB,GAAAtwB,KAAAH,KACxB0wB,iFAIN,OAAK1wB,KAAK0wB,MAAMzsB,QAMZ0sB,EAAA,qBAAKC,IAAK5wB,KAAK0wB,MAAMzsB,QAAS4sB,MAAO7wB,KAAK0wB,MAAMI,OAJ5CH,EAAA,gEASLI,EAAkBC,GAErB,IAAMC,EAAKF,EAASG,WAAWF,GAC/B,GAAIC,GAAM,OAAUA,GAAM,OAAUF,EAAS7jB,OAAS8jB,EAAW,EAAG,CAChE,IAAMG,EAAKJ,EAASG,WAAWF,EAAW,GAC1C,GAAIG,EAAK,OAAUA,GAAM,MACrB,OAAOJ,EAASK,UAAUJ,EAAU,GAG5C,OAAOD,EAASK,UAAUJ,EAAU,kDAIpC,IAAMK,EAAUrxB,KAAKsxB,OAAOtxB,KAAK0wB,MAAMa,iBAAkB,GAAGC,cAItDC,EAFOC,KAAI1xB,KAAK0wB,MAAMtX,gBAETuY,OAAO,EAAG,GAK7B,OACIhB,EAAA,qBAAKE,MAAO7wB,KAAK0wB,MAAMI,KAAMc,OAAQ5xB,KAAK0wB,MAAMI,KAAMe,MAAO,CAAEC,OAAQ,uCACnEnB,EAAA,sBAAMoB,EAAE,MAAMC,EAAE,MAAMC,GAAI,EAAGC,WAAW,SAASC,iBAAiB,SAASC,SAAUpyB,KAAK0wB,MAAMI,KAAO,GAAIuB,KAAM,IAAMZ,EAAOa,WAAW,cAAcjB,yCAM/J,OAAIrxB,KAAK0wB,MAAMzsB,QACJjE,KAAKuyB,gBAETvyB,KAAKwyB,wDAIZ,OAAOxyB,KAAKyyB,oBAtDiBC,mGCmCtBC,GAlCf,SAAAC,GACI,SAAAD,EAAYjC,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAA2yB,GAAA7yB,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA6yB,GAAAxyB,KAAAH,KACvB0wB,IAFd,OAAA5wB,OAAAe,EAAA,EAAAf,CAAA6yB,EAAAC,GAAA9yB,OAAAmR,EAAA,EAAAnR,CAAA6yB,EAAA,EAAAzhB,IAAA,eAAAxN,MAAA,SAKiB6V,GACT,OAAQA,EAAKsZ,cAAgB,YACzB,IAAK,WACD,IAAMC,EAAkBvZ,EAAKuZ,iBAAmB,YAC1CC,EAAexZ,EAAKwZ,aAC1B,OAAIA,EACO,mCAAqCA,EAAe,oBAAsBD,EAE1EE,KAEf,IAAK,aACL,IAAK,aACL,QACI,OAAOA,QAlBvB,CAAA9hB,IAAA,SAAAxN,MAAA,WAuBQ,IAAMuvB,EAAYjzB,KAAKkzB,aAAalzB,KAAK0wB,MAAMnX,MAC/C,OACIoX,EAAA,qBACIC,IAAKqC,EACLpB,MAAO,CAAEhB,MAAO7wB,KAAK0wB,MAAMI,YA3B3C6B,EAAA,CAA4BD,aFO5B,SAASS,GAAYC,GACjB,OAAQA,GACJ,KAAK1D,GAAK2D,QACN,OAAO3D,GAAK3mB,OAChB,KAAK2mB,GAAK3mB,OACN,OAAO2mB,GAAK2D,mBApBnB3D,qEAwBgB4D,eACjB,SAAAA,EAAY5C,GAAmB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAszB,IAC3B7zB,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAwzB,GAAAnzB,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTuyB,KAAM7D,GAAK2D,SAJY5zB,8EAS3BO,KAAKwzB,SAAS,CACVD,KAAMJ,GAAYnzB,KAAKgB,MAAMuyB,6CAKjC,OACI5C,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UADf,iDAOJ,GAAIlB,KAAK0wB,MAAMgD,WACX,OACI/C,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM9wB,KAAK0wB,MAAMmD,YAAc,8CAO1E,IAAMC,EACFnD,EAAA,yBACIA,EAAA,yBACK3wB,KAAK0wB,MAAMnX,KAAKtL,UAErB0iB,EAAA,yBACIA,EAAA,0BAAMA,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM,MAC1C,IACDH,EAAA,0BAAO3wB,KAAK0wB,MAAMnX,KAAKhQ,YAInC,OACIonB,EAAA,qBAAKgD,UAAU,eAQV3zB,KAAK+zB,eAENpD,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVxU,MAAOqU,GACPnD,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMnX,KAAKhQ,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,qDAatG,OACI0iB,EAAA,qBAAKgD,UAAU,qBACXhD,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAGhE4nB,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM9wB,KAAK0wB,MAAMmD,YAAc,MAElElD,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMnX,KAAKhQ,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,WAEtF0iB,EAAA,qBAAKgD,UAAU,kBACV3zB,KAAK0wB,MAAMnX,KAAKhQ,UAYrBonB,EAAA,qBAAKgD,UAAU,eACV3zB,KAAK0wB,MAAMnX,KAAKkG,OAASkR,EAAA,oDAE9BA,EAAA,qBAAKgD,UAAU,sBACV3zB,KAAK0wB,MAAMnX,KAAK9S,cAAgBkqB,EAAA,2DAErCA,EAAA,qBAAKgD,UAAU,kBACV,CAAC3zB,KAAK0wB,MAAMnX,KAAKgb,KAAMv0B,KAAK0wB,MAAMnX,KAAKvY,MAAOhB,KAAK0wB,MAAMnX,KAAKib,SAASzqB,OAAO,SAAAgoB,GAAC,OAAIA,IAAG5e,KAAK,OAASwd,EAAA,sGASrH,OAAO3wB,KAAKy0B,uBAxHe/B,aGZtBgC,GAAb,WAMI,SAAAA,EAAAl1B,GAAiD,IAAnCwR,EAAmCxR,EAAnCwR,IAAKhD,EAA8BxO,EAA9BwO,MAA8BlO,OAAAC,EAAA,EAAAD,CAAAE,KAAA00B,GAAA10B,KALjDgR,SAKiD,EAAAhR,KAJjDgO,WAIiD,EAC7ChO,KAAKgR,IAAMA,EACXhR,KAAKgO,MAAQA,GAAS,KAR9B,OAAAlO,OAAAmR,EAAA,EAAAnR,CAAA40B,EAAA,EAAAxjB,IAAA,cAAAxN,MAAA,SAWgB2P,EAAgBshB,GACxB,MAAO,CACHC,QAAS,MACTvhB,OAA+BrT,KAAK60B,YAAal3B,OAAS,IAAM0V,EAChErO,GAAI6Q,OAAOmN,KAAK8R,UAAUzV,MAAM,GAChC/J,OAAQ,CAACqf,MAhBrB,CAAAzjB,IAAA,mBAAAxN,MAAA,SAoBqB2P,GACb,MAAO,CACHuhB,QAAS,MACTvhB,OAA+BrT,KAAK60B,YAAal3B,OAAS,IAAM0V,EAChErO,GAAI6Q,OAAOmN,KAAK8R,UAAUzV,MAAM,GAChC/J,OAAQ,QAzBpBof,EAAA,GAAaA,GAIF/2B,cA4BJ,IAAMo3B,GAAb,SAAAC,GAGI,SAAAD,EAAYzf,GAA6B,IAAA7V,EAErC,GAFqCK,OAAAC,EAAA,EAAAD,CAAAE,KAAA+0B,IACrCt1B,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAi1B,GAAA50B,KAAAH,KAAMsV,KAHVtH,WAEyC,GAEhCsH,EAAOtH,MACR,MAAM,IAAIzN,MAAM,oCAHiB,OAKrCd,EAAKuO,MAAQsH,EAAOtH,MALiBvO,EAH7C,OAAAK,OAAAe,EAAA,EAAAf,CAAAi1B,EAAAC,GAAAl1B,OAAAmR,EAAA,EAAAnR,CAAAi1B,EAAA,EAAA7jB,IAAA,WAAAxN,MAAA,SAWauxB,EAAcN,GACnB,OAAOxjB,MAAMnR,KAAKgR,IAAK,CACnBqC,OAAQ,OACR9B,KAAM,OACN+I,MAAO,WACPlJ,QAAS,CACLC,cAAerR,KAAKgO,MACpBoF,eAAgB,mBAChB9B,OAAQ,oBAEZ2B,KAAMK,KAAKC,UAAUvT,KAAKk1B,YAAYD,EAAMN,MAE3CnjB,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,kBAAoBkR,EAAS5D,OAAS,KAAO4D,EAAS+B,YAE1E,OAAgB/B,EAASC,aA3BzCqjB,EAAA,CAA6CL,ICehCS,GAAb,SAAAC,GAII,SAAAD,EAAY7f,GAAkC,OAAAxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAm1B,GAAAr1B,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAq1B,GAAAh1B,KAAAH,KACpCsV,IALd,OAAAxV,OAAAe,EAAA,EAAAf,CAAAq1B,EAAAC,GAAAt1B,OAAAmR,EAAA,EAAAnR,CAAAq1B,EAAA,EAAAjkB,IAAA,aAAAxN,MAAA,WA2BQ,OAAOyN,MAAMnR,KAAKgR,IAAK,CACnBqC,OAAQ,OACR9B,KAAM,OACN+I,MAAO,WACPlJ,QAAS,CACLC,cAAerR,KAAKgO,MACpBoF,eAAgB,mBAChB9B,OAAQ,oBAEZ2B,KAAMK,KAAKC,UAAUvT,KAAKq1B,iBAAiB,cAE1C7jB,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAM,+BAAiCkR,EAAS5D,OAAS,KAAO4D,EAAS+B,YAEvF,OAAO/B,EAASC,WA1ChC,CAAAR,IAAA,iBAAAxN,MAAA,eAAA4xB,EAAAx1B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EA8CyB3I,GA9CzB,OAAAwI,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,WA+CY6iB,EAAkBI,aAAa7a,IAAInR,GA/C/C,CAAA6I,EAAAE,KAAA,eAAAF,EAAAG,OAAA,SAgDmBK,QAAQ4iB,QAAQL,EAAkBI,aAAa9hB,IAAIlK,KAhDtE,cAAA6I,EAAAG,OAAA,SAmDevS,KAAKy1B,SAAS,mBAAoB,CAAClsB,IACrCiI,KAAK,SAACG,GACH,OAAOA,EAAOA,OAAO,GAAG,MArDxC,wBAAAS,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAqhB,EAAA7iB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,oBAAAxN,MAAA,eAAAgyB,EAAA51B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,EAyD4BqD,GAzD5B,OAAAlF,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cA2DQ6iB,EAAkBI,aAAahG,OAAOtY,EAAOsC,KAAKhQ,UA3D1DuK,EAAAvB,OAAA,SA4DevS,KAAKy1B,SAAS,sBAAuB,CAAEE,QAAS1e,IAClDzF,KAAK,eA7DlB,wBAAAsC,EAAAtB,SAAAoB,EAAA5T,SAAA,gBAAAkU,GAAA,OAAAwhB,EAAAjjB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,kBAAAxN,MAAA,eAAAkyB,EAAA91B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EAuE0ByhB,GAvE1B,OAAA9jB,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA9B,OAAA,SAwEevS,KAAKy1B,SAAS,mBAAoBI,GACpCrkB,KAAK,SAACG,GACH,OAAOA,EAAOA,OAAO,MA1ErC,wBAAA0C,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAsU,GAAA,OAAAshB,EAAAnjB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,cAAAxN,MAAA,eAAAoyB,EAAAh2B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAgD,IAAA,OAAAlD,GAAAC,EAAAG,KAAA,SAAAgD,GAAA,cAAAA,EAAA9C,KAAA8C,EAAA7C,MAAA,cAAA6C,EAAA5C,OAAA,SA+EevS,KAAKy1B,SAAS,eAAgB,CAAE1rB,OAAQ,KAC1CyH,KAAK,SAACG,GACH,OAAOA,EAAOA,OAAO,MAjFrC,wBAAAwD,EAAA3C,SAAAyC,EAAAjV,SAAA,yBAAA81B,EAAArjB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,cAAAxN,MAAA,eAAAqyB,EAAAj2B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAiE,EAqFsBX,GArFtB,OAAAxD,GAAAC,EAAAG,KAAA,SAAAkE,GAAA,cAAAA,EAAAhE,KAAAgE,EAAA/D,MAAA,cAAA+D,EAAA9D,OAAA,SAsFevS,KAAKy1B,SAAS,eAAgB,CAAE1rB,OAAQwL,IAC1C/D,KAAK,SAACG,GACH,OAAOA,EAAOA,OAAO,MAxFrC,wBAAA0E,EAAA7D,SAAA0D,EAAAlW,SAAA,gBAAAoV,GAAA,OAAA2gB,EAAAtjB,MAAAzS,KAAA0S,YAAA,MAAAyiB,EAAA,CAAuCJ,IC/CvC,SAASiB,GAAcL,GACnB,IAAIM,EACJ,OAAKN,EAAQA,QAAQO,UAejBD,EADsC,UAAtCN,EAAQA,QAAQO,SAASD,SACdN,EAAQA,QAAQO,SAASC,cAEzBR,EAAQA,QAAQO,SAASD,SAGjC,CACH1sB,SAAUosB,EAAQpc,KAAKhQ,SACvB0E,SAAU0nB,EAAQpc,KAAKtL,SACvBsmB,KAAMoB,EAAQA,QAAQO,SAAS3B,KAC/BvzB,MAAO20B,EAAQA,QAAQO,SAASl1B,MAChCwzB,QAASmB,EAAQA,QAAQO,SAAS1B,QAClC/U,MAAOwW,EACPxvB,aAAckvB,EAAQA,QAAQO,SAASzvB,aACvCosB,aAAc8C,EAAQA,QAAQO,SAASrD,aACvCE,aAAc4C,EAAQA,QAAQS,OAAOrD,aACrCD,gBAAiB6C,EAAQA,QAAQO,SAASpD,kBA7BnC,CACHvpB,SAAUosB,EAAQpc,KAAKhQ,SACvB0E,SAAU0nB,EAAQpc,KAAKtL,SACvBsmB,KAAM,KACNvzB,MAAO,KACPwzB,QAAS,KACT/U,MAAO,KACPhZ,aAAc,KACdosB,aAAc,KACdE,aAAc,KACdD,gBAAiB,MDkChBqC,GACFx3B,OAAiB,cADfw3B,GAEFI,aAAyC,IAAIllB,ICKjD,IAAMgmB,GAAb,WAOI,SAAAA,EAAY/gB,GAA0BxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAq2B,GAAAr2B,KALtCsV,YAKqC,EAAAtV,KAJrCs2B,uBAIqC,EAAAt2B,KAFrCsa,WAEqC,EACjCta,KAAKsV,OAASA,EACdtV,KAAKs2B,kBAAoB,IAAInB,GAAkB,CAC3CnkB,IAAKhR,KAAKsV,OAAOihB,sBACjBvoB,MAAOhO,KAAKsV,OAAOtH,QAEvBhO,KAAKsa,MAAQ,IAAIjK,IAbzB,OAAAvQ,OAAAmR,EAAA,EAAAnR,CAAAu2B,EAAA,EAAAnlB,IAAA,UAAAxN,MAAA,eAAA8yB,EAAA12B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EAgBkB3I,GAhBlB,IAAAktB,EAAAld,EAAA,OAAAxH,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,WAiBYtS,KAAKsa,MAAMI,IAAInR,GAjB3B,CAAA6I,EAAAE,KAAA,eAAAF,EAAAG,OAAA,SAkBmBvS,KAAKsa,MAAM7G,IAAIlK,IAlBlC,cAAA6I,EAAAE,KAAA,EAqBkCtS,KAAKs2B,kBAAkBI,eAAentB,GArBxE,cAqBcktB,EArBdrkB,EAAA2B,KAsBcwF,EAAOyc,GAAcS,GAC3Bz2B,KAAKsa,MAAM/B,IAAIhP,EAAUgQ,GAvBjCnH,EAAAG,OAAA,SAwBegH,GAxBf,wBAAAnH,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAuiB,EAAA/jB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,WAAAxN,MAAA,eAAAizB,EAAA72B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,EA2BmBiiB,GA3BnB,IAAAlkB,EAAAilB,EAAAC,EAAAp3B,EAAAO,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cA4BcX,EAA8B,IAAItB,IAElCumB,EAA2B,GAEjCf,EAAU9a,QAAQ,SAACxR,GACX9J,EAAK6a,MAAMI,IAAInR,GACfoI,EAAO4G,IAAIhP,EAAU9J,EAAK6a,MAAM7G,IAAIlK,IAEpCqtB,EAAQE,KAAKvtB,KApC7BuK,EAAAxB,KAAA,EAwCmCtS,KAAKs2B,kBAAkBS,gBAAgBH,GAxC1E,cAwCcC,EAxCd/iB,EAAAC,KAyCsB8iB,EAAaxtB,IAAI,SAACssB,GAC5B,OAAOK,GAAcL,KAGzBkB,EAAa9b,QAAQ,SAAC0b,GAClB,IAAMld,EAAOyc,GAAcS,GAC3Bh3B,EAAK6a,MAAM/B,IAAIgB,EAAKhQ,SAAUgQ,GAC9B5H,EAAO4G,IAAIgB,EAAKhQ,SAAUgQ,KAhDtCzF,EAAAvB,OAAA,SAmDeZ,GAnDf,wBAAAmC,EAAAtB,SAAAoB,EAAA5T,SAAA,gBAAAkU,GAAA,OAAAyiB,EAAAlkB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,cAAAxN,MAAA,eAAAqyB,EAAAj2B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EAsDsBmB,GAtDtB,IAAAmV,EAAA,OAAA3Y,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA/B,KAAA,EAuD4BtS,KAAKs2B,kBAAkBU,YAAYzhB,EAAMA,OAvDrE,cAuDcmV,EAvDdrW,EAAAN,KAAAM,EAAA9B,OAAA,SAwDemY,EACF3gB,OAAO,SAAAvK,GAAkB,IAAf+J,EAAe/J,EAAf+J,SACP,OAAmD,IAA3CgM,EAAM0hB,cAAct2B,QAAQ4I,KAEvCF,IAAI,SAAAqN,GACD,MAAO,CACHnN,SAFyBmN,EAAzBnN,SAEU0E,SAFeyI,EAAfzI,aA5D9B,wBAAAoG,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAsU,GAAA,OAAAyhB,EAAAtjB,MAAAzS,KAAA0S,YAAA,MAAA2jB,EAAA,GCwBaa,GAAb,SAAAC,GAGI,SAAAD,EAAY5hB,GAA6B,IAAAxE,EAErC,GAFqChR,OAAAC,EAAA,EAAAD,CAAAE,KAAAk3B,IACrCpmB,EAAAhR,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAo3B,GAAA/2B,KAAAH,KAAMsV,KAHVtH,WAEyC,GAEhCsH,EAAOtH,MACR,MAAM,IAAIzN,MAAM,oCAHiB,OAKrCuQ,EAAK9C,MAAQsH,EAAOtH,MALiB8C,EAH7C,OAAAhR,OAAAe,EAAA,EAAAf,CAAAo3B,EAAAC,GAAAr3B,OAAAmR,EAAA,EAAAnR,CAAAo3B,EAAA,EAAAhmB,IAAA,WAAAxN,MAAA,eAAA0zB,EAAAt3B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EAWmB6gB,EAAcN,GAXjC,IAAAljB,EAAA,OAAAM,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA/B,KAAA,EAY+BnB,MAAMnR,KAAKgR,IAAK,CACnCqC,OAAQ,OACR9B,KAAM,OACN+I,MAAO,WACPlJ,QAAS,CACLC,cAAerR,KAAKgO,MACpBoF,eAAgB,mBAChB9B,OAAQ,oBAEZ2B,KAAMK,KAAKC,UAAUvT,KAAKk1B,YAAYD,EAAMN,MArBxD,cAYcljB,EAZd4C,EAAAN,KAAAM,EAAA9B,OAAA,SAuBevS,KAAKq3B,gBAAgB5lB,IAvBpC,wBAAA4C,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAoV,EAAAmB,GAAA,OAAA6gB,EAAA3kB,MAAAzS,KAAA0S,YAAA,MAAAwkB,EAAA,CA3EA,WAKI,SAAAI,EAAA93B,GAAyD,IAA3CwR,EAA2CxR,EAA3CwR,IAAKhD,EAAsCxO,EAAtCwO,MAAOrQ,EAA+B6B,EAA/B7B,OAA+BmC,OAAAC,EAAA,EAAAD,CAAAE,KAAAs3B,GAAAt3B,KAJzDgR,SAIyD,EAAAhR,KAHzDgO,WAGyD,EAAAhO,KAFzDrC,YAEyD,EACrDqC,KAAKgR,IAAMA,EACXhR,KAAKgO,MAAQA,GAAS,KACtBhO,KAAKrC,OAASA,EARtB,OAAAmC,OAAAmR,EAAA,EAAAnR,CAAAw3B,EAAA,EAAApmB,IAAA,cAAAxN,MAAA,SAWgB2P,EAAgBshB,GACxB,MAAO,CACHC,QAAS,MACTvhB,OAAQrT,KAAKrC,OAAS,IAAM0V,EAC5BrO,GAAI6Q,OAAOmN,KAAK8R,UAAUzV,MAAM,GAChC/J,OAAQqf,KAhBpB,CAAAzjB,IAAA,mBAAAxN,MAAA,SAoBqB2P,GACb,MAAO,CACHuhB,QAAS,MACTvhB,OAAQrT,KAAKrC,OAAS,IAAM0V,EAC5BrO,GAAI6Q,OAAOmN,KAAK8R,UAAUzV,MAAM,GAChC/J,OAAQ,MAzBpB,CAAApE,IAAA,kBAAAxN,MAAA,eAAA6zB,EAAAz3B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EA6B0BT,GA7B1B,IAAAiF,EAAA/E,EAAA6lB,EAAA7gB,EAAA8gB,EAAA/jB,EAAA,OAAA3B,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UA8BgC,MAApBb,EAAS5D,OA9BrB,CAAAuE,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,EA+B4Cb,EAASC,OA/BrD,UAAAgF,EAAAtE,EAAA2B,KA+BoBpC,EA/BpB+E,EA+BoB/E,OAAQvP,EA/B5BsU,EA+B4BtU,OACZuP,EAhChB,CAAAS,EAAAE,KAAA,gBAAAF,EAAAG,OAAA,SAiCuB,CAACZ,EAAQ,OAjChC,eAAAS,EAAAG,OAAA,SAmCuB,CAAC,KAAMnQ,IAnC9B,QAAAgQ,EAAAE,KAAA,oBAsCuC,MAApBb,EAAS5D,OAtC5B,CAAAuE,EAAAE,KAAA,gBAAAF,EAAAG,OAAA,SAuCmB,CAAC,KAAM,OAvC1B,WAyCgC,MAApBd,EAAS5D,OAzCrB,CAAAuE,EAAAE,KAAA,YA0CyD,qBAAzCb,EAASL,QAAQqC,IAAI,gBA1CrC,CAAArB,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GA2CwCb,EAASC,OA3CjD,eAAAiF,EAAAvE,EAAA2B,KA2CwB3R,EA3CxBuU,EA2CwBvU,MA3CxBgQ,EAAAG,OAAA,SA4CuB,CAAC,KAAMnQ,IA5C9B,eAAAgQ,EAAAE,KAAA,GA8CmCb,EAASiC,OA9C5C,eA8CsBA,EA9CtBtB,EAAA2B,KAAA3B,EAAAG,OAAA,SA+CuB,CAAC,KAAM,CACV7S,KAAM,EACNY,KAAM,mCACNX,QAAS,4CACTyC,MAAOsR,KAnD3B,cAuDc,IAAInT,MAAM,wBAA0BkR,EAAS5D,OAAS,KAAO4D,EAAS+B,YAvDpF,yBAAApB,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAsjB,EAAA9kB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,WAAAxN,MAAA,eAAAg0B,EAAA53B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,EA0DmBqhB,EAAcN,GA1DjC,IAAAl1B,EAAAO,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cAAAwB,EAAAvB,OAAA,SA2DepB,MAAMnR,KAAKgR,IAAK,CACnBqC,OAAQ,OACR9B,KAAM,OACN+I,MAAO,WACPlJ,QAAS,CACLgC,eAAgB,mBAChB9B,OAAQ,oBAEZ2B,KAAMK,KAAKC,UAAUvT,KAAKk1B,YAAYD,EAAMN,MAE3CnjB,KAAK,SAACC,GACH,OAAOhS,EAAK43B,gBAAgB5lB,MAtE5C,wBAAAqC,EAAAtB,SAAAoB,EAAA5T,SAAA,gBAAAkU,EAAAI,GAAA,OAAAojB,EAAAjlB,MAAAzS,KAAA0S,YAAA,MAAA4kB,EAAA,wBCSaK,GAAb,SAAAvC,GAII,SAAAuC,EAAYriB,GAAoC,OAAAxV,OAAAC,EAAA,EAAAD,CAAAE,KAAA23B,GAAA73B,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA63B,GAAAx3B,KAAAH,KACtCsV,IALd,OAAAxV,OAAAe,EAAA,EAAAf,CAAA63B,EAAAvC,GAAAt1B,OAAAmR,EAAA,EAAAnR,CAAA63B,EAAA,EAAAzmB,IAAA,mBAAAxN,MAAA,SASqB4R,GACb,OAAOtV,KAAKy1B,SAAS,qBAAsBngB,GACtC9D,KAAK,SAACG,GACH,GAAIA,EAAOA,QACPA,EAAOA,OAAOzE,OAAS,EAAG,CAC1B,IAAM0qB,EAAYjmB,EAAOA,OAAO,GAChC,IAAKimB,EACD,MAAM,IAAIr3B,MAAM,gCAEpB,OAAOq3B,EAEP,MAAM,IAAIr3B,MAAM,sCApBpCo3B,EAAA,CAAyC5C,IAA5B4C,GAEFh6B,OAAiB,gBCTrB,IA2MHk6B,GAAc,IA3MlB,WASI,SAAAC,EAAAt4B,GAAgG,IAAlFu4B,EAAkFv4B,EAAlFu4B,aAAcC,EAAoEx4B,EAApEw4B,oBAAqBC,EAA+Cz4B,EAA/Cy4B,cAAeC,EAAgC14B,EAAhC04B,gBAAgCp4B,OAAAC,EAAA,EAAAD,CAAAE,KAAA83B,GAAA93B,KAPhGsa,WAOgG,EAAAta,KANhGm4B,mBAMgG,EAAAn4B,KALhGg4B,yBAKgG,EAAAh4B,KAJhGi4B,mBAIgG,EAAAj4B,KAHhGk4B,qBAGgG,EAAAl4B,KAFhGo4B,kBAEgG,EAC5Fp4B,KAAKsa,MAAQ,IAAIjK,IAGjBrQ,KAAKm4B,cAAgBJ,GAAgB,KAIrC/3B,KAAKg4B,oBAAsBA,GAAuB,IAMlDh4B,KAAKi4B,cAAgBA,GAAiB,IACtCj4B,KAAKk4B,gBAAkBA,GAAmB,IAE1Cl4B,KAAKo4B,cAAe,EA1B5B,OAAAt4B,OAAAmR,EAAA,EAAAnR,CAAAg4B,EAAA,EAAA5mB,IAAA,aAAAxN,MAAA,WA6BiB,IAAAjE,EAAAO,KACLA,KAAKo4B,eAGTp4B,KAAKo4B,cAAe,EACpBC,OAAOC,WAAW,WACd,IAAMC,EAAW,IAAIloB,IACjBmoB,GAAe,EACnB14B,OAAO24B,KAAKh5B,EAAK6a,OAAOS,QAAQ,SAAC/V,GAC7B,IAAM0zB,EAAOj5B,EAAK6a,MAAM7G,IAAIzO,GACvBvF,EAAKk5B,UAAUD,KAChBH,EAAShgB,IAAIvT,EAAI0zB,GACjBF,GAAe,KAGvB/4B,EAAK6a,MAAQie,EACb94B,EAAK24B,cAAe,EAChBI,GACA/4B,EAAKm5B,cAEV54B,KAAKg4B,wBAjDhB,CAAA9mB,IAAA,YAAAxN,MAAA,SAoDcm1B,GAGN,OAFY,IAAI91B,MAAO+S,UACD+iB,EAAUpf,UACdzZ,KAAKm4B,gBAvD/B,CAAAjnB,IAAA,aAAAxN,MAAA,SA0Dem1B,GACP,OAAOA,EAAUC,WA3DzB,CAAA5nB,IAAA,UAAAxN,MAAA,SA8DYsB,GACJ,QAA2BmkB,IAAvBnpB,KAAKsa,MAAM7G,IAAIzO,GACf,OAAO,KAEX,IAAM+zB,EAAS/4B,KAAKsa,MAAM7G,IAAIzO,GAC9B,IAAIhF,KAAK24B,UAAUI,GAInB,OAAOA,EAHH/4B,KAAKsa,MAAMiV,OAAOvqB,KApE9B,CAAAkM,IAAA,gBAAAxN,MAAA,SA0EkBg1B,GAA4C,IAAA5nB,EAAA9Q,KACtD,OAAO,IAAIg5B,KAAuB,SAACxD,EAAS1P,GACxC,IAAMmT,GAAU,IAAIl2B,MAAO+S,WAGZ,SAATojB,IAIFb,OAAOC,WAAW,WACd,GAAIxnB,EAAKwJ,MAAMI,IAAIge,EAAK1zB,IAQpB,OAAO8L,EAAKqoB,gBAAgB,CACxBn0B,GAAI0zB,EAAK1zB,GACTo0B,QAASV,EAAKU,UAEb5nB,KAAK,WAIFgkB,EAAQ1kB,EAAKwJ,MAAM7G,IAAIilB,EAAK1zB,OAE/Bq0B,MAAM,SAACC,GACJxT,EAAOwT,KAGnB,GAAKZ,EAAKI,SAEH,CACH,IAAMS,GAAU,IAAIx2B,MAAO+S,UAAYmjB,EACnCM,EAAUzoB,EAAKmnB,eACfnnB,EAAKwJ,MAAMiV,OAAOmJ,EAAK1zB,IACvB8gB,EAAO,IAAIvlB,MACP,iEACEuQ,EAAKmnB,cAAgB,YAAcsB,KAEzCL,SATJ1D,EAAQkD,IAYb5nB,EAAKonB,iBAEZgB,OAzHZ,CAAAhoB,IAAA,kBAAAxN,MAAA,SAAAgT,GA6HiF,IAAA/D,EAAA3S,KAA3DgF,EAA2D0R,EAA3D1R,GAAIo0B,EAAuD1iB,EAAvD0iB,QAElBp5B,KAAKw5B,YAAYx0B,EAAIo0B,GAGrB,IAAMK,EAAeL,IAChB5nB,KAAK,SAACG,GAEH,OADAgB,EAAK+mB,QAAQ10B,EAAI2M,EAAQynB,GAClBznB,IAEVgoB,QAAQ,WAIDF,EAAaG,eACbjnB,EAAK2H,MAAM7G,IAAIzO,KAG3B,OAAOy0B,IA/If,CAAAvoB,IAAA,kBAAAxN,MAAA,SAAAiT,GAkJiF,IAA3D3R,EAA2D2R,EAA3D3R,GAAIo0B,EAAuDziB,EAAvDyiB,QACZL,EAAS/4B,KAAKsa,MAAM7G,IAAIzO,GAC9B,GAAI+zB,EAAQ,CACR,IAAI/4B,KAAK24B,UAAUI,GAEZ,OAAI/4B,KAAK65B,WAAWd,GAChB/4B,KAAK85B,cAAcf,GACrBvnB,KAAK,SAACunB,GACH,OAAOA,EAAOr1B,QAGfs1B,KAASxD,QAAQuD,EAAOr1B,OAP/B1D,KAAKsa,MAAMiV,OAAOvqB,GAW1B,OAAOhF,KAAKm5B,gBAAgB,CAAEn0B,KAAIo0B,cAjK1C,CAAAloB,IAAA,cAAAxN,MAAA,SAoKgBsB,EAAYo0B,GACpBp5B,KAAKsa,MAAM/B,IAAIvT,EAAI,CACfA,GAAIA,EACJyU,WAAW,IAAI1W,MAAO+S,UACtBgjB,UAAU,EACVp1B,MAAO,KACP01B,QAASA,MA1KrB,CAAAloB,IAAA,UAAAxN,MAAA,SA8KYsB,EAAYtB,EAAU01B,GAC1B,GAAIp5B,KAAKsa,MAAMI,IAAI1V,GAAK,CACpB,IAAM0zB,EAAO14B,KAAKsa,MAAM7G,IAAIzO,GACxB0zB,GAAQA,EAAKI,UACbJ,EAAKI,UAAW,EAChBJ,EAAKh1B,MAAQA,EACbg1B,EAAKU,QAAUA,GAGfp5B,KAAKsa,MAAM/B,IAAIvT,EAAI,CACfA,GAAIA,EACJyU,WAAW,IAAI1W,MAAO+S,UACtBsjB,QAASA,EACTN,UAAU,EACVp1B,MAAOA,SAIf1D,KAAKsa,MAAM/B,IAAIvT,EAAI,CACfA,GAAIA,EACJyU,WAAW,IAAI1W,MAAO+S,UACtBsjB,QAASA,EACTN,UAAU,EACVp1B,MAAOA,IAGf1D,KAAK44B,iBAxMbd,EAAA,GA2MkB,CAAe,CAC7BC,aAAc,KACdC,oBAAqB,IACrBC,cAAe,IACfC,gBAAiB,MAuBR6B,GAAb,WASI,SAAAA,EAAAnjB,GAAsF,IAAxE5I,EAAwE4I,EAAxE5I,MAAOgD,EAAiE4F,EAAjE5F,IAAK4jB,EAA4Dhe,EAA5Dge,QAASoF,EAAmDpjB,EAAnDojB,QAASC,EAA0CrjB,EAA1CqjB,WAMxC,GANkFn6B,OAAAC,EAAA,EAAAD,CAAAE,KAAA+5B,GAAA/5B,KARtFgO,WAQsF,EAAAhO,KAPtFg6B,aAOsF,EAAAh6B,KANtFi6B,gBAMsF,EAAAj6B,KALtFgR,SAKsF,EAAAhR,KAJtF40B,aAIsF,EAElF50B,KAAKgO,MAAQA,EACbhO,KAAKg6B,QAAUA,GAAW,IAC1Bh6B,KAAKi6B,WAAaA,GAAc,MAE3BjpB,EACD,MAAM,IAAIzQ,MAAM,8CAEpBP,KAAKgR,IAAMA,EAEXhR,KAAK40B,QAAUA,GAAW,KACV,SAAZA,IACA50B,KAAK40B,QAAU,MAtB3B,OAAA90B,OAAAmR,EAAA,EAAAnR,CAAAi6B,EAAA,EAAA7oB,IAAA,UAAAxN,MAAA,WA2BQ,MAAO,CACHs2B,QAASh6B,KAAKg6B,QACdjsB,cAAe/N,KAAKgO,MACpBisB,WAAYj6B,KAAKi6B,cA9B7B,CAAA/oB,IAAA,YAAAxN,MAAA,WAmCQ,OAAqC1D,KAAK60B,YAAal3B,SAnC/D,CAAAuT,IAAA,WAAAxN,MAAA,WAuCQ,IAAIw2B,EAMJ,OAFIA,EAHCl6B,KAAK40B,QAGK50B,KAAKm6B,YAAc,IAAMn6B,KAAK40B,QAF9B50B,KAAKm6B,YAAc,QAI3BD,IA7Cf,CAAAhpB,IAAA,YAAAxN,MAAA,SAgDc01B,GACN,OAAOvB,GAAYuC,gBAAgB,CAC/Bp1B,GAAIhF,KAAKk6B,WACTd,QAASA,MAnDrB,CAAAloB,IAAA,eAAAxN,MAAA,WA2DmB,IAAAqhB,EAAA/kB,KACX,OAAOA,KAAKq6B,UAAU,WAGDtV,EAAKoV,YACTpV,EAAK6P,QAHlB,IAOM0F,EAAS,IAAI3C,GAAoB,CACnC3mB,IAAK+T,EAAK/T,IACVhD,MAAO+W,EAAK/W,QAGhB,OAAOgrB,KAASxD,QACZ8E,EAAOC,iBAAiB,CACpBC,YAAazV,EAAKoV,YAClBvF,QAAS7P,EAAK6P,eA5ElC,CAAA1jB,IAAA,WAAAxN,MAAA,SAkFa+2B,EAAkBnlB,GAAa,IAAAolB,EAAA16B,KACpC,OAAOA,KAAK26B,eACPnpB,KAAK,SAACopB,GACH,IAAMN,EAAS,IAAIpD,GAAwB,CACvCv5B,OAAQi9B,EAAcJ,YACtBxpB,IAAK4pB,EAAc5pB,IACnBhD,MAAO0sB,EAAK1sB,QAEhB,OAAOgrB,KAASxD,QACZ8E,EAAO7E,SAASgF,EAAUnlB,MAGjC+jB,MAAM,SAACC,GAEJ,MADA53B,QAAQU,MAAM,UAAYk3B,EAAIh5B,KAAO,MAAQg5B,EAAI35B,QAAS25B,GACpDA,QAhGtBS,EAAA,GAAaA,GAOFp8B,cC9MJ,IChDKqB,GAWA67B,GA4DAC,GDvBCC,GAAb,SAAAC,GAII,SAAAD,EAAYzlB,GAAuC,OAAAxV,OAAAC,EAAA,EAAAD,CAAAE,KAAA+6B,GAAAj7B,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAi7B,GAAA56B,KAAAH,KACzCsV,IALd,OAAAxV,OAAAe,EAAA,EAAAf,CAAAi7B,EAAAC,GAAAl7B,OAAAmR,EAAA,EAAAnR,CAAAi7B,EAAA,EAAA7pB,IAAA,iBAAAxN,MAAA,eAAAu3B,EAAAn7B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EASyBhR,GATzB,IAAA1B,EAAAkX,EAAA/E,EAAA,OAAAI,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EAWsCtS,KAAKy1B,SAAS,kBAAmB,CAAC,CAC5Dv0B,KAAMA,KAZlB,UAAA1B,EAAA4S,EAAA2B,KAAA2C,EAAA5W,OAAAwY,GAAA,EAAAxY,CAAAN,EAAA,GAWemS,EAXf+E,EAAA,GAAAA,EAAA,IAiBY/E,IAAUA,EAAO,GAjB7B,CAAAS,EAAAE,KAAA,gBAAAF,EAAAG,OAAA,SAkBmBZ,EAAO,IAlB1B,cA4BkB,IAAIpR,MAAM,sBA5B5B,yBAAA6R,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAgnB,EAAAxoB,MAAAzS,KAAA0S,YAAA,MAAAqoB,EAAA,CAA4ChB,IEM5C,SAASmB,GAAcC,GACnB,IACMC,EADQ,6EACUC,KAAKF,GAC7B,IAAKC,EACD,MAAM,IAAIE,UAAU,2BAA6BH,GAGrD,IAAMI,EAASH,EAAU,GAAKA,EAAU,GAAK,IAAMA,EAAU,IACvDI,EAAgBJ,EAAU,GAAK,IAAMA,EAAU,GAAK,IAAMA,EAAU,GAAK,IAAMA,EAAU,GAAK,IAAMA,EAAU,GAAK,IAAMA,EAAU,GAAKG,EAC9I,OAAO,IAAIx4B,KAAKy4B,GAGb,SAASC,GAAsBC,GAClC,MAAO,CACH12B,GAAI02B,EAAO,GACXp7B,KAAMo7B,EAAO,GACb3b,MAAO2b,EAAO,GACd7hB,WAAYqhB,GAAcQ,EAAO,IACjCC,YAAaD,EAAO,GACpBE,eAAgBF,EAAO,GACvBG,qBAAoC,MAAdH,EAAO,GAC7BI,WAAYJ,EAAO,GACnBK,SAAUL,EAAO,IAIlB,SAASM,GAAmBC,GAC/B,IAAM/6B,EAAO+6B,EAAK,GAAGr7B,MAAM,QAE3B,MAAO,CACHoE,GAAIi3B,EAAK,GACT37B,KAAM27B,EAAK,GAEX/6B,KAAM,CACF8D,GAAIi3B,EAAK,GACTt+B,OAAQuD,EAAK,GACbZ,KAAMY,EAAK,GACXg7B,aAAcnb,SAAS7f,EAAK,GAAI,IAChCi7B,aAAcpb,SAAS7f,EAAK,GAAI,KAEpCk7B,QAASlB,GAAce,EAAK,IAC5BrH,QAASqH,EAAK,GACdI,QAASJ,EAAK,GACd1wB,YAAa0wB,EAAK,GAClBK,cAAeL,EAAK,GACpBM,SAAUN,EAAK,GACfnL,KAAMmL,EAAK,GACXF,SAAUE,EAAK,IACfO,IAAKP,EAAK,GAAK,IAAMA,EAAK,GAAK,IAAMA,EAAK,IFtDrClB,GAEFp9B,OAAiB,4BClDhBqB,yGAWA67B,6HA4DAC,2DAaL,IAAM2B,GAAb,WAII,SAAAA,EAAYnnB,GAA+BxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAy8B,GAAAz8B,KAF3CsV,YAE0C,EACtCtV,KAAKsV,OAASA,EALtB,OAAAxV,OAAAmR,EAAA,EAAAnR,CAAA28B,EAAA,EAAAvrB,IAAA,mBAAAxN,MAAA,eAAAg5B,EAAA58B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EAU2BkH,GAV3B,IAAAujB,EAAAtiB,EAAAuiB,EAAAp9B,EAAAkX,EAAAmmB,EAAAp2B,EAAAq2B,EAAAC,EAAA,OAAAhrB,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAWcqqB,EAAyB,IAAI5B,GAAuB,CACtD/pB,IAAKhR,KAAKsV,OAAO0nB,iBACjBhvB,MAAOhO,KAAKsV,OAAOtH,MACnBgsB,QAAS,MAGP3f,EAAe,IAAIkR,GAA2B,CAChDvd,MAAOhO,KAAKsV,OAAOtH,MACnBzE,SAAUvJ,KAAKsV,OAAO/L,SACtBiR,iBAAkBxa,KAAKsV,OAAOkF,mBAI5BoiB,EAAgB,IAAIjX,GAA2B,CACjD3X,MAAOhO,KAAKsV,OAAOtH,MACnBzE,SAAUvJ,KAAKsV,OAAO/L,SACtBiR,iBAAkBxa,KAAKsV,OAAOkF,mBA3B1CpI,EAAAE,KAAA,EA8BwEM,QAAQC,IAAI,CACxE8pB,EAAuBM,eAAe,QACtC5iB,EAAaiK,OAAOlL,GACpBwjB,EAAcM,yBAAyB9jB,KAjCnD,UAAA5Z,EAAA4S,EAAA2B,KAAA2C,EAAA5W,OAAAwY,GAAA,EAAAxY,CAAAN,EAAA,GA8Beq9B,EA9BfnmB,EAAA,GA8BiCjQ,EA9BjCiQ,EAAA,GA8B+ComB,EA9B/CpmB,EAAA,GAoCYjQ,EAAaqC,OAASyiB,GAA0B3L,qBApC5D,CAAAxN,EAAAE,KAAA,eAqCkB,IAAI/R,MAAM,mEArC5B,eAwCcw8B,EAAkBt2B,EAAa4E,WAAWhC,IAAI,SAACiC,GACjD,OAAOA,EAAUC,cAzC7B6G,EAAAG,OAAA,SA4CesqB,EAAiBxxB,WACnBhC,IAAI,SAAC8zB,GACF,MAAO,CACHC,cAAwBC,GAAmCF,EAAIG,IAC/DC,WAAYF,GAAgCF,EAAIA,QAGvDpzB,OAAO,SAACozB,GACL,MAAoD,UAA5CA,EAAIC,cAAcrB,SAASyB,eAEtCn0B,IAAI,SAACiC,GAeF,MAAO,CACHuC,QAbyD,IAAzDkvB,EAAgBp8B,QAAQ2K,EAAU8xB,cAAcp4B,IACvChG,GAAemuB,WACjB2P,EAAgB7hB,KAAK,SAACxL,GAG7B,OAAQA,EAAQ0G,eAAiBwP,GAAiC5M,WAC9DtJ,EAAQsK,cAAgBlE,OAAOvK,EAAU8xB,cAAcp4B,MAElDhG,GAAeouB,UAEfpuB,GAAesE,KAIxBgI,UAAW,CACPmyB,OAAQ5C,GAAgB7a,MACxBkB,SAAU5V,EAAU8xB,cAAcvB,qBAClCtwB,YAAaD,EAAU8xB,cAAcp4B,GACrC04B,SAAUpyB,EAAUiyB,WAAWv4B,GAC/Bya,MAAOnU,EAAU8xB,cAAcrB,SAAS4B,oBACxC5d,MAAOzU,EAAU8xB,cAAcrd,MAC/B6d,YAAatyB,EAAUiyB,WAAWnB,QAClCyB,YAAavyB,EAAUiyB,WAAWlB,YAK7C7Y,KAAK,SAACxR,EAAGoR,GACN,OAAQpR,EAAE1G,UAAUmU,MAAM4D,cAAcD,EAAE9X,UAAUmU,UArFpE,yBAAArN,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAyoB,EAAAjqB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,YAAAxN,MAAA,SAoIc8f,GACN,OAAQA,GACJ,KAAKsX,GAAKgD,MACN,OAAO,SAAC9rB,EAA0BoR,GAC9B,OAAOpR,EAAE1G,UAAUmU,MAAM4D,cAAcD,EAAE9X,UAAUmU,QAE3D,KAAKqb,GAAKiD,WACN,OAAO,SAAC/rB,EAA0BoR,GAC9B,OAAOA,EAAE9X,UAAUsyB,YAAY9nB,UAAY9D,EAAE1G,UAAUsyB,YAAY9nB,WAE3E,QACI,MAAM,IAAIvV,MAAM,wBA/IhC,CAAA2Q,IAAA,6BAAAxN,MAAA,SAyJ+B2H,EAA0CmY,GACjE,IAAIwa,EAASh+B,KAAKi+B,UAAUza,GAE5B,OAAOnY,EAAWmY,KAAKwa,GAAQ3e,MAAM,KA5J7C,CAAAnO,IAAA,eAAAxN,MAAA,eAAAw6B,EAAAp+B,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,EAoKuBrI,GApKvB,IAAA4yB,EAAAxnB,EAAAC,EAAAwnB,EAAAhB,EAAArjB,EAAAskB,EAAAxnB,EAAAC,EAAAwnB,EAAAf,EAAAgB,EAAA,OAAAxsB,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cAqKc6rB,EAAkB,IAAIjH,GAAwB,CAChDv5B,OAAQ,YACRqT,IAAKhR,KAAKsV,OAAOkpB,oBACjBxwB,MAAOhO,KAAKsV,OAAOtH,QAxK/B8F,EAAAzB,KAAA,EAAAyB,EAAAxB,KAAA,EA2KoE6rB,EAAgB1I,SAAS,qBAAsB,CAAC,CACpGzwB,GAAIuG,KA5KpB,UAAAoL,EAAA7C,EAAAC,KAAA6C,EAAA9W,OAAAwY,GAAA,EAAAxY,CAAA6W,EAAA,GA2KmBynB,EA3KnBxnB,EAAA,IAAAA,EAAA,IAAA9C,EAAAxB,KAAA,gBAAAwB,EAAAvB,OAAA,SAiLuB,CACHhH,YAAaA,EACbkyB,OAAQ5C,GAAgBv3B,OAnL5C,WAuLkB85B,EAAwCC,GAAmCe,EAAiB,IAE5FrkB,EAAcqjB,EAAcrB,SAASzwB,UAzLvD,CAAAwI,EAAAxB,KAAA,gBAAAwB,EAAAvB,OAAA,SA2LuB,CACHhH,YAAaA,EACbkyB,OAAQ5C,GAAgBv3B,OA7L5C,eAgMkBo6B,EAAW3c,SAAShH,EAAa,IAhMnDjG,EAAAxB,KAAA,GAkM8D6rB,EAAgB1I,SAAS,mBAAoB,CAAC,CAC5FgJ,QAAS,CAAC,CACNC,KAAMnzB,EACNozB,MAAOjB,IAEXkB,gBAAiB,EACjBC,aAAc,KAxM9B,WAAAhoB,EAAA/C,EAAAC,KAAA+C,EAAAhX,OAAAwY,GAAA,EAAAxY,CAAA+W,EAAA,GAkMmBynB,EAlMnBxnB,EAAA,IAAAA,EAAA,IAAAhD,EAAAxB,KAAA,gBAAAwB,EAAAvB,OAAA,SA4MuB,CACHhH,YAAaA,EACbkyB,OAAQ5C,GAAgBv3B,OA9M5C,QAkNkBi6B,EAAsCF,GAAgCiB,EAAc,GAAGQ,MAAM,IAlN/GhrB,EAAAE,GAqNoBopB,EAAcxB,eArNlC9nB,EAAAxB,KAsNqB,MAtNrBwB,EAAAE,GAAA,GA6NqB,MA7NrBF,EAAAE,GAAA,GAgOqB,MAhOrBF,EAAAE,GAAA,GAmOqB,MAnOrBF,EAAAE,GAAA,wBAuNwBopB,EAAcvB,qBAvNtC,CAAA/nB,EAAAxB,KAAA,gBAwNwBmrB,EAAS5C,GAAgB1a,KAxNjDrM,EAAAvB,OAAA,0BA2N8B,IAAIhS,MAAM,wDA3NxC,eA8NoBk9B,EAAS5C,GAAgB1a,KA9N7CrM,EAAAvB,OAAA,2BAiOoBkrB,EAAS5C,GAAgBza,KAjO7CtM,EAAAvB,OAAA,2BAqOwBkrB,EADAL,EAAcrd,QAAU/f,KAAKsV,OAAO/L,SAC3BsxB,GAAgB7a,MAEhB6a,GAAgBpxB,MAvOjDqK,EAAAvB,OAAA,0BA2O0B,IAAIhS,MAAM,iCAAmC68B,EAAcxB,gBA3OrF,eAAA9nB,EAAAvB,OAAA,SA8OmB,CACHhH,YAAa6xB,EAAcp4B,GAC3By4B,OAAQA,EACRvc,SAAUkc,EAAcvB,qBACxB6B,SAAUH,EAAWv4B,GACrBya,MAAO2d,EAAcrB,SAAS4B,qBAAuB,UACrD5d,MAAOqd,EAAcrd,MACrB6d,YAAaL,EAAWnB,QACxByB,YAAaN,EAAWlB,UAtPxC,cAAAvoB,EAAAzB,KAAA,GAAAyB,EAAA0H,GAAA1H,EAAA,SAyPYpS,QAAQU,MAAM,4BAAd0R,EAAA0H,IAzPZ1H,EAAA0H,GAAA,yBAAA1H,EAAAtB,SAAAoB,EAAA5T,KAAA,6BAAAkU,GAAA,OAAAgqB,EAAAzrB,MAAAzS,KAAA0S,YAAA,MAAA+pB,EAAA,GEtCO,SAASsC,GAAWC,GACvB,sBAAAx/B,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,IAAAC,EAAAC,EAAApxB,EAAAe,EAAAswB,EAAAC,EAAA,OAAAvtB,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACH2sB,EArBG,CACH/9B,KAAM7B,EAAWkgC,2BAmBdJ,EAMCD,IANDE,EAAAD,EAICvxB,KAAQG,cAAiBC,EAJ1BoxB,EAI0BpxB,MAJ1BoxB,EAIiC71B,SACzBwF,EALRowB,EAKCtwB,IAAOE,OAGLswB,EAAQ,IAAIG,GAAoB,CAClCxxB,QACAuoB,sBAAuBxnB,EAAO0wB,SAASC,YAAY1uB,MAVpDoB,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAcoB+sB,EAAMM,QAAQX,GAdlC,OAcOzlB,EAdPnH,EAAA2B,KAeCkrB,GA9BsB1lB,EA8BKA,EA7B5B,CACHrY,KAAM7B,EAAWsuB,2BACjBpU,KAAMA,KAYHnH,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,SAiBC6sB,GAzBoB78B,EAyBK,CACrB1C,KAAM,QACNC,QAASyS,EAAA4B,GAAGrU,SA1BjB,CACHuB,KAAM7B,EAAWugC,yBACjBx9B,MAAOA,KAKJ,yBAAAgQ,EAAAI,OARJ,IAAyBpQ,EAPEmX,GAevBrH,EAAAlS,KAAA,aAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GAgHG,SAASmtB,GAAct0B,GAC1B,sBAAAoL,EAAA7W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAmC,EAAO6qB,EAAmDC,GAA1D,IAAAY,EAAAC,EAAA/xB,EAAAzE,EAAAwF,EAAAixB,EAAAC,EAAA,OAAAluB,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cACH2sB,EAAS,CACL/9B,KAAM7B,EAAW6gC,8BAFlBJ,EAQCZ,IARDa,EAAAD,EAMClyB,KAAQG,cAAiBC,EAN1B+xB,EAM0B/xB,MAAOzE,EANjCw2B,EAMiCx2B,SACzBwF,EAPR+wB,EAOCjxB,IAAOE,OAGLixB,EAAkB,IAAIG,GAA8B,CACtDnyB,QAAOzE,WACPi1B,oBAAqBzvB,EAAO0wB,SAASW,UAAUpvB,IAC/CwJ,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,IACzCgsB,iBAAkBjuB,EAAO0wB,SAASa,cAActvB,MAdjDqD,EAAAhC,KAAA,EAAAgC,EAAA/B,KAAA,EAkByB0tB,EAAgBO,aAAah1B,GAlBtD,OAkBOD,EAlBP+I,EAAAN,KAmBCkrB,EAAS,CACL/9B,KAAM7B,EAAW6uB,8BACjB5iB,UAAWA,IArBhB+I,EAAA/B,KAAA,iBAAA+B,EAAAhC,KAAA,GAAAgC,EAAAL,GAAAK,EAAA,SAwBC4qB,EAAS,CACL/9B,KAAM7B,EAAWmhC,4BACjBp+B,MAAO,CACH1C,KAAM2U,EAAAL,GAAG1T,KACTX,QAAS0U,EAAAL,GAAGrU,WA5BrB,yBAAA0U,EAAA7B,SAAA4B,EAAApU,KAAA,aAAP,gBAAAuW,EAAAC,GAAA,OAAAG,EAAAlE,MAAAzS,KAAA0S,YAAA,OCvJE+tB,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,0EAIN,OAAI1wB,KAAK0wB,MAAMnX,KAEPoX,EAAA,cAAC+P,GAAD,CAAOnnB,KAAMvZ,KAAK0wB,MAAMnX,KAAMsa,WAAY7zB,KAAK0wB,MAAMmD,WAAYH,WAAY1zB,KAAK0wB,MAAMgD,aAIxF/C,EAAA,wFAQH3wB,KAAK0wB,MAAMnX,MACZvZ,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMnnB,iBArBpBmpB,aA6DNkO,mBAdf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACHnX,KAAMvY,EAAM4sB,SAASlD,MAAMmD,KAAKpa,IAAIid,EAAMnnB,YAIlD,SAA4B01B,GACxB,MAAO,CACH0B,OAAQ,SAAC3B,GACLC,EAAS4B,GAAmB7B,OAKzB4B,CAA8FH,WC7EtG,SAASK,GAAYC,EAAgBC,GAAqD,IAMzFC,EAASC,EAAYC,EANuCC,IAA6B1uB,UAAAxF,OAAA,QAAAic,IAAAzW,UAAA,KAAAA,UAAA,GACvF2uB,EAAU,IAAIt+B,KAEdw2B,EAAUvW,KAAKC,OAAOoe,EAAQvrB,UAAYirB,EAASjrB,WAAa,KAChEwrB,EAAate,KAAKue,IAAIhI,GAI5B,GAAI+H,EAAa,OADDN,GAAiB,IACQ,CACrC,GAAmB,IAAfM,EACA,MAAO,MACAA,EAAa,IACpBL,EAAU1H,EACV2H,EAAaI,EACbH,EAAO,UACAG,EAAa,MACpBL,EAAUje,KAAKC,MAAMsW,EAAU,IAC/B2H,EAAale,KAAKC,MAAMqe,EAAa,IACrCH,EAAO,UACAG,EAAa,OACpBL,EAAUje,KAAKC,MAAMsW,EAAU,MAC/B2H,EAAale,KAAKC,MAAMqe,EAAa,MACrCH,EAAO,SAEPF,EAAUje,KAAKC,MAAMsW,EAAO,OAC5B2H,EAAale,KAAKC,MAAMqe,EAAU,OAClCH,EAAO,OAGPD,EAAa,IACbC,GAAQ,KAGZ,IAAIK,EAAS,KACTC,EAAS,KAOb,OANIR,EAAU,EACVO,EAAS,KACFP,EAAU,IACjBQ,EAAS,QAGLD,EAASA,EAAS,IAAM,IAAMN,EAAa,IAAMC,GAAQM,EAAS,IAAMA,EAAS,IAGzF,OAAIL,GAAeC,EAAQK,gBAAkBX,EAASW,cAC3CC,KAAKC,eAAe,QAAS,CAChCC,MAAO,QACPC,IAAK,YACNC,OAAOhB,GAEHY,KAAKC,eAAe,QAAS,CAChCC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOhB,OC1CDkB,eACjB,SAAAA,EAAYvR,GAA8B,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAiiC,GAAAniC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAmiC,GAAA9hC,KAAAH,KAChC0wB,0EAIN,IAA+B,IAA3B1wB,KAAK0wB,MAAMwR,YAAuB,CAClC,IAAMpO,EACFnD,EAAA,0BAEQgR,KAAKC,eAAe,QAAS,CACzBC,MAAO,QACPC,IAAK,UACLE,KAAM,UACNG,KAAM,UACNC,OAAQ,UACRC,aAAc,UACfN,OAAO/hC,KAAK0wB,MAAMhgB,OAIjC,OACIigB,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,cAAcxU,MAAOqU,GACnCgN,GAAY9gC,KAAK0wB,MAAMhgB,KAAM,KAItC,OACIigB,EAAA,0BACKmQ,GAAY9gC,KAAK0wB,MAAMhgB,KAAM,YA7BLgiB,aCO7C,SAASS,GAAYC,GACjB,OAAQA,GACJ,KAAKr1B,EAAcs1B,QACf,OAAOt1B,EAAcgL,OACzB,KAAKhL,EAAcgL,OACf,OAAOhL,EAAcs1B,aAIZiP,eACjB,SAAAA,EAAY5R,GAA+B,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAsiC,IACvC7iC,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAwiC,GAAAniC,KAAAH,KAAM0wB,KACD1vB,MAAQ,CACTuyB,KAAMx1B,EAAcs1B,SAHe5zB,8EAQvCO,KAAKwzB,SAAS,CACVD,KAAMJ,GAAYnzB,KAAKgB,MAAMuyB,2CAI1B5T,GACP,OACIgR,EAAA,cAAC4R,GAAD,CAASt+B,QAAS0b,EAAI1b,QAAS6sB,KAAM,GAAIS,iBAAkB5R,EAAIrf,KAAM8Y,eAAgBuG,EAAI3a,2CAInF2a,GACV,IAAKA,EAAIrb,QACL,OACIqsB,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVxU,MAAM,iDAENkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,+BAI9C,IAAMqC,EACFnD,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,+EAKR,OACIA,EAAA,qBAAKgD,UAAU,6BACXhD,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAOqU,GAEPnD,EAAA,mBAAGuD,KAAMvU,EAAIrb,QAAS6vB,OAAO,UACzBxD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,yDAOVye,GACjB,OAAKA,EAAIqC,eAQL2O,EAAA,0BACKhR,EAAIqC,gBAPL2O,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,SAAtB,kDAYM9R,GACd,OAAuB,GAAnBA,EAAImC,YAEA6O,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,SAAtB,QAMJd,EAAA,0BACKhR,EAAImC,YAAc,0CAKhBnC,GACX,OAAQA,EAAIlV,UACR,KAAM8gB,GAAoCjoB,KACtC,OACIqtB,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,gEAENkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAI3B,KAAMqqB,GAAoCpL,KACtC,OACIwQ,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,gEAENkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAGvB,KAAMqqB,GAAoC1L,uBACtC,OACI8Q,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,sCAENkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,YALtC,oBAKqEd,EAAA,kCALrE,eASR,KAAMpF,GAAoCzL,0BACtC,OACI6Q,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,mDAENkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,WAG9C,KAAMlG,GAAoC3hB,OACtC,OACI+mB,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,yCAENkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAGvB,KAAMqqB,GAAoC9hB,MACtC,OACIknB,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,iDAENkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAGvB,KAAMqqB,GAAoCvL,MACtC,OACI2Q,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,0CAENkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,oDAQ3B,OADYlB,KAAK0wB,MAAMjqB,aACfgO,QAEAkc,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,gEACNkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,aAMnByvB,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,iEACNkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,wDAOZye,GACf,IACI8iB,EACJ,GAFc9iB,EAAIc,eAAkBd,EAAI9F,WAAW/D,UAAY6J,EAAIc,cAAc3K,UAEtE,CAEP2sB,EACI9R,EAAA,yBACIA,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,WAAWxU,MAHxB,oDAIFkR,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,MAAOW,SAAU,SAAvC,iBAOZqQ,EACI9R,EAAA,yBACIA,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,cAAeW,SAAU,SAA/C,WAOZ,IAEIsQ,EAWJ,OAHIA,EAAgB,KAIhB/R,EAAA,yBACK8R,EACAC,4CAMT,GAAM1iC,KAAK0wB,MAAMjqB,aAAagE,WAAa8gB,GAAoC9hB,OAC3EzJ,KAAK0wB,MAAMjqB,aAAagE,WAAa8gB,GAAoCvL,MAD7E,CAIA,IAAIrgB,EACAgjC,EACJ,OAAQ3iC,KAAK0wB,MAAMkS,oBACf,KAAKrX,GAAuBjoB,KAExB3D,EAAU,mDACVgjC,EAAY,2BACZ,MACJ,KAAKpX,GAAuBvoB,IACxBrD,EAAU,kEACVgjC,EAAY,MACZ,MACJ,KAAKpX,GAAuBlB,IACxB1qB,EAAU,gDACVgjC,EAAY,OACZ,MACJ,KAAKpX,GAAuBsX,aACxB,OACJ,QAEI,YADAnhC,QAAQC,KAAK,gCAAkC3B,KAAK0wB,MAAMkS,oBAGlE,IAAMnjB,EACFkR,EAAA,0BACKhxB,GAGT,OACIgxB,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,WACVxU,MAAOA,GACPkR,EAAA,sBAAMkB,MAAO,CAAEJ,MAAOkR,EAAWvQ,SAAU,QACvCzB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,sDAOvB,IAAM4hC,EACFnS,EAAA,yBACIA,EAAA,yJAIAA,EAAA,mBAAGkB,MAAO,CAAES,WAAY,YAAayQ,WAAY,SAC5C1K,OAAO2K,SAASC,OADrB,SACmCjjC,KAAK0wB,MAAMjqB,aAAazB,KAU7Dk+B,EACFvS,EAAA,cAACwS,GAAA,EAAD,CACI/O,QARU,SAAA50B,GAA8BA,EAA3B0R,IACjBkyB,KAAMvjC,KAAK,CACP4f,MAAO,gBACP4jB,QAASP,MAOTnS,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,QAAf,mBAKR,OACIyf,EAAA,cAAC4S,GAAA,EAAD,CACIC,QAASN,EACTO,QAAS,CAAC,QAAS,gBACnB9S,EAAA,mBAAGuD,KAAM,SAAWl0B,KAAK0wB,MAAMjqB,aAAazB,IACxC2rB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,oDAMVye,GACb,OACIgR,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,6BACXhD,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuByM,EAAI3a,KACjChF,KAAKyyB,WAAW9S,KAGzBgR,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,qBAAKgD,UAAU,iCACV3zB,KAAK4jC,eAAejkB,IAEzBgR,EAAA,qBAAKgD,UAAU,gCACV3zB,KAAK6jC,iBAGVlT,EAAA,qBAAKgD,UAAU,iCACV3zB,KAAK8jC,cAAcnkB,KAG5BgR,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,qBAAKgD,UAAU,qCACV3zB,KAAK+jC,mBAAmBpkB,IAE7BgR,EAAA,qBAAKgD,UAAU,qCACV3zB,KAAKgkC,kBAEVrT,EAAA,qBAAKgD,UAAU,wCACV3zB,KAAKikC,2DAOZnhB,GACV,OAAO6e,KAAKC,eAAe,QAAS,CAChCC,MAAO,QACPC,IAAK,UACLE,KAAM,UACNG,KAAM,UACNC,OAAQ,UACR8B,OAAQ,UACR7B,aAAc,UACfN,OAAOjf,yCAGAnD,GACV,OACIgR,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,sEACVhU,EAAIhb,mBAGTgsB,EAAA,qBAAKgD,UAAU,6DACXhD,EAAA,qBAAKgD,UAAU,mCACXhD,EAAA,sBAAMgD,UAAU,4CAAhB,UAEJhD,EAAA,qBAAKgD,UAAU,mCAEXhD,EAAA,cAACwT,GAAD,CAAO56B,SAAUoW,EAAII,MAAMxW,SAAUsqB,WAAY,GAAIH,YAAY,MAGzE/C,EAAA,qBAAKgD,UAAU,+DACXhD,EAAA,qBAAKgD,UAAU,mCACXhD,EAAA,sBAAMgD,UAAU,4CAAhB,YAEJhD,EAAA,qBAAKgD,UAAU,mCAEXhD,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAOzf,KAAKokC,cAAczkB,EAAIlG,YAC9BkX,EAAA,0BACKgR,KAAKC,eAAe,QAAS,CAC1BC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOpiB,EAAIlG,wDAS1BkG,GACZ,IACI0kB,EADEviB,EAAcnC,EAAImC,YAAc,EAuBtC,OAnBQuiB,EAFJviB,EACoB,IAAhBA,EAEI6O,EAAA,sCACaA,EAAA,4BADb,gCAMAA,EAAA,uCACcA,EAAA,uBAAI7O,GADlB,iCAOJ6O,EAAA,uCACcA,EAAA,qCADd,yBAMJA,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,cAAcxU,MAAO4kB,GACpC1T,EAAA,qBAAKgD,UAAU,+DACXhD,EAAA,qBAAKgD,UAAU,mCACXhD,EAAA,sBAAMgD,UAAU,eAAchD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAE7CyvB,EAAA,qBAAKgD,UAAU,mCACV3zB,KAAKskC,kBAAkB3kB,iDAOzBA,GACf,IACImU,EADEyQ,EAAQ5kB,EAAIqC,eAuBlB,OAnBQ8R,EAFJyQ,EACc,IAAVA,EAEI5T,EAAA,sCACaA,EAAA,4BADb,mCAMAA,EAAA,uCACcA,EAAA,uBAAI4T,GADlB,oCAOJ5T,EAAA,uCACcA,EAAA,wCADd,yBAMJA,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,cAAcxU,MAAOqU,GACpCnD,EAAA,qBAAKgD,UAAU,+DACXhD,EAAA,qBAAKgD,UAAU,mCACXhD,EAAA,sBAAMgD,UAAU,eAAchD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAE7CyvB,EAAA,qBAAKgD,UAAU,mCACV3zB,KAAKwkC,qBAAqB7kB,gDAO7BA,GACd,IAAMmU,EACFnD,EAAA,+DAEK,IACDA,EAAA,cAAC8T,GAAD,CAAiB/zB,KAAMiP,EAAI9F,WAAYqoB,aAAa,KAG5D,OACIvR,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,cAAcxU,MAAOqU,GACpCnD,EAAA,qBAAKgD,UAAU,+DACXhD,EAAA,qBAAKgD,UAAU,mCACXhD,EAAA,sBAAMgD,UAAU,eAAchD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAE7CyvB,EAAA,qBAAKgD,UAAU,mCACXhD,EAAA,cAAC8T,GAAD,CAAiB/zB,KAAMiP,EAAI9F,WAAYqoB,aAAa,8CAOzDviB,GACX,OACIgR,EAAA,cAACA,EAAA,SAAD,KACK3wB,KAAK0kC,gBAAgB/kB,GACrB3f,KAAK2kC,mBAAmBhlB,GACxB3f,KAAK4kC,kBAAkBjlB,2CAMhC,IAAMA,EAAM3f,KAAK0wB,MAAMjqB,aACvB,OACIkqB,EAAA,qBAAKgD,UAAU,qBACXhD,EAAA,qBAAKgD,UAAU,0BAIXhD,EAAA,qBAAKgD,UAAU,6BACV3zB,KAAK6kC,iBAAiBllB,IAE3BgR,EAAA,qBAAKgD,UAAU,6BACXhD,EAAA,qBAAKgD,UAAU,iCACXhD,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,qBAAKgD,UAAU,4DACXhD,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuByM,EAAI3a,KACjC2a,EAAIrf,SAKrBqwB,EAAA,qBAAKgD,UAAU,iCACXhD,EAAA,qBAAKgD,UAAU,kCACV3zB,KAAK8kC,cAAcnlB,IAExBgR,EAAA,qBAAKgD,UAAU,kCACV3zB,KAAK+kC,eAAeplB,yCAU7C,OAAO3f,KAAKglC,sBAjiB2BtS,aCVlCuS,GAAb,SAAArS,GACI,SAAAqS,EAAYvU,GAA2B,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAilC,IACnCxlC,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAmlC,GAAA9kC,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTsL,YAAa,IAJkB7M,EAD3C,OAAAK,OAAAe,EAAA,EAAAf,CAAAmlC,EAAArS,GAAA9yB,OAAAmR,EAAA,EAAAnR,CAAAmlC,EAAA,EAAA/zB,IAAA,kBAAAxN,MAAA,SASoBic,GACZ,OACIgR,EAAA,uCAXZ,CAAAzf,IAAA,YAAAxN,MAAA,SAiBc6gC,EAAeW,EAAkBC,GACvC,OAAc,IAAVZ,GAAeA,EAAQ,EAChBY,EAEJD,IArBf,CAAAh0B,IAAA,aAAAxN,MAAA,WAwBiB,IAAAoN,EAAA9Q,KACT,OAAIA,KAAK0wB,MAAMtkB,cAAcc,OAAS,EAE9BlN,KAAK0wB,MAAMtkB,cAAc/C,IAAI,SAAC5C,EAAc2+B,GACxC,IAAMv3B,EAASiD,EAAK4f,MAAMrkB,aAAaoH,IAAIhN,EAAazB,KAAO,KAC/D,OACI2rB,EAAA,qBAAKzf,IAAK2E,OAAOuvB,GAAQzR,UAAU,cAC/BhD,EAAA,cAAC0U,GAAD,CAAmB5+B,aAAcA,EAAcm8B,mBAAoB/0B,OAO/E8iB,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,UACR2wB,MAAO,CAAE0T,SAAU,OAAQC,OAAQ,oBACnC7lC,QAAQ,0CAxC5B,CAAAuR,IAAA,SAAAxN,MAAA,WA8CQ,OACIitB,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,qBAAKkB,MAAO,CAAE4T,UAAW,OAAQC,QAAS,OAAQC,cAAe,WAC5D3lC,KAAK4lC,mBAjD1BX,EAAA,CAAmCvS,aCoBpBkO,mBAlCR,SAAyB5/B,GAE5B,GAA6C,OAAzCA,EAAMI,MAAMyuB,eAAevuB,UAC3B,MAAM,IAAIf,MAAM,kBAH+C,IAAAslC,EAW/D7kC,EALAI,MACIyuB,eACIvuB,UAqBZ,MAAO,CACH8K,cA9B+Dy5B,EAQ1Cz5B,cAsBNC,aA9BgDw5B,EAQ3Bx5B,eA0B7Bu0B,CAAyBqE,oDCuDzBa,uBA7CX,SAAAA,EAAYpV,EAAoBqV,GAA6B,IAAAtmC,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAA8lC,IACzDrmC,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAgmC,GAAA3lC,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTglC,gBAAiB,UAJoCvmC,gFASzD,GAAIO,KAAK0wB,MAAMuV,YACX,OACItV,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,QAAQ2wB,MAAO,CAAEqU,cAAe,SAAUC,WAAY,MAAOC,YAAa,iDAKjFC,qCAWZ,OACI1V,EAAA,qBAAKgD,UAAU,UACXhD,EAAA,qBAAKgD,UAAU,qBACXhD,EAAA,qBAAKgD,UAAU,qBACXhD,EAAA,qBAAKgD,UAAU,sBACV3zB,KAAK0wB,MAAMuV,aAEhBtV,EAAA,qBAAKgD,UAAU,kBACV3zB,KAAK0wB,MAAM4V,mBArCnB5T,kCCmCN6T,uBAlEX,SAAAA,EAAY7V,EAAsBqV,GAA6B,IAAAtmC,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAumC,IAC3D9mC,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAymC,GAAApmC,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTglC,gBAAiB,UAJsCvmC,+EAQ/C4mC,yCAcZ,OACI1V,EAAA,cAAC6V,GAAA,EAAD,CAAOC,OAAQ,SAAAjnC,GAA2BA,EAAxBknC,QAAwB,IAClCC,EAA8B,GAClC,OAFsCnnC,EAAfwjC,SAEN4D,UACb,IAAK,iBACDD,EAAe,CAAC,WAChB,MACJ,IAAK,mBACDA,EAAe,CAAC,UAGxB,OACIhW,EAAA,cAACwS,GAAA,EAAD,CAEIwD,aAAcA,EACd9U,MAAO,CAAEgV,gBAAiB,eAC1Bt1B,KAAK,cAELof,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,WACXyf,EAAA,cAACmW,GAAA,EAAD,CAAMnD,GAAG,kBAAT,yDAYpB,OACIhT,EAAA,qBAAKgD,UAAU,YACXhD,EAAA,qBAAKgD,UAAU,iBACV3zB,KAAK+mC,cAEVpW,EAAA,qBAAKgD,UAAU,oBACV3zB,KAAK0wB,MAAM4V,iBA5DT5T,cCwfRsU,eAxdX,SAAAA,EAAYtW,GAAkC,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAgnC,IAC1CvnC,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAknC,GAAA7mC,KAAAH,KAAM0wB,KANVuW,iBAK8C,EAAAxnC,EAJ9CynC,kBAI8C,EAAAznC,EAH9C0nC,wBAG8C,EAG1C1nC,EAAKwnC,YAAcvU,cACnBjzB,EAAKynC,aAAexU,cAEpBjzB,EAAK0nC,mBAAqB,CACtB,CACIC,MAAO,SACP1jC,MAAO,UAEX,CACI0jC,MAAO,QACP1jC,MAAO,SAEX,CACI0jC,MAAO,QACP1jC,MAAO,UAIfjE,EAAKuB,MAAQ,CACTimC,YAAa,GACbI,UAAU,EACVC,iBAAkB,SAClBC,aAAc,GACdC,gBAAiB,MACjBC,sBAAsB,GA3BgBhoC,mFAiC1CO,KAAK0wB,MAAMgX,aAAa,yCAIxBtE,KAAMvjC,KAAK,CACP4f,MAAO,6BACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,qGAOZ,GAAiC,OAA7B3wB,KAAKinC,YAAYU,QAArB,CAGA,IAAMr7B,EAActM,KAAKinC,YAAYU,QAAQjkC,MAAM9C,MAAM,SAEzDZ,KAAK0wB,MAAMgX,aAAap7B,8CAIxB,SAAItM,KAAKgB,MAAMimC,aAAejnC,KAAKgB,MAAMimC,YAAY/5B,OAAS,iDAO9D,IAAI06B,EAEAA,EADA5nC,KAAKinC,YAAYU,QACS3nC,KAAKinC,YAAYU,QAAQjkC,MAEzB,GAE9B1D,KAAKwzB,SAAS,CAAEyT,YAAaW,qCAGxBvB,GACLA,EAAEwB,iBACF7nC,KAAK8nC,kDAGMpkC,GACX,OAAQA,GACJ,IAAK,QACD1D,KAAK0wB,MAAMqX,WAAW,QAASnpC,EAAc2kB,WAC7C,MACJ,IAAK,OACDvjB,KAAK0wB,MAAMqX,WAAW,OAAQnpC,EAAc2kB,WAC5C,MACJ,IAAK,gBACDvjB,KAAK0wB,MAAMqX,WAAW,UAAWnpC,EAAc+W,YAC/C,MACJ,IAAK,kBACD3V,KAAK0wB,MAAMqX,WAAW,UAAWnpC,EAAc+W,YAC/C,MACJ,IAAK,cACD3V,KAAK0wB,MAAMqX,WAAW,cAAenpC,EAAc+W,YACnD,MACJ,IAAK,iBACD3V,KAAK0wB,MAAMqX,WAAW,iBAAkBnpC,EAAc+W,2DAK5C0wB,GAClBrmC,KAAK0wB,MAAMqX,WAAW/nC,KAAK0wB,MAAMsX,OAAQ3B,EAAElS,OAAOzwB,wDAG7B2iC,GACrB,IAAI4B,EACJjoC,KAAKwzB,SAAS,CAAE8T,iBAAkBjB,EAAElS,OAAOzwB,QACpB,WAAnB2iC,EAAElS,OAAOzwB,OACT1D,KAAKwzB,SAAS,CAAE+T,aAAc,KAC9BU,EAASnoC,OAAAyB,EAAA,EAAAzB,CAAA,GACFE,KAAK0wB,MAAM3mB,OADT,CAEL2Z,SAAU2iB,EAAElS,OAAOzwB,UAGvBukC,EAASnoC,OAAAyB,EAAA,EAAAzB,CAAA,GACFE,KAAK0wB,MAAM3mB,OADT,CAEL2Z,SAAU2iB,EAAElS,OAAOzwB,MACnBwK,MAAO,KAEXlO,KAAKwzB,SAAS,CAAE+T,aAAc,MAElCvnC,KAAK0wB,MAAMwX,aAAaD,gDAGPE,GACjB,IAAIF,EACJjoC,KAAKwzB,SAAS,CAAE+T,aAAcY,IACD,IAAzBA,EAAcj7B,QACdlN,KAAKwzB,SAAS,CAAE8T,iBAAkB,WAClCW,EAASnoC,OAAAyB,EAAA,EAAAzB,CAAA,GACFE,KAAK0wB,MAAM3mB,OADT,CAEL2Z,SAAU,SACVxV,MAAOi6B,MAGXnoC,KAAKwzB,SAAS,CAAE8T,iBAAkB,WAClCW,EAASnoC,OAAAyB,EAAA,EAAAzB,CAAA,GACFE,KAAK0wB,MAAM3mB,OADT,CAEL2Z,SAAU,SACVxV,MAAOi6B,KAIfnoC,KAAK0wB,MAAMwX,aAAaD,mDAGJ5B,GACpBrmC,KAAKwzB,SAAS,CAAEgU,gBAAiBnB,EAAElS,OAAOzwB,QAC1C,IAAMukC,EAASnoC,OAAAyB,EAAA,EAAAzB,CAAA,GACRE,KAAK0wB,MAAM3mB,OADH,CAEX4Z,QAAS0iB,EAAElS,OAAOzwB,QAEtB1D,KAAK0wB,MAAMwX,aAAaD,2CAIS,OAA7BjoC,KAAKinC,YAAYU,UAGrB3nC,KAAKinC,YAAYU,QAAQjkC,MAAQ,GACjC1D,KAAKooC,sBACLpoC,KAAK8nC,2DAIL,OAA8B,IAA1B9nC,KAAK0wB,MAAMjkB,WAEPkkB,EAAA,4CAKyB,IAA7B3wB,KAAK0wB,MAAMhkB,cAEPikB,EAAA,mCAGK3wB,KAAK0wB,MAAMjkB,WACX,IAJL,QAUJzM,KAAK0wB,MAAMjkB,aAAezM,KAAK0wB,MAAMhkB,cAEjCikB,EAAA,0BACIA,EAAA,uBAAI3wB,KAAK0wB,MAAMjkB,YACd,IAFL,QASJkkB,EAAA,0BACIA,EAAA,uBAAI3wB,KAAK0wB,MAAMhkB,eADnB,IAGK1M,KAAK0wB,MAAMjkB,WACX,IAJL,mDAWJ,OAAIzM,KAAK0wB,MAAM9jB,UACH+jB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,YAEfyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,sDAInB,OACIyvB,EAAA,sBAAM3rB,GAAG,aAAa2uB,UAAU,iCAAiC0U,SAAUroC,KAAKqoC,SAAS/T,KAAKt0B,OAC1F2wB,EAAA,uBACIgD,UAAU,mCACV2U,YAAY,uBACZC,SAAUvoC,KAAKooC,oBAAoB9T,KAAKt0B,MACxCwoC,WAAS,EACThM,IAAKx8B,KAAKinC,cAKdtW,EAAA,cAAC8X,GAAA,EAAD,CACIC,UAAW1oC,KAAK2oC,kBAChBnM,IAAKx8B,KAAKknC,aACV0B,KAAK,aACL13B,IAAI,SACJ23B,SAAS,UACR7oC,KAAK8oC,oBAGVnY,EAAA,cAAC8X,GAAA,EAAD,CACIrU,QAASp0B,KAAK+oC,cAAczU,KAAKt0B,MACjC0oC,UAAW1oC,KAAK2oC,kBAChBlV,KAAK,qDAQjB,OACI9C,EAAA,qBAAKgD,UAAU,qCACXhD,EAAA,qBAAKgD,UAAU,sCACV3zB,KAAKgpC,oBAEVrY,EAAA,qBAAKgD,UAAU,sCACV3zB,KAAKipC,gEASlB,IAAMhD,EACFtV,EAAA,cAACA,EAAA,SAAD,MAGE2V,EACF3V,EAAA,cAACA,EAAA,SAAD,KAEIA,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,OAAOW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,SAGzE,OACI2wB,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,EAAaK,QAASA,kDAK/C,OACI3V,EAAA,cAAC0Y,GAAA,EAAD,CACId,SAAUvoC,KAAKspC,eAAehV,KAAKt0B,MACnCupC,aAAcvpC,KAAK0wB,MAAMsX,OACzBwB,0BAA0B,EAC1B3X,MAAO,CAAEhB,MAAO,SAChBF,EAAA,cAAC0Y,GAAA,EAAOI,OAAR,CAAe/lC,MAAM,kBAAkBwN,IAAI,WAA3C,gBACAyf,EAAA,cAAC0Y,GAAA,EAAOI,OAAR,CAAe/lC,MAAM,gBAAgBwN,IAAI,UAAzC,oBACAyf,EAAA,cAAC0Y,GAAA,EAAOI,OAAR,CAAe/lC,MAAM,OAAOwN,IAAI,QAAhC,YACAyf,EAAA,cAAC0Y,GAAA,EAAOI,OAAR,CAAe/lC,MAAM,cAAcwN,IAAI,eAAvC,aACAyf,EAAA,cAAC0Y,GAAA,EAAOI,OAAR,CAAe/lC,MAAM,iBAAiBwN,IAAI,kBAA1C,4DAUR,GAAIlR,KAAKgB,MAAMymC,qBAAsB,CACjCznC,KAAKwzB,SAAS,CAAEiU,sBAAsB,IADL,IAAAiC,EAEE1pC,KAAK0wB,MAAM3mB,OAAxC2Z,EAF2BgmB,EAE3BhmB,SAAUxV,EAFiBw7B,EAEjBx7B,MAFiBw7B,EAEV/lB,QAClB,CAAC,SAAU,OAAOC,SAASF,KAC5BA,EAAW,SACX1jB,KAAKwzB,SAAS,CAAE8T,iBAAkB,YAEtCtnC,KAAKwzB,SAAS,CAAE+T,aAAc,GAAIC,gBAAiB,QACnDt5B,EAAQ,GACE,MACVlO,KAAK0wB,MAAMwX,aAAa,CACpBxkB,WAAUxV,QAAOyV,QAFX,aAKV3jB,KAAKwzB,SAAS,CAAEiU,sBAAsB,mDAK1C,OAAIznC,KAAKgB,MAAMymC,qBAEP9W,EAAA,cAAC8C,GAAA,EAAD,CACIvyB,KAAK,WACLyyB,UAAU,2BACVS,QAASp0B,KAAK2pC,iBAAiBrV,KAAKt0B,QAIxC2wB,EAAA,cAAC8C,GAAA,EAAD,CACIvyB,KAAK,WACLyyB,UAAU,mBACVS,QAASp0B,KAAK2pC,iBAAiBrV,KAAKt0B,qDAMhD,IAAM4pC,EAAa,CACflE,QAAS,QACT9T,OAAQ,OACRiY,WAAY,QAGhB,OAAI7pC,KAAKgB,MAAMymC,qBAEP9W,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,cAACmZ,GAAA,EAAMC,MAAP,CACIxB,SAAUvoC,KAAKgqC,yBAAyB1V,KAAKt0B,MAC7C0D,MAAO1D,KAAKgB,MAAMsmC,kBAElB3W,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,SAASmuB,MAAO+X,GAA7B,WACAjZ,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,MAAMmuB,MAAO+X,GAA1B,YACC5pC,KAAKiqC,uBACNtZ,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,YAAYmuB,MAAO+X,GAAhC,eACAjZ,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,SAASmuB,MAAO+X,GAA7B,kBAGJjZ,EAAA,cAACuZ,GAAA,EAASH,MAAV,CACII,QAASnqC,KAAKmnC,mBACdzjC,MAAO1D,KAAKgB,MAAMumC,aAClB5T,UAAU,qCACV4U,SAAUvoC,KAAKoqC,qBAAqB9V,KAAKt0B,SAKjD2wB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,cAACmZ,GAAA,EAAMC,MAAP,CACIxB,SAAUvoC,KAAKgqC,yBAAyB1V,KAAKt0B,MAC7C0D,MAAO1D,KAAKgB,MAAMsmC,kBAElB3W,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,SAASmuB,MAAO+X,GAA7B,WACAjZ,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,MAAMmuB,MAAO+X,GAA1B,YACC5pC,KAAKiqC,yEAQtB,GAAKjqC,KAAKgB,MAAMymC,qBAAhB,CAGA,IAAMmC,EAAa,CACflE,QAAS,QACT9T,OAAQ,OACRiY,WAAY,OACZrE,OAAQ,OAQZ,OACI7U,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,cAACmZ,GAAA,EAAMC,MAAP,CACIxB,SAAUvoC,KAAKqqC,wBAAwB/V,KAAKt0B,MAC5C0D,MAAO1D,KAAKgB,MAAMwmC,iBAClB7W,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,MAAMmuB,MAAO+X,GAA1B,OACAjZ,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,SAASmuB,MAAO+X,GAA7B,UACAjZ,EAAA,cAACmZ,GAAA,EAAD,CAAOpmC,MAAM,UAAUmuB,MAAO+X,GAA9B,4DAOZ,OAAI5pC,KAAK0wB,MAAMtuB,MAEPuuB,EAAA,cAAC2U,GAAA,EAAD,CACIpkC,KAAK,QACLvB,QAASK,KAAK0wB,MAAMtuB,MAAM1C,KAC1B6F,YAAavF,KAAK0wB,MAAMtuB,MAAMzC,UAIlCgxB,EAAA,cAAC2Z,GAAD,mDAMR,OACI3Z,EAAA,cAACA,EAAA,SAAD,KAGIA,EAAA,qBAAKgD,UAAU,eAAf,WACC3zB,KAAKuqC,sBAEN5Z,EAAA,qBAAKgD,UAAU,cAAc9B,MAAO,CAAE2Y,UAAW,SAAjD,UAECxqC,KAAKyqC,qBAELzqC,KAAKgB,MAAMymC,qBACR9W,EAAA,qBAAKgD,UAAU,cAAc9B,MAAO,CAAE2Y,UAAW,SAAjD,cACC,KACJxqC,KAAK0qC,qEAMd,OACI/Z,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAG,oBAAmBhT,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,cAAc5B,MAAO,CAAEuU,YAAa,SAAjD,wBAC9B,IACDzV,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,OAAOW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,0CAMzE,OACI2wB,EAAA,qBAAKgD,UAAU,+CACXhD,EAAA,cAACga,GAAD,CAAUrE,QAAStmC,KAAK4qC,sBAEvB5qC,KAAK6qC,kBACNla,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,qBAAKgD,UAAU,uDACV3zB,KAAK8qC,uBAEVna,EAAA,qBAAKgD,UAAU,kCACV3zB,KAAK+qC,+BAtdKrY,aC4C5B,SAASnlB,GAAchB,EAAmBC,GAC7C,MAAO,CACHtL,KAAM7B,EAAWiO,uBACjBf,UAAWA,EACXC,cAAeA,GA+CvB,SAASW,GAAkBf,EAAkDK,EAAoBJ,GAC7F,MAAO,CACHnL,KAAM7B,EAAW4N,2BACjBb,cAAeA,EACfK,WAAYA,EACZJ,aAAcA,GAItB,SAASgB,GAAgBjL,GACrB,MAAO,CACHlB,KAAM7B,EAAW+N,yBACjBhL,MAAOA,GAkBR,SAASqL,GAAgB1D,GAC5B,MAAO,CACH7I,KAAM7B,EAAWmO,yBACjBzD,OAAQA,GAIT,SAASihC,KACZ,OAAO,SAAC/L,EAAmDC,GACvDD,EA3IG,CACH/9B,KAAM7B,EAAW4rC,yBA4JjBhM,EAxJR,SAAqB/yB,GACjB,MAAO,CACHhL,KAAM7B,EAAW2M,yBACjBE,iBAAkBA,GAqJThJ,CAfqC,CAC1CiJ,iBAAkB,GAClBC,cAAe,GACfC,aAAc,IAAIgE,IAClB5D,WAAY,EACZC,cAAe,EACfH,UAAW,UACXC,cAAe5N,EAAc+W,WAC7B5L,OAAQ,CAAE2Z,SAAU,SAAUxV,MAAO,GAAIyV,QAAS,OAClDrX,YAAa,GACbK,uBAAwB,KACxBC,WAAW,EACXxK,MAAO,SCnHJw+B,mBA3CR,SAAyBsK,GAC5B,IAAKA,EAAW9pC,MAAMyuB,eAAevuB,UACjC,MAAM,IAAIf,MAAM,kBAFgD,IAAA4qC,EAahED,EAPA9pC,MACIyuB,eACIvuB,UACI8K,EAToD++B,EASpD/+B,cAAeC,EATqC8+B,EASrC9+B,aAAcjK,EATuB+oC,EASvB/oC,MAM7C,MAAO,CACHgK,gBACAC,eACAI,WAlBgE0+B,EAUpD1+B,WASZC,cAnBgEy+B,EAUxCz+B,cAUxB3C,OApBgEohC,EAUzBphC,OAWvC3H,QACAwK,UAtBgEu+B,EAUjBv+B,YAiBhD,SAA4BqyB,GAC/B,MAAO,CACHyI,aAAc,SAACp7B,GAEX2yB,EDuIL,SAAoB3yB,GACvB,sBAAA9M,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,IAAAC,EAAAtP,EAAAuP,EAAApxB,EAAAzE,EAAAwF,EAAAq8B,EAAA7+B,EAAAC,EAAAzC,EAAAshC,EAAA30B,EAAA40B,EAAAhmB,EAAAimB,EAAAC,EAAA,OAAAz5B,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACH2sB,EArEG,CACH/9B,KAAM7B,EAAW0N,2BAmEdoyB,EAOCD,IAHSrP,EAJVsP,EAIC/9B,MAASyuB,eAJVuP,EAAAD,EAKCvxB,KAAQG,cAAiBC,EAL1BoxB,EAK0BpxB,MAAOzE,EALjC61B,EAKiC71B,SACzBwF,EANRowB,EAMCtwB,IAAOE,OAGsB,OAA7B8gB,EAAevuB,UAThB,CAAA8Q,EAAAE,KAAA,eAUC2sB,EAAS5xB,GAAgB,CACrB3N,KAAM,gBACNC,QAAS,0DAZdyS,EAAAG,OAAA,wBAAA64B,EAiByDvb,EAApDvuB,UAAaiL,EAjBlB6+B,EAiBkB7+B,UAAWC,EAjB7B4+B,EAiB6B5+B,cAAezC,EAjB5CqhC,EAiB4CrhC,OACzCshC,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MApB1CoB,EAAAC,KAAA,EAAAD,EAAAE,KAAA,GAwBwC+4B,EAAUI,UAAU,CACvDn/B,YAAaA,EACbC,YAAWC,gBAAezC,SAAQR,aA1BvC,WAAAmN,EAAAtE,EAAA2B,KAwBS3H,EAxBTsK,EAwBStK,cAAekZ,EAxBxB5O,EAwBwB4O,SAOjBimB,EAAYn/B,EACbrC,OAAO,SAAC4V,GACL,OACIA,EAAIlV,WAAa8gB,GAAoC9hB,OACrDkW,EAAIlV,WAAa8gB,GAAoCvL,QAG5D3W,IAAI,SAACsW,GACF,OAAOA,EAAI3a,MAGLkI,OAAS,GA1CxB,CAAAkF,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GA2C0B+4B,EAAUK,sBAAsB,CAAE/iB,gBAAiB4iB,IA3C7E,QA2CKl/B,EA3CL+F,EAAA2B,KAAA3B,EAAAE,KAAA,iBA6CKjG,EAAe,IAAIgE,IA7CxB,QAgDC4uB,EAAS9xB,GAAkBf,EAAekZ,EAAOjZ,IAhDlD+F,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,SAkDC1Q,QAAQU,MAAM,sBAAuBgQ,EAAA4B,GAAG1T,KAAM8R,EAAA4B,GAAGrU,SACjDs/B,EAAS5xB,GAAgB,CACrB3N,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,WArDjB,yBAAAyS,EAAAI,SAAAN,EAAAlS,KAAA,aAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GCxIiBmuB,CAAmBv0B,KAEhCy7B,WAAY,SAACC,EAAgBx7B,GAEzByyB,ED+LL,SAAkB1yB,EAAmBC,GACxC,sBAAAmK,EAAA7W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAA2B,EAAOqrB,EAAmDC,GAA1D,IAAAyM,EAAA9b,EAAA+b,EAAA59B,EAAAzE,EAAAwF,EAAAs8B,EAAAQ,EAAAv/B,EAAAvC,EAAA6M,EAAAk1B,EAAAxmB,EAAAimB,EAAAQ,EAAA,OAAAh6B,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,UACH2sB,EAAS1xB,GAAchB,EAAWC,IAD/Bm/B,EAMqBzM,IAFXrP,EAJV8b,EAICvqC,MAASyuB,eAJV+b,EAAAD,EAKC/9B,KAAQG,cAAiBC,EAL1B49B,EAK0B59B,MAAOzE,EALjCqiC,EAKiCriC,SACzBwF,EANR48B,EAMC98B,IAAOE,OAELs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGZ,OAA7B6e,EAAevuB,UAbhB,CAAAwS,EAAAxB,KAAA,eAcC2sB,EAAS5xB,GAAgB,CACrB3N,KAAM,gBACNC,QAAS,0DAhBdmU,EAAAvB,OAAA,wBAAAs5B,EAqB4Chc,EAAvCvuB,UAAagL,EArBlBu/B,EAqBkBv/B,YAAavC,EArB/B8hC,EAqB+B9hC,OArB/B+J,EAAAzB,KAAA,EAAAyB,EAAAxB,KAAA,GAwBwC+4B,EAAUI,UAAU,CACvDn/B,cAAavC,SAAQR,WACrBgD,YAAWC,kBA1BhB,WAAAoK,EAAA9C,EAAAC,KAwBS3H,EAxBTwK,EAwBSxK,cAAekZ,EAxBxB1O,EAwBwB0O,SAOjBimB,EAAYn/B,EACbrC,OAAO,SAAC4V,GACL,OACIA,EAAIlV,WAAa8gB,GAAoC9hB,OACrDkW,EAAIlV,WAAa8gB,GAAoCvL,QAG5D3W,IAAI,SAACsW,GACF,OAAOA,EAAI3a,MAGLkI,OAAS,GA1CxB,CAAA4G,EAAAxB,KAAA,gBAAAwB,EAAAxB,KAAA,GA2C0B+4B,EAAUK,sBAAsB,CAAE/iB,gBAAiB4iB,IA3C7E,QA2CKl/B,EA3CLyH,EAAAC,KAAAD,EAAAxB,KAAA,iBA6CKjG,EAAe,IAAIgE,IA7CxB,QAgDC4uB,EAAS9xB,GAAkBf,EAAekZ,EAAOjZ,IAhDlDyH,EAAAxB,KAAA,iBAAAwB,EAAAzB,KAAA,GAAAyB,EAAAE,GAAAF,EAAA,SAkDCpS,QAAQU,MAAM,sBAAuB0R,EAAAE,GAAG1T,KAAMwT,EAAAE,GAAGrU,SACjDs/B,EAAS5xB,GAAgB,CACrB3N,KAAMoU,EAAAE,GAAG1T,KACTX,QAASmU,EAAAE,GAAGrU,WArDjB,yBAAAmU,EAAAtB,SAAAoB,EAAA5T,KAAA,aAAP,gBAAAsU,EAAAc,GAAA,OAAAuB,EAAAlE,MAAAzS,KAAA0S,YAAA,GChMiBmuB,CAAiBmH,EAAQx7B,KAEtC07B,aAAc,SAACn+B,GACXk1B,EDwPL,SAAoBl1B,GACvB,sBAAA8M,EAAA/W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAmC,EAAO6qB,EAAmDC,GAA1D,IAAAY,EAAAjQ,EAAAkQ,EAAA/xB,EAAAzE,EAAAwF,EAAAs8B,EAAAW,EAAA1/B,EAAAC,EAAAC,EAAAsK,EAAAm1B,EAAA3mB,EAAAimB,EAAAW,EAAA,OAAAn6B,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,UACH2sB,EAASxxB,GAAgB1D,IADtB+1B,EAMqBZ,IAFXrP,EAJViQ,EAIC1+B,MAASyuB,eAJVkQ,EAAAD,EAKClyB,KAAQG,cAAiBC,EAL1B+xB,EAK0B/xB,MAAOzE,EALjCw2B,EAKiCx2B,SACzBwF,EANR+wB,EAMCjxB,IAAOE,OAELs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGZ,OAA7B6e,EAAevuB,UAbhB,CAAA+S,EAAA/B,KAAA,eAcC2sB,EAAS5xB,GAAgB,CACrB3N,KAAM,gBACNC,QAAS,0DAhBd0U,EAAA9B,OAAA,wBAAAy5B,EAqB8Dnc,EAAzDvuB,UAAagL,EArBlB0/B,EAqBkB1/B,YAAaC,EArB/By/B,EAqB+Bz/B,UAAWC,EArB1Cw/B,EAqB0Cx/B,cArB1C6H,EAAAhC,KAAA,EAAAgC,EAAA/B,KAAA,GAwBwC+4B,EAAUI,UAAU,CACvDn/B,cAAavC,SAAQR,WACrBgD,YAAWC,kBA1BhB,WAAAsK,EAAAzC,EAAAN,KAwBS3H,EAxBT0K,EAwBS1K,cAAekZ,EAxBxBxO,EAwBwBwO,SAOjBimB,EAAYn/B,EACbrC,OAAO,SAAC4V,GACL,OACIA,EAAIlV,WAAa8gB,GAAoC9hB,OACrDkW,EAAIlV,WAAa8gB,GAAoCvL,QAG5D3W,IAAI,SAACsW,GACF,OAAOA,EAAI3a,MAGLkI,OAAS,GA1CxB,CAAAmH,EAAA/B,KAAA,gBAAA+B,EAAA/B,KAAA,GA2C0B+4B,EAAUK,sBAAsB,CAAE/iB,gBAAiB4iB,IA3C7E,QA2CKl/B,EA3CLgI,EAAAN,KAAAM,EAAA/B,KAAA,iBA6CKjG,EAAe,IAAIgE,IA7CxB,QAgDC4uB,EAAS9xB,GAAkBf,EAAekZ,EAAOjZ,IAhDlDgI,EAAA/B,KAAA,iBAAA+B,EAAAhC,KAAA,GAAAgC,EAAAL,GAAAK,EAAA,SAkDC3S,QAAQU,MAAM,sBAAuBiS,EAAAL,GAAG1T,KAAM+T,EAAAL,GAAGrU,SACjDs/B,EAAS5xB,GAAgB,CACrB3N,KAAM2U,EAAAL,GAAG1T,KACTX,QAAS0U,EAAAL,GAAGrU,WArDjB,yBAAA0U,EAAA7B,SAAA4B,EAAApU,KAAA,aAAP,gBAAAuW,EAAAC,GAAA,OAAAK,EAAApE,MAAAzS,KAAA0S,YAAA,GCzPiBmuB,CAAmB92B,OAKzB62B,CAA6CoG,ICxDtDvG,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,iFAIN,OACIC,EAAA,yGAOJ,GAAK3wB,KAAK0wB,MAAM6C,KAAKnxB,MAGrB,OACIuuB,EAAA,mCACY3wB,KAAK0wB,MAAM6C,KAAKnxB,MAAMzC,0CAMtC,OAAQK,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KAE3B,KAAKzE,EAAsB2D,QACvB,OAAOxC,KAAKmsC,gBAChB,KAAKttC,EAAsBoH,MACvB,OAAOjG,KAAKosC,cAChB,KAAKvtC,EAAsB8D,QACvB,OACIguB,EAAA,cAAC0b,GAAD,CAAWrE,OAAO,iEAM9B,OAAQhoC,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KAEvBtD,KAAK0wB,MAAMiQ,yDAKnB3gC,KAAK0wB,MAAM4b,kBAhDE5Z,aAyFNkO,mBAjBf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACH6C,KAAMvyB,EAAMI,MAAMyuB,iBAI1B,SAA4BoP,GACxB,MAAO,CACH0B,OAAQ,WACJ1B,EAAS4B,OAEbyL,SAAU,WACNrN,EF/CD,CACH/9B,KAAM7B,EAAWqO,wBEmDVkzB,CAA8FH,ICyGtG,SAASp+B,GAAUD,GACtB,MAAO,CACHlB,KAAM7B,EAAW6C,mBACjBE,MAAOA,GAwCR,SAASmqC,KACZ,MAAO,CACHrrC,KAAM7B,EAAW2G,yBAqBlB,SAASf,GAAgBD,GAC5B,MAAO,CACH9D,KAAM7B,EAAW0F,0BACjBC,GAAIA,GA+BL,SAASG,GAAcH,EAAY5C,GACtC,MAAO,CACHlB,KAAM7B,EAAW6F,wBACjBF,GAAIA,EACJ5C,MAAOA,GAqBR,SAAS4oC,KACZ,OAAO,SAAC/L,EAAmDC,GACvDD,EArHG,CACH/9B,KAAM7B,EAAWiD,qBAsHjB,IAlHaW,EAkHP4iB,EAA+B,CACjC7gB,GAAI,CACAtB,MAAO,GACP2D,YAAa,KACb1D,UAAW1F,EAAU8I,MACrBnE,gBAAiBkc,GAAWuH,cAAc,IAAI,IAElD/lB,KAAM,CACFoD,MAAO,GACP2D,YAAa,KACb1D,UAAW1F,EAAU8I,MACrBnE,gBAAiBkc,GAAWwH,gBAAgB,IAAI,IAEpDriB,QAAS,CACLP,MAAO,GACP2D,YAAa,KACb1D,UAAW1F,EAAU8I,MACrBnE,gBAAiBkc,GAAW0tB,mBAAmB,IAAI,IAEvDloC,QAAS,CACLZ,MAAO,GACP2D,YAAa,KACb1D,UAAW1F,EAAU8I,MACrBnE,gBAAiBkc,GAAW2tB,mBAAmB,IAAI,IAEvD9nC,kBAAmB,CACfjB,MAAO,GACP2D,YAAa,KACb1D,UAAW1F,EAAU8I,MACrBnE,gBAAiBkc,GAAW4tB,6BAA6B,IAAI,IAEjEnnC,YAAa,CACT7B,MAAO,GACP2D,YAAa,KACb1D,UAAW1F,EAAU8I,MACrBnE,gBAAiBkc,GAAWyH,uBAAuB,IAAI,IAE3D3gB,UAAW,CACPlC,OAAO,EACP2D,YAAa,KACb1D,UAAW1F,EAAU8I,MACrBnE,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,QAI7Bk8B,GAjKah8B,EAiKQ4iB,EAhKlB,CACH3kB,KAAM7B,EAAWqD,qBACjBO,gBAAiBA,KA+JjBg8B,EAAS0N,OAIV,SAASC,KACZ,OAAO,SAAC3N,EAAmDC,GACvD,IAAMl+B,EAAQk+B,IAOd,GAAKl+B,EAAMI,MAAMC,WAAWC,UAA5B,CAUA29B,EApNG,CACH/9B,KAAM7B,EAAWwtC,qBAiMqE,IAAAC,EA0BlF9rC,EALA4M,KAAQG,cAAiBC,EArByD8+B,EAqBzD9+B,MAAOzE,EArBkDujC,EAqBlDvjC,SAEDtG,EAG/BjC,EAJAI,MACIC,WAAcC,UAAa2B,gBAExB8L,EACP/N,EADA6N,IAAOE,OAGLs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGxC/N,EAQLooC,EAAUuB,OAAO3pC,EAAiBsG,GAC7BiI,KAAK,SAACmO,GACHsf,EAxOT,SAAqBtf,GACxB,MAAO,CACHze,KAAM7B,EAAWwC,qBACjB4E,aAAckZ,GAqOG1d,CAAY0d,MAExB0Z,MAAM,SAACj3B,GACJV,QAAQU,MAAM,eAAgBa,EAAiBb,GAI/C68B,EAAS58B,GAAU,CACf3C,KAAM0C,EAAM1C,MAAQ0C,EAAM9B,KAC1BX,QAASyC,EAAMzC,QACfotC,UAAW3qC,OAnBnB68B,EAAS58B,GAAU,CACf3C,KAAM,MACNC,QAAS,uDA3Bbs/B,EAAS58B,GAAU,CACf3C,KAAM,UACNC,QAAS,0CAgDlB,SAASgtC,KACZ,OAAO,SAAC1N,EAAmDC,GACvD,IAAMl+B,EAAQk+B,IACd,GAAKl+B,EAAMI,MAAMC,WAAWC,UAA5B,CAFsF,IAAA0rC,EAelFhsC,EAJAI,MACIC,WACIC,UAAwB2B,GAbkD+pC,EAa7DlrC,UAb6DkrC,EAalD/pC,iBAI/BA,GAKDA,EAAgB3C,KAAKsC,gBAAgB1B,OAAS/C,EAAoB0E,IAKlEI,EAAgB+B,GAAGpC,gBAAgB1B,OAAS/C,EAAoB0E,IAOhEI,EAAgBgB,QAAQrB,gBAAgB1B,OAAS/C,EAAoB0E,IAKrEI,EAAgBqB,QAAQ1B,gBAAgB1B,OAAS/C,EAAoB0E,IAKrEI,EAAgB0B,kBAAkB/B,gBAAgB1B,OAAS/C,EAAoB0E,IAK/EI,EAAgBsC,YAAY3C,gBAAgB1B,OAAS/C,EAAoB0E,GAK7Eo8B,EAlQG,CACH/9B,KAAM7B,EAAWyG,sBA6Nbm5B,EAASsN,WAfTtN,EAAS58B,GAAU,CACf3C,KAAM,UACNC,QAAS,0CAqDzB,SAASstC,GAAkBjsC,GAAmB,IAAAksC,EAGlBlsC,EADpB4M,KAAQG,cAAiBC,EAFak/B,EAEbl/B,MAAOzE,EAFM2jC,EAEN3jC,SACzBwF,EAAa/N,EAApB6N,IAAOE,OACX,OAAO,IAAIwc,GAA2B,CAClCvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAI1C,SAASm8B,GAAW7sC,GACvB,OAAO,SAAC2+B,GAAsD,IAAAmO,EAC3BtuB,GAAWwH,gBAAgBhmB,GADA+sC,EAAAvtC,OAAAwY,GAAA,EAAAxY,CAAAstC,EAAA,GACnDE,EADmDD,EAAA,GACpCjrC,EADoCirC,EAAA,GAGtDjrC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAjQL,SAAyB3+B,EAAc8B,GAC1C,MAAO,CACHlB,KAAM7B,EAAWyE,0BACjBxD,KAAMA,EACN8B,MAAOA,GA6PM2B,CAAgBupC,EAAelrC,IAExC68B,EA1QL,SAA2B3+B,GAC9B,MAAO,CACHY,KAAM7B,EAAWmE,4BACjBlD,KAAMA,GAuQOuD,CAAkBypC,IAE/BrO,EAAS0N,OAIV,SAASY,GAAcjtC,GAC1B,OAAO,SAAC2+B,GAAsD,IAlP7Bh7B,EAkP6BupC,EACxB1uB,GAAW0tB,mBAAmBlsC,GADNmtC,EAAA3tC,OAAAwY,GAAA,EAAAxY,CAAA0tC,EAAA,GACnDE,EADmDD,EAAA,GACjCrrC,EADiCqrC,EAAA,GAGtDrrC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EA/OL,SAA4Bh7B,EAAwB7B,GACvD,MAAO,CACHlB,KAAM7B,EAAW8E,8BACjBF,QAASA,EACT7B,MAAOA,GA2OMgC,CAAmBspC,EAAkBtrC,IAE9C68B,GAxPyBh7B,EAwPKypC,EAvP/B,CACHxsC,KAAM7B,EAAW2E,gCACjBC,QAASA,KAuPTg7B,EAAS0N,WAsDXgB,cAOF,SAAAA,EAAYC,EAAeC,GAAkB/tC,OAAAC,EAAA,EAAAD,CAAAE,KAAA2tC,GAAA3tC,KAL7C4tC,WAK4C,EAAA5tC,KAJ5C6tC,SAI4C,EAAA7tC,KAH5C8tC,cAG4C,EAAA9tC,KAF5C+tC,WAE4C,EACxC/tC,KAAK4tC,MAAQA,EACb5tC,KAAK6tC,IAAMA,EACX7tC,KAAK8tC,UAAW,EAChB9tC,KAAK+tC,MAAQ,KACb/tC,KAAKguC,0EAGM,IAAAvuC,EAAAO,KACPA,KAAK+tC,OACL1V,OAAO4V,aAAajuC,KAAK+tC,OAE7B/tC,KAAK+tC,MAAQ1V,OAAOC,WAAW,WAC3B74B,EAAKouC,OACN7tC,KAAK4tC,wCAIR5tC,KAAK8tC,UAAW,WAIpBI,GAAoC,KAEjC,SAASC,GAASnpC,GACrB,OAAO,SAACi6B,EAAmDC,GACvDD,EA1VD,SAAsBj6B,GACzB,MAAO,CACH9D,KAAM7B,EAAW+F,uBACjBJ,GAAIA,GAuVKK,CAAaL,IADgE,IAAAopC,EAEzDtvB,GAAWuH,cAAcrhB,GAFgCqpC,EAAAvuC,OAAAwY,GAAA,EAAAxY,CAAAsuC,EAAA,GAE/EE,EAF+ED,EAAA,GAElEjsC,EAFkEisC,EAAA,GAGtF,GAAIjsC,EAAMlB,OAAS/C,EAAoB0E,GAGnC,OAFAo8B,EAAS95B,GAAcmpC,EAAalsC,SACpC68B,EAAS0N,MALyE,IAWhErrC,EAElB49B,IAHA99B,MACIC,WAAcC,UAItB,GAAKA,EAAL,CAKA,IAAMitC,EAAkBjtC,EAAU2B,gBAAgB+B,GAAGpC,gBAAgBE,YAC/D0rC,GAAM,IAAIzrC,MAAO+S,UAEvB,GAAIy4B,EAEA,GADgBC,EAAMD,EAAgBz4B,UAFzB,IAST,YALKo4B,KACDA,GAAkB,IAAIP,GAAU,IAAK,WACjC1O,EA+Bb,SAACA,EAAmDC,GAA+B,IAAAyM,EAMlFzM,IAFkB59B,EAJgEqqC,EAGlFvqC,MACIC,WAAcC,UAGtB,GAAKA,EAAL,CAKA,IAAM0D,EAAK1D,EAAU2B,gBAAgB+B,GAZiDypC,EAczD3vB,GAAWuH,cAAcrhB,EAAGtB,OAd6BgrC,EAAA5uC,OAAAwY,GAAA,EAAAxY,CAAA2uC,EAAA,GAc/EH,EAd+EI,EAAA,GAclEtsC,EAdkEssC,EAAA,GAetF,GAAItsC,EAAMlB,OAAS/C,EAAoB0E,GAGnC,OAFAo8B,EAAS95B,GAAcmpC,EAAalsC,SACpC68B,EAAS0N,MAIb,IAAMtN,EAAQ4N,GAAkB/N,KAChCG,EAAMsP,UAAUL,GACX98B,KAAK,SAACI,GAECqtB,EADArtB,EACSzM,GAAcmpC,EAAa,CAChCptC,KAAM/C,EAAoB8H,MAC1BtG,QAAS,gCACTmD,YAAa,IAAIC,OAGZkC,GAAgBqpC,IAG7BrP,EAAS0N,eA1DbuB,IACAA,GAAgBU,SAEpBV,GAAkB,KAEJjB,GAAkB/N,KAC1ByP,UAAUL,GACX98B,KAAK,SAACI,GAECqtB,EADArtB,EACSzM,GAAcmpC,EAAa,CAChCptC,KAAM/C,EAAoB8H,MAC1BnD,YAAa,IAAIC,KACjBpD,QAAS,kCAGJsF,GAAgBqpC,IAG7BrP,EAAS0N,UA6ClB,SAASkC,GAAkBtpC,GAC9B,OAAO,SAAC05B,EAAmDC,GACzC+N,GAAkB/N,KAAhC,IADsF4P,EAGhDhwB,GAAWyH,uBAAuBhhB,GAHcwpC,EAAAjvC,OAAAwY,GAAA,EAAAxY,CAAAgvC,EAAA,GAG/EE,EAH+ED,EAAA,GAGzD3sC,EAHyD2sC,EAAA,GAKlF3sC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAxZL,SAAgC15B,EAAqBnD,GACxD,MAAO,CACHlB,KAAM7B,EAAWoG,iCACjBF,YAAaA,EACbnD,MAAOA,GAoZMsD,CAAuBspC,EAAsB5sC,IAEtD68B,EAjaL,SAAkC15B,GACrC,MAAO,CACHrE,KAAM7B,EAAWiG,mCACjBC,YAAaA,GA8ZAC,CAAyBwpC,IAEtC/P,EAAS0N,qECtGFsC,eAnlBX,SAAAA,EAAYve,GAA6B,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAivC,IACrCxvC,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAmvC,GAAA9uC,KAAAH,KAAM0wB,KAHVuS,YAEyC,EAGrCxjC,EAAKuB,MAAQ,CACTkuC,iBAAiB,EACjBC,WAAW,GAGf1vC,EAAKwjC,OAASmM,SAASpM,SAAUC,OARIxjC,4EAYrC2jC,KAAMvjC,KAAK,CACP4f,MAAO,wBACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,kFAGAA,EAAA,4GAGAA,EAAA,gGAGAA,EAAA,wBACIA,EAAA,gCAGAA,EAAA,4CACqBA,EAAA,+BADrB,sLAKAA,EAAA,gCAGAA,EAAA,wBACIA,EAAA,8KAIAA,EAAA,6EAGAA,EAAA,oWAQJA,EAAA,8BAGAA,EAAA,wBACIA,EAAA,mCACaA,EAAA,6BADb,qOAKAA,EAAA,6JAMJA,EAAA,uCAGAA,EAAA,wBACIA,EAAA,8KAGAA,EAAA,6LAWC,IAAA7f,EAAA9Q,KACrB,GAAKA,KAAKqvC,aAAV,CAUAjM,KAAMkM,QAAQ,CACV7vB,MAAO,oBACP4jB,QACI1S,EAAA,yBACIA,EAAA,kFAEAA,EAAA,6FAAsEA,EAAA,8CAAtE,KAEAA,EAAA,uBAAGA,EAAA,0DAGX4e,KAhBY,WACZz+B,EAAK0iB,SAAS,CAAE0b,iBAAiB,KAgBjCM,SAdW,aAeXC,OAAQ,MACRC,WAAY,YAvBZ1vC,KAAKwzB,SAAS,CAAE0b,iBAAiB,qCA2BhC7I,GACLA,EAAEwB,iBACF7nC,KAAK0wB,MAAMif,8CAGFtJ,GACTA,EAAEuJ,UACF5vC,KAAK0wB,MAAMmf,aAAaxJ,EAAElS,OAAOzwB,mDAGjB2iC,GAChBA,EAAEuJ,UACF5vC,KAAK0wB,MAAMof,oBAAoBzJ,EAAElS,OAAOzwB,0CAGjC2iC,GACPA,EAAEuJ,UACF5vC,KAAK0wB,MAAMqf,WAAW1J,EAAElS,OAAOzwB,+CAGnB2iC,GACZA,EAAEuJ,UACF5vC,KAAK0wB,MAAMsf,gBAAgB3J,EAAElS,OAAOzwB,+CAGxB2iC,GACZA,EAAEuJ,UACF5vC,KAAK0wB,MAAMuf,gBAAgB5J,EAAElS,OAAOzwB,yDAGd2iC,GACtBA,EAAEuJ,UACF5vC,KAAK0wB,MAAMwf,0BAA0B7J,EAAElS,OAAOzwB,iDAGhC2iC,GACdrmC,KAAK0wB,MAAMyf,kBAAkB9J,EAAElS,OAAOic,2CAItC,OACIpwC,KAAK0wB,MAAM5uB,YAAc5D,EAAUuF,QACnCzD,KAAK0wB,MAAM9tB,gBAAgB1B,OAAS/C,EAAoB0E,KACvD7C,KAAK0wB,MAAMlvB,YAAcpD,EAAU4E,KAChChD,KAAK0wB,MAAMlvB,YAAcpD,EAAU0Q,OACnC9O,KAAK0wB,MAAMlvB,YAAcpD,EAAU4D,4CAK3C,OACIhC,KAAK0wB,MAAM5uB,YAAc5D,EAAUuF,QACnCzD,KAAK0wB,MAAMlvB,YAAcpD,EAAU4E,2CAI5BqtC,GACX,OAAQA,EAAMztC,gBAAgB1B,MAG1B,KAAM/C,EAAoB8H,MAE1B,KAAM9H,EAAoBohB,iBACtB,MAAO,mBAGf,OAAQ8wB,EAAM1sC,WACV,KAAM1F,EAAU2F,MACZ,MAAO,aACX,QACI,MAAO,0DAIFysC,GACb,OAAIA,EAAMztC,gBAAgB1B,OAAS/C,EAAoB0E,GAS5C,GARHwtC,EAAM1sC,YAAc1F,EAAU2F,MAE1B+sB,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,QACjB4e,EAAMztC,gBAAgBjD,cAHnC,yCAaJ,OACIgxB,EAAA,sBAAM3rB,GAAG,sBAAsB2uB,UAAU,yBAAyB0U,SAAUroC,KAAKqoC,SAAS/T,KAAKt0B,OAC3F2wB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKkB,MAAO,CAAEye,KAAM,YAChB3f,EAAA,sDAGRA,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qCAKRA,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yCACXhD,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,4EAAf,SAIJkR,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMztB,gBAAgB3C,KAAKoD,OAAS,GACnDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMztB,gBAAgB3C,MAC1DioC,SAAUvoC,KAAKywC,aAAanc,KAAKt0B,QACpCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMztB,gBAAgB3C,QAG1DqwB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,gCACV3zB,KAAK0wB,MAAMztB,gBAAgB3C,KAAKoD,OAAS,MAMtDitB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yCAAf,MAGAhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMztB,gBAAgB+B,GAAGtB,OAAS,GACjDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMztB,gBAAgB+B,IAC1DujC,SAAUvoC,KAAK2wC,WAAWrc,KAAKt0B,QAClCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMztB,gBAAgB+B,MAG1D2rB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,8BACXhD,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,WAAazxB,KAAKijC,OAAxC,UACCjjC,KAAK0wB,MAAMztB,gBAAgB+B,GAAGtB,OAAUitB,EAAA,sBAAMkB,MAAO,CAAE+e,UAAW,WAA1B,2BAMrDjgB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yCAAf,YAGAhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMztB,gBAAgBgB,QAAQP,OAAS,GACtDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMztB,gBAAgBgB,SAC1DskC,SAAUvoC,KAAK6wC,gBAAgBvc,KAAKt0B,QACvCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMztB,gBAAgBgB,WAG1D0sB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,gCACV3zB,KAAK8wC,uBAMlBngB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yCAAf,iBAGAhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMztB,gBAAgBqB,QAAQZ,OAAS,GACtDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMztB,gBAAgBqB,SAC1DikC,SAAUvoC,KAAK+wC,gBAAgBzc,KAAKt0B,QACvCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMztB,gBAAgBqB,WAG1DqsB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,8BACXhD,EAAA,mBAAGuD,KAAMl0B,KAAK0wB,MAAMztB,gBAAgBqB,QAAQZ,OAAS,GAAIywB,OAAO,UAAUn0B,KAAK0wB,MAAMztB,gBAAgBqB,QAAQZ,OAAS,OAOlIitB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yCAAf,eAGAhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAACuZ,GAAA,EAAD,CACIkG,QAASpwC,KAAK0wB,MAAMztB,gBAAgB2C,UAAUlC,MAC9CiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMztB,gBAAgB2C,WAC1D2iC,SAAUvoC,KAAKgxC,kBAAkB1c,KAAKt0B,QACzCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMztB,gBAAgB2C,aAG1D+qB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,qCACV3zB,KAAKixC,gBAAgBjxC,KAAK0wB,MAAMztB,gBAAgB2C,UAAUlC,UAOvEitB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yCAAf,sBAGAhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAACugB,GAAAl/B,EAAD,CAAUtO,MAAO1D,KAAK0wB,MAAMztB,gBAAgB0B,kBAAkBjB,OAAS,GACnEiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMztB,gBAAgB0B,mBAAqB,6CAC/EwsC,SAAU,CAAEC,QAAS,EAAGC,QAAS,GACjC9I,SAAUvoC,KAAKsxC,0BAA0Bhd,KAAKt0B,QACjDA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMztB,gBAAgB0B,qBAG1DgsB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,6CACV3zB,KAAK0wB,MAAMztB,gBAAgB0B,kBAAkBjB,OAAS,MAMnEitB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,0CAEfhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAACugB,GAAAl/B,EAAD,CAAUtO,MAAO1D,KAAK0wB,MAAMztB,gBAAgBsC,YAAY7B,OAAS,GAC7DiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMztB,gBAAgBsC,aAAe,uCACzE4rC,SAAU,CAAEC,QAAS,EAAGC,QAAS,IACjC9I,SAAUvoC,KAAKuxC,oBAAoBjd,KAAKt0B,QAC3CA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMztB,gBAAgBsC,eAG1DorB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,sCACX6d,wBAA0B,CAAEC,OAAQC,UAAOC,MAAM3xC,KAAK0wB,MAAMztB,gBAAgBsC,YAAY7B,OAAS,yCASlHqtB,EAAkBC,GAErB,IAAMC,EAAKF,EAASG,WAAWF,GAC/B,GAAIC,GAAM,OAAUA,GAAM,OAAUF,EAAS7jB,OAAS8jB,EAAW,EAAG,CAChE,IAAMG,EAAKJ,EAASG,WAAWF,EAAW,GAC1C,GAAIG,EAAK,OAAUA,GAAM,MACrB,OAAOJ,EAASK,UAAUJ,EAAU,GAG5C,OAAOD,EAASK,UAAUJ,EAAU,sCAG7BrR,GACP,OACIgR,EAAA,cAAC4R,GAAD,CAASt+B,QAAS,KAAM6sB,KAAM,GAAIS,iBAAkB5R,EAAIrf,KAAKoD,MAAO0V,eAAgBuG,EAAI3a,GAAGtB,gDAInFkC,GACZ,OAAIA,EAEI+qB,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAU,IADzB,WAMJyvB,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAY,IAD3B,sDAOJ,IAAMlB,KAAK0wB,MAAMztB,gBAAgB3C,KAAKoD,QAAS1D,KAAK0wB,MAAMztB,gBAAgB+B,GAAGtB,MACzE,OACIitB,EAAA,2GAKR,IAAMU,EAAUrxB,KAAKsxB,OAAOtxB,KAAK0wB,MAAMztB,gBAAgB3C,KAAKoD,MAAO,GAAG8tB,cAMhEC,EAJOC,KAAI1xB,KAAK0wB,MAAMztB,gBAAgB+B,GAAGtB,OAI5BiuB,OAAO,EAAG,GAC7B,OACIhB,EAAA,qBAAKE,MAJI,GAISe,OAJT,GAIuBC,MAAO,CAAEC,OAAQ,uCAC7CnB,EAAA,sBAAMoB,EAAE,MAAMC,EAAE,MAAMC,GAAI,EAAGC,WAAW,SAASC,iBAAiB,SAASC,SAAUtB,GAAWuB,KAAM,IAAMZ,EAAOa,WAAW,cAAcjB,gDAMpJ,OAAKrxB,KAAK0wB,MAAMztB,gBAAgBgB,QAAQP,MAIpCitB,EAAA,qBAAKC,IAAK5wB,KAAK0wB,MAAMztB,gBAAgBgB,QAAQP,MAAOmtB,MAAO,KAHpD7wB,KAAK4xC,0DAQN,IAAAC,EACwC7xC,KAAK0wB,MACjD0W,EAAQ,SAFJyK,EACF/vC,UAC6B,YAF3B+vC,EACSjvC,gBACkD,WAF3DivC,EAC0BrwC,UAEpC,OACImvB,EAAA,sBAAMkB,MAAO,CAAEuU,YAAa,SAAWgB,yCAK3CpnC,KAAKwzB,SAAS,CAAE2b,WAAYnvC,KAAKgB,MAAMmuC,mDAIvC,IACI2C,EADEC,EAAU/xC,KAAK0wB,MAAMztB,gBAAiB3C,KAAKoD,OAAUitB,EAAA,sBAAMkB,MAAO,CAAE+e,UAAW,SAAUnf,MAAO,SAA3C,0DAEvDzxB,KAAK0wB,MAAMtuB,QACX0vC,EACInhB,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,cAAcvyB,KAAK,SAASkzB,QAASp0B,KAAKgyC,YAAY1d,KAAKt0B,SAG/F,IAAMimC,EACFtV,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,0BAEIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBACV,IAHL,qBAKa6wC,EALb,MAUFzL,EACF3V,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OACTmV,KAAK,sBACL13B,IAAI,SACJw3B,UAAW1oC,KAAKiyC,QAAQ9xC,KAAKH,MAC7B6oC,SAAS,UAJb,QAUAlY,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,OAAOW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,QAChE8xC,GAGT,OACInhB,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,EAAaK,QAASA,kDAK/C,IAAML,EACFtV,EAAA,uDAIJ,OACIA,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,0CAIf,IAAAtzB,EAAA3S,KACV,GAAIA,KAAK0wB,MAAMtuB,OAASpC,KAAKgB,MAAMmuC,UAAW,CAC1C,IAMI/uC,EAgBJ,OAfIJ,KAAK0wB,MAAMtuB,MAAMhC,QACjBA,EAAQJ,KAAK0wB,MAAMtuB,MAAMhC,MAAMiJ,IAAI,SAAC6oC,EAAM9M,GACtC,OACIzU,EAAA,qBAAKzf,IAAK,QAAUk0B,GAAQ8M,MAIpC9xC,IACAA,EACIuwB,EAAA,yBACIA,EAAA,kCACCvwB,IAKTuwB,EAAA,cAACwhB,GAAA,EAAD,CAAOC,SAAS,EACZ3yB,MAAM,QACN4yB,OAAO,SACP5C,OAAO,QACPC,WAAW,cACXF,SAzBS,WACb78B,EAAK6gB,SAAS,CAAE2b,WAAW,KAyBvBI,KA7BK,WACT58B,EAAK6gB,SAAS,CAAE2b,WAAW,MA6BvBxe,EAAA,qBAAKkB,MAAO,CAAEkR,WAAY,SACrB/iC,KAAK0wB,MAAMtuB,MAAM1C,MAEtBixB,EAAA,yBACK3wB,KAAK0wB,MAAMtuB,MAAMzC,SAErBS,gDAQb,IAAI0xC,EAOJ,OANI9xC,KAAK0wB,MAAMtuB,QACX0vC,EACInhB,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,cAAcvyB,KAAK,SAASkzB,QAASp0B,KAAKgyC,YAAY1d,KAAKt0B,SAK3F2wB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OACTmV,KAAK,sBACL13B,IAAI,SACJw3B,UAAW1oC,KAAKiyC,QAAQ9xC,KAAKH,MAC7B6oC,SAAS,UAJb,QAOAlY,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,OAAOW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,QAChE8xC,oCAMT,OAAI9xC,KAAKgB,MAAMkuC,gBACJve,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAG,mBAIzB3jC,KAAK0wB,MAAMlvB,YAAcpD,EAAU4D,MAC5B2uB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMztB,gBAAgB+B,GAAGtB,QAG9E1D,KAAK0wB,MAAMztB,gBASZ0tB,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACga,GAAD,CAAUrE,QAAStmC,KAAK4qC,sBAEvB5qC,KAAKuyC,eACLvyC,KAAKosC,eAXNzb,EAAA,qBAAKgD,UAAU,mBACV3zB,KAAKwyC,8BAvkBI9f,aC6CfkO,mBAlDR,SAAyB5/B,GAC5B,IAAKA,EAAMI,MAAMC,WAAWC,UACxB,MAAM,IAAIf,MAAM,+BAFuC,IAAAysC,EAUvDhsC,EALAI,MACIC,WACIC,UAKZ,MAAO,CACHQ,UAbuDkrC,EAOlClrC,UAOrBN,UAduDwrC,EAOvBxrC,UAQhCoB,gBAfuDoqC,EAOZpqC,gBAS3CK,gBAhBuD+pC,EAOK/pC,gBAU5Db,MAjBuD4qC,EAOsB5qC,QAc9E,SAA4B68B,GAC/B,MAAO,CACH0Q,OAAQ,WACJ1Q,EAAS2N,OAEbiD,aAAc,SAACvvC,GACX2+B,EAASkO,GAAW7sC,KAExB0vC,gBAAiB,SAAC/rC,GACdg7B,EAASsO,GAActpC,KAE3B8rC,WAAY,SAAC/qC,GACTi6B,EAASkP,GAASnpC,KAEtB8qC,oBAAqB,SAACvqC,GAClB05B,EAAS4P,GAAkBtpC,KAE/B4qC,kBAAmB,SAACvqC,GAChBq5B,EFkgBL,SAAyBr5B,GAC5B,OAAO,SAACq5B,GAGJA,EAAS,CACL/9B,KAAM7B,EAAWsG,kCACjBC,cAEJq5B,EAAS0N,OE1gBI8F,CAAgB7sC,KAE7BqqC,gBAAiB,SAAC3rC,GACd26B,EFydL,SAAuB36B,GAC1B,OAAO,SAAC26B,GAAsD,IAAAyT,EACxB5zB,GAAW2tB,mBAAmBnoC,GADNquC,EAAA7yC,OAAAwY,GAAA,EAAAxY,CAAA4yC,EAAA,GACnDE,EADmDD,EAAA,GACjCvwC,EADiCuwC,EAAA,GAGtDvwC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAAS,CACL/9B,KAAM7B,EAAWmF,8BACjBF,QAASA,EACTlC,MAAOA,IAGX68B,EAAS,CACL/9B,KAAM7B,EAAWgF,gCACjBC,QAASsuC,KEteJC,CAAcvuC,KAE3B4rC,0BAA2B,SAACvrC,GACxBs6B,EFyeL,SAAiCt6B,GACpC,OAAO,SAACs6B,GAAsD,IAAA6T,EACdh0B,GAAW2tB,mBAAmB9nC,GADhBouC,EAAAjzC,OAAAwY,GAAA,EAAAxY,CAAAgzC,EAAA,GACnDE,EADmDD,EAAA,GACvB3wC,EADuB2wC,EAAA,GAGtD3wC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAAS,CACL/9B,KAAM7B,EAAWwF,wCACjBF,kBAAmBquC,EACnB5wC,MAAOA,IAGX68B,EAAS,CACL/9B,KAAM7B,EAAWqF,0CACjBC,kBAAmBquC,KEtfdC,CAAwBtuC,OAK9Bi8B,CAA8FsS,IClEvGzS,uBACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,iFAIN,OACIC,EAAA,uGAMIvuB,GACR,OACIuuB,EAAA,kCAEIA,EAAA,yBACKvuB,EAAMzC,2CAOnB,OAAQK,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KAE3B,KAAKzE,EAAsB2D,QACvB,OAAOxC,KAAKmsC,gBAChB,KAAKttC,EAAsBoH,MACvB,OAAIjG,KAAK0wB,MAAM6C,KAAKnxB,MACTpC,KAAKosC,YAAYpsC,KAAK0wB,MAAM6C,KAAKnxB,OAEjCpC,KAAKosC,YAAY,CACpB1sC,KAAM,gBACNC,QAAS,oCAGrB,KAAKd,EAAsB8D,QAC3B,QACI,OACIguB,EAAA,cAACwiB,GAAD,mDAMZ,OAAQnzC,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KAEvBtD,KAAK0wB,MAAMiQ,yDAMnB3gC,KAAK0wB,MAAM4b,kBAzDE5Z,cAkGNkO,mBAjBf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACH6C,KAAMvyB,EAAMI,MAAMC,aAI1B,SAA4B49B,GACxB,MAAO,CACH0B,OAAQ,WACJ1B,EAAS4B,OAEbyL,SAAU,WACNrN,EHoID,CACH/9B,KAAM7B,EAAWgE,oBGhIVu9B,CAA8FH,IC7FhG2S,GAAb,WAII,SAAAA,EAAY99B,GAA0BxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAozC,GAAApzC,KAFtCsV,YAEqC,EACjCtV,KAAKsV,OAASA,EALtB,OAAAxV,OAAAmR,EAAA,EAAAnR,CAAAszC,EAAA,EAAAliC,IAAA,yBAAAxN,MAAA,eAAA2vC,EAAAvzC,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EAQiCkH,GARjC,IAAAiyB,EAAAzO,EAAAn2B,EAAAgJ,EAAAwM,EAAAxR,EAAAE,EAAA,OAAAoH,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAcc+4B,EAAY,IAAI9f,GAA2B,CAC7Cvd,MAAOhO,KAAKsV,OAAOtH,MAAOzE,SAAUvJ,KAAKsV,OAAO/L,SAChDiR,iBAAkBxa,KAAKsV,OAAOkF,mBAG5BoiB,EAAgB,IAAIjX,GAA2B,CACjD3X,MAAOhO,KAAKsV,OAAOtH,MAAOzE,SAAUvJ,KAAKsV,OAAO/L,SAChDiR,iBAAkBxa,KAAKsV,OAAOkF,mBArB1CpI,EAAAE,KAAA,EAyBmC+4B,EAAU/mB,OAAOlL,GAzBpD,cAyBc3S,EAzBd2L,EAAA2B,KAAA3B,EAAAE,KAAA,EA4B8BsqB,EAAc0W,qBAAqBl6B,GA5BjE,cA4Bc3J,EA5Bd2C,EAAA2B,KAAA3B,EAAAE,KAAA,GA8BiCsqB,EAAc2W,wBAAwBn6B,GA9BvE,WA8Bc6C,EA9Bd7J,EAAA2B,MAmCctJ,EAAW8gB,GAA2B9kB,EAAczG,KAAKsV,OAAO/L,SAAUkG,EAASwM,IAG5E/a,OAASqqB,GAAoC9hB,OACtDgB,EAASvJ,OAASqqB,GAAoCvL,MAvClE,CAAA5N,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GAwCkCsqB,EAAc4W,qCAAqCp6B,GAxCrF,QAwCYzO,EAxCZyH,EAAA2B,KAAA3B,EAAAE,KAAA,iBA0CY3H,EAAgB,KA1C5B,eAAAyH,EAAAG,OAAA,SA6Ce,CACH9L,eAAcgJ,UAASwM,aAAYxR,WAAUE,kBA9CzD,yBAAAyH,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,GAAA,OAAAo/B,EAAA5gC,MAAAzS,KAAA0S,YAAA,MAAA0gC,EAAA,GCKO,SAASpI,KACZ,sBAAAxrC,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,OAAAntB,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OACH2sB,EAAS,CACL/9B,KAAM7B,EAAWo0C,0BAGrBxU,EAAS,CACL/9B,KAAM7B,EAAWowB,4BANlB,wBAAArd,EAAAI,SAAAN,EAAAlS,SAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GCkJG,SAASlH,GAAuBF,GACnC,MAAO,CACHpK,KAAM7B,EAAW8L,kCACjBG,UAAWA,GAIZ,SAASooC,GAAqBtxC,GACjC,MAAO,CACHlB,KAAM7B,EAAWs0C,gCACjBvxC,MAAOA,GAyFR,SAASsJ,GAAuBjF,GACnC,MAAO,CACHvF,KAAM7B,EAAWoM,kCACjBhF,aAAcA,GAIf,SAASmtC,GAAqBxxC,GACjC,MAAO,CACHlB,KAAM7B,EAAWw0C,gCACjBzxC,MAAOA,GAgGR,SAASyI,GACZpE,EACAgE,EACAC,EACAC,EACAC,EACA5B,EACAoB,EACA2kB,GACA,MAAO,CACH7tB,KAAM7B,EAAWmL,6BACjB/D,eAAcgE,WAAUC,cACxBC,gBAAeC,mBACf5B,eAAcoB,gBAAe2kB,iBAqC9B,SAAS+kB,GAAwB1xC,GACpC,MAAO,CACHlB,KAAM7B,EAAW00C,4BACjB3xC,MAAOA,GA2BR,SAAS4xC,KACZ,MAAO,CACH9yC,KAAM7B,EAAW40C,uCAkFlB,SAASjJ,GAAK5xB,GACjB,sBAAAxC,EAAA9W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAgD,EAAOgqB,EAAmDC,GAA1D,IAAAyM,EAAAC,EAAA59B,EAAAzE,EAAAwF,EAAAmlC,EAAAC,EAAAvX,EAAAyO,EAAAx0B,EAAAu9B,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAA5iC,GAAAC,EAAAG,KAAA,SAAAgD,GAAA,cAAAA,EAAA9C,KAAA8C,EAAA7C,MAAA,cACH2sB,EA5LG,CACH/9B,KAAM7B,EAAWiL,sBA0LdqhC,EAOCzM,IAPD0M,EAAAD,EAIC/9B,KAAQG,cAAiBC,EAJ1B49B,EAI0B59B,MAAOzE,EAJjCqiC,EAIiCriC,SACzBwF,EALR48B,EAKC98B,IAAOE,OALRmlC,EAAAvI,EAMC1c,GAAMF,cANPmlB,EAMwBrhC,IANxBqhC,EAM6BrmB,KAG1BsmB,EAAa,IAAIS,GAAoB,CACvC5mC,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,IACzCgsB,iBAAkBjuB,EAAO0wB,SAASa,cAActvB,IAChDulB,sBAAuBxnB,EAAO0wB,SAASC,YAAY1uB,IACnDwtB,oBAAqBzvB,EAAO0wB,SAASW,UAAUpvB,MAG7C4rB,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGvCq6B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAxB1CmE,EAAA9C,KAAA,EAAA8C,EAAA7C,KAAA,EA4B0C6hC,EAAWU,uBAAuBz7B,GA5B5E,UAAAvC,EAAA1B,EAAApB,KA4BStN,EA5BToQ,EA4BSpQ,aAAcgE,EA5BvBoM,EA4BuBpM,SAClBhE,EAAaqC,OAASyiB,GAA0BxiB,OA7BrD,CAAAoM,EAAA7C,KAAA,gBAAA6C,EAAA7C,KAAA,GA+BgCsqB,EAAckY,sBAAsB17B,GA/BpE,eA+BWpQ,EA/BXmM,EAAApB,KAgCKkrB,GAnLZx4B,EAmLoDA,EAlLpDgE,EAkLkEA,EAjLlEL,EAiL4EpB,EAhLrE,CACH9H,KAAM7B,EAAWyL,2CACjBrE,eAAcgE,WACdL,mBA6IG+K,EAAA5C,OAAA,qBAuCK9H,EAASvJ,OAASqqB,GAAoCvL,OACtDvV,EAASvJ,OAASqqB,GAAoC9hB,MAxC3D,CAAA0L,EAAA7C,KAAA,gBAAA6C,EAAA7C,KAAA,GAyCyBsqB,EAAc4W,qCAAqCp6B,GAzC5E,eAyCKo7B,EAzCLr/B,EAAApB,KAAAoB,EAAA7C,KAAA,GA0C4BsqB,EAAcmY,iCAAiC37B,GA1C3E,eA0CKq7B,EA1CLt/B,EAAApB,KAAAoB,EAAA7C,KAAA,GA2CyB+4B,EAAU2J,qBAAqB,CAAE57B,mBA3C1D,QA2CK1O,EA3CLyK,EAAApB,KAAAoB,EAAA7C,KAAA,iBA6CKkiC,EAAc,KACdC,EAAiB,KACjB/pC,EAAc6gB,GAAuBsX,aA/C1C,eAAA1tB,EAAA7C,KAAA,GAkDyDsqB,EAAcqY,8BAA8B77B,GAlDrG,eAkDOpQ,EAlDPmM,EAAApB,KAAAoB,EAAA7C,KAAA,GAmD0DsqB,EAAcsY,uBAAuB97B,GAnD/F,QAmDOhP,EAnDP+K,EAAApB,KAqDCkrB,EAASp0B,GAAkBpE,EAAcgE,EAAUC,EAAa8pC,EAAaC,EAAgBzrC,EAAcoB,EAAe,KArD3H+K,EAAA7C,KAAA,iBAAA6C,EAAA9C,KAAA,GAAA8C,EAAAnB,GAAAmB,EAAA,SAuDC8pB,GA/Lc78B,EA+LK,CACf1C,KAAMyV,EAAAnB,GAAG1T,KACTX,QAASwV,EAAAnB,GAAGrU,SAhMjB,CACHuB,KAAM7B,EAAW4L,oBACjB7I,MAAOA,KAqIJ,yBAAA+S,EAAA3C,OAxIJ,IAAmBpQ,EAXtBqE,EACAgE,EACAL,GAiJO6K,EAAAjV,KAAA,aAAP,gBAAAyW,EAAAe,GAAA,OAAAZ,EAAAnE,MAAAzS,KAAA0S,YAAA,GA+DG,SAASyiC,KACZ,sBAAAr+B,EAAAhX,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAiE,EAAO+oB,EAAmDC,GAA1D,IAAAl+B,EAAAo0C,EAAApnC,EAAAzE,EAAAwF,EAAAtI,EAAA4kC,EAAA,OAAAt5B,GAAAC,EAAAG,KAAA,SAAAkE,GAAA,cAAAA,EAAAhE,KAAAgE,EAAA/D,MAAA,WAEGtR,EAAQk+B,KACH99B,MAAMyH,YAAYvH,UAH1B,CAAA+U,EAAA/D,KAAA,eAIC2sB,EAAS6U,GAAwB,CAC7B5yC,KAAMlD,EAAYiI,MAClBtG,QAAS,qBANd0W,EAAA9D,OAAA,wBAAA6iC,EAiBCp0C,EALA4M,KAAQG,cAAiBC,EAZ1BonC,EAY0BpnC,MAAOzE,EAZjC6rC,EAYiC7rC,SACzBwF,EAIP/N,EAJA6N,IAAOE,OAEyBtI,EAEhCzF,EAHAI,MACIyH,YAAevH,UAAamF,aAI9B4kC,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MArB1CqF,EAAAhE,KAAA,EAAAgE,EAAA/D,KAAA,EAyBO+4B,EAAUxkB,kBAAkBpgB,EAAazB,IAzBhD,OA0BCi6B,EAlND,CACH/9B,KAAM7B,EAAWg2C,gCAkNbpW,EAAS+L,GAAMvkC,EAAazB,KA3B7BqR,EAAA/D,KAAA,iBAAA+D,EAAAhE,KAAA,GAAAgE,EAAArC,GAAAqC,EAAA,SA6BC4oB,EAAS6U,GAAwB,CAC7B5yC,KAAMlD,EAAYiI,MAClBtG,QAAS0W,EAAArC,GAAGrU,WA/BjB,yBAAA0W,EAAA7D,SAAA0D,EAAAlW,KAAA,aAAP,gBAAAwY,EAAAwE,GAAA,OAAAlG,EAAArE,MAAAzS,KAAA0S,YAAA,GAqCG,SAAS4iC,GAAyBpgC,GACrC,sBAAA6B,EAAAjX,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAoF,EAAO4nB,EAAmDC,GAA1D,IAAAl+B,EAAAu0C,EAAAvnC,EAAAzE,EAAAwF,EAAA6tB,EAAA4Y,EAAA,OAAAzjC,GAAAC,EAAAG,KAAA,SAAAoF,GAAA,cAAAA,EAAAlF,KAAAkF,EAAAjF,MAAA,UACH2sB,EArOG,CACH/9B,KAAM7B,EAAWo2C,+BAsOXz0C,EAAQk+B,KACH99B,MAAMyH,YAAYvH,UAJ1B,CAAAiW,EAAAjF,KAAA,eAKC2sB,EAAS6U,GAAwB,CAC7B5yC,KAAMlD,EAAYiI,MAClBtG,QAAS,qBAPd4X,EAAAhF,OAAA,wBAAAgjC,EAiB6Cv0C,EAJ5C4M,KAAQG,cAAiBC,EAb1BunC,EAa0BvnC,MAAOzE,EAbjCgsC,EAaiChsC,SACzBwF,EAGqC/N,EAH5C6N,IAAOE,OAGqC/N,EAF5CI,MACIyH,YACIvH,UAAamF,aAEnBm2B,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MArB1CuG,EAAAlF,KAAA,EAAAkF,EAAAjF,KAAA,GAyB0BsqB,EAAcxf,cAAclI,GAzBtD,QAyBOsgC,EAzBPj+B,EAAAxD,KA0BCkrB,EAnOD,CACH/9B,KAAM7B,EAAW8K,uCAmOb80B,EAAS+L,GAAKwK,EAAWp8B,iBA3B1B7B,EAAAjF,KAAA,iBAAAiF,EAAAlF,KAAA,GAAAkF,EAAAvD,GAAAuD,EAAA,SA6BC0nB,GAjOkC78B,EAiOK,CACnClB,KAAMlD,EAAYiI,MAClBtG,QAAS4X,EAAAvD,GAAGrU,SAlOjB,CACHuB,KAAM7B,EAAWq2C,mCACjBtzC,MAAOA,KAiMJ,yBAAAmV,EAAA/E,OApMJ,IAAuCpQ,GAoMnCiV,EAAArX,KAAA,aAAP,gBAAAqd,EAAAK,GAAA,OAAA3G,EAAAtE,MAAAzS,KAAA0S,YAAA,GAqCG,SAASijC,GAAqBzgC,GACjC,sBAAA8B,EAAAlX,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAyF,EAAOunB,EAAmDC,GAA1D,IAAAl+B,EAAA40C,EAAA5nC,EAAAzE,EAAAwF,EAAA6tB,EAAA4Y,EAAA,OAAAzjC,GAAAC,EAAAG,KAAA,SAAAiG,GAAA,cAAAA,EAAA/F,KAAA+F,EAAA9F,MAAA,UACH2sB,EAAS+U,OAEHhzC,EAAQk+B,KACH99B,MAAMyH,YAAYvH,UAJ1B,CAAA8W,EAAA9F,KAAA,eAKC2sB,EAAS6U,GAAwB,CAC7B5yC,KAAMlD,EAAYiI,MAClBtG,QAAS,qBAPdyY,EAAA7F,OAAA,wBAAAqjC,EAiB6C50C,EAJ5C4M,KAAQG,cAAiBC,EAb1B4nC,EAa0B5nC,MAAOzE,EAbjCqsC,EAaiCrsC,SACzBwF,EAGqC/N,EAH5C6N,IAAOE,OAGqC/N,EAF5CI,MACIyH,YACIvH,UAAamF,aAEnBm2B,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MArB1CoH,EAAA/F,KAAA,EAAA+F,EAAA9F,KAAA,GAyB0BsqB,EAAc+Y,qBAAqBzgC,GAzB7D,QAyBOsgC,EAzBPp9B,EAAArE,KA0BCkrB,EApPD,CACH/9B,KAAM7B,EAAWw2C,0CAqPb5W,EAAS+L,GAAKwK,EAAWp8B,iBA5B1BhB,EAAA9F,KAAA,iBAAA8F,EAAA/F,KAAA,GAAA+F,EAAApE,GAAAoE,EAAA,SA8BC6mB,GAnP8B78B,EAmPK,CAC/B1C,KAAM0Y,EAAApE,GAAG1T,KACTX,QAASyY,EAAApE,GAAGrU,SApPjB,CACHuB,KAAM7B,EAAWy2C,sCACjB1zC,MAAOA,KAkNJ,yBAAAgW,EAAA5F,OArNJ,IAAmCpQ,GAqN/BsV,EAAA1X,KAAA,aAAP,gBAAA+d,EAAAI,GAAA,OAAAnH,EAAAvE,MAAAzS,KAAA0S,YAAA,GAwCG,SAASqjC,GAAqB7gC,GACjC,sBAAAgC,EAAApX,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAA0J,EAAOsjB,EAAmDC,GAA1D,IAAAl+B,EAAAg1C,EAAAhoC,EAAAzE,EAAAwF,EAAA6tB,EAAA4Y,EAAA,OAAAzjC,GAAAC,EAAAG,KAAA,SAAAyJ,GAAA,cAAAA,EAAAvJ,KAAAuJ,EAAAtJ,MAAA,UACH2sB,EAAS+U,OAEHhzC,EAAQk+B,KACH99B,MAAMyH,YAAYvH,UAJ1B,CAAAsa,EAAAtJ,KAAA,eAKC2sB,EAAS6U,GAAwB,CAC7B5yC,KAAMlD,EAAYiI,MAClBtG,QAAS,qBAPdic,EAAArJ,OAAA,wBAAAyjC,EAiB6Ch1C,EAJ5C4M,KAAQG,cAAiBC,EAb1BgoC,EAa0BhoC,MAAOzE,EAbjCysC,EAaiCzsC,SACzBwF,EAGqC/N,EAH5C6N,IAAOE,OAGqC/N,EAF5CI,MACIyH,YACIvH,UAAamF,aAEnBm2B,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MArB1C4K,EAAAvJ,KAAA,EAAAuJ,EAAAtJ,KAAA,GAyB0BsqB,EAAcmZ,qBAAqB7gC,GAzB7D,QAyBOsgC,EAzBP55B,EAAA7H,KA0BCkrB,EAxQD,CACH/9B,KAAM7B,EAAW42C,0CAwQbhX,EAAS+L,GAAKwK,EAAWp8B,iBA3B1BwC,EAAAtJ,KAAA,iBAAAsJ,EAAAvJ,KAAA,GAAAuJ,EAAA5H,GAAA4H,EAAA,SA6BCqjB,GAtQ8B78B,EAsQK,CAC/B1C,KAAMkc,EAAA5H,GAAG1T,KACTX,QAASic,EAAA5H,GAAGrU,SAvQjB,CACHuB,KAAM7B,EAAW62C,sCACjB9zC,MAAOA,KAsOJ,yBAAAwZ,EAAApJ,OAzOJ,IAAmCpQ,GAyO/BuZ,EAAA3b,KAAA,aAAP,gBAAAue,EAAAK,GAAA,OAAA1H,EAAAzE,MAAAzS,KAAA0S,YAAA,GChrBG,SAAS+K,GAAcvI,GAC1B,sBAAA1V,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAqEC,GAA5E,IAAAl+B,EAAAM,EAAAwrC,EAAA9+B,EAAAzE,EAAAwF,EAAA6tB,EAAAuZ,EAAA,OAAApkC,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACGtR,EAAQk+B,IAII,QAFZ59B,EAAYN,EAAMI,MAAMyH,YAAYvH,WAHvC,CAAA8Q,EAAAE,KAAA,eAMC2sB,EAAS,CACL/9B,KAAM7B,EAAW+2C,oCACjBh0C,MAAO,CACH1C,KAAM,QACNC,QAAS,mBAVlByS,EAAAG,OAAA,oBAiBCjR,EAAUwH,OAAS3J,EAAqB4J,OAjBzC,CAAAqJ,EAAAE,KAAA,eAkBC2sB,EAAS,CACL/9B,KAAM7B,EAAW+2C,oCACjBh0C,MAAO,CACH1C,KAAM,gBACNC,QAAS,sCAtBlByS,EAAAG,OAAA,wBA4BH0sB,EAAS,CACL/9B,KAAM7B,EAAWg3C,sCA7BlBvJ,EAmCC9rC,EAFA4M,KAAQG,cAAiBC,EAjC1B8+B,EAiC0B9+B,MAAOzE,EAjCjCujC,EAiCiCvjC,SACzBwF,EACP/N,EADA6N,IAAOE,OAIL6tB,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAxC1CoB,EAAAC,KAAA,GAAAD,EAAAE,KAAA,GA4COsqB,EAAcnf,cAAcvI,GA5CnC,eAAA9C,EAAAE,KAAA,GA+CqBsqB,EAAcqY,8BAA8B3zC,EAAUmF,aAAazB,IA/CxF,QA+COmxC,EA/CP/jC,EAAA2B,KAiDCkrB,EAAS,CACL/9B,KAAM7B,EAAWuJ,sCACjBK,SAAUktC,IAnDf/jC,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,UAwDC6sB,EAAS,CACL/9B,KAAM7B,EAAW+2C,oCACjBh0C,MAAO,CACH1C,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,WA5DrB,yBAAAyS,EAAAI,SAAAN,EAAAlS,KAAA,cAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GCwBG,ICpDK4jC,GA6BAC,GDuBCC,GAAb,SAAArmC,GAEI,SAAAqmC,EAAYp0C,GAAmB,IAAA3C,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAw2C,IAC3B/2C,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA02C,GAAAr2C,KAAAH,KAAM,CACFN,KAAM,kBACNC,QAASyC,EAAMzC,QACfC,OAAQwC,EAAMzC,QACdE,KAAM,IAAIwQ,QANlBM,mBAC+B,EAO3BlR,EAAKa,KAAO,iBACZb,EAAKkR,cAAgBvO,EARM3C,EAFnC,OAAAK,OAAAe,EAAA,EAAAf,CAAA02C,EAAArmC,GAAAqmC,EAAA,CAAoCl3C,GAcvBsR,GAAb,SAAAC,GACI,SAAAD,EAAYhR,GAAgB,IAAAkR,EAAA,OAAAhR,OAAAC,EAAA,EAAAD,CAAAE,KAAA4Q,IACxBE,EAAAhR,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA8Q,GAAAzQ,KAAAH,KAAM,CAAEN,KAAM,mBAAoBC,QAAS,mBAAoBC,OAAQA,MAClEU,KAAO,kBAFYwQ,EADhC,OAAAhR,OAAAe,EAAA,EAAAf,CAAA8Q,EAAAC,GAAAD,EAAA,CAAqCtR,GAcxBm3C,GAAb,WAII,SAAAA,EAAYnhC,GAA4BxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAy2C,GAAAz2C,KAHxCsV,YAGuC,EACnCtV,KAAKsV,OAASA,EALtB,OAAAxV,OAAAmR,EAAA,EAAAnR,CAAA22C,EAAA,EAAAvlC,IAAA,MAAAxN,MAAA,eAAAgzC,EAAA52C,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,EAQiBc,EAAqBC,GARtC,IAAAjC,EAAA,OAAAe,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cASctB,EAAOhR,KAAK22C,cAAczjC,OAAOF,GAAOG,KAAK,KAT3Df,EAAAG,OAAA,SAUepB,MAAMH,EAAK,CACdI,QAAS,CACLC,cAAerR,KAAKsV,OAAOtH,MAC3BsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,MACRJ,KAAMK,KAAKC,UAAUN,KAEpBzB,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OAeN,IAAwB,MAApB4D,EAAS5D,OAChB,MAAM,IAAItN,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YAE7E,OAAO/B,EAASC,OACXF,KAAK,SAACG,GACH,OAAOA,IAnBf,OAAQF,EAASL,QAAQqC,IAAI,iBACzB,IAAK,mBACD,OAAOhC,EAASC,OACXF,KAAK,SAACG,GACH,MAAM,IAAI6kC,GAAe7kC,KAErC,IAAK,aACD,OAAOF,EAASiC,OACXlC,KAAK,SAACG,GACH,MAAM,IAAIf,GAAgBe,KAEtC,QACI,MAAM,IAAIpR,MAAM,4BAA8BkR,EAASL,QAAQqC,IAAI,qBAlC/F,wBAAArB,EAAAI,SAAAN,EAAAlS,SAAA,gBAAAiU,EAAAC,GAAA,OAAAwiC,EAAAjkC,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,OAAAxN,MAAA,eAAAiQ,EAAA7T,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,EA+CkBZ,EAAqBC,GA/CvC,IAAAjC,EAAAS,EAAAE,EAAAkC,EAAA,OAAA9B,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cAgDctB,EAAOhR,KAAK22C,cAAczjC,OAAOF,GAAOG,KAAK,KAhD3DW,EAAAxB,KAAA,EAiD+BnB,MAAMH,EAAK,CAC9BI,QAAS,CACLC,cAAerR,KAAKsV,OAAOtH,MAC3BsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,OACRJ,KAAMA,EAAOK,KAAKC,UAAUN,GAAQ,KAzDhD,UA4DgC,OAXlBxB,EAjDdqC,EAAAC,MA4DqBlG,OA5DrB,CAAAiG,EAAAxB,KAAA,SAAAwB,EAAAE,GA6DoBvC,EAASL,QAAQqC,IAAI,gBA7DzCK,EAAAxB,KA8DqB,qBA9DrBwB,EAAAE,GAAA,EAiEqB,eAjErBF,EAAAE,GAAA,0BAAAF,EAAAxB,KAAA,GA+DyCb,EAASC,OA/DlD,cA+D0BC,EA/D1BmC,EAAAC,KAgE0B,IAAIyiC,GAAe7kC,GAhE7C,eAAAmC,EAAAxB,KAAA,GAkE4Cb,EAASiC,OAlErD,cAkE0BG,EAlE1BC,EAAAC,KAmE0B,IAAInD,GAAgBiD,GAnE9C,cAqE0B,IAAItT,MAAM,4BAA8BkR,EAASL,QAAQqC,IAAI,iBArEvF,QAAAK,EAAAxB,KAAA,oBAuEuC,MAApBb,EAAS5D,OAvE5B,CAAAiG,EAAAxB,KAAA,gBAAAwB,EAAAxB,KAAA,GAwEyBb,EAASC,OAxElC,eAAAoC,EAAAvB,OAAA,SAAAuB,EAAAC,MAAA,WAyEuC,MAApBtC,EAAS5D,OAzE5B,CAAAiG,EAAAxB,KAAA,gBAAAwB,EAAAvB,OAAA,SA0EmB,MA1EnB,cA4EkB,IAAIhS,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YA5EzF,yBAAAM,EAAAtB,SAAAoB,EAAA5T,SAAA,gBAAAsU,EAAAc,GAAA,OAAAzB,EAAAlB,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,iBAAAxN,MAAA,eAAAkzC,EAAA92C,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EAgF4BpB,EAAqBC,GAhFjD,IAAAjC,EAAAS,EAAAE,EAAAkC,EAAA,OAAA9B,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAiFctB,EAAOhR,KAAK22C,cAAczjC,OAAOF,GAAOG,KAAK,KAjF3DkB,EAAA/B,KAAA,EAkF+BnB,MAAMH,EAAK,CAC9BI,QAAS,CACLC,cAAerR,KAAKsV,OAAOtH,MAC3BsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,OACRJ,KAAMA,EAAOK,KAAKC,UAAUN,GAAQ,KA1FhD,UA6FgC,OAXlBxB,EAlFd4C,EAAAN,MA6FqBlG,OA7FrB,CAAAwG,EAAA/B,KAAA,SAAA+B,EAAAL,GA8FoBvC,EAASL,QAAQqC,IAAI,gBA9FzCY,EAAA/B,KA+FqB,qBA/FrB+B,EAAAL,GAAA,EAkGqB,eAlGrBK,EAAAL,GAAA,0BAAAK,EAAA/B,KAAA,GAgGyCb,EAASC,OAhGlD,cAgG0BC,EAhG1B0C,EAAAN,KAiG0B,IAAIyiC,GAAe7kC,GAjG7C,eAAA0C,EAAA/B,KAAA,GAmG4Cb,EAASiC,OAnGrD,cAmG0BG,EAnG1BQ,EAAAN,KAoG0B,IAAInD,GAAgBiD,GApG9C,cAsG0B,IAAItT,MAAM,4BAA8BkR,EAASL,QAAQqC,IAAI,iBAtGvF,QAAAY,EAAA/B,KAAA,oBAwGuC,MAApBb,EAAS5D,OAxG5B,CAAAwG,EAAA/B,KAAA,gBAAA+B,EAAA/B,KAAA,GAyGyBb,EAASC,OAzGlC,eAAA2C,EAAA9B,OAAA,SAAA8B,EAAAN,MAAA,cA2GkB,IAAIxT,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YA3GzF,yBAAAa,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAuW,EAAAC,GAAA,OAAAogC,EAAAnkC,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,MAAAxN,MAAA,eAAAyQ,EAAArU,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAgD,EA+GiBjC,EAAqBuC,GA/GtC,IAAAshC,EAAA7lC,EAAAS,EAAAE,EAAAkC,EAAA,OAAA9B,GAAAC,EAAAG,KAAA,SAAAgD,GAAA,cAAAA,EAAA9C,KAAA8C,EAAA7C,MAAA,cAgHcukC,EAAcC,MAAMC,KAAKxhC,EAAM8C,WAAWhP,IAAI,SAAA7J,GAAY,IAAAkX,EAAA5W,OAAAwY,GAAA,EAAAxY,CAAAN,EAAA,GAAVw3C,EAAUtgC,EAAA,GAAP0c,EAAO1c,EAAA,GAC5D,MAAO,CACHsgC,EAAGC,mBAAmB7jB,IACxBjgB,KAAK,OACRA,KAAK,KACFnC,EAAOhR,KAAK22C,cAAczjC,OAAOF,GAAOG,KAAK,KAAO,IAAM0jC,EArHxE1hC,EAAA7C,KAAA,EAuH+BnB,MAAMH,EAAK,CAC9BI,QAAS,CACLC,cAAerR,KAAKsV,OAAOtH,MAC3BsD,OAAQ,mBACR8B,eAAgB,oBAEpB7B,KAAM,OACN8B,OAAQ,QA9HpB,UAiIgC,OAVlB5B,EAvHd0D,EAAApB,MAiIqBlG,OAjIrB,CAAAsH,EAAA7C,KAAA,SAAA6C,EAAAnB,GAkIoBvC,EAASL,QAAQqC,IAAI,gBAlIzC0B,EAAA7C,KAmIqB,qBAnIrB6C,EAAAnB,GAAA,EAsIqB,eAtIrBmB,EAAAnB,GAAA,0BAAAmB,EAAA7C,KAAA,GAoIyCb,EAASC,OApIlD,cAoI0BC,EApI1BwD,EAAApB,KAqI0B,IAAIyiC,GAAe7kC,GArI7C,eAAAwD,EAAA7C,KAAA,GAuI4Cb,EAASiC,OAvIrD,cAuI0BG,EAvI1BsB,EAAApB,KAwI0B,IAAInD,GAAgBiD,GAxI9C,cA0I0B,IAAItT,MAAM,4BAA8BkR,EAASL,QAAQqC,IAAI,iBA1IvF,QAAA0B,EAAA7C,KAAA,oBA4IuC,MAApBb,EAAS5D,OA5I5B,CAAAsH,EAAA7C,KAAA,gBAAA6C,EAAA7C,KAAA,GA6IyBb,EAASC,OA7IlC,eAAAyD,EAAA5C,OAAA,SAAA4C,EAAApB,MAAA,cA+IkB,IAAIxT,MAAM,wBAA0BkR,EAAS5D,OAAS,MAAQ4D,EAAS+B,YA/IzF,yBAAA2B,EAAA3C,SAAAyC,EAAAjV,SAAA,gBAAAyW,EAAAe,GAAA,OAAArD,EAAA1B,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,cAAAxN,MAAA,WA+KQ,MAAO,CAAC1D,KAAKsV,OAAOtE,IAAK,MAAO,QA/KxC,CAAAE,IAAA,mBAAAxN,MAAA,eAAAwzC,EAAAp3C,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAiE,EAAAS,GAAA,IAAA4tB,EAAA4F,EAAA,OAAAp4B,GAAAC,EAAAG,KAAA,SAAAkE,GAAA,cAAAA,EAAAhE,KAAAgE,EAAA/D,MAAA,cA6M6BiyB,EA7M7B5tB,EA6M6B4tB,OACf4F,EAAU,IAAI95B,KACZkI,IAAI,IAAK1C,OAAO0uB,IA/MhCluB,EAAA/D,KAAA,EAgNqBtS,KAAKyT,IAA4B,CAAC,iBAAkB02B,GAhNzE,cAAA9zB,EAAA9D,OAAA,SAAA8D,EAAAtC,MAAA,wBAAAsC,EAAA7D,SAAA0D,EAAAlW,SAAA,gBAAAwY,GAAA,OAAA0+B,EAAAzkC,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,mBAAAxN,MAAA,eAAAyzC,EAAAr3C,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAoF,EAoN2Bsd,GApN3B,OAAA5iB,GAAAC,EAAAG,KAAA,SAAAoF,GAAA,cAAAA,EAAAlF,KAAAkF,EAAAjF,MAAA,cAAAiF,EAAAhF,OAAA,SAqNevS,KAAKo3C,eAAuC,CAAC,gBAAiB,OAAQziB,IArNrF,wBAAApd,EAAA/E,SAAA6E,EAAArX,SAAA,gBAAAgd,GAAA,OAAAm6B,EAAA1kC,MAAAzS,KAAA0S,YAAA,MAAA+jC,EAAA,GCzBA,SAASY,GAAaC,GAClB,OAAQA,GACJ,IAAK,QACD,OAAOhB,GAAMiB,MACjB,IAAK,QACD,OAAOjB,GAAMrwC,MACjB,IAAK,UACD,OAAOqwC,GAAMkB,QACjB,IAAK,UACD,OAAOlB,GAAM19B,QACjB,QACI,MAAM,IAAIrY,MAAM,wBAA0B+2C,IAItD,SAASG,GAAwBzoB,GAK7B,IAAMmF,EAASnF,EAAamF,OAAO,GACnC,OAAQnF,EAAa0oB,MACjB,IAAK,YACD,OAAQvjB,EAAOjzB,MACX,IAAK,OACD,OAAOq1C,GAA6BoB,aACxC,IAAK,YACL,IAAK,YACD,OAAOpB,GAA6BqB,8BACxC,IAAK,MACD,OAAOrB,GAA6BsB,wBAEhD,IAAK,UACD,OAAQ1jB,EAAOjzB,MACX,IAAK,YACL,IAAK,YACD,OAAOq1C,GAA6BuB,qBAEhD,IAAK,WACD,OAAQ3jB,EAAOjzB,MACX,IAAK,YACL,IAAK,YACD,OAAOq1C,GAA6BwB,mBACxC,IAAK,OAED,OAAOxB,GAA6ByB,cAEhD,IAAK,UACD,OAAQ7jB,EAAOjzB,MACX,IAAK,OACD,OAAOq1C,GAA6B0B,gBAEhD,QAEI,OADAv2C,QAAQC,KAAK,UAAWqtB,GACjBunB,GAA6B2B,QAG5C,OAAO3B,GAA6B2B,kBAhH5B5B,sHA6BAC,6dA4FL,IAAME,GAAb,WAGI,SAAAA,EAAYnhC,GAA4BxV,OAAAC,EAAA,EAAAD,CAAAE,KAAAy2C,GAAAz2C,KAFxCsV,YAEuC,EAAAtV,KADvCm4C,iBACuC,EACnCn4C,KAAKsV,OAASA,EACdtV,KAAKm4C,YAAc,IAAIC,GAAqB,CACxCpqC,MAAOhO,KAAKsV,OAAOtH,MACnBgD,IAAKhR,KAAKsV,OAAO+iC,kBAP7B,OAAAv4C,OAAAmR,EAAA,EAAAnR,CAAA22C,EAAA,EAAAvlC,IAAA,mBAAAxN,MAAA,eAAAwzC,EAAAp3C,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAC,IAAA,IAAA6c,EAAA,OAAAhd,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EAYoCtS,KAAKm4C,YAAYG,iBAAiB,CAAE/T,MAAO,MAZ/E,cAYcxV,EAZd3c,EAAA2B,KAAA3B,EAAAG,OAAA,SAcewc,EAAcxV,KAAKg/B,KAAKlvC,IAAI,SAAC2lB,GAAiB,IACzChqB,EACwCgqB,EADxChqB,GAAIwzC,EACoCxpB,EADpCwpB,MAAOd,EAC6B1oB,EAD7B0oB,KAAMe,EACuBzpB,EADvBypB,OAAQtkB,EACenF,EADfmF,OAAQukB,EACO1pB,EADP0pB,OAAQpB,EACDtoB,EADCsoB,MAAOqB,EACR3pB,EADQ2pB,KACpDC,EAA4C5pB,EAA5C4pB,QAASC,EAAmC7pB,EAAnC6pB,QAASC,EAA0B9pB,EAA1B8pB,aAAc/S,EAAY/W,EAAZ+W,QACpC,MAAO,CACH/gC,KAAIwzC,QAAOd,OAAMe,SAAQtkB,SAAQukB,SACjCpB,MAAOD,GAAaC,GACpBqB,OACAl/B,UAAW,IAAI1W,KAAK61C,GAAUG,UAAW,IAAIh2C,KAAK81C,GAClDG,YAAaF,EAAc/S,cAtB3C,wBAAA3zB,EAAAI,SAAAN,EAAAlS,SAAA,yBAAAk3C,EAAAzkC,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,+BAAAxN,MAAA,eAAAu1C,EAAAn5C,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAA2B,IAAA,IAAAmb,EAAAtvB,EAAAO,KAAA,OAAA+R,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cAAAwB,EAAAxB,KAAA,EA4BoCtS,KAAKm4C,YAAYG,iBAAiB,CAC1D/T,MAAO,MA7BnB,cA4BcxV,EA5Bdjb,EAAAC,KAAAD,EAAAvB,OAAA,SAgCewc,EAAcxV,KAAKg/B,KACrBxuC,OAAO,SAAAvK,GAAuB,IAApBg5C,EAAoBh5C,EAApBg5C,MACP,MACe,kBAFYh5C,EAAbk5C,QAGVF,EAAMxzC,KAAOvF,EAAK6V,OAAO/L,WAGhCF,IAAI,SAAC2lB,GACF,MAAO,CACHhqB,GAAIgqB,EAAahqB,GACjB+xC,KAAM/nB,EAAawpB,MAAMxzC,GACzByU,UAAW,IAAI1W,KAAKisB,EAAa4pB,SACjCG,UAAW,IAAIh2C,KAAKisB,EAAa6pB,SACjCvB,MAAOD,GAAaroB,EAAasoB,OACjC4B,KAAMlqB,EAAa2pB,KACnBv/B,eAAgB4V,EAAaypB,OAAOzzC,GACpC9D,KAAMu2C,GAAwBzoB,GAC9BmqB,UAAWnqB,EAAamF,WAjD5C,wBAAArgB,EAAAtB,SAAAoB,EAAA5T,SAAA,yBAAAi5C,EAAAxmC,MAAAzS,KAAA0S,YAAA,KAAAxB,IAAA,kBAAAxN,MAAA,eAAA01C,EAAAt5C,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAA,SAAAmC,EAsD0Bkb,GAtD1B,IAAA5Y,EAAA2iC,EAAA,OAAAtnC,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA/B,KAAA,EAuDyDtS,KAAKm4C,YAAYmB,iBAAiB,CAAEC,SAAU,CAACjqB,KAvDxG,cAAA5Y,EAAArC,EAAAN,KAuDgBslC,EAvDhB3iC,EAuDgB2iC,WAvDhB3iC,EAuD4B8iC,mBAvD5BnlC,EAAA9B,OAAA,SAwDe8mC,EAAW,IAxD1B,wBAAAhlC,EAAA7B,SAAA4B,EAAApU,SAAA,gBAAAiU,GAAA,OAAAmlC,EAAA3mC,MAAAzS,KAAA0S,YAAA,MAAA+jC,EAAA,cCvHK/mB,8BAeL,SAASyD,GAAYC,GACjB,OAAQA,GACJ,KAAK1D,GAAK2D,QACN,OAAO3D,GAAK3mB,OAChB,KAAK2mB,GAAK3mB,OACN,OAAO2mB,GAAK2D,mBApBnB3D,qEAyJU+pB,eAhIX,SAAAA,EAAY/oB,GAAoB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAy5C,IAC5Bh6C,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA25C,GAAAt5C,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTuyB,KAAM7D,GAAK2D,SAJa5zB,8EAS5BO,KAAKwzB,SAAS,CACVD,KAAMJ,GAAYnzB,KAAKgB,MAAMuyB,6CAKjC,OAAQvzB,KAAK0wB,MAAMpnB,OAAOpI,MACtB,KAAKqqB,GAAoBvL,MACrB,OACI2Q,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UADf,UAIR,KAAKqqB,GAAoB9hB,MACrB,OACIknB,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WADf,UAIR,KAAKqqB,GAAoB3hB,OACrB,OACI+mB,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SADf,oDAQZ,IAAMw4C,EACF/oB,EAAA,yBACK3wB,KAAK0wB,MAAMpnB,OAAOC,UAG3B,OACIonB,EAAA,qBAAKgD,UAAU,uBACXhD,EAAA,qBAAKgD,UAAU,qBACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAGhE4nB,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM9wB,KAAK0wB,MAAMmD,YAAc,MAElElD,EAAA,qBAAKgD,UAAU,kBACXhD,EAAA,qBAAKgD,UAAU,eACXhD,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,cAAcxU,MAAOi6B,GACpC/oB,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMpnB,OAAOC,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,YAG5F0iB,EAAA,qBAAKgD,UAAU,eACV3zB,KAAK25C,aACL,YACDhpB,EAAA,cAAC8T,GAAD,CAAiB/zB,KAAM1Q,KAAK0wB,MAAMpnB,OAAOiX,YAE7CoQ,EAAA,qBAAKgD,UAAU,gBACV3zB,KAAK0wB,MAAMpnB,OAAOmW,OAASzf,KAAK0wB,MAAMnX,KAAKkG,gDAQ5D,IAAMi6B,EACF/oB,EAAA,yBACK3wB,KAAK0wB,MAAMpnB,OAAOC,UAG3B,OACIonB,EAAA,qBAAKgD,UAAU,sBACXhD,EAAA,qBAAKgD,UAAU,qBACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAGhE4nB,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM9wB,KAAK0wB,MAAMmD,YAAc,MAElElD,EAAA,qBAAKgD,UAAU,kBACXhD,EAAA,qBAAKgD,UAAU,eACXhD,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,cAAcxU,MAAOi6B,GACpC/oB,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMpnB,OAAOC,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,YAG5F0iB,EAAA,qBAAKgD,UAAU,eACV3zB,KAAK25C,aACL,YACDhpB,EAAA,cAAC8T,GAAD,CAAiB/zB,KAAM1Q,KAAK0wB,MAAMpnB,OAAOiX,YAE7CoQ,EAAA,qBAAKgD,UAAU,gBACV3zB,KAAK0wB,MAAMpnB,OAAOmW,OAASzf,KAAK0wB,MAAMnX,KAAKkG,OAEhDkR,EAAA,qBAAKgD,UAAU,uBACV3zB,KAAK0wB,MAAMnX,KAAK9S,cAAgBkqB,EAAA,2DAErCA,EAAA,qBAAKgD,UAAU,mBACV,CAAC3zB,KAAK0wB,MAAMnX,KAAKgb,KAAMv0B,KAAK0wB,MAAMnX,KAAKvY,MAAOhB,KAAK0wB,MAAMnX,KAAKib,SAASzqB,OAAO,SAAAgoB,GAAC,OAAIA,IAAG5e,KAAK,OAASwd,EAAA,sGAQrH,OAAQ3wB,KAAKgB,MAAMuyB,MACf,KAAK7D,GAAK2D,QACN,OAAOrzB,KAAKy0B,gBAEhB,KAAK/E,GAAK3mB,OACN,OAAO/I,KAAKglC,uBA5HPtS,aCpBf+N,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,0EAIN,OAAI1wB,KAAK0wB,MAAMnX,KAEPoX,EAAA,cAACipB,GAAD,CAAQtwC,OAAQtJ,KAAK0wB,MAAMpnB,OAAQiQ,KAAMvZ,KAAK0wB,MAAMnX,KAAMsa,WAAY7zB,KAAK0wB,MAAMmD,aAIjFlD,EAAA,wFAQH3wB,KAAK0wB,MAAMnX,MACZvZ,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMpnB,OAAOC,iBArB3BmpB,aA4DNkO,IC/CViZ,GD+CUjZ,eAdf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACHnX,KAAMvY,EAAM4sB,SAASlD,MAAMmD,KAAKpa,IAAIid,EAAMpnB,OAAOC,YAIzD,SAA4B01B,GACxB,MAAO,CACH0B,OAAQ,SAAC3B,GACLC,EAAS4B,GAAmB7B,OAKzB4B,CAA8FH,+BC/CxGoZ,wRAUE,IA2aQC,GA3af,SAAAlnB,GAII,SAAAknB,EAAYppB,GAAgC,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAA85C,IACxCr6C,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAg6C,GAAA35C,KAAAH,KAAM0wB,KAHVjmB,cAE4C,EAGxChL,EAAKuB,MAAQ,CACT+4C,WAAYF,GAAWv2C,MAG3B7D,EAAKgL,SAAWhL,EAAKu6C,kBAPmBv6C,EAJhD,OAAAK,OAAAe,EAAA,EAAAf,CAAAg6C,EAAAlnB,GAAA9yB,OAAAmR,EAAA,EAAAnR,CAAAg6C,EAAA,EAAA5oC,IAAA,kBAAAxN,MAAA,WAeQ,IAAMu2C,EAAkBj6C,KAAK0wB,MAAMupB,gBAC7Bt6B,EAAM3f,KAAK0wB,MAAMjqB,aACvB,GAAIwzC,IAAoBt6B,EAAII,MAAMxW,SAC9B,MAAO,CACHrI,KAAMqqB,GAAoCvL,OAG9C,IAAM1W,EAASqW,EAAIvW,QAAQ6R,KAAK,SAAAzb,GAC5B,OAD8CA,EAAf+J,WACV0wC,IAEzB,IAAI3wC,EAmBG,OAAItJ,KAAK0wB,MAAMnC,oBAAsBvuB,KAAK0wB,MAAMnC,mBAAmBhV,OAAS0gC,EACxE,CACH/4C,KAAMqqB,GAAoC1L,uBAC1C3K,UAAWlV,KAAK0wB,MAAMnC,mBAAmBvpB,IAEtChF,KAAK0wB,MAAMlC,uBAAyBxuB,KAAK0wB,MAAMlC,sBAAsBjV,OAAS0gC,EAC9E,CACH/4C,KAAMqqB,GAAoCzL,0BAC1C5K,UAAWlV,KAAK0wB,MAAMlC,sBAAsBxpB,IAGzC,CACH9D,KAAMqqB,GAAoCpL,MA9B9C,OAAQ7W,EAAOpI,MACX,KAAK7C,EAAWuL,OACZ,MAAO,CACH1I,KAAMqqB,GAAoC3hB,QAElD,KAAKvL,EAAWoL,MACZ,MAAO,CACHvI,KAAMqqB,GAAoC9hB,OAElD,KAAKpL,EAAW2hB,MACZ,MAAO,CACH9e,KAAMqqB,GAAoCvL,OAElD,QACI,MAAO,CACH9e,KAAMqqB,GAAoCjoB,SAzCtE,CAAA4N,IAAA,cAAAxN,MAAA,WA+DQ1D,KAAK0wB,MAAMwpB,YACXv6C,KAAQw6C,QAAQ,qCAhExB,CAAAjpC,IAAA,sBAAAxN,MAAA,WA2EQ,IAAM+G,EAAWzK,KAAKyK,SACtBzK,KAAK0wB,MAAM0pB,oBAAoB3vC,EAASyK,WACxCvV,KAAQw6C,QAAQ,oCA7ExB,CAAAjpC,IAAA,qBAAAxN,MAAA,WAiFQ,IAAM+G,EAAWzK,KAAKyK,SACtBzK,KAAK0wB,MAAM2pB,mBAAmB5vC,EAASyK,WACvCvV,KAAQw6C,QAAQ,yCAnFxB,CAAAjpC,IAAA,qBAAAxN,MAAA,WAuFQ,IAAM+G,EAAWzK,KAAKyK,SACtBzK,KAAK0wB,MAAM4pB,mBAAmB7vC,EAASyK,WACvCvV,KAAQw6C,QAAQ,wCAzFxB,CAAAjpC,IAAA,yBAAAxN,MAAA,WA6FQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWU,sBA7F/C,CAAArpC,IAAA,0BAAAxN,MAAA,WAiGQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWW,iBAjG/C,CAAAtpC,IAAA,6BAAAxN,MAAA,WAqGQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWY,oBArG/C,CAAAvpC,IAAA,+BAAAxN,MAAA,WAyGQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWa,sBAzG/C,CAAAxpC,IAAA,yBAAAxN,MAAA,WA6GQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWc,gBA7G/C,CAAAzpC,IAAA,+BAAAxN,MAAA,WAiHQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWe,sBAjH/C,CAAA1pC,IAAA,cAAAxN,MAAA,SAAAgT,GAqHQ,OADkCA,EAAxBxF,KAEN,IAAK,qBACDlR,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWU,oBACvC,MACJ,IAAK,cACDv6C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWW,eACvC,MACJ,IAAK,UACDx6C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWa,oBACvC,MACJ,IAAK,aACD16C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWc,cACvC,MACJ,IAAK,iBACD36C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWY,qBAnIvD,CAAAvpC,IAAA,aAAAxN,MAAA,SAyIeic,GACP,OACIgR,EAAA,cAAC4R,GAAD,CAASt+B,QAAS0b,EAAI1b,QAAS6sB,KAAM,GAAIS,iBAAkB5R,EAAIrf,KAAM8Y,eAAgBuG,EAAI3a,OA3IrG,CAAAkM,IAAA,iBAAAxN,MAAA,WAgJoB1D,KAAK0wB,MAAMjqB,aACvB,OAAQzG,KAAKyK,SAASvJ,MAClB,KAAMqqB,GAAoCjoB,KACtC,OACIqtB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAjB,QAER,KAAMqqB,GAAoCpL,KACtC,OACIwQ,EAAA,yBACIA,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,uFAENkR,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,WACrBlqB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,MAAM2wB,MAAO,CAAEuU,YAAa,SAD3C,8CAIJzV,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,WACrBlqB,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,UACLkzB,QAASp0B,KAAK86C,YAAYxmB,KAAKt0B,OAFnC,4BAShB,KAAMurB,GAAoC1L,uBACtC,OACI8Q,EAAA,yBACIA,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,sDAHV,MAIIkR,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,WACrBlqB,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,UAAYspB,MAAM,IADxD,mBAEoBpqB,EAAA,kCAFpB,cAGC,IACGA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,uBAIvByvB,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,WACrBlqB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,SAASvyB,KAAK,SAASkzB,QAASp0B,KAAKo6C,oBAAoB9lB,KAAKt0B,OAA3E,oBAKhB,KAAMurB,GAAoCzL,0BACtC,OACI6Q,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,mDAENkR,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,WACrBlqB,EAAA,yBACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,UADtC,iBACgEd,EAAA,kCADhE,8BAGAA,EAAA,yBACIA,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,QAAQvyB,KAAK,UAAUkzB,QAASp0B,KAAKq6C,mBAAmB/lB,KAAKt0B,OAA1E,UACA2wB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OAAOvyB,KAAK,SAASkzB,QAASp0B,KAAKs6C,mBAAmBhmB,KAAKt0B,OAAxE,aAKpB,KAAMurB,GAAoC3hB,OACtC,IAAMs5B,EACFvS,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAASp0B,KAAKg7C,YAAY1mB,KAAKt0B,OACjC2wB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,sBAAf,yBAKR,OACIyf,EAAA,qBAAKgD,UAAU,eACXhD,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,yCAENkR,EAAA,yBAAKA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAhB,aAAmCyvB,EAAA,iCAAnC,2BAGRA,EAAA,qBAAKgD,UAAU,gBACXhD,EAAA,yBACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAASN,EAAMO,QAAS,CAAC,UAC/B9S,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,UACVvY,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAU+5C,MAAM,SAASppB,MAAO,CAAEO,SAAU,eAOnF,KAAM7G,GAAoC9hB,MACtC,IAAMyxC,EACFvqB,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAASp0B,KAAKg7C,YAAY1mB,KAAKt0B,OACjC2wB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,sBAAf,wBAGAyf,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,WAAf,iBAGAyf,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,cAAf,gBAKR,OACIyf,EAAA,qBAAKgD,UAAU,eACXhD,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,kDAENkR,EAAA,yBAAKA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAhB,aAAqCyvB,EAAA,wCAArC,2BAGRA,EAAA,qBAAKgD,UAAU,gBACXhD,EAAA,yBACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAAS0X,EAAWzX,QAAS,CAAC,UACpC9S,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,UACVvY,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAU+5C,MAAM,SAASppB,MAAO,CAAEO,SAAU,eAOnF,KAAM7G,GAAoCvL,MACtC,IAAMm7B,EACFxqB,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAASp0B,KAAKg7C,YAAY1mB,KAAKt0B,OACjC2wB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,WAAf,iBAGAyf,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,cAAf,gBAKR,OACIyf,EAAA,qBAAKgD,UAAU,eACXhD,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,6BAENkR,EAAA,yBACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,QAAQ2wB,MAAO,CAAEJ,MAAO,UAClC,IAFL,OAGQd,EAAA,8BAHR,wBAORA,EAAA,qBAAKgD,UAAU,gBACXhD,EAAA,yBACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAAS2X,EAAW1X,QAAS,CAAC,UACpC9S,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,UACVvY,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAU+5C,MAAM,SAASppB,MAAO,CAAEO,SAAU,kBApT/F,CAAAlhB,IAAA,gBAAAxN,MAAA,SA8TkBic,GACV,GAAKA,EAAIrb,QAGT,OACIqsB,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,mBAAGuD,KAAMvU,EAAIrb,QAAS6vB,OAAO,UACzBxD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACV,IACAye,EAAIrb,YAvUzB,CAAA4M,IAAA,gBAAAxN,MAAA,WA8UQ,IAAMic,EAAM3f,KAAK0wB,MAAMjqB,aACvB,OACIkqB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,QACVhU,EAAIrf,MAETqwB,EAAA,yBACIA,EAAA,qBAAKkB,MAAO,CAAE6T,QAAS,eAAgB7U,MAAO,MAAOqV,cAAe,QAChEvV,EAAA,yBACK3wB,KAAK8jC,cAAcnkB,IAExBgR,EAAA,qBAAKgD,UAAU,SACXhD,EAAA,cAACwT,GAAD,CAAO56B,SAAUoW,EAAII,MAAMxW,SAAUsqB,WAAY,GAAIH,YAAY,MAGzE/C,EAAA,qBAAKkB,MAAO,CAAE6T,QAAS,eAAgB7U,MAAO,MAAOqV,cAAe,QAChEvV,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,eACAhD,EAAA,sBAAMgD,UAAU,eAAegO,KAAKC,eAAe,QAAS,CACxDC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOpiB,EAAIlG,aAElBkX,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,iBACAhD,EAAA,sBAAMgD,UAAU,eAAegO,KAAKC,eAAe,QAAS,CACxDC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOpiB,EAAI9F,mBA5W1C,CAAA3I,IAAA,mBAAAxN,MAAA,SAoXqBic,GACb,OAAQ3f,KAAKyK,SAASvJ,MAClB,KAAMqqB,GAAoCjoB,KACtC,MAAO,kBACX,KAAMioB,GAAoCpL,KACtC,MAAO,oCACX,KAAMoL,GAAoC1L,uBACtC,MAAO,yCACX,KAAM0L,GAAoCzL,0BACtC,MAAO,4CACX,KAAMyL,GAAoC3hB,OACtC,MAAO,iCACX,KAAM2hB,GAAoC9hB,MACtC,MAAO,gCACX,KAAM8hB,GAAoCvL,MACtC,MAAO,mCAnYvB,CAAA9O,IAAA,SAAAxN,MAAA,WAyYQ,OAAQ1D,KAAKgB,MAAM+4C,YACf,KAAKF,GAAWU,kBACZ,OAAO5pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,eAAiB3jC,KAAK0wB,MAAMjqB,aAAazB,KACvE,KAAK60C,GAAWW,aACZ,OAAO7pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,gBAAkB3jC,KAAK0wB,MAAMjqB,aAAazB,KACxE,KAAK60C,GAAWa,kBACZ,OAAO/pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMjqB,aAAazB,KAC7E,KAAK60C,GAAWY,gBACZ,OAAO9pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,+BAAiC3jC,KAAK0wB,MAAMjqB,aAAazB,KACvF,KAAK60C,GAAWc,YACZ,OAAOhqB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,eAAiB3jC,KAAK0wB,MAAMjqB,aAAazB,KACvE,KAAK60C,GAAWe,kBACZ,OAAOjqB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMjqB,aAAazB,KAKjF,OACI2rB,EAAA,qBAAKgD,UAAU,sBACXhD,EAAA,qBAAKgD,UAAU,UACV3zB,KAAKyyB,WAAWzyB,KAAK0wB,MAAMjqB,eAEhCkqB,EAAA,qBAAKgD,UAAU,WACV3zB,KAAKo7C,iBAEVzqB,EAAA,qBAAKgD,UAAW,gBAAkB3zB,KAAKq7C,iBAAiBr7C,KAAK0wB,MAAMjqB,eAC9DzG,KAAK4jC,uBAna1BkW,EAAA,CAAwCpnB,aCiCzBkO,mBArCf,SAAyB5/B,EAAyB0vB,GAA6B,IAGxCpvB,EAG/BN,EAJAI,MACIitB,wBAA2B/sB,UAENiI,EACzBvI,EADA4M,KAAQG,cAAiBxE,SAG7B,IAAKjI,EACD,MAAM,IAAIf,MAAM,sCAGpB,MAAO,CACHkG,aAAcnF,EAAUmF,aACxB8nB,mBAAoBjtB,EAAUitB,mBAC9BC,sBAAuBltB,EAAUktB,sBACjCyrB,gBAAiB1wC,IAIlB,SAA4B01B,GAC/B,MAAO,CACHib,UAAW,WACPjb,EAAS4B,OAEbuZ,oBAAqB,SAACllC,GAClB+pB,EAAS4B,GAAiC3rB,KAE9CmlC,mBAAoB,SAACnlC,GACjB+pB,EAAS4B,GAA6B3rB,KAE1ColC,mBAAoB,SAACplC,GACjB+pB,EAAS4B,GAA6B3rB,OAKnC0rB,CAAoGsS,IC3B5G,SAAShwC,GAAT1D,GAWQ,IAVXiH,EAUWjH,EAVXiH,aACA8nB,EASW/uB,EATX+uB,mBACAC,EAQWhvB,EARXgvB,sBACA/jB,EAOWjL,EAPXiL,SAQA,MAAO,CACHvJ,KAAM7B,EAAWivB,uCACjB7nB,eAAc8nB,qBAAoBC,wBAAuB/jB,YAI1D,SAASrH,GAAUhB,GACtB,MAAO,CACHlB,KAAM7B,EAAWovB,qCACjBrsB,MAAOA,OCnDTq+B,eACF,SAAAA,EAAY/P,GAAe,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACjB0wB,iFAIN,OACIC,EAAA,kFAMIvuB,GACR,OACIuuB,EAAA,kCAEIA,EAAA,yBACKvuB,EAAMzC,2CAQnB,OAAQK,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAKgI,EAA4BjH,KAEjC,KAAKiH,EAA4B/H,QAC7B,OAAOxC,KAAKmsC,gBAChB,KAAK5hC,EAA4BtE,MAC7B,OAAIjG,KAAK0wB,MAAM6C,KAAKnxB,MACTpC,KAAKosC,YAAYpsC,KAAK0wB,MAAM6C,KAAKnxB,OAEjCpC,KAAKosC,YAAY,CACpB1sC,KAAM,gBACNC,QAAS,oCAGrB,QACI,OACIgxB,EAAA,cAAC2qB,GAAD,mDAMZ,OAAQt7C,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAKgI,EAA4BjH,KAC7BtD,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMtX,gEAKrCpZ,KAAK0wB,MAAM4b,kBAvDE5Z,aAiGNkO,mBAjBf,SAAyB5/B,EAAyB0vB,GAC9C,MAAO,CACH6C,KAAMvyB,EAAMI,MAAMitB,0BAInB,SAA4B4Q,GAC/B,MAAO,CACH0B,OAAQ,SAACvnB,GACL6lB,ED3BL,SAAc7lB,GACjB,sBAAA1C,EAAA5W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAA4DC,GAAnE,IAAAC,EAAAC,EAAApxB,EAAAzE,EAAAwF,EAAAs8B,EAAAzO,EAAAwX,EAAA3kC,EAAAwM,EAAAo4B,EAAA,OAAAtiC,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACH2sB,EAvCG,CACH/9B,KAAM7B,EAAW+uB,uCAqCd+Q,EAMCD,IANDE,EAAAD,EAICvxB,KAAQG,cAAiBC,EAJ1BoxB,EAI0BpxB,MAAOzE,EAJjC61B,EAIiC71B,SACzBwF,EALRowB,EAKCtwB,IAAOE,OAGLs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGvC4rB,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAf1CoB,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAqB4B+4B,EAAU/mB,OAAOlL,GArB7C,WAqBO3S,EArBP2L,EAAA2B,MAsBkBjL,OAASyiB,GAA0BxiB,OAtBrD,CAAAqJ,EAAAE,KAAA,gBAuBK2sB,EAAS77B,GAAU,CACf1D,KAAM,gBACNC,QAAS,2CAzBlByS,EAAAG,OAAA,yBAAAH,EAAAE,KAAA,GA+BuBsqB,EAAc0W,qBAAqBl6B,GA/B1D,eA+BO3J,EA/BP2C,EAAA2B,KAAA3B,EAAAE,KAAA,GAgC0BsqB,EAAc2W,wBAAwBn6B,GAhChE,QAgCO6C,EAhCP7J,EAAA2B,KAkCOtJ,EAAW8gB,GAA2B9kB,EAAc8C,EAAUkG,EAASwM,GAG7EgjB,EAAS/7B,GAAY,CACjBuD,eAAcgE,WACd8jB,mBAAoB9e,EACpB+e,sBAAuBvS,KAxC5B7J,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,SA2CC6sB,EAAS77B,GAAU,CACf1D,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,WA7CjB,yBAAAyS,EAAAI,SAAAN,EAAAlS,KAAA,aAAP,gBAAAiU,EAAAC,GAAA,OAAAwC,EAAAjE,MAAAzS,KAAA0S,YAAA,GC0BiBmuB,CAAaznB,KAE1BkzB,SAAU,WACNrN,EDpCD,CACH/9B,KAAM7B,EAAWqvB,sCCwCVkS,CAAoGH,cCrEpG8a,uBA3BX,SAAAA,EAAY7qB,GAAmB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAu7C,GAAAz7C,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAy7C,GAAAp7C,KAAAH,KACrB0wB,0EAIN,IAAMoD,EACFnD,EAAA,yBACIA,EAAA,yBACK3wB,KAAK0wB,MAAMnX,KAAKtL,UAErB0iB,EAAA,yBACIA,EAAA,0BAAMA,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM,MAC1C,IACDH,EAAA,0BAAO3wB,KAAK0wB,MAAMnX,KAAKhQ,YAInC,OACIonB,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAOqU,EAASG,UAAU,eAC/BtD,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMnX,KAAKhQ,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,mBArBnFykB,cCCb+N,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,0EAIN,OAAI1wB,KAAK0wB,MAAMnX,KAEPoX,EAAA,cAAC6qB,GAAD,CAAYjiC,KAAMvZ,KAAK0wB,MAAMnX,KAAMsa,WAAY7zB,KAAK0wB,MAAMmD,aAI1DlD,EAAA,wFAQH3wB,KAAK0wB,MAAMnX,MACZvZ,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMsO,eArBpBtM,aA2DNkO,IC9DVlR,GD8DUkR,eAdf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACHnX,KAAMvY,EAAM4sB,SAASlD,MAAMmD,KAAKpa,IAAIid,EAAMsO,UAIlD,SAA4BC,GACxB,MAAO,CACH0B,OAAQ,SAAC3B,GACLC,EAAS4B,GAAmB7B,OAKzB4B,CAA8FH,WCzD7G,SAAStN,GAAYC,GACjB,OAAQA,GACJ,KAAK1D,GAAK2D,QACN,OAAO3D,GAAK3mB,OAChB,KAAK2mB,GAAK3mB,OACN,OAAO2mB,GAAK2D,mBAVnB3D,qEAkBgB+rB,eACjB,SAAAA,EAAY/qB,GAAuB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAy7C,IAC/Bh8C,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA27C,GAAAt7C,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTuyB,KAAM7D,GAAK2D,SAJgB5zB,8EAS/BO,KAAKwzB,SAAS,CACVD,KAAMJ,GAAYnzB,KAAKgB,MAAMuyB,uDAIdjoB,GACnB,OAAIA,EAAU4V,SAENyP,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,gDAAgDwU,UAAU,SACrEtD,EAAA,sBAAMkB,MAAO,CAAE6pB,OAAQ,SACnB/qB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WADf,sBAOJyvB,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,6EAA6EwU,UAAU,SAClGtD,EAAA,sBAAMkB,MAAO,CAAE6pB,OAAQ,SACnB/qB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SADf,oEAqCKoK,GACjB,IAAIqwC,EACA7nB,EACJ,OAAQxoB,EAAUmyB,QACd,KAAK0C,GAA+BhgB,KAChCw7B,EAAW,MACX7nB,EACInD,EAAA,wCAAiBA,EAAA,uEAAjB,KAEJ,MACJ,KAAKwP,GAA+B/f,KAChCu7B,EAAW,OACX7nB,EACInD,EAAA,oEAA6CA,EAAA,+BAA7C,aAAkEA,EAAA,uEAAlE,KAEJ,MACJ,KAAKwP,GAA+B12B,MAChCkyC,EAAW,SACX7nB,EACInD,EAAA,oEAC2CA,EAAA,iCAD3C,qCAIJ,MACJ,KAAKwP,GAA+BngB,MAChC27B,EAAW,QACX7nB,EACInD,EAAA,iEAMZ,OACIA,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVxU,MAAOqU,GACPnD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAMy6C,oDAKDrwC,GACnB,IAAIqwC,EACA7nB,EAQJ,OAPIxoB,EAAU4V,UACVy6B,EAAW,SACX7nB,EAAU,mEAEV6nB,EAAW,OACX7nB,EAAU,8FAGVnD,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVxU,MAAOqU,GACPnD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAMy6C,+CAKN74B,GACd,IAAMgR,EACFnD,EAAA,0BAEQgR,KAAKC,eAAe,QAAS,CACzBC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOjf,IAItB,OACI6N,EAAA,cAACqD,GAAA,EAAD,CAASC,UAAU,cAAcxU,MAAOqU,GACnCgN,GAAYhe,0CAKXxX,GACV,OACIqlB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAMhE4nB,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,mBAAGuD,KAAM,cAAgB5oB,EAAUC,YAAa4oB,OAAO,UAClD7oB,EAAUmU,QAGlB,KACDkR,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACirB,GAAD,CAAY/nB,WAAY,GAAImL,OAAQ1zB,EAAUyU,UAItD4Q,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,4BACV3zB,KAAK67C,qBAAqBvwC,IAE/BqlB,EAAA,qBAAKgD,UAAU,oBACV3zB,KAAK87C,uBAAuBxwC,KAGrCqlB,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,WACAhD,EAAA,cAAC8T,GAAD,CAAiB/zB,KAAMpF,EAAUsyB,sDAyBxCtyB,GAET,OACIqlB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAMhE4nB,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,mBAAGuD,KAAM,cAAgB5oB,EAAUC,YAAa4oB,OAAO,UAClD7oB,EAAUmU,QAGlB,KACDkR,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACirB,GAAD,CAAY/nB,WAAY,GAAImL,OAAQ1zB,EAAUyU,UAGtD4Q,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,4BACV3zB,KAAK67C,qBAAqBvwC,IAE/BqlB,EAAA,qBAAKgD,UAAU,oBACV3zB,KAAK87C,uBAAuBxwC,KAcrCqlB,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,cACC3zB,KAAK+7C,kBAAkBzwC,EAAUsyB,cAEtCjN,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,MACAhD,EAAA,cAACirB,GAAD,CAAY/nB,WAAY,GAAImL,OAAQ1zB,EAAUuyB,yDAOlDvyB,GACZ,OACIqlB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,mBAAGuD,KAAM,cAAgB5oB,EAAUC,YAAa4oB,OAAO,UAClD7oB,EAAUmU,QAGlB,KACDkR,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACirB,GAAD,CAAY/nB,WAAY,GAAImL,OAAQ1zB,EAAUyU,UAItD4Q,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,4BACV3zB,KAAK67C,qBAAqBvwC,IAE/BqlB,EAAA,qBAAKgD,UAAU,oBACV3zB,KAAK87C,uBAAuBxwC,KAGrCqlB,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,WACAhD,EAAA,cAAC8T,GAAD,CAAiB/zB,KAAMpF,EAAUsyB,kDAQjD,IAAMtyB,EAAYtL,KAAK0wB,MAAMplB,UAC7B,OAAIA,EAAUmyB,SAAW0C,GAA+B78B,KAEhDqtB,EAAA,oEAmBD3wB,KAAKg8C,gBAAgB1wC,UA/TGonB,aClBjC+N,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,0EAIN,OAAI1wB,KAAK0wB,MAAMplB,UAEPqlB,EAAA,cAACsrB,GAAD,CACI3wC,UAAWtL,KAAK0wB,MAAMplB,YAK1BqlB,EAAA,6FAQH3wB,KAAK0wB,MAAMplB,WACZtL,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMnlB,oBAvBpBmnB,aA8DNkO,mBAdf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACHplB,UAAWtK,EAAM4sB,SAASviB,WAAWwiB,KAAKpa,IAAIid,EAAMnlB,cAAgB,OAI5E,SAA4B0zB,GACxB,MAAO,CACH0B,OAAQ,SAACp1B,GACL0zB,EAAS4B,GAAsBt1B,OAK5Bq1B,CAA8FH,IC1DxFyb,uBACjB,SAAAA,EAAYxrB,GAAc,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAk8C,IACtBz8C,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAo8C,GAAA/7C,KAAAH,KAAM0wB,KACD1vB,MAAQ,CACTm7C,eAAe,GAHG18C,iFAQtBO,KAAK0wB,MAAM0rB,gBAAgBp8C,KAAK0wB,MAAMplB,qDAItCtL,KAAKwzB,SAAS,CAAE2oB,eAAe,mDAI/Bn8C,KAAKwzB,SAAS,CAAE2oB,eAAe,sDAGT7wC,GAAuC,IACzD87B,EACAiV,EACAC,EACAC,EAJyDzrC,EAAA9Q,KAK7D,OAAQsL,EAAU8V,YACd,KAAKmK,GAAiCjoB,KAC9BgI,EAAU4V,UACVo7B,EAAoB,kIACpBlV,EACIzW,EAAA,gDAIJ4rB,EAAgB,yJAChBF,EACI1rB,EAAA,cAAC8X,GAAA,EAAD,CAAQ3X,KAAK,QAAQsD,QAAS,WAAQtjB,EAAKsrC,gBAAgBj8C,KAAK2Q,KAAhE,2BAKJwrC,EAAoB,2FACpBlV,EACIzW,EAAA,uCAIJ4rB,EAAgB,uGAChBF,EACI1rB,EAAA,cAAC8X,GAAA,EAAD,CAAQ3X,KAAK,QAAQsD,QAAS,WAAQtjB,EAAKsrC,gBAAgBj8C,KAAK2Q,KAAhE,0BAKR,MACJ,KAAKya,GAAiCpL,KAClCm8B,EAAoB,oGACpBlV,EACIzW,EAAA,uCAIJ4rB,EAAgB,yFAChBF,EACI1rB,EAAA,cAAC8X,GAAA,EAAD,CAAQ3X,KAAK,QAAQsD,QAAS,WAAQtjB,EAAK0rC,gBAAgBr8C,KAAK2Q,KAAhE,6BAIJ,MACJ,KAAKya,GAAiCnL,KAClCk8B,EAAoB,wFACpBlV,EACIzW,EAAA,kCAIJ4rB,EAAgB,4GAChBF,EACI1rB,EAAA,cAAC8X,GAAA,EAAD,CAAQ3X,KAAK,QAAQsD,QAAS,WAAQtjB,EAAK0rC,gBAAgBr8C,KAAK2Q,KAAhE,wBAIJ,MACJ,KAAKya,GAAiC9hB,MAClC6yC,EAAoB,2FACpBlV,EACIzW,EAAA,mCAIJ,MACJ,KAAKpF,GAAiCvL,MAClCs8B,EAAoB,6EACpBlV,EACIzW,EAAA,mCAIJ,MACJ,QACIyW,EACIzW,EAAA,qCAMZ,OACIA,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAO68B,EAAmBroB,UAAU,SACzCtD,EAAA,sBAAMkB,MAAO,CAAE6pB,OAAQ,SACnB/qB,EAAA,sBAAMgD,UAAU,eAAhB,mBACCyT,IAGR,IACDzW,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAO88B,EAAetoB,UAAU,SACpCooB,mDAMM/wC,GACnB,OAAIA,EAAU4V,SAENyP,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,gDAAgDwU,UAAU,SACrEtD,EAAA,sBAAMkB,MAAO,CAAE6pB,OAAQ,SACnB/qB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WADf,sBAOJyvB,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,6EAA6EwU,UAAU,SAClGtD,EAAA,sBAAMkB,MAAO,CAAE6pB,OAAQ,SACnB/qB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SADf,iEASZ,IAAMoK,EAAYtL,KAAK0wB,MAAMplB,UAC7B,OAAIA,EAAU8V,aAAemK,GAAiCjoB,KAEtDqtB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,SAASroB,EAAUmU,OAElCkR,EAAA,yBAAM3wB,KAAKy8C,0BAA0BnxC,KAKzCqlB,EAAA,cAAC+rB,GAAD,CAAWnxC,YAAaD,EAAUC,uDAe1C,OACIolB,EAAA,yBACIA,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,SACAhD,EAAA,0BACIA,EAAA,cAAC8T,GAAD,CAAiB/zB,KAAM1Q,KAAK0wB,MAAMplB,UAAUmO,gDAOvD,IACDkjC,EADChqC,EAAA3S,KAgBL,OAdIA,KAAKgB,MAAMm7C,gBAEXQ,EACIhsB,EAAA,cAACisB,GAAA,EAAD,CAAQn9B,MAAM,8BACVwU,UAAU,QACV4oB,UAAU,EACVzK,SAAS,EACT0K,QAAS,WAAQnqC,EAAKoqC,qBAAqB58C,KAAKwS,KAJpD,yBAYJge,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,sCACV3zB,KAAKg8C,mBAEVrrB,EAAA,qBAAKgD,UAAU,qCACV3zB,KAAKg9C,kBAETL,UA9MkCjqB,cC8H5C,SAASuqB,GAAezzC,GAC3B,OAAO,SAACy1B,EAAmDC,GACvDD,EArBG,CACH/9B,KAAM7B,EAAW69C,+CAmBqE,IAAAvR,EASlFzM,IATkF0M,EAAAD,EAIlF/9B,KAAQG,cAAiBC,EAJyD49B,EAIzD59B,MAAOzE,EAJkDqiC,EAIlDriC,SACzBwF,EAL2E48B,EAKlF98B,IAAOE,OAEYzN,EAP+DqqC,EAMlFvqC,MACIyH,YAAevH,UAGvB,GAAkB,OAAdA,EACA,MAAM,IAAIf,MAAM,yBAEF,IAAIgrB,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGnCkW,cAAc5lB,EAAUmF,aAAazB,GAAIwE,GAC9CgI,KAAK,SAACmO,GACHsf,EAnCT,SAA+Bz1B,GAClC,MAAO,CACHtI,KAAM7B,EAAW8J,+CACjBK,kBAgCiBE,CAAsBF,MAElC6vB,MAAM,SAACC,GA9Bb,IAA6Bl3B,EA+BpB68B,GA/BoB78B,EA+BS,CACzB1C,KAAM45B,EAAIh5B,KACVX,QAAS25B,EAAI35B,SAhCtB,CACHuB,KAAM7B,EAAW89C,6CACjB/6C,MAAOA,QA8ER,SAASg7C,GAAe5zC,GAC3B,OAAO,SAACy1B,EAAmDC,GACvDD,EArBG,CACH/9B,KAAM7B,EAAWg+C,+CAmBqE,IAAAvd,EASlFZ,IATkFa,EAAAD,EAIlFlyB,KAAQG,cAAiBC,EAJyD+xB,EAIzD/xB,MAAOzE,EAJkDw2B,EAIlDx2B,SACzBwF,EAL2E+wB,EAKlFjxB,IAAOE,OAEYzN,EAP+Dw+B,EAMlF1+B,MACIyH,YAAevH,UAIvB,GAAkB,OAAdA,EACA,MAAM,IAAIf,MAAM,yBAEF,IAAIgrB,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGnCsW,cAAchmB,EAAUmF,aAAazB,GAAIwE,GAC9CgI,KAAK,SAACmO,GACHsf,EApCT,SAA+Bz1B,GAClC,MAAO,CACHtI,KAAM7B,EAAWsK,+CACjBH,eAAgBA,GAiCCK,CAAsBL,MAGlC6vB,MAAM,SAACC,GAhCb,IAA6Bl3B,EAiCpB68B,GAjCoB78B,EAiCS,CACzB1C,KAAM45B,EAAIh5B,KACVX,QAAS25B,EAAI35B,SAlCtB,CACHuB,KAAM7B,EAAWi+C,6CACjBl7C,MAAOA,QA+ER,SAASslB,GAAale,GACzB,OAAO,SAACy1B,EAAmDC,GACvDD,EArBG,CACH/9B,KAAM7B,EAAWk+C,4CAmBqE,IAAAC,EASlFte,IATkFue,EAAAD,EAIlF5vC,KAAQG,cAAiBC,EAJyDyvC,EAIzDzvC,MAAOzE,EAJkDk0C,EAIlDl0C,SACzBwF,EAL2EyuC,EAKlF3uC,IAAOE,OAEYzN,EAP+Dk8C,EAMlFp8C,MACIyH,YAAevH,UAGvB,GAAkB,OAAdA,EACA,MAAM,IAAIf,MAAM,yBAGF,IAAIgrB,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAGnC0W,aAAapmB,EAAUmF,aAAazB,GAAIwE,GAC7CgI,KAAK,WACFytB,EApChB,SAA6Bz1B,GACzB,MAAO,CACHtI,KAAM7B,EAAWyK,4CACjBN,kBAiCiBQ,CAAoBR,MAGhC6vB,MAAM,SAACC,GAhCpB,IAA2Bl3B,EAiCX68B,GAjCW78B,EAiCgB,CACvB1C,KAAM45B,EAAIh5B,KACVX,QAAS25B,EAAI35B,SAlCtB,CACHuB,KAAM7B,EAAWq+C,0CACjBt7C,MAAOA,mBC7QMu7C,eACjB,SAAAA,EAAYjtB,GAAsB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAA29C,GAAA79C,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA69C,GAAAx9C,KAAAH,KACxB0wB,uFAGYlnB,GAAmC,IAAA/J,EAAAO,KAIrDojC,KAAMkM,QAAQ,CACV7vB,MAAO,2BACP4jB,QACI1S,EAAA,kDAIJE,MAAO,OACP0e,KAAM,WAVN9vC,EAAKixB,MAAMktB,eAAep0C,2CAgBrB0H,EAAa5H,GACtB,OAAQ4H,GACJ,IAAK,iBACDlR,KAAK0wB,MAAMmtB,uBAAuBv0C,EAAOC,UACzC,MACJ,IAAK,eACDvJ,KAAK89C,sBAAsBx0C,EAAOC,+CAKlC2H,EAAa5H,GACrB,OAAQ4H,GACJ,IAAK,iBACDlR,KAAK0wB,MAAMqtB,sBAAsBz0C,EAAOC,oDAKnCD,GAAyB,IAAAwH,EAAA9Q,KAChCkjC,EACFvS,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAAS,SAAA50B,GAAa,IAAV0R,EAAU1R,EAAV0R,IAAYJ,EAAKktC,aAAa79C,KAAK2Q,EAAMI,EAAK5H,KAC5DqnB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,kBACXyf,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WADf,oBAGAyvB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,gBACXyf,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WADf,kBAKR,OACIyvB,EAAA,yBACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAASN,EAAMO,QAAS,CAAC,UAC/B9S,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAWyyB,UAAU,+DAMhCrqB,GAAyB,IAAAqJ,EAAA3S,KAC/BkjC,EACFvS,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAAS,SAAA1d,GAAa,IAAVxF,EAAUwF,EAAVxF,IAAYyB,EAAKsrC,YAAY99C,KAAKwS,EAAMzB,EAAK5H,KAC3DqnB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,kBACXyf,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SADf,qBAKR,OACIyvB,EAAA,yBACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAASN,EAAMO,QAAS,CAAC,UAC/B9S,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAWyyB,UAAU,+DAMhCrqB,GACZ,OACIqnB,EAAA,sEAIYrnB,GAChB,GAAMtJ,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoCvL,OACnEhgB,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoC9hB,MAIrE,OAAQH,EAAOpI,MACX,KAAKqqB,GAAoBvL,MACrB,OAAOhgB,KAAKk+C,gBAAgB50C,GAChC,KAAKiiB,GAAoB9hB,MACrB,OAAOzJ,KAAKm+C,gBAAgB70C,GAChC,KAAKiiB,GAAoB3hB,OACrB,OAAO5J,KAAKo+C,iBAAiB90C,4CAIzB,IACRF,EADQ2b,EAAA/kB,KAENL,EACFgxB,EAAA,qBAAKkB,MAAO,CAAE+e,UAAW,SAAUiK,UAAW,WAA9C,eAwBJ,OAlBIzxC,EAD2C,IAA3CpJ,KAAK0wB,MAAMjqB,aAAa2C,QAAQ8D,OAE5ByjB,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,OAAOvB,QAASA,IAGtBK,KAAK0wB,MAAMjqB,aAAa2C,QAAQC,IAAI,SAACC,GAC3C,OACIqnB,EAAA,qBAAKgD,UAAU,yBAAyBziB,IAAK5H,EAAOC,UAChDonB,EAAA,qBAAKgD,UAAU,kBACXhD,EAAA,cAAC0tB,GAAD,CAAQ/0C,OAAQA,EAAQuqB,WAAY,MAExClD,EAAA,qBAAKgD,UAAU,gBACV5O,EAAKu5B,oBAAoBh1C,OAQ1CqnB,EAAA,qBAAKgD,UAAU,aACVvqB,oCAMT,OACIunB,EAAA,cAACA,EAAA,SAAD,KACK3wB,KAAKu+C,wBA1Ie7rB,aCwCtBkO,mBAlCf,SAAyB5/B,EAAmB0vB,GAcxC,MAAO,IAGJ,SAA4BuO,GAC/B,MAAO,CACHuf,oBAAqB,WACjBvf,EFcD,CACH/9B,KAAM7B,EAAWo/C,gCEbjBZ,uBAAwB,SAACr0C,GACrBy1B,EAAS4B,GAAuBr3B,KAEpCu0C,sBAAuB,SAACW,GACpBzf,EAAS4B,GAAuB6d,KAEpCd,eAAgB,SAACp0C,GACby1B,EAAS4B,GAAqBr3B,OAK3Bo3B,CAA8F+d,ICtBtG,SAAS7gC,GAAY5I,GACxB,sBAAA1V,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAqEC,GAA5E,IAAAl+B,EAAAM,EAAAwrC,EAAA9+B,EAAAzE,EAAAwF,EAAA6tB,EAAAuZ,EAAA,OAAApkC,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACGtR,EAAQk+B,IAII,QAFZ59B,EAAYN,EAAMI,MAAMyH,YAAYvH,WAHvC,CAAA8Q,EAAAE,KAAA,eAMC2sB,EAAS,CACL/9B,KAAM7B,EAAW+2C,oCACjBh0C,MAAO,CACH1C,KAAM,QACNC,QAAS,mBAVlByS,EAAAG,OAAA,oBAiBCjR,EAAUwH,OAAS3J,EAAqB4J,OAjBzC,CAAAqJ,EAAAE,KAAA,eAkBC2sB,EAAS,CACL/9B,KAAM7B,EAAW+2C,oCACjBh0C,MAAO,CACH1C,KAAM,gBACNC,QAAS,sCAtBlByS,EAAAG,OAAA,wBA4BH0sB,EAAS,CACL/9B,KAAM7B,EAAWu/C,sCA7BlB9R,EAmCC9rC,EAFA4M,KAAQG,cAAiBC,EAjC1B8+B,EAiC0B9+B,MAAOzE,EAjCjCujC,EAiCiCvjC,SACzBwF,EACP/N,EADA6N,IAAOE,OAIL6tB,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAxC1CoB,EAAAC,KAAA,GAAAD,EAAAE,KAAA,GA4COsqB,EAAc9e,YAAY5I,GA5CjC,eAAA9C,EAAAE,KAAA,GA+CqBsqB,EAAckY,sBAAsBxzC,EAAUmF,aAAazB,IA/ChF,QA+COmxC,EA/CP/jC,EAAA2B,KAiDCkrB,EAAS,CACL/9B,KAAM7B,EAAW4K,sCACjBhB,SAAUktC,IAnDf/jC,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,UAwDC6sB,EAAS,CACL/9B,KAAM7B,EAAWw/C,oCACjBz8C,MAAO,CACH1C,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,WA5DrB,yBAAAyS,EAAAI,SAAAN,EAAAlS,KAAA,cAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,2BCtBG,SAASosC,GAATt/C,GAOL,IANIE,EAMJF,EANIE,KAAMC,EAMVH,EANUG,QAASC,EAMnBJ,EANmBI,OAAQ8mC,EAM3BlnC,EAN2BknC,QAAStmC,EAMpCZ,EANoCY,MAAOP,EAM3CL,EAN2CK,KAOzC,MAAO,CACHH,OAAMC,UAASC,SACfoF,GAAI+5C,OACJC,GAAI,IAAIj8C,KACR2jC,UAAStmC,QAAOP,QCMjB,SAASud,GAAclI,GAC1B,sBAAA1V,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,IAAAl+B,EAAAM,EAAAwrC,EAAA9+B,EAAAzE,EAAAwF,EAAA6tB,EAAAqiB,EAAA,OAAAltC,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACH2sB,EAAS,CACL/9B,KAAM7B,EAAW6/C,qCAGfl+C,EAAQk+B,IAII,QAFZ59B,EAAYN,EAAMI,MAAMyH,YAAYvH,WAPvC,CAAA8Q,EAAAE,KAAA,eAUC2sB,EAAS,CACL/9B,KAAM7B,EAAW+2C,oCACjBh0C,MAAO,CACH1C,KAAM,QACNC,QAAS,mBAdlByS,EAAAG,OAAA,oBAqBCjR,EAAUwH,OAAS3J,EAAqB4J,OArBzC,CAAAqJ,EAAAE,KAAA,eAsBC2sB,EAAS,CACL/9B,KAAM7B,EAAW+2C,oCACjBh0C,MAAO,CACH1C,KAAM,gBACNC,QAAS,sCA1BlByS,EAAAG,OAAA,wBAAAu6B,EAmCC9rC,EAFA4M,KAAQG,cAAiBC,EAjC1B8+B,EAiC0B9+B,MAAOzE,EAjCjCujC,EAiCiCvjC,SACzBwF,EACP/N,EADA6N,IAAOE,OAGL6tB,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAvC1CoB,EAAAC,KAAA,GAAAD,EAAAE,KAAA,GA2COsqB,EAAcxf,cAAclI,GA3CnC,eAAA9C,EAAAE,KAAA,GA6CqDsqB,EAAcsY,uBAAuB5zC,EAAUmF,aAAazB,IA7CjH,QA6COiE,EA7CPmJ,EAAA2B,KA+CCkrB,EAAS,CACL/9B,KAAM7B,EAAW8K,qCACjBlB,aAjDLmJ,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,UAoDC6sB,EAAS,CACL/9B,KAAM7B,EAAWq2C,mCACjBtzC,MAAO08C,GAAU,CACbp/C,KAAM,QACNC,QAASyS,EAAA4B,GAAGrU,YAxDrB,yBAAAyS,EAAAI,SAAAN,EAAAlS,KAAA,cAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,OCvBCgd,iBASL,SAASyD,GAAYC,GACjB,OAAQA,GACJ,KAAK1D,GAAK2D,QACN,OAAO3D,GAAK3mB,OAChB,KAAK2mB,GAAK3mB,OACN,OAAO2mB,GAAK2D,mBAdnB3D,qEAoHU6rB,eAxFX,SAAAA,EAAY7qB,GAAkB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAu7C,IAC1B97C,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAy7C,GAAAp7C,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTuyB,KAAM7D,GAAK2D,SAJW5zB,8EAS1BO,KAAKwzB,SAAS,CACVD,KAAMJ,GAAYnzB,KAAKgB,MAAMuyB,gDAKjC,OACI5C,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAGhE4nB,EAAA,qBAAKgD,UAAU,aACXhD,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM9wB,KAAK0wB,MAAMmD,YAAc,MAElElD,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMnX,KAAKhQ,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,WAEtF0iB,EAAA,yBACK3wB,KAAK0wB,MAAMnX,KAAKhQ,mDAQjC,OACIonB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAGhE4nB,EAAA,qBAAKgD,UAAU,aACXhD,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM9wB,KAAK0wB,MAAMmD,YAAc,MAElElD,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMnX,KAAKhQ,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,WAEtF0iB,EAAA,yBACK3wB,KAAK0wB,MAAMnX,KAAKhQ,UAErBonB,EAAA,qBAAKgD,UAAU,gBACV3zB,KAAK0wB,MAAMnX,KAAK9S,cAAgBkqB,EAAA,2DAErCA,EAAA,qBAAKgD,UAAU,YACV,CAAC3zB,KAAK0wB,MAAMnX,KAAKgb,KAAMv0B,KAAK0wB,MAAMnX,KAAKvY,MAAOhB,KAAK0wB,MAAMnX,KAAKib,SAASzqB,OAAO,SAAAgoB,GAAC,OAAIA,IAAG5e,KAAK,OAASwd,EAAA,sGAQrH,OAAQ3wB,KAAKgB,MAAMuyB,MACf,KAAK7D,GAAK2D,QACN,OACI1C,EAAA,qBAAKgD,UAAU,qBACV3zB,KAAKy0B,iBAGlB,KAAK/E,GAAK3mB,OACN,OACI4nB,EAAA,qBAAKgD,UAAU,oBACV3zB,KAAKglC,wBAlFXtS,aCvBb+N,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,0EAIN,OAAI1wB,KAAK0wB,MAAMnX,KAEPoX,EAAA,cAACwuB,GAAD,CAAM5lC,KAAMvZ,KAAK0wB,MAAMnX,KAAMsa,WAAY7zB,KAAK0wB,MAAMmD,aAIpDlD,EAAA,wFAQH3wB,KAAK0wB,MAAMnX,MACZvZ,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMsO,eArBpBtM,aA2DNkO,IChEVlR,GDgEUkR,eAdf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACHnX,KAAMvY,EAAM4sB,SAASlD,MAAMmD,KAAKpa,IAAIid,EAAMsO,UAIlD,SAA4BC,GACxB,MAAO,CACH0B,OAAQ,SAAC3B,GACLC,EAAS4B,GAAmB7B,OAKzB4B,CAA8FH,WC3D7G,SAAStN,GAAYC,GACjB,OAAQA,GACJ,KAAK1D,GAAK2D,QACN,OAAO3D,GAAK3mB,OAChB,KAAK2mB,GAAK3mB,OACN,OAAO2mB,GAAK2D,mBAVnB3D,qEAkBgB+rB,eACjB,SAAAA,EAAY/qB,GAAuB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAy7C,IAC/Bh8C,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA27C,GAAAt7C,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTuyB,KAAM7D,GAAK2D,SAJgB5zB,8EAS/BO,KAAKwzB,SAAS,CACVD,KAAMJ,GAAYnzB,KAAKgB,MAAMuyB,uDAIdjoB,GACnB,OAAIA,EAAU4V,SAENyP,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,gDAAgDwU,UAAU,SACrEtD,EAAA,sBAAMkB,MAAO,CAAE6pB,OAAQ,SACnB/qB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WADf,sBAOJyvB,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,6EAA6EwU,UAAU,SAClGtD,EAAA,sBAAMkB,MAAO,CAAE6pB,OAAQ,SACnB/qB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SADf,oEAQKoK,GACjB,IAAI87B,EACJ,OAAQ97B,EAAUmyB,QACd,KAAK0C,GAA+BhgB,KAChCinB,EACIzW,EAAA,wCAAiBA,EAAA,uEAAjB,KAEJ,MACJ,KAAKwP,GAA+B/f,KAChCgnB,EACIzW,EAAA,mCAAYA,EAAA,uEAAZ,KAEJ,MACJ,KAAKwP,GAA+B12B,MAChC29B,EAAQ,QACR,MACJ,KAAKjH,GAA+BngB,MAChConB,EAAQ,QACR,MACJ,QACIA,EAAQ,UAEhB,OACIzW,EAAA,0BACKyW,yCAKC97B,GACV,OACIqlB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAGhE4nB,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEO,SAAU,OAAQvB,MAAO,WAExDF,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,mBAAGuD,KAAM,cAAgB5oB,EAAUC,YAAa4oB,OAAO,UAClD7oB,EAAUmU,QAGlB,IACDkR,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACyuB,GAAD,CAAYvrB,WAAY,GAAImL,OAAQ1zB,EAAUyU,gDAOrDzU,GAET,OACIqlB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,mBAAGyD,QAASp0B,KAAKq0B,aAAaC,KAAKt0B,MAC/B2zB,UAAS,cAAAzgB,OAAgBlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,UAAY,KAEvE4nB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAI,GAAAgS,OAAKlT,KAAKgB,MAAMuyB,OAAS7D,GAAK3mB,OAAS,KAAO,YAGhE4nB,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEO,SAAU,OAAQvB,MAAO,WAExDF,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,mBAAGuD,KAAM,cAAgB5oB,EAAUC,YAAa4oB,OAAO,UAClD7oB,EAAUmU,QAGlB,IACDkR,EAAA,qBAAKgD,UAAU,mBACXhD,EAAA,cAACyuB,GAAD,CAAYvrB,WAAY,GAAImL,OAAQ1zB,EAAUyU,UAGtD4Q,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,4BACXhD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAEfyvB,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,aAGnByvB,EAAA,yBACK3wB,KAAKq/C,uBAAuB/zC,IAEjCqlB,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,mBACC3zB,KAAK67C,qBAAqBvwC,IAM/BqlB,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,cAAgDgO,KAAKC,eAAe,QAAS,CACzEC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOz2B,EAAUsyB,cAExBjN,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,MAAwCroB,EAAUuyB,gDASlE,IAAMvyB,EAAYtL,KAAK0wB,MAAMplB,UAC7B,GAAIA,EAAUmyB,SAAW0C,GAA+B78B,KACpD,OACIqtB,EAAA,yBACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,qBAAqB2wB,MAAO,CAAEJ,MAAO,YAC/C,IAFL,2CAOR,OAAQzxB,KAAKgB,MAAMuyB,MACf,KAAK7D,GAAK2D,QACN,OACI1C,EAAA,qBAAKgD,UAAU,0BACV3zB,KAAKy0B,cAAcnpB,IAGhC,KAAKokB,GAAK3mB,OACN,OACI4nB,EAAA,qBAAKgD,UAAU,yBACV3zB,KAAKglC,aAAa15B,YA9KJonB,aCfjC+N,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,0EAIN,OAAI1wB,KAAK0wB,MAAMplB,UAEPqlB,EAAA,cAAC2uB,GAAD,CACIh0C,UAAWtL,KAAK0wB,MAAMplB,YAK1BqlB,EAAA,6FAQH3wB,KAAK0wB,MAAMplB,WACZtL,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMnlB,oBAvBpBmnB,aA8DNkO,mBAdf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACHplB,UAAWtK,EAAM4sB,SAASviB,WAAWwiB,KAAKpa,IAAIid,EAAMnlB,cAAgB,OAI5E,SAA4B0zB,GACxB,MAAO,CACH0B,OAAQ,SAACp1B,GACL0zB,EAAS4B,GAAsBt1B,OAK5Bq1B,CAA8FH,ICxDxF8e,uBACjB,SAAAA,EAAY7uB,GAAsB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAu/C,GAAAz/C,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAy/C,GAAAp/C,KAAAH,KACxB0wB,mFAIN1wB,KAAK0wB,MAAM8uB,qBAAqBx/C,KAAK0wB,MAAMjhB,mDAI3CzP,KAAK0wB,MAAM+uB,qBAAqBz/C,KAAK0wB,MAAMjhB,0DAGtBA,GACrB,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC3M,IAClC,MAAO,WACX,KAAK2M,GAAiC7M,KAClC,MAAO,GACX,KAAK6M,GAAiC5M,UAClC,OACI4X,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAAC+uB,GAAD,CAAWn0C,YAAawV,SAAStR,EAAQsK,YAAa,QAK9E,KAAK4L,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,OACI6X,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ8J,KAAMsa,WAAY,QAMpE,MAAO,iEAGYpkB,GACnB,OACIkhB,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ6J,UAAWua,WAAY,uDAI3BpkB,GACtB,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC3M,IAClC,MAAO,2BACX,KAAK2M,GAAiC7M,KAClC,MAAO,+BACX,KAAK6M,GAAiC5M,UAClC,MAAO,iCAEnB,KAAK4M,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,MAAO,mCAGvB,MAAO,uEAGkBrJ,GACzB,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC3M,IAClC,MAAO,WACX,KAAK2M,GAAiC7M,KAClC,MAAO,GACX,KAAK6M,GAAiC5M,UAClC,OACI4X,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAAC+uB,GAAD,CAAWn0C,YAAawV,SAAStR,EAAQsK,YAAa,OAE1D4W,EAAA,qBAAKgD,UAAU,qBAAf,sBAIpB,KAAKhO,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,MAAO,IAGvB,MAAO,4DAGOrJ,GACd,OACIkhB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,qBAAf,gCAIAhD,EAAA,qBAAKgD,UAAU,qBAAf,QAEAhD,EAAA,qBAAKgD,UAAU,kBAAkB3zB,KAAK2/C,uBAAuBlwC,IAE5DzP,KAAK4/C,qBAAqBnwC,mDAKhBA,GACnB,OACIkhB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,qBAAf,kCAIAhD,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAAC+uB,GAAD,CAAWn0C,YAAawV,SAAStR,EAAQsK,YAAa,OAG1D4W,EAAA,qBAAKgD,UAAU,qBAAf,QAEAhD,EAAA,qBAAKgD,UAAU,wBAAwB3zB,KAAK2/C,uBAAuBlwC,IAElEzP,KAAK4/C,qBAAqBnwC,iDAKlBA,GAEjB,OACIkhB,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,WACrBlqB,EAAA,cAAC8X,GAAA,EAAOsB,MAAR,CAAclY,MAAO,CAAE2Y,UAAW,QAC9B7Z,EAAA,cAAC8X,GAAA,EAAD,CAAQvnC,KAAK,UAAUkzB,QAASp0B,KAAK6/C,gBAAgBvrB,KAAKt0B,OACtD2wB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UADf,UAIAyvB,EAAA,cAAC8X,GAAA,EAAD,CAAQvnC,KAAK,SAASkzB,QAASp0B,KAAK8/C,gBAAgBxrB,KAAKt0B,OACrD2wB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UADf,yDAaKuO,GACjB,OACIkhB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,qBAAf,mCAIAhD,EAAA,qBAAKgD,UAAU,kBAAkB3zB,KAAK+/C,6BAA6BtwC,IAEnEkhB,EAAA,qBAAKgD,UAAU,qBAAf,QAGAhD,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ6J,UAAWua,WAAY,KAE5C7zB,KAAK4/C,qBAAqBnwC,yCAMnC,IAAMA,EAAUzP,KAAK0wB,MAAMjhB,QAC3B,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,OAAO9Y,KAAKggD,kBAAkBvwC,GAClC,KAAKkW,GAAiC5M,UAClC,OAAO/Y,KAAKigD,uBAAuBxwC,GACvC,KAAKkW,GAAiC3M,IAClC,OACI2X,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,oDAMpB,KAAKhL,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,OAAO9Y,KAAKkgD,qBAAqBzwC,GACrC,KAAKkW,GAAiC5M,UAMtC,KAAK4M,GAAiC3M,IAClC,OACI2X,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,mFAQxB,IAAMlhB,EAAUzP,KAAK0wB,MAAMjhB,QAC3B,OACIkhB,EAAA,qBAAKzf,IAAKzB,EAAQzK,GAAI2uB,UAAU,uBAC5BhD,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,qBAAKgD,UAAU,iCACXhD,EAAA,qBAAKgD,UAAU,uCAGVgO,KAAKC,eAAe,QAAS,CAC1BC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQgK,YAEtBkX,EAAA,qBAAKgD,UAAU,sCACXhD,EAAA,sBAAMgD,UAAU,eAAhB,WACC,IACAmN,GAAYrxB,EAAQkK,aAIjCgX,EAAA,qBAAKgD,UAAU,eACV3zB,KAAKmgD,sBA5OWztB,cCmBtBkO,mBAhBf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,IAIX,SAA4BuO,GACxB,MAAO,CACHugB,qBAAsB,SAAC/vC,GACnBwvB,EAASmhB,GAA4B3wC,EAAQzK,MAEjDy6C,qBAAsB,SAAChwC,GACnBwvB,EAASohB,GAA0B5wC,EAAQzK,QAKxC47B,CAA8F0f,ICpBxFf,uBACjB,SAAAA,EAAY7uB,GAAsB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAu/C,GAAAz/C,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAy/C,GAAAp/C,KAAAH,KACxB0wB,mFAwBN1wB,KAAK0wB,MAAM6vB,sBAAsBvgD,KAAK0wB,MAAMjhB,sDAI5C+wC,MAAM,qFAINA,MAAM,kFAKNA,MAAM,kFAINA,MAAM,yFAKe/wC,GACrB,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC3M,IAClC,MAAO,WACX,KAAK2M,GAAiC7M,KAClC,MAAO,GACX,KAAK6M,GAAiC5M,UAClC,OACI4X,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAAC+uB,GAAD,CAAWn0C,YAAawV,SAAStR,EAAQsK,YAAa,QAK9E,KAAK4L,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,OACI6X,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ8J,KAAMsa,WAAY,QAMpE,MAAO,iEAGYpkB,GACnB,OACIkhB,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ6J,UAAWua,WAAY,uDAI3BpkB,GACtB,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC3M,IAClC,MAAO,2BACX,KAAK2M,GAAiC7M,KAClC,MAAO,+BACX,KAAK6M,GAAiC5M,UAClC,MAAO,iCAEnB,KAAK4M,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,MAAO,mCAGvB,MAAO,uEAGkBrJ,GACzB,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC3M,IAClC,MAAO,WACX,KAAK2M,GAAiC7M,KAClC,MAAO,GACX,KAAK6M,GAAiC5M,UAClC,OACI4X,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAAC+uB,GAAD,CAAWn0C,YAAawV,SAAStR,EAAQsK,YAAa,OAE1D4W,EAAA,qBAAKgD,UAAU,qBAAf,sBAIpB,KAAKhO,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,OACI6X,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ8J,KAAMsa,WAAY,MAI5D,MAAO,4DAGOpkB,GACd,OACIkhB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,qBAAf,gCAIC3zB,KAAK4/C,qBAAqBnwC,mDAKhBA,GACnB,OACIkhB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,qBAAf,kCAIAhD,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,cAAC+uB,GAAD,CAAWn0C,YAAawV,SAAStR,EAAQsK,YAAa,OAGzD/Z,KAAK4/C,qBAAqBnwC,iDAKlBA,GAEjB,OACIkhB,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,WACrBlqB,EAAA,cAAC8X,GAAA,EAAOsB,MAAR,CAAclY,MAAO,CAAE2Y,UAAW,QAC9B7Z,EAAA,cAAC8X,GAAA,EAAD,CAAQvnC,KAAK,SAASkzB,QAASp0B,KAAKygD,gBAAgBnsB,KAAKt0B,OACrD2wB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UADf,yDAYKuO,GACjB,OACIkhB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,qBAAf,mCAIAhD,EAAA,qBAAKgD,UAAU,qBAAf,WAIAhD,EAAA,qBAAKgD,UAAU,cACV3zB,KAAK+/C,6BAA6BtwC,IAGtCzP,KAAK4/C,qBAAqBnwC,yCAMnC,IAAMA,EAAUzP,KAAK0wB,MAAMjhB,QAC3B,OAAQA,EAAQvO,MACZ,KAAKykB,GAAyB/M,QAC1B,OAAQnJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,OAAO9Y,KAAKggD,kBAAkBvwC,GAClC,KAAKkW,GAAiC5M,UAClC,OAAO/Y,KAAKigD,uBAAuBxwC,GACvC,KAAKkW,GAAiC3M,IAClC,OACI2X,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,oDAMpB,KAAKhL,GAAyBhN,WAC1B,OAAQlJ,EAAQ0G,cACZ,KAAKwP,GAAiC7M,KAClC,OAAO9Y,KAAKkgD,qBAAqBzwC,GACrC,KAAKkW,GAAiC5M,UAMtC,KAAK4M,GAAiC3M,IAClC,OACI2X,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,mFAQxB,IAAMlhB,EAAUzP,KAAK0wB,MAAMjhB,QAC3B,OACIkhB,EAAA,qBAAKzf,IAAKzB,EAAQzK,GAAI2uB,UAAU,wBAC5BhD,EAAA,qBAAKgD,UAAU,iBACXhD,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,qBAAKgD,UAAU,wCAGVgO,KAAKC,eAAe,QAAS,CAC1BC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQgK,YAEtBkX,EAAA,qBAAKgD,UAAU,uCACXhD,EAAA,sBAAMgD,UAAU,eAAhB,WACC,IACAmN,GAAYrxB,EAAQkK,aAIjCgX,EAAA,qBAAKgD,UAAU,eACV3zB,KAAKmgD,sBArQWztB,cCgBtBkO,mBAdf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,IAKX,SAA4BuO,GACxB,MAAO,CACHshB,sBAAuB,SAAC9wC,GACpBwvB,EAASyhB,GAA4BjxC,EAAQzK,QAK1C47B,CAA8F+f,IC0d9FC,eA3dX,SAAAA,EAAYlwB,GAAsB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAA4gD,IAC9BnhD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA8gD,GAAAzgD,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTkuC,iBAAiB,EACjB2R,gBAAgB,GALUphD,wFAY9BO,KAAKwzB,SAAS,CAAE0b,iBAAiB,oDAIjClvC,KAAKwzB,SAAS,CAAEqtB,gBAAgB,gDAEhBpxC,GAChBzP,KAAK0wB,MAAMowB,oBAAoBrxC,6CAEjBA,GACdzP,KAAK0wB,MAAMqwB,kBAAkBtxC,kDAEVA,GACnBzP,KAAK0wB,MAAMswB,uBAAuBvxC,2CAEtBA,GACZzP,KAAK0wB,MAAM0rB,gBAAgB3sC,yCAEjBlG,GACV8uB,OAAO4oB,KAAK,YAAc13C,EAAU,+CAGpC65B,KAAMvjC,KAAK,CACP4f,MAAO,uBACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,uGAMFrwB,GAEV,OAAIA,EAAK4M,OAAS,GACP5M,EAGPqwB,EAAA,0BACKrwB,EAAK+e,MAAM,EAAG,IADnB,wDAQJ,IAAM4mB,EACFtV,EAAA,mDAKJ,OACIA,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,qDAIJx2B,GAAmC,IAAAqB,EAAA9Q,KAClDyf,EACFkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACV,IAJL,yBAQE2/B,EAAU,CACZlQ,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,UACL2wB,MAAO,CAAE2T,OAAQ,SACjBpR,QAAS,kBAAMtjB,EAAKgwC,oBAAoB3gD,KAAK2Q,EAAMrB,KAHvD,WAMAkhB,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,SACL2wB,MAAO,CAAE2T,OAAQ,SACjBpR,QAAS,kBAAMtjB,EAAKiwC,kBAAkB5gD,KAAK2Q,EAAMrB,KAHrD,SAQJ,OACIkhB,EAAA,cAACuwB,GAAA,EAAD,CAAMhwC,IAAKzB,EAAQzK,GACfya,MAAOA,EACP0hC,WAAW,EACXtgB,QAASA,EACTugB,UAAW,CAAEva,gBAAiB,0BAC9BhV,MAAO,CAAEwvB,aAAc,SACvB1wB,EAAA,uBAAOgD,UAAU,wBACbhD,EAAA,2BACIA,EAAA,wBACIA,EAAA,gCACAA,EAAA,oBAAIgD,UAAU,aACVhD,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ6J,UAAWua,WAAY,OAGrDlD,EAAA,wBACIA,EAAA,gCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQgK,aAEtBkX,EAAA,wBACIA,EAAA,mCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQkK,UAJlB,KAI+BmnB,GAAYrxB,EAAQkK,UAJnD,6DAYIlK,GAAsC,IAAAkD,EAAA3S,KACxDyf,EACFkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAEV,IANL,4BAUE2/B,EAAU,CACZlQ,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,SACL2wB,MAAO,CAAE2T,OAAQ,SACjBpR,QAAS,kBAAMzhB,EAAKquC,uBAAuB7gD,KAAKwS,EAAMlD,KAH1D,WAQJ,OACIkhB,EAAA,cAACuwB,GAAA,EAAD,CAAMhwC,IAAKzB,EAAQzK,GACfya,MAAOA,EACP0hC,WAAW,EACXtgB,QAASA,EACTugB,UAAW,CAAEva,gBAAiB,0BAC9BhV,MAAO,CAAEwvB,aAAc,SACvB1wB,EAAA,uBAAOgD,UAAU,wBACbhD,EAAA,2BACIA,EAAA,wBACIA,EAAA,yCACAA,EAAA,oBAAIgD,UAAU,aACVhD,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ8J,KAAMsa,WAAY,OAGhDlD,EAAA,wBACIA,EAAA,gCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQgK,aAEtBkX,EAAA,wBACIA,EAAA,mCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQkK,UAJlB,KAI+BmnB,GAAYrxB,EAAQkK,UAJnD,2DAYEyH,GACtB,OAAQA,GACJ,KAAKmK,GAAiCjoB,KAClC,MAAO,OACX,KAAKioB,GAAiCpL,KAClC,MAAO,YAEX,KAAKoL,GAAiCnL,KAClC,MAAO,OAEX,KAAKmL,GAAiC9hB,MAClC,MAAO,QAEX,KAAK8hB,GAAiCvL,MAClC,MAAO,+DAKWvQ,GAAwC,IA0B9D6xC,EA1B8Dv8B,EAAA/kB,KAC5Dyf,EACFkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACV,IAJL,4BASE2/B,EAAU,CACZlQ,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,UACL2wB,MAAO,CAAE2T,OAAQ,SACjBpR,QAAS,kBAAMrP,EAAK+7B,oBAAoB3gD,KAAK4kB,EAAMtV,KAHvD,WAMAkhB,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,SACL2wB,MAAO,CAAE2T,OAAQ,SACjBpR,QAAS,kBAAMrP,EAAKg8B,kBAAkB5gD,KAAK4kB,EAAMtV,KAHrD,SA4CJ,OAnCA6xC,EACI3wB,EAAA,cAAC+uB,GAAD,CAAWn0C,YAAawV,SAAStR,EAAQsK,YAAa,MAmCtD4W,EAAA,cAACuwB,GAAA,EAAD,CAAMhwC,IAAKzB,EAAQzK,GACfya,MAAOA,EACP0hC,WAAW,EACXtgB,QAASA,EACTugB,UAAW,CAAEva,gBAAiB,0BAC9BhV,MAAO,CAAEwvB,aAAc,SACvB1wB,EAAA,uBAAOgD,UAAU,wBACbhD,EAAA,2BACIA,EAAA,wBACIA,EAAA,gCACAA,EAAA,oBAAIgD,UAAU,aACVhD,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ6J,UAAWua,WAAY,OAGrDlD,EAAA,wBACIA,EAAA,qCACAA,EAAA,oBAAIgD,UAAU,aACT2tB,IAGT3wB,EAAA,wBACIA,EAAA,gCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQgK,aAEtBkX,EAAA,wBACIA,EAAA,mCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQkK,UAJlB,KAI+BmnB,GAAYrxB,EAAQkK,UAJnD,yDAYAlK,GAAkC,IAAAirB,EAAA16B,KAChDyf,EACFkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,aACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBACXyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACV,IAJL,sBAQE2/B,EAAU,CACZlQ,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,UACL2wB,MAAO,CAAE2T,OAAQ,SACjBpR,QAAS,kBAAMsG,EAAKomB,oBAAoB3gD,KAAKu6B,EAAMjrB,KAHvD,WAMAkhB,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,SACL2wB,MAAO,CAAE2T,OAAQ,SACjBpR,QAAS,kBAAMsG,EAAKqmB,kBAAkB5gD,KAAKu6B,EAAMjrB,KAHrD,SAQJ,OACIkhB,EAAA,cAACuwB,GAAA,EAAD,CAAMhwC,IAAKzB,EAAQzK,GACfya,MAAOA,EACP0hC,WAAW,EACXtgB,QAASA,EACTugB,UAAW,CAAEva,gBAAiB,0BAC9BhV,MAAO,CAAEwvB,aAAc,SACvB1wB,EAAA,uBAAOgD,UAAU,wBACbhD,EAAA,2BACIA,EAAA,wBACIA,EAAA,gCACAA,EAAA,oBAAIgD,UAAU,aACVhD,EAAA,cAACyuB,GAAD,CAAMpgB,OAAQvvB,EAAQ6J,UAAWua,WAAY,OAGrDlD,EAAA,wBACIA,EAAA,+BACAA,EAAA,oBAAIgD,UAAU,aACTlkB,EAAQuK,QAGjB2W,EAAA,wBACIA,EAAA,gCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQgK,aAEtBkX,EAAA,wBACIA,EAAA,mCACAA,EAAA,oBAAIgD,UAAU,aAAagO,KAAKC,eAAe,QAAS,CACpDC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOtyB,EAAQkK,UAJlB,KAI+BmnB,GAAYrxB,EAAQkK,UAJnD,+CAapB,IAAIw8B,EACJ,GAAgC,IAA5Bn2C,KAAK0wB,MAAMylB,MAAMjpC,OACjBipC,EACIxlB,EAAA,qBAAKgD,UAAU,WAAf,mCAID,CACH,IAAM1qB,EAAWjJ,KAAK0wB,MAAMylB,MAAM9sC,IAAI,SAACoG,GACnC,OACIkhB,EAAA,qBAAKzf,IAAKzB,EAAQzK,IACd2rB,EAAA,cAAC4wB,GAAD,CACI9xC,QAASA,OAIzB0mC,EACIxlB,EAAA,qBAAKkB,MAAO,CAAE4T,UAAW,SACpBx8B,GAIb,OACI0nB,EAAA,cAACA,EAAA,SAAD,KACKwlB,0CAMT,IAAIqL,EACJ,GAAiC,IAA7BxhD,KAAK0wB,MAAM8wB,OAAOt0C,OAClBs0C,EACI7wB,EAAA,qBAAKgD,UAAU,WAAf,oCAID,CACH,IAAM1qB,EAAWjJ,KAAK0wB,MAAM8wB,OAAOn4C,IAAI,SAACoG,GACpC,OACIkhB,EAAA,qBAAKzf,IAAKzB,EAAQzK,IACd2rB,EAAA,cAAC8wB,GAAD,CACIhyC,QAASA,OAIzB+xC,EACI7wB,EAAA,qBAAKkB,MAAO,CAAE4T,UAAW,SACpBx8B,GAIb,OACI0nB,EAAA,cAACA,EAAA,SAAD,KACK6wB,mCAKL/2C,GACJ,OACIA,EAASvJ,OAASqqB,GAAoC9hB,OACtDgB,EAASvJ,OAASqqB,GAAoCvL,uCAK1D,GAAIhgB,KAAK0hD,QAAQ1hD,KAAK0wB,MAAMjmB,UAAW,CACnC,IAAMk3C,EAAc3hD,KAAK0wB,MAAM8wB,OAAOt0C,OAChC00C,EAAa5hD,KAAK0wB,MAAMylB,MAAMjpC,OAEpC,OACIyjB,EAAA,qBAAKgD,UAAU,YACXhD,EAAA,qBAAKgD,UAAU,kCAAf,UAAwDiuB,EAAxD,KACC5hD,KAAK6hD,cACNlxB,EAAA,qBAAKgD,UAAU,kCAAf,WAAyDguB,EAAzD,KACC3hD,KAAK8hD,gBAId,IAAMH,EAAc3hD,KAAK0wB,MAAM8wB,OAAOt0C,OAEtC,OACIyjB,EAAA,qBAAKgD,UAAU,YACXhD,EAAA,qBAAKgD,UAAU,kCAAf,WAAyDguB,EAAzD,KACC3hD,KAAK8hD,uBAtdQpvB,aCmBnBkO,IC7BViZ,GAWAkI,GDkBUnhB,eArBf,SAAyB5/B,EAAyB0vB,GAC9C,MAAO,IAGJ,SAA4BuO,GAC/B,MAAO,CACH6hB,oBAAqB,SAACrxC,GAClBwvB,EAASmhB,GAA4B3wC,EAAQzK,MAEjD+7C,kBAAmB,SAACtxC,GAChBwvB,EAASohB,GAA0B5wC,EAAQzK,MAE/Cg8C,uBAAwB,SAACvxC,GACrBwvB,EAAS+iB,GAAmCvyC,EAAQzK,MAExDo3C,gBAAiB,SAAC3sC,OAMXmxB,CAAoGsS,cC7B9G2G,sVAWAkI,uDAumCUE,eApkCX,SAAAA,EAAYvxB,GAA8B,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAiiD,IACtCxiD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAmiD,GAAA9hD,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTqmC,UAAU,EACV0S,WAAYF,GAAWv2C,KACvB64C,cAAe,CACX7wC,UAAW,MAEf42C,eAAgBH,GAAeI,IATG1iD,sHAiBtCO,KAAK0wB,MAAMwpB,0DAIX,IAAMzvC,EAAWzK,KAAK0wB,MAAMjmB,SAC5BzK,KAAK0wB,MAAM0pB,oBAAoB3vC,EAASyK,wDAIxC,GAAKlV,KAAK0wB,MAAMjqB,aAAhB,CAGA,IAAMgE,EAAWzK,KAAK0wB,MAAMjmB,SAC5BzK,KAAK0wB,MAAM2pB,mBAAmB5vC,EAASyK,yDAIvC,GAAKlV,KAAK0wB,MAAMjqB,aAAhB,CAGA,IAAMgE,EAAWzK,KAAK0wB,MAAMjmB,SAC5BzK,KAAK0wB,MAAM4pB,mBAAmB7vC,EAASyK,4DAIvClV,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWuI,kEAGzB92C,GACdtL,KAAK0wB,MAAM2xB,kBAAkB/2C,2CAGjB4F,EAAa5F,GACzB,OAAQ4F,GACJ,IAAK,kBACDlR,KAAK0wB,MAAM2xB,kBAAkB/2C,yCAOrC83B,KAAMvjC,KAAK,CACP4f,MAAO,yBACPoR,MAAO,OACPwS,QACI1S,EAAA,+FAOGrlB,GAMXtL,KAAKwzB,SAAS,CAAE2oB,cAAe,CAAE7wC,UAAWA,oDAK5CtL,KAAKwzB,SAAS,CAAE2oB,cAAe,CAAE7wC,UAAW,8CAI5C,OACIqlB,EAAA,yBACK3wB,KAAKsiD,yDASd,GAAItiD,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoC9hB,OACjEzJ,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoCvL,MACjE,OACI2Q,EAAA,mBAAGkB,MAAO,CAAEgpB,UAAW,WAAvB,uCACwClqB,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuBlT,KAAK0wB,MAAMjqB,aAAczB,KAAM2rB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,QAAb,SADzG,mDAQR,GAAIzzB,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoC9hB,OACjEzJ,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoCvL,MACjE,OACI2Q,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuBlT,KAAK0wB,MAAMjqB,aAAczB,KAAM2rB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,QAAb,+DAOzE,GAAKzzB,KAAK0wB,MAAMjqB,aAGhB,OACIkqB,EAAA,qBAAKgD,UAAU,+DACXhD,EAAA,qBAAKgD,UAAU,mCACX6d,wBAA0B,CAAEC,OAAQC,UAAOC,MAAM3xC,KAAK0wB,MAAMjqB,aAAalB,aAAe,gDAOxFoa,GACZ,OACIgR,EAAA,qBAAKgD,UAAU,cACXhD,EAAA,qBAAKgD,UAAU,iBAEXhD,EAAA,qBAAKgD,UAAU,SACXhD,EAAA,mBAAGuD,KAAM,YAAcvU,EAAII,MAAMxW,SAAU4qB,OAAO,UAAUxU,EAAII,MAAMxW,UACrE,IAFL,SAGMoW,EAAII,MAAMxW,SAHhB,sDAkBZ,GAAKvJ,KAAK0wB,MAAMjqB,aAGhB,OACIkqB,EAAA,cAAC4xB,GAAD,CAAoBnpC,eAAgBpZ,KAAK0wB,MAAMjqB,aAAazB,4CAIrDyF,GACX,OAAQA,EAASvJ,MACb,KAAMqqB,GAAoCjoB,KACtC,OACIqtB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAjB,QAER,KAAMqqB,GAAoCpL,KACtC,OACIwQ,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,gEAENkR,EAAA,yBAAKA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,MAAM2wB,MAAO,CAAEuU,YAAa,SAA5C,6CACAzV,EAAA,qBAAKkB,MAAO,CAAE2Y,UAAW,SACrB7Z,EAAA,cAAC8X,GAAA,EAAD,CACIrU,QAASp0B,KAAK86C,YAAYxmB,KAAKt0B,OADnC,4BAOhB,KAAMurB,GAAoC1L,uBACtC,OACI8Q,EAAA,yBACIA,EAAA,yBAAKA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,UAAYspB,MAAM,IAAzD,mBAAiFpqB,EAAA,kCAAjF,eACAA,EAAA,yBAAKA,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,SAASvyB,KAAK,SAASkzB,QAASp0B,KAAKo6C,oBAAoB9lB,KAAKt0B,OAA3E,oBAGjB,KAAMurB,GAAoCzL,0BACtC,OACI6Q,EAAA,yBACIA,EAAA,yBAAKA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,UAAvC,iBAAiEd,EAAA,kCAAjE,8BACAA,EAAA,qBAAKkB,MAAO,CAAE2Y,UAAW,SACrB7Z,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,QAAQvyB,KAAK,UAAUkzB,QAASp0B,KAAKq6C,mBAAmB/lB,KAAKt0B,OAA1E,qBACA2wB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OAAOvyB,KAAK,SAASkzB,QAASp0B,KAAKs6C,mBAAmBhmB,KAAKt0B,OAAxE,uBAIhB,KAAMurB,GAAoC3hB,OACtC,OAAQ+mB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAjB,UACZ,KAAMqqB,GAAoC9hB,MACtC,OAAQknB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAjB,SACZ,KAAMqqB,GAAoCvL,MACtC,OACI2Q,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,cACVuO,gBAAiB,GACjB/iB,MAAM,oBAENkR,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAS+5C,MAAM,SAASppB,MAAO,CAAEuU,YAAa,SAA/D,kEAOhB,QAAKpmC,KAAK0wB,MAAMjqB,eAGZzG,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoCvL,OACjEhgB,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoC9hB,OACjEzJ,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoC3hB,gDAOrE,OAAK5J,KAAKwhB,WAQNmP,EAAA,cAAC6xB,GAAD,CAAS/7C,aAAczG,KAAK0wB,MAAMjqB,aAAcgE,SAAUzK,KAAK0wB,MAAMjmB,WANjEkmB,EAAA,mBAAGgD,UAAU,WAAb,2FAaR,GAAK3zB,KAAK0wB,MAAMjqB,aAGhB,OACIkqB,EAAA,cAACuwB,GAAA,EAAD,CACIzhC,MAAOkR,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBAAjB,SACPkgD,UAAW,CAAEva,gBAAiB,OAAQpV,MAAO,SAC7CkC,UAAU,YACVhD,EAAA,yBACIA,EAAA,yBACIA,EAAA,qBAAKgD,UAAU,SAAf,UAEJhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,cAAC0tB,GAAD,CAAQ/0C,OAAQtJ,KAAK0wB,MAAMjqB,aAAasZ,MAAO8T,WAAY,MAmB/DlD,EAAA,qBAAKgD,UAAU,8BACXhD,EAAA,qBAAKgD,UAAU,OACXhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,sBAAMgD,UAAU,SAAhB,gBAEJhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,qBAAKgD,UAAU,aACVgO,KAAKC,eAAe,QAAS,CAC1BC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAO/hC,KAAK0wB,MAAMjqB,aAAagT,cAK9CkX,EAAA,qBAAKgD,UAAU,OACXhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,sBAAMgD,UAAU,SAAhB,iBAEJhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,qBAAKgD,UAAU,cACVgO,KAAKC,eAAe,QAAS,CAC1BC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAO/hC,KAAK0wB,MAAMjqB,aAAaoT,mEAW9D,IAYI4oC,EAZEh4C,EAAWzK,KAAK0wB,MAAMjmB,SACtBxB,EAAWjJ,KAAK0wB,MAAM/lB,cACtByE,EAAcpP,KAAK0wB,MAAM9lB,iBAE/B,IAAMH,EAASvJ,OAASqqB,GAAoC9hB,OACxDgB,EAASvJ,OAASqqB,GAAoCvL,SAIzC,OAAb/W,GAAqC,OAAhBmG,GAmCzB,OA9BIqzC,EADAx5C,EAASiE,OAELyjB,EAAA,0DAMAA,EAAA,yBACIA,EAAA,yBACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,qBAAqB+5C,MAAM,UAAUyH,aAAa,WADjE,aAEK,IACD/xB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SAAW95B,EAASiE,QAC9C,IAJL,kBAKoBjE,EAASiE,OAAS,EAAI,IAAM,GAC3C,IANL,MAQK,IACDyjB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SAAW3zB,EAAYlC,QACjD,IAVL,kBAWoBkC,EAAYlC,OAAS,EAAI,IAAM,IAGnDyjB,EAAA,yBACIA,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAI,+BAAiC3jC,KAAK0wB,MAAMjqB,aAAazB,IAClE2rB,EAAA,cAAC8X,GAAA,EAAD,2BAOhB9X,EAAA,qBAAKgD,UAAU,OACXhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,sBAAMgD,UAAU,SAAhB,UAEJhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,qBAAKgD,UAAU,YACV8uB,iDAQDx5C,EAAuCmG,GACvD,OAAKnG,EAASiE,OAQNyjB,EAAA,yBACIA,EAAA,yBACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,qBAAqB+5C,MAAM,UAAUyH,aAAa,WADjE,SAEK,IACAz5C,EAASiE,OAAS,EAAI,MAAQ,KAC9B,IACDyjB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SAAW95B,EAASiE,QAC9C,IANL,kBAOoBjE,EAASiE,OAAS,EAAI,IAAM,GAC3C,IARL,MAUK,IACDyjB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SAAW3zB,EAAYlC,QACjD,IAZL,qBAauBkC,EAAYlC,OAAS,EAAI,IAAM,IAEtDyjB,EAAA,yBACIA,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAI,+BAAiC3jC,KAAK0wB,MAAMjqB,aAAczB,IACnE2rB,EAAA,cAAC8X,GAAA,EAAD,2BAxBZ9X,EAAA,qBAAKgD,UAAU,WAAf,yEA8DQlpB,GAChB,OAAQA,EAASvJ,MACb,KAAMqqB,GAAoCjoB,KAE1C,KAAMioB,GAAoCpL,KACtC,MAAO,UACX,KAAMoL,GAAoC1L,uBACtC,MAAO,iCACX,KAAM0L,GAAoCzL,0BACtC,MAAO,oCACX,KAAMyL,GAAoC3hB,OAE1C,KAAM2hB,GAAoC9hB,MAE1C,KAAM8hB,GAAoCvL,MACtC,MAAO,4DAMf,OACI2Q,EAAA,sBAAMgD,UAAU,aAWX3zB,KAAK2iD,qEAMd,IAAMl4C,EAAWzK,KAAK0wB,MAAMjmB,SAC5B,GAAMA,EAASvJ,OAASqqB,GAAoC9hB,OACxDgB,EAASvJ,OAASqqB,GAAoCvL,MAD1D,CAFe,IAAA6xB,EAO6B7xC,KAAK0wB,MAAzC/lB,EAPOknC,EAOPlnC,cAAeC,EAPRinC,EAOQjnC,iBACvB,GAAyB,OAArBA,GAA+C,OAAlBD,EAAjC,CAGA,IAAM45B,EAAQ55B,EAAcuC,OAAStC,EAAiBsC,OAChDuS,EACFkR,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WACZ,IADL,iBAGK,IACDyvB,EAAA,sBAAMgD,UAAU,+BAAhB,IAAgD4Q,EAAhD,MAGR,OACI5T,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,cAACuwB,GAAA,EAAD,CACIvtB,UAAU,2CACVytB,UAAW,CAAEva,gBAAiB,OAAQpV,MAAO,SAC7ChS,MAAOA,GACNzf,KAAK4iD,oBAAoBj4C,EAAeC,kDAOrD,GAAK5K,KAAK0wB,MAAMjqB,cAGZzG,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoCpL,KAGrE,OACIwQ,EAAA,cAAC8X,GAAA,EAAD,CACIrU,QAASp0B,KAAK86C,YAAYxmB,KAAKt0B,OADnC,wEASJ,IAAMimC,EACFtV,EAAA,4CAIJ,OACIA,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,gDAKzB,IAAM4c,EAAS,CAEPlyB,EAAA,cAAC+S,GAAA,EAAD,CACIxyB,IAAI,cACJyyB,GAAE,gBAAAzwB,OAAkBlT,KAAK0wB,MAAMjqB,aAAczB,KAC7C2rB,EAAA,cAAC8X,GAAA,EAAD,CACIrU,QAASp0B,KAAK8iD,cAAcxuB,KAAKt0B,MACjCyzB,KAAK,WAIrB,GAAKzzB,KAAK0wB,MAAMjqB,aAAhB,CAIA,IAAIqb,EAEAA,EADA9hB,KAAKwhB,WAEDmP,EAAA,sBAAMgD,UAAU,cAAhB,IAA+B3zB,KAAK0wB,MAAMjqB,aAAa2C,QAAQ8D,OAA/D,KAGU,GAElB,IAAMuS,EACFkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SADf,UAGK4gB,GAGT,OACI6O,EAAA,cAACuwB,GAAA,EAAD,CACIvtB,UAAU,uBACVytB,UAAW,CAAEva,gBAAiB,OAAQpV,MAAO,SAC7ChS,MAAOA,EACPsjC,MAAOF,GAEN7iD,KAAKu+C,6DAMd,OACI5tB,EAAA,qBAAKgD,UAAU,0BACV3zB,KAAKgjD,uBAELhjD,KAAKu+C,yDAKF9uC,GACZzP,KAAK0wB,MAAMmvB,gBAAgBpwC,EAAQzK,gDAGnBsG,GAAuC,IAInD43B,EAJmDpyB,EAAA9Q,KACjDyK,EAAWzK,KAAK0wB,MAAMjmB,SACXA,EAASvJ,OAASqqB,GAAoCvL,QACnEvV,EAASvJ,KAASqqB,GAAoC9hB,OAE1D,OAAQgB,EAASvJ,MACb,KAAMqqB,GAAoCjoB,KAEtC,MACJ,KAAMioB,GAAoCpL,KAC1C,KAAMoL,GAAoC1L,uBAC1C,KAAM0L,GAAoCzL,0BAC1C,KAAMyL,GAAoC3hB,OACtC,MACJ,KAAM2hB,GAAoC9hB,MAC1C,KAAM8hB,GAAoCvL,MACtCkjB,EACIvS,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAAS,SAAA50B,GAAa,IAAV0R,EAAU1R,EAAV0R,IAAYJ,EAAKmyC,gBAAgB/xC,EAAK5F,KACpDqlB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,mBACXyf,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WADf,wCAMhB,GAAKgiC,EAGL,OACIvS,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAASN,EAAMO,QAAS,CAAC,UAC/B9S,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAWyyB,UAAU,iEAKzB,IAAAhhB,EAAA3S,KACf,IAAKA,KAAKwhB,WACN,OACImP,EAAA,cAACuwB,GAAA,EAAD,CACIvtB,UAAU,uBACVlU,MAAOkR,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,kBAExByvB,EAAA,mBAAGkB,MAAO,CAAEgpB,UAAW,SAAUjK,UAAW,WAA5C,8CAOZ,IAAMiS,EAAS,CAEPlyB,EAAA,cAAC+S,GAAA,EAAD,CACIxyB,IAAI,sBACJyyB,GAAE,wBAAAzwB,OAA0BlT,KAAK0wB,MAAMjqB,aAAczB,KACrD2rB,EAAA,cAAC8X,GAAA,EAAD,CACIrU,QAASp0B,KAAKkjD,sBAAsB5uB,KAAKt0B,OACzC2wB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAFf,sBAQZ,GAAkD,IAA9ClB,KAAK0wB,MAAMjqB,aAAa4E,WAAW6B,OAAc,CACjD,IAAMvN,EACFgxB,EAAA,qBAAKgD,UAAU,WAAf,2DAIJ,OACIhD,EAAA,cAACuwB,GAAA,EAAD,CACIvtB,UAAU,uBACVytB,UAAW,CAAEva,gBAAiB,OAAQpV,MAAO,SAC7ChS,MAAOkR,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBAAjB,sBACP6hD,MAAOF,GAEPlyB,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,OAAOvB,QAASA,KAKxC,IAAMwjD,EAAkBnjD,KAAK0wB,MAAMjqB,aAAa4E,WAAWhC,IAAI,SAACiC,GAE5D,OACIqlB,EAAA,qBAAKgD,UAAU,uBAAuBziB,IAAK2E,OAAOvK,EAAUC,cACxDolB,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,cAACyyB,GAAD,CACI93C,UAAWA,EACX8wC,gBAAiBzpC,EAAK+d,MAAM0rB,mBAEpCzrB,EAAA,qBAAKgD,UAAU,aACVhhB,EAAK0wC,oBAAoB/3C,OAMpC0W,EAAiBhiB,KAAK0wB,MAAMjqB,aAAa4E,WAAW6B,OACpDuS,EACFkR,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,gBADf,aAGK,IACDyvB,EAAA,sBAAMgD,UAAU,cAAhB,IAA+B3R,EAA/B,MAGR,OACI2O,EAAA,cAACuwB,GAAA,EAAD,CACIvtB,UAAU,4DACVlU,MAAOA,EACPsjC,MAAOF,GAEPlyB,EAAA,qBAAKgD,UAAU,mBACVwvB,mDAOb,OAAQnjD,KAAK0wB,MAAMjmB,SAASvJ,MACxB,KAAKqqB,GAAoCjoB,KAEzC,KAAKioB,GAAoC3hB,OACrC,OACJ,KAAK2hB,GAAoC9hB,MASzC,KAAK8hB,GAAoCvL,MACrC,OACI2Q,EAAA,qBAAKgD,UAAU,mCACXhD,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAI,eAAiB3jC,KAAK0wB,MAAMjqB,aAAazB,IAClD2rB,EAAA,cAAC8X,GAAA,EAAD,CAAQ3X,KAAK,SAAQH,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAhC,2DASpB,IAAMwgD,EAAW1hD,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoC9hB,OAC9EzJ,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoCvL,MAE/DwB,EAAWxhB,KAAK0wB,MAAMjqB,aAAa+a,SAEzC,IAAKA,EACD,OACImP,EAAA,mBAAGkB,MAAO,CAAE+e,UAAW,WAAvB,qDAMR,IAEI9uB,EAFEwhC,EAAO,GAiBb,GAbIxhC,EADA9hB,KAAK0wB,MAAMjqB,aAAaqb,YAAc,EACxBjM,OAAO7V,KAAK0wB,MAAMjqB,aAAaqb,YAAc,GAE7C,OAElBwhC,EAAKxsB,KACDnG,EAAA,cAAC4yB,GAAA,EAAKC,QAAN,CACIC,IAAK9yB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAjB,WAAkCyvB,EAAA,sBAAMgD,UAAU,6BAAhB,IAA8C7R,EAA9C,MACvC5Q,IAAI,UACJ2gB,MAAO,CAAE8T,cAAe,WACvB3lC,KAAK0jD,qBAIVliC,EACA,GAAIkgC,EAAS,CACT,IAAMiC,EAAoB3jD,KAAK0wB,MAAM1nB,aAAakE,OAASlN,KAAK0wB,MAAMtmB,cAAc8C,OAC9E02C,EACFjzB,EAAA,sBAAMgD,UAAU,6BAAhB,IACMgwB,GAAqB,OAD3B,KAIJL,EAAKxsB,KACDnG,EAAA,cAAC4yB,GAAA,EAAKC,QAAN,CAAcC,IAAK9yB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAjB,YAAqC0iD,EAArC,KAA6D1yC,IAAI,QAAQ2gB,MAAO,CAAE8T,cAAe,WAChHhV,EAAA,cAACkzB,GAAD,CAAU1N,MAAOn2C,KAAK0wB,MAAM1nB,aAAcw4C,OAAQxhD,KAAK0wB,MAAMtmB,cAAeK,SAAUzK,KAAK0wB,MAAMjmB,iBAGtG,CACH,IACIq5C,EADEC,EAAa/jD,KAAK0wB,MAAMtmB,cAAc8C,OAGxC42C,EADAC,EACaluC,OAAOkuC,GAEP,OAEjBT,EAAKxsB,KACDnG,EAAA,cAAC4yB,GAAA,EAAKC,QAAN,CAAcC,IAAK9yB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAjB,YAAoCyvB,EAAA,sBAAMgD,UAAU,6BAAhB,IAA8CmwB,EAA9C,MAA0E5yC,IAAI,SAAS2gB,MAAO,CAAE8T,cAAe,WAClKhV,EAAA,cAACkzB,GAAD,CAAU1N,MAAO,GAAIqL,OAAQxhD,KAAK0wB,MAAMtmB,cAAeK,SAAUzK,KAAK0wB,MAAMjmB,aAM5F,OACIkmB,EAAA,cAAC4yB,GAAA,EAAD,CACIS,iBAAiB,UACjBrwB,UAAU,wBACVswB,UAAU,EACVnzB,KAAK,QACLozB,YAAY,OAEXZ,+CAMT,OACI3yB,EAAA,sBAAMgD,UAAU,aACZhD,EAAA,sBAAMgD,UAAU,oBACX3zB,KAAKmkD,iBAGVxzB,EAAA,sBAAMgD,UAAU,oBACZhD,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,OAAOW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,2DAO7EA,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWU,sEAIvCv6C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWW,oEAIvCx6C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWY,yEAIvCz6C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWa,qEAIvC16C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWc,qEAIvC36C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWe,2DAIvC,OADkClkC,EAAxBxF,KAEN,IAAK,qBACDlR,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWU,oBACvC,MACJ,IAAK,cACDv6C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWW,eACvC,MACJ,IAAK,UACDx6C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWa,oBACvC,MACJ,IAAK,aACD16C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWc,cACvC,MACJ,IAAK,iBACD36C,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWY,2DAMnCz6C,KAAK0wB,MAAMjqB,aACvB,OAAQzG,KAAK0wB,MAAMjmB,SAASvJ,MACxB,KAAMqqB,GAAoCjoB,KAa1C,KAAMioB,GAAoCpL,KACtC,OACIwQ,EAAA,0BACIA,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,UACLkzB,QAASp0B,KAAK86C,YAAYxmB,KAAKt0B,OAFnC,2BAOZ,KAAMurB,GAAoC1L,uBACtC,OACI8Q,EAAA,0BACIA,EAAA,cAACqD,GAAA,EAAD,CACIC,UAAU,SACVuO,gBAAiB,GACjB/iB,MAAM,0FAENkR,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,SAASvyB,KAAK,SAASkzB,QAASp0B,KAAKo6C,oBAAoB9lB,KAAKt0B,OAA3E,yBAKhB,KAAMurB,GAAoCzL,0BACtC,OACI6Q,EAAA,0BACIA,EAAA,0EACAA,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,QAAQvyB,KAAK,UAAUkzB,QAASp0B,KAAKq6C,mBAAmB/lB,KAAKt0B,OAA1E,UACA2wB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OAAOvyB,KAAK,SAASkzB,QAASp0B,KAAKs6C,mBAAmBhmB,KAAKt0B,OAAxE,WAGZ,KAAMurB,GAAoC3hB,OACtC,IAAMs5B,EACFvS,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAASp0B,KAAKg7C,YAAY1mB,KAAKt0B,OACjC2wB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,sBAAf,yBAKR,OACIyf,EAAA,0BACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAASN,EAAMO,QAAS,CAAC,UAC/B9S,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,UACVvY,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAU+5C,MAAM,SAASppB,MAAO,CAAEO,SAAU,aAK3E,KAAM7G,GAAoC9hB,MACtC,IAAMyxC,EACFvqB,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAASp0B,KAAKg7C,YAAY1mB,KAAKt0B,OACjC2wB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,sBAAf,wBAGAyf,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,WAAf,iBAGAyf,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,cAAf,gBAKR,OACIyf,EAAA,0BACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAAS0X,EAAWzX,QAAS,CAAC,UACpC9S,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,UACVvY,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAU+5C,MAAM,SAASppB,MAAO,CAAEO,SAAU,aAK3E,KAAM7G,GAAoCvL,MACtC,IAAMm7B,EACFxqB,EAAA,cAACwS,GAAA,EAAD,CAAM/O,QAASp0B,KAAKg7C,YAAY1mB,KAAKt0B,OACjC2wB,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,WAAf,iBAGAyf,EAAA,cAACwS,GAAA,EAAKG,KAAN,CAAWpyB,IAAI,cAAf,gBAKR,OACIyf,EAAA,0BACIA,EAAA,cAAC4S,GAAA,EAAD,CAAUC,QAAS2X,EAAW1X,QAAS,CAAC,UACpC9S,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,UACVvY,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAU+5C,MAAM,SAASppB,MAAO,CAAEO,SAAU,wDAU/EpyB,KAAKwzB,SAAS,CACV0uB,eAAgBliD,KAAKgB,MAAMkhD,iBAAmBH,GAAeI,GAAKJ,GAAeqC,KAAOrC,GAAeI,sDAK3G,IAAIxG,EAMJ,OAJIA,EADA37C,KAAKgB,MAAMkhD,iBAAmBH,GAAeI,GAClC,aAEA,WAGXxxB,EAAA,qBAAKgD,UAAU,6BAA6BS,QAASp0B,KAAKqkD,gBAAgB/vB,KAAKt0B,OAC3E2wB,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,qBAAKgD,UAAU,mCAEfhD,EAAA,qBAAKgD,UAAU,mCAEfhD,EAAA,qBAAKgD,UAAU,oCAGnBhD,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,qBAAKgD,UAAU,mCAEfhD,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAMy6C,KAEhBhrB,EAAA,qBAAKgD,UAAU,oCAMnBhD,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,qBAAKgD,UAAU,mCAEfhD,EAAA,qBAAKgD,UAAU,mCAEfhD,EAAA,qBAAKgD,UAAU,sEAU3B,OAAQ3zB,KAAKgB,MAAM+4C,YACf,KAAKF,GAAWuI,sBACZ,OACIzxB,EAAA,cAAC2hB,GAAA,EAAD,CAAU3O,GAAI,yBAEtB,KAAKkW,GAAWU,kBACZ,OAAO5pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,eAAiB3jC,KAAK0wB,MAAMjqB,aAAazB,KACvE,KAAK60C,GAAWW,aACZ,OAAO7pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,gBAAkB3jC,KAAK0wB,MAAMjqB,aAAazB,KACxE,KAAK60C,GAAWa,kBACZ,OAAO/pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMjqB,aAAazB,KAC7E,KAAK60C,GAAWY,gBACZ,OAAO9pB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,+BAAiC3jC,KAAK0wB,MAAMjqB,aAAazB,KACvF,KAAK60C,GAAWc,YACZ,OAAOhqB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,eAAiB3jC,KAAK0wB,MAAMjqB,aAAazB,KACvE,KAAK60C,GAAWe,kBACZ,OAAOjqB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMjqB,aAAazB,KAC7E,KAAK60C,GAAWv2C,MAKpB,IAAIghD,EACAC,EACAvkD,KAAKgB,MAAMkhD,iBAAmBH,GAAeI,IAC7CmC,EAAc,2DACdC,EAAqB,kEAErBD,EAAc,yDACdC,EAAqB,mEAEzBD,GAAe,0BACfC,GAAsB,0BAEtB,IACMC,EADOxkD,KAAK0wB,MAAMjqB,aAExB,OACIkqB,EAAA,qBAAKgD,UAAU,4CACXhD,EAAA,cAACga,GAAD,CAAUrE,QAAStmC,KAAK4qC,sBACxBja,EAAA,qBAAKkB,MAAO,CAAE4yB,aAAc,qBACxB9zB,EAAA,cAAC0U,GAAD,CAAmB5+B,aAAc+9C,EAAM5hB,mBAAoB5iC,KAAK0wB,MAAMhmB,eAE1EimB,EAAA,qBAAKgD,UAAU,mDACXhD,EAAA,qBAAKgD,UAAU,uDACXhD,EAAA,qBAAKgD,UAAW2wB,EAAazyB,MAAO,CAAE6yB,UAAW,QAC5C1kD,KAAK2kD,aAEVh0B,EAAA,qBAAKgD,UAAU,iCACV3zB,KAAK4kD,0BAEVj0B,EAAA,qBAAKgD,UAAW4wB,GACXvkD,KAAK6kD,qBAGdl0B,EAAA,qBAAKgD,UAAU,+BACV3zB,KAAK8kD,wBA5jCCpyB,aC6ChBkO,ICtGViZ,GDsGUjZ,eA1Df,SAAyB5/B,EAAmB+jD,GACxC,IAAMzjD,EAAYN,EAAMI,MAAMyH,YAAYvH,UAC1C,IAAKA,EACD,MAAM,IAAIf,MAAM,4BAEpB,GAAIe,EAAUwH,OAAS3J,EAAqB4J,OACxC,MAAM,IAAIxI,MAAM,wBANoD,IASpEkG,EACAnF,EADAmF,aAAcgE,EACdnJ,EADcmJ,SAAUC,EACxBpJ,EADwBoJ,YAAaC,EACrCrJ,EADqCqJ,cAAeC,EACpDtJ,EADoDsJ,iBAAkB5B,EACtE1H,EADsE0H,aAAcoB,EACpF9I,EADoF8I,cAQlF2kB,EAFF/tB,EAHAiuB,GACIF,cAAiBlc,IAIC9I,OAAO,SAACilB,GAC9B,OAAQA,EAAa5V,iBAAmB3S,EAAazB,KAGzD,MAAO,CACHyB,eAAcgE,WAAUC,cAAaC,gBAAeC,mBAAkB5B,eAAcoB,gBAAe2kB,kBAIpG,SAA4BkQ,GAC/B,MAAO,CACH+lB,UAAW,SAAChgD,GACRi6B,EAAS4B,GAAa77B,KAE1Bk1C,UAAW,WACPjb,EAAS4B,OAEbuZ,oBAAqB,SAACllC,GAClB+pB,EAAS4B,GAAiC3rB,KAE9CmlC,mBAAoB,SAACnlC,GACjB+pB,EAAS4B,GAA6B3rB,KAE1ColC,mBAAoB,SAACplC,GACjB+pB,EAAS4B,GAA6B3rB,KAE1CmtC,kBAAmB,SAAC/2C,GAChB2zB,EhC4FL,SAAyB3zB,GAC5B,sBAAA9L,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,IAAAl+B,EAAA8rC,EAAA9+B,EAAAzE,EAAAwF,EAAAtI,EAAA4O,EAAAg2B,EAAA,OAAAt5B,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACH2sB,EAvBG,CACH/9B,KAAM7B,EAAW4lD,mCA0BXjkD,EAAQk+B,KACH99B,MAAMyH,YAAYvH,UAN1B,CAAA8Q,EAAAE,KAAA,eAOC2sB,EAASyU,GAAqB,CAC1Bh0C,KAAM,YACNC,QAAS,oCATdyS,EAAAG,OAAA,oBAAAu6B,EAwBC9rC,EATA4M,KAAQG,cAAiBC,EAf1B8+B,EAe0B9+B,MAAOzE,EAfjCujC,EAeiCvjC,SACzBwF,EAQP/N,EARA6N,IAAOE,OAIKtI,EAIZzF,EAPAI,MACIyH,YACIvH,UACImF,aApBb,CAAA2L,EAAAE,KAAA,eA2BC2sB,EAASyU,GAAqB,CAC1Bh0C,KAAM,YACNC,QAAS,oCA7BdyS,EAAAG,OAAA,wBAkCG8C,EAAU5O,EAAazB,GAEvBqmC,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAtC1CoB,EAAAC,KAAA,GAAAD,EAAAE,KAAA,GA2CO+4B,EAAU6Z,uBAAuB7vC,EAAS/J,EAAUC,aA3C3D,QA4CC0zB,EAASzzB,GAAuBF,IA5CjC8G,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,UA8CC6sB,EAASyU,GAAqB,CAC1Bh0C,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,WAhDjB,yBAAAyS,EAAAI,SAAAN,EAAAlS,KAAA,cAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GgC7FiBmuB,CAAwBv1B,KAErC8wC,gBAAiB,SAAC9wC,GACd2zB,EhC4LL,SAAyB3zB,GAC5B,sBAAAoL,EAAA5W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAA2B,EAAOqrB,EAAmDC,GAA1D,IAAAl+B,EAAAM,EAAAmF,EAAAymC,EAAAl/B,EAAAzE,EAAAwF,EAAAsG,EAAAe,EAAAi1B,EAAA1rB,EAAA,OAAA5N,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,UACH2sB,EAvBG,CACH/9B,KAAM7B,EAAW8lD,mCAwBXnkD,EAAQk+B,KACH99B,MAAMyH,YAAYvH,UAJ1B,CAAAwS,EAAAxB,KAAA,eAKC2sB,EAAS2U,GAAqB,CAC1Bl0C,KAAM,QACNC,QAAS,mBAPdmU,EAAAvB,OAAA,qBAYGjR,EAAYN,EAAMI,MAAMyH,YAAYvH,WAC5BwH,OAAS3J,EAAqB4J,OAbzC,CAAA+K,EAAAxB,KAAA,eAcC2sB,EAAS2U,GAAqB,CAC1Bl0C,KAAM,QACNC,QAAS,oBAhBdmU,EAAAvB,OAAA,wBAqBK9L,EAAiBnF,EAAjBmF,aArBLymC,EA0BClsC,EAFA4M,KAAQG,cAAiBC,EAxB1Bk/B,EAwB0Bl/B,MAAOzE,EAxBjC2jC,EAwBiC3jC,SACzBwF,EACP/N,EADA6N,IAAOE,OAGLsG,EAAU5O,EAAazB,GACvBoR,EAAaP,OAAOvK,EAAUC,aAE9B8/B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAjC1C8C,EAAAzB,KAAA,GAAAyB,EAAAxB,KAAA,GAqCO+4B,EAAU+Z,qBAAqB/vC,EAASe,GArC/C,eAAAtC,EAAAxB,KAAA,GA0CmB+4B,EAAU/mB,OAAOjP,GA1CpC,YA0COsK,EA1CP7L,EAAAC,MA4CSjL,OAASyiB,GAA0BxiB,OA5C5C,CAAA+K,EAAAxB,KAAA,gBA6CK2sB,EAAS2U,GAAqB,CAC1Bl0C,KAAM,QACNC,QAAS,sBA/ClBmU,EAAAvB,OAAA,kBAoDC0sB,EAASY,GAAcv0B,EAAUC,cACjC0zB,EAASvzB,GAAuBiU,IArDjC7L,EAAAxB,KAAA,iBAAAwB,EAAAzB,KAAA,GAAAyB,EAAAE,GAAAF,EAAA,UAuDCmrB,EAAS2U,GAAqB,CAC1Bl0C,KAAM,QACNC,QAASmU,EAAAE,GAAGrU,WAzDjB,yBAAAmU,EAAAtB,SAAAoB,EAAA5T,KAAA,cAAP,gBAAAsU,EAAAc,GAAA,OAAAsB,EAAAjE,MAAAzS,KAAA0S,YAAA,GgC7LiBmuB,CAAwBv1B,KAErCu0C,gBAAiB,SAAC3qC,GACd+pB,EAASomB,GAAwCnwC,KAErDowC,mBAAoB,SAACh2B,GACjB2P,EEJL,SAAc3P,GACjB,sBAAA5Y,EAAA5W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAA2B,EAAOqrB,EAAmDC,GAA1D,IAAAyM,EAAAC,EAAA59B,EAAAzE,EAAAwF,EAAAopC,EAAA,OAAApmC,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cACH2sB,EAAS,CACL/9B,KAAM7B,EAAWkmD,2BAFlB5Z,EAOqBzM,IAPrB0M,EAAAD,EAMC/9B,KAAQG,cAAiBC,EAN1B49B,EAM0B59B,MAAOzE,EANjCqiC,EAMiCriC,SACzBwF,EAPR48B,EAOC98B,IAAOE,OAELopC,EAAc,IAAIqN,GAAuB,CAC3Cx3C,QAAOzE,WACP8uC,gBAAiBtpC,EAAO0wB,SAASgmB,MAAMz0C,MAXxC8C,EAAAzB,KAAA,EAAAyB,EAAAxB,KAAA,EAe6B6lC,EAAYuN,gBAAgBp2B,GAfzD,OAAAxb,EAAAC,KAmBCkrB,EAAS,CACL/9B,KAAM7B,EAAW8vB,2BACjBG,eAAgBA,IArBrBxb,EAAAxB,KAAA,iBAAAwB,EAAAzB,KAAA,GAAAyB,EAAAE,GAAAF,EAAA,SAwBCpS,QAAQU,MAAM,QAAd0R,EAAAE,IACAirB,EAAS,CACL/9B,KAAM7B,EAAWsmD,yBACjBvjD,MAAO,CACH1C,KAAMoU,EAAAE,GAAG1T,KACTX,QAASmU,EAAAE,GAAGrU,WA7BrB,yBAAAmU,EAAAtB,SAAAoB,EAAA5T,KAAA,aAAP,gBAAAsU,EAAAc,GAAA,OAAAsB,EAAAjE,MAAAzS,KAAA0S,YAAA,GFGiBkzC,CAAyBt2B,OAK/BsR,CAA8FqhB,qBCtGxGpI,6FA0NUoI,eAlMX,SAAAA,EAAYvxB,GAA8B,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAiiD,IACtCxiD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAmiD,GAAA9hD,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACTqmC,UAAU,EACV0S,WAAYF,GAAWv2C,KACvB64C,cAAe,CACX7wC,UAAW,OAPmB7L,4EActC2jC,KAAMvjC,KAAK,CACP4f,MAAO,yBACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,+CAAwBA,EAAA,kCAAxB,KACAA,EAAA,0FACAA,EAAA,qDACAA,EAAA,+GACAA,EAAA,wKAOZ3wB,KAAK0wB,MAAMwpB,0DAIX,IAAMzvC,EAAWzK,KAAK0wB,MAAMjmB,SAC5BzK,KAAK0wB,MAAM0pB,oBAAoB3vC,EAASyK,wDAIxC,GAAKlV,KAAK0wB,MAAMjqB,aAAhB,CAGA,IAAMgE,EAAWzK,KAAK0wB,MAAMjmB,SAC5BzK,KAAK0wB,MAAM2pB,mBAAmB5vC,EAASyK,yDAIvC,GAAKlV,KAAK0wB,MAAMjqB,aAAhB,CAGA,IAAMgE,EAAWzK,KAAK0wB,MAAMjmB,SAC5BzK,KAAK0wB,MAAM4pB,mBAAmB7vC,EAASyK,oDAIvC,OAAQlV,KAAK0wB,MAAMjmB,SAASvJ,MACxB,KAAMqqB,GAAoCjoB,KACtC,OACIqtB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,+CAAwBA,EAAA,kCAAxB,8BACAA,EAAA,gGACAA,EAAA,8DACAA,EAAA,wGACAA,EAAA,gIAGZ,KAAMpF,GAAoC1L,uBACtC,OACI8Q,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,4FAGZ,KAAMpF,GAAoCzL,0BACtC,OACI6Q,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,+EAGZ,QACI,OACIA,EAAA,mCACY3wB,KAAK0wB,MAAMjmB,SAASvJ,KADhC,0CAQZ,IAAMvB,EACFgxB,EAAA,kDAIEprB,EACForB,EAAA,cAACA,EAAA,SAAD,KACK3wB,KAAK6lD,gBAENl1B,EAAA,yBACK3wB,KAAK8lD,qBAIlB,OACIn1B,EAAA,cAAC2U,GAAA,EAAD,CACI3lC,QAASA,EACT4F,YAAaA,EACbrE,KAAK,OACL2wB,MAAO,CAAEhB,MAAO,OAAQ2U,OAAQ,aAChC7R,UAAU,4FAIFlpB,GAChB,OAAQA,EAASvJ,MACb,KAAMqqB,GAAoCjoB,KAE1C,KAAMioB,GAAoCpL,KACtC,MAAO,UACX,KAAMoL,GAAoC1L,uBACtC,MAAO,iCACX,KAAM0L,GAAoCzL,0BACtC,MAAO,oCACX,KAAMyL,GAAoC3hB,OAE1C,KAAM2hB,GAAoC9hB,MAE1C,KAAM8hB,GAAoCvL,MACtC,MAAO,sDAKf,OAAQhgB,KAAK0wB,MAAMjmB,SAASvJ,MACxB,KAAMqqB,GAAoCjoB,KACtC,OACIqtB,EAAA,cAAC8X,GAAA,EAAD,CACIrU,QAASp0B,KAAK86C,YAAYxmB,KAAKt0B,OADnC,0BAMR,KAAMurB,GAAoC1L,uBACtC,OACI8Q,EAAA,yBACIA,EAAA,yBAAKA,EAAA,cAAC8X,GAAA,EAAD,CACDhV,KAAK,SACLvyB,KAAK,SACLkzB,QAASp0B,KAAKo6C,oBAAoB9lB,KAAKt0B,OAHtC,oBAOjB,KAAMurB,GAAoCzL,0BACtC,OACI6Q,EAAA,yBACIA,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,QAAQvyB,KAAK,UAAUkzB,QAASp0B,KAAKq6C,mBAAmB/lB,KAAKt0B,OAA1E,qBACC,IACD2wB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OAAOvyB,KAAK,SAASkzB,QAASp0B,KAAKs6C,mBAAmBhmB,KAAKt0B,OAAxE,sBAGZ,QACI,OACI2wB,EAAA,mCACY3wB,KAAK0wB,MAAMjmB,SAASvJ,KADhC,6CAQZ,IAAM+kC,EACFtV,EAAA,qBAAKkB,MAAO,CAAEye,KAAM,cAGlBhK,EACF3V,EAAA,cAACA,EAAA,SAAD,KAEIA,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,OAAOW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,SAGzE,OACI2wB,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,EAAaK,QAASA,qCAK/C,OACI3V,EAAA,qBAAKgD,UAAU,+DACV3zB,KAAK+lD,eACL/lD,KAAK2kD,oBA7LSjyB,aEkDhBkO,mBA3Cf,SAAyB5/B,EAAmB+jD,GACxC,IAAMzjD,EAAYN,EAAMI,MAAMyH,YAAYvH,UAC1C,IAAKA,EACD,MAAM,IAAIf,MAAM,4BAEpB,GAAIe,EAAUwH,OAAS3J,EAAqB4L,qBACxC,MAAM,IAAIxK,MAAM,wBANoD,IASpEkG,EACAnF,EADAmF,aAAcgE,EACdnJ,EADcmJ,SAAUL,EACxB9I,EADwB8I,cAY5B,OANIpJ,EAHAiuB,GACIF,cAAiBlc,IAIC9I,OAAO,SAACilB,GAC9B,OAAQA,EAAa5V,iBAAmB3S,EAAazB,KAGlD,CACHyB,eAAcgE,WAAUL,kBAIzB,SAA4B60B,GAC/B,MAAO,CACHib,UAAW,WACPjb,EAAS4B,OAEbuZ,oBAAqB,SAACllC,GAClB+pB,EAAS4B,GAAiC3rB,KAE9CmlC,mBAAoB,SAACnlC,GACjB+pB,EAAS4B,GAA6B3rB,KAE1ColC,mBAAoB,SAACplC,GACjB+pB,EAAS4B,GAA6B3rB,OAKnC0rB,CAA8FqhB,cClEvGxhB,eACF,SAAAA,EAAY/P,GAAe,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACjB0wB,iFAIN,IAAM/wB,EACFgxB,EAAA,wDAEK,IACDA,EAAA,cAACoqB,GAAA,EAAD,OAGR,OACIpqB,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,OAAOvB,QAASA,EAASkyB,MAAO,CACxChB,MAAO,OACPm1B,QAAS,OACTxgB,OAAQ,mDAKRpjC,GACR,OACIuuB,EAAA,kCAEIA,EAAA,yBACKvuB,EAAMzC,2CAOnB,OAAQK,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAKgI,EAA4BjH,KAEjC,KAAKiH,EAA4B/H,QAC7B,OAAOxC,KAAKmsC,gBAChB,KAAK5hC,EAA4BtE,MAC7B,OAAIjG,KAAK0wB,MAAM6C,KAAKnxB,MACTpC,KAAKosC,YAAYpsC,KAAK0wB,MAAM6C,KAAKnxB,OAEjCpC,KAAKosC,YAAY,CACpB1sC,KAAM,gBACNC,QAAS,oCAGrB,QACI,OAAkC,OAA9BK,KAAK0wB,MAAM6C,KAAKjyB,UACTtB,KAAKosC,YAAY,CACpB1sC,KAAM,aACNC,QAAS,uDAGbK,KAAK0wB,MAAM6C,KAAKjyB,UAAUmF,aAAaqC,OAASqR,GAAiByF,qBAE7D+Q,EAAA,cAACs1B,GAAD,MAQJt1B,EAAA,cAACu1B,GAAD,mDAMZ,OAAQlmD,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAKgI,EAA4BjH,KAC7BtD,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMtX,gEAKrCpZ,KAAK0wB,MAAM4b,kBA9EE5Z,aAyHNkO,mBAjBf,SAAyB5/B,EAAyB0vB,GAC9C,MAAO,CACH6C,KAAMvyB,EAAMI,MAAMyH,cAInB,SAA4Bo2B,GAC/B,MAAO,CACH0B,OAAQ,SAACvnB,GACL6lB,EAAS4B,GAAaznB,KAE1BkzB,SAAU,WACNrN,EpCsXR,eAAAtoB,EAAA7W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAmC,EAAO6qB,EAAmDC,GAA1D,IAAAC,EAAAC,EAAApxB,EAAAzE,EAAAwF,EAAAzN,EAAA+pC,EAAA,OAAAt5B,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,UAAA6sB,EAMCD,IANDE,EAAAD,EAGCvxB,KAAQG,cAAiBC,EAH1BoxB,EAG0BpxB,MAAOzE,EAHjC61B,EAGiC71B,SACzBwF,EAJRowB,EAICtwB,IAAOE,OACiBzN,EALzB69B,EAKC/9B,MAASyH,YAAevH,UALzB,CAAA+S,EAAA/B,KAAA,cASO,IAAI/R,MAAM,6BATjB,UAYG8qC,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAMzC1P,EAAUmF,aAAagE,WAAa8gB,GAAoC3hB,QACxEtI,EAAUmF,aAAagE,WAAa8gB,GAAoC9hB,OACxEnI,EAAUmF,aAAagE,WAAa8gB,GAAoCvL,MAtBzE,CAAA3L,EAAA/B,KAAA,eAAA+B,EAAA/B,KAAA,EAuBO+4B,EAAU8a,SAAS,CAAE/sC,eAAgB9X,EAAUmF,aAAazB,KAvBnE,OA0BHi6B,EAASzO,MAITyO,EAAS,CACL/9B,KAAM7B,EAAW6L,kBA/BlB,wBAAAmJ,EAAA7B,SAAA4B,EAAApU,SAAP,gBAAAuW,EAAAC,GAAA,OAAAG,EAAAlE,MAAAzS,KAAA0S,YAAA,OoCjXWkuB,CAAoGH,IC+E5G,SAAS93B,KACZ,MAAO,CACHzH,KAAM7B,EAAWqJ,0BAwBlB,SAASxB,GAAiB9E,GAC7B,MAAO,CACHlB,KAAM7B,EAAW4H,oBACjB7E,MAAOA,GAyER,SAAS4oC,GAAK5xB,GACjB,OAAO,SAAC6lB,EAAmDC,GACvDD,EA1IG,CACH/9B,KAAM7B,EAAWiH,sBAwIqE,IAAA64B,EAMlFD,IANkFE,EAAAD,EAIlFvxB,KAAQG,cAAiBC,EAJyDoxB,EAIzDpxB,MAAOzE,EAJkD61B,EAIlD71B,SACzBwF,EAL2EowB,EAKlFtwB,IAAOE,OAgBX,OALkB,IAAIwc,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAG5BsT,OAAOlL,GACnB5H,KAAK,SAACmO,GACH,GAAIA,EAAI7W,OAASyiB,GAA0BxiB,OACvC,MAAM,IAAIxI,MAAM,6CAEpB,IA9JY8F,EAA0CI,EA8JhD2/C,EAAoC,CACtCphD,GAAI,CACAtB,MAAOic,EAAI3a,GACXqC,YAAasY,EAAI3a,GACjBrB,UAAW1F,EAAU+E,IACrBJ,gBAAiBkc,GAAWuH,cAAc1G,EAAI3a,IAAI,IAEtD1E,KAAM,CACFoD,MAAOic,EAAIrf,KACX+G,YAAasY,EAAIrf,KACjBqD,UAAW1F,EAAU+E,IACrBJ,gBAAiBkc,GAAWwH,gBAAgB3G,EAAIrf,MAAM,IAE1D2D,QAAS,CACLP,MAAOic,EAAI1b,QACXoD,YAAasY,EAAI1b,QACjBN,UAAW1F,EAAU+E,IACrBJ,gBAAiBkc,GAAW0tB,mBAAmB7sB,EAAI1b,SAAS,IAEhEK,QAAS,CACLZ,MAAOic,EAAIrb,QACX+C,YAAasY,EAAIrb,QACjBX,UAAW1F,EAAU+E,IACrBJ,gBAAiBkc,GAAW2tB,mBAAmB9sB,EAAIrb,SAAS,IAEhEK,kBAAmB,CACfjB,MAAOic,EAAIhb,kBACX0C,YAAasY,EAAIhb,kBACjBhB,UAAW1F,EAAU+E,IACrBJ,gBAAiBkc,GAAW4tB,6BAA6B/sB,EAAIhb,mBAAmB,IAEpFY,YAAa,CACT7B,MAAOic,EAAIpa,YACX8B,YAAasY,EAAIpa,YACjB5B,UAAW1F,EAAU+E,IACrBJ,gBAAiBkc,GAAWyH,uBAAuB5G,EAAIpa,aAAa,IAExEK,UAAW,CACPlC,MAAOic,EAAI/Z,UACXyB,YAAasY,EAAI/Z,UACjBjC,UAAW1F,EAAU+E,IACrBJ,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,QAI7Bk8B,GA7MY54B,EA6MS+/C,EA7MiC3/C,EA6MpBkZ,EA5MvC,CACHze,KAAM7B,EAAWmH,sBACjBH,mBAAoBA,EACpBI,aAAcA,OA2MT4yB,MAAM,SAACC,GAvMb,IAAmBl3B,EAwMVV,QAAQU,MAAM,iBAAkBk3B,GAChC2F,GAzMU78B,EAyMS,CACf1C,KAAM45B,EAAIh5B,KACVX,QAAS25B,EAAI35B,SA1MtB,CACHuB,KAAM7B,EAAWqH,oBACjBtE,MAAOA,QA8MR,SAASikD,KACZ,OAAO,SAACpnB,EAAmDC,GACvDD,EA/KG,CACH/9B,KAAM7B,EAAWuH,sBAgLjB,IAAM5F,EAAQk+B,IACd,IAAKl+B,EAAMI,MAAMmF,YAAYjF,UACzB,MAAM,IAAIf,MAAM,uBALkE,IAAAusC,EAe9D9rC,EANpB4M,KAAQG,cAAiBC,EATyD8+B,EASzD9+B,MAAOzE,EATkDujC,EASlDvjC,SATkD+8C,EAe9DtlD,EALpBI,MACImF,YACIjF,UAAamF,EAZ6D6/C,EAY7D7/C,aAAcJ,EAZ+CigD,EAY/CjgD,mBAG5B0I,EAAa/N,EAApB6N,IAAOE,OAELs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAG7C,GAAK3K,EAAL,CAQA,IAAM4Q,EAAS,CACX3W,KAAM+F,EAAmB/F,KAAKoD,MAC9BO,QAASoC,EAAmBpC,QAAQP,MACpC6B,YAAac,EAAmBd,YAAY7B,MAC5CkC,UAAWS,EAAmBT,UAAUlC,MACxCY,QAAS+B,EAAmB/B,QAAQZ,MACpCiB,kBAAmB0B,EAAmB1B,kBAAkBjB,OAG5D2nC,EAAUkb,UAAU9/C,EAAazB,GAAIiS,GAChCzF,KAAK,WACFytB,EAjNL,CACH/9B,KAAM7B,EAAWyH,0BAkNZuyB,MAAM,SAACj3B,GACJV,QAAQU,MAAM,eAAgBiE,EAAoBjE,GAClD68B,EAAS/3B,GAAiB,CACtBxH,KAAM,UACNC,QAASyC,EAAMzC,kBAxBvBs/B,EAAS/3B,GAAiB,CACtBxH,KAAM,MACNC,QAAS,mDA4BlB,SAAS6mD,KACZ,OAAO,SAACvnB,EAAmDC,GACvD,IAAMl+B,EAAQk+B,IACd,IAAKl+B,EAAMI,MAAMmF,YAAYjF,UACzB,MAAM,IAAIf,MAAM,uBAHkE,IAUtE8F,EAIZrF,EAPAI,MACImF,YACIjF,UACI+E,mBAMXA,GAKDA,EAAmB/F,KAAKsC,gBAAgB1B,OAAS/C,EAAoB0E,IAKrEwD,EAAmBpC,QAAQrB,gBAAgB1B,OAAS/C,EAAoB0E,IAKxEwD,EAAmB/B,QAAQ1B,gBAAgB1B,OAAS/C,EAAoB0E,IAKxEwD,EAAmB1B,kBAAkB/B,gBAAgB1B,OAAS/C,EAAoB0E,IAKlFwD,EAAmBd,YAAY3C,gBAAgB1B,OAAS/C,EAAoB0E,GAKhFo8B,EAtSG,CACH/9B,KAAM7B,EAAWmJ,uBAwQby2B,EAASt2B,OAiCd,SAASwkC,GAAW7sC,GACvB,OAAO,SAAC2+B,GAAsD,IAAAmO,EAC3BtuB,GAAWwH,gBAAgBhmB,GADA+sC,EAAAvtC,OAAAwY,GAAA,EAAAxY,CAAAstC,EAAA,GACnDE,EADmDD,EAAA,GACpCjrC,EADoCirC,EAAA,GAGtDjrC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAhQL,SAAgC3+B,EAAc8B,GACjD,MAAO,CACHlB,KAAM7B,EAAWmI,2BACjBlH,KAAMA,EACN8B,MAAOA,GA4PMqF,CAAuB6lC,EAAelrC,IAE/C68B,EAzQL,SAAkC3+B,GACrC,MAAO,CACHY,KAAM7B,EAAW8H,6BACjB7G,KAAMA,GAsQOiH,CAAyB+lC,IAEtCrO,EAASunB,OAIV,SAASjZ,GAActpC,GAC1B,OAAO,SAACg7B,GAAsD,IAAAuO,EACxB1uB,GAAW0tB,mBAAmBvoC,GADNwpC,EAAA3tC,OAAAwY,GAAA,EAAAxY,CAAA0tC,EAAA,GACnDE,EADmDD,EAAA,GACjCrrC,EADiCqrC,EAAA,GAGtDrrC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EArPL,SAAmCh7B,EAAwB7B,GAC9D,MAAO,CACHlB,KAAM7B,EAAWuI,+BACjB3D,QAASA,EACT7B,MAAOA,GAiPMyF,CAA0B6lC,EAAkBtrC,IAErD68B,EA9PL,SAAqCh7B,GACxC,MAAO,CACH/C,KAAM7B,EAAWqI,iCACjBzD,QAASA,GA2PI0D,CAA4B+lC,IAEzCzO,EAASunB,OA4CV,SAAS3X,GAAkBtpC,GAC9B,OAAO,SAAC05B,EACJC,GAA+B,IAAAyM,EAI3BzM,IAJ2B0M,EAAAD,EAE3B/9B,KAAQG,cAAiBC,EAFE49B,EAEF59B,MAAOzE,EAFLqiC,EAEKriC,SACzBwF,EAHoB48B,EAG3B98B,IAAOE,OAHoBq/B,GAMb,IAAI7iB,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAEP8N,GAAWyH,uBAAuBhhB,IAVzC8oC,EAAAvuC,OAAAwY,GAAA,EAAAxY,CAAAsuC,EAAA,GAUxBY,EAVwBX,EAAA,GAUFjsC,EAVEisC,EAAA,GAY3BjsC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EA1RL,SAAuC15B,EAAqBnD,GAC/D,MAAO,CACHlB,KAAM7B,EAAWiJ,kCACjB/C,YAAaA,EACbnD,MAAOA,GAsRMmG,CAA8BymC,EAAsB5sC,IAE7D68B,EAnSL,SAAyC15B,GAC5C,MAAO,CACHrE,KAAM7B,EAAWgJ,oCACjB9C,YAAaA,GAgSAkhD,CAAgCzX,IAE7C/P,EAASunB,WC/iBZ3M,4GA2fU6M,eA3eX,SAAAA,EAAYh2B,GAA8B,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAA0mD,IACtCjnD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA4mD,GAAAvmD,KAAAH,KAAM0wB,KAHVuS,YAE0C,EAGtCxjC,EAAKuB,MAAQ,CACTkuC,iBAAiB,EACjB2R,gBAAgB,EAChB9G,WAAYF,GAAWv2C,MAG3B7D,EAAKwjC,OAASmM,SAASpM,SAAUC,OATKxjC,4EAatC2jC,KAAMvjC,KAAK,CACP4f,MAAO,2BACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,kHAMS,IAAA7f,EAAA9Q,KACrB,GAAKA,KAAKqvC,aAAV,CAUAjM,KAAMkM,QAAQ,CACV7vB,MAAO,oBACP4jB,QACI1S,EAAA,yBACIA,EAAA,mEAEAA,EAAA,sEAA+CA,EAAA,oDAA/C,KAEAA,EAAA,uBAAGA,EAAA,0DAGX4e,KAhBY,WACZz+B,EAAK0iB,SAAS,CAAE0b,iBAAiB,KAgBjCM,SAdW,aAeXC,OAAQ,MACRC,WAAY,YAvBZ1vC,KAAKwzB,SAAS,CAAE0b,iBAAiB,oDA2BjB,IAAAv8B,EAAA3S,KACpB,GAAKA,KAAKqvC,aAAV,CAUAjM,KAAMkM,QAAQ,CACV7vB,MAAO,oBACP4jB,QACI1S,EAAA,yBACIA,EAAA,mEAEAA,EAAA,sEAA+CA,EAAA,oDAA/C,KAEAA,EAAA,uBAAGA,EAAA,0DAGX4e,KAhBY,WACZ58B,EAAK6gB,SAAS,CAAEqtB,gBAAgB,KAgBhCrR,SAdW,aAeXC,OAAQ,MACRC,WAAY,YAvBZ1vC,KAAKwzB,SAAS,CAAEqtB,gBAAgB,qCA2B/Bxa,GACLA,EAAEwB,iBACF7nC,KAAK0wB,MAAMi2B,qDAGFtgB,GACTA,EAAEuJ,UACF5vC,KAAK0wB,MAAMmf,aAAaxJ,EAAElS,OAAOzwB,mDAGjB2iC,GAChBA,EAAEuJ,UACF5vC,KAAK0wB,MAAMof,oBAAoBzJ,EAAElS,OAAOzwB,0CAGjC2iC,GACPA,EAAEuJ,UACFluC,QAAQC,KAAK,sEAGC0kC,GACdrmC,KAAK0wB,MAAMyf,kBAAkB9J,EAAElS,OAAOic,iDAG1B/J,GACZA,EAAEuJ,UACF5vC,KAAK0wB,MAAMsf,gBAAgB3J,EAAElS,OAAOzwB,+CAGxB2iC,GACZA,EAAEuJ,UACF5vC,KAAK0wB,MAAMuf,gBAAgB5J,EAAElS,OAAOzwB,yDAGd2iC,GACtBA,EAAEuJ,UACF5vC,KAAK0wB,MAAMwf,0BAA0B7J,EAAElS,OAAOzwB,yCAI9C,OACI1D,KAAK0wB,MAAM5uB,YAAc5D,EAAUuF,QACnCzD,KAAK0wB,MAAM9tB,gBAAgB1B,OAAS/C,EAAoB0E,KACvD7C,KAAK0wB,MAAMlvB,YAAcpD,EAAU4E,KAChChD,KAAK0wB,MAAMlvB,YAAcpD,EAAU0Q,OACnC9O,KAAK0wB,MAAMlvB,YAAcpD,EAAU4D,4CAK3C,OACIhC,KAAK0wB,MAAM5uB,YAAc5D,EAAUuF,SAClCzD,KAAK0wB,MAAMlvB,YAAcpD,EAAU4E,KAChChD,KAAK0wB,MAAMlvB,YAAcpD,EAAU0Q,8CAIhCuhC,GACX,OAAQA,EAAMztC,gBAAgB1B,MAG1B,KAAM/C,EAAoB8H,MAE1B,KAAM9H,EAAoBohB,iBACtB,MAAO,mBAGf,OAAQ8wB,EAAM1sC,WACV,KAAM1F,EAAU2F,MACZ,MAAO,aACX,QACI,MAAO,0DAIFysC,GACb,OAAIA,EAAMztC,gBAAgB1B,OAAS/C,EAAoB0E,GAS5C,GARHwtC,EAAM1sC,YAAc1F,EAAU2F,MAE1B+sB,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,QACjB4e,EAAMztC,gBAAgBjD,cAHnC,yCAaJ,OACIgxB,EAAA,sBAAM3rB,GAAG,uBAAuB2uB,UAAU,0BAA0B0U,SAAUroC,KAAKqoC,SAAS/T,KAAKt0B,OAC7F2wB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKkB,MAAO,CAAEye,KAAM,YAChB3f,EAAA,oDAGRA,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qCAKRA,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,0CACXhD,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,4EAAf,SAIJkR,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMrqB,mBAAmB/F,KAAKoD,OAAS,GACtDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMrqB,mBAAmB/F,MAC7DioC,SAAUvoC,KAAKywC,aAAanc,KAAKt0B,QACpCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMrqB,mBAAmB/F,QAG7DqwB,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,iCACV3zB,KAAK0wB,MAAMrqB,mBAAmB/F,KAAKoD,OAAS,MAMzDitB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,0CAAf,MAGAhD,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMrqB,mBAAmBrB,GAAGtB,OAAS,GACpDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMrqB,mBAAmBrB,IAC7DujC,SAAUvoC,KAAK2wC,WAAWrc,KAAKt0B,QAClCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMrqB,mBAAmBrB,MAG7D2rB,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,sBAAMkB,MAAO,CAAEJ,MAAO,WAAazxB,KAAKijC,OAAxC,UACCjjC,KAAK0wB,MAAMrqB,mBAAmBrB,GAAGtB,OAAUitB,EAAA,sBAAMkB,MAAO,CAAE+e,UAAW,WAA1B,2BAMxDjgB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,0CAAf,YAGAhD,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMrqB,mBAAmBpC,QAAQP,OAAS,GACzDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMrqB,mBAAmBpC,SAC7DskC,SAAUvoC,KAAK6wC,gBAAgBvc,KAAKt0B,QACvCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMrqB,mBAAmBpC,WAG7D0sB,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,iCACV3zB,KAAK8wC,uBAMlBngB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,0CAAf,iBAGAhD,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAMrqB,mBAAmB/B,QAAQZ,OAAS,GACzDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMrqB,mBAAmB/B,SAC7DikC,SAAUvoC,KAAK+wC,gBAAgBzc,KAAKt0B,QACvCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMrqB,mBAAmB/B,WAG7DqsB,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,mBAAGuD,KAAMl0B,KAAK0wB,MAAMrqB,mBAAmB/B,QAAQZ,OAAS,GAAIywB,OAAO,UAAUn0B,KAAK0wB,MAAMrqB,mBAAmB/B,QAAQZ,OAAS,OAMxIitB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,0CAAf,eAGAhD,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,cAACuZ,GAAA,EAAD,CACIkG,QAASpwC,KAAK0wB,MAAMrqB,mBAAmBT,UAAUlC,MACjDiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMrqB,mBAAmBT,WAC7D2iC,SAAUvoC,KAAKgxC,kBAAkB1c,KAAKt0B,QACzCA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMrqB,mBAAmBT,aAG7D+qB,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,sCACV3zB,KAAKixC,gBAAgBjxC,KAAK0wB,MAAMrqB,mBAAmBT,UAAUlC,UAO1EitB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,0CAAf,sBAGAhD,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,cAACugB,GAAAl/B,EAAD,CAAUtO,MAAO1D,KAAK0wB,MAAMrqB,mBAAmB1B,kBAAkBjB,OAAS,GACtEiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMrqB,mBAAmB1B,mBAAqB,8CAClFwsC,SAAU,CAAEC,QAAS,EAAGC,QAAS,GACjC9I,SAAUvoC,KAAKsxC,0BAA0Bhd,KAAKt0B,QACjDA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMrqB,mBAAmB1B,qBAG7DgsB,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,8CACV3zB,KAAK0wB,MAAMrqB,mBAAmB1B,kBAAkBjB,OAAS,MAMtEitB,EAAA,qBAAKgD,UAAU,wBACXhD,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,2CAEfhD,EAAA,qBAAKgD,UAAU,gCACXhD,EAAA,cAACugB,GAAAl/B,EAAD,CAAUtO,MAAO1D,KAAK0wB,MAAMrqB,mBAAmBd,YAAY7B,OAAS,GAChEiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAMrqB,mBAAmBd,aAAe,wCAC5E4rC,SAAU,CAAEC,QAAS,EAAGC,QAAS,IACjC9I,SAAUvoC,KAAKuxC,oBAAoBjd,KAAKt0B,QAC3CA,KAAK0wC,iBAAiB1wC,KAAK0wB,MAAMrqB,mBAAmBd,eAG7DorB,EAAA,qBAAKgD,UAAU,yBACXhD,EAAA,qBAAKgD,UAAU,uCACX6d,wBAA0B,CAAEC,OAAQC,UAAOC,MAAM3xC,KAAK0wB,MAAMrqB,mBAAmBd,YAAY7B,OAAS,kDAQ5GkC,GACZ,OAAIA,EAEI+qB,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAU,IADzB,WAMJyvB,EAAA,0BACIA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAY,IAD3B,sDAOJ,OAAKlB,KAAK0wB,MAAMrqB,mBAAmBpC,QAAQP,MAIvCitB,EAAA,qBAAKC,IAAK5wB,KAAK0wB,MAAMrqB,mBAAmBpC,QAAQP,MAAOmtB,MAAO,KAHvD7wB,KAAK4xC,mDAOb7gB,EAAkBC,GACrB,IAAMC,EAAKF,EAASG,WAAWF,GAC/B,GAAIC,GAAM,OAAUA,GAAM,OAAUF,EAAS7jB,OAAS8jB,EAAW,EAAG,CAChE,IAAMG,EAAKJ,EAASG,WAAWF,EAAW,GAC1C,GAAIG,EAAK,OAAUA,GAAM,MACrB,OAAOJ,EAASK,UAAUJ,EAAU,GAG5C,OAAOD,EAASK,UAAUJ,EAAU,+CAIpC,IAAMhxB,KAAK0wB,MAAMrqB,mBAAmB/F,KAAKoD,QAAS1D,KAAK0wB,MAAMrqB,mBAAmBrB,GAAGtB,MAC/E,OACIitB,EAAA,2GAKR,IAAMU,EAAUrxB,KAAKsxB,OAAOtxB,KAAK0wB,MAAMrqB,mBAAmB/F,KAAKoD,MAAO,GAAG8tB,cAGnEC,EAFOC,KAAI1xB,KAAK0wB,MAAMrqB,mBAAmBrB,GAAGtB,OAE/BiuB,OAAO,EAAG,GAC7B,OACIhB,EAAA,qBAAKE,MAHI,GAGSe,OAHT,GAGuBC,MAAO,CAAEC,OAAQ,uCAC7CnB,EAAA,sBAAMoB,EAAE,MAAMC,EAAE,MAAMC,GAAI,EAAGC,WAAW,SAASC,iBAAiB,SAASC,SAAUtB,GAAWuB,KAAM,IAAMZ,EAAOa,WAAW,cAAcjB,0CAK1I,IAAAwgB,EACwC7xC,KAAK0wB,MACjD0W,EAAQ,SAFJyK,EACF/vC,UAC6B,YAF3B+vC,EACSjvC,gBACkD,WAF3DivC,EAC0BrwC,UAEpC,OACImvB,EAAA,sBAAMkB,MAAO,CAAEuU,YAAa,SAAWgB,yCAIjC9mC,GAEV,GAAoB,IAAhBA,EAAK4M,OACL,OACIyjB,EAAA,sBAAMkB,MAAO,CAAE+e,UAAW,WAA1B,oBAMR,IAAImB,EAAUzxC,EAId,OAHIA,EAAK4M,QAVS,KAWd6kC,EAAUzxC,EAAK+e,MAAM,EAAG,IAAM,UAG9BsR,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuBlT,KAAK0wB,MAAMjqB,aAAazB,KACtD2rB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SACtBgP,kDAOb,IAAM9L,EACFtV,EAAA,mDAIJ,OACIA,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,8CAMzB,GAAKjmC,KAAK0wB,MAAMjqB,aAIhB,OACIkqB,EAAA,cAAC4xB,GAAD,CAAoBnpC,eAAgBpZ,KAAK0wB,MAAMjqB,aAAazB,iDAKhE,OACI2rB,EAAA,sBAAMgD,UAAU,aACZhD,EAAA,sBAAMgD,UAAU,oBACZhD,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OACTmV,KAAK,uBACL13B,IAAI,SACJw3B,UAAW1oC,KAAKiyC,QAAQ9xC,KAAKH,MAC7B6oC,SAAS,UAJb,SAQJlY,EAAA,sBAAMgD,UAAU,oBACZhD,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,WACTvyB,KAAK,SACLkzB,QAASp0B,KAAK4mD,sBAAsBtyB,KAAKt0B,OAF7C,gBAMJ2wB,EAAA,sBAAMgD,UAAU,oBACZhD,EAAA,cAAC8X,GAAA,EAAD,CAAQS,MAAM,SAASzV,KAAK,OAAOW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,2CAO7E,OAAIA,KAAKgB,MAAM6/C,eACJlwB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMjqB,aAAazB,KAGxEhF,KAAK0wB,MAAMrqB,mBASZsqB,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAACga,GAAD,CAAUrE,QAAStmC,KAAK4qC,sBACvB5qC,KAAK6mD,kBAEL7mD,KAAKuyC,gBAXN5hB,EAAA,qBAAKgD,UAAU,oBACV3zB,KAAKwyC,8BA/dK9f,aCqChBkO,mBAlDR,SAAyB5/B,GAC5B,IAAKA,EAAMI,MAAMmF,YAAYjF,UACzB,MAAM,IAAIf,MAAM,yBAFuC,IAAA+lD,EAUvDtlD,EALAI,MACImF,YACIjF,UAKZ,MAAO,CACHQ,UAbuDwkD,EAOlCxkD,UAOrBN,UAduD8kD,EAOvB9kD,UAQhCoB,gBAfuD0jD,EAOZ1jD,gBAS3CyD,mBAhBuDigD,EAOKjgD,mBAU5DI,aAjBuD6/C,EAOyB7/C,eAcjF,SAA4Bw4B,GAC/B,MAAO,CACH0nB,cAAe,WACX1nB,EAASonB,OAEbxW,aAAc,SAACvvC,GACX2+B,EAASkO,GAAW7sC,KAExB0vC,gBAAiB,SAACjd,GACdkM,EAASsO,GAAcxa,KAK3B+c,oBAAqB,SAACvqC,GAClB05B,EAAS4P,GAAkBtpC,KAE/B4qC,kBAAmB,SAACvqC,GAChBq5B,EF6gBL,SAAyBr5B,GAC5B,OAAO,SAACq5B,GAEJA,EAAS,CACL/9B,KAAM7B,EAAW+I,mCACjBxC,UAAWA,IAEfq5B,EAASunB,OEphBI/T,CAAgB7sC,KAE7BqqC,gBAAiB,SAAC3rC,GACd26B,EF2cL,SAAuB36B,GAC1B,OAAO,SAAC26B,GAAsD,IAAAyT,EACxB5zB,GAAW2tB,mBAAmBnoC,GADNquC,EAAA7yC,OAAAwY,GAAA,EAAAxY,CAAA4yC,EAAA,GACnDE,EADmDD,EAAA,GACjCvwC,EADiCuwC,EAAA,GAGtDvwC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAAS,CACL/9B,KAAM7B,EAAW2I,+BACjB1D,QAASsuC,EACTxwC,MAAOA,IAGX68B,EAAS,CACL/9B,KAAM7B,EAAWyI,iCACjBxD,QAASsuC,IAGjB3T,EAASunB,OE3dI3T,CAAcvuC,KAE3B4rC,0BAA2B,SAACvrC,GACxBs6B,EF4dL,SAAiCt6B,GACpC,OAAO,SAACs6B,GAAsD,IAAA6T,EACdh0B,GAAW2tB,mBAAmB9nC,GADhBouC,EAAAjzC,OAAAwY,GAAA,EAAAxY,CAAAgzC,EAAA,GACnDE,EADmDD,EAAA,GACvB3wC,EADuB2wC,EAAA,GAGtD3wC,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAAS,CACL/9B,KAAM7B,EAAW8I,yCACjBxD,kBAAmBquC,EACnB5wC,MAAOA,IAGX68B,EAAS,CACL/9B,KAAM7B,EAAW6I,2CACjBvD,kBAAmBquC,IAG3B/T,EAASunB,OE5eIvT,CAAwBtuC,OAK9Bi8B,CAA8F8lB,ICjEvGjmB,eACF,SAAAA,EAAY/P,GAAqB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACvB0wB,iFAIN,OACIC,EAAA,iHAOJ,GAAK3wB,KAAK0wB,MAAM6C,KAAKnxB,MAGrB,OACIuuB,EAAA,mCACY3wB,KAAK0wB,MAAM6C,KAAKnxB,MAAMzC,0CAMtC,OAAQK,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KAE3B,KAAKzE,EAAsB2D,QACvB,OAAOxC,KAAKmsC,gBAChB,KAAKttC,EAAsBoH,MACvB,OAAOjG,KAAKosC,cAChB,KAAKvtC,EAAsB8D,QACvB,OACIguB,EAAA,cAACm2B,GAAD,mDAMZ,OAAQ9mD,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KAEvBtD,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMtX,gEAKrCpZ,KAAK0wB,MAAM4b,kBAhDE5Z,aAyFNkO,mBAjBf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACH6C,KAAMvyB,EAAMI,MAAMmF,cAI1B,SAA4B04B,GACxB,MAAO,CACH0B,OAAQ,SAACvnB,GACL6lB,EAAS4B,GAAaznB,KAE1BkzB,SAAU,WACNrN,EHoGD,CACH/9B,KAAM7B,EAAWsH,qBGhGVi6B,CAA8FH,ICgC9FsmB,uBA7HX,SAAAA,EAAYr2B,GAAwB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAA+mD,IAChCtnD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAinD,GAAA5mD,KAAAH,KAAM0wB,KAHVs2B,cAEoC,EAGhCvnD,EAAKunD,SAAWt0B,cAEhBjzB,EAAKixB,MAAMu2B,YALqBxnD,+EAShCO,KAAK0wB,MAAMw2B,+DAIX,GAA8B,OAA1BlnD,KAAKgnD,SAASrf,QAAlB,CAGA,IAAM35B,EAAQhO,KAAKgnD,SAASrf,QAAQjkC,MACf,IAAjBsK,EAAMd,QAGVlN,KAAK0wB,MAAMy2B,mBAAmBn5C,4CAI9B,OACI2iB,EAAA,qBAAKgD,UAAU,aAAf,UACWhD,EAAA,uBAAO6L,IAAKx8B,KAAKgnD,SAAUn1B,MAAO,CAAEhB,MAAO,UAClDF,EAAA,cAAC8X,GAAA,EAAD,CACIhV,KAAK,OACLoV,SAAS,SACTzU,QAASp0B,KAAKonD,aAAa9yB,KAAKt0B,OAHpC,4DAWR,OACI2wB,EAAA,qBAAKgD,UAAU,gBAAf,gBACiBhD,EAAA,uBAAGA,EAAA,0BAAO3wB,KAAK0wB,MAAM3iB,cAAcA,cAAcE,UAAjD,KAAmE0iB,EAAA,0BAAO3wB,KAAK0wB,MAAM3iB,cAAcA,cAAcxE,WADlI,IAEK,IACDonB,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,SAASW,QAASp0B,KAAKqnD,cAAc/yB,KAAKt0B,gDAM/D,OAAQA,KAAK0wB,MAAM3iB,cAAcF,QAC7B,KAAKtD,EAAgBjH,KACrB,KAAKiH,EAAgBuD,SACjB,OACI6iB,EAAA,0BAER,KAAKpmB,EAAgB8D,WACjB,OACIsiB,EAAA,qBAAKgD,UAAU,+CACV3zB,KAAKsnD,mBACLtnD,KAAK0wB,MAAM62B,UAGxB,KAAKh9C,EAAgBiE,aACjB,OACImiB,EAAA,qBAAKgD,UAAU,iDACXhD,EAAA,mEACC3wB,KAAKwnD,iBAGlB,KAAKj9C,EAAgBtE,MACjB,OACI0qB,EAAA,qBAAKgD,UAAU,iDACXhD,EAAA,gCACC3wB,KAAK0wB,MAAM3iB,cAAcpO,SAGtC,QACI,OACIgxB,EAAA,mEAMZ,OAAQ3wB,KAAK0wB,MAAM3iB,cAAcF,QAC7B,KAAKtD,EAAgBjH,KACrB,KAAKiH,EAAgBuD,SACjB,OACI6iB,EAAA,0BAER,KAAKpmB,EAAgB8D,WACjB,OACIsiB,EAAA,qBAAKgD,UAAU,+CACV3zB,KAAK0wB,MAAM62B,UAGxB,KAAKh9C,EAAgBiE,aACjB,OACImiB,EAAA,qBAAKgD,UAAU,iDACXhD,EAAA,2CAGZ,KAAKpmB,EAAgBtE,MACjB,OACI0qB,EAAA,qBAAKgD,UAAU,0CACXhD,EAAA,qCAGZ,QACI,OACIA,EAAA,4DAOZ,OACIA,EAAA,qBAAKgD,UAAU,+BACV3zB,KAAK0wB,MAAM+2B,OAASznD,KAAK0nD,gBAAkB1nD,KAAK2nD,uBA1H9Cj1B,uBCoBbk1B,GACI,GADJA,GAES,eAFTA,GAGK,YAuDEC,GAAb,WAGI,SAAAA,EAAAroD,GAAsC,IAAxBwR,EAAwBxR,EAAxBwR,IAAwBlR,OAAAC,EAAA,EAAAD,CAAAE,KAAA6nD,GAAA7nD,KAFtCgR,SAEsC,EAClChR,KAAKgR,IAAMA,EAJnB,OAAAlR,OAAAmR,EAAA,EAAAnR,CAAA+nD,EAAA,EAAA32C,IAAA,WAAAxN,MAAA,SAOasP,GACL,MAAoB,kBAATA,EACA,CAAChT,KAAKgR,KAAKkC,OAAO,CAACF,IAAOG,KAAK,KAEnC,CAACnT,KAAKgR,KAAKkC,OAAOF,GAAMG,KAAK,OAX5C,CAAAjC,IAAA,OAAAxN,MAAA,WAgBQ,OAAOyN,MAAMnR,KAAK8nD,SAAS,CAACF,KAAkB,CAC1Cx2C,QAAS,CACLE,OAAQ,oBAEZC,KAAM,SAELC,KAAK,SAACC,GACH,OAAOA,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MA1BvB,CAAAT,IAAA,eAAAxN,MAAA,SA8BiBsK,GACT,OAAOmD,MAAMnR,KAAK8nD,SAAS,CAACF,KAAuB,CAC/Cx2C,QAAS,CACLE,OAAQ,mBACRD,cAAerD,GAEnBuD,KAAM,SAELC,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAMkR,EAAS+B,YAE7B,OAAO/B,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,MA7CvB,CAAAT,IAAA,QAAAxN,MAAA,SAiDUsK,GACF,OAAOmD,MAAMnR,KAAK8nD,SAAS,CAACF,KAAmB,CAC3Cx2C,QAAS,CACLE,OAAQ,mBACRD,cAAerD,GAEnBuD,KAAM,SAELC,KAAK,SAACC,GACH,GAAwB,MAApBA,EAAS5D,OACT,MAAM,IAAItN,MAAMkR,EAAS+B,YAE7B,OAAO/B,EAASC,SAEnBF,KAAK,SAACG,GACH,OAAOA,QAhEvBk2C,EAAA,GCpCO,SAASl5C,GAAevM,GAC3B,MAAO,CACHlB,KAAM7B,EAAWqP,iBACjBtM,SAID,SAASkM,GAAeN,EAAezE,EAAkB0E,EAAkBC,GAC9E,MAAO,CACHhN,KAAM7B,EAAW+O,gBACjBJ,QAAOzE,WAAU0E,WAAUC,SAI5B,SAASO,KACZ,MAAO,CACHvN,KAAM7B,EAAWkP,mBAmBlB,SAAS04C,KACZ,OAAO,SAAChoB,EAAmDC,GACvDD,EA1CG,CACH/9B,KAAM7B,EAAWsO,mBAwCqE,IAO9DqD,EAIpBkuB,IAPArwB,IACIE,OACI0wB,SACIsnB,KAAQ/1C,IAQlBhD,EAAQ+5C,OAAY,iBAC1B,GAAK/5C,EAAL,CAKA,IAAMJ,EAAO,IAAIi6C,GAAW,CAAE72C,IAAKA,IACnC4B,QAAQC,IAAI,CACRjF,EAAKo6C,aAAah6C,GAClBJ,EAAKq6C,MAAMj6C,KAEVwD,KAAK,SAAAhS,GAA0B,IAAAkX,EAAA5W,OAAAwY,GAAA,EAAAxY,CAAAN,EAAA,GAAb0oD,GAAaxxC,EAAA,GAAAA,EAAA,IACtBxI,EAAQg6C,EAAQh6C,MAAM7E,IAAI,SAAAsN,GAAA,IAAG3R,EAAH2R,EAAG3R,GAAH2R,EAAOwxC,KAAP,OAAkBnjD,IAClDi6B,EAAS3wB,GAAeN,EAAOk6C,EAAQ3uC,KAAM2uC,EAAQxiB,QAASx3B,MAEjEmrB,MAAM,SAACC,GACJ53B,QAAQU,MAAM,mBAAoBk3B,GAClC2F,EAAStwB,GAAe,CACpBjP,KAAM,QACNC,QAAS25B,EAAI35B,kBAjBrBs/B,EAASxwB,OCxDNmyB,mBAzBf,SAAyB5/B,EAAmB0vB,GAExC,MAAO,CACH3iB,cAFa/M,EAAT4M,OAUL,SAA4BqxB,GAC/B,MAAO,CACHgoB,UAAW,WACPhoB,EAAS4B,OAEbqmB,sBAAuB,WACnBjoB,EDwFD,SAACA,EAAmDC,GAEvD6oB,UAAe,iBAGf9oB,EAASxwB,SC3FT04C,mBAAoB,SAACn5C,GACjBixB,ED8FL,SAA8BjxB,GACjC,OAAO,SAACixB,EAAmDC,GAA+B,IAM9DluB,EAIpBkuB,IAPArwB,IACIE,OACI0wB,SACIsnB,KAAQ/1C,IAOxB+2C,OAAY,gBAAiB/5C,GAG7B,IAAMJ,EAAO,IAAIi6C,GAAW,CAAE72C,IAAKA,IACnC4B,QAAQC,IAAI,CACRjF,EAAKo6C,aAAah6C,GAClBJ,EAAKq6C,MAAMj6C,KAEVwD,KAAK,SAAAoF,GAA0B,IAAAC,EAAA/W,OAAAwY,GAAA,EAAAxY,CAAA8W,EAAA,GAAbsxC,GAAarxC,EAAA,GAAAA,EAAA,IACtB3I,EAAQg6C,EAAQh6C,MAAM7E,IAAI,SAAAyN,GAAA,IAAG9R,EAAH8R,EAAG9R,GAAH,OAAA8R,EAAOqxC,KAAWnjD,IAClDi6B,EAAS3wB,GAAeN,EAAOk6C,EAAQ3uC,KAAM2uC,EAAQxiB,QAASx3B,MAEjEmrB,MAAM,SAACC,GACJ53B,QAAQU,MAAM,mBAAoBk3B,GAClC2F,EAAStwB,GAAe,CACpBjP,KAAM,QACNC,QAAS25B,EAAI35B,cC5HZkhC,CAA6B7yB,OAKnC4yB,CAA8FmmB,ICzCvGqB,GAKF,SAAAA,EAAA5oD,GAA0D,IAA5Cc,EAA4Cd,EAA5Cc,KAAM+nD,EAAsC7oD,EAAtC6oD,UAAWC,EAA2B9oD,EAA3B8oD,QAA2BxoD,OAAAC,EAAA,EAAAD,CAAAE,KAAAooD,GAAApoD,KAJ1DM,UAI0D,EAAAN,KAH1DqoD,eAG0D,EAAAroD,KAF1DsoD,aAE0D,EACtDtoD,KAAKM,KAAOA,EACZN,KAAKqoD,UAAYA,EACjBroD,KAAKsoD,QAAUA,GAUjBC,eAIF,SAAAA,EAAYjzC,GAA+B,IAAA7V,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAuoD,IACvC9oD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAyoD,GAAApoD,KAAAH,KAAMsV,KAJV2jB,aAG2C,EAAAx5B,EAF3Cu6B,aAE2C,EAEvCv6B,EAAKw5B,QAAU,IAAIl2B,KACnBtD,EAAKu6B,QAAU1kB,EAAO0kB,SAAW,IAHMv6B,6BAJjB2oD,IAgBxBI,cAQF,SAAAA,EAAA9xC,GAAsF,IAAxEpW,EAAwEoW,EAAxEpW,KAAMkU,EAAkEkC,EAAlElC,QAASi0C,EAAyD/xC,EAAzD+xC,QAAyD3oD,OAAAC,EAAA,EAAAD,CAAAE,KAAAwoD,GAAAxoD,KAPtFM,UAOsF,EAAAN,KANtFwU,aAMsF,EAAAxU,KALtFgF,QAKsF,EAAAhF,KAJtF44C,aAIsF,EAAA54C,KAHtFyoD,aAGsF,EAAAzoD,KAFtF0oD,cAEsF,EAClF1oD,KAAKM,KAAOA,EACZN,KAAKwU,QAAUA,EACfxU,KAAKgF,GAAK2jD,OACV3oD,KAAK44C,QAAU,IAAI71C,KACnB/C,KAAKyoD,QAAUA,EACfzoD,KAAK0oD,SAAW,8DAIhB,MAAO,CACHA,SAAU,CACN1jD,GAAIhF,KAAKgF,GACT4zC,QAAS54C,KAAK44C,QACd6P,QAASzoD,KAAKyoD,SAElBnoD,KAAMN,KAAKM,KACXkU,QAASxU,KAAKwU,kBAgBbo0C,GAAb,WAgBI,SAAAA,EAAYtzC,GAKR,GALgCxV,OAAAC,EAAA,EAAAD,CAAAE,KAAA4oD,GAAA5oD,KAfpCq4B,YAemC,EAAAr4B,KAdnC6oD,UAcmC,EAAA7oD,KAbnCgF,QAamC,EAAAhF,KAZnC8oD,sBAYmC,EAAA9oD,KAXnC+oD,sBAWmC,EAAA/oD,KAVnCgpD,eAUmC,EAAAhpD,KATnCipD,YASmC,EAAAjpD,KARnCkpD,eAQmC,EAAAlpD,KAPnCmpD,mBAOmC,EAAAnpD,KANnCopD,4BAMmC,EAAAppD,KALnCqpD,sCAKmC,EAAArpD,KAJnCspD,6BAImC,EAAAtpD,KAHnCupD,kCAGmC,EAAAvpD,KAFnCwpD,qBAEmC,EAE/BxpD,KAAKq4B,OAAS/iB,EAAO+iB,OAGQ,OAAzBr4B,KAAKq4B,OAAO+W,SACZ,MAAM,IAAI7uC,MAAM,eAEpB,GAAsC,OAAlCP,KAAKq4B,OAAO+W,SAASpM,SACrB,MAAM,IAAIziC,MAAM,eAEpBP,KAAK6oD,KAAOvzC,EAAOuzC,MAAQ7oD,KAAKq4B,OAAO+W,SAASpM,SAASC,OAIzDjjC,KAAKgF,GAAKsQ,EAAOm0C,WAAad,OAG9B3oD,KAAK8oD,iBAAmB,IAAIz4C,IAC5BrQ,KAAK+oD,iBAAmB,IAAI14C,IAC5BrQ,KAAKgpD,UAAY,IAAI34C,IAErBrQ,KAAKipD,OAAS,EACdjpD,KAAKkpD,UAAY,EACjBlpD,KAAKmpD,cAAgB,EAErBnpD,KAAKopD,uBAAyB,EAC9BppD,KAAKqpD,iCAAmC,IACxCrpD,KAAKspD,yBAA0B,EAC/BtpD,KAAKupD,6BAA+B,EACpCvpD,KAAKwpD,gBAAkB,KA9C/B,OAAA1pD,OAAAmR,EAAA,EAAAnR,CAAA8oD,EAAA,EAAA13C,IAAA,QAAAxN,MAAA,WAmDQ,OADA1D,KAAKipD,QAAU,EACR,OAASpzC,OAAO7V,KAAKipD,UAnDpC,CAAA/3C,IAAA,iBAAAxN,MAAA,SAsDmBgmD,GACX,IAAM/pD,EAAU+pD,EAAaztB,KAC7B,IAAKt8B,EAKD,OAJAK,KAAKopD,8BACDppD,KAAKspD,yBACL5nD,QAAQC,KAAK,mCAAoC+nD,IAIzD,IAAK/pD,EAAQ+oD,SAKT,OAJA1oD,KAAKopD,8BACDppD,KAAKspD,yBACL5nD,QAAQC,KAAK,uDAAwD+nD,IAI7E,GAAM/pD,EAAQ+oD,SAASe,YAAczpD,KAAKgF,GAKtC,OAJAhF,KAAKopD,8BACDppD,KAAKspD,yBACL5nD,QAAQC,KAAK,oDAAsD+nD,IAoB3E,GAhBI1pD,KAAKupD,6BAA+BvpD,KAAKqpD,mCACzCrpD,KAAKspD,yBAA0B,EAC/B5nD,QAAQC,KAAK,4CAA8C3B,KAAKupD,6BAA+B,gBAc/F5pD,EAAQ+oD,SAAS1jD,IAAMhF,KAAK8oD,iBAAiBpuC,IAAI/a,EAAQ+oD,SAAS1jD,IAClE,IACI,IAAMyM,EAAWzR,KAAK8oD,iBAAiBr1C,IAAI9T,EAAQ+oD,SAAS1jD,IAC5DhF,KAAK8oD,iBAAiBv5B,OAAO5vB,EAAQ+oD,SAAS1jD,IAC1CyM,GACAA,EAASk4C,QAAQhqD,EAAQ6U,SAE/B,MAAOo1C,GACLloD,QAAQU,MAAM,uCAAwCzC,EAASiqD,GAMvE,GAAI5pD,KAAK+oD,iBAAiBruC,IAAI/a,EAAQW,MAAO,CACzC,IAAMupD,EAAW7pD,KAAK+oD,iBAAiBt1C,IAAI9T,EAAQW,MACnDN,KAAK+oD,iBAAiBx5B,OAAO5vB,EAAQW,MACrCupD,EAAS9uC,QAAQ,SAAC+uC,GACd,IACIA,EAASzB,UAAU1oD,EAAQ6U,SAC7B,MAAOo1C,GACLloD,QAAQU,MAAM,sCAAuCzC,EAASiqD,GAC1DE,EAASxB,SACTwB,EAASxB,QAAQsB,MAQ7B5pD,KAAKgpD,UAAUtuC,IAAI/a,EAAQW,OAC3BN,KAAKgpD,UAAUv1C,IAAI9T,EAAQW,MAAOya,QAAQ,SAAC+uC,GAClCA,EAASzB,WACV3mD,QAAQC,KAAK,2BAA4BmoD,GAE7C,IACIA,EAASzB,UAAU1oD,EAAQ6U,SAC7B,MAAOo1C,GACLloD,QAAQU,MAAM,sCAAuCzC,EAASiqD,GAC1DE,EAASxB,SACTwB,EAASxB,QAAQsB,QAtIzC,CAAA14C,IAAA,SAAAxN,MAAA,SA6IWomD,GACE9pD,KAAKgpD,UAAUtuC,IAAIovC,EAASxpD,OAC7BN,KAAKgpD,UAAUzwC,IAAIuxC,EAASxpD,KAAM,IAEtCN,KAAKgpD,UAAUv1C,IAAIq2C,EAASxpD,MAAOw2B,KAAKgzB,KAjJhD,CAAA54C,IAAA,KAAAxN,MAAA,SAoJOqmD,EAAmB5P,EAAgC/3C,GAClDpC,KAAKgqD,OAAO,IAAI5B,GAAS,CACrB9nD,KAAMypD,EACN1B,UAAWlO,EACXmO,QAASlmD,OAxJrB,CAAA8O,IAAA,cAAAxN,MAAA,SA4JgB/D,GACRK,KAAKq4B,OAAO4xB,YAAYtqD,EAAQuqD,aAAclqD,KAAK6oD,QA7J3D,CAAA33C,IAAA,OAAAxN,MAAA,SAgKSpD,EAAckU,GACf,IAAM7U,EAAU,IAAI6oD,GAAQ,CAAEloD,OAAMkU,UAASi0C,QAASzoD,KAAKgF,KAC3DhF,KAAKmqD,YAAYxqD,KAlKzB,CAAAuR,IAAA,cAAAxN,MAAA,SAqKgB/D,EAAkBgqD,GAC1B3pD,KAAK8oD,iBAAiBvwC,IAAI,aAAc,CACpC0gB,QAAS,IAAIl2B,KACb4mD,QAASA,IAGb3pD,KAAKmqD,YAAYxqD,KA3KzB,CAAAuR,IAAA,UAAAxN,MAAA,SA8KYpD,EAAckU,GAAkB,IAAA1D,EAAA9Q,KACpC,OAAO,IAAI4S,QAAQ,SAAC4iB,EAAS1P,GACzB,IACIhV,EAAKs5C,YAAY,IAAI5B,GAAQ,CAAEloD,OAAMkU,UAASi0C,QAAS33C,EAAK9L,KAAO,SAACyM,GAChE+jB,EAAQ/jB,KAEd,MAAOm4C,GACL9jC,EAAO8jC,QArLvB,CAAA14C,IAAA,eAAAxN,MAAA,WA0LmB,IAAAiP,EAAA3S,KACXq4B,OAAOC,WAAW,WACd,IAAMkW,GAAM,IAAIzrC,MAAO+S,UADH8S,GAAA,EAAAC,GAAA,EAAAC,OAAAK,EAAA,IAIpB,IAJoB,IAIpBH,EAJoBqhC,EAAA,eAAA1zC,EAAAqS,EAAAtlB,MAIRsB,GAJQ4R,EAAA9W,OAAAwY,GAAA,EAAAxY,CAAA6W,EAAA,OAwBY,IAxBZC,EAAA,GAKe7M,OAAO,SAAC+/C,GACnC,GAAIA,aAAoBvB,GAAiB,CACrC,IAAMhvB,EAAUiV,EAAMsb,EAAS7wB,QAAQnjB,UACvC,GAAIyjB,EAAUuwB,EAAS9vB,QAAS,CAC5B,IACQ8vB,EAASxB,SACTwB,EAASxB,QAAQ,IAAI/nD,MAAM,gBAAkBg5B,IAEnD,MAAOqwB,GACLloD,QAAQU,MAAM,8BAA+B4C,EAAI4kD,GAErD,OAAO,EAEP,OAAO,EAGX,OAAO,IAGE18C,QACbyF,EAAKo2C,iBAAiBx5B,OAAOvqB,IArBrC+jB,EAA8BpW,EAAKo2C,iBAAiB1wC,UAApD+Q,OAAAC,cAAAT,GAAAI,EAAAD,EAAAzW,QAAAgX,MAAAV,GAAA,EAA+D,KAAAhS,EAAAyzC,KAJ3C,MAAA/wB,GAAAzQ,GAAA,EAAAC,EAAAwQ,EAAA,YAAA1Q,GAAA,MAAAG,EAAAS,QAAAT,EAAAS,SAAA,WAAAX,EAAA,MAAAC,GA6BhBnW,EAAKo2C,iBAAiBj4B,KAAO,GAC7Bne,EAAK23C,gBAEV,OA3NX,CAAAp5C,IAAA,aAAAxN,MAAA,SA8NeomD,GACF9pD,KAAK+oD,iBAAiBruC,IAAIovC,EAASxpD,OACpCN,KAAK+oD,iBAAiBxwC,IAAIuxC,EAASxpD,KAAM,IAE7CN,KAAK+oD,iBAAiBt1C,IAAIq2C,EAASxpD,MAAOw2B,KAAKgzB,GAC3CA,EAAS9vB,SACTh6B,KAAKsqD,iBApOjB,CAAAp5C,IAAA,OAAAxN,MAAA,SAwOSpD,EAAc65C,EAAqC/3C,GACpDpC,KAAKuqD,WAAW,IAAIhC,GAAgB,CAChCjoD,KAAMA,EACN+nD,UAAWlO,EACXmO,QAASlmD,OA5OrB,CAAA8O,IAAA,OAAAxN,MAAA,SAgPSpD,EAAc05B,GAAiB,IAAAjV,EAAA/kB,KAChC,OAAO,IAAI4S,QAAQ,SAAC4iB,EAAS1P,GACzB,OAAOf,EAAKwlC,WAAW,IAAIhC,GAAgB,CACvCjoD,KAAMA,EACN05B,QAASA,EACTquB,UAAW,SAAC7zC,GACRghB,EAAQhhB,IAEZ8zC,QAAS,SAAClmD,GACN0jB,EAAO1jB,WAzP3B,CAAA8O,IAAA,QAAAxN,MAAA,WAgQQ,MAAO,CACHqQ,KAAM/T,KAAKkpD,UACXsB,SAAUxqD,KAAKmpD,iBAlQ3B,CAAAj4C,IAAA,SAAAxN,MAAA,SAsQW20B,GACHr4B,KAAKq4B,OAASA,IAvQtB,CAAAnnB,IAAA,QAAAxN,MAAA,WA0QY,IAAAg3B,EAAA16B,KACJA,KAAKwpD,gBAAkB,SAAC7pD,GACpB+6B,EAAK+vB,eAAe9qD,IAExBK,KAAKq4B,OAAOqyB,iBAAiB,UAAW1qD,KAAKwpD,iBAAiB,KA9QtE,CAAAt4C,IAAA,OAAAxN,MAAA,WAkRY1D,KAAKwpD,iBACLxpD,KAAKq4B,OAAOsyB,oBAAoB,UAAW3qD,KAAKwpD,iBAAiB,OAnR7EZ,EAAA,GCNegC,cAtCX,SAAAA,IAAe9qD,OAAAC,EAAA,EAAAD,CAAAE,KAAA4qD,GAAA5qD,KAHfsV,YAGc,EAAAtV,KAFdyoD,aAEc,EACVzoD,KAAKsV,OAAS,KAIdtV,KAAKyoD,QAAU,IAAIG,GAAQ,CACvBvwB,OAAQA,OACRwwB,KAAMzZ,SAASpM,SAAUC,2EAM7B,MAAO,CACHwmB,UAAWzpD,KAAKyoD,QAAQzjD,GACxB6lD,QAAS9L,OACTzpC,OAAQ,CACJkF,iBAAkB,mBAClB+b,sBAAuB,6BACvBiI,oBAAqB,eACrBxB,iBAAkB,2BAClBqb,gBAAiB,kBACjByS,eAAgB,iBAChBC,aAAc,GACdx3B,KAAM,KACNy3B,WAAY,MAMhBC,WAAY7b,SAASpM,SAAUC,iBCrD9BioB,GAAb,oBAAAA,IAAAprD,OAAAC,EAAA,EAAAD,CAAAE,KAAAkrD,GAAA,OAAAprD,OAAAmR,EAAA,EAAAnR,CAAAorD,EAAA,EAAAh6C,IAAA,sBAAAxN,MAAA,WAEQ,IAAK20B,OAAO8yB,aACR,OAAO,KAEX,IAAK9yB,OAAO8yB,aAAaC,aAAa,eAElC,OAAO,KAEX,IAAM91C,EAAS+iB,OAAO8yB,aAAaE,aAAa,eAChD,OAAe,OAAX/1C,EAEO,KAEUhC,KAAKq+B,MAAM2Z,mBAAmBh2C,QAd3D41C,EAAA,GCWO,SAASl8C,GAAWD,GACvB,MAAO,CACH7N,KAAM7B,EAAWuP,YACjBG,OAAQA,cC2BDw8C,eAhDX,SAAAA,EAAY76B,GAA+B,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAurD,GAAAzrD,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAyrD,GAAAprD,KAAAH,KACjC0wB,qFAQN1wB,KAAK0wB,MAAM86B,8CAOX,OAAIxrD,KAAK0wB,MAAM7iB,SAAWlP,EAAS2E,KAE3BqtB,EAAA,qBAAKgD,UAAU,oBAAf,cAMAhD,EAAA,qBAAKgD,UAAU,2CACV3zB,KAAK0wB,MAAM62B,iBA1BD70B,aC0BhBkO,mBAfR,SAAyB5/B,EAAyB0vB,GAA6B,IAAA+6B,EAC7BzqD,EAA7C6N,IACR,MAAO,CACHhB,OAH8E49C,EACnE59C,OAEH69C,YAHsED,EAC3D18C,OAAU28C,cAM9B,SAA4BzsB,GAC/B,MAAO,CACHusB,WAAY,WACRvsB,EFeD,SAACA,EAAyDC,GAE7D,IAAIysB,GAAe,IAAIT,IAAoBU,sBAE3C,GAAID,EAAc,CACd,IAAID,EACJ,OAAQC,EAAar2C,OAAOie,MACxB,IAAK,MACDm4B,EAAc,qBAAuBC,EAAar2C,OAAO01C,WAAWhmD,GACpEqzB,OAAOqO,QAAQmlB,UAAU,KAAM,OAAQH,GACvC,MACJ,QACIA,EAAc,iBACdrzB,OAAOqO,QAAQmlB,UAAU,KAAM,gBAAiB,kBAGxD5sB,EAASjwB,GAAW,CAChB88C,QAAS,GACTrsB,SAAU,CACNY,OAAQ,CACJrvB,IAAK26C,EAAar2C,OAAOkF,kBAE7BklB,YAAa,CACT1uB,IAAK26C,EAAar2C,OAAOihB,uBAE7B6J,UAAW,CACPpvB,IAAK26C,EAAar2C,OAAOkpB,qBAE7B8B,cAAe,CACXtvB,IAAK26C,EAAar2C,OAAO0nB,kBAE7ByoB,MAAO,CACHz0C,IAAK26C,EAAar2C,OAAO+iC,iBAE7B0O,KAAM,CACF/1C,IAAK26C,EAAar2C,OAAOw1C,iBAGjCY,YAAaA,UAKjBzsB,EAASjwB,GAAW,CAChB88C,QAAS,GACTrsB,SAAU,CACNY,OAAQ,CACJrvB,KALZ26C,GAAe,IAAIf,IAAkBgB,uBAKPt2C,OAAOkF,kBAE7BklB,YAAa,CACT1uB,IAAK26C,EAAar2C,OAAOihB,uBAE7B6J,UAAW,CACPpvB,IAAK26C,EAAar2C,OAAOkpB,qBAE7B8B,cAAe,CACXtvB,IAAK26C,EAAar2C,OAAO0nB,kBAE7ByoB,MAAO,CACHz0C,IAAK26C,EAAar2C,OAAO+iC,iBAE7B0O,KAAM,CACF/1C,IAAK26C,EAAar2C,OAAOw1C,iBAGjCY,YAAa,yBE3Ed9qB,CAAoG2qB,ICe5G,SAASnoD,GAAUhB,GACtB,MAAO,CACHlB,KAAM7B,EAAWurB,uBACjBxoB,MAAOA,GAwEf,SAAS2oB,GAAmBL,GACxB,MAAO,CACHxpB,KAAM7B,EAAWyrB,iCACjBJ,MAAOA,GAuJf,SAASqhC,GAAgB3pD,GACrB,MAAO,CACHlB,KAAM7B,EAAW2sD,8BACjB5pD,MAAOA,GAuDR,SAAS6pD,GAAWC,GACvB,OAAO,SAACjtB,EAAmDC,GACvDD,EAzEG,CACH/9B,KAAM7B,EAAW8sD,gCAuEqE,IAAArsB,EAQ9DZ,IAHE59B,EAL4Dw+B,EAIlF1+B,MACImpB,eAAkBjpB,UAL4Dy+B,EAAAD,EAOlFlyB,KAAQG,cAAiBC,EAPyD+xB,EAOzD/xB,MAClBe,GAR2EgxB,EAOlDx2B,SAPkDu2B,EAQlFjxB,IAAOE,QAENzN,EAQc,IAAIk+B,GAAoB,CACvCxxB,QACAuoB,sBAAuBxnB,EAAO0wB,SAASC,YAAY1uB,MAG5C2uB,QAAQusB,GACd16C,KAAK,SAAC+H,GAEH,IAAM9O,EAzDtB,SAAyB8O,EAAY9S,GACjC,GAAI8S,EAAKhQ,WAAa9C,EAAasZ,MAAMxW,SACrC,OAAOgiB,GAAoCvL,MAE/C,IAAM1W,EAAS7C,EAAa2C,QAAQ6R,KAAK,SAAC3R,GACtC,OAAOA,EAAOC,WAAagQ,EAAKhQ,WAEpC,GAAID,EACA,OAAQA,EAAOpI,MACX,KAAK7C,EAAWoL,MACZ,OAAO8hB,GAAoC9hB,MAC/C,KAAKpL,EAAW2hB,MACZ,OAAOuL,GAAoCvL,MAC/C,KAAK3hB,EAAWuL,OACZ,OAAO2hB,GAAoC3hB,OAavD,OAAO2hB,GAAoCpL,KA8Bd65B,CAAgBzgC,EAAMjY,EAAUmF,cACjDw4B,EA9FhB,SAA2B1lB,EAAY9O,GACnC,MAAO,CACHvJ,KAAM7B,EAAW2rB,gCACjBzR,KAAMA,EACN9O,SAAUA,GA0FOwgB,CAAkB1R,EAAM9O,MAEpC4uB,MAAM,SAACC,GACJ2F,EAAS8sB,GAAgB,CACrBrsD,KAAM45B,EAAIh5B,KACVX,QAAS25B,EAAI35B,aArBrBs/B,EAAS8sB,GAAgB,CACrBrsD,KAAM,gBACNC,QAAS,iDAgElB,SAASysD,KACZ,OAAO,SAACntB,EAAmDC,GACvDD,EApBG,CACH/9B,KAAM7B,EAAW6rB,oCAkBqE,IAAAsyB,EASlFte,IATkFue,EAAAD,EAIlF5vC,KAAQG,cAAiBC,EAJyDyvC,EAIzDzvC,MAAOzE,EAJkDk0C,EAIlDl0C,SACzBwF,EAL2EyuC,EAKlF3uC,IAAOE,OAL2Es9C,EAAA7O,EAMlFp8C,MACImpB,eAAkBhoB,EAP4D8pD,EAO5D9pD,aAAcjB,EAP8C+qD,EAO9C/qD,UAP8C+qD,EAOnCjqD,MAInD,GAAIG,IAAiB1D,EAAsB8D,SAIzB,OAAdrB,EAAJ,CAfsF,IAAAsV,EAmBvCtV,EAAvCqpB,EAnB8E/T,EAmB9E+T,aAA8B3lB,EAnBgD4R,EAmBhEnQ,aAAgBzB,GAEtC,GAAK2lB,EAIiB,IAAIhF,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAG/Bs7C,oBAAoBtnD,EAAI2lB,EAAapR,KAAKhQ,UACnDiI,KAAK,SAAC/B,GACHwvB,EA7CL,CACH/9B,KAAM7B,EAAWgsB,wCA8CZgO,MAAM,SAACC,GA1Cb,IAA6Bl3B,EA2CpB68B,GA3CoB78B,EA2CS,CACzB1C,KAAM45B,EAAIh5B,KACVX,QAAS25B,EAAI35B,SA5CtB,CACHuB,KAAM7B,EAAWqsB,kCACjBtpB,MAAOA,2BChXAm5C,eA5BX,SAAAA,EAAY7qB,GAAmB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAu7C,GAAAz7C,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAy7C,GAAAp7C,KAAAH,KACrB0wB,0EAIN,OACIC,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,qBAAKgD,UAAU,aACXhD,EAAA,cAACiD,GAAD,CAAQra,KAAMvZ,KAAK0wB,MAAMnX,KAAMuX,KAAM9wB,KAAK0wB,MAAMmD,YAAc,MAElElD,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,mBAAGuD,KAAM,YAAcl0B,KAAK0wB,MAAMnX,KAAKhQ,SAAU4qB,OAAO,UAAUn0B,KAAK0wB,MAAMnX,KAAKtL,UACjF,IAFL,SAGMjO,KAAK0wB,MAAMnX,KAAKhQ,SAHtB,UAKAonB,EAAA,qBAAKgD,UAAU,gBACV3zB,KAAK0wB,MAAMnX,KAAK9S,cAAgBkqB,EAAA,2DAErCA,EAAA,qBAAKgD,UAAU,YACV,CAAC3zB,KAAK0wB,MAAMnX,KAAKgb,KAAMv0B,KAAK0wB,MAAMnX,KAAKvY,MAAOhB,KAAK0wB,MAAMnX,KAAKib,SAASzqB,OAAO,SAAAgoB,GAAC,OAAIA,IAAG5e,KAAK,OAASwd,EAAA,4EArB1G+B,aCkBb65B,eASF,SAAAA,EAAY77B,GAAwB,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAusD,IAChC9sD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAysD,GAAApsD,KAAAH,KAAM0wB,KARV87B,kBAOoC,EAAA/sD,EAHpCwnC,iBAGoC,EAAAxnC,EAFpCynC,kBAEoC,EAGhCznC,EAAK+sD,aAAe,KACpB/sD,EAAKwnC,YAAcvU,cACnBjzB,EAAKynC,aAAexU,cAEpBjzB,EAAKuB,MAAQ,CACTyrD,qBAAqB,EACrBvd,iBAAiB,EACjB2R,gBAAgB,EAChB6L,oBAAqB,IAXOjtD,4FAgBhCO,KAAKwzB,SAAS,CAAEi5B,qBAAqB,qDAIrCzsD,KAAKwzB,SAAS,CAAE0b,iBAAiB,oDAIjClvC,KAAKwzB,SAAS,CAAEqtB,gBAAgB,+CAIhC7gD,KAAK0wB,MAAMi8B,qDAIX,QAAI3sD,KAAK0wB,MAAM/F,8CAMV0b,GAEL,IAAIuB,EADJvB,EAAEwB,iBAGED,EADA5nC,KAAKinC,YAAYU,QACS3nC,KAAKinC,YAAYU,QAAQjkC,MAEzB,GAE9B1D,KAAK4sD,cAAchlB,iDAKf5nC,KAAKinC,YAAYU,SACS3nC,KAAKinC,YAAYU,QAAQjkC,4CAO7CA,IASgB,OAAtB1D,KAAKwsD,eACJ,IAAIzpD,MAAO+S,UAAY9V,KAAKwsD,aAAa12C,UAAYy2C,EAAWM,kBACjE7sD,KAAKwsD,aAAe,IAAIzpD,KACxB/C,KAAK0wB,MAAMo8B,cAAc,CACrBv3C,MAAO7R,EACPuzB,cAAe,2CAKd1d,GACTvZ,KAAK0wB,MAAMq8B,aAAaxzC,EAAKhQ,+CAI7B65B,KAAMvjC,KAAK,CACP4f,MAAO,mBACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,mGAgBFrwB,GAEV,OAAIA,EAAK4M,OAAS,GACP5M,EAGPqwB,EAAA,0BACKrwB,EAAK+e,MAAM,EAAG,IADnB,iDAQJ,IAMM4mB,EACFtV,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,0BACIA,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuBlT,KAAK0wB,MAAMjqB,aAAazB,KACtD2rB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SACtB/iC,KAAKgtD,cAAchtD,KAAK0wB,MAAMjqB,aAAanG,QAIpDqwB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,QAAQ2wB,MAAO,CAAEqU,cAAe,SAAUC,WAAY,MAAOC,YAAa,SAErFzV,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACV,IACDyvB,EAAA,sBAAMkB,MAAO,CAAEO,SAAU,SAAzB,+BAINkU,EACF3V,EAAA,cAACA,EAAA,SAAD,KAaIA,EAAA,cAAC8X,GAAA,EAAD,CACIS,MAAM,SACNzV,KAAK,OACLW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,SAK1C,OACI2wB,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,EAAaK,QAASA,0CAIrC,IAAAx1B,EAAA9Q,KACV,IAAKA,KAAK0wB,MAAMhG,MAAO,CAEnB,OACIiG,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,OAAOvB,QAFP,2FAEyBstD,UAAQ,IAGrD,OAAgC,IAA5BjtD,KAAK0wB,MAAMhG,MAAMxd,OAEbyjB,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,UAAUvB,QAAQ,iBAAiBstD,UAAQ,IAGxDjtD,KAAK0wB,MAAMhG,MAAMrhB,IAAI,SAACkQ,GACzB,OAAIA,EAAK9O,WAAa8gB,GAAoCjoB,KAElDqtB,EAAA,qBACIgD,UAAU,0BACVziB,IAAKqI,EAAKhQ,SACV6qB,QAAS,WAAQtjB,EAAKi8C,aAAa5sD,KAAK2Q,EAAMyI,KAC9CoX,EAAA,qBAAKgD,UAAU,SAEVpa,EAAKtL,SAFV,KAEsBsL,EAAKhQ,SAF3B,MAQJonB,EAAA,qBACIgD,UAAU,sBACVziB,IAAKqI,EAAKhQ,SACV6qB,QAAS,WAAQtjB,EAAKi8C,aAAa5sD,KAAK2Q,EAAMyI,KAC9CoX,EAAA,qBAAKgD,UAAU,SAEVpa,EAAKtL,SAFV,KAEsBsL,EAAKhQ,SAF3B,gDAWhB,OACIonB,EAAA,qBAAKgD,UAAU,WACXhD,EAAA,qBAAKgD,UAAU,QACXhD,EAAA,sBAAMgD,UAAU,eAAhB,QACAhD,EAAA,0BAAO3wB,KAAK0wB,MAAMjqB,aAAanG,OAEnCqwB,EAAA,qBAAKgD,UAAU,eACXhD,EAAA,sBAAMgD,UAAU,eAAhB,eACAhD,EAAA,0BAAO3wB,KAAK0wB,MAAMjqB,aAAalB,8DAS3C,IAAI2nD,EACAvtD,EAuCJ,OAtCIK,KAAK0wB,MAAM/F,aACP3qB,KAAK0wB,MAAM/F,aAAalgB,WAAa8gB,GAAoCpL,KACzE+sC,EACIv8B,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,UACLkzB,QAASp0B,KAAK2sD,iBAAiBr4B,KAAKt0B,OAFxC,oBAKJktD,EACIv8B,EAAA,cAAC8X,GAAA,EAAD,CACIC,UAAQ,EACRxnC,KAAK,WAFT,mBAMJvB,EACIgxB,EAAA,4DACoCA,EAAA,yBAC/B3wB,KAAK4jC,eAAe5jC,KAAK0wB,MAAM/F,aAAalgB,WAGrD9K,EACIgxB,EAAA,cAAC2U,GAAA,EAAD,CACIpkC,KAAK,UACLvB,QAASA,EACTstD,UAAQ,MAKpBC,EACIv8B,EAAA,cAAC8X,GAAA,EAAD,CACIC,UAAQ,EACRxnC,KAAK,WAFT,mBAKJvB,EAAU,wBAGVgxB,EAAA,qBAAKgD,UAAU,kBACXhD,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,SAAUrQ,UAAW,SACzC0iB,GAELv8B,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,SAAUrQ,UAAW,SACzC7qC,qDAOb,OAAQK,KAAK0wB,MAAM5uB,WACf,KAAK/C,EAAoBuE,KACrB,OACIqtB,EAAA,iCAER,KAAK5xB,EAAoB0rB,QACrB,OACIkG,EAAA,oCAER,KAAK5xB,EAAoBouD,SACrB,OACIx8B,EAAA,qCAER,KAAK5xB,EAAoBosB,QACrB,OACIwF,EAAA,oCAER,KAAK5xB,EAAoB4D,QACrB,OACIguB,EAAA,8CAER,KAAK5xB,EAAoBkH,MACrB,OACI0qB,EAAA,0CAER,QACI,OACIA,EAAA,iFAQZ,GAAK3wB,KAAK0wB,MAAMjqB,aAGhB,OACIkqB,EAAA,cAAC4xB,GAAD,CAAoBnpC,eAAgBpZ,KAAK0wB,MAAMjqB,aAAazB,4CAIrDyF,GACX,OAAQA,GACJ,KAAM8gB,GAAoCjoB,KACtC,OACIqtB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAjB,QAER,KAAMqqB,GAAoCpL,KACtC,OACIwQ,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAjB,iBAER,KAAMqqB,GAAoC1L,uBACtC,OAAQ8Q,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,YAAxC,sBAAyEd,EAAA,kCAAzE,eACZ,KAAMpF,GAAoCzL,0BACtC,OAAQ6Q,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,OAAO2wB,MAAO,CAAEJ,MAAO,UAAxC,kBAAmEd,EAAA,kCAAnE,YACZ,KAAMpF,GAAoC3hB,OACtC,OAAQ+mB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SAAjB,cAAqCyvB,EAAA,iCAArC,yBACZ,KAAMpF,GAAoC9hB,MACtC,OAAQknB,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,WAAjB,cAAuCyvB,EAAA,gCAAvC,yBACZ,KAAMpF,GAAoCvL,MACtC,OAEI2Q,EAAA,0BAAMA,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAjB,gBAAwCyvB,EAAA,gCAAxC,uEAgCZ,OAAgC,OAA5B3wB,KAAK0wB,MAAM/F,aAEPgG,EAAA,qBAAKgD,UAAU,gBACXhD,EAAA,mBAAGgD,UAAU,eAAb,yBAOJhD,EAAA,qBAAKgD,UAAU,gBACXhD,EAAA,cAACy8B,GAAD,CAAe7zC,KAAMvZ,KAAK0wB,MAAM/F,aAAapR,OAC5CvZ,KAAK4jC,eAAe5jC,KAAK0wB,MAAM/F,aAAalgB,kDAOzD,OACIkmB,EAAA,qBAAKgD,UAAU,wDAMnB,OAAQhD,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,uDAInB,OACIyvB,EAAA,qBAAKgD,UAAU,aACXhD,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,WACTvyB,KAAK,SACLkzB,QAASp0B,KAAK4mD,sBAAsBtyB,KAAKt0B,OAF7C,gBAMJ2wB,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAAC8X,GAAA,EAAD,CACIS,MAAM,SACNzV,KAAK,OACLW,QAASp0B,KAAKmpC,WAAW7U,KAAKt0B,2CAS9C,OAAIA,KAAKgB,MAAMyrD,oBACJ97B,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,gBAAkB3jC,KAAK0wB,MAAMjqB,aAAazB,KAGpEhF,KAAKgB,MAAMkuC,gBACJve,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAG,mBAGzB3jC,KAAKgB,MAAM6/C,eACJlwB,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMjqB,aAAazB,KAIzE2rB,EAAA,qBAAKgD,UAAU,qCACXhD,EAAA,cAACga,GAAD,CAAUrE,QAAStmC,KAAK4qC,sBAEvB5qC,KAAK6mD,kBACNl2B,EAAA,qBAAKgD,UAAU,8BACXhD,EAAA,qBAAKgD,UAAU,8CACXhD,EAAA,iDACAA,EAAA,sBAAM3rB,GAAG,aAAa2uB,UAAU,YAC5B0U,SAAUroC,KAAKqoC,SAAS/T,KAAKt0B,OAC7B2wB,EAAA,uBACI6L,IAAKx8B,KAAKinC,YACVuB,WAAS,EACTD,SAAUvoC,KAAKooC,oBAAoB9T,KAAKt0B,MACxCsoC,YAAY,sBAEhB3X,EAAA,cAAC8X,GAAA,EAAD,CACI9U,UAAU,eACViV,KAAK,aACL13B,IAAI,SACJ23B,SAAS,UAER7oC,KAAKqtD,uBAGd18B,EAAA,qBAAKgD,UAAU,cACV3zB,KAAKstD,gBAWd38B,EAAA,qBAAKgD,UAAU,gBACXhD,EAAA,yCACC3wB,KAAKutD,qBACLvtD,KAAKwtD,yBAgBbxtD,KAAKytD,uBAzfG/6B,aAAnB65B,GAIKM,eAAyB,IA4hBrBN,UCrgBA3rB,mBA/Bf,SAAyB5/B,EAAyB0vB,GAC9C,IAAK1vB,EAAMI,MAAMmpB,gBAA4D,OAAzCvpB,EAAMI,MAAMmpB,eAAejpB,UAC3D,MAAM,IAAIf,MAAM,uDAFuD,IAAA+qB,EAYvEtqB,EALAI,MACImpB,eACIjpB,UAKZ,MAAO,CAAEmF,aAdkE6kB,EASlD7kB,aAKFikB,MAdoDY,EASpCZ,MAKTC,aAd6CW,EAS7BX,aAKF7oB,UAd+BwpB,EASfxpB,YAQzD,SAA4Bm9B,GAC/B,MAAO,CACH6tB,cAAe,SAAAttD,GAA8B,IAA3B+V,EAA2B/V,EAA3B+V,MAAO0hB,EAAoBz3B,EAApBy3B,cACrBgI,EH2FL,SAA+B1pB,GAClC,sBAAAmB,EAAA5W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAA2B,EAAOqrB,EAAmDC,GAA1D,IAAAyM,EAAArqC,EAAAsqC,EAAA59B,EAAAe,EAAA4Q,EAAA+tC,EAAA3tC,EAAA4tC,EAAAvkD,EAAAwkD,EAAAC,EAAAC,EAAAC,EAAA,OAAAh8C,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,UACH2sB,EArBG,CACH/9B,KAAM7B,EAAW2uD,iCAsBU,IAAvBz4C,EAAMA,MAAMrI,OAHb,CAAA4G,EAAAxB,KAAA,eAIC2sB,EAASlU,GAAmB,OAJ7BjX,EAAAvB,OAAA,oBAAAo5B,EAaqBzM,IAHE59B,EAVvBqqC,EASCvqC,MACImpB,eAAkBjpB,UAVvBsqC,EAAAD,EAYC/9B,KAAQG,cAAiBC,EAZ1B49B,EAY0B59B,MAZ1B49B,EAYiCriC,SACzBwF,EAbR48B,EAaC98B,IAAOE,OAGO,OAAdzN,EAhBD,CAAAwS,EAAAxB,KAAA,eAAAwB,EAAAvB,OAAA,wBAmBGoN,EAAMre,EAAUmF,aAEhBinD,EAAa,IAAIluB,GAAoB,CACvCxxB,QACAuoB,sBAAuBxnB,EAAO0wB,SAASC,YAAY1uB,MAOnD+O,EAAgBJ,EAAII,MAAMxW,SAC1BokD,EAA4B,GAC5BvkD,EAAyB,GACzBwkD,EAAyB,GACzBC,EAA2B,GAE/BluC,EAAIvW,QAAQ2R,QAAQ,SAACzR,GACjB,OAAQA,EAAOpI,MACX,KAAK7C,EAAWuL,OACZR,EAAQ0tB,KAAKxtB,EAAOC,UACxB,KAAKlL,EAAWoL,MACZkkD,EAAW72B,KAAKxtB,EAAOC,aAzChCuK,EAAAzB,KAAA,GAAAyB,EAAAxB,KAAA,GAiEqBo7C,EAAW12B,YAAYzhB,GAjE5C,QAiEOmV,EAjEP5W,EAAAC,KAuEOg6C,EAAoCrjC,EAAMrhB,IAAI,SAAAsN,GAA4B,IAAzBpN,EAAyBoN,EAAzBpN,SAenD,MAAO,CACHA,WAAU0E,SAhB8D0I,EAAf1I,SAiBzDxD,SAfAlB,IAAawW,EACFwL,GAAoCvL,MACxC2tC,EAAWhtD,QAAQ4I,IAAa,EAC5BgiB,GAAoC9hB,MACxCmkD,EAAQjtD,QAAQ4I,IAAa,EACzBgiB,GAAoCzL,0BACxC+tC,EAAUltD,QAAQ4I,IAAa,EAC3BgiB,GAAoC1L,uBACxCzW,EAAQzI,QAAQ4I,IAAa,EACzBgiB,GAAoC3hB,OAEpC2hB,GAAoCjoB,QAOvD27B,EAASlU,GAAmBgjC,IA3F7Bj6C,EAAAxB,KAAA,iBAAAwB,EAAAzB,KAAA,GAAAyB,EAAAE,GAAAF,EAAA,UA6FCmrB,GArGc78B,EAqGY,CACtB1C,KAAMoU,EAAAE,GAAG1T,KACTX,QAASmU,EAAAE,GAAGrU,SAtGjB,CACHuB,KAAM7B,EAAW4uD,+BACjB7rD,MAAOA,KAKJ,yBAAA0R,EAAAtB,OARX,IAA0BpQ,GAQfwR,EAAA5T,KAAA,cAAP,gBAAAsU,EAAAc,GAAA,OAAAsB,EAAAjE,MAAAzS,KAAA0S,YAAA,GG5FiBmuB,CAA8B,CAAEtrB,QAAO0hB,oBAEpD81B,aAAc,SAACxjD,GACX01B,EAAS4B,GAAmBt3B,KAEhCojD,iBAAkB,WACd1tB,EAAS4B,SAKND,CAAoG2rB,IC7C7G2B,eACF,SAAAA,EAAYx9B,GAA+B,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAkuD,GAAApuD,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAouD,GAAA/tD,KAAAH,KACjC0wB,iFAIN,OACIC,EAAA,mFAOJ,OACIA,EAAA,oEAOJ,OAAQ3wB,KAAK0wB,MAAMnuB,cACf,KAAK1D,EAAsByE,KAE3B,KAAKzE,EAAsB2D,QACvB,OAAOxC,KAAKmsC,gBAChB,KAAKttC,EAAsBoH,MACvB,OAAOjG,KAAKosC,cAChB,KAAKvtC,EAAsB8D,QACvB,OACIguB,EAAA,cAACw9B,GAAD,mDAMZ,OAAQnuD,KAAK0wB,MAAMnuB,cACf,KAAK1D,EAAsByE,KAEvBtD,KAAK0wB,MAAM09B,iBAAiBpuD,KAAK0wB,MAAMtX,gEAK/CpZ,KAAK0wB,MAAM4b,kBA7CY5Z,aAoFhBkO,mBAlBf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACHnuB,aAAcvB,EAAMI,MAAMmpB,eAAehoB,eAI1C,SAA4B08B,GAC/B,MAAO,CACHmvB,iBAAkB,SAACh1C,GACf6lB,EJ1BL,SAAc7lB,GACjB,sBAAA5Z,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,IAAAC,EAAAC,EAAApxB,EAAAzE,EAAAwF,EAAAs8B,EAAA1rB,EAAA,OAAA5N,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACH2sB,EA5BG,CACH/9B,KAAM7B,EAAWirB,yBA0Bd6U,EAMCD,IANDE,EAAAD,EAICvxB,KAAQG,cAAiBC,EAJ1BoxB,EAI0BpxB,MAAOzE,EAJjC61B,EAIiC71B,SACzBwF,EALRowB,EAKCtwB,IAAOE,OAGLs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAV1CoB,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAcmB+4B,EAAU/mB,OAAOlL,GAdpC,WAcOuG,EAdPvN,EAAA2B,MAeSjL,OAASyiB,GAA0BxiB,OAf5C,CAAAqJ,EAAAE,KAAA,gBAgBK2sB,EAAS77B,GAAU,CACf1D,KAAM,gBACNC,QAAS,wCAlBlByS,EAAAG,OAAA,kBAsBC0sB,GA5CgBx4B,EA4CKkZ,EA3CtB,CACHze,KAAM7B,EAAWmrB,yBACjB/jB,aAAcA,EACdikB,MAAO,QAkBJtY,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,SAwBC6sB,EAAS77B,GAAU,CACf1D,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,WA1BjB,yBAAAyS,EAAAI,OAtBJ,IAAqB/L,GAsBjByL,EAAAlS,KAAA,aAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GIyBiBmuB,CAAaznB,KAE1BkzB,SAAU,WACNrN,EJlCD,CACH/9B,KAAM7B,EAAWwrB,wBIuCV+V,CAA8FstB,ICnDtG,SAAS9qD,GAAUhB,GACtB,MAAO,CACHlB,KAAM7B,EAAW2sB,6BACjB5pB,MAAOA,GA2MR,SAASisD,KACZ,OAAO,SAACpvB,EAAmDC,GACvD,IAAMl+B,EAAQk+B,IACd,IAAKl+B,EAAMI,MAAM0qB,qBAAqBxqB,UAClC,MAAM,IAAIf,MAAM,uBAWhBS,EAPAI,MACI0qB,qBACIxqB,UACIsqB,sBAMUnM,MAAM7c,gBAAgB1B,OAAS/C,EAAoB0E,GAO7Eo8B,EAAS,CACL/9B,KAAM7B,EAAWgtB,qCAPjB4S,EAAS,CACL/9B,KAAM7B,EAAWktB,+CCnClB+hC,eApNX,SAAAA,EAAY59B,GAA+B,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAsuD,GAAAxuD,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAwuD,GAAAnuD,KAAAH,KACjC0wB,8EAGG,IAAAjxB,EAAAO,KAGHuuD,EAAa,WACf9uD,EAAK+uD,uBACNl6B,KAAKt0B,MACRojC,KAAMkM,QAAQ,CACV7vB,MAAO,kCACP4jB,QACI1S,EAAA,kDAIJE,MAAO,OACP0e,KAAM,WACFgf,qDAORvuD,KAAK0wB,MAAM+9B,oBAAoBzuD,KAAK0wB,MAAMjqB,aAAazB,sCAIvD,OACIhF,KAAK0wB,MAAM5uB,YAAc5D,EAAUuF,QACnCzD,KAAK0wB,MAAM9tB,gBAAgB1B,OAAS/C,EAAoB0E,KACvD7C,KAAK0wB,MAAMlvB,YAAcpD,EAAU4E,KAChChD,KAAK0wB,MAAMlvB,YAAcpD,EAAU0Q,OACnC9O,KAAK0wB,MAAMlvB,YAAcpD,EAAU4D,wCAItCqkC,GACLA,EAAEwB,iBACF7nC,KAAK0wB,MAAMif,+CAGDtJ,GACVA,EAAEuJ,UACF5vC,KAAK0wB,MAAMg+B,cAAcroB,EAAElS,OAAOzwB,4CAKlC0/B,KAAMvjC,KAAK,CACP4f,MAAO,4BACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,0HAMFrwB,GAEV,OAAIA,EAAK4M,OAAS,GACP5M,EAGPqwB,EAAA,0BACKrwB,EAAK+e,MAAM,EAAG,IADnB,iDAQJ,IAAM4mB,EACFtV,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,0BACIA,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuBlT,KAAK0wB,MAAMjqB,aAAazB,KACtD2rB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SACtB/iC,KAAKgtD,cAAchtD,KAAK0wB,MAAMjqB,aAAanG,QAIpDqwB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,QAAQ2wB,MAAO,CAAEqU,cAAe,SAAUC,WAAY,MAAOC,YAAa,SAErFzV,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACV,IACDyvB,EAAA,sBAAMkB,MAAO,CAAEO,SAAU,SAAzB,4BAINkU,EACF3V,EAAA,cAACA,EAAA,SAAD,KAOIA,EAAA,cAAC8X,GAAA,EAAD,CAEIvnC,KAAK,SACLuyB,KAAK,QACLW,QAASp0B,KAAK2uD,WAAWr6B,KAAKt0B,OAJlC,yBAOC,IACD2wB,EAAA,cAAC8X,GAAA,EAAD,CACIS,MAAM,SACNzV,KAAK,OACLW,QAASp0B,KAAK4uD,WAAWt6B,KAAKt0B,SAI1C,OACI2wB,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,EAAaK,QAASA,8CAM/C,GAAKtmC,KAAK0wB,MAAMjqB,aAGhB,OACIkqB,EAAA,cAAC4xB,GAAD,CAAoBnpC,eAAgBpZ,KAAK0wB,MAAMjqB,aAAazB,4CAIrDqrC,GACX,OAAQA,EAAMztC,gBAAgB1B,MAG1B,KAAM/C,EAAoB8H,MAE1B,KAAM9H,EAAoBohB,iBACtB,MAAO,oCAGf,OAAQ8wB,EAAM1sC,WACV,KAAM1F,EAAU2F,MACZ,MAAO,8BACX,QACI,MAAO,yEAKf,OACI+sB,EAAA,sBAAM3rB,GAAG,iBACL2uB,UAAU,+BACV0U,SAAUroC,KAAKqoC,SAAS/T,KAAKt0B,OAC7B2wB,EAAA,qBAAKgD,UAAU,8BACXhD,EAAA,qBAAKgD,UAAU,uDAAf,QAGAhD,EAAA,qBAAKgD,UAAU,uDAAf,YAIJhD,EAAA,qBAAKgD,UAAU,oCACXhD,EAAA,qBAAKgD,UAAU,sDACXhD,EAAA,qBAAKgD,UAAU,yCACXhD,EAAA,sBAAMgD,UAAU,2CAAhB,UAIJhD,EAAA,qBAAKgD,UAAU,2CACXhD,EAAA,cAAC4f,GAAA,EAAD,CAAO7sC,MAAO1D,KAAK0wB,MAAM9E,sBAAsBnM,MAAM/b,OAAS,GAC1DiwB,UAAW3zB,KAAKwwC,eAAexwC,KAAK0wB,MAAM9E,sBAAsBnM,OAChE8oB,SAAUvoC,KAAK6uD,cAAcv6B,KAAKt0B,UAG9C2wB,EAAA,qBAAKgD,UAAU,4DACXhD,EAAA,qBAAKgD,UAAU,iCACV3zB,KAAK0wB,MAAM9E,sBAAsBnM,MAAM/b,SAIpDitB,EAAA,qBAAKgD,UAAU,iCACXhD,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,OACTmV,KAAK,iBACL13B,IAAI,SACJw3B,UAAW1oC,KAAKiyC,QAAQ9xC,KAAKH,MAC7B6oC,SAAS,UAJb,2CAaZ,OACIlY,EAAA,qBAAKgD,UAAU,oBACV3zB,KAAK6mD,kBACL7mD,KAAK+lD,eACNp1B,EAAA,wDAIAA,EAAA,qBAAKgD,UAAU,yBACV3zB,KAAKuyC,wBA7MK7f,aCmChBkO,mBAhCf,SAAyB5/B,EAAmB0vB,GACxC,IAAK1vB,EAAMI,MAAM0qB,qBAAqBxqB,UAClC,MAAM,IAAIf,MAAM,sBAFiD,IAKxCgJ,EAMzBvI,EANA4M,KAAQG,cAAiBxE,SALwCulD,EAWjE9tD,EALAI,MACI0qB,qBACIxqB,UAIZ,MAAO,CACHiI,WAAU9C,aAbuDqoD,EAQ5CroD,aAKGmlB,sBAbyCkjC,EAQ9BljC,sBAMnC9pB,UAdiEgtD,EAQPhtD,UAM/CN,UAdsDstD,EAQIttD,UAM/CoB,gBAd2CksD,EAQelsD,kBAUjF,SAA4Bq8B,GAC/B,MAAO,CACHwvB,oBAAqB,SAACr1C,GAClB6lB,EF+FL,SAAkB7lB,GACrB,sBAAA1C,EAAA5W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAA2B,EAAOqrB,EAAmDC,GAA1D,IAAAyM,EAAAC,EAAA59B,EAAAzE,EAAAwF,EAAAs8B,EAAA,OAAAt5B,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,OACH2sB,EAAU,CACN/9B,KAAM7B,EAAW0vD,oCAFlBpjB,EAQCzM,IARD0M,EAAAD,EAMC/9B,KAAQG,cAAiBC,EAN1B49B,EAM0B59B,MAAOzE,EANjCqiC,EAMiCriC,SACzBwF,EAPR48B,EAOC98B,IAAOE,OAGLs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAG7C,IACIq6B,EAAU3jB,aAAatO,EAAgB7P,GACvC01B,EAAS,CACL/9B,KAAM7B,EAAW2vD,sCAEvB,MAAOpF,GACLloD,QAAQU,MAAM,oBAAqBwnD,GACnC3qB,EAAS,CACL/9B,KAAM7B,EAAW4vD,kCACjB7sD,MAAO,CACH1C,KAAMkqD,EAAGtpD,KACTX,QAASiqD,EAAGjqD,WA1BrB,wBAAAmU,EAAAtB,SAAAoB,EAAA5T,SAAP,gBAAAsU,EAAAc,GAAA,OAAAsB,EAAAjE,MAAAzS,KAAA0S,YAAA,GEhGiBmuB,CAAiBznB,KAE9Bs1C,cAAe,SAACjvC,GACZwf,EFwKL,SAAqBxf,GACxB,OAAO,SAACwf,GAAsD,IAAAiwB,EAC1BpwC,GAAWqwC,oBAAoB1vC,GADL2vC,EAAAtvD,OAAAwY,GAAA,EAAAxY,CAAAovD,EAAA,GACnDG,EADmDD,EAAA,GACnChtD,EADmCgtD,EAAA,GAGtDhtD,EAAMlB,OAAS/C,EAAoB0E,GACnCo8B,EAAS,CACL/9B,KAAM7B,EAAWiwD,qCACjBltD,MAAO08C,GAAU,CACbp/C,KAAM,UACNC,QAASyC,EAAMzC,YAIvBs/B,EAAS,CACL/9B,KAAM7B,EAAW6sB,uCACjBzM,MAAO4vC,IAGfpwB,EAASovB,OE1LIxtB,CAAoBphB,KAEjCkwB,OAAQ,WACJ1Q,EFsPR,eAAAtoB,EAAA7W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAmC,EAAO6qB,EAAmDC,GAA1D,IAAAl+B,EAAA8rC,EAAA9+B,EAAAzE,EAAAulD,EAAAroD,EAAAmlB,EAAA7c,EAAAkI,EAAAo0B,EAAA,OAAAt5B,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,UACH2sB,EAAS,CACL/9B,KAAM7B,EAAWkwD,gCAGfvuD,EAAQk+B,KACH99B,MAAM0qB,qBAAqBxqB,UANnC,CAAA+S,EAAA/B,KAAA,cAOO,IAAI/R,MAAM,0BAPjB,cAAAusC,EAkBC9rC,EAPA4M,KAAQG,cAAiBC,EAX1B8+B,EAW0B9+B,MAAOzE,EAXjCujC,EAWiCvjC,SAXjCulD,EAkBC9tD,EANAI,MACI0qB,qBACIxqB,UAAamF,EAdtBqoD,EAcsBroD,aAAcmlB,EAdpCkjC,EAcoCljC,sBAG5B7c,EACP/N,EADA6N,IAAOE,OAGLkI,EAAS,CACXwI,MAAOmM,EAAsBnM,MAAM/b,OAGjC2nC,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MA1B1CqD,EAAAhC,KAAA,EAAAgC,EAAA/B,KAAA,GA8BO+4B,EAAUrjB,aAAavhB,EAAazB,GAAIuE,EAAU0N,GA9BzD,QA+BCgoB,EAAS,CACL/9B,KAAM7B,EAAWotB,iCAhCtBpY,EAAA/B,KAAA,iBAAA+B,EAAAhC,KAAA,GAAAgC,EAAAL,GAAAK,EAAA,SAmCC3S,QAAQU,MAAM,8BAAdiS,EAAAL,IACAirB,EAAS,CACL/9B,KAAM7B,EAAWmwD,6BACjBptD,MAAO08C,GAAU,CACbp/C,KAAM,QACNC,QAAS0U,EAAAL,GAAGrU,YAxCrB,QA4CHs/B,EAASovB,MA5CN,yBAAAh6C,EAAA7B,SAAA4B,EAAApU,KAAA,aAAP,gBAAAuW,EAAAC,GAAA,OAAAG,EAAAlE,MAAAzS,KAAA0S,YAAA,OEjPWkuB,CAA8FsS,cC/CxF3yC,uBACjB,SAAAA,EAAYmwB,GAAoB,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAO,GAAAT,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAS,GAAAJ,KAAAH,KACtB0wB,gFAIN,OACIC,EAAA,uBAAOgD,UAAU,cACbhD,EAAA,2BACIA,EAAA,wBACIA,EAAA,wBACIA,EAAA,sBAAMgD,UAAU,eAAhB,iBAEJhD,EAAA,wBAEQgR,KAAKC,eAAe,QAAS,CACzBC,MAAO,QACPC,IAAK,UACLE,KAAM,YACPD,OAAO/hC,KAAK0wB,MAAMtuB,MAAM48C,MAIvCruB,EAAA,wBACIA,EAAA,wBACIA,EAAA,sBAAMgD,UAAU,eAAhB,aAEJhD,EAAA,wBACIA,EAAA,sBAAMkB,MAAO,CAAES,WAAY,cAAgBtyB,KAAK0wB,MAAMtuB,MAAM4C,MAGpE2rB,EAAA,wBACIA,EAAA,wBACIA,EAAA,sBAAMgD,UAAU,eAAhB,gBAEJhD,EAAA,wBACK3wB,KAAK0wB,MAAMtuB,MAAMxC,gDAStC,OAAKI,KAAK0wB,MAAMtuB,MAAMvC,KAQlB8wB,EAAA,qDANIA,EAAA,qBAAKkB,MAAO,CAAEgpB,UAAW,OAAQjK,UAAW,WAA5C,8DAaR,IAAMrrC,EACForB,EAAA,yBACIA,EAAA,uBACK3wB,KAAK0wB,MAAMtuB,MAAMzC,SAEtBgxB,EAAA,cAAC8+B,GAAA,EAAD,CAAUC,UAAU,EAAO79B,MAAO,CAAEgV,gBAAiB,gBACjDlW,EAAA,cAAC8+B,GAAA,EAASE,MAAV,CAAgBC,OAAO,SAAS1+C,IAAI,IAAI2gB,MAAO,CAAEgV,gBAAiB,gBAC7D7mC,KAAK6vD,iBAGdl/B,EAAA,cAAC8+B,GAAA,EAAD,CAAUC,UAAU,EAAO79B,MAAO,CAAEgV,gBAAiB,gBACjDlW,EAAA,cAAC8+B,GAAA,EAASE,MAAV,CAAgBC,OAAO,kBAAkB1+C,IAAI,IAAI2gB,MAAO,CAAEgV,gBAAiB,gBACtE7mC,KAAK8vD,gBAMtB,OACIn/B,EAAA,cAAC2U,GAAA,EAAD,CACIpkC,KAAK,QACL+rD,UAAQ,EACRttD,QAAQ,QACRg0B,UAAU,QACVpuB,YAAaA,WApFMmtB,cCE5B,SAASosB,GAATt/C,GAOL,IANIE,EAMJF,EANIE,KAAMC,EAMVH,EANUG,QAASC,EAMnBJ,EANmBI,OAAQ8mC,EAM3BlnC,EAN2BknC,QAAStmC,EAMpCZ,EANoCY,MAAOP,EAM3CL,EAN2CK,KAOzC,MAAO,CACHH,OAAMC,UAASC,SACfoF,GAAI+5C,OACJC,GAAI,IAAIj8C,KACR2jC,UAAStmC,QAAOP,YCZlB4gC,eACF,SAAAA,EAAY/P,GAAe,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACjB0wB,qFAIN,OACIC,EAAA,wGAOJ,OACIA,EAAA,6FAMIvuB,GACR,OACIuuB,EAAA,cAACo/B,GAAD,CAAO3tD,MAAOA,qCAKlB,OAAQpC,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KACvB,OAAOtD,KAAKgwD,oBAChB,KAAKnxD,EAAsB2D,QACvB,OAAOxC,KAAKmsC,gBAChB,KAAKttC,EAAsBoH,MACvB,OAAIjG,KAAK0wB,MAAM6C,KAAKnxB,MACTpC,KAAKosC,YAAYpsC,KAAK0wB,MAAM6C,KAAKnxB,OAEjCpC,KAAKosC,YAAY0S,GAAU,CAC9Bp/C,KAAM,gBACNC,QAAS,qCAGrB,QACI,OACIgxB,EAAA,cAACs/B,GAAD,mDAMZ,OAAQjwD,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAK1D,EAAsByE,KAEvBtD,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMtX,gEAKrCpZ,KAAK0wB,MAAM4b,kBA1DE5Z,aAmGNkO,ICtFViZ,GDsFUjZ,eAjBf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,CACH6C,KAAMvyB,EAAMI,MAAM0qB,uBAInB,SAA4BmT,GAC/B,MAAO,CACH0B,OAAQ,SAACvnB,GACL6lB,EL7CL,SAAc7lB,GACjB,sBAAA5Z,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,IAAAC,EAAAC,EAAApxB,EAAAzE,EAAAwF,EAAAs8B,EAAA1rB,EAAAuwC,EAAAC,EAAA,OAAAp+C,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACH2sB,EA5BG,CACH/9B,KAAM7B,EAAWwsB,+BA0BdsT,EAMCD,IANDE,EAAAD,EAICvxB,KAAQG,cAAiBC,EAJ1BoxB,EAI0BpxB,MAAOzE,EAJjC61B,EAIiC71B,SACzBwF,EALRowB,EAKCtwB,IAAOE,OAGLs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAV1CoB,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAemB+4B,EAAU/mB,OAAOlL,GAfpC,WAeOuG,EAfPvN,EAAA2B,MAgBSjL,OAASyiB,GAA0BxiB,OAhB5C,CAAAqJ,EAAAE,KAAA,gBAiBK2sB,EAAS77B,GAAU07C,GAAU,CACzBp/C,KAAM,gBACNC,QAAS,4CAnBlByS,EAAAG,OAAA,qBAwBMoN,EAAI6B,SAxBV,CAAApP,EAAAE,KAAA,gBAyBK2sB,EAAS77B,GAAU07C,GAAU,CACzBp/C,KAAM,WACNC,QAAS,aAAe4J,EAAW,oCA3B5C6I,EAAAG,OAAA,qBAgCO29C,EAAavwC,EAAIvW,QAAQ6R,KAAK,SAAC3R,GACjC,OAAOA,EAAOC,WAAaA,IAjChC,CAAA6I,EAAAE,KAAA,gBAoCK2sB,EAAS77B,GAAU07C,GAAU,CACzBp/C,KAAM,WACNC,QAAS,aAAe4J,EAAW,0CAtC5C6I,EAAAG,OAAA,kBA2CO49C,EAAkD,CACpD1wC,MAAO,CACH/b,MAAOwsD,EAAWzwC,MAClBpY,YAAa6oD,EAAWzwC,MACxB9b,UAAW1F,EAAU+E,IACrBJ,gBAAiB,CACb1B,KAAM/C,EAAoB0E,GAC1BC,YAAa,IAAIC,QAI7Bk8B,GA5EgBx4B,EA4EKkZ,EA5EgCiM,EA4E3BukC,EA3E3B,CACHjvD,KAAM7B,EAAW0sB,+BACjBtlB,aAAcA,EACdmlB,sBAAuBA,KAkBpBxZ,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,SAyDC1Q,QAAQU,MAAM,WAAdgQ,EAAA4B,IACAirB,EAAS77B,GAAU07C,GAAU,CACzBp/C,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,YA5DjB,yBAAAyS,EAAAI,OAtBJ,IAAqB/L,EAAqCmlB,GAsBtD1Z,EAAAlS,KAAA,aAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GK4CiBmuB,CAAaznB,KAE1BkzB,SAAU,WACNrN,ELrDD,CACH/9B,KAAM7B,EAAW4sB,8BKyDV2U,CAA8FH,qBCtFxGoZ,oFAWE,IAscQuW,GAtcf,SAAAx9B,GACI,SAAAw9B,EAAY1/B,GAAc,IAAAjxB,EAAA,OAAAK,OAAAC,EAAA,EAAAD,CAAAE,KAAAowD,IACtB3wD,EAAAK,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAswD,GAAAjwD,KAAAH,KAAM0wB,KAED1vB,MAAQ,CACT+4C,WAAYF,GAAWv2C,MAJL7D,EAD9B,OAAAK,OAAAe,EAAA,EAAAf,CAAAswD,EAAAx9B,GAAA9yB,OAAAmR,EAAA,EAAAnR,CAAAswD,EAAA,EAAAl/C,IAAA,oBAAAxN,MAAA,WAWQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWwW,YAX/C,CAAAn/C,IAAA,mBAAAxN,MAAA,WAeQ1D,KAAKwzB,SAAS,CAAEumB,WAAYF,GAAWyW,WAf/C,CAAAp/C,IAAA,oBAAAxN,MAAA,SAkBsB4H,GACdtL,KAAK0wB,MAAM6/B,kBAAkBjlD,KAnBrC,CAAA4F,IAAA,aAAAxN,MAAA,WAwBQ0/B,KAAMvjC,KAAK,CACP4f,MAAO,gCACPoR,MAAO,OACPwS,QACI1S,EAAA,yBACIA,EAAA,+GA7BpB,CAAAzf,IAAA,gBAAAxN,MAAA,WAoC6C,OAAjC1D,KAAK0wB,MAAM5D,kBAIf9sB,KAAK0wB,MAAM8/B,cAAcxwD,KAAK0wB,MAAMjqB,aAAazB,GAAIhF,KAAK0wB,MAAM5D,kBAAkBxhB,UAAUC,aAHxF7J,QAAQC,KAAK,wDArCzB,CAAAuP,IAAA,iBAAAxN,MAAA,WA4CQ,QAAI1D,KAAK0wB,MAAM5D,oBA5CvB,CAAA5b,IAAA,kBAAAxN,MAAA,WAoDQ,GAAK1D,KAAK0wB,MAAMjqB,aAGhB,OACIkqB,EAAA,cAAC4xB,GAAD,CAAoBnpC,eAAgBpZ,KAAK0wB,MAAMjqB,aAAazB,OAxDxE,CAAAkM,IAAA,gBAAAxN,MAAA,SA4DkBpD,GAEV,OAAIA,EAAK4M,OAAS,GACP5M,EAGPqwB,EAAA,0BACKrwB,EAAK+e,MAAM,EAAG,IADnB,YAlEZ,CAAAnO,IAAA,eAAAxN,MAAA,WA0EQ,IACMuiC,EACFtV,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,0BACIA,EAAA,cAAC+S,GAAA,EAAD,CAASC,GAAE,qBAAAzwB,OAAuBlT,KAAK0wB,MAAMjqB,aAAazB,KACtD2rB,EAAA,sBAAMkB,MAAO,CAAEkR,WAAY,SACtB/iC,KAAKgtD,cAAchtD,KAAK0wB,MAAMjqB,aAAanG,QAIpDqwB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,QAAQ2wB,MAAO,CAAEqU,cAAe,SAAUC,WAAY,MAAOC,YAAa,SAErFzV,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,SACV,IACDyvB,EAAA,sBAAMkB,MAAO,CAAEO,SAAU,SAAzB,0BAINkU,EACF3V,EAAA,cAACA,EAAA,SAAD,KAMIA,EAAA,cAAC8X,GAAA,EAAD,CACIS,MAAM,SACNzV,KAAK,OACLW,QAASp0B,KAAK4uD,WAAWt6B,KAAKt0B,SAI1C,OACI2wB,EAAA,cAACyY,GAAD,CAAQnD,YAAaA,EAAaK,QAASA,MA3GvD,CAAAp1B,IAAA,kBAAAxN,MAAA,SA+GoB4H,GACZ,OACIqlB,EAAA,cAACA,EAAA,SAAD,KACIA,EAAA,qBAAKgD,UAAU,0BACVroB,EAAUmU,OAQfkR,EAAA,qBAAKgD,UAAU,+BACXhD,EAAA,sBAAMgD,UAAU,eAAhB,cACCgO,KAAKC,eAAe,QAAS,CAC1BC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAOz2B,EAAUsyB,iBAjIxC,CAAA1sB,IAAA,mBAAAxN,MAAA,WAuIuB,IAAAoN,EAAA9Q,KACf,OAAqC,IAAjCA,KAAK0wB,MAAMrlB,WAAW6B,OAElByjB,EAAA,qBAAKgD,UAAU,WAAf,kCAKD3zB,KAAK0wB,MAAMrlB,WAAWhC,IAAI,SAAC6jB,EAAckY,GAAU,IAalDqrB,EAZI5iD,EAAsBqf,EAAtBrf,OAAQvC,EAAc4hB,EAAd5hB,UAQZolD,EAAa,CAAC,kCAKlB,UAXI5/C,EAAK4f,MAAM5D,mBACXxhB,EAAUC,cAAgBuF,EAAK4f,MAAM5D,kBAAkBxhB,UAAUC,cAOjEmlD,EAAW55B,KAAK,6BAGZjpB,GACJ,KAAK7O,EAAemuB,WAChBujC,EAAW55B,KAAK,mCAChB25B,EACI9/B,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,+DACXkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,QAAQ2wB,MAAO,CAAEJ,MAAO,YAG3C,MACJ,KAAKzyB,EAAeouB,UAChBsjC,EAAW55B,KAAK,mCAChB25B,EACI9/B,EAAA,cAACqD,GAAA,EAAD,CAASvU,MAAM,gFACXkR,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,UAAU2wB,MAAO,CAAEJ,MAAO,aAG7C,MACJ,QACIi/B,EAAW55B,KAAK,sCAGxB,OACInG,EAAA,qBACIgD,UAAW+8B,EAAWv9C,KAAK,KAC3BihB,QAAS,WAAQtjB,EAAKy/C,kBAAkBpwD,KAAK2Q,EAAMoc,IACnDhc,IAAK2E,OAAOuvB,IACZzU,EAAA,qBAAKgD,UAAU,kCACV88B,GAEL9/B,EAAA,qBAAKgD,UAAU,8BACV7iB,EAAKkrC,gBAAgB9uB,EAAa5hB,iBA3L3D,CAAA4F,IAAA,iBAAAxN,MAAA,WAmMQhC,QAAQivD,IAAI,kBAnMpB,CAAAz/C,IAAA,mBAAAxN,MAAA,WAwMQ,OAAI1D,KAAK0wB,MAAM9jB,UACH+jB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,YAEfyvB,EAAA,cAAC8C,GAAA,EAAD,CAAMvyB,KAAK,aA3M3B,CAAAgQ,IAAA,kBAAAxN,MAAA,WA+MQ,OACIitB,EAAA,sBAAM3rB,GAAG,aACL2uB,UAAU,6BACV0U,SAAUroC,KAAK4wD,eAAet8B,KAAKt0B,OACnC2wB,EAAA,uBACI2X,YAAY,yBAEZE,WAAS,IAOb7X,EAAA,cAAC8X,GAAA,EAAD,CAGI9U,UAAU,0BACViV,KAAK,aACL13B,IAAI,SACJ23B,SAAS,UACR7oC,KAAK8oC,uBApO1B,CAAA53B,IAAA,oBAAAxN,MAAA,WAgPQ,OACIitB,EAAA,mCAEK,IAEGgR,KAAKkvB,aAAa,QAAS,CACvBh/B,MAAO,UACPi/B,aAAa,IACd/uB,OAAO/hC,KAAK0wB,MAAMrlB,WAAW6B,QAEnC,IATL,gBAjPZ,CAAAgE,IAAA,iBAAAxN,MAAA,SAgQmBA,GACX,OAAQA,GACJ,IAAK,QACD1D,KAAK0wB,MAAMqgC,SAAS5wB,GAAoBrC,OACxC,MACJ,IAAK,UACD99B,KAAK0wB,MAAMqgC,SAAS5wB,GAAoBpC,eAtQxD,CAAA7sB,IAAA,wBAAAxN,MAAA,eAAAwN,IAAA,iBAAAxN,MAAA,eAAAwN,IAAA,sBAAAxN,MAAA,WAoRQ,OACIitB,EAAA,qBAAKgD,UAAU,kCACXhD,EAAA,sBAAMgD,UAAU,eAAhB,WACAhD,EAAA,cAAC0Y,GAAA,EAAD,CAAQd,SAAUvoC,KAAKspC,eAAehV,KAAKt0B,MACvCupC,aAAcvpC,KAAK0wB,MAAMsX,OACzBnW,MAAO,CAAEhB,MAAO,OAChB2Y,0BAA0B,GAC1B7Y,EAAA,cAAC0Y,GAAA,EAAOI,OAAR,CAAe/lC,MAAM,QAAQwN,IAAI,SAAjC,SACAyf,EAAA,cAAC0Y,GAAA,EAAOI,OAAR,CAAe/lC,MAAM,UAAUwN,IAAI,WAAnC,kBA5RpB,CAAAA,IAAA,0BAAAxN,MAAA,WAmTQ,OACIitB,EAAA,qBAAKgD,UAAU,6DACXhD,EAAA,qBAAKkB,MAAO,CAAE6T,QAAS,OAAQC,cAAe,QAI1ChV,EAAA,qBAAKkB,MAAO,CAAEye,KAAM,YACftwC,KAAKgxD,wBAGdrgC,EAAA,qBAAKgD,UAAU,gCACV3zB,KAAKixD,qBAEVtgC,EAAA,qBAAKgD,UAAU,sDACXhD,EAAA,qBAAKgD,UAAU,oCACV3zB,KAAK6kD,wBAlU9B,CAAA3zC,IAAA,gCAAAxN,MAAA,WAsVQ,IAAIwtD,EAZJ,GAAKlxD,KAAK0wB,MAAM5D,kBAGhB,OAAI9sB,KAAK0wB,MAAM5D,kBAAkBjf,SAAW7O,EAAemuB,WAEnDwD,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,OAAOvB,QAAQ,wDAExBK,KAAK0wB,MAAM5D,kBAAkBjf,SAAW7O,EAAeouB,UAE1DuD,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,UAAUvB,QAAQ,2EAMlCuxD,EAFAlxD,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoC9hB,OACjEzJ,KAAK0wB,MAAMjmB,SAASvJ,OAASqqB,GAAoCvL,MACnD,yCAEA,4DAGd2Q,EAAA,cAAC8X,GAAA,EAAD,CACIvnC,KAAK,UACLkzB,QAASp0B,KAAKwwD,cAAcl8B,KAAKt0B,MACjC0oC,UAAW1oC,KAAKmxD,eAAehxD,KAAKH,OACtCkxD,MAlWd,CAAAhgD,IAAA,0BAAAxN,MAAA,WAwWQ,OAAI1D,KAAK0wB,MAAM5D,kBAEP6D,EAAA,qBAAKgD,UAAU,sCACXhD,EAAA,qBAAKgD,UAAU,0BACV3zB,KAAK0wB,MAAM5D,kBAAkBxhB,UAAUmU,OAE5CkR,EAAA,yBACIA,EAAA,sBAAMgD,UAAU,eAAhB,cACC,IACAgO,KAAKC,eAAe,QAAS,CAC1BC,MAAO,OACPC,IAAK,UACLE,KAAM,YACPD,OAAO/hC,KAAK0wB,MAAM5D,kBAAkBxhB,UAAUsyB,eAMzDjN,EAAA,cAAC2U,GAAA,EAAD,CAAOpkC,KAAK,OAAOvB,QAAQ,iGA3X3C,CAAAuR,IAAA,oBAAAxN,MAAA,WAiYQ,OACIitB,EAAA,qBAAKgD,UAAU,aACXhD,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAAC8X,GAAA,EAAD,CAAQhV,KAAK,WACTvyB,KAAK,SACLkzB,QAASp0B,KAAKoxD,iBAAiB98B,KAAKt0B,OAFxC,gBAMJ2wB,EAAA,qBAAKgD,UAAU,oBACXhD,EAAA,cAAC8X,GAAA,EAAD,CACIS,MAAM,SACNzV,KAAK,OACLW,QAASp0B,KAAK4uD,WAAWt6B,KAAKt0B,YA9YtD,CAAAkR,IAAA,SAAAxN,MAAA,WAsZQ,OAAQ1D,KAAKgB,MAAM+4C,YACf,KAAKF,GAAWwW,QACZ,OAAO1/B,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAG,mBAC7B,KAAKkW,GAAWyW,OACZ,OAAO3/B,EAAA,cAAC2hB,GAAA,EAAD,CAAUxb,MAAI,EAAC6M,GAAI,qBAAuB3jC,KAAK0wB,MAAMjqB,aAAazB,KAC7E,KAAK60C,GAAWv2C,MAapB,OACIqtB,EAAA,qBAAKgD,UAAU,2CACXhD,EAAA,cAACga,GAAD,CAAUrE,QAAStmC,KAAK4qC,sBAEvB5qC,KAAK6mD,kBACNl2B,EAAA,qBAAKgD,UAAU,gDACXhD,EAAA,qBAAKgD,UAAU,8DACXhD,EAAA,8CACC3wB,KAAKqxD,2BAEV1gC,EAAA,qBAAKgD,UAAU,yCACXhD,EAAA,8CACC3wB,KAAKsxD,0BACN3gC,EAAA,qBAAKgD,UAAU,+CACV3zB,KAAKuxD,mCAIlB5gC,EAAA,qBAAKgD,UAAU,iCA1b/By8B,EAAA,CAAyC19B,aCgGlC,SAAS8+B,GAAgBlmD,GAC5B,OAAO,SAAC2zB,EAAmDC,GACvDD,EArBG,CACH/9B,KAAM7B,EAAWoyD,+CAmBqE,IAAA9lB,EAK9DzM,IAL8D0M,EAAAD,EAIlF/9B,KAAQG,cAJ0E69B,EAIzD59B,MAJyD49B,EAIlDriC,SAJkDoiC,EAKlF98B,IAAOE,OAKXkwB,EAzBD,SAAgC3zB,GACnC,MAAO,CACHpK,KAAM7B,EAAWiuB,+CACjBhiB,UAAWA,GAsBFiiB,CAAuBjiB,KC7EzBs1B,mBAtCf,SAAyB5/B,EAAyB0vB,GAC9C,GAAmD,OAA/C1vB,EAAMI,MAAMurB,qBAAqBrrB,UACjC,MAAM,IAAIf,MAAM,8BAFuD,IAAAmxD,EAavE1wD,EAPAI,MACIurB,qBACIrrB,UAOZ,MAAO,CACHmF,aAhBuEirD,EAS3DjrD,aAOEgE,SAhByDinD,EAS7CjnD,SAOFY,WAhB+CqmD,EASnCrmD,WAOAyhB,kBAhBmC4kC,EASvB5kC,kBAQhDlgB,WAAW,EACXo7B,OAAQ,QAERj+B,OAAQ,KAIhB,SAA4Bk1B,GACxB,MAAO,CACHuxB,cAAe,SAACn7C,EAAiB9J,GAC7B0zB,EDoIL,SAAqB5pB,EAAiB9J,GACzC,sBAAAqL,EAAA9W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAA2B,EAAOqrB,EAAmDC,GAA1D,IAAAY,EAAAC,EAAA/xB,EAAAzE,EAAAwF,EAAAs8B,EAAAsmB,EAAA,OAAA5/C,GAAAC,EAAAG,KAAA,SAAA2B,GAAA,cAAAA,EAAAzB,KAAAyB,EAAAxB,MAAA,cACH2sB,EArBG,CACH/9B,KAAM7B,EAAW2tB,mCAmBd8S,EAKqBZ,IALrBa,EAAAD,EAIClyB,KAAQG,cAAiBC,EAJ1B+xB,EAI0B/xB,MAAOzE,EAJjCw2B,EAIiCx2B,SACzBwF,EALR+wB,EAKCjxB,IAAOE,OAELs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAT1C8C,EAAAzB,KAAA,EAAAyB,EAAAxB,KAAA,EAauB+4B,EAAUumB,6BAA6Bv8C,EAAS9J,GAbvE,OAaOkE,EAbPqE,EAAAC,KAcCkrB,GA7BuBxvB,EA6BKA,EA5B7B,CACHvO,KAAM7B,EAAW4tB,mCACjBxd,QAASA,KAYNqE,EAAAxB,KAAA,iBAAAwB,EAAAzB,KAAA,GAAAyB,EAAAE,GAAAF,EAAA,SAgBCmrB,GAxBqB78B,EAwBK,CACtB1C,KAAMoU,EAAAE,GAAG1T,KACTX,QAASmU,EAAAE,GAAGrU,SAzBjB,CACHuB,KAAM7B,EAAWwyD,iCACjBzvD,MAAOA,KAKJ,yBAAA0R,EAAAtB,OARJ,IAA0BpQ,EAPEqN,GAexBmE,EAAA5T,KAAA,aAAP,gBAAAsU,EAAAc,GAAA,OAAAwB,EAAAnE,MAAAzS,KAAA0S,YAAA,GCrIiBmuB,CAAoBxrB,EAAS9J,KAE1CglD,kBAAmB,SAACjlD,GAChB2zB,EAAS4B,GAAwBv1B,KAErCylD,SAAU,SAAC/oB,GDyLZ,IAAcxkB,ECxLTyb,GDwLSzb,ECxLawkB,EDyL9B,eAAAnxB,EAAA/W,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAmC,EAAO6qB,EAAmDC,GAA1D,IAAAl+B,EAAAM,EAAAwrC,EAAA9+B,EAAAzE,EAAAwF,EAAAixB,EAAA3a,EAAA,OAAAtT,GAAAC,EAAAG,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,UACH2sB,EAAS,CACL/9B,KAAM7B,EAAWyyD,mCAGf9wD,EAAQk+B,IAII,QAFZ59B,EAAYN,EAAMI,MAAMurB,qBAAqBrrB,WAPhD,CAAA+S,EAAA/B,KAAA,eAUC2sB,EAAS,CACL/9B,KAAM7B,EAAW0yD,iCACjB3vD,MAAO08C,GAAU,CACbp/C,KAAM,QACNC,QAAS,wBAdlB0U,EAAA9B,OAAA,iBAAAu6B,EAuBC9rC,EAFA4M,KAAQG,cAAiBC,EArB1B8+B,EAqB0B9+B,MAAOzE,EArBjCujC,EAqBiCvjC,SACzBwF,EACP/N,EADA6N,IAAOE,OAGLixB,EAAkB,IAAIG,GAA8B,CACtDnyB,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,IACzCgsB,iBAAkBjuB,EAAO0wB,SAASa,cAActvB,IAChDwtB,oBAAqBzvB,EAAO0wB,SAASW,UAAUpvB,MAGnD,IACUqU,EAAS2a,EAAgBgyB,2BAA2B1wD,EAAU+J,WAAYmY,GAChFyb,EAAS,CACL/9B,KAAM7B,EAAWouB,mCACjBpiB,WAAYga,IAElB,MAAOukC,GACL3qB,EAAS,CACL/9B,KAAM7B,EAAW0yD,iCACjB3vD,MAAO08C,GAAU,CACbp/C,KAAM,QACNC,QAASiqD,EAAGjqD,YA3CrB,wBAAA0U,EAAA7B,SAAA4B,EAAApU,SAAP,gBAAAuW,EAAAC,GAAA,OAAAK,EAAApE,MAAAzS,KAAA0S,YAAA,QCpLWkuB,CAAoGsS,ICvD7GzS,eACF,SAAAA,EAAY/P,GAAe,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAygC,GAAA3gC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA2gC,GAAAtgC,KAAAH,KACjB0wB,iFAIN,OACIC,EAAA,2FAMIvuB,GACR,OACIuuB,EAAA,kCAEIA,EAAA,yBACKvuB,EAAMzC,2CAOnB,OAAQK,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAKgI,EAA4BjH,KAEjC,KAAKiH,EAA4B/H,QAC7B,OAAOxC,KAAKmsC,gBAChB,KAAK5hC,EAA4BtE,MAC7B,OAAIjG,KAAK0wB,MAAM6C,KAAKnxB,MACTpC,KAAKosC,YAAYpsC,KAAK0wB,MAAM6C,KAAKnxB,OAEjCpC,KAAKosC,YAAY,CACpB1sC,KAAM,gBACNC,QAAS,oCAGrB,QACI,OACIgxB,EAAA,cAACshC,GAAD,mDAMZ,OAAQjyD,KAAK0wB,MAAM6C,KAAKhxB,cACpB,KAAKgI,EAA4BjH,KAC7BtD,KAAK0wB,MAAMiQ,OAAO3gC,KAAK0wB,MAAMtX,gEAKrCpZ,KAAK0wB,MAAM4b,kBAtDE5Z,aAgGNkO,mBAjBf,SAAyB5/B,EAAyB0vB,GAC9C,MAAO,CACH6C,KAAMvyB,EAAMI,MAAMurB,uBAInB,SAA4BsS,GAC/B,MAAO,CACH0B,OAAQ,SAACvnB,GACL6lB,EFlDL,SAAc7lB,GACjB,sBAAA5Z,EAAAM,OAAAgS,GAAA,EAAAhS,CAAAiS,GAAAC,EAAAC,KAAO,SAAAC,EAAO+sB,EAAmDC,GAA1D,IAAAC,EAAAC,EAAApxB,EAAAzE,EAAAwF,EAAAs8B,EAAArL,EAAApD,EAAAlmB,EAAAC,EAAAgJ,EAAAuyC,EAAAC,EAAAl2C,EAAAo4B,EAAA,OAAAtiC,GAAAC,EAAAG,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACH2sB,EArBG,CACH/9B,KAAM7B,EAAWutB,mCAmBduS,EAKqBD,IALrBE,EAAAD,EAICvxB,KAAQG,cAAiBC,EAJ1BoxB,EAI0BpxB,MAAOzE,EAJjC61B,EAIiC71B,SACzBwF,EALRowB,EAKCtwB,IAAOE,OAELs8B,EAAY,IAAI9f,GAA2B,CAC7Cvd,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAEvCgvB,EAAkB,IAAIG,GAA8B,CACtDnyB,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,IACzCgsB,iBAAkBjuB,EAAO0wB,SAASa,cAActvB,IAChDwtB,oBAAqBzvB,EAAO0wB,SAASW,UAAUpvB,MAE7C4rB,EAAgB,IAAIjX,GAA2B,CACjD3X,QAAOzE,WACPiR,iBAAkBzL,EAAO0wB,SAASY,OAAOrvB,MAnB1CoB,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAuBsDM,QAAQC,IAAI,CAC7Dw4B,EAAU+mB,gBAAgBh5C,GAC1B4mB,EAAgBqyB,iBAAiBj5C,GACjCwjB,EAAc0W,qBAAqBl6B,GACnCwjB,EAAc2W,wBAAwBn6B,KA3B3C,OAAA1C,EAAAtE,EAAA2B,KAAA4C,EAAA7W,OAAAwY,GAAA,EAAAxY,CAAA4W,EAAA,GAuBQiJ,EAvBRhJ,EAAA,GAuBatL,EAvBbsL,EAAA,GAuByBlH,EAvBzBkH,EAAA,GAuBkCsF,EAvBlCtF,EAAA,GA8BOlM,EAAW8gB,GAA2B5L,EAAKpW,EAAUkG,EAASwM,GACpEgjB,GA9CgBx4B,EA8CKkZ,EA9CgCtU,EA8C3BA,EA9CoFZ,EA8CxEA,EA7CvC,CACHvJ,KAAM7B,EAAWwtB,mCACjBpmB,eAAc4E,aAAYZ,cAYvB2H,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAA4B,GAAA5B,EAAA,SAiCC1Q,QAAQU,MAAM,gBAAdgQ,EAAA4B,IACAirB,GA1Cc78B,EA0CK,CACf1C,KAAM0S,EAAA4B,GAAG1T,KACTX,QAASyS,EAAA4B,GAAGrU,SA3CjB,CACHuB,KAAM7B,EAAW0tB,iCACjB3qB,MAAOA,KAKJ,yBAAAgQ,EAAAI,OARJ,IAAmBpQ,EAPEqE,EAAqC4E,EAAyDZ,GAe/GyH,EAAAlS,KAAA,aAAP,gBAAAiU,EAAAC,GAAA,OAAA1U,EAAAiT,MAAAzS,KAAA0S,YAAA,GEiDiBmuB,CAAaznB,KAE1BkzB,SAAU,WACNrN,EFqHD,CACH/9B,KAAM7B,EAAWmuB,kCEjHVoT,CAAoGH,IC/FtG6xB,GAAb,oBAAAA,IAAAxyD,OAAAC,EAAA,EAAAD,CAAAE,KAAAsyD,GAAA,OAAAxyD,OAAAmR,EAAA,EAAAnR,CAAAwyD,EAAA,OAAAphD,IAAA,mBAAAxN,MAAA,WAEQ,MAAO,CACHkqB,SAAU,CACNlD,MAAO,CACHmD,KAAM,IAAIxd,IACVwC,IAAK,IAETyP,KAAM,CACFuL,KAAM,IAAIxd,IACVwC,IAAK,IAET5J,SAAU,CACN4kB,KAAM,IAAIxd,IACVwC,IAAK,IAETxH,WAAY,CACRwiB,KAAM,IAAIxd,MAGlB4e,GAAI,CACAF,cAAe,CACXlc,IAAK,GACLgb,KAAM,IAAIxd,MAMlBjP,MAAO,CACHyuB,eAAgB,CACZttB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEf+sB,wBAAyB,CACrB9rB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEfD,WAAY,CACRkB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEfiF,YAAa,CACThE,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAQf6N,+BAAgC,CAC5B5M,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEfsO,gBAAiB,CACbrN,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEfipB,eAAgB,CACZhoB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEfwqB,qBAAsB,CAClBvpB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEfqrB,qBAAsB,CAClBpqB,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,MAEfuH,YAAa,CACTtG,aAAc1D,EAAsByE,KACpClB,MAAO,KACPd,UAAW,OAKnBsM,KAAM,CACFC,OAAQpP,EAAU6E,KAClB3D,QAAS,GACToO,cAAe,CACXC,MAAO,GACPzE,SAAU,GACV0E,SAAU,GACVC,MAAO,KAGf9L,MAAO,KAEPyM,IAAK,CACDhB,OAAQlP,EAAS2E,KACjByL,OAAQ,CACJ+8C,QAAS,GACTrsB,SAAU,CACNY,OAAQ,CACJrvB,IAAK,IAET0uB,YAAa,CACT1uB,IAAK,IAETovB,UAAW,CACPpvB,IAAK,IAETsvB,cAAe,CACXtvB,IAAK,IAETy0C,MAAO,CACHz0C,IAAK,IAET+1C,KAAM,CACF/1C,IAAK,KAGb06C,YAAa,KAIrBnF,UAAW,CACPgM,SAAS,QAlIzBD,EAAA,GCJqBE,eACjB,SAAAA,EAAY9hC,GAAe,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAwyD,GAAA1yD,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAA0yD,GAAAryD,KAAAH,KACjB0wB,sFAIN1wB,KAAK0wB,MAAMiQ,wDAIX3gC,KAAK0wB,MAAM4b,4CAIX,OAAOtsC,KAAK0wB,MAAM62B,gBAdgB70B,aC0B3BkO,mBAjBf,SAAyB5/B,EAAmB0vB,GACxC,MAAO,IAKX,SAA4BuO,GACxB,MAAO,CACH0B,OAAQ,WACJ1B,EAAS4B,OAEbyL,SAAU,WACNrN,ErE+BD,CACH/9B,KAAM7B,EAAWozD,yBqE3BV7xB,CAA8FsS,IC/BvGnN,GAAUrT,gBAAuC,MAE1CggC,GAAqB3sB,GAAQ4sB,SACR5sB,GAAQ6sB,SCQ1CC,KAAQC,IAAIC,KAAWC,KAAUC,KAASC,UAiBpCC,eACJ,SAAAA,EAAYhpB,GAA0B,OAAArqC,OAAAC,EAAA,EAAAD,CAAAE,KAAAmzD,GAAArzD,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAqzD,GAAAhzD,KAAAH,KAC9BmqC,sEAEHjW,EAAczU,EAAe/L,GAChC,GAAI1T,KAAKmqC,QAAQipB,SAAU,CACzB,IAAIC,EAEJ,IACEA,EAAO/H,mBAAmBtrD,KAAKmqC,QAAQmpB,SAAUp/B,IAC9Cq/B,QAAQ,UAAW,IACnBC,cAEL,MAAOntB,GACL,OAAO3yB,EAGT,GAEkC,IAAhC2/C,EAAK1yD,QAAQ,gBACoB,IAA9B0yD,EAAK1yD,QAAQ,cACa,IAA1B0yD,EAAK1yD,QAAQ,SAEhB,OAAO+S,EAIX,IAAI+/C,EAAM,YAAcv/B,EAAO,IAQ/B,OANIzU,IACFg0C,GAAO,WAAah0C,EAAQ,KAG9Bg0C,GAAO,oBAAsB//C,EAAO,cAjCNggD,cAuCpB,IAAIC,kBACVC,SAAW,IAAIT,GACvBzhB,UAAOmiB,WAAW,CAAED,SAAU,IAAIT,KAQlC,IAAM1L,KAASpvB,OAAO8yB,aAIhB2I,GAAexB,GAAeyB,mBAK9BC,GAAQC,YAAYC,GAAmBJ,GAAqBK,YAAQC,YAAgBC,OAyC3EC,eAtCb,SAAAA,EAAY5jC,GAAa,OAAA5wB,OAAAC,EAAA,EAAAD,CAAAE,KAAAs0D,GAAAx0D,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAw0D,GAAAn0D,KAAAH,KACjB0wB,0EAIN,OACE6jC,EAAAviD,EAAAwiD,cAAC9B,GAAD,CAAoBhvD,MAAO,CAAEkf,KAAM,OACjC2xC,EAAAviD,EAAAwiD,cAACC,EAAA,EAAD,CAAUT,MAAOA,IACfO,EAAAviD,EAAAwiD,cAACE,GAAD,KACEH,EAAAviD,EAAAwiD,cAACG,GAAD,CAAMlN,OAAQA,IACZ8M,EAAAviD,EAAAwiD,cAACI,GAAD,KACEL,EAAAviD,EAAAwiD,cAACK,EAAA,EAAD,CAAeC,SAAS,KACtBP,EAAAviD,EAAAwiD,cAAA,OAAK7gC,UAAU,8BACb4gC,EAAAviD,EAAAwiD,cAAA,OAAK7gC,UAAU,mCAEb4gC,EAAAviD,EAAAwiD,cAACO,EAAA,EAAD,KACER,EAAAviD,EAAAwiD,cAACQ,EAAA,EAAD,CAAOhiD,KAAK,iBAAiBiiD,UAAWjuB,KACxCutB,EAAAviD,EAAAwiD,cAACQ,EAAA,EAAD,CAAOhiD,KAAK,mBAAmBiiD,UAAWhmB,KAE1CslB,EAAAviD,EAAAwiD,cAACQ,EAAA,EAAD,CAAOhiD,KAAK,wBAAwBiiD,UAAW,SAAAz1D,GAAA,IAAsBwF,EAAtBxF,EAAGggB,MAASlK,OAAUtQ,GAAtB,OAA0EuvD,EAAAviD,EAAAwiD,cAACU,GAAD,CAAkB97C,eAAgBpU,OAC3JuvD,EAAAviD,EAAAwiD,cAACQ,EAAA,EAAD,CAAOhiD,KAAK,wBAAwBiiD,UAAW,SAAAv+C,GAAA,IAAsB1R,EAAtB0R,EAAG8I,MAASlK,OAAUtQ,GAAtB,OAA0EuvD,EAAAviD,EAAAwiD,cAACW,GAAD,CAAkB/7C,eAAgBpU,OAC3JuvD,EAAAviD,EAAAwiD,cAACQ,EAAA,EAAD,CAAOhiD,KAAK,kBAAkBiiD,UAAW,SAAAt+C,GAAA,IAAsB3R,EAAtB2R,EAAG6I,MAASlK,OAAUtQ,GAAtB,OAA2EuvD,EAAAviD,EAAAwiD,cAACY,GAAD,CAAYh8C,eAAgBpU,OAChJuvD,EAAAviD,EAAAwiD,cAACQ,EAAA,EAAD,CAAOhiD,KAAK,kBAAkBiiD,UAAW,SAAAr+C,GAAA,IAAsB5R,EAAtB4R,EAAG4I,MAASlK,OAAUtQ,GAAtB,OAA2EuvD,EAAAviD,EAAAwiD,cAACa,GAAD,CAAkBj8C,eAAgBpU,OACtJuvD,EAAAviD,EAAAwiD,cAACQ,EAAA,EAAD,CAAOhiD,KAAK,2BAA2BiiD,UAAW,SAAAp+C,GAAA,IAAsB7R,EAAtB6R,EAAG2I,MAASlK,OAAUtQ,GAAtB,OAA2EuvD,EAAAviD,EAAAwiD,cAACc,GAAD,CAAqBl8C,eAAgBpU,OAClKuvD,EAAAviD,EAAAwiD,cAACe,EAAA,EAAD,CAAUxe,KAAK,IAAIpT,GAAG,iBAAiB6xB,OAAO,oBAzBpDtiB,kCCpFlBuiB,IAAShvB,OAAO8tB,EAAAviD,EAAAwiD,cAACkB,GAAD,MAAStmB,SAASumB,eAAe","file":"static/js/main.e11d9420.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/nouserpic.9af42ba9.png\";","import * as userProfile from \"../data/apis/userProfile\"\nimport * as groups from \"../data/apis/groups\"\nimport * as orgModel from '../data/models/organization/model'\nimport * as userModel from \"../data/models/user\"\nimport * as requestModel from '../data/models/requests'\nimport * as narrativeModel from '../data/models/narrative'\nimport * as uberModel from '../data/models/uber'\nimport * as feedsModel from '../data/models/feeds'\nimport { AnError } from \"../combo/error/api\";\n\n/* Types from the organization service (approximately) */\n\n/*\n    Organization\n*/\n\n\nexport enum ComponentView {\n    COMPACT = 0,\n    NORMAL\n}\n\nexport enum UIErrorType {\n    NONE = 0,\n    INFO,\n    WARNING,\n    ERROR\n}\n\nexport interface UIError {\n    type: UIErrorType\n    message?: string\n}\n\nexport enum SyncState {\n    NONE = 0,\n    NEW,\n    DIRTY,\n    CLEAN\n}\n\nexport enum EditState {\n    NONE = 'NONE',\n    UNEDITED = 'UNEDITED',\n    EDITED = 'EDITED'\n}\n\n\n// export enum ValidationState {\n//     NONE = 0,\n//     VALID,\n//     INVALID,\n//     // DIRTY = 'DIRTY',\n//     MISSING\n// }\n\nexport enum ValidationErrorType {\n    OK = 0,\n    ERROR,\n    REQUIRED_MISSING\n}\n\nexport interface ValidationStateBase {\n    type: ValidationErrorType\n    validatedAt: Date\n}\n\nexport interface ValidationStateOk extends ValidationStateBase {\n    type: ValidationErrorType.OK\n}\n\nexport interface ValidationStateError extends ValidationStateBase {\n    type: ValidationErrorType.ERROR\n    message: string\n}\n\nexport interface ValidationStateRequiredMissing extends ValidationStateBase {\n    type: ValidationErrorType.REQUIRED_MISSING\n    message: string\n}\n\n// export interface ValidationStateAsyncError extends ValidationStateBase {\n//     type: ValidationErrorType.ASYNC_ERROR\n//     message: string\n//     \n// }\n\nexport type ValidationState = ValidationStateOk | ValidationStateError | ValidationStateRequiredMissing\n\nexport interface Editable {\n    value: any\n    remoteValue: any\n    syncState: SyncState\n    // editState: EditState\n    // validationState: ValidationState\n    validationState: ValidationState\n    // validatedAt: Date | null\n    // error: UIError\n}\nexport interface EditableString extends Editable {\n    value: string,\n    remoteValue: string | null\n}\n\nexport interface EditableNullableString extends Editable {\n    value: string | null\n    remoteValue: string | null\n}\n\nexport interface EditableBoolean extends Editable {\n    value: boolean\n    remoteValue: boolean | null\n}\n\nexport interface EditableOrganization {\n    id: EditableString\n    name: EditableString\n    description: EditableString\n    isPrivate: EditableBoolean\n    logoUrl: EditableNullableString\n    homeUrl: EditableNullableString\n    researchInterests: EditableString\n}\n\n\n// TODO: or CLEAN to replace new and saved\nexport enum SaveState {\n    NONE = 'NONE',\n    NEW = 'NEW',\n    READY = 'READY',\n    SAVING = 'SAVING',\n    SAVED = 'SAVED',\n    SAVE_ERROR = 'SAVE_ERROR'\n}\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\nexport enum MemberType {\n    MEMBER = 0,\n    ADMIN,\n    OWNER\n}\nexport interface Member {\n    user: User,\n    type: MemberType\n}\n\n\n\n// export interface User extends UserBase {\n\n// }\n\n// export interface Owner extends UserBase {\n\n// }\n\n// export interface Member extends UserBase {\n\n// }\n\n// export interface Admin extends UserBase {\n\n// }\n\n// export enum UserRelationToOrganization {\n//     NONE = 0,\n//     VIEW,\n//     MEMBER_REQUEST_PENDING,\n//     MEMBER_INVITATION_PENDING,\n//     MEMBER,\n//     ADMIN,\n//     OWNER\n// }\n\n// export interface UserOrgRelation {\n//     type: UserRelationToOrganization\n// }\n\n// export interface NoRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.NONE\n// }\n\n// export interface ViewRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.VIEW\n// }\n\n// export interface MembershipRequestPendingRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n//     requestId: string\n// }\n\n// export interface MembershipInvitationPendingRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n//     requestId: string\n// }\n\n// export interface MemberRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.MEMBER\n// }\n\n// export interface AdminRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.ADMIN\n// }\n\n// export interface OwnerRelation extends UserOrgRelation {\n//     type: UserRelationToOrganization.OWNER\n// }\n\n\n\nexport enum RequestType {\n    REQUEST = 0,\n    INVITATION\n}\n\nexport enum RequestResourceType {\n    USER = 0,\n    WORKSPACE,\n    APP\n}\n\nexport enum RequestStatus {\n    OPEN = 0,\n    CANCELED,\n    EXPIRED,\n    ACCEPTED,\n    DENIED\n}\n\nexport type Username = string\n\n\n// export type Request = UserRequest | UserInvitation | WorkspaceRequest | WorkspaceInvitation | AppRequest | AppInvitation\n\nexport interface App {\n    id: string,\n    module: string,\n    func: string,\n    version: string,\n    title: string,\n    category: string\n}\n\nexport interface AppResource {\n    id: string\n}\n\n// REVIVE in a different form? Or not? This is the old Organization\n// export interface Organization {\n//     id: string\n//     name: string\n//     gravatarHash: string | null\n//     description: string\n//     owner: Member\n//     relation: UserOrgRelation\n//     createdAt: Date\n//     modifiedAt: Date,\n//     members: Array<Member>,\n//     // admins: Array<Admin>,\n//     adminRequests: Array<requestModel.Request>,\n//     narratives: Array<NarrativeResource>,\n//     apps: Array<AppResource>\n// }\n\nexport interface EditedOrganization {\n    id: {\n        value: string,\n        error?: UIError\n    }\n    name: {\n        value: string,\n        error?: UIError\n    }\n    description: {\n        value: string,\n        error?: UIError\n    }\n}\n\n/*\n    Collection of organizations\n*/\n\n/* REDUX */\n\nexport enum AuthState {\n    NONE = 0,\n    CHECKING,\n    AUTHORIZED,\n    UNAUTHORIZED,\n    ERROR\n}\n\nexport interface UserAuthorization {\n    token: string,\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\n\nexport interface Authorization {\n    status: AuthState,\n    message: string,\n    authorization: UserAuthorization\n}\n\nexport enum ViewOrgState {\n    NONE = 0,\n    INITIAL,\n    FETCHING,\n    READY,\n    ERROR\n}\n\nexport enum AppState {\n    NONE = 0,\n    LOADING,\n    READY,\n    ERROR\n}\n\nexport enum SortDirection {\n    ASCENDING = 'asc',\n    DESCENDING = 'desc'\n}\n\nexport enum ComponentLoadingState {\n    NONE = 0,\n    LOADING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface ManageOrganizationRequestsViewModel {\n    organization: orgModel.Organization\n    requests: Array<requestModel.Request>\n    invitations: Array<requestModel.Request>\n}\n\nexport interface ManageOrganizationRequestsView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: ManageOrganizationRequestsViewModel | null\n}\n\nexport interface ViewMembersViewModel {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\nexport interface ViewMembersView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: ViewMembersViewModel | null\n}\n\nexport enum BrowseOrgsState {\n    NONE = 0,\n    SEARCHING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface BrowseOrgsViewModel {\n    rawOrganizations: Array<orgModel.BriefOrganization>\n    organizations: Array<orgModel.BriefOrganization>\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n    totalCount: number\n    filteredCount: number\n    sortField: string\n    sortDirection: SortDirection\n    filter: orgModel.Filter\n    searchTerms: Array<string>\n    selectedOrganizationId: string | null,\n    // TODO: let's make a new interface for running operations...\n    searching: boolean\n    error: AppError | null\n}\n\nexport interface BrowseOrgsView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: BrowseOrgsViewModel | null\n}\n\nexport enum InviteUserViewState {\n    NONE = 0,\n    EDITING,\n    SENDABLE,\n    SENDING,\n    SUCCESS,\n    ERROR\n}\n\n// user info we get out of user profile search\n\n\n// a user who may or may not be in an org, with org relation info\n// todo: fetch more profile info.\nexport interface OrganizationUser {\n    username: string\n    realname: string\n    relation: orgModel.UserRelationToOrganization\n}\n\nexport interface InviteUserViewModel {\n    organization: orgModel.Organization\n    users: Array<OrganizationUser> | null\n    selectedUser: {\n        user: User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: InviteUserViewState\n}\n\nexport interface InviteUserView {\n    loadingState: ComponentLoadingState\n    viewModel: InviteUserViewModel | null\n    error: AppError | null\n    // viewState: AppError | InviteUserValue | null\n}\n\nexport interface ManageMembershipViewModel {\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n}\n\nexport interface ManageMembershipView {\n    loadingState: ComponentLoadingState\n    error: AnError | null\n    viewModel: ManageMembershipViewModel | null\n}\n\nexport enum NarrativeState {\n    NONE = 0,\n    ASSOCIATED,\n    REQUESTED\n}\n\nexport interface Narrative {\n    workspaceId: number\n    objectId: number\n    title: string\n    status: NarrativeState\n    // inOrganization: boolean,\n    // createdAt: Date,\n    owner: Username\n    modifiedAt: Date\n}\n\n// export enum UserWorkspacePermission {\n//     NONE = 0,\n//     READ,\n//     WRITE,\n//     ADMIN,\n//     OWN\n// }\n\n\nexport enum ProcessingState {\n    NONE = 0,\n    PROCESSING,\n    SUCCESS,\n    ERROR\n}\n\n\nexport enum RequestNarrativeState {\n    NONE = 0,\n    LOADING,\n    ERROR,\n    LOADED,\n    SENDING,\n    SENT\n}\n\n\nexport interface RequestNarrativeViewModel {\n    organization: orgModel.Organization\n    narratives: Array<narrativeModel.OrganizationNarrative>\n    selectedNarrative: narrativeModel.OrganizationNarrative | null\n    relation: orgModel.Relation\n    error: AppError | null\n    saveState: SaveState\n}\n\nexport interface RequestNarrativeView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: RequestNarrativeViewModel | null\n}\n\nexport interface AddOrgViewModel {\n    editState: EditState\n    saveState: SaveState\n    error: AppError | null\n    validationState: ValidationState\n    newOrganization: EditableOrganization\n}\n\nexport interface AddOrgView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: AddOrgViewModel | null\n}\n\nexport interface Notification {\n\n}\n\nexport interface UserEntity {\n    userId: string\n    profile: userProfile.UserProfile\n}\n\nexport interface OrganizationEntity {\n    groupId: string\n    group: groups.Group\n}\n\nexport interface RequestEntity {\n    requestId: string\n    request: groups.Request\n}\n\nexport interface OrganizationCentricView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: OrganizationCentricViewModel | null\n}\nexport interface OrganizationCentricViewModel {\n    organization: orgModel.Organization\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    relation: orgModel.Relation\n}\n\nexport enum ViewOrgViewModelKind {\n    NORMAL = 0,\n    PRIVATE_INACCESSIBLE\n}\n\nexport interface ViewOrgViewModel {\n    kind: ViewOrgViewModelKind.NORMAL,\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    openRequest: orgModel.RequestStatus\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n    requestOutbox: Array<requestModel.Request>\n    requestInbox: Array<requestModel.Request>\n}\n\nexport interface ViewInaccessiblePrivateOrgViewModel {\n    kind: ViewOrgViewModelKind.PRIVATE_INACCESSIBLE,\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n}\n\nexport interface ViewOrgView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: ViewOrgViewModel | ViewInaccessiblePrivateOrgViewModel | null\n}\n\nexport interface EditOrgViewModel {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    editedOrganization: EditableOrganization\n    organization: orgModel.Organization\n    saveError: AppError | null\n}\n\nexport interface EditOrgView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: EditOrgViewModel | null\n}\n\nexport interface StoreState {\n    // new!!\n    entities: {\n        users: {\n            byId: Map<userModel.Username, userModel.User>\n            all: Array<string>\n        }\n        orgs: {\n            byId: Map<orgModel.OrganizationID, orgModel.Organization | orgModel.InaccessiblePrivateOrganization>\n            all: Array<string>\n        }\n        requests: {\n            byId: Map<requestModel.RequestID, requestModel.Request>\n            all: Array<string>\n        }\n        narratives: {\n            byId: Map<narrativeModel.WorkspaceID, narrativeModel.Narrative>\n        }\n        // notifications: {\n        //     byId: <Map<\n        // }\n    }\n\n    db: {\n        notifications: {\n            all: Array<feedsModel.OrganizationNotification>\n            byId: Map<feedsModel.NotificationID, feedsModel.OrganizationNotification>\n            // collections: {\n            //     byGroup: Map<orgModel.OrganizationID, Array<feedsModel.NotificationID>>\n            // }\n        }\n    }\n\n    auth: Authorization\n    error: AppError | null\n\n    app: {\n        status: AppState\n        config: AppConfig\n        error?: AppError\n    }\n\n    views: {\n        browseOrgsView: BrowseOrgsView\n        addOrgView: AddOrgView\n        viewOrgView: ViewOrgView\n        editOrgView: EditOrgView\n        manageOrganizationRequestsView: ManageOrganizationRequestsView\n        viewMembersView: ViewMembersView\n        inviteUserView: InviteUserView\n        manageMembershipView: ManageMembershipView\n        requestNarrativeView: RequestNarrativeView\n        organizationCentricView: OrganizationCentricView\n    }\n    updateOrg: {\n        pending: boolean\n    }\n}\n\nexport enum ErrorCode {\n    NONE = 0,\n    ERROR\n}\n\n/* COMPONENT PROPS */\n\nexport interface SomeError {\n    code: ErrorCode\n    message: string\n    detail: string\n    id: string\n    at: Date\n\n    errorHistory?: Array<AppError>\n    trace?: Array<string>\n    info?: any\n}\n\nexport interface AppError {\n    code: string\n    message: string\n    generatedAt?: Date\n    trace?: Array<string>\n    errors?: Array<AppError>\n    exception?: AppException\n}\n\nexport class AppException extends Error {\n    code: string\n    message: string\n    detail?: string\n    trace?: Array<string>\n    errors?: Array<AppException>\n    info?: Map<string, any>\n    constructor({ code, message, detail, info }: { code: string, message: string, detail?: string, info?: Map<string, any> }) {\n        super(message)\n        this.name = 'AppException'\n        this.code = code\n        this.message = message\n        this.detail = detail\n        this.info = info\n\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, AppException)\n        }\n\n        if (this.stack) {\n            if (this.stack.indexOf('\\n') >= 0) {\n                this.trace = this.stack.split('\\n')\n            } else {\n                this.trace = [this.stack]\n            }\n        }\n    }\n}\n\nexport interface AppConfig {\n    baseUrl: string\n    services: {\n        Groups: {\n            url: string\n        }\n        UserProfile: {\n            url: string\n        }\n        Workspace: {\n            url: string\n        }\n        ServiceWizard: {\n            url: string\n        }\n        Feeds: {\n            url: string\n        }\n        Auth: {\n            url: string\n        }\n    }\n    defaultPath: string\n}\n\nexport interface AuthProps {\n    authorization: Authorization,\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n    hosted: boolean,\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nexport interface IFrameParams {\n    channelId: string\n    frameId: string\n    params: {\n        groupsServiceURL: string\n        userProfileServiceURL: string\n        workspaceServiceURL: string\n        serviceWizardURL: string\n        feedsServiceURL: string\n        authServiceURL: string\n        originalPath: string | null,\n        view: string | null,\n        viewParams: any\n    },\n    parentHost: string\n}","export enum ActionFlag {\n    APP = 1,\n    APP_START,\n    APP_SUCCESS,\n    // APP_SUCCESS_IFRAME,\n    // APP_SUCCESS_SOLO,\n    APP_ERROR,\n\n    BROWSE_ORGS_LOAD,\n    BROWSE_ORGS_LOAD_START,\n    BROWSE_ORGS_LOAD_SUCCESS,\n    BROWSE_ORGS_LOAD_ERROR,\n    BROWSE_ORGS_UNLOAD,\n\n    BROWSE_ORGS_SORT,\n    BROWSE_ORGS_SORT_START,\n    BROWSE_ORGS_SORT_SUCCESS,\n    BROWSE_ORGS_SORT_ERROR,\n\n    BROWSE_ORGS_FILTER,\n    BROWSE_ORGS_FILTER_START,\n    BROWSE_ORGS_FILTER_SUCCESS,\n    BROWSE_ORGS_FILTER_ERROR,\n\n    BROWSE_ORGS_SEARCH,\n    BROWSE_ORGS_SEARCH_START,\n    BROWSE_ORGS_SEARCH_SUCCESS,\n    BROWSE_ORGS_SEARCH_ERROR,\n\n    UPDATE_ORG,\n    UPDATE_ORG_START,\n    UPDATE_ORG_SUCCESS,\n    UPDATE_ORG_ERROR,\n\n    // viewing org\n    VIEW_ORG_LOAD,\n    VIEW_ORG_LOAD_START,\n    VIEW_ORG_LOAD_SUCCESS,\n    VIEW_ORG_LOAD_ERROR,\n    VIEW_ORG_UNLOAD,\n\n    VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,\n    VIEW_ORG_LOAD_NORMAL_SUCCESS,\n\n    // Requests\n\n    VIEW_ORG_JOIN_REQUEST,\n    VIEW_ORG_JOIN_REQUEST_START,\n    VIEW_ORG_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_CANCEL_JOIN_REQUEST,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_START,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_ACCEPT_JOIN_INVITATION,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_START,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n\n    VIEW_ORG_ACCEPT_INBOX_REQUEST,\n    VIEW_ORG_ACCEPT_INBOX_REQUEST_START,\n    VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,\n    VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n\n    VIEW_ORG_REJECT_INBOX_REQUEST,\n    VIEW_ORG_REJECT_INBOX_REQUEST_START,\n    VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,\n    VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,\n\n    VIEW_ORG_REJECT_JOIN_INVITATION,\n    VIEW_ORG_REJECT_JOIN_INVITATION_START,\n    VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n\n    VIEW_ORG_REMOVE_NARRATIVE,\n    VIEW_ORG_REMOVE_NARRATIVE_START,\n    VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n\n    VIEW_ORG_ACCESS_NARRATIVE,\n    VIEW_ORG_ACCESS_NARRATIVE_START,\n    VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n\n    VIEW_PRIVATE_ORG_JOIN_REQUEST,\n    VIEW_PRIVATE_ORG_JOIN_REQUEST_START,\n    VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS,\n    VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR,\n\n    // MEMBERS\n\n    VIEW_ORG_VIEW_MEMBERS_LOAD,\n    VIEW_ORG_VIEW_MEMBERS_LOAD_START,\n    VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR,\n    VIEW_ORG_VIEW_MEMBERS_UNLOAD,\n\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER,\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START,\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START,\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START,\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n\n    // add org fields\n\n    ADD_ORG_LOAD,\n    ADD_ORG_LOAD_START,\n    ADD_ORG_LOAD_SUCCESS,\n    ADD_ORG_LOAD_ERROR,\n    ADD_ORG_UNLOAD,\n\n    ADD_ORG_UPDATE_NAME,\n    ADD_ORG_UPDATE_NAME_SUCCESS,\n    ADD_ORG_UPDATE_NAME_ERROR,\n\n    ADD_ORG_UPDATE_LOGO_URL,\n    ADD_ORG_UPDATE_LOGO_URL_SUCCESS,\n    ADD_ORG_UPDATE_LOGO_URL_ERROR,\n\n    ADD_ORG_UPDATE_ID,\n    ADD_ORG_UPDATE_ID_SUCCESS,\n    ADD_ORG_UPDATE_ID_ERROR,\n    ADD_ORG_UPDATE_ID_PASS,\n    ADD_ORG_EVALUATE_ID,\n\n    ADD_ORG_UPDATE_DESCRIPTION,\n    ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    ADD_ORG_UPDATE_IS_PRIVATE,\n    ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    ADD_ORG_UPDATE_IS_PRIVATE_ERROR,\n\n    ADD_ORG_UPDATE_HOME_URL,\n    ADD_ORG_UPDATE_HOME_URL_SUCCESS,\n    ADD_ORG_UPDATE_HOME_URL_ERROR,\n\n    ADD_ORG_UPDATE_RESEARCH_INTERESTS,\n    ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n    ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n\n    ADD_ORG_EVALUATE,\n    ADD_ORG_EVALUATE_OK,\n    ADD_ORG_EVALUATE_ERRORS,\n\n    ADD_ORG_SAVE,\n    ADD_ORG_SAVE_START,\n    ADD_ORG_SAVE_SUCCESS,\n    ADD_ORG_SAVE_ERROR,\n\n\n    // editing org\n    EDIT_ORG_LOAD,\n    EDIT_ORG_LOAD_START,\n    EDIT_ORG_LOAD_SUCCESS,\n    EDIT_ORG_LOAD_ERROR,\n    EDIT_ORG_UNLOAD,\n\n    EDIT_ORG_SAVE,\n    EDIT_ORG_SAVE_START,\n    EDIT_ORG_SAVE_SUCCESS,\n    EDIT_ORG_SAVE_ERROR,\n\n    // edit org, field level updates\n    EDIT_ORG_UPDATE_NAME,\n    EDIT_ORG_UPDATE_NAME_SUCCESS,\n    EDIT_ORG_UPDATE_NAME_ERROR,\n\n    EDIT_ORG_UPDATE_LOGO_URL,\n    EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,\n    EDIT_ORG_UPDATE_LOGO_URL_ERROR,\n\n    EDIT_ORG_UPDATE_DESCRIPTION,\n    EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    EDIT_ORG_UPDATE_IS_PRIVATE,\n    EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    EDIT_ORG_UPDATE_IS_PRIVATE_ERROR,\n\n    EDIT_ORG_UPDATE_HOME_URL,\n    EDIT_ORG_UPDATE_HOME_URL_SUCCESS,\n    EDIT_ORG_UPDATE_HOME_URL_ERROR,\n\n    EDIT_ORG_UPDATE_RESEARCH_INTERESTS,\n    EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n    EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n\n    EDIT_ORG_EVALUATE,\n    EDIT_ORG_EVALUATE_OK,\n    EDIT_ORG_EVALUATE_ERRORS,\n\n    // Auth\n    AUTH_CHECK,\n    AUTH_CHECK_START,\n    AUTH_CHECK_ERROR,\n    AUTH_AUTHORIZED,\n    AUTH_UNAUTHORIZED,\n    AUTH_REMOVE_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_LOAD,\n    ADMIN_MANAGE_REQUESTS_LOAD_START,\n    ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n    ADMIN_MANAGE_REQUESTS_UNLOAD,\n\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,\n\n    // MEMBERS\n    VIEW_MEMBERS_LOAD,\n    VIEW_MEMBERS_LOAD_START,\n    VIEW_MEMBERS_LOAD_SUCCESS,\n    VIEW_MEMBERS_LOAD_ERROR,\n    VIEW_MEMBERS_UNLOAD,\n\n    VIEW_MEMBERS_REMOVE_MEMBER,\n    VIEW_MEMBERS_REMOVE_MEMBER_START,\n    VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_START,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_START,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n\n    // INVITE USER\n    INVITE_USER_LOAD,\n    INVITE_USER_LOAD_START,\n    INVITE_USER_LOAD_SUCCESS,\n    INVITE_USER_LOAD_ERROR,\n    INVITE_USER_UNLOAD,\n\n    INVITE_USER_SEARCH_USERS,\n    INVITE_USER_SEARCH_USERS_START,\n    INVITE_USER_SEARCH_USERS_SUCCESS,\n    INVITE_USER_SEARCH_USERS_ERROR,\n\n    INVITE_USER_SELECT_USER,\n    INVITE_USER_SELECT_USER_START,\n    INVITE_USER_SELECT_USER_SUCCESS,\n    INVITE_USER_SELECT_USER_ERROR,\n\n    INVITE_USER_SEND_INVITATION,\n    INVITE_USER_SEND_INVITATION_START,\n    INVITE_USER_SEND_INVITATION_SUCCESS,\n    INVITE_USER_SEND_INVITATION_ERROR,\n\n    // Manage Membership\n    MANAGE_MEMBERSHIP_LOAD,\n    MANAGE_MEMBERSHIP_LOAD_START,\n    MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n    MANAGE_MEMBERSHIP_LOAD_ERROR,\n    MANAGE_MEMBERSHIP_UNLOAD,\n\n    MANAGE_MEMBERSHIP_LEAVE_ORG,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_START,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,\n\n    MANAGE_MEMBERSHIP_UPDATE_TITLE,\n    MANAGE_MEMBERSHIP_UPDATE_TITLE_START,\n    MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,\n    MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,\n\n    MANAGE_MEMBERSHIP_SAVE,\n    MANAGE_MEMBERSHIP_SAVE_START,\n    MANAGE_MEMBERSHIP_SAVE_SUCCESS,\n    MANAGE_MEMBERSHIP_SAVE_ERROR,\n\n    MANAGE_MEMBERSHIP_EVALUATE,\n    MANAGE_MEMBERSHIP_EVALUATE_SUCCESS,\n    MANAGE_MEMBERSHIP_EVALUATE_ERROR,\n\n    // Narrative add requests\n    REQUEST_ADD_NARRATIVE_LOAD,\n    REQUEST_ADD_NARRATIVE_LOAD_START,\n    REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n    REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n    REQUEST_ADD_NARRATIVE_UNLOAD,\n\n    REQUEST_ADD_NARRATIVE_SEND,\n    REQUEST_ADD_NARRATIVE_SEND_START,\n    REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SEND_ERROR,\n\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR,\n\n    REQUEST_ADD_NARRATIVE_SORT,\n    REQUEST_ADD_NARRATIVE_SORT_START,\n    REQUEST_ADD_NARRATIVE_SORT_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SORT_ERROR,\n\n    // VIEWS\n\n    ORGANIZATION_CENTRIC_VIEW_LOAD,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_START,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,\n    ORGANIZATION_CENTRIC_VIEW_UNLOAD,\n\n    // ENTITIES\n\n    ENTITY_USER_LOADER,\n    ENTITY_USER_LOADER_START,\n    ENTITY_USER_LOADER_SUCCESS,\n    ENTITY_USER_LOADER_ERROR,\n\n    ENTITY_ORGANIZATION_LOADER,\n    ENTITY_ORGANIZATION_LOADER_START,\n    ENTITY_ORGANIZATION_LOADER_SUCCESS,\n    ENTITY_ORGANIZATION_LOADER_ERROR,\n\n    ENTITY_NARRATIVE_LOAD,\n    ENTITY_NARRATIVE_LOAD_START,\n    ENTITY_NARRATIVE_LOAD_SUCCESS,\n    ENTITY_NARRATIVE_LOAD_ERROR,\n\n    // GLOBAL ACTIONS\n    GLOBAL_ACCESS_NARRATIVE,\n    GLOBAL_ACCESS_NARRATIVE_START,\n    GLOBAL_ACCESS_NARRATIVE_SUCCESS,\n    GLOBAL_ACCESS_NARRATIVE_ERROR,\n\n    // NOTIFICATIONS\n    NOTIFICATIONS_LOAD,\n    NOTIFICATIONS_LOAD_START,\n    NOTIFICATIONS_LOAD_SUCCESS,\n    NOTIFICATIONS_LOAD_ERROR,\n    NOTIFICATIONS_UNLOAD,\n\n    NOTIFICATIONS_READ,\n    NOTIFICATIONS_READ_START,\n    NOTIFICATIONS_READ_SUCCESS,\n    NOTIFICATIONS_READ_ERROR,\n\n    // USER PROFILE\n    DATA_SERVICE_LOAD,\n    DATA_SERVICE_LOAD_START,\n    DATA_SERVICE_LOAD_SUCCESS,\n    DATA_SERVICE_LOAD_ERROR,\n    DATA_SERVICE_UNLOAD,\n\n    DATA_SERVICE_LOAD_REFRESH,\n    DATA_SERVICE_LOAD_REFRESH_START,\n    DATA_SERVICE_LOAD_REFRESH_SUCCESS,\n    DATA_SERVICE_LOAD_REFRESH_ERROR\n}\n","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, UIErrorType, ValidationState, ComponentLoadingState, SyncState, ValidationErrorType } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    LoadStart, Unload,\n    SaveError, SaveStart, SaveSuccess, AddOrgEvaluateOK, AddOrgEvaluateErrors,\n    LoadSuccess, UpdateNameSuccess, UpdateNameError,\n    UpdateIdSuccess, UpdateIdError, UpdateDescriptionSuccess,\n    UpdateDescriptionError,\n    LoadError,\n    UpdateIdPass,\n    UpdateIsPrivateSuccess,\n    UpdateLogoUrlSuccess,\n    UpdateLogoUrlError,\n    UpdateHomeUrlSuccess,\n    UpdateHomeUrlError,\n    UpdateResearchInterestsSuccess,\n    UpdateResearchInterestsError\n} from '../actions/addOrg'\nimport Validation from '../../data/models/organization/validation';\n\n// ADD ORG\n\nexport function saveStart(state: StoreState, action: SaveStart): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveStart without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    saveState: SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function saveSuccess(state: StoreState, action: SaveSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED\n                }\n            }\n        }\n    }\n}\n\nexport function saveError(state: StoreState, action: SaveError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    saveState: SaveState.SAVE_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEvaluateOk(state: StoreState, action: AddOrgEvaluateOK): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEvaluateErrors(state: StoreState, action: AddOrgEvaluateErrors): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.ERROR,\n                        message: 'TODO: form error',\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function loadStart(state: StoreState, action: LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: EditState.UNEDITED,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    },\n                    saveState: SaveState.NEW,\n                    error: null,\n                    newOrganization: action.newOrganization\n                }\n            }\n        }\n    }\n}\nexport function loadError(state: StoreState, action: LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\n// Name\nexport function updateNameSuccess(state: StoreState, action: UpdateNameSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateNameSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        name: {\n                            ...state.views.addOrgView.viewModel.newOrganization.name,\n                            value: action.name,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            },\n                            // editState: EditState.EDITED,\n                            // validatedAt: new Date(),\n                            // error: {\n                            //     type: UIErrorType.NONE\n                            // }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateNameError(state: StoreState, action: UpdateNameError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateNameError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        name: {\n                            ...state.views.addOrgView.viewModel.newOrganization.name,\n                            value: action.name,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                            // editState: EditState.EDITED,\n                            // validatedAt: new Date(),\n                            // error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Logo URL\nexport function updateLogoUrlSuccess(state: StoreState, action: UpdateLogoUrlSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Logo URL without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        logoUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.logoUrl,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateLogoUrlError(state: StoreState, action: UpdateLogoUrlError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Logo URL error without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        logoUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.logoUrl,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Home URL\nexport function updateHomeUrlSuccess(state: StoreState, action: UpdateHomeUrlSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Home URL (success) without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        homeUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.homeUrl,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateHomeUrlError(state: StoreState, action: UpdateHomeUrlError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting update to home url without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        homeUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.homeUrl,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Research Interests\nexport function updateResearchInterestsSuccess(state: StoreState, action: UpdateResearchInterestsSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Research Interests without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        researchInterests: {\n                            ...state.views.addOrgView.viewModel.newOrganization.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            value: action.researchInterests,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateResearchInterestsError(state: StoreState, action: UpdateResearchInterestsError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting update to research interests (error) without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        researchInterests: {\n                            ...state.views.addOrgView.viewModel.newOrganization.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            value: action.researchInterests,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Id\n\nexport function updateIdSuccess(state: StoreState, action: UpdateIdSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            ...state.views.addOrgView.viewModel.newOrganization.id,\n                            // value: action.id,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIdError(state: StoreState, action: UpdateIdError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            ...state.views.addOrgView.viewModel.newOrganization.id,\n                            // value: action.id,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIdPass(state: StoreState, action: UpdateIdPass): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            ...state.views.addOrgView.viewModel.newOrganization.id,\n                            value: action.id,\n                            syncState: SyncState.DIRTY\n                            // validationState: {\n                            //     type: ValidationErrorType.OK,\n                            //     validatedAt: new Date()\n                            // }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionSuccess(state: StoreState, action: UpdateDescriptionSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateDescriptionSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        description: {\n                            ...state.views.addOrgView.viewModel.newOrganization.description,\n                            value: action.description,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionError(state: StoreState, action: UpdateDescriptionError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateDescriptionError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        description: {\n                            ...state.views.addOrgView.viewModel.newOrganization.description,\n                            value: action.description,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIsPrivateSuccess(state: StoreState, action: UpdateIsPrivateSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        isPrivate: {\n                            ...state.views.addOrgView.viewModel.newOrganization.isPrivate,\n                            value: action.isPrivate,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.ADD_ORG_SAVE:\n            return saveStart(state, action as SaveStart)\n        case ActionFlag.ADD_ORG_SAVE_SUCCESS:\n            return saveSuccess(state, action as SaveSuccess)\n        case ActionFlag.ADD_ORG_SAVE_ERROR:\n            return saveError(state, action as SaveError)\n\n        case ActionFlag.ADD_ORG_LOAD_START:\n            return loadStart(state, action as LoadStart)\n        case ActionFlag.ADD_ORG_LOAD_SUCCESS:\n            return loadSuccess(state, action as LoadSuccess)\n        case ActionFlag.ADD_ORG_LOAD_ERROR:\n            return loadError(state, action as LoadError)\n        case ActionFlag.ADD_ORG_UNLOAD:\n            return unload(state, action as Unload)\n\n        case ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS:\n            return updateNameSuccess(state, action as UpdateNameSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_NAME_ERROR:\n            return updateNameError(state, action as UpdateNameError)\n\n        case ActionFlag.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:\n            return updateLogoUrlSuccess(state, action as UpdateLogoUrlSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_LOGO_URL_ERROR:\n            return updateLogoUrlError(state, action as UpdateLogoUrlError)\n\n        case ActionFlag.ADD_ORG_UPDATE_HOME_URL_SUCCESS:\n            return updateHomeUrlSuccess(state, action as UpdateHomeUrlSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_HOME_URL_ERROR:\n            return updateHomeUrlError(state, action as UpdateHomeUrlError)\n\n        case ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:\n            return updateResearchInterestsSuccess(state, action as UpdateResearchInterestsSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:\n            return updateResearchInterestsError(state, action as UpdateResearchInterestsError)\n\n        case ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS:\n            return updateIdSuccess(state, action as UpdateIdSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_ID_ERROR:\n            return updateIdError(state, action as UpdateIdError)\n        case ActionFlag.ADD_ORG_UPDATE_ID_PASS:\n            return updateIdPass(state, action as UpdateIdPass)\n\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return updateDescriptionSuccess(state, action as UpdateDescriptionSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR:\n            return updateDescriptionError(state, action as UpdateDescriptionError)\n\n        case ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:\n            return updateIsPrivateSuccess(state, action as UpdateIsPrivateSuccess)\n\n        case ActionFlag.ADD_ORG_EVALUATE_OK:\n            return addOrgEvaluateOk(state, action as AddOrgEvaluateOK)\n        case ActionFlag.ADD_ORG_EVALUATE_ERRORS:\n            return addOrgEvaluateErrors(state, action as AddOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, ComponentLoadingState, ValidationErrorType, SyncState, ValidationState, ValidationStateOk, EditOrgViewModel } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    LoadStart, LoadSuccess, LoadError,\n    EditOrgEvaluateOK, EditOrgEvaluateErrors,\n    EditOrgSave, EditOrgSaveStart, EditOrgSaveError, EditOrgSaveSuccess,\n    EditOrgUpdateNameSuccess, EditOrgUpdateNameError,\n    // EditOrgUpdateIdSuccess, EditOrgUpdateIdError,\n    EditOrgUpdateDescriptionSuccess, EditOrgUpdateDescriptionError,\n    UpdateIsPrivateSuccess, EditOrgUpdateLogoUrlSuccess, EditOrgUpdateLogoUrlError, UpdateHomeUrlSuccess, UpdateHomeUrlError, UpdateResearchInterestsError, UpdateResearchInterestsSuccess, Unload\n} from '../actions/editOrg'\nimport { StateInstances } from '../state';\n\n\n\n// EDIT ORG\n\n// Edit session loading\n\nexport function loadStart(state: StoreState, action: LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n\n            }\n        }\n    }\n}\n\nfunction validationStateOk(): ValidationStateOk {\n    const x: ValidationState = {\n        type: ValidationErrorType.OK,\n        validatedAt: new Date()\n    }\n    return x\n}\n\nexport function loadSuccess(state: StoreState, action: LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: EditState.UNEDITED,\n                    validationState: validationStateOk(),\n                    // validationState: {\n                    //     type: ValidationErrorType.OK,\n                    //     validatedAt: new Date()\n                    // },\n                    saveState: SaveState.NEW,\n                    // TODO: get rid of this...\n                    // organizationId: action.id,\n                    organization: action.organization,\n                    saveError: null,\n                    editedOrganization: action.editedOrganization\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\n// save\n\nexport function editOrgSaveStart(state: StoreState, action: EditOrgSaveStart): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    saveState: SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgSaveSuccess(state: StoreState, action: EditOrgSaveSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED,\n                    editedOrganization: {\n                        id: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.id,\n                            syncState: SyncState.CLEAN\n                        },\n                        name: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.name,\n                            syncState: SyncState.CLEAN\n                        },\n                        logoUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.logoUrl,\n                            syncState: SyncState.CLEAN\n                        },\n                        homeUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.homeUrl,\n                            syncState: SyncState.CLEAN\n                        },\n                        researchInterests: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.researchInterests,\n                            syncState: SyncState.CLEAN\n                        },\n                        isPrivate: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.isPrivate,\n                            syncState: SyncState.CLEAN\n                        },\n                        description: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.description,\n                            syncState: SyncState.CLEAN\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgSaveError(state: StoreState, action: EditOrgSaveError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    saveState: SaveState.SAVE_ERROR,\n                    saveError: action.error\n                }\n            }\n        }\n    }\n}\n\n// Evaluate edit session\n\nexport function editOrgEvaluateOk(state: StoreState, action: EditOrgEvaluateOK): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgEvaluateErrors(state: StoreState, action: EditOrgEvaluateErrors): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Validation errors',\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction evaluateEditorState(viewModel: EditOrgViewModel): EditState {\n    if (viewModel.editedOrganization.name.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.id.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.logoUrl.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.homeUrl.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.researchInterests.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.isPrivate.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.description.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    return EditState.UNEDITED\n}\n\n\n\n// Name\nexport function editOrgUpdateNameSuccess(state: StoreState, action: EditOrgUpdateNameSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const editedOrg = state.views.editOrgView.viewModel.editedOrganization\n    let syncState\n    if (action.name !== editedOrg.name.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    // editState: editState,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        name: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.name,\n                            value: action.name,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateNameError(state: StoreState, action: EditOrgUpdateNameError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        name: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.name,\n                            value: action.name,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Logo url\nexport function editOrgUpdateLogoUrlSuccess(state: StoreState, action: EditOrgUpdateLogoUrlSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        logoUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.logoUrl,\n                            value: action.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateLogoUrlError(state: StoreState, action: EditOrgUpdateLogoUrlError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        logoUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.logoUrl,\n                            value: action.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Update Home Url\n\n// Logo url\nexport function editOrgUpdateHomeUrlSuccess(state: StoreState, action: UpdateHomeUrlSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        homeUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.homeUrl,\n                            value: action.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateHomeUrlError(state: StoreState, action: UpdateHomeUrlError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        homeUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.homeUrl,\n                            value: action.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Update Research Interests\n\n// Logo url\nexport function updateResearchInterestsSuccess(state: StoreState, action: UpdateResearchInterestsSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        researchInterests: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.researchInterests,\n                            value: action.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function updateResearchInterestsError(state: StoreState, action: UpdateResearchInterestsError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        researchInterests: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.researchInterests,\n                            value: action.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionSuccess(state: StoreState, action: EditOrgUpdateDescriptionSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const editedOrg = state.views.editOrgView.viewModel.editedOrganization\n    let syncState\n    if (action.description !== editedOrg.description.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        description: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.description,\n                            value: action.description,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateDescriptionError(state: StoreState, action: EditOrgUpdateDescriptionError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        description: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.description,\n                            value: action.description,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIsPrivateSuccess(state: StoreState, action: UpdateIsPrivateSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n\n    const editedOrg = state.views.editOrgView.viewModel.editedOrganization\n    let syncState\n    if (action.isPrivate !== editedOrg.isPrivate.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        isPrivate: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.isPrivate,\n                            value: action.isPrivate,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.EDIT_ORG_LOAD_START:\n            return loadStart(state, action as LoadStart)\n        case ActionFlag.EDIT_ORG_LOAD_SUCCESS:\n            return loadSuccess(state, action as LoadSuccess)\n        case ActionFlag.EDIT_ORG_LOAD_ERROR:\n            return loadError(state, action as LoadError)\n\n        case ActionFlag.EDIT_ORG_UNLOAD:\n            return unload(state, action as Unload)\n\n        case ActionFlag.EDIT_ORG_SAVE_START:\n            return editOrgSaveStart(state, action as EditOrgSaveStart)\n        case ActionFlag.EDIT_ORG_SAVE_SUCCESS:\n            return editOrgSaveSuccess(state, action as EditOrgSaveSuccess)\n        case ActionFlag.EDIT_ORG_SAVE_ERROR:\n            return editOrgSaveError(state, action as EditOrgSaveError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS:\n            return editOrgUpdateNameSuccess(state, action as EditOrgUpdateNameSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR:\n            return editOrgUpdateNameError(state, action as EditOrgUpdateNameError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:\n            return editOrgUpdateLogoUrlSuccess(state, action as EditOrgUpdateLogoUrlSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_ERROR:\n            return editOrgUpdateLogoUrlError(state, action as EditOrgUpdateLogoUrlError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:\n            return editOrgUpdateHomeUrlSuccess(state, action as UpdateHomeUrlSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_HOME_URL_ERROR:\n            return editOrgUpdateHomeUrlError(state, action as UpdateHomeUrlError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:\n            return updateResearchInterestsSuccess(state, action as UpdateResearchInterestsSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:\n            return updateResearchInterestsError(state, action as UpdateResearchInterestsError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:\n            return updateIsPrivateSuccess(state, action as UpdateIsPrivateSuccess)\n\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS:\n        //     return editOrgUpdateIdSuccess(state, action as EditOrgUpdateIdSuccess)\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_ERROR:\n        //     return editOrgUpdateIdError(state, action as EditOrgUpdateIdError)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return updateDescriptionSuccess(state, action as EditOrgUpdateDescriptionSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:\n            return editOrgUpdateDescriptionError(state, action as EditOrgUpdateDescriptionError)\n        case ActionFlag.EDIT_ORG_EVALUATE_OK:\n            return editOrgEvaluateOk(state, action as EditOrgEvaluateOK)\n        case ActionFlag.EDIT_ORG_EVALUATE_ERRORS:\n            return editOrgEvaluateErrors(state, action as EditOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/acceptInboxRequest'\nimport { StoreState, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n\nexport function acceptInboxRequestSuccess(state: StoreState, action: actions.AcceptRequestSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    requestInbox: action.requests\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:\n            return acceptInboxRequestSuccess(state, action as actions.AcceptRequestSuccess)\n        default:\n            return null\n    }\n}\n\n","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/viewMembers'\nimport { StoreState, ComponentLoadingState, MemberType, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n// export function loadStart(state: StoreState, action: actions.LoadStart) {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.LOADING,\n//                 viewModel: null,\n//                 error: null\n//             }\n//         }\n//     }\n// }\n\n// export function unload(state: StoreState, action: actions.Unload): StoreState {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.NONE,\n//                 viewModel: null,\n//                 error: null\n//             }\n//         }\n//     }\n// }\n\n// export function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.SUCCESS,\n//                 viewModel: {\n//                     organization: action.organization,\n//                     relation: action.relation\n//                 },\n//                 error: null\n//             }\n//         }\n//     }\n// }\n\n// export function loadError(state: StoreState, action: actions.LoadError): StoreState {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.ERROR,\n//                 viewModel: null,\n//                 error: action.error\n//             }\n//         }\n//     }\n// }\n\nexport function promoteToAdminSuccess(state: StoreState, action: actions.PromoteToAdminSuccess): StoreState {\n\n    const {\n        views: { viewOrgView: { viewModel } }\n    } = state\n\n    if (viewModel === null) {\n        return state\n    }\n\n    // TODO: ugh, cut this off before getting here.\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n\n        if (member.username === action.memberUsername) {\n            return {\n                ...member,\n                type: MemberType.ADMIN\n            }\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...viewModel,\n                    organization: {\n                        ...viewModel.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function demoteToMemberSuccess(state: StoreState, action: actions.DemoteToMemberSuccess): StoreState {\n    const {\n        views: { viewOrgView: { viewModel } }\n    } = state\n\n    if (viewModel === null) {\n        return state\n    }\n\n    // TODO: ugh, cut this off before getting here.\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            return {\n                ...member,\n                type: MemberType.MEMBER\n            }\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...viewModel,\n                    organization: {\n                        ...viewModel.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\n\nexport function removeMemberSuccess(state: StoreState, action: actions.RemoveMemberSuccess): StoreState {\n    const {\n        views: { viewOrgView: { viewModel } }\n    } = state\n\n    if (viewModel === null) {\n        return state\n    }\n\n    // TODO: ugh, cut this off before getting here.\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.filter((member) => {\n        return (member.username !== action.memberUsername)\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...viewModel,\n                    organization: {\n                        ...viewModel.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        // case ActionFlag.VIEW_MEMBERS_LOAD_START:\n        //     return loadStart(state, action as actions.LoadStart)\n        // case ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS:\n        //     return loadSuccess(state, action as actions.LoadSuccess)\n        // case ActionFlag.VIEW_MEMBERS_LOAD_ERROR:\n        //     return loadError(state, action as actions.LoadError)\n        // case ActionFlag.VIEW_MEMBERS_UNLOAD:\n        //     return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:\n            return promoteToAdminSuccess(state, action as actions.PromoteToAdminSuccess)\n        case ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:\n            return demoteToMemberSuccess(state, action as actions.DemoteToMemberSuccess)\n        case ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS:\n            return removeMemberSuccess(state, action as actions.RemoveMemberSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/denyInboxRequest'\nimport { StoreState, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n\nexport function rejectInboxRequestSuccess(state: StoreState, action: actions.RejectInboxRequestSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    requestInbox: action.requests\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS:\n            return rejectInboxRequestSuccess(state, action as actions.RejectInboxRequestSuccess)\n        default:\n            return null\n    }\n}\n\n","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/cancelOutboxRequest'\nimport { StoreState, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n\nexport function cancelRequestSuccess(state: StoreState, action: actions.CancelJoinRequestSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    requestOutbox: action.requests\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS:\n            return cancelRequestSuccess(state, action as actions.CancelJoinRequestSuccess)\n        default:\n            return null\n    }\n}\n\n","import { Action } from 'redux'\nimport * as actions from '../actions/viewOrg'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport acceptInboxRequest from './viewOrganization/acceptInboxRequest'\nimport viewMembers from './viewOrganization/viewMembers'\nimport denyInboxRequest from './viewOrganization/denyInboxRequest'\nimport cancelOutboxRequest from './viewOrganization/cancelOutboxRequests'\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadNormalSuccess(state: types.StoreState, action: actions.LoadNormalSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    kind: types.ViewOrgViewModelKind.NORMAL,\n                    organization: action.organization,\n                    relation: action.relation,\n                    openRequest: action.openRequest,\n                    groupRequests: action.groupRequests,\n                    groupInvitations: action.groupInvitations,\n                    requestInbox: action.requestInbox,\n                    requestOutbox: action.requestOutbox\n                } as types.ViewOrgViewModel\n            }\n        }\n    }\n}\n\nexport function loadInaccessiblePrivateSuccess(state: types.StoreState, action: actions.LoadInaccessiblePrivateSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    kind: types.ViewOrgViewModelKind.PRIVATE_INACCESSIBLE,\n                    organization: action.organization,\n                    relation: action.relation,\n                    requestOutbox: action.requestOutbox\n                } as types.ViewInaccessiblePrivateOrgViewModel\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function removeNarrativeSuccess(state: types.StoreState, action: actions.RemoveNarrativeSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    // Argh!@\n    if (state.views.viewOrgView.viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    const newNarratives = state.views.viewOrgView.viewModel.organization.narratives.filter((narrative) => {\n        return (narrative.workspaceId !== action.narrative.workspaceId)\n    })\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: {\n                        ...state.views.viewOrgView.viewModel.organization,\n                        narratives: newNarratives\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function accessNarrativeSuccess(state: types.StoreState, action: actions.AccessNarrativeSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: action.organization\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.VIEW_ORG_LOAD_NORMAL_SUCCESS:\n            return loadNormalSuccess(state, action as actions.LoadNormalSuccess)\n        case ActionFlag.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS:\n            return loadInaccessiblePrivateSuccess(state, action as actions.LoadInaccessiblePrivateSuccess)\n        case ActionFlag.VIEW_ORG_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.VIEW_ORG_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:\n            return removeNarrativeSuccess(state, action as actions.RemoveNarrativeSuccess)\n        case ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:\n            return accessNarrativeSuccess(state, action as actions.AccessNarrativeSuccess)\n    }\n\n    return acceptInboxRequest(state, action) ||\n        denyInboxRequest(state, action) ||\n        cancelOutboxRequest(state, action) ||\n        viewMembers(state, action)\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/browseOrgs'\nimport { StoreState, SortDirection, ComponentLoadingState, BrowseOrgsView } from '../../types'\nimport { ActionFlag } from '../actions'\nimport * as orgModel from '../../data/models/organization/model'\n\nexport function applyOrgSearch(orgs: Array<orgModel.Organization>, searchTerms: Array<string>) {\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTerms.every((term) => {\n            // todo : make more efficient!!!\n            return (new RegExp(term, 'i').test(org.name));\n        })\n    })\n\n    return {\n        organizations: filteredOrgs,\n        totalCount: orgs.length,\n        filteredCount: filteredOrgs.length\n    }\n}\n\n// TODO:\n// dispatch the start of the request\n// do the request\n// dispatch the success (will be same for all queries?)\n// dispatch the error\n// FOR NOW:\n// do it here...\nexport function searchOrgs(state: BrowseOrgsView, action: actions.SearchOrgs): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    // const { viewModel: { filter, sortBy, sortDirection } } = state\n\n    // const query: Query = {\n    //     searchTerms: action.searchTerms,\n    //     filter: filter,\n    //     sortBy: sortBy,\n    //     sortDirection: sortDirection,\n    //     username: state.auth.authorization.username\n    // }\n    // const result = queryOrgs(state.rawOrganizations, query)\n    // rawOrganizations: Array<Organization>\n    // organizations: Array<Organization>\n    // totalCount: number\n    // filteredCount: number\n    // sortBy: string\n    // sortDirection: SortDirection\n    // filter: string\n    // searchTerms: Array<string>\n    // selectedOrganizationId: string | null\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            selectedOrganizationId: null,\n            searchTerms: action.searchTerms,\n            searching: true\n        }\n    }\n}\n\nexport function searchOrgsStart(state: BrowseOrgsView, action: actions.SearchOrgsStart): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            searching: true\n        }\n    }\n}\n\nexport function searchOrgsSuccess(state: BrowseOrgsView, action: actions.SearchOrgsSuccess): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            organizations: action.organizations,\n            openRequests: action.openRequests,\n            totalCount: action.totalCount,\n            filteredCount: action.organizations.length,\n            searching: false\n        }\n    }\n}\n\n// TODO: hmm, uses the global error -- this was early in the development of this (a whole two weeks ago!)\n// and this should now go in the \"browseOrgs\" (or better named \"searchOrgs\") branch.\nexport function searchOrgsError(state: BrowseOrgsView, action: actions.SearchOrgsError): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            searching: false,\n            error: action.error\n        }\n    }\n}\n\n\nexport function sortOrgsStart(state: BrowseOrgsView, action: actions.SortOrgsStart): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            sortField: action.sortField,\n            sortDirection: action.sortDirection,\n            searching: true\n        }\n    }\n}\n\n\ninterface Query {\n    searchTerms: Array<string>,\n    username: string,\n    sortField: string,\n    sortDirection: SortDirection,\n    filter: string\n}\n\ninterface QueryResults {\n    organizations: Array<orgModel.Organization>,\n    total: number\n}\n\nfunction filterOrgsStart(state: BrowseOrgsView, action: actions.FilterOrgsStart): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    const { filter } = action\n\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            filter,\n            searching: true\n        }\n    }\n}\n\nfunction loadSuccess(state: BrowseOrgsView, action: actions.LoadSuccess): BrowseOrgsView {\n    const { defaultViewModel: {\n        rawOrganizations, organizations, openRequests, searchTerms, sortField, sortDirection, filter,\n        totalCount, filteredCount, selectedOrganizationId, error, searching\n    } } = action\n\n    return {\n        ...state,\n        loadingState: ComponentLoadingState.SUCCESS,\n        error: null,\n        viewModel: {\n            rawOrganizations, organizations, openRequests, searchTerms, sortField, sortDirection, filter,\n            totalCount, filteredCount, selectedOrganizationId, error, searching\n        }\n    }\n}\n\nfunction unload(state: BrowseOrgsView, action: actions.Unload): BrowseOrgsView {\n    return {\n        loadingState: ComponentLoadingState.NONE,\n        error: null,\n        viewModel: null\n    }\n}\n\nfunction localReducer(state: BrowseOrgsView, action: Action): BrowseOrgsView | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.BROWSE_ORGS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.BROWSE_ORGS_SEARCH:\n            return searchOrgs(state, action as actions.SearchOrgs)\n        case ActionFlag.BROWSE_ORGS_SEARCH_START:\n            return searchOrgsStart(state, action as actions.SearchOrgsStart)\n        case ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS:\n            return searchOrgsSuccess(state, action as actions.SearchOrgsSuccess)\n        case ActionFlag.BROWSE_ORGS_SEARCH_ERROR:\n            return searchOrgsError(state, action as actions.SearchOrgsError)\n        // case ActionFlag.SORT_ORGS_STAR:\n        //     return sortOrgs(state, action as actions.SortOrgs)\n        case ActionFlag.BROWSE_ORGS_SORT_START:\n            return sortOrgsStart(state, action as actions.SortOrgsStart)\n        case ActionFlag.BROWSE_ORGS_FILTER_START:\n            return filterOrgsStart(state, action as actions.FilterOrgsStart)\n        case ActionFlag.BROWSE_ORGS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action<any>): StoreState | null {\n    const browseOrgsView = localReducer(state.views.browseOrgsView, action)\n    if (!browseOrgsView) {\n        return null\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView\n        }\n    }\n}\n","import { Action } from 'redux'\n\nimport { ActionFlag } from '../actions'\nimport { StoreState, AuthState } from '../../types'\nimport { AuthCheckStart, AuthAuthorized, AuthUnauthorized, AuthCheckError } from '../actions/auth';\n\nexport function authCheckStart(state: StoreState, action: AuthCheckStart): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.CHECKING,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authCheckError(state: StoreState, action: AuthCheckError): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.ERROR,\n            message: action.error.message,\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authAuthorized(state: StoreState, action: AuthAuthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.AUTHORIZED,\n            message: '',\n            authorization: {\n                token: action.token,\n                username: action.username,\n                realname: action.realname,\n                roles: action.roles\n            }\n        }\n    }\n}\n\nexport function authUnauthorized(state: StoreState, action: AuthUnauthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.UNAUTHORIZED,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.AUTH_CHECK_START:\n            return authCheckStart(state, action as AuthCheckStart)\n        case ActionFlag.AUTH_AUTHORIZED:\n            return authAuthorized(state, action as AuthAuthorized)\n        case ActionFlag.AUTH_UNAUTHORIZED:\n            return authUnauthorized(state, action as AuthUnauthorized)\n        case ActionFlag.AUTH_CHECK_ERROR:\n            return authCheckError(state, action as AuthCheckError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { ActionFlag } from '../actions'\nimport { AppSuccess } from '../actions/app';\nimport { StoreState, AppState } from '../../types';\n\nexport function appSuccess(state: StoreState, action: AppSuccess): StoreState {\n    return {\n        ...state,\n        app: {\n            status: AppState.READY,\n            config: action.config\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.APP_SUCCESS:\n            return appSuccess(state, action as AppSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageOrganizationRequests'\nimport { StoreState, ComponentLoadingState } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(\n    state: StoreState,\n    action: actions.LoadStart): StoreState {\n    return state\n}\n\nexport function loadSuccess(\n    state: StoreState,\n    action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    requests: action.requests,\n                    invitations: action.invitations\n                },\n            }\n        }\n    }\n}\n\nexport function loadError(\n    state: StoreState,\n    action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function getViewAccessSuccess(state: StoreState, action: actions.GetViewAccessSuccess): StoreState {\n    // Note: we use the state object rather than peeling off the viewModel because\n    // TS can't trace the assertion (not falsy) of the variable back to the object \n    // property it was taken from.\n    if (!state.views.manageOrganizationRequestsView.viewModel) {\n        return state\n    }\n    const requests = state.views.manageOrganizationRequestsView.viewModel.requests\n    const newRequests = requests.map((request) => {\n        if (request.id = action.request.id) {\n            return action.request\n        }\n        return request\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                ...state.views.manageOrganizationRequestsView,\n                viewModel: {\n                    // TODO: below, \n                    ...state.views.manageOrganizationRequestsView.viewModel,\n                    requests: newRequests\n                }\n            }\n        }\n    }\n}\n\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:\n            return getViewAccessSuccess(state, action as actions.GetViewAccessSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/viewMembers'\nimport { StoreState, ComponentLoadingState, MemberType } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart) {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.LOADING,\n                viewModel: null,\n                error: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.NONE,\n                viewModel: null,\n                error: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.SUCCESS,\n                viewModel: {\n                    organization: action.organization,\n                    relation: action.relation\n                },\n                error: null\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.ERROR,\n                viewModel: null,\n                error: action.error\n            }\n        }\n    }\n}\n\nexport function promoteToAdminSuccess(state: StoreState, action: actions.PromoteToAdminSuccess): StoreState {\n    if (state.views.viewMembersView.viewModel === null) {\n        return state\n    }\n\n    const {\n        views: { viewMembersView: { viewModel } }\n    } = state\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            member.type = MemberType.ADMIN\n            return member\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                viewModel: {\n                    ...state.views.viewMembersView.viewModel,\n                    organization: {\n                        ...state.views.viewMembersView.viewModel!.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function demoteToMemberSuccess(state: StoreState, action: actions.DemoteToMemberSuccess): StoreState {\n    if (state.views.viewMembersView.viewModel === null) {\n        return state\n    }\n\n    const {\n        views: { viewMembersView: { viewModel } }\n    } = state\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            member.type = MemberType.MEMBER\n            return member\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                viewModel: {\n                    ...state.views.viewMembersView.viewModel,\n                    organization: {\n                        ...state.views.viewMembersView.viewModel!.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_MEMBERS_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.VIEW_MEMBERS_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.VIEW_MEMBERS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:\n            return promoteToAdminSuccess(state, action as actions.PromoteToAdminSuccess)\n        case ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:\n            return demoteToMemberSuccess(state, action as actions.DemoteToMemberSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { AppException } from \"../../types\";\nimport { string } from \"prop-types\";\n\nexport interface GroupsServiceInfo {\n    servname: string;\n    version: string;\n    servertime: number;\n    gitcommithash: string\n}\n\nexport type Username = string\nexport type GroupID = string\n\nexport interface Member {\n    name: Username,\n    joined: number,\n    lastvisit: number | null,\n    custom: {\n        title: string\n    }\n}\n\nexport interface WorkspaceInfo {\n    rid: string\n    name: string\n    narrname: string\n    narrcreate: number\n    public: boolean\n    perm: string\n    description: string\n    moddate: number\n}\n\nexport interface AppInfo {\n    rid: string\n}\n\nexport type Role = \"None\" | \"Member\" | \"Admin\" | \"Owner\"\n\nexport interface BriefGroup {\n    id: GroupID\n    name: string\n    createdate: number\n    moddate: number\n    lastvisit: number | null\n    private: boolean\n    role: Role\n\n    custom: {\n        logourl?: string\n        researchinterests?: string\n        homeurl?: string\n    }\n    owner: Username\n\n    memcount: number\n    rescount: {\n        workspace: number\n    }\n}\n\nexport interface InaccessiblePrivateGroup {\n    id: GroupID\n    private: boolean\n    role: Role\n}\n\nexport interface Group {\n    id: GroupID\n    private: boolean\n    privatemembers: boolean\n    name: string\n    role: Role\n    owner: Member\n    admins: Array<Member>\n    members: Array<Member>\n    memcount: number\n    createdate: number\n    moddate: number\n    lastvisit: number\n    resources: {\n        workspace: Array<WorkspaceInfo>,\n        catalogmethod: Array<AppInfo>\n    }\n    rescount: {\n        workspace: number\n        catalogmethod: number\n    }\n    custom: {\n        logourl?: string\n        description: string\n        researchinterests: string\n        homeurl?: string\n    }\n}\n\nexport interface NewGroup {\n    id: string\n    name: string\n    logoUrl: string | null\n    homeUrl: string | null\n    researchInterests: string\n    description: string\n    isPrivate: boolean\n}\n\nexport interface GroupUpdate {\n    name: string\n    logoUrl: string | null\n    homeUrl: string | null\n    researchInterests: string\n    description: string\n    private: boolean\n}\n\nexport interface Request {\n    id: string\n    groupid: string\n    requester: Username\n    type: string\n    status: string\n    resource: string\n    resourcetype: string\n    createdate: number\n    expiredate: number\n    moddate: number\n}\n\nexport interface RequestWithCompletion extends Request {\n    complete: false\n}\n\nexport interface Completion {\n    complete: true\n}\n\nexport interface ErrorInfo {\n    appcode: number\n    apperror: string\n    callid: string\n    httpcode: number\n    httpstatus: string\n    message: string\n    time: number\n}\n\nexport interface ErrorResult {\n    error: ErrorInfo\n}\n\n// Error types: (appcode)\n// 10000\tAuthentication failed\n// 10010\tNo authentication token\n// 10020\tInvalid token\n// 20000\tUnauthorized\n// 30000\tMissing input parameter\n// 30001\tIllegal input parameter\n// 30010\tIllegal user name\n// 40000\tGroup already exists\n// 40010\tRequest already exists\n// 40020\tUser already group member\n// 40030\tWorkspace already in group\n// 50000\tNo such group\n// 50010\tNo such request\n// 50020\tNo such user\n// 50030\tNo such workspace\n// 60000\tUnsupported operation\n\nexport interface GroupExists {\n    exists: boolean\n}\n\n// export interface GroupRequest {\n//     id: string,\n//     groupid: string,\n//     requester: Username,\n//     type: string,\n//     status: string,\n//     resource: string\n//     resourcetype: string\n//     createdate: number,\n//     expiredate: number,\n//     moddate: number\n// }\n\nexport enum SortDirection {\n    ASCENDING = 0,\n    DESCENDING\n}\n\nexport interface GetRequestsParams {\n    includeClosed?: boolean,\n    sortDirection?: SortDirection,\n    startAt?: Date\n}\n\nexport interface RequestMemebershipParams {\n    groupId: string\n}\n\nexport interface RequestNarrativeParams {\n    workspaceId: number\n    groupId: string\n}\n\nfunction promiseTry<T>(fun: () => Promise<T>): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        try {\n            return resolve(fun())\n        } catch (ex) {\n            reject(ex)\n        }\n    })\n}\n\nexport interface GroupError {\n    httpcode: number\n    httpstatus: string\n    appcode: number\n    apperror: string\n    message: string\n    callid: string\n    time: number\n}\n\nexport class Exception extends Error {\n\n}\n\nexport class GroupException extends AppException {\n    originalError: GroupError\n    constructor(error: GroupError) {\n        super({\n            code: 'group-exception',\n            message: error.apperror,\n            detail: error.message,\n            info: new Map<string, any>([\n                ['httpcode', error.httpcode],\n                ['httpstatus', error.httpstatus],\n                ['appcode', error.appcode],\n                ['apperror', error.apperror],\n                ['message', error.message],\n                ['callid', error.callid],\n                ['time', error.time]\n            ])\n        })\n        this.name = 'GroupException'\n        this.originalError = error\n    }\n}\n\nexport interface RequestStatus {\n    new: 'None' | 'New' | 'Old'\n}\n\nexport class ServerException extends AppException {\n    constructor(detail: string) {\n        super({ code: 'server-exception', message: 'Server Exception', detail: detail })\n        this.name = 'ServerException'\n    }\n}\n\nexport class GroupsClient {\n    token: string;\n    url: string;\n\n    constructor({ token, url }: { token: string, url: string }) {\n        this.token = token\n        this.url = url\n    }\n\n    getInfo(): Promise<GroupsServiceInfo> {\n        return fetch(this.url + '/', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json();\n            })\n            .then((result) => {\n                return result as GroupsServiceInfo;\n            });\n    }\n\n    groupExists(id: string): Promise<GroupExists> {\n        return fetch(this.url + '/group/' + id + '/exists')\n            .then((response) => {\n                return response.json()\n            })\n            .then((exists) => {\n                return exists as GroupExists\n            })\n    }\n\n    // getGroups(): Promise<GroupList> {\n    //     return fetch(this.url + '/group', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json()\n    //         })\n    //         .then((result: GroupList) => {\n    //             return result.filter(({ type }) => type === 'Organization')\n    //         })\n    // }\n\n    async listGroups(): Promise<Array<BriefGroup>> {\n        return fetch(this.url + '/group', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    console.error('error fetching groups', response)\n                    throw new Error('Error fetching groups')\n                }\n                return response.json()\n            })\n    }\n\n\n    getGroups(): Promise<Array<Group | InaccessiblePrivateGroup>> {\n        return fetch(this.url + '/group', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    console.error('error fetching groups', response)\n                    throw new Error('Error fetching groups')\n                }\n                return response.json()\n            })\n            .then((result: Array<BriefGroup>) => {\n                return Promise.all(result.map((group) => (this.getGroupById(group.id))))\n            })\n            .then((result) => {\n                return result;\n            })\n    }\n\n    getGroupById(id: string): Promise<Group | InaccessiblePrivateGroup> {\n        return fetch(this.url + '/group/' + id, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status === 404) {\n                    return null\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Group\n            })\n    }\n\n    put<T>(path: Array<string>, body: any): Promise<T> {\n        const url = ([this.url].concat(path)).join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n            body: JSON.stringify(body)\n        })\n            .then((response) => {\n                if (response.status === 500) {\n                    switch (response.headers.get('Content-Type')) {\n                        case 'application/json':\n                            return response.json()\n                                .then((result) => {\n                                    throw new GroupException(result)\n                                })\n                        case 'text/plain':\n                            return response.text()\n                                .then((result) => {\n                                    throw new ServerException(result)\n                                })\n                        default:\n                            throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n                    }\n                } else if (response.status === 200) {\n                    return response.json()\n                        .then((result) => {\n                            return result as T\n                        })\n                } else if (response.status === 204) {\n                    const result = null as unknown\n                    return result as T\n                } else {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n            })\n    }\n\n    async post<T>(path: Array<string>, body: any): Promise<T | null> {\n        const url = ([this.url].concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST',\n            body: body ? JSON.stringify(body) : ''\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new GroupException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else if (response.status === 204) {\n            return null\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    async get<T>(path: Array<string>): Promise<T> {\n        const url = ([this.url].concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new GroupException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    createGroup(newGroup: NewGroup): Promise<Group> {\n        // argh!! description should be mandatory, but now it is a custom \n        // field and it is not yet defined in the service.\n        // TODO: we need the groups service to have default custom fields.\n        // At that point, what IS the point of custom fields ... oh, I know that\n        // there are internal reasons for this due to re-using \"group\" for \n        // organization, project, etc., but that should not leak through the \n        // api.\n\n        // mandatory fields.\n        const payload: any = {\n            name: newGroup.name,\n            private: newGroup.isPrivate,\n            custom: {\n                logourl: newGroup.logoUrl,\n                researchinterests: newGroup.researchInterests,\n                homeurl: newGroup.homeUrl\n            }\n        }\n\n        // optional fields\n        if (newGroup.description.length > 0) {\n            payload.custom.description = newGroup.description\n        }\n\n        return this.put<Group>(['group', newGroup.id], payload)\n    }\n\n    updateGroup(id: string, groupUpdate: GroupUpdate): Promise<void> {\n        const payload: any = {\n            name: groupUpdate.name,\n            custom: {\n                logourl: groupUpdate.logoUrl,\n                homeurl: groupUpdate.homeUrl,\n                researchinterests: groupUpdate.researchInterests\n            },\n            private: groupUpdate.private\n        }\n        // TODO: remove this when we have descriptions restored to the\n        // groups service.\n        if (groupUpdate.description) {\n            payload.custom.description = groupUpdate.description\n        }\n        return fetch(this.url + '/group/' + id + '/update', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n\n            // TODO: build more intelligently\n            body: JSON.stringify(payload)\n        })\n            .then((response) => {\n                // response is an empty body.\n                if (response.status === 204) {\n                    return\n                }\n                throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n            })\n    }\n\n    async getRequest(requestId: string): Promise<Request> {\n        const path = ['request', 'id', requestId]\n        return await this.get<Request>(path)\n    }\n\n    getGroupRequests(groupId: string, params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n\n        return fetch(this.url + '/group/' + groupId + '/requests?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getTargetedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/targeted?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getCreatedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/created?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'appcliation/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    addOrRequestNarrative(params: RequestNarrativeParams): Promise<RequestWithCompletion | Completion> {\n        const url = [\n            this.url,\n            'group',\n            params.groupId,\n            'resource',\n            'workspace',\n            String(params.workspaceId)\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                if (result.complete === false) {\n                    return result as RequestWithCompletion\n                } else {\n                    return result as Completion\n                }\n\n            })\n    }\n\n    async grantResourceAccess(groupId: string, resourceType: string, resourceId: string): Promise<null> {\n        const path = [\n            'group',\n            groupId,\n            'resource',\n            resourceType,\n            resourceId,\n            'getperm'\n        ]\n        return this.post<null>(path, null)\n    }\n\n    deleteResource(groupId: string, resourceType: string, resourceId: string): Promise<void> {\n        const url = [\n            this.url,\n            'group',\n            groupId,\n            'resource',\n            resourceType,\n            resourceId\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n            })\n    }\n\n    cancelRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/cancel', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    acceptRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/accept', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    grantReadAccessToRequestedResource({ requestId }: { requestId: string }): Promise<null> {\n        const path = ['request', 'id', requestId, 'getperm']\n        return this.post<null>(path, null)\n    }\n\n\n    denyRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/deny', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    memberToAdmin({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    adminToMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    updateMember({ groupId, memberUsername, update }: { groupId: string, memberUsername: string, update: any }): Promise<void> {\n        const path = [\n            'group', groupId, 'user', memberUsername, 'update'\n        ]\n\n        return this.put<void>(path, { custom: update })\n    }\n\n    removeMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n            })\n    }\n\n    requestMembership(params: RequestMemebershipParams): Promise<Request> {\n        return fetch(this.url + '/group/' + params.groupId + '/requestmembership', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json',\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    inviteUserToGroup({ groupId, username }: { groupId: string, username: string }): Promise<Request> {\n        const url = [\n            this.url, 'group', groupId, 'user', username\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    async visitGroup({ groupId }: { groupId: string }): Promise<void> {\n        const path = ['group', groupId, 'visit']\n        return this.put<void>(path, null)\n    }\n\n    async getOpenRequests({ groupIds }: { groupIds: Array<string> }): Promise<Map<GroupID, RequestStatus>> {\n        const path = ['request', 'groups', groupIds.join(','), 'new']\n        const result = await this.get<any>(path)\n        const requestStatuses = new Map<GroupID, RequestStatus>()\n        for (const [groupId, requestStatus] of Object.entries(result)) {\n            requestStatuses.set(groupId, <RequestStatus>requestStatus)\n        }\n        return requestStatuses\n    }\n}","import * as groupsApi from '../apis/groups'\nimport * as orgModel from './organization/model'\n\nexport type Username = string\n\nexport type RequestID = string\n\nexport enum RequestType {\n    REQUEST = 0,\n    INVITATION\n}\n\nexport enum RequestResourceType {\n    USER = 0,\n    WORKSPACE,\n    APP\n}\n\nexport enum RequestStatus {\n    OPEN = 0,\n    CANCELED,\n    EXPIRED,\n    ACCEPTED,\n    DENIED\n}\n\nexport interface BaseRequest {\n    id: string\n    organizationId: string\n    requester: Username\n    type: RequestType\n    status: RequestStatus\n    resourceType: RequestResourceType\n    createdAt: Date\n    expireAt: Date\n    modifiedAt: Date\n}\n\nexport interface UserRequest extends BaseRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.REQUEST\n    user: Username\n}\n\nexport interface UserInvitation extends BaseRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.INVITATION\n    user: Username\n}\n\nexport interface WorkspaceRequest extends BaseRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.REQUEST\n    narrativeId: string,\n}\n\nexport interface WorkspaceInvitation extends BaseRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.INVITATION\n    narrativeId: string\n}\n\nexport interface AppRequest extends BaseRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.REQUEST\n    appId: string\n}\n\nexport interface AppInvitation extends BaseRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.INVITATION\n    appId: string\n}\n\nexport type Request = UserRequest | UserInvitation | WorkspaceRequest | WorkspaceInvitation | AppRequest | AppInvitation\n\n\nfunction stringToRequestType(type: string): RequestType {\n    switch (type) {\n        case 'Invite':\n            return RequestType.INVITATION\n        case 'Request':\n            return RequestType.REQUEST\n        default:\n            throw new Error('unknown request type: ' + type)\n    }\n}\n\nfunction stringToResourceType(type: string) {\n    switch (type) {\n        case 'user':\n            return RequestResourceType.USER\n        case 'workspace':\n            return RequestResourceType.WORKSPACE\n        case 'catalogmethod':\n            return RequestResourceType.APP\n        default:\n            throw new Error('unknown resource type: ' + type)\n    }\n}\n\nfunction stringToRequestStatus(status: string): RequestStatus {\n    return RequestStatus.OPEN\n}\n\nexport function groupRequestToOrgRequest(request: groupsApi.Request): Request {\n\n    const requestType = stringToRequestType(request.type)\n    const resourceType = stringToResourceType(request.resourcetype)\n    const requestStatus = stringToRequestStatus(request.status)\n\n    switch (resourceType) {\n        case RequestResourceType.USER:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    user: request.resource as Username,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as UserRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    user: request.resource as Username,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as UserInvitation\n            }\n\n        case RequestResourceType.WORKSPACE:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    narrativeId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as WorkspaceRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    narrativeId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as WorkspaceInvitation\n            }\n\n        case RequestResourceType.APP:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    appId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as AppRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    appId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as AppInvitation\n            }\n        default:\n            throw new Error('resource type not handled yet: ' + request.resourcetype)\n    }\n}\n\ninterface RequestsModelParams {\n    groupsServiceURL: string\n    token: string\n    username: Username\n}\n\nexport class RequestsModel {\n\n    params: RequestsModelParams\n    groupsClient: groupsApi.GroupsClient\n    cache: Map<RequestID, Request>\n\n    constructor(params: RequestsModelParams) {\n        this.params = params\n        this.groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        this.cache = new Map()\n    }\n\n    async getRequest(requestId: RequestID): Promise<Request> {\n        if (this.cache.has(requestId)) {\n            return this.cache.get(requestId)!\n        }\n\n        const grequest = await this.groupsClient.getRequest(requestId)\n        const request = groupRequestToOrgRequest(grequest)\n\n        this.cache.set(request.id, request)\n        return request\n    }\n\n    async getOutboundRequests(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getUserRequestForOrg(organizationId: orgModel.OrganizationID): Promise<UserRequest | null> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        const grequest = grequests.find((r) => {\n            return r.groupid === organizationId\n        })\n\n        if (!grequest) {\n            return null\n        }\n\n        return groupRequestToOrgRequest(grequest) as UserRequest\n    }\n\n    async getPendingRequestsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        return grequests\n            .filter((r) => {\n                return r.groupid === organizationId\n            })\n            .map((r) => {\n                return groupRequestToOrgRequest(r)\n            })\n    }\n\n    async getRequestInboxForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        return grequests\n            .filter((r) => {\n                return r.groupid === organizationId\n            })\n            .map((r) => {\n                return groupRequestToOrgRequest(r)\n            })\n    }\n\n    /*\n        For a given organization (by id), return a list of all requests to that org \n    */\n    async getCombinedRequestInboxForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        let requests: Array<Request>\n\n        // const grequests = await groupsClient.getTargetedRequests({\n        //     includeClosed: false,\n        //     sortDirection: groupsApi.SortDirection.DESCENDING\n        // })\n\n        // // TODO should work in synchrony with above...\n        // return grequests\n        //     .filter((r) => {\n        //         return r.groupid === organizationId\n        //     })\n        //     .map((r) => {\n        //         return groupRequestToOrgRequest(r)\n        //     })\n\n        try {\n            requests = (await groupsClient.getGroupRequests(organizationId, {\n                includeClosed: false,\n                sortDirection: groupsApi.SortDirection.DESCENDING\n            }))\n                .map((request) => {\n                    return groupRequestToOrgRequest(request)\n                })\n        } catch (ex) {\n            requests = []\n        }\n\n        return requests\n    }\n\n    async getRequestOutboxForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        return grequests\n            .filter((r) => {\n                return r.groupid === organizationId\n            })\n            .map((r) => {\n                return groupRequestToOrgRequest(r)\n            })\n    }\n\n\n    async getOrganizationInvitations(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        }).filter((request) => {\n            return (request.type === RequestType.INVITATION)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getOrganizationInvitationsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const invitations = await this.getOrganizationInvitations()\n        return invitations.filter((invitation) => {\n            return (invitation.organizationId === organizationId)\n        })\n    }\n\n    async getInboundRequests(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getUserInvitationForOrg(organizationId: orgModel.OrganizationID): Promise<UserInvitation | null> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        const grequest = grequests.find((r) => {\n            return (r.groupid === organizationId)\n        })\n\n        if (!grequest) {\n            return null\n        }\n\n        return groupRequestToOrgRequest(grequest) as UserInvitation\n    }\n\n    async getPendingOrganizationRequestsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const groupRequests = await groupsClient.getGroupRequests(organizationId, {\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        return groupRequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        // const [groupRequests, adminRequests] = await Promise.all([\n        //     groupsClient.getGroupRequests(groupId, {\n        //         includeClosed: false,\n        //         sortDirection: groupsApi.SortDirection.DESCENDING\n        //     }),\n        //     groupsClient.getCreatedRequests({\n        //         includeClosed: false,\n        //         sortDirection: groupsApi.SortDirection.DESCENDING\n        //     })\n        // ])\n        // const groupAdminRequests = adminRequests.filter((request) => {\n        //     return (request.groupid === groupId)\n        // })\n\n        // return Promise.all(groupRequests.concat(groupAdminRequests).map((request) => {\n        //     return groupRequestToOrgRequest(request)\n        // }))\n    }\n\n    async getPendingOrganizationRequests(groupIds: Array<string>): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const groupRequests = await Promise.all(groupIds.map((groupId) => {\n            return groupsClient.getGroupRequests(groupId, {\n                includeClosed: false,\n                sortDirection: groupsApi.SortDirection.DESCENDING\n            })\n        }))\n\n        const allRequests = groupRequests.reduce((allRequests, requests) => {\n            return allRequests.concat(requests)\n        }, [])\n\n        return allRequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n    }\n\n    async cancelRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.cancelRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async acceptRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.acceptRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async denyRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.denyRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async acceptJoinInvitation(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.acceptRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async rejectJoinInvitation(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.denyRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async inviteUserToJoinOrg(groupId: string, username: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.inviteUserToGroup({\n            groupId,\n            username\n        })\n            .then((request) => {\n                return groupRequestToOrgRequest(request)\n            })\n    }\n}","import * as groupsApi from '../../apis/groups'\nimport {\n    SortDirection, EditableOrganization, ValidationState, EditableString, ValidationErrorType\n} from '../../../types';\nimport * as requestModel from '../requests'\nimport * as userModel from '../user'\nimport Validation from './validation'\n\n// import Member from '../../../components/entities/Member';\n\n\nexport interface OrganizationUpdate {\n    name: string\n    logoUrl: string | null\n    description: string\n    isPrivate: boolean\n    homeUrl: string | null\n    researchInterests: string\n}\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\nexport interface EditableMemberProfile {\n    title: EditableString\n}\nexport enum UserRelationToOrganization {\n    NONE = 'NONE',\n    VIEW = 'VIEW',\n    MEMBER_REQUEST_PENDING = 'MEMBER_REQUEST_PENDING',\n    MEMBER_INVITATION_PENDING = 'MEMBER_INVITATION_PENDING',\n    MEMBER = 'MEMBER',\n    ADMIN = 'ADMIN',\n    OWNER = 'OWNER'\n}\n\nexport interface UserOrgRelation {\n    type: UserRelationToOrganization\n}\n\nexport interface NoRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.NONE\n}\n\nexport interface ViewRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.VIEW\n}\n\nexport interface MembershipRequestPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n    requestId: string\n}\n\nexport interface MembershipInvitationPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n    requestId: string\n}\n\nexport interface MemberRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER\n}\n\nexport interface AdminRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.ADMIN\n}\n\nexport interface OwnerRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.OWNER\n}\n\nexport type Relation = NoRelation | ViewRelation | MembershipRequestPendingRelation | MembershipInvitationPendingRelation | MemberRelation | AdminRelation | OwnerRelation\n\nexport type Username = string\n\nexport enum MemberType {\n    MEMBER = 0,\n    ADMIN,\n    OWNER\n}\nexport interface Member {\n    username: groupsApi.Username\n    joinedAt: Date\n    lastVisitedAt: Date | null\n    type: MemberType\n    title: string\n}\n\nexport interface MemberUpdate {\n    title?: string\n}\n\nexport enum UserWorkspacePermission {\n    NONE = 0,\n    VIEW,\n    EDIT,\n    ADMIN,\n    OWNER\n}\n\nexport type WorkspaceID = number\n\nexport interface NarrativeResource {\n    workspaceId: number\n    title: string\n    permission: UserWorkspacePermission\n    isPublic: boolean\n    createdAt: Date\n    updatedAt: Date\n    description: string\n}\n\nexport type AppID = string\n\nexport interface AppInfo {\n    appId: AppID\n}\n\nexport interface BriefOrganization {\n    id: string\n    name: string\n    logoUrl: string | null\n    private: boolean\n    homeUrl: string | null\n    researchInterests: string | null\n    // TODO: we need researchInterests here\n    owner: Member\n    relation: UserRelationToOrganization\n    createdAt: Date\n    modifiedAt: Date\n    lastVisitedAt: Date | null\n\n    memberCount: number\n    narrativeCount: number\n}\n\nexport enum OrganizationKind {\n    NORMAL = 0,\n    INACCESSIBLE_PRIVATE\n}\n\nexport interface InaccessiblePrivateOrganization {\n    kind: OrganizationKind.INACCESSIBLE_PRIVATE\n    id: string\n    isPrivate: boolean\n    relation: UserRelationToOrganization\n}\n\nexport interface Organization {\n    kind: OrganizationKind.NORMAL\n    id: string\n    name: string\n    isPrivate: boolean\n    isMember: boolean\n    relation: UserRelationToOrganization\n    logoUrl: string | null\n    homeUrl: string | null\n    researchInterests: string\n    description: string\n    owner: Member\n    areMembersPrivate: boolean\n    members: Array<Member>\n    // relation: UserOrgRelation\n    createdAt: Date\n    modifiedAt: Date\n    lastVisitedAt: Date | null\n    narratives: Array<NarrativeResource>\n    apps: Array<AppInfo>\n    memberCount: number\n    narrativeCount: number\n    appCount: number\n}\n\n// export interface RequestStatus {\n//     new: boolean,\n//     old: boolean\n// }\n\n// LEFT OF HERE - inapplicable should be set if the user is not an admin.\nexport enum RequestStatus {\n    INAPPLICABLE = 'INAPPLICABLE',\n    NONE = 'NONE',\n    OLD = 'OLD',\n    NEW = 'NEW'\n}\n\nexport function determineRelation(\n    org: Organization | InaccessiblePrivateOrganization,\n    username: userModel.Username,\n    request: requestModel.UserRequest | null,\n    invitation: requestModel.UserInvitation | null): Relation {\n\n    if (org.kind === OrganizationKind.INACCESSIBLE_PRIVATE) {\n        if (request && request.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                requestId: request.id\n            } as MembershipRequestPendingRelation\n        } else if (invitation && invitation.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                requestId: invitation.id\n            } as MembershipInvitationPendingRelation\n        } else {\n            return {\n                type: UserRelationToOrganization.NONE\n            } as NoRelation\n        }\n    }\n\n    if (username === org.owner.username) {\n        return {\n            type: UserRelationToOrganization.OWNER\n        } as OwnerRelation\n    } else {\n        const member = org.members.find((member) => {\n            return (member.username === username)\n        })\n        if (member) {\n            switch (member.type) {\n                case MemberType.MEMBER:\n                    return {\n                        type: UserRelationToOrganization.MEMBER\n                    } as MemberRelation\n                case MemberType.ADMIN:\n                    return {\n                        type: UserRelationToOrganization.ADMIN\n                    } as AdminRelation\n                case MemberType.OWNER:\n                    return {\n                        type: UserRelationToOrganization.OWNER\n                    } as OwnerRelation\n                default:\n                    return {\n                        type: UserRelationToOrganization.NONE\n                    } as NoRelation\n            }\n        } else if (request && request.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                requestId: request.id\n            } as MembershipRequestPendingRelation\n        } else if (invitation && invitation.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                requestId: invitation.id\n            } as MembershipInvitationPendingRelation\n        } else {\n            return {\n                type: UserRelationToOrganization.NONE\n            } as NoRelation\n        }\n    }\n}\n\nfunction groupPermissionToWorkspacePermission(groupsPermission: string): UserWorkspacePermission {\n    switch (groupsPermission) {\n        case 'None':\n            return UserWorkspacePermission.NONE\n        case 'Read':\n            return UserWorkspacePermission.VIEW\n        case 'Write':\n            return UserWorkspacePermission.EDIT\n        case 'Admin':\n            return UserWorkspacePermission.ADMIN\n        case 'Own':\n            return UserWorkspacePermission.OWNER\n        default:\n            throw new Error('Invalid groups user permission: ' + groupsPermission)\n    }\n}\n\nexport function groupToOrganization(group: groupsApi.Group, currentUser: Username): Organization {\n\n    const owner: Member = {\n        username: group.owner.name,\n        joinedAt: new Date(group.owner.joined),\n        lastVisitedAt: group.owner.lastvisit ? new Date(group.owner.lastvisit) : null,\n        type: MemberType.OWNER,\n        title: 'Owner'\n    }\n\n    // We join admins and members, since they are all members, just different privileges in the org\n    const members = (<Array<Member>>[\n        // owner\n    ]).concat(group.admins.map((admin) => {\n        return {\n            username: admin.name,\n            joinedAt: new Date(admin.joined),\n            lastVisitedAt: admin.lastvisit ? new Date(admin.lastvisit) : null,\n            type: MemberType.ADMIN,\n            title: admin.custom.title\n        }\n    })).concat(group.members.map((member) => {\n        return {\n            username: member.name,\n            joinedAt: new Date(member.joined),\n            lastVisitedAt: member.lastvisit ? new Date(member.lastvisit) : null,\n            type: MemberType.MEMBER,\n            title: member.custom.title\n        }\n    }))\n\n    const narratives: Array<NarrativeResource> = group.resources.workspace.map((info) => {\n        return {\n            workspaceId: parseInt(info.rid, 10),\n            title: info.narrname,\n            isPublic: info.public,\n            permission: groupPermissionToWorkspacePermission(info.perm),\n            createdAt: new Date(info.narrcreate),\n            updatedAt: new Date(info.moddate),\n            description: info.description\n        }\n    })\n    const apps: Array<AppInfo> = []\n\n\n    return {\n        kind: OrganizationKind.NORMAL,\n        id: group.id,\n        name: group.name,\n        isPrivate: group.private,\n        isMember: (group.role !== \"None\"),\n        relation: groupRoleToUserRelation(group.role),\n        logoUrl: group.custom.logourl || null,\n        homeUrl: group.custom.homeurl || null,\n        researchInterests: group.custom.researchinterests || '',\n        description: group.custom.description,\n        owner: owner,\n        areMembersPrivate: group.privatemembers,\n        members: members,\n        modifiedAt: new Date(group.moddate),\n        createdAt: new Date(group.createdate),\n        lastVisitedAt: group.lastvisit ? new Date(group.lastvisit) : null,\n        narratives: narratives,\n        apps: [],\n        memberCount: group.memcount,\n        narrativeCount: group.rescount.workspace || 0,\n        appCount: group.rescount.catalogmethod || 0\n    }\n}\n\nexport function groupToPrivateOrganization(group: groupsApi.InaccessiblePrivateGroup, currentUser: Username): InaccessiblePrivateOrganization {\n    return {\n        kind: OrganizationKind.INACCESSIBLE_PRIVATE,\n        id: group.id,\n        isPrivate: group.private,\n        // isMember: false,\n        relation: groupRoleToUserRelation(group.role)\n    }\n}\n\n// export function determineRelation(group: Group, username: userModel.Username) {\n//     let relation: UserOrgRelation\n//     // TODO: when we have access to members, admins, and group publication status, we can \n//     // flesh out all user relations.\n//     // const orgMembers: Array<username> = this.membersAndAdminsToMembers(members, admins, profileMap)\n\n//     if (username === group.owner) {\n//         relation = {\n//             type: UserRelationToOrganization.OWNER\n//         } as OwnerRelation\n//     } else if (group.admins.indexOf(username) >= 0) {\n//         relation = {\n//             type: UserRelationToOrganization.ADMIN\n//         } as AdminRelation\n//     } else if (group.members.indexOf(username) >= 0) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER\n//         } as MemberRelation\n//     } else if (pendingRequests.has(group.id)) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n//             requestId: pendingRequests.get(group.id)!.id\n//         } as MembershipRequestPendingRelation\n//     } else if (pendingInvites.has(group.id)) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n//             requestId: pendingInvites.get(group.id)!.id\n//         } as MembershipInvitationPendingRelation\n//     } else {\n//         relation = {\n//             type: UserRelationToOrganization.VIEW\n//         } as ViewRelation\n//     }\n// }\n\nexport type GroupID = string\nexport type OrganizationID = GroupID\n\n\nexport interface ConstructorParams {\n    groupsServiceURL: string\n    token: string\n    username: groupsApi.Username\n}\n\nexport interface QueryResults {\n    organizations: Array<BriefOrganization>\n    total: number\n}\n\nexport interface Query {\n    searchTerms: Array<string>\n    username: groupsApi.Username\n    sortField: string\n    sortDirection: SortDirection\n    filter: Filter\n}\n\nexport function applySearch(orgs: Array<BriefOrganization>, searchTerms: Array<string>): Array<BriefOrganization> {\n    const searchTermsRe = searchTerms.map((term) => {\n        return new RegExp(term, 'i')\n    })\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTermsRe.every((termRe) => {\n            return termRe.test(org.name) ||\n                termRe.test(org.researchInterests || '') ||\n                termRe.test(org.owner.username)\n        })\n    })\n    return filteredOrgs\n}\n\nfunction dateDays(d: Date) {\n    const t = d.getTime()\n    return Math.round(t / (1000 * 60 * 60 * 24))\n}\n\nfunction applySortComparison(sortField: string, direction: number, a: BriefOrganization, b: BriefOrganization) {\n    switch (sortField) {\n        case 'created':\n            return direction * (dateDays(a.createdAt) - dateDays(b.createdAt))\n        case 'modified':\n        case 'changed':\n            return direction * (dateDays(a.modifiedAt) - dateDays(b.modifiedAt))\n        case 'name':\n            return direction * a.name.localeCompare(b.name)\n        case 'owner':\n            // TODO: after the dust settles for org -> brief org conversion,\n            // we may need to convert the owner to a member via profile...\n            return direction * a.owner.username.localeCompare(b.owner.username)\n        case 'narrativeCount':\n            return direction * (a.narrativeCount - b.narrativeCount)\n        case 'memberCount':\n            return direction * (a.memberCount - b.memberCount)\n        default:\n            console.warn('unimplemented sort field: ' + sortField)\n            return 0;\n    }\n}\n\nfunction applySort(organizations: Array<BriefOrganization>, sortField: string, sortDirection: SortDirection): Array<BriefOrganization> {\n    const direction = sortDirection === SortDirection.ASCENDING ? 1 : -1\n    return organizations.slice().sort((a, b) => {\n        return applySortComparison(sortField, direction, a, b) || applySortComparison('name', 1, a, b)\n    })\n}\n\nfunction groupRoleToUserRelation(role: groupsApi.Role): UserRelationToOrganization {\n    switch (role) {\n        case 'None': return UserRelationToOrganization.NONE\n        case 'Member': return UserRelationToOrganization.MEMBER\n        case 'Admin': return UserRelationToOrganization.ADMIN\n        case 'Owner': return UserRelationToOrganization.OWNER\n        default: throw new Error('Unknown role: ' + role)\n    }\n}\n\nexport interface Filter {\n    roleType: string,\n    roles: Array<string>,\n    privacy: string\n}\n\nfunction applyFilter(organizations: Array<BriefOrganization>, { roleType, roles, privacy }: Filter, username: groupsApi.Username): Array<BriefOrganization> {\n    function applyRoleType(org: BriefOrganization) {\n        switch (roleType) {\n            case 'myorgs':\n                return [\n                    UserRelationToOrganization.MEMBER,\n                    UserRelationToOrganization.ADMIN,\n                    UserRelationToOrganization.OWNER\n                ].includes(org.relation)\n            case 'notmyorgs':\n                return ![\n                    UserRelationToOrganization.MEMBER,\n                    UserRelationToOrganization.ADMIN,\n                    UserRelationToOrganization.OWNER\n                ].includes(org.relation)\n            case 'all':\n            default:\n                return true\n        }\n    }\n    function applyRole(org: BriefOrganization) {\n        if (roles.length === 0) {\n            return true\n        }\n        return roles.some((role) => {\n            switch (role) {\n                case 'member':\n                    return (org.relation === UserRelationToOrganization.MEMBER)\n                case 'admin':\n                    return (org.relation === UserRelationToOrganization.ADMIN)\n                case 'owner':\n                    return (org.relation === UserRelationToOrganization.OWNER)\n                default:\n                    return false\n            }\n        })\n    }\n    function applyPrivacy(org: BriefOrganization) {\n        switch (privacy) {\n            case 'public':\n                return !org.private\n            case 'private':\n                return org.private\n            case 'any':\n                return true\n            default:\n                return false\n        }\n    }\n    return organizations.filter((org) => {\n        return applyRoleType(org) && applyRole(org) && applyPrivacy(org)\n    })\n\n    // switch (filter) {\n    //     case 'role:all':\n    //         return organizations\n    //     case 'notMemberOf':\n    //         return organizations.filter((org) => {\n    //             return (org.relation === UserRelationToOrganization.NONE)\n    //         })\n    //     case 'memberOf':\n    //         return organizations.filter((org) => {\n    //             return (org.relation !== UserRelationToOrganization.NONE)\n    //         })\n    //     case 'role:member':\n    //         return organizations.filter((org) => {\n    //             return (org.relation === UserRelationToOrganization.MEMBER)\n    //         })\n    //     case 'role:myorgs':\n    //         return organizations.filter((org) => {\n    //             return [\n    //                 UserRelationToOrganization.MEMBER,\n    //                 UserRelationToOrganization.ADMIN,\n    //                 UserRelationToOrganization.OWNER\n    //             ].includes(org.relation)\n    //         })\n    //     case 'role:notmyorgs':\n    //         return organizations.filter((org) => {\n    //             return ![\n    //                 UserRelationToOrganization.MEMBER,\n    //                 UserRelationToOrganization.ADMIN,\n    //                 UserRelationToOrganization.OWNER\n    //             ].includes(org.relation)\n    //         })\n\n    //     case 'role:owner':\n    //         return organizations.filter((org) => (org.relation === UserRelationToOrganization.OWNER))\n    //     case 'role:notowner':\n    //         return organizations.filter((org) => (org.relation !== UserRelationToOrganization.OWNER))\n    //     case 'role:admin':\n    //         return organizations.filter((org) => (org.relation === UserRelationToOrganization.OWNER ||\n    //             org.relation === UserRelationToOrganization.ADMIN))\n    //     case 'privacy:private':\n    //         return organizations.filter((org) => {\n    //             return org.private\n    //         })\n    //     case 'privacy:public':\n    //         return organizations.filter((org) => {\n    //             return !org.private\n    //         })\n\n    //     // TODO: re-enable when have relation again...\n    //     // case 'pending':\n    //     //     return organizations.filter((org) => (\n    //     //         org.relation.type === UserRelationToOrganization.MEMBER_INVITATION_PENDING ||\n    //     //         org.relation.type === UserRelationToOrganization.MEMBER_REQUEST_PENDING\n    //     //     ))\n    //     // case 'groupPending':\n    //     //     return organizations.filter((org) => (\n    //     //         (org.relation.type === UserRelationToOrganization.ADMIN ||\n    //     //             org.relation.type === UserRelationToOrganization.OWNER) &&\n    //     //         (org.adminRequests && org.adminRequests.length > 0)\n    //     //     ))\n    //     default:\n    //         console.warn('unknown filter : ' + filter)\n    //         return organizations\n    // }\n}\n\nexport class OrganizationModel {\n\n    params: ConstructorParams\n    groupsClient: groupsApi.GroupsClient\n    organizations: Map<OrganizationID, Organization | InaccessiblePrivateOrganization>\n\n    constructor(params: ConstructorParams) {\n        this.params = params\n        this.groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        this.organizations = new Map<OrganizationID, Organization>()\n    }\n\n    async getOrg(id: OrganizationID): Promise<Organization | InaccessiblePrivateOrganization> {\n        if (this.organizations.has(id)) {\n            return this.organizations.get(id)!\n        }\n        return this.groupsClient.getGroupById(id)\n            .then((group) => {\n                let org: Organization | InaccessiblePrivateOrganization\n                if (group.role === \"None\" && group.private) {\n                    org = groupToPrivateOrganization(group as groupsApi.InaccessiblePrivateGroup, this.params.username)\n                } else {\n                    org = groupToOrganization(group as groupsApi.Group, this.params.username)\n                }\n                this.organizations.set(id, org)\n                return org\n            })\n    }\n\n    async getOrganization(id: OrganizationID): Promise<Organization> {\n        if (this.organizations.has(id)) {\n            const org = this.organizations.get(id)!\n            if (org.kind !== OrganizationKind.NORMAL) {\n                throw new Error('Inaccessible Organization')\n            }\n            return org\n        }\n        return this.groupsClient.getGroupById(id)\n            .then((group) => {\n\n                if (group.role === \"None\" && group.private) {\n                    throw new Error('Inaccessible Organization')\n                }\n\n                const org = groupToOrganization(group as groupsApi.Group, this.params.username)\n                this.organizations.set(id, org)\n                return org\n            })\n    }\n\n    async getOrgs(ids: Array<OrganizationID>): Promise<Array<Organization | InaccessiblePrivateOrganization>> {\n        return Promise.all(ids.map((id) => {\n            return this.getOrg(id)\n        }))\n    }\n\n    async getAllOrgs(): Promise<Array<Organization | InaccessiblePrivateOrganization>> {\n        const groups = await this.groupsClient.getGroups()\n        const ids = groups.map((group) => {\n            return group.id\n        })\n        return this.getOrgs(ids)\n    }\n\n    async getOwnOrgs(): Promise<Array<BriefOrganization>> {\n        const orgs = await this.getAllOrgs2()\n\n        const ownOrgs = orgs\n            .filter((org: BriefOrganization) => {\n                // ensure that user has some relationship to the org:\n                // member, admin, or owner\n                return (org.relation !== UserRelationToOrganization.NONE)\n            })\n\n        return ownOrgs\n\n        // return Promise.all(ownOrgs.map((org: BriefOrganization) => {\n        //     return this.getOrg(org.id)\n        // }))\n    }\n\n\n\n    listGroupToBriefOrganization(group: groupsApi.BriefGroup): BriefOrganization {\n        return {\n            id: group.id,\n            name: group.name,\n            logoUrl: group.custom.logourl || null,\n            private: group.private,\n            homeUrl: group.custom.homeurl || null,\n            researchInterests: group.custom.researchinterests || null,\n            owner: {\n                username: group.owner,\n                lastVisitedAt: null,\n                type: MemberType.OWNER,\n                joinedAt: new Date(group.createdate),\n                title: 'Owner'\n            },\n            // fix these...\n            relation: groupRoleToUserRelation(group.role),\n            createdAt: new Date(group.createdate),\n            modifiedAt: new Date(group.moddate),\n            lastVisitedAt: group.lastvisit ? new Date(group.lastvisit) : null,\n            memberCount: group.memcount || 0,\n            narrativeCount: group.rescount.workspace || 0\n        }\n    }\n\n    async getAllOrgs2(): Promise<Array<BriefOrganization>> {\n        const groups = await this.groupsClient.listGroups()\n        const orgs = groups.map((group) => {\n            return this.listGroupToBriefOrganization(group)\n        })\n        return orgs\n    }\n\n    async queryOrgs(query: Query): Promise<QueryResults> {\n        // const orgs = await this.getAllOrgs()\n        const orgs = await this.getAllOrgs2()\n\n        const filtered = applyFilter(orgs, query.filter, query.username)\n        const searched = applySearch(filtered, query.searchTerms)\n        const sorted = applySort(searched, query.sortField, query.sortDirection)\n\n        return {\n            organizations: sorted,\n            total: orgs.length\n        }\n    }\n\n    async ownOrgs(username: groupsApi.Username): Promise<QueryResults> {\n        // const orgs = await this.getAllOrgs2()\n\n        // const groupsClient = new groupsApi.GroupsClient({\n        //     url: this.params.groupsServiceURL,\n        //     token: this.params.token\n        // })\n\n        // const groups = await groupsClient.getGroups()\n\n        // const ownGroups = groups.filter((group: groupsApi.Group) => {\n        //     if (group.owner.name === username) {\n        //         return true\n        //     }\n        //     if (group.members.find((member) => {\n        //         return (member.name === username)\n        //     })) {\n        //         return true\n        //     }\n        //     if (group.admins.find((member) => {\n        //         return (member.name === username)\n        //     })) {\n        //         return true\n        //     }\n        //     return false\n        // })\n\n\n        // const ownOrganizations = ownGroups.map((group) => {\n        //     // return groupToOrganization(group, username)\n        //     return this.listGroupToBriefOrganization(group)\n        // })\n\n        const orgs = await this.getAllOrgs2()\n\n\n        const ownOrgs = orgs.filter((org: BriefOrganization) => {\n\n            return (org.relation !== UserRelationToOrganization.NONE)\n            // if (org.owner === username) {\n            //     return true\n            // }\n            // if (org.members.find((member) => {\n            //     return (member.name === username)\n            // })) {\n            //     return true\n            // }\n            // if (group.admins.find((member) => {\n            //     return (member.name === username)\n            // })) {\n            //     return true\n            // }\n            // return false\n        })\n\n        return {\n            organizations: ownOrgs,\n            total: ownOrgs.length\n        }\n    }\n\n    async grantViewAccess(requestId: string): Promise<requestModel.Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        await groupsClient.grantReadAccessToRequestedResource({ requestId })\n        const req = await groupsClient.getRequest(requestId)\n        return requestModel.groupRequestToOrgRequest(req)\n    }\n\n    async addOrg(newOrg: EditableOrganization, username: groupsApi.Username): Promise<Organization> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n        if ((newOrg.id.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.name.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.logoUrl.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.description.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.isPrivate.validationState.type !== ValidationErrorType.OK)\n        ) {\n            return Promise.reject(new Error('One or more fields are invalid'))\n        }\n\n        return groupsClient.createGroup({\n            id: newOrg.id.value,\n            name: newOrg.name.value,\n            logoUrl: newOrg.logoUrl.value,\n            homeUrl: newOrg.homeUrl.value,\n            researchInterests: newOrg.researchInterests.value,\n            description: newOrg.description.value,\n            isPrivate: newOrg.isPrivate.value\n        })\n            .then((group) => {\n                return groupToOrganization(group, username)\n            })\n    }\n\n    async orgExists(id: string): Promise<boolean> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.groupExists(id)\n            .then(({ exists }) => {\n                return exists\n            })\n    }\n\n    async updateOrg(id: string, orgUpdate: OrganizationUpdate): Promise<void> {\n\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n\n\n        return groupsClient.updateGroup(id, {\n            name: orgUpdate.name,\n            logoUrl: orgUpdate.logoUrl,\n            homeUrl: orgUpdate.homeUrl,\n            researchInterests: orgUpdate.researchInterests,\n            description: orgUpdate.description,\n            private: orgUpdate.isPrivate\n        })\n    }\n\n    validateOrgId(id: string): [string, ValidationState] {\n        return Validation.validateOrgId(id);\n    }\n\n    validateOrgName(name: string): [string, ValidationState] {\n        return Validation.validateOrgName(name)\n    }\n\n    validateOrgDescription(description: string): [string, ValidationState] {\n        return Validation.validateOrgDescription(description);\n    }\n\n    async removeNarrativeFromOrg(organizationId: OrganizationID, workspaceId: number): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.deleteResource(\n            organizationId,\n            'workspace',\n            String(workspaceId)\n        )\n    }\n\n    async grantNarrativeAccess(groupId: string, resourceId: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // TODO: yuck. need to \n        await groupsClient.grantResourceAccess(groupId, 'workspace', resourceId)\n        return\n    }\n\n    async requestMembership(id: string): Promise<requestModel.Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.requestMembership({\n            groupId: id\n        })\n        return requestModel.groupRequestToOrgRequest(request)\n    }\n\n    async addOrRequestNarrativeToGroup(groupId: string, workspaceId: WorkspaceID): Promise<requestModel.Request | boolean> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.addOrRequestNarrative({\n            groupId: groupId,\n            workspaceId: workspaceId\n        })\n        if (request.complete === true) {\n            return true\n        } else {\n            return requestModel.groupRequestToOrgRequest(request)\n        }\n    }\n\n    async memberToAdmin(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.memberToAdmin({\n            groupId,\n            member\n        })\n    }\n\n    async adminToMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.adminToMember({\n            groupId,\n            member\n        })\n    }\n    async removeMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.removeMember({\n            groupId,\n            member\n        })\n    }\n\n    async updateMember(groupId: string, memberUsername: string, update: MemberUpdate) {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.updateMember({ groupId, memberUsername, update })\n    }\n\n    async visitOrg({ organizationId }: { organizationId: string }): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.visitGroup({ groupId: organizationId })\n    }\n\n    async getOpenRequestsStatus({ organizationIds }: { organizationIds: Array<OrganizationID> }): Promise<Map<OrganizationID, RequestStatus>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        const openRequests = await groupsClient.getOpenRequests({ groupIds: organizationIds })\n        const result = new Map<OrganizationID, RequestStatus>()\n        for (const [groupId, status] of openRequests.entries()) {\n            const requestStatus: RequestStatus = stringToRequestStatus(status)\n            result.set(<OrganizationID>groupId, requestStatus)\n        }\n        return result\n    }\n\n    async getOpenRequestStatus({ organizationId }: { organizationId: OrganizationID }): Promise<RequestStatus> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        const openRequests = await groupsClient.getOpenRequests({ groupIds: [organizationId] })\n        for (const [groupId, status] of openRequests.entries()) {\n            return stringToRequestStatus(status)\n        }\n        throw new Error('expected request status, got none')\n    }\n}\n\nfunction stringToRequestStatus(status: groupsApi.RequestStatus): RequestStatus {\n    switch (status.new) {\n        case 'None': return RequestStatus.NONE\n        case 'Old': return RequestStatus.OLD\n        case 'New': return RequestStatus.NEW\n        default: throw new Error('Invalid open request status: ' + status)\n    }\n}\n\nexport function userPermissionToWorkspacePermission(userPermission: string, isOwner: boolean) {\n    if (isOwner) {\n        return UserWorkspacePermission.OWNER\n    }\n    switch (userPermission) {\n        case 'r':\n            return UserWorkspacePermission.VIEW\n        case 'w':\n            return UserWorkspacePermission.EDIT\n        case 'a':\n            return UserWorkspacePermission.ADMIN\n        default:\n            throw new Error('Invalid workspace user permission: ' + userPermission)\n    }\n}","import { UIError, UIErrorType, ValidationState, ValidationErrorType } from \"../../../types\";\n\nexport default class Validation {\n    static nonPrintableRe = /[\\000-\\031]/\n\n    static testNonPrintableCharacters(s: string) {\n        const firstNonPrintable = s.search(Validation.nonPrintableRe)\n        if (firstNonPrintable === -1) {\n            return false\n        }\n        const beforeStart = firstNonPrintable - 5 < 0 ? 0 : firstNonPrintable - 5\n        const before = s.slice(beforeStart, firstNonPrintable)\n        const after = s.slice(firstNonPrintable + 1, firstNonPrintable + 6)\n        return `Non-printable character at position ${firstNonPrintable}: \"${before}___${after}`\n    }\n    static validateOrgId(id: string): [string, ValidationState] {\n        // May not be empty\n        if (id.length === 0) {\n            return [\n                id, {\n                    type: ValidationErrorType.REQUIRED_MISSING,\n                    message: 'Organization id may not be empty',\n                    validatedAt: new Date()\n                }]\n        }\n        // No spaces\n        if (id.match(/\\s/)) {\n            return [\n                id, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization id may not contain a space',\n                    validatedAt: new Date()\n                }]\n        }\n        // May not exceed maximum size\n        // todo: what is the real limit?\n        if (id.length > 100) {\n            return [\n                id, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization id may not be longer than 100 characters',\n                    validatedAt: new Date()\n                }]\n        }\n\n        // May only consist if lower case alphanumeric\n        const alphaRe = /^[a-z0-9-]+$/\n        if (!id.match(alphaRe)) {\n            return [\n                id, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash \"-\"',\n                    validatedAt: new Date()\n                }\n            ]\n        }\n\n        return [id, {\n            type: ValidationErrorType.OK,\n            validatedAt: new Date()\n        }]\n    }\n\n    static validateOrgName(name: string): [string, ValidationState] {\n        if (name.length === 0) {\n            return [\n                name, {\n                    type: ValidationErrorType.REQUIRED_MISSING,\n                    message: 'Organization name may not be empty',\n                    validatedAt: new Date()\n                }]\n        }\n        if (name.length > 256) {\n            return [\n                name, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization name may not be longer than 256 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            name, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    static validateOrgLogoUrl(logoUrl: string | null): [string | null, ValidationState] {\n        if (logoUrl === null) {\n            return [\n                logoUrl, {\n                    type: ValidationErrorType.OK,\n                    validatedAt: new Date()\n                }\n            ]\n        }\n        if (logoUrl.length > 1000) {\n            return [\n                logoUrl, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Logo url may not be longer than 1000 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            logoUrl, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    static validateOrgHomeUrl(homeUrl: string | null): [string | null, ValidationState] {\n        if (homeUrl === null) {\n            return [\n                homeUrl, {\n                    type: ValidationErrorType.OK,\n                    validatedAt: new Date()\n                }\n            ]\n        }\n        if (homeUrl.length > 1000) {\n            return [\n                homeUrl, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Home url may not be longer than 1000 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            homeUrl, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    static validateOrgResearchInterests(researchInterests: string): [string, ValidationState] {\n        if (researchInterests.length === 0) {\n            return [\n                name, {\n                    type: ValidationErrorType.REQUIRED_MISSING,\n                    message: 'Research Interests may not be empty',\n                    validatedAt: new Date()\n                }]\n        }\n        if (researchInterests.length > 280) {\n            return [\n                researchInterests, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Research Interests may not be longer than 280 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            researchInterests, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    // static validateOrgGravatarHash(gravatarHash: string | null): [string | null, ValidationState] {\n    //     if (!gravatarHash) {\n    //         return [\n    //             null, {\n    //                 type: ValidationErrorType.OK,\n    //                 validatedAt: new Date()\n    //             }]\n    //     }\n    //     if (gravatarHash.length === 0) {\n    //         return [\n    //             gravatarHash, {\n    //                 type: ValidationErrorType.OK,\n    //                 validatedAt: new Date()\n    //             }]\n    //     }\n    //     if (gravatarHash.length > 32) {\n    //         return [\n    //             gravatarHash, {\n    //                 type: ValidationErrorType.ERROR,\n    //                 message: 'Organization gravatar hash may not be longer than 32 characters',\n    //                 validatedAt: new Date()\n    //             }]\n    //     }\n    //     if (gravatarHash.length < 32) {\n    //         return [\n    //             gravatarHash, {\n    //                 type: ValidationErrorType.ERROR,\n    //                 message: 'Organization gravatar hash may not be shorter than 32 characters',\n    //                 validatedAt: new Date()\n    //             }]\n    //     }\n    //     const acceptedChars = /^[a-f0-9]+$/\n    //     if (!acceptedChars.test(gravatarHash)) {\n    //         return [\n    //             gravatarHash, {\n    //                 type: ValidationErrorType.ERROR,\n    //                 message: 'Organization gravatar hash must consist only of the lower case hexadecimal characters a-f and 0-9',\n    //                 validatedAt: new Date()\n    //             }\n    //         ]\n    //     }\n\n    //     return [\n    //         gravatarHash, {\n    //             type: ValidationErrorType.OK,\n    //             validatedAt: new Date()\n    //         }]\n    // }\n\n    static validateOrgDescription(description: string): [string, ValidationState] {\n        if (description.length === 0) {\n            // return [name, {\n            //     type: ValidationErrorType.OK,\n            //     validatedAt: new Date()\n            // }]\n            return [name, {\n                type: ValidationErrorType.ERROR,\n                message: 'Organization description may not be empty',\n                validatedAt: new Date()\n            }]\n        }\n        // TODO: Is there really a limit?\n        // const nonPrintable = Validation.testNonPrintableCharacters(description)\n        // if (nonPrintable) {\n        //     return [\n        //         description, {\n        //             type: UIErrorType.ERROR,\n        //             message: nonPrintable\n        //         }\n        //     ]\n        // }\n        if (description.length > 4096) {\n            return [\n                description, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization description may not be longer than 4,096 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            description, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }\n        ]\n    }\n\n    static validateMemberTitle(title: string): [string, ValidationState] {\n        const maxTitleLength = 100\n        if (title.length > maxTitleLength) {\n            return [\n                title, {\n                    type: ValidationErrorType.ERROR,\n                    message: `member title may not be longer than ${maxTitleLength} characters`,\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            title, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n}","import { Action } from 'redux'\nimport * as actions from '../actions/inviteUser'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport * as orgModel from '../../data/models/organization/model'\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.LOADING\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: types.InviteUserViewState.EDITING,\n                    users: action.users,\n                    organization: action.organization,\n                    selectedUser: null\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                loadingState: types.ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function searchUsersSuccess(state: types.StoreState, action: actions.SearchUsersSuccess): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    users: action.users\n                }\n            }\n        }\n    }\n}\n\nexport function selectUserSuccess(state: types.StoreState, action: actions.SelectUserSuccess): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    selectedUser: {\n                        user: action.user,\n                        relation: action.relation\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function sendInvitationStart(state: types.StoreState, action: actions.SendInvitationStart): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    editState: types.InviteUserViewState.SENDING\n                }\n            }\n        }\n    }\n}\n\nexport function sendInvitationSuccess(state: types.StoreState, action: actions.SendInvitationSuccess): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n\n    const { views: { inviteUserView: { viewModel: { selectedUser, users } } } } = state\n\n    // const selectedUser = state.inviteUserView.value.selectedUser\n    if (!selectedUser) {\n        throw new Error('selected user is null')\n    }\n    selectedUser.relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n\n    if (!users) {\n        throw new Error('users is null')\n    }\n    const newUsers = users.map((user) => {\n        if (user.username === selectedUser.user.username) {\n            user.relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n        }\n        return user\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    editState: types.InviteUserViewState.SUCCESS,\n                    selectedUser: selectedUser,\n                    users: newUsers\n                }\n            }\n        }\n    }\n}\n\nexport function sendInvitationError(state: types.StoreState, action: actions.SendInvitationError): types.StoreState {\n    if (state.views.inviteUserView.viewModel === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            inviteUserView: {\n                ...state.views.inviteUserView,\n                viewModel: {\n                    ...state.views.inviteUserView.viewModel,\n                    editState: types.InviteUserViewState.ERROR\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.INVITE_USER_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.INVITE_USER_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.INVITE_USER_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.INVITE_USER_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS:\n            return searchUsersSuccess(state, action as actions.SearchUsersSuccess)\n        case ActionFlag.INVITE_USER_SELECT_USER_SUCCESS:\n            return selectUserSuccess(state, action as actions.SelectUserSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_START:\n            return sendInvitationStart(state, action as actions.SendInvitationStart)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS:\n            return sendInvitationSuccess(state, action as actions.SendInvitationSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_ERROR:\n            return sendInvitationError(state, action as actions.SendInvitationError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageMembership'\nimport { StoreState, ComponentLoadingState, SyncState, ValidationStateOk, ValidationState, ValidationErrorType, SaveState, EditState, ManageMembershipViewModel } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    editableMemberProfile: action.editableMemberProfile,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.NEW,\n                    validationState: validationStateOk()\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction validationStateOk(): ValidationStateOk {\n    const x: ValidationState = {\n        type: ValidationErrorType.OK,\n        validatedAt: new Date()\n    }\n    return x\n}\n\nexport function updateTitleSuccess(state: StoreState, action: actions.UpdateTitleSuccess): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n\n    const editedMember = state.views.manageMembershipView.viewModel.editableMemberProfile\n    let syncState\n    if (action.title !== editedMember.title.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    editableMemberProfile: {\n                        ...state.views.manageMembershipView.viewModel.editableMemberProfile,\n                        title: {\n                            value: action.title,\n                            remoteValue: action.title,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    const editState = evaluateEditorState(newState.views.manageMembershipView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...newState.views.manageMembershipView,\n                viewModel: {\n                    ...newState.views.manageMembershipView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\nfunction evaluateEditorState(viewModel: ManageMembershipViewModel): EditState {\n    if (viewModel.editableMemberProfile.title.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    return EditState.UNEDITED\n}\n\nfunction evaluateSuccess(state: StoreState, action: actions.EvaluateSuccess): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n\n    const editState = evaluateEditorState(state.views.manageMembershipView.viewModel)\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    editState: editState,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction evaluateError(state: StoreState, action: actions.EvaluateError): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Validation error(s)',\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function saveSuccess(state: StoreState, action: actions.SaveSuccess): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED,\n                    editableMemberProfile: {\n                        title: {\n                            ...state.views.manageMembershipView.viewModel.editableMemberProfile.title,\n                            syncState: SyncState.CLEAN\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.MANAGE_MEMBERSHIP_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:\n            return updateTitleSuccess(state, action as actions.UpdateTitleSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:\n            return evaluateSuccess(state, action as actions.EvaluateSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR:\n            return evaluateError(state, action as actions.EvaluateError)\n        case ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS:\n            return saveSuccess(state, action as actions.SaveSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/requestAddNarrative'\nimport { StoreState, ComponentLoadingState, SaveState, NarrativeState } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    narratives: action.narratives,\n                    selectedNarrative: null,\n                    relation: action.relation,\n                    error: null,\n                    saveState: SaveState.SAVED\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function sendRequestStart(state: StoreState, action: actions.SendRequestStart): StoreState {\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    saveState: SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function sendRequestSuccess(state: StoreState, action: actions.SendRequestSuccess): StoreState {\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n\n    const newState: StoreState = {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    saveState: SaveState.SAVED\n                }\n            }\n        }\n    }\n\n    const viewModel = newState.views.requestNarrativeView.viewModel\n\n    if (!viewModel) {\n        throw new Error('view model missing')\n    }\n\n    const selectedNarrative = viewModel.selectedNarrative\n\n    // If the request is by an admin, it will be returned as true, not the request\n    // (the api returns {complete: true})\n    if (action.request === true) {\n        viewModel.narratives = viewModel.narratives.map((orgNarrative) => {\n            if (orgNarrative.narrative.workspaceId === selectedNarrative!.narrative.workspaceId) {\n                orgNarrative.status = NarrativeState.ASSOCIATED\n            }\n            return orgNarrative\n        })\n    } else {\n        viewModel.narratives = viewModel.narratives.map((orgNarrative) => {\n            if (orgNarrative.narrative.workspaceId === selectedNarrative!.narrative.workspaceId) {\n                orgNarrative.status = NarrativeState.REQUESTED\n            }\n            return orgNarrative\n        })\n    }\n\n    return newState\n}\n\nexport function sendRequestError(state: StoreState, action: actions.SendRequestError): StoreState {\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    saveState: SaveState.SAVE_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function selectNarrativeSuccess(state: StoreState, action: actions.SelectNarrativeSuccess): StoreState {\n    if (!state.views.requestNarrativeView.viewModel) {\n        throw new Error('view model missing')\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                // TODO: a selected state?\n                error: null,\n                viewModel: {\n                    ...state.views.requestNarrativeView.viewModel,\n                    selectedNarrative: action.narrative\n                }\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction sortSuccess(state: StoreState, action: actions.SortSuccess): StoreState {\n    const viewModel = state.views.requestNarrativeView.viewModel\n    if (viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            requestNarrativeView: {\n                ...state.views.requestNarrativeView,\n                viewModel: {\n                    ...viewModel,\n                    narratives: action.narratives\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:\n            return sendRequestSuccess(state, action as actions.SendRequestSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:\n            return selectNarrativeSuccess(state, action as actions.SelectNarrativeSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:\n            return sortSuccess(state, action as actions.SortSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","\nimport * as actions from '../actions/entities'\nimport { StoreState } from '../../types';\nimport { ActionFlag } from '../actions';\n\nfunction userLoaderSuccess(state: StoreState, action: actions.UserLoaderSuccess) {\n    const users = state.entities.users\n    // mutation ... horrible ;)\n    users.byId.set(action.user.username, action.user)\n    // return state\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            users: {\n                ...state.entities.users,\n                byId: new Map(users.byId)\n            }\n        }\n    }\n}\n\nfunction organizationLoaderSuccess(state: StoreState, action: actions.OrganizationLoaderSuccess) {\n    const orgsMap = state.entities.orgs.byId\n    orgsMap.set(action.organization.id, action.organization)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            orgs: {\n                ...state.entities.orgs,\n                byId: new Map(orgsMap)\n            }\n        }\n    }\n}\n\nfunction loadNarrativeSuccess(state: StoreState, action: actions.LoadNarrativeSuccess) {\n    const narratives = state.entities.narratives\n    narratives.byId.set(action.narrative.workspaceId, action.narrative)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            narratives: {\n                byId: new Map(narratives.byId)\n            }\n        }\n    }\n}\n\n// TODO: start and error\n\nfunction reducer(state: StoreState, action: actions.EntityAction): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ENTITY_USER_LOADER_SUCCESS:\n            return userLoaderSuccess(state, action as actions.UserLoaderSuccess)\n        case ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS:\n            return organizationLoaderSuccess(state, action as actions.OrganizationLoaderSuccess)\n        case ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS:\n            return loadNarrativeSuccess(state, action as actions.LoadNarrativeSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/organizationCentric'\nimport { StoreState, ComponentLoadingState } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                ...state.views.organizationCentricView,\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                ...state.views.organizationCentricView,\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    pendingJoinRequest: action.pendingJoinRequest,\n                    pendingJoinInvitation: action.pendingJoinInvitation,\n                    relation: action.relation\n                }\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            organizationCentricView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import * as actions from '../actions/global'\nimport { StoreState } from '../../types'\nimport { ActionFlag } from '../actions'\nimport { Action } from 'redux';\nimport { access } from 'fs';\n\nexport function accessNarrativeSuccess(state: StoreState, action: actions.AccessNarrativeSuccess): StoreState {\n    const narrativesById = state.entities.narratives.byId\n    narrativesById.set(action.narrative.workspaceId, action.narrative)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            narratives: {\n                ...state.entities.narratives,\n                byId: narrativesById\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.GLOBAL_ACCESS_NARRATIVE_SUCCESS:\n            return accessNarrativeSuccess(state, action as actions.AccessNarrativeSuccess)\n        default:\n            return null\n    }\n}\n\n// function reducer(state: StoreState, action: actions.EntityAction): StoreState | null {\n//     switch (action.type) {\n//         case ActionFlag.ENTITY_USER_LOADER_SUCCESS:\n//             return userLoaderSuccess(state, action as actions.UserLoaderSuccess)\n//         case ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS:\n//             return organizationLoaderSuccess(state, action as actions.OrganizationLoaderSuccess)\n//         case ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS:\n//             return loadNarrativeSuccess(state, action as actions.LoadNarrativeSuccess)\n//         default:\n//             return null\n//     }\n// }\n\n// export default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/notifications'\nimport { StoreState } from '../../types'\nimport { ActionFlag } from '../actions'\nimport * as feedsModel from '../../data/models/feeds'\n\nfunction loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    const notificationsById = new Map<feedsModel.NotificationID, feedsModel.OrganizationNotification>()\n    action.notifications.forEach((notification) => {\n        notificationsById.set(notification.id, notification)\n    })\n\n    return {\n        ...state,\n        db: {\n            ...state.db,\n            notifications: {\n                all: action.notifications,\n                byId: notificationsById\n            }\n        }\n    }\n}\n\nfunction unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        db: {\n            ...state.db,\n            notifications: {\n                all: [],\n                byId: new Map()\n            }\n        }\n    }\n}\n\nfunction readSuccess(state: StoreState, action: actions.ReadSuccess): StoreState {\n    const {\n        db: { notifications: { all, byId } }\n    } = state\n    const allNotifications = all.filter((notification) => {\n        return (notification.id !== action.notificationId)\n    })\n    const notificationsById = new Map(byId)\n    notificationsById.delete(action.notificationId)\n    return {\n        ...state,\n        db: {\n            ...state.db,\n            notifications: {\n                all: allNotifications,\n                byId: notificationsById\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.NOTIFICATIONS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.NOTIFICATIONS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.NOTIFICATIONS_READ_SUCCESS:\n            return readSuccess(state, action as actions.ReadSuccess)\n        default:\n            return null\n    }\n}","import { Action } from 'redux'\nimport * as actions from '../actions/dataServices'\nimport { StoreState } from '../../types';\nimport { ActionFlag } from '../actions';\nimport * as userProfileModel from '../../data/models/profile'\n\nfunction loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        db: {\n            ...state.db,\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.DATA_SERVICE_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        default:\n            return null\n    }\n}","import { Action } from 'redux'\nimport { StoreState } from '../../types'\nimport addOrgReducer from './addOrg'\nimport editOrgReducer from './editOrg'\nimport viewOrgReducer from './viewOrg'\nimport browseOrgsReducer from './browseOrgs'\nimport authReducer from './auth'\nimport appReducer from './app'\nimport manageOrganizatiopRequests from './manageOrganizationRequests'\nimport viewMembers from './viewMembers'\nimport inviteUser from './inviteUser'\nimport manageMembership from './manageMembership'\nimport requestAddNarrative from './requestAddNarrative'\nimport entities from './entities'\nimport organizationCentric from './organizationCentric'\nimport global from './global'\nimport notifications from './notifications'\nimport dataServices from './dataServices'\n\n\nexport function reducer(state: StoreState, action: Action): StoreState {\n    return addOrgReducer(state, action) ||\n        editOrgReducer(state, action) ||\n        browseOrgsReducer(state, action) ||\n        viewOrgReducer(state, action) ||\n        authReducer(state, action) ||\n        appReducer(state, action) ||\n        manageOrganizatiopRequests(state, action) ||\n        viewMembers(state, action) ||\n        inviteUser(state, action) ||\n        manageMembership(state, action) ||\n        requestAddNarrative(state, action) ||\n        entities(state, action) ||\n        organizationCentric(state, action) ||\n        global(state, action) ||\n        notifications(state, action) ||\n        dataServices(state, action) ||\n        state;\n}\n\nexport default reducer","import * as React from 'react'\nimport './Owner.css'\n\nimport Avatar from './Avatar'\nimport { Icon, Tooltip } from 'antd';\nimport * as userModel from '../../data/models/user'\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nexport interface OwnerProps {\n    user: userModel.User\n    avatarSize?: number\n    showAvatar: boolean\n}\n\ninterface OwnerState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nexport default class Owner extends React.Component<OwnerProps, OwnerState> {\n    constructor(props: OwnerProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderRole() {\n        return (\n            <span>\n                <Icon type=\"crown\" /> owner\n        </span>\n        )\n    }\n\n    renderAvatar() {\n        if (this.props.showAvatar) {\n            return (\n                <div className=\"Owner-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n            )\n        }\n    }\n\n    renderCompact() {\n        const tooltip = (\n            <div>\n                <div>\n                    {this.props.user.realname}\n                </div>\n                <div>\n                    <span><Avatar user={this.props.user} size={20} /></span>\n                    {' '}\n                    <span>{this.props.user.username}</span>\n                </div>\n            </div>\n        )\n        return (\n            <div className=\"Owner-owner\" >\n                {/* <div className=\"Owner-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div> */}\n                {this.renderAvatar()}\n\n                <div className=\"Owner-infoCol\">\n                    <div className=\"Owner-name\">\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            title={tooltip}>\n                            <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        </Tooltip>\n\n                    </div>\n                    {/* <div className=\"Owner-username\">\n                        {this.props.user.username}\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n\n    renderNormal() {\n        return (\n            <div className=\"Owner View-NORMAL\" >\n                <div className=\"Owner-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"Owner-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"Owner-infoCol\">\n                    <div className=\"Owner-name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                    </div>\n                    <div className=\"Owner-username\">\n                        {this.props.user.username}\n                    </div>\n                    {/* <div className=\"role\">\n                        {this.renderRole()}\n                    </div> */}\n                    {/* <div className=\"joinedAt\">\n                        <span className=\"field-label\">joined</span>{' '}{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(this.props.member.joinedAt)}\n                    </div> */}\n                    <div className=\"Owner-title\">\n                        {this.props.user.title || <i>no title in user profile</i>}\n                    </div>\n                    <div className=\"Owner-organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"Owner-location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n\n    render() {\n        return this.renderCompact()\n        // switch (this.state.view) {\n        //     case View.COMPACT:\n        //         return this.renderCompact()\n\n        //     case View.NORMAL:\n        //         return this.renderNormal()\n        // }\n    }\n}\n\n","import * as React from 'react'\nimport md5 from 'md5'\n\nexport interface OrgLogoProps {\n    logoUrl: string | null\n    size: number\n    organizationName: string\n    organizationId: string\n}\n\nexport interface OrgLogoState {\n\n}\n\nexport default class OrgLogo extends React.Component<OrgLogoProps, OrgLogoState> {\n    constructor(props: OrgLogoProps) {\n        super(props)\n    }\n\n    renderLogoUrl() {\n        if (!this.props.logoUrl) {\n            return (\n                <span>n/a</span>\n            )\n        }\n        return (\n            <img src={this.props.logoUrl} width={this.props.size} />\n        )\n    }\n\n    // see: https://github.com/lautis/unicode-substring/blob/master/index.js\n    charAt(inString: string, position: number) {\n        // const c1 = inString.charAt(position)\n        const c1 = inString.charCodeAt(position)\n        if (c1 >= 0xD800 && c1 <= 0xDBFF && inString.length > position + 1) {\n            const c2 = inString.charCodeAt(position + 1)\n            if (c2 > 0xDC00 && c2 <= 0xDFFF) {\n                return inString.substring(position, 2)\n            }\n        }\n        return inString.substring(position, 1)\n    }\n\n    renderDefaultInitial() {\n        const initial = this.charAt(this.props.organizationName, 0).toUpperCase()\n        // const initial = this.props.organizationName.substr(0, 1).toUpperCase()\n        const hash = md5(this.props.organizationId)\n\n        const color = hash.substr(0, 6)\n        // return (\n        //     <span style={{ color: '\"#' + color + '\"', width: this.props.size, height: this.props.size, fontSize: this.props.size - 6 }}\n        //     >{initial}</span>\n        // )\n        return (\n            <svg width={this.props.size} height={this.props.size} style={{ border: '1px rgba(200, 200, 200, 0.5) solid' }}>\n                <text x=\"50%\" y=\"50%\" dy={4} textAnchor=\"middle\" dominantBaseline=\"middle\" fontSize={this.props.size - 12} fill={'#' + color} fontFamily=\"sans-serif\">{initial}</text>\n            </svg>\n        )\n    }\n\n    renderLogo() {\n        if (this.props.logoUrl) {\n            return this.renderLogoUrl()\n        }\n        return this.renderDefaultInitial();\n    }\n\n    render() {\n        return this.renderLogo()\n    }\n}","import * as React from 'react'\nimport './Avatar.css'\nimport noUserPic from './nouserpic.png'\n\nimport { User } from '../../types'\n\nexport interface AvatarProps {\n    user: User,\n    size: number\n}\n\ninterface AvatarState {\n\n}\n\nexport class Avatar extends React.Component<AvatarProps, AvatarState> {\n    constructor(props: AvatarProps) {\n        super(props)\n    }\n\n    getAvatarUrl(user: User) {\n        switch (user.avatarOption || 'gravatar') {\n            case 'gravatar':\n                const gravatarDefault = user.gravatarDefault || 'identicon';\n                const gravatarHash = user.gravatarHash;\n                if (gravatarHash) {\n                    return 'https://www.gravatar.com/avatar/' + gravatarHash + '?s=60&amp;r=pg&d=' + gravatarDefault;\n                } else {\n                    return noUserPic;\n                }\n            case 'silhouette':\n            case 'mysteryman':\n            default:\n                return noUserPic;\n        }\n    }\n\n    render() {\n        const avatarUrl = this.getAvatarUrl(this.props.user)\n        return (\n            <img\n                src={avatarUrl}\n                style={{ width: this.props.size }}\n            />\n        )\n    }\n\n}\n\nexport default Avatar","export interface ServiceClientParams {\n    url: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport interface JSONResponse {\n    id: string\n    version: string\n    result: any\n    error: any\n}\n\nexport class ServiceClient {\n    url: string;\n    token: string | null;\n\n    static module: string;\n\n    constructor({ url, token }: ServiceClientParams) {\n        this.url = url\n        this.token = token || null\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n\n}\n\nexport class AuthorizedServiceClient extends ServiceClient {\n    token: string;\n\n    constructor(params: ServiceClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    callFunc(func: string, param: any): Promise<JSONResponse> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token!,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Request error: ' + response.status + ', ' + response.statusText)\n                }\n                return <unknown>response.json() as JSONResponse\n            })\n    }\n}\n\n","import { ServiceClientParams, ServiceClient, AuthorizedServiceClient } from \"./serviceClient\";\n\nexport interface User {\n    username: string,\n    realname: string,\n    thumbnail: string\n}\n\nexport type OrganizationSetting = {\n    settings: {\n        lastVisitedAt: Date | null\n    }\n}\n\nexport type OrganizationsSettings = {\n    orgSettings: any //Map<string, OrganizationSetting>\n}\n\nexport interface UserProfile {\n    user: User,\n    profile: {\n        synced: {\n            gravatarHash: string\n        }\n        userdata: {\n            jobTitle: string,\n            jobTitleOther: string,\n            organization: string\n            city: string\n            state: string\n            country: string\n            avatarOption: string\n            gravatarDefault: string\n        }\n        metadata: {\n            createdBy: string\n            created: string\n        }\n        plugins: {\n            organizations?: OrganizationsSettings\n        }\n    }\n}\n\n// Note that we are only supporting updating of the orgs plugin settings, \n// so make this strict-ish.\nexport interface UserProfileUpdate {\n    user: User,\n    profile: {\n        plugins: {\n            organizations: OrganizationsSettings\n        }\n    }\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\n\nexport interface UserProfileClientParams extends ServiceClientParams {\n}\n\nexport class UserProfileClient extends AuthorizedServiceClient {\n    static module: string = 'UserProfile'\n    static profileCache: Map<string, UserProfile> = new Map()\n\n    constructor(params: UserProfileClientParams) {\n        super(params)\n    }\n\n    // makePayload(method: string, param: any): JSONPayload {\n    //     return {\n    //         version: '1.1',\n    //         method: 'UserProfile.' + method,\n    //         id: String(Math.random()).slice(2),\n    //         params: [param]\n    //     }\n    // }\n\n    // makeEmptyPayload(method: string): JSONPayload {\n    //     return {\n    //         version: '1.1',\n    //         method: 'UserProfile.' + method,\n    //         id: String(Math.random()).slice(2),\n    //         params: []\n    //     }\n    // }\n\n    getVersion(): Promise<any> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makeEmptyPayload('version'))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    async getUserProfile(username: string): Promise<UserProfile> {\n        if (UserProfileClient.profileCache.has(username)) {\n            return Promise.resolve(UserProfileClient.profileCache.get(username)!)\n        }\n\n        return this.callFunc('get_user_profile', [username])\n            .then((result) => {\n                return result.result[0][0] as UserProfile\n            })\n    }\n\n    async updateUserProfile(update: UserProfileUpdate): Promise<void> {\n        // TODO: update user profile cache here...\n        UserProfileClient.profileCache.delete(update.user.username)\n        return this.callFunc('update_user_profile', { profile: update })\n            .then(() => {\n                return\n            })\n    }\n\n    // async setUserProfile(username: string, profile: UserProfile): Promise<void> {\n    //     // TODO: update user profile cache here...\n    //     this.callFunc('update_user_profile', profile)\n    // }\n\n    async getUserProfiles(usernames: Array<string>): Promise<Array<UserProfile>> {\n        return this.callFunc('get_user_profile', usernames)\n            .then((result) => {\n                return result.result[0] as Array<UserProfile>\n            })\n    }\n\n    async getAllUsers(): Promise<Array<User>> {\n        return this.callFunc('filter_users', { filter: '' })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n\n    async searchUsers(query: string): Promise<Array<User>> {\n        return this.callFunc('filter_users', { filter: query })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n}","import { UserProfileClient, UserProfile } from '../apis/userProfile'\n\n\nexport type Username = string\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\n\nfunction profileToUser(profile: UserProfile): User {\n    let jobTitle\n    if (!profile.profile.userdata) {\n        return {\n            username: profile.user.username,\n            realname: profile.user.realname,\n            city: null,\n            state: null,\n            country: null,\n            title: null,\n            organization: null,\n            avatarOption: null,\n            gravatarHash: null,\n            gravatarDefault: null\n        }\n    }\n    if (profile.profile.userdata.jobTitle === 'Other') {\n        jobTitle = profile.profile.userdata.jobTitleOther\n    } else {\n        jobTitle = profile.profile.userdata.jobTitle\n    }\n\n    return {\n        username: profile.user.username,\n        realname: profile.user.realname,\n        city: profile.profile.userdata.city,\n        state: profile.profile.userdata.state,\n        country: profile.profile.userdata.country,\n        title: jobTitle,\n        organization: profile.profile.userdata.organization,\n        avatarOption: profile.profile.userdata.avatarOption,\n        gravatarHash: profile.profile.synced.gravatarHash,\n        gravatarDefault: profile.profile.userdata.gravatarDefault\n    }\n}\n\nexport interface UserQuery {\n    query: string\n    excludedUsers: Array<string>\n}\n\nexport interface BriefUser {\n    username: string\n    realname: string\n}\n\n\n\n\ninterface UserModelParams {\n    userProfileServiceURL: string\n    token: string\n}\n\nexport class UserModel {\n\n    params: UserModelParams\n    userProfileClient: UserProfileClient\n\n    cache: Map<Username, User>\n\n    constructor(params: UserModelParams) {\n        this.params = params\n        this.userProfileClient = new UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n        this.cache = new Map<Username, User>()\n    }\n\n    async getUser(username: Username): Promise<User> {\n        if (this.cache.has(username)) {\n            return this.cache.get(username)!\n        }\n\n        const userProfile = await this.userProfileClient.getUserProfile(username)\n        const user = profileToUser(userProfile)\n        this.cache.set(username, user)\n        return user\n    }\n\n    async getUsers(usernames: Array<Username>): Promise<Map<Username, User>> {\n        const result: Map<Username, User> = new Map()\n\n        const toFetch: Array<Username> = []\n\n        usernames.forEach((username) => {\n            if (this.cache.has(username)) {\n                result.set(username, this.cache.get(username)!)\n            } else {\n                toFetch.push(username)\n            }\n        })\n\n        const userProfiles = await this.userProfileClient.getUserProfiles(toFetch)\n        const users = userProfiles.map((profile) => {\n            return profileToUser(profile)\n        })\n\n        userProfiles.forEach((userProfile) => {\n            const user = profileToUser(userProfile)\n            this.cache.set(user.username, user)\n            result.set(user.username, user)\n        })\n\n        return result\n    }\n\n    async searchUsers(query: UserQuery): Promise<Array<BriefUser>> {\n        const users = await this.userProfileClient.searchUsers(query.query)\n        return users\n            .filter(({ username }) => {\n                return (query.excludedUsers.indexOf(username) === -1)\n            })\n            .map(({ username, realname }) => {\n                return {\n                    username, realname\n                }\n            })\n    }\n\n    // searchUsers(query: UserQuery): Promise<Array<BriefUser>> {\n    //     const userProfileClient = new userProfile.UserProfileClient({\n    //         url: this.params.userProfileServiceURL,\n    //         token: this.params.token\n    //     })\n\n    //     return userProfileClient.searchUsers(query.query)\n    //         .then((users) => {\n    //             return users\n    //                 .filter(({ username }) => {\n    //                     return (query.excludedUsers.indexOf(username) === -1)\n    //                 })\n    //                 .map(({ username, realname }) => {\n    //                     return {\n    //                         username, realname\n    //                     }\n    //                 })\n\n    //         })\n    // }\n\n    // getUser(username: string): Promise<User> {\n    //     const userProfileClient = new userProfile.UserProfileClient({\n    //         url: this.params.userProfileServiceURL,\n    //         token: this.params.token\n    //     })\n\n    //     return userProfileClient.getUserProfile(username)\n    //         .then((userProfile) => {\n    //             return this.profileToUser(userProfile)\n    //         })\n    // }\n}","export interface GenericClientParams {\n    url: string\n    module: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport interface ErrorResult {\n    name: string\n    code: number\n    message: string\n    error: string\n}\n\nexport type JSONRPCResponse = [any, ErrorResult | null]\n\nexport class GenericClient {\n    url: string;\n    token: string | null\n    module: string\n\n    constructor({ url, token, module }: GenericClientParams) {\n        this.url = url\n        this.token = token || null\n        this.module = module\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: param\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n    async processResponse(response: Response): Promise<JSONRPCResponse> {\n        if (response.status === 200) {\n            const { result, error } = await response.json()\n            if (result) {\n                return [result, null]\n            } else {\n                return [null, error]\n            }\n\n        } else if (response.status === 204) {\n            return [null, null]\n        }\n        if (response.status === 500) {\n            if (response.headers.get('Content-Type') === 'application/json') {\n                const { error } = await response.json()\n                return [null, error]\n            } else {\n                const text = await response.text()\n                return [null, {\n                    code: 0,\n                    name: 'Internal Server Error (for real)',\n                    message: 'The service experienced an internal error',\n                    error: text\n                }]\n            }\n        }\n        throw new Error('Unexpected response: ' + response.status + ', ' + response.statusText)\n    }\n\n    async callFunc(func: string, param: any): Promise<JSONRPCResponse> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                return this.processResponse(response)\n            })\n    }\n}\n\nexport class AuthorizedGenericClient extends GenericClient {\n    token: string;\n\n    constructor(params: GenericClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    async callFunc(func: string, param: any): Promise<JSONRPCResponse> {\n        const response = await fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n        return this.processResponse(response)\n    }\n}\n\n","import { AuthorizedServiceClient, ServiceClientParams } from './serviceClient'\n\n// types from module\n\nexport interface Service {\n    module_name: string\n    version: string | null\n}\n\nexport interface ServiceStatus {\n    module_name: string\n    version: string\n    git_commit_hash: string\n    release_tags: Array<string>\n    hash: string\n    url: string\n    up: number // aka boolean\n    status: string\n    health: string\n}\n\n// impl\n\nexport interface ServiceWizardClientParams extends ServiceClientParams {\n\n}\n\nexport interface GetServiceStatusParams extends Service { }\n\nexport interface GetServiceStatusResult extends ServiceStatus { }\n\nexport class ServiceWizardClient extends AuthorizedServiceClient {\n\n    static module: string = 'ServiceWizard'\n\n    constructor(params: ServiceWizardClientParams) {\n        super(params)\n    }\n\n\n    getServiceStatus(params: GetServiceStatusParams): Promise<GetServiceStatusResult> {\n        return this.callFunc('get_service_status', params)\n            .then((result) => {\n                if (result.result &&\n                    result.result.length > 0) {\n                    const theResult = result.result[0]\n                    if (!theResult) {\n                        throw new Error('Crazy at it seems, no result')\n                    }\n                    return theResult as GetServiceStatusResult\n                } else {\n                    throw new Error('Crazy at it seems, no result')\n                }\n            })\n    }\n\n}","import Bluebird from 'bluebird'\nimport { AuthorizedServiceClient } from './serviceClient'\n\nimport { ServiceWizardClient } from './serviceWizard'\nimport { GenericClient, AuthorizedGenericClient } from './genericClient'\n// now import the service wizard, and one auth generic client\n\n// type Promise<T> = Bluebird<T>\n\nexport interface CacheParams {\n    itemLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n}\n\nexport interface CacheItem<T> {\n    id: string\n    value: T | null\n    createdAt: number\n    fetcher: () => Bluebird<T>\n    reserved: boolean\n}\n\nexport class Cache<T> {\n\n    cache: Map<string, CacheItem<T>>\n    cacheLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n    isMonitoring: boolean\n\n    constructor({ itemLifetime, monitoringFrequency, waiterTimeout, waiterFrequency }: CacheParams) {\n        this.cache = new Map<string, CacheItem<T>>()\n\n        // 10 minute cache lifetime\n        this.cacheLifetime = itemLifetime || 1800000;\n\n        // Frequency with which to monitor the cache for expired items\n        // or refreshing them.\n        this.monitoringFrequency = monitoringFrequency || 60000;\n\n        // The waiter waits for a cache item to become available if it has\n        // been reserved. These settings determine how long to wait\n        // for a waiter to wait, and how often to check the cache item to see if it has\n        // yet been fulfilled.\n        this.waiterTimeout = waiterTimeout || 30000;\n        this.waiterFrequency = waiterFrequency || 100;\n\n        this.isMonitoring = false;\n    }\n\n    runMonitor() {\n        if (this.isMonitoring) {\n            return;\n        }\n        this.isMonitoring = true;\n        window.setTimeout(() => {\n            const newCache = new Map<string, any>();\n            let cacheRenewed = false;\n            Object.keys(this.cache).forEach((id) => {\n                const item = this.cache.get(id);\n                if (!this.isExpired(item)) {\n                    newCache.set(id, item)\n                    cacheRenewed = true\n                }\n            });\n            this.cache = newCache\n            this.isMonitoring = false\n            if (cacheRenewed) {\n                this.runMonitor()\n            }\n        }, this.monitoringFrequency)\n    }\n\n    isExpired(cacheItem: any) {\n        const now = new Date().getTime();\n        const elapsed = now - cacheItem.createdAt;\n        return (elapsed > this.cacheLifetime);\n    }\n\n    isReserved(cacheItem: any) {\n        return cacheItem.reserved;\n    }\n\n    getItem(id: string) {\n        if (this.cache.get(id) === undefined) {\n            return null\n        }\n        const cached = this.cache.get(id)\n        if (this.isExpired(cached)) {\n            this.cache.delete(id)\n            return;\n        }\n        return cached;\n    }\n\n    reserveWaiter(item: CacheItem<T>): Bluebird<CacheItem<T>> {\n        return new Bluebird<CacheItem<T>>((resolve, reject) => {\n            const started = new Date().getTime();\n            const waiting = true;\n\n            const waiter = () => {\n                if (!waiting) {\n                    return;\n                }\n                window.setTimeout(() => {\n                    if (this.cache.has(item.id)) {\n                        // If on a wait-loop cycle we discover that the\n                        // cache item has been deleted, we volunteer\n                        // to attempt to fetch it ourselves.\n                        // The only case now for this is a cancellation\n                        // of the first request to any dynamic service,\n                        // which may cancel the initial service wizard\n                        // call rather than the service call.\n                        return this.reserveAndFetch({\n                            id: item.id,\n                            fetcher: item.fetcher\n                        })\n                            .then(() => {\n                                // resolve(result);\n                                // we resolve with the cache item just\n                                // as if we had waited for it.\n                                resolve(this.cache.get(item.id))\n                            })\n                            .catch((err: Error) => {\n                                reject(err);\n                            });\n                    }\n                    if (!item.reserved) {\n                        resolve(item);\n                    } else {\n                        const elapsed = new Date().getTime() - started;\n                        if (elapsed > this.waiterTimeout) {\n                            this.cache.delete(item.id)\n                            reject(new Error(\n                                'Timed-out waiting for cache item to become available; timeout '\n                                + this.waiterTimeout + ', waited ' + elapsed));\n                        } else {\n                            waiter();\n                        }\n                    }\n                }, this.waiterFrequency);\n            };\n            waiter();\n        });\n    }\n\n    reserveAndFetch({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        // now, reserve it.\n        this.reserveItem(id, fetcher)\n\n        // and then fetch it.\n        const fetchPromise = fetcher()\n            .then((result: any) => {\n                this.setItem(id, result, fetcher)\n                return result\n            })\n            .finally(() => {\n                // If the fetch was cancelled, we need to remove\n                // the reserved item. This should signal any queued waiters\n                // to spawn their own fetch.\n                if (fetchPromise.isCancelled()) {\n                    this.cache.get(id)\n                }\n            });\n        return fetchPromise;\n    }\n\n    getItemWithWait({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        const cached = this.cache.get(id)\n        if (cached) {\n            if (this.isExpired(cached)) {\n                this.cache.delete(id)\n            } else if (this.isReserved(cached)) {\n                return this.reserveWaiter(cached)\n                    .then((cached) => {\n                        return cached.value;\n                    });\n            } else {\n                return Bluebird.resolve(cached.value)\n            }\n        }\n\n        return this.reserveAndFetch({ id, fetcher });\n    }\n\n    reserveItem(id: string, fetcher: () => Bluebird<T>) {\n        this.cache.set(id, {\n            id: id,\n            createdAt: new Date().getTime(),\n            reserved: true,\n            value: null,\n            fetcher: fetcher\n        });\n    }\n\n    setItem(id: string, value: T, fetcher: () => Bluebird<T>) {\n        if (this.cache.has(id)) {\n            const item = this.cache.get(id)\n            if (item && item.reserved) {\n                item.reserved = false\n                item.value = value\n                item.fetcher = fetcher\n            } else {\n                // overwriting? should we allow this?\n                this.cache.set(id, {\n                    id: id,\n                    createdAt: new Date().getTime(),\n                    fetcher: fetcher,\n                    reserved: false,\n                    value: value\n                })\n            }\n        } else {\n            this.cache.set(id, {\n                id: id,\n                createdAt: new Date().getTime(),\n                fetcher: fetcher,\n                reserved: false,\n                value: value\n            })\n        }\n        this.runMonitor();\n    }\n}\nvar moduleCache = new Cache<any>({\n    itemLifetime: 1800000,\n    monitoringFrequency: 60000,\n    waiterTimeout: 30000,\n    waiterFrequency: 100\n})\n\n\n/*\n * arg is:\n * url - service wizard url\n * timeout - request timeout\n * version - service release version or tag\n * auth - auth structure\n *   token - auth token\n *   username - username\n * rpcContext\n */\n\nexport interface DynamicServiceClientParams {\n    token: string\n    url: string\n    version?: string\n    timeout?: number\n    rpcContext?: any\n}\n\nexport class DynamicServiceClient {\n    token: string\n    timeout: number\n    rpcContext: any\n    url: string\n    version: string | null\n\n    static module: string\n\n    constructor({ token, url, version, timeout, rpcContext }: DynamicServiceClientParams) {\n        // Establish an auth object which has properties token and user_id.\n        this.token = token;\n        this.timeout = timeout || 10000;\n        this.rpcContext = rpcContext || null;\n\n        if (!url) {\n            throw new Error('The service discovery url was not provided');\n        }\n        this.url = url;\n\n        this.version = version || null;\n        if (version === 'auto') {\n            this.version = null;\n        }\n    }\n\n    options() {\n        return {\n            timeout: this.timeout,\n            authorization: this.token,\n            rpcContext: this.rpcContext\n        };\n    }\n\n    getModule() {\n        return (<typeof DynamicServiceClient>this.constructor).module\n    }\n\n    moduleId() {\n        let moduleId;\n        if (!this.version) {\n            moduleId = this.getModule() + ':auto';\n        } else {\n            moduleId = this.getModule() + ':' + this.version;\n        }\n        return moduleId;\n    }\n\n    getCached(fetcher: () => Bluebird<any>) {\n        return moduleCache.getItemWithWait({\n            id: this.moduleId(),\n            fetcher: fetcher\n        });\n    }\n\n    // setCached(value: any) {\n    //     moduleCache.setItem(this.moduleId(), value);\n    // }\n\n    lookupModule() {\n        return this.getCached((): Bluebird<any> => {\n            const func = 'get_service_status';\n            const params = [{\n                module_name: this.getModule(),\n                version: this.version\n            }];\n            // NB: pass null for numRets (number of return values) so we get the\n            // full return structure.\n            const client = new ServiceWizardClient({\n                url: this.url,\n                token: this.token\n            })\n\n            return Bluebird.resolve(\n                client.getServiceStatus({\n                    module_name: this.getModule(),\n                    version: this.version\n                })\n            )\n        })\n    }\n\n    callFunc(funcName: string, params: any) {\n        return this.lookupModule()\n            .then((serviceStatus) => {\n                const client = new AuthorizedGenericClient({\n                    module: serviceStatus.module_name,\n                    url: serviceStatus.url,\n                    token: this.token\n                })\n                return Bluebird.resolve(\n                    client.callFunc(funcName, params)\n                )\n            })\n            .catch((err) => {\n                console.error('ERROR: ' + err.name + \" = \" + err.message, err)\n                throw err\n            })\n    }\n}\n","// import { AuthorizedServiceClient, ServiceClientParams, JSONPayload } from './serviceClient'\n\nimport { DynamicServiceClient, DynamicServiceClientParams } from './dynamicServiceClient'\n\nimport { RawObjectInfo, RawWorkspaceInfo, WorkspaceInfo, ObjectInfo, workspaceInfoToObject, objectInfoToObject } from './workspaceUtils'\n\nexport interface NarrativeServiceClientParams extends DynamicServiceClientParams {\n\n}\n\nexport interface ListNarrativesParams {\n    type: string\n}\n\ntype Metadata = {}\n\n/* Information about an object, including user provided metadata.\n\n       obj_id objid - the numerical id of the object.\n       obj_name name - the name of the object.\n       type_string type - the type of the object.\n       timestamp save_date - the save date of the object.\n       obj_ver ver - the version of the object.\n       username saved_by - the user that saved or copied the object.\n       ws_id wsid - the workspace containing the object.\n       ws_name workspace - the workspace containing the object.\n       string chsum - the md5 checksum of the object.\n       int size - the size of the object in bytes.\n       usermeta meta - arbitrary user-supplied metadata about\n           the object.\n   */\n\n\n\n\nexport interface ListNarrativesResponseResult {\n    narratives: Array<{\n        ws: RawWorkspaceInfo\n        nar: RawObjectInfo\n    }>\n}\n\nexport interface ServiceResponse<T> {\n    id: string\n    version: string\n    result?: [T] | null\n    error?: any\n}\n\n\n\n// export type ListNarrativesResponse = ServiceResponse<ListNarrativesResponseResult>\n\n\n\nexport class NarrativeServiceClient extends DynamicServiceClient {\n\n    static module: string = 'NarrativeService'\n\n    constructor(params: NarrativeServiceClientParams) {\n        super(params)\n    }\n\n\n    async listNarratives(type: string): Promise<ListNarrativesResponseResult> {\n        // note usage of unknown below -- Bluebird and native Promise!\n        const [result, error] = await this.callFunc('list_narratives', [{\n            type: type\n        }])\n        // as Promise<ServiceResponse<ListNarrativesResponseResult>>\n\n        // should check id and version, or should call func do that?\n        if (result && result[0]) {\n            return result[0]\n            // return result[0].narratives.map((nar) => {\n            //     return {\n            //         workspaceInfo: workspaceInfoToObject(nar.ws),\n            //         objectInfo: objectInfoToObject(nar.nar)\n            //     }\n            // })\n        } else {\n            // TODO: handle error\n            // console.error('Result is missing', id, version, result, error)\n            throw new Error('Result is missing!')\n        }\n    }\n\n}","import { AuthorizedGenericClient } from '../apis/genericClient'\nimport { NarrativeServiceClient } from '../apis/narrativeService'\nimport * as orgModel from './organization/model'\nimport * as requestModel from './requests'\nimport * as workspaceApi from '../apis/workspaceUtils'\nimport * as userModel from './user'\n\nexport enum NarrativeState {\n    NONE = 0,\n    ASSOCIATED,\n    REQUESTED\n}\n\nexport type NarrativeID = number\n\nexport type WorkspaceID = number\nexport type ObjectID = number\n\nexport enum NarrativeAccess {\n    NONE = 0,\n    VIEW,\n    EDIT,\n    ADMIN,\n    OWNER\n}\n\nexport interface NarrativeBase {\n    workspaceId: WorkspaceID,\n    access: NarrativeAccess\n}\n\nexport interface InaccessibleNarrative extends NarrativeBase {\n    access: NarrativeAccess.NONE\n}\n\nexport interface AccessibleNarrative extends NarrativeBase {\n    access: NarrativeAccess.VIEW | NarrativeAccess.EDIT | NarrativeAccess.ADMIN | NarrativeAccess.OWNER\n    isPublic: boolean\n    objectId: ObjectID\n    title: string\n    // description?: string\n    owner: userModel.Username\n    // creator: userModel.Username\n    // createdAt: Date\n    lastSavedAt: Date\n    lastSavedBy: userModel.Username\n}\n\nexport type Narrative = AccessibleNarrative | InaccessibleNarrative\n\n// export interface OrganizationNarrativex {\n//     workspaceId: WorkspaceID\n//     objectId: ObjectID\n//     title: string\n//     status: NarrativeState\n//     // inOrganization: boolean\n//     // createdAt: Date\n//     owner: userModel.Username\n//     modifiedAt: Date\n// }\n\nexport interface OrganizationNarrative {\n    status: NarrativeState\n    narrative: AccessibleNarrative\n}\n\nexport interface NarrativeWorkspaceInfo extends workspaceApi.WorkspaceInfo {\n    metadata: {\n        narrative_nice_name: string\n        narrative: string\n        is_temporary: string\n    }\n}\n// export interface GetOwnNarrativesResult {\n//     workspaceInfo: WorkspaceInfo\n//     objectInfo: ObjectInfo\n// }\n\nexport enum Sort {\n    TITLE = 'TITLE',\n    LAST_SAVED = 'LAST_SAVED'\n}\n\ninterface NarrativeModelParams {\n    workspaceServiceURL: string\n    serviceWizardURL: string\n    groupsServiceURL: string\n    username: string\n    token: string\n}\n\nexport class NarrativeModel {\n\n    params: NarrativeModelParams\n\n    constructor(params: NarrativeModelParams) {\n        this.params = params\n    }\n\n    // Narratives\n\n    async getOwnNarratives(organizationId: string): Promise<Array<OrganizationNarrative>> {\n        const narrativeServiceClient = new NarrativeServiceClient({\n            url: this.params.serviceWizardURL,\n            token: this.params.token,\n            timeout: 10000,\n        })\n\n        const groupsClient = new orgModel.OrganizationModel({\n            token: this.params.token,\n            username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n\n        const requestClient = new requestModel.RequestsModel({\n            token: this.params.token,\n            username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const [narrativesResult, organization, pendingRequests] = await Promise.all([\n            narrativeServiceClient.listNarratives('mine'),\n            groupsClient.getOrg(organizationId),\n            requestClient.getPendingRequestsForOrg(organizationId)\n        ])\n\n        if (organization.kind === orgModel.OrganizationKind.INACCESSIBLE_PRIVATE) {\n            throw new Error('Cannot get own narratives for private inaccessible organization')\n        }\n\n        const workspacesInOrg = organization.narratives.map((narrative) => {\n            return narrative.workspaceId\n        })\n\n        return narrativesResult.narratives\n            .map((nar) => {\n                return {\n                    workspaceInfo: <unknown>workspaceApi.workspaceInfoToObject(nar.ws) as NarrativeWorkspaceInfo,\n                    objectInfo: workspaceApi.objectInfoToObject(nar.nar)\n                }\n            })\n            .filter((nar) => {\n                return (nar.workspaceInfo.metadata.is_temporary === 'false')\n            })\n            .map((narrative) => {\n                let status: NarrativeState\n\n                if (workspacesInOrg.indexOf(narrative.workspaceInfo.id) !== -1) {\n                    status = NarrativeState.ASSOCIATED\n                } else if (pendingRequests.find((request) => {\n                    // TODO: these requests should have already been converted to \n                    // model-friendly requests (typed!)\n                    return (request.resourceType === requestModel.RequestResourceType.WORKSPACE &&\n                        request.narrativeId === String(narrative.workspaceInfo.id))\n                })) {\n                    status = NarrativeState.REQUESTED\n                } else {\n                    status = NarrativeState.NONE\n                }\n                return {\n                    status: status,\n                    narrative: {\n                        access: NarrativeAccess.OWNER,\n                        isPublic: narrative.workspaceInfo.globalReadPermission,\n                        workspaceId: narrative.workspaceInfo.id,\n                        objectId: narrative.objectInfo.id,\n                        title: narrative.workspaceInfo.metadata.narrative_nice_name,\n                        owner: narrative.workspaceInfo.owner,\n                        lastSavedAt: narrative.objectInfo.savedAt,\n                        lastSavedBy: narrative.objectInfo.savedBy\n                    } as AccessibleNarrative\n\n                }\n            })\n            .sort((a, b) => {\n                return (a.narrative.title.localeCompare(b.narrative.title))\n            })\n    }\n\n    // async workspaceToNarrative(workspaceId: WorkspaceID): Promise<orgModel.NarrativeResource | null> {\n    //     const workspaceClient = new AuthorizedGenericClient({\n    //         module: 'Workspace',\n    //         url: this.params.workspaceServiceURL,\n    //         token: this.params.token\n    //     })\n    //     try {\n    //         const [[[rawObjectInfo], rawObjectInfoError], [[rawWorkspaceInfo], rawWorkspaceInfoError]] = await Promise.all([\n    //             workspaceClient.callFunc('get_object_info3', [{\n    //                 objects: [{\n    //                     wsid: workspaceId,\n    //                     // TODO: fix this!!\n    //                     objid: 1\n    //                 }],\n    //                 includeMetadata: 1,\n    //                 ignoreErrors: 0\n    //             }]),\n    //             workspaceClient.callFunc('get_workspace_info', [{\n    //                 id: workspaceId\n    //             }])\n    //         ])\n\n    //         if (rawObjectInfoError || rawWorkspaceInfoError) {\n    //             // console.warn('narrative not accessible', rawObjectInfoError, rawWorkspaceInfoError)\n    //             return null\n    //         }\n\n    //         const workspaceInfo: NarrativeWorkspaceInfo = workspaceApi.workspaceInfoToObject(rawWorkspaceInfo) as NarrativeWorkspaceInfo\n\n    //         return {\n    //             workspaceId: workspaceInfo.id,\n    //             title: workspaceInfo.metadata.narrative_nice_name || 'Unknown',\n    //             permission: orgModel.userPermissionToWorkspacePermission(workspaceInfo.userPermission, workspaceInfo.owner === this.params.username),\n    //             isPublic: workspaceInfo.globalReadPermission\n    //         }\n\n    //     } catch (ex) {\n    //         // assume it is an inaccessible workspace\n    //         // console.warn('narrative not accessible', ex)\n    //         return null\n    //     }\n    // }\n\n    getSorter(sort: Sort) {\n        switch (sort) {\n            case Sort.TITLE:\n                return (a: OrganizationNarrative, b: OrganizationNarrative) => {\n                    return a.narrative.title.localeCompare(b.narrative.title)\n                }\n            case Sort.LAST_SAVED:\n                return (a: OrganizationNarrative, b: OrganizationNarrative) => {\n                    return b.narrative.lastSavedAt.getTime() - a.narrative.lastSavedAt.getTime()\n                }\n            default:\n                throw new Error('invalid sort spec')\n        }\n    }\n\n    // sortNarratives(narratives: Array<AccessibleNarrative>, sort: Sort): Array<AccessibleNarrative> {\n    //     let sorter = this.getSorter(sort)\n\n    //     return narratives.sort(sorter)\n    // }\n\n    sortOrganizationNarratives(narratives: Array<OrganizationNarrative>, sort: Sort): Array<OrganizationNarrative> {\n        let sorter = this.getSorter(sort)\n\n        return narratives.sort(sorter).slice(0)\n    }\n\n    /*\n    getNarrative fetches the requested narrative and returns a Narrative object if found \n    and null otherwise. Note that this ignores the narrative state vis-a-vis any organization.\n    It also caches narratives.\n    */\n    async getNarrative(workspaceId: WorkspaceID): Promise<Narrative> {\n        const workspaceClient = new AuthorizedGenericClient({\n            module: 'Workspace',\n            url: this.params.workspaceServiceURL,\n            token: this.params.token\n        })\n        try {\n            const [rawWorkspaceInfo, rawWorkspaceInfoError] = await workspaceClient.callFunc('get_workspace_info', [{\n                id: workspaceId\n            }])\n\n\n            if (rawWorkspaceInfoError) {\n                return {\n                    workspaceId: workspaceId,\n                    access: NarrativeAccess.NONE\n                }\n            }\n\n            const workspaceInfo: NarrativeWorkspaceInfo = workspaceApi.workspaceInfoToObject(rawWorkspaceInfo[0]) as NarrativeWorkspaceInfo\n\n            const narrativeId = workspaceInfo.metadata.narrative\n            if (!narrativeId) {\n                return {\n                    workspaceId: workspaceId,\n                    access: NarrativeAccess.NONE\n                }\n            }\n            const objectId = parseInt(narrativeId, 10)\n\n            const [rawObjectInfo, rawObjectInfoError] = await workspaceClient.callFunc('get_object_info3', [{\n                objects: [{\n                    wsid: workspaceId,\n                    objid: objectId\n                }],\n                includeMetadata: 1,\n                ignoreErrors: 0\n            }])\n\n            if (rawObjectInfoError) {\n                return {\n                    workspaceId: workspaceId,\n                    access: NarrativeAccess.NONE\n                }\n            }\n\n            const objectInfo: workspaceApi.ObjectInfo = workspaceApi.objectInfoToObject(rawObjectInfo[0].infos[0])\n\n            let access: NarrativeAccess.VIEW | NarrativeAccess.EDIT | NarrativeAccess.ADMIN | NarrativeAccess.OWNER\n            switch (workspaceInfo.userPermission) {\n                case 'n':\n                    if (workspaceInfo.globalReadPermission) {\n                        access = NarrativeAccess.VIEW\n                        break\n                    } else {\n                        throw new Error('Cannot have no access and no global read permission!')\n                    }\n                case 'r':\n                    access = NarrativeAccess.VIEW\n                    break\n                case 'w':\n                    access = NarrativeAccess.EDIT\n                    break\n                case 'a':\n                    if (workspaceInfo.owner === this.params.username) {\n                        access = NarrativeAccess.OWNER\n                    } else {\n                        access = NarrativeAccess.ADMIN\n                    }\n                    break\n                default:\n                    throw new Error('Unknown workspace permission: ' + workspaceInfo.userPermission)\n            }\n\n            return {\n                workspaceId: workspaceInfo.id,\n                access: access,\n                isPublic: workspaceInfo.globalReadPermission,\n                objectId: objectInfo.id,\n                title: workspaceInfo.metadata.narrative_nice_name || 'Unknown',\n                owner: workspaceInfo.owner,\n                lastSavedAt: objectInfo.savedAt,\n                lastSavedBy: objectInfo.savedBy\n            }\n        } catch (ex) {\n            console.error('Error fetching narrative!', ex)\n            throw ex\n        }\n    }\n}\n","export type Metadata = {}\n\nexport type RawObjectInfo = [\n    number, // objid - object id\n    string, // name - object name\n    string, // type - object type\n    string, // save_date - iso8601 timestamp when last saved\n    number, // ver - object version\n    string, // saved_by - username who saved it last\n    number, // wsid - workspace id\n    string, // workspace - workspace name,\n    string, // chsum - checksum of the object\n    number, // size - size of the object (bytes)\n    Metadata   // meta - string to string object of stuff\n]\n\nexport type RawWorkspaceInfo = [\n    number, // id - workspace id\n    string, // workspace - workspace name\n    string, // owner - username who owns it\n    string, // moddate - iso8601 timestamp when last modified\n    number, // max_objid - last object id assigned to object in workspace\n    string, // user_permission - permission of user who made reqeust wrt workspace\n    string, // globalread - int bool whether this workspace is shared globally\n    string, // lockstat - status of the workspace lock\n    Metadata // metadata\n]\n\nexport interface WorkspaceInfo {\n    id: number\n    name: string\n    owner: string\n    modifiedAt: Date\n    objectCount: number\n    userPermission: string\n    globalReadPermission: boolean\n    lockStatus: string\n    metadata: Metadata\n}\n\nexport interface ObjectInfo {\n    id: number\n    name: string\n    type: {\n        module: string\n        name: string\n        majorVersion: number\n        minorVersion: number\n        id: string\n    }\n    version: number\n    savedAt: Date\n    savedBy: string\n    workspaceId: number\n    workspaceName: string\n    checksum: string\n    size: number\n    ref: string\n    metadata: Metadata\n}\n\nfunction iso8601ToDate(dateString: string) {\n    const isoRE = /(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)T(\\d\\d):(\\d\\d):(\\d\\d)([\\+\\-])(\\d\\d)(:?[\\:]*)(\\d\\d)/;\n    const dateParts = isoRE.exec(dateString);\n    if (!dateParts) {\n        throw new TypeError('Invalid Date Format for ' + dateString);\n    }\n    // This is why we do this -- JS insists on the colon in the tz offset.\n    const offset = dateParts[7] + dateParts[8] + ':' + dateParts[10];\n    const newDateString = dateParts[1] + '-' + dateParts[2] + '-' + dateParts[3] + 'T' + dateParts[4] + ':' + dateParts[5] + ':' + dateParts[6] + offset;\n    return new Date(newDateString);\n}\n\nexport function workspaceInfoToObject(wsInfo: RawWorkspaceInfo): WorkspaceInfo {\n    return {\n        id: wsInfo[0],\n        name: wsInfo[1],\n        owner: wsInfo[2],\n        modifiedAt: iso8601ToDate(wsInfo[3]),\n        objectCount: wsInfo[4],\n        userPermission: wsInfo[5],\n        globalReadPermission: wsInfo[6] === 'r' ? true : false,\n        lockStatus: wsInfo[7],\n        metadata: wsInfo[8]\n    }\n}\n\nexport function objectInfoToObject(data: RawObjectInfo): ObjectInfo {\n    const type = data[2].split(/[-.]/)\n\n    return {\n        id: data[0],\n        name: data[1],\n        // type: data[2],\n        type: {\n            id: data[2],\n            module: type[0],\n            name: type[1],\n            majorVersion: parseInt(type[2], 10),\n            minorVersion: parseInt(type[3], 10)\n        },\n        savedAt: iso8601ToDate(data[3]),\n        version: data[4],\n        savedBy: data[5],\n        workspaceId: data[6],\n        workspaceName: data[7],\n        checksum: data[8],\n        size: data[9],\n        metadata: data[10],\n        ref: data[6] + '/' + data[0] + '/' + data[4]\n    }\n}\n\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as userModel from '../../data/models/user'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as narrativeModel from '../../data/models/narrative'\nimport { AppError, StoreState } from '../../types'\n\nexport interface EntityAction extends Action {\n\n}\n\nexport interface UserLoader extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER,\n    userId: userModel.Username\n}\n\nexport interface UserLoaderStart extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_START\n}\n\nexport interface UserLoaderSuccess extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_SUCCESS,\n    user: userModel.User\n}\n\nexport interface UserLoaderError extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_ERROR,\n    error: AppError\n}\n\n\nexport function userLoaderStart(): UserLoaderStart {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_START\n    }\n}\n\nexport function userLoaderSuccess(user: userModel.User): UserLoaderSuccess {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_SUCCESS,\n        user: user\n    }\n}\n\nexport function userLoaderError(error: AppError): UserLoaderError {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_ERROR,\n        error: error\n    }\n}\n\nexport function userLoader(userId: userModel.Username) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(userLoaderStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const model = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        try {\n            const user = await model.getUser(userId)\n            dispatch(userLoaderSuccess(user))\n        } catch (ex) {\n            dispatch(userLoaderError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n    }\n}\n\n\nexport interface OrganizationLoader extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface OrganizationLoaderStart extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_START\n}\n\nexport interface OrganizationLoaderSuccess extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS,\n    organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization\n}\n\nexport interface OrganizationLoaderError extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_ERROR,\n    error: AppError\n}\n\n\nexport function organizationLoaderStart(): OrganizationLoaderStart {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_START\n    }\n}\n\nexport function organizationLoaderSuccess(organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization): OrganizationLoaderSuccess {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function organizationLoaderError(error: AppError): OrganizationLoaderError {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_ERROR,\n        error: error\n    }\n}\n\nexport function organizationLoader(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(organizationLoaderStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const model = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const organization = await model.getOrg(organizationId)\n            dispatch(organizationLoaderSuccess(organization))\n        } catch (ex) {\n            dispatch(organizationLoaderError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Narratives\n\nexport interface LoadNarrative {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD\n}\n\ninterface LoadNarrativeStart {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_START\n}\n\nexport interface LoadNarrativeSuccess {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS\n    narrative: narrativeModel.Narrative\n}\n\ninterface LoadNarrativeError {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_ERROR\n    error: AppError\n}\n\nexport function loadNarrative(workspaceId: narrativeModel.WorkspaceID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.ENTITY_NARRATIVE_LOAD_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            workspaceServiceURL: config.services.Workspace.url,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        try {\n            const narrative = await narrativeClient.getNarrative(workspaceId)\n            dispatch({\n                type: ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS,\n                narrative: narrative\n            })\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.ENTITY_NARRATIVE_LOAD_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n    }\n}\n\n// Access narrative\n\nexport interface AccessNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface AccessNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n}\n\nexport interface AccessNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface AccessNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\nexport function accessNarrativeStart(): AccessNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n    }\n}\n\nexport function accessNarrativeSuccess(organization: orgModel.Organization): AccessNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function accessNarrativeError(error: AppError): AccessNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function accessNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(accessNarrativeStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'No view model'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: {\n                        organization\n                    }\n                }\n            }\n        } = state\n\n        if (!organization) {\n            return\n        }\n\n        const groupId = organization.id\n        const resourceId = String(narrative.workspaceId)\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.grantNarrativeAccess(groupId, resourceId)\n            const org = await orgClient.getOrg(groupId)\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(accessNarrativeError({\n                    code: 'invalid state',\n                    message: 'Cannot access a Narrative for an inaccessible Organization'\n                }))\n                return\n            }\n            dispatch(accessNarrativeSuccess(org))\n        } catch (ex) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n\n","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport Owner from './Owner'\n\ninterface LoaderProps {\n    username: orgModel.Username\n    user: userModel.User | undefined\n    avatarSize: number\n    showAvatar: boolean\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <Owner user={this.props.user} avatarSize={this.props.avatarSize} showAvatar={this.props.showAvatar} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.username)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\nimport * as orgModel from '../../data/models/organization/model'\n\n\nexport interface OwnProps {\n    username: orgModel.Username\n    avatarSize: number\n    showAvatar: boolean\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.username)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","export function niceElapsed(someDate: Date, absoluteAfter?: number, compactDate: boolean = true) {\n    const nowDate = new Date()\n\n    const elapsed = Math.round((nowDate.getTime() - someDate.getTime()) / 1000);\n    const elapsedAbs = Math.abs(elapsed);\n\n    let measure, measureAbs, unit;\n    const maxDays = absoluteAfter || 90\n    if (elapsedAbs < 60 * 60 * 24 * maxDays) {\n        if (elapsedAbs === 0) {\n            return 'now';\n        } else if (elapsedAbs < 60) {\n            measure = elapsed;\n            measureAbs = elapsedAbs;\n            unit = 'second';\n        } else if (elapsedAbs < 60 * 60) {\n            measure = Math.round(elapsed / 60);\n            measureAbs = Math.round(elapsedAbs / 60);\n            unit = 'minute';\n        } else if (elapsedAbs < 60 * 60 * 24) {\n            measure = Math.round(elapsed / 3600);\n            measureAbs = Math.round(elapsedAbs / 3600);\n            unit = 'hour';\n        } else {\n            measure = Math.round(elapsed / (3600 * 24));\n            measureAbs = Math.round(elapsedAbs / (3600 * 24));\n            unit = 'day';\n        }\n\n        if (measureAbs > 1) {\n            unit += 's';\n        }\n\n        let prefix = null;\n        let suffix = null;\n        if (measure < 0) {\n            prefix = 'in';\n        } else if (measure > 0) {\n            suffix = 'ago';\n        }\n\n        return (prefix ? prefix + ' ' : '') + measureAbs + ' ' + unit + (suffix ? ' ' + suffix : '');\n    } else {\n        // otherwise show the actual date, with or without the year.\n        if (compactDate && nowDate.getFullYear() === someDate.getFullYear()) {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric'\n            }).format(someDate)\n        } else {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric',\n                year: 'numeric'\n            }).format(someDate)\n        }\n    }\n}","import * as React from 'react'\nimport { niceElapsed } from '../lib/time'\nimport { Tooltip } from 'antd';\n\nexport interface NiceElapsedTimeProps {\n    time: Date\n    showTooltip?: boolean\n}\n\ninterface NiceElapsedTimeState {\n}\n\nexport default class NiceElapsedTime extends React.Component<NiceElapsedTimeProps, NiceElapsedTimeState> {\n    constructor(props: NiceElapsedTimeProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.showTooltip !== false) {\n            const tooltip = (\n                <span>\n                    {\n                        Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric',\n                            hour: 'numeric',\n                            minute: 'numeric',\n                            timeZoneName: 'short'\n                        }).format(this.props.time)\n                    }\n                </span>\n            )\n            return (\n                <Tooltip placement=\"bottomRight\" title={tooltip}>\n                    {niceElapsed(this.props.time, 30)}\n                </Tooltip>\n            )\n        } else {\n            return (\n                <span>\n                    {niceElapsed(this.props.time, 30)}\n                </span>\n            )\n        }\n    }\n}","import * as React from 'react'\nimport * as orgModel from '../../../data/models/organization/model'\nimport { NavLink } from 'react-router-dom'\nimport OrgLogo from '../../OrgLogo'\nimport { Icon, Tooltip, Menu, Dropdown, Modal } from 'antd'\nimport Owner from '../../entities/OwnerContainer'\nimport { ComponentView } from '../../../types'\nimport './BriefOrganization.css'\nimport NiceElapsedTime from '../../NiceElapsedTime';\n\nexport interface BriefOrganizationProps {\n    organization: orgModel.BriefOrganization\n    openRequestsStatus: orgModel.RequestStatus | null\n}\n\ninterface BriefOrganizationState {\n    view: ComponentView\n}\n\nfunction reverseView(v: ComponentView) {\n    switch (v) {\n        case ComponentView.COMPACT:\n            return ComponentView.NORMAL\n        case ComponentView.NORMAL:\n            return ComponentView.COMPACT\n    }\n}\n\nexport default class BriefOrganization extends React.Component<BriefOrganizationProps, BriefOrganizationState> {\n    constructor(props: BriefOrganizationProps) {\n        super(props)\n        this.state = {\n            view: ComponentView.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderLogo(org: orgModel.BriefOrganization) {\n        return (\n            <OrgLogo logoUrl={org.logoUrl} size={80} organizationName={org.name} organizationId={org.id} />\n        )\n    }\n\n    renderHomeUrl(org: orgModel.BriefOrganization) {\n        if (!org.homeUrl) {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    title=\"This organization has not set a home page url\"\n                >\n                    <Icon type=\"home\" style={{ color: 'rgba(200, 200, 200, 0.3)' }} />\n                </Tooltip>\n            )\n        }\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Home page for this Organization (external to KBase)\n                </p>\n            </React.Fragment>\n        )\n        return (\n            <div className=\"BriefOrganization-homeUrl\">\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title={tooltip}\n                >\n                    <a href={org.homeUrl} target=\"_blank\">\n                        <Icon type=\"home\" />\n                    </a>\n                </Tooltip>\n            </div >\n        )\n    }\n\n    renderNarrativeCount(org: orgModel.BriefOrganization) {\n        if (!org.narrativeCount) {\n            return (\n                <span style={{ color: 'gray' }}>\n                    Ø\n                </span>\n            )\n        }\n        return (\n            <span>\n                {org.narrativeCount}\n            </span>\n        )\n    }\n\n    renderMemberCount(org: orgModel.BriefOrganization) {\n        if (org.memberCount == 1) {\n            return (\n                <span style={{ color: 'gray' }}>\n                    Ø\n                </span>\n            )\n        }\n        return (\n            <span>\n                {org.memberCount - 1}\n            </span>\n        )\n    }\n\n    renderRelation(org: orgModel.BriefOrganization) {\n        switch (org.relation) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <span>\n                            <Icon type=\"stop\" />\n                        </span>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <Icon type=\"stop\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"Your membership request is pending\"\n                    >\n                        <Icon type=\"user\" style={{ color: 'orange' }} /> Your membership <b>request</b> is pending\n                </Tooltip>\n                )\n\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You have been invited to join this organization\"\n                    >\n                        <Icon type=\"user\" style={{ color: 'blue' }} />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are a member of this organization\"\n                    >\n                        <Icon type=\"user\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are an administrator of this organization\"\n                    >\n                        <Icon type=\"robot\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are the owner of this organization\"\n                    >\n                        <Icon type=\"crown\" />\n                    </Tooltip>\n                )\n        }\n    }\n\n    renderPrivacy() {\n        const org = this.props.organization\n        if (org.private) {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title=\"This organization is private - may only be viewed by members\">\n                    <span>\n                        <Icon type=\"unlock\" />\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title=\"This organization is public - may be viewed by any KBase user\">\n                    <span>\n                        <Icon type=\"global\" />\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderOrgFreshness(org: orgModel.BriefOrganization) {\n        const isNew = org.lastVisitedAt && (org.modifiedAt.getTime() > org.lastVisitedAt.getTime())\n        let newAlert\n        if (isNew) {\n            const title = 'This org has changed since your last visit to it'\n            newAlert = (\n                <div>\n                    <Tooltip placement=\"topRight\" title={title}>\n                        <span style={{ color: 'red', fontSize: '120%' }}>\n                            ●\n                    </span>\n                    </Tooltip>\n                </div>\n            )\n        } else {\n            newAlert = (\n                <div>\n                    <span style={{ color: 'transparent', fontSize: '120%' }}>\n                        ●\n                    </span>\n                </div>\n            )\n        }\n\n        const hasRequests = false\n\n        let requestsAlert\n        if (hasRequests) {\n            requestsAlert = (\n                <div>\n                    <Icon type=\"bulb\" style={{ color: \"blue\" }} />\n                </div>\n            )\n        } else {\n            requestsAlert = null\n        }\n\n        return (\n            <div>\n                {newAlert}\n                {requestsAlert}\n            </div>\n        )\n    }\n\n    renderRequests() {\n        if (!(this.props.organization.relation === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.organization.relation === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        let message\n        let iconColor\n        switch (this.props.openRequestsStatus) {\n            case orgModel.RequestStatus.NONE:\n                // case null:\n                message = 'There are no open requests for this organization'\n                iconColor = 'rgba(200, 200, 200, 0.3)'\n                break\n            case orgModel.RequestStatus.NEW:\n                message = 'There are new requests since you last visited this organization'\n                iconColor = 'red'\n                break\n            case orgModel.RequestStatus.OLD:\n                message = 'There are open requests for this organization'\n                iconColor = 'blue'\n                break\n            case orgModel.RequestStatus.INAPPLICABLE:\n                return\n            default:\n                console.warn('Invalid open request status: ' + this.props.openRequestsStatus)\n                return\n        }\n        const title = (\n            <span>\n                {message}\n            </span>\n        )\n        return (\n            <Tooltip\n                placement=\"topRight\"\n                title={title}>\n                <span style={{ color: iconColor, fontSize: '80%' }}>\n                    <Icon type=\"mail\" />\n                </span>\n            </Tooltip>\n        )\n    }\n\n    renderPermalink() {\n        const permalink = (\n            <div>\n                <p>\n                    Below is the \"permalink\" for this organization. You may copy\n                    this url and use it to access this organization in a web browser.\n                </p>\n                <p style={{ fontFamily: 'monospace', fontWeight: 'bold' }}>\n                    {window.location.origin}/#org/{this.props.organization.id}\n                </p>\n            </div>\n        )\n        const menuClick = ({ key }: { key: string }) => {\n            Modal.info({\n                title: 'Org Permalink',\n                content: permalink\n            })\n        }\n        const menu = (\n            <Menu\n                onClick={menuClick}\n            >\n                <Menu.Item key=\"view\">\n                    View Permalink\n                </Menu.Item>\n            </Menu>\n        )\n        return (\n            <Dropdown\n                overlay={menu}\n                trigger={['click', 'contextMenu']}>\n                <a href={\"/#org/\" + this.props.organization.id}>\n                    <Icon type=\"link\" />\n                </a>\n            </Dropdown>\n        )\n    }\n\n    renderLogoColumn(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                <div className=\"BriefOrganization-logoRow\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderLogo(org)}\n                    </NavLink>\n                </div>\n                <div className=\"BriefOrganization-statusRow\">\n                    <div className=\"BriefOrganization-relationCol\">\n                        {this.renderRelation(org)}\n                    </div>\n                    <div className=\"BriefOrganization-privacyCol\">\n                        {this.renderPrivacy()}\n                    </div>\n\n                    <div className=\"BriefOrganization-homeLinkCol\">\n                        {this.renderHomeUrl(org)}\n                    </div>\n                </div>\n                <div className=\"BriefOrganization-freshnessRow\">\n                    <div className=\"BriefOrganization-orgFreshnessCol\">\n                        {this.renderOrgFreshness(org)}\n                    </div>\n                    <div className=\"BriefOrganization-openRequestsCol\">\n                        {this.renderRequests()}\n                    </div>\n                    <div className=\"BriefOrganization-openNewRequestsCol\">\n                        {this.renderPermalink()}\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    fullTimestamp(d: Date) {\n        return Intl.DateTimeFormat('en-US', {\n            month: 'short',\n            day: 'numeric',\n            year: 'numeric',\n            hour: 'numeric',\n            minute: 'numeric',\n            second: 'numeric',\n            timeZoneName: 'short'\n        }).format(d)\n    }\n\n    renderInfoCol(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                <div className=\"BriefOrganization-researchInterests BriefOrganization-infoTableRow\">\n                    {org.researchInterests}\n                </div>\n\n                <div className=\"BriefOrganization-orgOwner BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label BriefOrganization-fieldLabel\">owner</span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {/* TODO: render as Member or Owner component */}\n                        <Owner username={org.owner.username} avatarSize={16} showAvatar={false} />\n                    </div>\n                </div>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label BriefOrganization-fieldLabel\">created</span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {/* {niceElapsed(org.createdAt, 30)} */}\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title={this.fullTimestamp(org.createdAt)}>\n                            <span>\n                                {Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(org.createdAt)}\n                            </span>\n                        </Tooltip>\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderMemberRow(org: orgModel.BriefOrganization) {\n        const memberCount = org.memberCount - 1\n        let memberCountTooltip\n        if (memberCount) {\n            if (memberCount === 1) {\n                memberCountTooltip = (\n                    <span>\n                        There is <b>1</b> member in this organization\n                    </span>\n                )\n            } else {\n                memberCountTooltip = (\n                    <span>\n                        There are <b>{memberCount}</b> members in this organization\n                    </span>\n                )\n            }\n        } else {\n            memberCountTooltip = (\n                <span>\n                    There are <b>no members</b> in this organization\n                </span>\n            )\n        }\n        return (\n            <Tooltip placement=\"bottomRight\" title={memberCountTooltip}>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"team\" /></span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {this.renderMemberCount(org)}\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderNarrativeRow(org: orgModel.BriefOrganization) {\n        const count = org.narrativeCount\n        let tooltip\n        if (count) {\n            if (count === 1) {\n                tooltip = (\n                    <span>\n                        There is <b>1</b> narrative in this organization\n                    </span>\n                )\n            } else {\n                tooltip = (\n                    <span>\n                        There are <b>{count}</b> narratives in this organization\n                    </span>\n                )\n            }\n        } else {\n            tooltip = (\n                <span>\n                    There are <b>no narratives</b> in this organization\n                </span>\n            )\n        }\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"file\" /></span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {this.renderNarrativeCount(org)}\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderModifiedRow(org: orgModel.BriefOrganization) {\n        const tooltip = (\n            <span>\n                This organization was last updated\n                {' '}\n                <NiceElapsedTime time={org.modifiedAt} showTooltip={false} />\n            </span>\n        )\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"save\" /></span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        <NiceElapsedTime time={org.modifiedAt} showTooltip={false} />\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderStatsCol(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                {this.renderMemberRow(org)}\n                {this.renderNarrativeRow(org)}\n                {this.renderModifiedRow(org)}\n            </React.Fragment>\n        )\n    }\n\n    renderNormal() {\n        const org = this.props.organization\n        return (\n            <div className=\"BriefOrganization\">\n                <div className=\"BriefOrganization-body\">\n                    {/* <div className=\"BriefOrganization-freshnessCol\">\n                        {this.renderFreshness(org)}\n                    </div> */}\n                    <div className=\"BriefOrganization-logoCol\">\n                        {this.renderLogoColumn(org)}\n                    </div>\n                    <div className=\"BriefOrganization-infoCol\">\n                        <div className=\"BriefOrganization-infoCol-row\">\n                            <div className=\"BriefOrganization-infoCol-col1\">\n                                <div className=\"BriefOrganization-orgName BriefOrganization-infoTableRow\">\n                                    <NavLink to={`/viewOrganization/${org.id}`}>\n                                        {org.name}\n                                    </NavLink>\n                                </div>\n                            </div>\n                        </div>\n                        <div className=\"BriefOrganization-infoCol-row\">\n                            <div className=\"BriefOrganization-infoCol-col1\">\n                                {this.renderInfoCol(org)}\n                            </div>\n                            <div className=\"BriefOrganization-infoCol-col2\">\n                                {this.renderStatsCol(org)}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div >\n        )\n    }\n\n    render() {\n        return this.renderNormal()\n    }\n}\n","import * as React from 'react';\nimport './component.css';\nimport { Alert } from 'antd';\nimport * as orgModel from '../../../../data/models/organization/model'\nimport BriefOrganization from '../../../views/organizationHeader/BriefOrganization';\n\n// TODO: need more ergonomic way to resolve the common issue of data types interfering with \n// component types.\n\nexport interface OrganizationsProps {\n    organizations: Array<orgModel.BriefOrganization>\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n}\n\nexport interface OrganizationsState {\n    searchTerms: Array<string>\n}\n\nexport class Organizations extends React.Component<OrganizationsProps, OrganizationsState> {\n    constructor(props: OrganizationsProps) {\n        super(props)\n\n        this.state = {\n            searchTerms: []\n        }\n    }\n\n    renderAdminInfo(org: orgModel.Organization) {\n        return (\n            <div>\n                disabled\n            </div>\n        )\n    }\n\n    pluralize(count: number, singular: string, plural: string) {\n        if (count === 0 || count > 1) {\n            return plural\n        }\n        return singular\n    }\n\n    renderOrgs() {\n        if (this.props.organizations.length > 0) {\n            return (\n                this.props.organizations.map((organization, index) => {\n                    const status = this.props.openRequests.get(organization.id) || null\n                    return (\n                        <div key={String(index)} className=\"simpleCard\">\n                            <BriefOrganization organization={organization} openRequestsStatus={status} />\n                        </div>\n                    )\n                })\n            )\n        } else {\n            return (\n                <Alert type=\"warning\"\n                    style={{ maxWidth: '20em', margin: '20px auto 0 auto' }}\n                    message=\"Sorry, no organizations were found.\" />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Organizations\">\n                <div style={{ overflowY: 'auto', display: 'flex', flexDirection: 'column' }}>\n                    {this.renderOrgs()}\n                </div>\n            </div >\n        )\n    }\n}\n\nexport default Organizations;","import { Organizations, OrganizationsProps } from './component';\nimport { StoreState } from '../../../../types';\nimport { connect } from 'react-redux';\n\nexport function mapStateToProps(state: StoreState): OrganizationsProps {\n    // TODO: wow, should not do this here\n    if (state.views.browseOrgsView.viewModel === null) {\n        throw new Error('view not ready')\n    }\n    const {\n        views: {\n            browseOrgsView: {\n                viewModel: { organizations, openRequests }\n            }\n        }\n    } = state;\n\n    // associate the last visited by id with the org.\n    // const updatedOrgs = organizations.map((org: BriefOrganization) => {\n    //     const lastVisitedAt = lastVisitedAtById.get(org.id) || null\n    //     if (lastVisitedAt && lastVisitedAt.lastVisitedAt) {\n    //         return {\n    //             organization: org,\n    //             lastVisitedAt: lastVisitedAt.lastVisitedAt\n    //         }\n    //     } else {\n    //         return {\n    //             organization: org,\n    //             lastVisitedAt: null\n    //         }\n    //     }\n    // })\n\n    return {\n        organizations, openRequests\n    }\n}\n\nexport default connect(mapStateToProps)(Organizations);","import * as React from 'react'\nimport { NavLink, withRouter, Route } from 'react-router-dom'\nimport './Header.css'\nimport { Icon, Menu } from 'antd';\nimport { ClickParam } from 'antd/lib/menu'\n\nexport interface HeaderProps {\n    breadcrumbs: JSX.Element\n    buttons?: JSX.Element\n    test?: string\n    // history: History.History\n}\n\ninterface HeaderState {\n    currentMenuItem: string\n}\n\ninterface MenuProps {\n    currentItem: string\n}\n// const TopMenu = withRouter<MenuProps>(({ history }) => {\n//         function doNavigate(key: string) {\n//             switch (key) {\n//                 case 'myorgs':\n//                     history.push('/dashboard')\n//                 case 'allorgs':\n//                     history.push('/organizations')\n//             }\n//         }\n//         return (\n//             <Menu\n//                 onClick={(e: ClickParam) => { doNavigate(e.key) }}\n//                 selectedKeys={[this.state.currentMenuItem]}\n//                 mode=\"horizontal\"\n//             >\n//                 <Menu.Item key=\"myorgs\">\n//                     My Organizations\n//                 </Menu.Item>\n//                 <Menu.Item key=\"allorgs\">\n//                     All Organizations\n//                 </Menu.Item>\n//             </Menu>\n//         )\n//     })\n// }\n\nclass Header extends React.Component<HeaderProps, HeaderState> {\n\n    constructor(props: HeaderProps, context: React.Context<any>) {\n        super(props)\n\n        this.state = {\n            currentMenuItem: 'myorgs'\n        }\n    }\n    // <FaChevronRight style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n    buildSeparator() {\n        if (this.props.breadcrumbs) {\n            return (\n                <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n            )\n        }\n    }\n\n    onMenuSelection(e: ClickParam) {\n        // this.setState({\n        //     currentMenuItem: e.key\n        // })\n        // switch (e.key) {\n        //     case 'allorgs':\n        //         this.props.history.push('/organizations')\n        // }\n    }\n\n    render() {\n        return (\n            <div className=\"Header\">\n                <div className=\"Header-contextual\">\n                    <div className=\"Header-userColumn\">\n                        <div className=\"Header-breadcrumbs\">\n                            {this.props.breadcrumbs}\n                        </div>\n                        <div className=\"Header-buttons\">\n                            {this.props.buttons}\n                        </div>\n                        {/* {this.props.children} */}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Header;","import * as React from 'react'\nimport { NavLink, withRouter, Route, Link } from 'react-router-dom'\nimport './component.css'\nimport { Icon, Menu } from 'antd';\nimport { ClickParam } from 'antd/lib/menu'\n\ninterface MainMenuProps {\n    buttons?: JSX.Element\n}\n\ninterface MainMenuState {\n    currentMenuItem: string\n}\n\nclass MainMenu extends React.Component<MainMenuProps, MainMenuState> {\n    constructor(props: MainMenuProps, context: React.Context<any>) {\n        super(props)\n\n        this.state = {\n            currentMenuItem: 'myorgs'\n        }\n    }\n\n    onMenuSelection(e: ClickParam) {\n        // this.setState({\n        //     currentMenuItem: e.key\n        // })\n        // switch (e.key) {\n        //     case 'myorgs':\n        //         this.props.history.push('/dashboard')\n        //     case 'allorgs':\n        //         this.props.history.push('/organizations')\n        // }\n    }\n\n\n    renderMenu() {\n        return (\n            <Route render={({ history, location }) => {\n                let selectedKeys: Array<string> = []\n                switch (location.pathname) {\n                    case '/organizations':\n                        selectedKeys = ['allorgs']\n                        break\n                    case '/newOrganization':\n                        selectedKeys = ['neworg']\n                        break\n                }\n                return (\n                    <Menu\n                        // onClick={(e: ClickParam) => { doNavigate(e.key) }}\n                        selectedKeys={selectedKeys}\n                        style={{ backgroundColor: 'transparent' }}\n                        mode=\"horizontal\"\n                    >\n                        <Menu.Item key=\"allorgs\">\n                            <Link to=\"/organizations\">Browse &amp; Search</Link>\n                        </Menu.Item>\n                        {/* <Menu.Item key=\"neworg\">\n                            <Link to=\"/newOrganization\">Create New Organization</Link>\n                        </Menu.Item> */}\n                    </Menu>\n                )\n            }} />\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"MainMenu\">\n                <div className=\"MainMenu-menu\">\n                    {this.renderMenu()}\n                </div>\n                <div className=\"MainMenu-buttons\">\n                    {this.props.buttons}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default MainMenu;","import * as React from 'react';\n\nimport Organizations from './organizations/container';\nimport { SortDirection, AppError } from '../../../types';\n\nimport './component.css';\nimport { Button, Icon, Radio, Select, Modal, Alert, Checkbox } from 'antd'\nimport Header from '../../Header';\nimport { RadioChangeEvent } from 'antd/lib/radio';\nimport { CheckboxValueType } from 'antd/lib/checkbox/Group';\nimport { Filter } from '../../../data/models/organization/model';\nimport MainMenu from '../../menu/component';\nimport { NavLink } from 'react-router-dom';\nimport ButtonGroup from 'antd/lib/button/button-group';\n\nexport interface OrganizationsBrowserProps {\n    totalCount: number;\n    filteredCount: number;\n    sortBy: string;\n    filter: Filter;\n    searching: boolean;\n    error: AppError | null;\n    onSearchOrgs: (searchTerms: Array<string>) => void;\n    onSortOrgs: (sortField: string, sortDirection: SortDirection) => void;\n    onFilterOrgs: (filter: Filter) => void;\n}\n\nexport interface OrganizationsBrowserState {\n    searchInput: string\n    showInfo: boolean\n    filterByRoleType: string\n    filterByRole: Array<CheckboxValueType>\n    filterByPrivacy: string\n    showAdvancedControls: boolean\n    // filterByPrivacyType: Array<CheckboxValueType>\n}\n\ntype CBVT = CheckboxValueType\n\nclass OrganizationsBrowser extends React.Component<OrganizationsBrowserProps, OrganizationsBrowserState> {\n\n    searchInput: React.RefObject<HTMLInputElement>;\n    searchButton: React.RefObject<Button>;\n    filterByRoleValues: Array<any>\n\n\n    constructor(props: OrganizationsBrowserProps) {\n        super(props)\n\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.filterByRoleValues = [\n            {\n                label: 'Member',\n                value: 'member'\n            },\n            {\n                label: 'Admin',\n                value: 'admin'\n            },\n            {\n                label: 'Owner',\n                value: 'owner'\n            }\n        ]\n\n        this.state = {\n            searchInput: '',\n            showInfo: false,\n            filterByRoleType: 'myorgs',\n            filterByRole: [],\n            filterByPrivacy: 'any',\n            showAdvancedControls: false\n        }\n    }\n\n    // https://reactjs.org/docs/react-component.html#componentdidmount\n    componentDidMount() {\n        this.props.onSearchOrgs([])\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Organizations Browser Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations browser...</p>\n                </div>\n            )\n        })\n    }\n\n    doSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        const searchTerms = this.searchInput.current.value.split(/[\\s+]/)\n        // dispatch the search event\n        this.props.onSearchOrgs(searchTerms);\n    }\n\n    haveSearchInput() {\n        if (this.state.searchInput && this.state.searchInput.length > 0) {\n            return true\n        }\n        return false\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.setState({ searchInput: currentSearchInputValue })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.doSearch()\n    }\n\n    onSortByChange(value: string) {\n        switch (value) {\n            case 'owner':\n                this.props.onSortOrgs('owner', SortDirection.ASCENDING)\n                break\n            case 'name':\n                this.props.onSortOrgs('name', SortDirection.ASCENDING)\n                break\n            case 'recentlyAdded':\n                this.props.onSortOrgs('created', SortDirection.DESCENDING)\n                break\n            case 'recentlyChanged':\n                this.props.onSortOrgs('changed', SortDirection.DESCENDING)\n                break\n            case 'memberCount':\n                this.props.onSortOrgs('memberCount', SortDirection.DESCENDING)\n                break\n            case 'narrativeCount':\n                this.props.onSortOrgs('narrativeCount', SortDirection.DESCENDING)\n                break\n        }\n    }\n\n    onSortDirectionChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(this.props.sortBy, e.target.value)\n    }\n\n    onFilterByRoleTypeChange(e: RadioChangeEvent) {\n        let newFilter: Filter\n        this.setState({ filterByRoleType: e.target.value })\n        if (e.target.value === 'select') {\n            this.setState({ filterByRole: [] })\n            newFilter = {\n                ...this.props.filter,\n                roleType: e.target.value\n            }\n        } else {\n            newFilter = {\n                ...this.props.filter,\n                roleType: e.target.value,\n                roles: []\n            }\n            this.setState({ filterByRole: [] })\n        }\n        this.props.onFilterOrgs(newFilter)\n    }\n\n    onFilterByRoleChange(checkedValues: CheckboxValueType[]) {\n        let newFilter: Filter\n        this.setState({ filterByRole: checkedValues })\n        if (checkedValues.length === 0) {\n            this.setState({ filterByRoleType: 'myorgs' })\n            newFilter = {\n                ...this.props.filter,\n                roleType: 'myorgs',\n                roles: checkedValues\n            } as Filter\n        } else {\n            this.setState({ filterByRoleType: 'select' })\n            newFilter = {\n                ...this.props.filter,\n                roleType: 'select',\n                roles: checkedValues\n            } as Filter\n        }\n\n        this.props.onFilterOrgs(newFilter)\n    }\n\n    onFilterByPrivacyChange(e: RadioChangeEvent) {\n        this.setState({ filterByPrivacy: e.target.value })\n        const newFilter = {\n            ...this.props.filter,\n            privacy: e.target.value\n        } as Filter\n        this.props.onFilterOrgs(newFilter)\n    }\n\n    onClearSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        this.searchInput.current.value = ''\n        this.onSearchInputChange()\n        this.doSearch()\n    }\n\n    renderSearchFeedback() {\n        if (this.props.totalCount === 0) {\n            return (\n                <span>\n                    None available\n                </span>\n            )\n        }\n        if (this.props.filteredCount === 0) {\n            return (\n                <span>\n                    Ø\n                    /\n                    {this.props.totalCount}\n                    {' '}\n                    orgs\n                </span>\n            )\n\n        }\n        if (this.props.totalCount === this.props.filteredCount) {\n            return (\n                <span>\n                    <b>{this.props.totalCount}</b>\n                    {' '}\n                    orgs\n                </span>\n            )\n        }\n\n        return (\n            <span>\n                <b>{this.props.filteredCount}</b>\n                /\n                {this.props.totalCount}\n                {' '}\n                orgs\n            </span>\n        )\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchForm() {\n        return (\n            <form id=\"searchForm\" className=\"OrganizationsBrowser-searchBar\" onSubmit={this.onSubmit.bind(this)}>\n                <input\n                    className=\"OrganizationsBrowser-searchInput\"\n                    placeholder=\"Search Organizations\"\n                    onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                    ref={this.searchInput}></input>\n                {/* <Tooltip\n                    title=\"Enter one or more words to search organizations by name or owner\">\n                    <Icon type=\"info-circle\" theme=\"twoTone\" style={{ alignSelf: 'end' }} />\n                </Tooltip> */}\n                <Button\n                    disabled={!this.haveSearchInput()}\n                    ref={this.searchButton}\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                    {/* Search */}\n                </Button>\n                <Button\n                    onClick={this.onClearSearch.bind(this)}\n                    disabled={!this.haveSearchInput()}\n                    icon=\"close\"\n                >\n                </Button>\n            </form>\n        )\n    }\n\n    renderSearchBar() {\n        return (\n            <div className=\"OrganizationsBrowser-searchBarRow\">\n                <div className=\"OrganizationsBrowser-searchBarCol1\">\n                    {this.renderSearchForm()}\n                </div>\n                <div className=\"OrganizationsBrowser-searchBarCol2\">\n                    {this.renderSearchFeedback()}\n                </div>\n                {/* <div className=\"OrganizationsBrowser-searchBarCol3\">\n                </div> */}\n            </div>\n        )\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <React.Fragment>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                {/* <NavLink to=\"/newOrganization\"><Button icon=\"plus-circle\">Create Organization</Button></NavLink> */}\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderSortByControl() {\n        return (\n            <Select\n                onChange={this.onSortByChange.bind(this)}\n                defaultValue={this.props.sortBy}\n                dropdownMatchSelectWidth={true}\n                style={{ width: '10em' }}>\n                <Select.Option value=\"recentlyChanged\" key=\"changed\">Date Changed</Select.Option>\n                <Select.Option value=\"recentlyAdded\" key=\"recent\">Date Established</Select.Option>\n                <Select.Option value=\"name\" key=\"name\">Org Name</Select.Option>\n                <Select.Option value=\"memberCount\" key=\"memberCount\"># members</Select.Option>\n                <Select.Option value=\"narrativeCount\" key=\"narrativeCount\"># narratives</Select.Option>\n                {/* <Select.Option value=\"owner\" key=\"owner\">Org owner</Select.Option> */}\n                {/* <Select.Option value=\"\"newFirst key=\"newFirst\">New Activity</Select.Option> */}\n            </Select>\n        )\n    }\n\n    onToggleAdvanced() {\n        // When switching back to basic filter mode, we need to ensure that advanced \n        // filtering is removed.\n        if (this.state.showAdvancedControls) {\n            this.setState({ showAdvancedControls: false })\n            let { roleType, roles, privacy } = this.props.filter\n            if (!['myorgs', 'all'].includes(roleType)) {\n                roleType = 'myorgs'\n                this.setState({ filterByRoleType: 'myorgs' })\n            }\n            this.setState({ filterByRole: [], filterByPrivacy: 'any' })\n            roles = []\n            privacy = 'any'\n            this.props.onFilterOrgs({\n                roleType, roles, privacy\n            })\n        } else {\n            this.setState({ showAdvancedControls: true })\n        }\n    }\n\n    renderAdvancedToggle() {\n        if (this.state.showAdvancedControls) {\n            return (\n                <Icon\n                    type=\"ellipsis\"\n                    className=\"IconButton-hover-pressed\"\n                    onClick={this.onToggleAdvanced.bind(this)} />\n            )\n        } else {\n            return (\n                <Icon\n                    type=\"ellipsis\"\n                    className=\"IconButton-hover\"\n                    onClick={this.onToggleAdvanced.bind(this)} />\n            )\n        }\n    }\n\n    renderFilterByRole() {\n        const radioStyle = {\n            display: 'block',\n            height: '30px',\n            lineHeight: '30px'\n        }\n\n        if (this.state.showAdvancedControls) {\n            return (\n                <React.Fragment>\n                    <Radio.Group\n                        onChange={this.onFilterByRoleTypeChange.bind(this)}\n                        value={this.state.filterByRoleType}>\n\n                        <Radio value=\"myorgs\" style={radioStyle}>My Orgs</Radio>\n                        <Radio value=\"all\" style={radioStyle}>All Orgs</Radio>\n                        {this.renderAdvancedToggle()}\n                        <Radio value=\"notmyorgs\" style={radioStyle}>Not My Orgs</Radio>\n                        <Radio value=\"select\" style={radioStyle}>Specific Role</Radio>\n                    </Radio.Group>\n\n                    <Checkbox.Group\n                        options={this.filterByRoleValues}\n                        value={this.state.filterByRole}\n                        className=\"OrganizationsBrowser-checkboxGroup\"\n                        onChange={this.onFilterByRoleChange.bind(this)} />\n                </React.Fragment>\n            )\n        } else {\n            return (\n                <React.Fragment>\n                    <Radio.Group\n                        onChange={this.onFilterByRoleTypeChange.bind(this)}\n                        value={this.state.filterByRoleType}>\n\n                        <Radio value=\"myorgs\" style={radioStyle}>My Orgs</Radio>\n                        <Radio value=\"all\" style={radioStyle}>All Orgs</Radio>\n                        {this.renderAdvancedToggle()}\n                    </Radio.Group>\n                </React.Fragment>\n            )\n        }\n    }\n\n    renderFilterByPrivacy() {\n        if (!this.state.showAdvancedControls) {\n            return\n        }\n        const radioStyle = {\n            display: 'block',\n            height: '30px',\n            lineHeight: '30px',\n            margin: '0px'\n        }\n        const checkboxStyle = {\n            display: 'block',\n            height: '30px',\n            lineHeight: '30px',\n            margin: '0 0 0 6px'\n        }\n        return (\n            <React.Fragment>\n                <Radio.Group\n                    onChange={this.onFilterByPrivacyChange.bind(this)}\n                    value={this.state.filterByPrivacy}>\n                    <Radio value=\"any\" style={radioStyle}>Any</Radio>\n                    <Radio value=\"public\" style={radioStyle}>Public</Radio>\n                    <Radio value=\"private\" style={radioStyle}>Private</Radio>\n                </Radio.Group>\n            </React.Fragment >\n        )\n    }\n\n    renderOrganizations() {\n        if (this.props.error) {\n            return (\n                <Alert\n                    type=\"error\"\n                    message={this.props.error.code}\n                    description={this.props.error.message} />\n            )\n        } else {\n            return (\n                <Organizations />\n            )\n        }\n    }\n\n    renderFilterColumn() {\n        return (\n            <React.Fragment>\n\n\n                <div className=\"field-label\">sort by</div>\n                {this.renderSortByControl()}\n\n                <div className=\"field-label\" style={{ marginTop: '10px' }}>filter</div>\n\n                {this.renderFilterByRole()}\n\n                {this.state.showAdvancedControls ? (\n                    <div className=\"field-label\" style={{ marginTop: '10px' }}>by privacy</div>\n                ) : (null)}\n                {this.renderFilterByPrivacy()}\n            </React.Fragment>\n        )\n    }\n\n    renderMenuButtons() {\n        return (\n            <React.Fragment>\n                <NavLink to=\"/newOrganization\"><Button icon=\"plus-circle\" style={{ marginRight: '10px' }}>Create Organization</Button></NavLink>\n                {' '}\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"OrganizationsBrowser scrollable-flex-column\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                {/* {this.renderHeader()} */}\n                {this.renderSearchBar()}\n                <div className=\"OrganizationsBrowser-bodyRow\">\n                    <div className=\"OrganizationsBrowser-bodyCol scrollable-flex-column\">\n                        {this.renderOrganizations()}\n                    </div>\n                    <div className=\"OrganizationsBrowser-filterCol\">\n                        {this.renderFilterColumn()}\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default OrganizationsBrowser","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState,\n    AppError, SortDirection, BrowseOrgsViewModel\n} from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\n\nexport interface Load extends Action<ActionFlag.BROWSE_ORGS_LOAD> {\n    type: ActionFlag.BROWSE_ORGS_LOAD\n}\n\nexport interface LoadStart extends Action<ActionFlag.BROWSE_ORGS_LOAD_START> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_START\n}\n\nexport interface LoadSuccess extends Action<ActionFlag.BROWSE_ORGS_LOAD_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_SUCCESS\n    defaultViewModel: BrowseOrgsViewModel\n}\n\nexport interface LoadError extends Action<ActionFlag.BROWSE_ORGS_LOAD_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_ERROR\n    error: AppError\n}\n\nexport interface Unload extends Action<ActionFlag.BROWSE_ORGS_UNLOAD> {\n    type: ActionFlag.BROWSE_ORGS_UNLOAD\n}\n\nfunction loadStart(): LoadStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_START\n    }\n}\n\nfunction loadSuccess(defaultViewModel: BrowseOrgsViewModel): LoadSuccess {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_SUCCESS,\n        defaultViewModel: defaultViewModel\n    }\n}\n\nfunction loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.BROWSE_ORGS_UNLOAD\n    }\n}\n\n// SORTING\n\nexport interface SortOrgs extends Action<ActionFlag.BROWSE_ORGS_SORT> {\n    type: ActionFlag.BROWSE_ORGS_SORT,\n    sortField: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsStart extends Action<ActionFlag.BROWSE_ORGS_SORT_START> {\n    type: ActionFlag.BROWSE_ORGS_SORT_START,\n    sortField: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsSuccess extends Action<ActionFlag.BROWSE_ORGS_SORT_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_SORT_SUCCESS\n}\n\nexport interface SortOrgsError extends Action<ActionFlag.BROWSE_ORGS_SORT_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_SORT_ERROR,\n    error: AppError\n}\n\n\nexport function sortOrgsStart(sortField: string, sortDirection: SortDirection): SortOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SORT_START,\n        sortField: sortField,\n        sortDirection: sortDirection\n    }\n}\n\n// SEARCHING\n\nexport interface SearchOrgs extends Action<ActionFlag.BROWSE_ORGS_SEARCH> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH,\n    searchTerms: Array<string>\n}\n\n// Called upon the start of a search call\n// Sets the ui state to enable a spinner\n// and also search query data to be reflected in the ui\nexport interface SearchOrgs extends Action<ActionFlag.BROWSE_ORGS_SEARCH> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH,\n    searchTerms: Array<string>\n}\n\nexport interface SearchOrgsStart extends Action<ActionFlag.BROWSE_ORGS_SEARCH_START> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_START\n}\n\n// Called upon successful completion of a search\n// Sets the organizations found\nexport interface SearchOrgsSuccess extends Action<ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS\n    organizations: Array<orgModel.BriefOrganization>\n    totalCount: number\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n}\n\n// Called upon a search error\n// Sets error state\nexport interface SearchOrgsError extends Action<ActionFlag.BROWSE_ORGS_SEARCH_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_ERROR\n    error: AppError\n}\n\n\n// searchTerms: Array<string>\nfunction searchOrgsStart(): SearchOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_START\n    }\n}\n\nfunction searchOrgsSuccess(organizations: Array<orgModel.BriefOrganization>, totalCount: number, openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>): SearchOrgsSuccess {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS,\n        organizations: organizations,\n        totalCount: totalCount,\n        openRequests: openRequests\n    }\n}\n\nfunction searchOrgsError(error: AppError): SearchOrgsError {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_ERROR,\n        error: error\n    }\n}\n\n// FILTER \n\n// Filter orgs\nexport interface FilterOrgs extends Action<ActionFlag.BROWSE_ORGS_FILTER> {\n    type: ActionFlag.BROWSE_ORGS_FILTER,\n    filter: string\n}\n\nexport interface FilterOrgsStart extends Action<ActionFlag.BROWSE_ORGS_FILTER_START> {\n    type: ActionFlag.BROWSE_ORGS_FILTER_START,\n    filter: orgModel.Filter\n}\n\n\nexport function filterOrgsStart(filter: orgModel.Filter): FilterOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_FILTER_START,\n        filter: filter\n    }\n}\n\nexport function load() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        // populate default browse orgs props\n        const defaultViewModel: BrowseOrgsViewModel = {\n            rawOrganizations: [],\n            organizations: [],\n            openRequests: new Map(),\n            totalCount: 0,\n            filteredCount: 0,\n            sortField: 'changed',\n            sortDirection: SortDirection.DESCENDING,\n            filter: { roleType: 'myorgs', roles: [], privacy: 'any' },\n            searchTerms: [],\n            selectedOrganizationId: null,\n            searching: false,\n            error: null\n        }\n        // done!\n        dispatch(loadSuccess(defaultViewModel))\n    }\n}\n\n// TODO: proper typing here \nexport function searchOrgs(searchTerms: Array<string>) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchOrgsStart())\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { sortField, sortDirection, filter } } = browseOrgsView\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const { organizations, total } = await orgClient.queryOrgs({\n                searchTerms: searchTerms,\n                sortField, sortDirection, filter, username\n            })\n\n            // LEFT OFF HERE\n            // NOW GET THE PENDING REQUESTS...\n            const adminOrgs = organizations\n                .filter((org) => {\n                    return (\n                        org.relation === orgModel.UserRelationToOrganization.ADMIN ||\n                        org.relation === orgModel.UserRelationToOrganization.OWNER\n                    )\n                })\n                .map((org) => {\n                    return org.id\n                })\n            let openRequests\n            if (adminOrgs.length > 0) {\n                openRequests = await orgClient.getOpenRequestsStatus({ organizationIds: adminOrgs })\n            } else {\n                openRequests = new Map()\n            }\n\n            dispatch(searchOrgsSuccess(organizations, total, openRequests))\n        } catch (ex) {\n            console.error('Error querying orgs', ex.name, ex.message)\n            dispatch(searchOrgsError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function sortOrgs(sortField: string, sortDirection: SortDirection) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sortOrgsStart(sortField, sortDirection))\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { searchTerms, filter } } = browseOrgsView\n\n        try {\n            const { organizations, total } = await orgClient.queryOrgs({\n                searchTerms, filter, username,\n                sortField, sortDirection,\n            })\n\n            // LEFT OFF HERE\n            // NOW GET THE PENDING REQUESTS...\n            const adminOrgs = organizations\n                .filter((org) => {\n                    return (\n                        org.relation === orgModel.UserRelationToOrganization.ADMIN ||\n                        org.relation === orgModel.UserRelationToOrganization.OWNER\n                    )\n                })\n                .map((org) => {\n                    return org.id\n                })\n            let openRequests\n            if (adminOrgs.length > 0) {\n                openRequests = await orgClient.getOpenRequestsStatus({ organizationIds: adminOrgs })\n            } else {\n                openRequests = new Map()\n            }\n\n            dispatch(searchOrgsSuccess(organizations, total, openRequests))\n        } catch (ex) {\n            console.error('Error querying orgs', ex.name, ex.message)\n            dispatch(searchOrgsError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function filterOrgs(filter: orgModel.Filter) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(filterOrgsStart(filter))\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { searchTerms, sortField, sortDirection } } = browseOrgsView\n\n        try {\n            const { organizations, total } = await orgClient.queryOrgs({\n                searchTerms, filter, username,\n                sortField, sortDirection,\n            })\n\n            // LEFT OFF HERE\n            // NOW GET THE PENDING REQUESTS...\n            const adminOrgs = organizations\n                .filter((org) => {\n                    return (\n                        org.relation === orgModel.UserRelationToOrganization.ADMIN ||\n                        org.relation === orgModel.UserRelationToOrganization.OWNER\n                    )\n                })\n                .map((org) => {\n                    return org.id\n                })\n            let openRequests\n            if (adminOrgs.length > 0) {\n                openRequests = await orgClient.getOpenRequestsStatus({ organizationIds: adminOrgs })\n            } else {\n                openRequests = new Map()\n            }\n\n            dispatch(searchOrgsSuccess(organizations, total, openRequests))\n        } catch (ex) {\n            console.error('Error querying orgs', ex.name, ex.message)\n            dispatch(searchOrgsError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n","import OrganizationsBrowser from './component'\nimport { StoreState, SortDirection, AppError } from '../../../types'\nimport * as actions from '../../../redux/actions/browseOrgs'\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as orgModel from '../../../data/models/organization/model'\n//\n// Typing for the mapState and mapDispatch\n//\n\nexport interface OwnProps {\n    sortBy: string\n}\nexport interface LinkStateProps {\n    organizations: Array<orgModel.BriefOrganization>\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n    totalCount: number\n    filteredCount: number\n    filter: orgModel.Filter\n    searching: boolean,\n    error: AppError | null\n}\n\nexport interface LinkDispatchProps {\n    onSearchOrgs: (searchTerms: Array<string>) => void,\n    onSortOrgs: (sortField: string, sortDirection: SortDirection) => void,\n    onFilterOrgs: (filter: orgModel.Filter) => void\n}\n\n// note second arg is the component props, but we don't have any component props to merge in.\nexport function mapStateToProps(storeState: StoreState): LinkStateProps {\n    if (!storeState.views.browseOrgsView.viewModel) {\n        throw new Error('No view model!')\n    }\n\n    const {\n        views: {\n            browseOrgsView: {\n                viewModel: {\n                    organizations, openRequests, error,\n                    totalCount, filteredCount, filter, searching }\n            }\n        }\n    } = storeState\n\n    return {\n        organizations,\n        openRequests,\n        totalCount,\n        filteredCount,\n        filter,\n        error,\n        searching: searching\n    }\n\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.SearchOrgs | actions.SortOrgs | actions.FilterOrgs>): LinkDispatchProps {\n    return {\n        onSearchOrgs: (searchTerms: Array<string>) => {\n            // TODO proper typing here\n            dispatch(actions.searchOrgs(searchTerms) as any)\n        },\n        onSortOrgs: (sortBy: string, sortDirection: SortDirection) => {\n            // TODO proper typing here\n            dispatch(actions.sortOrgs(sortBy, sortDirection) as any)\n        },\n        onFilterOrgs: (filter: orgModel.Filter) => {\n            dispatch(actions.filterOrgs(filter) as any)\n        }\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OrganizationsBrowser)","import * as React from 'react'\nimport { ComponentLoadingState, StoreState, BrowseOrgsView } from '../../../types';\nimport Container from './container'\n\n// First the loader component, which takes care of a loading view, error view, and the \n// container.\n\nexport interface LoaderProps {\n    view: BrowseOrgsView\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Fetching your orgs and other things...\n            </div>\n        )\n    }\n\n    renderError() {\n        if (!this.props.view.error) {\n            return\n        }\n        return (\n            <div>\n                Error! {this.props.view.error.message}\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container sortBy=\"recentlyChanged\" />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad()\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// THe redux connection\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/browseOrgs'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    view: BrowseOrgsView\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.browseOrgsView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, AppError, UIError, UIErrorType, EditableOrganization, EditState, ValidationState, SyncState, ValidationErrorType } from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport Validation from '../../data/models/organization/validation'\n\n// ACTIONS\n\nexport interface Save extends Action<ActionFlag.ADD_ORG_SAVE> {\n    type: ActionFlag.ADD_ORG_SAVE\n}\n\nexport interface SaveStart extends Action<ActionFlag.ADD_ORG_SAVE_START> {\n    type: ActionFlag.ADD_ORG_SAVE_START\n}\n\nexport interface SaveSuccess extends Action<ActionFlag.ADD_ORG_SAVE_SUCCESS> {\n    type: ActionFlag.ADD_ORG_SAVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface SaveError extends Action<ActionFlag.ADD_ORG_SAVE_ERROR> {\n    type: ActionFlag.ADD_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Editing\n\nexport interface Load extends Action<ActionFlag.ADD_ORG_LOAD> {\n    type: ActionFlag.ADD_ORG_LOAD;\n}\n\nexport interface LoadStart {\n    type: ActionFlag.ADD_ORG_LOAD_START\n}\n\nexport interface LoadSuccess {\n    type: ActionFlag.ADD_ORG_LOAD_SUCCESS,\n    newOrganization: EditableOrganization\n}\n\nexport interface LoadError {\n    type: ActionFlag.ADD_ORG_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload {\n    type: ActionFlag.ADD_ORG_UNLOAD\n}\n\n// Evaluating state of form \n\nexport interface AddOrgEvaluate extends Action<ActionFlag.ADD_ORG_EVALUATE> {\n    type: ActionFlag.ADD_ORG_EVALUATE\n}\n\nexport interface AddOrgEvaluateOK extends Action<ActionFlag.ADD_ORG_EVALUATE_OK> {\n    type: ActionFlag.ADD_ORG_EVALUATE_OK\n}\n\nexport interface AddOrgEvaluateErrors extends Action<ActionFlag.ADD_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n}\n\n// Updating name field\n\nexport interface UpdateName extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME\n    name: string\n}\n\nexport interface UpdateNameSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS\n    name: string\n}\n\nexport interface UpdateNameError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR\n    name: string,\n    error: ValidationState\n}\n\n// Updating logo url field\n\nexport interface UpdateLogoUrl extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL\n    name: string\n}\n\nexport interface UpdateLogoUrlSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_SUCCESS\n    logoUrl: string | null\n}\n\nexport interface UpdateLogoUrlError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_ERROR\n    logoUrl: string | null,\n    error: ValidationState\n}\n\n// Updating home url field\nexport interface UpdateHomeUrl extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_HOME_URL\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlSuccess extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_SUCCESS\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_ERROR\n    homeUrl: string | null\n    error: ValidationState\n}\n\n// Updating research interests field\nexport interface UpdateResearchInterests extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsSuccess extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR\n    researchInterests: string\n    error: ValidationState\n}\n\n// Updating id Field\n\nexport interface UpdateId extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID,\n    id: string\n}\n\nexport interface UpdateIdSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n    id: string\n}\n\nexport interface UpdateIdError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n    id: string,\n    error: ValidationState\n}\n\nexport interface UpdateIdPass extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_PASS,\n    id: string\n}\n\n// Updating description field\n\nexport interface UpdateDescription extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface UpdateDescriptionSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface UpdateDescriptionError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: ValidationState\n}\n\n// Update is private field\n\nexport interface UpdateIsPrivate extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateSuccess extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateError extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_ERROR> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_ERROR,\n    error: ValidationState\n}\n\n\n// ACTION CREATORS\n\nexport function saveStart(): SaveStart {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_START\n    }\n}\n\nexport function saveSuccess(org: orgModel.Organization): SaveSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_SUCCESS,\n        organization: org\n    }\n}\n\nexport function saveError(error: AppError): SaveError {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n// Editing\n\nfunction loadStart() {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_START\n    }\n}\n\nfunction loadSuccess(newOrganization: EditableOrganization) {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_SUCCESS,\n        newOrganization: newOrganization\n    }\n}\n\nfunction loadError(error: AppError) {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.ADD_ORG_UNLOAD\n    }\n}\n\n// Evaluate\n\nexport function addOrgEvaluateOk(): AddOrgEvaluateOK {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_OK\n    }\n}\n\nexport function AddOrgEvaluateErrors(): AddOrgEvaluateErrors {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Update Name\n\nexport function updateNameSuccess(name: string): UpdateNameSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function updateNameError(name: string, error: ValidationState): UpdateNameError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\nexport function updateIdSuccess(id: string): UpdateIdSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n        id: id\n    }\n}\n\nexport function updateIdPass(id: string): UpdateIdPass {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_PASS,\n        id: id\n    }\n}\n\n// Update Gravatar Hash\n\nexport function updateLogoUrlSuccess(logoUrl: string | null): UpdateLogoUrlSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,\n        logoUrl: logoUrl\n    }\n}\n\nexport function updateLogoUrlError(logoUrl: string | null, error: ValidationState): UpdateLogoUrlError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_ERROR,\n        logoUrl: logoUrl,\n        error: error\n    }\n}\n\n\n// Update Id\n\nexport function updateIdError(id: string, error: ValidationState): UpdateIdError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n        id: id,\n        error: error\n    }\n}\n\nexport function updateDescriptionSuccess(description: string): UpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function updateDescriptionError(description: string, error: ValidationState): UpdateDescriptionError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function load() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const newOrg: EditableOrganization = {\n            id: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgId('')[1]\n            },\n            name: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgName('')[1]\n            },\n            logoUrl: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgLogoUrl('')[1]\n            },\n            homeUrl: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgHomeUrl('')[1]\n            },\n            researchInterests: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgResearchInterests('')[1]\n            },\n            description: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgDescription('')[1]\n            },\n            isPrivate: {\n                value: false,\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: {\n                    type: ValidationErrorType.OK,\n                    validatedAt: new Date()\n                }\n            }\n        }\n        dispatch(loadSuccess(newOrg))\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrg() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n\n        // This check is to satisfy TS. Since viewModel is nullable, it has no way \n        // of knowing that our app flow ensures that it is populated.\n        // In terms of generalized usage of the redux store, though, there is no\n        // way to ensure this! So we really should perform our state checks before \n        // handling any event\n        if (!state.views.addOrgView.viewModel) {\n            dispatch(saveError({\n                code: 'invalid',\n                message: 'Unexpected condition: no view model'\n            }))\n            return\n        }\n\n        // TODO: other validations!!!\n\n        dispatch(saveStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                addOrgView: { viewModel: { newOrganization } },\n            },\n            app: { config }\n        } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (!newOrganization) {\n            dispatch(saveError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        orgClient.addOrg(newOrganization, username)\n            .then((org: orgModel.Organization) => {\n                dispatch(saveSuccess(org))\n            })\n            .catch((error) => {\n                console.error('error adding', newOrganization, error)\n\n                // note that we dispatch an AppError compliant object,\n                // which wraps the original exception object.\n                dispatch(saveError({\n                    code: error.code || error.name,\n                    message: error.message,\n                    exception: error\n                }))\n            })\n    }\n}\n\nexport function addOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.addOrgView.viewModel) {\n            dispatch(saveError({\n                code: 'invalid',\n                message: 'Unexpected condition: no view model'\n            }))\n            return\n        }\n\n        const {\n            views: {\n                addOrgView: {\n                    viewModel: { editState, newOrganization } }\n            }\n        } = state\n\n        if (!newOrganization) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.name.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.id.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        // TODO: quick hack to allow unmodified fields to evaluate to true.\n\n        if (newOrganization.logoUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.homeUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.researchInterests.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.description.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(addOrgEvaluateOk())\n    }\n}\n\nfunction orgModelFromState(state: StoreState) {\n    const {\n        auth: { authorization: { token, username } },\n        app: { config } } = state\n    return new orgModel.OrganizationModel({\n        token, username,\n        groupsServiceURL: config.services.Groups.url\n    })\n}\n\nexport function updateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateNameError(validatedName, error))\n        } else {\n            dispatch(updateNameSuccess(validatedName))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function updateLogoUrl(name: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedLogoUrl, error] = Validation.validateOrgLogoUrl(name)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateLogoUrlError(validatedLogoUrl, error))\n        } else {\n            dispatch(updateLogoUrlSuccess(validatedLogoUrl))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function updateHomeUrl(homeUrl: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedHomeUrl, error] = Validation.validateOrgHomeUrl(homeUrl)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_ERROR,\n                homeUrl: homeUrl,\n                error: error\n            } as UpdateHomeUrlError)\n        } else {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_SUCCESS,\n                homeUrl: validatedHomeUrl\n            })\n        }\n    }\n}\n\nexport function updateResearchInterests(researchInterests: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedResearchInterests, error] = Validation.validateOrgHomeUrl(researchInterests)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n                researchInterests: validatedResearchInterests,\n                error: error\n            } as UpdateResearchInterestsError)\n        } else {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n                researchInterests: validatedResearchInterests\n            }) as UpdateResearchInterestsSuccess\n        }\n    }\n}\n\nexport function updateIsPrivate(isPrivate: boolean) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        // no validation for now ... what is there to validate?\n\n        dispatch({\n            type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n            isPrivate\n        })\n        dispatch(addOrgEvaluate())\n    }\n}\n\nclass Debouncer {\n\n    delay: number\n    fun: () => void\n    canceled: boolean\n    timer: number | null\n\n    constructor(delay: number, fun: () => void) {\n        this.delay = delay\n        this.fun = fun\n        this.canceled = false\n        this.timer = null\n        this.startWaiting()\n    }\n\n    startWaiting() {\n        if (this.timer) {\n            window.clearTimeout(this.timer)\n        }\n        this.timer = window.setTimeout(() => {\n            this.fun()\n        }, this.delay)\n    }\n\n    cancel() {\n        this.canceled = true\n    }\n}\n\nlet activeDebouncer: Debouncer | null = null\n\nexport function updateId(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(updateIdPass(id))\n        const [validatedId, error] = Validation.validateOrgId(id)\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n\n        const {\n            views: {\n                addOrgView: { viewModel }\n            }\n        } = getState()\n\n        if (!viewModel) {\n            // do nothing\n            return\n        }\n\n        const lastValidatedAt = viewModel.newOrganization.id.validationState.validatedAt\n        const now = new Date().getTime()\n        const debounce = 500 // ms\n        if (lastValidatedAt) {\n            const elapsed = now - lastValidatedAt.getTime()\n            if (elapsed < debounce) {\n                if (!activeDebouncer) {\n                    activeDebouncer = new Debouncer(500, () => {\n                        dispatch(evaluateId())\n                    })\n                }\n                return\n            }\n        }\n\n        if (activeDebouncer) {\n            activeDebouncer.cancel()\n        }\n        activeDebouncer = null\n\n        const model = orgModelFromState(getState())\n        model.orgExists(validatedId)\n            .then((exists) => {\n                if (exists) {\n                    dispatch(updateIdError(validatedId, {\n                        type: ValidationErrorType.ERROR,\n                        validatedAt: new Date(),\n                        message: 'This org id is already in use'\n                    }))\n                } else {\n                    dispatch(updateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function evaluateId() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n\n        const {\n            views: {\n                addOrgView: { viewModel }\n            }\n        } = getState()\n        if (!viewModel) {\n            // do nothing\n            return\n        }\n\n        const id = viewModel.newOrganization.id\n\n        const [validatedId, error] = Validation.validateOrgId(id.value)\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n\n        const model = orgModelFromState(getState())\n        model.orgExists(validatedId)\n            .then((exists) => {\n                if (exists) {\n                    dispatch(updateIdError(validatedId, {\n                        type: ValidationErrorType.ERROR,\n                        message: 'This org id is already in use',\n                        validatedAt: new Date()\n                    }))\n                } else {\n                    dispatch(updateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function updateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const model = orgModelFromState(getState())\n\n        const [validatedDescription, error] = Validation.validateOrgDescription(description)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(updateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}","import * as React from 'react'\nimport { Redirect } from 'react-router-dom'\nimport { Marked } from 'marked-ts'\nimport { Button, Icon, Modal, Input, Checkbox, Tooltip } from 'antd'\nimport md5 from 'md5'\n\nimport { EditableOrganization, SaveState, ValidationState, EditState, AppError, Editable, ValidationErrorType, SyncState } from '../../../types';\n\nimport './component.css'\n\nimport Header from '../../Header';\nimport { CheckboxChangeEvent } from 'antd/lib/checkbox';\nimport OrgLogo from '../../OrgLogo';\nimport TextArea from 'antd/lib/input/TextArea';\nimport MainMenu from '../../menu/component';\n\nexport interface NewOrganizationProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    error: AppError | null,\n    newOrganization: EditableOrganization,\n    onSave: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateLogoUrl: (logoUrl: string) => void\n    onUpdateHomeUrl: (homeUrl: string) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n}\n\nexport interface NewOrganizationState {\n    cancelToBrowser: boolean\n    showError: boolean\n}\n\nclass NewOrganization extends React.Component<NewOrganizationProps, NewOrganizationState> {\n\n    origin: string;\n\n    constructor(props: NewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            showError: true\n        }\n\n        this.origin = document.location!.origin\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'New Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>\n                        As a KBase user, you may create your own organizations.\n                    </p>\n                    <p>\n                        Once you have created an Organization, you will be the sole owner of it, forever.\n                    </p>\n                    <p>\n                        In order to create an Org, you need to complete the following fields.\n                    </p>\n                    <dl>\n                        <dt>\n                            name\n                        </dt>\n                        <dd>\n                            The organization <i>name</i> is whatever you wish to have your Org known as. It may be\n                            composed of any text (including unicode characters) up to 200 characters in length. You\n                            may also change it at any time.\n                        </dd>\n                        <dt>\n                            logo\n                        </dt>\n                        <dd>\n                            <p>\n                                Logo support has undergone a redesign, but has not yet been implemented. The new\n                                design supports direct image upload, and removes gravatar support.\n                            </p>\n                            <p>\n                                For now, gravatar is the only support for org logo\n                            </p>\n                            <p>\n                                In order to display a custom logo for your organization, you need to associate\n                                your Organization with an avatar hosted with the Gravatar service.\n                                To do so,\n                                simply enter the email address associated with your gravatar and press the update\n                                button. This will calculate a new \"gravatar hash\" and associate it with your organization.\n                            </p>\n                        </dd>\n                        <dt>\n                            id\n                        </dt>\n                        <dd>\n                            <p>\n                                Your Org <i>id</i> forms a url endpoint for your org as well as the identifier used throughout\n                            KBase to, well, identify your organization uniquely among all current and future organizations.\n                            As such, the Org ID may not be changed once created.\n                            </p>\n                            <p>\n                                The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also\n                                restricted to 100 characters in length.\n                            </p>\n\n                        </dd>\n                        <dt>\n                            description\n                        </dt>\n                        <dd>\n                            <p>\n                                Up to 4000 characters, a description allows you to express to other KBase users the purpose,\n                            history, associations, and science domain of your Org.</p>\n                            <p>\n                                The description is in \"markdown\" format, and the editor will show you a preview of the\n                                rendered description.\n                            </p>\n                        </dd>\n                    </dl>\n                </div>\n            )\n        })\n    }\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have entered information for this new organization.</p>\n\n                    <p>If you leave the editor without first saving, the new organization <i>will not be created</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        this.props.onSave();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value);\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value);\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateId(e.target.value)\n    }\n\n    onLogoUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateLogoUrl(e.target.value)\n    }\n\n    onHomeUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateHomeUrl(e.target.value)\n    }\n\n    onResearchInterestsChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateResearchInterests(e.target.value)\n    }\n\n    onIsPrivateChange(e: CheckboxChangeEvent) {\n        this.props.onUpdateIsPrivate(e.target.checked)\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState.type === ValidationErrorType.OK &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.saveState === SaveState.NEW\n        )\n    }\n\n    calcFieldClass(field: Editable) {\n        switch (field.validationState.type) {\n            // case (ValidationErrorType.OK):\n            //     return 'validation-ok'\n            case (ValidationErrorType.ERROR):\n                return 'validation-error'\n            case (ValidationErrorType.REQUIRED_MISSING):\n                return 'validation-error'\n        }\n\n        switch (field.syncState) {\n            case (SyncState.DIRTY):\n                return 'sync-dirty'\n            default:\n                return 'validation-ok'\n        }\n    }\n\n    renderFieldError(field: Editable) {\n        if (field.validationState.type !== ValidationErrorType.OK) {\n            if (field.syncState === SyncState.DIRTY) {\n                return (\n                    <span style={{ color: 'red' }}>\n                        {field.validationState.message}\n                    </span>\n                )\n            }\n        } else {\n            return ''\n        }\n    }\n\n    renderEditor() {\n        return (\n            <form id=\"newOrganizationForm\" className=\"NewOrganization-editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div style={{ flex: '1 1 0px' }}>\n                            <h3>Create Your Organization</h3>\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <h3>Preview</h3>\n                    </div>\n                </div>\n\n                {/* Org name */}\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div className=\"NewOrganization-formLabel field-label\">\n                            <Tooltip title=\"This is the name for your organization as you want KBase users to see it\">\n                                Name\n                            </Tooltip>\n                        </div>\n                        <div className=\"NewOrganization-formControl\">\n                            <Input value={this.props.newOrganization.name.value || ''}\n                                className={this.calcFieldClass(this.props.newOrganization.name)}\n                                onChange={this.onNameChange.bind(this)} />\n                            {this.renderFieldError(this.props.newOrganization.name)}\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <div className=\"NewOrganization-preview-name\">\n                            {this.props.newOrganization.name.value || ''}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Org ID */}\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div className=\"NewOrganization-formLabel field-label\">\n                            ID\n                        </div>\n                        <div className=\"NewOrganization-formControl\">\n                            <Input value={this.props.newOrganization.id.value || ''}\n                                className={this.calcFieldClass(this.props.newOrganization.id)}\n                                onChange={this.onIdChange.bind(this)} />\n                            {this.renderFieldError(this.props.newOrganization.id)}\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <div className=\"NewOrganization-preview-id\">\n                            <span style={{ color: 'silver' }}>{this.origin}/#org/</span>\n                            {this.props.newOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Logo URL */}\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div className=\"NewOrganization-formLabel field-label\">\n                            Logo URL\n                        </div>\n                        <div className=\"NewOrganization-formControl\">\n                            <Input value={this.props.newOrganization.logoUrl.value || ''}\n                                className={this.calcFieldClass(this.props.newOrganization.logoUrl)}\n                                onChange={this.onLogoUrlChange.bind(this)} />\n                            {this.renderFieldError(this.props.newOrganization.logoUrl)}\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <div className=\"NewOrganization-preview-logo\">\n                            {this.renderLogoPreview()}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Home Page URL */}\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div className=\"NewOrganization-formLabel field-label\">\n                            Home Page URL\n                        </div>\n                        <div className=\"NewOrganization-formControl\">\n                            <Input value={this.props.newOrganization.homeUrl.value || ''}\n                                className={this.calcFieldClass(this.props.newOrganization.homeUrl)}\n                                onChange={this.onHomeUrlChange.bind(this)} />\n                            {this.renderFieldError(this.props.newOrganization.homeUrl)}\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <div className=\"NewOrganization-field-name\">\n                            <a href={this.props.newOrganization.homeUrl.value || ''} target=\"_blank\">{this.props.newOrganization.homeUrl.value || ''}</a>\n                        </div>\n                    </div>\n                </div>\n\n\n                {/* Is Private? */}\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div className=\"NewOrganization-formLabel field-label\">\n                            Is Private?\n                        </div>\n                        <div className=\"NewOrganization-formControl\">\n                            <Checkbox\n                                checked={this.props.newOrganization.isPrivate.value}\n                                className={this.calcFieldClass(this.props.newOrganization.isPrivate)}\n                                onChange={this.onIsPrivateChange.bind(this)} />\n                            {this.renderFieldError(this.props.newOrganization.isPrivate)}\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <div className=\"NewOrganization-preview-isPrivate\">\n                            {this.renderIsPrivate(this.props.newOrganization.isPrivate.value)}\n                        </div>\n                    </div>\n                </div>\n\n\n                {/* Research Interests */}\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div className=\"NewOrganization-formLabel field-label\">\n                            Research Interests\n                        </div>\n                        <div className=\"NewOrganization-formControl\">\n                            <TextArea value={this.props.newOrganization.researchInterests.value || ''}\n                                className={this.calcFieldClass(this.props.newOrganization.researchInterests) + ' NewOrganization-control-researchInterests'}\n                                autosize={{ minRows: 2, maxRows: 2 }}\n                                onChange={this.onResearchInterestsChange.bind(this)} />\n                            {this.renderFieldError(this.props.newOrganization.researchInterests)}\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <div className=\"NewOrganization-preview-researchInterests\">\n                            {this.props.newOrganization.researchInterests.value || ''}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Description*/}\n                <div className=\"NewOrganization-row\">\n                    <div className=\"NewOrganization-col1\">\n                        <div className=\"NewOrganization-formLabel field-label\">\n                        </div>\n                        <div className=\"NewOrganization-formControl\">\n                            <TextArea value={this.props.newOrganization.description.value || ''}\n                                className={this.calcFieldClass(this.props.newOrganization.description) + ' NewOrganization-control-description'}\n                                autosize={{ minRows: 5, maxRows: 15 }}\n                                onChange={this.onDescriptionChange.bind(this)} />\n                            {this.renderFieldError(this.props.newOrganization.description)}\n                        </div>\n                    </div>\n                    <div className=\"NewOrganization-col2\">\n                        <div className=\"NewOrganization-preview-description\"\n                            dangerouslySetInnerHTML={({ __html: Marked.parse(this.props.newOrganization.description.value || '') })}\n                        />\n                    </div>\n                </div>\n            </form >\n        )\n    }\n\n\n    charAt(inString: string, position: number) {\n        // const c1 = inString.charAt(position)\n        const c1 = inString.charCodeAt(position)\n        if (c1 >= 0xD800 && c1 <= 0xDBFF && inString.length > position + 1) {\n            const c2 = inString.charCodeAt(position + 1)\n            if (c2 > 0xDC00 && c2 <= 0xDFFF) {\n                return inString.substring(position, 2)\n            }\n        }\n        return inString.substring(position, 1)\n    }\n\n    renderLogo(org: EditableOrganization) {\n        return (\n            <OrgLogo logoUrl={null} size={64} organizationName={org.name.value} organizationId={org.id.value} />\n        )\n    }\n\n    renderIsPrivate(isPrivate: boolean) {\n        if (isPrivate) {\n            return (\n                <span>\n                    <Icon type=\"lock\" />{' '}Private\n                </span>\n            )\n        }\n        return (\n            <span>\n                <Icon type=\"global\" />{' '}Public\n            </span>\n        )\n    }\n\n    renderDefaultLogo() {\n        if (!(this.props.newOrganization.name.value && this.props.newOrganization.id.value)) {\n            return (\n                <div>\n                    Default logo preview available when the Organization name and id are completed\n                </div>\n            )\n        }\n        const initial = this.charAt(this.props.newOrganization.name.value, 0).toUpperCase()\n        // const initial = this.props.organizationName.substr(0, 1).toUpperCase()\n        const hash = md5(this.props.newOrganization.id.value)\n\n        const size = 60;\n\n        const color = hash.substr(0, 6)\n        return (\n            <svg width={size} height={size} style={{ border: '1px rgba(200, 200, 200, 0.5) solid' }}>\n                <text x=\"50%\" y=\"50%\" dy={4} textAnchor=\"middle\" dominantBaseline=\"middle\" fontSize={size - 12} fill={'#' + color} fontFamily=\"sans-serif\">{initial}</text>\n            </svg>\n        )\n    }\n\n    renderLogoPreview() {\n        if (!this.props.newOrganization.logoUrl.value) {\n            return this.renderDefaultLogo()\n        }\n        return (\n            <img src={this.props.newOrganization.logoUrl.value} width={60} />\n        )\n    }\n\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    toggleError() {\n        this.setState({ showError: !this.state.showError })\n    }\n\n    renderHeader() {\n        const orgName = this.props.newOrganization!.name.value || (<span style={{ fontStyle: 'italic', color: 'gray' }}>org name will appear here when you edit the name field</span>)\n        let errorButton\n        if (this.props.error) {\n            errorButton = (\n                <Button shape=\"circle\" icon=\"exclamation\" type=\"danger\" onClick={this.toggleError.bind(this)}></Button>\n            )\n        }\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    {/* <FaPlusCircle style={{ verticalAlign: 'middle' }} /> */}\n                    <Icon type=\"plus-circle\" />\n                    {' '}\n                    Adding a New Org \"\n                            {orgName}\n                    \"\n                        </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                <Button icon=\"save\"\n                    form=\"newOrganizationForm\"\n                    key=\"submit\"\n                    disabled={!this.canSave.call(this)}\n                    htmlType=\"submit\">\n                    {/* <Icon type=\"save\" /> */}\n                    {/* <FaSave style={{ verticalAlign: 'center' }} /> */}\n                    Save\n                        </Button>\n\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                {errorButton}\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading New Org Editor...\n            </span>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderError() {\n        if (this.props.error && this.state.showError) {\n            const onOk = () => {\n                this.setState({ showError: false })\n            }\n            const onCancel = () => {\n                this.setState({ showError: false })\n            }\n            let trace\n            if (this.props.error.trace) {\n                trace = this.props.error.trace.map((line, index) => {\n                    return (\n                        <div key={\"line_\" + index}>{line}</div>\n                    )\n                })\n            }\n            if (trace) {\n                trace = (\n                    <div>\n                        <div>trace</div>\n                        {trace}\n                    </div>\n                )\n            }\n            return (\n                <Modal visible={true}\n                    title=\"Error\"\n                    okType=\"danger\"\n                    okText=\"Close\"\n                    cancelText=\"Clear Error\"\n                    onCancel={onCancel}\n                    onOk={onOk}>\n                    <div style={{ fontWeight: 'bold' }}>\n                        {this.props.error.code}\n                    </div>\n                    <div>\n                        {this.props.error.message}\n                    </div>\n                    {trace}\n\n                </Modal>\n            )\n        }\n    }\n\n    renderMenuButtons() {\n        let errorButton\n        if (this.props.error) {\n            errorButton = (\n                <Button shape=\"circle\" icon=\"exclamation\" type=\"danger\" onClick={this.toggleError.bind(this)}></Button>\n            )\n        }\n\n        return (\n            <React.Fragment>\n                <Button icon=\"save\"\n                    form=\"newOrganizationForm\"\n                    key=\"submit\"\n                    disabled={!this.canSave.call(this)}\n                    htmlType=\"submit\">\n                    Save\n                </Button>\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                {errorButton}\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        // TODO: this is just a prop for today.\n        if (this.props.saveState === SaveState.SAVED) {\n            return <Redirect push to={\"/editOrganization/\" + this.props.newOrganization.id.value} />\n        }\n\n        if (!this.props.newOrganization) {\n            return (\n                <div className=\"NewOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"NewOrganization\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                {/* {this.renderHeader()} */}\n                {this.renderEditor()}\n                {this.renderError()}\n            </div>\n        )\n    }\n}\n\nexport default NewOrganization","import { Dispatch, Action } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState, EditState, SaveState, ValidationState, EditableOrganization, AppError } from '../../../types';\nimport {\n    addOrg, updateName, updateLogoUrl, updateId, updateDescription, updateIsPrivate, updateHomeUrl, updateResearchInterests\n} from '../../../redux/actions/addOrg';\n\nimport Component from './component';\n\ninterface OwnProps {\n}\n\nexport interface StateProps {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    newOrganization: EditableOrganization\n    error: AppError | null\n}\n\nexport interface DispatchProps {\n    onSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateLogoUrl: (logoUrl: string | null) => void\n    onUpdateId: (id: string) => void\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateHomeUrl: (homeUrl: string | null) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n}\n\nexport function mapStateToProps(state: StoreState): StateProps {\n    if (!state.views.addOrgView.viewModel) {\n        throw new Error('View model missing in state')\n    }\n    const {\n        views: {\n            addOrgView: {\n                viewModel: { editState, saveState, validationState, newOrganization, error }\n            }\n        }\n    } = state\n\n    return {\n        editState,\n        saveState,\n        validationState,\n        newOrganization,\n        error\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onSave: () => {\n            dispatch(addOrg() as any)\n        },\n        onUpdateName: (name) => {\n            dispatch(updateName(name) as any)\n        },\n        onUpdateLogoUrl: (logoUrl: string | null) => {\n            dispatch(updateLogoUrl(logoUrl) as any)\n        },\n        onUpdateId: (id) => {\n            dispatch(updateId(id) as any)\n        },\n        onUpdateDescription: (description) => {\n            dispatch(updateDescription(description) as any)\n        },\n        onUpdateIsPrivate: (isPrivate: boolean) => {\n            dispatch(updateIsPrivate(isPrivate) as any)\n        },\n        onUpdateHomeUrl: (homeUrl: string | null) => {\n            dispatch(updateHomeUrl(homeUrl) as any)\n        },\n        onUpdateResearchInterests: (researchInterests: string) => {\n            dispatch(updateResearchInterests(researchInterests) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nimport { AppError, AddOrgView, ComponentLoadingState, StoreState } from '../../../types'\nimport Container from './container'\nimport './loader.css'\n\ninterface LoaderProps {\n    view: AddOrgView\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading \"Add New Organization\" form...\n            </div>\n        )\n    }\n\n    renderError(error: AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            case ComponentLoadingState.SUCCESS:\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad()\n        }\n    }\n\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// redux interface\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/addOrg'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.addOrgView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.Load | actions.Unload>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as requestModel from './requests'\nimport * as orgModel from './organization/model'\nimport { RequestType } from '../../types';\n\nexport interface UberOrganization {\n    organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization\n    request: requestModel.UserRequest | null\n    invitation: requestModel.UserInvitation | null\n    relation: orgModel.Relation,\n    groupRequests: Array<requestModel.Request> | null\n}\n\ninterface UberModelParams {\n    token: string\n    username: string\n    groupsServiceURL: string\n    userProfileServiceURL: string\n    workspaceServiceURL: string\n    serviceWizardURL: string\n}\n\nexport class UberModel {\n\n    params: UberModelParams\n\n    constructor(params: UberModelParams) {\n        this.params = params\n    }\n\n    async getOrganizationForUser(organizationId: string): Promise<UberOrganization> {\n        // const {\n        //     auth: { authorization: { token, username } },\n        //     app: { config }\n        // } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        // get org\n        const organization = await orgClient.getOrg(organizationId)\n\n        // get pending requests\n        const request = await requestClient.getUserRequestForOrg(organizationId) as requestModel.UserRequest | null\n\n        const invitation = await requestClient.getUserInvitationForOrg(organizationId) as requestModel.UserInvitation | null\n\n        // we should probably just keep the request ids rather than try to keep the whole request\n        // and refactor the calls for the request events, which I just refactored (not much work) to use the \n        // whole request structure rather than just the id, to use the request id + the org id...\n        const relation = orgModel.determineRelation(organization, this.params.username, request, invitation)\n\n        let groupRequests\n        if (relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            groupRequests = await requestClient.getPendingOrganizationRequestsForOrg(organizationId)\n        } else {\n            groupRequests = null\n        }\n\n        return {\n            organization, request, invitation, relation, groupRequests\n        }\n    }\n\n    // async getOrganizationsForUser(): Promise<Array<UberOrganization>> {\n    //     // const {\n    //     //     auth: { authorization: { token, username } },\n    //     //     app: { config }\n    //     // } = getState()\n\n    //     const orgClient = new orgModel.OrganizationModel({\n    //         token: this.params.token, username: this.params.username,\n    //         groupsServiceURL: this.params.groupsServiceURL\n    //     })\n\n    //     const requestClient = new requestModel.RequestsModel({\n    //         token: this.params.token, username: this.params.username,\n    //         groupsServiceURL: this.params.groupsServiceURL\n    //     })\n\n    //     const orgs = await orgClient.getOwnOrgs()\n\n    //     const requestOutbox = await requestClient.getOutboundRequests()\n    //     const requestInbox = await requestClient.getInboundRequests()\n\n    //     return await Promise.all(orgs.map(async (organization) => {\n    //         const request = requestOutbox.find((request) => {\n    //             if (request.organizationId === organization.id) {\n    //                 if (request.type === RequestType.REQUEST &&\n    //                     request.resourceType === requestModel.RequestResourceType.USER) {\n    //                     return true\n    //                 }\n    //             }\n    //             return false\n    //         }) as requestModel.UserRequest\n\n    //         const invitation = requestInbox.find((request) => {\n    //             if (request.organizationId === organization.id) {\n    //                 if (request.type === RequestType.INVITATION &&\n    //                     request.resourceType === requestModel.RequestResourceType.USER) {\n    //                     return true\n    //                 }\n    //             }\n    //             return false\n    //         }) as requestModel.UserInvitation\n\n    //         const relation = orgModel.determineRelation(organization, this.params.username, request || null, invitation)\n\n    //         let groupRequests\n    //         if (relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n    //             relation.type === orgModel.UserRelationToOrganization.OWNER) {\n    //             groupRequests = await requestClient.getPendingOrganizationRequestsForOrg(organization.id)\n    //         } else {\n    //             groupRequests = null\n    //         }\n\n    //         return {\n    //             organization, request, invitation, relation, groupRequests\n    //         }\n    //     }))\n    // }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport { AnError, makeError } from '../../lib/error';\nimport { StoreState } from '../../types';\n\nexport interface Load extends Action<ActionFlag.DATA_SERVICE_LOAD> {\n    type: ActionFlag.DATA_SERVICE_LOAD\n}\n\nexport interface LoadSuccess extends Action<ActionFlag.DATA_SERVICE_LOAD_SUCCESS> {\n    type: ActionFlag.DATA_SERVICE_LOAD_SUCCESS\n}\n\nexport interface LoadError extends Action<ActionFlag.DATA_SERVICE_LOAD_ERROR> {\n    type: ActionFlag.DATA_SERVICE_LOAD_ERROR,\n    error: AnError\n}\n\nfunction loadError(error: AnError) {\n    return {\n        type: ActionFlag.DATA_SERVICE_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function load() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.DATA_SERVICE_LOAD_START\n        })\n\n        dispatch({\n            type: ActionFlag.DATA_SERVICE_LOAD_SUCCESS\n        } as LoadSuccess)\n\n        // const {\n        //     auth: { authorization: { token, username } },\n        //     app: { config } } = getState()\n\n        // const userProfileClient = new userProfileModel.UserProfile({\n        //     token, username,\n        //     userProfileServiceURL: config.services.UserProfile.url\n        // })\n\n        // try {\n        //     const userProfile = await userProfileClient.getProfile(username)\n\n        //     dispatch({\n        //         type: ActionFlag.DATA_SERVICE_LOAD_SUCCESS,\n        //         profile: userProfile\n        //     })\n        // } catch (ex) {\n        //     console.error('error', ex)\n        //     dispatch(loadError(makeError({\n        //         code: ex.name,\n        //         message: ex.name\n        //     })))\n        // }\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.DATA_SERVICE_UNLOAD\n    }\n}\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState,\n    AppError, UIError, UIErrorType, ViewOrgViewModelKind\n} from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport * as requestModel from '../../data/models/requests'\nimport * as uberModel from '../../data/models/uber'\nimport * as feedsModel from '../../data/models/feeds'\nimport * as userProfileModel from '../../data/models/profile'\nimport { loadNarrative } from './entities'\nimport * as dataServices from './dataServices'\n\n// Action Types\n\nexport interface Load extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_START\n}\n\n// export interface LoadSuccess extends Action {\n//     type: ActionFlag.VIEW_ORG_LOAD_SUCCESS\n//     organization: orgModel.Organization\n//     relation: orgModel.Relation\n//     groupRequests: Array<requestModel.Request> | null\n//     groupInvitations: Array<requestModel.Request> | null\n//     requestInbox: Array<requestModel.Request>\n//     requestOutbox: Array<requestModel.Request>\n//     notifications: Array<feedsModel.OrganizationNotification>\n// }\n\nexport interface LoadNormalSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_NORMAL_SUCCESS\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    openRequest: orgModel.RequestStatus\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n    requestInbox: Array<requestModel.Request>\n    requestOutbox: Array<requestModel.Request>\n    notifications: Array<feedsModel.OrganizationNotification>\n}\n\nexport interface LoadInaccessiblePrivateSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_ERROR\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.VIEW_ORG_UNLOAD\n}\n\n// Join Requests\n\nexport interface ViewOrgJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST\n    requestId: string\n}\n\nexport interface ViewOrgJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR\n    error: UIError\n}\n\n// Join Request cancellation\n\nexport interface ViewOrgCancelJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST\n}\n\nexport interface ViewOrgCancelJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgCancelJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgCancelJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n    error: UIError\n}\n\n// Join Invitation Acceptance\n\nexport interface AcceptJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION\n}\n\nexport interface AcceptJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n}\n\nexport interface AcceptJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface AcceptJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n// Join Invitation Denial\n\nexport interface RejectJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION\n}\n\nexport interface RejectJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n}\n\nexport interface RejectJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface RejectJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n\n// Delete Narrative\n\nexport interface RemoveNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE\n}\n\nexport interface RemoveNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n}\n\nexport interface RemoveNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface RemoveNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\n\nexport function removeNarrativeStart(): RemoveNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n    }\n}\n\nexport function removeNarrativeSuccess(narrative: orgModel.NarrativeResource): RemoveNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n        narrative: narrative\n    }\n}\n\nexport function removeNarrativeError(error: AppError): RemoveNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function removeNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeNarrativeStart())\n\n        // TODO: need to restructure this view -- this is crazy\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: {\n                        organization\n                    }\n                }\n            }\n        } = state\n\n        if (!organization) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const groupId = organization.id\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n\n        try {\n            await orgClient.removeNarrativeFromOrg(groupId, narrative.workspaceId)\n            dispatch(removeNarrativeSuccess(narrative))\n        } catch (ex) {\n            dispatch(removeNarrativeError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Access narrative\n\nexport interface AccessNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface AccessNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n}\n\nexport interface AccessNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface AccessNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\nexport function accessNarrativeStart(): AccessNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n    }\n}\n\nexport function accessNarrativeSuccess(organization: orgModel.Organization): AccessNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function accessNarrativeError(error: AppError): AccessNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function accessNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(accessNarrativeStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'No view model'\n            }))\n            return\n        }\n\n        const viewModel = state.views.viewOrgView.viewModel\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'Not NORMAL org'\n            }))\n            return\n        }\n\n        const { organization } = viewModel\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n        } = state\n\n        const groupId = organization.id\n        const resourceId = String(narrative.workspaceId)\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.grantNarrativeAccess(groupId, resourceId)\n            // Getting a fresh copy of the org will trigger the view org component and\n            // all subcomponents with changed data to refresh. All we are intending here is that\n            // the narrative in the list of narratives provided by the groups api is updated, but\n            // there may be other elements of the group/org which have changed as well. So be it.\n            const org = await orgClient.getOrg(groupId)\n\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(accessNarrativeError({\n                    code: 'error',\n                    message: 'Not a NORMAL org'\n                }))\n                return\n            }\n\n            dispatch(loadNarrative(narrative.workspaceId))\n            dispatch(accessNarrativeSuccess(org))\n        } catch (ex) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n// Generators\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_START\n    }\n}\n\n\n\n// export function loadSuccess(\n//     organization: orgModel.Organization,\n//     relation: orgModel.Relation,\n//     groupRequests: Array<requestModel.Request> | null,\n//     groupInvitations: Array<requestModel.Request> | null,\n//     requestInbox: Array<requestModel.Request>,\n//     requestOutbox: Array<requestModel.Request>,\n//     notifications: Array<feedsModel.OrganizationNotification>): LoadSuccess {\n//     return {\n//         type: ActionFlag.VIEW_ORG_LOAD_SUCCESS,\n//         organization, relation, groupRequests, groupInvitations,\n//         requestInbox, requestOutbox, notifications\n//     }\n// }\n\nexport function loadNormalSuccess(\n    organization: orgModel.Organization,\n    relation: orgModel.Relation,\n    openRequest: orgModel.RequestStatus,\n    groupRequests: Array<requestModel.Request> | null,\n    groupInvitations: Array<requestModel.Request> | null,\n    requestInbox: Array<requestModel.Request>,\n    requestOutbox: Array<requestModel.Request>,\n    notifications: Array<feedsModel.OrganizationNotification>): LoadNormalSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_NORMAL_SUCCESS,\n        organization, relation, openRequest,\n        groupRequests, groupInvitations,\n        requestInbox, requestOutbox, notifications\n    }\n}\n\nexport function loadInaccessiblePrivateSuccess(\n    organization: orgModel.InaccessiblePrivateOrganization,\n    relation: orgModel.Relation,\n    requestOutbox: Array<requestModel.Request>): LoadInaccessiblePrivateSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,\n        organization, relation,\n        requestOutbox\n    }\n}\n\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\n// Join requests\n\nexport function viewOrgJoinRequestStart(): ViewOrgJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgJoinRequestSuccess(): ViewOrgJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgJoinRequestError(error: UIError): ViewOrgJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Join Request Cancellation\n\nexport function viewOrgCancelJoinRequestStart(): ViewOrgCancelJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgCancelJoinRequestSuccess(): ViewOrgCancelJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgCancelJoinRequestError(error: UIError): ViewOrgCancelJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Invitation Acceptance\n\nexport function acceptJoinInvitationStart(): AcceptJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n    }\n}\n\nexport function acceptJoinInvitationSuccess(): AcceptJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function acceptJoinInvitationError(error: AppError): AcceptJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n// Invitation Rejection \n\nexport function rejectJoinInvitationStart(): RejectJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n    }\n}\n\nexport function rejectJoinInvitationSuccess(): RejectJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function rejectJoinInvitationError(error: AppError): RejectJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n\n// Join invitation acceptance\n\n// TODO\n\n// Thunks\n\nexport function unload() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: { viewOrgView: { viewModel } }\n        } = getState()\n\n        if (!viewModel) {\n            throw new Error('view model not defined!?!')\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        //  await userProfileClient.setLastVisitedAt(viewModel.organization.id, new Date())\n\n\n        if (viewModel.organization.relation === orgModel.UserRelationToOrganization.MEMBER ||\n            viewModel.organization.relation === orgModel.UserRelationToOrganization.ADMIN ||\n            viewModel.organization.relation === orgModel.UserRelationToOrganization.OWNER) {\n            await orgClient.visitOrg({ organizationId: viewModel.organization.id })\n        }\n\n        dispatch(dataServices.load())\n\n        // Update the user's profile to indicate that this org has been \"viewed\".\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_UNLOAD\n        })\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            db: { notifications: { all, byId } }\n        } = getState()\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n        })\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const { organization, relation } = await uberClient.getOrganizationForUser(organizationId)\n            if (organization.kind !== orgModel.OrganizationKind.NORMAL) {\n\n                const requestInbox = await requestClient.getRequestInboxForOrg(organizationId)\n                dispatch(loadInaccessiblePrivateSuccess(organization, relation, requestInbox))\n                return\n            }\n\n            let openRequest\n            let orgRequests: Array<requestModel.Request> | null\n            let orgInvitations: Array<requestModel.Request> | null\n            if (relation.type === orgModel.UserRelationToOrganization.OWNER ||\n                relation.type === orgModel.UserRelationToOrganization.ADMIN) {\n                orgRequests = await requestClient.getPendingOrganizationRequestsForOrg(organizationId)\n                orgInvitations = await requestClient.getOrganizationInvitationsForOrg(organizationId)\n                openRequest = await orgClient.getOpenRequestStatus({ organizationId })\n            } else {\n                orgRequests = null\n                orgInvitations = null\n                openRequest = orgModel.RequestStatus.INAPPLICABLE\n            }\n\n            const requestInbox: Array<requestModel.Request> = await requestClient.getCombinedRequestInboxForOrg(organizationId)\n            const requestOutbox: Array<requestModel.Request> = await requestClient.getRequestOutboxForOrg(organizationId)\n\n            dispatch(loadNormalSuccess(organization, relation, openRequest, orgRequests, orgInvitations, requestInbox, requestOutbox, []))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function viewOrgJoinRequest() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        //TODO: could do a start here...\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel: { organization } }\n            }\n        } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.requestMembership(organization.id)\n            dispatch(viewOrgJoinRequestSuccess())\n            dispatch(load((organization.id)))\n        } catch (ex) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function viewOrgCancelJoinRequest(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewOrgJoinRequestStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.cancelRequest(requestId)\n            dispatch(viewOrgCancelJoinRequestSuccess())\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(viewOrgCancelJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function acceptJoinInvitation(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.acceptJoinInvitation(requestId)\n            dispatch(acceptJoinInvitationSuccess())\n            // quick 'n easy\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(acceptJoinInvitationError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n\nexport function rejectJoinInvitation(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.rejectJoinInvitation(requestId)\n            dispatch(rejectJoinInvitationSuccess())\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(rejectJoinInvitationError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\nimport {\n    StoreState,\n    AppError,\n    ViewOrgViewModelKind\n} from '../../../types'\n\nimport * as requestModel from '../../../data/models/requests'\nimport * as uberModel from '../../../data/models/uber'\n\nexport interface AcceptRequestAction<T> extends Action<T> {\n}\n\nexport interface AcceptRequest extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST\n    request: requestModel.Request\n}\n\ninterface AcceptRequestStart extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_START> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_START\n}\n\nexport interface AcceptRequestSuccess extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,\n    requests: Array<requestModel.Request>\n    organizations: Array<uberModel.UberOrganization>\n}\n\ninterface AcceptRequestError extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n    error: AppError\n}\n\nexport function acceptRequest(requestId: requestModel.RequestID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, AcceptRequestAction<any>>, getState: () => StoreState) => {\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'error',\n                    message: 'No view model'\n                }\n            })\n            return\n        }\n\n        // argh\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'invalid state',\n                    message: 'Not the right kind of view model'\n                }\n            })\n            return\n        }\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        // do the cancelation\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await requestClient.acceptRequest(requestId)\n\n            // refetch the inbox\n            const inbox = await requestClient.getCombinedRequestInboxForOrg(viewModel.organization.id)\n\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,\n                requests: inbox\n            })\n\n            // send the inbox in the success\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n\n        // or error\n    }\n}\n\n","import { string } from \"prop-types\";\nimport { AppException } from \"../../types\";\n\n/*\n{\n    \"id\": string - a unique id for the notification,\n    \"actor\": string - the actor who triggered the notification,\n    \"verb\": string - the action represented by this notification (see list of verbs below),\n    \"object\": string - the object of the notification,\n    \"target\": list - the target(s) of the notification,\n    \"source\": string - the source service that created the notification,\n    \"level\": string, one of alert, error, warning, request,\n    \"seen\": boolean, if true, then this has been seen before,\n    \"created\": int - number of milliseconds since the epoch, when the notification was created,\n    \"expires\": int - number of milliseconds since the epoch, when the notification will expire, and will no longer be seen.\n    \"external_key\": string - (optional) a external key that has meaning for the service that created the notification. Meant for use by other services.\n    \"context\": structure - (optional) a (mostly) freely open structure with meaning for the service that created it. The special keys `text` and `link` are intended to be used by the front end viewers. A `link` becomes a hyperlink that would link to some relevant place. `text` gets interpreted as the intended text of the notification, instead of automatically generating it.\n}\n*/\n\nexport interface Resource {\n    id: string\n    name: string\n    type: string\n}\nexport interface Notification {\n    id: string\n    actor: Resource\n    verb: string\n    object: Resource\n    target: Array<Resource>\n    source: string\n    level: string\n    seen: boolean\n    created: number\n    expires: number\n    external_key?: string\n    context?: {\n        resourcetype?: string\n        groupid?: string\n        requestid?: string\n    }\n}\n\nexport interface GetNotificationsResult {\n    group: {\n        feed: Array<Notification>\n        unseen: number\n    }\n    user: {\n        feed: Array<Notification>\n        unseen: number\n    }\n}\n\n\nexport interface FeedsError {\n    message: string\n}\n\n\nexport class FeedsException extends AppException {\n    originalError: FeedsError\n    constructor(error: FeedsError) {\n        super({\n            code: 'feeds-exception',\n            message: error.message,\n            detail: error.message,\n            info: new Map<string, any>()\n        })\n        this.name = 'FeedsException'\n        this.originalError = error\n    }\n}\n\nexport class ServerException extends AppException {\n    constructor(detail: string) {\n        super({ code: 'server-exception', message: 'Server Exception', detail: detail })\n        this.name = 'ServerException'\n    }\n}\n\nexport interface FeedsClientParams {\n    token: string\n    url: string\n}\n\ninterface APIResponse { }\n\nexport class FeedsClient {\n    params: FeedsClientParams\n\n\n    constructor(params: FeedsClientParams) {\n        this.params = params\n    }\n\n    async put<T>(path: Array<string>, body: any): Promise<T> {\n        const url = (this.baseURLPath().concat(path)).join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.params.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n            body: JSON.stringify(body)\n        })\n            .then((response) => {\n                if (response.status === 500) {\n                    switch (response.headers.get('Content-Type')) {\n                        case 'application/json':\n                            return response.json()\n                                .then((result) => {\n                                    throw new FeedsException(result)\n                                })\n                        case 'text/plain':\n                            return response.text()\n                                .then((result) => {\n                                    throw new ServerException(result)\n                                })\n                        default:\n                            throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n                    }\n                } else if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                } else {\n                    return response.json()\n                        .then((result) => {\n                            return result as T\n                        })\n                }\n            })\n    }\n\n    async post<T>(path: Array<string>, body: any): Promise<T | null> {\n        const url = (this.baseURLPath().concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.params.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST',\n            body: body ? JSON.stringify(body) : ''\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new FeedsException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else if (response.status === 204) {\n            return null\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    async postWithResult<T>(path: Array<string>, body: any): Promise<T> {\n        const url = (this.baseURLPath().concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.params.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST',\n            body: body ? JSON.stringify(body) : ''\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new FeedsException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    async get<T>(path: Array<string>, query: Map<string, string>): Promise<T> {\n        const queryString = Array.from(query.entries()).map(([k, v]) => {\n            return [\n                k, encodeURIComponent(v)\n            ].join('=')\n        }).join('&')\n        const url = (this.baseURLPath().concat(path)).join('/') + '?' + queryString\n        // const url = ([this.url].concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.params.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new FeedsException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    // async get(path: Array<string>, query: Map<string, string>): Promise<APIResponse> {\n    //     const queryString = Array.from(query.entries()).map(([k, v]) => {\n    //         return [\n    //             k, encodeURIComponent(v)\n    //         ].join('=')\n    //     }).join('&')\n    //     const url = [this.params.url, 'api', 'V1'].concat(path).join('/') + '?' + queryString\n    //     const response = await fetch(url, {\n    //         headers: {\n    //             Authorization: this.params.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n\n    //     if (response.headers.get('Content-Type') === 'application/json') {\n    //         if (response.status === 200) {\n    //             const result = await response.json()\n    //             return result\n    //         }\n    //         throw new Error('Non-success response: ' + response.status + ': ' + response.statusText)\n    //     } else {\n    //         const textResult = await response.text()\n    //         throw new Error('Non-JSON response' + textResult)\n    //     }\n    // }\n\n    baseURLPath() {\n        return [this.params.url, 'api', 'V1']\n    }\n\n    // async post(path: Array<string>, body: Map<string, string>): Promise<APIResponse> {\n    //     // const queryString = Array.from(query.entries()).map(([k, v]) => {\n    //     //     return [\n    //     //         k, encodeURIComponent(v)\n    //     //     ].join('=')\n    //     // }).join('&')\n    //     const url = this.baseURLPath().concat(path).join('/') //  + '?' + queryString\n    //     const response = await fetch(url, {\n    //         headers: {\n    //             Authorization: this.params.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n\n    //     if (response.headers.get('Content-Type') === 'application/json') {\n    //         if (response.status === 200) {\n    //             const result = await response.json()\n    //             return result\n    //         }\n    //         throw new Error('Non-success response: ' + response.status + ': ' + response.statusText)\n    //     } else {\n    //         const textResult = await response.text()\n    //         throw new Error('Non-JSON response' + textResult)\n    //     }\n    // }\n\n    async getNotifications({ count }: { count: number }): Promise<GetNotificationsResult> {\n        const options = new Map<string, string>()\n        options.set('n', String(count))\n        return await this.get<GetNotificationsResult>(['notifications'], options)\n        // return notifications as GetNotificationsResult\n    }\n\n    async seeNotifications(param: SeeNotificationsParam): Promise<SeeNotificationsResult> {\n        return this.postWithResult<SeeNotificationsResult>(['notifications', 'see'], param)\n    }\n}\n\nexport interface SeeNotificationsParam {\n    note_ids: Array<string>\n}\n\nexport interface SeeNotificationsResult {\n    seen_notes: Array<string>,\n    unauthorized_notes: Array<string>\n}\n\nexport default FeedsClient","import * as feedsApi from '../apis/feeds'\nimport * as userModel from './user'\nimport * as orgModel from './organization/model'\nimport * as requestModel from './requests'\nimport { acceptJoinRequest } from '../../redux/actions/manageOrganizationRequests';\nimport { sendRequest } from '../../redux/actions/requestAddNarrative';\n\nexport type NotificationID = string\n\nexport enum Level {\n    ALERT = 0,\n    ERROR,\n    WARNING,\n    REQUEST\n}\n\nexport interface Context { }\n\nexport interface Entity {\n    id: string\n    name: string\n    type: string\n}\nexport interface Notification {\n    id: NotificationID\n    actor: Entity\n    verb: string\n    object: Entity\n    target: Array<Entity>\n    source: string\n    level: Level\n    seen: boolean\n    createdAt: Date\n    expiresAt: Date\n    externalKey?: string\n    context?: Context\n}\n\nexport enum OrganizationNotificationType {\n    UNKNOWN = 0,\n    JOIN_REQUEST,\n    JOIN_INVITATION,\n    USER_JOINED,\n    USER_ACCEPTED,\n    NARRATIVE_ASSOCIATION_REQUEST,\n    NARRATIVE_ASSOCIATED,\n    NARRATIVE_ACCEPTED, // what is the difference from associated?\n    APP_ASSOCIATION_REQUEST,\n    APP_ASSOCIATED,\n    MESSAGE\n}\n\nexport interface OrganizationNotification {\n    id: NotificationID\n    from: userModel.Username\n    createdAt: Date\n    expiresAt: Date\n    level: Level\n    organizationId: orgModel.OrganizationID\n    type: OrganizationNotificationType\n    read: boolean\n    regarding: Array<Entity>\n}\n\nfunction convertLevel(level: string) {\n    switch (level) {\n        case 'alert':\n            return Level.ALERT\n        case 'error':\n            return Level.ERROR\n        case 'warning':\n            return Level.WARNING\n        case 'request':\n            return Level.REQUEST\n        default:\n            throw new Error('Invalid level value: ' + level)\n    }\n}\n\nfunction convertNotificationType(notification: feedsApi.Notification): OrganizationNotificationType {\n    // Grok\n    // if (!(notification.target && notification.context.resourcetype)) {\n    //     return OrganizationNotificationType.UNKNOWN\n    // }\n    const target = notification.target[0]\n    switch (notification.verb) {\n        case 'requested':\n            switch (target.type) {\n                case 'user':\n                    return OrganizationNotificationType.JOIN_REQUEST\n                case 'narrative':\n                case 'workspace':\n                    return OrganizationNotificationType.NARRATIVE_ASSOCIATION_REQUEST\n                case 'app':\n                    return OrganizationNotificationType.APP_ASSOCIATION_REQUEST\n            }\n        case 'updated':\n            switch (target.type) {\n                case 'narrative':\n                case 'workspace':\n                    return OrganizationNotificationType.NARRATIVE_ASSOCIATED\n            }\n        case 'accepted':\n            switch (target.type) {\n                case 'narrative':\n                case 'workspace':\n                    return OrganizationNotificationType.NARRATIVE_ACCEPTED\n                case 'user':\n                    // user request to join group has been accepted.\n                    return OrganizationNotificationType.USER_ACCEPTED\n            }\n        case 'invited':\n            switch (target.type) {\n                case 'user':\n                    return OrganizationNotificationType.JOIN_INVITATION\n            }\n        default:\n            console.warn('unknown', notification);\n            return OrganizationNotificationType.UNKNOWN\n    }\n\n    return OrganizationNotificationType.UNKNOWN\n}\n\nexport interface FeedsClientParams {\n    token: string\n    username: string\n    feedsServiceURL: string\n}\n\nexport class FeedsClient {\n    params: FeedsClientParams\n    feedsClient: feedsApi.FeedsClient\n    constructor(params: FeedsClientParams) {\n        this.params = params\n        this.feedsClient = new feedsApi.FeedsClient({\n            token: this.params.token,\n            url: this.params.feedsServiceURL\n        })\n    }\n\n    async getNotifications(): Promise<Array<Notification>> {\n        const notifications = await this.feedsClient.getNotifications({ count: 100 })\n\n        return notifications.user.feed.map((notification) => {\n            const { id, actor, verb, object, target, source, level, seen,\n                created, expires, external_key, context } = notification\n            return {\n                id, actor, verb, object, target, source,\n                level: convertLevel(level),\n                seen,\n                createdAt: new Date(created), expiresAt: new Date(expires),\n                externalKey: external_key, context\n            }\n        })\n    }\n\n    async getOrganizationNotifications(): Promise<Array<OrganizationNotification>> {\n        const notifications = await this.feedsClient.getNotifications({\n            count: 100\n        })\n\n        return notifications.user.feed\n            .filter(({ actor, source }) => {\n                return (\n                    source === 'groupsservice' &&\n                    actor.id !== this.params.username\n                )\n            })\n            .map((notification) => {\n                return {\n                    id: notification.id,\n                    from: notification.actor.id,\n                    createdAt: new Date(notification.created),\n                    expiresAt: new Date(notification.expires),\n                    level: convertLevel(notification.level),\n                    read: notification.seen,\n                    organizationId: notification.object.id,\n                    type: convertNotificationType(notification),\n                    regarding: notification.target\n                }\n            })\n    }\n\n    async seeNotification(notificationId: NotificationID): Promise<NotificationID> {\n        const { seen_notes, unauthorized_notes } = await this.feedsClient.seeNotifications({ note_ids: [notificationId] })\n        return seen_notes[0]\n\n    }\n}","import * as React from 'react'\n\nimport Avatar from './Avatar'\nimport { } from '../../types';\nimport { Icon, Tooltip } from 'antd';\nimport * as orgModel from '../../data/models/organization/model'\nimport * as userModel from '../../data/models/user'\n\nimport './Member.css'\nimport NiceElapsedTime from '../NiceElapsedTime';\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nexport interface MemberProps {\n    member: orgModel.Member\n    user: userModel.User\n    avatarSize?: number\n}\n\ninterface MemberState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nclass Member extends React.Component<MemberProps, MemberState> {\n    constructor(props: MemberProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderRole() {\n        switch (this.props.member.type) {\n            case orgModel.MemberType.OWNER:\n                return (\n                    <span>\n                        <Icon type=\"crown\" /> owner\n                </span>\n                )\n            case orgModel.MemberType.ADMIN:\n                return (\n                    <span>\n                        <Icon type=\"unlock\" /> admin\n                </span>\n                )\n            case orgModel.MemberType.MEMBER:\n                return (\n                    <span>\n                        <Icon type=\"user\" /> member\n                </span>\n                )\n        }\n    }\n\n    renderCompact() {\n        const userTooltip = (\n            <div>\n                {this.props.member.username}\n            </div>\n        )\n        return (\n            <div className=\"Member View-COMPACT\" >\n                <div className=\"Member-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"Member-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"Member-infoCol\">\n                    <div className=\"Member-name\">\n                        <Tooltip placement=\"bottomRight\" title={userTooltip}>\n                            <a href={\"/#people/\" + this.props.member.username} target=\"_blank\">{this.props.user.realname}</a>\n                        </Tooltip>\n                    </div>\n                    <div className=\"Member-role\">\n                        {this.renderRole()}\n                        {', joined '}\n                        <NiceElapsedTime time={this.props.member.joinedAt} />\n                    </div>\n                    <div className=\"Member-title\">\n                        {this.props.member.title || this.props.user.title}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderNormal() {\n        const userTooltip = (\n            <div>\n                {this.props.member.username}\n            </div>\n        )\n        return (\n            <div className=\"Member View-NORMAL\" >\n                <div className=\"Member-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"Member-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"Member-infoCol\">\n                    <div className=\"Member-name\">\n                        <Tooltip placement=\"bottomRight\" title={userTooltip}>\n                            <a href={\"/#people/\" + this.props.member.username} target=\"_blank\">{this.props.user.realname}</a>\n                        </Tooltip>\n                    </div>\n                    <div className=\"Member-role\">\n                        {this.renderRole()}\n                        {', joined '}\n                        <NiceElapsedTime time={this.props.member.joinedAt} />\n                    </div>\n                    <div className=\"Member-title\">\n                        {this.props.member.title || this.props.user.title}\n                    </div>\n                    <div className=\"Member-organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"Member-location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.state.view) {\n            case View.COMPACT:\n                return this.renderCompact()\n\n            case View.NORMAL:\n                return this.renderNormal()\n        }\n    }\n}\n\nexport default Member","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport Member from './Member'\n\ninterface LoaderProps {\n    member: orgModel.Member\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <Member member={this.props.member} user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.member.username)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\nimport * as orgModel from '../../data/models/organization/model'\n\n\nexport interface OwnProps {\n    member: orgModel.Member\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.member.username)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport { MemberType } from '../../../types'\nimport { Icon, Tooltip, Button, message, Menu, Dropdown } from 'antd'\nimport { Redirect } from 'react-router-dom'\n\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as requestModel from '../../../data/models/requests'\nimport * as userModel from '../../../data/models/user'\n\nimport './component.css'\nimport OrgLogo from '../../OrgLogo';\nimport Owner from '../../entities/OwnerContainer';\n\nexport interface OrganizationHeaderProps {\n    organization: orgModel.Organization\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    currentUsername: userModel.Username\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n    onJoinOrg: () => void\n}\n\ninterface OrganizationHeaderState {\n    navigateTo: NavigateTo\n}\n\nenum NavigateTo {\n    NONE = 0,\n    MANAGE_MEMBERSHIP,\n    VIEW_MEMBERS,\n    MANAGE_REQUESTS,\n    VIEW_ORGANIZATION,\n    EDIT_ORGANIZATION,\n    INVITE_USER\n}\n\nexport class OrganizationHeader extends React.Component<OrganizationHeaderProps, OrganizationHeaderState> {\n\n    relation: orgModel.UserOrgRelation\n\n    constructor(props: OrganizationHeaderProps) {\n        super(props)\n\n        this.state = {\n            navigateTo: NavigateTo.NONE\n        }\n\n        this.relation = this.getUserRelation()\n    }\n\n    getUserRelation(): orgModel.UserOrgRelation {\n        const currentUsername = this.props.currentUsername\n        const org = this.props.organization\n        if (currentUsername === org.owner.username) {\n            return {\n                type: orgModel.UserRelationToOrganization.OWNER\n            } as orgModel.OwnerRelation\n        } else {\n            const member = org.members.find(({ username }) => {\n                return (username === currentUsername)\n            })\n            if (member) {\n                switch (member.type) {\n                    case MemberType.MEMBER:\n                        return {\n                            type: orgModel.UserRelationToOrganization.MEMBER\n                        } as orgModel.MemberRelation\n                    case MemberType.ADMIN:\n                        return {\n                            type: orgModel.UserRelationToOrganization.ADMIN\n                        } as orgModel.AdminRelation\n                    case MemberType.OWNER:\n                        return {\n                            type: orgModel.UserRelationToOrganization.OWNER\n                        } as orgModel.OwnerRelation\n                    default:\n                        return {\n                            type: orgModel.UserRelationToOrganization.NONE\n                        } as orgModel.NoRelation\n                }\n            } else if (this.props.pendingJoinRequest && this.props.pendingJoinRequest.user === currentUsername) {\n                return {\n                    type: orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                    requestId: this.props.pendingJoinRequest.id\n                } as orgModel.MembershipRequestPendingRelation\n            } else if (this.props.pendingJoinInvitation && this.props.pendingJoinInvitation.user === currentUsername) {\n                return {\n                    type: orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                    requestId: this.props.pendingJoinInvitation.id\n                } as orgModel.MembershipInvitationPendingRelation\n            } else {\n                return {\n                    type: orgModel.UserRelationToOrganization.VIEW\n                } as orgModel.ViewRelation\n            }\n        }\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n        message.success('Join request has been submitted')\n    }\n\n    // LEFT OFF HERE... \n    // OK ... the relation should actually capture more info ... such as the request id\n    // but in reality don't we always have just one of request or invitation (or none)?\n    // in which case, we can just pick the appropriate one.\n    // but ... it also makes sense for the relation to carry information appropriate for the\n    // relation.\n\n    onCancelJoinRequest() {\n        const relation = this.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n        message.success('Submitted cancellation request')\n    }\n\n    onAcceptInvitation() {\n        const relation = this.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n        message.success('Invitation acceptance has been sent')\n    }\n\n    onRejectInvitation() {\n        const relation = this.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n        message.success('Invitation rejection has been sent')\n    }\n\n    onNavigateToMembership() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_MEMBERSHIP })\n    }\n\n    onNavigateToViewMembers() {\n        this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n    }\n\n    onNavigateToManageRequests() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n    }\n\n    onNavigateToEditOrganization() {\n        this.setState({ navigateTo: NavigateTo.EDIT_ORGANIZATION })\n    }\n\n    onNavigateToInviteUser() {\n        this.setState({ navigateTo: NavigateTo.INVITE_USER })\n    }\n\n    onNavigateToViewOrganization() {\n        this.setState({ navigateTo: NavigateTo.VIEW_ORGANIZATION })\n    }\n\n    onMenuClick({ key }: { key: string }) {\n        switch (key) {\n            case 'manageMyMembership':\n                this.setState({ navigateTo: NavigateTo.MANAGE_MEMBERSHIP })\n                break\n            case 'viewMembers':\n                this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n                break\n            case 'editOrg':\n                this.setState({ navigateTo: NavigateTo.EDIT_ORGANIZATION })\n                break\n            case 'inviteUser':\n                this.setState({ navigateTo: NavigateTo.INVITE_USER })\n                break\n            case 'manageRequests':\n                this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n                break\n        }\n    }\n\n\n    renderLogo(org: orgModel.Organization) {\n        return (\n            <OrgLogo logoUrl={org.logoUrl} size={80} organizationName={org.name} organizationId={org.id} />\n        )\n    }\n\n    renderRelation() {\n        const org = this.props.organization\n        switch (this.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <div>\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title=\"You are not a member of this org, but you may access it, you may request membership\"\n                        >\n                            <div style={{ textAlign: 'center' }}>\n                                <Icon type=\"eye\" style={{ marginRight: '4px' }} />You are not a member of this Organization\n                            </div>\n                        </Tooltip>\n                        <div style={{ textAlign: 'center' }}>\n                            <Button\n                                type=\"primary\"\n                                onClick={this.onJoinClick.bind(this)}>\n                                Join this Organization\n                            </Button>\n                        </div>\n                    </div>\n\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title=\"You have requested membership in this Organization\"\n                        >   <div style={{ textAlign: 'center' }}>\n                                <span>\n                                    <Icon type=\"user\" style={{ color: 'orange' }} spin={true} />\n                                    Your membership <b>request</b> is pending\n                                {' '}\n                                    <Icon type=\"question-circle\" />\n                                </span>\n                            </div>\n                        </Tooltip>\n                        <div style={{ textAlign: 'center' }}>\n                            <Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button>\n                        </div>\n                    </div>\n\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You have been invited to join this Organization\"\n                    >\n                        <div style={{ textAlign: 'center' }}>\n                            <div>\n                                <Icon type=\"user\" style={{ color: 'blue' }} />You have been <b>invited</b> to join this Organization\n                            </div>\n                            <div>\n                                <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept</Button>\n                                <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject</Button>\n                            </div>\n                        </div>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                const menu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            Manage My Membership\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You are a member of this organization\"\n                            >\n                                <div><Icon type=\"user\" />You are a <b>member</b> of this Organization</div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={menu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                const adminMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" >\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You are an Administrator for this organization\"\n                            >\n                                <div><Icon type=\"unlock\" />You are a <b>administrator</b> of this Organization</div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={adminMenu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                const ownerMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"editOrg\">\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You own this organization\"\n                            >\n                                <div>\n                                    <Icon type=\"crown\" style={{ color: 'gold' }} />\n                                    {' '}\n                                    You <b>own</b> this Organization\n                                    </div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={ownerMenu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                    </div>\n                )\n        }\n    }\n\n    renderHomeUrl(org: orgModel.Organization) {\n        if (!org.homeUrl) {\n            return\n        }\n        return (\n            <div className=\"homeUrl\">\n                <a href={org.homeUrl} target=\"_blank\">\n                    <Icon type=\"home\" />\n                    {' '}\n                    {org.homeUrl}\n                </a>\n            </div>\n        )\n    }\n\n    renderOrgInfo() {\n        const org = this.props.organization\n        return (\n            <React.Fragment>\n                <div className=\"name\">\n                    {org.name}\n                </div>\n                <div>\n                    <div style={{ display: 'inline-block', width: '50%', verticalAlign: 'top' }}>\n                        <div>\n                            {this.renderHomeUrl(org)}\n                        </div>\n                        <div className=\"owner\">\n                            <Owner username={org.owner.username} avatarSize={20} showAvatar={true} />\n                        </div>\n                    </div>\n                    <div style={{ display: 'inline-block', width: '50%', verticalAlign: 'top' }}>\n                        <div>\n                            <span className=\"field-label\">established</span>\n                            <span className=\"field-value\">{Intl.DateTimeFormat('en-US', {\n                                month: 'short',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(org.createdAt)}</span>\n                        </div>\n                        <div>\n                            <span className=\"field-label\">last modified</span>\n                            <span className=\"field-value\">{Intl.DateTimeFormat('en-US', {\n                                month: 'short',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(org.modifiedAt)}</span>\n                        </div>\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    getRelationClass(org: orgModel.Organization) {\n        switch (this.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return 'relationRequest'\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return 'relationRequest relationNonMember'\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'relationRequest relationRequestPending'\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'relationRequest relationInvitationPending'\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return 'relationRequest relationMember'\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return 'relationRequest relationAdmin'\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return 'relationRequest relationOwner'\n        }\n    }\n\n    render() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        switch (this.state.navigateTo) {\n            case NavigateTo.MANAGE_MEMBERSHIP:\n                return <Redirect push to={\"/membership/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_MEMBERS:\n                return <Redirect push to={\"/viewMembers/\" + this.props.organization.id} />\n            case NavigateTo.EDIT_ORGANIZATION:\n                return <Redirect push to={\"/editOrganization/\" + this.props.organization.id} />\n            case NavigateTo.MANAGE_REQUESTS:\n                return <Redirect push to={\"/manageOrganizationRequests/\" + this.props.organization.id} />\n            case NavigateTo.INVITE_USER:\n                return <Redirect push to={\"/inviteUser/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_ORGANIZATION:\n                return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n            default:\n            // nothing, fall through\n        }\n\n        return (\n            <div className=\"OrganizationHeader\">\n                <div className=\"avatar\">\n                    {this.renderLogo(this.props.organization)}\n                </div>\n                <div className=\"orgInfo\">\n                    {this.renderOrgInfo()}\n                </div>\n                <div className={\"yourRelation \" + this.getRelationClass(this.props.organization)}>\n                    {this.renderRelation()}\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default OrganizationHeader","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\n// we steal the view org actions...\nimport * as actions from '../../../redux/actions/viewOrg'\n\nimport Component from './component'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as requestModel from '../../../data/models/requests'\nimport * as userModel from '../../../data/models/user'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    organization: orgModel.Organization\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    currentUsername: userModel.Username\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const {\n        views: {\n            organizationCentricView: { viewModel }\n        },\n        auth: { authorization: { username } }\n    } = state\n\n    if (!viewModel) {\n        throw new Error('View model is unexpectedly missing')\n    }\n\n    return {\n        organization: viewModel.organization,\n        pendingJoinRequest: viewModel.pendingJoinRequest,\n        pendingJoinInvitation: viewModel.pendingJoinInvitation,\n        currentUsername: username\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: string) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: string) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: string) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as requestModel from '../../data/models/requests'\nimport * as userModel from '../../data/models/user'\nimport { AppError, StoreState } from '../../types';\n\nexport interface OrganizationCentricAction<T> extends Action<T> {\n\n}\n\nexport interface Load extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD\n}\n\nexport interface LoadStart extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START\n}\n\nexport interface LoadSuccess extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,\n    organization: orgModel.Organization,\n    pendingJoinRequest: requestModel.UserRequest | null\n    pendingJoinInvitation: requestModel.UserInvitation | null\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends OrganizationCentricAction<ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD> {\n    type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_START\n    }\n}\n\nexport function loadSuccess({\n    organization,\n    pendingJoinRequest,\n    pendingJoinInvitation,\n    relation\n}: {\n    organization: orgModel.Organization,\n    pendingJoinRequest: requestModel.UserRequest | null,\n    pendingJoinInvitation: requestModel.UserInvitation | null,\n    relation: orgModel.Relation\n}\n): LoadSuccess {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,\n        organization, pendingJoinRequest, pendingJoinInvitation, relation\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.ORGANIZATION_CENTRIC_VIEW_UNLOAD\n    }\n}\n\n\nexport function load(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, ValidityState, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n\n        try {\n            // get org\n            const organization = await orgClient.getOrg(organizationId)\n            if (organization.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(loadError({\n                    code: 'invalid state',\n                    message: 'Organization must be of kind \"NORMAL\"'\n                }))\n                return\n            }\n\n            // get pending requests\n            const request = await requestClient.getUserRequestForOrg(organizationId)\n            const invitation = await requestClient.getUserInvitationForOrg(organizationId)\n\n            const relation = orgModel.determineRelation(organization, username, request, invitation)\n\n            // current username is already here.\n            dispatch(loadSuccess({\n                organization, relation,\n                pendingJoinRequest: request,\n                pendingJoinInvitation: invitation\n            }))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}","import * as React from 'react'\n\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: types.OrganizationCentricView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading header...\n            </div>\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case types.ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case types.ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/organizationCentric'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.OrganizationCentricView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.organizationCentricView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport './UserSimple.css'\nimport Avatar from './Avatar'\nimport * as userModel from '../../data/models/user'\nimport { Tooltip } from 'antd';\n\nexport interface UserProps {\n    user: userModel.User\n    avatarSize?: number\n}\n\ninterface UserState {\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n    }\n\n    render() {\n        const tooltip = (\n            <div>\n                <div>\n                    {this.props.user.realname}\n                </div>\n                <div>\n                    <span><Avatar user={this.props.user} size={20} /></span>\n                    {' '}\n                    <span>{this.props.user.username}</span>\n                </div>\n            </div>\n        )\n        return (\n            <div className=\"UserSimple\">\n                <Tooltip title={tooltip} placement=\"bottomRight\">\n                    <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                </Tooltip>\n            </div>\n        )\n    }\n}\n\nexport default User","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport UserSimple from './UserSimple'\n\ninterface LoaderProps {\n    userId: userModel.Username\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <UserSimple user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.userId)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\n\n\nexport interface OwnProps {\n    userId: userModel.Username\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.userId)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport * as narrativeModel from '../../../data/models/narrative'\nimport { Tooltip, Icon } from 'antd'\nimport UserSimple from '../UserSimpleContainer'\nimport { niceElapsed } from '../../../lib/time'\nimport './component.css'\nimport NiceElapsedTime from '../../NiceElapsedTime';\n\nexport interface NarrativeProps {\n    narrative: narrativeModel.Narrative\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\ninterface NarrativeState {\n    view: View\n}\n\nexport default class Narrative extends React.Component<NarrativeProps, NarrativeState> {\n    constructor(props: NarrativeProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderPublicPermission(narrative: narrativeModel.AccessibleNarrative) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"global\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    // renderUserPermission(narrative: narrativeModel.AccessibleNarrative) {\n    //     let label\n    //     switch (narrative.access) {\n    //         case narrativeModel.NarrativeAccess.VIEW:\n    //             label = (\n    //                 <span>View-Only (<i>visit narrative to request additional access</i>)</span>\n    //             )\n    //             break\n    //         case narrativeModel.NarrativeAccess.EDIT:\n    //             label = (\n    //                 <span>Edit (<i>visit narrative to request additional access</i>)</span>\n    //             )\n    //             break\n    //         case narrativeModel.NarrativeAccess.ADMIN:\n    //             label = 'Admin'\n    //             break\n    //         case narrativeModel.NarrativeAccess.OWNER:\n    //             label = 'Owner'\n    //             break\n    //         default:\n    //             label = 'Unknown'\n    //     }\n    //     return (\n    //         <span>\n    //             {label}\n    //         </span>\n    //     )\n    // }\n\n    renderUserPermission(narrative: narrativeModel.AccessibleNarrative) {\n        let iconType\n        let tooltip\n        switch (narrative.access) {\n            case narrativeModel.NarrativeAccess.VIEW:\n                iconType = 'eye'\n                tooltip = (\n                    <span>View-Only (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.EDIT:\n                iconType = 'edit'\n                tooltip = (\n                    <span>This narrative is shared with you with <b>edit</b>> access (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.ADMIN:\n                iconType = 'unlock'\n                tooltip = (\n                    <span>\n                        This narrative is shared with you with <b>access</b> - you may edit and re-share this\n                    </span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.OWNER:\n                iconType = 'crown'\n                tooltip = (\n                    <span>\n                        You are the owner of this Narrative\n                    </span>\n                )\n                break\n        }\n        return (\n            <Tooltip\n                placement=\"bottomRight\"\n                title={tooltip}>\n                <Icon type={iconType} />\n            </Tooltip>\n        )\n    }\n\n    renderGlobalPermission(narrative: narrativeModel.AccessibleNarrative) {\n        let iconType\n        let tooltip\n        if (narrative.isPublic) {\n            iconType = 'global'\n            tooltip = 'This narrative has been shared publicly - with all KBase users'\n        } else {\n            iconType = 'lock'\n            tooltip = 'This narrative is private - only accessible to the owner any users it has been shared with'\n        }\n        return (\n            <Tooltip\n                placement=\"bottomRight\"\n                title={tooltip}>\n                <Icon type={iconType} />\n            </Tooltip>\n        )\n    }\n\n    renderNiceElapsed(d: Date) {\n        const tooltip = (\n            <span>\n                {\n                    Intl.DateTimeFormat('en-US', {\n                        month: 'short',\n                        day: 'numeric',\n                        year: 'numeric'\n                    }).format(d)\n                }\n            </span>\n        )\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                {niceElapsed(d)}\n            </Tooltip>\n        )\n    }\n\n    renderCompact(narrative: narrativeModel.AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                {/* <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div> */}\n                <div className=\"mainCol\">\n                    <div>\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {', '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            {this.renderUserPermission(narrative)}\n                        </div>\n                        <div className=\"Narrative-global\">\n                            {this.renderGlobalPermission(narrative)}\n                        </div>\n                    </div>\n                    <div>\n                        <span className=\"field-label\">updated</span>\n                        <NiceElapsedTime time={narrative.lastSavedAt} />\n                    </div>\n\n                    {/* TODO: left off here; need to add in the added date\n                        <div>\n                        <span className=\"field-label\">added</span>\n                        {this.renderNiceElapsed(this.props.)}\n                    </div> */}\n                    {/* <div>\n                        {this.renderPublicPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">your permission</span>\n                        {this.renderUserPermission(narrative)}\n                    </div> */}\n                    {/* <div>\n                        <span className=\"field-label\">owner</span>\n                        <div style={{ display: 'inline-block' }}><UserSimple avatarSize={20} userId={narrative.owner} /></div>\n                    </div> */}\n                </div>\n\n            </React.Fragment>\n        )\n    }\n\n    renderNormal(narrative: narrativeModel.AccessibleNarrative) {\n\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                {/* <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div> */}\n                <div className=\"mainCol\">\n                    <div>\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {', '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            {this.renderUserPermission(narrative)}\n                        </div>\n                        <div className=\"Narrative-global\">\n                            {this.renderGlobalPermission(narrative)}\n                        </div>\n                    </div>\n                    {/* <div>\n                        {this.renderPublicPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">your permission</span>\n                        {this.renderUserPermission(narrative)}\n                    </div> */}\n                    {/* <div>\n                        <span className=\"field-label\">owner</span>\n                        <div style={{ display: 'inline-block' }}><UserSimple avatarSize={20} userId={narrative.owner} /></div>\n                    </div> */}\n                    <div>\n                        <span className=\"field-label\">last saved</span>\n                        {this.renderNiceElapsed(narrative.lastSavedAt)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">by</span>\n                        <UserSimple avatarSize={20} userId={narrative.lastSavedBy} />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNarrative(narrative: narrativeModel.AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"mainCol\">\n                    <div>\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {', '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            {this.renderUserPermission(narrative)}\n                        </div>\n                        <div className=\"Narrative-global\">\n                            {this.renderGlobalPermission(narrative)}\n                        </div>\n                    </div>\n                    <div>\n                        <span className=\"field-label\">updated</span>\n                        <NiceElapsedTime time={narrative.lastSavedAt} />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        const narrative = this.props.narrative\n        if (narrative.access === narrativeModel.NarrativeAccess.NONE) {\n            return (\n                <div>\n                    You don't have access to this Narrative\n                </div>\n            )\n        }\n        // switch (this.state.view) {\n        //     case View.COMPACT:\n        //         return (\n        //             <div className=\"Narrative View-COMPACT\">\n        //                 {this.renderCompact(narrative)}\n        //             </div>\n        //         )\n        //     case View.NORMAL:\n        //         return (\n        //             <div className=\"Narrative View-NORMAL\">\n        //                 {this.renderNormal(narrative)}\n        //             </div>\n        //         )\n        // }\n        return this.renderNarrative(narrative)\n    }\n}","import * as React from 'react'\nimport * as narrativeModel from '../../../data/models/narrative'\nimport Narrative from './component'\n\ninterface LoaderProps {\n    workspaceId: narrativeModel.WorkspaceID\n    narrative: narrativeModel.Narrative | null\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\ninterface LoaderState { }\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.narrative) {\n            return (\n                <Narrative\n                    narrative={this.props.narrative}\n                />\n            )\n        } else {\n            return (\n                <div>\n                    Loading narrative...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.narrative) {\n            this.props.onLoad(this.props.workspaceId)\n        }\n    }\n}\n\n// redux wrapper\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../../types'\nimport * as actions from '../../../redux/actions/entities'\n\nexport interface OwnProps {\n    workspaceId: narrativeModel.WorkspaceID\n}\n\ninterface StateProps {\n    narrative: narrativeModel.Narrative | null\n}\n\ninterface DispatchProps {\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        narrative: state.entities.narratives.byId.get(props.workspaceId) || null\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (workspaceId: narrativeModel.WorkspaceID) => {\n            dispatch(actions.loadNarrative(workspaceId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)\n","import * as React from 'react'\nimport * as orgModel from '../data/models/organization/model'\nimport { Button, Tooltip, Icon, Drawer } from 'antd'\nimport Narrative from './entities/narrative/reduxAdapter'\nimport NiceElapsedTime from './NiceElapsedTime'\nimport './OrganizationNarrative.css'\n\nexport interface Props {\n    narrative: orgModel.NarrativeResource\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n}\n\ninterface State {\n    requestAccess: boolean\n}\n\nexport default class OrganizationNarrative extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n        this.state = {\n            requestAccess: false\n        }\n    }\n\n    onGetViewAccess() {\n        this.props.onGetViewAccess(this.props.narrative)\n    }\n\n    onRequestAccess() {\n        this.setState({ requestAccess: true })\n    }\n\n    onCloseRequestAccess() {\n        this.setState({ requestAccess: false })\n    }\n\n    renderNarrativePermission(narrative: orgModel.NarrativeResource) {\n        let label\n        let shareButton\n        let permissionTooltip\n        let buttonTooltip\n        switch (narrative.permission) {\n            case orgModel.UserWorkspacePermission.NONE:\n                if (narrative.isPublic) {\n                    permissionTooltip = \"You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it\"\n                    label = (\n                        <span>\n                            View Only (public)\n                        </span>\n                    )\n                    buttonTooltip = 'Although you have View-Only access to this Narrative due to it being shared globally, you can obtain personal View-Only access by clicking this button'\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onGetViewAccess.call(this) }}>\n                            Click for View Access\n                        </Button>\n                    )\n                } else {\n                    permissionTooltip = \"You have No access to this narrative narrative; you may not view, edit, run, or share it\"\n                    label = (\n                        <span>\n                            No Access\n                        </span>\n                    )\n                    buttonTooltip = 'You cannot access this Narrative; in order to immediately obtain View-Only access click this button.'\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onGetViewAccess.call(this) }}>\n                            Click for View Access\n                        </Button>\n                    )\n                }\n                break\n            case orgModel.UserWorkspacePermission.VIEW:\n                permissionTooltip = \"You have View access to this narrative narrative; you may view it, but not edit, run, or share it\"\n                label = (\n                    <span>\n                        View Only\n                    </span>\n                )\n                buttonTooltip = 'You already have View-Only access to this Narrative, but may request additional access'\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestAccess.call(this) }}>\n                        Request Additional Access\n                    </Button>\n                )\n                break\n            case orgModel.UserWorkspacePermission.EDIT:\n                permissionTooltip = \"You have Edit access to this Narrative; you may view, edit, and run, but not share it\"\n                label = (\n                    <span>\n                        Edit\n                    </span>\n                )\n                buttonTooltip = 'You already have Edit access to this Narrative, but may request additional access by clicking this button'\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestAccess.call(this) }}>\n                        Request Admin Access\n                    </Button>\n                )\n                break\n            case orgModel.UserWorkspacePermission.ADMIN:\n                permissionTooltip = \"You have Admin access to this narrative narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Admin\n                    </span>\n                )\n                break\n            case orgModel.UserWorkspacePermission.OWNER:\n                permissionTooltip = \"You are the Owner of this narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Owner\n                    </span>\n                )\n                break\n            default:\n                label = (\n                    <span>\n                        Unknown\n                    </span>\n                )\n        }\n\n        return (\n            <React.Fragment>\n                <Tooltip title={permissionTooltip} placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <span className=\"field-label\">your permission</span>\n                        {label}\n                    </span>\n                </Tooltip>\n                {' '}\n                <Tooltip title={buttonTooltip} placement=\"right\">\n                    {shareButton}\n                </Tooltip>\n            </React.Fragment>\n        )\n    }\n\n    renderPublicPermission(narrative: orgModel.NarrativeResource) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"global\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderNarrative() {\n        const narrative = this.props.narrative\n        if (narrative.permission === orgModel.UserWorkspacePermission.NONE) {\n            return (\n                <React.Fragment>\n                    <div className=\"title\">{narrative.title}</div>\n                    {/* <div>{this.renderPublicPermission(narrative)}</div> */}\n                    <div>{this.renderNarrativePermission(narrative)}</div>\n                </React.Fragment>\n            )\n        } else {\n            return (\n                <Narrative workspaceId={narrative.workspaceId} />\n                // <React.Fragment>\n                //     <div className=\"title\"><a href={'https://ci.kbase.us/narrative/ws.' + narrative.workspaceId + '.obj.' + '1'} target=\"_blank\">{narrative.title}</a></div>\n                //     <div>{this.renderPublicPermission(narrative)}</div>\n                //     <div>{this.renderNarrativePermission(narrative)}</div>\n\n                //     <div>\n                //         <Narrative workspaceId={narrative.workspaceId} />\n                //     </div>\n                // </React.Fragment>\n            )\n        }\n    }\n\n    renderResource() {\n        return (\n            <div>\n                <div>\n                    <span className=\"field-label\">added</span>\n                    <span>\n                        <NiceElapsedTime time={this.props.narrative.createdAt} />\n                    </span>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        let accessModal\n        if (this.state.requestAccess) {\n            // TODO: replace with our own implementation...n\n            accessModal = (\n                <Drawer title=\"Request Access to Narrative\"\n                    placement=\"right\"\n                    closable={true}\n                    visible={true}\n                    onClose={() => { this.onCloseRequestAccess.call(this) }}\n                >\n                    Requesting access...\n                </Drawer>\n            )\n        }\n\n        return (\n            <div className=\"OrganizationNarrative\">\n                <div className=\"OrganizationNarrative-narrativeCol\">\n                    {this.renderNarrative()}\n                </div>\n                <div className=\"OrganizationNarrative-resourceCol\">\n                    {this.renderResource()}\n                </div>\n                {accessModal}\n            </div>\n        )\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\n\nimport { AppError, StoreState } from '../../../types'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as uberModel from '../../../data/models/uber'\n\n// LOADING\n\nexport interface Load extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD,\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_START\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_UNLOAD\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR\n    error: AppError\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, relation: orgModel.Relation): LoadSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS,\n        organization: organization,\n        relation: relation\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        try {\n            const { organization, relation } = await uberClient.getOrganizationForUser(organizationId)\n            if (organization.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(loadError({\n                    code: 'invalid state',\n                    message: 'Organization must be of kind \"NORMAL\"'\n                }))\n                return\n            }\n            dispatch(loadSuccess(organization, relation))\n\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Promoting member to admin\n\nexport interface PromoteToAdmin extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    memberUsername: string\n}\n\nexport interface PromoteToAdminStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n}\n\nexport interface PromoteToAdminSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    memberUsername: string\n}\n\nexport interface PromoteToAdminError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n    error: AppError\n}\n\n\nexport function promoteToAdminStart(): PromoteToAdminStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n    }\n}\n\nexport function promoteToAdminSuccess(memberUsername: string): PromoteToAdminSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n        memberUsername\n    }\n}\n\nexport function promoteToAdminError(error: AppError): PromoteToAdminError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n        error: error\n    }\n}\n\nexport function promoteToAdmin(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(promoteToAdminStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.memberToAdmin(viewModel.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(promoteToAdminSuccess(memberUsername))\n            })\n            .catch((err: Error) => {\n                dispatch(promoteToAdminError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Demote admin to member\n\nexport interface DemoteToMember extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    memberUsername: string\n}\n\nexport interface DemoteToMemberStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n}\n\nexport interface DemoteToMemberSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    memberUsername: string\n}\n\nexport interface DemoteToMemberError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n    error: AppError\n}\n\n\nexport function demoteToMemberStart(): DemoteToMemberStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n    }\n}\n\nexport function demoteToMemberSuccess(memberUsername: string): DemoteToMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n        memberUsername: memberUsername\n    }\n}\n\nexport function demoteToMemberError(error: AppError): DemoteToMemberError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function demoteToMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(demoteToMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.adminToMember(viewModel.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(demoteToMemberSuccess(memberUsername))\n                // dispatch(viewMembersLoad(view.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(demoteToMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Remove a member\n\nexport interface RemoveMember extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER,\n    memberUsername: string\n}\n\ninterface RemoveMemberStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START\n}\n\nexport interface RemoveMemberSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    memberUsername: orgModel.Username\n}\n\ninterface RemoveMemberError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n    error: AppError\n}\n\nfunction removeMemberStart(): RemoveMemberStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START\n    }\n}\n\nfunction removeMemberSuccess(memberUsername: orgModel.Username): RemoveMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n        memberUsername\n    }\n}\n\nfunction removeMemberError(error: AppError): RemoveMemberError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function removeMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.removeMember(viewModel.organization.id, memberUsername)\n            .then(() => {\n                dispatch(removeMemberSuccess(memberUsername))\n                // dispatch(load(viewModel.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(removeMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport { Alert, Card, Menu, Icon, Dropdown, Modal } from 'antd'\nimport Member from '../../../../entities/MemberContainer'\nimport './component.css'\n\nexport interface MembersProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    onPromoteMemberToAdmin: (username: string) => void\n    onRemoveMember: (username: string) => void\n    onDemoteAdminToMember: (username: string) => void\n}\n\ninterface MembersState {\n\n}\n\nexport default class Members extends React.Component<MembersProps, MembersState> {\n    constructor(props: MembersProps) {\n        super(props)\n    }\n\n    onConfirmRemoveMember(memberUsername: orgModel.Username) {\n        const confirmed = (() => {\n            this.props.onRemoveMember(memberUsername)\n        })\n        Modal.confirm({\n            title: 'Really remove this user?',\n            content: (\n                <p>\n                    This is not reversible.\n                </p>\n            ),\n            width: '50em',\n            onOk: () => {\n                confirmed()\n            }\n        })\n    }\n\n    onMemberMenu(key: string, member: orgModel.Member) {\n        switch (key) {\n            case 'promoteToAdmin':\n                this.props.onPromoteMemberToAdmin(member.username)\n                break\n            case 'removeMember':\n                this.onConfirmRemoveMember(member.username)\n                break\n        }\n    }\n\n    onAdminMenu(key: string, member: orgModel.Member) {\n        switch (key) {\n            case 'demoteToMember':\n                this.props.onDemoteAdminToMember(member.username)\n                break\n        }\n    }\n\n    renderMemberMenu(member: orgModel.Member) {\n        const menu = (\n            <Menu onClick={({ key }) => { this.onMemberMenu.call(this, key, member) }}>\n                <Menu.Item key=\"promoteToAdmin\" >\n                    <Icon type=\"unlock\" />Promote to Admin\n                </Menu.Item>\n                <Menu.Item key=\"removeMember\" >\n                    <Icon type=\"delete\" />Remove Member\n                </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Icon type=\"ellipsis\" className=\"IconButton-hover\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderAdminMenu(member: orgModel.Member) {\n        const menu = (\n            <Menu onClick={({ key }) => { this.onAdminMenu.call(this, key, member) }}>\n                <Menu.Item key=\"demoteToMember\">\n                    <Icon type=\"user\" />Demote to Member\n                    </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Icon type=\"ellipsis\" className=\"IconButton-hover\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderOwnerMenu(member: orgModel.Member) {\n        return (\n            <div></div>\n        )\n    }\n\n    renderMemberOptions(member: orgModel.Member) {\n        if (!(this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN)) {\n            return\n        }\n\n        switch (member.type) {\n            case orgModel.MemberType.OWNER:\n                return this.renderOwnerMenu(member)\n            case orgModel.MemberType.ADMIN:\n                return this.renderAdminMenu(member)\n            case orgModel.MemberType.MEMBER:\n                return this.renderMemberMenu(member)\n        }\n    }\n\n    renderMembers() {\n        let members: JSX.Element | Array<JSX.Element>\n        const message = (\n            <div style={{ fontStyle: 'italic', textAlign: 'center' }}>\n                No members.\n            </div>\n        )\n\n        if (this.props.organization.members.length === 0) {\n            members = (\n                <Alert type=\"info\" message={message} />\n            )\n        } else {\n            members = this.props.organization.members.map((member) => {\n                return (\n                    <div className=\"Members-row simpleCard\" key={member.username}>\n                        <div className=\"Members-member\">\n                            <Member member={member} avatarSize={50} />\n                        </div>\n                        <div className=\"Members-menu\">\n                            {this.renderMemberOptions(member)}\n                        </div>\n                    </div>\n                )\n            })\n        }\n\n        return (\n            <div className=\"infoTable\">\n                {members}\n            </div>\n        )\n    }\n\n    render() {\n        return (\n            <React.Fragment>\n                {this.renderMembers()}\n            </React.Fragment>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState } from '../../../../../types'\nimport * as actions from '../../../../../redux/actions/viewOrganization/viewMembers'\nimport ViewMembers from './component'\nimport * as orgModel from '../../../../../data/models/organization/model'\n\nexport interface OwnProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onViewMembersUnload: () => void,\n    onPromoteMemberToAdmin: (memberUsername: string) => void,\n    onDemoteAdminToMember: (adminUsername: string) => void,\n    onRemoveMember: (memberUsername: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    // if (!state.views.viewMembersView || (state.views.viewMembersView.viewModel === null)) {\n    //     throw new Error('Runtime Error - view members view is not defined!')\n    // }\n    // const {\n    //     views: {\n    //         viewMembersView: {\n    //             viewModel: { organization, relation }\n    //         }\n    //     }\n    // } = state\n    // return {\n    //     organization, relation\n    // }\n    return {}\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onViewMembersUnload: () => {\n            dispatch(actions.unload() as any)\n        },\n        onPromoteMemberToAdmin: (memberUsername: string) => {\n            dispatch(actions.promoteToAdmin(memberUsername) as any)\n        },\n        onDemoteAdminToMember: (adminUsername: string) => {\n            dispatch(actions.demoteToMember(adminUsername) as any)\n        },\n        onRemoveMember: (memberUsername: string) => {\n            dispatch(actions.removeMember(memberUsername) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewMembers)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\nimport {\n    StoreState,\n    AppError,\n    ViewOrgViewModelKind\n} from '../../../types'\n\nimport * as requestModel from '../../../data/models/requests'\n\n// Reject inbound request\n\nexport interface RejectRequestAction<T> extends Action<T> {\n}\n\nexport interface RejectInboxRequest extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST\n    request: requestModel.Request\n}\n\ninterface RejectInboxRequestStart extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_START> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_START\n}\n\nexport interface RejectInboxRequestSuccess extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS\n    requests: Array<requestModel.Request>\n}\n\ninterface RejectInboxRequestError extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,\n    error: AppError\n}\n\nexport function denyRequest(requestId: requestModel.RequestID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, RejectRequestAction<any>>, getState: () => StoreState) => {\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'error',\n                    message: 'No view model'\n                }\n            })\n            return\n        }\n\n        // argh\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'invalid state',\n                    message: 'Not the right kind of view model'\n                }\n            })\n            return\n        }\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        // do the cancelation\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await requestClient.denyRequest(requestId)\n\n            // refetch the outbox\n            const inbox = await requestClient.getRequestInboxForOrg(viewModel.organization.id)\n\n            dispatch({\n                type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,\n                requests: inbox\n            } as RejectInboxRequestSuccess)\n\n            // send the inbox in the success\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n\n\n        // or error\n    }\n}","import uuid from 'uuid/v4'\n\nexport interface AnError {\n    code: string\n    message: string\n    id: string\n    at: Date\n\n\n    detail?: string\n    history?: Array<AnError>\n    trace?: Array<string>\n    info?: any\n}\n\nexport function makeError(\n    { code, message, detail, history, trace, info }:\n        {\n            code: string, message: string,\n            detail?: string,\n            history?: Array<AnError>, trace?: Array<string>, info?: any\n        }\n) {\n    return {\n        code, message, detail,\n        id: uuid(),\n        at: new Date(),\n        history, trace, info\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\nimport {\n    StoreState,\n    AppError,\n    UIError,\n    UIErrorType,\n    ViewOrgViewModelKind\n} from '../../../types'\n\nimport * as requestModel from '../../../data/models/requests'\nimport { AnError, makeError } from '../../../lib/error';\n\nexport interface CancelJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST\n}\n\nexport interface CancelJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n}\n\nexport interface CancelJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n    requests: Array<requestModel.Request>\n}\n\nexport interface CancelJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n    error: AnError\n}\n\nexport function cancelRequest(requestId: requestModel.RequestID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n        })\n\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'error',\n                    message: 'No view model'\n                }\n            })\n            return\n        }\n\n        // argh\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'invalid state',\n                    message: 'Not the right kind of view model'\n                }\n            })\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await requestClient.cancelRequest(requestId)\n\n            const requests: Array<requestModel.Request> = await requestClient.getRequestOutboxForOrg(viewModel.organization.id)\n\n            dispatch({\n                type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,\n                requests\n            } as CancelJoinRequestSuccess)\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            } as CancelJoinRequestError)\n        }\n    }\n}","import * as React from 'react'\nimport './User.css'\nimport Avatar from './Avatar'\nimport * as userModel from '../../data/models/user'\nimport { Button, Icon } from 'antd';\n\nexport interface UserProps {\n    user: userModel.User\n    avatarSize?: number\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\ninterface UserState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nfunction viewLabel(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return 'Compact'\n        case View.NORMAL:\n            return 'Normal'\n    }\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderCompact() {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                    </div>\n                    <div>\n                        {this.props.user.username}\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNormal() {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                    </div>\n                    <div>\n                        {this.props.user.username}\n                    </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        switch (this.state.view) {\n            case View.COMPACT:\n                return (\n                    <div className=\"User View-COMPACT\">\n                        {this.renderCompact()}\n                    </div>\n                )\n            case View.NORMAL:\n                return (\n                    <div className=\"User View-NORMAL\">\n                        {this.renderNormal()}\n                    </div>\n                )\n        }\n    }\n}\n\nexport default User","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport User from './User'\n\ninterface LoaderProps {\n    userId: userModel.Username\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <User user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.userId)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\n\n\nexport interface OwnProps {\n    userId: userModel.Username\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.userId)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport * as narrativeModel from '../../data/models/narrative'\nimport { Tooltip, Icon, Alert } from 'antd';\nimport './Narrative.css'\nimport UserSimple from './UserContainer';\n\nexport interface NarrativeProps {\n    narrative: narrativeModel.Narrative\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\ninterface NarrativeState {\n    view: View\n}\n\nexport default class Narrative extends React.Component<NarrativeProps, NarrativeState> {\n    constructor(props: NarrativeProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderPublicPermission(narrative: narrativeModel.AccessibleNarrative) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"global\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderUserPermission(narrative: narrativeModel.AccessibleNarrative) {\n        let label\n        switch (narrative.access) {\n            case narrativeModel.NarrativeAccess.VIEW:\n                label = (\n                    <span>View-Only (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.EDIT:\n                label = (\n                    <span>Edit (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.ADMIN:\n                label = 'Admin'\n                break\n            case narrativeModel.NarrativeAccess.OWNER:\n                label = 'Owner'\n                break\n            default:\n                label = 'Unknown'\n        }\n        return (\n            <span>\n                {label}\n            </span>\n        )\n    }\n\n    renderCompact(narrative: narrativeModel.AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div>\n                <div className=\"mainCol\">\n                    <div className=\"Narrative-title\">\n                        <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                            {narrative.title}\n                        </a>\n                    </div>\n                    {' '}\n                    <div className=\"Narrative-owner\">\n                        <UserSimple avatarSize={20} userId={narrative.owner} />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNormal(narrative: narrativeModel.AccessibleNarrative) {\n        // const narrative = this.props.narrative\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div>\n                <div className=\"mainCol\">\n                    <div className=\"mainCol\">\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {' '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            <Icon type=\"crown\" />\n                        </div>\n                        <div className=\"Narrative-global\">\n                            <Icon type=\"global\" />\n                        </div>\n                    </div>\n                    <div>\n                        {this.renderPublicPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">your permission</span>\n                        {this.renderUserPermission(narrative)}\n                    </div>\n                    {/* <div>\n                        <span className=\"field-label\">owner</span>\n                        <UserSimple avatarSize={20} userId={narrative.owner} />\n                    </div> */}\n                    <div>\n                        <span className=\"field-label\">last saved</span>{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(narrative.lastSavedAt)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">by</span>{narrative.lastSavedBy}\n                    </div>\n                </div>\n\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        const narrative = this.props.narrative\n        if (narrative.access === narrativeModel.NarrativeAccess.NONE) {\n            return (\n                <div>\n                    <Icon type=\"exclamation-circle\" style={{ color: 'orange' }} />\n                    {' '}\n                    You don't have access to this Narrative\n                </div>\n            )\n        }\n        switch (this.state.view) {\n            case View.COMPACT:\n                return (\n                    <div className=\"Narrative View-COMPACT\">\n                        {this.renderCompact(narrative)}\n                    </div>\n                )\n            case View.NORMAL:\n                return (\n                    <div className=\"Narrative View-NORMAL\">\n                        {this.renderNormal(narrative)}\n                    </div>\n                )\n        }\n\n    }\n}","import * as React from 'react'\nimport * as narrativeModel from '../../data/models/narrative'\nimport * as orgModel from '../../data/models/organization/model'\nimport Narrative from './Narrative'\n\ninterface LoaderProps {\n    workspaceId: narrativeModel.WorkspaceID\n    narrative: narrativeModel.Narrative | null\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\ninterface LoaderState { }\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.narrative) {\n            return (\n                <Narrative\n                    narrative={this.props.narrative}\n                />\n            )\n        } else {\n            return (\n                <div>\n                    Loading narrative...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.narrative) {\n            this.props.onLoad(this.props.workspaceId)\n        }\n    }\n}\n\n// redux wrapper\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types'\nimport * as actions from '../../redux/actions/entities'\n\nexport interface OwnProps {\n    workspaceId: narrativeModel.WorkspaceID\n}\n\ninterface StateProps {\n    narrative: narrativeModel.Narrative | null\n}\n\ninterface DispatchProps {\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        narrative: state.entities.narratives.byId.get(props.workspaceId) || null\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (workspaceId: narrativeModel.WorkspaceID) => {\n            dispatch(actions.loadNarrative(workspaceId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)\n","import * as React from 'react'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { niceElapsed } from '../../../../../lib/time'\nimport Narrative from '../../../../entities/NarrativeContainer';\nimport User from '../../../../entities/UserContainer';\nimport { Button, Icon } from 'antd';\nimport './InboxRequest.css'\n\nexport interface RequestProps {\n    request: requestModel.Request\n    onAcceptInboxRequest: (request: requestModel.Request) => void\n    onRejectInboxRequest: (request: requestModel.Request) => void\n}\n\ninterface RequestState {\n\n}\n\nexport default class Request extends React.Component<RequestProps, RequestState> {\n    constructor(props: RequestProps) {\n        super(props)\n    }\n\n    onAcceptRequest() {\n        this.props.onAcceptInboxRequest(this.props.request)\n    }\n\n    onRejectRequest() {\n        this.props.onRejectInboxRequest(this.props.request)\n    }\n\n    renderRequestSentSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <User userId={request.user} avatarSize={30} />\n                                </div>\n                            </div>\n                        )\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestRequester(request: requestModel.Request) {\n        return (\n            <User userId={request.requester} avatarSize={30} />\n        )\n    }\n\n    renderRequestReceivedType(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'REQUEST to associate App'\n                    case requestModel.RequestResourceType.USER:\n                        return 'REQUEST to join Organization'\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return 'REQUEST to associate Narrative'\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return 'INVITATION to join Organization'\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestReceivedSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                                <div className=\"cardSectionHeader\">with organization</div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderJoinRequest(request: requestModel.UserRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to join Organization\n                </div>\n\n                <div className=\"cardSectionHeader\">from</div>\n\n                <div className=\"requestSubject\">{this.renderRequestRequester(request)}</div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderWorkspaceRequest(request: requestModel.WorkspaceRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to associate Narrative\n                </div>\n\n                <div className=\"miniDetail\">\n                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                </div>\n\n                <div className=\"cardSectionHeader\">from</div>\n\n                <div className=\"requester miniDetail\">{this.renderRequestRequester(request)}</div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderRequestOptions(request: requestModel.Request) {\n        // First, did the current user make or receive the request\n        return (\n            <div style={{ textAlign: 'center' }}>\n                <Button.Group style={{ marginTop: '4px' }}>\n                    <Button type=\"default\" onClick={this.onAcceptRequest.bind(this)}>\n                        <Icon type=\"check\" />\n                        Accept\n                        </Button>\n                    <Button type=\"danger\" onClick={this.onRejectRequest.bind(this)}>\n                        <Icon type=\"cross\" />\n                        Reject\n                        </Button>\n                    {/* <Button>\n                            <Icon type=\"eye\" />\n                            Visit\n                        </Button> */}\n                </Button.Group>\n            </div>\n        )\n    }\n\n    renderUserInvitation(request: requestModel.UserInvitation) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    INVITATION to join organization\n                </div>\n\n                <div className=\"requestSubject\">{this.renderRequestReceivedSubject(request)}</div>\n\n                <div className=\"cardSectionHeader\">\n                    from\n                </div>\n                <User userId={request.requester} avatarSize={30} />\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderBody() {\n        const request = this.props.request\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderJoinRequest(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return this.renderWorkspaceRequest(request)\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>\n                                    apps not supported yet\n                            </div>\n                            </React.Fragment>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderUserInvitation(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                }\n        }\n    }\n\n    render() {\n        const request = this.props.request\n        return (\n            <div key={request.id} className=\"InboxRequest kbCard\">\n                <div className=\"kbCard-header\">\n                    <div className=\"InboxRequest-requestHeaderRow\">\n                        <div className=\"InboxRequest-requestHeaderCreatedAt\">\n                            {/* <span className=\"field-label\">created</span>\n                                {' '} */}\n                            {Intl.DateTimeFormat('en-US', {\n                                month: 'short',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}\n                        </div>\n                        <div className=\"InboxRequest-requestHeaderExpireAt\">\n                            <span className=\"field-label\">expires</span>\n                            {' '}\n                            {niceElapsed(request.expireAt)}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"kbCard-body\">\n                    {this.renderBody()}\n                </div>\n            </div>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { StoreState } from '../../../../../types';\nimport * as acceptActions from '../../../../../redux/actions/viewOrganization/acceptInboxRequest'\nimport * as rejectActions from '../../../../../redux/actions/viewOrganization/denyInboxRequest'\nimport InboxRequest from './InboxRequest'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onAcceptInboxRequest: (request: requestModel.Request) => void\n    onRejectInboxRequest: (request: requestModel.Request) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAcceptInboxRequest: (request: requestModel.Request) => {\n            dispatch(acceptActions.acceptRequest(request.id) as any)\n        },\n        onRejectInboxRequest: (request: requestModel.Request) => {\n            dispatch(rejectActions.denyRequest(request.id) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(InboxRequest)\n","import * as React from 'react'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { niceElapsed } from '../../../../../lib/time'\nimport Narrative from '../../../../entities/NarrativeContainer';\nimport User from '../../../../entities/UserContainer';\nimport { Button, Icon } from 'antd';\nimport './OutboxRequest.css'\n\nexport interface RequestProps {\n    request: requestModel.Request\n    onCancelOutboxRequest: (request: requestModel.Request) => void\n}\n\ninterface RequestState {\n\n}\n\nexport default class Request extends React.Component<RequestProps, RequestState> {\n    constructor(props: RequestProps) {\n        super(props)\n    }\n\n    // renderRequestSentType(request: requestModel.Request) {\n    //     switch (request.type) {\n    //         case requestModel.RequestType.REQUEST:\n    //             switch (request.resourceType) {\n    //                 case requestModel.RequestResourceType.APP:\n    //                     return 'REQUEST to associate App'\n    //                 case requestModel.RequestResourceType.USER:\n    //                     return 'REQUEST to join Organization'\n    //                 case requestModel.RequestResourceType.WORKSPACE:\n    //                     return 'REQUEST to associate Narrative'\n    //             }\n    //         case requestModel.RequestType.INVITATION:\n    //             switch (request.resourceType) {\n    //                 case requestModel.RequestResourceType.USER:\n    //                     return 'INVITATION to join Organization'\n    //             }\n    //     }\n    //     return 'unknown request'\n    // }\n\n    onCancelRequest() {\n        this.props.onCancelOutboxRequest(this.props.request)\n    }\n\n    onAcceptInvitation() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n    onRejectInvitation() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n\n    onAcceptRequest() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n    onRejectRequest() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n\n\n    renderRequestSentSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <User userId={request.user} avatarSize={30} />\n                                </div>\n                            </div>\n                        )\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestRequester(request: requestModel.Request) {\n        return (\n            <User userId={request.requester} avatarSize={30} />\n        )\n    }\n\n    renderRequestReceivedType(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'REQUEST to associate App'\n                    case requestModel.RequestResourceType.USER:\n                        return 'REQUEST to join Organization'\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return 'REQUEST to associate Narrative'\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return 'INVITATION to join Organization'\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestReceivedSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                                <div className=\"cardSectionHeader\">with organization</div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return (\n                            <User userId={request.user} avatarSize={30} />\n                        )\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderJoinRequest(request: requestModel.UserRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to join Organization\n                </div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderWorkspaceRequest(request: requestModel.WorkspaceRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to associate Narrative\n                </div>\n\n                <div className=\"miniDetail\">\n                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                </div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderRequestOptions(request: requestModel.Request) {\n        // First, did the current user make or receive the request\n        return (\n            <div style={{ textAlign: 'center' }}>\n                <Button.Group style={{ marginTop: '4px' }}>\n                    <Button type=\"danger\" onClick={this.onCancelRequest.bind(this)}>\n                        <Icon type=\"cross\" />Cancel\n                        </Button>\n                    {/* <Button onClick={this.onVisitOrg.bind(this)}>\n                            <Icon type=\"eye\" />Visit \n                        </Button> */}\n                </Button.Group>\n            </div>\n        )\n\n    }\n\n    renderUserInvitation(request: requestModel.UserInvitation) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    INVITATION to join organization\n                </div>\n\n                <div className=\"cardSectionHeader\">\n                    sent to\n                </div>\n\n                <div className=\"miniDetail\">\n                    {this.renderRequestReceivedSubject(request)}\n                </div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderBody() {\n        const request = this.props.request\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderJoinRequest(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return this.renderWorkspaceRequest(request)\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>\n                                    apps not supported yet\n                            </div>\n                            </React.Fragment>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderUserInvitation(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                }\n        }\n    }\n\n    render() {\n        const request = this.props.request\n        return (\n            <div key={request.id} className=\"OutboxRequest kbCard\">\n                <div className=\"kbCard-header\">\n                    <div className=\"OutboxRequest-requestHeaderRow\">\n                        <div className=\"OutboxRequest-requestHeaderCreatedAt\">\n                            {/* <span className=\"field-label\">created</span>\n                                {' '} */}\n                            {Intl.DateTimeFormat('en-US', {\n                                month: 'short',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}\n                        </div>\n                        <div className=\"OutboxRequest-requestHeaderExpireAt\">\n                            <span className=\"field-label\">expires</span>\n                            {' '}\n                            {niceElapsed(request.expireAt)}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"kbCard-body\">\n                    {this.renderBody()}\n                </div>\n            </div>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { StoreState } from '../../../../../types';\nimport * as cancelActions from '../../../../../redux/actions/viewOrganization/cancelOutboxRequest'\nimport OutboxRequest from './OutboxRequest'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onCancelOutboxRequest: (request: requestModel.Request) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onCancelOutboxRequest: (request: requestModel.Request) => {\n            dispatch(cancelActions.cancelRequest(request.id) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(OutboxRequest)","import * as React from 'react'\n\nimport './component.css'\nimport Header from '../../../../Header'\nimport { Icon, Button, Modal, Card } from 'antd'\nimport User from '../../../../entities/UserContainer'\nimport Narrative from '../../../../entities/NarrativeContainer'\nimport * as requestModel from '../../../../../data/models/requests'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport { niceElapsed } from '../../../../../lib/time'\nimport InboxRequest from './InboxRequestContainer'\nimport OutboxRequest from './OutboxRequestContainer'\n\nexport interface RequestsProps {\n    inbox: Array<requestModel.Request>\n    outbox: Array<requestModel.Request>\n    relation: orgModel.Relation\n    // organizationId: string,\n    // viewModel: types.\n    // onStart: (organizationId: string) => void,\n    onAcceptJoinRequest: (request: requestModel.Request) => void\n    onDenyJoinRequest: (request: requestModel.Request) => void\n    onCancelJoinInvitation: (request: requestModel.Request) => void\n    onGetViewAccess: (request: requestModel.Request) => void\n}\n\nexport interface RequestsState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\nclass ManageGroupRequests extends React.Component<RequestsProps, RequestsState> {\n\n    constructor(props: RequestsProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n\n        // this.props.onStart(this.props.organizationId)\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n    onAcceptJoinRequest(request: requestModel.Request) {\n        this.props.onAcceptJoinRequest(request)\n    }\n    onDenyJoinRequest(request: requestModel.Request) {\n        this.props.onDenyJoinRequest(request)\n    }\n    onCancelJoinInvitation(request: requestModel.Request) {\n        this.props.onCancelJoinInvitation(request)\n    }\n    onGetViewAccess(request: requestModel.Request) {\n        this.props.onGetViewAccess(request)\n    }\n    onViewProfile(username: string) {\n        window.open('/#people/' + username, '_blank')\n    }\n    onShowInfo() {\n        Modal.info({\n            title: 'Manage Requests Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the manage requests tool...</p>\n                </div>\n            )\n        })\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org Editor...\n            </span>\n        )\n\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderRequestJoinRequest(request: requestModel.UserRequest) {\n        const title = (\n            <span>\n                <Icon type=\"user\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User userId={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestJoinInvitation(request: requestModel.UserInvitation) {\n        const title = (\n            <span>\n                <Icon type=\"team\" />\n                <Icon type=\"mail\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"user\" />\n\n                {' '}\n                Invitation to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onCancelJoinInvitation.call(this, request)}>\n                Cancel\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>invitation to</th>\n                            <td className=\"requester\">\n                                <User userId={request.user} avatarSize={30} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderNarrativePermission(permission: orgModel.UserWorkspacePermission) {\n        switch (permission) {\n            case orgModel.UserWorkspacePermission.NONE:\n                return 'None'\n            case orgModel.UserWorkspacePermission.VIEW:\n                return 'View Only'\n            // return 'View and Copy'\n            case orgModel.UserWorkspacePermission.EDIT:\n                return 'Edit'\n            // return 'View, Copy, Save, Run'\n            case orgModel.UserWorkspacePermission.ADMIN:\n                return 'Admin'\n            // return 'View, Copy, Save, Run, Manage Sharing'\n            case orgModel.UserWorkspacePermission.OWNER:\n                return 'Owner'\n            // return 'View, Copy, Save, Run, Manage Sharing, Own'\n        }\n    }\n\n    renderRequestNarrativeRequest(request: requestModel.WorkspaceRequest) {\n        const title = (\n            <span>\n                <Icon type=\"file\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add Narrative\n            </span>\n        )\n\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request)}>\n                Deny\n            </Button>\n        ]\n\n        let narrativeAccess\n        narrativeAccess = (\n            <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n        )\n        // TODO: Revive me!!\n        // if (request.narrativeId) {\n        //     // TODO: note the '1' below -- we dont' get the object id from the groups service,\n        //     // and the narrative will soon accept just the workspace id (and will look up the object id by itself)\n        //     // but not yet, so we just use 1, which is INCORRECT.\n        //     narrativeAccess = (\n        //         <div>\n        //             <div>\n        //                 <a href={\"/narrative/ws.\" + request.narrativeId + '.obj.' + '1'} target=\"_blank\">{request.title}</a>\n        //             </div>\n        //             <div>\n        //                 <span className=\"field-label\">your access</span>{' '}{this.renderNarrativePermission(request.narrative.permission)}\n        //             </div>\n        //             <div>\n        //                 <span className=\"field-label\">public?</span>{' '}{request.isPublic ? 'yes' : 'no'}\n        //             </div>\n\n        //         </div>\n        //     )\n        // } else {\n        //     narrativeAccess = (\n        //         <span>\n        //             You don't have access to this narrative\n        //             {' '}\n        //             <Button\n        //                 onClick={() => { this.onGetViewAccess.call(this, request.id) }}>\n        //                 Click for View Access\n        //             </Button>\n        //         </span>\n        //     )\n        // }\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User userId={request.requester} avatarSize={30} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>narrative</th>\n                            <td className=\"narrative\">\n                                {narrativeAccess}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestAppRequest(request: requestModel.AppRequest) {\n        const title = (\n            <span>\n                <Icon type=\"appstore\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add App\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User userId={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>app</th>\n                            <td className=\"requester\">\n                                {request.appId}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderInbox() {\n        let inbox\n        if (this.props.inbox.length === 0) {\n            inbox = (\n                <div className=\"Message\">\n                    No pending requests for you\n                </div>\n            )\n        } else {\n            const requests = this.props.inbox.map((request) => {\n                return (\n                    <div key={request.id}>\n                        <InboxRequest\n                            request={request} />\n                    </div>\n                )\n            })\n            inbox = (\n                <div style={{ overflowY: 'auto' }}>\n                    {requests}\n                </div>\n            )\n        }\n        return (\n            <React.Fragment>\n                {inbox}\n            </React.Fragment>\n        )\n    }\n\n    renderOutbox() {\n        let outbox\n        if (this.props.outbox.length === 0) {\n            outbox = (\n                <div className=\"Message\">\n                    No pending requests from you\n                </div>\n            )\n        } else {\n            const requests = this.props.outbox.map((request) => {\n                return (\n                    <div key={request.id}>\n                        <OutboxRequest\n                            request={request} />\n                    </div>\n                )\n            })\n            outbox = (\n                <div style={{ overflowY: 'auto' }}>\n                    {requests}\n                </div>\n            )\n        }\n        return (\n            <React.Fragment>\n                {outbox}\n            </React.Fragment>\n        )\n    }\n\n    isAdmin(relation: orgModel.Relation): boolean {\n        return (\n            relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER\n        )\n    }\n\n    render() {\n        if (this.isAdmin(this.props.relation)) {\n            const outboxCount = this.props.outbox.length\n            const inboxCount = this.props.inbox.length\n\n            return (\n                <div className=\"Requests\">\n                    <div className=\"ViewOrganization-tabPaneHeader\">inbox ({inboxCount})</div>\n                    {this.renderInbox()}\n                    <div className=\"ViewOrganization-tabPaneHeader\">outbox ({outboxCount})</div>\n                    {this.renderOutbox()}\n                </div>\n            )\n        } else {\n            const outboxCount = this.props.outbox.length\n\n            return (\n                <div className=\"Requests\">\n                    <div className=\"ViewOrganization-tabPaneHeader\">outbox ({outboxCount})</div>\n                    {this.renderOutbox()}\n                </div>\n            )\n        }\n    }\n}\n\nexport default ManageGroupRequests\n","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../../../types'\nimport * as acceptActions from '../../../../../redux/actions/viewOrganization/acceptInboxRequest'\nimport * as rejectActions from '../../../../../redux/actions/viewOrganization/denyInboxRequest'\nimport * as cancelRequestActions from '../../../../../redux/actions/viewOrganization/cancelOutboxRequest'\nimport * as requestModel from '../../../../../data/models/requests'\nimport * as orgModel from '../../../../../data/models/organization/model'\n\nimport Component from './component'\n\nexport interface OwnProps {\n    inbox: Array<requestModel.Request>\n    outbox: Array<requestModel.Request>\n    relation: orgModel.Relation\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onAcceptJoinRequest: (request: requestModel.Request) => void\n    onDenyJoinRequest: (request: requestModel.Request) => void\n    onCancelJoinInvitation: (request: requestModel.Request) => void\n    onGetViewAccess: (request: requestModel.Request) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {}\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAcceptJoinRequest: (request: requestModel.Request) => {\n            dispatch(acceptActions.acceptRequest(request.id) as any)\n        },\n        onDenyJoinRequest: (request: requestModel.Request) => {\n            dispatch(rejectActions.denyRequest(request.id) as any)\n        },\n        onCancelJoinInvitation: (request: requestModel.Request) => {\n            dispatch(cancelRequestActions.cancelRequest(request.id) as any)\n        },\n        onGetViewAccess: (request: requestModel.Request) => {\n            // dispatch(actions.getViewAccess(requestId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)\n\n","import * as React from 'react'\nimport { Marked } from 'marked-ts'\nimport { NavLink, Redirect } from 'react-router-dom'\n\nimport './component.css'\n\nimport { } from '../../../../types'\nimport { Button, Modal, Icon, Tooltip, Card, Dropdown, Menu, Alert, Tabs } from 'antd'\nimport Header from '../../../Header'\nimport Member from '../../../entities/MemberContainer'\nimport OrganizationHeader from '../../organizationHeader/loader'\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\nimport * as feedsModel from '../../../../data/models/feeds'\nimport OrganizationNarrative from '../../../OrganizationNarrative'\nimport MainMenu from '../../../menu/component';\nimport Members from './members/reduxAdapter'\n\nimport Requests from './requests/container'\nimport BriefOrganization from '../../organizationHeader/BriefOrganization';\n\nenum NavigateTo {\n    NONE = 0,\n    REQUEST_ADD_NARRATIVE,\n    MANAGE_MEMBERSHIP,\n    VIEW_MEMBERS,\n    MANAGE_REQUESTS,\n    VIEW_ORGANIZATION,\n    EDIT_ORGANIZATION,\n    INVITE_USER\n}\n\nenum AccordionState {\n    UP = 0,\n    DOWN\n}\n\nexport interface ViewOrganizationState {\n    showInfo: boolean\n    navigateTo: NavigateTo\n    requestAccess: {\n        narrative: orgModel.NarrativeResource | null\n    }\n    accordionState: AccordionState\n}\n\nexport interface ViewOrganizationProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    openRequest: orgModel.RequestStatus\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n    requestOutbox: Array<requestModel.Request>\n    requestInbox: Array<requestModel.Request>\n    notifications: Array<feedsModel.OrganizationNotification>\n    onViewOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: requestModel.RequestID) => void\n    onAcceptInvitation: (requestId: requestModel.RequestID) => void\n    onRejectInvitation: (requestId: requestModel.RequestID) => void\n    onRemoveNarrative: (narrative: orgModel.NarrativeResource) => void\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n    onAcceptRequest: (requestId: requestModel.RequestID) => void\n    onReadNotification: (requestId: requestModel.RequestID) => void\n}\n\nclass ViewOrganization extends React.Component<ViewOrganizationProps, ViewOrganizationState> {\n    constructor(props: ViewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            showInfo: false,\n            navigateTo: NavigateTo.NONE,\n            requestAccess: {\n                narrative: null\n            },\n            accordionState: AccordionState.UP\n        }\n    }\n\n    onViewMembers() {\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n    }\n\n    onCancelJoinRequest() {\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n    }\n\n    onAcceptInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n    }\n\n    onRejectInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n    }\n\n    onRequestAddNarrative() {\n        this.setState({ navigateTo: NavigateTo.REQUEST_ADD_NARRATIVE })\n    }\n\n    onRemoveNarrative(narrative: orgModel.NarrativeResource) {\n        this.props.onRemoveNarrative(narrative)\n    }\n\n    onNarrativeMenu(key: string, narrative: orgModel.NarrativeResource) {\n        switch (key) {\n            case 'removeNarrative':\n                this.props.onRemoveNarrative(narrative)\n                break\n        }\n    }\n\n    onShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'View Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    Organization help here...\n                </div>\n            )\n        })\n    }\n\n    onRequestShare(narrative: orgModel.NarrativeResource) {\n        // Drawer.\n        // Drawer.open({\n        //     title: 'Request Access to Narrative',\n        //     content: 'Are you sure?'\n        // })\n        this.setState({ requestAccess: { narrative: narrative } })\n        // alert('not yet implemented')\n    }\n\n    onCloseRequestAccess() {\n        this.setState({ requestAccess: { narrative: null } })\n    }\n\n    buildFooter() {\n        return (\n            <div>\n                {this.renderEditRow()}\n                {/* <p style={{ textAlign: 'center' }}>\n                    You may also  <NavLink to={`/organizations`}><Button type=\"danger\" icon=\"undo\">Return to Orgs</Button></NavLink> to the organizations browser.\n                </p> */}\n            </div>\n        )\n    }\n\n    renderEditRow() {\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            return (\n                <p style={{ textAlign: 'center' }}>\n                    As the owner of this group, you may <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink> it.\n                </p>\n            )\n        }\n    }\n\n    renderEditButton() {\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            return (\n                <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit This Organization</Button></NavLink>\n            )\n        }\n    }\n\n    renderOrg() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <div className=\"ViewOrganization-org-description-org scrollable-flex-column\">\n                <div className=\"ViewOrganization-org-description\"\n                    dangerouslySetInnerHTML={({ __html: Marked.parse(this.props.organization.description || '') })}\n                />\n            </div>\n        )\n    }\n\n    // TODO: this should be a component, so we can pick up all the good stuff, which is now commented out...\n    renderOwnerInfo(org: orgModel.Organization) {\n        return (\n            <div className=\"ownerTable\">\n                <div className=\"proprietorCol\">\n\n                    <div className=\"owner\">\n                        <a href={\"/#people/\" + org.owner.username} target=\"_blank\">{org.owner.username}</a>\n                        {' '}\n                        ❨{org.owner.username}❩\n                                </div>\n                    {/* <div className=\"profileOrganization\">\n                        {org.owner.user.organization}\n                    </div>\n                    <div className=\"profileOrganization\">\n                        {org.owner.user.city}, {org.owner.user.state}, {org.owner.user.country}\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    renderRelation(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <div><Icon type=\"eye\" style={{ marginRight: '4px' }} />You are not a member of this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button\n                                onClick={this.onJoinClick.bind(this)}>\n                                Join this Organization\n                            </Button>\n                        </div>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'orange' }} spin={true} />Your membership <b>request</b> is pending</div>\n                        <div><Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button></div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'blue' }} />You have been <b>invited</b> to join this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                            <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                        </div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" />Member</span>)\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />Admin</span>)\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You own this org\"\n                    >\n                        <span><Icon type=\"unlock\" theme=\"filled\" style={{ marginRight: '4px' }} />You own this organization</span>\n                    </Tooltip>\n                )\n        }\n    }\n\n    isMember(): boolean {\n        if (!this.props.organization) {\n            return false\n        }\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.MEMBER) {\n            return true\n        }\n        return false\n    }\n\n    renderMembers() {\n        if (!this.isMember()) {\n            return (\n                <p className=\"message\">\n                    Organization membership restricted to members only\n                </p>\n            )\n        }\n        return (\n            <Members organization={this.props.organization} relation={this.props.relation} />\n        )\n\n    }\n\n    renderInfo() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <Card\n                title={<span><Icon type=\"info-circle\"></Icon> info</span>}\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                className=\"slimCard\">\n                <div>\n                    <div>\n                        <div className=\"label\">owner</div>\n                    </div>\n                    <div className=\"ViewOrganization-ownerTable\">\n                        <Member member={this.props.organization.owner} avatarSize={50} />\n                        {/* TODO: fix avatar component */}\n                        {/* <div className=\"avatarCol\">\n                            <Avatar user={this.props.organization.owner.username} size={60} />\n                        </div>\n                        <div className=\"proprietorCol\">\n                            <div className=\"owner\">\n                                <a href={\"/#people/\" + this.props.organization.owner.user.username} target=\"_blank\">{this.props.organization.owner.user.realname}</a>\n                                {' '}\n                                ❨{this.props.organization.owner.user.username}❩\n                                        </div>\n                            <div className=\"profileOrganization\">\n                                {this.props.organization.owner.user.organization}\n                            </div>\n                            <div className=\"profileOrganization\">\n                                {this.props.organization.owner.user.city}, {this.props.organization.owner.user.state}, {this.props.organization.owner.user.country}\n                            </div>\n                        </div> */}\n                    </div>\n                    <div className='ViewOrganization-infoTable'>\n                        <div className=\"row\">\n                            <div className=\"col1\">\n                                <span className=\"label\">established</span>\n                            </div>\n                            <div className=\"col2\">\n                                <div className=\"createdAt\">\n                                    {Intl.DateTimeFormat('en-US', {\n                                        month: 'long',\n                                        day: 'numeric',\n                                        year: 'numeric'\n                                    }).format(this.props.organization.createdAt)}\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"row\">\n                            <div className=\"col1\">\n                                <span className=\"label\">last updated</span>\n                            </div>\n                            <div className=\"col2\">\n                                <div className=\"modifiedAt\">\n                                    {Intl.DateTimeFormat('en-US', {\n                                        month: 'long',\n                                        day: 'numeric',\n                                        year: 'numeric'\n                                    }).format(this.props.organization.modifiedAt)}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </Card>\n        )\n    }\n\n    renderGroupRequestsRow() {\n        const relation = this.props.relation\n        const requests = this.props.groupRequests\n        const invitations = this.props.groupInvitations\n\n        if (!(relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        // TODO: bad. should not get here in this case...\n        if (requests === null || invitations === null) {\n            return\n        }\n        let inner\n        if (requests.length) {\n            inner = (\n                <div>\n                    group has no pending requests\n                </div>\n            )\n        } else {\n            inner = (\n                <div>\n                    <div>\n                        <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> group has\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{requests.length}</span>\n                        {' '}\n                        pending request{requests.length > 1 ? 's' : ''}\n                        {' '}\n                        and\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{invitations.length}</span>\n                        {' '}\n                        pending request{invitations.length > 1 ? 's' : ''}\n\n                    </div>\n                    <div>\n                        <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization.id}>\n                            <Button>Manage Requests</Button>\n                        </NavLink>\n                    </div>\n                </div>\n            )\n        }\n        return (\n            <div className=\"row\">\n                <div className=\"col1\">\n                    <span className=\"label\">admin</span>\n                </div>\n                <div className=\"col2\">\n                    <div className=\"relation\">\n                        {inner}\n                    </div>\n                </div>\n            </div>\n\n        )\n    }\n\n    renderGroupRequests(requests: Array<requestModel.Request>, invitations: Array<requestModel.Request>) {\n        if (!requests.length) {\n            return (\n                <div className=\"message\">\n                    No pending group requests\n                </div>\n            )\n        } else {\n            return (\n                <div>\n                    <div>\n                        <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> There\n                        {' '}\n                        {requests.length > 1 ? 'are' : 'is'}\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{requests.length}</span>\n                        {' '}\n                        pending request{requests.length > 1 ? 's' : ''}\n                        {' '}\n                        and\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{invitations.length}</span>\n                        {' '}\n                        pending invitation{invitations.length > 1 ? 's' : ''}\n                    </div>\n                    <div>\n                        <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization!.id}>\n                            <Button>Manage Requests</Button>\n                        </NavLink>\n                    </div>\n                </div>\n            )\n        }\n        // return (\n        //     <div className=\"row\">\n        //         <div className=\"col1\">\n        //             <span className=\"label\">admin</span>\n        //         </div>\n        //         <div className=\"col2\">\n        //             <div className=\"relation\">\n        //                 {inner}\n        //             </div>\n        //         </div>\n        //     </div>\n\n        // )\n\n        // return (\n        //     <div>\n        //         <div>\n        //             <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> group has\n        //             {' '}\n        //             <span style={{ fontWeight: 'bold' }}>{org.adminRequests.length}</span>\n        //             {' '}\n        //             pending request{org.adminRequests.length > 1 ? 's' : ''}\n        //         </div>\n        //         <div>\n        //             <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization!.id}>\n        //                 <Button>Manage Requests</Button>\n        //             </NavLink>\n        //         </div>\n        //     </div>\n        // )\n    }\n\n    renderRelationClass(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'infoBox relationRequestPending'\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'infoBox relationInvitationPending'\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return 'infoBox'\n        }\n    }\n\n    renderUserRelationship() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        return (\n            <form className=\"infoTable\">\n                {/* <div className=\"row\">\n                    <div className=\"col1\">\n                        <span className=\"label\">your relation</span>\n                    </div>\n                    <div className=\"col2\">\n                        <div className='relation'>\n                            {this.renderRelation(this.props.organization)}\n                        </div>\n                    </div>\n                </div> */}\n                {this.renderGroupRequestsRow()}\n            </form>\n        )\n    }\n\n    renderAdminTasks() {\n        const relation = this.props.relation\n        if (!(relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        // TODO: ditto -- silly to test both conditions (this is only to make TS happy btw)\n        const { groupRequests, groupInvitations } = this.props\n        if (groupInvitations === null || groupRequests === null) {\n            return\n        }\n        const count = groupRequests.length + groupInvitations.length\n        const title = (\n            <span><Icon type=\"unlock\" />\n                {' '}\n                group requests\n                {' '}\n                <span className=\"ViewOrganization-titleCount\">({count})</span>\n            </span>\n        )\n        return (\n            <div className=\"ViewOrganization-adminTasksBox\">\n                <Card\n                    className=\"slimCard ViewOrganization-adminTasksCard\"\n                    headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                    title={title} >\n                    {this.renderGroupRequests(groupRequests, groupInvitations)}\n                </Card>\n            </div>\n        )\n    }\n\n    renderJoinButton() {\n        if (!this.props.organization) {\n            return\n        }\n        if (this.props.relation.type !== orgModel.UserRelationToOrganization.VIEW) {\n            return\n        }\n        return (\n            <Button\n                onClick={this.onJoinClick.bind(this)}\n            >\n                Join this Organization\n                </Button>\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org...\n            </span>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderMembersCard() {\n        const extras = [\n            (\n                <NavLink\n                    key=\"viewMembers\"\n                    to={`/viewMembers/${this.props.organization!.id}`}>\n                    <Button\n                        onClick={this.onViewMembers.bind(this)}\n                        icon=\"team\"></Button>\n                </NavLink>\n            )\n        ]\n        if (!this.props.organization) {\n            return\n        }\n\n        let memberCount\n        if (this.isMember()) {\n            memberCount = (\n                <span className=\"titleCount\">({this.props.organization.members.length})</span>\n            )\n        } else {\n            memberCount = ''\n        }\n        const title = (\n            <span>\n                <Icon type=\"team\" />\n                members\n                {memberCount}\n            </span>\n        )\n        return (\n            <Card\n                className=\"slimCard membersCard\"\n                headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                title={title}\n                extra={extras}\n            >\n                {this.renderMembers()}\n            </Card>\n        )\n    }\n\n    renderMembersTab() {\n        return (\n            <div className=\"scrollable-flex-column\">\n                {this.renderMembersToolbar()}\n\n                {this.renderMembers()}\n            </div>\n        )\n    }\n\n    onAcceptRequest(request: requestModel.Request) {\n        this.props.onAcceptRequest(request.id)\n    }\n\n    renderNarrativeMenu(narrative: orgModel.NarrativeResource) {\n        const relation = this.props.relation\n        const isAdmin = (relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            relation.type === orgModel.UserRelationToOrganization.ADMIN)\n        let menu\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                // should never occur\n                break;\n            case (orgModel.UserRelationToOrganization.VIEW):\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                break;\n            case (orgModel.UserRelationToOrganization.ADMIN):\n            case (orgModel.UserRelationToOrganization.OWNER):\n                menu = (\n                    <Menu onClick={({ key }) => { this.onNarrativeMenu(key, narrative) }}>\n                        <Menu.Item key=\"removeNarrative\">\n                            <Icon type=\"delete\" /> Remove Narrative from Organization\n                        </Menu.Item>\n                    </Menu>\n                )\n        }\n        if (!menu) {\n            return\n        }\n        return (\n            <Dropdown overlay={menu} trigger={['click']}>\n                <Icon type=\"ellipsis\" className=\"IconButton-hover\" />\n            </Dropdown>\n        )\n    }\n\n    renderNarratives() {\n        if (!this.isMember()) {\n            return (\n                <Card\n                    className=\"slimCard  narratives\"\n                    title={<span><Icon type=\"folder-open\" /></span>}\n                >\n                    <p style={{ textAlign: 'center', fontStyle: 'italic' }}>\n                        Narratives are restricted to members only\n                </p>\n                </Card>\n            )\n        }\n\n        const extras = [\n            (\n                <NavLink\n                    key=\"requestAddNarrative\"\n                    to={`/requestAddNarrative/${this.props.organization!.id}`}>\n                    <Button\n                        onClick={this.onRequestAddNarrative.bind(this)}>\n                        <Icon type=\"plus\" /> Add a Narrative\n                    </Button>\n                </NavLink>\n            )\n        ]\n\n        if (this.props.organization.narratives.length === 0) {\n            const message = (\n                <div className=\"message\">\n                    No Narratives are yet associated with this Organization\n                </div>\n            )\n            return (\n                <Card\n                    className=\"slimCard  narratives\"\n                    headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                    title={<span><Icon type=\"folder-open\" /> Narratives (Ø)</span>}\n                    extra={extras}\n                >\n                    <Alert type=\"info\" message={message} />\n                </Card>\n            )\n        }\n\n        const narrativesTable = this.props.organization.narratives.map((narrative) => {\n            // create buttons or not, depending on being an admin\n            return (\n                <div className=\"narrative simpleCard\" key={String(narrative.workspaceId)}>\n                    <div className=\"dataCol\">\n                        <OrganizationNarrative\n                            narrative={narrative}\n                            onGetViewAccess={this.props.onGetViewAccess} />\n                    </div>\n                    <div className=\"buttonCol\">\n                        {this.renderNarrativeMenu(narrative)}\n                    </div>\n                </div>\n            )\n        })\n\n        const narrativeCount = this.props.organization.narratives.length\n        const title = (\n            <span>\n                <Icon type=\"folder-open\" />\n                Narratives\n                {' '}\n                <span className=\"titleCount\">({narrativeCount})</span>\n            </span>\n        )\n        return (\n            <Card\n                className=\"slimCard narratives narrativesCard scrollable-flex-column\"\n                title={title}\n                extra={extras}\n            >\n                <div className=\"narrativesTable\">\n                    {narrativesTable}\n                </div>\n            </Card>\n        )\n    }\n\n    renderMembersToolbar() {\n        switch (this.props.relation.type) {\n            case orgModel.UserRelationToOrganization.NONE:\n                return\n            case orgModel.UserRelationToOrganization.MEMBER:\n                return\n            case orgModel.UserRelationToOrganization.ADMIN:\n                return (\n                    <div className=\"ViewOrganization-tabPaneToolbar\">\n                        <NavLink to={\"/inviteUser/\" + this.props.organization.id}>\n                            <Button size=\"small\"><Icon type=\"mail\" /> Invite a User</Button>\n                        </NavLink>\n                    </div>\n                )\n\n            case orgModel.UserRelationToOrganization.OWNER:\n                return (\n                    <div className=\"ViewOrganization-tabPaneToolbar\">\n                        <NavLink to={\"/inviteUser/\" + this.props.organization.id}>\n                            <Button size=\"small\"><Icon type=\"mail\" /> Invite a User</Button>\n                        </NavLink>\n                    </div>\n                )\n\n        }\n    }\n\n    renderCombo() {\n        const isAdmin = (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER)\n\n        const isMember = this.props.organization.isMember\n\n        if (!isMember) {\n            return (\n                <p style={{ fontStyle: 'italic' }}>\n                    The membership list is only available to members.\n                </p>\n            )\n        }\n\n        const tabs = []\n\n        let memberCount\n        if (this.props.organization.memberCount - 1) {\n            memberCount = String(this.props.organization.memberCount - 1)\n        } else {\n            memberCount = 'Ø'\n        }\n        tabs.push((\n            <Tabs.TabPane\n                tab={<span><Icon type=\"team\" />Members <span className=\"ViewOrganization-tabCount\">({memberCount})</span></span>}\n                key=\"members\"\n                style={{ flexDirection: 'column' }}>\n                {this.renderMembersTab()}\n            </Tabs.TabPane>\n        ))\n\n        if (isMember) {\n            if (isAdmin) {\n                const totalRequestCount = this.props.requestInbox.length + this.props.requestOutbox.length\n                const totalRequests = (\n                    <span className=\"ViewOrganization-tabCount\">\n                        ({totalRequestCount || 'Ø'})\n                    </span>\n                )\n                tabs.push((\n                    <Tabs.TabPane tab={<span><Icon type=\"inbox\" />Requests {totalRequests} </span>} key=\"inbox\" style={{ flexDirection: 'column' }}>\n                        <Requests inbox={this.props.requestInbox} outbox={this.props.requestOutbox} relation={this.props.relation} />\n                    </Tabs.TabPane>\n                ))\n            } else {\n                const outboxSize = this.props.requestOutbox.length\n                let titleCount\n                if (outboxSize) {\n                    titleCount = String(outboxSize)\n                } else {\n                    titleCount = 'Ø'\n                }\n                tabs.push((\n                    <Tabs.TabPane tab={<span><Icon type=\"inbox\" />Requests <span className=\"ViewOrganization-tabCount\">({titleCount})</span></span>} key=\"outbox\" style={{ flexDirection: 'column' }}>\n                        <Requests inbox={[]} outbox={this.props.requestOutbox} relation={this.props.relation} />\n                    </Tabs.TabPane>\n                ))\n            }\n        }\n\n        return (\n            <Tabs\n                defaultActiveKey=\"members\"\n                className=\"ViewOrganization-tabs\"\n                animated={false}\n                size=\"small\"\n                tabPosition=\"top\"\n            >\n                {tabs}\n            </Tabs>\n        )\n    }\n\n    renderMenuButtons() {\n        return (\n            <span className=\"ButtonSet\">\n                <span className=\"ButtonSet-button\">\n                    {this.renderOrgMenu()}\n                </span>\n\n                <span className=\"ButtonSet-button\">\n                    <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                </span>\n            </span>\n        )\n    }\n\n    onNavigateToMembership() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_MEMBERSHIP })\n    }\n\n    onNavigateToViewMembers() {\n        this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n    }\n\n    onNavigateToManageRequests() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n    }\n\n    onNavigateToEditOrganization() {\n        this.setState({ navigateTo: NavigateTo.EDIT_ORGANIZATION })\n    }\n\n    onNavigateToInviteUser() {\n        this.setState({ navigateTo: NavigateTo.INVITE_USER })\n    }\n\n    onNavigateToViewOrganization() {\n        this.setState({ navigateTo: NavigateTo.VIEW_ORGANIZATION })\n    }\n\n    onMenuClick({ key }: { key: string }) {\n        switch (key) {\n            case 'manageMyMembership':\n                this.setState({ navigateTo: NavigateTo.MANAGE_MEMBERSHIP })\n                break\n            case 'viewMembers':\n                this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n                break\n            case 'editOrg':\n                this.setState({ navigateTo: NavigateTo.EDIT_ORGANIZATION })\n                break\n            case 'inviteUser':\n                this.setState({ navigateTo: NavigateTo.INVITE_USER })\n                break\n            case 'manageRequests':\n                this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n                break\n        }\n    }\n\n    renderOrgMenu() {\n        const org = this.props.organization\n        switch (this.props.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                // return (\n                //     <span><Icon type=\"stop\" />None</span>\n                // )\n                return (\n                    <span>\n                        <Button\n                            type=\"primary\"\n                            onClick={this.onJoinClick.bind(this)}>\n                            Join this Organization\n                        </Button>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <span>\n                        <Button\n                            type=\"primary\"\n                            onClick={this.onJoinClick.bind(this)}>\n                            Join this Organization\n                        </Button>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <span>\n                        <Tooltip\n                            placement=\"bottom\"\n                            mouseEnterDelay={0.5}\n                            title=\"You have requested to join this Org; you may cancel your join request with this button\"\n                        >\n                            <Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Join Request</Button>\n                        </Tooltip>\n                    </span>\n\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <span>\n                        <span>You have been invited to this organization: </span>\n                        <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept</Button>\n                        <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject</Button>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                const menu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            Manage My Membership\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <span>\n                        <Dropdown overlay={menu} trigger={['click']}>\n                            <Button shape=\"circle\">\n                                <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                            </Button>\n                        </Dropdown>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                const adminMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" >\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <span>\n                        <Dropdown overlay={adminMenu} trigger={['click']}>\n                            <Button shape=\"circle\">\n                                <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                            </Button>\n                        </Dropdown>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                const ownerMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"editOrg\">\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <span>\n                        <Dropdown overlay={ownerMenu} trigger={['click']}>\n                            <Button shape=\"circle\">\n                                <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                            </Button>\n                        </Dropdown>\n                    </span>\n                )\n        }\n    }\n\n\n    toggleAccordion() {\n        this.setState({\n            accordionState: this.state.accordionState === AccordionState.UP ? AccordionState.DOWN : AccordionState.UP\n        })\n    }\n\n    renderAccordionControl() {\n        let iconType\n        if (this.state.accordionState === AccordionState.UP) {\n            iconType = 'caret-down'\n        } else {\n            iconType = 'caret-up'\n        }\n        return (\n            <div className=\"ViewOrganization-accordion\" onClick={this.toggleAccordion.bind(this)}>\n                <div className=\"ViewOrganization-accordionCol1\">\n                    <div className=\"ViewOrganization-accordionRow1\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow2\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow3\">\n                    </div>\n                </div>\n                <div className=\"ViewOrganization-accordionCol2\">\n                    <div className=\"ViewOrganization-accordionRow1\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow2\">\n                        <Icon type={iconType} />\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow3\">\n                    </div>\n                    {/* <div className=\"ViewOrganization-accordionIcon\">\n                        <Icon type={iconType} />\n                    </div> */}\n                </div>\n                <div className=\"ViewOrganization-accordionCol3\">\n                    <div className=\"ViewOrganization-accordionRow1\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow2\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow3\">\n                    </div>\n                </div>\n\n\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.state.navigateTo) {\n            case NavigateTo.REQUEST_ADD_NARRATIVE:\n                return (\n                    <Redirect to={\"/requestAddNarrative\"} />\n                )\n            case NavigateTo.MANAGE_MEMBERSHIP:\n                return <Redirect push to={\"/membership/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_MEMBERS:\n                return <Redirect push to={\"/viewMembers/\" + this.props.organization.id} />\n            case NavigateTo.EDIT_ORGANIZATION:\n                return <Redirect push to={\"/editOrganization/\" + this.props.organization.id} />\n            case NavigateTo.MANAGE_REQUESTS:\n                return <Redirect push to={\"/manageOrganizationRequests/\" + this.props.organization.id} />\n            case NavigateTo.INVITE_USER:\n                return <Redirect push to={\"/inviteUser/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_ORGANIZATION:\n                return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n            case NavigateTo.NONE:\n            default:\n            // do nothing.\n        }\n\n        let orgRowClass\n        let narrativesRowClass\n        if (this.state.accordionState === AccordionState.UP) {\n            orgRowClass = \"ViewOrganization-orgRow ViewOrganization-accordionClosed\"\n            narrativesRowClass = \"ViewOrganization-narrativesRow ViewOrganization-accordionOpen\"\n        } else {\n            orgRowClass = \"ViewOrganization-orgRow ViewOrganization-accordionOpen\"\n            narrativesRowClass = \"ViewOrganization-narrativesRow ViewOrganization-accordionClosed\"\n        }\n        orgRowClass += \" scrollable-flex-column\"\n        narrativesRowClass += \" scrollable-flex-column\"\n\n        const uorg = this.props.organization as unknown\n        const borg = uorg as orgModel.BriefOrganization\n        return (\n            <div className=\"ViewOrganization  scrollable-flex-column\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                <div style={{ borderBottom: '1px silver solid' }}>\n                    <BriefOrganization organization={borg} openRequestsStatus={this.props.openRequest} />\n                </div>\n                <div className=\"ViewOrganization-mainRow scrollable-flex-column\">\n                    <div className=\"ViewOrganization-mainColumn  scrollable-flex-column\">\n                        <div className={orgRowClass} style={{ minHeight: '0px' }}>\n                            {this.renderOrg()}\n                        </div>\n                        <div className=\"ViewOrganization-accordionRow\">\n                            {this.renderAccordionControl()}\n                        </div>\n                        <div className={narrativesRowClass}>\n                            {this.renderNarratives()}\n                        </div>\n                    </div>\n                    <div className=\"ViewOrganization-infoColumn\">\n                        {this.renderCombo()}\n                    </div>\n                </div>\n            </div>\n\n        )\n    }\n}\n\nexport default ViewOrganization","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, ViewOrgViewModelKind } from '../../../../types'\nimport * as actions from '../../../../redux/actions/viewOrg'\nimport * as acceptInboxRequestActions from '../../../../redux/actions/viewOrganization/acceptInboxRequest'\nimport * as denyInboxRequestActions from '../../../../redux/actions/viewOrganization/denyInboxRequest'\nimport * as cancelOutboxRequestActions from '../../../../redux/actions/viewOrganization/cancelOutboxRequest'\nimport * as notificationActions from '../../../../redux/actions/notifications'\n\nimport ViewOrganization from './component'\n\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\nimport * as feedsModel from '../../../../data/models/feeds'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    openRequest: orgModel.RequestStatus\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n    requestOutbox: Array<requestModel.Request>\n    requestInbox: Array<requestModel.Request>\n    notifications: Array<feedsModel.OrganizationNotification>\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onViewOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: requestModel.RequestID) => void\n    onAcceptInvitation: (requestId: requestModel.RequestID) => void\n    onRejectInvitation: (requestId: requestModel.RequestID) => void\n    onRemoveNarrative: (narrative: orgModel.NarrativeResource) => void\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n    onAcceptRequest: (requestId: requestModel.RequestID) => void\n    onReadNotification: (notificationId: string) => void\n}\n\n// hmm this bit would be for the interface for the wrapped component.\n// can't really do that here, but _could_ export the interfaces above\n// and compose them thus in the wrapped component. But the wrapped component\n// should know nothing about this business\n// type Props = StateProps & DispatchProps & OwnProps\n\nfunction mapStateToProps(state: StoreState, ownProps: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    const {\n        organization, relation, openRequest, groupRequests, groupInvitations, requestInbox, requestOutbox\n    } = viewModel\n    const {\n        db: {\n            notifications: { all }\n        }\n    } = state\n\n    const notifications = all.filter((notification) => {\n        return (notification.organizationId === organization.id)\n    })\n    // TODO: of course this really needs to be an async fetch of the org info!\n    return {\n        organization, relation, openRequest, groupRequests, groupInvitations, requestInbox, requestOutbox, notifications\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onViewOrg: (id: string) => {\n            dispatch(actions.load(id) as any)\n        },\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: requestModel.RequestID) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: requestModel.RequestID) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: requestModel.RequestID) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        },\n        onRemoveNarrative: (narrative: orgModel.NarrativeResource) => {\n            dispatch(actions.removeNarrative(narrative) as any)\n        },\n        onGetViewAccess: (narrative: orgModel.NarrativeResource) => {\n            dispatch(actions.accessNarrative(narrative) as any)\n        },\n        onAcceptRequest: (requestId: requestModel.RequestID) => {\n            dispatch(acceptInboxRequestActions.acceptRequest(requestId) as any)\n        },\n        onReadNotification: (notificationId: string) => {\n            dispatch(notificationActions.read(notificationId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewOrganization)\n\n// export default connect(mapStateToProps, mapDispatchToProps)(ViewOrganization) \n\n","import * as React from 'react'\n\nimport './component.css'\n\nimport { Button, Modal, Icon, Alert } from 'antd'\nimport Header from '../../../Header'\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\n\nenum NavigateTo {\n    NONE = 0,\n    REQUEST_ADD_NARRATIVE\n}\n\nexport interface ViewOrganizationState {\n    showInfo: boolean\n    navigateTo: NavigateTo\n    requestAccess: {\n        narrative: orgModel.NarrativeResource | null\n    }\n}\n\nexport interface ViewOrganizationProps {\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n}\n\nclass ViewOrganization extends React.Component<ViewOrganizationProps, ViewOrganizationState> {\n    constructor(props: ViewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            showInfo: false,\n            navigateTo: NavigateTo.NONE,\n            requestAccess: {\n                narrative: null\n            }\n        }\n    }\n\n    onShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'View Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This organization is <b>private</b>.</p>\n                    <p>Nothing about this organization may be revealed to non-members.</p>\n                    <p>You may request membership</p>\n                    <p>Upon requesting membership, the organization administrators may grant you membership</p>\n                    <p>When your request is either accepted or denied, you will received a notification in your KBase Feed.</p>\n                </div>\n            )\n        })\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n    }\n\n    onCancelJoinRequest() {\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n    }\n\n    onAcceptInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n    }\n\n    onRejectInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n    }\n\n    renderMessage() {\n        switch (this.props.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <React.Fragment>\n                        <p>This organization is <b>private</b> and you are not a member.</p>\n                        <p>Nothing about a private organization may be revealed to a non-member.</p>\n                        <p>However, you may request membership</p>\n                        <p>Upon requesting membership, the organization administrators will be notified.</p>\n                        <p>When your request is either accepted or denied, you will received a notification in your KBase Feed.</p>\n                    </React.Fragment>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <React.Fragment>\n                        <p>Your membership request to this private organization is pending.</p>\n                    </React.Fragment>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <React.Fragment>\n                        <p>You have been invited to this private organization.</p>\n                    </React.Fragment>\n                )\n            default:\n                return (\n                    <div>\n                        Weird, {this.props.relation.type}.\n                    </div>\n                )\n        }\n    }\n\n    renderOrg() {\n        const message = (\n            <span>\n                Private Organization\n            </span>\n        )\n        const description = (\n            <React.Fragment>\n                {this.renderMessage()}\n\n                <div>\n                    {this.renderJoinButton()}\n                </div>\n            </React.Fragment>\n        )\n        return (\n            <Alert\n                message={message}\n                description={description}\n                type=\"info\"\n                style={{ width: '50em', margin: '20px auto' }}\n                className=\"ViewInaccessiblePrivateOrganization-message\" />\n        )\n    }\n\n    renderRelationClass(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'infoBox relationRequestPending'\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'infoBox relationInvitationPending'\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return 'infoBox'\n        }\n    }\n\n    renderJoinButton() {\n        switch (this.props.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <Button\n                        onClick={this.onJoinClick.bind(this)}\n                    >\n                        Join this Organization\n                    </Button>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <div><Button\n                            icon=\"delete\"\n                            type=\"danger\"\n                            onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button>\n                        </div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div>\n                        <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                        {' '}\n                        <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                    </div>\n                )\n            default:\n                return (\n                    <div>\n                        Weird, {this.props.relation.type}.\n                    </div>\n                )\n        }\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <div style={{ flex: '0 0 auto' }}>\n            </div>\n        )\n        const buttons = (\n            <React.Fragment>\n\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"ViewInaccessiblePrivateOrganization  scrollable-flex-column\">\n                {this.renderHeader()}\n                {this.renderOrg()}\n            </div>\n        )\n    }\n}\n\nexport default ViewOrganization","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport { AppError, StoreState } from '../../types'\nimport * as feedsModel from '../../data/models/feeds';\n\nexport interface Load extends Action<ActionFlag.NOTIFICATIONS_LOAD> {\n    type: ActionFlag.NOTIFICATIONS_LOAD\n}\n\nexport interface LoadStart extends Action<ActionFlag.NOTIFICATIONS_LOAD_START> {\n    type: ActionFlag.NOTIFICATIONS_LOAD_START\n}\n\nexport interface LoadSuccess extends Action<ActionFlag.NOTIFICATIONS_LOAD_SUCCESS> {\n    type: ActionFlag.NOTIFICATIONS_LOAD_SUCCESS,\n    notifications: Array<feedsModel.OrganizationNotification>\n}\n\nexport interface LoadError extends Action<ActionFlag.NOTIFICATIONS_LOAD_ERROR> {\n    type: ActionFlag.NOTIFICATIONS_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action<ActionFlag.NOTIFICATIONS_UNLOAD> {\n    type: ActionFlag.NOTIFICATIONS_UNLOAD\n}\n\nexport interface Read extends Action<ActionFlag.NOTIFICATIONS_READ> {\n    type: ActionFlag.NOTIFICATIONS_READ,\n    notificationId: feedsModel.NotificationID\n}\n\nexport interface ReadStart extends Action<ActionFlag.NOTIFICATIONS_READ_START> {\n    type: ActionFlag.NOTIFICATIONS_READ_START\n}\n\nexport interface ReadSuccess extends Action<ActionFlag.NOTIFICATIONS_READ_SUCCESS> {\n    type: ActionFlag.NOTIFICATIONS_READ_SUCCESS,\n    notificationId: feedsModel.NotificationID\n}\n\nexport interface ReadError extends Action<ActionFlag.NOTIFICATIONS_READ_ERROR> {\n    type: ActionFlag.NOTIFICATIONS_READ_ERROR,\n    error: AppError\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.NOTIFICATIONS_LOAD_START\n    }\n}\n\nexport function loadSuccess(notifications: Array<feedsModel.OrganizationNotification>): LoadSuccess {\n    return {\n        type: ActionFlag.NOTIFICATIONS_LOAD_SUCCESS,\n        notifications: notifications\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.NOTIFICATIONS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.NOTIFICATIONS_UNLOAD\n    }\n}\n\nexport function load() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const feedsClient = new feedsModel.FeedsClient({\n            token, username,\n            feedsServiceURL: config.services.Feeds.url\n        })\n\n        try {\n            const notifications = await feedsClient.getOrganizationNotifications()\n            // const groupNotifications = notifications.filter((notification) => {\n            //     return (notification.source === 'groupsservice')\n            // })\n            dispatch(loadSuccess(notifications))\n        } catch (ex) {\n            console.error('error', ex)\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function read(notificationId: feedsModel.NotificationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.NOTIFICATIONS_READ_START\n        } as ReadStart)\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const feedsClient = new feedsModel.FeedsClient({\n            token, username,\n            feedsServiceURL: config.services.Feeds.url\n        })\n\n        try {\n            const notifications = await feedsClient.seeNotification(notificationId)\n            // const groupNotifications = notifications.filter((notification) => {\n            //     return (notification.source === 'groupsservice')\n            // })\n            dispatch({\n                type: ActionFlag.NOTIFICATIONS_READ_SUCCESS,\n                notificationId: notificationId\n            } as ReadSuccess)\n        } catch (ex) {\n            console.error('error', ex)\n            dispatch({\n                type: ActionFlag.NOTIFICATIONS_READ_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            } as ReadError)\n        }\n    }\n}\n","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, ViewOrgViewModelKind } from '../../../../types'\nimport * as actions from '../../../../redux/actions/viewOrg'\n\nimport ViewOrganization from './component'\n\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n}\n\n// hmm this bit would be for the interface for the wrapped component.\n// can't really do that here, but _could_ export the interfaces above\n// and compose them thus in the wrapped component. But the wrapped component\n// should know nothing about this business\n// type Props = StateProps & DispatchProps & OwnProps\n\n\nfunction mapStateToProps(state: StoreState, ownProps: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.PRIVATE_INACCESSIBLE) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    const {\n        organization, relation, requestOutbox\n    } = viewModel\n    const {\n        db: {\n            notifications: { all }\n        }\n    } = state\n\n    const notifications = all.filter((notification) => {\n        return (notification.organizationId === organization.id)\n    })\n    // TODO: of course this really needs to be an async fetch of the org info!\n    return {\n        organization, relation, requestOutbox\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: string) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: string) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: string) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        },\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewOrganization)\n","import * as React from 'react'\n\nimport AccessibleContainer from './accessible/container'\nimport InaccessibleContainer from './inaccessible/container'\nimport { Spin, Alert } from 'antd';\n\nexport interface Props {\n    organizationId: string\n    view: types.ViewOrgView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        const message = (\n            <div>\n                Loading your Organization...\n                {' '}\n                <Spin />\n            </div>\n        )\n        return (\n            <Alert type=\"info\" message={message} style={{\n                width: '20em',\n                padding: '20px',\n                margin: '20px auto'\n            }} />\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case types.ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case types.ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                if (this.props.view.viewModel === null) {\n                    return this.renderError({\n                        code: 'Null Error',\n                        message: 'The view model is missing, but should be available'\n                    })\n                }\n                if (this.props.view.viewModel.organization.kind === OrganizationKind.INACCESSIBLE_PRIVATE) {\n                    return (\n                        <InaccessibleContainer />\n                    )\n                    // return this.renderError({\n                    //     code: 'Unsupported',\n                    //     message: 'Private orgs are not currently supported'\n                    // })\n                }\n                return (\n                    <AccessibleContainer />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/viewOrg'\nimport { OrganizationKind } from '../../../data/models/organization/model';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.ViewOrgView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.viewOrgView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, AppError, EditableOrganization, ValidationState, EditState, ValidationErrorType, SyncState } from '../../types'\nimport Validation from '../../data/models/organization/validation'\nimport * as orgModel from '../../data/models/organization/model'\n\n// ACTIONS\n\n// Loading the editor\nexport interface Load extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD,\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD_SUCCESS,\n    editedOrganization: EditableOrganization,\n    organization: orgModel.Organization\n}\n\nexport interface LoadError extends Action<ActionFlag.EDIT_ORG_LOAD_ERROR> {\n    type: ActionFlag.EDIT_ORG_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action<ActionFlag.EDIT_ORG_UNLOAD> {\n    type: ActionFlag.EDIT_ORG_UNLOAD\n}\n\n// Evaluating state of form \n\nexport interface EditOrgEvaluate extends Action<ActionFlag.EDIT_ORG_EVALUATE> {\n    type: ActionFlag.EDIT_ORG_EVALUATE\n}\n\nexport interface EditOrgEvaluateOK extends Action<ActionFlag.EDIT_ORG_EVALUATE_OK> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_OK\n}\n\nexport interface EditOrgEvaluateErrors extends Action<ActionFlag.EDIT_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n}\n\n// Saving\n\nexport interface EditOrgSave extends Action<ActionFlag.EDIT_ORG_SAVE> {\n    type: ActionFlag.EDIT_ORG_SAVE\n}\n\nexport interface EditOrgSaveStart extends Action<ActionFlag.EDIT_ORG_SAVE_START> {\n    type: ActionFlag.EDIT_ORG_SAVE_START\n}\n\nexport interface EditOrgSaveSuccess extends Action<ActionFlag.EDIT_ORG_SAVE_SUCCESS> {\n    type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n}\n\nexport interface EditOrgSaveError extends Action<ActionFlag.EDIT_ORG_SAVE_ERROR> {\n    type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Updating name field\n\nexport interface EditOrgUpdateName extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface EditOrgUpdateNameSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface EditOrgUpdateNameError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: ValidationState\n}\n\n// Updating logo url field\n\nexport interface EditOrgUpdateLogoUrl extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL,\n    name: string | null\n}\n\nexport interface EditOrgUpdateLogoUrlSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,\n    logoUrl: string | null\n}\n\nexport interface EditOrgUpdateLogoUrlError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_ERROR,\n    logoUrl: string | null,\n    error: ValidationState\n}\n\n// Updating home url field\nexport interface UpdateHomeUrl extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_SUCCESS\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_ERROR\n    homeUrl: string | null\n    error: ValidationState\n}\n\n// Updating research interests field\nexport interface UpdateResearchInterests extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR\n    researchInterests: string\n    error: ValidationState\n}\n\n// Updating description field\n\nexport interface EditOrgUpdateDescription extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: ValidationState\n}\n\nexport interface UpdateIsPrivate extends Action<ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE> {\n    type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateSuccess extends Action<ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS> {\n    type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateError extends Action<ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR> {\n    type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR,\n    error: ValidationState\n}\n\n\n// ACTION CREATORS\n\n// export function editOrgStart(id: string): LoadStart {\n//     return {\n//         type: ActionFlag.EDIT_ORG_LOAD_START,\n//         id: id\n//     }\n// }\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_START\n    }\n}\n\nexport function loadSuccess(editedOrganization: EditableOrganization, organization: orgModel.Organization): LoadSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_SUCCESS,\n        editedOrganization: editedOrganization,\n        organization: organization\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.EDIT_ORG_UNLOAD\n    }\n}\n\n// Evaluate\n\nexport function editOrgEvaluateOk(): EditOrgEvaluateOK {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_OK\n    }\n}\n\nexport function editOrgEvaluateErrors(): EditOrgEvaluateErrors {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Save\n\n// export function editOrgSave(): EditOrgSave {\n//     return {\n//         type: ActionFlag.EDIT_ORG_SAVE\n//     }\n// }\n\nexport function editOrgSaveStart(): EditOrgSaveStart {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_START\n    }\n}\n\nexport function editOrgSaveSuccess(): EditOrgSaveSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n    }\n}\n\nexport function editOrgSaveError(error: AppError): EditOrgSaveError {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n// Update Name\n\nexport function editOrgUpdateNameSuccess(name: string): EditOrgUpdateNameSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function editOrgUpdateNameError(name: string, error: ValidationState): EditOrgUpdateNameError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\n// export function editOrgUpdateIdSuccess(id: string): EditOrgUpdateIdSuccess {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS,\n//         id: id\n//     }\n// }\n\n// Update Logo Url\n\nexport function editOrgUpdateLogoUrlSuccess(logoUrl: string | null): EditOrgUpdateLogoUrlSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,\n        logoUrl: logoUrl\n    }\n}\n\nexport function editOrgUpdateLogoUrlError(logoUrl: string | null, error: ValidationState): EditOrgUpdateLogoUrlError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_ERROR,\n        logoUrl: logoUrl,\n        error: error\n    }\n}\n\n\n// Update Id\n\n// export function editOrgUpdateIdError(id: string, error: UIError): EditOrgUpdateIdError {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_ERROR,\n//         id: id,\n//         error: error\n//     }\n// }\n\nexport function editOrgUpdateDescriptionSuccess(description: string): EditOrgUpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function editOrgUpdateDescriptionError(description: string, error: ValidationState): EditOrgUpdateDescriptionError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function load(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        // const model = new Model({\n        //     token, username,\n        //     groupsServiceURL: config.services.Groups.url,\n        //     userProfileServiceURL: config.services.UserProfile.url,\n        //     workspaceServiceURL: config.services.Workspace.url,\n        //     serviceWizardURL: config.services.ServiceWizard.url\n        // })\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        return orgClient.getOrg(organizationId)\n            .then((org) => {\n                if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                    throw new Error('May not edit an inaccessible private org!')\n                }\n                const editableOrg: EditableOrganization = {\n                    id: {\n                        value: org.id,\n                        remoteValue: org.id,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgId(org.id)[1]\n                    },\n                    name: {\n                        value: org.name,\n                        remoteValue: org.name,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgName(org.name)[1]\n                    },\n                    logoUrl: {\n                        value: org.logoUrl,\n                        remoteValue: org.logoUrl,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgLogoUrl(org.logoUrl)[1]\n                    },\n                    homeUrl: {\n                        value: org.homeUrl,\n                        remoteValue: org.homeUrl,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgHomeUrl(org.homeUrl)[1]\n                    },\n                    researchInterests: {\n                        value: org.researchInterests,\n                        remoteValue: org.researchInterests,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgResearchInterests(org.researchInterests)[1]\n                    },\n                    description: {\n                        value: org.description,\n                        remoteValue: org.description,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgDescription(org.description)[1]\n                    },\n                    isPrivate: {\n                        value: org.isPrivate,\n                        remoteValue: org.isPrivate,\n                        syncState: SyncState.NEW,\n                        validationState: {\n                            type: ValidationErrorType.OK,\n                            validatedAt: new Date()\n                        }\n                    }\n                }\n                dispatch(loadSuccess(editableOrg, org))\n            })\n            .catch((err) => {\n                console.error('load org error', err)\n                dispatch(loadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function editOrgSave() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(editOrgSaveStart())\n\n        const state = getState()\n        if (!state.views.editOrgView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                editOrgView: {\n                    viewModel: { organization, editedOrganization }\n                }\n            },\n            app: { config } } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (!editedOrganization) {\n            dispatch(editOrgSaveError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        const update = {\n            name: editedOrganization.name.value,\n            logoUrl: editedOrganization.logoUrl.value,\n            description: editedOrganization.description.value,\n            isPrivate: editedOrganization.isPrivate.value,\n            homeUrl: editedOrganization.homeUrl.value,\n            researchInterests: editedOrganization.researchInterests.value\n        }\n\n        orgClient.updateOrg(organization.id, update)\n            .then(() => {\n                dispatch(editOrgSaveSuccess())\n            })\n            .catch((error) => {\n                console.error('error adding', editedOrganization, error)\n                dispatch(editOrgSaveError({\n                    code: 'invalid',\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function editOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.editOrgView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            views: {\n                editOrgView: {\n                    viewModel: {\n                        editedOrganization\n                    }\n                }\n            }\n        } = state\n\n        if (!editedOrganization) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.name.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.logoUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.homeUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.researchInterests.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.description.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(editOrgEvaluateOk())\n    }\n}\n\nexport function updateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(editOrgUpdateNameError(validatedName, error))\n        } else {\n            dispatch(editOrgUpdateNameSuccess(validatedName))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateLogoUrl(logoUrl: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedLogoUrl, error] = Validation.validateOrgLogoUrl(logoUrl)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(editOrgUpdateLogoUrlError(validatedLogoUrl, error))\n        } else {\n            dispatch(editOrgUpdateLogoUrlSuccess(validatedLogoUrl))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateHomeUrl(homeUrl: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedHomeUrl, error] = Validation.validateOrgHomeUrl(homeUrl)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_ERROR,\n                homeUrl: validatedHomeUrl,\n                error: error\n            } as UpdateHomeUrlError)\n        } else {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,\n                homeUrl: validatedHomeUrl\n            } as UpdateHomeUrlSuccess)\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateResearchInterests(researchInterests: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedResearchInterests, error] = Validation.validateOrgHomeUrl(researchInterests)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n                researchInterests: validatedResearchInterests,\n                error: error\n            } as UpdateResearchInterestsError)\n        } else {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n                researchInterests: validatedResearchInterests\n            } as UpdateResearchInterestsSuccess)\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>,\n        getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        const [validatedDescription, error] = Validation.validateOrgDescription(description)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(editOrgUpdateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(editOrgUpdateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateIsPrivate(isPrivate: boolean) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        // No validation for now.\n        dispatch({\n            type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n            isPrivate: isPrivate\n        })\n        dispatch(editOrgEvaluate())\n    }\n} ","import * as React from 'react'\nimport { Redirect, NavLink } from 'react-router-dom';\nimport { Marked } from 'marked-ts';\nimport { Button, Icon, Modal, Checkbox, Input, Tooltip } from 'antd';\nimport md5 from 'md5'\n\nimport {\n    EditableOrganization, SaveState, ValidationState,\n    EditState, ValidationErrorType, Editable, SyncState\n} from '../../../types';\n\nimport './component.css'\n\nimport Header from '../../Header';\nimport OrganizationHeader from '../organizationHeader/loader';\nimport * as orgModel from '../../../data/models/organization/model'\nimport { CheckboxChangeEvent } from 'antd/lib/checkbox';\nimport TextArea from 'antd/lib/input/TextArea';\nimport MainMenu from '../../menu/component';\n\nexport interface EditOrganizationProps {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    editedOrganization: EditableOrganization\n    organization: orgModel.Organization\n    onEditOrgSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateLogoUrl: (logoUrl: string) => void\n    onUpdateHomeUrl: (homeUrl: string) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n}\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    VIEWER\n}\n\nexport interface EditOrganizationState {\n    cancelToBrowser: boolean;\n    cancelToViewer: boolean;\n    navigateTo: NavigateTo;\n}\n\nclass EditOrganization extends React.Component<EditOrganizationProps, EditOrganizationState> {\n\n    origin: string;\n\n    constructor(props: EditOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false,\n            navigateTo: NavigateTo.NONE\n        }\n\n        this.origin = document.location!.origin\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Organization Editor Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations editor...</p>\n                </div>\n            )\n        })\n    }\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onClickCancelToViewer() {\n        if (!this.isModified()) {\n            this.setState({ cancelToViewer: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToViewer: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.props.onEditOrgSave()\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateName(e.target.value)\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value)\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        console.warn('no updating id, naughty!')\n    }\n\n    onIsPrivateChange(e: CheckboxChangeEvent) {\n        this.props.onUpdateIsPrivate(e.target.checked)\n    }\n\n    onLogoUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateLogoUrl(e.target.value)\n    }\n\n    onHomeUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateHomeUrl(e.target.value)\n    }\n\n    onResearchInterestsChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateResearchInterests(e.target.value)\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState.type === ValidationErrorType.OK &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY)\n        )\n    }\n\n    calcFieldClass(field: Editable) {\n        switch (field.validationState.type) {\n            // case (ValidationErrorType.OK):\n            //     return 'validation-ok'\n            case (ValidationErrorType.ERROR):\n                return 'validation-error'\n            case (ValidationErrorType.REQUIRED_MISSING):\n                return 'validation-error'\n        }\n\n        switch (field.syncState) {\n            case (SyncState.DIRTY):\n                return 'sync-dirty'\n            default:\n                return 'validation-ok'\n        }\n    }\n\n    renderFieldError(field: Editable) {\n        if (field.validationState.type !== ValidationErrorType.OK) {\n            if (field.syncState === SyncState.DIRTY) {\n                return (\n                    <span style={{ color: 'red' }}>\n                        {field.validationState.message}\n                    </span>\n                )\n            }\n        } else {\n            return ''\n        }\n    }\n\n    renderEditor() {\n        return (\n            <form id=\"editOrganizationForm\" className=\"EditOrganization-editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div style={{ flex: '1 1 0px' }}>\n                            <h3>Edit Your Organization</h3>\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <h3>Preview</h3>\n                    </div>\n                </div>\n\n                {/* Org name */}\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div className=\"EditOrganization-formLabel field-label\">\n                            <Tooltip title=\"This is the name for your organization as you want KBase users to see it\">\n                                Name\n                            </Tooltip>\n                        </div>\n                        <div className=\"EditOrganization-formControl\">\n                            <Input value={this.props.editedOrganization.name.value || ''}\n                                className={this.calcFieldClass(this.props.editedOrganization.name)}\n                                onChange={this.onNameChange.bind(this)} />\n                            {this.renderFieldError(this.props.editedOrganization.name)}\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div className=\"EditOrganization-preview-name\">\n                            {this.props.editedOrganization.name.value || ''}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Org ID */}\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div className=\"EditOrganization-formLabel field-label\">\n                            ID\n                        </div>\n                        <div className=\"EditOrganization-formControl\">\n                            <Input value={this.props.editedOrganization.id.value || ''}\n                                className={this.calcFieldClass(this.props.editedOrganization.id)}\n                                onChange={this.onIdChange.bind(this)} />\n                            {this.renderFieldError(this.props.editedOrganization.id)}\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div className=\"EditOrganization-preview-id\">\n                            <span style={{ color: 'silver' }}>{this.origin}/#org/</span>\n                            {this.props.editedOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Logo URL */}\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div className=\"EditOrganization-formLabel field-label\">\n                            Logo URL\n                        </div>\n                        <div className=\"EditOrganization-formControl\">\n                            <Input value={this.props.editedOrganization.logoUrl.value || ''}\n                                className={this.calcFieldClass(this.props.editedOrganization.logoUrl)}\n                                onChange={this.onLogoUrlChange.bind(this)} />\n                            {this.renderFieldError(this.props.editedOrganization.logoUrl)}\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div className=\"EditOrganization-preview-logo\">\n                            {this.renderLogoPreview()}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Home Page URL */}\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div className=\"EditOrganization-formLabel field-label\">\n                            Home Page URL\n                        </div>\n                        <div className=\"EditOrganization-formControl\">\n                            <Input value={this.props.editedOrganization.homeUrl.value || ''}\n                                className={this.calcFieldClass(this.props.editedOrganization.homeUrl)}\n                                onChange={this.onHomeUrlChange.bind(this)} />\n                            {this.renderFieldError(this.props.editedOrganization.homeUrl)}\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div className=\"EditOrganization-field-name\">\n                            <a href={this.props.editedOrganization.homeUrl.value || ''} target=\"_blank\">{this.props.editedOrganization.homeUrl.value || ''}</a>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Is Private? */}\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div className=\"EditOrganization-formLabel field-label\">\n                            Is Private?\n                        </div>\n                        <div className=\"EditOrganization-formControl\">\n                            <Checkbox\n                                checked={this.props.editedOrganization.isPrivate.value}\n                                className={this.calcFieldClass(this.props.editedOrganization.isPrivate)}\n                                onChange={this.onIsPrivateChange.bind(this)} />\n                            {this.renderFieldError(this.props.editedOrganization.isPrivate)}\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div className=\"EditOrganization-preview-isPrivate\">\n                            {this.renderIsPrivate(this.props.editedOrganization.isPrivate.value)}\n                        </div>\n                    </div>\n                </div>\n\n\n                {/* Research Interests */}\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div className=\"EditOrganization-formLabel field-label\">\n                            Research Interests\n                        </div>\n                        <div className=\"EditOrganization-formControl\">\n                            <TextArea value={this.props.editedOrganization.researchInterests.value || ''}\n                                className={this.calcFieldClass(this.props.editedOrganization.researchInterests) + ' EditOrganization-control-researchInterests'}\n                                autosize={{ minRows: 2, maxRows: 2 }}\n                                onChange={this.onResearchInterestsChange.bind(this)} />\n                            {this.renderFieldError(this.props.editedOrganization.researchInterests)}\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div className=\"EditOrganization-preview-researchInterests\">\n                            {this.props.editedOrganization.researchInterests.value || ''}\n                        </div>\n                    </div>\n                </div>\n\n                {/* Description*/}\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                        <div className=\"EditOrganization-formLabel field-label\">\n                        </div>\n                        <div className=\"EditOrganization-formControl\">\n                            <TextArea value={this.props.editedOrganization.description.value || ''}\n                                className={this.calcFieldClass(this.props.editedOrganization.description) + ' EditOrganization-control-description'}\n                                autosize={{ minRows: 5, maxRows: 15 }}\n                                onChange={this.onDescriptionChange.bind(this)} />\n                            {this.renderFieldError(this.props.editedOrganization.description)}\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div className=\"EditOrganization-preview-description\"\n                            dangerouslySetInnerHTML={({ __html: Marked.parse(this.props.editedOrganization.description.value || '') })}\n                        />\n                    </div>\n                </div>\n            </form >\n        )\n    }\n\n    renderIsPrivate(isPrivate: boolean) {\n        if (isPrivate) {\n            return (\n                <span>\n                    <Icon type=\"lock\" />{' '}Private\n                </span>\n            )\n        }\n        return (\n            <span>\n                <Icon type=\"global\" />{' '}Public\n            </span>\n        )\n    }\n\n    renderLogoPreview() {\n        if (!this.props.editedOrganization.logoUrl.value) {\n            return this.renderDefaultLogo()\n        }\n        return (\n            <img src={this.props.editedOrganization.logoUrl.value} width={60} />\n        )\n    }\n\n    charAt(inString: string, position: number) {\n        const c1 = inString.charCodeAt(position)\n        if (c1 >= 0xD800 && c1 <= 0xDBFF && inString.length > position + 1) {\n            const c2 = inString.charCodeAt(position + 1)\n            if (c2 > 0xDC00 && c2 <= 0xDFFF) {\n                return inString.substring(position, 2)\n            }\n        }\n        return inString.substring(position, 1)\n    }\n\n    renderDefaultLogo() {\n        if (!(this.props.editedOrganization.name.value && this.props.editedOrganization.id.value)) {\n            return (\n                <div>\n                    Default logo preview available when the Organization name and id are completed\n                </div>\n            )\n        }\n        const initial = this.charAt(this.props.editedOrganization.name.value, 0).toUpperCase()\n        const hash = md5(this.props.editedOrganization.id.value)\n        const size = 60;\n        const color = hash.substr(0, 6)\n        return (\n            <svg width={size} height={size} style={{ border: '1px rgba(200, 200, 200, 0.5) solid' }}>\n                <text x=\"50%\" y=\"50%\" dy={4} textAnchor=\"middle\" dominantBaseline=\"middle\" fontSize={size - 12} fill={'#' + color} fontFamily=\"sans-serif\">{initial}</text>\n            </svg>\n        )\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length === 0) {\n            return (\n                <span style={{ fontStyle: 'italic' }}>\n                    org name missing\n                </span>\n            )\n        }\n\n        let orgName = name\n        if (name.length >= maxLength) {\n            orgName = name.slice(0, 25) + '…'\n        }\n        return (\n            <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                <span style={{ fontWeight: 'bold' }}>\n                    {orgName}\n                </span>\n            </NavLink>\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org Editor...\n            </span>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    renderMenuButtons() {\n        return (\n            <span className=\"ButtonSet\">\n                <span className=\"ButtonSet-button\">\n                    <Button icon=\"save\"\n                        form=\"editOrganizationForm\"\n                        key=\"submit\"\n                        disabled={!this.canSave.call(this)}\n                        htmlType=\"submit\">\n                        Save\n                    </Button>\n                </span>\n                <span className=\"ButtonSet-button\">\n                    <Button icon=\"rollback\"\n                        type=\"danger\"\n                        onClick={this.onClickCancelToViewer.bind(this)}>\n                        Back to Org\n                        </Button>\n                </span>\n                <span className=\"ButtonSet-button\">\n                    <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                </span>\n            </span>\n        )\n    }\n\n    render() {\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        if (!this.props.editedOrganization) {\n            return (\n                <div className=\"EditOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"EditOrganization\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                {this.renderOrgHeader()}\n\n                {this.renderEditor()}\n            </div>\n        )\n    }\n}\n\nexport default EditOrganization","import { Dispatch, Action } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState, EditableOrganization, EditState, SaveState, ValidationState } from '../../../types';\nimport {\n    editOrgSave,\n    updateName,\n    updateDescription, updateLogoUrl, updateIsPrivate, updateHomeUrl, updateResearchInterests\n} from '../../../redux/actions/editOrg';\nimport EditOrganization from './component';\nimport * as orgModel from '../../../data/models/organization/model'\n\ninterface OwnProps {\n}\n\nexport interface StateProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    editedOrganization: EditableOrganization,\n    organization: orgModel.Organization\n}\n\nexport interface DispatchProps {\n    onEditOrgSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateLogoUrl: (gravatarHash: string | null) => void\n    // onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateHomeUrl: (homeUrl: string | null) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n}\n\nexport function mapStateToProps(state: StoreState): StateProps {\n    if (!state.views.editOrgView.viewModel) {\n        throw new Error('What, no view model??')\n    }\n    const {\n        views: {\n            editOrgView: {\n                viewModel: { editState, saveState, validationState, editedOrganization, organization }\n            }\n        }\n    } = state\n\n    return {\n        editState,\n        saveState,\n        validationState,\n        editedOrganization,\n        organization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onEditOrgSave: () => {\n            dispatch(editOrgSave() as any)\n        },\n        onUpdateName: (name: string) => {\n            dispatch(updateName(name) as any)\n        },\n        onUpdateLogoUrl: (gravatarHash: string | null) => {\n            dispatch(updateLogoUrl(gravatarHash) as any)\n        },\n        // onUpdateId: (id) => {\n        //     dispatch(editOrgUpdateId(id) as any)\n        // },\n        onUpdateDescription: (description) => {\n            dispatch(updateDescription(description) as any)\n        },\n        onUpdateIsPrivate: (isPrivate: boolean) => {\n            dispatch(updateIsPrivate(isPrivate) as any)\n        },\n        onUpdateHomeUrl: (homeUrl: string | null) => {\n            dispatch(updateHomeUrl(homeUrl) as any)\n        },\n        onUpdateResearchInterests: (researchInterests: string) => {\n            dispatch(updateResearchInterests(researchInterests) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(EditOrganization)","import * as React from 'react'\nimport { ComponentLoadingState, StoreState, EditOrgView } from '../../../types';\nimport Container from './container'\nimport * as orgModel from '../../../data/models/organization/model'\n\n// First the loader component, which takes care of a loading view, error view, and the \n// container.\n\nexport interface LoaderProps {\n    organizationId: orgModel.OrganizationID\n    view: EditOrgView\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Fetching your organizations and other stuff...\n            </div>\n        )\n    }\n\n    renderError() {\n        if (!this.props.view.error) {\n            return\n        }\n        return (\n            <div>\n                Error! {this.props.view.error.message}\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// THe redux connection\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/editOrg'\n\nexport interface OwnProps {\n    organizationId: orgModel.OrganizationID\n}\n\ninterface StateProps {\n    view: EditOrgView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.editOrgView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: (organizationId: orgModel.OrganizationID) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport './Auth.css'\n\nimport * as types from '../types'\nimport { Button } from 'antd';\n\n\nexport interface AuthState {\n\n}\n\nclass Auth extends React.Component<types.AuthProps, AuthState> {\n\n    tokenRef: React.RefObject<HTMLInputElement>\n\n    constructor(props: types.AuthProps) {\n        super(props)\n\n        this.tokenRef = React.createRef()\n\n        this.props.checkAuth()\n    }\n\n    onLogoutClick() {\n        this.props.onRemoveAuthorization()\n    }\n\n    onLoginClick() {\n        if (this.tokenRef.current === null) {\n            return\n        }\n        const token = this.tokenRef.current.value\n        if (token.length === 0) {\n            return\n        }\n        this.props.onAddAuthorization(token)\n    }\n\n    buildAuthForm() {\n        return (\n            <div className=\"Auth-form\">\n                Token: <input ref={this.tokenRef} style={{ width: '30em' }} />\n                <Button\n                    icon=\"save\"\n                    htmlType=\"submit\"\n                    onClick={this.onLoginClick.bind(this)} >\n                    Assign Token\n                </Button>\n            </div>\n        )\n    }\n\n    buildAuthToolbar() {\n        return (\n            <div className=\"Auth-toolbar\">\n                Logged in as <b><span>{this.props.authorization.authorization.realname}</span> (<span>{this.props.authorization.authorization.username}</span></b>)\n                {' '}\n                <Button icon=\"logout\" onClick={this.onLogoutClick.bind(this)}></Button>\n            </div>\n        )\n    }\n\n    buildAuthDev() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.buildAuthToolbar()}\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized! Enter a user token below</p>\n                        {this.buildAuthForm()}\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Error</p>\n                        {this.props.authorization.message}\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n    }\n\n    buildAuthProd() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized!</p>\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-error scrollable-flex-column\">\n                        <p>Error: ??</p>\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n\n    }\n\n    render() {\n        return (\n            <div className=\"Auth scrollable-flex-column\">\n                {this.props.hosted ? this.buildAuthProd() : this.buildAuthDev()}\n            </div>\n        )\n\n    }\n}\n\nexport default Auth","\nexport interface RootInfo {\n    version: string,\n    servertime: number\n}\n\ninterface AuthEndpoints {\n    root: string,\n    tokenInfo: string,\n    apiMe: string,\n    me: string,\n    loginStart: string,\n    loginChoice: string,\n    loginCreate: string,\n    loginUsernameSuggest: string,\n    loginPick: string,\n    loginCancel: string,\n    logout: string,\n    linkStart: string,\n    linkCancel: string,\n    linkChoice: string,\n    linkPick: string,\n    linkRemove: string,\n    tokens: string,\n    tokensRevoke: string,\n    tokensRevokeAll: string,\n    userSearch: string,\n    adminUserSearch: string,\n    adminUser: string\n}\n\nconst endpoints: AuthEndpoints = {\n    root: '',\n    tokenInfo: 'api/V2/token',\n    apiMe: 'api/V2/me',\n    me: 'me',\n    loginStart: 'login/start',\n    logout: 'logout',\n    loginChoice: 'login/choice',\n    loginCreate: 'login/create',\n    loginUsernameSuggest: 'login/suggestname',\n    loginPick: 'login/pick',\n    loginCancel: 'login/cancel',\n    linkStart: 'link/start',\n    linkCancel: 'link/cancel',\n    linkChoice: 'link/choice',\n    linkPick: 'link/pick',\n    linkRemove: 'me/unlink',\n    tokens: 'tokens',\n    tokensRevoke: 'tokens/revoke',\n    tokensRevokeAll: 'tokens/revokeall',\n    userSearch: 'api/V2/users/search',\n    adminUserSearch: 'api/V2/admin/search',\n    adminUser: 'api/V2/admin/user'\n}\n\nexport interface TokenInfo {\n    created: number,\n    expires: number,\n    id: string,\n    name: string | null,\n    token: string,\n    type: string,\n    user: string,\n    cachefor: number\n}\n\nexport interface Identity {\n    id: string,\n    provider: string,\n    username: string\n}\n\nexport interface Role {\n    id: string,\n    desc: string\n}\n\nexport interface Account {\n    created: number,\n    customroles: Array<string>,\n    display: string,\n    email: string,\n    idents: Array<Identity>,\n    lastLogin: number,\n    local: boolean,\n    roles: Array<Role>,\n    user: string\n}\nexport class AuthClient {\n    url: string;\n\n    constructor({ url }: { url: string }) {\n        this.url = url\n    }\n\n    makePath(path: Array<string> | string): string {\n        if (typeof path === 'string') {\n            return [this.url].concat([path]).join('/');\n        }\n        return [this.url].concat(path).join('/');\n    }\n\n\n    root(): Promise<RootInfo> {\n        return fetch(this.makePath([endpoints.root]), {\n            headers: {\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as RootInfo\n            })\n    }\n\n    getTokenInfo(token: string): Promise<TokenInfo> {\n        return fetch(this.makePath([endpoints.tokenInfo]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as TokenInfo\n            })\n    }\n\n    getMe(token: string): Promise<Account> {\n        return fetch(this.makePath([endpoints.apiMe]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Account\n            })\n    }\n\n\n    // getInfo() : Promise<GroupsServiceInfo> {\n    //     return fetch(this.url + '/', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json();\n    //         })\n    //         .then((result) => {\n    //             return result as GroupsServiceInfo;\n    //         });\n    // }\n\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport * as Cookies from 'es-cookie'\n\nimport { ActionFlag } from './index'\nimport { AppError, StoreState } from '../../types';\nimport { AuthClient, TokenInfo, Account } from '../../data/auth';\n\n// Action Definitions\n\nexport interface AuthCheck extends Action {\n    type: ActionFlag.AUTH_CHECK\n}\n\nexport interface AuthCheckStart extends Action {\n    type: ActionFlag.AUTH_CHECK_START\n}\n\nexport interface AuthCheckError extends Action {\n    type: ActionFlag.AUTH_CHECK_ERROR,\n    error: AppError\n}\n\nexport interface AuthAuthorized extends Action {\n    type: ActionFlag.AUTH_AUTHORIZED,\n    token: string\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\nexport interface AuthUnauthorized extends Action {\n    type: ActionFlag.AUTH_UNAUTHORIZED\n}\n\nexport interface AuthRemoveAuthorization extends Action {\n    type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n}\n\nexport interface AuthAddAuthorization extends Action {\n    type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n    token: string\n}\n\n// Action Creators\n\n\nexport function authCheckStart(): AuthCheckStart {\n    return {\n        type: ActionFlag.AUTH_CHECK_START\n    }\n}\n\nexport function authCheckError(error: AppError): AuthCheckError {\n    return {\n        type: ActionFlag.AUTH_CHECK_ERROR,\n        error\n    }\n}\n\nexport function authAuthorized(token: string, username: string, realname: string, roles: Array<string>): AuthAuthorized {\n    return {\n        type: ActionFlag.AUTH_AUTHORIZED,\n        token, username, realname, roles\n    }\n}\n\nexport function authUnauthorized(): AuthUnauthorized {\n    return {\n        type: ActionFlag.AUTH_UNAUTHORIZED\n    }\n}\n\n// export function authRemoveAuthorization(): AuthRemoveAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n//     }\n// }\n\n// export function authAddAuthorization(token: string): AuthAddAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n//         token: token\n//     }\n// }\n\n// Action Thunks\n\nexport function checkAuth() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(authCheckStart())\n\n        const {\n            app: {\n                config: {\n                    services: {\n                        Auth: { url }\n                    }\n                }\n            }\n        } = getState()\n\n        // TODO: get the auth from the kbase-ui integration api, perhaps a postmessage call\n\n        const token = Cookies.get('kbase_session')\n        if (!token) {\n            dispatch(authUnauthorized())\n            return\n        }\n\n        const auth = new AuthClient({ url: url })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function authRemoveAuthorization() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // remove cookie\n        Cookies.remove('kbase_session')\n\n        // remove auth in state\n        dispatch(authUnauthorized())\n    }\n}\n\nexport function authAddAuthorization(token: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n\n        const {\n            app: {\n                config: {\n                    services: {\n                        Auth: { url }\n                    }\n                }\n            }\n        } = getState()\n\n        // add cookie\n        Cookies.set('kbase_session', token)\n\n        // TODO: get auth info\n        const auth = new AuthClient({ url: url })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, AuthState, Authorization } from '../types'\nimport Auth from '../components/Auth'\nimport * as actions from '../redux/actions/auth'\n\nexport interface OwnProps {\n    hosted: boolean\n}\n\ninterface StateProps {\n    authorization: Authorization\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n}\n\ninterface DispatchProps {\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const { auth } = state\n    return {\n        authorization: auth\n        // authStatus: status,\n        // token: authorization.token || null,\n        // username: authorization.username || null,\n        // realname: authorization.realname || null\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        checkAuth: () => {\n            dispatch(actions.checkAuth() as any)\n        },\n        onRemoveAuthorization: () => {\n            dispatch(actions.authRemoveAuthorization() as any)\n        },\n        onAddAuthorization: (token: string) => {\n            dispatch(actions.authAddAuthorization(token) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Auth)","\nimport uuidv4 from 'uuid/v4'\n\ninterface ListenerParams {\n    name: string,\n    onSuccess: (payload: Payload) => void,\n    onError: (error: Error) => void\n}\n\nclass Listener {\n    name: string;\n    onSuccess: (payload: Payload) => void;\n    onError: (error: Error) => void;\n\n    constructor({ name, onSuccess, onError }: ListenerParams) {\n        this.name = name;\n        this.onSuccess = onSuccess;\n        this.onError = onError;\n    }\n}\n\ntype Payload = any;\n\ninterface WaitingListenerParams extends ListenerParams {\n    timeout?: number\n}\n\nclass WaitingListener extends Listener {\n    started: Date;\n    timeout: number;\n\n    constructor(params: WaitingListenerParams) {\n        super(params);\n        this.started = new Date();\n        this.timeout = params.timeout || 5000;\n    }\n}\n\ninterface Envelope {\n    channelId: string\n    id: string\n}\n\nclass Message {\n    name: string;\n    payload: any;\n    id: string;\n    created: Date;\n    channel: any\n    envelope: Envelope | null\n\n    constructor({ name, payload, channel }: { name: string, payload: any, channel: any }) {\n        this.name = name\n        this.payload = payload\n        this.id = uuidv4()\n        this.created = new Date()\n        this.channel = channel\n        this.envelope = null;\n    }\n\n    getMessage() {\n        return {\n            envelope: {\n                id: this.id,\n                created: this.created,\n                channel: this.channel\n            },\n            name: this.name,\n            payload: this.payload\n        };\n    }\n}\n\ninterface Handler {\n    started: Date,\n    handler: (response: any) => any\n}\n\ninterface ChannelParams {\n    window: Window,\n    host: string,\n    channelId?: string\n}\n\nexport class Channel {\n    window: Window\n    host: string\n    id: string\n    awaitingResponse: Map<string, Handler>\n    waitingListeners: Map<string, Array<Listener>>\n    listeners: Map<string, Array<Listener>>\n    lastId: number\n    sentCount: number\n    receivedCount: number\n    unwelcomeReceivedCount: number\n    unwelcomeReceivedCountThreshhold: number\n    unwelcomeReceiptWarning: boolean\n    unwelcomeReceiptWarningCount: number\n    currentListener: ((message: MessageEvent) => void) | null\n\n    constructor(params: ChannelParams) {\n        // The given window upon which we will listen for messages.\n        this.window = params.window;\n\n        // The host for the window; required for postmessage\n        if (this.window.document === null) {\n            throw new Error('No document')\n        }\n        if (this.window.document.location === null) {\n            throw new Error('No location')\n        }\n        this.host = params.host || this.window.document.location.origin;\n\n        // The channel id. Used to filter all messages received to\n        // this channel.\n        this.id = params.channelId || uuidv4()\n\n\n        this.awaitingResponse = new Map<string, Handler>()\n        this.waitingListeners = new Map<string, Array<Listener>>()\n        this.listeners = new Map<string, Array<Listener>>()\n\n        this.lastId = 0\n        this.sentCount = 0\n        this.receivedCount = 0\n\n        this.unwelcomeReceivedCount = 0\n        this.unwelcomeReceivedCountThreshhold = 100\n        this.unwelcomeReceiptWarning = true\n        this.unwelcomeReceiptWarningCount = 0\n        this.currentListener = null\n    }\n\n    genId() {\n        this.lastId += 1;\n        return 'msg_' + String(this.lastId);\n    }\n\n    receiveMessage(messageEvent: MessageEvent) {\n        const message = messageEvent.data as Message;\n        if (!message) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message data; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!message.envelope) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message envelope, not from KBase; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!(message.envelope.channelId === this.id)) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('Message envelope does not match this channel\\'s id', messageEvent);\n            }\n            return;\n        }\n        if (this.unwelcomeReceiptWarningCount > this.unwelcomeReceivedCountThreshhold) {\n            this.unwelcomeReceiptWarning = false;\n            console.warn('Unwelcome message warning disabled after ' + this.unwelcomeReceiptWarningCount + ' instances.');\n        }\n\n        // A message sent as a request will have registered a response handler\n        // in the awaitingResponse hash, using a generated id as the key.\n        // TODO: to to rethink using the message id here. Perhaps somehting like a\n        // chain of ids, the root of which is the origination id, which is the one\n        // known here when it it is sent; the message \"id\" should be assigned whenver\n        // a message is sent, but a response  message would include the original\n        // message in the \"chain\"...\n\n        // We can also have awaiting responses without an originating request.\n        // These are useful for, e.g., a promise which awaits a message to be sent\n        // within some window...\n        if (message.envelope.id && this.awaitingResponse.has(message.envelope.id)) {\n            try {\n                const response = this.awaitingResponse.get(message.envelope.id)\n                this.awaitingResponse.delete(message.envelope.id)\n                if (response) {\n                    response.handler(message.payload)\n                }\n            } catch (ex) {\n                console.error('Error handling response for message ', message, ex);\n            }\n        }\n\n        // and also awaiting by message name. Like a listener, but they are only used\n        // once.\n        if (this.waitingListeners.has(message.name)) {\n            const awaiting = this.waitingListeners.get(message.name)!\n            this.waitingListeners.delete(message.name)\n            awaiting.forEach((listener) => {\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n\n        // Otherwise, permanently registered handlers are found in the listeners for the\n        // message name.\n        if (this.listeners.has(message.name)) {\n            this.listeners.get(message.name)!.forEach((listener) => {\n                if (!listener.onSuccess) {\n                    console.warn('no handler for listener!', listener);\n                }\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n    }\n\n    listen(listener: Listener) {\n        if (!this.listeners.has(listener.name)) {\n            this.listeners.set(listener.name, [])\n        }\n        this.listeners.get(listener.name)!.push(listener)\n    }\n\n    on(messageId: string, success: (payload: any) => any, error: (error: Error) => void) {\n        this.listen(new Listener({\n            name: messageId,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    sendMessage(message: Message) {\n        this.window.postMessage(message.getMessage(), this.host);\n    }\n\n    send(name: string, payload: Payload) {\n        const message = new Message({ name, payload, channel: this.id });\n        this.sendMessage(message);\n    }\n\n    sendRequest(message: Message, handler: (response: any) => any) {\n        this.awaitingResponse.set('message.id', {\n            started: new Date(),\n            handler: handler\n        })\n\n        this.sendMessage(message);\n    }\n\n    request(name: string, payload: Payload) {\n        return new Promise((resolve, reject) => {\n            try {\n                this.sendRequest(new Message({ name, payload, channel: this.id }), (response: any) => {\n                    resolve(response);\n                });\n            } catch (ex) {\n                reject(ex);\n            }\n        });\n    }\n\n    startMonitor() {\n        window.setTimeout(() => {\n            const now = new Date().getTime();\n\n            // first take care of listeners awaiting a message.\n            for (const [id, listeners] of this.waitingListeners.entries()) {\n                const newListeners = listeners.filter((listener) => {\n                    if (listener instanceof WaitingListener) {\n                        const elapsed = now - listener.started.getTime();\n                        if (elapsed > listener.timeout) {\n                            try {\n                                if (listener.onError) {\n                                    listener.onError(new Error('timout after ' + elapsed));\n                                }\n                            } catch (ex) {\n                                console.error('Error calling error handler', id, ex);\n                            }\n                            return false;\n                        } else {\n                            return true;\n                        }\n                    } else {\n                        return true;\n                    }\n                });\n                if (newListeners.length === 0) {\n                    this.waitingListeners.delete(id)\n                }\n            }\n\n            if (this.waitingListeners.size > 0) {\n                this.startMonitor()\n            }\n        }, 100);\n    }\n\n    listenOnce(listener: WaitingListener) {\n        if (!this.waitingListeners.has(listener.name)) {\n            this.waitingListeners.set(listener.name, [])\n        }\n        this.waitingListeners.get(listener.name)!.push(listener);\n        if (listener.timeout) {\n            this.startMonitor();\n        }\n    }\n\n    once(name: string, success: (payload: Payload) => void, error: (error: Error) => void) {\n        this.listenOnce(new WaitingListener({\n            name: name,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    when(name: string, timeout: number) {\n        return new Promise((resolve, reject) => {\n            return this.listenOnce(new WaitingListener({\n                name: name,\n                timeout: timeout,\n                onSuccess: (payload) => {\n                    resolve(payload);\n                },\n                onError: (error) => {\n                    reject(error);\n                }\n            }));\n        });\n    }\n\n    stats() {\n        return {\n            sent: this.sentCount,\n            received: this.receivedCount\n        };\n    }\n\n    attach(window: Window) {\n        this.window = window;\n    }\n\n    start() {\n        this.currentListener = (message: MessageEvent) => {\n            this.receiveMessage(message);\n        };\n        this.window.addEventListener('message', this.currentListener, false);\n    }\n\n    stop() {\n        if (this.currentListener) {\n            this.window.removeEventListener('message', this.currentListener, false);\n        }\n    }\n}\n","import uuid from 'uuid/v4'\nimport { Channel } from './windowChannel'\nimport { IFrameParams } from '../types'\n\n// export interface IFrameParams {\n//     channelId: string\n//     frameId: string\n//     params: {\n//         groupsServiceURL: string\n//         userProfileServiceURL: string\n//         workspaceServiceURL: string\n//         serviceWizardURL: string\n//         feedsServiceURL: string\n//         authServiceURL: string\n//         originalPath: string | null,\n//         view: string | null,\n//         viewParams: any\n//     },\n//     parentHost: string\n// }\n/*\n channelId: \"3b33179e-8a6d-4ae9-bc95-af4c0492eaa6\"\nframeId: \"frame_kb_html_be553ee5-645c-4737-80ba-dcb642632f0c\"\nhostId: \"host_kb_html_9a3b5d5d-bb92-43ff-a443-73267aa31323\"\nparams: {}\nparentHost: \"https://ci.kbase.us\"\n\n*/\n\n/*\nIFrameSimulator\nThis little doozey allows us to create a simulated iframe. We can query it for\n the params placed on the iframe, and talk to it via the window channel -- it has \n its own window channel.\n Good thing we designed the channel for multiple channels per window.\n*/\nclass IFrameSimulator {\n    params: IFrameParams | null\n    channel: Channel\n\n    constructor() {\n        this.params = null\n\n        // create a window channel.\n\n        this.channel = new Channel({\n            window: window,\n            host: document.location!.origin\n        })\n\n    }\n\n    getParamsFromIFrame(): IFrameParams {\n        return {\n            channelId: this.channel.id,\n            frameId: uuid(),\n            params: {\n                groupsServiceURL: '/services/groups',\n                userProfileServiceURL: '/services/user_profile/rpc',\n                workspaceServiceURL: '/services/ws',\n                serviceWizardURL: '/services/service_wizard',\n                feedsServiceURL: '/services/feeds',\n                authServiceURL: '/services/auth',\n                originalPath: '',\n                view: null,\n                viewParams: null\n                // view: 'org',\n                // viewParams: {\n                //     id: 'test'\n                // }\n            },\n            parentHost: document.location!.origin\n        }\n    }\n}\n\n\n\nexport default IFrameSimulator","import { IFrameParams } from '../types'\n// export interface IFrameParams {\n//     channelId: string\n//     frameId: string\n//     params: {\n//         groupsServiceURL: string\n//         userProfileServiceURL: string\n//         workspaceServiceURL: string\n//         serviceWizardURL: string\n//         feedsServiceURL: string\n//         authServiceURL: string\n//         originalPath: string | null,\n//         view: string | null,\n//         viewParams: any\n//     },\n//     parentHost: string\n// }\n\nexport class IFrameIntegration {\n    getParamsFromIFrame() {\n        if (!window.frameElement) {\n            return null\n        }\n        if (!window.frameElement.hasAttribute('data-params')) {\n            // throw new Error('No params found in window!!');\n            return null\n        }\n        const params = window.frameElement.getAttribute('data-params');\n        if (params === null) {\n            // throw new Error('No params found in window!')\n            return null\n        }\n        const iframeParams = JSON.parse(decodeURIComponent(params)) as IFrameParams\n        return iframeParams\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as types from '../../types'\nimport IFrameSimulator from '../../lib/IFrameSimulator';\nimport { IFrameIntegration } from '../../lib/IFrameIntegration';\n\nimport { } from 'react-router-dom';\n\n// Action Definitions\n\n// export interface AppStart extends Action {\n//     type: ActionFlag.APP_START,\n\n// }\n\nexport interface AppSuccess extends Action {\n    type: ActionFlag.APP_SUCCESS,\n    config: types.AppConfig\n}\n\nexport interface AppError extends Action {\n    type: ActionFlag.APP_ERROR,\n    error: AppError\n}\n\n// Action Creators\n\nexport function appSuccess(config: types.AppConfig): AppSuccess {\n    return {\n        type: ActionFlag.APP_SUCCESS,\n        config: config\n    }\n}\n\nexport function appError(error: AppError): AppError {\n    return {\n        type: ActionFlag.APP_ERROR,\n        error: error\n    }\n}\n\n// Action Thunks\n\nexport function appStart() {\n    return (dispatch: ThunkDispatch<types.StoreState, void, Action>, getState: () => types.StoreState) => {\n        // check and see if we are in an iframe\n        let iframeParams = new IFrameIntegration().getParamsFromIFrame()\n\n        if (iframeParams) {\n            let defaultPath\n            switch (iframeParams.params.view) {\n                case 'org':\n                    defaultPath = '/viewOrganization/' + iframeParams.params.viewParams.id\n                    window.history.pushState(null, 'test', defaultPath)\n                    break\n                default:\n                    defaultPath = '/organizations'\n                    window.history.pushState(null, 'organizations', '/organizations')\n                    break\n            }\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: iframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: iframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: iframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: iframeParams.params.serviceWizardURL\n                    },\n                    Feeds: {\n                        url: iframeParams.params.feedsServiceURL\n                    },\n                    Auth: {\n                        url: iframeParams.params.authServiceURL\n                    }\n                },\n                defaultPath: defaultPath\n            }))\n\n        } else {\n            iframeParams = new IFrameSimulator().getParamsFromIFrame()\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: iframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: iframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: iframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: iframeParams.params.serviceWizardURL\n                    },\n                    Feeds: {\n                        url: iframeParams.params.feedsServiceURL\n                    },\n                    Auth: {\n                        url: iframeParams.params.authServiceURL\n                    }\n                },\n                defaultPath: '/organizations'\n            }))\n        }\n    }\n}\n","import * as React from 'react'\nimport './KBaseIntegration.css'\n\nimport { AppState } from '../types'\nimport { } from '../lib/IFrameSimulator'\n\nexport interface KBaseIntegrationProps {\n    status: AppState,\n    onAppStart: () => void\n}\nclass KBaseIntegration extends React.Component<KBaseIntegrationProps, object> {\n    constructor(props: KBaseIntegrationProps) {\n        super(props)\n\n        // const params = this.getParamsFromIFrame()\n\n        // this.props.onAppStart()\n    }\n\n    componentDidMount() {\n        this.props.onAppStart()\n    }\n\n    render() {\n        // TODO: some test like \n        // {this.props.env === 'dev' ? this.buildAuthDev() : this.buildAuthProd()}\n\n        if (this.props.status === AppState.NONE) {\n            return (\n                <div className=\"KBaseIntegration\">\n                    Loading...\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"KBaseIntegration scrollable-flex-column\">\n                    {this.props.children}\n                </div>\n            )\n        }\n    }\n\n    // getParamsFromIFrame() {\n    //     if (!window.frameElement) {\n    //         return null\n    //     }\n    //     if (!window.frameElement.hasAttribute('data-params')) {\n    //         // throw new Error('No params found in window!!');\n    //         return null\n    //     }\n    //     const params = window.frameElement.getAttribute('data-params');\n    //     if (params === null) {\n    //         // throw new Error('No params found in window!')\n    //         return null\n    //     }\n    //     return JSON.parse(decodeURIComponent(params));\n    // }\n}\n\nexport default KBaseIntegration","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../types'\nimport * as actions from '../redux/actions/app'\n\nimport KBaseIntegration from '../components/KBaseIntegration'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    status: types.AppState\n    defaultPath: string\n}\n\ninterface DispatchProps {\n    onAppStart: () => void\n}\n\nexport function mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const { app: { status, config: { defaultPath } } } = state\n    return {\n        status, defaultPath\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAppStart: () => {\n            dispatch(actions.appStart() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(KBaseIntegration)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\n\nimport { AppError, StoreState, User, InviteUserViewModel, ComponentLoadingState, RequestType, RequestResourceType, MemberType, OrganizationUser } from '../../types'\nimport { Model, UserQuery } from '../../data/model'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as userModel from '../../data/models/user'\nimport * as requestModel from '../../data/models/requests'\n\n// View Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.INVITE_USER_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_SUCCESS,\n    organization: orgModel.Organization,\n    users: Array<OrganizationUser> | null\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.INVITE_USER_UNLOAD\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization): LoadSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_SUCCESS,\n        organization: organization,\n        users: null\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.INVITE_USER_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const org = await orgClient.getOrg(organizationId)\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(loadError({\n                    code: 'invalid state',\n                    message: 'Organization kind must be \"NORMAL\"'\n                }))\n                return\n            }\n            dispatch(loadSuccess(org))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// User Selection\n\n\n\nexport interface InviteUserSearchUsers extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS,\n    query: UserQuery\n}\n\ninterface SearchUsersStart extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n}\n\nexport interface SearchUsersSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n    users: Array<OrganizationUser> | null\n}\n\ninterface SearchUsersError extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n    error: AppError\n}\n\nfunction searchUsersStart(): SearchUsersStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n    }\n}\n\nfunction searchUsersSuccess(users: Array<OrganizationUser> | null): SearchUsersSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n        users: users\n    }\n}\n\nfunction searchUsersError(error: AppError): SearchUsersError {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n        error: error\n    }\n}\n\nexport function inviteUserSearchUsers(query: UserQuery) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchUsersStart())\n\n        if (query.query.length === 0) {\n            dispatch(searchUsersSuccess(null))\n            return\n        }\n\n        const {\n            views: {\n                inviteUserView: { viewModel }\n            },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        // TODO: better form of type narrowing? \n        if (viewModel === null) {\n            return\n        }\n        const org = viewModel.organization\n\n        const userClient = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        let excludedUsers: Array<string> = []\n\n        // excludedUsers.push(org.owner.user.username)\n\n        let owner: string = org.owner.username\n        let adminUsers: Array<string> = []\n        let members: Array<string> = []\n        let invited: Array<string> = []\n        let requested: Array<string> = []\n\n        org.members.forEach((member) => {\n            switch (member.type) {\n                case MemberType.MEMBER:\n                    members.push(member.username)\n                case MemberType.ADMIN:\n                    adminUsers.push(member.username)\n            }\n        })\n\n        // excludedUsers = excludedUsers.concat(org.members.map((member) => {\n        //     return member.\n        // }))\n\n        // TODO revive\n        // org.adminRequests.forEach((request) => {\n        //     if (request.resourceType === RequestResourceType.USER) {\n        //         switch (request.type) {\n        //             case RequestType.INVITATION:\n        //                 invited.push((<UserInvitation>request).user.username)\n        //                 // excludedUsers.push((<UserInvitation>request).user.username)\n        //                 break\n        //             case RequestType.REQUEST:\n        //                 requested.push((<UserRequest>request).requester.username)\n        //             // excludedUsers.push((<UserRequest>request).requester.username)\n        //         }\n        //     }\n        // })\n\n        try {\n            const users = await userClient.searchUsers(query)\n\n\n            // const filteredUsers = users.filter((user) => {\n            //     return (excludedUsers.indexOf(user.username) === -1)\n            // })\n            const orgUsers: Array<OrganizationUser> = users.map(({ username, realname }) => {\n                let relation: orgModel.UserRelationToOrganization\n                if (username === owner) {\n                    relation = orgModel.UserRelationToOrganization.OWNER\n                } else if (adminUsers.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.ADMIN\n                } else if (invited.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n                } else if (requested.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING\n                } else if (members.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER\n                } else {\n                    relation = orgModel.UserRelationToOrganization.NONE\n                }\n                return {\n                    username, realname,\n                    relation: relation\n                }\n            })\n            dispatch(searchUsersSuccess(orgUsers))\n        } catch (ex) {\n            dispatch(searchUsersError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n// Select a user\n\nexport interface SelectUser extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER,\n    username: string\n}\n\nexport interface SelectUserStart extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_START\n}\n\nexport interface SelectUserSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n    user: User,\n    relation: orgModel.UserRelationToOrganization\n}\n\nexport interface SelectUserError extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n    error: AppError\n}\n\n\nfunction selectUserStart(): SelectUserStart {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_START\n    }\n}\n\nfunction selectUserSuccess(user: User, relation: orgModel.UserRelationToOrganization): SelectUserSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n        user: user,\n        relation: relation\n    }\n}\n\nfunction selectUserError(error: AppError): SelectUserError {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n        error: error\n    }\n}\n\nfunction isUserRequest(request: requestModel.Request, username: string): request is requestModel.UserRequest {\n    const req: requestModel.UserRequest = <requestModel.UserRequest>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.REQUEST &&\n        req.requester === username) {\n        return true\n    }\n    return false\n}\n\nfunction isUserInvitation(request: requestModel.Request, username: string): request is requestModel.UserRequest {\n    const req: requestModel.UserInvitation = <requestModel.UserInvitation>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.INVITATION &&\n        req.user &&\n        req.user === username) {\n        return true\n    }\n    return false\n}\n\nfunction getUserRelation(user: User, organization: orgModel.Organization): orgModel.UserRelationToOrganization {\n    if (user.username === organization.owner.username) {\n        return orgModel.UserRelationToOrganization.OWNER\n    }\n    const member = organization.members.find((member) => {\n        return member.username === user.username\n    })\n    if (member) {\n        switch (member.type) {\n            case MemberType.ADMIN:\n                return orgModel.UserRelationToOrganization.ADMIN\n            case MemberType.OWNER:\n                return orgModel.UserRelationToOrganization.OWNER\n            case MemberType.MEMBER:\n                return orgModel.UserRelationToOrganization.MEMBER\n        }\n    }\n\n    // TODO revive\n    // for (const request of organization.adminRequests) {\n    //     if (isUserInvitation(request, user.username)) {\n    //         return UserRelationToOrganization.MEMBER_INVITATION_PENDING\n    //     } else if (isUserRequest(request, user.username)) {\n    //         return UserRelationToOrganization.MEMBER_REQUEST_PENDING\n    //     }\n    // }\n\n    return orgModel.UserRelationToOrganization.VIEW\n}\n\nexport function selectUser(selectedUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectUserStart())\n\n        const {\n            views: {\n                inviteUserView: { viewModel }\n            },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        if (!viewModel) {\n            dispatch(selectUserError({\n                code: 'invalid state',\n                message: 'select user invalid state -- no view value'\n            }))\n            return\n        }\n\n        const userClient = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        userClient.getUser(selectedUsername)\n            .then((user) => {\n                // TODO: use the new model getUserRelation, or even getUserWithRelation\n                const relation = getUserRelation(user, viewModel.organization)\n                dispatch(selectUserSuccess(user, relation))\n            })\n            .catch((err) => {\n                dispatch(selectUserError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Now send the invitation, whew!\n\nexport interface SendInvitation extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION\n}\n\nexport interface SendInvitationStart extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n}\n\nexport interface SendInvitationSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n}\n\nexport interface SendInvitationError extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n    error: AppError\n}\n\n\nexport function sendInvitationStart(): SendInvitationStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n    }\n}\n\nexport function sendInvitationSuccess(): SendInvitationSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n    }\n}\n\nexport function sendInvitationError(error: AppError): SendInvitationError {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n        error: error\n    }\n}\n\nexport function sendInvitation() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendInvitationStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                inviteUserView: { loadingState, viewModel, error }\n            }\n        } = getState()\n\n        if (loadingState !== ComponentLoadingState.SUCCESS) {\n            return\n        }\n\n        if (viewModel === null) {\n            return\n        }\n\n        const { selectedUser, organization: { id } } = viewModel as InviteUserViewModel\n\n        if (!selectedUser) {\n            return\n        }\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        requestClient.inviteUserToJoinOrg(id, selectedUser.user.username)\n            .then((request) => {\n                dispatch(sendInvitationSuccess())\n            })\n            .catch((err) => {\n                dispatch(sendInvitationError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\nimport './User.css'\n\nimport Avatar from './entities/Avatar'\nimport * as types from '../types';\n\nexport interface UserProps {\n    user: types.User\n    avatarSize?: number\n}\n\ninterface UserState {\n\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n    }\n\n    render() {\n        return (\n            <div className=\"User\">\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        ❨{this.props.user.username}❩\n                                </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default User","import * as React from 'react'\n\nimport './component.css'\nimport { User, InviteUserViewState, OrganizationUser } from '../../../types';\nimport { Button, Icon, Modal, Alert } from 'antd';\nimport Header from '../../Header';\nimport { Redirect, NavLink } from 'react-router-dom';\nimport OrganizationHeader from '../organizationHeader/loader';\nimport UserComponent from '../../User'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\nimport MainMenu from '../../menu/component';\n\nexport interface InviteUserProps {\n    organization: orgModel.Organization,\n    selectedUser: {\n        user: User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: InviteUserViewState,\n    users: Array<OrganizationUser> | null\n    onSearchUsers: (query: userModel.UserQuery) => void,\n    onSelectUser: (username: string) => void,\n    onSendInvitation: () => void\n}\n\ninterface InviteUserState {\n    cancelToViewMembers: boolean\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n    autocompleteMessage: string\n}\n\nclass InviteUser extends React.Component<InviteUserProps, InviteUserState> {\n\n    lastSearchAt: Date | null\n\n    static searchDebounce: number = 200\n\n    searchInput: React.RefObject<HTMLInputElement>\n    searchButton: React.RefObject<Button>\n\n    constructor(props: InviteUserProps) {\n        super(props)\n\n        this.lastSearchAt = null\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.state = {\n            cancelToViewMembers: false,\n            cancelToBrowser: false,\n            cancelToViewer: false,\n            autocompleteMessage: ''\n        }\n    }\n\n    onClickCancelToViewMembers() {\n        this.setState({ cancelToViewMembers: true })\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n\n    onSendInvitation() {\n        this.props.onSendInvitation()\n    }\n\n    canSave() {\n        if (this.props.selectedUser) {\n            return true\n        }\n        return false\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.doSearchUsers(currentSearchInputValue)\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        // this.doSearchUsers(currentSearchInputValue)\n    }\n\n    doSearchUsers(value: string) {\n        // if (value.length < 3) {\n        //     this.setState({ autocompleteMessage: 'Search begins after 3 or more characters' })\n        //     return\n        // }\n        // this.setState({ autocompleteMessage: '' })\n        // build up list of users already owning, members of, or with membership pending.\n        const excludedUsers: Array<string> = []\n\n        if (this.lastSearchAt === null ||\n            (new Date().getTime() - this.lastSearchAt.getTime() > InviteUser.searchDebounce)) {\n            this.lastSearchAt = new Date()\n            this.props.onSearchUsers({\n                query: value,\n                excludedUsers: []\n            })\n        }\n    }\n\n    onSelectUser(user: OrganizationUser) {\n        this.props.onSelectUser(user.username);\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Invite User Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the invite user tool...</p>\n                </div>\n            )\n        })\n    }\n\n    // foundUsers() {\n    //     const users = this.props.users.map(({ username, realname }) => {\n    //         return {\n    //             value: username,\n    //             text: realname + ' (' + username + ')'\n    //         }\n    //     })\n    //     return users\n    // }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    renderHeader() {\n        let orgName: string\n        // if (this.props.manageGroupRequestsView && this.props.manageGroupRequestsView.view) {\n        //     orgName = this.props.manageGroupRequestsView.view.organization.name\n        // } else {\n        //     orgName = 'loading...'\n        // }\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"tool\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Invite a User to Join Org</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                {/* <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.onClickCancelToViewMembers.bind(this)}>\n                    Return to Org Members\n            </Button>\n                <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.onClickCancelToViewer.bind(this)}>\n                    Return to this Org\n            </Button> */}\n\n\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.onShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderUsers() {\n        if (!this.props.users) {\n            const message = 'Search for users by name or username to display a list of available users in this space.'\n            return (\n                <Alert type=\"info\" message={message} showIcon />\n            )\n        }\n        if (this.props.users.length === 0) {\n            return (\n                <Alert type=\"warning\" message=\"No users found\" showIcon />\n            )\n        }\n        return this.props.users.map((user) => {\n            if (user.relation === orgModel.UserRelationToOrganization.NONE) {\n                return (\n                    <div\n                        className=\"user notInOrganization \"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            } else {\n                return (\n                    <div\n                        className=\"user inOrganization\"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            }\n        })\n    }\n\n    renderOrgInfo() {\n        return (\n            <div className=\"orgInfo\">\n                <div className=\"name\">\n                    <span className=\"field-label\">name</span>\n                    <span>{this.props.organization.name}</span>\n                </div>\n                <div className=\"description\">\n                    <span className=\"field-label\">description</span>\n                    <span>{this.props.organization.description}</span>\n                </div>\n            </div>\n        )\n    }\n\n\n\n    renderInvitationForm() {\n        let button\n        let message\n        if (this.props.selectedUser) {\n            if (this.props.selectedUser.relation === orgModel.UserRelationToOrganization.VIEW) {\n                button = (\n                    <Button\n                        type=\"primary\"\n                        onClick={this.onSendInvitation.bind(this)}>Send Invitation</Button>\n                )\n            } else {\n                button = (\n                    <Button\n                        disabled\n                        type=\"primary\"\n                    >Send Invitation</Button>\n                )\n                // message = 'User is a member of this organization'\n                message = (\n                    <div>\n                        User may not be invited because:<br />\n                        {this.renderRelation(this.props.selectedUser.relation)}\n                    </div>\n                )\n                message = (\n                    <Alert\n                        type=\"warning\"\n                        message={message}\n                        showIcon\n                    />\n                )\n            }\n        } else {\n            button = (\n                <Button\n                    disabled\n                    type=\"primary\"\n                >Send Invitation</Button>\n            )\n            message = 'Please select a user'\n        }\n        return (\n            <div className=\"invitationForm\">\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {button}\n                </div>\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {message}\n                </div>\n            </div>\n        )\n    }\n\n    renderInvitationStatus() {\n        switch (this.props.editState) {\n            case InviteUserViewState.NONE:\n                return (\n                    <div>NONE</div>\n                )\n            case InviteUserViewState.EDITING:\n                return (\n                    <div>EDITING</div>\n                )\n            case InviteUserViewState.SENDABLE:\n                return (\n                    <div>SENDABLE</div>\n                )\n            case InviteUserViewState.SENDING:\n                return (\n                    <div>SENDING</div>\n                )\n            case InviteUserViewState.SUCCESS:\n                return (\n                    <div>SENT SUCCESSFULLY</div>\n                )\n            case InviteUserViewState.ERROR:\n                return (\n                    <div>ERROR SENDING</div>\n                )\n            default:\n                return (\n                    <div>Bad State</div>\n                )\n        }\n\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    renderRelation(relation: orgModel.UserRelationToOrganization) {\n        switch (relation) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <span><Icon type=\"stop\" /> Not a member</span>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> User's membership <b>request</b> is pending</span>)\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> User has been <b>invited</b> to join</span>)\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" /> User is a <b>member</b> of this organization</span>)\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />User is an <b>admin</b> of this organization</span>)\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n\n                    <span><Icon type=\"crown\" /> User is the <b>owner</b> of this Organization</span>\n                )\n        }\n    }\n\n    // renderRelationText(relation: UserRelationToOrganization) {\n    //     switch (relation) {\n    //         case (UserRelationToOrganization.NONE):\n    //             return (\n    //                 <span><Icon type=\"stop\" />None</span>\n    //             )\n    //         case (UserRelationToOrganization.VIEW):\n    //             return (\n    //                 <span><Icon type=\"stop\" /> Not a member</span>\n    //             )\n    //         case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> User's membership <b>request</b> is pending</span>)\n    //         case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> User has been <b>invited</b> to join</span>)\n    //         case (UserRelationToOrganization.MEMBER):\n    //             return (<span><Icon type=\"user\" /> User is a <b>member</b> of this organization</span>)\n    //         case (UserRelationToOrganization.ADMIN):\n    //             return (<span><Icon type=\"unlock\" />User is an <b>admin</b> of this organization</span>)\n    //         case (UserRelationToOrganization.OWNER):\n    //             return (\n    //                 <span><Icon type=\"crown\" /> User is the <b>owner</b> of this Organization</span>\n    //             )\n    //     }\n    // }\n\n    renderSelectedUser() {\n\n        if (this.props.selectedUser === null) {\n            return (\n                <div className=\"selectedUser\">\n                    <p className=\"noSelection\">\n                        No user yet selected\n                    </p>\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"selectedUser\">\n                    <UserComponent user={this.props.selectedUser.user} />\n                    {this.renderRelation(this.props.selectedUser.relation)}\n                </div>\n            )\n        }\n    }\n\n    renderFooter() {\n        return (\n            <div className=\"footer\">\n            </div>\n        )\n    }\n\n    renderSearchButton() {\n        return (<Icon type=\"search\" />)\n    }\n\n    renderMenuButtons() {\n        return (\n            <div className=\"ButtonSet\">\n                <div className=\"ButtonSet-button\">\n                    <Button icon=\"rollback\"\n                        type=\"danger\"\n                        onClick={this.onClickCancelToViewer.bind(this)}>\n                        Back to Org\n                    </Button>\n                </div>\n                <div className=\"ButtonSet-button\">\n                    <Button\n                        shape=\"circle\"\n                        icon=\"info\"\n                        onClick={this.onShowInfo.bind(this)}>\n                    </Button>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n\n        if (this.state.cancelToViewMembers) {\n            return <Redirect push to={\"/viewMembers/\" + this.props.organization.id} />\n        }\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"InviteUser scrollable-flex-column\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                {/* {this.renderHeader()} */}\n                {this.renderOrgHeader()}\n                <div className=\"row scrollable-flex-column\">\n                    <div className=\"col1 firstCol users scrollable-flex-column\">\n                        <h3>Select User to Invite</h3>\n                        <form id=\"searchForm\" className=\"searchBar\"\n                            onSubmit={this.onSubmit.bind(this)}>\n                            <input\n                                ref={this.searchInput}\n                                autoFocus\n                                onChange={this.onSearchInputChange.bind(this)}\n                                placeholder=\"Search for a user\"\n                            />\n                            <Button\n                                className=\"searchButton\"\n                                form=\"searchForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\"\n                            >\n                                {this.renderSearchButton()}\n                            </Button>\n                        </form>\n                        <div className=\"usersTable\">\n                            {this.renderUsers()}\n                        </div>\n                        {/* <SelectUserComponent\n                            users={this.props.users}\n                            selectedUser={this.props.selectedUser}\n                            onSearchUsers={this.onSearchUsers.bind(this)}\n                            onSelectUser={this.onSelectUser.bind(this)}\n                        />\n                        {this.renderInvitationForm()}\n                        {this.renderInvitationStatus()} */}\n                    </div>\n                    <div className=\"col1 lastCol\">\n                        <h3>Selected User</h3>\n                        {this.renderSelectedUser()}\n                        {this.renderInvitationForm()}\n                    </div>\n                </div>\n                {/* <div className=\"row\">\n                    <div className=\"col1\">\n                        <h3>Send Invitation</h3>\n                        {this.renderInvitationForm()}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\">\n                        <h3>Status</h3>\n                        {this.renderInvitationStatus()}\n                    </div>\n                </div> */}\n                {/* {this.renderUsers()} */}\n                {this.renderFooter()}\n            </div>\n        )\n\n        // return (\n        //     <div className=\"InviteUser\">\n        //         {this.renderHeader()}\n        //         {this.renderOrgHeader()}\n        //         <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Select User to Invite</h3>\n        //                 <SelectUserComponent\n        //                     users={this.props.users}\n        //                     selectedUser={this.props.selectedUser}\n        //                     onSearchUsers={this.onSearchUsers.bind(this)}\n        //                     onSelectUser={this.onSelectUser.bind(this)}\n        //                 />\n        //                 {this.renderInvitationForm()}\n        //                 {this.renderInvitationStatus()}\n        //             </div>\n        //         </div>\n        //         {/* <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Send Invitation</h3>\n        //                 {this.renderInvitationForm()}\n        //             </div>\n        //         </div>\n        //         <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Status</h3>\n        //                 {this.renderInvitationStatus()}\n        //             </div>\n        //         </div> */}\n        //         {/* {this.renderUsers()} */}\n        //     </div>\n        // )\n    }\n}\n\nexport default InviteUser","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/inviteUser'\nimport InviteUser from './component'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    users: Array<types.OrganizationUser> | null\n    selectedUser: {\n        user: types.User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: types.InviteUserViewState\n}\n\ninterface DispatchProps {\n    onSearchUsers: (query: userModel.UserQuery) => void\n    onSelectUser: (username: string) => void\n    onSendInvitation: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    if (!state.views.inviteUserView || (state.views.inviteUserView.viewModel === null)) {\n        throw new Error('Runtime Error - invite members view is not defined!')\n    }\n\n\n    const {\n        views: {\n            inviteUserView: {\n                viewModel: { organization, users, selectedUser, editState }\n            }\n        }\n    } = state\n\n    return { organization, users, selectedUser, editState }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onSearchUsers: ({ query, excludedUsers }) => {\n            dispatch(actions.inviteUserSearchUsers({ query, excludedUsers }) as any)\n        },\n        onSelectUser: (username: string) => {\n            dispatch(actions.selectUser(username) as any)\n        },\n        onSendInvitation: () => {\n            dispatch(actions.sendInvitation() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(InviteUser)","import * as React from 'react'\n\nimport Container from './container'\nimport { ComponentLoadingState, StoreState } from '../../../types';\n\nexport interface InviteUserLoaderProps {\n    loadingState: ComponentLoadingState\n    organizationId: string\n    onInviteUserLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface InviteUserLoaderState {\n}\n\nclass InviteUserLoader extends React.Component<InviteUserLoaderProps, InviteUserLoaderState> {\n    constructor(props: InviteUserLoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading Users...\n            </div>\n        )\n    }\n\n    renderError() {\n        return (\n            <div>\n                Error!\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onInviteUserLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../redux/actions/inviteUser'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    loadingState: ComponentLoadingState\n}\n\ninterface DispatchProps {\n    onInviteUserLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        loadingState: state.views.inviteUserView.loadingState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onInviteUserLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(InviteUserLoader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport { StoreState, SyncState, ValidationErrorType } from '../../types'\nimport { AnError, makeError } from '../../lib/error'\nimport Validation from '../../data/models/organization/validation';\nimport { ActionFlag } from '.';\n\n// Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n    error: AnError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UNLOAD\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, editableMemberProfile: orgModel.EditableMemberProfile): LoadSuccess {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n        organization: organization,\n        editableMemberProfile: editableMemberProfile\n    }\n}\n\nexport function loadError(error: AnError): LoadError {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        // TODO: here is where we would hook into the store state entities for groups\n        try {\n            const org = await orgClient.getOrg(organizationId)\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(loadError(makeError({\n                    code: 'invalid state',\n                    message: 'Organization must be of kind \"NORMAL\"'\n                })))\n                return\n            }\n\n            if (!org.isMember) {\n                dispatch(loadError(makeError({\n                    code: 'notfound',\n                    message: 'The user \"' + username + '\" is not a member of this org'\n                })))\n                return\n            }\n\n            const thisMember = org.members.find((member) => {\n                return member.username === username\n            })\n            if (!thisMember) {\n                dispatch(loadError(makeError({\n                    code: 'notfound',\n                    message: 'The user \"' + username + '\" was not found in the members list'\n                })))\n                return\n            }\n\n            const editableProfile: orgModel.EditableMemberProfile = {\n                title: {\n                    value: thisMember.title,\n                    remoteValue: thisMember.title,\n                    syncState: SyncState.NEW,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n            dispatch(loadSuccess(org, editableProfile))\n            // dispatch(evaluate())\n        } catch (ex) {\n            console.error('Error :(', ex)\n            dispatch(loadError(makeError({\n                code: ex.name,\n                message: ex.message\n            })))\n        }\n    }\n}\n\n// Leaving the Org\n\nexport interface LeaveOrg extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG\n    organizationId: orgModel.OrganizationID\n}\n\ninterface LeaveOrgSuccess extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS\n}\n\ninterface LeaveOrgError extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,\n    error: AnError\n}\n\nexport function leaveOrg(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(({\n            type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_START\n        }))\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            orgClient.removeMember(organizationId, username)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS\n            })\n        } catch (ex) {\n            console.error('ERROR leaving org', ex)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n\n\n    }\n}\n\n\n// Updating Profile\n\nexport interface UpdateTitle {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE,\n    title: string\n}\n\nexport interface UpdateTitleStart {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_START\n}\n\nexport interface UpdateTitleSuccess {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,\n    title: string\n}\n\nexport interface UpdateTitleError {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,\n    error: AnError\n}\n\nexport interface Save {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE,\n    memberProfile: orgModel.EditableMemberProfile\n}\n\nexport interface SaveStart {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_START\n}\n\nexport interface SaveSuccess {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS\n}\n\nexport interface SaveError {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR,\n    error: AnError\n}\n\nexport function updateTitle(title: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedTitle, error] = Validation.validateMemberTitle(title)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,\n                error: makeError({\n                    code: 'invalid',\n                    message: error.message\n                })\n            })\n        } else {\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,\n                title: validatedTitle\n            })\n        }\n        dispatch(evaluate())\n    }\n}\n\nexport interface Evaluate extends Action<ActionFlag.MANAGE_MEMBERSHIP_EVALUATE> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE\n}\n\nexport interface EvaluateSuccess extends Action<ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS,\n}\n\nexport interface EvaluateError extends Action<ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR\n}\n\nexport function evaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.manageMembershipView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            views: {\n                manageMembershipView: {\n                    viewModel: {\n                        editableMemberProfile\n                    }\n                }\n            }\n        } = state\n\n        if (editableMemberProfile.title.validationState.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR\n            })\n            return\n        }\n\n        dispatch({\n            type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS\n        })\n    }\n}\n\nexport interface Save extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE\n}\n\nexport interface SaveStart extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE_START> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_START\n}\n\nexport interface SaveSuccess extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS\n}\n\nexport interface SaveError extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR\n}\n\nexport function save() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_START\n        })\n\n        const state = getState()\n        if (!state.views.manageMembershipView.viewModel) {\n            throw new Error('Argh, no view model?!?')\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                manageMembershipView: {\n                    viewModel: { organization, editableMemberProfile }\n                }\n            },\n            app: { config }\n        } = state\n\n        const update = {\n            title: editableMemberProfile.title.value\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.updateMember(organization.id, username, update)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS\n            })\n        } catch (ex) {\n            console.error('error saving member profile', ex)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n        dispatch(evaluate())\n    }\n}\n","import * as React from 'react'\nimport Header from '../../Header';\nimport { Icon, Button, Modal, Input } from 'antd';\nimport { NavLink } from 'react-router-dom';\nimport './component.css'\nimport OrganizationHeader from '../organizationHeader/loader';\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\nimport { Editable, ValidationErrorType, SyncState, EditState, SaveState, ValidationState } from '../../../types';\n\nexport interface ManageMembershipProps {\n    username: userModel.Username\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    onLeaveOrganization: (organizationId: string) => void\n    onUpdateTitle: (title: string) => void\n    onSave: () => void\n}\n\ninterface MangeMembershipState {\n}\n\nclass ManageMembership extends React.Component<ManageMembershipProps, MangeMembershipState> {\n    constructor(props: ManageMembershipProps) {\n        super(props)\n    }\n\n    doLeaveOrg() {\n        // alert('this will leave you the org')\n        // this.props.onLeaveOrganization(this.props.organization.id)\n        const confirmed = (() => {\n            this.doLeaveOrgConfirmed()\n        }).bind(this)\n        Modal.confirm({\n            title: 'Really leave this organization?',\n            content: (\n                <p>\n                    This is not reversible.\n                </p>\n            ),\n            width: '50em',\n            onOk: () => {\n                confirmed()\n            }\n        })\n    }\n\n    doLeaveOrgConfirmed() {\n        // alert('this will leave you the org')\n        this.props.onLeaveOrganization(this.props.organization.id)\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState.type === ValidationErrorType.OK &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.props.onSave()\n    }\n\n    onTitleChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateTitle(e.target.value)\n    }\n\n    doShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'Manage My Membership Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view to help you manage your membership...</p>\n                </div>\n            )\n        })\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"user\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Manage your membership</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                {/* <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.doCancelToViewer.bind(this)}>\n                    Return to this Org\n                </Button> */}\n\n                <Button\n                    // shape=\"circle\"\n                    type=\"danger\"\n                    icon=\"frown\"\n                    onClick={this.doLeaveOrg.bind(this)}>\n                    Leave Organization...\n                </Button>\n                {' '}\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.doShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    calcFieldClass(field: Editable) {\n        switch (field.validationState.type) {\n            // case (ValidationErrorType.OK):\n            //     return 'validation-ok'\n            case (ValidationErrorType.ERROR):\n                return 'ManageMembership-validation-error'\n            case (ValidationErrorType.REQUIRED_MISSING):\n                return 'ManageMembership-validation-error'\n        }\n\n        switch (field.syncState) {\n            case (SyncState.DIRTY):\n                return 'ManageMembership-sync-dirty'\n            default:\n                return 'ManageMembership-validation-ok'\n        }\n    }\n\n    renderEditor() {\n        return (\n            <form id=\"editMembership\"\n                className=\"ManageMembership-editorTable\"\n                onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"ManageMembership-headerRow\">\n                    <div className=\"ManageMembership-editCol ManageMembership-headerCol\">\n                        Edit\n                    </div>\n                    <div className=\"ManageMembership-editCol ManageMembership-headerCol\">\n                        Preview\n                    </div>\n                </div>\n                <div className=\"ManageMembership-editorTable-row\">\n                    <div className=\"ManageMembership-editCol ManageMembership-editCell\">\n                        <div className=\"ManageMembership-editorTable-labelCol\">\n                            <span className=\"field-label ManageMembership-titleLabel\">\n                                title\n                            </span>\n                        </div>\n                        <div className=\"ManageMembership-editorTable-controlCol\">\n                            <Input value={this.props.editableMemberProfile.title.value || ''}\n                                className={this.calcFieldClass(this.props.editableMemberProfile.title)}\n                                onChange={this.onTitleChange.bind(this)} />\n                        </div>\n                    </div>\n                    <div className=\"ManageMembership-previewCol ManageMembership-previewCell\">\n                        <div className=\"ManageMembership-titlePreview\">\n                            {this.props.editableMemberProfile.title.value}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"ManageMembership-editorFooter\">\n                    <Button icon=\"save\"\n                        form=\"editMembership\"\n                        key=\"submit\"\n                        disabled={!this.canSave.call(this)}\n                        htmlType=\"submit\">\n                        Save\n                </Button>\n                </div>\n            </form>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"ManageMembership\">\n                {this.renderOrgHeader()}\n                {this.renderHeader()}\n                <h3>\n                    Edit Your Membership Profile\n                </h3>\n\n                <div className=\"ManageMembership-body\">\n                    {this.renderEditor()}\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default ManageMembership","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../redux/actions/manageMembership'\n\nimport { StoreState, EditState, SaveState, ValidationState } from '../../../types';\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\n\nimport Component from './component'\n\nexport interface OwnProps {\n}\n\ninterface StateProps {\n    username: userModel.Username\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n}\n\ninterface DispatchProps {\n    onLeaveOrganization: (organizationId: string) => void,\n    onUpdateTitle: (title: string) => void\n    onSave: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    if (!state.views.manageMembershipView.viewModel) {\n        throw new Error('View model missing')\n    }\n    const {\n        auth: { authorization: { username } },\n        views: {\n            manageMembershipView: {\n                viewModel: { organization, editableMemberProfile, editState, saveState, validationState }\n            }\n        }\n    } = state\n    return {\n        username, organization, editableMemberProfile,\n        editState, saveState, validationState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLeaveOrganization: (organizationId: string) => {\n            dispatch(actions.leaveOrg(organizationId) as any)\n        },\n        onUpdateTitle: (title: string) => {\n            dispatch(actions.updateTitle(title) as any)\n        },\n        onSave: () => {\n            dispatch(actions.save() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\nimport { Alert, Collapse } from 'antd';\nimport './component.css'\nimport { AnError } from './api';\n\nexport interface ErrorProps {\n    error: AnError\n}\n\ninterface ErrorState {\n\n}\n\nexport default class Error extends React.Component<ErrorProps, ErrorState> {\n    constructor(props: ErrorProps) {\n        super(props)\n    }\n\n    renderDetail() {\n        return (\n            <table className='errorTable'>\n                <tbody>\n                    <tr>\n                        <th>\n                            <span className=\"field-label\">generated at</span>\n                        </th>\n                        <td>\n                            {\n                                Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(this.props.error.at)\n                            }\n                        </td>\n                    </tr>\n                    <tr>\n                        <th>\n                            <span className=\"field-label\">error id</span>\n                        </th>\n                        <td>\n                            <span style={{ fontFamily: 'monospace' }}>{this.props.error.id}</span>\n                        </td>\n                    </tr>\n                    <tr>\n                        <th>\n                            <span className=\"field-label\">explanation</span>\n                        </th>\n                        <td>\n                            {this.props.error.detail}\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        )\n    }\n\n    renderInfo() {\n        if (!this.props.error.info) {\n            return (\n                <div style={{ textAlign: 'left', fontStyle: 'italic' }}>\n                    No additional information\n                </div>\n            )\n        }\n        return (\n            <div>\n                additional info here ...\n            </div>\n        )\n    }\n\n    render() {\n        const description = (\n            <div>\n                <p>\n                    {this.props.error.message}\n                </p>\n                <Collapse bordered={false} style={{ backgroundColor: 'transparent' }}>\n                    <Collapse.Panel header=\"detail\" key=\"1\" style={{ backgroundColor: 'transparent' }}>\n                        {this.renderDetail()}\n                    </Collapse.Panel>\n                </Collapse>\n                <Collapse bordered={false} style={{ backgroundColor: 'transparent' }}>\n                    <Collapse.Panel header=\"additional info\" key=\"1\" style={{ backgroundColor: 'transparent' }}>\n                        {this.renderInfo()}\n                    </Collapse.Panel>\n                </Collapse>\n            </div>\n        )\n\n        return (\n            <Alert\n                type=\"error\"\n                showIcon\n                message=\"Error\"\n                className=\"Error\"\n                description={description}\n            />\n        )\n    }\n}","import uuid from 'uuid/v4'\n\nexport interface AnError {\n    code: string\n    message: string\n    id: string\n    at: Date\n\n\n    detail?: string\n    history?: Array<AnError>\n    trace?: Array<string>\n    info?: any\n}\n\nexport function makeError(\n    { code, message, detail, history, trace, info }:\n        {\n            code: string, message: string,\n            detail?: string,\n            history?: Array<AnError>, trace?: Array<string>, info?: any\n        }\n) {\n    return {\n        code, message, detail,\n        id: uuid(),\n        at: new Date(),\n        history, trace, info\n    }\n}","import * as React from 'react'\nimport { ManageMembershipView, ComponentLoadingState, StoreState } from '../../../types'\nimport Container from './container'\nimport Error from '../../../combo/error/component'\n\nexport interface Props {\n    organizationId: string\n    view: ManageMembershipView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoadingNone() {\n        return (\n            <div>\n                Loading membership editor (none)...\n            </div>\n        )\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading membership editor...\n            </div>\n        )\n    }\n\n    renderError(error: AnError) {\n        return (\n            <Error error={error} />\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoadingNone()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError(makeError({\n                        code: 'missing-error',\n                        message: 'The error appears to be missing'\n                    }))\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../redux/actions/manageMembership'\nimport { AnError, makeError } from '../../../combo/error/api';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: ManageMembershipView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.manageMembershipView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\n\nimport OrganizationHeader from '../organizationHeader/loader';\nimport { Redirect, NavLink } from 'react-router-dom';\nimport { NarrativeState } from '../../../types';\nimport Header from '../../Header';\nimport { Icon, Button, Modal, Alert, Select, Tooltip } from 'antd';\nimport './component.css'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as narrativeModel from '../../../data/models/narrative'\nimport MainMenu from '../../menu/component';\nimport { OrganizationNarrative, AccessibleNarrative } from '../../../data/models/narrative';\n\n\nexport interface Props {\n    organization: orgModel.Organization\n    narratives: Array<OrganizationNarrative>\n    relation: orgModel.Relation\n    selectedNarrative: OrganizationNarrative | null\n    searching: boolean\n    sortBy: string\n    // sortDirection: string\n    filter: string\n    doSortBy: (sortBy: narrativeModel.Sort) => void\n    doSendRequest: (groupId: string, workspaceId: number) => void\n    doSelectNarrative: (narrative: OrganizationNarrative) => void\n}\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    VIEWER\n}\n\ninterface State {\n    navigateTo: NavigateTo,\n    // selectedNarrative: Narrative | null\n}\n\nexport class RequestAddNarrative extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n\n        this.state = {\n            navigateTo: NavigateTo.NONE,\n            // selectedNarrative: null\n        }\n    }\n\n    doCancelToBrowser() {\n        this.setState({ navigateTo: NavigateTo.BROWSER })\n    }\n\n    doCancelToViewer() {\n        this.setState({ navigateTo: NavigateTo.VIEWER })\n    }\n\n    doSelectNarrative(narrative: OrganizationNarrative) {\n        this.props.doSelectNarrative(narrative)\n    }\n\n    doShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'Request to Add Narrative Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view to help you request the addition of a narrative to this org...</p>\n                </div>\n            )\n        })\n    }\n\n    doSendRequest() {\n        if (this.props.selectedNarrative === null) {\n            console.warn('attempt to send request without selected narrative')\n            return\n        }\n        this.props.doSendRequest(this.props.organization.id, this.props.selectedNarrative.narrative.workspaceId)\n    }\n\n    canSendRequest() {\n        if (this.props.selectedNarrative) {\n            return true\n        }\n        return false\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organizationId={this.props.organization.id} />\n        )\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    renderHeader() {\n        let orgName: string\n        const breadcrumbs = (\n            <React.Fragment>\n                <span>\n                    <NavLink to={`/viewOrganization/${this.props.organization.id}`}>\n                        <span style={{ fontWeight: 'bold' }}>\n                            {this.renderOrgName(this.props.organization.name)}\n                        </span>\n                    </NavLink>\n\n                    <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n\n                    <Icon type=\"plus\" />\n                    {' '}\n                    <span style={{ fontSize: '120%' }}>Add Narrative to Org</span>\n                </span>\n            </React.Fragment>\n        )\n        const buttons = (\n            <React.Fragment>\n                {/* <Button icon=\"undo\"\n                    type=\"danger\"\n                    onClick={this.doCancelToViewer.bind(this)}>\n                    Return to this Org\n                </Button> */}\n                <Button\n                    shape=\"circle\"\n                    icon=\"info\"\n                    onClick={this.doShowInfo.bind(this)}>\n                </Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    renderNarrative(narrative: AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"RequestNarrative-title\">\n                    {narrative.title}\n                </div>\n                {/* <div className=\"RequestNarrative-owner\">\n                    <span className=\"field-label\">owner</span>\n                    <div style={{ display: 'inline-block' }}>\n                        <User userId={narrative.owner} avatarSize={20} />\n                    </div>\n                </div> */}\n                <div className=\"RequestNarrative-modifiedAt\">\n                    <span className=\"field-label\">Last saved</span>\n                    {Intl.DateTimeFormat('en-US', {\n                        month: 'long',\n                        day: 'numeric',\n                        year: 'numeric'\n                    }).format(narrative.lastSavedAt)}\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNarratives() {\n        if (this.props.narratives.length === 0) {\n            return (\n                <div className=\"message\">\n                    You do not have any Narratives\n                </div>\n            )\n        }\n        return this.props.narratives.map((orgNarrative, index) => {\n            const { status, narrative } = orgNarrative\n            let isSelected\n            if (this.props.selectedNarrative &&\n                narrative.workspaceId === this.props.selectedNarrative.narrative.workspaceId) {\n                isSelected = true\n            } else {\n                isSelected = false\n            }\n            let classNames = ['RequestNarrative-narrativeCell']\n            if (isSelected) {\n                classNames.push('RequestNarrative-selected')\n            }\n            let flag\n            switch (status) {\n                case NarrativeState.ASSOCIATED:\n                    classNames.push('RequestNarrative-narrativeInOrg')\n                    flag = (\n                        <Tooltip title=\"This narrative is already associated with this organization\">\n                            <Icon type=\"check\" style={{ color: 'green' }} />\n                        </Tooltip>\n                    )\n                    break\n                case NarrativeState.REQUESTED:\n                    classNames.push('RequestNarrative-narrativeInOrg')\n                    flag = (\n                        <Tooltip title=\"You have already requested that this narrative be added to this organization\">\n                            <Icon type=\"loading\" style={{ color: 'orange' }} />\n                        </Tooltip>\n                    )\n                    break\n                default:\n                    classNames.push('RequestNarrative-narrativeNotInOrg')\n            }\n\n            return (\n                <div\n                    className={classNames.join(' ')}\n                    onClick={() => { this.doSelectNarrative.call(this, orgNarrative) }}\n                    key={String(index)}>\n                    <div className=\"RequestNarrative-narrativeFlag\">\n                        {flag}\n                    </div>\n                    <div className=\"RequestNarrative-narrative\">\n                        {this.renderNarrative(orgNarrative.narrative)}\n                    </div>\n                </div>\n            )\n        })\n    }\n\n    onSearchSubmit() {\n        console.log('searching...')\n        return\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchBar() {\n        return (\n            <form id=\"searchForm\"\n                className=\"RequestNarrative-searchBar\"\n                onSubmit={this.onSearchSubmit.bind(this)}>\n                <input\n                    placeholder=\"Search your Narratives\"\n                    // onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                // ref={this.searchInput}\n                />\n                {/* <Tooltip\n                    title=\"Enter one or more words to search organizations by name or owner\">\n                    <Icon type=\"info-circle\" theme=\"twoTone\" style={{ alignSelf: 'end' }} />\n                </Tooltip> */}\n                <Button\n                    // disabled={!this.haveSearchInput()}\n                    // ref={this.searchButton}\n                    className=\"RequestNarrative-button\"\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                    {/* Search */}\n                </Button>\n\n                {/* <div className=\"message\">\n                    {this.renderSearchFeedback()}\n                </div> */}\n            </form>\n        )\n    }\n\n    renderFeedbackBar() {\n        return (\n            <div>\n                Showing\n                {' '}\n                {\n                    Intl.NumberFormat('en-US', {\n                        style: 'decimal',\n                        useGrouping: true\n                    }).format(this.props.narratives.length)\n                }\n                {' '}\n                narratives\n            </div>\n        )\n    }\n\n    onSortByChange(value: string) {\n        switch (value) {\n            case 'title':\n                this.props.doSortBy(narrativeModel.Sort.TITLE)\n                break\n            case 'savedAt':\n                this.props.doSortBy(narrativeModel.Sort.LAST_SAVED)\n                break\n        }\n    }\n\n    onSortDirectionChange() {\n\n    }\n\n    onFilterChange() {\n\n    }\n\n    renderFilterSortBar() {\n        return (\n            <div className=\"RequestNarrative-filterSortBar\">\n                <span className=\"field-label\">sort by</span>\n                <Select onChange={this.onSortByChange.bind(this)}\n                    defaultValue={this.props.sortBy}\n                    style={{ width: '8em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"title\" key=\"title\">Title</Select.Option>\n                    <Select.Option value=\"savedAt\" key=\"savedAt\">Last saved</Select.Option>\n                </Select>\n                {/* <Select onChange={this.onSortDirectionChange.bind(this)}\n                    style={{ width: '4em' }}\n                    dropdownMatchSelectWidth={true}\n                    defaultValue={this.props.sortDirection}>\n                    <Select.Option value={SortDirection.ASCENDING} key=\"name\"><Icon type=\"sort-ascending\" /></Select.Option>\n                    <Select.Option value={SortDirection.DESCENDING} key=\"owner\"><Icon type=\"sort-descending\" /></Select.Option>\n                </Select> */}\n                {/* <span className=\"field-label\" style={{ marginLeft: '10px' }}>filter</span>\n                <Select onChange={this.onFilterChange.bind(this)}\n                    defaultValue={this.props.filter}\n                    style={{ width: '10em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"all\" key=\"all\">All</Select.Option>\n                    <Select.Option value=\"notAssociatedPending\" key=\"notAssociatedPending\">Not Associated/Pending</Select.Option>\n                    <Select.Option value=\"associatedPending\" key=\"associatedPending\">Only Associated/Pending</Select.Option>\n                </Select> */}\n            </div>\n        )\n    }\n\n    renderNarrativeSelector() {\n        return (\n            <div className=\"RequestNarrative-narrativeSelector scrollable-flex-column\">\n                <div style={{ display: 'flex', flexDirection: 'row' }}>\n                    {/* <div style={{ flex: '0 0 10em' }}>\n                        {this.renderSearchBar()}\n                    </div> */}\n                    <div style={{ flex: '1 1 0px' }}>\n                        {this.renderFilterSortBar()}\n                    </div>\n                </div>\n                <div className=\"RequestNarrative-feedbackBar\">\n                    {this.renderFeedbackBar()}\n                </div>\n                <div className=\"RequestNarrative-narratives scrollable-flex-column\">\n                    <div className=\"RequestNarrative-narrativesTable\">\n                        {this.renderNarratives()}\n                    </div>\n                </div>\n            </div >\n        )\n    }\n\n    renderSelectedNarrativeButton() {\n        if (!this.props.selectedNarrative) {\n            return\n        }\n        if (this.props.selectedNarrative.status === NarrativeState.ASSOCIATED) {\n            return (\n                <Alert type=\"info\" message=\"This Narrative is associated with this Organization\" />\n            )\n        } else if (this.props.selectedNarrative.status === NarrativeState.REQUESTED) {\n            return (\n                <Alert type=\"warning\" message=\"You have requested to associate this Narrative with this Organization\" />\n            )\n        }\n        let buttonLabel\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            buttonLabel = 'Add Selected Narrative to Organization'\n        } else {\n            buttonLabel = 'Request Association of Selected Narrative to Organization'\n        }\n        return (\n            <Button\n                type=\"primary\"\n                onClick={this.doSendRequest.bind(this)}\n                disabled={!this.canSendRequest.call(this)}\n            >{buttonLabel}</Button>\n        )\n\n    }\n\n    renderSelectedNarrative() {\n        if (this.props.selectedNarrative) {\n            return (\n                <div className=\"RequestNarrative-selectedNarrative\">\n                    <div className=\"RequestNarrative-title\">\n                        {this.props.selectedNarrative.narrative.title}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">last saved</span>\n                        {' '}\n                        {Intl.DateTimeFormat('en-US', {\n                            month: 'long',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(this.props.selectedNarrative.narrative.lastSavedAt)}\n                    </div>\n                </div>\n            )\n        } else {\n            return (\n                <Alert type=\"info\" message=\"Select a narrative on the left to show it here and be able to add it to this organization.\" />\n            )\n        }\n    }\n\n    renderMenuButtons() {\n        return (\n            <div className=\"ButtonSet\">\n                <div className=\"ButtonSet-button\">\n                    <Button icon=\"rollback\"\n                        type=\"danger\"\n                        onClick={this.doCancelToViewer.bind(this)}>\n                        Back to Org\n                </Button>\n                </div>\n                <div className=\"ButtonSet-button\">\n                    <Button\n                        shape=\"circle\"\n                        icon=\"info\"\n                        onClick={this.doShowInfo.bind(this)}>\n                    </Button>\n                </div>\n            </div >\n        )\n    }\n\n    render() {\n        switch (this.state.navigateTo) {\n            case NavigateTo.BROWSER:\n                return <Redirect push to=\"/organizations\" />\n            case NavigateTo.VIEWER:\n                return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n            case NavigateTo.NONE:\n            default:\n            // do nothing.\n        }\n\n        // let buttonLabel\n        // if (this.props.organization.relation.type === UserRelationToOrganization.ADMIN ||\n        //     this.props.organization.relation.type === UserRelationToOrganization.OWNER) {\n        //     buttonLabel = 'Add Selected Narrative to Organization'\n        // } else {\n        //     buttonLabel = 'Request Addition of Selected Narrative to Organization'\n        // }\n\n        return (\n            <div className=\"RequestNarrative scrollable-flex-column\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                {/* {this.renderHeader()} */}\n                {this.renderOrgHeader()}\n                <div className=\"RequestNarrative-body scrollable-flex-column\">\n                    <div className=\"RequestNarrative-selectNarrativeCol scrollable-flex-column\">\n                        <h3>Select a Narrative</h3>\n                        {this.renderNarrativeSelector()}\n                    </div>\n                    <div className=\"RequestNarrative-selectedNarrativeCol\">\n                        <h3>Selected Narrative</h3>\n                        {this.renderSelectedNarrative()}\n                        <div className=\"RequestNarrative-selectedNarrativeButtonBar\">\n                            {this.renderSelectedNarrativeButton()}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"RequestNarrative-footer\">\n                    {/* <Button\n                        type=\"primary\"\n                        onClick={this.doSendRequest.bind(this)}\n                        disabled={!this.canSendRequest.call(this)}\n                    >{buttonLabel}</Button> */}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default RequestAddNarrative","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport { AppError, StoreState, Narrative } from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport * as narrativeModel from '../../data/models/narrative'\nimport * as requestModel from '../../data/models/requests'\nimport { AnError } from '../../lib/error';\nimport { makeError } from '../../combo/error/api';\nimport { OrganizationNarrative } from '../../data/models/narrative';\n\nexport interface Load extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS\n    organization: orgModel.Organization\n    narratives: Array<narrativeModel.OrganizationNarrative>\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR\n    error: AppError\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, narratives: Array<narrativeModel.OrganizationNarrative>, relation: orgModel.Relation): LoadSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n        organization, narratives, relation\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const [org, narratives, request, invitation] = await Promise.all([\n                orgClient.getOrganization(organizationId),\n                narrativeClient.getOwnNarratives(organizationId),\n                requestClient.getUserRequestForOrg(organizationId),\n                requestClient.getUserInvitationForOrg(organizationId)\n            ])\n\n            const relation = orgModel.determineRelation(org, username, request, invitation)\n            dispatch(loadSuccess(org, narratives, relation))\n        } catch (ex) {\n            console.error('loading error', ex)\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Selecting narrative\nexport interface SelectNarrative {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    narrative: Narrative\n}\n\nexport interface SelectNarrativeStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n}\n\nexport interface SelectNarrativeSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS\n    narrative: narrativeModel.OrganizationNarrative\n}\n\nexport interface SelectNarrativeError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR\n    error: AppError\n}\n\nexport function selectNarrativeStart(): SelectNarrativeStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n    }\n}\n\nexport function selectNarrativeSuccess(narrative: OrganizationNarrative): SelectNarrativeSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n        narrative: narrative\n    }\n}\n\nexport function selectNarrativeError(error: AppError): SelectNarrativeError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\nexport function selectNarrative(narrative: OrganizationNarrative) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectNarrativeStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        // TODO: fetch narrative and populate the selected narrative accordingly...\n\n\n        dispatch(selectNarrativeSuccess(narrative))\n    }\n}\n\n// Sending Request\nexport interface SendRequest {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND\n}\n\nexport interface SendRequestStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n}\n\nexport interface SendRequestSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    request: requestModel.Request | boolean\n}\n\nexport interface SendRequestError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n    error: AppError\n}\n\n\nexport function sendRequestStart(): SendRequestStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n    }\n}\n\nexport function sendRequestSuccess(request: requestModel.Request | boolean): SendRequestSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n        request: request\n    }\n}\n\nexport function sendRequestError(error: AppError): SendRequestError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n        error: error\n    }\n}\n\nexport function sendRequest(groupId: string, workspaceId: number) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendRequestStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const request = await orgClient.addOrRequestNarrativeToGroup(groupId, workspaceId)\n            dispatch(sendRequestSuccess(request))\n        } catch (ex) {\n            dispatch(sendRequestError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Unloading\n\nexport interface Unload extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n    }\n}\n\n// SORTING\n\nexport interface Sort {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT\n    sort: narrativeModel.Sort\n}\n\nexport interface SortStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_START\n}\n\nexport interface SortSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_SUCCESS\n    narratives: Array<narrativeModel.OrganizationNarrative>\n}\n\nexport interface SortError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_ERROR\n    error: AnError\n}\n\nexport function sort(sort: narrativeModel.Sort) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_START\n        } as SortStart)\n\n        const state = getState()\n\n        const viewModel = state.views.requestNarrativeView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: 'viewmodel missing'\n                })\n            })\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        try {\n            const sorted = narrativeClient.sortOrganizationNarratives(viewModel.narratives, sort)\n            dispatch({\n                type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_SUCCESS,\n                narratives: sorted\n            } as SortSuccess)\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n\n    }\n}","import { Dispatch, Action } from 'redux'\n\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\n\nimport Component from './component'\nimport * as actions from '../../../redux/actions/requestAddNarrative'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as narrativeModel from '../../../data/models/narrative'\n\nexport interface OwnProps {\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    narratives: Array<narrativeModel.OrganizationNarrative>\n    selectedNarrative: narrativeModel.OrganizationNarrative | null\n    searching: boolean\n    sortBy: string\n    // sortDirection: types.SortDirection\n    filter: string\n}\n\ninterface DispatchProps {\n    doSendRequest: (groupId: string, workspaceId: number) => void\n    doSelectNarrative: (narrative: narrativeModel.OrganizationNarrative) => void\n    doSortBy: (sortBy: narrativeModel.Sort) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    if (state.views.requestNarrativeView.viewModel === null) {\n        throw new Error('view value is not defined!')\n    }\n\n    const {\n        views: {\n            requestNarrativeView: {\n                viewModel: {\n                    organization, relation, narratives, selectedNarrative,\n                }\n            }\n        }\n    } = state\n\n    return {\n        organization, relation, narratives, selectedNarrative,\n        searching: false,\n        sortBy: 'title',\n        // sortDirection: types.SortDirection.ASCENDING,\n        filter: ''\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        doSendRequest: (groupId: string, workspaceId: number) => {\n            dispatch(actions.sendRequest(groupId, workspaceId) as any)\n        },\n        doSelectNarrative: (narrative: narrativeModel.OrganizationNarrative) => {\n            dispatch(actions.selectNarrative(narrative) as any)\n        },\n        doSortBy: (sortBy: narrativeModel.Sort) => {\n            dispatch(actions.sort(sortBy) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: types.RequestNarrativeView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading Your Narratives...\n            </div>\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case types.ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case types.ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/requestAddNarrative'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.RequestNarrativeView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.requestNarrativeView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import {\n    StoreState, SortDirection, AuthState, AppState,\n    EditState, SaveState, ValidationState, BrowseOrgsState, ComponentLoadingState\n} from \"../types\";\n\n// rawOrganizations: [],\n//                         organizations: [],\n//                         totalCount: 0,\n//                         filteredCount: 0,\n//                         sortBy: 'name',\n//                         sortDirection: SortDirection.ASCENDING,\n//                         filter: 'all',\n//                         searchTerms: [],\n//                         selectedOrganizationId: null,\n//                         searching: false\nexport class StateInstances {\n    static makeInitialState(): StoreState {\n        return {\n            entities: {\n                users: {\n                    byId: new Map(),\n                    all: []\n                },\n                orgs: {\n                    byId: new Map(),\n                    all: []\n                },\n                requests: {\n                    byId: new Map(),\n                    all: []\n                },\n                narratives: {\n                    byId: new Map()\n                }\n            },\n            db: {\n                notifications: {\n                    all: [],\n                    byId: new Map(),\n                    // collections: {\n                    //     byGroup: new Map()\n                    // }\n                }\n            },\n            views: {\n                browseOrgsView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                organizationCentricView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                addOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                editOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                    // organizationId: '',\n                    // editState: EditState.NONE,\n                    // saveState: SaveState.NONE,\n                    // validationState: ValidationState.NONE,\n                    // editedOrganization: StaticData.makeEmptyEditableOrganization(),\n                    // organization: null\n                },\n                manageOrganizationRequestsView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                viewMembersView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                inviteUserView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                manageMembershipView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                requestNarrativeView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                viewOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n            },\n\n\n            auth: {\n                status: AuthState.NONE,\n                message: '',\n                authorization: {\n                    token: '',\n                    username: '',\n                    realname: '',\n                    roles: []\n                }\n            },\n            error: null,\n\n            app: {\n                status: AppState.NONE,\n                config: {\n                    baseUrl: '',\n                    services: {\n                        Groups: {\n                            url: ''\n                        },\n                        UserProfile: {\n                            url: ''\n                        },\n                        Workspace: {\n                            url: ''\n                        },\n                        ServiceWizard: {\n                            url: ''\n                        },\n                        Feeds: {\n                            url: ''\n                        },\n                        Auth: {\n                            url: ''\n                        }\n                    },\n                    defaultPath: ''\n                }\n            },\n\n            updateOrg: {\n                pending: false\n            },\n\n\n        }\n    }\n}","import * as React from 'react'\n\nexport interface Props {\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface State {\n\n}\n\nexport default class DataServices extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    componentWillMount() {\n        this.props.onLoad()\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n\n    render() {\n        return this.props.children\n    }\n}\n\n","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\n// import * as actions from '../../redux/actions/notifications'\nimport * as actions from '../../redux/actions/dataServices'\nimport Component from './component'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nexport interface AppContext {\n    test: string\n}\n\nconst context = React.createContext<AppContext | null>(null)\n\nexport const AppContextProvider = context.Provider\nexport const AppContextConsumer = context.Consumer","import React, { Component } from 'react'\nimport { Route, Switch, Redirect } from 'react-router'\nimport { BrowserRouter } from 'react-router-dom'\n\n// redux\nimport { Provider } from 'react-redux';\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport thunk from 'redux-thunk'\n\nimport theReducer from './redux/reducers'\n\n// the app and subcomponents\nimport './App.css';\n\n// fontawesome setup\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faSpinner, faSearch, faGlobe, faUserLock } from '@fortawesome/free-solid-svg-icons'\nlibrary.add(faSpinner, faSearch, faGlobe, faUserLock)\n\nimport OrganizationsBrowser from './components/views/browseOrgs/loader'\nimport NewOrganization from './components/views/newOrganization/loader'\nimport ViewOrganization from './components/views/viewOrganization/loader'\nimport EditOrganization from './components/views/editOrganization/loader'\nimport Auth from './containers/Auth'\nimport KBaseIntegration from './containers/KBaseIntegration'\nimport InviteUser from './components/views/inviteUser/loader'\nimport ManageMembership from './components/views/manageMembership/loader'\nimport RequestAddNarrative from './components/views/requestAddNarrative/loader'\nimport { StateInstances } from './redux/state';\nimport DataServices from './components/dataServices/storeAdapter'\nimport { AppContextProvider } from './AppContext'\nimport { Marked, Renderer, MarkedOptions } from 'marked-ts'\nimport MainMenu from './components/menu/component';\n\nclass DescriptionRenderer extends Renderer {\n  constructor(options?: MarkedOptions) {\n    super(options)\n  }\n  link(href: string, title: string, text: string) {\n    if (this.options.sanitize) {\n      let prot: string;\n\n      try {\n        prot = decodeURIComponent(this.options.unescape!(href))\n          .replace(/[^\\w:]/g, '')\n          .toLowerCase()\n      }\n      catch (e) {\n        return text\n      }\n\n      if\n        (\n        prot.indexOf('javascript:') === 0\n        || prot.indexOf('vbscript:') === 0\n        || prot.indexOf('data:') === 0\n      ) {\n        return text\n      }\n    }\n\n    let out = '<a href=\"' + href + '\"';\n\n    if (title) {\n      out += ' title=\"' + title + '\"';\n    }\n\n    out += ' target=\"_blank\">' + text + '</a>';\n\n    return out;\n  }\n}\n\nlet options = new MarkedOptions()\noptions.renderer = new DescriptionRenderer()\nMarked.setOptions({ renderer: new DescriptionRenderer() })\n\n// Put the redux store together\n// Just for prototyping --- This is super naive and will change!\n// import {organizations} from './data/temp';\n\n// TODO: determine the environment\n\nconst hosted = window.frameElement ? true : false\n\n// Set up initial state \n// TODO: move to own file\nconst initialState = StateInstances.makeInitialState()\n\n// TODO: remove the cast of reducer to any...\n// const middleware = [thunk]\n// const store = createStore<StoreState, SortOrgs, null, null>(theReducer as any, initialState, applyMiddleware(thunk));\nconst store = createStore(theReducer as any, initialState as any, compose(applyMiddleware(thunk)))\n\nclass App extends Component {\n  constructor(props: any) {\n    super(props)\n  }\n\n  render() {\n    return (\n      <AppContextProvider value={{ test: 'ok' }}>\n        <Provider store={store}>\n          <KBaseIntegration>\n            <Auth hosted={hosted}>\n              <DataServices>\n                <BrowserRouter basename=\"/\" >\n                  <div className=\"App scrollable-flex-column\">\n                    <div className=\"App-body scrollable-flex-column\">\n                      {/* <MainMenu /> */}\n                      <Switch>\n                        <Route path=\"/organizations\" component={OrganizationsBrowser} />\n                        <Route path=\"/newOrganization\" component={NewOrganization} />\n                        {/* The destructuring below is ugly, but effective */}\n                        <Route path=\"/viewOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ViewOrganization organizationId={id} />} />\n                        <Route path=\"/editOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <EditOrganization organizationId={id} />} />\n                        <Route path=\"/inviteUser/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<InviteUser organizationId={id} />)} />\n                        <Route path=\"/membership/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<ManageMembership organizationId={id} />)} />\n                        <Route path=\"/requestAddNarrative/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<RequestAddNarrative organizationId={id} />)} />\n                        <Redirect from=\"/\" to=\"/organizations\" exact={true} />\n                      </Switch>\n                    </div>\n                  </div>\n                </BrowserRouter>\n              </DataServices>\n            </Auth>\n          </KBaseIntegration>\n        </Provider>\n      </AppContextProvider>\n    )\n  }\n}\n\nexport default App\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport 'typeface-oxygen';\nimport 'normalize.css';\nimport 'antd/dist/antd.css'\n\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}