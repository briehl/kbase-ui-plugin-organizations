{"version":3,"sources":["components/entities/nouserpic.png","types/index.tsx","redux/actions/index.ts","redux/reducers/addOrg.ts","redux/reducers/editOrg.ts","redux/reducers/viewOrganization/acceptInboxRequest.ts","redux/reducers/viewOrganization/viewMembers.ts","redux/reducers/viewOrganization/denyInboxRequest.ts","redux/reducers/viewOrganization/cancelOutboxRequests.ts","data/apis/groups.ts","data/models/requests.ts","data/models/organization/model.ts","data/models/organization/validation.ts","combo/error/api.ts","redux/actions/viewOrganization/manageRelatedOrganizations.ts","redux/reducers/viewOrganization/manageRelatedOrganizations.ts","redux/reducers/viewOrganization/relatedOrganizations.ts","redux/reducers/viewOrg.ts","redux/reducers/browseOrgs.ts","redux/reducers/auth.ts","redux/reducers/app.ts","redux/reducers/manageOrganizationRequests.ts","redux/reducers/viewMembers.ts","redux/reducers/viewOrganization/inviteUser.ts","redux/reducers/manageMembership.ts","redux/reducers/viewOrganization/requestAddNarrative.ts","redux/reducers/entities/organization.ts","redux/reducers/entities.ts","redux/reducers/dataServices.ts","redux/reducers/index.tsx","components/entities/Owner.tsx","components/OrgLogo.tsx","components/entities/Avatar.tsx","data/apis/serviceClient.ts","data/apis/userProfile.ts","data/models/user.ts","data/apis/genericClient.ts","data/apis/serviceWizard.ts","data/apis/dynamicServiceClient.ts","data/apis/narrativeService.ts","data/models/narrative.ts","data/apis/workspaceUtils.ts","redux/actions/entities.ts","components/entities/OwnerContainer.tsx","lib/time.ts","components/NiceElapsedTime.tsx","components/BriefOrganization.tsx","components/views/browseOrgs/organizations/component.tsx","components/views/browseOrgs/organizations/container.tsx","components/views/browseOrgs/component.tsx","redux/actions/browseOrgs.ts","components/views/browseOrgs/container.tsx","components/views/browseOrgs/loader.tsx","redux/actions/addOrg.ts","components/views/newOrganization/component.tsx","components/views/newOrganization/container.tsx","components/views/newOrganization/loader.tsx","data/models/uber.ts","redux/actions/dataServices.ts","redux/actions/viewOrg.ts","redux/actions/viewOrganization/acceptInboxRequest.ts","components/Header.tsx","lib/error.ts","redux/actions/viewOrganization/viewMembers.ts","components/entities/Member.tsx","components/entities/MemberContainer.tsx","components/views/viewOrganization/accessible/members/component.tsx","components/views/viewOrganization/accessible/members/reduxAdapter.tsx","redux/actions/viewOrganization/denyInboxRequest.ts","redux/actions/viewOrganization/cancelOutboxRequest.ts","components/entities/User.tsx","components/entities/UserContainer.tsx","components/entities/Narrative.tsx","components/entities/NarrativeContainer.tsx","components/views/viewOrganization/accessible/requests/InboxRequest.tsx","components/views/viewOrganization/accessible/requests/InboxRequestContainer.tsx","components/views/viewOrganization/accessible/requests/OutboxRequest.tsx","components/views/viewOrganization/accessible/requests/OutboxRequestContainer.tsx","components/views/viewOrganization/accessible/requests/component.tsx","components/views/viewOrganization/accessible/requests/container.tsx","components/views/viewOrganization/accessible/BriefOrganizationHeader.tsx","components/entities/organization/component.tsx","components/entities/organization/Inaccessible.tsx","components/entities/organization/loader.tsx","redux/actions/entities/organization.ts","components/views/viewOrganization/accessible/relatedOrgs/component.tsx","components/views/viewOrganization/accessible/relatedOrgs/reduxAdapter.tsx","redux/actions/viewOrganization/relatedOrganizations.ts","components/views/viewOrganization/accessible/manageRelatedOrganizations/AvailableOrganization.tsx","components/views/viewOrganization/accessible/manageRelatedOrganizations/component.tsx","components/views/viewOrganization/accessible/manageRelatedOrganizations/reduxAdapter.tsx","components/views/viewOrganization/accessible/manageRelatedOrganizations/loader.tsx","redux/actions/viewOrganization/inviteUser.ts","components/User.tsx","components/menu/component.tsx","components/views/viewOrganization/accessible/inviteUser/component.tsx","components/views/viewOrganization/accessible/inviteUser/container.tsx","components/views/viewOrganization/accessible/inviteUser/loader.tsx","components/entities/UserSimple.tsx","components/entities/UserSimpleContainer.tsx","components/entities/narrative/component.tsx","components/entities/narrative/reduxAdapter.tsx","components/OrganizationNarrative.tsx","components/views/viewOrganization/accessible/narratives/component.tsx","redux/actions/manageMembership.ts","components/views/viewOrganization/accessible/manageMembership/component.tsx","components/views/viewOrganization/accessible/manageMembership/container.tsx","combo/error/component.tsx","components/views/viewOrganization/accessible/manageMembership/loader.tsx","redux/actions/editOrg.ts","components/views/viewOrganization/accessible/editOrganization/component.tsx","components/views/viewOrganization/accessible/editOrganization/container.tsx","components/views/viewOrganization/accessible/editOrganization/loader.tsx","components/views/viewOrganization/accessible/requestAddNarrative/component.tsx","redux/actions/viewOrganization/requestAddNarrative.ts","components/views/viewOrganization/accessible/requestAddNarrative/container.tsx","components/views/viewOrganization/accessible/requestAddNarrative/loader.tsx","components/views/viewOrganization/accessible/component.tsx","components/views/viewOrganization/accessible/OrgMenu.tsx","components/views/viewOrganization/accessible/container.tsx","components/views/viewOrganization/inaccessible/component.tsx","components/views/viewOrganization/inaccessible/container.tsx","components/views/viewOrganization/loader.tsx","components/Auth.tsx","data/auth.ts","redux/actions/auth.ts","containers/Auth.tsx","lib/windowChannel.ts","lib/IFrameSimulator.ts","lib/IFrameIntegration.ts","redux/actions/app.ts","components/KBaseIntegration.tsx","containers/KBaseIntegration.tsx","redux/state.tsx","components/dataServices/component.tsx","components/dataServices/storeAdapter.tsx","AppContext.tsx","App.tsx","index.tsx"],"names":["module","exports","__webpack_require__","p","ComponentView","UIErrorType","SyncState","EditState","ValidationErrorType","SaveState","MemberType","RequestType","RequestResourceType","RequestStatus","AuthState","ViewOrgState","AppState","SortDirection","ComponentLoadingState","BrowseOrgsState","InviteUserViewState","NarrativeState","ProcessingState","RequestNarrativeState","ViewOrgViewModelKind","SubViews","ViewOrgSubViewKind","ViewState","ErrorCode","ActionFlag","AppException","_Error","_ref","_this","code","message","detail","info","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","trace","errors","name","Error","captureStackTrace","assertThisInitialized","stack","indexOf","split","inherits","wrapNativeSuper","reducer","state","action","type","ADD_ORG_SAVE","views","addOrgView","viewModel","objectSpread","saveState","SAVING","console","warn","saveStart","ADD_ORG_SAVE_SUCCESS","editState","UNEDITED","SAVED","saveSuccess","ADD_ORG_SAVE_ERROR","SAVE_ERROR","error","saveError","ADD_ORG_LOAD_START","loadingState","LOADING","loadStart","ADD_ORG_LOAD_SUCCESS","SUCCESS","validationState","OK","validatedAt","Date","NEW","newOrganization","loadSuccess","ADD_ORG_LOAD_ERROR","loadError","ADD_ORG_UNLOAD","NONE","unload","ADD_ORG_UPDATE_NAME_SUCCESS","EDITED","value","syncState","DIRTY","updateNameSuccess","ADD_ORG_UPDATE_NAME_ERROR","updateNameError","ADD_ORG_UPDATE_LOGO_URL_SUCCESS","logoUrl","updateLogoUrlSuccess","ADD_ORG_UPDATE_LOGO_URL_ERROR","updateLogoUrlError","ADD_ORG_UPDATE_HOME_URL_SUCCESS","homeUrl","updateHomeUrlSuccess","ADD_ORG_UPDATE_HOME_URL_ERROR","updateHomeUrlError","ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS","researchInterests","updateResearchInterestsSuccess","ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR","updateResearchInterestsError","ADD_ORG_UPDATE_ID_SUCCESS","id","updateIdSuccess","ADD_ORG_UPDATE_ID_ERROR","updateIdError","ADD_ORG_UPDATE_ID_PASS","updateIdPass","ADD_ORG_UPDATE_DESCRIPTION_SUCCESS","description","updateDescriptionSuccess","ADD_ORG_UPDATE_DESCRIPTION_ERROR","updateDescriptionError","ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS","isPrivate","updateIsPrivateSuccess","ADD_ORG_EVALUATE_OK","addOrgEvaluateOk","ADD_ORG_EVALUATE_ERRORS","ERROR","addOrgEvaluateErrors","validationStateOk","evaluateEditorState","editedOrganization","EDIT_ORG_LOAD_START","editOrgView","EDIT_ORG_LOAD_SUCCESS","organization","EDIT_ORG_LOAD_ERROR","EDIT_ORG_UNLOAD","EDIT_ORG_SAVE_START","editOrgSaveStart","EDIT_ORG_SAVE_SUCCESS","CLEAN","editOrgSaveSuccess","EDIT_ORG_SAVE_ERROR","editOrgSaveError","EDIT_ORG_UPDATE_NAME_SUCCESS","editedOrg","remoteValue","newState","editOrgUpdateNameSuccess","EDIT_ORG_UPDATE_NAME_ERROR","editOrgUpdateNameError","EDIT_ORG_UPDATE_LOGO_URL_SUCCESS","editOrgUpdateLogoUrlSuccess","EDIT_ORG_UPDATE_LOGO_URL_ERROR","editOrgUpdateLogoUrlError","EDIT_ORG_UPDATE_HOME_URL_SUCCESS","editOrgUpdateHomeUrlSuccess","EDIT_ORG_UPDATE_HOME_URL_ERROR","editOrgUpdateHomeUrlError","EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS","EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR","EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS","EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS","EDIT_ORG_UPDATE_DESCRIPTION_ERROR","editOrgUpdateDescriptionError","EDIT_ORG_EVALUATE_OK","editOrgEvaluateOk","EDIT_ORG_EVALUATE_ERRORS","editOrgEvaluateErrors","VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS","viewOrgView","kind","NORMAL","requestInbox","requests","acceptInboxRequestSuccess","VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS","members","map","member","username","memberUsername","ADMIN","promoteToAdminSuccess","VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS","MEMBER","demoteToMemberSuccess","VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS","filter","sortedMembers","removeMemberSuccess","VIEW_ORG_SORT_MEMBERS_SUCCESS","sortMembersBy","sortBy","sortMembersSuccess","VIEW_ORG_SEARCH_MEMBERS_SUCCESS","searchMembersBy","searchBy","searchMembersSuccess","VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS","rejectInboxRequestSuccess","VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS","requestOutbox","cancelRequestSuccess","GroupException","_AppException","apperror","Map","httpcode","httpstatus","appcode","callid","time","originalError","ServerException","_AppException2","_this2","GroupsClient","token","url","createClass","key","fetch","headers","Authorization","Accept","mode","then","response","json","result","exists","_listGroups","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","next","abrupt","status","stop","apply","arguments","_this3","Promise","all","group","getGroupById","path","body","concat","join","Content-Type","method","JSON","stringify","statusText","get","text","_post","_callee2","errorText","_context2","sent","t0","_x","_x2","_get","_callee3","_context3","_x3","newGroup","payload","private","custom","logourl","researchinterests","homeurl","length","put","groupUpdate","_addRelatedGroup","_callee4","groupId","relatedGroupId","relatedGroups","update","_context4","relatedgroups","includes","push","_x4","_x5","_removeRelatedGroup","_callee5","newRelatedGroups","_context5","_x6","_x7","_getRequest","_callee6","requestId","_context6","_x8","params","query","URLSearchParams","includeClosed","append","sortDirection","DESCENDING","startAt","String","getTime","toString","workspaceId","complete","_grantResourceAccess","_callee7","resourceType","resourceId","_context7","post","_x9","_x10","_x11","_ref2","_ref3","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","_ref10","_visitGroup","_callee8","_ref11","_context8","_x12","_getOpenRequests","_callee9","_ref12","groupIds","requestStatuses","_arr","_i","_ref15","_ref14","_groupId","requestStatus","_context9","entries","slicedToArray","set","_x13","groupRequestToOrgRequest","request","requestType","INVITATION","REQUEST","stringToRequestType","USER","WORKSPACE","APP","stringToResourceType","resourcetype","OPEN","organizationId","groupid","requester","user","resource","createdAt","createdate","expireAt","expiredate","modifiedAt","moddate","narrativeId","appId","UserRelationToOrganization","UserWorkspacePermission","OrganizationKind","RequestsModel","groupsClient","cache","groupsApi","groupsServiceURL","grequest","has","getRequest","_getOutboundRequests","grequests","getCreatedRequests","forEach","_getUserRequestForOrg","find","r","_getPendingRequestsForOrg","_getRequestInboxForOrg","getTargetedRequests","_getCombinedRequestInboxForOrg","getGroupRequests","t1","_getRequestOutboxForOrg","_getOrganizationInvitations","_getOrganizationInvitationsForOrg","invitations","getOrganizationInvitations","invitation","_getInboundRequests","_callee10","_context10","_getUserInvitationForOrg","_callee11","_context11","_getPendingOrganizationRequestsForOrg","_callee12","groupRequests","_context12","_getPendingOrganizationRequests","_callee13","allRequests","_context13","reduce","_cancelRequest","_callee14","_context14","cancelRequest","_acceptRequest","_callee15","_context15","acceptRequest","_denyRequest","_callee16","_context16","denyRequest","_acceptJoinInvitation","_callee17","_context17","_x14","_rejectJoinInvitation","_callee18","_context18","_x15","_inviteUserToJoinOrg","_callee19","_context19","inviteUserToGroup","_x16","_x17","Validation","s","firstNonPrintable","search","nonPrintableRe","beforeStart","before","slice","after","REQUIRED_MISSING","match","URL","protocol","ex","log","title","determineRelation","org","INACCESSIBLE_PRIVATE","MEMBER_REQUEST_PENDING","MEMBER_INVITATION_PENDING","owner","OWNER","groupPermissionToWorkspacePermission","groupsPermission","VIEW","EDIT","groupToOrganization","currentUser","joinedAt","joined","lastVisitedAt","lastvisit","admins","admin","narratives","resources","workspace","parseInt","rid","narrname","isPublic","public","permission","perm","narrcreate","updatedAt","addedAt","added","isMember","role","isAdmin","isOwner","relation","groupRoleToUserRelation","areMembersPrivate","privatemembers","apps","memberCount","memcount","narrativeCount","rescount","appCount","catalogmethod","relatedOrganizations","groupToPrivateOrganization","applySearch","orgs","searchTerms","searchTermsRe","term","RegExp","every","termRe","test","dateDays","d","t","Math","round","applySortComparison","sortField","direction","b","localeCompare","applySort","organizations","ASCENDING","sort","applyFilter","roleType","roles","privacy","applyRoleType","some","applyRole","applyPrivacy","narrativeSortByToComparator","queryNarratives","c1","applyNarrativeSort","tokens","narrative","applyNarrativeSearch","memberSortByToComparator","queryMembers","applyMembersSort","applyMembersSearch","OrganizationModel","_getOrg","_getOrganization","_getOrgs","ids","getOrg","_getAllOrgs","groups","getGroups","getOrgs","_getOwnOrgs","ownOrgs","getAllOrgs2","_getAllOrgs2","listGroups","listGroupToBriefOrganization","_queryOrgs","filtered","searched","sorted","total","_ownOrgs","_grantViewAccess","req","grantReadAccessToRequestedResource","requestModel","_addOrg","newOrg","reject","createGroup","_orgExists","groupExists","_updateOrg","orgUpdate","updateGroup","validateOrgId","validateOrgName","validateOrgDescription","_removeNarrativeFromOrg","deleteResource","_grantNarrativeAccess","grantResourceAccess","_requestMembership","requestMembership","_addOrRequestNarrativeToGroup","addOrRequestNarrative","_x18","_memberToAdmin","memberToAdmin","_x19","_x20","_adminToMember","adminToMember","_x21","_x22","_removeMember","removeMember","_x23","_x24","_updateMember","_callee20","_context20","updateMember","_x25","_x26","_x27","_visitOrg","_callee21","_context21","visitGroup","_x28","_getOpenRequestsStatus","_callee22","organizationIds","openRequests","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","_context22","getOpenRequests","undefined","Symbol","iterator","done","stringToRequestStatus","return","finish","_x29","_getOpenRequestStatus","_callee23","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_context23","_x30","_addRelatedOrganization","_callee24","relatedOrganizationId","_context24","addRelatedGroup","_x31","_removeRelatedOrganization","_callee25","_ref13","_context25","removeRelatedGroup","_x32","new","OLD","makeError","history","uuid","at","applyQuery","searchExp","re","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS","subViews","manageRelatedOrganizationsView","MANAGE_RELATED_ORGS","availableOrganizations","queried","selectedOrganization","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION","availableOrgs","relatedOrg","isSelected","actions","selectOrganization","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS","newRelatedOrgs","newAvailableOrgs","isRelated","addOrganization","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS","relatedOrgs","removeOrganization","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS","searchSuccess","VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS","VIEW_ORG_LOAD_START","types","VIEW_ORG_LOAD_NORMAL_SUCCESS","openRequest","groupInvitations","sortNarrativesBy","narrativesSortBy","searchNarrativesBy","inviteUserView","requestNarrativeView","loadNormalSuccess","VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS","PRIVATE_INACCESSIBLE","loadInaccessiblePrivateSuccess","VIEW_ORG_LOAD_ERROR","VIEW_ORG_UNLOAD","VIEW_ORG_REMOVE_NARRATIVE_SUCCESS","newNarratives","newDisplayNarratives","removeNarrativeSuccess","VIEW_ORG_ACCESS_NARRATIVE_SUCCESS","accessNarrativeSuccess","VIEW_ORG_SORT_NARRATIVES_SUCCESS","sortNarrativesSuccess","VIEW_ORG_SEARCH_NARRATIVES_SUCCESS","searchNarrativesSuccess","acceptInboxRequest","denyInboxRequest","cancelOutboxRequest","viewMembers","manageRelatedOrganizations","localReducer","BROWSE_ORGS_LOAD_SUCCESS","_action$defaultViewMo","defaultViewModel","rawOrganizations","totalCount","filteredCount","selectedOrganizationId","searching","BROWSE_ORGS_SEARCH","searchOrgs","BROWSE_ORGS_SEARCH_START","searchOrgsStart","BROWSE_ORGS_SEARCH_SUCCESS","searchOrgsSuccess","BROWSE_ORGS_SEARCH_ERROR","searchOrgsError","BROWSE_ORGS_SORT_START","sortOrgsStart","BROWSE_ORGS_FILTER_START","filterOrgsStart","BROWSE_ORGS_UNLOAD","AUTH_CHECK_START","auth","CHECKING","authorization","realname","authCheckStart","AUTH_AUTHORIZED","AUTHORIZED","authAuthorized","AUTH_UNAUTHORIZED","UNAUTHORIZED","authUnauthorized","AUTH_CHECK_ERROR","authCheckError","APP_SUCCESS","app","READY","config","appSuccess","ADMIN_MANAGE_REQUESTS_LOAD_START","ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS","manageOrganizationRequestsView","ADMIN_MANAGE_REQUESTS_LOAD_ERROR","ADMIN_MANAGE_REQUESTS_UNLOAD","ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS","newRequests","getViewAccessSuccess","VIEW_MEMBERS_LOAD_START","viewMembersView","VIEW_MEMBERS_LOAD_SUCCESS","VIEW_MEMBERS_LOAD_ERROR","VIEW_MEMBERS_UNLOAD","VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS","VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS","INVITE_USER_LOAD_START","INVITE_USER_LOAD_SUCCESS","EDITING","users","selectedUser","INVITE_USER_LOAD_ERROR","INVITE_USER_UNLOAD","INVITE_USER_SEARCH_USERS_SUCCESS","searchUsersSuccess","INVITE_USER_SELECT_USER_SUCCESS","selectUserSuccess","INVITE_USER_SEND_INVITATION_START","SENDING","sendInvitationStart","INVITE_USER_SEND_INVITATION_SUCCESS","_state$viewModel","orgModel","newUsers","sendInvitationSuccess","INVITE_USER_SEND_INVITATION_ERROR","sendInvitationError","haveReducer","newViewState","editableMemberProfile","MANAGE_MEMBERSHIP_LOAD_START","manageMembershipView","MANAGE_MEMBERSHIP_LOAD_SUCCESS","MANAGE_MEMBERSHIP_LOAD_ERROR","MANAGE_MEMBERSHIP_UNLOAD","MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS","editedMember","updateTitleSuccess","MANAGE_MEMBERSHIP_EVALUATE_SUCCESS","evaluateSuccess","MANAGE_MEMBERSHIP_EVALUATE_ERROR","evaluateError","MANAGE_MEMBERSHIP_SAVE_SUCCESS","sendRequestStart","REQUEST_ADD_NARRATIVE_LOAD_START","REQUEST_ADD_NARRATIVE_LOAD_SUCCESS","selectedNarrative","REQUEST_ADD_NARRATIVE_LOAD_ERROR","REQUEST_ADD_NARRATIVE_SEND_START","REQUEST_ADD_NARRATIVE_SEND_SUCCESS","orgNarrative","ASSOCIATED","REQUESTED","sendRequestSuccess","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS","selectNarrativeSuccess","REQUEST_ADD_NARRATIVE_UNLOAD","REQUEST_ADD_NARRATIVE_SORT_SUCCESS","sortSuccess","ENTITY_ORGANIZATION_LOAD_SUCCESS","newOrgs","entities","byId","ENTITY_USER_LOADER_SUCCESS","userLoaderSuccess","ENTITY_ORGANIZATION_LOADER_SUCCESS","orgsMap","organizationLoaderSuccess","ENTITY_NARRATIVE_LOAD_SUCCESS","loadNarrativeSuccess","organizationsReducer","DATA_SERVICE_LOAD_SUCCESS","db","View","addOrgReducer","editOrgReducer","browseOrgsView","browseOrgsReducer","viewOrgReducer","authReducer","appReducer","manageOrganizatiopRequests","inviteUser","manageMembership","requestAddNarrative","dataServices","OrgLogo","props","react","src","width","size","inString","position","charCodeAt","c2","substring","initial","charAt","organizationName","toUpperCase","color","md5","substr","height","style","border","x","y","dy","textAnchor","dominantBaseline","fontSize","fill","fontFamily","renderLogoUrl","renderDefaultInitial","renderLogo","React","Avatar","_React$Component","avatarOption","gravatarDefault","gravatarHash","noUserPic","avatarUrl","getAvatarUrl","reverseView","v","COMPACT","Owner","view","setState","icon","showAvatar","className","components_entities_Avatar","avatarSize","tooltip","renderAvatar","es_tooltip","placement","href","target","onClick","onToggleView","bind","city","country","renderCompact","ServiceClient","param","version","constructor","random","AuthorizedServiceClient","_ServiceClient","func","makePayload","UserProfileClient","_AuthorizedServiceCli","makeEmptyPayload","_getUserProfile","profileCache","resolve","callFunc","_updateUserProfile","delete","profile","_getUserProfiles","usernames","_getAllUsers","_searchUsers","profileToUser","jobTitle","userdata","jobTitleOther","synced","UserModel","userProfileClient","userProfileServiceURL","_getUser","userProfile","getUserProfile","_getUsers","toFetch","userProfiles","getUserProfiles","searchUsers","excludedUsers","AuthorizedGenericClient","_GenericClient","_callFunc2","processResponse","GenericClient","_processResponse","_error","_error2","_callFunc","ServiceWizardClient","theResult","moduleCache","Cache","itemLifetime","monitoringFrequency","waiterTimeout","waiterFrequency","cacheLifetime","isMonitoring","window","setTimeout","newCache","cacheRenewed","keys","item","isExpired","runMonitor","cacheItem","reserved","cached","Bluebird","started","waiter","reserveAndFetch","fetcher","catch","err","elapsed","reserveItem","fetchPromise","setItem","finally","isCancelled","isReserved","reserveWaiter","DynamicServiceClient","timeout","rpcContext","moduleId","getModule","getItemWithWait","_this4","getCached","client","getServiceStatus","module_name","funcName","_this5","lookupModule","serviceStatus","NarrativeAccess","Sort","NarrativeServiceClient","_DynamicServiceClient","_listNarratives","iso8601ToDate","dateString","dateParts","exec","TypeError","offset","newDateString","workspaceInfoToObject","wsInfo","objectCount","userPermission","globalReadPermission","lockStatus","metadata","objectInfoToObject","data","majorVersion","minorVersion","savedAt","savedBy","workspaceName","checksum","ref","NarrativeModel","_getOwnNarratives","narrativeServiceClient","requestClient","narrativesResult","pendingRequests","workspacesInOrg","serviceWizardURL","listNarratives","getPendingRequestsForOrg","nar","workspaceInfo","workspaceApi","ws","objectInfo","is_temporary","access","objectId","narrative_nice_name","lastSavedAt","lastSavedBy","TITLE","LAST_SAVED","sorter","getSorter","_getNarrative","workspaceClient","rawWorkspaceInfo","_objectId","rawObjectInfo","_access","workspaceServiceURL","objects","wsid","objid","includeMetadata","ignoreErrors","infos","userLoader","userId","dispatch","getState","_getState","_getState$auth$author","model","_user","ENTITY_USER_LOADER_START","userModel","services","UserProfile","getUser","ENTITY_USER_LOADER_ERROR","loadNarrative","_getState3","_getState3$auth$autho","narrativeClient","_narrative","ENTITY_NARRATIVE_LOAD_START","narrativeModel","Workspace","Groups","ServiceWizard","getNarrative","ENTITY_NARRATIVE_LOAD_ERROR","Loader","Owner_Owner","onLoad","connect","niceElapsed","someDate","absoluteAfter","measure","measureAbs","unit","compactDate","nowDate","elapsedAbs","abs","prefix","suffix","getFullYear","Intl","DateTimeFormat","month","day","format","year","NiceElapsedTime","showTooltip","fullDate","hour","minute","timeZoneName","tooltipPrefix","BriefOrganization","OrgLogo_OrgLogo","mouseEnterDelay","newAlert","theme","requestsAlert","iconColor","openRequestsStatus","INAPPLICABLE","permalink","fontWeight","location","origin","menu","es_menu","Modal","content","Item","dropdown","overlay","trigger","NavLink","to","renderRelation","renderPrivacy","renderHomeUrl","renderOrgFreshness","renderRequests","renderPermalink","second","OwnerContainer","fullTimestamp","memberCountTooltip","renderMemberCount","count","renderNarrativeCount","NiceElapsedTime_NiceElapsedTime","renderMemberRow","renderNarrativeRow","renderModifiedRow","renderLogoColumn","renderInfoCol","renderStatsCol","renderNormal","Organizations","singular","plural","index","BriefOrganization_BriefOrganization","es_alert","maxWidth","margin","overflowY","display","flexDirection","renderOrgs","_state$views$browseOr","OrganizationsBrowser","searchInput","searchButton","filterByRoleValues","label","filterByRoleType","filterByRole","filterByPrivacy","showAdvancedControls","onSearchOrgs","current","currentSearchInputValue","e","preventDefault","doSearch","onSortOrgs","newFilter","onFilterOrgs","checkedValues","onSearchInputChange","onSubmit","placeholder","onChange","autoFocus","es_button","disabled","haveSearchInput","form","htmlType","renderSearchIcon","onClearSearch","renderSearchFeedback","renderSearchForm","marginRight","es_select","onSortByChange","defaultValue","dropdownMatchSelectWidth","Option","_this$props$filter","onToggleAdvanced","radioStyle","lineHeight","es_radio","Group","onFilterByRoleTypeChange","renderAdvancedToggle","es_checkbox","options","onFilterByRoleChange","onFilterByPrivacyChange","container","renderSortByControl","marginTop","renderFilterByRole","renderFilterByPrivacy","renderSearchBar","renderOrganizations","renderFilterColumn","storeState","_storeState$views$bro","_getState2","_getState2$auth$autho","_browseOrgsView$viewM","orgClient","_organizations2","adminOrgs","_openRequests2","queryOrgs","getOpenRequestsStatus","_browseOrgsView$viewM2","_organizations3","_openRequests3","_getState4","_getState4$auth$autho","_browseOrgsView$viewM3","_organizations4","_openRequests4","spin","padding","renderLoading","renderError","browseOrgs_container","onUnload","defaultSearchTerms","defaultSortField","defaultSortDirection","defaultFilter","_organizations","_openRequests","_defaultViewModel","BROWSE_ORGS_LOAD_START","AddOrgEvaluateErrors","load","validateOrgLogoUrl","validateOrgHomeUrl","validateOrgResearchInterests","addOrgEvaluate","addOrg","ADD_ORG_SAVE_START","_state$auth$authoriza","exception","_state$views$addOrgVi","orgModelFromState","_state$auth$authoriza2","updateName","_Validation$validateO","_Validation$validateO2","validatedName","updateLogoUrl","_Validation$validateO3","_Validation$validateO4","validatedLogoUrl","Debouncer","delay","fun","canceled","timer","startWaiting","clearTimeout","activeDebouncer","updateId","_Validation$validateO9","_Validation$validateO10","validatedId","lastValidatedAt","now","_Validation$validateO11","_Validation$validateO12","orgExists","cancel","updateDescription","_Validation$validateO13","_Validation$validateO14","validatedDescription","NewOrganization","cancelToBrowser","showError","document","isModified","confirm","onOk","onCancel","okText","cancelText","onSave","persist","onUpdateName","onUpdateDescription","onUpdateId","onUpdateLogoUrl","onUpdateHomeUrl","onUpdateResearchInterests","onUpdateIsPrivate","checked","field","input","calcFieldClass","onNameChange","renderFieldError","onIdChange","fontStyle","onLogoUrlChange","renderLogoPreview","onHomeUrlChange","collapse","bordered","Panel","header","background","borderRadius","overflow","onIsPrivateChange","renderIsPrivate","TextArea_default","autosize","minRows","maxRows","onResearchInterestsChange","onDescriptionChange","dangerouslySetInnerHTML","__html","Marked","parse","flex","renderEditorHeader","renderNameRow","renderIDRow","renderLogoURLRow","renderHomeURLRow","renderPrivatePublicRow","renderResearchInterestsRow","renderDescriptionRow","textAlign","renderSaveButton","renderCancelButton","renderDefaultLogo","_this$props","line","modal","visible","okType","canSave","onClickCancelToBrowser","errorButton","shape","toggleError","es_Redirect","renderEditor","updateIsPrivate","_Validation$validateO5","_Validation$validateO6","validatedHomeUrl","updateHomeUrl","_Validation$validateO7","_Validation$validateO8","validatedResearchInterests","updateResearchInterests","Component","newOrganization_container","UberModel","_getOrganizationForUser","getUserRequestForOrg","getUserInvitationForOrg","getPendingOrganizationRequestsForOrg","DATA_SERVICE_LOAD_START","removeNarrativeError","VIEW_ORG_REMOVE_NARRATIVE_ERROR","accessNarrativeError","VIEW_ORG_ACCESS_NARRATIVE_ERROR","viewOrgJoinRequestError","VIEW_ORG_JOIN_REQUEST_ERROR","acceptJoinInvitationStart","VIEW_ORG_ACCEPT_JOIN_INVITATION_START","uberClient","_organization","_relation","_requestInbox2","_openRequest","orgRequests","orgInvitations","_requestInbox","_requestOutbox","_narratives2","_members","uberModel","getOrganizationForUser","getRequestInboxForOrg","getOrganizationInvitationsForOrg","getOpenRequestStatus","getCombinedRequestInboxForOrg","getRequestOutboxForOrg","reload","_organization2","_relation2","_requestInbox4","_openRequest2","_requestInbox3","_requestOutbox2","_narratives3","_members2","viewOrgJoinRequest","_state$auth$authoriza3","VIEW_ORG_JOIN_REQUEST_SUCCESS","viewOrgCancelJoinRequest","_state$auth$authoriza4","newRequest","VIEW_ORG_JOIN_REQUEST_START","VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR","acceptJoinInvitation","_state$auth$authoriza5","VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS","VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR","rejectJoinInvitation","_state$auth$authoriza6","VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS","VIEW_ORG_REJECT_JOIN_INVITATION_ERROR","inbox","VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR","VIEW_ORG_ACCEPT_INBOX_REQUEST_START","Header","context","currentMenuItem","breadcrumbs","verticalAlign","marginLeft","buttons","promoteToAdmin","VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START","VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR","demoteToMember","VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START","VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR","VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START","reloadOrg","VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR","Member","userTooltip","renderRole","components_entities_Member","Members","confirmMemberRemoval","marginBottom","MemberContainer","onRemoveMember","onPromoteMemberToAdmin","onConfirmRemoveMember","onDemoteAdminToMember","onMemberMenu","onAdminMenu","renderOwnerMenu","renderAdminMenu","renderMemberMenu","classNames","renderMemberOptions","_this6","paddingRight","onSearchMembers","_this7","onSortMembers","renderSortBar","renderConfirmMemberRemoval","renderHeader","renderMembers","onViewMembersUnload","VIEW_ORG_VIEW_MEMBERS_UNLOAD","adminUsername","VIEW_ORG_SORT_MEMBERS_START","VIEW_ORG_SORT_MEMBERS_ERROR","ViewMembers","VIEW_ORG_REJECT_INBOX_REQUEST_START","VIEW_ORG_REJECT_INBOX_REQUEST_ERROR","_requests","VIEW_ORG_CANCEL_JOIN_REQUEST_START","User","components_entities_User","Narrative","cursor","UserContainer","renderPublicPermission","renderUserPermission","Narrative_Narrative","Request","onAcceptInboxRequest","onRejectInboxRequest","NarrativeContainer","renderRequestRequester","renderRequestOptions","onAcceptRequest","onRejectRequest","renderRequestReceivedSubject","renderJoinRequest","renderWorkspaceRequest","renderUserInvitation","renderBody","acceptActions","rejectActions","InboxRequest","onCancelOutboxRequest","alert","onCancelRequest","cancelActions","OutboxRequest","ManageGroupRequests","cancelToViewer","onAcceptJoinRequest","onDenyJoinRequest","onCancelJoinInvitation","onGetViewAccess","open","src_components_Header","card","hoverable","headStyle","backgroundColor","narrativeAccess","InboxRequestContainer","outbox","OutboxRequestContainer","outboxCount","inboxCount","renderInbox","renderOutbox","cancelRequestActions","orgMenu","onNavigateToBrowser","renderButtonsRow","Organization","component_Organization","Inaccessible_Organization","ENTITY_ORGANIZATION_LOAD_START","ENTITY_ORGANIZATION_LOAD_ERROR","RelatedOrganizations","onManageRelatedOrgs","onRemoveRelatedOrganization","Wrapped","withRouter","OrganizationEntity","renderControls","VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START","removeRelatedOrganization","VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR","AvailableOrganization","selectableOrganization","renderRelated","ManageRelatedOrganizations","onAddOrganization","onRemoveOrganization","onSearch","onFilterChange","classes","onSelectOrganization","AvailableOrganization_AvailableOrganization","button","alertStyle","onRemoveSelectedOrganization","onAddSelectedOrganization","onFinish","renderAvailableToolbar","renderAvailableOrgs","renderSelectedOrg","_viewModel$subViews$m","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START","addRelatedOrganization","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START","vm","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR","manageRelatedOrganizations_reduxAdapter","vm1","selectableOrgs","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START","VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR","selectUserError","INVITE_USER_SELECT_USER_ERROR","getUserRelation","ensureView","sendInvitation","_view$viewModel","inviteUserToJoinOrg","MainMenu","es_Route","render","selectedKeys","pathname","renderMenu","InviteUser","lastSearchAt","autocompleteMessage","onSendInvitation","doSearchUsers","searchDebounce","onSearchUsers","onSelectUser","showIcon","SENDABLE","src_components_User","onClickCancelToViewer","components_menu_component","renderMenuButtons","renderSearchButton","renderUsers","renderSelectedUser","renderInvitationForm","renderFooter","userClient","adminUsers","invited","requested","_users","orgUsers","INVITE_USER_SEARCH_USERS_START","INVITE_USER_SEARCH_USERS_ERROR","selectedUsername","INVITE_USER_SELECT_USER_START","InviteUserLoader","inviteUser_container","entities_UserSimple","iconType","UserSimpleContainer","renderGlobalPermission","renderNiceElapsed","renderNarrative","component_Narrative","OrganizationNarrative","requestAccess","shareButton","permissionTooltip","buttonTooltip","onRequestAccess","narrative_reduxAdapter","renderNarrativePermission","accessModal","drawer","closable","onClose","onCloseRequestAccess","Narratives","onRequestAddNarrative","onRemoveNarrative","onNarrativeMenu","onSearchNarratives","onSortNarratives","narrativesTable","extras","lastOrgVisitAt","OrganizationNarrative_OrganizationNarrative","renderNarrativeMenu","narrativesToShow","hiddenNarrativeCount","renderMemberNarratives","renderNonMemberNarratives","evaluate","ManageMembership","confirmed","doLeaveOrgConfirmed","onLeaveOrganization","onUpdateTitle","onTitleChange","onDone","_state$views$manageMe","MANAGE_MEMBERSHIP_LEAVE_ORG_START","MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS","MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR","_Validation$validateM","validateMemberTitle","_Validation$validateM2","validatedTitle","MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR","MANAGE_MEMBERSHIP_SAVE_START","MANAGE_MEMBERSHIP_SAVE_ERROR","renderDetail","renderInfo","component_Error","manageMembership_container","thisMember","editableProfile","editableOrg","editOrgSave","_state$views$editOrgV","updateOrg","editOrgEvaluate","editOrgUpdateDescriptionSuccess","NavigateTo","EditOrganization","navigateTo","onEditOrgSave","editOrganization_container","RequestAddNarrative","doSelectNarrative","doSendRequest","flag","onSearchSubmit","NumberFormat","useGrouping","doSortBy","renderFilterSortBar","renderFeedbackBar","renderNarratives","buttonLabel","canSendRequest","renderNarrativeSelector","renderSelectedNarrative","renderSelectedNarrativeButton","selectNarrative","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START","subViewModel","_request2","addOrRequestNarrativeToGroup","REQUEST_ADD_NARRATIVE_SEND_ERROR","REQUEST_ADD_NARRATIVE_SORT_START","REQUEST_ADD_NARRATIVE_SORT_ERROR","sortOrganizationNarratives","requestAddNarrative_container","AccordionState","_narratives","_request","getOrganization","getOwnNarratives","OrgMenu","onJoinOrg","onCancelJoinRequest","onAcceptInvitation","onRejectInvitation","onChangeSubView","MANAGE_MEMBERSHIP","EDIT_ORGANIZATION","INVITE_USER","ADD_NARRATIVE","onJoinClick","onMenuClick","adminMenu","ownerMenu","renderOrgMenu","ViewOrganization","showInfo","accordionState","UP","subView","renderEditRow","reduxAdapter","onReloadOrg","inner","twoToneColor","renderGroupRequestsRow","_this$props$viewModel","renderGroupRequests","renderMembersToolbar","onInviteUser","tabs","es_tabs","TabPane","tab","renderMembersTab","totalRequestCount","totalRequests","requests_container","titleCount","outboxSize","relatedOrgCount","relatedOrgTab","relatedOrgs_reduxAdapter","defaultActiveKey","animated","tabPosition","BROWSER","VIEW_MEMBERS","MANAGE_REQUESTS","DOWN","toggleAccordion","orgRowClass","narrativesRowClass","minHeight","renderOrg","renderAccordionControl","component_Narratives","renderCombo","manageRelatedOrganizations_loader","inviteUser_loader","manageMembership_loader","editOrganization_loader","requestAddNarrative_loader","renderManageRelatedOrgsView","renderInviteUsersView","renderManageMembership","renderEditOrganization","renderAddNarrative","renderNormalView","borg","OrgMenu_OrgMenu","BriefOrganizationHeader_BriefOrganization","getSubView","ownProps","onViewOrg","VIEW_ORG_REMOVE_NARRATIVE_START","removeNarrativeFromOrg","filteredNarratives","VIEW_ORG_ACCESS_NARRATIVE_START","grantNarrativeAccess","acceptInboxRequestActions","VIEW_ORG_SORT_NARRATIVES_START","renderMessage","renderJoinButton","onShowInfo","previousOrganizationId","inaccessible_container","accessible_container","previousProps","visitOrg","Auth","tokenRef","checkAuth","onRemoveAuthorization","onAddAuthorization","onLoginClick","onLogoutClick","buildAuthToolbar","children","buildAuthForm","hosted","buildAuthProd","buildAuthDev","endpoints","AuthClient","makePath","Cookies","getTokenInfo","getMe","account","desc","Listener","onSuccess","onError","WaitingListener","Message","channelId","created","envelope","uuidv4","Channel","host","awaitingResponse","waitingListeners","listeners","lastId","sentCount","receivedCount","unwelcomeReceivedCount","unwelcomeReceivedCountThreshhold","unwelcomeReceiptWarning","unwelcomeReceiptWarningCount","currentListener","messageEvent","handler","awaiting","listener","messageId","success","listen","postMessage","getMessage","sendMessage","sendRequest","_loop","startMonitor","listenOnce","received","receiveMessage","addEventListener","removeEventListener","IFrameSimulator","channel","frameId","authServiceURL","originalPath","viewParams","parentHost","IFrameIntegration","frameElement","hasAttribute","getAttribute","decodeURIComponent","KBaseIntegration","on","start","send","greeting","onAppStart","setupChannel","teardownChannel","_state$app","_state$app$config","defaultPath","iframeParams","getParamsFromIFrame","pushState","baseUrl","StateInstances","pending","DataServices","DATA_SERVICE_UNLOAD","AppContextProvider","Provider","Consumer","library","add","faSpinner","faSearch","faGlobe","faUserLock","DescriptionRenderer","sanitize","prot","unescape","replace","toLowerCase","out","Renderer","MarkedOptions","renderer","setOptions","initialState","makeInitialState","store","createStore","theReducer","compose","applyMiddleware","thunk","F","react_default","createElement","viewOrganization_loader","App","es","containers_KBaseIntegration","containers_Auth","storeAdapter","BrowserRouter","basename","Switch","Route","component","exact","Redirect","from","ReactDOM","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.cb235b9e.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/nouserpic.9af42ba9.png\";","import * as userProfile from \"../data/apis/userProfile\"\nimport * as groups from \"../data/apis/groups\"\nimport * as orgModel from '../data/models/organization/model'\nimport * as userModel from \"../data/models/user\"\nimport * as requestModel from '../data/models/requests'\nimport * as narrativeModel from '../data/models/narrative'\nimport { AnError } from \"../combo/error/api\";\n\n/* Types from the organization service (approximately) */\n\n/*\n    Organization\n*/\n\n\nexport enum ComponentView {\n    COMPACT = 0,\n    NORMAL\n}\n\nexport enum UIErrorType {\n    NONE = 0,\n    INFO,\n    WARNING,\n    ERROR\n}\n\nexport interface UIError {\n    type: UIErrorType\n    message?: string\n}\n\nexport enum SyncState {\n    NONE = 0,\n    NEW,\n    DIRTY,\n    CLEAN\n}\n\nexport enum EditState {\n    NONE = 'NONE',\n    UNEDITED = 'UNEDITED',\n    EDITED = 'EDITED'\n}\n\n\n// export enum ValidationState {\n//     NONE = 0,\n//     VALID,\n//     INVALID,\n//     // DIRTY = 'DIRTY',\n//     MISSING\n// }\n\nexport enum ValidationErrorType {\n    OK = 0,\n    ERROR,\n    REQUIRED_MISSING\n}\n\nexport interface ValidationStateBase {\n    type: ValidationErrorType\n    validatedAt: Date\n}\n\nexport interface ValidationStateOk extends ValidationStateBase {\n    type: ValidationErrorType.OK\n}\n\nexport interface ValidationStateError extends ValidationStateBase {\n    type: ValidationErrorType.ERROR\n    message: string\n}\n\nexport interface ValidationStateRequiredMissing extends ValidationStateBase {\n    type: ValidationErrorType.REQUIRED_MISSING\n    message: string\n}\n\n// export interface ValidationStateAsyncError extends ValidationStateBase {\n//     type: ValidationErrorType.ASYNC_ERROR\n//     message: string\n//     \n// }\n\nexport type ValidationState = ValidationStateOk | ValidationStateError | ValidationStateRequiredMissing\n\nexport interface Editable {\n    value: any\n    remoteValue: any\n    syncState: SyncState\n    // editState: EditState\n    // validationState: ValidationState\n    validationState: ValidationState\n    // validatedAt: Date | null\n    // error: UIError\n}\nexport interface EditableString extends Editable {\n    value: string,\n    remoteValue: string | null\n}\n\nexport interface EditableNullableString extends Editable {\n    value: string | null\n    remoteValue: string | null\n}\n\nexport interface EditableBoolean extends Editable {\n    value: boolean\n    remoteValue: boolean | null\n}\n\nexport interface EditableOrganization {\n    id: EditableString\n    name: EditableString\n    description: EditableString\n    isPrivate: EditableBoolean\n    logoUrl: EditableNullableString\n    homeUrl: EditableNullableString\n    researchInterests: EditableString\n}\n\n\n// TODO: or CLEAN to replace new and saved\nexport enum SaveState {\n    NONE = 'NONE',\n    NEW = 'NEW',\n    READY = 'READY',\n    SAVING = 'SAVING',\n    SAVED = 'SAVED',\n    SAVE_ERROR = 'SAVE_ERROR'\n}\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\nexport enum MemberType {\n    MEMBER = 0,\n    ADMIN,\n    OWNER\n}\nexport interface Member {\n    user: User,\n    type: MemberType\n}\n\nexport enum RequestType {\n    REQUEST = 0,\n    INVITATION\n}\n\nexport enum RequestResourceType {\n    USER = 0,\n    WORKSPACE,\n    APP\n}\n\nexport enum RequestStatus {\n    OPEN = 0,\n    CANCELED,\n    EXPIRED,\n    ACCEPTED,\n    DENIED\n}\n\nexport type Username = string\n\nexport interface App {\n    id: string,\n    module: string,\n    func: string,\n    version: string,\n    title: string,\n    category: string\n}\n\nexport interface AppResource {\n    id: string\n}\n\nexport interface EditedOrganization {\n    id: {\n        value: string,\n        error?: UIError\n    }\n    name: {\n        value: string,\n        error?: UIError\n    }\n    description: {\n        value: string,\n        error?: UIError\n    }\n}\n\n/*\n    Collection of organizations\n*/\n\n/* REDUX */\n\nexport enum AuthState {\n    NONE = 0,\n    CHECKING,\n    AUTHORIZED,\n    UNAUTHORIZED,\n    ERROR\n}\n\nexport interface UserAuthorization {\n    token: string,\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\n\nexport interface Authorization {\n    status: AuthState,\n    message: string,\n    authorization: UserAuthorization\n}\n\nexport enum ViewOrgState {\n    NONE = 0,\n    INITIAL,\n    FETCHING,\n    READY,\n    ERROR\n}\n\nexport enum AppState {\n    NONE = 0,\n    LOADING,\n    READY,\n    ERROR\n}\n\nexport enum SortDirection {\n    ASCENDING = 'asc',\n    DESCENDING = 'desc'\n}\n\nexport enum ComponentLoadingState {\n    NONE = 0,\n    LOADING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface ManageOrganizationRequestsViewModel {\n    organization: orgModel.Organization\n    requests: Array<requestModel.Request>\n    invitations: Array<requestModel.Request>\n}\n\nexport interface ManageOrganizationRequestsView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: ManageOrganizationRequestsViewModel | null\n}\n\nexport interface ViewMembersViewModel {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\nexport interface ViewMembersView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: ViewMembersViewModel | null\n}\n\nexport enum BrowseOrgsState {\n    NONE = 0,\n    SEARCHING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface BrowseOrgsViewModel {\n    rawOrganizations: Array<orgModel.BriefOrganization>\n    organizations: Array<orgModel.BriefOrganization>\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n    totalCount: number\n    filteredCount: number\n    sortField: string\n    sortDirection: SortDirection\n    filter: orgModel.Filter\n    searchTerms: Array<string>\n    selectedOrganizationId: string | null,\n    // TODO: let's make a new interface for running operations...\n    searching: boolean\n    error: AppError | null\n}\n\nexport interface BrowseOrgsView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: BrowseOrgsViewModel | null\n}\n\nexport enum InviteUserViewState {\n    NONE = 0,\n    EDITING,\n    SENDABLE,\n    SENDING,\n    SUCCESS,\n    ERROR\n}\n\n// user info we get out of user profile search\n\n\n// a user who may or may not be in an org, with org relation info\n// todo: fetch more profile info.\nexport interface OrganizationUser {\n    username: string\n    realname: string\n    relation: orgModel.UserRelationToOrganization\n}\n\n// View Model / Invite User (for admins)\n\nexport interface InviteUserViewModel {\n    organization: orgModel.Organization\n    users: Array<OrganizationUser> | null\n    selectedUser: {\n        user: User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: InviteUserViewState\n}\n\n\n\nexport interface ManageMembershipViewModel {\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n}\n\nexport interface ManageMembershipView {\n    loadingState: ComponentLoadingState\n    error: AnError | null\n    viewModel: ManageMembershipViewModel | null\n}\n\nexport enum NarrativeState {\n    NONE = 0,\n    ASSOCIATED,\n    REQUESTED\n}\n\nexport interface Narrative {\n    workspaceId: number\n    objectId: number\n    title: string\n    status: NarrativeState\n    owner: Username\n    modifiedAt: Date\n}\n\nexport enum ProcessingState {\n    NONE = 0,\n    PROCESSING,\n    SUCCESS,\n    ERROR\n}\n\n\nexport enum RequestNarrativeState {\n    NONE = 0,\n    LOADING,\n    ERROR,\n    LOADED,\n    SENDING,\n    SENT\n}\n\n// ViewModel / RequestAddNarrative\n\nexport interface RequestNarrativeViewModel {\n    organization: orgModel.Organization\n    narratives: Array<narrativeModel.OrganizationNarrative>\n    selectedNarrative: narrativeModel.OrganizationNarrative | null\n    relation: orgModel.Relation\n    error: AnError | null\n    saveState: SaveState\n}\n\n// Add Org\n\nexport interface AddOrgViewModel {\n    editState: EditState\n    saveState: SaveState\n    error: AppError | null\n    validationState: ValidationState\n    newOrganization: EditableOrganization\n}\n\nexport interface AddOrgView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: AddOrgViewModel | null\n}\n\n// Entities\n\nexport interface UserEntity {\n    userId: string\n    profile: userProfile.UserProfile\n}\n\nexport interface OrganizationEntity {\n    groupId: string\n    group: groups.Group\n}\n\nexport interface RequestEntity {\n    requestId: string\n    request: groups.Request\n}\n\nexport enum ViewOrgViewModelKind {\n    NORMAL = 0,\n    PRIVATE_INACCESSIBLE\n}\n\n// TODO: just for view org view, should be namespaced or something.\nexport enum SubViews {\n    NORMAL = 0,\n    MANAGE_RELATED_ORGS,\n    INVITE_USER,\n    MANAGE_MEMBERSHIP,\n    EDIT_ORGANIZATION,\n    ADD_NARRATIVE\n}\n\nexport interface ViewOrgViewModel {\n    kind: ViewOrgViewModelKind.NORMAL,\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    openRequest: orgModel.RequestStatus\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n    requestOutbox: Array<requestModel.Request>\n    requestInbox: Array<requestModel.Request>\n    sortNarrativesBy: string\n    searchNarrativesBy: string\n    narratives: Array<orgModel.NarrativeResource>\n    sortMembersBy: string\n    searchMembersBy: string\n    members: Array<orgModel.Member>\n\n    subViews: {\n        manageRelatedOrganizationsView: View<ManageRelatedOrgsViewModel>\n        inviteUserView: View<InviteUserViewModel>\n        requestNarrativeView: View<RequestNarrativeViewModel>\n    }\n}\n\nexport interface ViewInaccessiblePrivateOrgViewModel {\n    kind: ViewOrgViewModelKind.PRIVATE_INACCESSIBLE,\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n}\n\nexport interface ViewOrgView {\n    loadingState: ComponentLoadingState\n    error: AppError | null\n    viewModel: ViewOrgViewModel | ViewInaccessiblePrivateOrgViewModel | null\n}\n\nexport enum ViewOrgSubViewKind {\n    NONE = 0,\n    MANAGE_RELATED_ORGS\n}\n\nexport interface NoneViewModel {\n    kind: ViewOrgSubViewKind.NONE\n}\n\nexport enum ViewState {\n    NONE = 0,\n    LOADING,\n    OK,\n    ERROR\n}\nexport interface View<T> {\n    state: ViewState\n    error: AnError | null\n    viewModel: T | null\n}\n\nexport interface SelectableRelatableOrganization {\n    organization: orgModel.BriefOrganization\n    isRelated: boolean\n    isSelected: boolean\n}\n\nexport interface ManageRelatedOrgsViewModel {\n    kind: ViewOrgSubViewKind.MANAGE_RELATED_ORGS\n    organization: orgModel.Organization\n    availableOrganizations: {\n        organizations: Array<SelectableRelatableOrganization>\n        queried: Array<SelectableRelatableOrganization>\n        searchBy: string\n    }\n    relatedOrganizations: Array<string>\n    selectedOrganization: SelectableRelatableOrganization | null\n}\n\nexport type ViewOrgSubView = View<NoneViewModel> | View<ManageRelatedOrgsViewModel>\n\n\nexport interface EditOrgViewModel {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    editedOrganization: EditableOrganization\n    organization: orgModel.Organization\n    saveError: AppError | null\n}\n\nexport interface EditOrgView {\n    loadingState: ComponentLoadingState,\n    error: AppError | null,\n    viewModel: EditOrgViewModel | null\n}\n\nexport interface StoreState {\n    // new!!\n    entities: {\n        users: {\n            byId: Map<userModel.Username, userModel.User>\n            all: Array<string>\n        }\n        orgs: {\n            byId: Map<orgModel.OrganizationID, orgModel.Organization | orgModel.InaccessiblePrivateOrganization>\n            all: Array<string>\n        }\n        requests: {\n            byId: Map<requestModel.RequestID, requestModel.Request>\n            all: Array<string>\n        }\n        narratives: {\n            byId: Map<narrativeModel.WorkspaceID, narrativeModel.Narrative>\n        }\n        organizations: {\n            byId: Map<orgModel.OrganizationID, orgModel.Organization | orgModel.InaccessiblePrivateOrganization>\n        }\n    }\n\n    db: {\n    }\n\n    auth: Authorization\n    error: AppError | null\n\n    app: {\n        status: AppState\n        config: AppConfig\n        error?: AppError,\n    }\n\n    views: {\n        browseOrgsView: BrowseOrgsView\n        addOrgView: AddOrgView\n        viewOrgView: ViewOrgView\n        editOrgView: EditOrgView\n        manageOrganizationRequestsView: ManageOrganizationRequestsView\n        viewMembersView: ViewMembersView\n        // inviteUserView: InviteUserView\n        manageMembershipView: ManageMembershipView\n        // requestNarrativeView: RequestNarrativeView\n        // organizationCentricView: OrganizationCentricView\n    }\n    updateOrg: {\n        pending: boolean\n    }\n}\n\nexport enum ErrorCode {\n    NONE = 0,\n    ERROR\n}\n\n/* COMPONENT PROPS */\n\nexport interface SomeError {\n    code: ErrorCode\n    message: string\n    detail: string\n    id: string\n    at: Date\n\n    errorHistory?: Array<AppError>\n    trace?: Array<string>\n    info?: any\n}\n\nexport interface AppError {\n    code: string\n    message: string\n    generatedAt?: Date\n    trace?: Array<string>\n    errors?: Array<AppError>\n    exception?: AppException\n}\n\nexport class AppException extends Error {\n    code: string\n    message: string\n    detail?: string\n    trace?: Array<string>\n    errors?: Array<AppException>\n    info?: Map<string, any>\n    constructor({ code, message, detail, info }: { code: string, message: string, detail?: string, info?: Map<string, any> }) {\n        super(message)\n        this.name = 'AppException'\n        this.code = code\n        this.message = message\n        this.detail = detail\n        this.info = info\n\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, AppException)\n        }\n\n        if (this.stack) {\n            if (this.stack.indexOf('\\n') >= 0) {\n                this.trace = this.stack.split('\\n')\n            } else {\n                this.trace = [this.stack]\n            }\n        }\n    }\n}\n\nexport interface AppConfig {\n    baseUrl: string\n    services: {\n        Groups: {\n            url: string\n        }\n        UserProfile: {\n            url: string\n        }\n        Workspace: {\n            url: string\n        }\n        ServiceWizard: {\n            url: string\n        }\n        Auth: {\n            url: string\n        }\n    }\n    defaultPath: string,\n    channelId: string | null\n}\n\nexport interface AuthProps {\n    authorization: Authorization,\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n    hosted: boolean,\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nexport interface IFrameParams {\n    channelId: string\n    frameId: string\n    params: {\n        groupsServiceURL: string\n        userProfileServiceURL: string\n        workspaceServiceURL: string\n        serviceWizardURL: string\n        authServiceURL: string\n        originalPath: string | null,\n        view: string | null,\n        viewParams: any\n    },\n    parentHost: string\n}","export enum ActionFlag {\n    APP = 1,\n    APP_START,\n    APP_SUCCESS,\n    // APP_SUCCESS_IFRAME,\n    // APP_SUCCESS_SOLO,\n    APP_ERROR,\n\n    BROWSE_ORGS_LOAD,\n    BROWSE_ORGS_LOAD_START,\n    BROWSE_ORGS_LOAD_SUCCESS,\n    BROWSE_ORGS_LOAD_ERROR,\n    BROWSE_ORGS_UNLOAD,\n\n    BROWSE_ORGS_SORT,\n    BROWSE_ORGS_SORT_START,\n    BROWSE_ORGS_SORT_SUCCESS,\n    BROWSE_ORGS_SORT_ERROR,\n\n    BROWSE_ORGS_FILTER,\n    BROWSE_ORGS_FILTER_START,\n    BROWSE_ORGS_FILTER_SUCCESS,\n    BROWSE_ORGS_FILTER_ERROR,\n\n    BROWSE_ORGS_SEARCH,\n    BROWSE_ORGS_SEARCH_START,\n    BROWSE_ORGS_SEARCH_SUCCESS,\n    BROWSE_ORGS_SEARCH_ERROR,\n\n    UPDATE_ORG,\n    UPDATE_ORG_START,\n    UPDATE_ORG_SUCCESS,\n    UPDATE_ORG_ERROR,\n\n    // viewing org\n    VIEW_ORG_LOAD,\n    VIEW_ORG_LOAD_START,\n    VIEW_ORG_LOAD_SUCCESS,\n    VIEW_ORG_LOAD_ERROR,\n    VIEW_ORG_UNLOAD,\n    VIEW_ORG_RELOAD,\n\n    VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,\n    VIEW_ORG_LOAD_NORMAL_SUCCESS,\n\n    // Requests\n\n    VIEW_ORG_JOIN_REQUEST,\n    VIEW_ORG_JOIN_REQUEST_START,\n    VIEW_ORG_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_CANCEL_JOIN_REQUEST,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_START,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_ACCEPT_JOIN_INVITATION,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_START,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n\n    VIEW_ORG_ACCEPT_INBOX_REQUEST,\n    VIEW_ORG_ACCEPT_INBOX_REQUEST_START,\n    VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,\n    VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n\n    VIEW_ORG_REJECT_INBOX_REQUEST,\n    VIEW_ORG_REJECT_INBOX_REQUEST_START,\n    VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,\n    VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,\n\n    VIEW_ORG_REJECT_JOIN_INVITATION,\n    VIEW_ORG_REJECT_JOIN_INVITATION_START,\n    VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n\n    VIEW_ORG_REMOVE_NARRATIVE,\n    VIEW_ORG_REMOVE_NARRATIVE_START,\n    VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n\n    VIEW_ORG_ACCESS_NARRATIVE,\n    VIEW_ORG_ACCESS_NARRATIVE_START,\n    VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n\n    VIEW_ORG_SORT_NARRATIVES,\n    VIEW_ORG_SORT_NARRATIVES_START,\n    VIEW_ORG_SORT_NARRATIVES_SUCCESS,\n    VIEW_ORG_SORT_NARRATIVES_ERROR,\n\n    VIEW_ORG_SEARCH_NARRATIVES,\n    VIEW_ORG_SEARCH_NARRATIVES_START,\n    VIEW_ORG_SEARCH_NARRATIVES_SUCCESS,\n    VIEW_ORG_SEARCH_NARRATIVES_ERROR,\n\n    VIEW_ORG_SORT_MEMBERS,\n    VIEW_ORG_SORT_MEMBERS_START,\n    VIEW_ORG_SORT_MEMBERS_SUCCESS,\n    VIEW_ORG_SORT_MEMBERS_ERROR,\n\n    VIEW_ORG_SEARCH_MEMBERS,\n    VIEW_ORG_SEARCH_MEMBERS_START,\n    VIEW_ORG_SEARCH_MEMBERS_SUCCESS,\n    VIEW_ORG_SEARCH_MEMBERS_ERROR,\n\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD,\n\n    // keep these ones simple...\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,\n\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,\n\n    VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION,\n    VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START,\n    VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,\n    VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,\n\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS,\n    VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR,\n\n    // PRIVATE ORG\n\n    VIEW_PRIVATE_ORG_JOIN_REQUEST,\n    VIEW_PRIVATE_ORG_JOIN_REQUEST_START,\n    VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS,\n    VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR,\n\n    // MEMBERS\n\n    VIEW_ORG_VIEW_MEMBERS_LOAD,\n    VIEW_ORG_VIEW_MEMBERS_LOAD_START,\n    VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR,\n    VIEW_ORG_VIEW_MEMBERS_UNLOAD,\n\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER,\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START,\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START,\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START,\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n\n    // add org fields\n\n    ADD_ORG_LOAD,\n    ADD_ORG_LOAD_START,\n    ADD_ORG_LOAD_SUCCESS,\n    ADD_ORG_LOAD_ERROR,\n    ADD_ORG_UNLOAD,\n\n    ADD_ORG_UPDATE_NAME,\n    ADD_ORG_UPDATE_NAME_SUCCESS,\n    ADD_ORG_UPDATE_NAME_ERROR,\n\n    ADD_ORG_UPDATE_LOGO_URL,\n    ADD_ORG_UPDATE_LOGO_URL_SUCCESS,\n    ADD_ORG_UPDATE_LOGO_URL_ERROR,\n\n    ADD_ORG_UPDATE_ID,\n    ADD_ORG_UPDATE_ID_SUCCESS,\n    ADD_ORG_UPDATE_ID_ERROR,\n    ADD_ORG_UPDATE_ID_PASS,\n    ADD_ORG_EVALUATE_ID,\n\n    ADD_ORG_UPDATE_DESCRIPTION,\n    ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    ADD_ORG_UPDATE_IS_PRIVATE,\n    ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    ADD_ORG_UPDATE_IS_PRIVATE_ERROR,\n\n    ADD_ORG_UPDATE_HOME_URL,\n    ADD_ORG_UPDATE_HOME_URL_SUCCESS,\n    ADD_ORG_UPDATE_HOME_URL_ERROR,\n\n    ADD_ORG_UPDATE_RESEARCH_INTERESTS,\n    ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n    ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n\n    ADD_ORG_EVALUATE,\n    ADD_ORG_EVALUATE_OK,\n    ADD_ORG_EVALUATE_ERRORS,\n\n    ADD_ORG_SAVE,\n    ADD_ORG_SAVE_START,\n    ADD_ORG_SAVE_SUCCESS,\n    ADD_ORG_SAVE_ERROR,\n\n\n    // editing org\n    EDIT_ORG_LOAD,\n    EDIT_ORG_LOAD_START,\n    EDIT_ORG_LOAD_SUCCESS,\n    EDIT_ORG_LOAD_ERROR,\n    EDIT_ORG_UNLOAD,\n\n    EDIT_ORG_SAVE,\n    EDIT_ORG_SAVE_START,\n    EDIT_ORG_SAVE_SUCCESS,\n    EDIT_ORG_SAVE_ERROR,\n\n    // edit org, field level updates\n    EDIT_ORG_UPDATE_NAME,\n    EDIT_ORG_UPDATE_NAME_SUCCESS,\n    EDIT_ORG_UPDATE_NAME_ERROR,\n\n    EDIT_ORG_UPDATE_LOGO_URL,\n    EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,\n    EDIT_ORG_UPDATE_LOGO_URL_ERROR,\n\n    EDIT_ORG_UPDATE_DESCRIPTION,\n    EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    EDIT_ORG_UPDATE_IS_PRIVATE,\n    EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    EDIT_ORG_UPDATE_IS_PRIVATE_ERROR,\n\n    EDIT_ORG_UPDATE_HOME_URL,\n    EDIT_ORG_UPDATE_HOME_URL_SUCCESS,\n    EDIT_ORG_UPDATE_HOME_URL_ERROR,\n\n    EDIT_ORG_UPDATE_RESEARCH_INTERESTS,\n    EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n    EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n\n    EDIT_ORG_EVALUATE,\n    EDIT_ORG_EVALUATE_OK,\n    EDIT_ORG_EVALUATE_ERRORS,\n\n    // Auth\n    AUTH_CHECK,\n    AUTH_CHECK_START,\n    AUTH_CHECK_ERROR,\n    AUTH_AUTHORIZED,\n    AUTH_UNAUTHORIZED,\n    AUTH_REMOVE_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_LOAD,\n    ADMIN_MANAGE_REQUESTS_LOAD_START,\n    ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n    ADMIN_MANAGE_REQUESTS_UNLOAD,\n\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,\n\n    // MEMBERS\n    VIEW_MEMBERS_LOAD,\n    VIEW_MEMBERS_LOAD_START,\n    VIEW_MEMBERS_LOAD_SUCCESS,\n    VIEW_MEMBERS_LOAD_ERROR,\n    VIEW_MEMBERS_UNLOAD,\n\n    VIEW_MEMBERS_REMOVE_MEMBER,\n    VIEW_MEMBERS_REMOVE_MEMBER_START,\n    VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_START,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_START,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n\n    // INVITE USER\n    INVITE_USER_LOAD,\n    INVITE_USER_LOAD_START,\n    INVITE_USER_LOAD_SUCCESS,\n    INVITE_USER_LOAD_ERROR,\n    INVITE_USER_UNLOAD,\n\n    INVITE_USER_SEARCH_USERS,\n    INVITE_USER_SEARCH_USERS_START,\n    INVITE_USER_SEARCH_USERS_SUCCESS,\n    INVITE_USER_SEARCH_USERS_ERROR,\n\n    INVITE_USER_SELECT_USER,\n    INVITE_USER_SELECT_USER_START,\n    INVITE_USER_SELECT_USER_SUCCESS,\n    INVITE_USER_SELECT_USER_ERROR,\n\n    INVITE_USER_SEND_INVITATION,\n    INVITE_USER_SEND_INVITATION_START,\n    INVITE_USER_SEND_INVITATION_SUCCESS,\n    INVITE_USER_SEND_INVITATION_ERROR,\n\n    // Manage Membership\n    MANAGE_MEMBERSHIP_LOAD,\n    MANAGE_MEMBERSHIP_LOAD_START,\n    MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n    MANAGE_MEMBERSHIP_LOAD_ERROR,\n    MANAGE_MEMBERSHIP_UNLOAD,\n\n    MANAGE_MEMBERSHIP_LEAVE_ORG,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_START,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS,\n    MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,\n\n    MANAGE_MEMBERSHIP_UPDATE_TITLE,\n    MANAGE_MEMBERSHIP_UPDATE_TITLE_START,\n    MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,\n    MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,\n\n    MANAGE_MEMBERSHIP_SAVE,\n    MANAGE_MEMBERSHIP_SAVE_START,\n    MANAGE_MEMBERSHIP_SAVE_SUCCESS,\n    MANAGE_MEMBERSHIP_SAVE_ERROR,\n\n    MANAGE_MEMBERSHIP_EVALUATE,\n    MANAGE_MEMBERSHIP_EVALUATE_SUCCESS,\n    MANAGE_MEMBERSHIP_EVALUATE_ERROR,\n\n    // Narrative add requests\n    REQUEST_ADD_NARRATIVE_LOAD,\n    REQUEST_ADD_NARRATIVE_LOAD_START,\n    REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n    REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n    REQUEST_ADD_NARRATIVE_UNLOAD,\n\n    REQUEST_ADD_NARRATIVE_SEND,\n    REQUEST_ADD_NARRATIVE_SEND_START,\n    REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SEND_ERROR,\n\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR,\n\n    REQUEST_ADD_NARRATIVE_SORT,\n    REQUEST_ADD_NARRATIVE_SORT_START,\n    REQUEST_ADD_NARRATIVE_SORT_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SORT_ERROR,\n\n    // VIEWS\n\n    ORGANIZATION_CENTRIC_VIEW_LOAD,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_START,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,\n    ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,\n    ORGANIZATION_CENTRIC_VIEW_UNLOAD,\n\n    // ENTITIES\n\n    ENTITY_USER_LOADER,\n    ENTITY_USER_LOADER_START,\n    ENTITY_USER_LOADER_SUCCESS,\n    ENTITY_USER_LOADER_ERROR,\n\n    ENTITY_ORGANIZATION_LOADER,\n    ENTITY_ORGANIZATION_LOADER_START,\n    ENTITY_ORGANIZATION_LOADER_SUCCESS,\n    ENTITY_ORGANIZATION_LOADER_ERROR,\n\n    ENTITY_NARRATIVE_LOAD,\n    ENTITY_NARRATIVE_LOAD_START,\n    ENTITY_NARRATIVE_LOAD_SUCCESS,\n    ENTITY_NARRATIVE_LOAD_ERROR,\n\n    ENTITY_ORGANIZATION_LOAD,\n    ENTITY_ORGANIZATION_LOAD_START,\n    ENTITY_ORGANIZATION_LOAD_SUCCESS,\n    ENTITY_ORGANIZATION_LOAD_ERROR,\n\n    // GLOBAL ACTIONS\n    // GLOBAL_ACCESS_NARRATIVE,\n    // GLOBAL_ACCESS_NARRATIVE_START,\n    // GLOBAL_ACCESS_NARRATIVE_SUCCESS,\n    // GLOBAL_ACCESS_NARRATIVE_ERROR,\n\n    // USER PROFILE\n    DATA_SERVICE_LOAD,\n    DATA_SERVICE_LOAD_START,\n    DATA_SERVICE_LOAD_SUCCESS,\n    DATA_SERVICE_LOAD_ERROR,\n    DATA_SERVICE_UNLOAD,\n\n    DATA_SERVICE_LOAD_REFRESH,\n    DATA_SERVICE_LOAD_REFRESH_START,\n    DATA_SERVICE_LOAD_REFRESH_SUCCESS,\n    DATA_SERVICE_LOAD_REFRESH_ERROR\n}\n","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, UIErrorType, ValidationState, ComponentLoadingState, SyncState, ValidationErrorType } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    LoadStart, Unload,\n    SaveError, SaveStart, SaveSuccess, AddOrgEvaluateOK, AddOrgEvaluateErrors,\n    LoadSuccess, UpdateNameSuccess, UpdateNameError,\n    UpdateIdSuccess, UpdateIdError, UpdateDescriptionSuccess,\n    UpdateDescriptionError,\n    LoadError,\n    UpdateIdPass,\n    UpdateIsPrivateSuccess,\n    UpdateLogoUrlSuccess,\n    UpdateLogoUrlError,\n    UpdateHomeUrlSuccess,\n    UpdateHomeUrlError,\n    UpdateResearchInterestsSuccess,\n    UpdateResearchInterestsError\n} from '../actions/addOrg'\nimport Validation from '../../data/models/organization/validation';\n\n// ADD ORG\n\nexport function saveStart(state: StoreState, action: SaveStart): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveStart without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    saveState: SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function saveSuccess(state: StoreState, action: SaveSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED\n                }\n            }\n        }\n    }\n}\n\nexport function saveError(state: StoreState, action: SaveError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    saveState: SaveState.SAVE_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEvaluateOk(state: StoreState, action: AddOrgEvaluateOK): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEvaluateErrors(state: StoreState, action: AddOrgEvaluateErrors): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting saveSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.ERROR,\n                        message: 'TODO: form error',\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function loadStart(state: StoreState, action: LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: EditState.UNEDITED,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    },\n                    saveState: SaveState.NEW,\n                    error: null,\n                    newOrganization: action.newOrganization\n                }\n            }\n        }\n    }\n}\nexport function loadError(state: StoreState, action: LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\n// Name\nexport function updateNameSuccess(state: StoreState, action: UpdateNameSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateNameSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        name: {\n                            ...state.views.addOrgView.viewModel.newOrganization.name,\n                            value: action.name,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            },\n                            // editState: EditState.EDITED,\n                            // validatedAt: new Date(),\n                            // error: {\n                            //     type: UIErrorType.NONE\n                            // }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateNameError(state: StoreState, action: UpdateNameError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateNameError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        name: {\n                            ...state.views.addOrgView.viewModel.newOrganization.name,\n                            value: action.name,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                            // editState: EditState.EDITED,\n                            // validatedAt: new Date(),\n                            // error: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Logo URL\nexport function updateLogoUrlSuccess(state: StoreState, action: UpdateLogoUrlSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Logo URL without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        logoUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.logoUrl,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateLogoUrlError(state: StoreState, action: UpdateLogoUrlError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Logo URL error without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        logoUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.logoUrl,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Home URL\nexport function updateHomeUrlSuccess(state: StoreState, action: UpdateHomeUrlSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Home URL (success) without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        homeUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.homeUrl,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateHomeUrlError(state: StoreState, action: UpdateHomeUrlError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting update to home url without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        homeUrl: {\n                            ...state.views.addOrgView.viewModel.newOrganization.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            value: action.homeUrl,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Research Interests\nexport function updateResearchInterestsSuccess(state: StoreState, action: UpdateResearchInterestsSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting Research Interests without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        researchInterests: {\n                            ...state.views.addOrgView.viewModel.newOrganization.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            value: action.researchInterests,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateResearchInterestsError(state: StoreState, action: UpdateResearchInterestsError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting update to research interests (error) without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        researchInterests: {\n                            ...state.views.addOrgView.viewModel.newOrganization.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            value: action.researchInterests,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Id\n\nexport function updateIdSuccess(state: StoreState, action: UpdateIdSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            ...state.views.addOrgView.viewModel.newOrganization.id,\n                            // value: action.id,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIdError(state: StoreState, action: UpdateIdError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            ...state.views.addOrgView.viewModel.newOrganization.id,\n                            // value: action.id,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIdPass(state: StoreState, action: UpdateIdPass): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        id: {\n                            ...state.views.addOrgView.viewModel.newOrganization.id,\n                            value: action.id,\n                            syncState: SyncState.DIRTY\n                            // validationState: {\n                            //     type: ValidationErrorType.OK,\n                            //     validatedAt: new Date()\n                            // }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionSuccess(state: StoreState, action: UpdateDescriptionSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateDescriptionSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        description: {\n                            ...state.views.addOrgView.viewModel.newOrganization.description,\n                            value: action.description,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionError(state: StoreState, action: UpdateDescriptionError): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateDescriptionError without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        description: {\n                            ...state.views.addOrgView.viewModel.newOrganization.description,\n                            value: action.description,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIsPrivateSuccess(state: StoreState, action: UpdateIsPrivateSuccess): StoreState {\n    if (!state.views.addOrgView.viewModel) {\n        console.warn('attempting updateIdSuccess without view model')\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            addOrgView: {\n                ...state.views.addOrgView,\n                viewModel: {\n                    ...state.views.addOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    newOrganization: {\n                        ...state.views.addOrgView.viewModel.newOrganization,\n                        isPrivate: {\n                            ...state.views.addOrgView.viewModel.newOrganization.isPrivate,\n                            value: action.isPrivate,\n                            syncState: SyncState.DIRTY,\n                            validationState: {\n                                type: ValidationErrorType.OK,\n                                validatedAt: new Date()\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.ADD_ORG_SAVE:\n            return saveStart(state, action as SaveStart)\n        case ActionFlag.ADD_ORG_SAVE_SUCCESS:\n            return saveSuccess(state, action as SaveSuccess)\n        case ActionFlag.ADD_ORG_SAVE_ERROR:\n            return saveError(state, action as SaveError)\n\n        case ActionFlag.ADD_ORG_LOAD_START:\n            return loadStart(state, action as LoadStart)\n        case ActionFlag.ADD_ORG_LOAD_SUCCESS:\n            return loadSuccess(state, action as LoadSuccess)\n        case ActionFlag.ADD_ORG_LOAD_ERROR:\n            return loadError(state, action as LoadError)\n        case ActionFlag.ADD_ORG_UNLOAD:\n            return unload(state, action as Unload)\n\n        case ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS:\n            return updateNameSuccess(state, action as UpdateNameSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_NAME_ERROR:\n            return updateNameError(state, action as UpdateNameError)\n\n        case ActionFlag.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:\n            return updateLogoUrlSuccess(state, action as UpdateLogoUrlSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_LOGO_URL_ERROR:\n            return updateLogoUrlError(state, action as UpdateLogoUrlError)\n\n        case ActionFlag.ADD_ORG_UPDATE_HOME_URL_SUCCESS:\n            return updateHomeUrlSuccess(state, action as UpdateHomeUrlSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_HOME_URL_ERROR:\n            return updateHomeUrlError(state, action as UpdateHomeUrlError)\n\n        case ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:\n            return updateResearchInterestsSuccess(state, action as UpdateResearchInterestsSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:\n            return updateResearchInterestsError(state, action as UpdateResearchInterestsError)\n\n        case ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS:\n            return updateIdSuccess(state, action as UpdateIdSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_ID_ERROR:\n            return updateIdError(state, action as UpdateIdError)\n        case ActionFlag.ADD_ORG_UPDATE_ID_PASS:\n            return updateIdPass(state, action as UpdateIdPass)\n\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return updateDescriptionSuccess(state, action as UpdateDescriptionSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR:\n            return updateDescriptionError(state, action as UpdateDescriptionError)\n\n        case ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:\n            return updateIsPrivateSuccess(state, action as UpdateIsPrivateSuccess)\n\n        case ActionFlag.ADD_ORG_EVALUATE_OK:\n            return addOrgEvaluateOk(state, action as AddOrgEvaluateOK)\n        case ActionFlag.ADD_ORG_EVALUATE_ERRORS:\n            return addOrgEvaluateErrors(state, action as AddOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, ComponentLoadingState, ValidationErrorType, SyncState, ValidationState, ValidationStateOk, EditOrgViewModel } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    LoadStart, LoadSuccess, LoadError,\n    EditOrgEvaluateOK, EditOrgEvaluateErrors,\n    EditOrgSave, EditOrgSaveStart, EditOrgSaveError, EditOrgSaveSuccess,\n    EditOrgUpdateNameSuccess, EditOrgUpdateNameError,\n    // EditOrgUpdateIdSuccess, EditOrgUpdateIdError,\n    EditOrgUpdateDescriptionSuccess, EditOrgUpdateDescriptionError,\n    UpdateIsPrivateSuccess, EditOrgUpdateLogoUrlSuccess, EditOrgUpdateLogoUrlError, UpdateHomeUrlSuccess, UpdateHomeUrlError, UpdateResearchInterestsError, UpdateResearchInterestsSuccess, Unload\n} from '../actions/editOrg'\nimport { StateInstances } from '../state';\n\n\n\n// EDIT ORG\n\n// Edit session loading\n\nexport function loadStart(state: StoreState, action: LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n\n            }\n        }\n    }\n}\n\nfunction validationStateOk(): ValidationStateOk {\n    const x: ValidationState = {\n        type: ValidationErrorType.OK,\n        validatedAt: new Date()\n    }\n    return x\n}\n\nexport function loadSuccess(state: StoreState, action: LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    editState: EditState.UNEDITED,\n                    validationState: validationStateOk(),\n                    // validationState: {\n                    //     type: ValidationErrorType.OK,\n                    //     validatedAt: new Date()\n                    // },\n                    saveState: SaveState.NEW,\n                    // TODO: get rid of this...\n                    // organizationId: action.id,\n                    organization: action.organization,\n                    saveError: null,\n                    editedOrganization: action.editedOrganization\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\n// save\n\nexport function editOrgSaveStart(state: StoreState, action: EditOrgSaveStart): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    saveState: SaveState.SAVING\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgSaveSuccess(state: StoreState, action: EditOrgSaveSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED,\n                    editedOrganization: {\n                        id: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.id,\n                            syncState: SyncState.CLEAN\n                        },\n                        name: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.name,\n                            syncState: SyncState.CLEAN\n                        },\n                        logoUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.logoUrl,\n                            syncState: SyncState.CLEAN\n                        },\n                        homeUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.homeUrl,\n                            syncState: SyncState.CLEAN\n                        },\n                        researchInterests: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.researchInterests,\n                            syncState: SyncState.CLEAN\n                        },\n                        isPrivate: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.isPrivate,\n                            syncState: SyncState.CLEAN\n                        },\n                        description: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.description,\n                            syncState: SyncState.CLEAN\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgSaveError(state: StoreState, action: EditOrgSaveError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    saveState: SaveState.SAVE_ERROR,\n                    saveError: action.error\n                }\n            }\n        }\n    }\n}\n\n// Evaluate edit session\n\nexport function editOrgEvaluateOk(state: StoreState, action: EditOrgEvaluateOK): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgEvaluateErrors(state: StoreState, action: EditOrgEvaluateErrors): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Validation errors',\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction evaluateEditorState(viewModel: EditOrgViewModel): EditState {\n    if (viewModel.editedOrganization.name.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.id.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.logoUrl.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.homeUrl.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.researchInterests.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.isPrivate.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    if (viewModel.editedOrganization.description.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    return EditState.UNEDITED\n}\n\n\n\n// Name\nexport function editOrgUpdateNameSuccess(state: StoreState, action: EditOrgUpdateNameSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const editedOrg = state.views.editOrgView.viewModel.editedOrganization\n    let syncState\n    if (action.name !== editedOrg.name.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    // editState: editState,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        name: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.name,\n                            value: action.name,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateNameError(state: StoreState, action: EditOrgUpdateNameError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        name: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.name,\n                            value: action.name,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Logo url\nexport function editOrgUpdateLogoUrlSuccess(state: StoreState, action: EditOrgUpdateLogoUrlSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        logoUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.logoUrl,\n                            value: action.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateLogoUrlError(state: StoreState, action: EditOrgUpdateLogoUrlError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        logoUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.logoUrl,\n                            value: action.logoUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Update Home Url\n\n// Logo url\nexport function editOrgUpdateHomeUrlSuccess(state: StoreState, action: UpdateHomeUrlSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        homeUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.homeUrl,\n                            value: action.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateHomeUrlError(state: StoreState, action: UpdateHomeUrlError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        homeUrl: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.homeUrl,\n                            value: action.homeUrl,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Update Research Interests\n\n// Logo url\nexport function updateResearchInterestsSuccess(state: StoreState, action: UpdateResearchInterestsSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        researchInterests: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.researchInterests,\n                            value: action.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function updateResearchInterestsError(state: StoreState, action: UpdateResearchInterestsError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        researchInterests: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.researchInterests,\n                            value: action.researchInterests,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateDescriptionSuccess(state: StoreState, action: EditOrgUpdateDescriptionSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    const editedOrg = state.views.editOrgView.viewModel.editedOrganization\n    let syncState\n    if (action.description !== editedOrg.description.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        description: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.description,\n                            value: action.description,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateDescriptionError(state: StoreState, action: EditOrgUpdateDescriptionError): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        description: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.description,\n                            value: action.description,\n                            syncState: SyncState.DIRTY,\n                            validationState: action.error\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function updateIsPrivateSuccess(state: StoreState, action: UpdateIsPrivateSuccess): StoreState {\n    if (!state.views.editOrgView.viewModel) {\n        return state\n    }\n\n\n    const editedOrg = state.views.editOrgView.viewModel.editedOrganization\n    let syncState\n    if (action.isPrivate !== editedOrg.isPrivate.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...state.views.editOrgView,\n                viewModel: {\n                    ...state.views.editOrgView.viewModel,\n                    editState: EditState.EDITED,\n                    editedOrganization: {\n                        ...state.views.editOrgView.viewModel.editedOrganization,\n                        isPrivate: {\n                            ...state.views.editOrgView.viewModel.editedOrganization.isPrivate,\n                            value: action.isPrivate,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // This bit is just to ensure that the overall edit state (used for controlling, e.g., the \n    // enablement of a save button).\n    const editState = evaluateEditorState(newState.views.editOrgView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            editOrgView: {\n                ...newState.views.editOrgView,\n                viewModel: {\n                    ...newState.views.editOrgView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.EDIT_ORG_LOAD_START:\n            return loadStart(state, action as LoadStart)\n        case ActionFlag.EDIT_ORG_LOAD_SUCCESS:\n            return loadSuccess(state, action as LoadSuccess)\n        case ActionFlag.EDIT_ORG_LOAD_ERROR:\n            return loadError(state, action as LoadError)\n\n        case ActionFlag.EDIT_ORG_UNLOAD:\n            return unload(state, action as Unload)\n\n        case ActionFlag.EDIT_ORG_SAVE_START:\n            return editOrgSaveStart(state, action as EditOrgSaveStart)\n        case ActionFlag.EDIT_ORG_SAVE_SUCCESS:\n            return editOrgSaveSuccess(state, action as EditOrgSaveSuccess)\n        case ActionFlag.EDIT_ORG_SAVE_ERROR:\n            return editOrgSaveError(state, action as EditOrgSaveError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS:\n            return editOrgUpdateNameSuccess(state, action as EditOrgUpdateNameSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR:\n            return editOrgUpdateNameError(state, action as EditOrgUpdateNameError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:\n            return editOrgUpdateLogoUrlSuccess(state, action as EditOrgUpdateLogoUrlSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_ERROR:\n            return editOrgUpdateLogoUrlError(state, action as EditOrgUpdateLogoUrlError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:\n            return editOrgUpdateHomeUrlSuccess(state, action as UpdateHomeUrlSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_HOME_URL_ERROR:\n            return editOrgUpdateHomeUrlError(state, action as UpdateHomeUrlError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:\n            return updateResearchInterestsSuccess(state, action as UpdateResearchInterestsSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:\n            return updateResearchInterestsError(state, action as UpdateResearchInterestsError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:\n            return updateIsPrivateSuccess(state, action as UpdateIsPrivateSuccess)\n\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS:\n        //     return editOrgUpdateIdSuccess(state, action as EditOrgUpdateIdSuccess)\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_ERROR:\n        //     return editOrgUpdateIdError(state, action as EditOrgUpdateIdError)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return updateDescriptionSuccess(state, action as EditOrgUpdateDescriptionSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:\n            return editOrgUpdateDescriptionError(state, action as EditOrgUpdateDescriptionError)\n        case ActionFlag.EDIT_ORG_EVALUATE_OK:\n            return editOrgEvaluateOk(state, action as EditOrgEvaluateOK)\n        case ActionFlag.EDIT_ORG_EVALUATE_ERRORS:\n            return editOrgEvaluateErrors(state, action as EditOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/acceptInboxRequest'\nimport { StoreState, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n\nexport function acceptInboxRequestSuccess(state: StoreState, action: actions.AcceptRequestSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    requestInbox: action.requests\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:\n            return acceptInboxRequestSuccess(state, action as actions.AcceptRequestSuccess)\n        default:\n            return null\n    }\n}\n\n","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/viewMembers'\nimport { StoreState, ComponentLoadingState, MemberType, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n// export function loadStart(state: StoreState, action: actions.LoadStart) {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.LOADING,\n//                 viewModel: null,\n//                 error: null\n//             }\n//         }\n//     }\n// }\n\n// export function unload(state: StoreState, action: actions.Unload): StoreState {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.NONE,\n//                 viewModel: null,\n//                 error: null\n//             }\n//         }\n//     }\n// }\n\n// export function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.SUCCESS,\n//                 viewModel: {\n//                     organization: action.organization,\n//                     relation: action.relation\n//                 },\n//                 error: null\n//             }\n//         }\n//     }\n// }\n\n// export function loadError(state: StoreState, action: actions.LoadError): StoreState {\n//     return {\n//         ...state,\n//         views: {\n//             ...state.views,\n//             viewMembersView: {\n//                 ...state.views.viewMembersView,\n//                 loadingState: ComponentLoadingState.ERROR,\n//                 viewModel: null,\n//                 error: action.error\n//             }\n//         }\n//     }\n// }\n\nexport function promoteToAdminSuccess(state: StoreState, action: actions.PromoteToAdminSuccess): StoreState {\n\n    const {\n        views: { viewOrgView: { viewModel } }\n    } = state\n\n    if (viewModel === null) {\n        return state\n    }\n\n    // TODO: ugh, cut this off before getting here.\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n\n        if (member.username === action.memberUsername) {\n            return {\n                ...member,\n                type: MemberType.ADMIN\n            }\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...viewModel,\n                    organization: {\n                        ...viewModel.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function demoteToMemberSuccess(state: StoreState, action: actions.DemoteToMemberSuccess): StoreState {\n    const {\n        views: { viewOrgView: { viewModel } }\n    } = state\n\n    if (viewModel === null) {\n        return state\n    }\n\n    // TODO: ugh, cut this off before getting here.\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            return {\n                ...member,\n                type: MemberType.MEMBER\n            }\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...viewModel,\n                    organization: {\n                        ...viewModel.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\n\nexport function removeMemberSuccess(state: StoreState, action: actions.RemoveMemberSuccess): StoreState {\n    const {\n        views: { viewOrgView: { viewModel } }\n    } = state\n\n    if (viewModel === null) {\n        return state\n    }\n\n    // TODO: ugh, cut this off before getting here.\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.filter((member) => {\n        return (member.username !== action.memberUsername)\n    })\n\n    const sortedMembers = viewModel.members.filter((member) => {\n        return (member.username !== action.memberUsername)\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...viewModel,\n                    organization: {\n                        ...viewModel.organization,\n                        members: members\n                    },\n                    members: sortedMembers\n                }\n            }\n        }\n    }\n}\n\n\nexport function sortMembersSuccess(state: StoreState, action: actions.SortMembersSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    sortMembersBy: action.sortBy,\n                    members: action.members\n                }\n            }\n        }\n    }\n}\n\nexport function searchMembersSuccess(state: StoreState, action: actions.SearchMembersSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    searchMembersBy: action.searchBy,\n                    members: action.members\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        // case ActionFlag.VIEW_MEMBERS_LOAD_START:\n        //     return loadStart(state, action as actions.LoadStart)\n        // case ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS:\n        //     return loadSuccess(state, action as actions.LoadSuccess)\n        // case ActionFlag.VIEW_MEMBERS_LOAD_ERROR:\n        //     return loadError(state, action as actions.LoadError)\n        // case ActionFlag.VIEW_MEMBERS_UNLOAD:\n        //     return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:\n            return promoteToAdminSuccess(state, action as actions.PromoteToAdminSuccess)\n        case ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:\n            return demoteToMemberSuccess(state, action as actions.DemoteToMemberSuccess)\n        case ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS:\n            return removeMemberSuccess(state, action as actions.RemoveMemberSuccess)\n        case ActionFlag.VIEW_ORG_SORT_MEMBERS_SUCCESS:\n            return sortMembersSuccess(state, action as actions.SortMembersSuccess)\n        case ActionFlag.VIEW_ORG_SEARCH_MEMBERS_SUCCESS:\n            return searchMembersSuccess(state, action as actions.SearchMembersSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/denyInboxRequest'\nimport { StoreState, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n\nexport function rejectInboxRequestSuccess(state: StoreState, action: actions.RejectInboxRequestSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    requestInbox: action.requests\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS:\n            return rejectInboxRequestSuccess(state, action as actions.RejectInboxRequestSuccess)\n        default:\n            return null\n    }\n}\n\n","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/cancelOutboxRequest'\nimport { StoreState, ViewOrgViewModelKind } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\n\nexport function cancelRequestSuccess(state: StoreState, action: actions.CancelJoinRequestSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    requestOutbox: action.requests\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS:\n            return cancelRequestSuccess(state, action as actions.CancelJoinRequestSuccess)\n        default:\n            return null\n    }\n}\n\n","import { AppException } from \"../../types\";\nimport { string } from \"prop-types\";\n\nexport interface GroupsServiceInfo {\n    servname: string;\n    version: string;\n    servertime: number;\n    gitcommithash: string\n}\n\nexport type Username = string\nexport type GroupID = string\n\nexport interface Member {\n    name: Username,\n    joined: number,\n    lastvisit: number | null,\n    custom: {\n        title: string\n    }\n}\n\nexport interface Resource {\n    rid: string\n    added: number | null\n}\n\nexport interface WorkspaceInfo extends Resource {\n    name: string\n    narrname: string\n    narrcreate: number\n    public: boolean\n    perm: string\n    description: string\n    moddate: number\n}\n\nexport interface AppInfo extends Resource {\n}\n\nexport type Role = \"None\" | \"Member\" | \"Admin\" | \"Owner\"\n\nexport interface GroupCustomFields {\n    logourl?: string\n    description: string\n    researchinterests: string\n    homeurl?: string\n    relatedgroups?: string\n}\n\nexport interface BriefGroup {\n    id: GroupID\n    name: string\n    createdate: number\n    moddate: number\n    lastvisit: number | null\n    private: boolean\n    role: Role\n\n    custom: GroupCustomFields\n    // owner: Member\n    owner: Username\n\n    memcount: number\n    rescount: {\n        workspace: number\n    }\n}\n\nexport interface InaccessiblePrivateGroup {\n    id: GroupID\n    private: boolean\n    role: Role\n}\n\nexport interface Group {\n    id: GroupID\n    private: boolean\n    privatemembers: boolean\n    name: string\n    role: Role\n    owner: Member\n    admins: Array<Member>\n    members: Array<Member>\n    memcount: number\n    createdate: number\n    moddate: number\n    lastvisit: number\n    resources: {\n        workspace: Array<WorkspaceInfo>,\n        catalogmethod: Array<AppInfo>\n    }\n    rescount: {\n        workspace: number\n        catalogmethod: number\n    }\n    custom: GroupCustomFields\n}\n\nexport interface NewGroup {\n    id: string\n    name: string\n    logoUrl: string | null\n    homeUrl: string | null\n    researchInterests: string\n    description: string\n    isPrivate: boolean\n}\n\nexport interface GroupUpdate {\n    name: string\n    logoUrl: string | null\n    homeUrl: string | null\n    researchInterests: string\n    description: string\n    private: boolean\n}\n\nexport interface Request {\n    id: string\n    groupid: string\n    requester: Username\n    type: string\n    status: string\n    resource: string\n    resourcetype: string\n    createdate: number\n    expiredate: number\n    moddate: number\n}\n\nexport interface RequestWithCompletion extends Request {\n    complete: false\n}\n\nexport interface Completion {\n    complete: true\n}\n\nexport interface ErrorInfo {\n    appcode: number\n    apperror: string\n    callid: string\n    httpcode: number\n    httpstatus: string\n    message: string\n    time: number\n}\n\nexport interface ErrorResult {\n    error: ErrorInfo\n}\n\n// Error types: (appcode)\n// 10000\tAuthentication failed\n// 10010\tNo authentication token\n// 10020\tInvalid token\n// 20000\tUnauthorized\n// 30000\tMissing input parameter\n// 30001\tIllegal input parameter\n// 30010\tIllegal user name\n// 40000\tGroup already exists\n// 40010\tRequest already exists\n// 40020\tUser already group member\n// 40030\tWorkspace already in group\n// 50000\tNo such group\n// 50010\tNo such request\n// 50020\tNo such user\n// 50030\tNo such workspace\n// 60000\tUnsupported operation\n\nexport interface GroupExists {\n    exists: boolean\n}\n\n// export interface GroupRequest {\n//     id: string,\n//     groupid: string,\n//     requester: Username,\n//     type: string,\n//     status: string,\n//     resource: string\n//     resourcetype: string\n//     createdate: number,\n//     expiredate: number,\n//     moddate: number\n// }\n\nexport enum SortDirection {\n    ASCENDING = 0,\n    DESCENDING\n}\n\nexport interface GetRequestsParams {\n    includeClosed?: boolean,\n    sortDirection?: SortDirection,\n    startAt?: Date\n}\n\nexport interface RequestMemebershipParams {\n    groupId: string\n}\n\nexport interface RequestNarrativeParams {\n    workspaceId: number\n    groupId: string\n}\n\nfunction promiseTry<T>(fun: () => Promise<T>): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        try {\n            return resolve(fun())\n        } catch (ex) {\n            reject(ex)\n        }\n    })\n}\n\nexport interface GroupError {\n    httpcode: number\n    httpstatus: string\n    appcode: number\n    apperror: string\n    message: string\n    callid: string\n    time: number\n}\n\nexport class Exception extends Error {\n\n}\n\nexport class GroupException extends AppException {\n    originalError: GroupError\n    constructor(error: GroupError) {\n        super({\n            code: 'group-exception',\n            message: error.apperror,\n            detail: error.message,\n            info: new Map<string, any>([\n                ['httpcode', error.httpcode],\n                ['httpstatus', error.httpstatus],\n                ['appcode', error.appcode],\n                ['apperror', error.apperror],\n                ['message', error.message],\n                ['callid', error.callid],\n                ['time', error.time]\n            ])\n        })\n        this.name = 'GroupException'\n        this.originalError = error\n    }\n}\n\nexport interface RequestStatus {\n    new: 'None' | 'New' | 'Old'\n}\n\nexport class ServerException extends AppException {\n    constructor(detail: string) {\n        super({ code: 'server-exception', message: 'Server Exception', detail: detail })\n        this.name = 'ServerException'\n    }\n}\n\nexport class GroupsClient {\n    token: string;\n    url: string;\n\n    constructor({ token, url }: { token: string, url: string }) {\n        this.token = token\n        this.url = url\n    }\n\n    getInfo(): Promise<GroupsServiceInfo> {\n        return fetch(this.url + '/', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json();\n            })\n            .then((result) => {\n                return result as GroupsServiceInfo;\n            });\n    }\n\n    groupExists(id: string): Promise<GroupExists> {\n        return fetch(this.url + '/group/' + id + '/exists')\n            .then((response) => {\n                return response.json()\n            })\n            .then((exists) => {\n                return exists as GroupExists\n            })\n    }\n\n    // getGroups(): Promise<GroupList> {\n    //     return fetch(this.url + '/group', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json()\n    //         })\n    //         .then((result: GroupList) => {\n    //             return result.filter(({ type }) => type === 'Organization')\n    //         })\n    // }\n\n    async listGroups(): Promise<Array<BriefGroup>> {\n        return fetch(this.url + '/group', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    console.error('error fetching groups', response)\n                    throw new Error('Error fetching groups')\n                }\n                return response.json()\n            })\n    }\n\n\n    getGroups(): Promise<Array<Group | InaccessiblePrivateGroup>> {\n        return fetch(this.url + '/group', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    console.error('error fetching groups', response)\n                    throw new Error('Error fetching groups')\n                }\n                return response.json()\n            })\n            .then((result: Array<BriefGroup>) => {\n                return Promise.all(result.map((group) => (this.getGroupById(group.id))))\n            })\n            .then((result) => {\n                return result;\n            })\n    }\n\n    getGroupById(id: string): Promise<Group | InaccessiblePrivateGroup> {\n        return fetch(this.url + '/group/' + id, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status === 404) {\n                    return null\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Group\n            })\n    }\n\n    put<T>(path: Array<string>, body: any): Promise<T> {\n        const url = ([this.url].concat(path)).join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n            body: JSON.stringify(body)\n        })\n            .then((response) => {\n                if (response.status === 500) {\n                    switch (response.headers.get('Content-Type')) {\n                        case 'application/json':\n                            return response.json()\n                                .then((result) => {\n                                    throw new GroupException(result)\n                                })\n                        case 'text/plain':\n                            return response.text()\n                                .then((result) => {\n                                    throw new ServerException(result)\n                                })\n                        default:\n                            throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n                    }\n                } else if (response.status === 200) {\n                    return response.json()\n                        .then((result) => {\n                            return result as T\n                        })\n                } else if (response.status === 204) {\n                    const result = null as unknown\n                    return result as T\n                } else {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n            })\n    }\n\n    async post<T>(path: Array<string>, body: any): Promise<T | null> {\n        const url = ([this.url].concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST',\n            body: body ? JSON.stringify(body) : ''\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new GroupException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else if (response.status === 204) {\n            return null\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    async get<T>(path: Array<string>): Promise<T> {\n        const url = ([this.url].concat(path)).join('/')\n        const response = await fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n\n        if (response.status === 500) {\n            switch (response.headers.get('Content-Type')) {\n                case 'application/json':\n                    const result = await response.json()\n                    throw new GroupException(result)\n                case 'text/plain':\n                    const errorText = await response.text()\n                    throw new ServerException(errorText)\n                default:\n                    throw new Error('Unexpected content type: ' + response.headers.get('Content-Type'))\n            }\n        } else if (response.status === 200) {\n            return await response.json() as T\n        } else {\n            throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n        }\n    }\n\n    createGroup(newGroup: NewGroup): Promise<Group> {\n        // argh!! description should be mandatory, but now it is a custom \n        // field and it is not yet defined in the service.\n        // TODO: we need the groups service to have default custom fields.\n        // At that point, what IS the point of custom fields ... oh, I know that\n        // there are internal reasons for this due to re-using \"group\" for \n        // organization, project, etc., but that should not leak through the \n        // api.\n\n        // mandatory fields.\n        const payload: any = {\n            name: newGroup.name,\n            private: newGroup.isPrivate,\n            custom: {\n                logourl: newGroup.logoUrl,\n                researchinterests: newGroup.researchInterests,\n                homeurl: newGroup.homeUrl\n            }\n        }\n\n        // optional fields\n        if (newGroup.description.length > 0) {\n            payload.custom.description = newGroup.description\n        }\n\n        return this.put<Group>(['group', newGroup.id], payload)\n    }\n\n    updateGroup(id: string, groupUpdate: GroupUpdate): Promise<void> {\n        const payload: any = {\n            name: groupUpdate.name,\n            custom: {\n                logourl: groupUpdate.logoUrl,\n                homeurl: groupUpdate.homeUrl,\n                researchinterests: groupUpdate.researchInterests\n            },\n            private: groupUpdate.private\n        }\n        // TODO: remove this when we have descriptions restored to the\n        // groups service.\n        if (groupUpdate.description) {\n            payload.custom.description = groupUpdate.description\n        }\n        return fetch(this.url + '/group/' + id + '/update', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n\n            // TODO: build more intelligently\n            body: JSON.stringify(payload)\n        })\n            .then((response) => {\n                // response is an empty body.\n                if (response.status === 204) {\n                    return\n                }\n                throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n            })\n    }\n\n    async addRelatedGroup(groupId: GroupID, relatedGroupId: GroupID): Promise<string> {\n        // get the existing related groups\n        const group = await this.get<Group>(['group', groupId])\n\n        // split into list\n        let relatedGroups: Array<GroupID>\n        if (group.custom.relatedgroups) {\n            relatedGroups = group.custom.relatedgroups.split(',')\n        } else {\n            relatedGroups = []\n        }\n\n        // ensure that this one is not already there\n        if (relatedGroups.includes(relatedGroupId)) {\n            return relatedGroupId\n        }\n\n        // append it\n        relatedGroups.push(relatedGroupId)\n\n        // join back into string\n        const update = {\n            custom: {\n                relatedgroups: relatedGroups.join(',')\n            }\n        }\n\n        // save as the relatedgroups property\n        await this.put<void>(['group', groupId, 'update'], update)\n\n        return relatedGroupId\n    }\n\n    async removeRelatedGroup(groupId: GroupID, relatedGroupId: GroupID): Promise<string> {\n        // get the existing related groups\n        const group = await this.get<Group>(['group', groupId])\n\n        // split into list\n        let relatedGroups: Array<GroupID>\n        if (group.custom.relatedgroups) {\n            relatedGroups = group.custom.relatedgroups.split(',')\n        } else {\n            relatedGroups = []\n        }\n\n        // ensure that this one is already there\n        if (!relatedGroups.includes(relatedGroupId)) {\n            return relatedGroupId\n        }\n\n        // append it\n        relatedGroups.push(relatedGroupId)\n\n        const newRelatedGroups = relatedGroups.filter((groupId) => {\n            return groupId !== relatedGroupId\n        })\n\n        // join back into string\n        const update = {\n            custom: {\n                relatedgroups: newRelatedGroups.join(',')\n            }\n        }\n\n        // save as the relatedgroups property\n        await this.put<void>(['group', groupId, 'update'], update)\n\n        return relatedGroupId\n    }\n\n    async getRequest(requestId: string): Promise<Request> {\n        const path = ['request', 'id', requestId]\n        return await this.get<Request>(path)\n    }\n\n    getGroupRequests(groupId: string, params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n\n        return fetch(this.url + '/group/' + groupId + '/requests?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getTargetedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/targeted?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getCreatedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/created?' + query.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'appcliation/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    addOrRequestNarrative(params: RequestNarrativeParams): Promise<RequestWithCompletion | Completion> {\n        const url = [\n            this.url,\n            'group',\n            params.groupId,\n            'resource',\n            'workspace',\n            String(params.workspaceId)\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                if (result.complete === false) {\n                    return result as RequestWithCompletion\n                } else {\n                    return result as Completion\n                }\n\n            })\n    }\n\n    async grantResourceAccess(groupId: string, resourceType: string, resourceId: string): Promise<null> {\n        const path = [\n            'group',\n            groupId,\n            'resource',\n            resourceType,\n            resourceId,\n            'getperm'\n        ]\n        return this.post<null>(path, null)\n    }\n\n    deleteResource(groupId: string, resourceType: string, resourceId: string): Promise<void> {\n        const url = [\n            this.url,\n            'group',\n            groupId,\n            'resource',\n            resourceType,\n            resourceId\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n            })\n    }\n\n    cancelRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/cancel', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    acceptRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/accept', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    grantReadAccessToRequestedResource({ requestId }: { requestId: string }): Promise<null> {\n        const path = ['request', 'id', requestId, 'getperm']\n        return this.post<null>(path, null)\n    }\n\n\n    denyRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/deny', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    memberToAdmin({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    adminToMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    updateMember({ groupId, memberUsername, update }: { groupId: string, memberUsername: string, update: any }): Promise<void> {\n        const path = [\n            'group', groupId, 'user', memberUsername, 'update'\n        ]\n\n        return this.put<void>(path, { custom: update })\n    }\n\n    removeMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n            })\n    }\n\n    requestMembership(params: RequestMemebershipParams): Promise<Request> {\n        return fetch(this.url + '/group/' + params.groupId + '/requestmembership', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json',\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    inviteUserToGroup({ groupId, username }: { groupId: string, username: string }): Promise<Request> {\n        const url = [\n            this.url, 'group', groupId, 'user', username\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    async visitGroup({ groupId }: { groupId: string }): Promise<void> {\n        const path = ['group', groupId, 'visit']\n        return this.put<void>(path, null)\n    }\n\n    async getOpenRequests({ groupIds }: { groupIds: Array<string> }): Promise<Map<GroupID, RequestStatus>> {\n        const path = ['request', 'groups', groupIds.join(','), 'new']\n        const result = await this.get<any>(path)\n        const requestStatuses = new Map<GroupID, RequestStatus>()\n        for (const [groupId, requestStatus] of Object.entries(result)) {\n            requestStatuses.set(groupId, <RequestStatus>requestStatus)\n        }\n        return requestStatuses\n    }\n}","import * as groupsApi from '../apis/groups'\nimport * as orgModel from './organization/model'\n\nexport type Username = string\n\nexport type RequestID = string\n\nexport enum RequestType {\n    REQUEST = 0,\n    INVITATION\n}\n\nexport enum RequestResourceType {\n    USER = 0,\n    WORKSPACE,\n    APP\n}\n\nexport enum RequestStatus {\n    OPEN = 0,\n    CANCELED,\n    EXPIRED,\n    ACCEPTED,\n    DENIED\n}\n\nexport interface BaseRequest {\n    id: string\n    organizationId: string\n    requester: Username\n    type: RequestType\n    status: RequestStatus\n    resourceType: RequestResourceType\n    createdAt: Date\n    expireAt: Date\n    modifiedAt: Date\n}\n\nexport interface UserRequest extends BaseRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.REQUEST\n    user: Username\n}\n\nexport interface UserInvitation extends BaseRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.INVITATION\n    user: Username\n}\n\nexport interface WorkspaceRequest extends BaseRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.REQUEST\n    narrativeId: string,\n}\n\nexport interface WorkspaceInvitation extends BaseRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.INVITATION\n    narrativeId: string\n}\n\nexport interface AppRequest extends BaseRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.REQUEST\n    appId: string\n}\n\nexport interface AppInvitation extends BaseRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.INVITATION\n    appId: string\n}\n\nexport type Request = UserRequest | UserInvitation | WorkspaceRequest | WorkspaceInvitation | AppRequest | AppInvitation\n\n\nfunction stringToRequestType(type: string): RequestType {\n    switch (type) {\n        case 'Invite':\n            return RequestType.INVITATION\n        case 'Request':\n            return RequestType.REQUEST\n        default:\n            throw new Error('unknown request type: ' + type)\n    }\n}\n\nfunction stringToResourceType(type: string) {\n    switch (type) {\n        case 'user':\n            return RequestResourceType.USER\n        case 'workspace':\n            return RequestResourceType.WORKSPACE\n        case 'catalogmethod':\n            return RequestResourceType.APP\n        default:\n            throw new Error('unknown resource type: ' + type)\n    }\n}\n\nfunction stringToRequestStatus(status: string): RequestStatus {\n    return RequestStatus.OPEN\n}\n\nexport function groupRequestToOrgRequest(request: groupsApi.Request): Request {\n\n    const requestType = stringToRequestType(request.type)\n    const resourceType = stringToResourceType(request.resourcetype)\n    const requestStatus = stringToRequestStatus(request.status)\n\n    switch (resourceType) {\n        case RequestResourceType.USER:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    user: request.resource as Username,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as UserRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    user: request.resource as Username,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as UserInvitation\n            }\n\n        case RequestResourceType.WORKSPACE:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    narrativeId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as WorkspaceRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    narrativeId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as WorkspaceInvitation\n            }\n\n        case RequestResourceType.APP:\n            if (requestType === RequestType.REQUEST) {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    appId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as AppRequest\n            } else {\n                return {\n                    id: request.id,\n                    organizationId: request.groupid,\n                    resourceType: resourceType,\n                    requester: request.requester,\n                    type: requestType,\n                    status: requestStatus,\n                    appId: request.resource,\n                    createdAt: new Date(request.createdate),\n                    expireAt: new Date(request.expiredate),\n                    modifiedAt: new Date(request.moddate)\n                } as AppInvitation\n            }\n        default:\n            throw new Error('resource type not handled yet: ' + request.resourcetype)\n    }\n}\n\ninterface RequestsModelParams {\n    groupsServiceURL: string\n    token: string\n    username: Username\n}\n\nexport class RequestsModel {\n\n    params: RequestsModelParams\n    groupsClient: groupsApi.GroupsClient\n    cache: Map<RequestID, Request>\n\n    constructor(params: RequestsModelParams) {\n        this.params = params\n        this.groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        this.cache = new Map()\n    }\n\n    async getRequest(requestId: RequestID): Promise<Request> {\n        if (this.cache.has(requestId)) {\n            return this.cache.get(requestId)!\n        }\n\n        const grequest = await this.groupsClient.getRequest(requestId)\n        const request = groupRequestToOrgRequest(grequest)\n\n        this.cache.set(request.id, request)\n        return request\n    }\n\n    async getOutboundRequests(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getUserRequestForOrg(organizationId: orgModel.OrganizationID): Promise<UserRequest | null> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        const grequest = grequests.find((r) => {\n            return r.groupid === organizationId\n        })\n\n        if (!grequest) {\n            return null\n        }\n\n        return groupRequestToOrgRequest(grequest) as UserRequest\n    }\n\n    async getPendingRequestsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        return grequests\n            .filter((r) => {\n                return r.groupid === organizationId\n            })\n            .map((r) => {\n                return groupRequestToOrgRequest(r)\n            })\n    }\n\n    async getRequestInboxForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        return grequests\n            .filter((r) => {\n                return r.groupid === organizationId\n            })\n            .map((r) => {\n                return groupRequestToOrgRequest(r)\n            })\n    }\n\n    /*\n        For a given organization (by id), return a list of all requests to that org \n    */\n    async getCombinedRequestInboxForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        let requests: Array<Request>\n\n        // const grequests = await groupsClient.getTargetedRequests({\n        //     includeClosed: false,\n        //     sortDirection: groupsApi.SortDirection.DESCENDING\n        // })\n\n        // // TODO should work in synchrony with above...\n        // return grequests\n        //     .filter((r) => {\n        //         return r.groupid === organizationId\n        //     })\n        //     .map((r) => {\n        //         return groupRequestToOrgRequest(r)\n        //     })\n\n        try {\n            requests = (await groupsClient.getGroupRequests(organizationId, {\n                includeClosed: false,\n                sortDirection: groupsApi.SortDirection.DESCENDING\n            }))\n                .map((request) => {\n                    return groupRequestToOrgRequest(request)\n                })\n        } catch (ex) {\n            requests = []\n        }\n\n        return requests\n    }\n\n    async getRequestOutboxForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        return grequests\n            .filter((r) => {\n                return r.groupid === organizationId\n            })\n            .map((r) => {\n                return groupRequestToOrgRequest(r)\n            })\n    }\n\n\n    async getOrganizationInvitations(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getCreatedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        }).filter((request) => {\n            return (request.type === RequestType.INVITATION)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getOrganizationInvitationsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const invitations = await this.getOrganizationInvitations()\n        return invitations.filter((invitation) => {\n            return (invitation.organizationId === organizationId)\n        })\n    }\n\n    async getInboundRequests(): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        const requests = grequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        requests.forEach((request) => {\n            if (!this.cache.has(request.id)) {\n                this.cache.set(request.id, request)\n            }\n        })\n\n        return requests\n    }\n\n    async getUserInvitationForOrg(organizationId: orgModel.OrganizationID): Promise<UserInvitation | null> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const grequests = await groupsClient.getTargetedRequests({\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        // TODO should work in synchrony with above...\n        const grequest = grequests.find((r) => {\n            return (r.groupid === organizationId)\n        })\n\n        if (!grequest) {\n            return null\n        }\n\n        return groupRequestToOrgRequest(grequest) as UserInvitation\n    }\n\n    async getPendingOrganizationRequestsForOrg(organizationId: orgModel.OrganizationID): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const groupRequests = await groupsClient.getGroupRequests(organizationId, {\n            includeClosed: false,\n            sortDirection: groupsApi.SortDirection.DESCENDING\n        })\n\n        return groupRequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n\n        // const [groupRequests, adminRequests] = await Promise.all([\n        //     groupsClient.getGroupRequests(groupId, {\n        //         includeClosed: false,\n        //         sortDirection: groupsApi.SortDirection.DESCENDING\n        //     }),\n        //     groupsClient.getCreatedRequests({\n        //         includeClosed: false,\n        //         sortDirection: groupsApi.SortDirection.DESCENDING\n        //     })\n        // ])\n        // const groupAdminRequests = adminRequests.filter((request) => {\n        //     return (request.groupid === groupId)\n        // })\n\n        // return Promise.all(groupRequests.concat(groupAdminRequests).map((request) => {\n        //     return groupRequestToOrgRequest(request)\n        // }))\n    }\n\n    async getPendingOrganizationRequests(groupIds: Array<string>): Promise<Array<Request>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const groupRequests = await Promise.all(groupIds.map((groupId) => {\n            return groupsClient.getGroupRequests(groupId, {\n                includeClosed: false,\n                sortDirection: groupsApi.SortDirection.DESCENDING\n            })\n        }))\n\n        const allRequests = groupRequests.reduce((allRequests, requests) => {\n            return allRequests.concat(requests)\n        }, [])\n\n        return allRequests.map((request) => {\n            return groupRequestToOrgRequest(request)\n        })\n    }\n\n    async cancelRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.cancelRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async acceptRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.acceptRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async denyRequest(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.denyRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async acceptJoinInvitation(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.acceptRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async rejectJoinInvitation(requestId: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.denyRequest({\n            requestId\n        })\n        return groupRequestToOrgRequest(request)\n    }\n\n    async inviteUserToJoinOrg(groupId: string, username: string): Promise<Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.inviteUserToGroup({\n            groupId,\n            username\n        })\n            .then((request) => {\n                return groupRequestToOrgRequest(request)\n            })\n    }\n}","import * as groupsApi from '../../apis/groups'\nimport {\n    SortDirection, EditableOrganization, ValidationState, EditableString, ValidationErrorType\n} from '../../../types';\nimport * as requestModel from '../requests'\nimport * as userModel from '../user'\nimport Validation from './validation'\n\n// import Member from '../../../components/entities/Member';\n\n\nexport interface OrganizationUpdate {\n    name: string\n    logoUrl: string | null\n    description: string\n    isPrivate: boolean\n    homeUrl: string | null\n    researchInterests: string\n}\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\nexport interface EditableMemberProfile {\n    title: EditableString\n}\nexport enum UserRelationToOrganization {\n    NONE = 'NONE',\n    VIEW = 'VIEW',\n    MEMBER_REQUEST_PENDING = 'MEMBER_REQUEST_PENDING',\n    MEMBER_INVITATION_PENDING = 'MEMBER_INVITATION_PENDING',\n    MEMBER = 'MEMBER',\n    ADMIN = 'ADMIN',\n    OWNER = 'OWNER'\n}\n\nexport interface UserOrgRelation {\n    type: UserRelationToOrganization\n}\n\nexport interface NoRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.NONE\n}\n\nexport interface ViewRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.VIEW\n}\n\nexport interface MembershipRequestPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n    requestId: string\n}\n\nexport interface MembershipInvitationPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n    requestId: string\n}\n\nexport interface MemberRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER\n}\n\nexport interface AdminRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.ADMIN\n}\n\nexport interface OwnerRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.OWNER\n}\n\nexport type Relation = NoRelation | ViewRelation | MembershipRequestPendingRelation | MembershipInvitationPendingRelation | MemberRelation | AdminRelation | OwnerRelation\n\nexport type Username = string\n\nexport enum MemberType {\n    MEMBER = 0,\n    ADMIN,\n    OWNER\n}\nexport interface Member {\n    username: groupsApi.Username\n    joinedAt: Date\n    lastVisitedAt: Date | null\n    type: MemberType\n    title: string | null\n}\n\nexport interface MemberUpdate {\n    title?: string\n}\n\nexport enum UserWorkspacePermission {\n    NONE = 0,\n    VIEW,\n    EDIT,\n    ADMIN,\n    OWNER\n}\n\nexport type WorkspaceID = number\n\nexport interface NarrativeResource {\n    workspaceId: number\n    title: string\n    permission: UserWorkspacePermission\n    isPublic: boolean\n    createdAt: Date\n    updatedAt: Date\n    addedAt: Date | null\n    description: string\n}\n\nexport type AppID = string\n\nexport interface AppInfo {\n    appId: AppID\n}\n\nexport interface BriefOrganization {\n    id: string\n    name: string\n    logoUrl: string | null\n    isPrivate: boolean\n    homeUrl: string | null\n    researchInterests: string | null\n    // TODO: we need researchInterests here\n    owner: Member\n    relation: UserRelationToOrganization\n\n    isMember: boolean\n    isAdmin: boolean\n    isOwner: boolean\n\n    createdAt: Date\n    modifiedAt: Date\n    lastVisitedAt: Date | null\n\n    memberCount: number\n    narrativeCount: number\n    relatedOrganizations: Array<OrganizationID>\n}\n\nexport enum OrganizationKind {\n    NORMAL = 0,\n    INACCESSIBLE_PRIVATE\n}\n\nexport interface InaccessiblePrivateOrganization {\n    kind: OrganizationKind.INACCESSIBLE_PRIVATE\n    id: string\n    isPrivate: boolean\n    relation: UserRelationToOrganization\n}\n\nexport interface Organization {\n    kind: OrganizationKind.NORMAL\n    id: string\n    name: string\n\n    isPrivate: boolean\n    isMember: boolean\n    isAdmin: boolean\n    isOwner: boolean\n\n    relation: UserRelationToOrganization\n    logoUrl: string | null\n    homeUrl: string | null\n    researchInterests: string\n    description: string\n    owner: Member\n    areMembersPrivate: boolean\n    members: Array<Member>\n    // relation: UserOrgRelation\n    createdAt: Date\n    modifiedAt: Date\n    lastVisitedAt: Date | null\n    narratives: Array<NarrativeResource>\n    apps: Array<AppInfo>\n    memberCount: number\n    narrativeCount: number\n    appCount: number\n    relatedOrganizations: Array<OrganizationID>\n}\n\n// export interface RequestStatus {\n//     new: boolean,\n//     old: boolean\n// }\n\n// LEFT OF HERE - inapplicable should be set if the user is not an admin.\nexport enum RequestStatus {\n    INAPPLICABLE = 'INAPPLICABLE',\n    NONE = 'NONE',\n    OLD = 'OLD',\n    NEW = 'NEW'\n}\n\nexport function determineRelation(\n    org: Organization | InaccessiblePrivateOrganization,\n    username: userModel.Username,\n    request: requestModel.UserRequest | null,\n    invitation: requestModel.UserInvitation | null): Relation {\n\n    if (org.kind === OrganizationKind.INACCESSIBLE_PRIVATE) {\n        if (request && request.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                requestId: request.id\n            } as MembershipRequestPendingRelation\n        } else if (invitation && invitation.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                requestId: invitation.id\n            } as MembershipInvitationPendingRelation\n        } else {\n            return {\n                type: UserRelationToOrganization.NONE\n            } as NoRelation\n        }\n    }\n\n    if (username === org.owner.username) {\n        return {\n            type: UserRelationToOrganization.OWNER\n        } as OwnerRelation\n    } else {\n        const member = org.members.find((member) => {\n            return (member.username === username)\n        })\n        if (member) {\n            switch (member.type) {\n                case MemberType.MEMBER:\n                    return {\n                        type: UserRelationToOrganization.MEMBER\n                    } as MemberRelation\n                case MemberType.ADMIN:\n                    return {\n                        type: UserRelationToOrganization.ADMIN\n                    } as AdminRelation\n                case MemberType.OWNER:\n                    return {\n                        type: UserRelationToOrganization.OWNER\n                    } as OwnerRelation\n                default:\n                    return {\n                        type: UserRelationToOrganization.NONE\n                    } as NoRelation\n            }\n        } else if (request && request.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                requestId: request.id\n            } as MembershipRequestPendingRelation\n        } else if (invitation && invitation.user === username) {\n            return {\n                type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                requestId: invitation.id\n            } as MembershipInvitationPendingRelation\n        } else {\n            return {\n                type: UserRelationToOrganization.NONE\n            } as NoRelation\n        }\n    }\n}\n\nfunction groupPermissionToWorkspacePermission(groupsPermission: string): UserWorkspacePermission {\n    switch (groupsPermission) {\n        case 'None':\n            return UserWorkspacePermission.NONE\n        case 'Read':\n            return UserWorkspacePermission.VIEW\n        case 'Write':\n            return UserWorkspacePermission.EDIT\n        case 'Admin':\n            return UserWorkspacePermission.ADMIN\n        case 'Own':\n            return UserWorkspacePermission.OWNER\n        default:\n            throw new Error('Invalid groups user permission: ' + groupsPermission)\n    }\n}\n\nexport function groupToOrganization(group: groupsApi.Group, currentUser: Username): Organization {\n\n    const owner: Member = {\n        username: group.owner.name,\n        joinedAt: new Date(group.owner.joined),\n        lastVisitedAt: group.owner.lastvisit ? new Date(group.owner.lastvisit) : null,\n        type: MemberType.OWNER,\n        title: group.owner.custom.title\n    }\n\n    // We join admins and members, since they are all members, just different privileges in the org\n    const members = (<Array<Member>>[\n        // owner\n    ]).concat(group.admins.map((admin) => {\n        return {\n            username: admin.name,\n            joinedAt: new Date(admin.joined),\n            lastVisitedAt: admin.lastvisit ? new Date(admin.lastvisit) : null,\n            type: MemberType.ADMIN,\n            title: admin.custom.title\n        }\n    })).concat(group.members.map((member) => {\n        return {\n            username: member.name,\n            joinedAt: new Date(member.joined),\n            lastVisitedAt: member.lastvisit ? new Date(member.lastvisit) : null,\n            type: MemberType.MEMBER,\n            title: member.custom.title\n        }\n    }))\n\n    const narratives: Array<NarrativeResource> = group.resources.workspace.map((info) => {\n        return {\n            workspaceId: parseInt(info.rid, 10),\n            title: info.narrname,\n            isPublic: info.public,\n            permission: groupPermissionToWorkspacePermission(info.perm),\n            createdAt: new Date(info.narrcreate),\n            updatedAt: new Date(info.moddate),\n            description: info.description,\n            addedAt: info.added === null ? null : new Date(info.added)\n        }\n    })\n    const apps: Array<AppInfo> = []\n\n\n    return {\n        kind: OrganizationKind.NORMAL,\n        id: group.id,\n        name: group.name,\n        isPrivate: group.private,\n        isMember: (group.role !== \"None\"),\n        isAdmin: (group.role === \"Admin\" || group.role === \"Owner\"),\n        isOwner: (group.role === \"Owner\"),\n        relation: groupRoleToUserRelation(group.role),\n        logoUrl: group.custom.logourl || null,\n        homeUrl: group.custom.homeurl || null,\n        researchInterests: group.custom.researchinterests || '',\n        description: group.custom.description,\n        owner: owner,\n        areMembersPrivate: group.privatemembers,\n        members: members,\n        modifiedAt: new Date(group.moddate),\n        createdAt: new Date(group.createdate),\n        lastVisitedAt: group.lastvisit ? new Date(group.lastvisit) : null,\n        narratives: narratives,\n        apps: [],\n        memberCount: group.memcount,\n        narrativeCount: group.rescount.workspace || 0,\n        appCount: group.rescount.catalogmethod || 0,\n        relatedOrganizations: group.custom ? group.custom.relatedgroups ? group.custom.relatedgroups.split(',') : [] : []\n    }\n}\n\nexport function groupToPrivateOrganization(group: groupsApi.InaccessiblePrivateGroup, currentUser: Username): InaccessiblePrivateOrganization {\n    return {\n        kind: OrganizationKind.INACCESSIBLE_PRIVATE,\n        id: group.id,\n        isPrivate: group.private,\n        // isMember: false,\n        relation: groupRoleToUserRelation(group.role)\n    }\n}\n\n// export function determineRelation(group: Group, username: userModel.Username) {\n//     let relation: UserOrgRelation\n//     // TODO: when we have access to members, admins, and group publication status, we can \n//     // flesh out all user relations.\n//     // const orgMembers: Array<username> = this.membersAndAdminsToMembers(members, admins, profileMap)\n\n//     if (username === group.owner) {\n//         relation = {\n//             type: UserRelationToOrganization.OWNER\n//         } as OwnerRelation\n//     } else if (group.admins.indexOf(username) >= 0) {\n//         relation = {\n//             type: UserRelationToOrganization.ADMIN\n//         } as AdminRelation\n//     } else if (group.members.indexOf(username) >= 0) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER\n//         } as MemberRelation\n//     } else if (pendingRequests.has(group.id)) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n//             requestId: pendingRequests.get(group.id)!.id\n//         } as MembershipRequestPendingRelation\n//     } else if (pendingInvites.has(group.id)) {\n//         relation = {\n//             type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n//             requestId: pendingInvites.get(group.id)!.id\n//         } as MembershipInvitationPendingRelation\n//     } else {\n//         relation = {\n//             type: UserRelationToOrganization.VIEW\n//         } as ViewRelation\n//     }\n// }\n\nexport type GroupID = string\nexport type OrganizationID = GroupID\n\n\nexport interface ConstructorParams {\n    groupsServiceURL: string\n    token: string\n    username: groupsApi.Username\n}\n\nexport interface QueryResults {\n    organizations: Array<BriefOrganization>\n    total: number\n}\n\nexport interface Query {\n    searchTerms: Array<string>\n    username: groupsApi.Username\n    sortField: string\n    sortDirection: SortDirection\n    filter: Filter\n}\n\nexport function applySearch(orgs: Array<BriefOrganization>, searchTerms: Array<string>): Array<BriefOrganization> {\n    const searchTermsRe = searchTerms.map((term) => {\n        return new RegExp(term, 'i')\n    })\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTermsRe.every((termRe) => {\n            return termRe.test(org.name) ||\n                termRe.test(org.researchInterests || '') ||\n                termRe.test(org.owner.username)\n        })\n    })\n    return filteredOrgs\n}\n\nfunction dateDays(d: Date) {\n    const t = d.getTime()\n    return Math.round(t / (1000 * 60 * 60 * 24))\n}\n\nfunction applySortComparison(sortField: string, direction: number, a: BriefOrganization, b: BriefOrganization) {\n    switch (sortField) {\n        case 'created':\n            return direction * (dateDays(a.createdAt) - dateDays(b.createdAt))\n        case 'modified':\n        case 'changed':\n            return direction * (dateDays(a.modifiedAt) - dateDays(b.modifiedAt))\n        case 'name':\n            return direction * a.name.localeCompare(b.name)\n        case 'owner':\n            // TODO: after the dust settles for org -> brief org conversion,\n            // we may need to convert the owner to a member via profile...\n            return direction * a.owner.username.localeCompare(b.owner.username)\n        case 'narrativeCount':\n            return direction * (a.narrativeCount - b.narrativeCount)\n        case 'memberCount':\n            return direction * (a.memberCount - b.memberCount)\n        default:\n            console.warn('unimplemented sort field: ' + sortField)\n            return 0;\n    }\n}\n\nfunction applySort(organizations: Array<BriefOrganization>, sortField: string, sortDirection: SortDirection): Array<BriefOrganization> {\n    const direction = sortDirection === SortDirection.ASCENDING ? 1 : -1\n    return organizations.slice().sort((a, b) => {\n        return applySortComparison(sortField, direction, a, b) || applySortComparison('name', 1, a, b)\n    })\n}\n\nfunction groupRoleToUserRelation(role: groupsApi.Role): UserRelationToOrganization {\n    switch (role) {\n        case 'None': return UserRelationToOrganization.NONE\n        case 'Member': return UserRelationToOrganization.MEMBER\n        case 'Admin': return UserRelationToOrganization.ADMIN\n        case 'Owner': return UserRelationToOrganization.OWNER\n        default: throw new Error('Unknown role: ' + role)\n    }\n}\n\nexport interface Filter {\n    roleType: string,\n    roles: Array<string>,\n    privacy: string\n}\n\nfunction applyFilter(organizations: Array<BriefOrganization>, { roleType, roles, privacy }: Filter, username: groupsApi.Username): Array<BriefOrganization> {\n    function applyRoleType(org: BriefOrganization) {\n        switch (roleType) {\n            case 'myorgs':\n                return [\n                    UserRelationToOrganization.MEMBER,\n                    UserRelationToOrganization.ADMIN,\n                    UserRelationToOrganization.OWNER\n                ].includes(org.relation)\n            case 'notmyorgs':\n                return ![\n                    UserRelationToOrganization.MEMBER,\n                    UserRelationToOrganization.ADMIN,\n                    UserRelationToOrganization.OWNER\n                ].includes(org.relation)\n            case 'all':\n            default:\n                return true\n        }\n    }\n    function applyRole(org: BriefOrganization) {\n        if (roles.length === 0) {\n            return true\n        }\n        return roles.some((role) => {\n            switch (role) {\n                case 'member':\n                    return (org.relation === UserRelationToOrganization.MEMBER)\n                case 'admin':\n                    return (org.relation === UserRelationToOrganization.ADMIN)\n                case 'owner':\n                    return (org.relation === UserRelationToOrganization.OWNER)\n                default:\n                    return false\n            }\n        })\n    }\n    function applyPrivacy(org: BriefOrganization) {\n        switch (privacy) {\n            case 'public':\n                return !org.isPrivate\n            case 'private':\n                return org.isPrivate\n            case 'any':\n                return true\n            default:\n                return false\n        }\n    }\n    return organizations.filter((org) => {\n        return applyRoleType(org) && applyRole(org) && applyPrivacy(org)\n    })\n\n    // switch (filter) {\n    //     case 'role:all':\n    //         return organizations\n    //     case 'notMemberOf':\n    //         return organizations.filter((org) => {\n    //             return (org.relation === UserRelationToOrganization.NONE)\n    //         })\n    //     case 'memberOf':\n    //         return organizations.filter((org) => {\n    //             return (org.relation !== UserRelationToOrganization.NONE)\n    //         })\n    //     case 'role:member':\n    //         return organizations.filter((org) => {\n    //             return (org.relation === UserRelationToOrganization.MEMBER)\n    //         })\n    //     case 'role:myorgs':\n    //         return organizations.filter((org) => {\n    //             return [\n    //                 UserRelationToOrganization.MEMBER,\n    //                 UserRelationToOrganization.ADMIN,\n    //                 UserRelationToOrganization.OWNER\n    //             ].includes(org.relation)\n    //         })\n    //     case 'role:notmyorgs':\n    //         return organizations.filter((org) => {\n    //             return ![\n    //                 UserRelationToOrganization.MEMBER,\n    //                 UserRelationToOrganization.ADMIN,\n    //                 UserRelationToOrganization.OWNER\n    //             ].includes(org.relation)\n    //         })\n\n    //     case 'role:owner':\n    //         return organizations.filter((org) => (org.relation === UserRelationToOrganization.OWNER))\n    //     case 'role:notowner':\n    //         return organizations.filter((org) => (org.relation !== UserRelationToOrganization.OWNER))\n    //     case 'role:admin':\n    //         return organizations.filter((org) => (org.relation === UserRelationToOrganization.OWNER ||\n    //             org.relation === UserRelationToOrganization.ADMIN))\n    //     case 'privacy:private':\n    //         return organizations.filter((org) => {\n    //             return org.private\n    //         })\n    //     case 'privacy:public':\n    //         return organizations.filter((org) => {\n    //             return !org.private\n    //         })\n\n    //     // TODO: re-enable when have relation again...\n    //     // case 'pending':\n    //     //     return organizations.filter((org) => (\n    //     //         org.relation.type === UserRelationToOrganization.MEMBER_INVITATION_PENDING ||\n    //     //         org.relation.type === UserRelationToOrganization.MEMBER_REQUEST_PENDING\n    //     //     ))\n    //     // case 'groupPending':\n    //     //     return organizations.filter((org) => (\n    //     //         (org.relation.type === UserRelationToOrganization.ADMIN ||\n    //     //             org.relation.type === UserRelationToOrganization.OWNER) &&\n    //     //         (org.adminRequests && org.adminRequests.length > 0)\n    //     //     ))\n    //     default:\n    //         console.warn('unknown filter : ' + filter)\n    //         return organizations\n    // }\n}\n\n\n\n// Narrative Sort and Search\nfunction narrativeSortByToComparator(sortBy: string) {\n    switch (sortBy) {\n        case 'name':\n            return (a: NarrativeResource, b: NarrativeResource) => {\n                return a.title.localeCompare(b.title)\n            }\n        case 'updated':\n            return (a: NarrativeResource, b: NarrativeResource) => {\n                return b.updatedAt.getTime() - a.updatedAt.getTime()\n            }\n        default:\n        case 'added':\n            return (a: NarrativeResource, b: NarrativeResource) => {\n                if (a.addedAt === null) {\n                    if (b.addedAt === null) {\n                        return 0\n                    } else {\n                        // nulls sort to bottom\n                        return 1\n                    }\n                } else {\n                    if (b.addedAt === null) {\n                        return -1\n                    } else {\n                        return b.addedAt.getTime() - a.addedAt.getTime()\n                    }\n                }\n\n            }\n    }\n}\n\nexport function applyNarrativeSort(narratives: Array<NarrativeResource>, sortBy: string) {\n    if (!sortBy) {\n        return narratives\n    }\n    return narratives.slice().sort((a: NarrativeResource, b: NarrativeResource) => {\n        const c1 = narrativeSortByToComparator(sortBy)(a, b)\n        if (c1 === 0) {\n            if (sortBy !== 'name') {\n                return narrativeSortByToComparator('name')(a, b)\n            }\n        }\n        return c1\n    })\n}\n\nexport function applyNarrativeSearch(narratives: Array<NarrativeResource>, searchBy: string) {\n    const tokens = searchBy.split(/\\s+/).map((token) => {\n        return new RegExp(token, 'i')\n    })\n    if (tokens.length === 0) {\n        return narratives\n    }\n    return narratives.slice().filter((narrative: NarrativeResource) => {\n        return tokens.every((token: RegExp) => {\n            return (token.test(narrative.title))\n        })\n    })\n}\n\nexport interface NarrativeQuery {\n    searchBy: string\n    sortBy: string\n}\n\nexport function queryNarratives(narratives: Array<NarrativeResource>, query: NarrativeQuery) {\n    const searched = applyNarrativeSearch(narratives, query.searchBy)\n    const sorted = applyNarrativeSort(searched, query.sortBy)\n    return sorted\n}\n\n// Members Sort and Search\n\nfunction memberSortByToComparator(sortBy: string) {\n    switch (sortBy) {\n        case 'name':\n            // TODO: need to use user real name\n\n            return (a: Member, b: Member) => {\n                return a.username.localeCompare(b.username)\n            }\n        default:\n        case 'added':\n            return (a: Member, b: Member) => {\n                return b.joinedAt.getTime() - a.joinedAt.getTime()\n            }\n    }\n}\n\nexport function applyMembersSort(members: Array<Member>, sortBy: string) {\n    if (!sortBy) {\n        return members\n    }\n    return members.slice().sort((a: Member, b: Member) => {\n        const c1 = memberSortByToComparator(sortBy)(a, b)\n        if (c1 === 0) {\n            if (sortBy !== 'name') {\n                return memberSortByToComparator('name')(a, b)\n            }\n        }\n        return c1\n    })\n}\n\nexport function applyMembersSearch(members: Array<Member>, searchBy: string) {\n    const tokens = searchBy.split(/\\s+/).map((token) => {\n        return new RegExp(token, 'i')\n    })\n    if (tokens.length === 0) {\n        return members\n    }\n    return members.slice().filter((member: Member) => {\n        return tokens.every((token: RegExp) => {\n            return (token.test(member.username) ||\n                token.test(member.title || ''))\n        })\n    })\n}\n\nexport interface MembersQuery {\n    searchBy: string\n    sortBy: string\n}\n\nexport function queryMembers(members: Array<Member>, query: MembersQuery) {\n    const searched = applyMembersSearch(members, query.searchBy)\n    const sorted = applyMembersSort(searched, query.sortBy)\n    return sorted\n}\n\n// function getCustomField(group: groupsApi.Group | groupsApi.BriefGroup, name: string): string | null {\n//     if (!group.custom) {\n//         return null\n//     }\n//     if (name in group.custom) {\n//         return group.custom[name]\n//     }\n//     return null\n// }\n\nexport class OrganizationModel {\n\n    params: ConstructorParams\n    groupsClient: groupsApi.GroupsClient\n    // organizations: Map<OrganizationID, Organization | InaccessiblePrivateOrganization>\n\n    constructor(params: ConstructorParams) {\n        this.params = params\n        this.groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        // this.organizations = new Map<OrganizationID, Organization>()\n    }\n\n    async getOrg(id: OrganizationID): Promise<Organization | InaccessiblePrivateOrganization> {\n        return this.groupsClient.getGroupById(id)\n            .then((group) => {\n                if (group.role === \"None\" && group.private) {\n                    return groupToPrivateOrganization(group as groupsApi.InaccessiblePrivateGroup, this.params.username)\n                } else {\n                    return groupToOrganization(group as groupsApi.Group, this.params.username)\n                }\n            })\n    }\n\n    async getOrganization(id: OrganizationID): Promise<Organization> {\n        const group = await this.groupsClient.getGroupById(id)\n        if (group.role === \"None\" && group.private) {\n            throw new Error('Inaccessible Organization')\n        }\n        return groupToOrganization(group as groupsApi.Group, this.params.username)\n    }\n\n    async getOrgs(ids: Array<OrganizationID>): Promise<Array<Organization | InaccessiblePrivateOrganization>> {\n        return Promise.all(ids.map((id) => {\n            return this.getOrg(id)\n        }))\n    }\n\n    async getAllOrgs(): Promise<Array<Organization | InaccessiblePrivateOrganization>> {\n        const groups = await this.groupsClient.getGroups()\n        const ids = groups.map((group) => {\n            return group.id\n        })\n        return this.getOrgs(ids)\n    }\n\n    async getOwnOrgs(): Promise<Array<BriefOrganization>> {\n        const orgs = await this.getAllOrgs2()\n\n        const ownOrgs = orgs\n            .filter((org: BriefOrganization) => {\n                // ensure that user has some relationship to the org:\n                // member, admin, or owner\n                return (org.relation !== UserRelationToOrganization.NONE)\n            })\n\n        return ownOrgs\n    }\n\n    listGroupToBriefOrganization(group: groupsApi.BriefGroup): BriefOrganization {\n        return {\n            id: group.id,\n            name: group.name,\n            logoUrl: group.custom.logourl || null,\n            isPrivate: group.private,\n            homeUrl: group.custom.homeurl || null,\n            researchInterests: group.custom.researchinterests || null,\n            owner: {\n                username: group.owner,\n                lastVisitedAt: null,\n                type: MemberType.OWNER,\n                joinedAt: new Date(group.createdate),\n                title: 'Owner'\n            },\n\n            // owner: {\n            //     username: group.owner.name,\n            //     lastVisitedAt: group.owner.lastvisit ? new Date(group.owner.lastvisit) : null,\n            //     type: MemberType.OWNER,\n            //     joinedAt: new Date(group.owner.joined),\n            //     title: group.owner.custom ? group.owner.custom.title : null\n            // },\n            // fix these...\n            relation: groupRoleToUserRelation(group.role),\n            isMember: (group.role !== \"None\"),\n            isAdmin: (group.role === \"Admin\" || group.role === \"Owner\"),\n            isOwner: (group.role === \"Owner\"),\n            createdAt: new Date(group.createdate),\n            modifiedAt: new Date(group.moddate),\n            lastVisitedAt: group.lastvisit ? new Date(group.lastvisit) : null,\n            memberCount: group.memcount || 0,\n            narrativeCount: group.rescount.workspace || 0,\n            relatedOrganizations: group.custom ? group.custom.relatedgroups ? group.custom.relatedgroups.split(',') : [] : []\n        }\n    }\n\n    async getAllOrgs2(): Promise<Array<BriefOrganization>> {\n        const groups = await this.groupsClient.listGroups()\n        return groups.map((group) => {\n            return this.listGroupToBriefOrganization(group)\n        })\n    }\n\n    async queryOrgs(query: Query): Promise<QueryResults> {\n        // const orgs = await this.getAllOrgs()\n        const orgs = await this.getAllOrgs2()\n\n        const filtered = applyFilter(orgs, query.filter, query.username)\n        const searched = applySearch(filtered, query.searchTerms)\n        const sorted = applySort(searched, query.sortField, query.sortDirection)\n\n        return {\n            organizations: sorted,\n            total: orgs.length\n        }\n    }\n\n    async ownOrgs(username: groupsApi.Username): Promise<QueryResults> {\n        const orgs = await this.getAllOrgs2()\n        const ownOrgs = orgs.filter((org: BriefOrganization) => {\n            return (org.relation !== UserRelationToOrganization.NONE)\n        })\n\n        return {\n            organizations: ownOrgs,\n            total: ownOrgs.length\n        }\n    }\n\n    async grantViewAccess(requestId: string): Promise<requestModel.Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        await groupsClient.grantReadAccessToRequestedResource({ requestId })\n        const req = await groupsClient.getRequest(requestId)\n        return requestModel.groupRequestToOrgRequest(req)\n    }\n\n    async addOrg(newOrg: EditableOrganization, username: groupsApi.Username): Promise<Organization> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n        if ((newOrg.id.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.name.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.logoUrl.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.description.validationState.type !== ValidationErrorType.OK) ||\n            (newOrg.isPrivate.validationState.type !== ValidationErrorType.OK)\n        ) {\n            return Promise.reject(new Error('One or more fields are invalid'))\n        }\n\n        return groupsClient.createGroup({\n            id: newOrg.id.value,\n            name: newOrg.name.value,\n            logoUrl: newOrg.logoUrl.value,\n            homeUrl: newOrg.homeUrl.value,\n            researchInterests: newOrg.researchInterests.value,\n            description: newOrg.description.value,\n            isPrivate: newOrg.isPrivate.value\n        })\n            .then((group) => {\n                return groupToOrganization(group, username)\n            })\n    }\n\n    async orgExists(id: string): Promise<boolean> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.groupExists(id)\n            .then(({ exists }) => {\n                return exists\n            })\n    }\n\n    async updateOrg(id: string, orgUpdate: OrganizationUpdate): Promise<void> {\n\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n\n\n        return groupsClient.updateGroup(id, {\n            name: orgUpdate.name,\n            logoUrl: orgUpdate.logoUrl,\n            homeUrl: orgUpdate.homeUrl,\n            researchInterests: orgUpdate.researchInterests,\n            description: orgUpdate.description,\n            private: orgUpdate.isPrivate\n        })\n    }\n\n    validateOrgId(id: string): [string, ValidationState] {\n        return Validation.validateOrgId(id);\n    }\n\n    validateOrgName(name: string): [string, ValidationState] {\n        return Validation.validateOrgName(name)\n    }\n\n    validateOrgDescription(description: string): [string, ValidationState] {\n        return Validation.validateOrgDescription(description);\n    }\n\n    async removeNarrativeFromOrg(organizationId: OrganizationID, workspaceId: number): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.deleteResource(\n            organizationId,\n            'workspace',\n            String(workspaceId)\n        )\n    }\n\n    async grantNarrativeAccess(groupId: string, resourceId: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        await groupsClient.grantResourceAccess(groupId, 'workspace', resourceId)\n    }\n\n    async requestMembership(id: string): Promise<requestModel.Request> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.requestMembership({\n            groupId: id\n        })\n        return requestModel.groupRequestToOrgRequest(request)\n    }\n\n    async addOrRequestNarrativeToGroup(groupId: string, workspaceId: WorkspaceID): Promise<requestModel.Request | boolean> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        const request = await groupsClient.addOrRequestNarrative({\n            groupId: groupId,\n            workspaceId: workspaceId\n        })\n        if (request.complete === true) {\n            return true\n        } else {\n            return requestModel.groupRequestToOrgRequest(request)\n        }\n    }\n\n    async memberToAdmin(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.memberToAdmin({\n            groupId,\n            member\n        })\n    }\n\n    async adminToMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.adminToMember({\n            groupId,\n            member\n        })\n    }\n    async removeMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.removeMember({\n            groupId,\n            member\n        })\n    }\n\n    async updateMember(groupId: string, memberUsername: string, update: MemberUpdate) {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.updateMember({ groupId, memberUsername, update })\n    }\n\n    async visitOrg({ organizationId }: { organizationId: string }): Promise<void> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.visitGroup({ groupId: organizationId })\n    }\n\n    async getOpenRequestsStatus({ organizationIds }: { organizationIds: Array<OrganizationID> }): Promise<Map<OrganizationID, RequestStatus>> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        const openRequests = await groupsClient.getOpenRequests({ groupIds: organizationIds })\n        const result = new Map<OrganizationID, RequestStatus>()\n        for (const [groupId, status] of openRequests.entries()) {\n            const requestStatus: RequestStatus = stringToRequestStatus(status)\n            result.set(<OrganizationID>groupId, requestStatus)\n        }\n        return result\n    }\n\n    async getOpenRequestStatus({ organizationId }: { organizationId: OrganizationID }): Promise<RequestStatus> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        const openRequests = await groupsClient.getOpenRequests({ groupIds: [organizationId] })\n        for (const [groupId, status] of openRequests.entries()) {\n            return stringToRequestStatus(status)\n        }\n        throw new Error('expected request status, got none')\n    }\n\n    async addRelatedOrganization({ organizationId, relatedOrganizationId }: { organizationId: OrganizationID, relatedOrganizationId: OrganizationID }): Promise<OrganizationID> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return await groupsClient.addRelatedGroup(organizationId, relatedOrganizationId)\n    }\n\n    async removeRelatedOrganization({ organizationId, relatedOrganizationId }: { organizationId: OrganizationID, relatedOrganizationId: OrganizationID }): Promise<OrganizationID> {\n        const groupsClient = new groupsApi.GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return await groupsClient.removeRelatedGroup(organizationId, relatedOrganizationId)\n    }\n}\n\nfunction stringToRequestStatus(status: groupsApi.RequestStatus): RequestStatus {\n    switch (status.new) {\n        case 'None': return RequestStatus.NONE\n        case 'Old': return RequestStatus.OLD\n        case 'New': return RequestStatus.NEW\n        default: throw new Error('Invalid open request status: ' + status)\n    }\n}\n\nexport function userPermissionToWorkspacePermission(userPermission: string, isOwner: boolean) {\n    if (isOwner) {\n        return UserWorkspacePermission.OWNER\n    }\n    switch (userPermission) {\n        case 'r':\n            return UserWorkspacePermission.VIEW\n        case 'w':\n            return UserWorkspacePermission.EDIT\n        case 'a':\n            return UserWorkspacePermission.ADMIN\n        default:\n            throw new Error('Invalid workspace user permission: ' + userPermission)\n    }\n}","import { ValidationState, ValidationErrorType } from \"../../../types\"\n\nexport default class Validation {\n    static nonPrintableRe = /[\\000-\\031]/\n\n    static testNonPrintableCharacters(s: string) {\n        const firstNonPrintable = s.search(Validation.nonPrintableRe)\n        if (firstNonPrintable === -1) {\n            return false\n        }\n        const beforeStart = firstNonPrintable - 5 < 0 ? 0 : firstNonPrintable - 5\n        const before = s.slice(beforeStart, firstNonPrintable)\n        const after = s.slice(firstNonPrintable + 1, firstNonPrintable + 6)\n        return `Non-printable character at position ${firstNonPrintable}: \"${before}___${after}`\n    }\n\n    static validateOrgId(id: string): [string, ValidationState] {\n        // May not be empty\n        if (id.length === 0) {\n            return [\n                id, {\n                    type: ValidationErrorType.REQUIRED_MISSING,\n                    message: 'Organization id may not be empty',\n                    validatedAt: new Date()\n                }]\n        }\n        // No spaces\n        if (id.match(/\\s/)) {\n            return [\n                id, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization id may not contain a space',\n                    validatedAt: new Date()\n                }]\n        }\n        // May not exceed maximum size\n        // todo: what is the real limit?\n        if (id.length > 100) {\n            return [\n                id, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization id may not be longer than 100 characters',\n                    validatedAt: new Date()\n                }]\n        }\n\n        // May only consist if lower case alphanumeric\n        const alphaRe = /^[a-z0-9-]+$/\n        if (!id.match(alphaRe)) {\n            return [\n                id, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash \"-\"',\n                    validatedAt: new Date()\n                }\n            ]\n        }\n\n        return [id, {\n            type: ValidationErrorType.OK,\n            validatedAt: new Date()\n        }]\n    }\n\n    static validateOrgName(name: string): [string, ValidationState] {\n        if (name.length === 0) {\n            return [\n                name, {\n                    type: ValidationErrorType.REQUIRED_MISSING,\n                    message: 'Organization name may not be empty',\n                    validatedAt: new Date()\n                }]\n        }\n        if (name.length > 256) {\n            return [\n                name, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization name may not be longer than 256 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            name, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    static validateOrgLogoUrl(logoUrl: string | null): [string | null, ValidationState] {\n        if (logoUrl === null || logoUrl === '') {\n            return [\n                logoUrl, {\n                    type: ValidationErrorType.OK,\n                    validatedAt: new Date()\n                }\n            ]\n        }\n        if (logoUrl.length > 1000) {\n            return [\n                logoUrl, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Logo url may not be longer than 1000 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        try {\n            const url = new URL(logoUrl)\n            if (!url.protocol.match(/^http[s]?:$/)) {\n                return [\n                    logoUrl, {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Error parsing url: ' + url.protocol + ' is not a valid protocol',\n                        validatedAt: new Date()\n                    }]\n            }\n            if (!url.protocol.match(/^https:$/)) {\n                return [\n                    logoUrl, {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Only https (secure) urls are supported',\n                        validatedAt: new Date()\n                    }]\n            }\n        } catch (ex) {\n            return [\n                logoUrl, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Error parsing url: ' + ex.message,\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            logoUrl, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    static validateOrgHomeUrl(homeUrl: string | null): [string | null, ValidationState] {\n        if (homeUrl === null || homeUrl === '') {\n            return [\n                homeUrl, {\n                    type: ValidationErrorType.OK,\n                    validatedAt: new Date()\n                }\n            ]\n        }\n        if (homeUrl.length > 1000) {\n            return [\n                homeUrl, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Home url may not be longer than 1000 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        try {\n            const url = new URL(homeUrl)\n            if (!url.protocol.match(/^http[s]?:$/)) {\n                return [\n                    homeUrl, {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Error parsing url: ' + url.protocol + ' is not a valid protocol',\n                        validatedAt: new Date()\n                    }]\n            }\n            if (!url.protocol.match(/^https:$/)) {\n                return [\n                    homeUrl, {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Only https (secure) urls are supported',\n                        validatedAt: new Date()\n                    }]\n            }\n        } catch (ex) {\n            return [\n                homeUrl, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Error parsing url: ' + ex.message,\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            homeUrl, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    static validateOrgResearchInterests(researchInterests: string): [string, ValidationState] {\n        console.log('validating research interests', researchInterests, researchInterests === null, researchInterests === '')\n        if (researchInterests.length === 0) {\n            return [\n                name, {\n                    type: ValidationErrorType.REQUIRED_MISSING,\n                    message: 'Research Interests may not be empty',\n                    validatedAt: new Date()\n                }]\n        }\n\n        if (researchInterests.length > 280) {\n            return [\n                researchInterests, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Research Interests may not be longer than 280 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            researchInterests, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n\n    static validateOrgDescription(description: string): [string, ValidationState] {\n        console.log('validating description', description, description === null, description === '')\n        if (description.length === 0) {\n            // return [name, {\n            //     type: ValidationErrorType.OK,\n            //     validatedAt: new Date()\n            // }]\n            return [name, {\n                type: ValidationErrorType.ERROR,\n                message: 'Organization description may not be empty',\n                validatedAt: new Date()\n            }]\n        }\n        // TODO: Is there really a limit?\n        // const nonPrintable = Validation.testNonPrintableCharacters(description)\n        // if (nonPrintable) {\n        //     return [\n        //         description, {\n        //             type: UIErrorType.ERROR,\n        //             message: nonPrintable\n        //         }\n        //     ]\n        // }\n        if (description.length > 4096) {\n            return [\n                description, {\n                    type: ValidationErrorType.ERROR,\n                    message: 'Organization description may not be longer than 4,096 characters',\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            description, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }\n        ]\n    }\n\n    static validateMemberTitle(title: string): [string, ValidationState] {\n        const maxTitleLength = 100\n        if (title.length > maxTitleLength) {\n            return [\n                title, {\n                    type: ValidationErrorType.ERROR,\n                    message: `member title may not be longer than ${maxTitleLength} characters`,\n                    validatedAt: new Date()\n                }]\n        }\n        return [\n            title, {\n                type: ValidationErrorType.OK,\n                validatedAt: new Date()\n            }]\n    }\n}","import uuid from 'uuid/v4'\n\nexport interface AnError {\n    code: string\n    message: string\n    id: string\n    at: Date\n\n\n    detail?: string\n    history?: Array<AnError>\n    trace?: Array<string>\n    info?: any\n}\n\nexport function makeError(\n    { code, message, detail, history, trace, info }:\n        {\n            code: string, message: string,\n            detail?: string,\n            history?: Array<AnError>, trace?: Array<string>, info?: any\n        }\n) {\n    return {\n        code, message, detail,\n        id: uuid(),\n        at: new Date(),\n        history, trace, info\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from '../index'\nimport { AnError } from '../../../lib/error'\nimport { StoreState, ViewOrgViewModelKind, SelectableRelatableOrganization } from '../../../types'\nimport * as orgModel from '../../../data/models/organization/model'\nimport { makeError } from '../../../combo/error/api'\n\nexport interface Load extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD\n}\n\nexport interface LoadStart extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START\n}\n\nexport interface LoadSuccess extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS,\n    organizations: Array<SelectableRelatableOrganization>\n}\n\nexport interface LoadError extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR\n    error: AnError\n}\n\nexport interface Unload extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD\n}\n\nexport function load() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START\n        } as LoadStart)\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            throw new Error('view is not normal')\n        }\n        const { organization } = viewModel\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const orgs = await orgClient.getAllOrgs2()\n            const selectableOrgs = orgs.map((org) => {\n                const isRelated = organization.relatedOrganizations.includes(org.id)\n                return {\n                    isRelated: isRelated,\n                    isSelected: false,\n                    organization: org\n                } as SelectableRelatableOrganization\n            })\n            dispatch({\n                type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS,\n                organizations: selectableOrgs\n            })\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD\n    }\n}\n\nexport interface SelectOrganization extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION,\n    selectedOrganization: SelectableRelatableOrganization\n}\n\nexport function selectOrganization(org: SelectableRelatableOrganization): SelectOrganization {\n    return {\n        type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION,\n        selectedOrganization: org\n    }\n}\n\n// Add Org\n\nexport interface AddOrganization extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface AddOrganizationStart extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START\n}\n\nexport interface AddOrganizationSuccess extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface AddOrganizationError extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,\n    error: AnError\n}\n\nexport function addOrganization(organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START\n        } as AddOrganizationStart)\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        try {\n            await orgClient.addRelatedOrganization({ organizationId, relatedOrganizationId })\n            dispatch({\n                type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,\n                organizationId: relatedOrganizationId\n            })\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n    }\n}\n\n// Remove Org\n\nexport interface RemoveOrganization extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface RemoveOrganizationStart extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START\n}\n\nexport interface RemoveOrganizationSuccess extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface RemoveOrganizationError extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,\n    error: AnError\n}\n\nexport function removeOrganization(organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START\n        } as RemoveOrganizationStart)\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        try {\n            await orgClient.removeRelatedOrganization({ organizationId, relatedOrganizationId })\n            dispatch({\n                type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,\n                organizationId: relatedOrganizationId\n            } as RemoveOrganizationSuccess)\n            // dispatch(viewOrgActions.reload(organizationId))\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n    }\n}\n\n// Search Orgs\n\nexport interface Search extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH,\n    query: string\n}\n\nexport interface SearchStart extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START\n}\n\nexport interface SearchSuccess extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS,\n    organizations: Array<SelectableRelatableOrganization>\n    searchBy: string\n}\n\nexport interface SearchError extends Action<ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR> {\n    type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR,\n    error: AnError\n}\n\nexport function applyQuery(orgs: Array<SelectableRelatableOrganization>, query: string) {\n    const searchExp = query.split(/\\s+/).map((term) => {\n        return new RegExp(term, 'i')\n    })\n\n    return orgs.filter(({ organization }) => {\n        return searchExp.every((re) => {\n            return (\n                re.test(organization.name) ||\n                // TODO: realname\n                re.test(organization.owner.username)\n            )\n        })\n    })\n}\n\nexport function search(query: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START\n        } as SearchStart)\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            throw new Error('view is not normal')\n        }\n\n        const vm = viewModel.subViews.manageRelatedOrganizationsView.viewModel\n        if (vm === null) {\n            throw new Error('vm is null')\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        try {\n            const availableOrgs = applyQuery(vm.availableOrganizations.organizations, query)\n\n            dispatch({\n                type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS,\n                organizations: availableOrgs,\n                searchBy: query\n            } as SearchSuccess)\n            // dispatch(viewOrgActions.reload(organizationId))\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n    }\n}","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/manageRelatedOrganizations'\nimport { StoreState, ViewOrgViewModelKind, ViewOrgSubViewKind, ViewState, SelectableRelatableOrganization } from '../../../types';\nimport { ActionFlag } from '../../actions';\nimport { OrganizationModel } from '../../../data/models/organization/model';\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        manageRelatedOrganizationsView: {\n                            state: ViewState.OK,\n                            error: null,\n                            viewModel: {\n                                kind: ViewOrgSubViewKind.MANAGE_RELATED_ORGS,\n                                relatedOrganizations: state.views.viewOrgView.viewModel.organization.relatedOrganizations,\n                                organization: state.views.viewOrgView.viewModel.organization,\n                                availableOrganizations: {\n                                    organizations: action.organizations,\n                                    queried: action.organizations,\n                                    searchBy: ''\n                                },\n                                selectedOrganization: null\n                            }\n                        }\n\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        manageRelatedOrganizationsView: {\n                            state: ViewState.NONE,\n                            error: null,\n                            viewModel: null\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function selectOrganization(state: StoreState, action: actions.SelectOrganization): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel === null) {\n        return state\n    }\n    const availableOrgs = state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations;\n\n    const organizations = availableOrgs.organizations.map((relatedOrg: SelectableRelatableOrganization) => {\n        if (relatedOrg.organization.id === action.selectedOrganization.organization.id) {\n            relatedOrg.isSelected = true\n        } else {\n            relatedOrg.isSelected = false\n        }\n        return relatedOrg\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        manageRelatedOrganizationsView: {\n                            ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,\n                            viewModel: {\n                                ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,\n                                selectedOrganization: action.selectedOrganization,\n                                availableOrganizations: {\n                                    organizations: organizations,\n                                    queried: actions.applyQuery(organizations, availableOrgs.searchBy),\n                                    searchBy: availableOrgs.searchBy\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrganization(state: StoreState, action: actions.AddOrganizationSuccess): StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel === null) {\n        return state\n    }\n    const availableOrgs = state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations\n    const newRelatedOrgs = state.views.viewOrgView.viewModel.organization.relatedOrganizations.concat([action.organizationId])\n\n    const newAvailableOrgs = availableOrgs.organizations.map((relatedOrg: SelectableRelatableOrganization) => {\n        if (newRelatedOrgs.includes(relatedOrg.organization.id)) {\n            relatedOrg.isRelated = true\n        } else {\n            relatedOrg.isRelated = false\n        }\n        return relatedOrg\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: {\n                        ...state.views.viewOrgView.viewModel.organization,\n                        relatedOrganizations: newRelatedOrgs\n                    },\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        manageRelatedOrganizationsView: {\n                            ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,\n                            viewModel: {\n                                ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,\n                                availableOrganizations: {\n                                    organizations: newAvailableOrgs,\n                                    queried: actions.applyQuery(newAvailableOrgs, availableOrgs.searchBy),\n                                    searchBy: availableOrgs.searchBy\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function removeOrganization(state: StoreState, action: actions.RemoveOrganizationSuccess): StoreState {\n\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    if (state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel === null) {\n        return state\n    }\n\n    // Remove from the related orgs\n    const relatedOrgs = state.views.viewOrgView.viewModel.organization.relatedOrganizations.filter((organizationId: string) => {\n        return (organizationId !== action.organizationId)\n    })\n\n    const availableOrgs = state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations\n\n    // Update the related status of the org in the management interface.\n    const newAvailableOrgs = availableOrgs.organizations.filter((relatedOrg: SelectableRelatableOrganization) => {\n        if (relatedOrg.organization.id === action.organizationId) {\n            relatedOrg.isRelated = false\n        }\n        return relatedOrg\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: {\n                        ...state.views.viewOrgView.viewModel.organization,\n                        relatedOrganizations: relatedOrgs\n                    },\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        manageRelatedOrganizationsView: {\n                            ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,\n                            viewModel: {\n                                ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,\n                                availableOrganizations: {\n                                    organizations: newAvailableOrgs,\n                                    queried: actions.applyQuery(newAvailableOrgs, availableOrgs.searchBy),\n                                    searchBy: availableOrgs.searchBy\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n\nexport function searchSuccess(state: StoreState, action: actions.SearchSuccess): StoreState {\n\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    if (state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel === null) {\n        return state\n    }\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        manageRelatedOrganizationsView: {\n                            ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,\n                            viewModel: {\n                                ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,\n                                availableOrganizations: {\n                                    ...state.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,\n                                    queried: action.organizations,\n                                    searchBy: action.searchBy\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION:\n            return selectOrganization(state, action as actions.SelectOrganization)\n        case ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS:\n            return addOrganization(state, action as actions.AddOrganizationSuccess)\n        case ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:\n            return removeOrganization(state, action as actions.RemoveOrganizationSuccess)\n        case ActionFlag.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS:\n            return searchSuccess(state, action as actions.SearchSuccess)\n        default:\n            return null\n    }\n}\n","import * as actions from '../../actions/viewOrganization/relatedOrganizations'\nimport { StoreState, ViewOrgViewModelKind } from '../../../types'\nimport { Action } from 'redux'\nimport { ActionFlag } from '../../actions'\n\nexport function removeOrganization(state: StoreState, action: actions.RemoveOrganization): StoreState {\n\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n\n    const relatedOrgs = state.views.viewOrgView.viewModel.organization.relatedOrganizations.filter((organizationId: string) => {\n        return (organizationId !== action.organizationId)\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: {\n                        ...state.views.viewOrgView.viewModel.organization,\n                        relatedOrganizations: relatedOrgs\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:\n            return removeOrganization(state, action as actions.RemoveOrganization)\n        default:\n            return null\n    }\n}\n","import { Action } from 'redux'\nimport * as actions from '../actions/viewOrg'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport acceptInboxRequest from './viewOrganization/acceptInboxRequest'\nimport viewMembers from './viewOrganization/viewMembers'\nimport denyInboxRequest from './viewOrganization/denyInboxRequest'\nimport cancelOutboxRequest from './viewOrganization/cancelOutboxRequests'\nimport manageRelatedOrganizations from './viewOrganization/manageRelatedOrganizations'\nimport relatedOrganizations from './viewOrganization/relatedOrganizations'\nimport requestAddNarrative from './viewOrganization/requestAddNarrative'\n\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadNormalSuccess(state: types.StoreState, action: actions.LoadNormalSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    kind: types.ViewOrgViewModelKind.NORMAL,\n                    organization: action.organization,\n                    relation: action.relation,\n                    openRequest: action.openRequest,\n                    groupRequests: action.groupRequests,\n                    groupInvitations: action.groupInvitations,\n                    requestInbox: action.requestInbox,\n                    requestOutbox: action.requestOutbox,\n                    sortNarrativesBy: action.narrativesSortBy,\n                    searchNarrativesBy: '',\n                    narratives: action.narratives,\n                    sortMembersBy: action.sortMembersBy,\n                    members: action.members,\n                    searchMembersBy: '',\n                    subViews: {\n                        manageRelatedOrganizationsView: {\n                            state: types.ViewState.NONE,\n                            viewModel: null,\n                            error: null\n                        },\n                        inviteUserView: {\n                            state: types.ViewState.NONE,\n                            viewModel: null,\n                            error: null\n                        },\n                        requestNarrativeView: {\n                            state: types.ViewState.NONE,\n                            viewModel: null,\n                            error: null\n                        }\n                    }\n                } as types.ViewOrgViewModel\n            }\n        }\n    }\n}\n\nexport function loadInaccessiblePrivateSuccess(state: types.StoreState, action: actions.LoadInaccessiblePrivateSuccess): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    kind: types.ViewOrgViewModelKind.PRIVATE_INACCESSIBLE,\n                    organization: action.organization,\n                    relation: action.relation,\n                    requestOutbox: action.requestOutbox\n                } as types.ViewInaccessiblePrivateOrgViewModel\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                loadingState: types.ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function removeNarrativeSuccess(state: types.StoreState, action: actions.RemoveNarrativeSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    // Argh!@\n    if (state.views.viewOrgView.viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    const narratives = state.views.viewOrgView.viewModel.organization.narratives\n    const newNarratives = narratives.filter((narrative) => {\n        return (narrative.workspaceId !== action.narrativeId)\n    })\n    const newDisplayNarratives = state.views.viewOrgView.viewModel.narratives.filter((narrative) => {\n        return (narrative.workspaceId !== action.narrativeId)\n    })\n    // const filteredSortedNarratives = \n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: {\n                        ...state.views.viewOrgView.viewModel.organization,\n                        narratives: newNarratives\n                    },\n                    narratives: newDisplayNarratives\n                }\n            }\n        }\n    }\n}\n\nexport function accessNarrativeSuccess(state: types.StoreState, action: actions.AccessNarrativeSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    organization: action.organization,\n                    narratives: action.narratives\n                }\n            }\n        }\n    }\n}\n\nexport function sortNarrativesSuccess(state: types.StoreState, action: actions.SortNarrativesSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    sortNarrativesBy: action.sortBy,\n                    narratives: action.narratives\n                }\n            }\n        }\n    }\n}\n\nexport function searchNarrativesSuccess(state: types.StoreState, action: actions.SearchNarrativesSuccess): types.StoreState {\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    searchNarrativesBy: action.searchBy,\n                    narratives: action.narratives\n                }\n            }\n        }\n    }\n}\n\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.VIEW_ORG_LOAD_NORMAL_SUCCESS:\n            return loadNormalSuccess(state, action as actions.LoadNormalSuccess)\n        case ActionFlag.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS:\n            return loadInaccessiblePrivateSuccess(state, action as actions.LoadInaccessiblePrivateSuccess)\n        case ActionFlag.VIEW_ORG_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.VIEW_ORG_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:\n            return removeNarrativeSuccess(state, action as actions.RemoveNarrativeSuccess)\n        case ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:\n            return accessNarrativeSuccess(state, action as actions.AccessNarrativeSuccess)\n        case ActionFlag.VIEW_ORG_SORT_NARRATIVES_SUCCESS:\n            return sortNarrativesSuccess(state, action as actions.SortNarrativesSuccess)\n        case ActionFlag.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS:\n            return searchNarrativesSuccess(state, action as actions.SearchNarrativesSuccess)\n    }\n\n    return acceptInboxRequest(state, action) ||\n        denyInboxRequest(state, action) ||\n        cancelOutboxRequest(state, action) ||\n        viewMembers(state, action) ||\n        manageRelatedOrganizations(state, action) ||\n        relatedOrganizations(state, action) ||\n        relatedOrganizations(state, action)\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/browseOrgs'\nimport { StoreState, SortDirection, ComponentLoadingState, BrowseOrgsView } from '../../types'\nimport { ActionFlag } from '../actions'\nimport * as orgModel from '../../data/models/organization/model'\n\nexport function applyOrgSearch(orgs: Array<orgModel.Organization>, searchTerms: Array<string>) {\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTerms.every((term) => {\n            // todo : make more efficient!!!\n            return (new RegExp(term, 'i').test(org.name));\n        })\n    })\n\n    return {\n        organizations: filteredOrgs,\n        totalCount: orgs.length,\n        filteredCount: filteredOrgs.length\n    }\n}\n\n// TODO:\n// dispatch the start of the request\n// do the request\n// dispatch the success (will be same for all queries?)\n// dispatch the error\n// FOR NOW:\n// do it here...\nexport function searchOrgs(state: BrowseOrgsView, action: actions.SearchOrgs): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    // const { viewModel: { filter, sortBy, sortDirection } } = state\n\n    // const query: Query = {\n    //     searchTerms: action.searchTerms,\n    //     filter: filter,\n    //     sortBy: sortBy,\n    //     sortDirection: sortDirection,\n    //     username: state.auth.authorization.username\n    // }\n    // const result = queryOrgs(state.rawOrganizations, query)\n    // rawOrganizations: Array<Organization>\n    // organizations: Array<Organization>\n    // totalCount: number\n    // filteredCount: number\n    // sortBy: string\n    // sortDirection: SortDirection\n    // filter: string\n    // searchTerms: Array<string>\n    // selectedOrganizationId: string | null\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            selectedOrganizationId: null,\n            searchTerms: action.searchTerms,\n            searching: true\n        }\n    }\n}\n\nexport function searchOrgsStart(state: BrowseOrgsView, action: actions.SearchOrgsStart): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            searching: true\n        }\n    }\n}\n\nexport function searchOrgsSuccess(state: BrowseOrgsView, action: actions.SearchOrgsSuccess): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            organizations: action.organizations,\n            openRequests: action.openRequests,\n            totalCount: action.totalCount,\n            filteredCount: action.organizations.length,\n            searching: false\n        }\n    }\n}\n\n// TODO: hmm, uses the global error -- this was early in the development of this (a whole two weeks ago!)\n// and this should now go in the \"browseOrgs\" (or better named \"searchOrgs\") branch.\nexport function searchOrgsError(state: BrowseOrgsView, action: actions.SearchOrgsError): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            searching: false,\n            error: action.error\n        }\n    }\n}\n\n\nexport function sortOrgsStart(state: BrowseOrgsView, action: actions.SortOrgsStart): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            sortField: action.sortField,\n            sortDirection: action.sortDirection,\n            searching: true\n        }\n    }\n}\n\n\ninterface Query {\n    searchTerms: Array<string>,\n    username: string,\n    sortField: string,\n    sortDirection: SortDirection,\n    filter: string\n}\n\ninterface QueryResults {\n    organizations: Array<orgModel.Organization>,\n    total: number\n}\n\nfunction filterOrgsStart(state: BrowseOrgsView, action: actions.FilterOrgsStart): BrowseOrgsView {\n    if (state.viewModel === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n\n    const { filter } = action\n\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            filter,\n            searching: true\n        }\n    }\n}\n\nfunction loadSuccess(state: BrowseOrgsView, action: actions.LoadSuccess): BrowseOrgsView {\n    const { defaultViewModel: {\n        rawOrganizations, organizations, openRequests, searchTerms, sortField, sortDirection, filter,\n        totalCount, filteredCount, selectedOrganizationId, error, searching\n    } } = action\n\n    return {\n        ...state,\n        loadingState: ComponentLoadingState.SUCCESS,\n        error: null,\n        viewModel: {\n            rawOrganizations, organizations, openRequests, searchTerms, sortField, sortDirection, filter,\n            totalCount, filteredCount, selectedOrganizationId, error, searching\n        }\n    }\n}\n\nfunction unload(state: BrowseOrgsView, action: actions.Unload): BrowseOrgsView {\n    return {\n        loadingState: ComponentLoadingState.NONE,\n        error: null,\n        viewModel: null\n    }\n}\n\nfunction localReducer(state: BrowseOrgsView, action: Action): BrowseOrgsView | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.BROWSE_ORGS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.BROWSE_ORGS_SEARCH:\n            return searchOrgs(state, action as actions.SearchOrgs)\n        case ActionFlag.BROWSE_ORGS_SEARCH_START:\n            return searchOrgsStart(state, action as actions.SearchOrgsStart)\n        case ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS:\n            return searchOrgsSuccess(state, action as actions.SearchOrgsSuccess)\n        case ActionFlag.BROWSE_ORGS_SEARCH_ERROR:\n            return searchOrgsError(state, action as actions.SearchOrgsError)\n        // case ActionFlag.SORT_ORGS_STAR:\n        //     return sortOrgs(state, action as actions.SortOrgs)\n        case ActionFlag.BROWSE_ORGS_SORT_START:\n            return sortOrgsStart(state, action as actions.SortOrgsStart)\n        case ActionFlag.BROWSE_ORGS_FILTER_START:\n            return filterOrgsStart(state, action as actions.FilterOrgsStart)\n        case ActionFlag.BROWSE_ORGS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action<any>): StoreState | null {\n    const browseOrgsView = localReducer(state.views.browseOrgsView, action)\n    if (!browseOrgsView) {\n        return null\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            browseOrgsView\n        }\n    }\n}\n","import { Action } from 'redux'\n\nimport { ActionFlag } from '../actions'\nimport { StoreState, AuthState } from '../../types'\nimport { AuthCheckStart, AuthAuthorized, AuthUnauthorized, AuthCheckError } from '../actions/auth';\n\nexport function authCheckStart(state: StoreState, action: AuthCheckStart): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.CHECKING,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authCheckError(state: StoreState, action: AuthCheckError): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.ERROR,\n            message: action.error.message,\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authAuthorized(state: StoreState, action: AuthAuthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.AUTHORIZED,\n            message: '',\n            authorization: {\n                token: action.token,\n                username: action.username,\n                realname: action.realname,\n                roles: action.roles\n            }\n        }\n    }\n}\n\nexport function authUnauthorized(state: StoreState, action: AuthUnauthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.UNAUTHORIZED,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.AUTH_CHECK_START:\n            return authCheckStart(state, action as AuthCheckStart)\n        case ActionFlag.AUTH_AUTHORIZED:\n            return authAuthorized(state, action as AuthAuthorized)\n        case ActionFlag.AUTH_UNAUTHORIZED:\n            return authUnauthorized(state, action as AuthUnauthorized)\n        case ActionFlag.AUTH_CHECK_ERROR:\n            return authCheckError(state, action as AuthCheckError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { ActionFlag } from '../actions'\nimport { AppSuccess } from '../actions/app';\nimport { StoreState, AppState } from '../../types';\n\nexport function appSuccess(state: StoreState, action: AppSuccess): StoreState {\n    return {\n        ...state,\n        app: {\n            status: AppState.READY,\n            config: action.config\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.APP_SUCCESS:\n            return appSuccess(state, action as AppSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageOrganizationRequests'\nimport { StoreState, ComponentLoadingState } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(\n    state: StoreState,\n    action: actions.LoadStart): StoreState {\n    return state\n}\n\nexport function loadSuccess(\n    state: StoreState,\n    action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    requests: action.requests,\n                    invitations: action.invitations\n                },\n            }\n        }\n    }\n}\n\nexport function loadError(\n    state: StoreState,\n    action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function getViewAccessSuccess(state: StoreState, action: actions.GetViewAccessSuccess): StoreState {\n    // Note: we use the state object rather than peeling off the viewModel because\n    // TS can't trace the assertion (not falsy) of the variable back to the object \n    // property it was taken from.\n    if (!state.views.manageOrganizationRequestsView.viewModel) {\n        return state\n    }\n    const requests = state.views.manageOrganizationRequestsView.viewModel.requests\n    const newRequests = requests.map((request) => {\n        if (request.id = action.request.id) {\n            return action.request\n        }\n        return request\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageOrganizationRequestsView: {\n                ...state.views.manageOrganizationRequestsView,\n                viewModel: {\n                    // TODO: below, \n                    ...state.views.manageOrganizationRequestsView.viewModel,\n                    requests: newRequests\n                }\n            }\n        }\n    }\n}\n\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:\n            return getViewAccessSuccess(state, action as actions.GetViewAccessSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/viewMembers'\nimport { StoreState, ComponentLoadingState, MemberType } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart) {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.LOADING,\n                viewModel: null,\n                error: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.NONE,\n                viewModel: null,\n                error: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.SUCCESS,\n                viewModel: {\n                    organization: action.organization,\n                    relation: action.relation\n                },\n                error: null\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                loadingState: ComponentLoadingState.ERROR,\n                viewModel: null,\n                error: action.error\n            }\n        }\n    }\n}\n\nexport function promoteToAdminSuccess(state: StoreState, action: actions.PromoteToAdminSuccess): StoreState {\n    if (state.views.viewMembersView.viewModel === null) {\n        return state\n    }\n\n    const {\n        views: { viewMembersView: { viewModel } }\n    } = state\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            member.type = MemberType.ADMIN\n            return member\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                viewModel: {\n                    ...state.views.viewMembersView.viewModel,\n                    organization: {\n                        ...state.views.viewMembersView.viewModel!.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function demoteToMemberSuccess(state: StoreState, action: actions.DemoteToMemberSuccess): StoreState {\n    if (state.views.viewMembersView.viewModel === null) {\n        return state\n    }\n\n    const {\n        views: { viewMembersView: { viewModel } }\n    } = state\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = viewModel.organization.members.map((member) => {\n        if (member.username === action.memberUsername) {\n            member.type = MemberType.MEMBER\n            return member\n        } else {\n            return member\n        }\n    })\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewMembersView: {\n                ...state.views.viewMembersView,\n                viewModel: {\n                    ...state.views.viewMembersView.viewModel,\n                    organization: {\n                        ...state.views.viewMembersView.viewModel!.organization,\n                        members: members\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_MEMBERS_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.VIEW_MEMBERS_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.VIEW_MEMBERS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:\n            return promoteToAdminSuccess(state, action as actions.PromoteToAdminSuccess)\n        case ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:\n            return demoteToMemberSuccess(state, action as actions.DemoteToMemberSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/inviteUser'\nimport { ViewOrgViewModel, StoreState, InviteUserViewModel, ViewState, View, InviteUserViewState } from '../../../types'\nimport { ActionFlag } from '../../actions'\nimport * as orgModel from '../../../data/models/organization/model'\nimport { ViewOrgViewModelKind } from '../../../types';\n\nexport function loadStart(state: View<InviteUserViewModel>, action: actions.LoadStart): View<InviteUserViewModel> {\n    return {\n        state: ViewState.LOADING,\n        viewModel: null,\n        error: null\n    }\n}\n\nexport function loadSuccess(state: View<InviteUserViewModel>, action: actions.LoadSuccess): View<InviteUserViewModel> {\n    return {\n        state: ViewState.OK,\n        error: null,\n        viewModel: {\n            editState: InviteUserViewState.EDITING,\n            users: action.users,\n            organization: action.organization,\n            selectedUser: null\n        }\n    }\n}\n\nexport function loadError(state: View<InviteUserViewModel>, action: actions.LoadError): View<InviteUserViewModel> {\n    return {\n        state: ViewState.ERROR,\n        error: action.error,\n        viewModel: null\n    }\n}\n\nexport function unload(state: View<InviteUserViewModel>, action: actions.Unload): View<InviteUserViewModel> {\n    return {\n\n        state: ViewState.NONE,\n        error: null,\n        viewModel: null\n    }\n}\n\nexport function searchUsersSuccess(state: View<InviteUserViewModel>, action: actions.SearchUsersSuccess): View<InviteUserViewModel> {\n    // TODO: better guards!\n    if (state.viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            users: action.users\n        }\n    }\n}\n\nexport function selectUserSuccess(state: View<InviteUserViewModel>, action: actions.SelectUserSuccess): View<InviteUserViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            selectedUser: {\n                user: action.user,\n                relation: action.relation\n            }\n        }\n    }\n}\n\nexport function sendInvitationStart(state: View<InviteUserViewModel>, action: actions.SendInvitationStart): View<InviteUserViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            editState: InviteUserViewState.SENDING\n        }\n    }\n}\n\nexport function sendInvitationSuccess(state: View<InviteUserViewModel>, action: actions.SendInvitationSuccess): View<InviteUserViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n\n    const { viewModel: { selectedUser, users } } = state\n\n    // const selectedUser = state.inviteUserView.value.selectedUser\n    if (!selectedUser) {\n        throw new Error('selected user is null')\n    }\n    selectedUser.relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n\n    if (!users) {\n        throw new Error('users is null')\n    }\n    const newUsers = users.map((user) => {\n        if (user.username === selectedUser.user.username) {\n            user.relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n        }\n        return user\n    })\n\n    return {\n        ...state,\n\n        viewModel: {\n            ...state.viewModel,\n            editState: InviteUserViewState.SUCCESS,\n            selectedUser: selectedUser,\n            users: newUsers\n        }\n    }\n}\n\nexport function sendInvitationError(state: View<InviteUserViewModel>, action: actions.SendInvitationError): View<InviteUserViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            editState: InviteUserViewState.ERROR\n        }\n    }\n}\n\nfunction localReducer(state: View<InviteUserViewModel>, action: Action): View<InviteUserViewModel> | null {\n    switch (action.type) {\n        case ActionFlag.INVITE_USER_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.INVITE_USER_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.INVITE_USER_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.INVITE_USER_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS:\n            return searchUsersSuccess(state, action as actions.SearchUsersSuccess)\n        case ActionFlag.INVITE_USER_SELECT_USER_SUCCESS:\n            return selectUserSuccess(state, action as actions.SelectUserSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_START:\n            return sendInvitationStart(state, action as actions.SendInvitationStart)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS:\n            return sendInvitationSuccess(state, action as actions.SendInvitationSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_ERROR:\n            return sendInvitationError(state, action as actions.SendInvitationError)\n        default:\n            return null\n    }\n}\n\nfunction haveReducer(action: Action): boolean {\n    switch (action.type) {\n        case ActionFlag.INVITE_USER_LOAD_START:\n            return true\n        case ActionFlag.INVITE_USER_LOAD_SUCCESS:\n            return true\n        case ActionFlag.INVITE_USER_LOAD_ERROR:\n            return true\n        case ActionFlag.INVITE_USER_UNLOAD:\n            return true\n        case ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS:\n            return true\n        case ActionFlag.INVITE_USER_SELECT_USER_SUCCESS:\n            return true\n        case ActionFlag.INVITE_USER_SEND_INVITATION_START:\n            return true\n        case ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS:\n            return true\n        case ActionFlag.INVITE_USER_SEND_INVITATION_ERROR:\n            return true\n        default:\n            return false\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    if (!haveReducer(action)) {\n        return null\n    }\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    const viewState: View<InviteUserViewModel> = state.views.viewOrgView.viewModel.subViews.inviteUserView\n    const newViewState = localReducer(viewState, action)\n    if (newViewState === null) {\n        return null\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        inviteUserView: newViewState\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageMembership'\nimport { StoreState, ComponentLoadingState, SyncState, ValidationStateOk, ValidationState, ValidationErrorType, SaveState, EditState, ManageMembershipViewModel } from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: StoreState, action: actions.LoadStart): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.LOADING,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.SUCCESS,\n                error: null,\n                viewModel: {\n                    organization: action.organization,\n                    editableMemberProfile: action.editableMemberProfile,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.NEW,\n                    validationState: validationStateOk()\n                }\n            }\n        }\n    }\n}\n\nexport function loadError(state: StoreState, action: actions.LoadError): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.ERROR,\n                error: action.error,\n                viewModel: null\n            }\n        }\n    }\n}\n\nexport function unload(state: StoreState, action: actions.Unload): StoreState {\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                loadingState: ComponentLoadingState.NONE,\n                error: null,\n                viewModel: null\n            }\n        }\n    }\n}\n\nfunction validationStateOk(): ValidationStateOk {\n    const x: ValidationState = {\n        type: ValidationErrorType.OK,\n        validatedAt: new Date()\n    }\n    return x\n}\n\nexport function updateTitleSuccess(state: StoreState, action: actions.UpdateTitleSuccess): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n\n    const editedMember = state.views.manageMembershipView.viewModel.editableMemberProfile\n    let syncState\n    if (action.title !== editedMember.title.remoteValue) {\n        syncState = SyncState.DIRTY\n    } else {\n        syncState = SyncState.CLEAN\n    }\n    const newState = {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    editableMemberProfile: {\n                        ...state.views.manageMembershipView.viewModel.editableMemberProfile,\n                        title: {\n                            value: action.title,\n                            remoteValue: action.title,\n                            syncState: syncState,\n                            validationState: validationStateOk()\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    const editState = evaluateEditorState(newState.views.manageMembershipView.viewModel)\n\n    return {\n        ...newState,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...newState.views.manageMembershipView,\n                viewModel: {\n                    ...newState.views.manageMembershipView.viewModel,\n                    editState: editState\n                }\n            }\n        }\n    }\n}\nfunction evaluateEditorState(viewModel: ManageMembershipViewModel): EditState {\n    if (viewModel.editableMemberProfile.title.syncState === SyncState.DIRTY) {\n        return EditState.EDITED\n    }\n\n    return EditState.UNEDITED\n}\n\nfunction evaluateSuccess(state: StoreState, action: actions.EvaluateSuccess): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n\n    const editState = evaluateEditorState(state.views.manageMembershipView.viewModel)\n\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    editState: editState,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction evaluateError(state: StoreState, action: actions.EvaluateError): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    validationState: {\n                        type: ValidationErrorType.ERROR,\n                        message: 'Validation error(s)',\n                        validatedAt: new Date()\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function saveSuccess(state: StoreState, action: actions.SaveSuccess): StoreState {\n    if (!state.views.manageMembershipView.viewModel) {\n        return state\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            manageMembershipView: {\n                ...state.views.manageMembershipView,\n                viewModel: {\n                    ...state.views.manageMembershipView.viewModel,\n                    editState: EditState.UNEDITED,\n                    saveState: SaveState.SAVED,\n                    editableMemberProfile: {\n                        title: {\n                            ...state.views.manageMembershipView.viewModel.editableMemberProfile.title,\n                            syncState: SyncState.CLEAN\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.MANAGE_MEMBERSHIP_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:\n            return updateTitleSuccess(state, action as actions.UpdateTitleSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:\n            return evaluateSuccess(state, action as actions.EvaluateSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR:\n            return evaluateError(state, action as actions.EvaluateError)\n        case ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS:\n            return saveSuccess(state, action as actions.SaveSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../../actions/viewOrganization/requestAddNarrative'\nimport {\n    StoreState, SaveState, NarrativeState, View,\n    RequestNarrativeViewModel, ViewOrgViewModelKind,\n    ViewState\n} from '../../../types'\nimport { ActionFlag } from '../../actions'\n\nexport function loadStart(state: View<RequestNarrativeViewModel>, action: actions.LoadStart): View<RequestNarrativeViewModel> {\n    return {\n\n        state: ViewState.LOADING,\n        error: null,\n        viewModel: null\n    }\n\n}\n\nexport function loadSuccess(state: View<RequestNarrativeViewModel>, action: actions.LoadSuccess): View<RequestNarrativeViewModel> {\n    return {\n        state: ViewState.OK,\n        error: null,\n        viewModel: {\n            organization: action.organization,\n            narratives: action.narratives,\n            selectedNarrative: null,\n            relation: action.relation,\n            error: null,\n            saveState: SaveState.SAVED\n        }\n    }\n}\n\nexport function loadError(state: View<RequestNarrativeViewModel>, action: actions.LoadError): View<RequestNarrativeViewModel> {\n    return {\n        state: ViewState.ERROR,\n        error: action.error,\n        viewModel: null\n    }\n}\n\nexport function sendRequestStart(state: View<RequestNarrativeViewModel>, action: actions.SendRequestStart): View<RequestNarrativeViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            saveState: SaveState.SAVING\n        }\n    }\n}\n\nexport function sendRequestSuccess(state: View<RequestNarrativeViewModel>, action: actions.SendRequestSuccess): View<RequestNarrativeViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n\n    const newState: View<RequestNarrativeViewModel> = {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            saveState: SaveState.SAVED\n        }\n\n    }\n\n    const viewModel = newState.viewModel\n\n    // hmm, TS can't trace this fact from the original state (which we proved\n    // at the top of this function.)\n    if (!viewModel) {\n        throw new Error('view model missing')\n    }\n\n    const selectedNarrative = viewModel.selectedNarrative\n\n    // If the request is by an admin, it will be returned as true, not the request\n    // (the api returns {complete: true})\n    if (action.request === true) {\n        viewModel.narratives = viewModel.narratives.map((orgNarrative) => {\n            if (orgNarrative.narrative.workspaceId === selectedNarrative!.narrative.workspaceId) {\n                orgNarrative.status = NarrativeState.ASSOCIATED\n            }\n            return orgNarrative\n        })\n    } else {\n        viewModel.narratives = viewModel.narratives.map((orgNarrative) => {\n            if (orgNarrative.narrative.workspaceId === selectedNarrative!.narrative.workspaceId) {\n                orgNarrative.status = NarrativeState.REQUESTED\n            }\n            return orgNarrative\n        })\n    }\n\n    return newState\n}\n\nexport function sendRequestError(state: View<RequestNarrativeViewModel>, action: actions.SendRequestError): View<RequestNarrativeViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            saveState: SaveState.SAVE_ERROR,\n            error: action.error\n        }\n    }\n}\n\nexport function selectNarrativeSuccess(state: View<RequestNarrativeViewModel>, action: actions.SelectNarrativeSuccess): View<RequestNarrativeViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        error: null,\n        viewModel: {\n            ...state.viewModel,\n            selectedNarrative: action.narrative\n        }\n    }\n}\n\nexport function unload(state: View<RequestNarrativeViewModel>, action: actions.Unload): View<RequestNarrativeViewModel> {\n    return {\n        state: ViewState.NONE,\n        error: null,\n        viewModel: null\n    }\n}\n\nfunction sortSuccess(state: View<RequestNarrativeViewModel>, action: actions.SortSuccess): View<RequestNarrativeViewModel> {\n    if (state.viewModel === null) {\n        return state\n    }\n    return {\n        ...state,\n        viewModel: {\n            ...state.viewModel,\n            narratives: action.narratives\n        }\n    }\n}\n\nfunction localReducer(state: View<RequestNarrativeViewModel>, action: Action): View<RequestNarrativeViewModel> | null {\n    switch (action.type) {\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:\n            return sendRequestSuccess(state, action as actions.SendRequestSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:\n            return selectNarrativeSuccess(state, action as actions.SelectNarrativeSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:\n            return sortSuccess(state, action as actions.SortSuccess)\n        default:\n            return null\n    }\n}\n\nfunction haveReducer(action: Action): boolean {\n    switch (action.type) {\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD:\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:\n            return true\n        default:\n            return false\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    if (!haveReducer(action)) {\n        return null\n    }\n    if (!state.views.viewOrgView.viewModel) {\n        return state\n    }\n    if (state.views.viewOrgView.viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        return state\n    }\n    const viewState: View<RequestNarrativeViewModel> = state.views.viewOrgView.viewModel.subViews.requestNarrativeView\n    const newViewState = localReducer(viewState, action)\n    if (newViewState === null) {\n        return null\n    }\n    return {\n        ...state,\n        views: {\n            ...state.views,\n            viewOrgView: {\n                ...state.views.viewOrgView,\n                viewModel: {\n                    ...state.views.viewOrgView.viewModel,\n                    subViews: {\n                        ...state.views.viewOrgView.viewModel.subViews,\n                        requestNarrativeView: newViewState\n                    }\n                }\n            }\n        }\n    }\n}\n\n","import * as actions from '../../actions/entities/organization'\nimport { StoreState } from '../../../types'\nimport { ActionFlag } from '../../actions'\n\nfunction loadSuccess(state: StoreState, action: actions.LoadSuccess) {\n    const newOrgs = new Map(state.entities.organizations.byId)\n    newOrgs.set(action.organization.id, action.organization)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            organizations: {\n                ...state.entities.organizations.byId,\n                byId: newOrgs\n            }\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: actions.OrganizationEntityAction): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ENTITY_ORGANIZATION_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        default:\n            return null\n    }\n}\n","\nimport * as actions from '../actions/entities'\nimport { StoreState } from '../../types'\nimport { ActionFlag } from '../actions'\nimport organizationsReducer from './entities/organization'\n\nfunction userLoaderSuccess(state: StoreState, action: actions.UserLoaderSuccess) {\n    const users = state.entities.users\n    // mutation ... horrible ;)\n    users.byId.set(action.user.username, action.user)\n    // return state\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            users: {\n                ...state.entities.users,\n                byId: new Map(users.byId)\n            }\n        }\n    }\n}\n\nfunction organizationLoaderSuccess(state: StoreState, action: actions.OrganizationLoaderSuccess) {\n    const orgsMap = state.entities.orgs.byId\n    orgsMap.set(action.organization.id, action.organization)\n\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            orgs: {\n                ...state.entities.orgs,\n                byId: new Map(orgsMap)\n            }\n        }\n    }\n}\n\nfunction loadNarrativeSuccess(state: StoreState, action: actions.LoadNarrativeSuccess) {\n    const narratives = state.entities.narratives\n    narratives.byId.set(action.narrative.workspaceId, action.narrative)\n    return {\n        ...state,\n        entities: {\n            ...state.entities,\n            narratives: {\n                ...state.entities.narratives,\n                byId: new Map(narratives.byId)\n            }\n        }\n    }\n}\n\n// TODO: start and error\n\nexport default function reducer(state: StoreState, action: actions.EntityAction): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ENTITY_USER_LOADER_SUCCESS:\n            return userLoaderSuccess(state, action as actions.UserLoaderSuccess)\n        case ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS:\n            return organizationLoaderSuccess(state, action as actions.OrganizationLoaderSuccess)\n        case ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS:\n            return loadNarrativeSuccess(state, action as actions.LoadNarrativeSuccess)\n    }\n\n    return organizationsReducer(state, action)\n}\n\n","import { Action } from 'redux'\nimport * as actions from '../actions/dataServices'\nimport { StoreState } from '../../types';\nimport { ActionFlag } from '../actions';\nimport * as userProfileModel from '../../data/models/profile'\n\nfunction loadSuccess(state: StoreState, action: actions.LoadSuccess): StoreState {\n    return {\n        ...state,\n        db: {\n            ...state.db,\n        }\n    }\n}\n\nexport default function reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.DATA_SERVICE_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        default:\n            return null\n    }\n}","import { Action } from 'redux'\nimport { StoreState } from '../../types'\nimport addOrgReducer from './addOrg'\nimport editOrgReducer from './editOrg'\nimport viewOrgReducer from './viewOrg'\nimport browseOrgsReducer from './browseOrgs'\nimport authReducer from './auth'\nimport appReducer from './app'\nimport manageOrganizatiopRequests from './manageOrganizationRequests'\nimport viewMembers from './viewMembers'\nimport inviteUser from './viewOrganization/inviteUser'\nimport manageMembership from './manageMembership'\nimport requestAddNarrative from './viewOrganization/requestAddNarrative'\nimport entities from './entities'\nimport dataServices from './dataServices'\n\n\nexport function reducer(state: StoreState, action: Action): StoreState {\n    return addOrgReducer(state, action) ||\n        editOrgReducer(state, action) ||\n        browseOrgsReducer(state, action) ||\n        viewOrgReducer(state, action) ||\n        authReducer(state, action) ||\n        appReducer(state, action) ||\n        manageOrganizatiopRequests(state, action) ||\n        viewMembers(state, action) ||\n        inviteUser(state, action) ||\n        manageMembership(state, action) ||\n        requestAddNarrative(state, action) ||\n        entities(state, action) ||\n        dataServices(state, action) ||\n        state;\n}\n\nexport default reducer","import * as React from 'react'\nimport './Owner.css'\n\nimport Avatar from './Avatar'\nimport { Icon, Tooltip } from 'antd';\nimport * as userModel from '../../data/models/user'\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nexport interface OwnerProps {\n    user: userModel.User\n    avatarSize?: number\n    showAvatar: boolean\n}\n\ninterface OwnerState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nexport default class Owner extends React.Component<OwnerProps, OwnerState> {\n    constructor(props: OwnerProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderRole() {\n        return (\n            <span>\n                <Icon type=\"crown\" /> owner\n        </span>\n        )\n    }\n\n    renderAvatar() {\n        if (this.props.showAvatar) {\n            return (\n                <div className=\"Owner-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n            )\n        }\n    }\n\n    renderCompact() {\n        const tooltip = (\n            <div>\n                <div>\n                    {this.props.user.realname}\n                </div>\n                <div>\n                    <span><Avatar user={this.props.user} size={20} /></span>\n                    {' '}\n                    <span>{this.props.user.username}</span>\n                </div>\n            </div>\n        )\n        return (\n            <div className=\"Owner-owner\" >\n                {/* <div className=\"Owner-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div> */}\n                {this.renderAvatar()}\n\n                <div className=\"Owner-infoCol\">\n                    <div className=\"Owner-name\">\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            title={tooltip}>\n                            <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        </Tooltip>\n\n                    </div>\n                    {/* <div className=\"Owner-username\">\n                        {this.props.user.username}\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n\n    renderNormal() {\n        return (\n            <div className=\"Owner View-NORMAL\" >\n                <div className=\"Owner-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"Owner-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"Owner-infoCol\">\n                    <div className=\"Owner-name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                    </div>\n                    <div className=\"Owner-username\">\n                        {this.props.user.username}\n                    </div>\n                    {/* <div className=\"role\">\n                        {this.renderRole()}\n                    </div> */}\n                    {/* <div className=\"joinedAt\">\n                        <span className=\"field-label\">joined</span>{' '}{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(this.props.member.joinedAt)}\n                    </div> */}\n                    <div className=\"Owner-title\">\n                        {this.props.user.title || <i>no title in user profile</i>}\n                    </div>\n                    <div className=\"Owner-organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"Owner-location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n\n    render() {\n        return this.renderCompact()\n        // switch (this.state.view) {\n        //     case View.COMPACT:\n        //         return this.renderCompact()\n\n        //     case View.NORMAL:\n        //         return this.renderNormal()\n        // }\n    }\n}\n\n","import * as React from 'react'\nimport md5 from 'md5'\n\nexport interface OrgLogoProps {\n    logoUrl: string | null\n    size: number\n    organizationName: string\n    organizationId: string\n}\n\nexport interface OrgLogoState {\n\n}\n\nexport default class OrgLogo extends React.Component<OrgLogoProps, OrgLogoState> {\n    constructor(props: OrgLogoProps) {\n        super(props)\n    }\n\n    renderLogoUrl() {\n        if (!this.props.logoUrl) {\n            return (\n                <span>n/a</span>\n            )\n        }\n        return (\n            <img src={this.props.logoUrl} width={this.props.size} />\n        )\n    }\n\n    // see: https://github.com/lautis/unicode-substring/blob/master/index.js\n    charAt(inString: string, position: number) {\n        // const c1 = inString.charAt(position)\n        const c1 = inString.charCodeAt(position)\n        if (c1 >= 0xD800 && c1 <= 0xDBFF && inString.length > position + 1) {\n            const c2 = inString.charCodeAt(position + 1)\n            if (c2 > 0xDC00 && c2 <= 0xDFFF) {\n                return inString.substring(position, 2)\n            }\n        }\n        return inString.substring(position, 1)\n    }\n\n    renderDefaultInitial() {\n        const initial = this.charAt(this.props.organizationName, 0).toUpperCase()\n        // const initial = this.props.organizationName.substr(0, 1).toUpperCase()\n        const hash = md5(this.props.organizationId)\n\n        const color = hash.substr(0, 6)\n        // return (\n        //     <span style={{ color: '\"#' + color + '\"', width: this.props.size, height: this.props.size, fontSize: this.props.size - 6 }}\n        //     >{initial}</span>\n        // )\n        return (\n            <svg width={this.props.size} height={this.props.size} style={{ border: '1px rgba(200, 200, 200, 0.5) solid' }}>\n                <text x=\"50%\" y=\"50%\" dy={4} textAnchor=\"middle\" dominantBaseline=\"middle\" fontSize={this.props.size - 12} fill={'#' + color} fontFamily=\"sans-serif\">{initial}</text>\n            </svg>\n        )\n    }\n\n    renderLogo() {\n        if (this.props.logoUrl) {\n            return this.renderLogoUrl()\n        }\n        return this.renderDefaultInitial();\n    }\n\n    render() {\n        return this.renderLogo()\n    }\n}","import * as React from 'react'\nimport './Avatar.css'\nimport noUserPic from './nouserpic.png'\n\nimport { User } from '../../types'\n\nexport interface AvatarProps {\n    user: User,\n    size: number\n}\n\ninterface AvatarState {\n\n}\n\nexport class Avatar extends React.Component<AvatarProps, AvatarState> {\n    constructor(props: AvatarProps) {\n        super(props)\n    }\n\n    getAvatarUrl(user: User) {\n        switch (user.avatarOption || 'gravatar') {\n            case 'gravatar':\n                const gravatarDefault = user.gravatarDefault || 'identicon';\n                const gravatarHash = user.gravatarHash;\n                if (gravatarHash) {\n                    return 'https://www.gravatar.com/avatar/' + gravatarHash + '?s=60&amp;r=pg&d=' + gravatarDefault;\n                } else {\n                    return noUserPic;\n                }\n            case 'silhouette':\n            case 'mysteryman':\n            default:\n                return noUserPic;\n        }\n    }\n\n    render() {\n        const avatarUrl = this.getAvatarUrl(this.props.user)\n        return (\n            <img\n                src={avatarUrl}\n                style={{ width: this.props.size }}\n            />\n        )\n    }\n\n}\n\nexport default Avatar","export interface ServiceClientParams {\n    url: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport interface JSONResponse {\n    id: string\n    version: string\n    result: any\n    error: any\n}\n\nexport class ServiceClient {\n    url: string;\n    token: string | null;\n\n    static module: string;\n\n    constructor({ url, token }: ServiceClientParams) {\n        this.url = url\n        this.token = token || null\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n\n}\n\nexport class AuthorizedServiceClient extends ServiceClient {\n    token: string;\n\n    constructor(params: ServiceClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    callFunc(func: string, param: any): Promise<JSONResponse> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token!,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Request error: ' + response.status + ', ' + response.statusText)\n                }\n                return <unknown>response.json() as JSONResponse\n            })\n    }\n}\n\n","import { ServiceClientParams, ServiceClient, AuthorizedServiceClient } from \"./serviceClient\";\n\nexport interface User {\n    username: string,\n    realname: string,\n    thumbnail: string\n}\n\nexport type OrganizationSetting = {\n    settings: {\n        lastVisitedAt: Date | null\n    }\n}\n\nexport type OrganizationsSettings = {\n    orgSettings: any //Map<string, OrganizationSetting>\n}\n\nexport interface UserProfile {\n    user: User,\n    profile: {\n        synced: {\n            gravatarHash: string\n        }\n        userdata: {\n            jobTitle: string,\n            jobTitleOther: string,\n            organization: string\n            city: string\n            state: string\n            country: string\n            avatarOption: string\n            gravatarDefault: string\n        }\n        metadata: {\n            createdBy: string\n            created: string\n        }\n        plugins: {\n            organizations?: OrganizationsSettings\n        }\n    }\n}\n\n// Note that we are only supporting updating of the orgs plugin settings, \n// so make this strict-ish.\nexport interface UserProfileUpdate {\n    user: User,\n    profile: {\n        plugins: {\n            organizations: OrganizationsSettings\n        }\n    }\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\n\nexport interface UserProfileClientParams extends ServiceClientParams {\n}\n\nexport class UserProfileClient extends AuthorizedServiceClient {\n    static module: string = 'UserProfile'\n    static profileCache: Map<string, UserProfile> = new Map()\n\n    constructor(params: UserProfileClientParams) {\n        super(params)\n    }\n\n    // makePayload(method: string, param: any): JSONPayload {\n    //     return {\n    //         version: '1.1',\n    //         method: 'UserProfile.' + method,\n    //         id: String(Math.random()).slice(2),\n    //         params: [param]\n    //     }\n    // }\n\n    // makeEmptyPayload(method: string): JSONPayload {\n    //     return {\n    //         version: '1.1',\n    //         method: 'UserProfile.' + method,\n    //         id: String(Math.random()).slice(2),\n    //         params: []\n    //     }\n    // }\n\n    getVersion(): Promise<any> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makeEmptyPayload('version'))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    async getUserProfile(username: string): Promise<UserProfile> {\n        if (UserProfileClient.profileCache.has(username)) {\n            return Promise.resolve(UserProfileClient.profileCache.get(username)!)\n        }\n\n        return this.callFunc('get_user_profile', [username])\n            .then((result) => {\n                return result.result[0][0] as UserProfile\n            })\n    }\n\n    async updateUserProfile(update: UserProfileUpdate): Promise<void> {\n        // TODO: update user profile cache here...\n        UserProfileClient.profileCache.delete(update.user.username)\n        return this.callFunc('update_user_profile', { profile: update })\n            .then(() => {\n                return\n            })\n    }\n\n    // async setUserProfile(username: string, profile: UserProfile): Promise<void> {\n    //     // TODO: update user profile cache here...\n    //     this.callFunc('update_user_profile', profile)\n    // }\n\n    async getUserProfiles(usernames: Array<string>): Promise<Array<UserProfile>> {\n        return this.callFunc('get_user_profile', usernames)\n            .then((result) => {\n                return result.result[0] as Array<UserProfile>\n            })\n    }\n\n    async getAllUsers(): Promise<Array<User>> {\n        return this.callFunc('filter_users', { filter: '' })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n\n    async searchUsers(query: string): Promise<Array<User>> {\n        return this.callFunc('filter_users', { filter: query })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n}","import { UserProfileClient, UserProfile } from '../apis/userProfile'\n\n\nexport type Username = string\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\n\nfunction profileToUser(profile: UserProfile): User {\n    let jobTitle\n    if (!profile.profile.userdata) {\n        return {\n            username: profile.user.username,\n            realname: profile.user.realname,\n            city: null,\n            state: null,\n            country: null,\n            title: null,\n            organization: null,\n            avatarOption: null,\n            gravatarHash: null,\n            gravatarDefault: null\n        }\n    }\n    if (profile.profile.userdata.jobTitle === 'Other') {\n        jobTitle = profile.profile.userdata.jobTitleOther\n    } else {\n        jobTitle = profile.profile.userdata.jobTitle\n    }\n\n    return {\n        username: profile.user.username,\n        realname: profile.user.realname,\n        city: profile.profile.userdata.city,\n        state: profile.profile.userdata.state,\n        country: profile.profile.userdata.country,\n        title: jobTitle,\n        organization: profile.profile.userdata.organization,\n        avatarOption: profile.profile.userdata.avatarOption,\n        gravatarHash: profile.profile.synced.gravatarHash,\n        gravatarDefault: profile.profile.userdata.gravatarDefault\n    }\n}\n\nexport interface UserQuery {\n    query: string\n    excludedUsers: Array<string>\n}\n\nexport interface BriefUser {\n    username: string\n    realname: string\n}\n\n\n\n\ninterface UserModelParams {\n    userProfileServiceURL: string\n    token: string\n}\n\nexport class UserModel {\n\n    params: UserModelParams\n    userProfileClient: UserProfileClient\n\n    cache: Map<Username, User>\n\n    constructor(params: UserModelParams) {\n        this.params = params\n        this.userProfileClient = new UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n        this.cache = new Map<Username, User>()\n    }\n\n    async getUser(username: Username): Promise<User> {\n        if (this.cache.has(username)) {\n            return this.cache.get(username)!\n        }\n\n        const userProfile = await this.userProfileClient.getUserProfile(username)\n        const user = profileToUser(userProfile)\n        this.cache.set(username, user)\n        return user\n    }\n\n    async getUsers(usernames: Array<Username>): Promise<Map<Username, User>> {\n        const result: Map<Username, User> = new Map()\n\n        const toFetch: Array<Username> = []\n\n        usernames.forEach((username) => {\n            if (this.cache.has(username)) {\n                result.set(username, this.cache.get(username)!)\n            } else {\n                toFetch.push(username)\n            }\n        })\n\n        const userProfiles = await this.userProfileClient.getUserProfiles(toFetch)\n        const users = userProfiles.map((profile) => {\n            return profileToUser(profile)\n        })\n\n        userProfiles.forEach((userProfile) => {\n            const user = profileToUser(userProfile)\n            this.cache.set(user.username, user)\n            result.set(user.username, user)\n        })\n\n        return result\n    }\n\n    async searchUsers(query: UserQuery): Promise<Array<BriefUser>> {\n        const users = await this.userProfileClient.searchUsers(query.query)\n        return users\n            .filter(({ username }) => {\n                return (query.excludedUsers.indexOf(username) === -1)\n            })\n            .map(({ username, realname }) => {\n                return {\n                    username, realname\n                }\n            })\n    }\n\n    // searchUsers(query: UserQuery): Promise<Array<BriefUser>> {\n    //     const userProfileClient = new userProfile.UserProfileClient({\n    //         url: this.params.userProfileServiceURL,\n    //         token: this.params.token\n    //     })\n\n    //     return userProfileClient.searchUsers(query.query)\n    //         .then((users) => {\n    //             return users\n    //                 .filter(({ username }) => {\n    //                     return (query.excludedUsers.indexOf(username) === -1)\n    //                 })\n    //                 .map(({ username, realname }) => {\n    //                     return {\n    //                         username, realname\n    //                     }\n    //                 })\n\n    //         })\n    // }\n\n    // getUser(username: string): Promise<User> {\n    //     const userProfileClient = new userProfile.UserProfileClient({\n    //         url: this.params.userProfileServiceURL,\n    //         token: this.params.token\n    //     })\n\n    //     return userProfileClient.getUserProfile(username)\n    //         .then((userProfile) => {\n    //             return this.profileToUser(userProfile)\n    //         })\n    // }\n}","export interface GenericClientParams {\n    url: string\n    module: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport interface ErrorResult {\n    name: string\n    code: number\n    message: string\n    error: string\n}\n\nexport type JSONRPCResponse = [any, ErrorResult | null]\n\nexport class GenericClient {\n    url: string;\n    token: string | null\n    module: string\n\n    constructor({ url, token, module }: GenericClientParams) {\n        this.url = url\n        this.token = token || null\n        this.module = module\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: param\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n    async processResponse(response: Response): Promise<JSONRPCResponse> {\n        if (response.status === 200) {\n            const { result, error } = await response.json()\n            if (result) {\n                return [result, null]\n            } else {\n                return [null, error]\n            }\n\n        } else if (response.status === 204) {\n            return [null, null]\n        }\n        if (response.status === 500) {\n            if (response.headers.get('Content-Type') === 'application/json') {\n                const { error } = await response.json()\n                return [null, error]\n            } else {\n                const text = await response.text()\n                return [null, {\n                    code: 0,\n                    name: 'Internal Server Error (for real)',\n                    message: 'The service experienced an internal error',\n                    error: text\n                }]\n            }\n        }\n        throw new Error('Unexpected response: ' + response.status + ', ' + response.statusText)\n    }\n\n    async callFunc(func: string, param: any): Promise<JSONRPCResponse> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                return this.processResponse(response)\n            })\n    }\n}\n\nexport class AuthorizedGenericClient extends GenericClient {\n    token: string;\n\n    constructor(params: GenericClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    async callFunc(func: string, param: any): Promise<JSONRPCResponse> {\n        const response = await fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n        return this.processResponse(response)\n    }\n}\n\n","import { AuthorizedServiceClient, ServiceClientParams } from './serviceClient'\n\n// types from module\n\nexport interface Service {\n    module_name: string\n    version: string | null\n}\n\nexport interface ServiceStatus {\n    module_name: string\n    version: string\n    git_commit_hash: string\n    release_tags: Array<string>\n    hash: string\n    url: string\n    up: number // aka boolean\n    status: string\n    health: string\n}\n\n// impl\n\nexport interface ServiceWizardClientParams extends ServiceClientParams {\n\n}\n\nexport interface GetServiceStatusParams extends Service { }\n\nexport interface GetServiceStatusResult extends ServiceStatus { }\n\nexport class ServiceWizardClient extends AuthorizedServiceClient {\n\n    static module: string = 'ServiceWizard'\n\n    constructor(params: ServiceWizardClientParams) {\n        super(params)\n    }\n\n\n    getServiceStatus(params: GetServiceStatusParams): Promise<GetServiceStatusResult> {\n        return this.callFunc('get_service_status', params)\n            .then((result) => {\n                if (result.result &&\n                    result.result.length > 0) {\n                    const theResult = result.result[0]\n                    if (!theResult) {\n                        throw new Error('Crazy at it seems, no result')\n                    }\n                    return theResult as GetServiceStatusResult\n                } else {\n                    throw new Error('Crazy at it seems, no result')\n                }\n            })\n    }\n\n}","import Bluebird from 'bluebird'\nimport { AuthorizedServiceClient } from './serviceClient'\n\nimport { ServiceWizardClient } from './serviceWizard'\nimport { GenericClient, AuthorizedGenericClient } from './genericClient'\n// now import the service wizard, and one auth generic client\n\n// type Promise<T> = Bluebird<T>\n\nexport interface CacheParams {\n    itemLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n}\n\nexport interface CacheItem<T> {\n    id: string\n    value: T | null\n    createdAt: number\n    fetcher: () => Bluebird<T>\n    reserved: boolean\n}\n\nexport class Cache<T> {\n\n    cache: Map<string, CacheItem<T>>\n    cacheLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n    isMonitoring: boolean\n\n    constructor({ itemLifetime, monitoringFrequency, waiterTimeout, waiterFrequency }: CacheParams) {\n        this.cache = new Map<string, CacheItem<T>>()\n\n        // 10 minute cache lifetime\n        this.cacheLifetime = itemLifetime || 1800000;\n\n        // Frequency with which to monitor the cache for expired items\n        // or refreshing them.\n        this.monitoringFrequency = monitoringFrequency || 60000;\n\n        // The waiter waits for a cache item to become available if it has\n        // been reserved. These settings determine how long to wait\n        // for a waiter to wait, and how often to check the cache item to see if it has\n        // yet been fulfilled.\n        this.waiterTimeout = waiterTimeout || 30000;\n        this.waiterFrequency = waiterFrequency || 100;\n\n        this.isMonitoring = false;\n    }\n\n    runMonitor() {\n        if (this.isMonitoring) {\n            return;\n        }\n        this.isMonitoring = true;\n        window.setTimeout(() => {\n            const newCache = new Map<string, any>();\n            let cacheRenewed = false;\n            Object.keys(this.cache).forEach((id) => {\n                const item = this.cache.get(id);\n                if (!this.isExpired(item)) {\n                    newCache.set(id, item)\n                    cacheRenewed = true\n                }\n            });\n            this.cache = newCache\n            this.isMonitoring = false\n            if (cacheRenewed) {\n                this.runMonitor()\n            }\n        }, this.monitoringFrequency)\n    }\n\n    isExpired(cacheItem: any) {\n        const now = new Date().getTime();\n        const elapsed = now - cacheItem.createdAt;\n        return (elapsed > this.cacheLifetime);\n    }\n\n    isReserved(cacheItem: any) {\n        return cacheItem.reserved;\n    }\n\n    getItem(id: string) {\n        if (this.cache.get(id) === undefined) {\n            return null\n        }\n        const cached = this.cache.get(id)\n        if (this.isExpired(cached)) {\n            this.cache.delete(id)\n            return;\n        }\n        return cached;\n    }\n\n    reserveWaiter(item: CacheItem<T>): Bluebird<CacheItem<T>> {\n        return new Bluebird<CacheItem<T>>((resolve, reject) => {\n            const started = new Date().getTime();\n            const waiting = true;\n\n            const waiter = () => {\n                if (!waiting) {\n                    return;\n                }\n                window.setTimeout(() => {\n                    if (this.cache.has(item.id)) {\n                        // If on a wait-loop cycle we discover that the\n                        // cache item has been deleted, we volunteer\n                        // to attempt to fetch it ourselves.\n                        // The only case now for this is a cancellation\n                        // of the first request to any dynamic service,\n                        // which may cancel the initial service wizard\n                        // call rather than the service call.\n                        return this.reserveAndFetch({\n                            id: item.id,\n                            fetcher: item.fetcher\n                        })\n                            .then(() => {\n                                // resolve(result);\n                                // we resolve with the cache item just\n                                // as if we had waited for it.\n                                resolve(this.cache.get(item.id))\n                            })\n                            .catch((err: Error) => {\n                                reject(err);\n                            });\n                    }\n                    if (!item.reserved) {\n                        resolve(item);\n                    } else {\n                        const elapsed = new Date().getTime() - started;\n                        if (elapsed > this.waiterTimeout) {\n                            this.cache.delete(item.id)\n                            reject(new Error(\n                                'Timed-out waiting for cache item to become available; timeout '\n                                + this.waiterTimeout + ', waited ' + elapsed));\n                        } else {\n                            waiter();\n                        }\n                    }\n                }, this.waiterFrequency);\n            };\n            waiter();\n        });\n    }\n\n    reserveAndFetch({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        // now, reserve it.\n        this.reserveItem(id, fetcher)\n\n        // and then fetch it.\n        const fetchPromise = fetcher()\n            .then((result: any) => {\n                this.setItem(id, result, fetcher)\n                return result\n            })\n            .finally(() => {\n                // If the fetch was cancelled, we need to remove\n                // the reserved item. This should signal any queued waiters\n                // to spawn their own fetch.\n                if (fetchPromise.isCancelled()) {\n                    this.cache.get(id)\n                }\n            });\n        return fetchPromise;\n    }\n\n    getItemWithWait({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        const cached = this.cache.get(id)\n        if (cached) {\n            if (this.isExpired(cached)) {\n                this.cache.delete(id)\n            } else if (this.isReserved(cached)) {\n                return this.reserveWaiter(cached)\n                    .then((cached) => {\n                        return cached.value;\n                    });\n            } else {\n                return Bluebird.resolve(cached.value)\n            }\n        }\n\n        return this.reserveAndFetch({ id, fetcher });\n    }\n\n    reserveItem(id: string, fetcher: () => Bluebird<T>) {\n        this.cache.set(id, {\n            id: id,\n            createdAt: new Date().getTime(),\n            reserved: true,\n            value: null,\n            fetcher: fetcher\n        });\n    }\n\n    setItem(id: string, value: T, fetcher: () => Bluebird<T>) {\n        if (this.cache.has(id)) {\n            const item = this.cache.get(id)\n            if (item && item.reserved) {\n                item.reserved = false\n                item.value = value\n                item.fetcher = fetcher\n            } else {\n                // overwriting? should we allow this?\n                this.cache.set(id, {\n                    id: id,\n                    createdAt: new Date().getTime(),\n                    fetcher: fetcher,\n                    reserved: false,\n                    value: value\n                })\n            }\n        } else {\n            this.cache.set(id, {\n                id: id,\n                createdAt: new Date().getTime(),\n                fetcher: fetcher,\n                reserved: false,\n                value: value\n            })\n        }\n        this.runMonitor();\n    }\n}\nvar moduleCache = new Cache<any>({\n    itemLifetime: 1800000,\n    monitoringFrequency: 60000,\n    waiterTimeout: 30000,\n    waiterFrequency: 100\n})\n\n\n/*\n * arg is:\n * url - service wizard url\n * timeout - request timeout\n * version - service release version or tag\n * auth - auth structure\n *   token - auth token\n *   username - username\n * rpcContext\n */\n\nexport interface DynamicServiceClientParams {\n    token: string\n    url: string\n    version?: string\n    timeout?: number\n    rpcContext?: any\n}\n\nexport class DynamicServiceClient {\n    token: string\n    timeout: number\n    rpcContext: any\n    url: string\n    version: string | null\n\n    static module: string\n\n    constructor({ token, url, version, timeout, rpcContext }: DynamicServiceClientParams) {\n        // Establish an auth object which has properties token and user_id.\n        this.token = token;\n        this.timeout = timeout || 10000;\n        this.rpcContext = rpcContext || null;\n\n        if (!url) {\n            throw new Error('The service discovery url was not provided');\n        }\n        this.url = url;\n\n        this.version = version || null;\n        if (version === 'auto') {\n            this.version = null;\n        }\n    }\n\n    options() {\n        return {\n            timeout: this.timeout,\n            authorization: this.token,\n            rpcContext: this.rpcContext\n        };\n    }\n\n    getModule() {\n        return (<typeof DynamicServiceClient>this.constructor).module\n    }\n\n    moduleId() {\n        let moduleId;\n        if (!this.version) {\n            moduleId = this.getModule() + ':auto';\n        } else {\n            moduleId = this.getModule() + ':' + this.version;\n        }\n        return moduleId;\n    }\n\n    getCached(fetcher: () => Bluebird<any>) {\n        return moduleCache.getItemWithWait({\n            id: this.moduleId(),\n            fetcher: fetcher\n        });\n    }\n\n    // setCached(value: any) {\n    //     moduleCache.setItem(this.moduleId(), value);\n    // }\n\n    lookupModule() {\n        return this.getCached((): Bluebird<any> => {\n            const func = 'get_service_status';\n            const params = [{\n                module_name: this.getModule(),\n                version: this.version\n            }];\n            // NB: pass null for numRets (number of return values) so we get the\n            // full return structure.\n            const client = new ServiceWizardClient({\n                url: this.url,\n                token: this.token\n            })\n\n            return Bluebird.resolve(\n                client.getServiceStatus({\n                    module_name: this.getModule(),\n                    version: this.version\n                })\n            )\n        })\n    }\n\n    callFunc(funcName: string, params: any) {\n        return this.lookupModule()\n            .then((serviceStatus) => {\n                const client = new AuthorizedGenericClient({\n                    module: serviceStatus.module_name,\n                    url: serviceStatus.url,\n                    token: this.token\n                })\n                return Bluebird.resolve(\n                    client.callFunc(funcName, params)\n                )\n            })\n            .catch((err) => {\n                console.error('ERROR: ' + err.name + \" = \" + err.message, err)\n                throw err\n            })\n    }\n}\n","// import { AuthorizedServiceClient, ServiceClientParams, JSONPayload } from './serviceClient'\n\nimport { DynamicServiceClient, DynamicServiceClientParams } from './dynamicServiceClient'\n\nimport { RawObjectInfo, RawWorkspaceInfo, WorkspaceInfo, ObjectInfo, workspaceInfoToObject, objectInfoToObject } from './workspaceUtils'\n\nexport interface NarrativeServiceClientParams extends DynamicServiceClientParams {\n\n}\n\nexport interface ListNarrativesParams {\n    type: string\n}\n\ntype Metadata = {}\n\n/* Information about an object, including user provided metadata.\n\n       obj_id objid - the numerical id of the object.\n       obj_name name - the name of the object.\n       type_string type - the type of the object.\n       timestamp save_date - the save date of the object.\n       obj_ver ver - the version of the object.\n       username saved_by - the user that saved or copied the object.\n       ws_id wsid - the workspace containing the object.\n       ws_name workspace - the workspace containing the object.\n       string chsum - the md5 checksum of the object.\n       int size - the size of the object in bytes.\n       usermeta meta - arbitrary user-supplied metadata about\n           the object.\n   */\n\n\n\n\nexport interface ListNarrativesResponseResult {\n    narratives: Array<{\n        ws: RawWorkspaceInfo\n        nar: RawObjectInfo\n    }>\n}\n\nexport interface ServiceResponse<T> {\n    id: string\n    version: string\n    result?: [T] | null\n    error?: any\n}\n\n\n\n// export type ListNarrativesResponse = ServiceResponse<ListNarrativesResponseResult>\n\n\n\nexport class NarrativeServiceClient extends DynamicServiceClient {\n\n    static module: string = 'NarrativeService'\n\n    constructor(params: NarrativeServiceClientParams) {\n        super(params)\n    }\n\n\n    async listNarratives(type: string): Promise<ListNarrativesResponseResult> {\n        // note usage of unknown below -- Bluebird and native Promise!\n        const [result, error] = await this.callFunc('list_narratives', [{\n            type: type\n        }])\n        // as Promise<ServiceResponse<ListNarrativesResponseResult>>\n\n        // should check id and version, or should call func do that?\n        if (result && result[0]) {\n            return result[0]\n            // return result[0].narratives.map((nar) => {\n            //     return {\n            //         workspaceInfo: workspaceInfoToObject(nar.ws),\n            //         objectInfo: objectInfoToObject(nar.nar)\n            //     }\n            // })\n        } else {\n            // TODO: handle error\n            // console.error('Result is missing', id, version, result, error)\n            throw new Error('Result is missing!')\n        }\n    }\n\n}","import { AuthorizedGenericClient } from '../apis/genericClient'\nimport { NarrativeServiceClient } from '../apis/narrativeService'\nimport * as orgModel from './organization/model'\nimport * as requestModel from './requests'\nimport * as workspaceApi from '../apis/workspaceUtils'\nimport * as userModel from './user'\n\nexport enum NarrativeState {\n    NONE = 0,\n    ASSOCIATED,\n    REQUESTED\n}\n\nexport type NarrativeID = number\n\nexport type WorkspaceID = number\nexport type ObjectID = number\n\nexport enum NarrativeAccess {\n    NONE = 0,\n    VIEW,\n    EDIT,\n    ADMIN,\n    OWNER\n}\n\nexport interface NarrativeBase {\n    workspaceId: WorkspaceID,\n    access: NarrativeAccess\n}\n\nexport interface InaccessibleNarrative extends NarrativeBase {\n    access: NarrativeAccess.NONE\n}\n\nexport interface AccessibleNarrative extends NarrativeBase {\n    access: NarrativeAccess.VIEW | NarrativeAccess.EDIT | NarrativeAccess.ADMIN | NarrativeAccess.OWNER\n    isPublic: boolean\n    objectId: ObjectID\n    title: string\n    // description?: string\n    owner: userModel.Username\n    // creator: userModel.Username\n    // createdAt: Date\n    lastSavedAt: Date\n    lastSavedBy: userModel.Username\n}\n\nexport type Narrative = AccessibleNarrative | InaccessibleNarrative\n\n// export interface OrganizationNarrativex {\n//     workspaceId: WorkspaceID\n//     objectId: ObjectID\n//     title: string\n//     status: NarrativeState\n//     // inOrganization: boolean\n//     // createdAt: Date\n//     owner: userModel.Username\n//     modifiedAt: Date\n// }\n\nexport interface OrganizationNarrative {\n    status: NarrativeState\n    narrative: AccessibleNarrative\n}\n\nexport interface NarrativeWorkspaceInfo extends workspaceApi.WorkspaceInfo {\n    metadata: {\n        narrative_nice_name: string\n        narrative: string\n        is_temporary: string\n    }\n}\n// export interface GetOwnNarrativesResult {\n//     workspaceInfo: WorkspaceInfo\n//     objectInfo: ObjectInfo\n// }\n\nexport enum Sort {\n    TITLE = 'TITLE',\n    LAST_SAVED = 'LAST_SAVED'\n}\n\ninterface NarrativeModelParams {\n    workspaceServiceURL: string\n    serviceWizardURL: string\n    groupsServiceURL: string\n    username: string\n    token: string\n}\n\nexport class NarrativeModel {\n\n    params: NarrativeModelParams\n\n    constructor(params: NarrativeModelParams) {\n        this.params = params\n    }\n\n    // Narratives\n\n    async getOwnNarratives(organizationId: string): Promise<Array<OrganizationNarrative>> {\n        const narrativeServiceClient = new NarrativeServiceClient({\n            url: this.params.serviceWizardURL,\n            token: this.params.token,\n            timeout: 10000,\n        })\n\n        const groupsClient = new orgModel.OrganizationModel({\n            token: this.params.token,\n            username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n\n        const requestClient = new requestModel.RequestsModel({\n            token: this.params.token,\n            username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const [narrativesResult, organization, pendingRequests] = await Promise.all([\n            narrativeServiceClient.listNarratives('mine'),\n            groupsClient.getOrg(organizationId),\n            requestClient.getPendingRequestsForOrg(organizationId)\n        ])\n\n        if (organization.kind === orgModel.OrganizationKind.INACCESSIBLE_PRIVATE) {\n            throw new Error('Cannot get own narratives for private inaccessible organization')\n        }\n\n        const workspacesInOrg = organization.narratives.map((narrative) => {\n            return narrative.workspaceId\n        })\n\n        return narrativesResult.narratives\n            .map((nar) => {\n                return {\n                    workspaceInfo: <unknown>workspaceApi.workspaceInfoToObject(nar.ws) as NarrativeWorkspaceInfo,\n                    objectInfo: workspaceApi.objectInfoToObject(nar.nar)\n                }\n            })\n            .filter((nar) => {\n                return (nar.workspaceInfo.metadata.is_temporary === 'false')\n            })\n            .map((narrative) => {\n                let status: NarrativeState\n\n                if (workspacesInOrg.indexOf(narrative.workspaceInfo.id) !== -1) {\n                    status = NarrativeState.ASSOCIATED\n                } else if (pendingRequests.find((request) => {\n                    // TODO: these requests should have already been converted to \n                    // model-friendly requests (typed!)\n                    return (request.resourceType === requestModel.RequestResourceType.WORKSPACE &&\n                        request.narrativeId === String(narrative.workspaceInfo.id))\n                })) {\n                    status = NarrativeState.REQUESTED\n                } else {\n                    status = NarrativeState.NONE\n                }\n                return {\n                    status: status,\n                    narrative: {\n                        access: NarrativeAccess.OWNER,\n                        isPublic: narrative.workspaceInfo.globalReadPermission,\n                        workspaceId: narrative.workspaceInfo.id,\n                        objectId: narrative.objectInfo.id,\n                        title: narrative.workspaceInfo.metadata.narrative_nice_name,\n                        owner: narrative.workspaceInfo.owner,\n                        lastSavedAt: narrative.objectInfo.savedAt,\n                        lastSavedBy: narrative.objectInfo.savedBy\n                    } as AccessibleNarrative\n\n                }\n            })\n            .sort((a, b) => {\n                return (a.narrative.title.localeCompare(b.narrative.title))\n            })\n    }\n\n    // async workspaceToNarrative(workspaceId: WorkspaceID): Promise<orgModel.NarrativeResource | null> {\n    //     const workspaceClient = new AuthorizedGenericClient({\n    //         module: 'Workspace',\n    //         url: this.params.workspaceServiceURL,\n    //         token: this.params.token\n    //     })\n    //     try {\n    //         const [[[rawObjectInfo], rawObjectInfoError], [[rawWorkspaceInfo], rawWorkspaceInfoError]] = await Promise.all([\n    //             workspaceClient.callFunc('get_object_info3', [{\n    //                 objects: [{\n    //                     wsid: workspaceId,\n    //                     // TODO: fix this!!\n    //                     objid: 1\n    //                 }],\n    //                 includeMetadata: 1,\n    //                 ignoreErrors: 0\n    //             }]),\n    //             workspaceClient.callFunc('get_workspace_info', [{\n    //                 id: workspaceId\n    //             }])\n    //         ])\n\n    //         if (rawObjectInfoError || rawWorkspaceInfoError) {\n    //             // console.warn('narrative not accessible', rawObjectInfoError, rawWorkspaceInfoError)\n    //             return null\n    //         }\n\n    //         const workspaceInfo: NarrativeWorkspaceInfo = workspaceApi.workspaceInfoToObject(rawWorkspaceInfo) as NarrativeWorkspaceInfo\n\n    //         return {\n    //             workspaceId: workspaceInfo.id,\n    //             title: workspaceInfo.metadata.narrative_nice_name || 'Unknown',\n    //             permission: orgModel.userPermissionToWorkspacePermission(workspaceInfo.userPermission, workspaceInfo.owner === this.params.username),\n    //             isPublic: workspaceInfo.globalReadPermission\n    //         }\n\n    //     } catch (ex) {\n    //         // assume it is an inaccessible workspace\n    //         // console.warn('narrative not accessible', ex)\n    //         return null\n    //     }\n    // }\n\n    getSorter(sort: Sort) {\n        switch (sort) {\n            case Sort.TITLE:\n                return (a: OrganizationNarrative, b: OrganizationNarrative) => {\n                    return a.narrative.title.localeCompare(b.narrative.title)\n                }\n            case Sort.LAST_SAVED:\n                return (a: OrganizationNarrative, b: OrganizationNarrative) => {\n                    return b.narrative.lastSavedAt.getTime() - a.narrative.lastSavedAt.getTime()\n                }\n            default:\n                throw new Error('invalid sort spec')\n        }\n    }\n\n    // sortNarratives(narratives: Array<AccessibleNarrative>, sort: Sort): Array<AccessibleNarrative> {\n    //     let sorter = this.getSorter(sort)\n\n    //     return narratives.sort(sorter)\n    // }\n\n    sortOrganizationNarratives(narratives: Array<OrganizationNarrative>, sort: Sort): Array<OrganizationNarrative> {\n        let sorter = this.getSorter(sort)\n\n        return narratives.sort(sorter).slice(0)\n    }\n\n    /*\n    getNarrative fetches the requested narrative and returns a Narrative object if found \n    and null otherwise. Note that this ignores the narrative state vis-a-vis any organization.\n    It also caches narratives.\n    */\n    async getNarrative(workspaceId: WorkspaceID): Promise<Narrative> {\n        const workspaceClient = new AuthorizedGenericClient({\n            module: 'Workspace',\n            url: this.params.workspaceServiceURL,\n            token: this.params.token\n        })\n        try {\n            const [rawWorkspaceInfo, rawWorkspaceInfoError] = await workspaceClient.callFunc('get_workspace_info', [{\n                id: workspaceId\n            }])\n\n\n            if (rawWorkspaceInfoError) {\n                return {\n                    workspaceId: workspaceId,\n                    access: NarrativeAccess.NONE\n                }\n            }\n\n            const workspaceInfo: NarrativeWorkspaceInfo = workspaceApi.workspaceInfoToObject(rawWorkspaceInfo[0]) as NarrativeWorkspaceInfo\n\n            const narrativeId = workspaceInfo.metadata.narrative\n            if (!narrativeId) {\n                return {\n                    workspaceId: workspaceId,\n                    access: NarrativeAccess.NONE\n                }\n            }\n            const objectId = parseInt(narrativeId, 10)\n\n            const [rawObjectInfo, rawObjectInfoError] = await workspaceClient.callFunc('get_object_info3', [{\n                objects: [{\n                    wsid: workspaceId,\n                    objid: objectId\n                }],\n                includeMetadata: 1,\n                ignoreErrors: 0\n            }])\n\n            if (rawObjectInfoError) {\n                return {\n                    workspaceId: workspaceId,\n                    access: NarrativeAccess.NONE\n                }\n            }\n\n            const objectInfo: workspaceApi.ObjectInfo = workspaceApi.objectInfoToObject(rawObjectInfo[0].infos[0])\n\n            let access: NarrativeAccess.VIEW | NarrativeAccess.EDIT | NarrativeAccess.ADMIN | NarrativeAccess.OWNER\n            switch (workspaceInfo.userPermission) {\n                case 'n':\n                    if (workspaceInfo.globalReadPermission) {\n                        access = NarrativeAccess.VIEW\n                        break\n                    } else {\n                        throw new Error('Cannot have no access and no global read permission!')\n                    }\n                case 'r':\n                    access = NarrativeAccess.VIEW\n                    break\n                case 'w':\n                    access = NarrativeAccess.EDIT\n                    break\n                case 'a':\n                    if (workspaceInfo.owner === this.params.username) {\n                        access = NarrativeAccess.OWNER\n                    } else {\n                        access = NarrativeAccess.ADMIN\n                    }\n                    break\n                default:\n                    throw new Error('Unknown workspace permission: ' + workspaceInfo.userPermission)\n            }\n\n            return {\n                workspaceId: workspaceInfo.id,\n                access: access,\n                isPublic: workspaceInfo.globalReadPermission,\n                objectId: objectInfo.id,\n                title: workspaceInfo.metadata.narrative_nice_name || 'Unknown',\n                owner: workspaceInfo.owner,\n                lastSavedAt: objectInfo.savedAt,\n                lastSavedBy: objectInfo.savedBy\n            }\n        } catch (ex) {\n            console.error('Error fetching narrative!', ex)\n            throw ex\n        }\n    }\n}\n","export type Metadata = {}\n\nexport type RawObjectInfo = [\n    number, // objid - object id\n    string, // name - object name\n    string, // type - object type\n    string, // save_date - iso8601 timestamp when last saved\n    number, // ver - object version\n    string, // saved_by - username who saved it last\n    number, // wsid - workspace id\n    string, // workspace - workspace name,\n    string, // chsum - checksum of the object\n    number, // size - size of the object (bytes)\n    Metadata   // meta - string to string object of stuff\n]\n\nexport type RawWorkspaceInfo = [\n    number, // id - workspace id\n    string, // workspace - workspace name\n    string, // owner - username who owns it\n    string, // moddate - iso8601 timestamp when last modified\n    number, // max_objid - last object id assigned to object in workspace\n    string, // user_permission - permission of user who made reqeust wrt workspace\n    string, // globalread - int bool whether this workspace is shared globally\n    string, // lockstat - status of the workspace lock\n    Metadata // metadata\n]\n\nexport interface WorkspaceInfo {\n    id: number\n    name: string\n    owner: string\n    modifiedAt: Date\n    objectCount: number\n    userPermission: string\n    globalReadPermission: boolean\n    lockStatus: string\n    metadata: Metadata\n}\n\nexport interface ObjectInfo {\n    id: number\n    name: string\n    type: {\n        module: string\n        name: string\n        majorVersion: number\n        minorVersion: number\n        id: string\n    }\n    version: number\n    savedAt: Date\n    savedBy: string\n    workspaceId: number\n    workspaceName: string\n    checksum: string\n    size: number\n    ref: string\n    metadata: Metadata\n}\n\nfunction iso8601ToDate(dateString: string) {\n    const isoRE = /(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)T(\\d\\d):(\\d\\d):(\\d\\d)([\\+\\-])(\\d\\d)(:?[\\:]*)(\\d\\d)/;\n    const dateParts = isoRE.exec(dateString);\n    if (!dateParts) {\n        throw new TypeError('Invalid Date Format for ' + dateString);\n    }\n    // This is why we do this -- JS insists on the colon in the tz offset.\n    const offset = dateParts[7] + dateParts[8] + ':' + dateParts[10];\n    const newDateString = dateParts[1] + '-' + dateParts[2] + '-' + dateParts[3] + 'T' + dateParts[4] + ':' + dateParts[5] + ':' + dateParts[6] + offset;\n    return new Date(newDateString);\n}\n\nexport function workspaceInfoToObject(wsInfo: RawWorkspaceInfo): WorkspaceInfo {\n    return {\n        id: wsInfo[0],\n        name: wsInfo[1],\n        owner: wsInfo[2],\n        modifiedAt: iso8601ToDate(wsInfo[3]),\n        objectCount: wsInfo[4],\n        userPermission: wsInfo[5],\n        globalReadPermission: wsInfo[6] === 'r' ? true : false,\n        lockStatus: wsInfo[7],\n        metadata: wsInfo[8]\n    }\n}\n\nexport function objectInfoToObject(data: RawObjectInfo): ObjectInfo {\n    const type = data[2].split(/[-.]/)\n\n    return {\n        id: data[0],\n        name: data[1],\n        // type: data[2],\n        type: {\n            id: data[2],\n            module: type[0],\n            name: type[1],\n            majorVersion: parseInt(type[2], 10),\n            minorVersion: parseInt(type[3], 10)\n        },\n        savedAt: iso8601ToDate(data[3]),\n        version: data[4],\n        savedBy: data[5],\n        workspaceId: data[6],\n        workspaceName: data[7],\n        checksum: data[8],\n        size: data[9],\n        metadata: data[10],\n        ref: data[6] + '/' + data[0] + '/' + data[4]\n    }\n}\n\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as userModel from '../../data/models/user'\nimport * as orgModel from '../../data/models/organization/model'\nimport * as narrativeModel from '../../data/models/narrative'\nimport { AppError, StoreState } from '../../types'\n\nexport interface EntityAction extends Action {\n}\n\nexport interface UserLoader extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER,\n    userId: userModel.Username\n}\n\nexport interface UserLoaderStart extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_START\n}\n\nexport interface UserLoaderSuccess extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_SUCCESS,\n    user: userModel.User\n}\n\nexport interface UserLoaderError extends EntityAction {\n    type: ActionFlag.ENTITY_USER_LOADER_ERROR,\n    error: AppError\n}\n\n\nexport function userLoaderStart(): UserLoaderStart {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_START\n    }\n}\n\nexport function userLoaderSuccess(user: userModel.User): UserLoaderSuccess {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_SUCCESS,\n        user: user\n    }\n}\n\nexport function userLoaderError(error: AppError): UserLoaderError {\n    return {\n        type: ActionFlag.ENTITY_USER_LOADER_ERROR,\n        error: error\n    }\n}\n\nexport function userLoader(userId: userModel.Username) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(userLoaderStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const model = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        try {\n            const user = await model.getUser(userId)\n            dispatch(userLoaderSuccess(user))\n        } catch (ex) {\n            dispatch(userLoaderError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n    }\n}\n\n\nexport interface OrganizationLoader extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface OrganizationLoaderStart extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_START\n}\n\nexport interface OrganizationLoaderSuccess extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS,\n    organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization\n}\n\nexport interface OrganizationLoaderError extends EntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOADER_ERROR,\n    error: AppError\n}\n\n\nexport function organizationLoaderStart(): OrganizationLoaderStart {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_START\n    }\n}\n\nexport function organizationLoaderSuccess(organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization): OrganizationLoaderSuccess {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function organizationLoaderError(error: AppError): OrganizationLoaderError {\n    return {\n        type: ActionFlag.ENTITY_ORGANIZATION_LOADER_ERROR,\n        error: error\n    }\n}\n\nexport function organizationLoader(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(organizationLoaderStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const model = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const organization = await model.getOrg(organizationId)\n            dispatch(organizationLoaderSuccess(organization))\n        } catch (ex) {\n            dispatch(organizationLoaderError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Narratives\n\nexport interface LoadNarrative {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD\n}\n\ninterface LoadNarrativeStart {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_START\n}\n\nexport interface LoadNarrativeSuccess {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS\n    narrative: narrativeModel.Narrative\n}\n\ninterface LoadNarrativeError {\n    type: ActionFlag.ENTITY_NARRATIVE_LOAD_ERROR\n    error: AppError\n}\n\nexport function loadNarrative(workspaceId: narrativeModel.WorkspaceID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(<LoadNarrativeStart>{\n            type: ActionFlag.ENTITY_NARRATIVE_LOAD_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            workspaceServiceURL: config.services.Workspace.url,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        try {\n            const narrative = await narrativeClient.getNarrative(workspaceId)\n            dispatch(<LoadNarrativeSuccess>{\n                type: ActionFlag.ENTITY_NARRATIVE_LOAD_SUCCESS,\n                narrative: narrative\n            })\n        } catch (ex) {\n            dispatch(<LoadNarrativeError>{\n                type: ActionFlag.ENTITY_NARRATIVE_LOAD_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n    }\n}\n\n// Access narrative\n\nexport interface AccessNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface AccessNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n}\n\nexport interface AccessNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface AccessNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\nexport function accessNarrativeStart(): AccessNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n    }\n}\n\nexport function accessNarrativeSuccess(organization: orgModel.Organization): AccessNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function accessNarrativeError(error: AppError): AccessNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function accessNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(accessNarrativeStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'No view model'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: {\n                        organization\n                    }\n                }\n            }\n        } = state\n\n        if (!organization) {\n            return\n        }\n\n        const groupId = organization.id\n        const resourceId = String(narrative.workspaceId)\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.grantNarrativeAccess(groupId, resourceId)\n            const org = await orgClient.getOrg(groupId)\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(accessNarrativeError({\n                    code: 'invalid state',\n                    message: 'Cannot access a Narrative for an inaccessible Organization'\n                }))\n                return\n            }\n            dispatch(accessNarrativeSuccess(org))\n        } catch (ex) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n\n","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport Owner from './Owner'\n\ninterface LoaderProps {\n    username: orgModel.Username\n    user: userModel.User | undefined\n    avatarSize: number\n    showAvatar: boolean\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <Owner user={this.props.user} avatarSize={this.props.avatarSize} showAvatar={this.props.showAvatar} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.username)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\nimport * as orgModel from '../../data/models/organization/model'\n\n\nexport interface OwnProps {\n    username: orgModel.Username\n    avatarSize: number\n    showAvatar: boolean\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.username)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","export function niceElapsed(someDate: Date, absoluteAfter?: number, compactDate: boolean = true) {\n    const nowDate = new Date()\n\n    const elapsed = Math.round((nowDate.getTime() - someDate.getTime()) / 1000);\n    const elapsedAbs = Math.abs(elapsed);\n\n    let measure, measureAbs, unit;\n    const maxDays = absoluteAfter || 90\n    if (elapsedAbs < 60 * 60 * 24 * maxDays) {\n        if (elapsedAbs === 0) {\n            return 'now';\n        } else if (elapsedAbs < 60) {\n            measure = elapsed;\n            measureAbs = elapsedAbs;\n            unit = 'second';\n        } else if (elapsedAbs < 60 * 60) {\n            measure = Math.round(elapsed / 60);\n            measureAbs = Math.round(elapsedAbs / 60);\n            unit = 'minute';\n        } else if (elapsedAbs < 60 * 60 * 24) {\n            measure = Math.round(elapsed / 3600);\n            measureAbs = Math.round(elapsedAbs / 3600);\n            unit = 'hour';\n        } else {\n            measure = Math.round(elapsed / (3600 * 24));\n            measureAbs = Math.round(elapsedAbs / (3600 * 24));\n            unit = 'day';\n        }\n\n        if (measureAbs > 1) {\n            unit += 's';\n        }\n\n        let prefix = null;\n        let suffix = null;\n        if (measure < 0) {\n            prefix = 'in';\n        } else if (measure > 0) {\n            suffix = 'ago';\n        }\n\n        return (prefix ? prefix + ' ' : '') + measureAbs + ' ' + unit + (suffix ? ' ' + suffix : '');\n    } else {\n        // otherwise show the actual date, with or without the year.\n        if (compactDate && nowDate.getFullYear() === someDate.getFullYear()) {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric'\n            }).format(someDate)\n        } else {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric',\n                year: 'numeric'\n            }).format(someDate)\n        }\n    }\n}","import * as React from 'react'\nimport { niceElapsed } from '../lib/time'\nimport { Tooltip } from 'antd';\n\nexport interface NiceElapsedTimeProps {\n    time: Date\n    showTooltip?: boolean\n    tooltipPrefix?: string\n}\n\ninterface NiceElapsedTimeState {\n}\n\nexport default class NiceElapsedTime extends React.Component<NiceElapsedTimeProps, NiceElapsedTimeState> {\n    constructor(props: NiceElapsedTimeProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.showTooltip === false) {\n            return (\n                <span>\n                    {niceElapsed(this.props.time, 30)}\n                </span>\n            )\n        }\n\n        const fullDate = (\n            <span>\n                {\n                    Intl.DateTimeFormat('en-US', {\n                        month: 'short',\n                        day: 'numeric',\n                        year: 'numeric',\n                        hour: 'numeric',\n                        minute: 'numeric',\n                        timeZoneName: 'short'\n                    }).format(this.props.time)\n                }\n            </span>\n        )\n        let tooltip\n        if (this.props.tooltipPrefix) {\n            tooltip = (\n                <span>\n                    {this.props.tooltipPrefix}\n                    {fullDate}\n                </span>\n            )\n        } else {\n            tooltip = fullDate\n        }\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                {niceElapsed(this.props.time, 30)}\n            </Tooltip>\n        )\n    }\n}","import * as React from 'react'\nimport * as orgModel from '../data/models/organization/model'\nimport { NavLink } from 'react-router-dom'\nimport OrgLogo from './OrgLogo'\nimport { Icon, Tooltip, Menu, Dropdown, Modal } from 'antd'\nimport Owner from './entities/OwnerContainer'\nimport { ComponentView } from '../types'\nimport './BriefOrganization.css'\nimport NiceElapsedTime from './NiceElapsedTime';\n\nexport interface BriefOrganizationProps {\n    organization: orgModel.BriefOrganization\n    openRequestsStatus: orgModel.RequestStatus | null\n}\n\ninterface BriefOrganizationState {\n    view: ComponentView\n}\n\nfunction reverseView(v: ComponentView) {\n    switch (v) {\n        case ComponentView.COMPACT:\n            return ComponentView.NORMAL\n        case ComponentView.NORMAL:\n            return ComponentView.COMPACT\n    }\n}\n\nexport default class BriefOrganization extends React.Component<BriefOrganizationProps, BriefOrganizationState> {\n    constructor(props: BriefOrganizationProps) {\n        super(props)\n        this.state = {\n            view: ComponentView.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderLogo(org: orgModel.BriefOrganization) {\n        return (\n            <OrgLogo logoUrl={org.logoUrl} size={80} organizationName={org.name} organizationId={org.id} />\n        )\n    }\n\n    renderHomeUrl(org: orgModel.BriefOrganization) {\n        if (!org.homeUrl) {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    title=\"This organization has not set a home page url\"\n                >\n                    <Icon type=\"home\" style={{ color: 'rgba(200, 200, 200, 0.3)' }} />\n                </Tooltip>\n            )\n        }\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Home page for this Organization (external to KBase)\n                </p>\n            </React.Fragment>\n        )\n        return (\n            <div className=\"BriefOrganization-homeUrl\">\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title={tooltip}\n                >\n                    <a href={org.homeUrl} target=\"_blank\">\n                        <Icon type=\"home\" />\n                    </a>\n                </Tooltip>\n            </div >\n        )\n    }\n\n    renderNarrativeCount(org: orgModel.BriefOrganization) {\n        if (!org.narrativeCount) {\n            return (\n                <span style={{ color: 'gray' }}>\n                    Ø\n                </span>\n            )\n        }\n        return (\n            <span>\n                {org.narrativeCount}\n            </span>\n        )\n    }\n\n    renderMemberCount(org: orgModel.BriefOrganization) {\n        if (org.memberCount == 1) {\n            return (\n                <span style={{ color: 'gray' }}>\n                    Ø\n                </span>\n            )\n        }\n        return (\n            <span>\n                {org.memberCount - 1}\n            </span>\n        )\n    }\n\n    renderRelation(org: orgModel.BriefOrganization) {\n        switch (org.relation) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <span>\n                            <Icon type=\"stop\" />\n                        </span>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <Icon type=\"stop\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"Your membership request is pending\"\n                    >\n                        <Icon type=\"user\" style={{ color: 'orange' }} /> Your membership <b>request</b> is pending\n                </Tooltip>\n                )\n\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You have been invited to join this organization\"\n                    >\n                        <Icon type=\"user\" style={{ color: 'blue' }} />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are a member of this organization\"\n                    >\n                        <Icon type=\"user\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are an administrator of this organization\"\n                    >\n                        <Icon type=\"robot\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are the owner of this organization\"\n                    >\n                        <Icon type=\"crown\" />\n                    </Tooltip>\n                )\n        }\n    }\n\n    renderPrivacy() {\n        const org = this.props.organization\n        if (org.isPrivate) {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title=\"This organization is private - may only be viewed by members\">\n                    <span>\n                        <Icon type=\"unlock\" />\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title=\"This organization is public - may be viewed by any KBase user\">\n                    <span>\n                        <Icon type=\"global\" />\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderOrgFreshness(org: orgModel.BriefOrganization) {\n        const isNew = org.lastVisitedAt && (org.modifiedAt.getTime() > org.lastVisitedAt.getTime())\n        let newAlert\n        if (isNew) {\n            const title = 'This org has changed since your last visit to it; new or updated items are highlighted'\n            newAlert = (\n                <div>\n                    <Tooltip placement=\"topRight\" title={title}>\n                        <span style={{ color: 'red', fontSize: '120%' }}>\n                            {/* ● */}\n                            <Icon type=\"bell\" theme=\"filled\" />\n                        </span>\n                    </Tooltip>\n                </div>\n            )\n        } else {\n            newAlert = (\n                <div>\n                    <span style={{ color: 'transparent', fontSize: '120%' }}>\n                        <Icon type=\"bell\" theme=\"filled\" />\n                    </span>\n                </div>\n            )\n        }\n\n        const hasRequests = false\n\n        let requestsAlert\n        if (hasRequests) {\n            requestsAlert = (\n                <div>\n                    <Icon type=\"bulb\" style={{ color: \"blue\" }} />\n                </div>\n            )\n        } else {\n            requestsAlert = null\n        }\n\n        return (\n            <div>\n                {newAlert}\n                {requestsAlert}\n            </div>\n        )\n    }\n\n    renderRequests() {\n        if (!(this.props.organization.relation === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.organization.relation === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        let message\n        let iconColor\n        switch (this.props.openRequestsStatus) {\n            case orgModel.RequestStatus.NONE:\n                // case null:\n                message = 'There are no open requests for this organization'\n                iconColor = 'rgba(200, 200, 200, 0.3)'\n                break\n            case orgModel.RequestStatus.NEW:\n                message = 'There are new requests since you last visited this organization'\n                iconColor = 'red'\n                break\n            case orgModel.RequestStatus.OLD:\n                message = 'There are open requests for this organization'\n                iconColor = 'blue'\n                break\n            case orgModel.RequestStatus.INAPPLICABLE:\n                return\n            default:\n                console.warn('Invalid open request status: ' + this.props.openRequestsStatus)\n                return\n        }\n        const title = (\n            <span>\n                {message}\n            </span>\n        )\n        return (\n            <Tooltip\n                placement=\"topRight\"\n                title={title}>\n                <span style={{ color: iconColor, fontSize: '80%' }}>\n                    <Icon type=\"mail\" theme=\"filled\" />\n                </span>\n            </Tooltip>\n        )\n    }\n\n    renderPermalink() {\n        const permalink = (\n            <div>\n                <p>\n                    Below is the \"permalink\" for this organization. You may copy\n                    this url and use it to access this organization in a web browser.\n                </p>\n                <p style={{ fontFamily: 'monospace', fontWeight: 'bold' }}>\n                    {window.location.origin}/#org/{this.props.organization.id}\n                </p>\n            </div>\n        )\n        const menuClick = ({ key }: { key: string }) => {\n            Modal.info({\n                title: 'Org Permalink',\n                content: permalink\n            })\n        }\n        const menu = (\n            <Menu\n                onClick={menuClick}\n            >\n                <Menu.Item key=\"view\">\n                    View Permalink\n                </Menu.Item>\n            </Menu>\n        )\n        return (\n            <Dropdown\n                overlay={menu}\n                trigger={['click', 'contextMenu']}>\n                <a href={\"/#orgs/\" + this.props.organization.id}>\n                    <Icon type=\"link\" />\n                </a>\n            </Dropdown>\n        )\n    }\n\n    renderLogoColumn(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                <div className=\"BriefOrganization-logoRow\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderLogo(org)}\n                    </NavLink>\n                </div>\n                <div className=\"BriefOrganization-statusRow\">\n                    <div className=\"BriefOrganization-relationCol\">\n                        {this.renderRelation(org)}\n                    </div>\n                    <div className=\"BriefOrganization-privacyCol\">\n                        {this.renderPrivacy()}\n                    </div>\n\n                    <div className=\"BriefOrganization-homeLinkCol\">\n                        {this.renderHomeUrl(org)}\n                    </div>\n                </div>\n                <div className=\"BriefOrganization-freshnessRow\">\n                    <div className=\"BriefOrganization-orgFreshnessCol\">\n                        {this.renderOrgFreshness(org)}\n                    </div>\n                    <div className=\"BriefOrganization-openRequestsCol\">\n                        {this.renderRequests()}\n                    </div>\n                    <div className=\"BriefOrganization-openNewRequestsCol\">\n                        {this.renderPermalink()}\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    fullTimestamp(d: Date) {\n        return Intl.DateTimeFormat('en-US', {\n            month: 'short',\n            day: 'numeric',\n            year: 'numeric',\n            hour: 'numeric',\n            minute: 'numeric',\n            second: 'numeric',\n            timeZoneName: 'short'\n        }).format(d)\n    }\n\n    renderInfoCol(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                <div className=\"BriefOrganization-researchInterests BriefOrganization-infoTableRow\">\n                    {org.researchInterests}\n                </div>\n\n                <div className=\"BriefOrganization-orgOwner BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label BriefOrganization-fieldLabel\">owner</span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {/* TODO: render as Member or Owner component */}\n                        <Owner username={org.owner.username} avatarSize={16} showAvatar={false} />\n                    </div>\n                </div>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label BriefOrganization-fieldLabel\">created</span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {/* {niceElapsed(org.createdAt, 30)} */}\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title={this.fullTimestamp(org.createdAt)}>\n                            <span>\n                                {Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(org.createdAt)}\n                            </span>\n                        </Tooltip>\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderMemberRow(org: orgModel.BriefOrganization) {\n        const memberCount = org.memberCount - 1\n        let memberCountTooltip\n        if (memberCount) {\n            if (memberCount === 1) {\n                memberCountTooltip = (\n                    <span>\n                        There is <b>1</b> member in this organization\n                    </span>\n                )\n            } else {\n                memberCountTooltip = (\n                    <span>\n                        There are <b>{memberCount}</b> members in this organization\n                    </span>\n                )\n            }\n        } else {\n            memberCountTooltip = (\n                <span>\n                    There are <b>no members</b> in this organization\n                </span>\n            )\n        }\n        return (\n            <Tooltip placement=\"bottomRight\" title={memberCountTooltip}>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"team\" /></span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {this.renderMemberCount(org)}\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderNarrativeRow(org: orgModel.BriefOrganization) {\n        const count = org.narrativeCount\n        let tooltip\n        if (count) {\n            if (count === 1) {\n                tooltip = (\n                    <span>\n                        There is <b>1</b> narrative in this organization\n                    </span>\n                )\n            } else {\n                tooltip = (\n                    <span>\n                        There are <b>{count}</b> narratives in this organization\n                    </span>\n                )\n            }\n        } else {\n            tooltip = (\n                <span>\n                    There are <b>no narratives</b> in this organization\n                </span>\n            )\n        }\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"file\" /></span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        {this.renderNarrativeCount(org)}\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderModifiedRow(org: orgModel.BriefOrganization) {\n        const tooltip = (\n            <span>\n                This organization was last updated\n                {' '}\n                <NiceElapsedTime time={org.modifiedAt} showTooltip={false} />\n            </span>\n        )\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                <div className=\"BriefOrganization-orgCreated BriefOrganization-infoTableRow\">\n                    <div className=\"BriefOrganization-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"save\" /></span>\n                    </div>\n                    <div className=\"BriefOrganization-infoTableCol2\">\n                        <NiceElapsedTime time={org.modifiedAt} showTooltip={false} />\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderStatsCol(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                {this.renderMemberRow(org)}\n                {this.renderNarrativeRow(org)}\n                {this.renderModifiedRow(org)}\n            </React.Fragment>\n        )\n    }\n\n    renderNormal() {\n        const org = this.props.organization\n        return (\n            <div className=\"BriefOrganization\">\n                <div className=\"BriefOrganization-body\">\n                    {/* <div className=\"BriefOrganization-freshnessCol\">\n                        {this.renderFreshness(org)}\n                    </div> */}\n                    <div className=\"BriefOrganization-logoCol\">\n                        {this.renderLogoColumn(org)}\n                    </div>\n                    <div className=\"BriefOrganization-infoCol\">\n                        <div className=\"BriefOrganization-infoCol-row\">\n                            <div className=\"BriefOrganization-infoCol-col1\">\n                                <div className=\"BriefOrganization-orgName BriefOrganization-infoTableRow\">\n                                    <NavLink to={`/viewOrganization/${org.id}`}>\n                                        {org.name}\n                                    </NavLink>\n                                </div>\n                            </div>\n                        </div>\n                        <div className=\"BriefOrganization-infoCol-row\">\n                            <div className=\"BriefOrganization-infoCol-col1\">\n                                {this.renderInfoCol(org)}\n                            </div>\n                            <div className=\"BriefOrganization-infoCol-col2\">\n                                {this.renderStatsCol(org)}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div >\n        )\n    }\n\n    render() {\n        return this.renderNormal()\n    }\n}\n","import * as React from 'react';\nimport './component.css';\nimport { Alert } from 'antd';\nimport * as orgModel from '../../../../data/models/organization/model'\nimport BriefOrganization from '../../../BriefOrganization';\n\n// TODO: need more ergonomic way to resolve the common issue of data types interfering with \n// component types.\n\nexport interface OrganizationsProps {\n    organizations: Array<orgModel.BriefOrganization>\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n}\n\nexport interface OrganizationsState {\n    searchTerms: Array<string>\n}\n\nexport class Organizations extends React.Component<OrganizationsProps, OrganizationsState> {\n    constructor(props: OrganizationsProps) {\n        super(props)\n\n        this.state = {\n            searchTerms: []\n        }\n    }\n\n    renderAdminInfo(org: orgModel.Organization) {\n        return (\n            <div>\n                disabled\n            </div>\n        )\n    }\n\n    pluralize(count: number, singular: string, plural: string) {\n        if (count === 0 || count > 1) {\n            return plural\n        }\n        return singular\n    }\n\n    renderOrgs() {\n        if (this.props.organizations.length > 0) {\n            return (\n                this.props.organizations.map((organization, index) => {\n                    const status = this.props.openRequests.get(organization.id) || null\n                    return (\n                        <div key={String(index)} className=\"simpleCard\">\n                            <BriefOrganization organization={organization} openRequestsStatus={status} />\n                        </div>\n                    )\n                })\n            )\n        } else {\n            return (\n                <Alert type=\"warning\"\n                    style={{ maxWidth: '20em', margin: '20px auto 0 auto' }}\n                    message=\"Sorry, no organizations were found.\" />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Organizations\">\n                <div style={{ overflowY: 'auto', display: 'flex', flexDirection: 'column' }}>\n                    {this.renderOrgs()}\n                </div>\n            </div >\n        )\n    }\n}\n\nexport default Organizations;","import { Organizations, OrganizationsProps } from './component';\nimport { StoreState } from '../../../../types';\nimport { connect } from 'react-redux';\n\nexport function mapStateToProps(state: StoreState): OrganizationsProps {\n    // TODO: wow, should not do this here\n    if (state.views.browseOrgsView.viewModel === null) {\n        throw new Error('view not ready')\n    }\n    const {\n        views: {\n            browseOrgsView: {\n                viewModel: { organizations, openRequests }\n            }\n        }\n    } = state;\n\n    // associate the last visited by id with the org.\n    // const updatedOrgs = organizations.map((org: BriefOrganization) => {\n    //     const lastVisitedAt = lastVisitedAtById.get(org.id) || null\n    //     if (lastVisitedAt && lastVisitedAt.lastVisitedAt) {\n    //         return {\n    //             organization: org,\n    //             lastVisitedAt: lastVisitedAt.lastVisitedAt\n    //         }\n    //     } else {\n    //         return {\n    //             organization: org,\n    //             lastVisitedAt: null\n    //         }\n    //     }\n    // })\n\n    return {\n        organizations, openRequests\n    }\n}\n\nexport default connect(mapStateToProps)(Organizations);","import * as React from 'react'\nimport Organizations from './organizations/container'\nimport { SortDirection, AppError } from '../../../types'\nimport { Button, Icon, Radio, Select, Modal, Alert, Checkbox } from 'antd'\nimport { RadioChangeEvent } from 'antd/lib/radio'\nimport { CheckboxValueType } from 'antd/lib/checkbox/Group'\nimport { Filter } from '../../../data/models/organization/model'\nimport MainMenu from '../../menu/component'\nimport { NavLink } from 'react-router-dom'\nimport './component.css'\n\nexport interface OrganizationsBrowserProps {\n    totalCount: number;\n    filteredCount: number;\n    sortBy: string;\n    filter: Filter;\n    searching: boolean;\n    error: AppError | null;\n    onSearchOrgs: (searchTerms: Array<string>) => void;\n    onSortOrgs: (sortField: string, sortDirection: SortDirection) => void;\n    onFilterOrgs: (filter: Filter) => void;\n}\n\nexport interface OrganizationsBrowserState {\n    searchInput: string\n    filterByRoleType: string\n    filterByRole: Array<CheckboxValueType>\n    filterByPrivacy: string\n    showAdvancedControls: boolean\n    // filterByPrivacyType: Array<CheckboxValueType>\n}\n\nclass OrganizationsBrowser extends React.Component<OrganizationsBrowserProps, OrganizationsBrowserState> {\n    searchInput: React.RefObject<HTMLInputElement>;\n    searchButton: React.RefObject<Button>;\n    filterByRoleValues: Array<any>\n\n    constructor(props: OrganizationsBrowserProps) {\n        super(props)\n\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.filterByRoleValues = [\n            {\n                label: 'Member',\n                value: 'member'\n            },\n            {\n                label: 'Admin',\n                value: 'admin'\n            },\n            {\n                label: 'Owner',\n                value: 'owner'\n            }\n        ]\n\n        this.state = {\n            searchInput: '',\n            filterByRoleType: 'myorgs',\n            filterByRole: [],\n            filterByPrivacy: 'any',\n            showAdvancedControls: false\n        }\n    }\n\n    // https://reactjs.org/docs/react-component.html#componentdidmount\n    componentDidMount() {\n        this.props.onSearchOrgs([])\n    }\n\n    doSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        const searchTerms = this.searchInput.current.value.split(/[\\s+]/)\n        // dispatch the search event\n        this.props.onSearchOrgs(searchTerms);\n    }\n\n    haveSearchInput() {\n        if (this.state.searchInput && this.state.searchInput.length > 0) {\n            return true\n        }\n        return false\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.setState({ searchInput: currentSearchInputValue })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.doSearch()\n    }\n\n    onSortByChange(value: string) {\n        switch (value) {\n            case 'owner':\n                this.props.onSortOrgs('owner', SortDirection.ASCENDING)\n                break\n            case 'name':\n                this.props.onSortOrgs('name', SortDirection.ASCENDING)\n                break\n            case 'recentlyAdded':\n                this.props.onSortOrgs('created', SortDirection.DESCENDING)\n                break\n            case 'recentlyChanged':\n                this.props.onSortOrgs('changed', SortDirection.DESCENDING)\n                break\n            case 'memberCount':\n                this.props.onSortOrgs('memberCount', SortDirection.DESCENDING)\n                break\n            case 'narrativeCount':\n                this.props.onSortOrgs('narrativeCount', SortDirection.DESCENDING)\n                break\n        }\n    }\n\n    onSortDirectionChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(this.props.sortBy, e.target.value)\n    }\n\n    onFilterByRoleTypeChange(e: RadioChangeEvent) {\n        let newFilter: Filter\n        this.setState({ filterByRoleType: e.target.value })\n        if (e.target.value === 'select') {\n            this.setState({ filterByRole: [] })\n            newFilter = {\n                ...this.props.filter,\n                roleType: e.target.value\n            }\n        } else {\n            newFilter = {\n                ...this.props.filter,\n                roleType: e.target.value,\n                roles: []\n            }\n            this.setState({ filterByRole: [] })\n        }\n        this.props.onFilterOrgs(newFilter)\n    }\n\n    onFilterByRoleChange(checkedValues: CheckboxValueType[]) {\n        let newFilter: Filter\n        this.setState({ filterByRole: checkedValues })\n        if (checkedValues.length === 0) {\n            this.setState({ filterByRoleType: 'myorgs' })\n            newFilter = {\n                ...this.props.filter,\n                roleType: 'myorgs',\n                roles: checkedValues\n            } as Filter\n        } else {\n            this.setState({ filterByRoleType: 'select' })\n            newFilter = {\n                ...this.props.filter,\n                roleType: 'select',\n                roles: checkedValues\n            } as Filter\n        }\n\n        this.props.onFilterOrgs(newFilter)\n    }\n\n    onFilterByPrivacyChange(e: RadioChangeEvent) {\n        this.setState({ filterByPrivacy: e.target.value })\n        const newFilter = {\n            ...this.props.filter,\n            privacy: e.target.value\n        } as Filter\n        this.props.onFilterOrgs(newFilter)\n    }\n\n    onClearSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        this.searchInput.current.value = ''\n        this.onSearchInputChange()\n        this.doSearch()\n    }\n\n    renderSearchFeedback() {\n        if (this.props.totalCount === 0) {\n            return (\n                <div className=\"OrganizationsBrowser-searchFeedback\">\n                    None available\n                </div>\n            )\n        }\n        if (this.props.filteredCount === 0) {\n            return (\n                <div className=\"OrganizationsBrowser-searchFeedback\">\n                    Ø\n                    /\n                    {this.props.totalCount}\n                    {' '}\n                    orgs\n                </div>\n            )\n\n        }\n        if (this.props.totalCount === this.props.filteredCount) {\n            return (\n                <div className=\"OrganizationsBrowser-searchFeedback\">\n                    <b>{this.props.totalCount}</b>\n                    {' '}\n                    orgs\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"OrganizationsBrowser-searchFeedback\">\n                <b>{this.props.filteredCount}</b>\n                /\n                {this.props.totalCount}\n                {' '}\n                orgs\n            </div>\n        )\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchForm() {\n        return (\n            <form id=\"searchForm\" className=\"OrganizationsBrowser-searchBar\" onSubmit={this.onSubmit.bind(this)}>\n                <input\n                    className=\"OrganizationsBrowser-searchInput\"\n                    placeholder=\"Search Organizations\"\n                    onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                    ref={this.searchInput}></input>\n                <Button\n                    disabled={!this.haveSearchInput()}\n                    ref={this.searchButton}\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                </Button>\n                <Button\n                    onClick={this.onClearSearch.bind(this)}\n                    disabled={!this.haveSearchInput()}\n                    icon=\"close\"\n                >\n                </Button>\n                {this.renderSearchFeedback()}\n            </form>\n        )\n    }\n\n    renderSearchBar() {\n        return (\n            <div className=\"OrganizationsBrowser-searchBarRow\">\n                <div className=\"OrganizationsBrowser-searchBarCol1\">\n                    {this.renderSearchForm()}\n                </div>\n                <div className=\"OrganizationsBrowser-searchBarCol2\">\n                    <NavLink to=\"/newOrganization\"><Button icon=\"plus-circle\" style={{ marginRight: '10px' }}>Create Organization</Button></NavLink>\n\n                </div>\n                {/* <div className=\"OrganizationsBrowser-searchBarCol3\">\n                </div> */}\n            </div>\n        )\n    }\n\n    renderSortByControl() {\n        return (\n            <Select\n                onChange={this.onSortByChange.bind(this)}\n                defaultValue={this.props.sortBy}\n                dropdownMatchSelectWidth={true}\n                style={{ width: '10em' }}>\n                <Select.Option value=\"recentlyChanged\" key=\"changed\">Date Changed</Select.Option>\n                <Select.Option value=\"recentlyAdded\" key=\"recent\">Date Established</Select.Option>\n                <Select.Option value=\"name\" key=\"name\">Org Name</Select.Option>\n                <Select.Option value=\"memberCount\" key=\"memberCount\"># members</Select.Option>\n                <Select.Option value=\"narrativeCount\" key=\"narrativeCount\"># narratives</Select.Option>\n            </Select>\n        )\n    }\n\n    onToggleAdvanced() {\n        // When switching back to basic filter mode, we need to ensure that advanced \n        // filtering is removed.\n        if (this.state.showAdvancedControls) {\n            this.setState({ showAdvancedControls: false })\n            let { roleType, roles, privacy } = this.props.filter\n            if (!['myorgs', 'all'].includes(roleType)) {\n                roleType = 'myorgs'\n                this.setState({ filterByRoleType: 'myorgs' })\n            }\n            this.setState({ filterByRole: [], filterByPrivacy: 'any' })\n            roles = []\n            privacy = 'any'\n            this.props.onFilterOrgs({\n                roleType, roles, privacy\n            })\n        } else {\n            this.setState({ showAdvancedControls: true })\n        }\n    }\n\n    renderAdvancedToggle() {\n        if (this.state.showAdvancedControls) {\n            return (\n                <Icon\n                    type=\"ellipsis\"\n                    className=\"IconButton-hover-pressed\"\n                    onClick={this.onToggleAdvanced.bind(this)} />\n            )\n        } else {\n            return (\n                <Icon\n                    type=\"ellipsis\"\n                    className=\"IconButton-hover\"\n                    onClick={this.onToggleAdvanced.bind(this)} />\n            )\n        }\n    }\n\n    renderFilterByRole() {\n        const radioStyle = {\n            display: 'block',\n            height: '30px',\n            lineHeight: '30px'\n        }\n        if (this.state.showAdvancedControls) {\n            return (\n                <React.Fragment>\n                    <Radio.Group\n                        onChange={this.onFilterByRoleTypeChange.bind(this)}\n                        value={this.state.filterByRoleType}>\n\n                        <Radio value=\"myorgs\" style={radioStyle}>My Orgs</Radio>\n                        <Radio value=\"all\" style={radioStyle}>All Orgs</Radio>\n                        {this.renderAdvancedToggle()}\n                        <Radio value=\"notmyorgs\" style={radioStyle}>Not My Orgs</Radio>\n                        <Radio value=\"select\" style={radioStyle}>Specific Role</Radio>\n                    </Radio.Group>\n\n                    <Checkbox.Group\n                        options={this.filterByRoleValues}\n                        value={this.state.filterByRole}\n                        className=\"OrganizationsBrowser-checkboxGroup\"\n                        onChange={this.onFilterByRoleChange.bind(this)} />\n                </React.Fragment>\n            )\n        } else {\n            return (\n                <React.Fragment>\n                    <Radio.Group\n                        onChange={this.onFilterByRoleTypeChange.bind(this)}\n                        value={this.state.filterByRoleType}>\n\n                        <Radio value=\"myorgs\" style={radioStyle}>My Orgs</Radio>\n                        <Radio value=\"all\" style={radioStyle}>All Orgs</Radio>\n                        {this.renderAdvancedToggle()}\n                    </Radio.Group>\n                </React.Fragment>\n            )\n        }\n    }\n\n    renderFilterByPrivacy() {\n        if (!this.state.showAdvancedControls) {\n            return\n        }\n        const radioStyle = {\n            display: 'block',\n            height: '30px',\n            lineHeight: '30px',\n            margin: '0px'\n        }\n        return (\n            <React.Fragment>\n                <Radio.Group\n                    onChange={this.onFilterByPrivacyChange.bind(this)}\n                    value={this.state.filterByPrivacy}>\n                    <Radio value=\"any\" style={radioStyle}>Any</Radio>\n                    <Radio value=\"public\" style={radioStyle}>Visible</Radio>\n                    <Radio value=\"private\" style={radioStyle}>Hidden</Radio>\n                </Radio.Group>\n            </React.Fragment>\n        )\n    }\n\n    renderOrganizations() {\n        if (this.props.error) {\n            return (\n                <Alert\n                    type=\"error\"\n                    message={this.props.error.code}\n                    description={this.props.error.message} />\n            )\n        } else {\n            return (\n                <Organizations />\n            )\n        }\n    }\n\n    renderFilterColumn() {\n        return (\n            <React.Fragment>\n                <div className=\"field-label\">sort by</div>\n                {this.renderSortByControl()}\n\n                <div className=\"field-label\" style={{ marginTop: '10px' }}>filter</div>\n\n                {this.renderFilterByRole()}\n\n                {this.state.showAdvancedControls ? (\n                    <div className=\"field-label\" style={{ marginTop: '10px' }}>visibility</div>\n                ) : (null)}\n                {this.renderFilterByPrivacy()}\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"OrganizationsBrowser scrollable-flex-column\">\n                {this.renderSearchBar()}\n                <div className=\"OrganizationsBrowser-bodyRow\">\n                    <div className=\"OrganizationsBrowser-bodyCol scrollable-flex-column\">\n                        {this.renderOrganizations()}\n                    </div>\n                    <div className=\"OrganizationsBrowser-filterCol\">\n                        {this.renderFilterColumn()}\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default OrganizationsBrowser","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState,\n    AppError, SortDirection, BrowseOrgsViewModel\n} from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\n\nexport interface Load extends Action<ActionFlag.BROWSE_ORGS_LOAD> {\n    type: ActionFlag.BROWSE_ORGS_LOAD\n}\n\nexport interface LoadStart extends Action<ActionFlag.BROWSE_ORGS_LOAD_START> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_START\n}\n\nexport interface LoadSuccess extends Action<ActionFlag.BROWSE_ORGS_LOAD_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_SUCCESS\n    defaultViewModel: BrowseOrgsViewModel\n}\n\nexport interface LoadError extends Action<ActionFlag.BROWSE_ORGS_LOAD_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_LOAD_ERROR\n    error: AppError\n}\n\nexport interface Unload extends Action<ActionFlag.BROWSE_ORGS_UNLOAD> {\n    type: ActionFlag.BROWSE_ORGS_UNLOAD\n}\n\nfunction loadStart(): LoadStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_START\n    }\n}\n\nfunction loadSuccess(defaultViewModel: BrowseOrgsViewModel): LoadSuccess {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_SUCCESS,\n        defaultViewModel: defaultViewModel\n    }\n}\n\nfunction loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.BROWSE_ORGS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.BROWSE_ORGS_UNLOAD\n    }\n}\n\n// SORTING\n\nexport interface SortOrgs extends Action<ActionFlag.BROWSE_ORGS_SORT> {\n    type: ActionFlag.BROWSE_ORGS_SORT,\n    sortField: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsStart extends Action<ActionFlag.BROWSE_ORGS_SORT_START> {\n    type: ActionFlag.BROWSE_ORGS_SORT_START,\n    sortField: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsSuccess extends Action<ActionFlag.BROWSE_ORGS_SORT_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_SORT_SUCCESS\n}\n\nexport interface SortOrgsError extends Action<ActionFlag.BROWSE_ORGS_SORT_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_SORT_ERROR,\n    error: AppError\n}\n\n\nexport function sortOrgsStart(sortField: string, sortDirection: SortDirection): SortOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SORT_START,\n        sortField: sortField,\n        sortDirection: sortDirection\n    }\n}\n\n// SEARCHING\n\nexport interface SearchOrgs extends Action<ActionFlag.BROWSE_ORGS_SEARCH> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH,\n    searchTerms: Array<string>\n}\n\n// Called upon the start of a search call\n// Sets the ui state to enable a spinner\n// and also search query data to be reflected in the ui\nexport interface SearchOrgs extends Action<ActionFlag.BROWSE_ORGS_SEARCH> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH,\n    searchTerms: Array<string>\n}\n\nexport interface SearchOrgsStart extends Action<ActionFlag.BROWSE_ORGS_SEARCH_START> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_START\n}\n\n// Called upon successful completion of a search\n// Sets the organizations found\nexport interface SearchOrgsSuccess extends Action<ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS\n    organizations: Array<orgModel.BriefOrganization>\n    totalCount: number\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n}\n\n// Called upon a search error\n// Sets error state\nexport interface SearchOrgsError extends Action<ActionFlag.BROWSE_ORGS_SEARCH_ERROR> {\n    type: ActionFlag.BROWSE_ORGS_SEARCH_ERROR\n    error: AppError\n}\n\n\n// searchTerms: Array<string>\nfunction searchOrgsStart(): SearchOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_START\n    }\n}\n\nfunction searchOrgsSuccess(organizations: Array<orgModel.BriefOrganization>, totalCount: number, openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>): SearchOrgsSuccess {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_SUCCESS,\n        organizations: organizations,\n        totalCount: totalCount,\n        openRequests: openRequests\n    }\n}\n\nfunction searchOrgsError(error: AppError): SearchOrgsError {\n    return {\n        type: ActionFlag.BROWSE_ORGS_SEARCH_ERROR,\n        error: error\n    }\n}\n\n// FILTER \n\n// Filter orgs\nexport interface FilterOrgs extends Action<ActionFlag.BROWSE_ORGS_FILTER> {\n    type: ActionFlag.BROWSE_ORGS_FILTER,\n    filter: string\n}\n\nexport interface FilterOrgsStart extends Action<ActionFlag.BROWSE_ORGS_FILTER_START> {\n    type: ActionFlag.BROWSE_ORGS_FILTER_START,\n    filter: orgModel.Filter\n}\n\n\nexport function filterOrgsStart(filter: orgModel.Filter): FilterOrgsStart {\n    return {\n        type: ActionFlag.BROWSE_ORGS_FILTER_START,\n        filter: filter\n    }\n}\n\nexport function load() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        const defaultSearchTerms: Array<string> = []\n        const defaultSortField = 'changed'\n        const defaultSortDirection = SortDirection.DESCENDING\n        const defaultFilter = { roleType: 'myorgs', roles: [], privacy: 'any' }\n\n        try {\n            const { organizations, total } = await orgClient.queryOrgs({\n                searchTerms: defaultSearchTerms,\n                sortField: defaultSortField,\n                sortDirection: defaultSortDirection,\n                filter: defaultFilter,\n                username\n            })\n\n            const adminOrgs = organizations\n                .filter((org) => {\n                    return (\n                        org.relation === orgModel.UserRelationToOrganization.ADMIN ||\n                        org.relation === orgModel.UserRelationToOrganization.OWNER\n                    )\n                })\n                .map((org) => {\n                    return org.id\n                })\n            let openRequests\n            if (adminOrgs.length > 0) {\n                openRequests = await orgClient.getOpenRequestsStatus({ organizationIds: adminOrgs })\n            } else {\n                openRequests = new Map()\n            }\n\n            // dispatch(searchOrgsSuccess(organizations, total, openRequests))\n            // populate default browse orgs props\n            const defaultViewModel: BrowseOrgsViewModel = {\n                rawOrganizations: organizations,\n                organizations: organizations,\n                openRequests: openRequests,\n                totalCount: total,\n                filteredCount: organizations.length,\n                sortField: defaultSortField,\n                sortDirection: defaultSortDirection,\n                filter: defaultFilter,\n                searchTerms: defaultSearchTerms,\n                selectedOrganizationId: null,\n                searching: false,\n                error: null\n            }\n            // done!\n            dispatch(loadSuccess(defaultViewModel))\n        } catch (ex) {\n            console.error('Error querying orgs', ex.name, ex.message)\n            dispatch(searchOrgsError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n// TODO: proper typing here \nexport function searchOrgs(searchTerms: Array<string>) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchOrgsStart())\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { sortField, sortDirection, filter } } = browseOrgsView\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const { organizations, total } = await orgClient.queryOrgs({\n                searchTerms: searchTerms,\n                sortField, sortDirection, filter, username\n            })\n\n            // LEFT OFF HERE\n            // NOW GET THE PENDING REQUESTS...\n            const adminOrgs = organizations\n                .filter((org) => {\n                    return (\n                        org.relation === orgModel.UserRelationToOrganization.ADMIN ||\n                        org.relation === orgModel.UserRelationToOrganization.OWNER\n                    )\n                })\n                .map((org) => {\n                    return org.id\n                })\n            let openRequests\n            if (adminOrgs.length > 0) {\n                openRequests = await orgClient.getOpenRequestsStatus({ organizationIds: adminOrgs })\n            } else {\n                openRequests = new Map()\n            }\n\n            dispatch(searchOrgsSuccess(organizations, total, openRequests))\n        } catch (ex) {\n            console.error('Error querying orgs', ex.name, ex.message)\n            dispatch(searchOrgsError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function sortOrgs(sortField: string, sortDirection: SortDirection) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sortOrgsStart(sortField, sortDirection))\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { searchTerms, filter } } = browseOrgsView\n\n        try {\n            const { organizations, total } = await orgClient.queryOrgs({\n                searchTerms, filter, username,\n                sortField, sortDirection,\n            })\n\n            // LEFT OFF HERE\n            // NOW GET THE PENDING REQUESTS...\n            const adminOrgs = organizations\n                .filter((org) => {\n                    return (\n                        org.relation === orgModel.UserRelationToOrganization.ADMIN ||\n                        org.relation === orgModel.UserRelationToOrganization.OWNER\n                    )\n                })\n                .map((org) => {\n                    return org.id\n                })\n            let openRequests\n            if (adminOrgs.length > 0) {\n                openRequests = await orgClient.getOpenRequestsStatus({ organizationIds: adminOrgs })\n            } else {\n                openRequests = new Map()\n            }\n\n            dispatch(searchOrgsSuccess(organizations, total, openRequests))\n        } catch (ex) {\n            console.error('Error querying orgs', ex.name, ex.message)\n            dispatch(searchOrgsError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function filterOrgs(filter: orgModel.Filter) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(filterOrgsStart(filter))\n\n        const {\n            views: { browseOrgsView },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (browseOrgsView.viewModel === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { viewModel: { searchTerms, sortField, sortDirection } } = browseOrgsView\n\n        try {\n            const { organizations, total } = await orgClient.queryOrgs({\n                searchTerms, filter, username,\n                sortField, sortDirection,\n            })\n\n            // LEFT OFF HERE\n            // NOW GET THE PENDING REQUESTS...\n            const adminOrgs = organizations\n                .filter((org) => {\n                    return (\n                        org.relation === orgModel.UserRelationToOrganization.ADMIN ||\n                        org.relation === orgModel.UserRelationToOrganization.OWNER\n                    )\n                })\n                .map((org) => {\n                    return org.id\n                })\n            let openRequests\n            if (adminOrgs.length > 0) {\n                openRequests = await orgClient.getOpenRequestsStatus({ organizationIds: adminOrgs })\n            } else {\n                openRequests = new Map()\n            }\n\n            dispatch(searchOrgsSuccess(organizations, total, openRequests))\n        } catch (ex) {\n            console.error('Error querying orgs', ex.name, ex.message)\n            dispatch(searchOrgsError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n","import OrganizationsBrowser from './component'\nimport { StoreState, SortDirection, AppError } from '../../../types'\nimport * as actions from '../../../redux/actions/browseOrgs'\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as orgModel from '../../../data/models/organization/model'\n//\n// Typing for the mapState and mapDispatch\n//\n\nexport interface OwnProps {\n    sortBy: string\n}\nexport interface LinkStateProps {\n    organizations: Array<orgModel.BriefOrganization>\n    openRequests: Map<orgModel.OrganizationID, orgModel.RequestStatus>\n    totalCount: number\n    filteredCount: number\n    filter: orgModel.Filter\n    searching: boolean,\n    error: AppError | null\n}\n\nexport interface LinkDispatchProps {\n    onSearchOrgs: (searchTerms: Array<string>) => void,\n    onSortOrgs: (sortField: string, sortDirection: SortDirection) => void,\n    onFilterOrgs: (filter: orgModel.Filter) => void\n}\n\n// note second arg is the component props, but we don't have any component props to merge in.\nexport function mapStateToProps(storeState: StoreState): LinkStateProps {\n    if (!storeState.views.browseOrgsView.viewModel) {\n        throw new Error('No view model!')\n    }\n\n    const {\n        views: {\n            browseOrgsView: {\n                viewModel: {\n                    organizations, openRequests, error,\n                    totalCount, filteredCount, filter, searching }\n            }\n        }\n    } = storeState\n\n    return {\n        organizations,\n        openRequests,\n        totalCount,\n        filteredCount,\n        filter,\n        error,\n        searching: searching\n    }\n\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.SearchOrgs | actions.SortOrgs | actions.FilterOrgs>): LinkDispatchProps {\n    return {\n        onSearchOrgs: (searchTerms: Array<string>) => {\n            // TODO proper typing here\n            dispatch(actions.searchOrgs(searchTerms) as any)\n        },\n        onSortOrgs: (sortBy: string, sortDirection: SortDirection) => {\n            // TODO proper typing here\n            dispatch(actions.sortOrgs(sortBy, sortDirection) as any)\n        },\n        onFilterOrgs: (filter: orgModel.Filter) => {\n            dispatch(actions.filterOrgs(filter) as any)\n        }\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OrganizationsBrowser)","import * as React from 'react'\nimport { ComponentLoadingState, StoreState, BrowseOrgsView } from '../../../types';\nimport Container from './container'\n\n// First the loader component, which takes care of a loading view, error view, and the \n// container.\n\nexport interface LoaderProps {\n    view: BrowseOrgsView\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        const message = (\n            <div>\n                Loading Organizations...\n                {' '}\n                <Spin />\n            </div>\n        )\n        return (\n            <Alert type=\"info\" message={message} style={{\n                width: '20em',\n                padding: '20px',\n                margin: '20px auto'\n            }} />\n        )\n    }\n\n    renderError() {\n        if (!this.props.view.error) {\n            return\n        }\n        return (\n            <div>\n                Error! {this.props.view.error.message}\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container sortBy=\"recentlyChanged\" />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad()\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// THe redux connection\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/browseOrgs'\nimport { Spin, Alert } from 'antd';\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    view: BrowseOrgsView\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.browseOrgsView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, AppError, UIError, UIErrorType, EditableOrganization, EditState, ValidationState, SyncState, ValidationErrorType } from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport Validation from '../../data/models/organization/validation'\n\n// ACTIONS\n\nexport interface Save extends Action<ActionFlag.ADD_ORG_SAVE> {\n    type: ActionFlag.ADD_ORG_SAVE\n}\n\nexport interface SaveStart extends Action<ActionFlag.ADD_ORG_SAVE_START> {\n    type: ActionFlag.ADD_ORG_SAVE_START\n}\n\nexport interface SaveSuccess extends Action<ActionFlag.ADD_ORG_SAVE_SUCCESS> {\n    type: ActionFlag.ADD_ORG_SAVE_SUCCESS,\n    organization: orgModel.Organization\n}\n\nexport interface SaveError extends Action<ActionFlag.ADD_ORG_SAVE_ERROR> {\n    type: ActionFlag.ADD_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Editing\n\nexport interface Load extends Action<ActionFlag.ADD_ORG_LOAD> {\n    type: ActionFlag.ADD_ORG_LOAD;\n}\n\nexport interface LoadStart {\n    type: ActionFlag.ADD_ORG_LOAD_START\n}\n\nexport interface LoadSuccess {\n    type: ActionFlag.ADD_ORG_LOAD_SUCCESS,\n    newOrganization: EditableOrganization\n}\n\nexport interface LoadError {\n    type: ActionFlag.ADD_ORG_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload {\n    type: ActionFlag.ADD_ORG_UNLOAD\n}\n\n// Evaluating state of form \n\nexport interface AddOrgEvaluate extends Action<ActionFlag.ADD_ORG_EVALUATE> {\n    type: ActionFlag.ADD_ORG_EVALUATE\n}\n\nexport interface AddOrgEvaluateOK extends Action<ActionFlag.ADD_ORG_EVALUATE_OK> {\n    type: ActionFlag.ADD_ORG_EVALUATE_OK\n}\n\nexport interface AddOrgEvaluateErrors extends Action<ActionFlag.ADD_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n}\n\n// Updating name field\n\nexport interface UpdateName extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME\n    name: string\n}\n\nexport interface UpdateNameSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS\n    name: string\n}\n\nexport interface UpdateNameError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR\n    name: string,\n    error: ValidationState\n}\n\n// Updating logo url field\n\nexport interface UpdateLogoUrl extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL\n    name: string\n}\n\nexport interface UpdateLogoUrlSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_SUCCESS\n    logoUrl: string | null\n}\n\nexport interface UpdateLogoUrlError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_ERROR\n    logoUrl: string | null,\n    error: ValidationState\n}\n\n// Updating home url field\nexport interface UpdateHomeUrl extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_HOME_URL\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlSuccess extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_SUCCESS\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_ERROR\n    homeUrl: string | null\n    error: ValidationState\n}\n\n// Updating research interests field\nexport interface UpdateResearchInterests extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsSuccess extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR\n    researchInterests: string\n    error: ValidationState\n}\n\n// Updating id Field\n\nexport interface UpdateId extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID,\n    id: string\n}\n\nexport interface UpdateIdSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n    id: string\n}\n\nexport interface UpdateIdError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n    id: string,\n    error: ValidationState\n}\n\nexport interface UpdateIdPass extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_PASS,\n    id: string\n}\n\n// Updating description field\n\nexport interface UpdateDescription extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface UpdateDescriptionSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface UpdateDescriptionError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: ValidationState\n}\n\n// Update is private field\n\nexport interface UpdateIsPrivate extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateSuccess extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateError extends Action<ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_ERROR> {\n    type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_ERROR,\n    error: ValidationState\n}\n\n\n// ACTION CREATORS\n\nexport function saveStart(): SaveStart {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_START\n    }\n}\n\nexport function saveSuccess(org: orgModel.Organization): SaveSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_SUCCESS,\n        organization: org\n    }\n}\n\nexport function saveError(error: AppError): SaveError {\n    return {\n        type: ActionFlag.ADD_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n// Editing\n\nfunction loadStart() {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_START\n    }\n}\n\nfunction loadSuccess(newOrganization: EditableOrganization) {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_SUCCESS,\n        newOrganization: newOrganization\n    }\n}\n\nfunction loadError(error: AppError) {\n    return {\n        type: ActionFlag.ADD_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.ADD_ORG_UNLOAD\n    }\n}\n\n// Evaluate\n\nexport function addOrgEvaluateOk(): AddOrgEvaluateOK {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_OK\n    }\n}\n\nexport function AddOrgEvaluateErrors(): AddOrgEvaluateErrors {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Update Name\n\nexport function updateNameSuccess(name: string): UpdateNameSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function updateNameError(name: string, error: ValidationState): UpdateNameError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\nexport function updateIdSuccess(id: string): UpdateIdSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n        id: id\n    }\n}\n\nexport function updateIdPass(id: string): UpdateIdPass {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_PASS,\n        id: id\n    }\n}\n\n// Update Gravatar Hash\n\nexport function updateLogoUrlSuccess(logoUrl: string | null): UpdateLogoUrlSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,\n        logoUrl: logoUrl\n    }\n}\n\nexport function updateLogoUrlError(logoUrl: string | null, error: ValidationState): UpdateLogoUrlError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_LOGO_URL_ERROR,\n        logoUrl: logoUrl,\n        error: error\n    }\n}\n\n\n// Update Id\n\nexport function updateIdError(id: string, error: ValidationState): UpdateIdError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n        id: id,\n        error: error\n    }\n}\n\nexport function updateDescriptionSuccess(description: string): UpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function updateDescriptionError(description: string, error: ValidationState): UpdateDescriptionError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function load() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const newOrg: EditableOrganization = {\n            id: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgId('')[1]\n            },\n            name: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgName('')[1]\n            },\n            logoUrl: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgLogoUrl('')[1]\n            },\n            homeUrl: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgHomeUrl('')[1]\n            },\n            researchInterests: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgResearchInterests('')[1]\n            },\n            description: {\n                value: '',\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: Validation.validateOrgDescription('')[1]\n            },\n            isPrivate: {\n                value: false,\n                remoteValue: null,\n                syncState: SyncState.CLEAN,\n                validationState: {\n                    type: ValidationErrorType.OK,\n                    validatedAt: new Date()\n                }\n            }\n        }\n        dispatch(loadSuccess(newOrg))\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrg() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n\n        // This check is to satisfy TS. Since viewModel is nullable, it has no way \n        // of knowing that our app flow ensures that it is populated.\n        // In terms of generalized usage of the redux store, though, there is no\n        // way to ensure this! So we really should perform our state checks before \n        // handling any event\n        if (!state.views.addOrgView.viewModel) {\n            dispatch(saveError({\n                code: 'invalid',\n                message: 'Unexpected condition: no view model'\n            }))\n            return\n        }\n\n        // TODO: other validations!!!\n\n        dispatch(saveStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                addOrgView: { viewModel: { newOrganization } },\n            },\n            app: { config }\n        } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (!newOrganization) {\n            dispatch(saveError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        orgClient.addOrg(newOrganization, username)\n            .then((org: orgModel.Organization) => {\n                dispatch(saveSuccess(org))\n            })\n            .catch((error) => {\n                console.error('error adding', newOrganization, error)\n\n                // note that we dispatch an AppError compliant object,\n                // which wraps the original exception object.\n                dispatch(saveError({\n                    code: error.code || error.name,\n                    message: error.message,\n                    exception: error\n                }))\n            })\n    }\n}\n\nexport function addOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.addOrgView.viewModel) {\n            dispatch(saveError({\n                code: 'invalid',\n                message: 'Unexpected condition: no view model'\n            }))\n            return\n        }\n\n        const {\n            views: {\n                addOrgView: {\n                    viewModel: { editState, newOrganization } }\n            }\n        } = state\n\n        if (!newOrganization) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.name.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.id.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        // TODO: quick hack to allow unmodified fields to evaluate to true.\n\n        if (newOrganization.logoUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.homeUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.researchInterests.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.description.validationState.type !== ValidationErrorType.OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(addOrgEvaluateOk())\n    }\n}\n\nfunction orgModelFromState(state: StoreState) {\n    const {\n        auth: { authorization: { token, username } },\n        app: { config } } = state\n    return new orgModel.OrganizationModel({\n        token, username,\n        groupsServiceURL: config.services.Groups.url\n    })\n}\n\nexport function updateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateNameError(validatedName, error))\n        } else {\n            dispatch(updateNameSuccess(validatedName))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function updateLogoUrl(name: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedLogoUrl, error] = Validation.validateOrgLogoUrl(name)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateLogoUrlError(validatedLogoUrl, error))\n        } else {\n            dispatch(updateLogoUrlSuccess(validatedLogoUrl))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function updateHomeUrl(homeUrl: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedHomeUrl, error] = Validation.validateOrgHomeUrl(homeUrl)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_ERROR,\n                homeUrl: homeUrl,\n                error: error\n            } as UpdateHomeUrlError)\n        } else {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_HOME_URL_SUCCESS,\n                homeUrl: validatedHomeUrl\n            })\n        }\n    }\n}\n\nexport function updateResearchInterests(researchInterests: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedResearchInterests, error] = Validation.validateOrgResearchInterests(researchInterests)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n                researchInterests: validatedResearchInterests,\n                error: error\n            } as UpdateResearchInterestsError)\n        } else {\n            dispatch({\n                type: ActionFlag.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n                researchInterests: validatedResearchInterests\n            }) as UpdateResearchInterestsSuccess\n        }\n    }\n}\n\nexport function updateIsPrivate(isPrivate: boolean) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        // no validation for now ... what is there to validate?\n\n        dispatch({\n            type: ActionFlag.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n            isPrivate\n        })\n        dispatch(addOrgEvaluate())\n    }\n}\n\nclass Debouncer {\n\n    delay: number\n    fun: () => void\n    canceled: boolean\n    timer: number | null\n\n    constructor(delay: number, fun: () => void) {\n        this.delay = delay\n        this.fun = fun\n        this.canceled = false\n        this.timer = null\n        this.startWaiting()\n    }\n\n    startWaiting() {\n        if (this.timer) {\n            window.clearTimeout(this.timer)\n        }\n        this.timer = window.setTimeout(() => {\n            this.fun()\n        }, this.delay)\n    }\n\n    cancel() {\n        this.canceled = true\n    }\n}\n\nlet activeDebouncer: Debouncer | null = null\n\nexport function updateId(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(updateIdPass(id))\n        const [validatedId, error] = Validation.validateOrgId(id)\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n\n        const {\n            views: {\n                addOrgView: { viewModel }\n            }\n        } = getState()\n\n        if (!viewModel) {\n            // do nothing\n            return\n        }\n\n        const lastValidatedAt = viewModel.newOrganization.id.validationState.validatedAt\n        const now = new Date().getTime()\n        const debounce = 500 // ms\n        if (lastValidatedAt) {\n            const elapsed = now - lastValidatedAt.getTime()\n            if (elapsed < debounce) {\n                if (!activeDebouncer) {\n                    activeDebouncer = new Debouncer(500, () => {\n                        dispatch(evaluateId())\n                    })\n                }\n                return\n            }\n        }\n\n        if (activeDebouncer) {\n            activeDebouncer.cancel()\n        }\n        activeDebouncer = null\n\n        const model = orgModelFromState(getState())\n        model.orgExists(validatedId)\n            .then((exists) => {\n                if (exists) {\n                    dispatch(updateIdError(validatedId, {\n                        type: ValidationErrorType.ERROR,\n                        validatedAt: new Date(),\n                        message: 'This org id is already in use'\n                    }))\n                } else {\n                    dispatch(updateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function evaluateId() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n\n        const {\n            views: {\n                addOrgView: { viewModel }\n            }\n        } = getState()\n        if (!viewModel) {\n            // do nothing\n            return\n        }\n\n        const id = viewModel.newOrganization.id\n\n        const [validatedId, error] = Validation.validateOrgId(id.value)\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n\n        const model = orgModelFromState(getState())\n        model.orgExists(validatedId)\n            .then((exists) => {\n                if (exists) {\n                    dispatch(updateIdError(validatedId, {\n                        type: ValidationErrorType.ERROR,\n                        message: 'This org id is already in use',\n                        validatedAt: new Date()\n                    }))\n                } else {\n                    dispatch(updateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function updateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const model = orgModelFromState(getState())\n\n        const [validatedDescription, error] = Validation.validateOrgDescription(description)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(updateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(updateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}","import * as React from 'react'\nimport { Redirect } from 'react-router-dom'\nimport { Marked } from 'marked-ts'\nimport { Button, Icon, Modal, Input, Checkbox, Tooltip, Collapse } from 'antd'\nimport md5 from 'md5'\nimport {\n    EditableOrganization, SaveState, ValidationState, EditState,\n    AppError, Editable, ValidationErrorType, SyncState\n} from '../../../types';\nimport { CheckboxChangeEvent } from 'antd/lib/checkbox'\nimport OrgLogo from '../../OrgLogo'\nimport TextArea from 'antd/lib/input/TextArea'\nimport MainMenu from '../../menu/component'\nimport './component.css'\n\nexport interface NewOrganizationProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    error: AppError | null,\n    newOrganization: EditableOrganization,\n    onSave: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateLogoUrl: (logoUrl: string) => void\n    onUpdateHomeUrl: (homeUrl: string) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n}\n\nexport interface NewOrganizationState {\n    cancelToBrowser: boolean\n    showError: boolean\n}\n\nclass NewOrganization extends React.Component<NewOrganizationProps, NewOrganizationState> {\n    origin: string;\n\n    constructor(props: NewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            showError: true\n        }\n\n        this.origin = document.location!.origin\n    }\n\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have entered information for this new organization.</p>\n\n                    <p>If you leave the editor without first saving, the new organization <i>will not be created</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        this.props.onSave();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value);\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value);\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateId(e.target.value)\n    }\n\n    onLogoUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateLogoUrl(e.target.value)\n    }\n\n    onHomeUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateHomeUrl(e.target.value)\n    }\n\n    onResearchInterestsChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateResearchInterests(e.target.value)\n    }\n\n    onIsPrivateChange(e: CheckboxChangeEvent) {\n        this.props.onUpdateIsPrivate(e.target.checked)\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState.type === ValidationErrorType.OK &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.saveState === SaveState.NEW\n        )\n    }\n\n    calcFieldClass(field: Editable) {\n        switch (field.validationState.type) {\n            // case (ValidationErrorType.OK):\n            //     return 'validation-ok'\n            case (ValidationErrorType.ERROR):\n                return 'validation-error Lite'\n            case (ValidationErrorType.REQUIRED_MISSING):\n                return 'validation-error Lite'\n        }\n\n        switch (field.syncState) {\n            case (SyncState.DIRTY):\n                return 'sync-dirty Lite'\n            default:\n                return 'validation-ok Lite'\n        }\n    }\n\n    renderFieldError(field: Editable) {\n        if (field.validationState.type !== ValidationErrorType.OK) {\n            if (field.syncState === SyncState.DIRTY) {\n                return (\n                    <span style={{ color: 'red' }}>\n                        {field.validationState.message}\n                    </span>\n                )\n            }\n        } else {\n            return ''\n        }\n    }\n\n    renderNameRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    This is the name for your organization as you want KBase users to see it; you may change it at any time.\n                </p>\n                <p>\n                    It may be composed of ordinary text, but does not accept formatting.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1024 characters\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = 'Your Organization\\'s display name'\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                    <div className=\"NewOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Name\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div className=\"NewOrganization-formControl\">\n                        <Input value={this.props.newOrganization.name.value || ''}\n                            className={this.calcFieldClass(this.props.newOrganization.name)}\n                            placeholder={placeholder}\n                            autoFocus\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.renderFieldError(this.props.newOrganization.name)}\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <div className=\"NewOrganization-preview-name\">\n                        {this.props.newOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderIDRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each Organization has a unique identifier. The ID is set when the organization is created, and are permanent: It may never be changed.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                100 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                a to z, 0 to 9, -\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = \"A unique ID for your Organization\"\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                    <div className=\"NewOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            ID\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div className=\"NewOrganization-formControl\">\n                        <Input value={this.props.newOrganization.id.value || ''}\n                            className={this.calcFieldClass(this.props.newOrganization.id)}\n                            placeholder={placeholder}\n                            onChange={this.onIdChange.bind(this)} />\n                        {this.renderFieldError(this.props.newOrganization.id)}\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <div className=\"NewOrganization-preview-id\">\n                        <span style={{ color: 'silver' }}>{this.origin}/#org/</span>\n                        {this.props.newOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderLogoURLRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each Organization will display a logo. You may specific your own logo by entering the URL for an image, or leave\n                    this field blank and a default logo will be displayed, using the first letter of your org name and a randomly\n                    generated color (based on your org id).\n                </p>\n                <p>\n                    Please don't use large images, and try to keep them roughly square. The logo image display will be constrained\n                    to no larger than 100 pixels wide. Non-square logos may not look good in the Orgs list or on your Org page.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                no\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1000 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                a full https:// url. E.g. https://my.org/myimage.png<br />\n                                note that only <i>https</i> urls are accepted.\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = \"The URL for your Organization's logo (optional)\"\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                    <div className=\"NewOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Logo URL\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div className=\"NewOrganization-formControl\">\n                        <Input value={this.props.newOrganization.logoUrl.value || ''}\n                            className={this.calcFieldClass(this.props.newOrganization.logoUrl)}\n                            placeholder={placeholder}\n                            onChange={this.onLogoUrlChange.bind(this)} />\n                        {this.renderFieldError(this.props.newOrganization.logoUrl)}\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <div className=\"NewOrganization-preview-logo\">\n                        {this.renderLogoPreview()}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderHomeURLRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each Organization may display a home page url. This should be considered the canonical home for your Organization, if\n                    it also exists outside of KBase.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                no\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1000 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                a full url. E.g. http://my.org/myimage.png<br />\n                                note that both <i>http></i> and <i>https</i> urls are accepted.\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = \"The url for your Organization's home page (optional)\"\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                    <div className=\"NewOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Home Page URL\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div className=\"NewOrganization-formControl\">\n                        <Input value={this.props.newOrganization.homeUrl.value || ''}\n                            className={this.calcFieldClass(this.props.newOrganization.homeUrl)}\n                            placeholder={placeholder}\n                            onChange={this.onHomeUrlChange.bind(this)} />\n                        {this.renderFieldError(this.props.newOrganization.homeUrl)}\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <div className=\"NewOrganization-field-name\">\n                        <a href={this.props.newOrganization.homeUrl.value || ''} target=\"_blank\">{this.props.newOrganization.homeUrl.value || ''}</a>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderCollapse(content: JSX.Element) {\n        const style = {\n            background: 'transparent',\n            borderRadius: 0,\n            margin: 0,\n            border: 0,\n            overflow: 'hidden'\n        }\n        return (\n            <Collapse bordered={false}>\n                <Collapse.Panel header=\"What about inviting users?\" key=\"invite\" style={style}>\n                    {content}\n                </Collapse.Panel>\n            </Collapse>\n        )\n    }\n\n    renderPrivatePublicRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Set the Organization to \"hidden\" to prevent it from appearing in the listing and from being exposed\n                    as an Org page for any non-member.\n                </p>\n                <p>\n                    You may invite users directly to your org. When doing so they will receive a notification with a link to the\n                    org page. When a user lands on the org page they will not be shown information about the org, but will be available\n                    to accept the invitation and instantly have access to it.\n                </p>\n                <p>\n                    A user with an invitation who lands on the org page will not see information about the org, but will be able to\n                    submit a Join request.\n                </p>\n                {/* {this.renderCollapse((\n                    <React.Fragment>\n                        <p>\n                            You may invite users directly to your org. When doing so they will receive a notification with a link to the\n                            org page. When a user lands on the org page they will not be shown information about the org, but will be available\n                            to accept the invitation and instantly have access to it.\n                        </p>\n                        <p>\n                            A user with an invitation who lands on the org page will not see information about the org, but will be able to\n                            submit a Join request.\n                        </p>\n                    </React.Fragment>\n                ))} */}\n\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                no\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                    <div className=\"NewOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Hidden?\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div className=\"NewOrganization-formControl\">\n                        <Checkbox\n                            checked={this.props.newOrganization.isPrivate.value}\n                            className={this.calcFieldClass(this.props.newOrganization.isPrivate)}\n                            onChange={this.onIsPrivateChange.bind(this)} />\n                        {this.renderFieldError(this.props.newOrganization.isPrivate)}\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <div className=\"NewOrganization-preview-isPrivate\">\n                        {this.renderIsPrivate(this.props.newOrganization.isPrivate.value)}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderResearchInterestsRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each organization must have a short description of research interests or purpose.\n                </p>\n                <p>\n                    This text is displayed in the organizations list and the organization's page. It is most helpful\n                    in the list context to help users quickly scan the list.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                200 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                unformatted text\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = 'List your areas of interest. Systems biology, microbial ecology, plant genomics'\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                    <div className=\"NewOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Research Interests\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div className=\"NewOrganization-formControl\">\n                        <TextArea value={this.props.newOrganization.researchInterests.value || ''}\n                            className={this.calcFieldClass(this.props.newOrganization.researchInterests) + ' NewOrganization-control-researchInterests'}\n                            autosize={{ minRows: 2, maxRows: 2 }}\n                            placeholder={placeholder}\n                            onChange={this.onResearchInterestsChange.bind(this)} />\n                        {this.renderFieldError(this.props.newOrganization.researchInterests)}\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <div className=\"NewOrganization-preview-researchInterests\">\n                        {this.props.newOrganization.researchInterests.value || ''}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderDescriptionRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each organization must have a description which communicates the purpose of this organization.\n                </p>\n                <p>\n                    The description is in <a href=\"https://daringfireball.net/projects/markdown/syntax\" target=\"_blank\">markdown</a> format\n                    and may be quite long. It will be presented in a scrolling area.\n                </p>\n                <p>\n                    Please be mindful of embedding large images or other content which may interfere with the display of your Organization.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1024 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                standard <a href=\"https://daringfireball.net/projects/markdown/syntax\" target=\"_blank\">markdown</a>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = 'Text or Markdown describing your Organization'\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                    <div className=\"NewOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Description\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div className=\"NewOrganization-formControl\">\n                        <TextArea value={this.props.newOrganization.description.value || ''}\n                            className={this.calcFieldClass(this.props.newOrganization.description) + ' NewOrganization-control-description'}\n                            autosize={{ minRows: 5, maxRows: 15 }}\n                            placeholder={placeholder}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.renderFieldError(this.props.newOrganization.description)}\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <div className=\"NewOrganization-preview-description\"\n                        dangerouslySetInnerHTML={({ __html: Marked.parse(this.props.newOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        )\n    }\n\n    renderEditorHeader() {\n        return (\n            <div className=\"NewOrganization-row\">\n                <div className=\"NewOrganization-col1\">\n                </div>\n                <div className=\"NewOrganization-col2\">\n                    <div style={{ flex: '1 1 0px' }}>\n                        <h3>Create Your Organization</h3>\n                    </div>\n                </div>\n                <div className=\"NewOrganization-col3\">\n                    <h3>Preview</h3>\n                </div>\n            </div>\n        )\n    }\n\n    renderEditor() {\n        return (\n            <form id=\"newOrganizationForm\" className=\"NewOrganization-editor  scrollable-flex-column\" onSubmit={this.onSubmit.bind(this)}>\n                {this.renderEditorHeader()}\n                <div className=\"NewOrganization-body\">\n                    {this.renderNameRow()}\n                    {this.renderIDRow()}\n                    {this.renderLogoURLRow()}\n                    {this.renderHomeURLRow()}\n                    {this.renderPrivatePublicRow()}\n                    {this.renderResearchInterestsRow()}\n                    {this.renderDescriptionRow()}\n                    <div className=\"NewOrganization-row\">\n                        <div className=\"NewOrganization-col1\">\n                        </div>\n                        <div className=\"NewOrganization-col2\" style={{ textAlign: 'center' }}>\n                            <div className=\"ButtonSet\">\n                                <span className=\"ButtonSet-button\">\n                                    {this.renderSaveButton()}\n                                </span>\n                                <span className=\"ButtonSet-button\">\n                                    {this.renderCancelButton()}\n                                </span>\n                            </div>\n                        </div>\n                        <div className=\"NewOrganization-col3\">\n                        </div>\n                    </div>\n                </div>\n            </form>\n        )\n    }\n\n    charAt(inString: string, position: number) {\n        const c1 = inString.charCodeAt(position)\n        if (c1 >= 0xD800 && c1 <= 0xDBFF && inString.length > position + 1) {\n            const c2 = inString.charCodeAt(position + 1)\n            if (c2 > 0xDC00 && c2 <= 0xDFFF) {\n                return inString.substring(position, 2)\n            }\n        }\n        return inString.substring(position, 1)\n    }\n\n    renderLogo(org: EditableOrganization) {\n        return (\n            <OrgLogo logoUrl={null} size={64} organizationName={org.name.value} organizationId={org.id.value} />\n        )\n    }\n\n    renderIsPrivate(isPrivate: boolean) {\n        if (isPrivate) {\n            return (\n                <span>\n                    <Icon type=\"lock\" />{' '}Hidden - will be visible <b>only</b> for members of this organization\n                </span>\n            )\n        }\n        return (\n            <span>\n                <Icon type=\"global\" />{' '}Visible - will be visible to all KBase users.\n            </span>\n        )\n    }\n\n    renderDefaultLogo() {\n        if (!(this.props.newOrganization.name.value && this.props.newOrganization.id.value)) {\n            return (\n                <div>\n                    Default logo preview available when the Organization name and id are completed\n                </div>\n            )\n        }\n        const initial = this.charAt(this.props.newOrganization.name.value, 0).toUpperCase()\n        const hash = md5(this.props.newOrganization.id.value)\n        const size = 60;\n        const color = hash.substr(0, 6)\n        return (\n            <svg width={size} height={size} style={{ border: '1px rgba(200, 200, 200, 0.5) solid' }}>\n                <text x=\"50%\" y=\"50%\" dy={4} textAnchor=\"middle\" dominantBaseline=\"middle\" fontSize={size - 12} fill={'#' + color} fontFamily=\"sans-serif\">{initial}</text>\n            </svg>\n        )\n    }\n\n    renderLogoPreview() {\n        if (!this.props.newOrganization.logoUrl.value) {\n            return this.renderDefaultLogo()\n        }\n        return (\n            <img src={this.props.newOrganization.logoUrl.value} width={60} />\n        )\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    toggleError() {\n        this.setState({ showError: !this.state.showError })\n    }\n\n    renderError() {\n        if (this.props.error && this.state.showError) {\n            const onOk = () => {\n                this.setState({ showError: false })\n            }\n            const onCancel = () => {\n                this.setState({ showError: false })\n            }\n            let trace\n            if (this.props.error.trace) {\n                trace = this.props.error.trace.map((line, index) => {\n                    return (\n                        <div key={\"line_\" + index}>{line}</div>\n                    )\n                })\n            }\n            if (trace) {\n                trace = (\n                    <div>\n                        <div>trace</div>\n                        {trace}\n                    </div>\n                )\n            }\n            return (\n                <Modal visible={true}\n                    title=\"Error\"\n                    okType=\"danger\"\n                    okText=\"Close\"\n                    cancelText=\"Clear Error\"\n                    onCancel={onCancel}\n                    onOk={onOk}>\n                    <div style={{ fontWeight: 'bold' }}>\n                        {this.props.error.code}\n                    </div>\n                    <div>\n                        {this.props.error.message}\n                    </div>\n                    {trace}\n                </Modal>\n            )\n        }\n    }\n\n    renderSaveButton() {\n        return (\n            <Button icon=\"save\"\n                form=\"newOrganizationForm\"\n                key=\"submit\"\n                disabled={!this.canSave.call(this)}\n                htmlType=\"submit\">\n                Save\n            </Button>\n        )\n    }\n\n    renderCancelButton() {\n        return (\n            <Button type=\"danger\" onClick={this.onClickCancelToBrowser.bind(this)} >\n                <Icon type=\"close\" />{' '}Close\n            </Button>\n        )\n    }\n\n    renderMenuButtons() {\n        let errorButton\n        if (this.props.error) {\n            errorButton = (\n                <span className=\"ButtonSet-button\">\n                    <Button shape=\"circle\" icon=\"exclamation\" type=\"danger\" onClick={this.toggleError.bind(this)}></Button>\n                </span>\n            )\n        }\n        return (\n            <div className=\"ButtonSet\">\n                <span className=\"ButtonSet-button\">\n                    <Button type=\"default\" onClick={this.onClickCancelToBrowser.bind(this)} >\n                        <Icon type=\"rollback\" />{' '}Back\n                    </Button>\n                </span>\n                <span className=\"ButtonSet-button\">\n                    {this.renderSaveButton()}\n                </span>\n                {errorButton}\n            </div>\n        )\n    }\n\n    render() {\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        // TODO: this is just a prop for today.\n        if (this.props.saveState === SaveState.SAVED) {\n            return <Redirect push to={\"/editOrganization/\" + this.props.newOrganization.id.value} />\n        }\n\n        return (\n            <div className=\"NewOrganization\">\n                {this.renderEditor()}\n                {this.renderError()}\n            </div>\n        )\n    }\n}\n\nexport default NewOrganization","import { Dispatch, Action } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState, EditState, SaveState, ValidationState, EditableOrganization, AppError } from '../../../types';\nimport {\n    addOrg, updateName, updateLogoUrl, updateId, updateDescription, updateIsPrivate, updateHomeUrl, updateResearchInterests\n} from '../../../redux/actions/addOrg';\n\nimport Component from './component';\n\ninterface OwnProps {\n}\n\nexport interface StateProps {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    newOrganization: EditableOrganization\n    error: AppError | null\n}\n\nexport interface DispatchProps {\n    onSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateLogoUrl: (logoUrl: string | null) => void\n    onUpdateId: (id: string) => void\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateHomeUrl: (homeUrl: string | null) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n}\n\nexport function mapStateToProps(state: StoreState): StateProps {\n    if (!state.views.addOrgView.viewModel) {\n        throw new Error('View model missing in state')\n    }\n    const {\n        views: {\n            addOrgView: {\n                viewModel: { editState, saveState, validationState, newOrganization, error }\n            }\n        }\n    } = state\n\n    return {\n        editState,\n        saveState,\n        validationState,\n        newOrganization,\n        error\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onSave: () => {\n            dispatch(addOrg() as any)\n        },\n        onUpdateName: (name) => {\n            dispatch(updateName(name) as any)\n        },\n        onUpdateLogoUrl: (logoUrl: string | null) => {\n            dispatch(updateLogoUrl(logoUrl) as any)\n        },\n        onUpdateId: (id) => {\n            dispatch(updateId(id) as any)\n        },\n        onUpdateDescription: (description) => {\n            dispatch(updateDescription(description) as any)\n        },\n        onUpdateIsPrivate: (isPrivate: boolean) => {\n            dispatch(updateIsPrivate(isPrivate) as any)\n        },\n        onUpdateHomeUrl: (homeUrl: string | null) => {\n            dispatch(updateHomeUrl(homeUrl) as any)\n        },\n        onUpdateResearchInterests: (researchInterests: string) => {\n            dispatch(updateResearchInterests(researchInterests) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nimport { AppError, AddOrgView, ComponentLoadingState, StoreState } from '../../../types'\nimport Container from './container'\n\ninterface LoaderProps {\n    view: AddOrgView\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading \"Add New Organization\" form...\n            </div>\n        )\n    }\n\n    renderError(error: AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            case ComponentLoadingState.SUCCESS:\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad()\n        }\n    }\n\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// redux interface\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../redux/actions/addOrg'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.addOrgView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.Load | actions.Unload>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as requestModel from './requests'\nimport * as orgModel from './organization/model'\nimport { RequestType } from '../../types';\n\nexport interface UberOrganization {\n    organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization\n    request: requestModel.UserRequest | null\n    invitation: requestModel.UserInvitation | null\n    relation: orgModel.Relation,\n    groupRequests: Array<requestModel.Request> | null\n}\n\ninterface UberModelParams {\n    token: string\n    username: string\n    groupsServiceURL: string\n    userProfileServiceURL: string\n    workspaceServiceURL: string\n    serviceWizardURL: string\n}\n\nexport class UberModel {\n\n    params: UberModelParams\n\n    constructor(params: UberModelParams) {\n        this.params = params\n    }\n\n    async getOrganizationForUser(organizationId: string): Promise<UberOrganization> {\n        // const {\n        //     auth: { authorization: { token, username } },\n        //     app: { config }\n        // } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token: this.params.token, username: this.params.username,\n            groupsServiceURL: this.params.groupsServiceURL\n        })\n\n        // get org\n        const organization = await orgClient.getOrg(organizationId)\n\n        // get pending requests\n        const request = await requestClient.getUserRequestForOrg(organizationId) as requestModel.UserRequest | null\n\n        const invitation = await requestClient.getUserInvitationForOrg(organizationId) as requestModel.UserInvitation | null\n\n        // we should probably just keep the request ids rather than try to keep the whole request\n        // and refactor the calls for the request events, which I just refactored (not much work) to use the \n        // whole request structure rather than just the id, to use the request id + the org id...\n        const relation = orgModel.determineRelation(organization, this.params.username, request, invitation)\n\n        let groupRequests\n        if (relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            groupRequests = await requestClient.getPendingOrganizationRequestsForOrg(organizationId)\n        } else {\n            groupRequests = null\n        }\n\n        return {\n            organization, request, invitation, relation, groupRequests\n        }\n    }\n\n    // async getOrganizationsForUser(): Promise<Array<UberOrganization>> {\n    //     // const {\n    //     //     auth: { authorization: { token, username } },\n    //     //     app: { config }\n    //     // } = getState()\n\n    //     const orgClient = new orgModel.OrganizationModel({\n    //         token: this.params.token, username: this.params.username,\n    //         groupsServiceURL: this.params.groupsServiceURL\n    //     })\n\n    //     const requestClient = new requestModel.RequestsModel({\n    //         token: this.params.token, username: this.params.username,\n    //         groupsServiceURL: this.params.groupsServiceURL\n    //     })\n\n    //     const orgs = await orgClient.getOwnOrgs()\n\n    //     const requestOutbox = await requestClient.getOutboundRequests()\n    //     const requestInbox = await requestClient.getInboundRequests()\n\n    //     return await Promise.all(orgs.map(async (organization) => {\n    //         const request = requestOutbox.find((request) => {\n    //             if (request.organizationId === organization.id) {\n    //                 if (request.type === RequestType.REQUEST &&\n    //                     request.resourceType === requestModel.RequestResourceType.USER) {\n    //                     return true\n    //                 }\n    //             }\n    //             return false\n    //         }) as requestModel.UserRequest\n\n    //         const invitation = requestInbox.find((request) => {\n    //             if (request.organizationId === organization.id) {\n    //                 if (request.type === RequestType.INVITATION &&\n    //                     request.resourceType === requestModel.RequestResourceType.USER) {\n    //                     return true\n    //                 }\n    //             }\n    //             return false\n    //         }) as requestModel.UserInvitation\n\n    //         const relation = orgModel.determineRelation(organization, this.params.username, request || null, invitation)\n\n    //         let groupRequests\n    //         if (relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n    //             relation.type === orgModel.UserRelationToOrganization.OWNER) {\n    //             groupRequests = await requestClient.getPendingOrganizationRequestsForOrg(organization.id)\n    //         } else {\n    //             groupRequests = null\n    //         }\n\n    //         return {\n    //             organization, request, invitation, relation, groupRequests\n    //         }\n    //     }))\n    // }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport { AnError, makeError } from '../../lib/error';\nimport { StoreState } from '../../types';\n\nexport interface Load extends Action<ActionFlag.DATA_SERVICE_LOAD> {\n    type: ActionFlag.DATA_SERVICE_LOAD\n}\n\nexport interface LoadSuccess extends Action<ActionFlag.DATA_SERVICE_LOAD_SUCCESS> {\n    type: ActionFlag.DATA_SERVICE_LOAD_SUCCESS\n}\n\nexport interface LoadError extends Action<ActionFlag.DATA_SERVICE_LOAD_ERROR> {\n    type: ActionFlag.DATA_SERVICE_LOAD_ERROR,\n    error: AnError\n}\n\nfunction loadError(error: AnError) {\n    return {\n        type: ActionFlag.DATA_SERVICE_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function load() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.DATA_SERVICE_LOAD_START\n        })\n\n        dispatch({\n            type: ActionFlag.DATA_SERVICE_LOAD_SUCCESS\n        } as LoadSuccess)\n\n        // const {\n        //     auth: { authorization: { token, username } },\n        //     app: { config } } = getState()\n\n        // const userProfileClient = new userProfileModel.UserProfile({\n        //     token, username,\n        //     userProfileServiceURL: config.services.UserProfile.url\n        // })\n\n        // try {\n        //     const userProfile = await userProfileClient.getProfile(username)\n\n        //     dispatch({\n        //         type: ActionFlag.DATA_SERVICE_LOAD_SUCCESS,\n        //         profile: userProfile\n        //     })\n        // } catch (ex) {\n        //     console.error('error', ex)\n        //     dispatch(loadError(makeError({\n        //         code: ex.name,\n        //         message: ex.name\n        //     })))\n        // }\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.DATA_SERVICE_UNLOAD\n    }\n}\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState,\n    AppError, UIError, UIErrorType, ViewOrgViewModelKind\n} from '../../types'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport * as requestModel from '../../data/models/requests'\nimport * as uberModel from '../../data/models/uber'\nimport { loadNarrative } from './entities'\nimport * as dataServices from './dataServices'\nimport { AnError } from '../../lib/error';\nimport * as narrativeModel from '../../data/models/narrative'\n\n// Action Types\n\nexport interface Load extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD\n    organizationId: string\n}\n\nexport interface ReLoad extends Action {\n    type: ActionFlag.VIEW_ORG_RELOAD\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_START\n}\n\nexport interface LoadNormalSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_NORMAL_SUCCESS\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    openRequest: orgModel.RequestStatus\n    groupRequests: Array<requestModel.Request> | null\n    groupInvitations: Array<requestModel.Request> | null\n    requestInbox: Array<requestModel.Request>\n    requestOutbox: Array<requestModel.Request>\n    narrativesSortBy: string\n    narratives: Array<orgModel.NarrativeResource>\n    sortMembersBy: string,\n    members: Array<orgModel.Member>\n}\n\nexport interface LoadInaccessiblePrivateSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.VIEW_ORG_LOAD_ERROR\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.VIEW_ORG_UNLOAD\n}\n\n// Join Requests\n\nexport interface ViewOrgJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST\n    requestId: string\n}\n\nexport interface ViewOrgJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR\n    error: UIError\n}\n\n// Join Request cancellation\n\nexport interface ViewOrgCancelJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST\n}\n\nexport interface ViewOrgCancelJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgCancelJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgCancelJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n    error: UIError\n}\n\n// Join Invitation Acceptance\n\nexport interface AcceptJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION\n}\n\nexport interface AcceptJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n}\n\nexport interface AcceptJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface AcceptJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n// Join Invitation Denial\n\nexport interface RejectJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION\n}\n\nexport interface RejectJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n}\n\nexport interface RejectJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface RejectJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n\n// Delete Narrative\n\nexport interface RemoveNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE\n}\n\nexport interface RemoveNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n}\n\nexport interface RemoveNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    narrativeId: narrativeModel.NarrativeID\n}\n\nexport interface RemoveNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\n\nexport function removeNarrativeStart(): RemoveNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n    }\n}\n\nexport function removeNarrativeSuccess(narrativeId: narrativeModel.NarrativeID): RemoveNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n        narrativeId\n    }\n}\n\nexport function removeNarrativeError(error: AppError): RemoveNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function removeNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeNarrativeStart())\n\n        // TODO: need to restructure this view -- this is crazy\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel\n                }\n            }\n        }: StoreState = state\n\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const { organization } = viewModel\n\n        if (!organization) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const groupId = organization.id\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n\n        try {\n            await orgClient.removeNarrativeFromOrg(groupId, narrative.workspaceId)\n\n            dispatch(removeNarrativeSuccess(narrative.workspaceId))\n        } catch (ex) {\n            dispatch(removeNarrativeError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Access narrative\n\nexport interface AccessNarrative extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE,\n    narrative: orgModel.NarrativeResource\n}\n\nexport interface AccessNarrativeStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n}\n\nexport interface AccessNarrativeSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n    organization: orgModel.Organization\n    narratives: Array<orgModel.NarrativeResource>\n}\n\nexport interface AccessNarrativeError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\nexport function accessNarrativeStart(): AccessNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_START\n    }\n}\n\nexport function accessNarrativeSuccess(organization: orgModel.Organization, narratives: Array<orgModel.NarrativeResource>): AccessNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,\n        organization,\n        narratives\n    }\n}\n\nexport function accessNarrativeError(error: AppError): AccessNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCESS_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// Thunk\n\nexport function accessNarrative(narrative: orgModel.NarrativeResource) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(accessNarrativeStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'No view model'\n            }))\n            return\n        }\n\n        const viewModel = state.views.viewOrgView.viewModel\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: 'Not NORMAL org'\n            }))\n            return\n        }\n\n        const { organization, sortNarrativesBy, searchNarrativesBy } = viewModel\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n        } = state\n\n        const organizationId = organization.id\n        const resourceId = String(narrative.workspaceId)\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.grantNarrativeAccess(organizationId, resourceId)\n            // Getting a fresh copy of the org will trigger the view org component and\n            // all subcomponents with changed data to refresh. All we are intending here is that\n            // the narrative in the list of narratives provided by the groups api is updated, but\n            // there may be other elements of the group/org which have changed as well. So be it.\n\n            // TODO: just update the narrative, don't reprocess everything.\n\n\n            const org = await orgClient.getOrg(organizationId)\n\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(accessNarrativeError({\n                    code: 'error',\n                    message: 'Not a NORMAL org'\n                }))\n                return\n            }\n\n            const narratives = org.narratives\n\n            const filteredNarratives = orgModel.queryNarratives(narratives, {\n                sortBy: sortNarrativesBy,\n                searchBy: searchNarrativesBy\n            })\n\n            dispatch(loadNarrative(narrative.workspaceId))\n            dispatch(accessNarrativeSuccess(org, filteredNarratives))\n        } catch (ex) {\n            dispatch(accessNarrativeError({\n                code: 'error',\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n// Generators\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_START\n    }\n}\n\nexport function loadNormalSuccess(\n    organization: orgModel.Organization,\n    relation: orgModel.Relation,\n    openRequest: orgModel.RequestStatus,\n    groupRequests: Array<requestModel.Request> | null,\n    groupInvitations: Array<requestModel.Request> | null,\n    requestInbox: Array<requestModel.Request>,\n    requestOutbox: Array<requestModel.Request>,\n    narrativesSortBy: string,\n    narratives: Array<orgModel.NarrativeResource>,\n    sortMembersBy: string,\n    members: Array<orgModel.Member>): LoadNormalSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_NORMAL_SUCCESS,\n        organization, relation, openRequest,\n        groupRequests, groupInvitations,\n        requestInbox, requestOutbox,\n        narrativesSortBy,\n        narratives, sortMembersBy, members\n    }\n}\n\nexport function loadInaccessiblePrivateSuccess(\n    organization: orgModel.InaccessiblePrivateOrganization,\n    relation: orgModel.Relation,\n    requestOutbox: Array<requestModel.Request>): LoadInaccessiblePrivateSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,\n        organization, relation,\n        requestOutbox\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.VIEW_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\n// Join requests\n\nexport function viewOrgJoinRequestStart(): ViewOrgJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgJoinRequestSuccess(): ViewOrgJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgJoinRequestError(error: UIError): ViewOrgJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Join Request Cancellation\n\nexport function viewOrgCancelJoinRequestStart(): ViewOrgCancelJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgCancelJoinRequestSuccess(): ViewOrgCancelJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgCancelJoinRequestError(error: UIError): ViewOrgCancelJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Invitation Acceptance\n\nexport function acceptJoinInvitationStart(): AcceptJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n    }\n}\n\nexport function acceptJoinInvitationSuccess(): AcceptJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function acceptJoinInvitationError(error: AppError): AcceptJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n// Invitation Rejection \n\nexport function rejectJoinInvitationStart(): RejectJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n    }\n}\n\nexport function rejectJoinInvitationSuccess(): RejectJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function rejectJoinInvitationError(error: AppError): RejectJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n// Join invitation acceptance\n\n// TODO\n\n// Thunks\n\nexport function unload() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: { viewOrgView: { viewModel } }\n        } = getState()\n\n        if (!viewModel) {\n            throw new Error('view model not defined!?!')\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (viewModel.organization.relation === orgModel.UserRelationToOrganization.MEMBER ||\n            viewModel.organization.relation === orgModel.UserRelationToOrganization.ADMIN ||\n            viewModel.organization.relation === orgModel.UserRelationToOrganization.OWNER) {\n            await orgClient.visitOrg({ organizationId: viewModel.organization.id })\n        }\n\n        dispatch(dataServices.load())\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_UNLOAD\n        })\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n        })\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const { organization, relation } = await uberClient.getOrganizationForUser(organizationId)\n            if (organization.kind !== orgModel.OrganizationKind.NORMAL) {\n                const requestInbox = await requestClient.getRequestInboxForOrg(organizationId)\n                dispatch(loadInaccessiblePrivateSuccess(organization, relation, requestInbox))\n                return\n            }\n\n            let openRequest\n            let orgRequests: Array<requestModel.Request> | null\n            let orgInvitations: Array<requestModel.Request> | null\n            if (relation.type === orgModel.UserRelationToOrganization.OWNER ||\n                relation.type === orgModel.UserRelationToOrganization.ADMIN) {\n                orgRequests = await requestClient.getPendingOrganizationRequestsForOrg(organizationId)\n                orgInvitations = await requestClient.getOrganizationInvitationsForOrg(organizationId)\n                openRequest = await orgClient.getOpenRequestStatus({ organizationId })\n            } else {\n                orgRequests = null\n                orgInvitations = null\n                openRequest = orgModel.RequestStatus.INAPPLICABLE\n            }\n\n            const requestInbox: Array<requestModel.Request> = await requestClient.getCombinedRequestInboxForOrg(organizationId)\n            const requestOutbox: Array<requestModel.Request> = await requestClient.getRequestOutboxForOrg(organizationId)\n\n            // default narrative sort?\n            const narrativesSortBy = 'added'\n            const narratives = orgModel.queryNarratives(organization.narratives, {\n                sortBy: narrativesSortBy,\n                searchBy: ''\n            })\n\n            const sortMembersBy = 'added'\n            const members = orgModel.queryMembers(organization.members, {\n                sortBy: sortMembersBy,\n                searchBy: ''\n            })\n\n            dispatch(loadNormalSuccess(organization, relation, openRequest, orgRequests, orgInvitations,\n                requestInbox, requestOutbox, narrativesSortBy, narratives, sortMembersBy, members))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function reload(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n        })\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            // existing org view.\n            const state = getState()\n            const viewModel = state.views.viewOrgView.viewModel\n\n            if (!viewModel) {\n                dispatch(loadError({\n                    code: 'error',\n                    message: 'No view model'\n                }))\n                return\n            }\n\n            if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n                dispatch(loadError({\n                    code: 'error',\n                    message: 'Wrong org view model kind!'\n                }))\n                return\n            }\n\n            const { organization, relation } = await uberClient.getOrganizationForUser(organizationId)\n            if (organization.kind !== orgModel.OrganizationKind.NORMAL) {\n                const requestInbox = await requestClient.getRequestInboxForOrg(organizationId)\n                dispatch(loadInaccessiblePrivateSuccess(organization, relation, requestInbox))\n                return\n            }\n\n            let openRequest\n            let orgRequests: Array<requestModel.Request> | null\n            let orgInvitations: Array<requestModel.Request> | null\n            if (relation.type === orgModel.UserRelationToOrganization.OWNER ||\n                relation.type === orgModel.UserRelationToOrganization.ADMIN) {\n                orgRequests = await requestClient.getPendingOrganizationRequestsForOrg(organizationId)\n                orgInvitations = await requestClient.getOrganizationInvitationsForOrg(organizationId)\n                openRequest = await orgClient.getOpenRequestStatus({ organizationId })\n            } else {\n                orgRequests = null\n                orgInvitations = null\n                openRequest = orgModel.RequestStatus.INAPPLICABLE\n            }\n\n            const requestInbox: Array<requestModel.Request> = await requestClient.getCombinedRequestInboxForOrg(organizationId)\n            const requestOutbox: Array<requestModel.Request> = await requestClient.getRequestOutboxForOrg(organizationId)\n\n            // default narrative sort?\n            const narrativesSortBy = 'added'\n            const narratives = orgModel.queryNarratives(organization.narratives, {\n                sortBy: viewModel.sortNarrativesBy,\n                searchBy: viewModel.searchNarrativesBy\n            })\n\n            const sortMembersBy = 'added'\n            const members = orgModel.queryMembers(organization.members, {\n                sortBy: viewModel.sortMembersBy,\n                searchBy: viewModel.searchMembersBy\n            })\n\n            dispatch(loadNormalSuccess(organization, relation, openRequest, orgRequests, orgInvitations,\n                requestInbox, requestOutbox, narrativesSortBy, narratives, sortMembersBy, members))\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function viewOrgJoinRequest() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        //TODO: could do a start here...\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel: { organization } }\n            }\n        } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.requestMembership(organization.id)\n            dispatch(viewOrgJoinRequestSuccess())\n            dispatch(load((organization.id)))\n        } catch (ex) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function viewOrgCancelJoinRequest(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewOrgJoinRequestStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.cancelRequest(requestId)\n            dispatch(viewOrgCancelJoinRequestSuccess())\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(viewOrgCancelJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: ex.message\n            }))\n        }\n    }\n}\n\nexport function acceptJoinInvitation(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.acceptJoinInvitation(requestId)\n            dispatch(acceptJoinInvitationSuccess())\n            // quick 'n easy\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(acceptJoinInvitationError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n\nexport function rejectJoinInvitation(requestId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const state = getState()\n        if (!state.views.viewOrgView.viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: {\n                    viewModel: { organization } } } } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const newRequest = await requestClient.rejectJoinInvitation(requestId)\n            dispatch(rejectJoinInvitationSuccess())\n            dispatch(load(newRequest.organizationId))\n        } catch (ex) {\n            dispatch(rejectJoinInvitationError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n\n    }\n}\n\n// SORT NARRATIVES\nexport interface SortNarratives {\n    type: ActionFlag.VIEW_ORG_SORT_NARRATIVES,\n    sortBy: string\n}\n\nexport interface SortNarrativesStart {\n    type: ActionFlag.VIEW_ORG_SORT_NARRATIVES_START\n}\n\nexport interface SortNarrativesSuccess {\n    type: ActionFlag.VIEW_ORG_SORT_NARRATIVES_SUCCESS\n    narratives: Array<orgModel.NarrativeResource>\n    sortBy: string\n}\n\nexport interface SortNarrativesError {\n    type: ActionFlag.VIEW_ORG_SORT_NARRATIVES_ERROR\n    error: AnError\n}\n\n\n\nexport function sortNarratives(sortBy: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SORT_NARRATIVES_START\n        })\n\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (!viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Wrong org view model kind!'\n            }))\n            return\n        }\n\n        const { narratives } = viewModel.organization as orgModel.Organization\n        const searchBy = viewModel.searchNarrativesBy\n\n        const sorted = orgModel.queryNarratives(narratives, {\n            sortBy: sortBy,\n            searchBy: searchBy\n        })\n\n        // const sorted = orgModel.sortNarratives(narratives.slice(), sortBy)\n        // const sorted = narratives.slice().sort(sortByToComparator(sortBy))\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SORT_NARRATIVES_SUCCESS,\n            narratives: sorted,\n            sortBy\n        })\n\n    }\n}\n\n\n// SEARCH NARRATIVES\n\nexport interface SearchNarratives {\n    type: ActionFlag.VIEW_ORG_SEARCH_NARRATIVES,\n    searchBy: string\n}\n\nexport interface SearchtNarrativesStart {\n    type: ActionFlag.VIEW_ORG_SEARCH_NARRATIVES_START\n}\n\nexport interface SearchNarrativesSuccess {\n    type: ActionFlag.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS\n    narratives: Array<orgModel.NarrativeResource>\n    searchBy: string\n}\n\nexport interface SearchNarrativesError {\n    type: ActionFlag.VIEW_ORG_SEARCH_NARRATIVES_ERROR\n    error: AnError\n}\n\n\n\nexport function searchNarratives(searchBy: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SORT_NARRATIVES_START\n        })\n\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (!viewModel) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Now view model!'\n            }))\n            return\n        }\n\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Wrong org view model kind!'\n            }))\n            return\n        }\n\n        const { narratives } = viewModel.organization as orgModel.Organization\n        const sortBy = viewModel.sortNarrativesBy\n\n        const sorted = orgModel.queryNarratives(narratives, {\n            sortBy: sortBy,\n            searchBy: searchBy\n        })\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS,\n            searchBy: searchBy,\n            narratives: sorted\n        })\n\n    }\n}\n\n\n\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\nimport {\n    StoreState,\n    AppError,\n    ViewOrgViewModelKind\n} from '../../../types'\n\nimport * as requestModel from '../../../data/models/requests'\n\n\nexport interface AcceptRequestAction<T> extends Action<T> {\n}\n\nexport interface AcceptRequest extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST\n    request: requestModel.Request\n}\n\ninterface AcceptRequestStart extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_START> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_START\n}\n\nexport interface AcceptRequestSuccess extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,\n    requests: Array<requestModel.Request>\n}\n\ninterface AcceptRequestError extends AcceptRequestAction<ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR> {\n    type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n    error: AppError\n}\n\nexport function acceptRequest(requestId: requestModel.RequestID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, AcceptRequestAction<any>>, getState: () => StoreState) => {\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'error',\n                    message: 'No view model'\n                }\n            })\n            return\n        }\n\n        // argh\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'invalid state',\n                    message: 'Not the right kind of view model'\n                }\n            })\n            return\n        }\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        // do the cancellation\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await requestClient.acceptRequest(requestId)\n\n            // refetch the inbox\n            const inbox = await requestClient.getCombinedRequestInboxForOrg(viewModel.organization.id)\n\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,\n                requests: inbox\n            })\n\n\n\n            // send the inbox in the success\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n\n        // or error\n    }\n}\n\n","import * as React from 'react'\nimport { NavLink, withRouter, Route } from 'react-router-dom'\nimport './Header.css'\nimport { Icon, Menu } from 'antd';\nimport { ClickParam } from 'antd/lib/menu'\n\nexport interface HeaderProps {\n    breadcrumbs: JSX.Element\n    buttons?: JSX.Element\n    test?: string\n    // history: History.History\n}\n\ninterface HeaderState {\n    currentMenuItem: string\n}\n\ninterface MenuProps {\n    currentItem: string\n}\n// const TopMenu = withRouter<MenuProps>(({ history }) => {\n//         function doNavigate(key: string) {\n//             switch (key) {\n//                 case 'myorgs':\n//                     history.push('/dashboard')\n//                 case 'allorgs':\n//                     history.push('/organizations')\n//             }\n//         }\n//         return (\n//             <Menu\n//                 onClick={(e: ClickParam) => { doNavigate(e.key) }}\n//                 selectedKeys={[this.state.currentMenuItem]}\n//                 mode=\"horizontal\"\n//             >\n//                 <Menu.Item key=\"myorgs\">\n//                     My Organizations\n//                 </Menu.Item>\n//                 <Menu.Item key=\"allorgs\">\n//                     All Organizations\n//                 </Menu.Item>\n//             </Menu>\n//         )\n//     })\n// }\n\nclass Header extends React.Component<HeaderProps, HeaderState> {\n\n    constructor(props: HeaderProps, context: React.Context<any>) {\n        super(props)\n\n        this.state = {\n            currentMenuItem: 'myorgs'\n        }\n    }\n    // <FaChevronRight style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n    buildSeparator() {\n        if (this.props.breadcrumbs) {\n            return (\n                <Icon type=\"right\" style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n            )\n        }\n    }\n\n    onMenuSelection(e: ClickParam) {\n        // this.setState({\n        //     currentMenuItem: e.key\n        // })\n        // switch (e.key) {\n        //     case 'allorgs':\n        //         this.props.history.push('/organizations')\n        // }\n    }\n\n    render() {\n        return (\n            <div className=\"Header\">\n                <div className=\"Header-contextual\">\n                    <div className=\"Header-userColumn\">\n                        <div className=\"Header-breadcrumbs\">\n                            {this.props.breadcrumbs}\n                        </div>\n                        <div className=\"Header-buttons\">\n                            {this.props.buttons}\n                        </div>\n                        {/* {this.props.children} */}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Header;","import uuid from 'uuid/v4'\n\nexport interface AnError {\n    code: string\n    message: string\n    id: string\n    at: Date\n\n\n    detail?: string\n    history?: Array<AnError>\n    trace?: Array<string>\n    info?: any\n}\n\nexport function makeError(\n    { code, message, detail, history, trace, info }:\n        {\n            code: string, message: string,\n            detail?: string,\n            history?: Array<AnError>, trace?: Array<string>, info?: any\n        }\n) {\n    return {\n        code, message, detail,\n        id: uuid(),\n        at: new Date(),\n        history, trace, info\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\n\nimport { AppError, StoreState, ViewOrgViewModelKind } from '../../../types'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as uberModel from '../../../data/models/uber'\nimport { AnError, makeError } from '../../../lib/error'\nimport { reload as reloadOrg } from '../viewOrg'\n\n// LOADING\n\nexport interface Load extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD,\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_START\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_UNLOAD\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR\n    error: AppError\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, relation: orgModel.Relation): LoadSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS,\n        organization: organization,\n        relation: relation\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n\n        const uberClient = new uberModel.UberModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        try {\n            const { organization, relation } = await uberClient.getOrganizationForUser(organizationId)\n            if (organization.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(loadError({\n                    code: 'invalid state',\n                    message: 'Organization must be of kind \"NORMAL\"'\n                }))\n                return\n            }\n            dispatch(loadSuccess(organization, relation))\n\n        } catch (ex) {\n            dispatch(loadError({\n                code: ex.name,\n                message: ex.message\n            }))\n        }\n    }\n}\n\n// Promoting member to admin\n\nexport interface PromoteToAdmin extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    memberUsername: string\n}\n\nexport interface PromoteToAdminStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n}\n\nexport interface PromoteToAdminSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    memberUsername: string\n}\n\nexport interface PromoteToAdminError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n    error: AppError\n}\n\n\nexport function promoteToAdminStart(): PromoteToAdminStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n    }\n}\n\nexport function promoteToAdminSuccess(memberUsername: string): PromoteToAdminSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n        memberUsername\n    }\n}\n\nexport function promoteToAdminError(error: AppError): PromoteToAdminError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n        error: error\n    }\n}\n\nexport function promoteToAdmin(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(promoteToAdminStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.memberToAdmin(viewModel.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(promoteToAdminSuccess(memberUsername))\n            })\n            .catch((err: Error) => {\n                dispatch(promoteToAdminError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Demote admin to member\n\nexport interface DemoteToMember extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    memberUsername: string\n}\n\nexport interface DemoteToMemberStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n}\n\nexport interface DemoteToMemberSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    memberUsername: string\n}\n\nexport interface DemoteToMemberError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n    error: AppError\n}\n\n\nexport function demoteToMemberStart(): DemoteToMemberStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n    }\n}\n\nexport function demoteToMemberSuccess(memberUsername: string): DemoteToMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n        memberUsername: memberUsername\n    }\n}\n\nexport function demoteToMemberError(error: AppError): DemoteToMemberError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function demoteToMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(demoteToMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.adminToMember(viewModel.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(demoteToMemberSuccess(memberUsername))\n                // dispatch(viewMembersLoad(view.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(demoteToMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Remove a member\n\nexport interface RemoveMember extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER,\n    memberUsername: string\n}\n\ninterface RemoveMemberStart extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START\n}\n\nexport interface RemoveMemberSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    memberUsername: orgModel.Username\n}\n\ninterface RemoveMemberError extends Action {\n    type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n    error: AppError\n}\n\nfunction removeMemberStart(): RemoveMemberStart {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START\n    }\n}\n\nfunction removeMemberSuccess(memberUsername: orgModel.Username): RemoveMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n        memberUsername\n    }\n}\n\nfunction removeMemberError(error: AppError): RemoveMemberError {\n    return {\n        type: ActionFlag.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function removeMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        orgClient.removeMember(viewModel.organization.id, memberUsername)\n            .then(() => {\n                // dispatch(removeMemberSuccess(memberUsername))\n                // dispatch(load(viewModel.organization.id))\n                dispatch(reloadOrg(viewModel.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(removeMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// SORT MEMBERS\n\nexport interface SortMembers {\n    type: ActionFlag.VIEW_ORG_SORT_MEMBERS,\n    sortBy: string\n}\n\nexport interface SortMembersStart {\n    type: ActionFlag.VIEW_ORG_SORT_MEMBERS_START\n}\n\nexport interface SortMembersSuccess {\n    type: ActionFlag.VIEW_ORG_SORT_MEMBERS_SUCCESS\n    members: Array<orgModel.Member>\n    sortBy: string\n}\n\nexport interface SortMembersError {\n    type: ActionFlag.VIEW_ORG_SORT_MEMBERS_ERROR\n    error: AnError\n}\n\n\n\nexport function sortMembers(sortBy: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SORT_MEMBERS_START\n        })\n\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_SORT_MEMBERS_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: 'No view model'\n                })\n            })\n            return\n        }\n\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_SORT_MEMBERS_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: 'Wrong org view model kind!'\n                })\n            })\n            return\n        }\n\n        const { members } = viewModel.organization as orgModel.Organization\n        const searchBy = viewModel.searchMembersBy\n\n        const sorted = orgModel.queryMembers(members, {\n            sortBy: sortBy,\n            searchBy: searchBy\n        })\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SORT_MEMBERS_SUCCESS,\n            members: sorted,\n            sortBy\n        })\n\n    }\n}\n\n// SEARCH MEMBERS\n\nexport interface SearchMembers {\n    type: ActionFlag.VIEW_ORG_SEARCH_MEMBERS,\n    searchBy: string\n}\n\nexport interface SearchtMembersStart {\n    type: ActionFlag.VIEW_ORG_SEARCH_MEMBERS_START\n}\n\nexport interface SearchMembersSuccess {\n    type: ActionFlag.VIEW_ORG_SEARCH_MEMBERS_SUCCESS\n    members: Array<orgModel.Member>\n    searchBy: string\n}\n\nexport interface SearchMembersError {\n    type: ActionFlag.VIEW_ORG_SEARCH_MEMBERS_ERROR\n    error: AnError\n}\n\nexport function searchMembers(searchBy: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SORT_MEMBERS_START\n        })\n\n        const state = getState()\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (!viewModel) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_SORT_MEMBERS_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: 'No view model'\n                })\n            })\n            return\n        }\n\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_SORT_MEMBERS_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: 'Wrong org view model kind!'\n                })\n            })\n            return\n        }\n\n        const { members } = viewModel.organization as orgModel.Organization\n        const sortBy = viewModel.sortMembersBy\n\n        const sorted = orgModel.queryMembers(members, {\n            sortBy: sortBy,\n            searchBy: searchBy\n        })\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_SEARCH_MEMBERS_SUCCESS,\n            searchBy: searchBy,\n            members: sorted\n        })\n\n    }\n}","import * as React from 'react'\n\nimport Avatar from './Avatar'\nimport { } from '../../types';\nimport { Icon, Tooltip } from 'antd';\nimport * as orgModel from '../../data/models/organization/model'\nimport * as userModel from '../../data/models/user'\n\nimport './Member.css'\nimport NiceElapsedTime from '../NiceElapsedTime';\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nexport interface MemberProps {\n    member: orgModel.Member\n    user: userModel.User\n    avatarSize?: number\n}\n\ninterface MemberState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nclass Member extends React.Component<MemberProps, MemberState> {\n    constructor(props: MemberProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderRole() {\n        switch (this.props.member.type) {\n            case orgModel.MemberType.OWNER:\n                return (\n                    <span>\n                        <Icon type=\"crown\" /> owner\n                </span>\n                )\n            case orgModel.MemberType.ADMIN:\n                return (\n                    <span>\n                        <Icon type=\"unlock\" /> admin\n                </span>\n                )\n            case orgModel.MemberType.MEMBER:\n                return (\n                    <span>\n                        <Icon type=\"user\" /> member\n                </span>\n                )\n        }\n    }\n\n    renderCompact() {\n        const userTooltip = (\n            <div>\n                {this.props.member.username}\n            </div>\n        )\n        return (\n            <div className=\"Member View-COMPACT\" >\n                <div className=\"Member-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"Member-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"Member-infoCol\">\n                    <div className=\"Member-name\">\n                        <Tooltip placement=\"bottomRight\" title={userTooltip}>\n                            <a href={\"/#people/\" + this.props.member.username} target=\"_blank\">{this.props.user.realname}</a>\n                        </Tooltip>\n                    </div>\n                    <div className=\"Member-role\">\n                        {this.renderRole()}\n                        {', joined '}\n                        <NiceElapsedTime time={this.props.member.joinedAt} />\n                    </div>\n                    <div className=\"Member-title\">\n                        {this.props.member.title || this.props.user.title}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderNormal() {\n        const userTooltip = (\n            <div>\n                {this.props.member.username}\n            </div>\n        )\n        return (\n            <div className=\"Member View-NORMAL\" >\n                <div className=\"Member-controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"Member-avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"Member-infoCol\">\n                    <div className=\"Member-name\">\n                        <Tooltip placement=\"bottomRight\" title={userTooltip}>\n                            <a href={\"/#people/\" + this.props.member.username} target=\"_blank\">{this.props.user.realname}</a>\n                        </Tooltip>\n                    </div>\n                    <div className=\"Member-role\">\n                        {this.renderRole()}\n                        {', joined '}\n                        <NiceElapsedTime time={this.props.member.joinedAt} />\n                    </div>\n                    <div className=\"Member-title\">\n                        {this.props.member.title || this.props.user.title}\n                    </div>\n                    <div className=\"Member-organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"Member-location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.state.view) {\n            case View.COMPACT:\n                return this.renderCompact()\n\n            case View.NORMAL:\n                return this.renderNormal()\n        }\n    }\n}\n\nexport default Member","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport Member from './Member'\n\ninterface LoaderProps {\n    member: orgModel.Member\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <Member member={this.props.member} user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.member.username)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\nimport * as orgModel from '../../data/models/organization/model'\n\n\nexport interface OwnProps {\n    member: orgModel.Member\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.member.username)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport { Alert, Card, Menu, Icon, Dropdown, Modal, Input, Select } from 'antd'\nimport Member from '../../../../entities/MemberContainer'\nimport './component.css'\nimport { organizationLoader } from '../../../../../redux/actions/entities';\n\nexport interface MembersProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    searchMembersBy: string\n    sortMembersBy: string\n    members: Array<orgModel.Member>\n    onPromoteMemberToAdmin: (username: string) => void\n    onRemoveMember: (username: string) => void\n    onDemoteAdminToMember: (username: string) => void\n    onSearchMembers: (searchBy: string) => void\n    onSortMembers: (sortBy: string) => void\n    onReloadOrg: (id: string) => void\n}\n\ninterface MembersState {\n    confirmMemberRemoval: {\n        member: orgModel.Member\n    } | null\n}\n\nexport default class Members extends React.Component<MembersProps, MembersState> {\n    constructor(props: MembersProps) {\n        super(props)\n        this.state = {\n            confirmMemberRemoval: null\n        }\n    }\n\n    onConfirmRemoveMember(member: orgModel.Member) {\n        this.setState({\n            confirmMemberRemoval: {\n                member: member\n            }\n        })\n    }\n\n    renderConfirmMemberRemoval() {\n        if (!this.state.confirmMemberRemoval) {\n            return\n        }\n        const member = this.state.confirmMemberRemoval.member\n        const confirmed = (() => {\n            this.props.onRemoveMember(member.username)\n            this.setState({\n                confirmMemberRemoval: null\n            })\n        })\n        const canceled = (() => {\n            this.setState({\n                confirmMemberRemoval: null\n            })\n        })\n        const title = 'Confirm Removal of Member'\n        const content = (\n            <React.Fragment>\n                <p>\n                    Please confirm removal of this member from this organization.\n                </p>\n                <div className=\"simpleCard\" style={{ marginBottom: '1em' }}>\n                    <Member member={member} avatarSize={20} />\n                </div>\n                <p>\n                    This user as well as members of this organization will receive a notification\n                    of the removal.\n                </p>\n                <p>\n                    Any Narratives associated by this member with this Organization will be unaffected. This member\n                    will also retain any Narrative permissions granted through this Organization.\n                </p>\n            </React.Fragment>\n        )\n        return (\n            <Modal\n                title={title}\n                width=\"50em\"\n                visible={true}\n                onOk={() => { confirmed() }}\n                onCancel={() => { canceled() }}\n                okText=\"Confirm\">\n                {content}\n            </Modal>\n        )\n    }\n\n    onMemberMenu(key: string, member: orgModel.Member) {\n        switch (key) {\n            case 'promoteToAdmin':\n                this.props.onPromoteMemberToAdmin(member.username)\n                break\n            case 'removeMember':\n                this.onConfirmRemoveMember(member)\n                break\n        }\n    }\n\n    onAdminMenu(key: string, member: orgModel.Member) {\n        switch (key) {\n            case 'demoteToMember':\n                this.props.onDemoteAdminToMember(member.username)\n                break\n        }\n    }\n\n    renderMemberMenu(member: orgModel.Member) {\n        const menu = (\n            <Menu onClick={({ key }) => { this.onMemberMenu.call(this, key, member) }}>\n                <Menu.Item key=\"promoteToAdmin\" >\n                    <Icon type=\"unlock\" />Promote to Admin\n                </Menu.Item>\n                <Menu.Item key=\"removeMember\" >\n                    <Icon type=\"delete\" />Remove Member\n                </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Icon type=\"ellipsis\" className=\"IconButton-hover\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderAdminMenu(member: orgModel.Member) {\n        const menu = (\n            <Menu onClick={({ key }) => { this.onAdminMenu.call(this, key, member) }}>\n                <Menu.Item key=\"demoteToMember\">\n                    <Icon type=\"user\" />Demote to Member\n                    </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Icon type=\"ellipsis\" className=\"IconButton-hover\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderOwnerMenu(member: orgModel.Member) {\n        return (\n            <div></div>\n        )\n    }\n\n    renderMemberOptions(member: orgModel.Member) {\n        if (!(this.props.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN)) {\n            return\n        }\n\n        switch (member.type) {\n            case orgModel.MemberType.OWNER:\n                return this.renderOwnerMenu(member)\n            case orgModel.MemberType.ADMIN:\n                return this.renderAdminMenu(member)\n            case orgModel.MemberType.MEMBER:\n                return this.renderMemberMenu(member)\n        }\n    }\n\n    renderMembers() {\n        let members: JSX.Element | Array<JSX.Element>\n        const message = (\n            <div style={{ fontStyle: 'italic', textAlign: 'center' }}>\n                No members\n            </div>\n        )\n\n        if (this.props.members.length === 0) {\n            members = (\n                <Alert type=\"info\" message={message} />\n            )\n        } else {\n            members = this.props.members.map((member) => {\n                let isNew: boolean\n                if (this.props.organization.lastVisitedAt === null) {\n                    isNew = false\n                } else {\n                    isNew = this.props.organization.lastVisitedAt.getTime() < member.joinedAt.getTime()\n                }\n                const classNames = ['Members-row', 'simpleCard']\n                if (isNew) {\n                    classNames.push('Members-newMember')\n                }\n                return (\n                    <div className={classNames.join(' ')} key={member.username}>\n                        <div className=\"Members-member\">\n                            <Member member={member} avatarSize={50} />\n                        </div>\n                        <div className=\"Members-menu\">\n                            {this.renderMemberOptions(member)}\n                        </div>\n                    </div>\n                )\n            })\n        }\n\n        return (\n            <div className=\"infoTable\">\n                {members}\n            </div>\n        )\n    }\n\n    renderSearchBar() {\n        const doChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n            this.props.onSearchMembers(e.target.value)\n        }\n        return (\n            <div style={{ paddingRight: '6px' }}>\n                <Input style={{ width: '100%', marginRight: '6px' }}\n                    placeholder=\"Filter members by name\"\n                    onChange={doChange} />\n            </div>\n        )\n    }\n\n    renderSortBar() {\n        const handleSelect = (value: string) => {\n            this.props.onSortMembers(value)\n        }\n        return (\n            <React.Fragment>\n                <span className=\"field-label\">sort</span>\n                <Select onChange={handleSelect}\n                    style={{ width: '10em' }}\n                    dropdownMatchSelectWidth={true}\n                    defaultValue={this.props.sortMembersBy}\n                >\n                    <Select.Option value=\"name\" key=\"name\">Name</Select.Option>\n                    <Select.Option value=\"added\" key=\"added\">Date Joined</Select.Option>\n                </Select>\n            </React.Fragment>\n        )\n    }\n\n    renderHeader() {\n        return (\n            <div className=\"ViewOrganizationMembers-headerRow\">\n                <div className=\"ViewOrganizationMembers-searchCol\">\n                    {this.renderSearchBar()}\n                </div>\n                <div className=\"ViewOrganizationMembers-sortCol\">\n                    {this.renderSortBar()}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        let confirm\n        if (this.state.confirmMemberRemoval) {\n            confirm = this.renderConfirmMemberRemoval()\n        }\n        return (\n            <React.Fragment>\n                <div className=\"ViewOrganizationMembers scrollable-flex-column\">\n                    <div className=\"ViewOrganizationMembers-header\">\n                        {this.renderHeader()}\n                    </div>\n                    <div className=\"ViewOrganizationMembers-body scrollable-flex-column\">\n                        {this.renderMembers()}\n                    </div>\n                </div>\n                {confirm}\n            </React.Fragment>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, ViewOrgViewModelKind } from '../../../../../types'\nimport * as actions from '../../../../../redux/actions/viewOrganization/viewMembers'\nimport ViewMembers from './component'\nimport * as orgModel from '../../../../../data/models/organization/model'\n\nexport interface OwnProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    onReloadOrg: (id: string) => void\n}\n\ninterface StateProps {\n    searchMembersBy: string\n    sortMembersBy: string\n    members: Array<orgModel.Member>\n}\n\ninterface DispatchProps {\n    onViewMembersUnload: () => void,\n    onPromoteMemberToAdmin: (memberUsername: string) => void,\n    onDemoteAdminToMember: (adminUsername: string) => void,\n    onRemoveMember: (memberUsername: string) => void\n    onSearchMembers: (searchBy: string) => void\n    onSortMembers: (sortBy: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    const { searchMembersBy, sortMembersBy, members } = viewModel\n    return {\n        searchMembersBy, sortMembersBy, members\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onViewMembersUnload: () => {\n            dispatch(actions.unload() as any)\n        },\n        onPromoteMemberToAdmin: (memberUsername: string) => {\n            dispatch(actions.promoteToAdmin(memberUsername) as any)\n        },\n        onDemoteAdminToMember: (adminUsername: string) => {\n            dispatch(actions.demoteToMember(adminUsername) as any)\n        },\n        onRemoveMember: (memberUsername: string) => {\n            dispatch(actions.removeMember(memberUsername) as any)\n        },\n        onSearchMembers: (searchBy: string) => {\n            dispatch(actions.searchMembers(searchBy) as any)\n        },\n        onSortMembers: (sortBy: string) => {\n            dispatch(actions.sortMembers(sortBy) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewMembers)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\nimport {\n    StoreState,\n    AppError,\n    ViewOrgViewModelKind\n} from '../../../types'\n\nimport * as requestModel from '../../../data/models/requests'\n\n// Reject inbound request\n\nexport interface RejectRequestAction<T> extends Action<T> {\n}\n\nexport interface RejectInboxRequest extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST\n    request: requestModel.Request\n}\n\ninterface RejectInboxRequestStart extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_START> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_START\n}\n\nexport interface RejectInboxRequestSuccess extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS\n    requests: Array<requestModel.Request>\n}\n\ninterface RejectInboxRequestError extends RejectRequestAction<ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR> {\n    type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,\n    error: AppError\n}\n\nexport function denyRequest(requestId: requestModel.RequestID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, RejectRequestAction<any>>, getState: () => StoreState) => {\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'error',\n                    message: 'No view model'\n                }\n            })\n            return\n        }\n\n        // argh\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'invalid state',\n                    message: 'Not the right kind of view model'\n                }\n            })\n            return\n        }\n\n        dispatch({\n            type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        // do the cancelation\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await requestClient.denyRequest(requestId)\n\n            // refetch the outbox\n            const inbox = await requestClient.getRequestInboxForOrg(viewModel.organization.id)\n\n            dispatch({\n                type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,\n                requests: inbox\n            } as RejectInboxRequestSuccess)\n\n            // send the inbox in the success\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n\n\n        // or error\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\nimport {\n    StoreState,\n    AppError,\n    UIError,\n    UIErrorType,\n    ViewOrgViewModelKind\n} from '../../../types'\n\nimport * as requestModel from '../../../data/models/requests'\nimport { AnError, makeError } from '../../../lib/error';\n\nexport interface CancelJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST\n}\n\nexport interface CancelJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n}\n\nexport interface CancelJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n    requests: Array<requestModel.Request>\n}\n\nexport interface CancelJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n    error: AnError\n}\n\nexport function cancelRequest(requestId: requestModel.RequestID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n        })\n\n        const state = getState()\n\n        const viewModel = state.views.viewOrgView.viewModel\n\n        if (viewModel === null) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'error',\n                    message: 'No view model'\n                }\n            })\n            return\n        }\n\n        // argh\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,\n                error: {\n                    code: 'invalid state',\n                    message: 'Not the right kind of view model'\n                }\n            })\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await requestClient.cancelRequest(requestId)\n\n            const requests: Array<requestModel.Request> = await requestClient.getRequestOutboxForOrg(viewModel.organization.id)\n\n            dispatch({\n                type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,\n                requests\n            } as CancelJoinRequestSuccess)\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            } as CancelJoinRequestError)\n        }\n    }\n}","import * as React from 'react'\nimport './User.css'\nimport Avatar from './Avatar'\nimport * as userModel from '../../data/models/user'\nimport { Button, Icon } from 'antd';\n\nexport interface UserProps {\n    user: userModel.User\n    avatarSize?: number\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\ninterface UserState {\n    view: View\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\nfunction viewLabel(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return 'Compact'\n        case View.NORMAL:\n            return 'Normal'\n    }\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderCompact() {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                    </div>\n                    <div>\n                        {this.props.user.username}\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNormal() {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                    </div>\n                    <div>\n                        {this.props.user.username}\n                    </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        switch (this.state.view) {\n            case View.COMPACT:\n                return (\n                    <div className=\"User View-COMPACT\">\n                        {this.renderCompact()}\n                    </div>\n                )\n            case View.NORMAL:\n                return (\n                    <div className=\"User View-NORMAL\">\n                        {this.renderNormal()}\n                    </div>\n                )\n        }\n    }\n}\n\nexport default User","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport User from './User'\n\ninterface LoaderProps {\n    userId: userModel.Username\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <User user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.userId)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\n\n\nexport interface OwnProps {\n    userId: userModel.Username\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.userId)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport * as narrativeModel from '../../data/models/narrative'\nimport { Tooltip, Icon, Alert } from 'antd';\nimport './Narrative.css'\nimport UserSimple from './UserContainer';\n\nexport interface NarrativeProps {\n    narrative: narrativeModel.Narrative\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\ninterface NarrativeState {\n    view: View\n}\n\nexport default class Narrative extends React.Component<NarrativeProps, NarrativeState> {\n    constructor(props: NarrativeProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderPublicPermission(narrative: narrativeModel.AccessibleNarrative) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"global\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderUserPermission(narrative: narrativeModel.AccessibleNarrative) {\n        let label\n        switch (narrative.access) {\n            case narrativeModel.NarrativeAccess.VIEW:\n                label = (\n                    <span>View-Only (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.EDIT:\n                label = (\n                    <span>Edit (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.ADMIN:\n                label = 'Admin'\n                break\n            case narrativeModel.NarrativeAccess.OWNER:\n                label = 'Owner'\n                break\n            default:\n                label = 'Unknown'\n        }\n        return (\n            <span>\n                {label}\n            </span>\n        )\n    }\n\n    renderCompact(narrative: narrativeModel.AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div>\n                <div className=\"mainCol\">\n                    <div className=\"Narrative-title\">\n                        <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                            {narrative.title}\n                        </a>\n                    </div>\n                    {' '}\n                    <div className=\"Narrative-owner\">\n                        <UserSimple avatarSize={20} userId={narrative.owner} />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNormal(narrative: narrativeModel.AccessibleNarrative) {\n        // const narrative = this.props.narrative\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div>\n                <div className=\"mainCol\">\n                    <div className=\"mainCol\">\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {' '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            <Icon type=\"crown\" />\n                        </div>\n                        <div className=\"Narrative-global\">\n                            <Icon type=\"global\" />\n                        </div>\n                    </div>\n                    <div>\n                        {this.renderPublicPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">your permission</span>\n                        {this.renderUserPermission(narrative)}\n                    </div>\n                    {/* <div>\n                        <span className=\"field-label\">owner</span>\n                        <UserSimple avatarSize={20} userId={narrative.owner} />\n                    </div> */}\n                    <div>\n                        <span className=\"field-label\">last saved</span>{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(narrative.lastSavedAt)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">by</span>{narrative.lastSavedBy}\n                    </div>\n                </div>\n\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        const narrative = this.props.narrative\n        if (narrative.access === narrativeModel.NarrativeAccess.NONE) {\n            return (\n                <div>\n                    <Icon type=\"exclamation-circle\" style={{ color: 'orange' }} />\n                    {' '}\n                    You don't have access to this Narrative\n                </div>\n            )\n        }\n        switch (this.state.view) {\n            case View.COMPACT:\n                return (\n                    <div className=\"Narrative View-COMPACT\">\n                        {this.renderCompact(narrative)}\n                    </div>\n                )\n            case View.NORMAL:\n                return (\n                    <div className=\"Narrative View-NORMAL\">\n                        {this.renderNormal(narrative)}\n                    </div>\n                )\n        }\n\n    }\n}","import * as React from 'react'\nimport * as narrativeModel from '../../data/models/narrative'\nimport * as orgModel from '../../data/models/organization/model'\nimport Narrative from './Narrative'\n\ninterface LoaderProps {\n    workspaceId: narrativeModel.WorkspaceID\n    narrative: narrativeModel.Narrative | null\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\ninterface LoaderState { }\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.narrative) {\n            return (\n                <Narrative\n                    narrative={this.props.narrative}\n                />\n            )\n        } else {\n            return (\n                <div>\n                    Loading narrative...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.narrative) {\n            this.props.onLoad(this.props.workspaceId)\n        }\n    }\n}\n\n// redux wrapper\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types'\nimport * as actions from '../../redux/actions/entities'\n\nexport interface OwnProps {\n    workspaceId: narrativeModel.WorkspaceID\n}\n\ninterface StateProps {\n    narrative: narrativeModel.Narrative | null\n}\n\ninterface DispatchProps {\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        narrative: state.entities.narratives.byId.get(props.workspaceId) || null\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (workspaceId: narrativeModel.WorkspaceID) => {\n            dispatch(actions.loadNarrative(workspaceId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)\n","import * as React from 'react'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { niceElapsed } from '../../../../../lib/time'\nimport Narrative from '../../../../entities/NarrativeContainer';\nimport User from '../../../../entities/UserContainer';\nimport { Button, Icon } from 'antd';\nimport './InboxRequest.css'\n\nexport interface RequestProps {\n    request: requestModel.Request\n    onAcceptInboxRequest: (request: requestModel.Request) => void\n    onRejectInboxRequest: (request: requestModel.Request) => void\n}\n\ninterface RequestState {\n\n}\n\nexport default class Request extends React.Component<RequestProps, RequestState> {\n    constructor(props: RequestProps) {\n        super(props)\n    }\n\n    onAcceptRequest() {\n        this.props.onAcceptInboxRequest(this.props.request)\n    }\n\n    onRejectRequest() {\n        this.props.onRejectInboxRequest(this.props.request)\n    }\n\n    renderRequestSentSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <User userId={request.user} avatarSize={30} />\n                                </div>\n                            </div>\n                        )\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestRequester(request: requestModel.Request) {\n        return (\n            <User userId={request.requester} avatarSize={30} />\n        )\n    }\n\n    renderRequestReceivedType(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'REQUEST to associate App'\n                    case requestModel.RequestResourceType.USER:\n                        return 'REQUEST to join Organization'\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return 'REQUEST to associate Narrative'\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return 'INVITATION to join Organization'\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestReceivedSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                                <div className=\"cardSectionHeader\">with organization</div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderJoinRequest(request: requestModel.UserRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to join Organization\n                </div>\n\n                <div className=\"cardSectionHeader\">from</div>\n\n                <div className=\"requestSubject\">{this.renderRequestRequester(request)}</div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderWorkspaceRequest(request: requestModel.WorkspaceRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to associate Narrative\n                </div>\n\n                <div className=\"miniDetail\">\n                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                </div>\n\n                <div className=\"cardSectionHeader\">from</div>\n\n                <div className=\"requester miniDetail\">{this.renderRequestRequester(request)}</div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderRequestOptions(request: requestModel.Request) {\n        // First, did the current user make or receive the request\n        return (\n            <div style={{ textAlign: 'center' }}>\n                <Button.Group style={{ marginTop: '4px' }}>\n                    <Button type=\"default\" onClick={this.onAcceptRequest.bind(this)}>\n                        <Icon type=\"check\" />\n                        Accept\n                        </Button>\n                    <Button type=\"danger\" onClick={this.onRejectRequest.bind(this)}>\n                        <Icon type=\"cross\" />\n                        Reject\n                        </Button>\n                    {/* <Button>\n                            <Icon type=\"eye\" />\n                            Visit\n                        </Button> */}\n                </Button.Group>\n            </div>\n        )\n    }\n\n    renderUserInvitation(request: requestModel.UserInvitation) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    INVITATION to join organization\n                </div>\n\n                <div className=\"requestSubject\">{this.renderRequestReceivedSubject(request)}</div>\n\n                <div className=\"cardSectionHeader\">\n                    from\n                </div>\n                <User userId={request.requester} avatarSize={30} />\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderBody() {\n        const request = this.props.request\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderJoinRequest(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return this.renderWorkspaceRequest(request)\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>\n                                    apps not supported yet\n                            </div>\n                            </React.Fragment>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderUserInvitation(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                }\n        }\n    }\n\n    render() {\n        const request = this.props.request\n        return (\n            <div key={request.id} className=\"InboxRequest kbCard\">\n                <div className=\"kbCard-header\">\n                    <div className=\"InboxRequest-requestHeaderRow\">\n                        <div className=\"InboxRequest-requestHeaderCreatedAt\">\n                            {/* <span className=\"field-label\">created</span>\n                                {' '} */}\n                            {Intl.DateTimeFormat('en-US', {\n                                month: 'short',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}\n                        </div>\n                        <div className=\"InboxRequest-requestHeaderExpireAt\">\n                            <span className=\"field-label\">expires</span>\n                            {' '}\n                            {niceElapsed(request.expireAt)}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"kbCard-body\">\n                    {this.renderBody()}\n                </div>\n            </div>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { StoreState } from '../../../../../types';\nimport * as acceptActions from '../../../../../redux/actions/viewOrganization/acceptInboxRequest'\nimport * as rejectActions from '../../../../../redux/actions/viewOrganization/denyInboxRequest'\nimport InboxRequest from './InboxRequest'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onAcceptInboxRequest: (request: requestModel.Request) => void\n    onRejectInboxRequest: (request: requestModel.Request) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAcceptInboxRequest: (request: requestModel.Request) => {\n            dispatch(acceptActions.acceptRequest(request.id) as any)\n        },\n        onRejectInboxRequest: (request: requestModel.Request) => {\n            dispatch(rejectActions.denyRequest(request.id) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(InboxRequest)\n","import * as React from 'react'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { niceElapsed } from '../../../../../lib/time'\nimport Narrative from '../../../../entities/NarrativeContainer';\nimport User from '../../../../entities/UserContainer';\nimport { Button, Icon } from 'antd';\nimport './OutboxRequest.css'\n\nexport interface RequestProps {\n    request: requestModel.Request\n    onCancelOutboxRequest: (request: requestModel.Request) => void\n}\n\ninterface RequestState {\n\n}\n\nexport default class Request extends React.Component<RequestProps, RequestState> {\n    constructor(props: RequestProps) {\n        super(props)\n    }\n\n    // renderRequestSentType(request: requestModel.Request) {\n    //     switch (request.type) {\n    //         case requestModel.RequestType.REQUEST:\n    //             switch (request.resourceType) {\n    //                 case requestModel.RequestResourceType.APP:\n    //                     return 'REQUEST to associate App'\n    //                 case requestModel.RequestResourceType.USER:\n    //                     return 'REQUEST to join Organization'\n    //                 case requestModel.RequestResourceType.WORKSPACE:\n    //                     return 'REQUEST to associate Narrative'\n    //             }\n    //         case requestModel.RequestType.INVITATION:\n    //             switch (request.resourceType) {\n    //                 case requestModel.RequestResourceType.USER:\n    //                     return 'INVITATION to join Organization'\n    //             }\n    //     }\n    //     return 'unknown request'\n    // }\n\n    onCancelRequest() {\n        this.props.onCancelOutboxRequest(this.props.request)\n    }\n\n    onAcceptInvitation() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n    onRejectInvitation() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n\n    onAcceptRequest() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n    onRejectRequest() {\n        alert('Hold your socks, not yet implemented')\n    }\n\n\n\n    renderRequestSentSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <User userId={request.user} avatarSize={30} />\n                                </div>\n                            </div>\n                        )\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestRequester(request: requestModel.Request) {\n        return (\n            <User userId={request.requester} avatarSize={30} />\n        )\n    }\n\n    renderRequestReceivedType(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'REQUEST to associate App'\n                    case requestModel.RequestResourceType.USER:\n                        return 'REQUEST to join Organization'\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return 'REQUEST to associate Narrative'\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return 'INVITATION to join Organization'\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderRequestReceivedSubject(request: requestModel.Request) {\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.APP:\n                        return 'SHOW APP'\n                    case requestModel.RequestResourceType.USER:\n                        return ''\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <div>\n                                <div className=\"miniDetail\">\n                                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                                </div>\n                                <div className=\"cardSectionHeader\">with organization</div>\n                            </div>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return (\n                            <User userId={request.user} avatarSize={30} />\n                        )\n                }\n        }\n        return 'unknown request'\n    }\n\n    renderJoinRequest(request: requestModel.UserRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to join Organization\n                </div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderWorkspaceRequest(request: requestModel.WorkspaceRequest) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    REQUEST to associate Narrative\n                </div>\n\n                <div className=\"miniDetail\">\n                    <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n                </div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderRequestOptions(request: requestModel.Request) {\n        // First, did the current user make or receive the request\n        return (\n            <div style={{ textAlign: 'center' }}>\n                <Button.Group style={{ marginTop: '4px' }}>\n                    <Button type=\"danger\" onClick={this.onCancelRequest.bind(this)}>\n                        <Icon type=\"cross\" />Cancel\n                        </Button>\n                    {/* <Button onClick={this.onVisitOrg.bind(this)}>\n                            <Icon type=\"eye\" />Visit \n                        </Button> */}\n                </Button.Group>\n            </div>\n        )\n\n    }\n\n    renderUserInvitation(request: requestModel.UserInvitation) {\n        return (\n            <React.Fragment>\n                <div className=\"cardSectionHeader\">\n                    INVITATION to join organization\n                </div>\n\n                <div className=\"cardSectionHeader\">\n                    sent to\n                </div>\n\n                <div className=\"miniDetail\">\n                    {this.renderRequestReceivedSubject(request)}\n                </div>\n\n                {this.renderRequestOptions(request)}\n            </React.Fragment>\n        )\n    }\n\n    renderBody() {\n        const request = this.props.request\n        switch (request.type) {\n            case requestModel.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderJoinRequest(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return this.renderWorkspaceRequest(request)\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>\n                                    apps not supported yet\n                            </div>\n                            </React.Fragment>\n                        )\n                }\n            case requestModel.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case requestModel.RequestResourceType.USER:\n                        return this.renderUserInvitation(request)\n                    case requestModel.RequestResourceType.WORKSPACE:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                    case requestModel.RequestResourceType.APP:\n                        return (\n                            <React.Fragment>\n                                <div>Hmm, not supported</div>\n                            </React.Fragment>\n                        )\n                }\n        }\n    }\n\n    render() {\n        const request = this.props.request\n        return (\n            <div key={request.id} className=\"OutboxRequest kbCard\">\n                <div className=\"kbCard-header\">\n                    <div className=\"OutboxRequest-requestHeaderRow\">\n                        <div className=\"OutboxRequest-requestHeaderCreatedAt\">\n                            {/* <span className=\"field-label\">created</span>\n                                {' '} */}\n                            {Intl.DateTimeFormat('en-US', {\n                                month: 'short',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}\n                        </div>\n                        <div className=\"OutboxRequest-requestHeaderExpireAt\">\n                            <span className=\"field-label\">expires</span>\n                            {' '}\n                            {niceElapsed(request.expireAt)}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"kbCard-body\">\n                    {this.renderBody()}\n                </div>\n            </div>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as requestModel from '../../../../../data/models/requests'\nimport { StoreState } from '../../../../../types';\nimport * as cancelActions from '../../../../../redux/actions/viewOrganization/cancelOutboxRequest'\nimport OutboxRequest from './OutboxRequest'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onCancelOutboxRequest: (request: requestModel.Request) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onCancelOutboxRequest: (request: requestModel.Request) => {\n            dispatch(cancelActions.cancelRequest(request.id) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(OutboxRequest)","import * as React from 'react'\n\nimport './component.css'\nimport Header from '../../../../Header'\nimport { Icon, Button, Modal, Card, Alert } from 'antd'\nimport User from '../../../../entities/UserContainer'\nimport Narrative from '../../../../entities/NarrativeContainer'\nimport * as requestModel from '../../../../../data/models/requests'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport { niceElapsed } from '../../../../../lib/time'\nimport InboxRequest from './InboxRequestContainer'\nimport OutboxRequest from './OutboxRequestContainer'\n\nexport interface RequestsProps {\n    inbox: Array<requestModel.Request>\n    outbox: Array<requestModel.Request>\n    relation: orgModel.Relation\n    // organizationId: string,\n    // viewModel: types.\n    // onStart: (organizationId: string) => void,\n    onAcceptJoinRequest: (request: requestModel.Request) => void\n    onDenyJoinRequest: (request: requestModel.Request) => void\n    onCancelJoinInvitation: (request: requestModel.Request) => void\n    onGetViewAccess: (request: requestModel.Request) => void\n}\n\nexport interface RequestsState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\nclass ManageGroupRequests extends React.Component<RequestsProps, RequestsState> {\n\n    constructor(props: RequestsProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n\n        // this.props.onStart(this.props.organizationId)\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n    onAcceptJoinRequest(request: requestModel.Request) {\n        this.props.onAcceptJoinRequest(request)\n    }\n    onDenyJoinRequest(request: requestModel.Request) {\n        this.props.onDenyJoinRequest(request)\n    }\n    onCancelJoinInvitation(request: requestModel.Request) {\n        this.props.onCancelJoinInvitation(request)\n    }\n    onGetViewAccess(request: requestModel.Request) {\n        this.props.onGetViewAccess(request)\n    }\n    onViewProfile(username: string) {\n        window.open('/#people/' + username, '_blank')\n    }\n    onShowInfo() {\n        Modal.info({\n            title: 'Manage Requests Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the manage requests tool...</p>\n                </div>\n            )\n        })\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org Editor...\n            </span>\n        )\n\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderRequestJoinRequest(request: requestModel.UserRequest) {\n        const title = (\n            <span>\n                <Icon type=\"user\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"Requests-pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"Requests-requester\">\n                                <User userId={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"Requests-createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"Requests-expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestJoinInvitation(request: requestModel.UserInvitation) {\n        const title = (\n            <span>\n                <Icon type=\"team\" />\n                <Icon type=\"mail\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"user\" />\n\n                {' '}\n                Invitation to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onCancelJoinInvitation.call(this, request)}>\n                Cancel\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"Requests-pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>invitation to</th>\n                            <td className=\"Requests-requester\">\n                                <User userId={request.user} avatarSize={30} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"Requests-createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"Requests-expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderNarrativePermission(permission: orgModel.UserWorkspacePermission) {\n        switch (permission) {\n            case orgModel.UserWorkspacePermission.NONE:\n                return 'None'\n            case orgModel.UserWorkspacePermission.VIEW:\n                return 'View Only'\n            // return 'View and Copy'\n            case orgModel.UserWorkspacePermission.EDIT:\n                return 'Edit'\n            // return 'View, Copy, Save, Run'\n            case orgModel.UserWorkspacePermission.ADMIN:\n                return 'Admin'\n            // return 'View, Copy, Save, Run, Manage Sharing'\n            case orgModel.UserWorkspacePermission.OWNER:\n                return 'Owner'\n            // return 'View, Copy, Save, Run, Manage Sharing, Own'\n        }\n    }\n\n    renderRequestNarrativeRequest(request: requestModel.WorkspaceRequest) {\n        const title = (\n            <span>\n                <Icon type=\"file\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add Narrative\n            </span>\n        )\n\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request)}>\n                Deny\n            </Button>\n        ]\n\n        let narrativeAccess\n        narrativeAccess = (\n            <Narrative workspaceId={parseInt(request.narrativeId, 10)} />\n        )\n        // TODO: Revive me!!\n        // if (request.narrativeId) {\n        //     // TODO: note the '1' below -- we dont' get the object id from the groups service,\n        //     // and the narrative will soon accept just the workspace id (and will look up the object id by itself)\n        //     // but not yet, so we just use 1, which is INCORRECT.\n        //     narrativeAccess = (\n        //         <div>\n        //             <div>\n        //                 <a href={\"/narrative/ws.\" + request.narrativeId + '.obj.' + '1'} target=\"_blank\">{request.title}</a>\n        //             </div>\n        //             <div>\n        //                 <span className=\"field-label\">your access</span>{' '}{this.renderNarrativePermission(request.narrative.permission)}\n        //             </div>\n        //             <div>\n        //                 <span className=\"field-label\">public?</span>{' '}{request.isPublic ? 'yes' : 'no'}\n        //             </div>\n\n        //         </div>\n        //     )\n        // } else {\n        //     narrativeAccess = (\n        //         <span>\n        //             You don't have access to this narrative\n        //             {' '}\n        //             <Button\n        //                 onClick={() => { this.onGetViewAccess.call(this, request.id) }}>\n        //                 Click for View Access\n        //             </Button>\n        //         </span>\n        //     )\n        // }\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"Requests-pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"Requests-requester\">\n                                <User userId={request.requester} avatarSize={30} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>narrative</th>\n                            <td className=\"Requests-narrative\">\n                                {narrativeAccess}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"Requests-createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"Requests-expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestAppRequest(request: requestModel.AppRequest) {\n        const title = (\n            <span>\n                <Icon type=\"appstore\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add App\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"Requests-pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"Requests-requester\">\n                                <User userId={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>app</th>\n                            <td className=\"Requests-requester\">\n                                {request.appId}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"Requests-createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"Requests-expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderInbox() {\n        let inbox\n        if (this.props.inbox.length === 0) {\n            inbox = (\n                <Alert type=\"info\" message=\"No pending requests\" />\n            )\n        } else {\n            const requests = this.props.inbox.map((request) => {\n                return (\n                    <div key={request.id}>\n                        <InboxRequest\n                            request={request} />\n                    </div>\n                )\n            })\n            inbox = (\n                <div style={{ overflowY: 'auto' }}>\n                    {requests}\n                </div>\n            )\n        }\n        return (\n            <React.Fragment>\n                {inbox}\n            </React.Fragment>\n        )\n    }\n\n    renderOutbox() {\n        let outbox\n        if (this.props.outbox.length === 0) {\n            outbox = (\n                <Alert type=\"info\" message=\"No pending requests\" />\n            )\n        } else {\n            const requests = this.props.outbox.map((request) => {\n                return (\n                    <div key={request.id}>\n                        <OutboxRequest\n                            request={request} />\n                    </div>\n                )\n            })\n            outbox = (\n                <div style={{ overflowY: 'auto' }}>\n                    {requests}\n                </div>\n            )\n        }\n        return (\n            <React.Fragment>\n                {outbox}\n            </React.Fragment>\n        )\n    }\n\n    isAdmin(relation: orgModel.Relation): boolean {\n        return (\n            relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER\n        )\n    }\n\n    render() {\n        if (this.isAdmin(this.props.relation)) {\n            const outboxCount = this.props.outbox.length\n            const inboxCount = this.props.inbox.length\n\n            return (\n                <div className=\"Requests\">\n                    <div className=\"Requests-tabPaneHeader\">inbox ({inboxCount})</div>\n                    {this.renderInbox()}\n                    <div className=\"Requests-tabPaneHeader\">outbox ({outboxCount})</div>\n                    {this.renderOutbox()}\n                </div>\n            )\n        } else {\n            const outboxCount = this.props.outbox.length\n\n            return (\n                <div className=\"Requests\">\n                    <div className=\"Requests-tabPaneHeader\">outbox ({outboxCount})</div>\n                    {this.renderOutbox()}\n                </div>\n            )\n        }\n    }\n}\n\nexport default ManageGroupRequests\n","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../../../types'\nimport * as acceptActions from '../../../../../redux/actions/viewOrganization/acceptInboxRequest'\nimport * as rejectActions from '../../../../../redux/actions/viewOrganization/denyInboxRequest'\nimport * as cancelRequestActions from '../../../../../redux/actions/viewOrganization/cancelOutboxRequest'\nimport * as requestModel from '../../../../../data/models/requests'\nimport * as orgModel from '../../../../../data/models/organization/model'\n\nimport Component from './component'\n\nexport interface OwnProps {\n    inbox: Array<requestModel.Request>\n    outbox: Array<requestModel.Request>\n    relation: orgModel.Relation\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onAcceptJoinRequest: (request: requestModel.Request) => void\n    onDenyJoinRequest: (request: requestModel.Request) => void\n    onCancelJoinInvitation: (request: requestModel.Request) => void\n    onGetViewAccess: (request: requestModel.Request) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {}\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAcceptJoinRequest: (request: requestModel.Request) => {\n            dispatch(acceptActions.acceptRequest(request.id) as any)\n        },\n        onDenyJoinRequest: (request: requestModel.Request) => {\n            dispatch(rejectActions.denyRequest(request.id) as any)\n        },\n        onCancelJoinInvitation: (request: requestModel.Request) => {\n            dispatch(cancelRequestActions.cancelRequest(request.id) as any)\n        },\n        onGetViewAccess: (request: requestModel.Request) => {\n            // dispatch(actions.getViewAccess(requestId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)\n\n","import * as React from 'react'\nimport * as orgModel from '../../../../data/models/organization/model'\nimport { NavLink } from 'react-router-dom'\nimport OrgLogo from '../../../OrgLogo'\nimport { Icon, Tooltip, Menu, Dropdown, Modal, Button } from 'antd'\nimport Owner from '../../../entities/OwnerContainer'\nimport { ComponentView, SubViews } from '../../../../types'\nimport NiceElapsedTime from '../../../NiceElapsedTime'\nimport OrgMenu from './OrgMenu'\nimport './BriefOrganizationHeader.css'\n\nexport interface BriefOrganizationProps {\n    organization: orgModel.BriefOrganization\n    openRequestsStatus: orgModel.RequestStatus | null\n    orgMenu: JSX.Element\n    onNavigateToBrowser: () => void\n}\n\ninterface BriefOrganizationState {\n    view: ComponentView\n}\n\nfunction reverseView(v: ComponentView) {\n    switch (v) {\n        case ComponentView.COMPACT:\n            return ComponentView.NORMAL\n        case ComponentView.NORMAL:\n            return ComponentView.COMPACT\n    }\n}\n\nexport default class BriefOrganization extends React.Component<BriefOrganizationProps, BriefOrganizationState> {\n    constructor(props: BriefOrganizationProps) {\n        super(props)\n        this.state = {\n            view: ComponentView.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderLogo(org: orgModel.BriefOrganization) {\n        return (\n            <OrgLogo logoUrl={org.logoUrl} size={80} organizationName={org.name} organizationId={org.id} />\n        )\n    }\n\n    renderHomeUrl(org: orgModel.BriefOrganization) {\n        if (!org.homeUrl) {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    title=\"This organization has not set a home page url\"\n                >\n                    <Icon type=\"home\" style={{ color: 'rgba(200, 200, 200, 0.3)' }} />\n                </Tooltip>\n            )\n        }\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Home page for this Organization (external to KBase)\n                </p>\n            </React.Fragment>\n        )\n        return (\n            <div className=\"BriefOrganizationHeader-homeUrl\">\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title={tooltip}\n                >\n                    <a href={org.homeUrl} target=\"_blank\">\n                        <Icon type=\"home\" />\n                    </a>\n                </Tooltip>\n            </div >\n        )\n    }\n\n    renderNarrativeCount(org: orgModel.BriefOrganization) {\n        if (!org.narrativeCount) {\n            return (\n                <span style={{ color: 'gray' }}>\n                    Ø\n                </span>\n            )\n        }\n        return (\n            <span>\n                {org.narrativeCount}\n            </span>\n        )\n    }\n\n    renderMemberCount(org: orgModel.BriefOrganization) {\n        if (org.memberCount == 1) {\n            return (\n                <span style={{ color: 'gray' }}>\n                    Ø\n                </span>\n            )\n        }\n        return (\n            <span>\n                {org.memberCount - 1}\n            </span>\n        )\n    }\n\n    renderRelation(org: orgModel.BriefOrganization) {\n        switch (org.relation) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <span>\n                            <Icon type=\"stop\" />\n                        </span>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <Icon type=\"stop\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"Your membership request is pending\"\n                    >\n                        <Icon type=\"user\" style={{ color: 'orange' }} /> Your membership <b>request</b> is pending\n                </Tooltip>\n                )\n\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You have been invited to join this organization\"\n                    >\n                        <Icon type=\"user\" style={{ color: 'blue' }} />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are a member of this organization\"\n                    >\n                        <Icon type=\"user\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are an administrator of this organization\"\n                    >\n                        <Icon type=\"robot\" />\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are the owner of this organization\"\n                    >\n                        <Icon type=\"crown\" />\n                    </Tooltip>\n                )\n        }\n    }\n\n    renderPrivacy() {\n        const org = this.props.organization\n        if (org.isPrivate) {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title=\"This organization is private - may only be viewed by members\">\n                    <span>\n                        <Icon type=\"unlock\" />\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip\n                    placement=\"bottomRight\"\n                    mouseEnterDelay={0.5}\n                    title=\"This organization is public - may be viewed by any KBase user\">\n                    <span>\n                        <Icon type=\"global\" />\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderOrgFreshness(org: orgModel.BriefOrganization) {\n        const isNew = org.lastVisitedAt && (org.modifiedAt.getTime() > org.lastVisitedAt.getTime())\n        let newAlert\n        if (isNew) {\n            const title = 'This org has changed since your last visit to it; new or updated items are highlighted'\n            newAlert = (\n                <div>\n                    <Tooltip placement=\"topRight\" title={title}>\n                        <span style={{ color: 'red', fontSize: '120%' }}>\n                            {/* ● */}\n                            <Icon type=\"bell\" theme=\"filled\" />\n                        </span>\n                    </Tooltip>\n                </div>\n            )\n        } else {\n            newAlert = (\n                <div>\n                    <span style={{ color: 'transparent', fontSize: '120%' }}>\n                        <Icon type=\"bell\" theme=\"filled\" />\n                    </span>\n                </div>\n            )\n        }\n\n        const hasRequests = false\n\n        let requestsAlert\n        if (hasRequests) {\n            requestsAlert = (\n                <div>\n                    <Icon type=\"bulb\" style={{ color: \"blue\" }} />\n                </div>\n            )\n        } else {\n            requestsAlert = null\n        }\n\n        return (\n            <div>\n                {newAlert}\n                {requestsAlert}\n            </div>\n        )\n    }\n\n    renderRequests() {\n        if (!(this.props.organization.relation === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.organization.relation === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        let message\n        let iconColor\n        switch (this.props.openRequestsStatus) {\n            case orgModel.RequestStatus.NONE:\n                // case null:\n                message = 'There are no open requests for this organization'\n                iconColor = 'rgba(200, 200, 200, 0.3)'\n                break\n            case orgModel.RequestStatus.NEW:\n                message = 'There are new requests since you last visited this organization'\n                iconColor = 'red'\n                break\n            case orgModel.RequestStatus.OLD:\n                message = 'There are open requests for this organization'\n                iconColor = 'blue'\n                break\n            case orgModel.RequestStatus.INAPPLICABLE:\n                return\n            default:\n                console.warn('Invalid open request status: ' + this.props.openRequestsStatus)\n                return\n        }\n        const title = (\n            <span>\n                {message}\n            </span>\n        )\n        return (\n            <Tooltip\n                placement=\"topRight\"\n                title={title}>\n                <span style={{ color: iconColor, fontSize: '80%' }}>\n                    <Icon type=\"mail\" theme=\"filled\" />\n                </span>\n            </Tooltip>\n        )\n    }\n\n    renderPermalink() {\n        const permalink = (\n            <div>\n                <p>\n                    Below is the \"permalink\" for this organization. You may copy\n                    this url and use it to access this organization in a web browser.\n                </p>\n                <p style={{ fontFamily: 'monospace', fontWeight: 'bold' }}>\n                    {window.location.origin}/#org/{this.props.organization.id}\n                </p>\n            </div>\n        )\n        const menuClick = ({ key }: { key: string }) => {\n            Modal.info({\n                title: 'Org Permalink',\n                content: permalink\n            })\n        }\n        const menu = (\n            <Menu\n                onClick={menuClick}\n            >\n                <Menu.Item key=\"view\">\n                    View Permalink\n                </Menu.Item>\n            </Menu>\n        )\n        return (\n            <Dropdown\n                overlay={menu}\n                trigger={['click', 'contextMenu']}>\n                <a href={\"/#orgs/\" + this.props.organization.id}>\n                    <Icon type=\"link\" />\n                </a>\n            </Dropdown>\n        )\n    }\n\n    renderLogoColumn(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                <div className=\"BriefOrganizationHeader-logoRow\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderLogo(org)}\n                    </NavLink>\n                </div>\n                <div className=\"BriefOrganizationHeader-statusRow\">\n                    <div className=\"BriefOrganizationHeader-relationCol\">\n                        {this.renderRelation(org)}\n                    </div>\n                    <div className=\"BriefOrganizationHeader-privacyCol\">\n                        {this.renderPrivacy()}\n                    </div>\n\n                    <div className=\"BriefOrganizationHeader-homeLinkCol\">\n                        {this.renderHomeUrl(org)}\n                    </div>\n                </div>\n                <div className=\"BriefOrganizationHeader-freshnessRow\">\n                    <div className=\"BriefOrganizationHeader-orgFreshnessCol\">\n                        {this.renderOrgFreshness(org)}\n                    </div>\n                    <div className=\"BriefOrganizationHeader-openRequestsCol\">\n                        {this.renderRequests()}\n                    </div>\n                    <div className=\"BriefOrganizationHeader-openNewRequestsCol\">\n                        {this.renderPermalink()}\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    fullTimestamp(d: Date) {\n        return Intl.DateTimeFormat('en-US', {\n            month: 'short',\n            day: 'numeric',\n            year: 'numeric',\n            hour: 'numeric',\n            minute: 'numeric',\n            second: 'numeric',\n            timeZoneName: 'short'\n        }).format(d)\n    }\n\n    renderInfoCol(org: orgModel.BriefOrganization) {\n        return (\n            <React.Fragment>\n                <div className=\"BriefOrganizationHeader-orgName BriefOrganizationHeader-infoTableRow\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {org.name}\n                    </NavLink>\n                </div>\n\n                <div className=\"BriefOrganizationHeader-researchInterests BriefOrganizationHeader-infoTableRow\">\n                    {org.researchInterests}\n                </div>\n\n                <div className=\"BriefOrganizationHeader-orgOwner BriefOrganizationHeader-infoTableRow\">\n                    <div className=\"BriefOrganizationHeader-infoTableCol1\">\n                        <span className=\"field-label BriefOrganizationHeader-fieldLabel\">owner</span>\n                    </div>\n                    <div className=\"BriefOrganizationHeader-infoTableCol2\">\n                        {/* TODO: render as Member or Owner component */}\n                        <Owner username={org.owner.username} avatarSize={16} showAvatar={false} />\n                    </div>\n                </div>\n                <div className=\"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow\">\n                    <div className=\"BriefOrganizationHeader-infoTableCol1\">\n                        <span className=\"field-label BriefOrganizationHeader-fieldLabel\">created</span>\n                    </div>\n                    <div className=\"BriefOrganizationHeader-infoTableCol2\">\n                        {/* {niceElapsed(org.createdAt, 30)} */}\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title={this.fullTimestamp(org.createdAt)}>\n                            <span>\n                                {Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(org.createdAt)}\n                            </span>\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"BriefOrganizationHeader-orgOwner BriefOrganizationHeader-infoTableRow\">\n                    <div className=\"BriefOrganizationHeader-infoTableCol1\">\n                        <span className=\"field-label\">updated</span>\n                    </div>\n                    <div className=\"BriefOrganizationHeader-infoTableCol2\">\n                        <NiceElapsedTime time={org.modifiedAt} showTooltip={false} />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderMemberRow(org: orgModel.BriefOrganization) {\n        const memberCount = org.memberCount - 1\n        let memberCountTooltip\n        if (memberCount) {\n            if (memberCount === 1) {\n                memberCountTooltip = (\n                    <span>\n                        There is <b>1</b> member in this organization\n                    </span>\n                )\n            } else {\n                memberCountTooltip = (\n                    <span>\n                        There are <b>{memberCount}</b> members in this organization\n                    </span>\n                )\n            }\n        } else {\n            memberCountTooltip = (\n                <span>\n                    There are <b>no members</b> in this organization\n                </span>\n            )\n        }\n        return (\n            <Tooltip placement=\"bottomRight\" title={memberCountTooltip}>\n                <div className=\"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow\">\n                    <div className=\"BriefOrganizationHeader-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"team\" /></span>\n                    </div>\n                    <div className=\"BriefOrganizationHeader-infoTableCol2\">\n                        {this.renderMemberCount(org)}\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderNarrativeRow(org: orgModel.BriefOrganization) {\n        const count = org.narrativeCount\n        let tooltip\n        if (count) {\n            if (count === 1) {\n                tooltip = (\n                    <span>\n                        There is <b>1</b> narrative in this organization\n                    </span>\n                )\n            } else {\n                tooltip = (\n                    <span>\n                        There are <b>{count}</b> narratives in this organization\n                    </span>\n                )\n            }\n        } else {\n            tooltip = (\n                <span>\n                    There are <b>no narratives</b> in this organization\n                </span>\n            )\n        }\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                <div className=\"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow\">\n                    <div className=\"BriefOrganizationHeader-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"file\" /></span>\n                    </div>\n                    <div className=\"BriefOrganizationHeader-infoTableCol2\">\n                        {this.renderNarrativeCount(org)}\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderModifiedRow(org: orgModel.BriefOrganization) {\n        const tooltip = (\n            <span>\n                This organization was last updated\n                {' '}\n                <NiceElapsedTime time={org.modifiedAt} showTooltip={false} />\n            </span>\n        )\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                <div className=\"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow\">\n                    <div className=\"BriefOrganizationHeader-infoTableCol1\">\n                        <span className=\"field-label\"><Icon type=\"save\" /></span>\n                    </div>\n                    <div className=\"BriefOrganizationHeader-infoTableCol2\">\n                        <NiceElapsedTime time={org.modifiedAt} showTooltip={false} />\n                    </div>\n                </div>\n            </Tooltip>\n        )\n    }\n\n    renderButtonsRow() {\n        return (\n            <div className=\"ButtonSet\">\n                <div className=\"ButtonSet-button\">\n                    {this.props.orgMenu}\n                </div>\n            </div>\n        )\n    }\n\n    renderStatsCol(org: orgModel.BriefOrganization) {\n        return (\n            <div className=\"BriefOrganizationHeader-buttonsCol\">\n                <div className=\"BriefOrganizationHeader-buttonsRow\" style={{ marginBottom: '10px' }}>\n                    <div className=\"ButtonSet\">\n                        <div className=\"IconButton\"\n                            onClick={this.props.onNavigateToBrowser}\n                            style={{ color: 'red' }}>\n                            <Icon type=\"close\" />\n                        </div>\n                    </div>\n                </div>\n                <div className=\"BriefOrganizationHeader-buttonsRow\">\n                    {this.renderButtonsRow()}\n                </div>\n            </div>\n        )\n    }\n\n    renderNormal() {\n        const org = this.props.organization\n        return (\n            <div className=\"BriefOrganization\">\n                <div className=\"BriefOrganizationHeader-body\">\n                    <div className=\"BriefOrganizationHeader-logoCol\">\n                        {this.renderLogoColumn(org)}\n                    </div>\n                    <div className=\"BriefOrganizationHeader-infoCol\">\n\n                        <div className=\"BriefOrganizationHeader-infoCol-row\">\n                            <div className=\"BriefOrganizationHeader-infoCol-col1\">\n                                {this.renderInfoCol(org)}\n                            </div>\n                            <div className=\"BriefOrganizationHeader-infoCol-col2\">\n                                {this.renderStatsCol(org)}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div >\n        )\n    }\n\n    render() {\n        return this.renderNormal()\n    }\n}\n","import * as React from 'react'\nimport * as orgModel from '../../../data/models/organization/model'\nimport { Tooltip } from 'antd';\nimport './component.css'\nimport OrgLogo from '../../OrgLogo';\nimport Owner from '../OwnerContainer';\nimport { NavLink } from 'react-router-dom';\n\nexport interface OrganizationProps {\n    organization: orgModel.Organization\n}\n\ninterface OrganizationState {\n\n}\n\nexport default class Organization extends React.Component<OrganizationProps, OrganizationState> {\n    constructor(props: OrganizationProps) {\n        super(props)\n    }\n\n    fullTimestamp(d: Date) {\n        return Intl.DateTimeFormat('en-US', {\n            month: 'short',\n            day: 'numeric',\n            year: 'numeric',\n            hour: 'numeric',\n            minute: 'numeric',\n            second: 'numeric',\n            timeZoneName: 'short'\n        }).format(d)\n    }\n\n    renderLogo(org: orgModel.Organization) {\n        return (\n            <OrgLogo logoUrl={org.logoUrl} size={30} organizationName={org.name} organizationId={org.id} />\n        )\n    }\n\n    render() {\n        const org = this.props.organization\n        return (\n            <div className=\"OrganizationEntity-Accessible \">\n                <div className=\"OrganizationEntity-Accessible-logoCol\">\n                    {this.renderLogo(org)}\n                </div>\n                <div className=\"OrganizationEntity-Accessible-mainCol\">\n                    <div className=\"OrganizationEntity-Accessible-name\">\n                        <NavLink to={`/viewOrganization/${org.id}`}>\n                            {org.name}\n                        </NavLink>\n                    </div>\n                    <div className=\"OrganizationEntity-Accessible-researchInterests\">\n                        {org.researchInterests}\n                    </div>\n                    <div className=\"OrganizationEntity-Accessible-owner\">\n                        <Owner username={org.owner.username} showAvatar={false} avatarSize={20} />\n                    </div>\n                    {/* <div className=\"OrganizationEntity-Accessible-createdAt\">\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title={this.fullTimestamp(org.createdAt)}>\n                            <span>\n                                {Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(org.createdAt)}\n                            </span>\n                        </Tooltip>\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n}","import * as React from 'react'\nimport * as orgModel from '../../../data/models/organization/model'\nimport './Inaccessible.css'\nimport { Icon } from 'antd';\n\nexport interface OrganizationProps {\n    organization: orgModel.InaccessiblePrivateOrganization\n}\n\ninterface OrganizationState {\n\n}\n\nexport default class Organization extends React.Component<OrganizationProps, OrganizationState> {\n    constructor(props: OrganizationProps) {\n        super(props)\n    }\n\n    render() {\n        return (\n            <div className=\"OrganizationEntity-Inaccessible \">\n                <div className=\"OrganizationEntity-Inaccessible-logoCol\">\n                    <Icon type=\"lock\" />\n                </div>\n                <div className=\"OrganizationEntity-Inaccessible-mainCol\">\n                    <div className=\"OrganizationEntity-Inaccessible-name\">\n                        Private Organization\n                    </div>\n\n                </div>\n            </div>\n        )\n    }\n}","// The loader component\n\nimport * as React from 'react'\nimport * as orgModel from '../../../data/models/organization/model'\nimport Organization from './component'\nimport InaccessibleOrganization from './Inaccessible'\n\ninterface LoaderProps {\n    organizationId: orgModel.OrganizationID\n    organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization | null\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n}\n\ninterface LoaderState { }\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.organization) {\n            switch (this.props.organization.kind) {\n                case orgModel.OrganizationKind.NORMAL:\n                    return (\n                        <Organization organization={this.props.organization} />\n                    )\n                case orgModel.OrganizationKind.INACCESSIBLE_PRIVATE:\n                    return (\n                        <InaccessibleOrganization organization={this.props.organization} />\n                    )\n                default:\n                    return (\n                        <div>\n                            Error: unrecognized org kind\n                        </div>\n                    )\n            }\n        } else {\n            return (\n                <div>\n                    <Icon type=\"loading\" />\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.organization) {\n            this.props.onLoad(this.props.organizationId)\n        }\n    }\n}\n\n// The loader redux adapter\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../../types'\nimport * as actions from '../../../redux/actions/entities/organization'\nimport { Icon } from 'antd';\n\nexport interface OwnProps {\n    organizationId: orgModel.OrganizationID\n}\n\ninterface StateProps {\n    organization: orgModel.Organization | orgModel.InaccessiblePrivateOrganization | null\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        organization: state.entities.organizations.byId.get(props.organizationId) || null\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.OrganizationEntityAction>): DispatchProps {\n    return {\n        onLoad: (organizationId: orgModel.OrganizationID) => {\n            dispatch(actions.load(organizationId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\nimport * as orgModel from '../../../data/models/organization/model'\nimport { StoreState } from '../../../types'\nimport { AnError, makeError } from '../../../lib/error';\n\nexport interface OrganizationEntityAction extends Action {\n\n}\n\n// Organization\n\nexport interface Load extends OrganizationEntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOAD\n}\n\ninterface LoadStart extends OrganizationEntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOAD_START\n}\n\nexport interface LoadSuccess extends OrganizationEntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOAD_SUCCESS\n    organization: orgModel.Organization\n}\n\ninterface LoadError extends OrganizationEntityAction {\n    type: ActionFlag.ENTITY_ORGANIZATION_LOAD_ERROR\n    error: AnError\n}\n\nexport function load(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, OrganizationEntityAction>, getState: () => StoreState) => {\n        dispatch(<LoadStart>{\n            type: ActionFlag.ENTITY_ORGANIZATION_LOAD_START\n        })\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const organization = await orgClient.getOrg(organizationId)\n            dispatch(<LoadSuccess>{\n                type: ActionFlag.ENTITY_ORGANIZATION_LOAD_SUCCESS,\n                organization\n            })\n        } catch (ex) {\n            dispatch(<LoadError>{\n                type: ActionFlag.ENTITY_ORGANIZATION_LOAD_ERROR,\n                error: makeError({\n                    code: ex.name,\n                    message: ex.message\n                })\n            })\n        }\n    }\n}","import * as React from 'react'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport { Button, Menu, Dropdown, Icon, Alert } from 'antd'\nimport OrganizationEntity from '../../../../entities/organization/loader'\nimport { withRouter, NavLink } from 'react-router-dom'\nimport './component.css'\n\nexport interface RelatedOrganizationsProps {\n    organization: orgModel.Organization\n    relatedOrganizations: Array<orgModel.OrganizationID>\n    onManageRelatedOrgs: () => void\n    onRemoveRelatedOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => void\n}\n\ninterface RelatedOrganizationsState {\n}\n\nexport default class RelatedOrganizations extends React.Component<RelatedOrganizationsProps, RelatedOrganizationsState> {\n    constructor(params: RelatedOrganizationsProps) {\n        super(params)\n    }\n\n    onManageRelatedOrgs() {\n        this.props.onManageRelatedOrgs()\n    }\n\n    renderToolbar() {\n        return (\n            <div className=\"RelatedOrganizations-toolbar\">\n                <Button onClick={this.onManageRelatedOrgs.bind(this)}>\n                    Add Related Org\n                </Button>\n            </div>\n        )\n    }\n\n    onAdminMenu(key: string, organizationId: orgModel.OrganizationID) {\n        switch (key) {\n            case 'removeRelation':\n                // this.props.onDemoteAdminToMember(member.username)\n                this.props.onRemoveRelatedOrganization(this.props.organization.id, organizationId)\n                // window.alert('will remove relation for org: ' + organizationId)\n                break\n        }\n    }\n\n    renderControls(organizationId: orgModel.OrganizationID) {\n        if (!this.props.organization.isAdmin) {\n            return\n        }\n        const menu = (\n            <Menu onClick={({ key }) => { this.onAdminMenu.call(this, key, organizationId) }}>\n                <Menu.Item key=\"removeRelation\">\n                    <Icon type=\"delete\" />Remove\n                    </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Icon type=\"ellipsis\" className=\"IconButton-hover\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderBody() {\n        if (this.props.relatedOrganizations.length === 0) {\n            const message = (\n                <p>\n                    No related organizations\n                </p>\n            )\n            return (\n                <Alert type=\"info\" message={message} />\n            )\n        }\n        const Wrapped = withRouter<any>(OrganizationEntity)\n        // console.log('hmm???', OrganizationEntity, Wrapped)\n        const relatedOrgs = this.props.relatedOrganizations.map((organizationId: string) => {\n            return (\n                <div key={organizationId} className=\"RelatedOrganizations-orgRow simpleCard\">\n                    {/* <RelatedOrganization organizationId={org} /> */}\n\n                    <div className=\"RelatedOrganizations-orgCol\">\n                        <Wrapped organizationId={organizationId} />\n                    </div>\n                    <div className=\"RelatedOrganizations-controlCol\">\n                        {this.renderControls(organizationId)}\n                    </div>\n                </div>\n            )\n        });\n        return (\n            <div className=\"RelatedOrganizations-organizations\">\n                {relatedOrgs}\n            </div>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"RelatedOrganizations scrollable-flex-column\">\n                {/* <div className=\"RelatedOrganizations-toolbarRow\">\n                    {this.renderToolbar()}\n                </div> */}\n                <div className=\"RelatedOrganizations-bodyRow scrollable-flex-column\">\n                    {this.renderBody()}\n                </div>\n            </div>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, ViewOrgViewModelKind } from '../../../../../types'\nimport * as actions from '../../../../../redux/actions/viewOrganization/relatedOrganizations'\nimport Component from './component'\nimport * as orgModel from '../../../../../data/models/organization/model'\n\nexport interface OwnProps {\n    organization: orgModel.Organization\n    relatedOrganizations: Array<orgModel.OrganizationID>\n    onManageRelatedOrgs: () => void\n\n}\n\ninterface StateProps {\n    searchMembersBy: string\n    sortMembersBy: string\n    members: Array<orgModel.Member>\n}\n\ninterface DispatchProps {\n    onRemoveRelatedOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    const { searchMembersBy, sortMembersBy, members } = viewModel\n    return {\n        searchMembersBy, sortMembersBy, members\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onRemoveRelatedOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => {\n            dispatch(actions.removeOrganization(organizationId, relatedOrganizationId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from '../index'\nimport { AnError } from '../../../lib/error'\nimport { StoreState } from '../../../types'\nimport * as orgModel from '../../../data/models/organization/model'\nimport { makeError } from '../../../combo/error/api'\n\n\n// Add Org\n\n// export interface AddOrganization extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION> {\n//     type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION,\n//     organizationId: orgModel.OrganizationID\n// }\n\n// export interface AddOrganizationStart extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START> {\n//     type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START\n// }\n\n// export interface AddOrganizationSuccess extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS> {\n//     type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,\n//     organizationId: orgModel.OrganizationID\n// }\n\n// export interface AddOrganizationError extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR> {\n//     type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,\n//     error: AnError\n// }\n\n// export function addOrganization(organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) {\n//     return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n//         dispatch({\n//             type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START\n//         } as AddOrganizationStart)\n\n//         const {\n//             auth: { authorization: { token, username } },\n//             app: { config },\n//             views: {\n//                 viewOrgView: { viewModel }\n//             }\n//         } = getState()\n//         if (viewModel === null) {\n//             throw new Error('view is not populated')\n//         }\n//         const orgClient = new orgModel.OrganizationModel({\n//             token, username,\n//             groupsServiceURL: config.services.Groups.url\n//         })\n//         try {\n//             await orgClient.addRelatedOrganization({ organizationId, relatedOrganizationId })\n//             dispatch({\n//                 type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,\n//                 organizationId\n//             })\n//         } catch (ex) {\n//             dispatch({\n//                 type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,\n//                 error: makeError({\n//                     code: 'error',\n//                     message: ex.message\n//                 })\n//             })\n//         }\n//     }\n// }\n\n\n// Remove Org\n\nexport interface RemoveOrganization extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION> {\n    type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface RemoveOrganizationStart extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START> {\n    type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START\n}\n\nexport interface RemoveOrganizationSuccess extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS> {\n    type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,\n    organizationId: orgModel.OrganizationID\n}\n\nexport interface RemoveOrganizationError extends Action<ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR> {\n    type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,\n    error: AnError\n}\n\nexport function removeOrganization(organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START\n        } as RemoveOrganizationStart)\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        try {\n            await orgClient.removeRelatedOrganization({ organizationId, relatedOrganizationId })\n            dispatch({\n                type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,\n                organizationId: relatedOrganizationId\n            } as RemoveOrganizationSuccess)\n            // dispatch(viewOrgActions.reload(organizationId))\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n    }\n}","import * as React from 'react'\nimport { BriefOrganization } from '../../../../../data/models/organization/model'\nimport './AvailableOrganization.css'\nimport OrgLogo from '../../../../OrgLogo'\nimport Owner from '../../../../entities/OwnerContainer'\nimport { SelectableRelatableOrganization } from '../../../../../types';\nimport { Icon } from 'antd';\n\nexport interface AvailableOrganizationProps {\n    selectableOrganization: SelectableRelatableOrganization\n    // onSelectOrganization: (org: BriefOrganization) => void\n    // onAddOrganization: (org: BriefOrganization) => void\n}\n\nexport interface AvailableOrganizationState {\n}\n\nexport default class AvailableOrganization extends React.Component<AvailableOrganizationProps, AvailableOrganizationState> {\n    constructor(props: AvailableOrganizationProps) {\n        super(props)\n    }\n\n    renderRelated() {\n        if (this.props.selectableOrganization.isRelated) {\n            return (\n                <Icon type=\"check\" style={{ color: \"green\" }} />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"AvailableOrganization\">\n                <div className=\"AvailableOrganization-relatedCol\">\n                    {this.renderRelated()}\n                </div>\n                <div className=\"AvailableOrganization-orgCol\">\n                    <div className=\"AvailableOrganization-logoCol\">\n                        <OrgLogo logoUrl={this.props.selectableOrganization.organization.logoUrl}\n                            size={30}\n                            organizationName={this.props.selectableOrganization.organization.name}\n                            organizationId={this.props.selectableOrganization.organization.id} />\n                    </div>\n                    <div className=\"AvailableOrganization-orgInfoCol\">\n                        <div className=\"AvailableOrganization-name\">{this.props.selectableOrganization.organization.name}</div>\n                        <div className=\"AvailableOrganization-owner\">\n                            <Owner username={this.props.selectableOrganization.organization.owner.username}\n                                avatarSize={20} showAvatar={false} />\n                        </div>\n                    </div>\n                </div>\n                <div className=\"AvailableOrganization-actionCol\"></div>\n            </div>\n        )\n    }\n}\n","import * as React from 'react'\n\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport './component.css'\nimport { Button, Icon, Input, Alert } from 'antd';\nimport AvailableOrganization from './AvailableOrganization'\nimport BriefOrganization from '../../../../BriefOrganization';\nimport { SelectableRelatableOrganization } from '../../../../../types';\n\nexport interface ManageRelatedOrganizationsProps {\n    organization: orgModel.Organization\n    relatedOrganizations: Array<string>\n    // relation: orgModel.Relation\n    selectedOrganization: SelectableRelatableOrganization | null\n    organizations: Array<SelectableRelatableOrganization>\n    onFinish: () => void\n    onSelectOrganization: (org: SelectableRelatableOrganization) => void\n    onAddOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => void\n    onRemoveOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => void\n    onSearch: (searchBy: string) => void\n}\n\ninterface ManageRelatedOrganizationsState {\n\n}\n\nexport default class ManageRelatedOrganizations extends React.Component<ManageRelatedOrganizationsProps, ManageRelatedOrganizationsState> {\n    constructor(props: ManageRelatedOrganizationsProps) {\n        super(props)\n    }\n\n    onAddSelectedOrganization() {\n        if (!this.props.selectedOrganization) {\n            return\n        }\n        this.props.onAddOrganization(this.props.organization.id, this.props.selectedOrganization.organization.id)\n    }\n\n    onRemoveSelectedOrganization() {\n        if (!this.props.selectedOrganization) {\n            return\n        }\n        this.props.onRemoveOrganization(this.props.organization.id, this.props.selectedOrganization.organization.id)\n    }\n\n    onFilterChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onSearch(e.target.value)\n    }\n\n    renderAvailableToolbar() {\n        return (\n            <div className=\"ManageRelatedOrganizations-available-toolbar\">\n                <Input placeholder=\"Filter Available Organizations\" onChange={this.onFilterChange.bind(this)} />\n            </div>\n        )\n    }\n\n    renderAvailableOrgs() {\n        return this.props.organizations.map((org: SelectableRelatableOrganization) => {\n            const selectOrg = () => {\n                this.props.onSelectOrganization(org)\n            }\n            let classes = ['simpleCard', 'ManageRelatedOrganizations-availableOrganization']\n            if (org.isSelected) {\n                classes.push('ManageRelatedOrganizations-selected')\n            }\n            return (\n                <div className={classes.join(' ')} onClick={selectOrg} key={org.organization.id} >\n                    <AvailableOrganization selectableOrganization={org} />\n                </div>\n            )\n        })\n    }\n\n    renderSelectedOrg() {\n        let button\n        let content\n        let alert\n        let alertStyle = {\n            marginBottom: '4px'\n        }\n        if (!this.props.selectedOrganization) {\n            const message = (\n                <React.Fragment>\n                    <p>\n                        When you select an organization on the left, details about it will be displayed here.\n                    </p>\n                </React.Fragment>\n            )\n            alert = (\n                <Alert type=\"info\" message={message} style={alertStyle} />\n            )\n            button = (\n                <Button\n                    type=\"primary\"\n                    disabled={this.props.selectedOrganization === null}\n                    onClick={this.onAddSelectedOrganization.bind(this)}>\n                    Add Organization\n                </Button>\n            )\n        } else {\n            content = (\n                <div className=\"ManageRelatedOrganizations-selectedOrganization\">\n                    <BriefOrganization organization={this.props.selectedOrganization.organization} openRequestsStatus={null} />\n                </div>\n            )\n            if (this.props.selectedOrganization.isRelated) {\n                alert = (\n                    <Alert type=\"warning\" message=\"This org is associated\" style={alertStyle} />\n                )\n                button = (\n                    <Button\n                        type=\"danger\"\n                        disabled={this.props.selectedOrganization === null}\n                        onClick={this.onRemoveSelectedOrganization.bind(this)}>\n                        Remove Organization\n                    </Button>\n                )\n            } else {\n                button = (\n                    <Button\n                        type=\"primary\"\n                        disabled={this.props.selectedOrganization === null}\n                        onClick={this.onAddSelectedOrganization.bind(this)}>\n                        Add Organization\n                    </Button>\n                )\n            }\n        }\n\n        return (\n            <React.Fragment>\n                {alert}\n                {content}\n                <div className=\"ManageRelatedOrganizations-buttonBar\">\n                    {button}\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"ManageRelatedOrganizations scrollable-flex-column\">\n                <div className=\"ManageRelatedOrganizations-toolbar\">\n                    <Button onClick={() => this.props.onFinish()} type=\"danger\">\n                        <Icon type=\"rollback\" />\n                        {' '}\n                        Done\n                    </Button>\n                </div>\n                <div className=\"ManageRelatedOrganizations-main scrollable-flex-column\">\n                    <div className=\"ManageRelatedOrganizations-availableOrgs\">\n                        <h3 style={{ textAlign: 'center' }}>Available Organizations</h3>\n                        {this.renderAvailableToolbar()}\n                        <div className=\"ManageRelatedOrganizations-organizations\">\n                            {this.renderAvailableOrgs()}\n                        </div>\n                    </div>\n                    <div className=\"ManageRelatedOrganizations-relatedOrgs\">\n                        <h3 style={{ textAlign: 'center' }}>Selected Organization</h3>\n                        {this.renderSelectedOrg()}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../../../redux/actions/viewOrganization/manageRelatedOrganizations'\nimport ManageRelatedOrganizations from './component'\nimport { StoreState, ViewOrgViewModelKind, SelectableRelatableOrganization } from '../../../../../types';\nimport * as orgModel from '../../../../../data/models/organization/model'\n\nexport interface OwnProps {\n    onFinish: () => void\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    organizations: Array<SelectableRelatableOrganization>\n    relatedOrganizations: Array<string>\n    selectedOrganization: SelectableRelatableOrganization | null\n}\n\ninterface DispatchProps {\n    onSelectOrganization: (org: SelectableRelatableOrganization) => void\n    onAddOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => void\n    onRemoveOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => void\n    onSearch: (searchBy: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    // if (viewModel.subViews.kind !== ViewOrgSubViewKind.MANAGE_RELATED_ORGS) {\n    //     throw new Error(\"argh, wrong org subview kind\")\n    // }\n    if (viewModel.subViews.manageRelatedOrganizationsView.viewModel === null) {\n        throw new Error(\"argh, null subview view model\")\n    }\n    const { organization, availableOrganizations: { queried }, relatedOrganizations, selectedOrganization } = viewModel.subViews.manageRelatedOrganizationsView.viewModel\n\n    return {\n        organization, organizations: queried, relatedOrganizations, selectedOrganization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onSelectOrganization: (org: SelectableRelatableOrganization) => {\n            dispatch(actions.selectOrganization(org) as any)\n        },\n        onAddOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => {\n            dispatch(actions.addOrganization(organizationId, relatedOrganizationId) as any)\n        },\n        onRemoveOrganization: (organizationId: orgModel.OrganizationID, relatedOrganizationId: orgModel.OrganizationID) => {\n            dispatch(actions.removeOrganization(organizationId, relatedOrganizationId) as any)\n        },\n        onSearch: (searchBy: string) => {\n            dispatch(actions.search(searchBy) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ManageRelatedOrganizations)","import * as React from 'react'\nimport { Spin, Alert } from 'antd'\nimport Container from './reduxAdapter'\n\n\nexport interface Props {\n    view: types.View<types.ManageRelatedOrgsViewModel | types.NoneViewModel>\n    onLoad: () => void\n    onUnload: () => void\n    onFinish: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        const message = (\n            <div>\n                Loading Related Organizations Manager...\n                {' '}\n                <Spin />\n            </div>\n        )\n        return (\n            <Alert type=\"info\" message={message} style={{\n                width: '20em',\n                padding: '20px',\n                margin: '20px auto'\n            }} />\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.state) {\n            case types.ViewState.NONE:\n                return this.renderLoading()\n            case types.ViewState.LOADING:\n                return this.renderLoading()\n            case types.ViewState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container onFinish={this.props.onFinish} />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.state) {\n            case types.ViewState.NONE:\n                this.props.onLoad()\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../../../types'\nimport * as actions from '../../../../../redux/actions/viewOrganization/manageRelatedOrganizations'\nimport { OrganizationModel } from '../../../../../data/models/organization/model';\n\nexport interface OwnProps {\n    onFinish: () => void\n}\n\ninterface StateProps {\n    view: types.View<types.ManageRelatedOrgsViewModel>\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const v = state.views.viewOrgView\n    const vm1 = v.viewModel\n    if (vm1 === null) {\n        throw new Error('vm is null')\n    }\n    if (vm1.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        throw new Error('not the right vm')\n    }\n    return {\n        view: vm1.subViews.manageRelatedOrganizationsView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from '../index'\n\nimport {\n    StoreState, User, InviteUserViewModel,\n    RequestType, RequestResourceType, MemberType,\n    OrganizationUser,\n    ViewOrgViewModelKind,\n    View\n} from '../../../types'\nimport { UserQuery } from '../../../data/model'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as userModel from '../../../data/models/user'\nimport * as requestModel from '../../../data/models/requests'\nimport { AnError } from '../../../combo/error/api';\nimport { makeError } from '../../../lib/error';\n\n// View Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.INVITE_USER_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_SUCCESS,\n    organization: orgModel.Organization,\n    users: Array<OrganizationUser> | null\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_ERROR,\n    error: AnError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.INVITE_USER_UNLOAD\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization): LoadSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_SUCCESS,\n        organization: organization,\n        users: null\n    }\n}\n\nexport function loadError(error: AnError): LoadError {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.INVITE_USER_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const org = await orgClient.getOrg(organizationId)\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(loadError(makeError({\n                    code: 'invalid state',\n                    message: 'Organization kind must be \"NORMAL\"'\n                })))\n                return\n            }\n            dispatch(loadSuccess(org))\n        } catch (ex) {\n            dispatch(loadError(makeError({\n                code: ex.name,\n                message: ex.message\n            })))\n        }\n    }\n}\n\n// User Selection\n\n\n\nexport interface InviteUserSearchUsers extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS,\n    query: UserQuery\n}\n\ninterface SearchUsersStart extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n}\n\nexport interface SearchUsersSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n    users: Array<OrganizationUser> | null\n}\n\ninterface SearchUsersError extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n    error: AnError\n}\n\nfunction searchUsersStart(): SearchUsersStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n    }\n}\n\nfunction searchUsersSuccess(users: Array<OrganizationUser> | null): SearchUsersSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n        users: users\n    }\n}\n\nfunction searchUsersError(error: AnError): SearchUsersError {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n        error: error\n    }\n}\n\nexport function inviteUserSearchUsers(query: UserQuery) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchUsersStart())\n\n        if (query.query.length === 0) {\n            dispatch(searchUsersSuccess(null))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            views: {\n                viewOrgView: { viewModel }\n            }\n        } = getState()\n        if (viewModel === null) {\n            throw new Error('view is not populated')\n        }\n        if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n            throw new Error('view is not normal')\n        }\n        // const { organization } = viewModel\n        // const orgClient = new orgModel.OrganizationModel({\n        //     token, username,\n        //     groupsServiceURL: config.services.Groups.url\n        // })\n\n\n\n        // const {\n        //     views: {\n        //         inviteUserView: { viewModel }\n        //     },\n        //     auth: { authorization: { token, username } },\n        //     app: { config } } = getState()\n\n        // // TODO: better form of type narrowing? \n        // if (viewModel === null) {\n        //     return\n        // }\n\n        const org = viewModel.organization\n\n        const userClient = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        // let excludedUsers: Array<string> = []\n\n        // excludedUsers.push(org.owner.user.username)\n\n        let owner: string = org.owner.username\n        let adminUsers: Array<string> = []\n        let members: Array<string> = []\n        let invited: Array<string> = []\n        let requested: Array<string> = []\n\n        org.members.forEach((member) => {\n            switch (member.type) {\n                case MemberType.MEMBER:\n                    members.push(member.username)\n                case MemberType.ADMIN:\n                    adminUsers.push(member.username)\n            }\n        })\n\n        // excludedUsers = excludedUsers.concat(org.members.map((member) => {\n        //     return member.\n        // }))\n\n        // TODO revive\n        // org.adminRequests.forEach((request) => {\n        //     if (request.resourceType === RequestResourceType.USER) {\n        //         switch (request.type) {\n        //             case RequestType.INVITATION:\n        //                 invited.push((<UserInvitation>request).user.username)\n        //                 // excludedUsers.push((<UserInvitation>request).user.username)\n        //                 break\n        //             case RequestType.REQUEST:\n        //                 requested.push((<UserRequest>request).requester.username)\n        //             // excludedUsers.push((<UserRequest>request).requester.username)\n        //         }\n        //     }\n        // })\n\n        try {\n            const users = await userClient.searchUsers(query)\n\n\n            // const filteredUsers = users.filter((user) => {\n            //     return (excludedUsers.indexOf(user.username) === -1)\n            // })\n            const orgUsers: Array<OrganizationUser> = users.map(({ username, realname }) => {\n                let relation: orgModel.UserRelationToOrganization\n                if (username === owner) {\n                    relation = orgModel.UserRelationToOrganization.OWNER\n                } else if (adminUsers.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.ADMIN\n                } else if (invited.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n                } else if (requested.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING\n                } else if (members.indexOf(username) >= 0) {\n                    relation = orgModel.UserRelationToOrganization.MEMBER\n                } else {\n                    relation = orgModel.UserRelationToOrganization.NONE\n                }\n                return {\n                    username, realname,\n                    relation: relation\n                }\n            })\n            dispatch(searchUsersSuccess(orgUsers))\n        } catch (ex) {\n            dispatch(searchUsersError(makeError({\n                code: ex.name,\n                message: ex.message\n            })))\n        }\n\n    }\n}\n\n// Select a user\n\nexport interface SelectUser extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER,\n    username: string\n}\n\nexport interface SelectUserStart extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_START\n}\n\nexport interface SelectUserSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n    user: User,\n    relation: orgModel.UserRelationToOrganization\n}\n\nexport interface SelectUserError extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n    error: AnError\n}\n\n\nfunction selectUserStart(): SelectUserStart {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_START\n    }\n}\n\nfunction selectUserSuccess(user: User, relation: orgModel.UserRelationToOrganization): SelectUserSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n        user: user,\n        relation: relation\n    }\n}\n\nfunction selectUserError(error: AnError): SelectUserError {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n        error: error\n    }\n}\n\nfunction isUserRequest(request: requestModel.Request, username: string): request is requestModel.UserRequest {\n    const req: requestModel.UserRequest = <requestModel.UserRequest>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.REQUEST &&\n        req.requester === username) {\n        return true\n    }\n    return false\n}\n\nfunction isUserInvitation(request: requestModel.Request, username: string): request is requestModel.UserRequest {\n    const req: requestModel.UserInvitation = <requestModel.UserInvitation>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.INVITATION &&\n        req.user &&\n        req.user === username) {\n        return true\n    }\n    return false\n}\n\nfunction getUserRelation(user: User, organization: orgModel.Organization): orgModel.UserRelationToOrganization {\n    if (user.username === organization.owner.username) {\n        return orgModel.UserRelationToOrganization.OWNER\n    }\n    const member = organization.members.find((member) => {\n        return member.username === user.username\n    })\n    if (member) {\n        switch (member.type) {\n            case MemberType.ADMIN:\n                return orgModel.UserRelationToOrganization.ADMIN\n            case MemberType.OWNER:\n                return orgModel.UserRelationToOrganization.OWNER\n            case MemberType.MEMBER:\n                return orgModel.UserRelationToOrganization.MEMBER\n        }\n    }\n\n    // TODO revive\n    // for (const request of organization.adminRequests) {\n    //     if (isUserInvitation(request, user.username)) {\n    //         return UserRelationToOrganization.MEMBER_INVITATION_PENDING\n    //     } else if (isUserRequest(request, user.username)) {\n    //         return UserRelationToOrganization.MEMBER_REQUEST_PENDING\n    //     }\n    // }\n\n    return orgModel.UserRelationToOrganization.VIEW\n}\n\nfunction ensureView(state: StoreState): View<InviteUserViewModel> {\n    const {\n        views: {\n            viewOrgView: { viewModel }\n        }\n    } = state\n    if (viewModel === null) {\n        throw new Error('select user invalid state -- no view value')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error('select user invalid state -- no view value')\n    }\n    const { inviteUserView } = viewModel.subViews\n    if (inviteUserView === null) {\n        throw new Error('select user invalid state -- no view value')\n    }\n    return inviteUserView\n}\n\n// function ensureViewModel(state: StoreState): InviteUserViewModel {\n//     const view = ensureView(state)\n//     if (view.viewModel)\n// }\n\nexport function selectUser(selectedUsername: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectUserStart())\n\n        const state = getState()\n\n        let view: View<InviteUserViewModel>\n        try {\n            view = ensureView(state)\n        } catch (ex) {\n            dispatch(selectUserError(makeError({\n                code: 'invalid state',\n                message: ex.message\n            })))\n            return\n        }\n\n        if (view.viewModel === null) {\n            dispatch(selectUserError(makeError({\n                code: 'error',\n                message: 'missing view model'\n            })))\n            return\n        }\n\n        const {\n            auth: { authorization: { token } },\n            app: { config }\n        } = state\n\n        const userClient = new userModel.UserModel({\n            token,\n            userProfileServiceURL: config.services.UserProfile.url\n        })\n\n        try {\n            const user = await userClient.getUser(selectedUsername)\n            const relation = getUserRelation(user, view.viewModel.organization)\n            dispatch(selectUserSuccess(user, relation))\n        } catch (ex) {\n            dispatch(selectUserError(makeError({\n                code: ex.name,\n                message: ex.message\n            })))\n        }\n    }\n}\n\n// Now send the invitation, whew!\n\nexport interface SendInvitation extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION\n}\n\nexport interface SendInvitationStart extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n}\n\nexport interface SendInvitationSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n}\n\nexport interface SendInvitationError extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n    error: AnError\n}\n\nexport function sendInvitationStart(): SendInvitationStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n    }\n}\n\nexport function sendInvitationSuccess(): SendInvitationSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n    }\n}\n\nexport function sendInvitationError(error: AnError): SendInvitationError {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n        error: error\n    }\n}\n\nexport function sendInvitation() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendInvitationStart())\n\n        const state = getState()\n\n        let view: View<InviteUserViewModel>\n        try {\n            view = ensureView(state)\n        } catch (ex) {\n            dispatch(selectUserError(makeError({\n                code: 'invalid state',\n                message: ex.message\n            })))\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        if (view.viewModel === null) {\n            dispatch(sendInvitationError(makeError({\n                code: 'error',\n                message: 'null view model'\n            })))\n            return\n        }\n\n        const { selectedUser, organization: { id } } = view.viewModel\n\n        if (!selectedUser) {\n            return\n        }\n\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        requestClient.inviteUserToJoinOrg(id, selectedUser.user.username)\n            .then((request) => {\n                dispatch(sendInvitationSuccess())\n            })\n            .catch((err) => {\n                dispatch(sendInvitationError(makeError({\n                    code: err.name,\n                    message: err.message\n                })))\n            })\n    }\n}\n","import * as React from 'react'\nimport './User.css'\n\nimport Avatar from './entities/Avatar'\nimport * as types from '../types';\n\nexport interface UserProps {\n    user: types.User\n    avatarSize?: number\n}\n\ninterface UserState {\n\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n    }\n\n    render() {\n        return (\n            <div className=\"User\">\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        ❨{this.props.user.username}❩\n                                </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default User","import * as React from 'react'\nimport { Route } from 'react-router-dom'\nimport './component.css'\nimport { Icon, Menu } from 'antd';\nimport { ClickParam } from 'antd/lib/menu'\n\ninterface MainMenuProps {\n    buttons?: JSX.Element\n}\n\ninterface MainMenuState {\n    currentMenuItem: string\n}\n\nclass MainMenu extends React.Component<MainMenuProps, MainMenuState> {\n    constructor(props: MainMenuProps, context: React.Context<any>) {\n        super(props)\n\n        this.state = {\n            currentMenuItem: 'myorgs'\n        }\n    }\n\n    onMenuSelection(e: ClickParam) {\n        // this.setState({\n        //     currentMenuItem: e.key\n        // })\n        // switch (e.key) {\n        //     case 'myorgs':\n        //         this.props.history.push('/dashboard')\n        //     case 'allorgs':\n        //         this.props.history.push('/organizations')\n        // }\n    }\n\n\n    renderMenu() {\n        return (\n            <Route render={({ history, location }) => {\n                let selectedKeys: Array<string> = []\n                switch (location.pathname) {\n                    case '/organizations':\n                        selectedKeys = ['allorgs']\n                        break\n                    case '/newOrganization':\n                        selectedKeys = ['neworg']\n                        break\n                }\n                return (\n                    <Menu\n                        // onClick={(e: ClickParam) => { doNavigate(e.key) }}\n                        selectedKeys={selectedKeys}\n                        style={{ backgroundColor: 'transparent' }}\n                        mode=\"horizontal\"\n                    >\n                        {/* <Menu.Item key=\"allorgs\">\n                            <Link to=\"/organizations\">Browse &amp; Search</Link>\n                        </Menu.Item> */}\n                        {/* <Menu.Item key=\"neworg\">\n                            <Link to=\"/newOrganization\">Create New Organization</Link>\n                        </Menu.Item> */}\n                    </Menu>\n                )\n            }} />\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"MainMenu\">\n                <div className=\"MainMenu-menu\">\n                    {this.renderMenu()}\n                </div>\n                <div className=\"MainMenu-buttons\">\n                    {this.props.buttons}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default MainMenu;","import * as React from 'react'\n\nimport './component.css'\nimport { User, InviteUserViewState, OrganizationUser } from '../../../../../types';\nimport { Button, Icon, Modal, Alert } from 'antd';\nimport Header from '../../../../Header';\nimport { NavLink } from 'react-router-dom';\nimport UserComponent from '../../../../User'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport * as userModel from '../../../../../data/models/user'\nimport MainMenu from '../../../../menu/component'\n\nexport interface InviteUserProps {\n    organization: orgModel.Organization,\n    selectedUser: {\n        user: User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: InviteUserViewState,\n    users: Array<OrganizationUser> | null\n    onSearchUsers: (query: userModel.UserQuery) => void,\n    onSelectUser: (username: string) => void,\n    onSendInvitation: () => void\n    onFinish: () => void\n}\n\ninterface InviteUserState {\n    autocompleteMessage: string\n}\nclass InviteUser extends React.Component<InviteUserProps, InviteUserState> {\n\n    lastSearchAt: Date | null\n\n    static searchDebounce: number = 200\n\n    searchInput: React.RefObject<HTMLInputElement>\n    searchButton: React.RefObject<Button>\n\n    constructor(props: InviteUserProps) {\n        super(props)\n\n        this.lastSearchAt = null\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.state = {\n            autocompleteMessage: ''\n        }\n    }\n\n    onClickCancelToViewer() {\n        this.props.onFinish()\n    }\n\n    onSendInvitation() {\n        this.props.onSendInvitation()\n    }\n\n    canSave() {\n        if (this.props.selectedUser) {\n            return true\n        }\n        return false\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.doSearchUsers(currentSearchInputValue)\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        // this.doSearchUsers(currentSearchInputValue)\n    }\n\n    doSearchUsers(value: string) {\n        // if (value.length < 3) {\n        //     this.setState({ autocompleteMessage: 'Search begins after 3 or more characters' })\n        //     return\n        // }\n        // this.setState({ autocompleteMessage: '' })\n        // build up list of users already owning, members of, or with membership pending.\n        const excludedUsers: Array<string> = []\n\n        if (this.lastSearchAt === null ||\n            (new Date().getTime() - this.lastSearchAt.getTime() > InviteUser.searchDebounce)) {\n            this.lastSearchAt = new Date()\n            this.props.onSearchUsers({\n                query: value,\n                excludedUsers: []\n            })\n        }\n    }\n\n    onSelectUser(user: OrganizationUser) {\n        this.props.onSelectUser(user.username);\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    renderUsers() {\n        if (!this.props.users) {\n            const message = 'Search for users by name or username to display a list of available users in this space.'\n            return (\n                <Alert type=\"info\" message={message} showIcon />\n            )\n        }\n        if (this.props.users.length === 0) {\n            return (\n                <Alert type=\"warning\" message=\"No users found\" showIcon />\n            )\n        }\n        return this.props.users.map((user) => {\n            if (user.relation === orgModel.UserRelationToOrganization.NONE) {\n                return (\n                    <div\n                        className=\"user notInOrganization \"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            } else {\n                return (\n                    <div\n                        className=\"user inOrganization\"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            }\n        })\n    }\n\n    renderOrgInfo() {\n        return (\n            <div className=\"orgInfo\">\n                <div className=\"name\">\n                    <span className=\"field-label\">name</span>\n                    <span>{this.props.organization.name}</span>\n                </div>\n                <div className=\"description\">\n                    <span className=\"field-label\">description</span>\n                    <span>{this.props.organization.description}</span>\n                </div>\n            </div>\n        )\n    }\n\n    renderInvitationForm() {\n        let button\n        let message\n        if (this.props.selectedUser) {\n            if (this.props.selectedUser.relation === orgModel.UserRelationToOrganization.VIEW) {\n                button = (\n                    <Button\n                        type=\"primary\"\n                        onClick={this.onSendInvitation.bind(this)}>Send Invitation</Button>\n                )\n            } else {\n                button = (\n                    <Button\n                        disabled\n                        type=\"primary\"\n                    >Send Invitation</Button>\n                )\n                // message = 'User is a member of this organization'\n                message = (\n                    <div>\n                        User may not be invited because:<br />\n                        {this.renderRelation(this.props.selectedUser.relation)}\n                    </div>\n                )\n                message = (\n                    <Alert\n                        type=\"warning\"\n                        message={message}\n                        showIcon\n                    />\n                )\n            }\n        } else {\n            button = (\n                <Button\n                    disabled\n                    type=\"primary\"\n                >Send Invitation</Button>\n            )\n            message = 'Please select a user'\n        }\n        return (\n            <div className=\"invitationForm\">\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {button}\n                </div>\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {message}\n                </div>\n            </div>\n        )\n    }\n\n    renderInvitationStatus() {\n        switch (this.props.editState) {\n            case InviteUserViewState.NONE:\n                return (\n                    <div>NONE</div>\n                )\n            case InviteUserViewState.EDITING:\n                return (\n                    <div>EDITING</div>\n                )\n            case InviteUserViewState.SENDABLE:\n                return (\n                    <div>SENDABLE</div>\n                )\n            case InviteUserViewState.SENDING:\n                return (\n                    <div>SENDING</div>\n                )\n            case InviteUserViewState.SUCCESS:\n                return (\n                    <div>SENT SUCCESSFULLY</div>\n                )\n            case InviteUserViewState.ERROR:\n                return (\n                    <div>ERROR SENDING</div>\n                )\n            default:\n                return (\n                    <div>Bad State</div>\n                )\n        }\n    }\n\n    renderRelation(relation: orgModel.UserRelationToOrganization) {\n        switch (relation) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <span><Icon type=\"stop\" /> Not a member</span>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> User's membership <b>request</b> is pending</span>)\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> User has been <b>invited</b> to join</span>)\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" /> User is a <b>member</b> of this organization</span>)\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />User is an <b>admin</b> of this organization</span>)\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n\n                    <span><Icon type=\"crown\" /> User is the <b>owner</b> of this Organization</span>\n                )\n        }\n    }\n\n    renderSelectedUser() {\n        if (this.props.selectedUser === null) {\n            return (\n                <div className=\"selectedUser\">\n                    <p className=\"noSelection\">\n                        No user yet selected\n                    </p>\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"selectedUser\">\n                    <UserComponent user={this.props.selectedUser.user} />\n                    {this.renderRelation(this.props.selectedUser.relation)}\n                </div>\n            )\n        }\n    }\n\n    renderFooter() {\n        return (\n            <div className=\"footer\">\n            </div>\n        )\n    }\n\n    renderSearchButton() {\n        return (<Icon type=\"search\" />)\n    }\n\n    renderMenuButtons() {\n        return (\n            <div className=\"ButtonSet\">\n                <div className=\"ButtonSet-button\">\n                    <Button icon=\"rollback\"\n                        type=\"danger\"\n                        onClick={this.onClickCancelToViewer.bind(this)}>\n                        Done\n                    </Button>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"InviteUser scrollable-flex-column\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                <div className=\"row scrollable-flex-column\">\n                    <div className=\"col1 firstCol users scrollable-flex-column\">\n                        <h3>Select User to Invite</h3>\n                        <form id=\"searchForm\" className=\"searchBar\"\n                            onSubmit={this.onSubmit.bind(this)}>\n                            <input\n                                ref={this.searchInput}\n                                autoFocus\n                                onChange={this.onSearchInputChange.bind(this)}\n                                placeholder=\"Search for a user\"\n                            />\n                            <Button\n                                className=\"searchButton\"\n                                form=\"searchForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\"\n                            >\n                                {this.renderSearchButton()}\n                            </Button>\n                        </form>\n                        <div className=\"usersTable\">\n                            {this.renderUsers()}\n                        </div>\n                    </div>\n                    <div className=\"col1 lastCol\">\n                        <h3>Selected User</h3>\n                        {this.renderSelectedUser()}\n                        {this.renderInvitationForm()}\n                    </div>\n                </div>\n\n                {this.renderFooter()}\n            </div>\n        )\n    }\n}\n\nexport default InviteUser","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../../../types'\nimport * as actions from '../../../../../redux/actions/viewOrganization/inviteUser'\nimport InviteUser from './component'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport * as userModel from '../../../../../data/models/user'\n\nexport interface OwnProps {\n    onFinish: () => void\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    users: Array<types.OrganizationUser> | null\n    selectedUser: {\n        user: types.User,\n        relation: orgModel.UserRelationToOrganization\n    } | null\n    editState: types.InviteUserViewState\n}\n\ninterface DispatchProps {\n    onSearchUsers: (query: userModel.UserQuery) => void\n    onSelectUser: (username: string) => void\n    onSendInvitation: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    if (viewModel.subViews.inviteUserView.viewModel === null) {\n        throw new Error(\"argh, null subview view model\")\n    }\n\n    return viewModel.subViews.inviteUserView.viewModel\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onSearchUsers: ({ query, excludedUsers }) => {\n            dispatch(actions.inviteUserSearchUsers({ query, excludedUsers }) as any)\n        },\n        onSelectUser: (username: string) => {\n            dispatch(actions.selectUser(username) as any)\n        },\n        onSendInvitation: () => {\n            dispatch(actions.sendInvitation() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(InviteUser)","import * as React from 'react'\n\nimport Container from './container'\nimport {\n    StoreState, ViewOrgViewModelKind, ViewState,\n    InviteUserViewModel, View, NoneViewModel\n} from '../../../../../types';\n\nexport interface InviteUserLoaderProps {\n    view: View<InviteUserViewModel | NoneViewModel>\n    organizationId: string\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n    onFinish: () => void\n}\n\ninterface InviteUserLoaderState {\n}\n\nclass InviteUserLoader extends React.Component<InviteUserLoaderProps, InviteUserLoaderState> {\n    constructor(props: InviteUserLoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        const message = (\n            <div>\n                Loading ...\n                {' '}\n                <Spin />\n            </div>\n        )\n        return (\n            <Alert type=\"info\" message={message} style={{\n                width: '20em',\n                padding: '20px',\n                margin: '20px auto'\n            }} />\n        )\n    }\n\n    renderError(error: AnError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.state) {\n            case ViewState.NONE:\n                return this.renderLoading()\n            case ViewState.LOADING:\n                return this.renderLoading()\n            case ViewState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError(makeError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    }))\n                }\n            default:\n                return (\n                    <Container onFinish={this.props.onFinish} />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.state) {\n            case ViewState.NONE:\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../../../redux/actions/viewOrganization/inviteUser'\nimport { Spin, Alert } from 'antd';\nimport { AnError, makeError } from '../../../../../lib/error';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: View<InviteUserViewModel>\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const v = state.views.viewOrgView\n    const vm1 = v.viewModel\n    if (vm1 === null) {\n        throw new Error('vm is null')\n    }\n    if (vm1.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error('not the right vm')\n    }\n    return {\n        view: vm1.subViews.inviteUserView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(InviteUserLoader)","import * as React from 'react'\nimport './UserSimple.css'\nimport Avatar from './Avatar'\nimport * as userModel from '../../data/models/user'\nimport { Tooltip } from 'antd';\n\nexport interface UserProps {\n    user: userModel.User\n    avatarSize?: number\n}\n\ninterface UserState {\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n    }\n\n    render() {\n        const tooltip = (\n            <div>\n                <div>\n                    {this.props.user.realname}\n                </div>\n                <div>\n                    <span><Avatar user={this.props.user} size={20} /></span>\n                    {' '}\n                    <span>{this.props.user.username}</span>\n                </div>\n            </div>\n        )\n        return (\n            <div className=\"UserSimple\">\n                <Tooltip title={tooltip} placement=\"bottomRight\">\n                    <a href={\"/#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                </Tooltip>\n            </div>\n        )\n    }\n}\n\nexport default User","import * as React from 'react'\nimport * as userModel from '../../data/models/user'\nimport UserSimple from './UserSimple'\n\ninterface LoaderProps {\n    userId: userModel.Username\n    user: userModel.User | undefined\n    avatarSize: number\n    onLoad: (userId: userModel.Username) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.user) {\n            return (\n                <UserSimple user={this.props.user} avatarSize={this.props.avatarSize} />\n            )\n        } else {\n            return (\n                <div>\n                    Loading user...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.user) {\n            this.props.onLoad(this.props.userId)\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/entities'\n\n\nexport interface OwnProps {\n    userId: userModel.Username\n    avatarSize: number\n}\n\ninterface StateProps {\n    user: userModel.User | undefined\n}\n\ninterface DispatchProps {\n    onLoad: (userId: userModel.Username) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        user: state.entities.users.byId.get(props.userId)\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (userId: userModel.Username) => {\n            dispatch(actions.userLoader(userId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport * as narrativeModel from '../../../data/models/narrative'\nimport { Tooltip, Icon } from 'antd'\nimport UserSimple from '../UserSimpleContainer'\nimport { niceElapsed } from '../../../lib/time'\nimport './component.css'\nimport NiceElapsedTime from '../../NiceElapsedTime';\n\nexport interface NarrativeProps {\n    narrative: narrativeModel.Narrative\n}\n\nenum View {\n    COMPACT = 0,\n    NORMAL\n}\n\nfunction reverseView(v: View) {\n    switch (v) {\n        case View.COMPACT:\n            return View.NORMAL\n        case View.NORMAL:\n            return View.COMPACT\n    }\n}\n\ninterface NarrativeState {\n    view: View\n}\n\nexport default class Narrative extends React.Component<NarrativeProps, NarrativeState> {\n    constructor(props: NarrativeProps) {\n        super(props)\n\n        this.state = {\n            view: View.COMPACT\n        }\n    }\n\n    onToggleView() {\n        this.setState({\n            view: reverseView(this.state.view)\n        })\n    }\n\n    renderPublicPermission(narrative: narrativeModel.AccessibleNarrative) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"global\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    // renderUserPermission(narrative: narrativeModel.AccessibleNarrative) {\n    //     let label\n    //     switch (narrative.access) {\n    //         case narrativeModel.NarrativeAccess.VIEW:\n    //             label = (\n    //                 <span>View-Only (<i>visit narrative to request additional access</i>)</span>\n    //             )\n    //             break\n    //         case narrativeModel.NarrativeAccess.EDIT:\n    //             label = (\n    //                 <span>Edit (<i>visit narrative to request additional access</i>)</span>\n    //             )\n    //             break\n    //         case narrativeModel.NarrativeAccess.ADMIN:\n    //             label = 'Admin'\n    //             break\n    //         case narrativeModel.NarrativeAccess.OWNER:\n    //             label = 'Owner'\n    //             break\n    //         default:\n    //             label = 'Unknown'\n    //     }\n    //     return (\n    //         <span>\n    //             {label}\n    //         </span>\n    //     )\n    // }\n\n    renderUserPermission(narrative: narrativeModel.AccessibleNarrative) {\n        let iconType\n        let tooltip\n        switch (narrative.access) {\n            case narrativeModel.NarrativeAccess.VIEW:\n                iconType = 'eye'\n                tooltip = (\n                    <span>View-Only (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.EDIT:\n                iconType = 'edit'\n                tooltip = (\n                    <span>This narrative is shared with you with <b>edit</b> access (<i>visit narrative to request additional access</i>)</span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.ADMIN:\n                iconType = 'unlock'\n                tooltip = (\n                    <span>\n                        This narrative is shared with you with <b>access</b> - you may edit and re-share this\n                    </span>\n                )\n                break\n            case narrativeModel.NarrativeAccess.OWNER:\n                iconType = 'crown'\n                tooltip = (\n                    <span>\n                        You are the owner of this Narrative\n                    </span>\n                )\n                break\n        }\n        return (\n            <Tooltip\n                placement=\"bottomRight\"\n                title={tooltip}>\n                <Icon type={iconType} />\n            </Tooltip>\n        )\n    }\n\n    renderGlobalPermission(narrative: narrativeModel.AccessibleNarrative) {\n        let iconType\n        let tooltip\n        if (narrative.isPublic) {\n            iconType = 'global'\n            tooltip = 'This narrative has been shared publicly - with all KBase users'\n        } else {\n            iconType = 'lock'\n            tooltip = 'This narrative is private - only accessible to the owner any users it has been shared with'\n        }\n        return (\n            <Tooltip\n                placement=\"bottomRight\"\n                title={tooltip}>\n                <Icon type={iconType} />\n            </Tooltip>\n        )\n    }\n\n    renderNiceElapsed(d: Date) {\n        const tooltip = (\n            <span>\n                {\n                    Intl.DateTimeFormat('en-US', {\n                        month: 'short',\n                        day: 'numeric',\n                        year: 'numeric'\n                    }).format(d)\n                }\n            </span>\n        )\n        return (\n            <Tooltip placement=\"bottomRight\" title={tooltip}>\n                {niceElapsed(d)}\n            </Tooltip>\n        )\n    }\n\n    renderCompact(narrative: narrativeModel.AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                {/* <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div> */}\n                <div className=\"mainCol\">\n                    <div>\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {', '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            {this.renderUserPermission(narrative)}\n                        </div>\n                        <div className=\"Narrative-global\">\n                            {this.renderGlobalPermission(narrative)}\n                        </div>\n                    </div>\n                    <div>\n                        <span className=\"field-label\">updated</span>\n                        <NiceElapsedTime time={narrative.lastSavedAt} />\n                    </div>\n\n                    {/* TODO: left off here; need to add in the added date\n                        <div>\n                        <span className=\"field-label\">added</span>\n                        {this.renderNiceElapsed(this.props.)}\n                    </div> */}\n                    {/* <div>\n                        {this.renderPublicPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">your permission</span>\n                        {this.renderUserPermission(narrative)}\n                    </div> */}\n                    {/* <div>\n                        <span className=\"field-label\">owner</span>\n                        <div style={{ display: 'inline-block' }}><UserSimple avatarSize={20} userId={narrative.owner} /></div>\n                    </div> */}\n                </div>\n\n            </React.Fragment>\n        )\n    }\n\n    renderNormal(narrative: narrativeModel.AccessibleNarrative) {\n\n        return (\n            <React.Fragment>\n                <div className=\"controlCol\">\n                    <a onClick={this.onToggleView.bind(this)}\n                        className={`linkButton ${this.state.view === View.NORMAL ? \"pressed\" : \"\"}`}\n                    >\n                        <Icon type={`${this.state.view === View.NORMAL ? \"up\" : \"down\"}`} />\n                    </a>\n                </div>\n                {/* <div className=\"iconCol\">\n                    <Icon type=\"file\" style={{ fontSize: '30px', width: '30px' }} />\n                </div> */}\n                <div className=\"mainCol\">\n                    <div>\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {', '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            {this.renderUserPermission(narrative)}\n                        </div>\n                        <div className=\"Narrative-global\">\n                            {this.renderGlobalPermission(narrative)}\n                        </div>\n                    </div>\n                    {/* <div>\n                        {this.renderPublicPermission(narrative)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">your permission</span>\n                        {this.renderUserPermission(narrative)}\n                    </div> */}\n                    {/* <div>\n                        <span className=\"field-label\">owner</span>\n                        <div style={{ display: 'inline-block' }}><UserSimple avatarSize={20} userId={narrative.owner} /></div>\n                    </div> */}\n                    <div>\n                        <span className=\"field-label\">last saved</span>\n                        {this.renderNiceElapsed(narrative.lastSavedAt)}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">by</span>\n                        <UserSimple avatarSize={20} userId={narrative.lastSavedBy} />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNarrative(narrative: narrativeModel.AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"mainCol\">\n                    <div>\n                        <div className=\"Narrative-title\">\n                            <a href={\"/narrative/\" + narrative.workspaceId} target=\"_blank\">\n                                {narrative.title}\n                            </a>\n                        </div>\n                        {', '}\n                        <div className=\"Narrative-owner\">\n                            <UserSimple avatarSize={20} userId={narrative.owner} />\n                        </div>\n                    </div>\n\n                    <div className=\"Narrative-attributes\">\n                        <div className=\"Narrative-userPermission\">\n                            {this.renderUserPermission(narrative)}\n                        </div>\n                        <div className=\"Narrative-global\">\n                            {this.renderGlobalPermission(narrative)}\n                        </div>\n                    </div>\n                    <div>\n                        <span className=\"field-label\">\n                            <Icon type=\"save\" />\n                        </span>\n                        <NiceElapsedTime time={narrative.lastSavedAt} tooltipPrefix=\"last saved \" />\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    render() {\n        const narrative = this.props.narrative\n        if (narrative.access === narrativeModel.NarrativeAccess.NONE) {\n            return (\n                <div>\n                    You don't have access to this Narrative\n                </div>\n            )\n        }\n        // switch (this.state.view) {\n        //     case View.COMPACT:\n        //         return (\n        //             <div className=\"Narrative View-COMPACT\">\n        //                 {this.renderCompact(narrative)}\n        //             </div>\n        //         )\n        //     case View.NORMAL:\n        //         return (\n        //             <div className=\"Narrative View-NORMAL\">\n        //                 {this.renderNormal(narrative)}\n        //             </div>\n        //         )\n        // }\n        return this.renderNarrative(narrative)\n    }\n}","import * as React from 'react'\nimport * as narrativeModel from '../../../data/models/narrative'\nimport Narrative from './component'\n\ninterface LoaderProps {\n    workspaceId: narrativeModel.WorkspaceID\n    narrative: narrativeModel.Narrative | null\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\ninterface LoaderState { }\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    render() {\n        if (this.props.narrative) {\n            return (\n                <Narrative\n                    narrative={this.props.narrative}\n                />\n            )\n        } else {\n            return (\n                <div>\n                    Loading narrative...\n                </div>\n            )\n        }\n    }\n\n    componentDidMount() {\n        if (!this.props.narrative) {\n            this.props.onLoad(this.props.workspaceId)\n        }\n    }\n}\n\n// redux wrapper\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../../types'\nimport * as actions from '../../../redux/actions/entities'\n\nexport interface OwnProps {\n    workspaceId: narrativeModel.WorkspaceID\n}\n\ninterface StateProps {\n    narrative: narrativeModel.Narrative | null\n}\n\ninterface DispatchProps {\n    onLoad: (workspaceId: narrativeModel.WorkspaceID) => void\n}\n\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        narrative: state.entities.narratives.byId.get(props.workspaceId) || null\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<actions.EntityAction>): DispatchProps {\n    return {\n        onLoad: (workspaceId: narrativeModel.WorkspaceID) => {\n            dispatch(actions.loadNarrative(workspaceId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)\n","import * as React from 'react'\nimport * as orgModel from '../data/models/organization/model'\nimport { Button, Tooltip, Icon, Drawer } from 'antd'\nimport Narrative from './entities/narrative/reduxAdapter'\nimport NiceElapsedTime from './NiceElapsedTime'\nimport './OrganizationNarrative.css'\n\nexport interface Props {\n    organization: orgModel.Organization\n    narrative: orgModel.NarrativeResource\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n}\n\ninterface State {\n    requestAccess: boolean\n}\n\nexport default class OrganizationNarrative extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n        this.state = {\n            requestAccess: false\n        }\n    }\n\n    onGetViewAccess() {\n        this.props.onGetViewAccess(this.props.narrative)\n    }\n\n    onRequestAccess() {\n        this.setState({ requestAccess: true })\n    }\n\n    onCloseRequestAccess() {\n        this.setState({ requestAccess: false })\n    }\n\n    renderNarrativePermission(narrative: orgModel.NarrativeResource) {\n        let label\n        let shareButton\n        let permissionTooltip\n        let buttonTooltip\n        switch (narrative.permission) {\n            case orgModel.UserWorkspacePermission.NONE:\n                if (narrative.isPublic) {\n                    permissionTooltip = \"You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it\"\n                    label = (\n                        <span>\n                            View Only (public)\n                        </span>\n                    )\n                    buttonTooltip = 'Although you have View-Only access to this Narrative due to it being shared globally, you may obtain personal View-Only access by clicking this button'\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onGetViewAccess.call(this) }}>\n                            Click for View Access\n                        </Button>\n                    )\n                } else {\n                    permissionTooltip = \"You have No access to this narrative narrative; you may not view, edit, run, or share it\"\n                    label = (\n                        <span>\n                            No Access\n                        </span>\n                    )\n                    buttonTooltip = 'You cannot access this Narrative; in order to immediately obtain View-Only access click this button.'\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onGetViewAccess.call(this) }}>\n                            Click for View Access\n                        </Button>\n                    )\n                }\n                break\n            case orgModel.UserWorkspacePermission.VIEW:\n                permissionTooltip = \"You have View access to this narrative narrative; you may view it, but not edit, run, or share it\"\n                label = (\n                    <span>\n                        View Only\n                    </span>\n                )\n                buttonTooltip = 'You already have View-Only access to this Narrative, but may request additional access'\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestAccess.call(this) }}>\n                        Request Additional Access\n                    </Button>\n                )\n                break\n            case orgModel.UserWorkspacePermission.EDIT:\n                permissionTooltip = \"You have Edit access to this Narrative; you may view, edit, and run, but not share it\"\n                label = (\n                    <span>\n                        Edit\n                    </span>\n                )\n                buttonTooltip = 'You already have Edit access to this Narrative, but may request additional access by clicking this button'\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestAccess.call(this) }}>\n                        Request Admin Access\n                    </Button>\n                )\n                break\n            case orgModel.UserWorkspacePermission.ADMIN:\n                permissionTooltip = \"You have Admin access to this narrative narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Admin\n                    </span>\n                )\n                break\n            case orgModel.UserWorkspacePermission.OWNER:\n                permissionTooltip = \"You are the Owner of this narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Owner\n                    </span>\n                )\n                break\n            default:\n                label = (\n                    <span>\n                        Unknown\n                    </span>\n                )\n        }\n\n        return (\n            <React.Fragment>\n                <Tooltip title={permissionTooltip} placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <span className=\"field-label\">your permission</span>\n                        {label}\n                    </span>\n                </Tooltip>\n                {' '}\n                <Tooltip title={buttonTooltip} placement=\"right\">\n                    {shareButton}\n                </Tooltip>\n            </React.Fragment>\n        )\n    }\n\n    renderPublicPermission(narrative: orgModel.NarrativeResource) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"global\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <Icon type=\"lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderNarrative() {\n        const narrative = this.props.narrative\n        if (this.props.organization.isMember) {\n            if (narrative.permission === orgModel.UserWorkspacePermission.NONE &&\n                !narrative.isPublic) {\n                return (\n                    <React.Fragment>\n                        <a href={'/narrative/' + narrative.workspaceId} target=\"_blank\">\n                            <div className=\"title\">{narrative.title}</div>\n                        </a>\n                        <div>{this.renderNarrativePermission(narrative)}</div>\n                    </React.Fragment>\n                )\n            }\n            return (\n                <Narrative workspaceId={narrative.workspaceId} />\n            )\n        }\n        return (\n            <Narrative workspaceId={narrative.workspaceId} />\n        )\n    }\n\n    renderResource() {\n        return (\n            <div>\n                <div>\n                    <span className=\"field-label\">added</span>\n                    <span>\n                        <NiceElapsedTime time={this.props.narrative.createdAt} />\n                    </span>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        let accessModal\n        if (this.state.requestAccess) {\n            // TODO: replace with our own implementation...n\n            accessModal = (\n                <Drawer title=\"Request Access to Narrative\"\n                    placement=\"right\"\n                    closable={true}\n                    visible={true}\n                    onClose={() => { this.onCloseRequestAccess.call(this) }}\n                >\n                    Requesting access...\n                </Drawer>\n            )\n        }\n\n        return (\n            <div className=\"OrganizationNarrative\">\n                <div className=\"OrganizationNarrative-narrativeCol\">\n                    {this.renderNarrative()}\n                </div>\n                {/* <div className=\"OrganizationNarrative-resourceCol\">\n                    {this.renderResource()}\n                </div> */}\n                {accessModal}\n            </div>\n        )\n    }\n}","import * as React from 'react'\nimport './component.css'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport { Alert, Button, Icon, Menu, Dropdown, Input, Select, Modal } from 'antd';\nimport OrganizationNarrative from '../../../../OrganizationNarrative'\n\nexport interface NarrativesProps {\n    organization: orgModel.Organization\n    narratives: Array<orgModel.NarrativeResource>\n    relation: orgModel.Relation\n    sortNarrativesBy: string\n    searchNarrativesBy: string\n    onSortNarratives: (sortBy: string) => void\n    onSearchNarratives: (searchBy: string) => void\n    onRemoveNarrative: (narrative: orgModel.NarrativeResource) => void\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n    onRequestAddNarrative: () => void\n}\n\ninterface NarrativesState {\n}\n\nexport default class Narratives extends React.Component<NarrativesProps, NarrativesState> {\n    constructor(props: NarrativesProps) {\n        super(props)\n    }\n\n    onRequestAddNarrative() {\n        // this.setState({ navigateTo: NavigateTo.REQUEST_ADD_NARRATIVE })\n        // alert('will add narrative')\n        this.props.onRequestAddNarrative()\n    }\n\n    onRemoveNarrative(narrative: orgModel.NarrativeResource) {\n        const confirmed = () => {\n            this.props.onRemoveNarrative(narrative)\n        }\n        const message = (\n            <React.Fragment>\n                <p>\n                    Please confirm the removal of this Narrative from this Organization.\n                </p>\n                <p>\n                    Any view permission granted to organization members will be unaffected by removing the Narrative.\n                </p>\n                <p>\n                    All Organization members and the Narrative owner will receive a notification.\n                </p>\n            </React.Fragment>\n        )\n        Modal.confirm({\n            title: 'Confirm',\n            content: message,\n            width: '50em',\n            okText: 'Confirm',\n            onOk: () => {\n                confirmed()\n            }\n        })\n    }\n\n    onNarrativeMenu(key: string, narrative: orgModel.NarrativeResource) {\n        switch (key) {\n            case 'removeNarrative':\n                this.onRemoveNarrative(narrative)\n                break\n        }\n    }\n\n    renderNarrativeMenu(narrative: orgModel.NarrativeResource) {\n        const relation = this.props.relation\n        let menu\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                // should never occur\n                break;\n            case (orgModel.UserRelationToOrganization.VIEW):\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                break;\n            case (orgModel.UserRelationToOrganization.ADMIN):\n            case (orgModel.UserRelationToOrganization.OWNER):\n                menu = (\n                    <Menu onClick={({ key }) => { this.onNarrativeMenu(key, narrative) }}>\n                        <Menu.Item key=\"removeNarrative\">\n                            <Icon type=\"delete\" /> Remove Narrative from Organization\n                        </Menu.Item>\n                    </Menu>\n                )\n        }\n        if (!menu) {\n            return\n        }\n        return (\n            <Dropdown overlay={menu} trigger={['click']}>\n                <Icon type=\"ellipsis\" className=\"IconButton-hover\" />\n            </Dropdown>\n        )\n    }\n\n    renderSearchBar() {\n        const doChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n            this.props.onSearchNarratives(e.target.value)\n        }\n        return (\n            <div style={{ paddingRight: '6px' }}>\n                <Input style={{ width: '100%', marginRight: '6px' }}\n                    placeholder=\"Filter narratives by title\"\n                    onChange={doChange} />\n                {/* <Button>\n                    <Icon type=\"search\" />\n                </Button> */}\n            </div>\n        )\n    }\n\n    renderSortBar() {\n        const handleSelect = (value: string) => {\n            this.props.onSortNarratives(value)\n        }\n\n        return (\n            <React.Fragment>\n                <span className=\"field-label\">sort</span>\n                <Select onChange={handleSelect}\n                    style={{ width: '11em' }}\n                    dropdownMatchSelectWidth={true}\n                    defaultValue={this.props.sortNarrativesBy}\n                >\n                    <Select.Option value=\"name\" key=\"name\">Name</Select.Option>\n                    <Select.Option value=\"added\" key=\"added\">Date Added</Select.Option>\n                    <Select.Option value=\"changed\" key=\"changed\">Last Changed</Select.Option>\n                </Select>\n            </React.Fragment>\n        )\n    }\n\n    renderMemberNarratives() {\n        const extras = [(\n            <Button\n                key=\"addNarrative\"\n                size=\"small\"\n                onClick={this.onRequestAddNarrative.bind(this)}>\n                <Icon type=\"plus\" />  Add a Narrative\n            </Button>\n        )]\n\n        let narrativesTable\n        if (this.props.narratives.length === 0) {\n            narrativesTable = (\n                <Alert type=\"info\" message=\"No Narratives are yet associated with this Organization\" />\n            )\n        } else {\n            narrativesTable = this.props.narratives.map((narrative) => {\n                const lastOrgVisitAt = this.props.organization.lastVisitedAt\n                const addedAt = narrative.addedAt\n                let isNew\n                if (lastOrgVisitAt === null) {\n                    if (addedAt === null) {\n                        isNew = false\n                    } else {\n                        isNew = false\n                    }\n                } else {\n                    if (addedAt === null) {\n                        isNew = false\n                    } else {\n                        isNew = lastOrgVisitAt.getTime() < addedAt.getTime()\n                    }\n                }\n                const classNames = ['ViewOrganization-Narratives-narrative', 'simpleCard']\n                if (isNew) {\n                    classNames.push('ViewOrganization-Narratives-newNarrative')\n                }\n                return (\n                    <div className={classNames.join(' ')} key={String(narrative.workspaceId)}>\n                        <div className=\"ViewOrganization-Narratives-dataCol\">\n                            <OrganizationNarrative\n                                narrative={narrative}\n                                organization={this.props.organization}\n                                onGetViewAccess={this.props.onGetViewAccess} />\n                        </div>\n                        <div className=\"ViewOrganization-Narratives-buttonCol\">\n                            {this.renderNarrativeMenu(narrative)}\n                        </div>\n                    </div>\n                )\n            })\n        }\n\n        // const narrativeCount = this.props.narratives.length\n        const narrativeCount = this.props.organization.narrativeCount\n        const title = (\n            <span className=\"ViewOrganization-Narratives-title\">\n                <Icon type=\"folder-open\" style={{ marginRight: '8px' }} />\n                Narratives\n                {' '}\n                <span className=\"ViewOrganization-Narratives-titleCount\">({narrativeCount})</span>\n            </span>\n        )\n        return (\n            <div className=\"ViewOrganization-Narratives scrollable-flex-column\">\n                <div className=\"ViewOrganization-Narratives-header\">\n                    <div className=\"ViewOrganization-Narratives-headerCol1\">\n                        {title}\n                    </div>\n                    <div className=\"ViewOrganization-Narratives-headerCol2\">\n                        {extras}\n                    </div>\n                </div>\n                <div className=\"ViewOrganization-Narratives-toolbar\">\n                    <div className=\"ViewOrganization-Narratives-toolbar-searchCol\">\n                        {this.renderSearchBar()}\n                    </div>\n                    <div className=\"ViewOrganization-Narratives-toolbar-sortCol\">\n                        {this.renderSortBar()}\n                    </div>\n                </div>\n                <div className=\"ViewOrganization-Narratives-narrativesList\">\n                    <div className=\"ViewOrganization-Narratives-narrativesTable\">\n                        {narrativesTable}\n                    </div>\n                </div>\n            </div >\n        )\n    }\n\n    renderNonMemberNarratives() {\n        let alert\n        const narrativesToShow = this.props.organization.narratives.length\n        const hiddenNarrativeCount = this.props.organization.narrativeCount - this.props.organization.narratives.length\n        const alertStyle = {\n            marginBottom: '10px'\n        }\n        if (narrativesToShow) {\n            if (hiddenNarrativeCount) {\n                const message = (\n                    <React.Fragment>\n                        <p>Since you are not a member of this Organization, only public Narratives are displayed.</p>\n                        <p>{hiddenNarrativeCount} private Narrative{hiddenNarrativeCount !== 1 ? 's have ' : ' has '} been hidden.</p>\n                    </React.Fragment>\n                )\n                alert = (\n                    <Alert type=\"info\" message={message} style={alertStyle} />\n                )\n            }\n        } else {\n            if (hiddenNarrativeCount) {\n                const message = (\n                    <React.Fragment>\n                        <p>Since you are not a member of this Organization, only public Narratives would be displayed, but this Organization has none.</p>\n                        <p>{hiddenNarrativeCount} private Narrative{hiddenNarrativeCount !== 1 ? 's have ' : ' has '} been hidden.</p>\n                    </React.Fragment>\n                )\n                alert = (\n                    <Alert type=\"info\" message={message} style={alertStyle} />\n                )\n            } else {\n                alert = (\n                    <Alert type=\"info\" message=\"No Narratives are yet associated with this Organization\" style={alertStyle} />\n                )\n            }\n        }\n\n        let narrativesTable\n        if (narrativesToShow) {\n            narrativesTable = this.props.narratives.map((narrative) => {\n                // create buttons or not, depending on being an admin\n                return (\n                    <div className=\"ViewOrganization-Narratives-narrative simpleCard\" key={String(narrative.workspaceId)}>\n                        <div className=\"ViewOrganization-Narratives-dataCol\">\n                            <OrganizationNarrative\n                                narrative={narrative}\n                                organization={this.props.organization}\n                                onGetViewAccess={this.props.onGetViewAccess} />\n                        </div>\n                        <div className=\"ViewOrganization-Narratives-buttonCol\">\n                            {this.renderNarrativeMenu(narrative)}\n                        </div>\n                    </div>\n                )\n            })\n        }\n\n        // const narrativeCount = this.props.narratives.length\n        const title = (\n            <span className=\"ViewOrganization-Narratives-title\">\n                <Icon type=\"folder-open\" style={{ marginRight: '8px' }} />\n                Narratives\n                {' '}\n                <span className=\"ViewOrganization-Narratives-titleCount\">({this.props.organization.narrativeCount})</span>\n            </span>\n        )\n        return (\n            <div className=\"ViewOrganization-Narratives scrollable-flex-column\">\n                <div className=\"ViewOrganization-Narratives-header\">\n                    <div className=\"ViewOrganization-Narratives-headerCol1\">\n                        {title}\n                    </div>\n                    <div className=\"ViewOrganization-Narratives-headerCol2\">\n                    </div>\n                </div>\n                <div className=\"ViewOrganization-Narratives-toolbar\">\n                    <div className=\"ViewOrganization-Narratives-toolbar-searchCol\">\n                        {this.renderSearchBar()}\n                    </div>\n                    <div className=\"ViewOrganization-Narratives-toolbar-sortCol\">\n                        {this.renderSortBar()}\n                    </div>\n                </div>\n                <div className=\"ViewOrganization-Narratives-narrativesList\">\n                    <div className=\"ViewOrganization-Narratives-table\">\n                        {alert}\n                        {narrativesTable}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        if (this.props.organization.isMember) {\n            return this.renderMemberNarratives()\n        } else {\n            return this.renderNonMemberNarratives()\n        }\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport * as orgModel from '../../data/models/organization/model'\nimport { StoreState, SyncState, ValidationErrorType } from '../../types'\nimport { AnError, makeError } from '../../lib/error'\nimport Validation from '../../data/models/organization/validation';\nimport { ActionFlag } from '.';\n\n// Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n    error: AnError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UNLOAD\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, editableMemberProfile: orgModel.EditableMemberProfile): LoadSuccess {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n        organization: organization,\n        editableMemberProfile: editableMemberProfile\n    }\n}\n\nexport function loadError(error: AnError): LoadError {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload() {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_UNLOAD\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        // TODO: here is where we would hook into the store state entities for groups\n        try {\n            const org = await orgClient.getOrg(organizationId)\n            if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                dispatch(loadError(makeError({\n                    code: 'invalid state',\n                    message: 'Organization must be of kind \"NORMAL\"'\n                })))\n                return\n            }\n\n            if (!org.isMember) {\n                dispatch(loadError(makeError({\n                    code: 'notfound',\n                    message: 'The user \"' + username + '\" is not a member of this org'\n                })))\n                return\n            }\n\n            let thisMember = org.members.find((member) => {\n                return member.username === username\n            })\n\n            if (!thisMember) {\n                if (org.owner.username === username) {\n                    thisMember = org.owner\n                }\n            }\n\n            if (!thisMember) {\n                dispatch(loadError(makeError({\n                    code: 'notfound',\n                    message: 'The user \"' + username + '\" was not found in the members list'\n                })))\n                return\n            }\n\n            const editableProfile: orgModel.EditableMemberProfile = {\n                title: {\n                    value: thisMember.title || '',\n                    remoteValue: thisMember.title,\n                    syncState: SyncState.NEW,\n                    validationState: {\n                        type: ValidationErrorType.OK,\n                        validatedAt: new Date()\n                    }\n                }\n            }\n            dispatch(loadSuccess(org, editableProfile))\n            // dispatch(evaluate())\n        } catch (ex) {\n            console.error('Error :(', ex)\n            dispatch(loadError(makeError({\n                code: ex.name,\n                message: ex.message\n            })))\n        }\n    }\n}\n\n// Leaving the Org\n\nexport interface LeaveOrg extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG\n    organizationId: orgModel.OrganizationID\n}\n\ninterface LeaveOrgSuccess extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS\n}\n\ninterface LeaveOrgError extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,\n    error: AnError\n}\n\nexport function leaveOrg(organizationId: orgModel.OrganizationID) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(({\n            type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_START\n        }))\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            orgClient.removeMember(organizationId, username)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS\n            })\n        } catch (ex) {\n            console.error('ERROR leaving org', ex)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,\n                error: {\n                    code: ex.name,\n                    message: ex.message\n                }\n            })\n        }\n\n\n    }\n}\n\n\n// Updating Profile\n\nexport interface UpdateTitle {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE,\n    title: string\n}\n\nexport interface UpdateTitleStart {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_START\n}\n\nexport interface UpdateTitleSuccess {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,\n    title: string\n}\n\nexport interface UpdateTitleError {\n    type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,\n    error: AnError\n}\n\nexport interface Save {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE,\n    memberProfile: orgModel.EditableMemberProfile\n}\n\nexport interface SaveStart {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_START\n}\n\nexport interface SaveSuccess {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS\n}\n\nexport interface SaveError {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR,\n    error: AnError\n}\n\nexport function updateTitle(title: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedTitle, error] = Validation.validateMemberTitle(title)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,\n                error: makeError({\n                    code: 'invalid',\n                    message: error.message\n                })\n            })\n        } else {\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,\n                title: validatedTitle\n            })\n        }\n        dispatch(evaluate())\n    }\n}\n\nexport interface Evaluate extends Action<ActionFlag.MANAGE_MEMBERSHIP_EVALUATE> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE\n}\n\nexport interface EvaluateSuccess extends Action<ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS,\n}\n\nexport interface EvaluateError extends Action<ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR\n}\n\nexport function evaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.manageMembershipView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            views: {\n                manageMembershipView: {\n                    viewModel: {\n                        editableMemberProfile\n                    }\n                }\n            }\n        } = state\n\n        if (editableMemberProfile.title.validationState.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_ERROR\n            })\n            return\n        }\n\n        dispatch({\n            type: ActionFlag.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS\n        })\n    }\n}\n\nexport interface Save extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE\n}\n\nexport interface SaveStart extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE_START> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_START\n}\n\nexport interface SaveSuccess extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS\n}\n\nexport interface SaveError extends Action<ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR> {\n    type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR\n}\n\nexport function save() {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_START\n        })\n\n        const state = getState()\n        if (!state.views.manageMembershipView.viewModel) {\n            throw new Error('Argh, no view model?!?')\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                manageMembershipView: {\n                    viewModel: { organization, editableMemberProfile }\n                }\n            },\n            app: { config }\n        } = state\n\n        const update = {\n            title: editableMemberProfile.title.value\n        }\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            await orgClient.updateMember(organization.id, username, update)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_SUCCESS\n            })\n        } catch (ex) {\n            console.error('error saving member profile', ex)\n            dispatch({\n                type: ActionFlag.MANAGE_MEMBERSHIP_SAVE_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n        dispatch(evaluate())\n    }\n}\n","import * as React from 'react'\nimport { Button, Modal, Input } from 'antd';\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport * as userModel from '../../../../../data/models/user'\nimport {\n    Editable, ValidationErrorType, SyncState, EditState,\n    SaveState, ValidationState\n} from '../../../../../types'\nimport MainMenu from '../../../../menu/component'\nimport './component.css'\n\nexport interface ManageMembershipProps {\n    username: userModel.Username\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    onLeaveOrganization: (organizationId: string) => void\n    onUpdateTitle: (title: string) => void\n    onSave: () => void\n    onFinish: () => void\n}\n\ninterface MangeMembershipState {\n}\n\nclass ManageMembership extends React.Component<ManageMembershipProps, MangeMembershipState> {\n    constructor(props: ManageMembershipProps) {\n        super(props)\n    }\n\n    doLeaveOrg() {\n        // alert('this will leave you the org')\n        // this.props.onLeaveOrganization(this.props.organization.id)\n        const confirmed = (() => {\n            this.doLeaveOrgConfirmed()\n        }).bind(this)\n        Modal.confirm({\n            title: 'Really leave this organization?',\n            content: (\n                <p>\n                    This is not reversible.\n                </p>\n            ),\n            width: '50em',\n            onOk: () => {\n                confirmed()\n            }\n        })\n    }\n\n    onDone() {\n        this.props.onFinish()\n    }\n\n    doLeaveOrgConfirmed() {\n        // alert('this will leave you the org')\n        this.props.onLeaveOrganization(this.props.organization.id)\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState.type === ValidationErrorType.OK &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.props.onSave()\n    }\n\n    onTitleChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateTitle(e.target.value)\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    calcFieldClass(field: Editable) {\n        switch (field.validationState.type) {\n            // case (ValidationErrorType.OK):\n            //     return 'validation-ok'\n            case (ValidationErrorType.ERROR):\n                return 'ManageMembership-validation-error'\n            case (ValidationErrorType.REQUIRED_MISSING):\n                return 'ManageMembership-validation-error'\n        }\n\n        switch (field.syncState) {\n            case (SyncState.DIRTY):\n                return 'ManageMembership-sync-dirty'\n            default:\n                return 'ManageMembership-validation-ok'\n        }\n    }\n\n    renderEditor() {\n        return (\n            <form id=\"editMembership\"\n                className=\"ManageMembership-editorTable\"\n                onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"ManageMembership-headerRow\">\n                    <div className=\"ManageMembership-editCol ManageMembership-headerCol\">\n                        Edit\n                    </div>\n                    <div className=\"ManageMembership-editCol ManageMembership-headerCol\">\n                        Preview\n                    </div>\n                </div>\n                <div className=\"ManageMembership-editorTable-row\">\n                    <div className=\"ManageMembership-editCol ManageMembership-editCell\">\n                        <div className=\"ManageMembership-editorTable-labelCol\">\n                            <span className=\"field-label ManageMembership-titleLabel\">\n                                title\n                            </span>\n                        </div>\n                        <div className=\"ManageMembership-editorTable-controlCol\">\n                            <Input value={this.props.editableMemberProfile.title.value || ''}\n                                className={this.calcFieldClass(this.props.editableMemberProfile.title)}\n                                onChange={this.onTitleChange.bind(this)} />\n                        </div>\n                    </div>\n                    <div className=\"ManageMembership-previewCol ManageMembership-previewCell\">\n                        <div className=\"ManageMembership-titlePreview\">\n                            {this.props.editableMemberProfile.title.value}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"ManageMembership-editorFooter\">\n                    <Button icon=\"save\"\n                        form=\"editMembership\"\n                        key=\"submit\"\n                        disabled={!this.canSave.call(this)}\n                        htmlType=\"submit\">\n                        Save\n                </Button>\n                </div>\n            </form>\n        )\n    }\n\n    renderMenuButtons() {\n        return (\n            <div className=\"ButtonSet\">\n                <div className=\"ButtonSet-button\">\n                    <Button icon=\"rollback\"\n                        type=\"danger\"\n                        onClick={this.onDone.bind(this)}>\n                        Done\n                    </Button>\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"ManageMembership scrollable-flex-column\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                <h3>\n                    Edit Your Membership Profile\n                </h3>\n\n                <div className=\"ManageMembership-body\">\n                    {this.renderEditor()}\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default ManageMembership","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../../../redux/actions/manageMembership'\n\nimport { StoreState, EditState, SaveState, ValidationState } from '../../../../../types';\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport * as userModel from '../../../../../data/models/user'\n\nimport Component from './component'\n\nexport interface OwnProps {\n    onFinish: () => void\n}\n\ninterface StateProps {\n    username: userModel.Username\n    organization: orgModel.Organization\n    editableMemberProfile: orgModel.EditableMemberProfile\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n}\n\ninterface DispatchProps {\n    onLeaveOrganization: (organizationId: string) => void,\n    onUpdateTitle: (title: string) => void\n    onSave: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    if (!state.views.manageMembershipView.viewModel) {\n        throw new Error('View model missing')\n    }\n    const {\n        auth: { authorization: { username } },\n        views: {\n            manageMembershipView: {\n                viewModel: { organization, editableMemberProfile, editState, saveState, validationState }\n            }\n        }\n    } = state\n    return {\n        username, organization, editableMemberProfile,\n        editState, saveState, validationState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLeaveOrganization: (organizationId: string) => {\n            dispatch(actions.leaveOrg(organizationId) as any)\n        },\n        onUpdateTitle: (title: string) => {\n            dispatch(actions.updateTitle(title) as any)\n        },\n        onSave: () => {\n            dispatch(actions.save() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\nimport { Alert, Collapse } from 'antd';\nimport './component.css'\nimport { AnError } from './api';\n\nexport interface ErrorProps {\n    error: AnError\n}\n\ninterface ErrorState {\n\n}\n\nexport default class Error extends React.Component<ErrorProps, ErrorState> {\n    constructor(props: ErrorProps) {\n        super(props)\n    }\n\n    renderDetail() {\n        return (\n            <table className='errorTable'>\n                <tbody>\n                    <tr>\n                        <th>\n                            <span className=\"field-label\">generated at</span>\n                        </th>\n                        <td>\n                            {\n                                Intl.DateTimeFormat('en-US', {\n                                    month: 'short',\n                                    day: 'numeric',\n                                    year: 'numeric'\n                                }).format(this.props.error.at)\n                            }\n                        </td>\n                    </tr>\n                    <tr>\n                        <th>\n                            <span className=\"field-label\">error id</span>\n                        </th>\n                        <td>\n                            <span style={{ fontFamily: 'monospace' }}>{this.props.error.id}</span>\n                        </td>\n                    </tr>\n                    <tr>\n                        <th>\n                            <span className=\"field-label\">explanation</span>\n                        </th>\n                        <td>\n                            {this.props.error.detail}\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        )\n    }\n\n    renderInfo() {\n        if (!this.props.error.info) {\n            return (\n                <div style={{ textAlign: 'left', fontStyle: 'italic' }}>\n                    No additional information\n                </div>\n            )\n        }\n        return (\n            <div>\n                additional info here ...\n            </div>\n        )\n    }\n\n    render() {\n        const description = (\n            <div>\n                <p>\n                    {this.props.error.message}\n                </p>\n                <Collapse bordered={false} style={{ backgroundColor: 'transparent' }}>\n                    <Collapse.Panel header=\"detail\" key=\"1\" style={{ backgroundColor: 'transparent' }}>\n                        {this.renderDetail()}\n                    </Collapse.Panel>\n                </Collapse>\n                <Collapse bordered={false} style={{ backgroundColor: 'transparent' }}>\n                    <Collapse.Panel header=\"additional info\" key=\"1\" style={{ backgroundColor: 'transparent' }}>\n                        {this.renderInfo()}\n                    </Collapse.Panel>\n                </Collapse>\n            </div>\n        )\n\n        return (\n            <Alert\n                type=\"error\"\n                showIcon\n                message=\"Error\"\n                className=\"Error\"\n                description={description}\n            />\n        )\n    }\n}","import * as React from 'react'\nimport { ManageMembershipView, ComponentLoadingState, StoreState } from '../../../../../types'\nimport Container from './container'\nimport Error from '../../../../../combo/error/component'\n\nexport interface Props {\n    organizationId: string\n    view: ManageMembershipView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n    onFinish: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        const message = (\n            <div>\n                Loading ...\n                {' '}\n                <Spin />\n            </div>\n        )\n        return (\n            <Alert type=\"info\" message={message} style={{\n                width: '20em',\n                padding: '20px',\n                margin: '20px auto'\n            }} />\n        )\n    }\n\n    renderError(error: AnError) {\n        return (\n            <Error error={error} />\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError(makeError({\n                        code: 'missing-error',\n                        message: 'The error appears to be missing'\n                    }))\n                }\n            default:\n                return (\n                    <Container onFinish={this.props.onFinish} />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../../../../redux/actions/manageMembership'\nimport { AnError, makeError } from '../../../../../combo/error/api'\nimport { Spin, Alert } from 'antd';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: ManageMembershipView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.manageMembershipView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, AppError, EditableOrganization, ValidationState, EditState, ValidationErrorType, SyncState } from '../../types'\nimport Validation from '../../data/models/organization/validation'\nimport * as orgModel from '../../data/models/organization/model'\n\n// ACTIONS\n\n// Loading the editor\nexport interface Load extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD,\n    organizationId: string\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_LOAD_SUCCESS,\n    editedOrganization: EditableOrganization,\n    organization: orgModel.Organization\n}\n\nexport interface LoadError extends Action<ActionFlag.EDIT_ORG_LOAD_ERROR> {\n    type: ActionFlag.EDIT_ORG_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action<ActionFlag.EDIT_ORG_UNLOAD> {\n    type: ActionFlag.EDIT_ORG_UNLOAD\n}\n\n// Evaluating state of form \n\nexport interface EditOrgEvaluate extends Action<ActionFlag.EDIT_ORG_EVALUATE> {\n    type: ActionFlag.EDIT_ORG_EVALUATE\n}\n\nexport interface EditOrgEvaluateOK extends Action<ActionFlag.EDIT_ORG_EVALUATE_OK> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_OK\n}\n\nexport interface EditOrgEvaluateErrors extends Action<ActionFlag.EDIT_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n}\n\n// Saving\n\nexport interface EditOrgSave extends Action<ActionFlag.EDIT_ORG_SAVE> {\n    type: ActionFlag.EDIT_ORG_SAVE\n}\n\nexport interface EditOrgSaveStart extends Action<ActionFlag.EDIT_ORG_SAVE_START> {\n    type: ActionFlag.EDIT_ORG_SAVE_START\n}\n\nexport interface EditOrgSaveSuccess extends Action<ActionFlag.EDIT_ORG_SAVE_SUCCESS> {\n    type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n}\n\nexport interface EditOrgSaveError extends Action<ActionFlag.EDIT_ORG_SAVE_ERROR> {\n    type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Updating name field\n\nexport interface EditOrgUpdateName extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface EditOrgUpdateNameSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface EditOrgUpdateNameError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: ValidationState\n}\n\n// Updating logo url field\n\nexport interface EditOrgUpdateLogoUrl extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL,\n    name: string | null\n}\n\nexport interface EditOrgUpdateLogoUrlSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,\n    logoUrl: string | null\n}\n\nexport interface EditOrgUpdateLogoUrlError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_ERROR,\n    logoUrl: string | null,\n    error: ValidationState\n}\n\n// Updating home url field\nexport interface UpdateHomeUrl extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_SUCCESS\n    homeUrl: string | null\n}\n\nexport interface UpdateHomeUrlError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_ERROR\n    homeUrl: string | null\n    error: ValidationState\n}\n\n// Updating research interests field\nexport interface UpdateResearchInterests extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS\n    researchInterests: string\n}\n\nexport interface UpdateResearchInterestsError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR\n    researchInterests: string\n    error: ValidationState\n}\n\n// Updating description field\n\nexport interface EditOrgUpdateDescription extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: ValidationState\n}\n\nexport interface UpdateIsPrivate extends Action<ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE> {\n    type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateSuccess extends Action<ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS> {\n    type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n    isPrivate: boolean\n}\n\nexport interface UpdateIsPrivateError extends Action<ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR> {\n    type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR,\n    error: ValidationState\n}\n\n\n// ACTION CREATORS\n\n// export function editOrgStart(id: string): LoadStart {\n//     return {\n//         type: ActionFlag.EDIT_ORG_LOAD_START,\n//         id: id\n//     }\n// }\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_START\n    }\n}\n\nexport function loadSuccess(editedOrganization: EditableOrganization, organization: orgModel.Organization): LoadSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_SUCCESS,\n        editedOrganization: editedOrganization,\n        organization: organization\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.EDIT_ORG_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.EDIT_ORG_UNLOAD\n    }\n}\n\n// Evaluate\n\nexport function editOrgEvaluateOk(): EditOrgEvaluateOK {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_OK\n    }\n}\n\nexport function editOrgEvaluateErrors(): EditOrgEvaluateErrors {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Save\n\n// export function editOrgSave(): EditOrgSave {\n//     return {\n//         type: ActionFlag.EDIT_ORG_SAVE\n//     }\n// }\n\nexport function editOrgSaveStart(): EditOrgSaveStart {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_START\n    }\n}\n\nexport function editOrgSaveSuccess(): EditOrgSaveSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n    }\n}\n\nexport function editOrgSaveError(error: AppError): EditOrgSaveError {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n// Update Name\n\nexport function editOrgUpdateNameSuccess(name: string): EditOrgUpdateNameSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function editOrgUpdateNameError(name: string, error: ValidationState): EditOrgUpdateNameError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\n// export function editOrgUpdateIdSuccess(id: string): EditOrgUpdateIdSuccess {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS,\n//         id: id\n//     }\n// }\n\n// Update Logo Url\n\nexport function editOrgUpdateLogoUrlSuccess(logoUrl: string | null): EditOrgUpdateLogoUrlSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,\n        logoUrl: logoUrl\n    }\n}\n\nexport function editOrgUpdateLogoUrlError(logoUrl: string | null, error: ValidationState): EditOrgUpdateLogoUrlError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_LOGO_URL_ERROR,\n        logoUrl: logoUrl,\n        error: error\n    }\n}\n\n\n// Update Id\n\n// export function editOrgUpdateIdError(id: string, error: UIError): EditOrgUpdateIdError {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_ERROR,\n//         id: id,\n//         error: error\n//     }\n// }\n\nexport function editOrgUpdateDescriptionSuccess(description: string): EditOrgUpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function editOrgUpdateDescriptionError(description: string, error: ValidationState): EditOrgUpdateDescriptionError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function load(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        // const model = new Model({\n        //     token, username,\n        //     groupsServiceURL: config.services.Groups.url,\n        //     userProfileServiceURL: config.services.UserProfile.url,\n        //     workspaceServiceURL: config.services.Workspace.url,\n        //     serviceWizardURL: config.services.ServiceWizard.url\n        // })\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        return orgClient.getOrg(organizationId)\n            .then((org) => {\n                if (org.kind !== orgModel.OrganizationKind.NORMAL) {\n                    throw new Error('May not edit an inaccessible private org!')\n                }\n                const editableOrg: EditableOrganization = {\n                    id: {\n                        value: org.id,\n                        remoteValue: org.id,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgId(org.id)[1]\n                    },\n                    name: {\n                        value: org.name,\n                        remoteValue: org.name,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgName(org.name)[1]\n                    },\n                    logoUrl: {\n                        value: org.logoUrl,\n                        remoteValue: org.logoUrl,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgLogoUrl(org.logoUrl)[1]\n                    },\n                    homeUrl: {\n                        value: org.homeUrl,\n                        remoteValue: org.homeUrl,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgHomeUrl(org.homeUrl)[1]\n                    },\n                    researchInterests: {\n                        value: org.researchInterests,\n                        remoteValue: org.researchInterests,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgResearchInterests(org.researchInterests)[1]\n                    },\n                    description: {\n                        value: org.description,\n                        remoteValue: org.description,\n                        syncState: SyncState.NEW,\n                        validationState: Validation.validateOrgDescription(org.description)[1]\n                    },\n                    isPrivate: {\n                        value: org.isPrivate,\n                        remoteValue: org.isPrivate,\n                        syncState: SyncState.NEW,\n                        validationState: {\n                            type: ValidationErrorType.OK,\n                            validatedAt: new Date()\n                        }\n                    }\n                }\n                dispatch(loadSuccess(editableOrg, org))\n            })\n            .catch((err) => {\n                console.error('load org error', err)\n                dispatch(loadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function editOrgSave() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(editOrgSaveStart())\n\n        const state = getState()\n        if (!state.views.editOrgView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            views: {\n                editOrgView: {\n                    viewModel: { organization, editedOrganization }\n                }\n            },\n            app: { config } } = state\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        if (!editedOrganization) {\n            dispatch(editOrgSaveError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        const update = {\n            name: editedOrganization.name.value,\n            logoUrl: editedOrganization.logoUrl.value,\n            description: editedOrganization.description.value,\n            isPrivate: editedOrganization.isPrivate.value,\n            homeUrl: editedOrganization.homeUrl.value,\n            researchInterests: editedOrganization.researchInterests.value\n        }\n\n        orgClient.updateOrg(organization.id, update)\n            .then(() => {\n                dispatch(editOrgSaveSuccess())\n            })\n            .catch((error) => {\n                console.error('error adding', editedOrganization, error)\n                dispatch(editOrgSaveError({\n                    code: 'invalid',\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function editOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const state = getState()\n        if (!state.views.editOrgView.viewModel) {\n            throw new Error('Argh, no view model')\n        }\n\n        const {\n            views: {\n                editOrgView: {\n                    viewModel: {\n                        editedOrganization\n                    }\n                }\n            }\n        } = state\n\n        if (!editedOrganization) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.name.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.logoUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.homeUrl.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.researchInterests.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        if (editedOrganization.description.validationState.type !== ValidationErrorType.OK) {\n            dispatch(editOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(editOrgEvaluateOk())\n    }\n}\n\nexport function updateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(editOrgUpdateNameError(validatedName, error))\n        } else {\n            dispatch(editOrgUpdateNameSuccess(validatedName))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateLogoUrl(logoUrl: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedLogoUrl, error] = Validation.validateOrgLogoUrl(logoUrl)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(editOrgUpdateLogoUrlError(validatedLogoUrl, error))\n        } else {\n            dispatch(editOrgUpdateLogoUrlSuccess(validatedLogoUrl))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateHomeUrl(homeUrl: string | null) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedHomeUrl, error] = Validation.validateOrgHomeUrl(homeUrl)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_ERROR,\n                homeUrl: validatedHomeUrl,\n                error: error\n            } as UpdateHomeUrlError)\n        } else {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,\n                homeUrl: validatedHomeUrl\n            } as UpdateHomeUrlSuccess)\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateResearchInterests(researchInterests: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedResearchInterests, error] = Validation.validateOrgResearchInterests(researchInterests)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,\n                researchInterests: validatedResearchInterests,\n                error: error\n            } as UpdateResearchInterestsError)\n        } else {\n            dispatch({\n                type: ActionFlag.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,\n                researchInterests: validatedResearchInterests\n            } as UpdateResearchInterestsSuccess)\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>,\n        getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const [validatedDescription, error] = Validation.validateOrgDescription(description)\n\n        if (error.type !== ValidationErrorType.OK) {\n            dispatch(editOrgUpdateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(editOrgUpdateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function updateIsPrivate(isPrivate: boolean) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        // No validation for now.\n        dispatch({\n            type: ActionFlag.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,\n            isPrivate: isPrivate\n        })\n        dispatch(editOrgEvaluate())\n    }\n} ","import * as React from 'react'\nimport { Redirect } from 'react-router-dom';\nimport { Marked } from 'marked-ts';\nimport { Button, Icon, Modal, Checkbox, Input, Tooltip, Table, Collapse } from 'antd';\nimport md5 from 'md5'\nimport {\n    EditableOrganization, SaveState, ValidationState,\n    EditState, ValidationErrorType, Editable, SyncState\n} from '../../../../../types';\nimport './component.css'\n\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport { CheckboxChangeEvent } from 'antd/lib/checkbox';\nimport TextArea from 'antd/lib/input/TextArea';\nimport MainMenu from '../../../../menu/component';\n\nexport interface EditOrganizationProps {\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    editedOrganization: EditableOrganization\n    organization: orgModel.Organization\n    onEditOrgSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateLogoUrl: (logoUrl: string) => void\n    onUpdateHomeUrl: (homeUrl: string) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n    onFinish: () => void\n}\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    VIEWER\n}\n\nexport interface EditOrganizationState {\n    cancelToBrowser: boolean;\n    cancelToViewer: boolean;\n    navigateTo: NavigateTo;\n}\n\nclass EditOrganization extends React.Component<EditOrganizationProps, EditOrganizationState> {\n\n    origin: string;\n\n    constructor(props: EditOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false,\n            navigateTo: NavigateTo.NONE\n        }\n\n        this.origin = document.location!.origin\n    }\n\n    onFinish() {\n        this.props.onFinish()\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Organization Editor Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations editor...</p>\n                </div>\n            )\n        })\n    }\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onClickCancelToViewer() {\n        if (!this.isModified()) {\n            this.setState({ cancelToViewer: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToViewer: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.props.onEditOrgSave()\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateName(e.target.value)\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value)\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        console.warn('no updating id, naughty!')\n    }\n\n    onIsPrivateChange(e: CheckboxChangeEvent) {\n        this.props.onUpdateIsPrivate(e.target.checked)\n    }\n\n    onLogoUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateLogoUrl(e.target.value)\n    }\n\n    onHomeUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist()\n        this.props.onUpdateHomeUrl(e.target.value)\n    }\n\n    onResearchInterestsChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateResearchInterests(e.target.value)\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState.type === ValidationErrorType.OK &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY)\n        )\n    }\n\n    calcFieldClass(field: Editable) {\n        switch (field.validationState.type) {\n            // case (ValidationErrorType.OK):\n            //     return 'validation-ok'\n            case (ValidationErrorType.ERROR):\n                return 'validation-error Lite'\n            case (ValidationErrorType.REQUIRED_MISSING):\n                return 'validation-error Lite'\n        }\n\n        switch (field.syncState) {\n            case (SyncState.DIRTY):\n                return 'sync-dirty Lite'\n            default:\n                return 'validation-ok Lite'\n        }\n    }\n\n    renderFieldError(field: Editable) {\n        if (field.validationState.type !== ValidationErrorType.OK) {\n            if (field.syncState === SyncState.DIRTY) {\n                return (\n                    <span style={{ color: 'red' }}>\n                        {field.validationState.message}\n                    </span>\n                )\n            }\n        } else {\n            return ''\n        }\n    }\n\n    renderNameRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    This is the name for your organization as you want KBase users to see it; you may change it at any time.\n                </p>\n                <p>\n                    It may be composed of ordinary text, but does not accept formatting.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1024 characters\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = 'Your Organization\\'s display name'\n        return (\n            <div className=\"EditOrganization-row\">\n                <div className=\"EditOrganization-col1\">\n                    <div className=\"EditOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Name\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col2\">\n                    <div className=\"EditOrganization-formControl\">\n                        <Input value={this.props.editedOrganization.name.value || ''}\n                            className={this.calcFieldClass(this.props.editedOrganization.name)}\n                            placeholder={placeholder}\n                            autoFocus\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.renderFieldError(this.props.editedOrganization.name)}\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col3\">\n                    <div className=\"EditOrganization-preview-name\">\n                        {this.props.editedOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderIDRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each Organization has a unique identifier. The ID is set when the organization is created, and are permanent: It may never be changed.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                100 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                a to z, 0 to 9, -\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = \"A unique ID for your Organization\"\n        return (\n            <div className=\"EditOrganization-row\">\n                <div className=\"EditOrganization-col1\">\n                    <div className=\"EditOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            ID\n                            </Tooltip>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col2\">\n                    <div className=\"EditOrganization-formControl\">\n                        <Input value={this.props.editedOrganization.id.value || ''}\n                            className={this.calcFieldClass(this.props.editedOrganization.id)}\n                            placeholder={placeholder}\n                            onChange={this.onIdChange.bind(this)} />\n                        {this.renderFieldError(this.props.editedOrganization.id)}\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col3\">\n                    <div className=\"EditOrganization-preview-id\">\n                        <span style={{ color: 'silver' }}>{this.origin}/#org/</span>\n                        {this.props.editedOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderLogoURLRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each Organization will display a logo. You may specific your own logo by entering the URL for an image, or leave\n                    this field blank and a default logo will be displayed, using the first letter of your org name and a randomly\n                    generated color (based on your org id).\n                </p>\n                <p>\n                    Please don't use large images, and try to keep them roughly square. The logo image display will be constrained\n                    to no larger than 100 pixels wide. Non-square logos may not look good in the Orgs list or on your Org page.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                no\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1000 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                a full https:// url. E.g. https://my.org/myimage.png<br />\n                                note that only <i>https</i> urls are accepted.\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = \"The URL for your Organization's logo (optional)\"\n        return (\n            <div className=\"EditOrganization-row\">\n                <div className=\"EditOrganization-col1\">\n                    <div className=\"EditOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Logo URL\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col2\">\n                    <div className=\"EditOrganization-formControl\">\n                        <Input value={this.props.editedOrganization.logoUrl.value || ''}\n                            className={this.calcFieldClass(this.props.editedOrganization.logoUrl)}\n                            placeholder={placeholder}\n                            onChange={this.onLogoUrlChange.bind(this)} />\n                        {this.renderFieldError(this.props.editedOrganization.logoUrl)}\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col3\">\n                    <div className=\"EditOrganization-preview-logo\">\n                        {this.renderLogoPreview()}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderHomeURLRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each Organization may display a home page url. This should be considered the canonical home for your Organization, if\n                    it also exists outside of KBase.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                no\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1000 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                a full url. E.g. http://my.org/myimage.png<br />\n                                note that both <i>http></i> and <i>https</i> urls are accepted.\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = \"The URL for your Organization's home page (optional)\"\n        return (\n            <div className=\"EditOrganization-row\">\n                <div className=\"EditOrganization-col1\">\n                    <div className=\"EditOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Home Page URL\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col2\">\n                    <div className=\"EditOrganization-formControl\">\n                        <Input value={this.props.editedOrganization.homeUrl.value || ''}\n                            className={this.calcFieldClass(this.props.editedOrganization.homeUrl)}\n                            placeholder={placeholder}\n                            onChange={this.onHomeUrlChange.bind(this)} />\n                        {this.renderFieldError(this.props.editedOrganization.homeUrl)}\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col3\">\n                    <div className=\"EditOrganization-field-name\">\n                        <a href={this.props.editedOrganization.homeUrl.value || ''} target=\"_blank\">{this.props.editedOrganization.homeUrl.value || ''}</a>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderCollapse(content: JSX.Element) {\n        const style = {\n            background: 'transparent',\n            borderRadius: 0,\n            margin: 0,\n            border: 0,\n            overflow: 'hidden'\n        }\n        return (\n            <Collapse bordered={false}>\n                <Collapse.Panel header=\"What about inviting users?\" key=\"invite\" style={style}>\n                    {content}\n                </Collapse.Panel>\n            </Collapse>\n        )\n    }\n\n    renderPrivatePublicRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Set the Organization to \"hidden\" to prevent it from appearing in the listing and from being exposed\n                    as an Org page for any non-member.\n                </p>\n                <p>\n                    You may invite users directly to your org. When doing so they will receive a notification with a link to the\n                    org page. When a user lands on the org page they will not be shown information about the org, but will be available\n                    to accept the invitation and instantly have access to it.\n                </p>\n                <p>\n                    A user with an invitation who lands on the org page will not see information about the org, but will be able to\n                    submit a Join request.\n                </p>\n                {/* {this.renderCollapse((\n                    <React.Fragment>\n                        <p>\n                            You may invite users directly to your org. When doing so they will receive a notification with a link to the\n                            org page. When a user lands on the org page they will not be shown information about the org, but will be available\n                            to accept the invitation and instantly have access to it.\n                        </p>\n                        <p>\n                            A user with an invitation who lands on the org page will not see information about the org, but will be able to\n                            submit a Join request.\n                        </p>\n                    </React.Fragment>\n                ))} */}\n\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                no\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        return (\n            <div className=\"EditOrganization-row\">\n                <div className=\"EditOrganization-col1\">\n                    <div className=\"EditOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Hidden?\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col2\">\n                    <div className=\"EditOrganization-formControl\">\n                        <Checkbox\n                            checked={this.props.editedOrganization.isPrivate.value}\n                            className={this.calcFieldClass(this.props.editedOrganization.isPrivate)}\n                            onChange={this.onIsPrivateChange.bind(this)} />\n                        {this.renderFieldError(this.props.editedOrganization.isPrivate)}\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col3\">\n                    <div className=\"EditOrganization-preview-isPrivate\">\n                        {this.renderIsPrivate(this.props.editedOrganization.isPrivate.value)}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderResearchInterestsRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each organization must have a short description of research interests or purpose.\n                </p>\n                <p>\n                    This text is displayed in the organizations list and the organization's page. It is most helpful\n                    in the list context to help users quickly scan the list.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                200 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                unformatted text\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = 'List your areas of interest. Systems biology, microbial ecology, plant genomics'\n        return (\n            <div className=\"EditOrganization-row\">\n                <div className=\"EditOrganization-col1\">\n                    <div className=\"EditOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Research Interests\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col2\">\n                    <div className=\"EditOrganization-formControl\">\n                        <TextArea value={this.props.editedOrganization.researchInterests.value || ''}\n                            className={this.calcFieldClass(this.props.editedOrganization.researchInterests) + ' EditOrganization-control-researchInterests'}\n                            autosize={{ minRows: 2, maxRows: 2 }}\n                            placeholder={placeholder}\n                            onChange={this.onResearchInterestsChange.bind(this)} />\n                        {this.renderFieldError(this.props.editedOrganization.researchInterests)}\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col3\">\n                    <div className=\"EditOrganization-preview-researchInterests\">\n                        {this.props.editedOrganization.researchInterests.value || ''}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderDescriptionRow() {\n        const tooltip = (\n            <React.Fragment>\n                <p>\n                    Each organization must have a description which communicates the purpose of this organization.\n                </p>\n                <p>\n                    The description is in <a href=\"https://daringfireball.net/projects/markdown/syntax\" target=\"_blank\">markdown</a> format\n                    and may be quite long. It will be presented in a scrolling area.\n                </p>\n                <p>\n                    Please be mindful of embedding large images or other content which may interfere with the display of your Organization.\n                </p>\n                <table>\n                    <tbody>\n                        <tr>\n                            <th>\n                                required\n                            </th>\n                            <td>\n                                yes\n                            </td>\n                        </tr>\n\n                        <tr>\n                            <th>\n                                max length\n                            </th>\n                            <td>\n                                1024 characters\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>\n                                allowed\n                            </th>\n                            <td>\n                                standard <a href=\"https://daringfireball.net/projects/markdown/syntax\" target=\"_blank\">markdown</a>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </React.Fragment>\n        )\n        const placeholder = 'Text or Markdown describing your Organization'\n        return (\n            <div className=\"EditOrganization-row\">\n                <div className=\"EditOrganization-col1\">\n                    <div className=\"EditOrganization-formLabel field-label\">\n                        <Tooltip title={tooltip}>\n                            Description\n                        </Tooltip>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col2\">\n                    <div className=\"EditOrganization-formControl\">\n                        <TextArea value={this.props.editedOrganization.description.value || ''}\n                            className={this.calcFieldClass(this.props.editedOrganization.description) + ' EditOrganization-control-description'}\n                            autosize={{ minRows: 5, maxRows: 15 }}\n                            placeholder={placeholder}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.renderFieldError(this.props.editedOrganization.description)}\n                    </div>\n                </div>\n                <div className=\"EditOrganization-col3\">\n                    <div className=\"EditOrganization-preview-description\"\n                        dangerouslySetInnerHTML={({ __html: Marked.parse(this.props.editedOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        )\n    }\n\n    renderSaveButton() {\n        return (\n            <Button icon=\"save\"\n                form=\"newOrganizationForm\"\n                key=\"submit\"\n                disabled={!this.canSave.call(this)}\n                htmlType=\"submit\">\n                Save\n            </Button>\n        )\n    }\n\n    renderCancelButton() {\n        return (\n            <Button icon=\"close\"\n                type=\"danger\"\n                onClick={this.onFinish.bind(this)}>\n                Cancel\n            </Button>\n        )\n    }\n\n    renderEditor() {\n        return (\n            <form id=\"editOrganizationForm\" className=\"EditOrganization-editor scrollable-flex-column\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"EditOrganization-row\">\n                    <div className=\"EditOrganization-col1\">\n                    </div>\n                    <div className=\"EditOrganization-col2\">\n                        <div style={{ flex: '1 1 0px' }}>\n                            <h3>Edit Your Organization</h3>\n                        </div>\n                    </div>\n                    <div className=\"EditOrganization-col3\">\n                        <h3>Preview</h3>\n                    </div>\n                </div>\n                <div className=\"EditOrganization-body\">\n                    {this.renderNameRow()}\n                    {this.renderIDRow()}\n                    {this.renderLogoURLRow()}\n                    {this.renderHomeURLRow()}\n                    {this.renderPrivatePublicRow()}\n                    {this.renderResearchInterestsRow()}\n                    {this.renderDescriptionRow()}\n                    <div className=\"EditOrganization-row\">\n                        <div className=\"EditOrganization-col1\">\n                        </div>\n                        <div className=\"EditOrganization-col2\" style={{ textAlign: 'center' }}>\n                            <div className=\"ButtonSet\">\n                                <span className=\"ButtonSet-button\">\n                                    {this.renderSaveButton()}\n                                </span>\n                                <span className=\"ButtonSet-button\">\n                                    {this.renderCancelButton()}\n                                </span>\n                            </div>\n                        </div>\n                        <div className=\"EditOrganization-col3\">\n                        </div>\n                    </div>\n                </div>\n            </form >\n        )\n    }\n\n    renderIsPrivate(isPrivate: boolean) {\n        if (isPrivate) {\n            return (\n                <span>\n                    <Icon type=\"lock\" />{' '}Hidden - will be visible <b>only</b> for members of this organization\n                </span>\n            )\n        }\n        return (\n            <span>\n                <Icon type=\"global\" />{' '}Visible - will be visible to all KBase users.\n            </span>\n        )\n    }\n\n    renderLogoPreview() {\n        if (!this.props.editedOrganization.logoUrl.value) {\n            return this.renderDefaultLogo()\n        }\n        return (\n            <img src={this.props.editedOrganization.logoUrl.value} width={60} />\n        )\n    }\n\n    charAt(inString: string, position: number) {\n        const c1 = inString.charCodeAt(position)\n        if (c1 >= 0xD800 && c1 <= 0xDBFF && inString.length > position + 1) {\n            const c2 = inString.charCodeAt(position + 1)\n            if (c2 > 0xDC00 && c2 <= 0xDFFF) {\n                return inString.substring(position, 2)\n            }\n        }\n        return inString.substring(position, 1)\n    }\n\n    renderDefaultLogo() {\n        if (!(this.props.editedOrganization.name.value && this.props.editedOrganization.id.value)) {\n            return (\n                <div>\n                    Default logo preview available when the Organization name and id are completed\n                </div>\n            )\n        }\n        const initial = this.charAt(this.props.editedOrganization.name.value, 0).toUpperCase()\n        const hash = md5(this.props.editedOrganization.id.value)\n        const size = 60;\n        const color = hash.substr(0, 6)\n        return (\n            <svg width={size} height={size} style={{ border: '1px rgba(200, 200, 200, 0.5) solid' }}>\n                <text x=\"50%\" y=\"50%\" dy={4} textAnchor=\"middle\" dominantBaseline=\"middle\" fontSize={size - 12} fill={'#' + color} fontFamily=\"sans-serif\">{initial}</text>\n            </svg>\n        )\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    renderMenuButtons() {\n        return (\n            <span className=\"ButtonSet\">\n                <span className=\"ButtonSet-button\">\n                    <Button icon=\"rollback\"\n                        type=\"danger\"\n                        onClick={this.onFinish.bind(this)}>\n                        Close\n                        </Button>\n                </span>\n                <span className=\"ButtonSet-button\">\n                    <Button icon=\"save\"\n                        form=\"editOrganizationForm\"\n                        key=\"submit\"\n                        disabled={!this.canSave.call(this)}\n                        htmlType=\"submit\">\n                        Save\n                    </Button>\n                </span>\n            </span>\n        )\n    }\n\n    render() {\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"EditOrganization\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                {this.renderEditor()}\n            </div>\n        )\n    }\n}\n\nexport default EditOrganization","import { Dispatch, Action } from 'redux';\nimport { connect } from 'react-redux';\nimport { StoreState, EditableOrganization, EditState, SaveState, ValidationState } from '../../../../../types';\nimport {\n    editOrgSave,\n    updateName,\n    updateDescription, updateLogoUrl, updateIsPrivate, updateHomeUrl, updateResearchInterests\n} from '../../../../../redux/actions/editOrg';\nimport EditOrganization from './component';\nimport * as orgModel from '../../../../../data/models/organization/model'\n\ninterface OwnProps {\n    onFinish: () => void\n}\n\nexport interface StateProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    editedOrganization: EditableOrganization,\n    organization: orgModel.Organization\n}\n\nexport interface DispatchProps {\n    onEditOrgSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateLogoUrl: (gravatarHash: string | null) => void\n    // onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n    onUpdateIsPrivate: (isPrivate: boolean) => void\n    onUpdateHomeUrl: (homeUrl: string | null) => void\n    onUpdateResearchInterests: (researchInterests: string) => void\n}\n\nexport function mapStateToProps(state: StoreState): StateProps {\n    if (!state.views.editOrgView.viewModel) {\n        throw new Error('What, no view model??')\n    }\n    const {\n        views: {\n            editOrgView: {\n                viewModel: { editState, saveState, validationState, editedOrganization, organization }\n            }\n        }\n    } = state\n\n    return {\n        editState,\n        saveState,\n        validationState,\n        editedOrganization,\n        organization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onEditOrgSave: () => {\n            dispatch(editOrgSave() as any)\n        },\n        onUpdateName: (name: string) => {\n            dispatch(updateName(name) as any)\n        },\n        onUpdateLogoUrl: (gravatarHash: string | null) => {\n            dispatch(updateLogoUrl(gravatarHash) as any)\n        },\n        // onUpdateId: (id) => {\n        //     dispatch(editOrgUpdateId(id) as any)\n        // },\n        onUpdateDescription: (description) => {\n            dispatch(updateDescription(description) as any)\n        },\n        onUpdateIsPrivate: (isPrivate: boolean) => {\n            dispatch(updateIsPrivate(isPrivate) as any)\n        },\n        onUpdateHomeUrl: (homeUrl: string | null) => {\n            dispatch(updateHomeUrl(homeUrl) as any)\n        },\n        onUpdateResearchInterests: (researchInterests: string) => {\n            dispatch(updateResearchInterests(researchInterests) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(EditOrganization)","import * as React from 'react'\nimport { ComponentLoadingState, StoreState, EditOrgView } from '../../../../../types'\nimport Container from './container'\nimport * as orgModel from '../../../../../data/models/organization/model'\n\n// First the loader component, which takes care of a loading view, error view, and the \n// container.\n\nexport interface LoaderProps {\n    organizationId: orgModel.OrganizationID\n    view: EditOrgView\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n    onUnload: () => void\n    onFinish: () => void\n}\n\ninterface LoaderState {\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        const message = (\n            <div>\n                Loading Editor...\n                {' '}\n                <Spin />\n            </div>\n        )\n        return (\n            <Alert type=\"info\" message={message} style={{\n                width: '20em',\n                padding: '20px',\n                margin: '20px auto'\n            }} />\n        )\n    }\n\n    renderError() {\n        if (!this.props.view.error) {\n            return\n        }\n        return (\n            <div>\n                Error! {this.props.view.error.message}\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container onFinish={this.props.onFinish} />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.loadingState) {\n            case ComponentLoadingState.NONE:\n                // should only appear briefly as the LOAD event is processed.\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n// THe redux connection\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../../../redux/actions/editOrg'\nimport { Alert, Spin } from 'antd';\n\nexport interface OwnProps {\n    organizationId: orgModel.OrganizationID\n}\n\ninterface StateProps {\n    view: EditOrgView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: orgModel.OrganizationID) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.editOrgView\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: (organizationId: orgModel.OrganizationID) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport { NarrativeState } from '../../../../../types';\nimport { Icon, Button, Alert, Select, Tooltip } from 'antd';\nimport './component.css'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport * as narrativeModel from '../../../../../data/models/narrative'\nimport MainMenu from '../../../../menu/component';\nimport { OrganizationNarrative, AccessibleNarrative } from '../../../../../data/models/narrative';\nimport NiceElapsedTime from '../../../../NiceElapsedTime';\n\nexport interface Props {\n    organization: orgModel.Organization\n    narratives: Array<OrganizationNarrative>\n    relation: orgModel.Relation\n    selectedNarrative: OrganizationNarrative | null\n    searching: boolean\n    sortBy: string\n    filter: string\n    doSortBy: (sortBy: narrativeModel.Sort) => void\n    doSendRequest: (groupId: string, workspaceId: number) => void\n    doSelectNarrative: (narrative: OrganizationNarrative) => void\n    onFinish: () => void\n}\n\ninterface State {\n}\n\nexport class RequestAddNarrative extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n\n        this.state = {\n        }\n    }\n\n    onFinish() {\n        this.props.onFinish()\n    }\n\n    doSelectNarrative(narrative: OrganizationNarrative) {\n        this.props.doSelectNarrative(narrative)\n    }\n\n    doSendRequest() {\n        if (this.props.selectedNarrative === null) {\n            console.warn('attempt to send request without selected narrative')\n            return\n        }\n        this.props.doSendRequest(this.props.organization.id, this.props.selectedNarrative.narrative.workspaceId)\n    }\n\n    canSendRequest() {\n        if (this.props.selectedNarrative) {\n            return true\n        }\n        return false\n    }\n\n    renderOrgName(name: string) {\n        const maxLength = 25\n        if (name.length < 25) {\n            return name\n        }\n        return (\n            <span>\n                {name.slice(0, 25)}\n                …\n            </span>\n        )\n    }\n\n    renderPermission(narrative: AccessibleNarrative) {\n        switch (narrative.access) {\n            case narrativeModel.NarrativeAccess.VIEW:\n                return (\n                    <span>\n                        <Icon type=\"eye\" /> View\n                    </span>\n                )\n            case narrativeModel.NarrativeAccess.EDIT:\n                return (\n                    <span>\n                        <Icon type=\"edit\" /> Edit\n                    </span>\n                )\n            case narrativeModel.NarrativeAccess.ADMIN:\n                return (\n                    <span>\n                        <Icon type=\"unlock\" /> Admin\n                    </span>\n                )\n            case narrativeModel.NarrativeAccess.OWNER:\n                return (\n                    <span>\n                        <Icon type=\"crown\" /> Owner\n                    </span>\n                )\n            default:\n                return (\n                    <span>\n                        ERROR\n                    </span>\n                )\n        }\n    }\n\n    renderPublicPermission(narrative: AccessibleNarrative) {\n        if (narrative.isPublic) {\n            return (\n                <span>\n                    <Icon type=\"global\" /> Public\n                </span>\n            )\n        } else {\n            return (\n                <span>\n                    <Icon type=\"lock\" /> Private\n                </span>\n            )\n        }\n    }\n\n    renderNarrative(narrative: AccessibleNarrative) {\n        return (\n            <React.Fragment>\n                <div className=\"RequestNarrative-title\">\n                    {narrative.title}\n                </div>\n\n                <div className=\"RequestNarrative-publicPermission\">\n                    {this.renderPublicPermission(narrative)}\n                </div>\n                <div className=\"RequestNarrative-modifiedAt\">\n                    <span className=\"field-label\">\n                        <Icon type=\"save\" />\n                    </span>\n                    {' '}\n                    <NiceElapsedTime time={narrative.lastSavedAt} tooltipPrefix=\"last saved \" />\n                </div>\n            </React.Fragment>\n        )\n    }\n\n    renderNarratives() {\n        if (this.props.narratives.length === 0) {\n            return (\n                <div className=\"message\">\n                    You do not have any Narratives\n                </div>\n            )\n        }\n        return this.props.narratives.map((orgNarrative, index) => {\n            const { status, narrative } = orgNarrative\n            let isSelected\n            if (this.props.selectedNarrative &&\n                narrative.workspaceId === this.props.selectedNarrative.narrative.workspaceId) {\n                isSelected = true\n            } else {\n                isSelected = false\n            }\n            let classNames = ['RequestNarrative-narrativeCell']\n            if (isSelected) {\n                classNames.push('RequestNarrative-selected')\n            }\n            let flag\n            switch (status) {\n                case NarrativeState.ASSOCIATED:\n                    classNames.push('RequestNarrative-narrativeInOrg')\n                    flag = (\n                        <Tooltip title=\"This narrative is already associated with this organization\">\n                            <Icon type=\"check\" style={{ color: 'green' }} />\n                        </Tooltip>\n                    )\n                    break\n                case NarrativeState.REQUESTED:\n                    classNames.push('RequestNarrative-narrativeInOrg')\n                    flag = (\n                        <Tooltip title=\"You have already requested that this narrative be added to this organization\">\n                            <Icon type=\"loading\" style={{ color: 'orange' }} />\n                        </Tooltip>\n                    )\n                    break\n                default:\n                    classNames.push('RequestNarrative-narrativeNotInOrg')\n            }\n\n            return (\n                <div\n                    className={classNames.join(' ')}\n                    onClick={() => { this.doSelectNarrative.call(this, orgNarrative) }}\n                    key={String(index)}>\n                    <div className=\"RequestNarrative-narrativeFlag\">\n                        {flag}\n                    </div>\n                    <div className=\"RequestNarrative-narrative\">\n                        {this.renderNarrative(orgNarrative.narrative)}\n                    </div>\n                </div>\n            )\n        })\n    }\n\n    onSearchSubmit() {\n        console.log('searching...')\n        return\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchBar() {\n        return (\n            <form id=\"searchForm\"\n                className=\"RequestNarrative-searchBar\"\n                onSubmit={this.onSearchSubmit.bind(this)}>\n                <input\n                    placeholder=\"Search your Narratives\"\n                    // onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                />\n                <Button\n                    className=\"RequestNarrative-button\"\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                </Button>\n            </form>\n        )\n    }\n\n    renderFeedbackBar() {\n        return (\n            <div>\n                Showing\n                {' '}\n                {\n                    Intl.NumberFormat('en-US', {\n                        style: 'decimal',\n                        useGrouping: true\n                    }).format(this.props.narratives.length)\n                }\n                {' '}\n                narratives\n            </div>\n        )\n    }\n\n    onSortByChange(value: string) {\n        switch (value) {\n            case 'title':\n                this.props.doSortBy(narrativeModel.Sort.TITLE)\n                break\n            case 'savedAt':\n                this.props.doSortBy(narrativeModel.Sort.LAST_SAVED)\n                break\n        }\n    }\n\n    onSortDirectionChange() {\n    }\n\n    onFilterChange() {\n    }\n\n    renderFilterSortBar() {\n        return (\n            <div className=\"RequestNarrative-filterSortBar\">\n                <span className=\"field-label\">sort by</span>\n                <Select onChange={this.onSortByChange.bind(this)}\n                    defaultValue={this.props.sortBy}\n                    style={{ width: '8em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"title\" key=\"title\">Title</Select.Option>\n                    <Select.Option value=\"savedAt\" key=\"savedAt\">Last saved</Select.Option>\n                </Select>\n            </div>\n        )\n    }\n\n    renderNarrativeSelector() {\n        return (\n            <div className=\"RequestNarrative-narrativeSelector scrollable-flex-column\">\n                <div style={{ display: 'flex', flexDirection: 'row' }}>\n                    {/* <div style={{ flex: '0 0 10em' }}>\n                        {this.renderSearchBar()}\n                    </div> */}\n                    <div style={{ flex: '1 1 0px' }}>\n                        {this.renderFilterSortBar()}\n                    </div>\n                </div>\n                <div className=\"RequestNarrative-feedbackBar\">\n                    {this.renderFeedbackBar()}\n                </div>\n                <div className=\"RequestNarrative-narratives scrollable-flex-column\">\n                    <div className=\"RequestNarrative-narrativesTable\">\n                        {this.renderNarratives()}\n                    </div>\n                </div>\n            </div >\n        )\n    }\n\n    renderSelectedNarrativeButton() {\n        if (!this.props.selectedNarrative) {\n            return\n        }\n        if (this.props.selectedNarrative.status === NarrativeState.ASSOCIATED) {\n            return (\n                <Alert type=\"info\" message=\"This Narrative is associated with this Organization\" />\n            )\n        } else if (this.props.selectedNarrative.status === NarrativeState.REQUESTED) {\n            return (\n                <Alert type=\"warning\" message=\"You have requested to associate this Narrative with this Organization\" />\n            )\n        }\n        let buttonLabel\n        if (this.props.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            buttonLabel = 'Add Selected Narrative to Organization'\n        } else {\n            buttonLabel = 'Request Association of Selected Narrative to Organization'\n        }\n        return (\n            <Button\n                type=\"primary\"\n                onClick={this.doSendRequest.bind(this)}\n                disabled={!this.canSendRequest.call(this)}\n            >{buttonLabel}</Button>\n        )\n    }\n\n    renderSelectedNarrative() {\n        if (this.props.selectedNarrative) {\n            return (\n                <div className=\"RequestNarrative-selectedNarrative\">\n                    <div className=\"RequestNarrative-title\">\n                        {this.props.selectedNarrative.narrative.title}\n                    </div>\n                    <div>\n                        <span className=\"field-label\">\n                            <Icon type=\"save\" />\n                        </span>\n                        {' '}\n                        <NiceElapsedTime time={this.props.selectedNarrative.narrative.lastSavedAt} tooltipPrefix=\"last saved \" />\n                    </div>\n                </div>\n            )\n        } else {\n            return (\n                <Alert type=\"info\" message=\"Select a narrative on the left to show it here and be able to add it to this organization.\" />\n            )\n        }\n    }\n\n    renderMenuButtons() {\n        return (\n            <div className=\"ButtonSet\">\n                <div className=\"ButtonSet-button\">\n                    <Button icon=\"rollback\"\n                        type=\"danger\"\n                        onClick={this.onFinish.bind(this)}>\n                        Done\n                </Button>\n                </div>\n            </div >\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"RequestNarrative scrollable-flex-column\">\n                <MainMenu buttons={this.renderMenuButtons()} />\n                <div className=\"RequestNarrative-body scrollable-flex-column\">\n                    <div className=\"RequestNarrative-selectNarrativeCol scrollable-flex-column\">\n                        <h3>Select a Narrative</h3>\n                        {this.renderNarrativeSelector()}\n                    </div>\n                    <div className=\"RequestNarrative-selectedNarrativeCol\">\n                        <h3>Selected Narrative</h3>\n                        {this.renderSelectedNarrative()}\n                        <div className=\"RequestNarrative-selectedNarrativeButtonBar\">\n                            {this.renderSelectedNarrativeButton()}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"RequestNarrative-footer\">\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default RequestAddNarrative","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from '../index'\nimport {\n    StoreState, Narrative, View, ViewOrgViewModelKind,\n    RequestNarrativeViewModel\n} from '../../../types'\nimport * as orgModel from '../../../data/models/organization/model'\nimport * as narrativeModel from '../../../data/models/narrative'\nimport * as requestModel from '../../../data/models/requests'\nimport { AnError } from '../../../lib/error'\nimport { makeError } from '../../../combo/error/api'\nimport { OrganizationNarrative } from '../../../data/models/narrative'\n\nexport interface Load extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS\n    organization: orgModel.Organization\n    narratives: Array<narrativeModel.OrganizationNarrative>\n    relation: orgModel.Relation\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR\n    error: AnError\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: orgModel.Organization, narratives: Array<narrativeModel.OrganizationNarrative>, relation: orgModel.Relation): LoadSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n        organization, narratives, relation\n    }\n}\n\nexport function loadError(error: AnError): LoadError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function load(organizationId: string) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n        const requestClient = new requestModel.RequestsModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const [org, narratives, request, invitation] = await Promise.all([\n                orgClient.getOrganization(organizationId),\n                narrativeClient.getOwnNarratives(organizationId),\n                requestClient.getUserRequestForOrg(organizationId),\n                requestClient.getUserInvitationForOrg(organizationId)\n            ])\n\n            const relation = orgModel.determineRelation(org, username, request, invitation)\n            dispatch(loadSuccess(org, narratives, relation))\n        } catch (ex) {\n            console.error('loading error', ex)\n            dispatch(loadError(makeError({\n                code: ex.name,\n                message: ex.message\n            })))\n        }\n    }\n}\n\n// Selecting narrative\nexport interface SelectNarrative {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    narrative: Narrative\n}\n\nexport interface SelectNarrativeStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n}\n\nexport interface SelectNarrativeSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS\n    narrative: narrativeModel.OrganizationNarrative\n}\n\nexport interface SelectNarrativeError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR\n    error: AnError\n}\n\nexport function selectNarrativeStart(): SelectNarrativeStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n    }\n}\n\nexport function selectNarrativeSuccess(narrative: OrganizationNarrative): SelectNarrativeSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n        narrative: narrative\n    }\n}\n\nexport function selectNarrativeError(error: AnError): SelectNarrativeError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\nexport function selectNarrative(narrative: OrganizationNarrative) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectNarrativeStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        // TODO: fetch narrative and populate the selected narrative accordingly...\n\n\n        dispatch(selectNarrativeSuccess(narrative))\n    }\n}\n\n// Sending Request\nexport interface SendRequest {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND\n}\n\nexport interface SendRequestStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n}\n\nexport interface SendRequestSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    request: requestModel.Request | boolean\n}\n\nexport interface SendRequestError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n    error: AnError\n}\n\n\nexport function sendRequestStart(): SendRequestStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n    }\n}\n\nexport function sendRequestSuccess(request: requestModel.Request | boolean): SendRequestSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n        request: request\n    }\n}\n\nexport function sendRequestError(error: AnError): SendRequestError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n        error: error\n    }\n}\n\nexport function sendRequest(groupId: string, workspaceId: number) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendRequestStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const orgClient = new orgModel.OrganizationModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url\n        })\n\n        try {\n            const request = await orgClient.addOrRequestNarrativeToGroup(groupId, workspaceId)\n            dispatch(sendRequestSuccess(request))\n        } catch (ex) {\n            dispatch(sendRequestError(makeError({\n                code: ex.name,\n                message: ex.message\n            })))\n        }\n    }\n}\n\n// Unloading\n\nexport interface Unload extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n    }\n}\n\n// SORTING\n\nexport interface Sort {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT\n    sort: narrativeModel.Sort\n}\n\nexport interface SortStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_START\n}\n\nexport interface SortSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_SUCCESS\n    narratives: Array<narrativeModel.OrganizationNarrative>\n}\n\nexport interface SortError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_ERROR\n    error: AnError\n}\n\nfunction ensureView(state: StoreState): View<RequestNarrativeViewModel> {\n    const {\n        views: {\n            viewOrgView: { viewModel }\n        }\n    } = state\n    if (viewModel === null) {\n        throw new Error('select user invalid state -- no view value')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error('select user invalid state -- no view value')\n    }\n    const { requestNarrativeView } = viewModel.subViews\n    if (requestNarrativeView === null) {\n        throw new Error('select user invalid state -- no view value')\n    }\n    return requestNarrativeView\n}\n\nexport function sort(sort: narrativeModel.Sort) {\n    return async (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch({\n            type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_START\n        } as SortStart)\n\n        const state = getState()\n\n        let view: View<RequestNarrativeViewModel>\n        try {\n            view = ensureView(state)\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n            return\n        }\n\n        if (view.viewModel === null) {\n            dispatch({\n                type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: 'missing view model'\n                })\n            })\n            return\n        }\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = state\n\n        const narrativeClient = new narrativeModel.NarrativeModel({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            serviceWizardURL: config.services.ServiceWizard.url,\n            workspaceServiceURL: config.services.Workspace.url\n        })\n\n        try {\n            const sorted = narrativeClient.sortOrganizationNarratives(view.viewModel.narratives, sort)\n            dispatch({\n                type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_SUCCESS,\n                narratives: sorted\n            } as SortSuccess)\n        } catch (ex) {\n            dispatch({\n                type: ActionFlag.REQUEST_ADD_NARRATIVE_SORT_ERROR,\n                error: makeError({\n                    code: 'error',\n                    message: ex.message\n                })\n            })\n        }\n\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\nimport * as types from '../../../../../types'\nimport Component from './component'\nimport * as actions from '../../../../../redux/actions/viewOrganization/requestAddNarrative'\nimport * as orgModel from '../../../../../data/models/organization/model'\nimport * as narrativeModel from '../../../../../data/models/narrative'\nimport { RequestNarrativeViewModel } from '../../../../../types';\n\nexport interface OwnProps {\n    onFinish: () => void\n}\n\ninterface StateProps {\n    organization: orgModel.Organization\n    relation: orgModel.Relation\n    narratives: Array<narrativeModel.OrganizationNarrative>\n    selectedNarrative: narrativeModel.OrganizationNarrative | null\n    searching: boolean\n    sortBy: string\n    // sortDirection: types.SortDirection\n    filter: string\n}\n\ninterface DispatchProps {\n    doSendRequest: (groupId: string, workspaceId: number) => void\n    doSelectNarrative: (narrative: narrativeModel.OrganizationNarrative) => void\n    doSortBy: (sortBy: narrativeModel.Sort) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== types.ViewOrgViewModelKind.NORMAL) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    if (viewModel.subViews.requestNarrativeView.viewModel === null) {\n        throw new Error(\"argh, null subview view model\")\n    }\n\n    const subViewModel: RequestNarrativeViewModel = viewModel.subViews.requestNarrativeView.viewModel\n\n    const {\n        organization, relation, narratives, selectedNarrative,\n    } = subViewModel\n\n    return {\n        organization, relation, narratives, selectedNarrative,\n        searching: false,\n        sortBy: 'title',\n        filter: ''\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        doSendRequest: (groupId: string, workspaceId: number) => {\n            dispatch(actions.sendRequest(groupId, workspaceId) as any)\n        },\n        doSelectNarrative: (narrative: narrativeModel.OrganizationNarrative) => {\n            dispatch(actions.selectNarrative(narrative) as any)\n        },\n        doSortBy: (sortBy: narrativeModel.Sort) => {\n            dispatch(actions.sort(sortBy) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: View<RequestNarrativeViewModel | NoneViewModel>\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n    onFinish: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        const message = (\n            <React.Fragment>\n                <Icon type=\"loading\" />{' '}Loading Your Narratives...\n            </React.Fragment>\n        )\n        return (\n            <Alert type=\"info\" message={message}\n                style={{ padding: '20px', width: '30em', margin: '30px auto 0 auto', textAlign: 'center' }} />\n        )\n    }\n\n    renderError(error: AnError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.state) {\n            case ViewState.NONE:\n                return this.renderLoading()\n            case ViewState.LOADING:\n                return this.renderLoading()\n            case ViewState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError(makeError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    }))\n                }\n            default:\n                return (\n                    <Container onFinish={this.props.onFinish} />\n                )\n        }\n    }\n\n    componentDidMount() {\n        switch (this.props.view.state) {\n            case ViewState.NONE:\n                this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as actions from '../../../../../redux/actions/viewOrganization/requestAddNarrative'\nimport { Icon, Alert } from 'antd'\nimport {\n    View, RequestNarrativeViewModel, StoreState, ViewOrgViewModelKind,\n    ViewState, NoneViewModel\n} from '../../../../../types'\nimport { AnError, makeError } from '../../../../../lib/error';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: View<RequestNarrativeViewModel>\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    // This bit deals with the fact that we are a subview \n    // and it keeps TS happy.\n    const v = state.views.viewOrgView\n    const vm1 = v.viewModel\n    if (vm1 === null) {\n        throw new Error('vm is null')\n    }\n    if (vm1.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error('not the right vm')\n    }\n    console.log('going in!', vm1.subViews)\n    return {\n        view: vm1.subViews.requestNarrativeView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport { Marked } from 'marked-ts'\nimport { NavLink, Redirect } from 'react-router-dom'\nimport { ViewOrgViewModel, SubViews } from '../../../../types'\nimport { Button, Modal, Icon, Tooltip, Card, Dropdown, Menu, Alert, Tabs } from 'antd'\nimport Header from '../../../Header'\nimport Member from '../../../entities/MemberContainer'\nimport MainMenu from '../../../menu/component'\nimport Members from './members/reduxAdapter'\nimport Requests from './requests/container'\nimport BriefOrganizationHeader from './BriefOrganizationHeader'\nimport RelatedOrganizations from './relatedOrgs/reduxAdapter'\nimport ManageRelatedOrganizations from './manageRelatedOrganizations/loader'\nimport InviteUser from './inviteUser/loader'\nimport Narratives from './narratives/component'\nimport ManageMembership from './manageMembership/loader'\nimport EditOrganization from './editOrganization/loader'\nimport RequestAddNarrative from './requestAddNarrative/loader'\nimport * as requestModel from '../../../../data/models/requests'\nimport * as orgModel from '../../../../data/models/organization/model'\nimport './component.css'\nimport OrgMenu from './OrgMenu';\n\nenum NavigateTo {\n    NONE = 0,\n    VIEW_MEMBERS,\n    MANAGE_REQUESTS,\n    VIEW_ORGANIZATION,\n    BROWSER\n}\n\nenum AccordionState {\n    UP = 0,\n    DOWN\n}\n\nexport interface ViewOrganizationState {\n    showInfo: boolean\n    navigateTo: NavigateTo\n    requestAccess: {\n        narrative: orgModel.NarrativeResource | null\n    }\n    accordionState: AccordionState\n    subView: SubViews\n}\n\nexport interface ViewOrganizationProps {\n    viewModel: ViewOrgViewModel\n    onViewOrg: (id: string) => void\n    onReloadOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: requestModel.RequestID) => void\n    onAcceptInvitation: (requestId: requestModel.RequestID) => void\n    onRejectInvitation: (requestId: requestModel.RequestID) => void\n    onRemoveNarrative: (narrative: orgModel.NarrativeResource) => void\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n    onAcceptRequest: (requestId: requestModel.RequestID) => void\n    onSortNarratives: (sortBy: string) => void\n    onSearchNarratives: (searchBy: string) => void\n}\n\nclass ViewOrganization extends React.Component<ViewOrganizationProps, ViewOrganizationState> {\n    constructor(props: ViewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            showInfo: false,\n            navigateTo: NavigateTo.NONE,\n            requestAccess: {\n                narrative: null\n            },\n            accordionState: AccordionState.UP,\n            subView: SubViews.NORMAL\n        }\n    }\n\n    onManageRelatedOrgs() {\n        this.setState({ subView: SubViews.MANAGE_RELATED_ORGS })\n    }\n\n    onInviteUser() {\n        this.setState({ subView: SubViews.INVITE_USER })\n    }\n\n    onChangeSubView(subView: SubViews) {\n        console.log('new subview?', subView)\n        this.setState({ subView })\n    }\n\n    onViewMembers() {\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n    }\n\n    onCancelJoinRequest() {\n        const relation = this.props.viewModel.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n    }\n\n    onAcceptInvitation() {\n        if (!this.props.viewModel.organization) {\n            return\n        }\n        const relation = this.props.viewModel.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n    }\n\n    onRejectInvitation() {\n        if (!this.props.viewModel.organization) {\n            return\n        }\n        const relation = this.props.viewModel.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n    }\n\n    onRequestAddNarrative() {\n        this.setState({ subView: SubViews.ADD_NARRATIVE })\n    }\n\n    onRemoveNarrative(narrative: orgModel.NarrativeResource) {\n        this.props.onRemoveNarrative(narrative)\n    }\n\n    onNarrativeMenu(key: string, narrative: orgModel.NarrativeResource) {\n        switch (key) {\n            case 'removeNarrative':\n                this.props.onRemoveNarrative(narrative)\n                break\n        }\n    }\n\n    onShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'View Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    Organization help here...\n                </div>\n            )\n        })\n    }\n\n    onRequestShare(narrative: orgModel.NarrativeResource) {\n        // Drawer.\n        // Drawer.open({\n        //     title: 'Request Access to Narrative',\n        //     content: 'Are you sure?'\n        // })\n        this.setState({ requestAccess: { narrative: narrative } })\n        // alert('not yet implemented')\n    }\n\n    onCloseRequestAccess() {\n        this.setState({ requestAccess: { narrative: null } })\n    }\n\n    buildFooter() {\n        return (\n            <div>\n                {this.renderEditRow()}\n                {/* <p style={{ textAlign: 'center' }}>\n                    You may also  <NavLink to={`/organizations`}><Button type=\"danger\" icon=\"undo\">Return to Orgs</Button></NavLink> to the organizations browser.\n                </p> */}\n            </div>\n        )\n    }\n\n    renderEditRow() {\n        if (this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            return (\n                <p style={{ textAlign: 'center' }}>\n                    As the owner of this group, you may <NavLink to={`/editOrganization/${this.props.viewModel.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink> it.\n                </p>\n            )\n        }\n    }\n\n    renderEditButton() {\n        if (this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.OWNER) {\n            return (\n                <NavLink to={`/editOrganization/${this.props.viewModel.organization!.id}`}><Button icon=\"edit\">Edit This Organization</Button></NavLink>\n            )\n        }\n    }\n\n    renderOrg() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.viewModel.organization) {\n            return\n        }\n        return (\n            <div className=\"ViewOrganization-org-description-org scrollable-flex-column\">\n                <div className=\"ViewOrganization-org-description\"\n                    dangerouslySetInnerHTML={({ __html: Marked.parse(this.props.viewModel.organization.description || '') })}\n                />\n            </div>\n        )\n    }\n\n    // TODO: this should be a component, so we can pick up all the good stuff, which is now commented out...\n    renderOwnerInfo(org: orgModel.Organization) {\n        return (\n            <div className=\"ownerTable\">\n                <div className=\"proprietorCol\">\n\n                    <div className=\"owner\">\n                        <a href={\"/#people/\" + org.owner.username} target=\"_blank\">{org.owner.username}</a>\n                        {' '}\n                        ❨{org.owner.username}❩\n                                </div>\n                    {/* <div className=\"profileOrganization\">\n                        {org.owner.user.organization}\n                    </div>\n                    <div className=\"profileOrganization\">\n                        {org.owner.user.city}, {org.owner.user.state}, {org.owner.user.country}\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n\n    renderRelation(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org; you may request membership\"\n                    >\n                        <div><Icon type=\"eye\" style={{ marginRight: '4px' }} />You are not a member of this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button\n                                onClick={this.onJoinClick.bind(this)}>\n                                Join this Organization\n                            </Button>\n                        </div>\n                    </Tooltip>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'orange' }} spin={true} />Your membership <b>request</b> is pending</div>\n                        <div><Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button></div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'blue' }} />You have been <b>invited</b> to join this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                            <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                        </div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" />Member</span>)\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />Admin</span>)\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You own this org\"\n                    >\n                        <span><Icon type=\"unlock\" theme=\"filled\" style={{ marginRight: '4px' }} />You own this organization</span>\n                    </Tooltip>\n                )\n        }\n    }\n\n    isMember(): boolean {\n        if (!this.props.viewModel.organization) {\n            return false\n        }\n        if (this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.OWNER ||\n            this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.MEMBER) {\n            return true\n        }\n        return false\n    }\n\n    renderMembers() {\n        if (!this.isMember()) {\n            return (\n                <Alert message=\"Membership is only available to members\" type=\"info\" />\n            )\n        }\n        return (\n            <Members\n                organization={this.props.viewModel.organization}\n                relation={this.props.viewModel.relation}\n                onReloadOrg={this.props.onReloadOrg} />\n        )\n\n    }\n\n    renderGroupRequestsRow() {\n        const relation = this.props.viewModel.relation\n        const requests = this.props.viewModel.groupRequests\n        const invitations = this.props.viewModel.groupInvitations\n\n        if (!(relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        // TODO: bad. should not get here in this case...\n        if (requests === null || invitations === null) {\n            return\n        }\n        let inner\n        if (requests.length) {\n            inner = (\n                <div>\n                    group has no pending requests\n                </div>\n            )\n        } else {\n            inner = (\n                <div>\n                    <div>\n                        <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> group has\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{requests.length}</span>\n                        {' '}\n                        pending request{requests.length > 1 ? 's' : ''}\n                        {' '}\n                        and\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{invitations.length}</span>\n                        {' '}\n                        pending request{invitations.length > 1 ? 's' : ''}\n\n                    </div>\n                    <div>\n                        <NavLink to={\"/manageOrganizationRequests/\" + this.props.viewModel.organization.id}>\n                            <Button>Manage Requests</Button>\n                        </NavLink>\n                    </div>\n                </div>\n            )\n        }\n        return (\n            <div className=\"row\">\n                <div className=\"col1\">\n                    <span className=\"label\">admin</span>\n                </div>\n                <div className=\"col2\">\n                    <div className=\"relation\">\n                        {inner}\n                    </div>\n                </div>\n            </div>\n\n        )\n    }\n\n    renderGroupRequests(requests: Array<requestModel.Request>, invitations: Array<requestModel.Request>) {\n        if (!requests.length) {\n            return (\n                <div className=\"message\">\n                    No pending group requests\n                </div>\n            )\n        } else {\n            return (\n                <div>\n                    <div>\n                        <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> There\n                        {' '}\n                        {requests.length > 1 ? 'are' : 'is'}\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{requests.length}</span>\n                        {' '}\n                        pending request{requests.length > 1 ? 's' : ''}\n                        {' '}\n                        and\n                        {' '}\n                        <span style={{ fontWeight: 'bold' }}>{invitations.length}</span>\n                        {' '}\n                        pending invitation{invitations.length > 1 ? 's' : ''}\n                    </div>\n                    <div>\n                        <NavLink to={\"/manageOrganizationRequests/\" + this.props.viewModel.organization!.id}>\n                            <Button>Manage Requests</Button>\n                        </NavLink>\n                    </div>\n                </div>\n            )\n        }\n    }\n\n    renderRelationClass(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'infoBox relationRequestPending'\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'infoBox relationInvitationPending'\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return 'infoBox'\n        }\n    }\n\n    renderUserRelationship() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        return (\n            <form className=\"infoTable\">\n                {/* <div className=\"row\">\n                    <div className=\"col1\">\n                        <span className=\"label\">your relation</span>\n                    </div>\n                    <div className=\"col2\">\n                        <div className='relation'>\n                            {this.renderRelation(this.props.organization)}\n                        </div>\n                    </div>\n                </div> */}\n                {this.renderGroupRequestsRow()}\n            </form>\n        )\n    }\n\n    renderAdminTasks() {\n        const relation = this.props.viewModel.relation\n        if (!(relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            relation.type === orgModel.UserRelationToOrganization.OWNER)) {\n            return\n        }\n        // TODO: ditto -- silly to test both conditions (this is only to make TS happy btw)\n        const { groupRequests, groupInvitations } = this.props.viewModel\n        if (groupInvitations === null || groupRequests === null) {\n            return\n        }\n        const count = groupRequests.length + groupInvitations.length\n        const title = (\n            <span><Icon type=\"unlock\" />\n                {' '}\n                group requests\n                {' '}\n                <span className=\"ViewOrganization-titleCount\">({count})</span>\n            </span>\n        )\n        return (\n            <div className=\"ViewOrganization-adminTasksBox\">\n                <Card\n                    className=\"slimCard ViewOrganization-adminTasksCard\"\n                    headStyle={{ backgroundColor: 'gray', color: 'white' }}\n                    title={title} >\n                    {this.renderGroupRequests(groupRequests, groupInvitations)}\n                </Card>\n            </div>\n        )\n    }\n\n    renderJoinButton() {\n        if (!this.props.viewModel.organization) {\n            return\n        }\n        if (this.props.viewModel.relation.type !== orgModel.UserRelationToOrganization.VIEW) {\n            return\n        }\n        return (\n            <Button\n                onClick={this.onJoinClick.bind(this)}\n            >\n                Join this Organization\n                </Button>\n        )\n    }\n\n    renderLoadingHeader() {\n        const breadcrumbs = (\n            <span>\n                Loading Org...\n            </span>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} />\n        )\n    }\n\n    renderMembersTab() {\n        return (\n            <div className=\"ViewOrganization-membersCol scrollable-flex-column\">\n                {this.renderMembersToolbar()}\n                {this.renderMembers()}\n            </div>\n        )\n    }\n\n    onAcceptRequest(request: requestModel.Request) {\n        this.props.onAcceptRequest(request.id)\n    }\n\n\n    renderMembersToolbar() {\n        switch (this.props.viewModel.relation.type) {\n            case orgModel.UserRelationToOrganization.NONE:\n                return\n            case orgModel.UserRelationToOrganization.MEMBER:\n                return\n            case orgModel.UserRelationToOrganization.ADMIN:\n                return (\n                    <div className=\"ViewOrganization-tabPaneToolbar\">\n                        <Tooltip placement=\"bottomRight\"\n                            title=\"Invite one or more users to this organization\">\n                            <Button size=\"small\" onClick={this.onInviteUser.bind(this)}><Icon type=\"mail\" />Invite Users</Button>\n                        </Tooltip>\n                    </div>\n                )\n            case orgModel.UserRelationToOrganization.OWNER:\n                return (\n                    <div className=\"ViewOrganization-tabPaneToolbar\">\n                        <Tooltip placement=\"bottomRight\"\n                            title=\"Invite one or more users to this organization\">\n                            <Button size=\"small\" onClick={this.onInviteUser.bind(this)}><Icon type=\"mail\" />Invite Users</Button>\n                        </Tooltip>\n                    </div>\n                )\n        }\n    }\n\n    renderToolbarButtons() {\n        switch (this.props.viewModel.relation.type) {\n            case orgModel.UserRelationToOrganization.NONE:\n                return\n            case orgModel.UserRelationToOrganization.MEMBER:\n                return\n            case orgModel.UserRelationToOrganization.ADMIN:\n                return (\n                    <React.Fragment>\n                        <Tooltip placement=\"bottomRight\"\n                            title=\"Invite a user to this organization\">\n                            <Button size=\"small\" onClick={this.onInviteUser.bind(this)}><Icon type=\"mail\" /></Button>\n                        </Tooltip>\n                    </React.Fragment>\n                )\n            case orgModel.UserRelationToOrganization.OWNER:\n                return (\n                    <React.Fragment>\n                        <Tooltip placement=\"bottomRight\"\n                            title=\"Invite a user to this organization\">\n                            <Button size=\"small\" onClick={this.onInviteUser.bind(this)}><Icon type=\"mail\" /></Button>\n                        </Tooltip>\n                    </React.Fragment>\n                )\n        }\n    }\n\n    renderCombo() {\n        const isAdmin = (this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.ADMIN ||\n            this.props.viewModel.relation.type === orgModel.UserRelationToOrganization.OWNER)\n\n        const isMember = this.props.viewModel.organization.isMember\n\n        // if (!isMember) {\n        //     return (\n        //         <p style={{ fontStyle: 'italic' }}>\n        //             The membership list is only available to members.\n        //         </p>\n        //     )\n        // }\n\n        const tabs = []\n\n        let memberCount\n        if (this.props.viewModel.organization.memberCount - 1) {\n            memberCount = String(this.props.viewModel.organization.memberCount - 1)\n        } else {\n            memberCount = 'Ø'\n        }\n        tabs.push((\n            <Tabs.TabPane\n                tab={<span><Icon type=\"team\" />Members <span className=\"ViewOrganization-tabCount\">({memberCount})</span></span>}\n                key=\"members\"\n                style={{ flexDirection: 'column' }}>\n                {this.renderMembersTab()}\n            </Tabs.TabPane>\n        ))\n\n        if (isMember) {\n            if (isAdmin) {\n                const totalRequestCount = this.props.viewModel.requestInbox.length + this.props.viewModel.requestOutbox.length\n                const totalRequests = (\n                    <span className=\"ViewOrganization-tabCount\">\n                        ({totalRequestCount || 'Ø'})\n                    </span>\n                )\n                tabs.push((\n                    <Tabs.TabPane tab={<span><Icon type=\"inbox\" />Requests {totalRequests} </span>} key=\"inbox\" style={{ flexDirection: 'column' }}>\n                        <Requests inbox={this.props.viewModel.requestInbox} outbox={this.props.viewModel.requestOutbox} relation={this.props.viewModel.relation} />\n                    </Tabs.TabPane>\n                ))\n            } else {\n                const outboxSize = this.props.viewModel.requestOutbox.length\n                let titleCount\n                if (outboxSize) {\n                    titleCount = String(outboxSize)\n                } else {\n                    titleCount = 'Ø'\n                }\n                tabs.push((\n                    <Tabs.TabPane tab={<span><Icon type=\"inbox\" />Requests <span className=\"ViewOrganization-tabCount\">({titleCount})</span></span>} key=\"outbox\" style={{ flexDirection: 'column' }}>\n                        <Requests inbox={[]} outbox={this.props.viewModel.requestOutbox} relation={this.props.viewModel.relation} />\n                    </Tabs.TabPane>\n                ))\n            }\n        }\n\n        const relatedOrgCount = this.props.viewModel.organization.relatedOrganizations.length\n        const relatedOrgTab = (\n            <span>\n                <Icon type=\"team\" />\n                Related Orgs <span className=\"ViewOrganization-tabCount\">({relatedOrgCount})</span>\n            </span>\n        )\n        tabs.push((\n            <Tabs.TabPane tab={relatedOrgTab} key=\"relatedorgs\" style={{ flexDirection: 'column' }}>\n                <RelatedOrganizations\n                    relatedOrganizations={this.props.viewModel.organization.relatedOrganizations}\n                    organization={this.props.viewModel.organization}\n                    onManageRelatedOrgs={() => { this.onManageRelatedOrgs() }} />\n            </Tabs.TabPane>\n        ))\n\n        return (\n            <Tabs\n                defaultActiveKey=\"members\"\n                className=\"ViewOrganization-tabs\"\n                animated={false}\n                size=\"small\"\n                tabPosition=\"top\"\n            >\n                {tabs}\n            </Tabs>\n        )\n    }\n\n    renderMenuButtons() {\n        return (\n            <span className=\"ButtonSet\">\n                <span className=\"ButtonSet-button\">\n                    <div className=\"IconButton\" onClick={this.onNavigateToBrowser.bind(this)} >\n                        <Icon type=\"close\" />\n                    </div>\n                    {/* <Button type=\"default\" onClick={this.onNavigateToBrowser.bind(this)} >\n                        <Icon type=\"close\" />{' '}Back\n                    </Button> */}\n                </span>\n            </span>\n        )\n    }\n\n    onNavigateToBrowser() {\n        this.setState({ navigateTo: NavigateTo.BROWSER })\n    }\n\n    onMenuClick({ key }: { key: string }) {\n        switch (key) {\n            case 'manageMyMembership':\n                this.setState({ subView: SubViews.MANAGE_MEMBERSHIP })\n                break\n            case 'viewMembers':\n                this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n                break\n            case 'editOrg':\n                this.setState({ subView: SubViews.EDIT_ORGANIZATION })\n                break\n            case 'inviteUser':\n                this.setState({ subView: SubViews.INVITE_USER })\n                break\n            case 'manageRequests':\n                this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n                break\n            case 'addNarrative':\n                this.setState({ subView: SubViews.ADD_NARRATIVE })\n                break\n            case 'manageRelatedOrgs':\n                this.setState({ subView: SubViews.MANAGE_RELATED_ORGS })\n                break\n        }\n    }\n\n    renderOrgMenu() {\n        const org = this.props.viewModel.organization\n        switch (this.props.viewModel.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                // return (\n                //     <span><Icon type=\"stop\" />None</span>\n                // )\n                return (\n                    <span>\n                        <Button\n                            type=\"primary\"\n                            onClick={this.onJoinClick.bind(this)}>\n                            Join this Organization\n                        </Button>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <span>\n                        <Button\n                            type=\"primary\"\n                            onClick={this.onJoinClick.bind(this)}>\n                            Join this Organization\n                        </Button>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <span>\n                        <Tooltip\n                            placement=\"bottom\"\n                            mouseEnterDelay={0.5}\n                            title=\"You have requested to join this Org; you may cancel your join request with this button\"\n                        >\n                            <Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Join Request</Button>\n                        </Tooltip>\n                    </span>\n\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div className=\"ViewOrganization-invitationPendingCard\">\n                        <span>You have been invited to this organization: </span>\n                        <Button icon=\"check\" type=\"default\" size=\"small\" onClick={this.onAcceptInvitation.bind(this)}>Accept</Button>\n                        <Button icon=\"stop\" type=\"danger\" size=\"small\" onClick={this.onRejectInvitation.bind(this)}>Reject</Button>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                const menu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            <Icon type=\"user\" />{' '}Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"addNarrative\">\n                            <Icon type=\"file\" />{' '}Add Narrative\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <span>\n                        <Dropdown overlay={menu} trigger={['click']}>\n                            <Button shape=\"circle\">\n                                <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                            </Button>\n                        </Dropdown>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                const adminMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            <Icon type=\"user\" />{' '}Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" >\n                            <Icon type=\"edit\" />{' '}Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            <Icon type=\"mail\" />{' '}Invite User\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRelatedOrgs\">\n                            <Icon type=\"team\" />{' '}Manage Related Orgs\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <span>\n                        <Dropdown overlay={adminMenu} trigger={['click']}>\n                            <Button shape=\"circle\">\n                                <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                            </Button>\n                        </Dropdown>\n                    </span>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                const ownerMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            <Icon type=\"user\" />{' '}Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\">\n                            <Icon type=\"edit\" />{' '}Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            <Icon type=\"mail\" />{' '}Invite User\n                        </Menu.Item>\n                        <Menu.Item key=\"addNarrative\">\n                            <Icon type=\"file\" />{' '}Add Narrative\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRelatedOrgs\">\n                            <Icon type=\"team\" />{' '}Manage Related Orgs\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <span>\n                        <Dropdown overlay={ownerMenu} trigger={['click']}>\n                            <Button shape=\"circle\">\n                                <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                            </Button>\n                        </Dropdown>\n                    </span>\n                )\n        }\n    }\n\n\n    toggleAccordion() {\n        this.setState({\n            accordionState: this.state.accordionState === AccordionState.UP ? AccordionState.DOWN : AccordionState.UP\n        })\n    }\n\n    renderAccordionControl() {\n        let iconType\n        if (this.state.accordionState === AccordionState.UP) {\n            iconType = 'caret-down'\n        } else {\n            iconType = 'caret-up'\n        }\n        return (\n            <div className=\"ViewOrganization-accordion\" onClick={this.toggleAccordion.bind(this)}>\n                <div className=\"ViewOrganization-accordionCol1\">\n                    <div className=\"ViewOrganization-accordionRow1\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow2\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow3\">\n                    </div>\n                </div>\n                <div className=\"ViewOrganization-accordionCol2\">\n                    <div className=\"ViewOrganization-accordionRow1\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow2\">\n                        <Icon type={iconType} />\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow3\">\n                    </div>\n                    {/* <div className=\"ViewOrganization-accordionIcon\">\n                        <Icon type={iconType} />\n                    </div> */}\n                </div>\n                <div className=\"ViewOrganization-accordionCol3\">\n                    <div className=\"ViewOrganization-accordionRow1\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow2\">\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow3\">\n                    </div>\n                </div>\n\n\n            </div>\n        )\n    }\n\n    renderNormalView() {\n        let orgRowClass\n        let narrativesRowClass\n        if (this.state.accordionState === AccordionState.UP) {\n            orgRowClass = \"ViewOrganization-orgRow ViewOrganization-accordionClosed\"\n            narrativesRowClass = \"ViewOrganization-narrativesRow ViewOrganization-accordionOpen\"\n        } else {\n            orgRowClass = \"ViewOrganization-orgRow ViewOrganization-accordionOpen\"\n            narrativesRowClass = \"ViewOrganization-narrativesRow ViewOrganization-accordionClosed\"\n        }\n        orgRowClass += \" scrollable-flex-column\"\n        narrativesRowClass += \" scrollable-flex-column\"\n        return (\n            <div className=\"ViewOrganization-mainRow scrollable-flex-column\">\n                <div className=\"ViewOrganization-mainColumn  scrollable-flex-column\">\n                    <div className={orgRowClass} style={{ minHeight: '0px' }}>\n                        {this.renderOrg()}\n                    </div>\n                    <div className=\"ViewOrganization-accordionRow\">\n                        {this.renderAccordionControl()}\n                    </div>\n                    <div className={narrativesRowClass}>\n                        {/* TODO: move these actions into a redux adapter for narratives \n                    */}\n                        <Narratives\n                            organization={this.props.viewModel.organization}\n                            narratives={this.props.viewModel.narratives}\n                            relation={this.props.viewModel.relation}\n                            sortNarrativesBy={this.props.viewModel.sortNarrativesBy}\n                            searchNarrativesBy={this.props.viewModel.searchNarrativesBy}\n                            onSortNarratives={this.props.onSortNarratives}\n                            onSearchNarratives={this.props.onSearchNarratives}\n                            onRemoveNarrative={this.props.onRemoveNarrative}\n                            onGetViewAccess={this.props.onGetViewAccess}\n                            onRequestAddNarrative={this.onRequestAddNarrative.bind(this)}\n                        />\n                    </div>\n                </div>\n                <div className=\"ViewOrganization-infoColumn\">\n                    {this.renderCombo()}\n                </div>\n            </div>\n        )\n    }\n\n    renderManageRelatedOrgsView() {\n        const onFinish = () => {\n            this.setState({\n                subView: SubViews.NORMAL\n            })\n        }\n        return (\n            <ManageRelatedOrganizations\n                // organization={this.props.viewModel.organization}\n                // relatedOrganizations={[]}\n                // relation={this.props.viewModel.relation}\n                onFinish={onFinish} />\n        )\n    }\n\n    renderInviteUsersView() {\n        const onFinish = () => {\n            this.setState({\n                subView: SubViews.NORMAL\n            })\n        }\n        return (\n            <InviteUser onFinish={onFinish} organizationId={this.props.viewModel.organization.id} />\n        )\n    }\n\n    renderManageMembership() {\n        const onFinish = () => {\n            this.setState({\n                subView: SubViews.NORMAL\n            })\n        }\n        return (\n            <ManageMembership onFinish={onFinish} organizationId={this.props.viewModel.organization.id} />\n        )\n    }\n\n    renderEditOrganization() {\n        const onFinish = () => {\n            this.setState({\n                subView: SubViews.NORMAL\n            })\n        }\n        return (\n            <EditOrganization onFinish={onFinish} organizationId={this.props.viewModel.organization.id} />\n        )\n    }\n\n    renderAddNarrative() {\n        const onFinish = () => {\n            this.setState({\n                subView: SubViews.NORMAL\n            })\n        }\n        return (\n            <RequestAddNarrative onFinish={onFinish} organizationId={this.props.viewModel.organization.id} />\n        )\n    }\n\n    getSubView() {\n        switch (this.state.subView) {\n            case SubViews.MANAGE_RELATED_ORGS:\n                return this.renderManageRelatedOrgsView()\n            case SubViews.INVITE_USER:\n                return this.renderInviteUsersView()\n            case SubViews.MANAGE_MEMBERSHIP:\n                return this.renderManageMembership()\n            case SubViews.EDIT_ORGANIZATION:\n                return this.renderEditOrganization()\n            case SubViews.ADD_NARRATIVE:\n                return this.renderAddNarrative()\n            case SubViews.NORMAL:\n            default:\n                return this.renderNormalView()\n        }\n    }\n\n    render() {\n        switch (this.state.navigateTo) {\n            case NavigateTo.BROWSER:\n                return <Redirect push to={\"/organizations\"} />\n            case NavigateTo.NONE:\n            default:\n            // do nothing.\n        }\n\n        const uorg = this.props.viewModel.organization as unknown\n        const borg = uorg as orgModel.BriefOrganization\n\n        // TODO: only doing this here so I don't have to do a redux adapter for the menu today...\n\n        const orgMenu = <OrgMenu\n            viewModel={this.props.viewModel}\n            onJoinOrg={this.props.onJoinOrg}\n            onCancelJoinRequest={this.props.onCancelJoinRequest}\n            onAcceptInvitation={this.props.onAcceptInvitation}\n            onRejectInvitation={this.props.onRejectInvitation}\n            onChangeSubView={this.onChangeSubView.bind(this)}\n        />\n\n\n        return (\n            <div className=\"ViewOrganization  scrollable-flex-column\">\n                <div className=\"ViewOrganization-organizationBox\">\n                    <BriefOrganizationHeader\n                        organization={borg}\n                        openRequestsStatus={this.props.viewModel.openRequest}\n                        orgMenu={orgMenu}\n                        onNavigateToBrowser={this.onNavigateToBrowser.bind(this)}\n                    />\n                </div>\n                {this.getSubView()}\n            </div>\n\n        )\n    }\n}\n\nexport default ViewOrganization","import * as React from 'react'\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\nimport { Button, Tooltip, Menu, Icon, Dropdown } from 'antd';\nimport { ViewOrgViewModel, SubViews } from '../../../../types';\nimport './OrgMenu.css'\n\nexport interface OrgMenuProps {\n    viewModel: ViewOrgViewModel\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: requestModel.RequestID) => void\n    onAcceptInvitation: (requestId: requestModel.RequestID) => void\n    onRejectInvitation: (requestId: requestModel.RequestID) => void\n    onChangeSubView: (subView: SubViews) => void\n}\n\nexport interface OrgMenuState {\n\n}\n\nexport default class OrgMenu extends React.Component<OrgMenuProps, OrgMenuState> {\n    constructor(props: OrgMenuProps) {\n        super(props)\n    }\n\n    // Event handlers\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n    }\n\n    onCancelJoinRequest() {\n        const relation = this.props.viewModel.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n    }\n\n    onAcceptInvitation() {\n        if (!this.props.viewModel.organization) {\n            return\n        }\n        const relation = this.props.viewModel.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n    }\n\n    onRejectInvitation() {\n        if (!this.props.viewModel.organization) {\n            return\n        }\n        const relation = this.props.viewModel.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n    }\n\n    onMenuClick({ key }: { key: string }) {\n        switch (key) {\n            case 'manageMyMembership':\n                this.props.onChangeSubView(SubViews.MANAGE_MEMBERSHIP)\n                break\n            case 'editOrg':\n                this.props.onChangeSubView(SubViews.EDIT_ORGANIZATION)\n                break\n            case 'inviteUser':\n                this.props.onChangeSubView(SubViews.INVITE_USER)\n                break\n            case 'addNarrative':\n                this.props.onChangeSubView(SubViews.ADD_NARRATIVE)\n                break\n            case 'manageRelatedOrgs':\n                this.props.onChangeSubView(SubViews.MANAGE_RELATED_ORGS)\n                break\n        }\n    }\n\n    // Renderers\n\n    renderOrgMenu() {\n        const org = this.props.viewModel.organization\n        switch (this.props.viewModel.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <Button\n                        type=\"primary\"\n                        onClick={this.onJoinClick.bind(this)}>\n                        Join this Organization\n                        </Button>\n                )\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return (\n                    <Button\n                        type=\"primary\"\n                        onClick={this.onJoinClick.bind(this)}>\n                        Join this Organization\n                        </Button>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottom\"\n                        mouseEnterDelay={0.5}\n                        title=\"You have requested to join this Org; you may cancel your join request with this button\"\n                    >\n                        <Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Join Request</Button>\n                    </Tooltip>\n\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div className=\"ViewOrganization-invitationPendingCard\">\n                        <span>You have been invited to this organization: </span>\n                        <Button icon=\"check\" type=\"default\" size=\"small\" onClick={this.onAcceptInvitation.bind(this)}>Accept</Button>\n                        <Button icon=\"stop\" type=\"danger\" size=\"small\" onClick={this.onRejectInvitation.bind(this)}>Reject</Button>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                const menu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            <Icon type=\"user\" />{' '}Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"addNarrative\">\n                            <Icon type=\"file\" />{' '}Add Narrative\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <Dropdown overlay={menu} trigger={['click']}>\n                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '300%' }} />\n                    </Dropdown>\n                )\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                const adminMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            <Icon type=\"user\" />{' '}Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" >\n                            <Icon type=\"edit\" />{' '}Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            <Icon type=\"mail\" />{' '}Invite User\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRelatedOrgs\">\n                            <Icon type=\"team\" />{' '}Manage Related Orgs\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <Dropdown overlay={adminMenu} trigger={['click']}>\n                        <Icon type=\"setting\" theme=\"filled\" className=\"IconButton\" style={{ fontSize: '300%' }} />\n                    </Dropdown>\n                )\n            case (orgModel.UserRelationToOrganization.OWNER):\n                const ownerMenu = (\n                    <Menu onClick={this.onMenuClick.bind(this)}>\n                        <Menu.Item key=\"manageMyMembership\">\n                            <Icon type=\"user\" />{' '}Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\">\n                            <Icon type=\"edit\" />{' '}Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\">\n                            <Icon type=\"mail\" />{' '}Invite User\n                        </Menu.Item>\n                        <Menu.Item key=\"addNarrative\">\n                            <Icon type=\"file\" />{' '}Add Narrative\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRelatedOrgs\">\n                            <Icon type=\"team\" />{' '}Manage Related Orgs\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <Dropdown overlay={ownerMenu} trigger={['click']}>\n                        <Icon type=\"setting\" theme=\"filled\" className=\"IconButton\" style={{ fontSize: '300%' }} />\n                    </Dropdown>\n                )\n        }\n    }\n\n    render() {\n        return (\n            <React.Fragment>\n                {this.renderOrgMenu()}\n            </React.Fragment>\n        )\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, ViewOrgViewModelKind, ViewOrgViewModel } from '../../../../types'\nimport * as actions from '../../../../redux/actions/viewOrg'\nimport * as acceptInboxRequestActions from '../../../../redux/actions/viewOrganization/acceptInboxRequest'\n\nimport ViewOrganization from './component'\n\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    viewModel: ViewOrgViewModel\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onViewOrg: (id: string) => void\n    onReloadOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: requestModel.RequestID) => void\n    onAcceptInvitation: (requestId: requestModel.RequestID) => void\n    onRejectInvitation: (requestId: requestModel.RequestID) => void\n    onRemoveNarrative: (narrative: orgModel.NarrativeResource) => void\n    onGetViewAccess: (narrative: orgModel.NarrativeResource) => void\n    onAcceptRequest: (requestId: requestModel.RequestID) => void\n    onSortNarratives: (sortBy: string) => void\n    onSearchNarratives: (searchBy: string) => void\n}\n\n// hmm this bit would be for the interface for the wrapped component.\n// can't really do that here, but _could_ export the interfaces above\n// and compose them thus in the wrapped component. But the wrapped component\n// should know nothing about this business\n// type Props = StateProps & DispatchProps & OwnProps\n\nfunction mapStateToProps(state: StoreState, ownProps: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.NORMAL) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n\n    // TODO: of course this really needs to be an async fetch of the org info!\n    return {\n        viewModel\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onViewOrg: (id: string) => {\n            dispatch(actions.load(id) as any)\n        },\n        onReloadOrg: (id: string) => {\n            dispatch(actions.reload(id) as any)\n        },\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: requestModel.RequestID) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: requestModel.RequestID) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: requestModel.RequestID) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        },\n        onRemoveNarrative: (narrative: orgModel.NarrativeResource) => {\n            dispatch(actions.removeNarrative(narrative) as any)\n        },\n        onGetViewAccess: (narrative: orgModel.NarrativeResource) => {\n            dispatch(actions.accessNarrative(narrative) as any)\n        },\n        onAcceptRequest: (requestId: requestModel.RequestID) => {\n            dispatch(acceptInboxRequestActions.acceptRequest(requestId) as any)\n        },\n        onSortNarratives: (sortBy: string) => {\n            dispatch(actions.sortNarratives(sortBy) as any)\n        },\n        onSearchNarratives: (searchBy: string) => {\n            dispatch(actions.searchNarratives(searchBy) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewOrganization)\n\n// export default connect(mapStateToProps, mapDispatchToProps)(ViewOrganization) \n\n","import * as React from 'react'\n\nimport './component.css'\n\nimport { Button, Modal, Icon, Alert } from 'antd'\nimport Header from '../../../Header'\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\n\nenum NavigateTo {\n    NONE = 0,\n    REQUEST_ADD_NARRATIVE\n}\n\nexport interface ViewOrganizationState {\n    showInfo: boolean\n    navigateTo: NavigateTo\n    requestAccess: {\n        narrative: orgModel.NarrativeResource | null\n    }\n}\n\nexport interface ViewOrganizationProps {\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n}\n\nclass ViewOrganization extends React.Component<ViewOrganizationProps, ViewOrganizationState> {\n    constructor(props: ViewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            showInfo: false,\n            navigateTo: NavigateTo.NONE,\n            requestAccess: {\n                narrative: null\n            }\n        }\n    }\n\n    onShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'View Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This organization is <b>private</b>.</p>\n                    <p>Although no information about this organization may be revealed to non-members, you may request membership</p>\n                    <p>Upon requesting membership, an organization administrator may grant you membership</p>\n                    <p>When your request is either accepted or denied, you will received a notification in your KBase Feed.</p>\n                </div>\n            )\n        })\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n    }\n\n    onCancelJoinRequest() {\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n    }\n\n    onAcceptInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n    }\n\n    onRejectInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.relation as orgModel.MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n    }\n\n    renderMessage() {\n        switch (this.props.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <React.Fragment>\n                        <p>This organization is <b>private</b> and you are not a member.</p>\n                        <p>Although no information about this organization may be revealed to non-members, you may request membership</p>\n                        <p>Upon requesting membership, the organization administrators will be notified.</p>\n                        <p>When your request is either accepted or denied, you will received a notification in your KBase Feed.</p>\n                    </React.Fragment>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <React.Fragment>\n                        <p>Your membership request to this private organization is pending.</p>\n                    </React.Fragment>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <React.Fragment>\n                        <p>You have been invited to this private organization.</p>\n                    </React.Fragment>\n                )\n            default:\n                return (\n                    <div>\n                        Weird, {this.props.relation.type}.\n                    </div>\n                )\n        }\n    }\n\n    renderOrg() {\n        const message = (\n            <span>\n                Private Organization\n            </span>\n        )\n        const description = (\n            <React.Fragment>\n                {this.renderMessage()}\n                <div>\n                    {this.renderJoinButton()}\n                </div>\n            </React.Fragment>\n        )\n        return (\n            <Alert\n                message={message}\n                description={description}\n                type=\"info\"\n                showIcon={true}\n                icon={(<Icon type=\"lock\" />)}\n                style={{ width: '50em', margin: '20px auto' }}\n                className=\"ViewInaccessiblePrivateOrganization-message\" />\n        )\n    }\n\n    renderRelationClass(relation: orgModel.Relation) {\n        switch (relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.VIEW):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'infoBox relationRequestPending'\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'infoBox relationInvitationPending'\n            case (orgModel.UserRelationToOrganization.MEMBER):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.ADMIN):\n                return 'infoBox'\n            case (orgModel.UserRelationToOrganization.OWNER):\n                return 'infoBox'\n        }\n    }\n\n    renderJoinButton() {\n        switch (this.props.relation.type) {\n            case (orgModel.UserRelationToOrganization.NONE):\n                return (\n                    <Button\n                        onClick={this.onJoinClick.bind(this)}\n                    >\n                        Join this Organization\n                    </Button>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <div><Button\n                            icon=\"delete\"\n                            type=\"danger\"\n                            onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button>\n                        </div>\n                    </div>\n                )\n            case (orgModel.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div>\n                        <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                        {' '}\n                        <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                    </div>\n                )\n            default:\n                return (\n                    <div>\n                        Weird, {this.props.relation.type}.\n                    </div>\n                )\n        }\n    }\n\n    renderHeader() {\n        const breadcrumbs = (\n            <div style={{ flex: '0 0 auto' }}>\n            </div>\n        )\n        const buttons = (\n            <React.Fragment>\n\n                <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n            </React.Fragment>\n        )\n        return (\n            <Header breadcrumbs={breadcrumbs} buttons={buttons} />\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"ViewInaccessiblePrivateOrganization  scrollable-flex-column\">\n                {this.renderHeader()}\n                {this.renderOrg()}\n            </div>\n        )\n    }\n}\n\nexport default ViewOrganization","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, ViewOrgViewModelKind } from '../../../../types'\nimport * as actions from '../../../../redux/actions/viewOrg'\n\nimport ViewOrganization from './component'\n\nimport * as orgModel from '../../../../data/models/organization/model'\nimport * as requestModel from '../../../../data/models/requests'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    organization: orgModel.InaccessiblePrivateOrganization\n    relation: orgModel.Relation\n    requestOutbox: Array<requestModel.Request>\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n}\n\n// hmm this bit would be for the interface for the wrapped component.\n// can't really do that here, but _could_ export the interfaces above\n// and compose them thus in the wrapped component. But the wrapped component\n// should know nothing about this business\n// type Props = StateProps & DispatchProps & OwnProps\n\n\nfunction mapStateToProps(state: StoreState, ownProps: OwnProps): StateProps {\n    const viewModel = state.views.viewOrgView.viewModel\n    if (!viewModel) {\n        throw new Error('argh, view model missing')\n    }\n    if (viewModel.kind !== ViewOrgViewModelKind.PRIVATE_INACCESSIBLE) {\n        throw new Error(\"argh, wrong org kind\")\n    }\n    const {\n        organization, relation, requestOutbox\n    } = viewModel\n\n    // TODO: of course this really needs to be an async fetch of the org info!\n    return {\n        organization, relation, requestOutbox\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: string) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: string) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: string) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        },\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ViewOrganization)\n","import * as React from 'react'\n\nimport AccessibleContainer from './accessible/container'\nimport InaccessibleContainer from './inaccessible/container'\nimport { Spin, Alert } from 'antd';\n\nexport interface Props {\n    organizationId: string\n    view: types.ViewOrgView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n\n    previousOrganizationId: string | null\n\n    constructor(props: Props) {\n        super(props)\n\n        this.previousOrganizationId = null\n    }\n\n    renderLoading() {\n        const message = (\n            <div>\n                Loading Organization...\n                {' '}\n                <Spin />\n            </div>\n        )\n        return (\n            <Alert type=\"info\" message={message} style={{\n                width: '20em',\n                padding: '20px',\n                margin: '20px auto'\n            }} />\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.view.loadingState) {\n            case types.ComponentLoadingState.NONE:\n                return this.renderLoading()\n            case types.ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case types.ComponentLoadingState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            case types.ComponentLoadingState.SUCCESS:\n            default:\n                if (this.props.view.viewModel === null) {\n                    return this.renderError({\n                        code: 'Null Error',\n                        message: 'The view model is missing, but should be available'\n                    })\n                }\n                if (this.props.view.viewModel.organization.kind === OrganizationKind.INACCESSIBLE_PRIVATE) {\n                    return (\n                        <InaccessibleContainer />\n                    )\n                }\n                return (\n                    <AccessibleContainer />\n                )\n        }\n    }\n\n    componentDidUpdate(previousProps: Props) {\n        if (previousProps.organizationId !== this.props.organizationId) {\n            this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentDidMount() {\n        if (this.props.view.loadingState === types.ComponentLoadingState.NONE) {\n            this.props.onLoad(this.props.organizationId)\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../../types'\nimport * as actions from '../../../redux/actions/viewOrg'\nimport { OrganizationKind } from '../../../data/models/organization/model';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.ViewOrgView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.views.viewOrgView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import * as React from 'react'\nimport './Auth.css'\n\nimport * as types from '../types'\nimport { Button } from 'antd';\n\n\nexport interface AuthState {\n\n}\n\nclass Auth extends React.Component<types.AuthProps, AuthState> {\n\n    tokenRef: React.RefObject<HTMLInputElement>\n\n    constructor(props: types.AuthProps) {\n        super(props)\n\n        this.tokenRef = React.createRef()\n\n        this.props.checkAuth()\n    }\n\n    onLogoutClick() {\n        this.props.onRemoveAuthorization()\n    }\n\n    onLoginClick() {\n        if (this.tokenRef.current === null) {\n            return\n        }\n        const token = this.tokenRef.current.value\n        if (token.length === 0) {\n            return\n        }\n        this.props.onAddAuthorization(token)\n    }\n\n    buildAuthForm() {\n        return (\n            <div className=\"Auth-form\">\n                Token: <input ref={this.tokenRef} style={{ width: '30em' }} />\n                <Button\n                    icon=\"save\"\n                    htmlType=\"submit\"\n                    onClick={this.onLoginClick.bind(this)} >\n                    Assign Token\n                </Button>\n            </div>\n        )\n    }\n\n    buildAuthToolbar() {\n        return (\n            <div className=\"Auth-toolbar\">\n                Logged in as <b><span>{this.props.authorization.authorization.realname}</span> (<span>{this.props.authorization.authorization.username}</span></b>)\n                {' '}\n                <Button icon=\"logout\" onClick={this.onLogoutClick.bind(this)}></Button>\n            </div>\n        )\n    }\n\n    buildAuthDev() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.buildAuthToolbar()}\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized! Enter a user token below</p>\n                        {this.buildAuthForm()}\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Error</p>\n                        {this.props.authorization.message}\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n    }\n\n    buildAuthProd() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized!</p>\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-error scrollable-flex-column\">\n                        <p>Error: ??</p>\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n\n    }\n\n    render() {\n        return (\n            <div className=\"Auth scrollable-flex-column\">\n                {this.props.hosted ? this.buildAuthProd() : this.buildAuthDev()}\n            </div>\n        )\n\n    }\n}\n\nexport default Auth","\nexport interface RootInfo {\n    version: string,\n    servertime: number\n}\n\ninterface AuthEndpoints {\n    root: string,\n    tokenInfo: string,\n    apiMe: string,\n    me: string,\n    loginStart: string,\n    loginChoice: string,\n    loginCreate: string,\n    loginUsernameSuggest: string,\n    loginPick: string,\n    loginCancel: string,\n    logout: string,\n    linkStart: string,\n    linkCancel: string,\n    linkChoice: string,\n    linkPick: string,\n    linkRemove: string,\n    tokens: string,\n    tokensRevoke: string,\n    tokensRevokeAll: string,\n    userSearch: string,\n    adminUserSearch: string,\n    adminUser: string\n}\n\nconst endpoints: AuthEndpoints = {\n    root: '',\n    tokenInfo: 'api/V2/token',\n    apiMe: 'api/V2/me',\n    me: 'me',\n    loginStart: 'login/start',\n    logout: 'logout',\n    loginChoice: 'login/choice',\n    loginCreate: 'login/create',\n    loginUsernameSuggest: 'login/suggestname',\n    loginPick: 'login/pick',\n    loginCancel: 'login/cancel',\n    linkStart: 'link/start',\n    linkCancel: 'link/cancel',\n    linkChoice: 'link/choice',\n    linkPick: 'link/pick',\n    linkRemove: 'me/unlink',\n    tokens: 'tokens',\n    tokensRevoke: 'tokens/revoke',\n    tokensRevokeAll: 'tokens/revokeall',\n    userSearch: 'api/V2/users/search',\n    adminUserSearch: 'api/V2/admin/search',\n    adminUser: 'api/V2/admin/user'\n}\n\nexport interface TokenInfo {\n    created: number,\n    expires: number,\n    id: string,\n    name: string | null,\n    token: string,\n    type: string,\n    user: string,\n    cachefor: number\n}\n\nexport interface Identity {\n    id: string,\n    provider: string,\n    username: string\n}\n\nexport interface Role {\n    id: string,\n    desc: string\n}\n\nexport interface Account {\n    created: number,\n    customroles: Array<string>,\n    display: string,\n    email: string,\n    idents: Array<Identity>,\n    lastLogin: number,\n    local: boolean,\n    roles: Array<Role>,\n    user: string\n}\nexport class AuthClient {\n    url: string;\n\n    constructor({ url }: { url: string }) {\n        this.url = url\n    }\n\n    makePath(path: Array<string> | string): string {\n        if (typeof path === 'string') {\n            return [this.url].concat([path]).join('/');\n        }\n        return [this.url].concat(path).join('/');\n    }\n\n\n    root(): Promise<RootInfo> {\n        return fetch(this.makePath([endpoints.root]), {\n            headers: {\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as RootInfo\n            })\n    }\n\n    getTokenInfo(token: string): Promise<TokenInfo> {\n        return fetch(this.makePath([endpoints.tokenInfo]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as TokenInfo\n            })\n    }\n\n    getMe(token: string): Promise<Account> {\n        return fetch(this.makePath([endpoints.apiMe]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Account\n            })\n    }\n\n\n    // getInfo() : Promise<GroupsServiceInfo> {\n    //     return fetch(this.url + '/', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json();\n    //         })\n    //         .then((result) => {\n    //             return result as GroupsServiceInfo;\n    //         });\n    // }\n\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport * as Cookies from 'es-cookie'\n\nimport { ActionFlag } from './index'\nimport { AppError, StoreState } from '../../types';\nimport { AuthClient, TokenInfo, Account } from '../../data/auth';\n\n// Action Definitions\n\nexport interface AuthCheck extends Action {\n    type: ActionFlag.AUTH_CHECK\n}\n\nexport interface AuthCheckStart extends Action {\n    type: ActionFlag.AUTH_CHECK_START\n}\n\nexport interface AuthCheckError extends Action {\n    type: ActionFlag.AUTH_CHECK_ERROR,\n    error: AppError\n}\n\nexport interface AuthAuthorized extends Action {\n    type: ActionFlag.AUTH_AUTHORIZED,\n    token: string\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\nexport interface AuthUnauthorized extends Action {\n    type: ActionFlag.AUTH_UNAUTHORIZED\n}\n\nexport interface AuthRemoveAuthorization extends Action {\n    type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n}\n\nexport interface AuthAddAuthorization extends Action {\n    type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n    token: string\n}\n\n// Action Creators\n\n\nexport function authCheckStart(): AuthCheckStart {\n    return {\n        type: ActionFlag.AUTH_CHECK_START\n    }\n}\n\nexport function authCheckError(error: AppError): AuthCheckError {\n    return {\n        type: ActionFlag.AUTH_CHECK_ERROR,\n        error\n    }\n}\n\nexport function authAuthorized(token: string, username: string, realname: string, roles: Array<string>): AuthAuthorized {\n    return {\n        type: ActionFlag.AUTH_AUTHORIZED,\n        token, username, realname, roles\n    }\n}\n\nexport function authUnauthorized(): AuthUnauthorized {\n    return {\n        type: ActionFlag.AUTH_UNAUTHORIZED\n    }\n}\n\n// export function authRemoveAuthorization(): AuthRemoveAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n//     }\n// }\n\n// export function authAddAuthorization(token: string): AuthAddAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n//         token: token\n//     }\n// }\n\n// Action Thunks\n\nexport function checkAuth() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(authCheckStart())\n\n        const {\n            app: {\n                config: {\n                    services: {\n                        Auth: { url }\n                    }\n                }\n            }\n        } = getState()\n\n        // TODO: get the auth from the kbase-ui integration api, perhaps a postmessage call\n\n        const token = Cookies.get('kbase_session')\n        if (!token) {\n            dispatch(authUnauthorized())\n            return\n        }\n\n        const auth = new AuthClient({ url: url })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function authRemoveAuthorization() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // remove cookie\n        Cookies.remove('kbase_session')\n\n        // remove auth in state\n        dispatch(authUnauthorized())\n    }\n}\n\nexport function authAddAuthorization(token: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n\n        const {\n            app: {\n                config: {\n                    services: {\n                        Auth: { url }\n                    }\n                }\n            }\n        } = getState()\n\n        // add cookie\n        Cookies.set('kbase_session', token)\n\n        // TODO: get auth info\n        const auth = new AuthClient({ url: url })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, AuthState, Authorization } from '../types'\nimport Auth from '../components/Auth'\nimport * as actions from '../redux/actions/auth'\n\nexport interface OwnProps {\n    hosted: boolean\n}\n\ninterface StateProps {\n    authorization: Authorization\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n}\n\ninterface DispatchProps {\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const { auth } = state\n    return {\n        authorization: auth\n        // authStatus: status,\n        // token: authorization.token || null,\n        // username: authorization.username || null,\n        // realname: authorization.realname || null\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        checkAuth: () => {\n            dispatch(actions.checkAuth() as any)\n        },\n        onRemoveAuthorization: () => {\n            dispatch(actions.authRemoveAuthorization() as any)\n        },\n        onAddAuthorization: (token: string) => {\n            dispatch(actions.authAddAuthorization(token) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Auth)","\nimport uuidv4 from 'uuid/v4'\n\ninterface ListenerParams {\n    name: string,\n    onSuccess: (payload: Payload) => void,\n    onError: (error: Error) => void\n}\n\nclass Listener {\n    name: string;\n    onSuccess: (payload: Payload) => void;\n    onError: (error: Error) => void;\n\n    constructor({ name, onSuccess, onError }: ListenerParams) {\n        this.name = name;\n        this.onSuccess = onSuccess;\n        this.onError = onError;\n    }\n}\n\ntype Payload = any;\n\ninterface WaitingListenerParams extends ListenerParams {\n    timeout?: number\n}\n\nclass WaitingListener extends Listener {\n    started: Date;\n    timeout: number;\n\n    constructor(params: WaitingListenerParams) {\n        super(params);\n        this.started = new Date();\n        this.timeout = params.timeout || 5000;\n    }\n}\n\ninterface Envelope {\n    channelId: string\n    id: string\n}\n\nclass Message {\n    name: string;\n    payload: any;\n    id: string;\n    created: Date;\n    channelId: string\n    envelope: Envelope | null\n\n    constructor({ name, payload, channelId }: { name: string, payload: any, channelId: any }) {\n        this.name = name\n        this.payload = payload\n        this.id = uuidv4()\n        this.created = new Date()\n        this.channelId = channelId\n        this.envelope = null;\n    }\n\n    getMessage() {\n        return {\n            envelope: {\n                id: this.id,\n                created: this.created,\n                channelId: this.channelId\n            },\n            name: this.name,\n            payload: this.payload\n        };\n    }\n}\n\ninterface Handler {\n    started: Date,\n    handler: (response: any) => any\n}\n\ninterface ChannelParams {\n    window?: Window,\n    host?: string,\n    channelId?: string\n}\n\nexport class Channel {\n    window: Window\n    host: string\n    id: string\n    awaitingResponse: Map<string, Handler>\n    waitingListeners: Map<string, Array<Listener>>\n    listeners: Map<string, Array<Listener>>\n    lastId: number\n    sentCount: number\n    receivedCount: number\n    unwelcomeReceivedCount: number\n    unwelcomeReceivedCountThreshhold: number\n    unwelcomeReceiptWarning: boolean\n    unwelcomeReceiptWarningCount: number\n    currentListener: ((message: MessageEvent) => void) | null\n\n    constructor(params: ChannelParams) {\n        // The given window upon which we will listen for messages.\n        this.window = params.window || window\n\n        // The host for the window; required for postmessage\n        if (this.window.document === null) {\n            throw new Error('No document')\n        }\n        if (this.window.document.location === null) {\n            throw new Error('No location')\n        }\n        this.host = params.host || this.window.document.location.origin;\n\n        // The channel id. Used to filter all messages received to\n        // this channel.\n        this.id = params.channelId || uuidv4()\n\n        this.awaitingResponse = new Map<string, Handler>()\n        this.waitingListeners = new Map<string, Array<Listener>>()\n        this.listeners = new Map<string, Array<Listener>>()\n\n        this.lastId = 0\n        this.sentCount = 0\n        this.receivedCount = 0\n\n        this.unwelcomeReceivedCount = 0\n        this.unwelcomeReceivedCountThreshhold = 100\n        this.unwelcomeReceiptWarning = true\n        this.unwelcomeReceiptWarningCount = 0\n        this.currentListener = null\n    }\n\n    genId() {\n        this.lastId += 1;\n        return 'msg_' + String(this.lastId);\n    }\n\n    receiveMessage(messageEvent: MessageEvent) {\n        const message = messageEvent.data as Message;\n        if (!message) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('TS No message data; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!message.envelope) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message envelope, not from KBase; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!(message.envelope.channelId === this.id)) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('Message envelope does not match this channel\\'s id', message.envelope, message.envelope.channelId, this.id);\n            }\n            return;\n        }\n        if (this.unwelcomeReceiptWarningCount > this.unwelcomeReceivedCountThreshhold) {\n            this.unwelcomeReceiptWarning = false;\n            console.warn('Unwelcome message warning disabled after ' + this.unwelcomeReceiptWarningCount + ' instances.');\n        }\n\n        // A message sent as a request will have registered a response handler\n        // in the awaitingResponse hash, using a generated id as the key.\n        // TODO: to to rethink using the message id here. Perhaps somehting like a\n        // chain of ids, the root of which is the origination id, which is the one\n        // known here when it it is sent; the message \"id\" should be assigned whenver\n        // a message is sent, but a response  message would include the original\n        // message in the \"chain\"...\n\n        // We can also have awaiting responses without an originating request.\n        // These are useful for, e.g., a promise which awaits a message to be sent\n        // within some window...\n        if (message.envelope.id && this.awaitingResponse.has(message.envelope.id)) {\n            try {\n                const response = this.awaitingResponse.get(message.envelope.id)\n                this.awaitingResponse.delete(message.envelope.id)\n                if (response) {\n                    response.handler(message.payload)\n                }\n            } catch (ex) {\n                console.error('Error handling response for message ', message, ex);\n            }\n        }\n\n        // and also awaiting by message name. Like a listener, but they are only used\n        // once.\n\n        if (this.waitingListeners.has(message.name)) {\n            const awaiting = this.waitingListeners.get(message.name)!\n            this.waitingListeners.delete(message.name)\n            awaiting.forEach((listener) => {\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n        // Otherwise, permanently registered handlers are found in the listeners for the\n        // message name.\n        if (this.listeners.has(message.name)) {\n            this.listeners.get(message.name)!.forEach((listener) => {\n                if (!listener.onSuccess) {\n                    console.warn('no handler for listener!', listener);\n                }\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n    }\n\n    listen(listener: Listener) {\n        if (!this.listeners.has(listener.name)) {\n            this.listeners.set(listener.name, [])\n        }\n        this.listeners.get(listener.name)!.push(listener)\n    }\n\n    on(messageId: string, success: (payload: any) => any, error: (error: Error) => void) {\n        this.listen(new Listener({\n            name: messageId,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    sendMessage(message: Message) {\n        this.window.postMessage(message.getMessage(), this.host)\n    }\n\n    send(name: string, payload: Payload) {\n        const message = new Message({ name, payload, channelId: this.id });\n        this.sendMessage(message);\n    }\n\n    sendRequest(message: Message, handler: (response: any) => any) {\n        this.awaitingResponse.set('message.id', {\n            started: new Date(),\n            handler: handler\n        })\n\n        this.sendMessage(message);\n    }\n\n    request(name: string, payload: Payload) {\n        return new Promise((resolve, reject) => {\n            try {\n                this.sendRequest(new Message({ name, payload, channelId: this.id }), (response: any) => {\n                    resolve(response);\n                });\n            } catch (ex) {\n                reject(ex);\n            }\n        });\n    }\n\n    startMonitor() {\n        window.setTimeout(() => {\n            const now = new Date().getTime();\n\n            // first take care of listeners awaiting a message.\n            for (const [id, listeners] of this.waitingListeners.entries()) {\n                const newListeners = listeners.filter((listener) => {\n                    if (listener instanceof WaitingListener) {\n                        const elapsed = now - listener.started.getTime();\n                        if (elapsed > listener.timeout) {\n                            try {\n                                if (listener.onError) {\n                                    listener.onError(new Error('timout after ' + elapsed));\n                                }\n                            } catch (ex) {\n                                console.error('Error calling error handler', id, ex);\n                            }\n                            return false;\n                        } else {\n                            return true;\n                        }\n                    } else {\n                        return true;\n                    }\n                });\n                if (newListeners.length === 0) {\n                    this.waitingListeners.delete(id)\n                }\n            }\n\n            if (this.waitingListeners.size > 0) {\n                this.startMonitor()\n            }\n        }, 100);\n    }\n\n    listenOnce(listener: WaitingListener) {\n        if (!this.waitingListeners.has(listener.name)) {\n            this.waitingListeners.set(listener.name, [])\n        }\n        this.waitingListeners.get(listener.name)!.push(listener);\n        if (listener.timeout) {\n            this.startMonitor();\n        }\n    }\n\n    once(name: string, success: (payload: Payload) => void, error: (error: Error) => void) {\n        this.listenOnce(new WaitingListener({\n            name: name,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    when(name: string, timeout: number) {\n        return new Promise((resolve, reject) => {\n            return this.listenOnce(new WaitingListener({\n                name: name,\n                timeout: timeout,\n                onSuccess: (payload) => {\n                    resolve(payload);\n                },\n                onError: (error) => {\n                    reject(error);\n                }\n            }));\n        });\n    }\n\n    stats() {\n        return {\n            sent: this.sentCount,\n            received: this.receivedCount\n        };\n    }\n\n    attach(window: Window) {\n        this.window = window;\n    }\n\n    start() {\n        this.currentListener = (message: MessageEvent) => {\n            this.receiveMessage(message);\n        };\n        this.window.addEventListener('message', this.currentListener, false);\n    }\n\n    stop() {\n        if (this.currentListener) {\n            this.window.removeEventListener('message', this.currentListener, false);\n        }\n    }\n}\n","import uuid from 'uuid/v4'\nimport { Channel } from './windowChannel'\nimport { IFrameParams } from '../types'\n\n// export interface IFrameParams {\n//     channelId: string\n//     frameId: string\n//     params: {\n//         groupsServiceURL: string\n//         userProfileServiceURL: string\n//         workspaceServiceURL: string\n//         serviceWizardURL: string\n//         authServiceURL: string\n//         originalPath: string | null,\n//         view: string | null,\n//         viewParams: any\n//     },\n//     parentHost: string\n// }\n/*\n channelId: \"3b33179e-8a6d-4ae9-bc95-af4c0492eaa6\"\nframeId: \"frame_kb_html_be553ee5-645c-4737-80ba-dcb642632f0c\"\nhostId: \"host_kb_html_9a3b5d5d-bb92-43ff-a443-73267aa31323\"\nparams: {}\nparentHost: \"https://ci.kbase.us\"\n\n*/\n\n/*\nIFrameSimulator\nThis little doozey allows us to create a simulated iframe. We can query it for\n the params placed on the iframe, and talk to it via the window channel -- it has \n its own window channel.\n Good thing we designed the channel for multiple channels per window.\n*/\nclass IFrameSimulator {\n    params: IFrameParams | null\n    channel: Channel\n\n    constructor() {\n        this.params = null\n\n        // create a window channel.\n\n        this.channel = new Channel({\n            window: window,\n            host: document.location!.origin\n        })\n\n    }\n\n    getParamsFromIFrame(): IFrameParams {\n        return {\n            channelId: this.channel.id,\n            frameId: uuid(),\n            params: {\n                groupsServiceURL: '/services/groups',\n                userProfileServiceURL: '/services/user_profile/rpc',\n                workspaceServiceURL: '/services/ws',\n                serviceWizardURL: '/services/service_wizard',\n                authServiceURL: '/services/auth',\n                originalPath: '',\n                view: null,\n                viewParams: null\n                // view: 'org',\n                // viewParams: {\n                //     id: 'test'\n                // }\n            },\n            parentHost: document.location!.origin\n        }\n    }\n}\n\n\n\nexport default IFrameSimulator","import { IFrameParams } from '../types'\n// export interface IFrameParams {\n//     channelId: string\n//     frameId: string\n//     params: {\n//         groupsServiceURL: string\n//         userProfileServiceURL: string\n//         workspaceServiceURL: string\n//         serviceWizardURL: string\n//         authServiceURL: string\n//         originalPath: string | null,\n//         view: string | null,\n//         viewParams: any\n//     },\n//     parentHost: string\n// }\n\nexport class IFrameIntegration {\n    getParamsFromIFrame() {\n        if (!window.frameElement) {\n            return null\n        }\n        if (!window.frameElement.hasAttribute('data-params')) {\n            // throw new Error('No params found in window!!');\n            return null\n        }\n        const params = window.frameElement.getAttribute('data-params');\n        if (params === null) {\n            // throw new Error('No params found in window!')\n            return null\n        }\n        const iframeParams = JSON.parse(decodeURIComponent(params)) as IFrameParams\n        return iframeParams\n    }\n    getChannelID() {\n        if (!window.frameElement) {\n            return null\n        }\n        if (!window.frameElement.hasAttribute('data-channel')) {\n            return null\n        }\n        return window.frameElement.getAttribute('data-channel')\n    }\n    getIframeElement() {\n        return window.frameElement || null\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as types from '../../types'\nimport IFrameSimulator from '../../lib/IFrameSimulator';\nimport { IFrameIntegration } from '../../lib/IFrameIntegration';\n\nimport { } from 'react-router-dom';\n\n// Action Definitions\n\n// export interface AppStart extends Action {\n//     type: ActionFlag.APP_START,\n\n// }\n\nexport interface AppSuccess extends Action {\n    type: ActionFlag.APP_SUCCESS,\n    config: types.AppConfig\n}\n\nexport interface AppError extends Action {\n    type: ActionFlag.APP_ERROR,\n    error: AppError\n}\n\n// Action Creators\n\nexport function appSuccess(config: types.AppConfig): AppSuccess {\n    return {\n        type: ActionFlag.APP_SUCCESS,\n        config: config\n    }\n}\n\nexport function appError(error: AppError): AppError {\n    return {\n        type: ActionFlag.APP_ERROR,\n        error: error\n    }\n}\n\nexport function appStart() {\n    return (dispatch: ThunkDispatch<types.StoreState, void, Action>, getState: () => types.StoreState) => {\n        // check and see if we are in an iframe\n        let integration = new IFrameIntegration();\n        let iframeParams = integration.getParamsFromIFrame();\n\n\n        if (iframeParams) {\n            let defaultPath\n\n            // set up the message bus.\n            let channelId = iframeParams.channelId;\n\n            // route from paths passed in from kbase-ui\n            switch (iframeParams.params.view) {\n                case 'org':\n                    defaultPath = '/viewOrganization/' + iframeParams.params.viewParams.id\n                    window.history.pushState(null, 'test', defaultPath)\n                    break\n                default:\n                    defaultPath = '/organizations'\n                    window.history.pushState(null, 'organizations', '/organizations')\n                    break\n            }\n\n            // suck up all the params into our state.\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: iframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: iframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: iframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: iframeParams.params.serviceWizardURL\n                    },\n                    Auth: {\n                        url: iframeParams.params.authServiceURL\n                    }\n                },\n                defaultPath,\n                channelId\n            }))\n\n        } else {\n            iframeParams = new IFrameSimulator().getParamsFromIFrame()\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: iframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: iframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: iframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: iframeParams.params.serviceWizardURL\n                    },\n                    Auth: {\n                        url: iframeParams.params.authServiceURL\n                    }\n                },\n                defaultPath: '/organizations',\n                channelId: null\n            }))\n        }\n    }\n}\n","import * as React from 'react'\nimport './KBaseIntegration.css'\n\nimport { AppState } from '../types'\nimport { Channel } from '../lib/windowChannel';\nimport { IFrameIntegration } from '../lib/IFrameIntegration';\n\nexport interface KBaseIntegrationProps {\n    status: AppState\n    channelId: string | null\n    onAppStart: () => void\n}\nclass KBaseIntegration extends React.Component<KBaseIntegrationProps, object> {\n\n    channel: Channel | null\n\n    constructor(props: KBaseIntegrationProps) {\n        super(props)\n\n        // const params = this.getParamsFromIFrame()\n\n        // this.props.onAppStart()\n\n        this.channel = null\n    }\n\n    setupChannel() {\n        if (this.props.channelId) {\n\n            this.channel = new Channel({\n                channelId: this.props.channelId,\n            })\n\n            this.channel.on('navigate', ({ to, params }) => {\n\n            }, (err) => {\n                console.error('Error processing \"navigate\" message')\n            })\n\n            this.channel.start()\n\n            this.channel.send('ready', {\n                channelId: this.props.channelId,\n                greeting: 'heloooo'\n            })\n        }\n    }\n\n    teardownChannel() {\n\n    }\n\n    componentDidMount() {\n        this.props.onAppStart()\n    }\n\n    componentDidUpdate() {\n        this.setupChannel()\n    }\n\n    componentWillUnmount() {\n        this.teardownChannel()\n    }\n\n    render() {\n        if (this.props.status === AppState.NONE) {\n            return (\n                <div className=\"KBaseIntegration\">\n                    Loading...\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"KBaseIntegration scrollable-flex-column\">\n                {this.props.children}\n            </div>\n        )\n    }\n}\n\nexport default KBaseIntegration","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../types'\nimport * as actions from '../redux/actions/app'\n\nimport KBaseIntegration from '../components/KBaseIntegration'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    status: types.AppState\n    defaultPath: string\n    channelId: string | null\n}\n\ninterface DispatchProps {\n    onAppStart: () => void\n}\n\nexport function mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const { app: { status, config: { defaultPath, channelId } } } = state\n    return {\n        status, defaultPath, channelId\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAppStart: () => {\n            dispatch(actions.appStart() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(KBaseIntegration)","import {\n    StoreState, AuthState, AppState,\n    ComponentLoadingState\n} from \"../types\"\n\nimport * as orgModel from '../data/models/organization/model'\n\nexport class StateInstances {\n    static makeInitialState(): StoreState {\n        return {\n            entities: {\n                users: {\n                    byId: new Map(),\n                    all: []\n                },\n                orgs: {\n                    byId: new Map(),\n                    all: []\n                },\n                requests: {\n                    byId: new Map(),\n                    all: []\n                },\n                narratives: {\n                    byId: new Map()\n                },\n                organizations: {\n                    byId: new Map()\n                }\n            },\n            db: {\n            },\n            views: {\n                browseOrgsView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                addOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                editOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                manageOrganizationRequestsView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                viewMembersView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                // inviteUserView: {\n                //     loadingState: ComponentLoadingState.NONE,\n                //     error: null,\n                //     viewModel: null\n                // },\n                manageMembershipView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                },\n                // requestNarrativeView: {\n                //     loadingState: ComponentLoadingState.NONE,\n                //     error: null,\n                //     viewModel: null\n                // },\n                viewOrgView: {\n                    loadingState: ComponentLoadingState.NONE,\n                    error: null,\n                    viewModel: null\n                }\n            },\n            auth: {\n                status: AuthState.NONE,\n                message: '',\n                authorization: {\n                    token: '',\n                    username: '',\n                    realname: '',\n                    roles: []\n                }\n            },\n            error: null,\n            app: {\n                status: AppState.NONE,\n                config: {\n                    baseUrl: '',\n                    services: {\n                        Groups: {\n                            url: ''\n                        },\n                        UserProfile: {\n                            url: ''\n                        },\n                        Workspace: {\n                            url: ''\n                        },\n                        ServiceWizard: {\n                            url: ''\n                        },\n                        Auth: {\n                            url: ''\n                        }\n                    },\n                    defaultPath: '',\n                    channelId: null\n                }\n            },\n\n            updateOrg: {\n                pending: false\n            },\n\n\n        }\n    }\n}","import * as React from 'react'\n\nexport interface Props {\n    onLoad: () => void\n    onUnload: () => void\n}\n\ninterface State {\n\n}\n\nexport default class DataServices extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    componentWillMount() {\n        this.props.onLoad()\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n\n    render() {\n        return this.props.children\n    }\n}\n\n","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\nimport { StoreState } from '../../types';\nimport * as actions from '../../redux/actions/dataServices'\nimport Component from './component'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n\n}\n\ninterface DispatchProps {\n    onLoad: () => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: () => {\n            dispatch(actions.load() as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nexport interface AppContext {\n    test: string\n}\n\nconst context = React.createContext<AppContext | null>(null)\n\nexport const AppContextProvider = context.Provider\nexport const AppContextConsumer = context.Consumer","import React, { Component, FunctionComponent } from 'react'\nimport { Route, Switch, Redirect } from 'react-router'\nimport { BrowserRouter, RouteProps, RouteComponentProps } from 'react-router-dom'\n\n// redux\nimport { Provider } from 'react-redux';\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport thunk from 'redux-thunk'\n\nimport theReducer from './redux/reducers'\n\n// the app and subcomponents\nimport './App.css';\n\n// fontawesome setup\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faSpinner, faSearch, faGlobe, faUserLock } from '@fortawesome/free-solid-svg-icons'\nlibrary.add(faSpinner, faSearch, faGlobe, faUserLock)\n\nimport OrganizationsBrowser from './components/views/browseOrgs/loader'\nimport NewOrganization from './components/views/newOrganization/loader'\nimport ViewOrganization from './components/views/viewOrganization/loader'\nimport Auth from './containers/Auth'\nimport KBaseIntegration from './containers/KBaseIntegration'\nimport { StateInstances } from './redux/state';\nimport DataServices from './components/dataServices/storeAdapter'\nimport { AppContextProvider } from './AppContext'\nimport { Marked, Renderer, MarkedOptions } from 'marked-ts'\n\nclass DescriptionRenderer extends Renderer {\n  constructor(options?: MarkedOptions) {\n    super(options)\n  }\n  link(href: string, title: string, text: string) {\n    if (this.options.sanitize) {\n      let prot: string;\n\n      try {\n        prot = decodeURIComponent(this.options.unescape!(href))\n          .replace(/[^\\w:]/g, '')\n          .toLowerCase()\n      }\n      catch (e) {\n        return text\n      }\n\n      if\n        (\n        prot.indexOf('javascript:') === 0\n        || prot.indexOf('vbscript:') === 0\n        || prot.indexOf('data:') === 0\n      ) {\n        return text\n      }\n    }\n\n    let out = '<a href=\"' + href + '\"';\n\n    if (title) {\n      out += ' title=\"' + title + '\"';\n    }\n\n    out += ' target=\"_blank\">' + text + '</a>';\n\n    return out;\n  }\n}\n\nlet options = new MarkedOptions()\noptions.renderer = new DescriptionRenderer()\nMarked.setOptions({ renderer: new DescriptionRenderer() })\n\n// Put the redux store together\n// Just for prototyping --- This is super naive and will change!\n// import {organizations} from './data/temp';\n\n// TODO: determine the environment\n\nconst hosted = window.frameElement ? true : false\n\n// Set up initial state \n// TODO: move to own file\nconst initialState = StateInstances.makeInitialState()\n\n// TODO: remove the cast of reducer to any...\n// const middleware = [thunk]\n// const store = createStore<StoreState, SortOrgs, null, null>(theReducer as any, initialState, applyMiddleware(thunk));\nconst store = createStore(theReducer as any, initialState as any, compose(applyMiddleware(thunk)))\n\n// export interface WrappedComponent extends React.Component<NewOrganization {\n\n// }\n\n// const Wrapped: FunctionComponent<NewOrganization> = ({component: Component, ...rest}: {component: any}) => {\n//   return (<Route {...rest} render={(props) => {\n//       <Component {...props} />\n//     }} />\n//   )\n// }\n\n\n\ninterface ViewOrgMatchProps {\n  id: string\n}\ntype WrappedProps = RouteComponentProps<ViewOrgMatchProps>\nconst F: React.SFC<WrappedProps> = (props: WrappedProps) => {\n  return (\n    <ViewOrganization organizationId={props.match.params.id} />\n  )\n}\n\n// class F2 extends React.Component<WrappedProps> {\n//   constructor(params: WrappedProps) {\n//     super(params)\n//   }\n//   render() {\n//     return (\n//       <ViewOrganization organizationId={this.props.match.params.id} />\n//     )\n//   }\n// }\n\nclass App extends Component {\n  constructor(props: any) {\n    super(props)\n  }\n\n\n\n  render() {\n    return (\n      <AppContextProvider value={{ test: 'ok' }}>\n        <Provider store={store}>\n          <KBaseIntegration>\n            <Auth hosted={hosted}>\n              <DataServices>\n                <BrowserRouter basename=\"/\" >\n                  <div className=\"App scrollable-flex-column\">\n                    <div className=\"App-body scrollable-flex-column\">\n                      {/* <MainMenu /> */}\n                      <Switch>\n                        <Route path=\"/organizations\" component={OrganizationsBrowser} />\n                        <Route path=\"/newOrganization\" component={NewOrganization} />\n                        <Route path=\"/viewOrganization/:id\" exact={true} component={F} />\n                        {/* <Route path=\"/viewOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ViewOrganization organizationId={id} />} /> */}\n                        <Redirect from=\"/\" to=\"/organizations\" exact={true} />\n                      </Switch>\n                    </div>\n                  </div>\n                </BrowserRouter>\n              </DataServices>\n            </Auth>\n          </KBaseIntegration>\n        </Provider>\n      </AppContextProvider>\n    )\n  }\n}\n\nexport default App\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport 'typeface-oxygen';\nimport 'normalize.css';\nimport 'antd/dist/antd.css'\n\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}