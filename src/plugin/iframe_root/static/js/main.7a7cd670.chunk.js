(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{131:function(e,t,r){},143:function(e,t,r){e.exports=r(299)},148:function(e,t,r){},156:function(e,t,r){},158:function(e,t,r){},160:function(e,t,r){},162:function(e,t,r){},216:function(e,t,r){},218:function(e,t,r){},235:function(e,t,r){},242:function(e,t,r){},244:function(e,t,r){},246:function(e,t,r){},248:function(e,t,r){},250:function(e,t,r){},252:function(e,t,r){},254:function(e,t,r){},256:function(e,t,r){},270:function(e,t,r){},272:function(e,t,r){},276:function(e,t,r){},278:function(e,t,r){},281:function(e,t,r){},283:function(e,t,r){},285:function(e,t,r){},287:function(e,t,r){},289:function(e,t,r){},291:function(e,t,r){},299:function(e,t,r){"use strict";r.r(t);var n,a,i,s,o,c,u,l,E,d,m,v,p,h,O,R,w,g,f,S,_,A=r(0),N=r.n(A),I=r(18),T=r.n(I),b=(r(148),r(6)),y=r(8),D=r(13),C=r(11),k=r(12),M=r(303),U=r(214),V=r(314),j=r(17),z=r(61),G=r(133),L=r(2),P=r(66),x=r(88);!function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(n||(n={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(a||(a={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(i||(i={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(s||(s={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(o||(o={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(c||(c={})),function(e){e[e.NONE=0]="NONE",e[e.FETCHING=1]="FETCHING",e[e.READY=2]="READY",e[e.EDITING_CAN_SAVE=3]="EDITING_CAN_SAVE",e[e.EDITING_ERRORS=4]="EDITING_ERRORS",e[e.SAVING=5]="SAVING",e[e.SAVED=6]="SAVED",e[e.ERROR=7]="ERROR"}(u||(u={})),function(e){e.NONE="NONE",e.NEW="NEW",e.DIRTY="DIRTY",e.CLEAN="CLEAN"}(l||(l={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(E||(E={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(d||(d={})),function(e){e.NONE="NONE",e.VALID="VALID",e.INVALID="INVALID",e.DIRTY="DIRTY"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.UNEDITED_OK=1]="UNEDITED_OK",e[e.UNEDITED_ERROR=2]="UNEDITED_ERROR",e[e.EDITED_OK=3]="EDITED_OK",e[e.EDITED_ERROR=4]="EDITED_ERROR",e[e.EDITED_WARNING=5]="EDITED_WARNING"}(v||(v={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(p||(p={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(h||(h={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(O||(O={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(g||(g={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(f||(f={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(S||(S={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(_||(_={}));var q,W=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,s=e.info;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,a))).name="AppException",r.code=n,r.message=a,r.detail=i,r.info=s,Error.captureStackTrace&&Error.captureStackTrace(Object(P.a)(Object(P.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(k.a)(t,e),t}(Object(x.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_JOIN_REQUEST=31]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=32]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=33]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=34]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=35]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=36]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=37]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=38]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=39]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=40]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=41]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=42]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=43]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=44]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=45]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=46]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=47]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=48]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=49]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=50]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=51]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=52]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=53]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=54]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.ADD_ORG_LOAD=55]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=56]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=57]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=58]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=59]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=60]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=61]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=62]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH=63]="ADD_ORG_UPDATE_GRAVATAR_HASH",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS=64]="ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS",e[e.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR=65]="ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR",e[e.ADD_ORG_UPDATE_ID=66]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=67]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=68]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=69]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=70]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=71]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=72]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=73]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=74]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=75]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=76]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_EVALUATE=77]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=78]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=79]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=80]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=81]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=82]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=83]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=84]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=85]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=86]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=87]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=88]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=89]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=90]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=91]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=92]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=93]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=94]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=95]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH=96]="EDIT_ORG_UPDATE_GRAVATAR_HASH",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS=97]="EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS",e[e.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR=98]="EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=99]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=100]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=101]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=102]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=103]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=104]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_EVALUATE=105]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=106]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=107]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=108]="AUTH_CHECK",e[e.AUTH_CHECK_START=109]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=110]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=111]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=112]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=113]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=114]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=115]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=116]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=117]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=118]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=119]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=120]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=121]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=122]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=123]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=124]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=125]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=126]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=127]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=128]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=129]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=130]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=131]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=132]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=133]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=134]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=135]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=136]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=137]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=138]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=139]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=140]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=141]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=142]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=143]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=144]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=145]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=146]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=147]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=148]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=149]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=150]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=151]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=152]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=153]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=154]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=155]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=156]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=157]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=158]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=159]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=160]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=161]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=162]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=163]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=164]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=165]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=166]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=167]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=168]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=169]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=170]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=171]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=172]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=173]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=174]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.MANAGE_MEMBERSHIP_UNLOAD=175]="MANAGE_MEMBERSHIP_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD=176]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=177]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=178]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=179]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=180]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=181]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=182]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=183]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=184]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=185]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=186]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=187]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=188]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.DASHBOARD_LOAD=189]="DASHBOARD_LOAD",e[e.DASHBOARD_LOAD_START=190]="DASHBOARD_LOAD_START",e[e.DASHBOARD_LOAD_SUCCESS=191]="DASHBOARD_LOAD_SUCCESS",e[e.DASHBOARD_LOAD_ERROR=192]="DASHBOARD_LOAD_ERROR",e[e.DASHBOARD_UNLOAD=193]="DASHBOARD_UNLOAD",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST=194]="DASHBOARD_CANCEL_OUTBOX_REQUEST",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_START=195]="DASHBOARD_CANCEL_OUTBOX_REQUEST_START",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS=196]="DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR=197]="DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST=198]="DASHBOARD_ACCEPT_INBOX_REQUEST",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_START=199]="DASHBOARD_ACCEPT_INBOX_REQUEST_START",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS=200]="DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR=201]="DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR",e[e.DASHBOARD_REJECT_INBOX_REQUEST=202]="DASHBOARD_REJECT_INBOX_REQUEST",e[e.DASHBOARD_REJECT_INBOX_REQUEST_START=203]="DASHBOARD_REJECT_INBOX_REQUEST_START",e[e.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS=204]="DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_REJECT_INBOX_REQUEST_ERROR=205]="DASHBOARD_REJECT_INBOX_REQUEST_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=206]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=207]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=208]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=209]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=210]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=211]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=212]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=213]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=214]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=215]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=216]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=217]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=218]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=219]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=220]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=221]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=222]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.GLOBAL_ACCESS_NARRATIVE=223]="GLOBAL_ACCESS_NARRATIVE",e[e.GLOBAL_ACCESS_NARRATIVE_START=224]="GLOBAL_ACCESS_NARRATIVE_START",e[e.GLOBAL_ACCESS_NARRATIVE_SUCCESS=225]="GLOBAL_ACCESS_NARRATIVE_SUCCESS",e[e.GLOBAL_ACCESS_NARRATIVE_ERROR=226]="GLOBAL_ACCESS_NARRATIVE_ERROR"}(q||(q={}));var B=function(e,t){switch(t.type){case q.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{saveState:d.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case q.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.UNEDITED,saveState:d.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case q.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{saveState:d.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e,t);case q.ADD_ORG_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case q.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{editState:E.UNEDITED,validationState:m.NONE,saveState:d.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case q.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:R.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case q.ADD_ORG_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case q.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{name:{value:t.name,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{name:{value:t.name,validationState:m.INVALID,editState:E.EDITED,validatedAt:new Date,error:t.error}})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{gravatarHash:{value:t.gravatarHash,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):(console.warn("attempting updateGravatarHashSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{gravatarHash:{value:t.gravatarHash,validationState:m.INVALID,editState:E.EDITED,validatedAt:new Date,error:t.error}})})})})}):(console.warn("attempting updateGravatarHashError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{id:{value:t.id,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{id:{value:t.id,validationState:m.INVALID,editState:E.EDITED,validatedAt:new Date,error:t.error}})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,editState:E.EDITED})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{description:{value:t.description,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{description:{value:t.description,validationState:m.INVALID,editState:E.EDITED,validatedAt:new Date,error:t.error}})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{editState:E.EDITED,newOrganization:Object(L.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:{value:t.isPrivate,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case q.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{validationState:m.VALID})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case q.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{addOrgView:Object(L.a)({},e.views.addOrgView,{viewModel:Object(L.a)({},e.views.addOrgView.viewModel,{validationState:m.INVALID})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};var H=function(e,t){switch(t.type){case q.EDIT_ORG_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case q.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{editState:E.UNEDITED,validationState:m.NONE,saveState:d.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case q.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{saveState:d.SAVING})})})}):e}(e);case q.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.UNEDITED,saveState:d.SAVED})})})}):e}(e);case q.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{saveState:d.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:{value:t.name,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:{value:t.name,validationState:m.INVALID,editState:E.EDITED,validatedAt:new Date,error:t.error}})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{gravatarHash:{value:t.gravatarHash,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{gravatarHash:{value:t.gravatarHash,validationState:m.INVALID,editState:E.EDITED,validatedAt:new Date,error:t.error}})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:{value:t.isPrivate,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:{value:t.description,validationState:m.VALID,editState:E.EDITED,validatedAt:new Date,error:{type:n.NONE}}})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{editState:E.EDITED,editedOrganization:Object(L.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:{value:t.description,validationState:m.INVALID,editState:E.EDITED,validatedAt:new Date,error:t.error}})})})})}):e}(e,t);case q.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{validationState:m.VALID})})})}):e}(e);case q.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{editOrgView:Object(L.a)({},e.views.editOrgView,{viewModel:Object(L.a)({},e.views.editOrgView.viewModel,{validationState:m.INVALID})})})}):e}(e);default:return null}};var Q=function(e,t){switch(t.type){case q.VIEW_ORG_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case q.VIEW_ORG_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,relation:t.relation,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox}}})})}(e,t);case q.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.VIEW_ORG_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrative.workspaceId});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:Object(L.a)({},e.views.viewOrgView,{viewModel:Object(L.a)({},e.views.viewOrgView.viewModel,{organization:Object(L.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r})})})})})}(e,t);case q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewOrgView:Object(L.a)({},e.views.viewOrgView,{viewModel:Object(L.a)({},e.views.viewOrgView.viewModel,{organization:t.organization})})})}):e}(e,t);default:return null}};var F=function(e,t){switch(t.type){case q.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.searchTerms,s=r.sortBy,o=r.sortDirection,c=r.filter,u=r.totalCount,l=r.filteredCount,E=r.selectedOrganizationId,d=r.error,m=r.searching;return Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:{loadingState:R.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,searchTerms:i,sortBy:s,sortDirection:o,filter:c,totalCount:u,filteredCount:l,selectedOrganizationId:E,error:d,searching:m}}})})}(e,t);case q.BROWSE_ORGS_SEARCH:return function(e,t){if(null===e.views.browseOrgsView||null===e.views.browseOrgsView.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=e.views.browseOrgsView.viewModel;return r.filter,r.sortBy,r.sortDirection,Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:Object(L.a)({},e.views.browseOrgsView,{error:null,viewModel:Object(L.a)({},e.views.browseOrgsView.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})})})}(e,t);case q.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.views.browseOrgsView||null===e.views.browseOrgsView.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:Object(L.a)({},e.views.browseOrgsView,{viewModel:Object(L.a)({},e.views.browseOrgsView.viewModel,{searching:!0})})})})}(e);case q.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.views.browseOrgsView||null===e.views.browseOrgsView.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:Object(L.a)({},e.views.browseOrgsView,{viewModel:Object(L.a)({},e.views.browseOrgsView.viewModel,{organizations:t.organizations,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})})})}(e,t);case q.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.views.browseOrgsView||null===e.views.browseOrgsView.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:Object(L.a)({},e.views.browseOrgsView,{viewModel:Object(L.a)({},e.views.browseOrgsView.viewModel,{searching:!1,error:t.error})})})})}(e,t);case q.BROWSE_ORGS_SORT_START:return function(e,t){if(null===e.views.browseOrgsView||null===e.views.browseOrgsView.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=e.views.browseOrgsView.viewModel;return r.searchTerms,r.filter,e.auth.authorization.username,Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:Object(L.a)({},e.views.browseOrgsView,{viewModel:Object(L.a)({},e.views.browseOrgsView.viewModel,{sortBy:t.sortBy,sortDirection:t.sortDirection,searching:!0})})})})}(e,t);case q.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.views.browseOrgsView||null===e.views.browseOrgsView.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(L.a)({},e,{views:Object(L.a)({},e.views,{browseOrgsView:Object(L.a)({},e.views.browseOrgsView,{viewModel:Object(L.a)({},e.views.browseOrgsView.viewModel,{filter:r,searching:!0})})})})}(e,t);default:return null}};var J=function(e,t){switch(t.type){case q.AUTH_CHECK_START:return function(e,t){return Object(L.a)({},e,{auth:{status:c.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case q.AUTH_AUTHORIZED:return function(e,t){return Object(L.a)({},e,{auth:{status:c.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case q.AUTH_UNAUTHORIZED:return function(e,t){return Object(L.a)({},e,{auth:{status:c.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case q.AUTH_CHECK_ERROR:return function(e,t){return Object(L.a)({},e,{auth:{status:c.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var Y=function(e,t){switch(t.type){case q.APP_SUCCESS:return function(e,t){return Object(L.a)({},e,{app:{status:h.READY,config:t.config}})}(e,t);default:return null}};var Z=function(e,t){switch(t.type){case q.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case q.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case q.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageOrganizationRequestsView:Object(L.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(L.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var K,X=function(e,t){switch(t.type){case q.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:R.LOADING,viewModel:null,error:null})})})}(e);case q.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:R.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case q.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:R.ERROR,viewModel:null,error:t.error})})})}(e,t);case q.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{loadingState:R.NONE,viewModel:null,error:null})})})}(e);case q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=a.ADMIN,e):e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{viewModel:Object(L.a)({},e.views.viewMembersView.viewModel,{organization:Object(L.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=a.MEMBER,e):e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{viewMembersView:Object(L.a)({},e.views.viewMembersView,{viewModel:Object(L.a)({},e.views.viewMembersView.viewModel,{organization:Object(L.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}},$=r(4),ee=r.n($),te=r(15);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(K||(K={}));Object(x.a)(Error);var re,ne,ae,ie=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).name="GroupException",r.originalError=e,r}return Object(k.a)(t,e),t}(W),se=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(k.a)(t,e),t}(W),oe=function(){function e(t){var r=t.token,n=t.url;Object(b.a)(this,e),this.token=r,this.url=n}return Object(y.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"getGroups",value:function(){var e=this;(new Date).getTime();return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new ie(e)});case"text/plain":return e.text().then(function(e){throw new se(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n,a,i,s;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new ie(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new se(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new ie(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new se(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{gravatarhash:e.gravatarhash}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{gravatarhash:t.gravatarhash},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"getRequest",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===K.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===K.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===K.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r,n){var a;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function ce(e){var t=function(e){switch(e){case"Invite":return re.INVITATION;case"Request":return re.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return ne.USER;case"workspace":return ne.WORKSPACE;case"catalogmethod":return ne.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,ae.OPEN);switch(r){case ne.USER:return re.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ne.WORKSPACE:return re.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ne.APP:return re.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(re||(re={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(ne||(ne={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(ae||(ae={}));var ue,le,Ee,de=function(){function e(t){Object(b.a)(this,e),this.params=t,this.groupsClient=new oe({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(y.a)(e,[{key:"getRequest",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=ce(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserRequests",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t,r,n,a=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ce(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ce(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ce(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ce(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ce(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t,r,n,a=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ce(e)}).filter(function(e){return e.type===re.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserInvitations",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t,r,n,a=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ce(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:K.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ce(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:K.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return ce(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:K.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return ce(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ce(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ce(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ce(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ce(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ce(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return ce(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),me=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:n.ERROR,message:"Organization id may not be empty"}];if(e.match(/\s/))return[e,{type:n.ERROR,message:"Organization id may not contain a space"}];if(e.length>100)return[e,{type:n.ERROR,message:"Organization id may not be longer than 100 characters"}];return e.match(/^[a-zA-Z0-9_]+$/)?[e,{type:n.NONE}]:[e,{type:n.ERROR,message:"Organization id may only contain alphanumeric (a-z, A-Z, 0-9) and underscore (_)"}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:n.ERROR,message:"Organization name may not be empty"}]:e.length>256?[e,{type:n.ERROR,message:"Organization name may not be longer than 256 characters"}]:[e,{type:n.NONE}]}},{key:"validateOrgGravatarHash",value:function(e){return 0===e.length?[e,{type:n.NONE}]:e.length>32?[e,{type:n.ERROR,message:"Organization gravatar hash may not be longer than 32 characters"}]:[e,{type:n.NONE}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:n.NONE}]:e.length>4096?[e,{type:n.ERROR,message:"Organization description may not be longer than 4,096 characters"}]:[e,{type:n.NONE}]}}]),e}();function ve(e,t,r,n){if(t===e.owner.username)return{type:le.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:le.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:le.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:le.NONE};switch(a.type){case ue.MEMBER:return{type:le.MEMBER};case ue.ADMIN:return{type:le.ADMIN};case ue.OWNER:return{type:le.OWNER};default:return{type:le.NONE}}}function pe(e,t){var r={username:e.owner.name,joinedAt:new Date(e.owner.joined),type:ue.OWNER},n=[].concat(e.admins.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:ue.ADMIN}})).concat(e.members.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:ue.MEMBER}})),a=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:function(e){switch(e){case"None":return Ee.NONE;case"Read":return Ee.VIEW;case"Write":return Ee.EDIT;case"Admin":return Ee.ADMIN;case"Own":return Ee.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}(e.perm)}});return{id:e.id,name:e.name,isPrivate:e.private,isMember:e.ismember,gravatarHash:e.custom.gravatarhash||null,description:e.custom.description,owner:r,members:n,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),narratives:a,apps:[]}}function he(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.owner.username)||t.test(e.owner.username)})})}function Oe(e,t,r){var n=r===O.ASCENDING?1:-1;switch(t){case"created":return e.slice().sort(function(e,t){return n*(e.createdAt.getTime()-t.createdAt.getTime())});case"name":return e.slice().sort(function(e,t){return n*e.name.localeCompare(t.name)});case"owner":return e.slice().sort(function(e,t){return n*e.owner.username.localeCompare(t.owner.username)});default:return console.warn("unimplemented sort field: "+t),e}}function Re(e,t,r){switch(t){case"all":return e;case"memberOf":return e.filter(function(e){return e.members.findIndex(function(e){return e.username===r})>=0});case"owned":return e.filter(function(e){return e.owner.username===r});case"notOwned":return e.filter(function(e){return e.owner.username!==r});default:return console.warn("unknown filter : "+t),e}}me.nonPrintableRe=/[\000-\031]/,function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(ue||(ue={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.MEMBER_REQUEST_PENDING=2]="MEMBER_REQUEST_PENDING",e[e.MEMBER_INVITATION_PENDING=3]="MEMBER_INVITATION_PENDING",e[e.MEMBER=4]="MEMBER",e[e.ADMIN=5]="ADMIN",e[e.OWNER=6]="OWNER"}(le||(le={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(Ee||(Ee={}));var we=function(){function e(t){Object(b.a)(this,e),this.params=t,this.groupsClient=new oe({url:this.params.groupsServiceURL,token:this.params.token}),this.organizations=new Map}return Object(y.a)(e,[{key:"getOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.organizations.has(t)){e.next=2;break}return e.abrupt("return",this.organizations.get(t));case 2:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){var n=pe(e,r.params.username);return r.organizations.set(t,n),n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllOrgs",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t,r;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroups();case 2:return t=e.sent,r=t.map(function(e){return e.id}),e.abrupt("return",this.getOrgs(r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t,r=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs();case 2:return t=e.sent,e.abrupt("return",t.filter(function(e){return e.owner.username===r.params.username||!!e.members.find(function(e){return e.username===r.params.username})}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs();case 2:return r=e.sent,n=Re(r,t.filter,t.username),a=he(n,t.searchTerms),i=Oe(a,t.sortBy,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs();case 2:return e.sent,r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=6,r.getGroups();case 6:return n=e.sent,a=n.filter(function(e){return e.owner.name===t||(!!e.members.find(function(e){return e.name===t})||!!e.admins.find(function(e){return e.name===t}))}),i=a.map(function(e){return pe(e)}),e.abrupt("return",{organizations:i,total:i.length});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",ce(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var a;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new oe({url:this.params.groupsServiceURL,token:this.params.token}),!(t.id.error&&t.id.error.type===n.ERROR||t.name.error&&t.name.error.type===n.ERROR||t.gravatarHash.error&&t.gravatarHash.error.type===n.ERROR||t.description.error&&t.description.error.type===n.ERROR||t.isPrivate.error&&t.isPrivate.error.type===n.ERROR)){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.abrupt("return",a.createGroup({id:t.id.value,name:t.name.value,gravatarhash:t.gravatarHash.value,description:t.description.value,isPrivate:t.isPrivate.value}).then(function(e){return pe(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,gravatarhash:r.gravatarHash,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return me.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return me.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return me.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembershipToGroup",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",ce(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n,a;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new oe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",ce(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(e,t){return new oe({url:this.params.groupsServiceURL,token:this.params.token}).memberToAdmin({groupId:e,member:t})}},{key:"adminToMember",value:function(e,t){return new oe({url:this.params.groupsServiceURL,token:this.params.token}).adminToMember({groupId:e,member:t})}},{key:"removeMember",value:function(e,t){return new oe({url:this.params.groupsServiceURL,token:this.params.token}).removeMember({groupId:e,member:t})}}]),e}();function ge(e,t){if(t)return Ee.OWNER;switch(e){case"r":return Ee.VIEW;case"w":return Ee.EDIT;case"a":return Ee.ADMIN;default:throw new Error("Invalid workspace user permission: "+e)}}var fe=function(e,t){switch(t.type){case q.INVITE_USER_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:R.LOADING})})})}(e);case q.INVITE_USER_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:R.SUCCESS,error:null,viewModel:{editState:g.EDITING,users:t.users,organization:t.organization,selectedUser:null}})})})}(e,t);case q.INVITE_USER_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:R.SUCCESS,error:t.error,viewModel:null})})})}(e,t);case q.INVITE_USER_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{loadingState:R.NONE,error:null,viewModel:null})})})}(e);case q.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{users:t.users})})})})}(e,t);case q.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})})})}(e,t);case q.INVITE_USER_SEND_INVITATION_START:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{editState:g.SENDING})})})})}(e);case q.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");var r=e.views.inviteUserView.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=le.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=le.MEMBER_INVITATION_PENDING),e});return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{editState:g.SUCCESS,selectedUser:n,users:i})})})})}(e);case q.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{inviteUserView:Object(L.a)({},e.views.inviteUserView,{viewModel:Object(L.a)({},e.views.inviteUserView.viewModel,{editState:g.ERROR})})})})}(e);default:return null}};var Se=function(e,t){switch(t.type){case q.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case q.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization}}})})}(e,t);case q.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:R.LOADING,error:t.error,viewModel:null}})})}(e,t);case q.MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{manageMembershipView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);default:return null}};function _e(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{viewModel:Object(L.a)({},e.views.requestNarrativeView.viewModel,{saveState:d.SAVING})})})})}var Ae=function(e,t){switch(t.type){case q.REQUEST_ADD_NARRATIVE_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{loadingState:R.LOADING,error:null,viewModel:null})})})}(e);case q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,saveState:d.SAVED}})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{loadingState:R.ERROR,error:t.error,viewModel:null})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_SEND_START:return _e(e);case q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");var r=Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{viewModel:Object(L.a)({},e.views.requestNarrativeView.viewModel,{saveState:d.SAVED})})})}),n=r.views.requestNarrativeView.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=f.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=f.REQUESTED),e}),r}(e,t);case q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return _e(e);case q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:Object(L.a)({},e.views.requestNarrativeView,{error:null,viewModel:Object(L.a)({},e.views.requestNarrativeView.viewModel,{selectedNarrative:t.narrative})})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{requestNarrativeView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);default:return null}};function Ne(e,t){switch(t.type){case q.DASHBOARD_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{dashboardView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case q.DASHBOARD_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{dashboardView:{loadingState:R.SUCCESS,error:null,viewModel:{organizations:t.organizations,notifications:[],pendingRequests:t.requests,pendingInvitations:t.invitations,pendingAdminRequests:t.pendingGroupRequests}}})})}(e,t);case q.DASHBOARD_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{dashboardView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.DASHBOARD_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{dashboardView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case q.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS:return function(e,t){return Object(L.a)({},e,{view:Object(L.a)({},e.views,{dashboardView:Object(L.a)({},e.views.dashboardView,{viewModel:Object(L.a)({},e.views.dashboardView.viewModel,{pendingRequests:t.requests})})})})}(e,t);default:return null}}var Ie=function(e,t){switch(t.type){case q.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{users:Object(L.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case q.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{orgs:Object(L.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case q.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{narratives:{byId:new Map(r.byId)}})})}(e,t);default:return null}};var Te=function(e,t){switch(t.type){case q.ORGANIZATION_CENTRIC_VIEW_LOAD_START:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case q.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:Object(L.a)({},e.views.organizationCentricView,{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,pendingJoinRequest:t.pendingJoinRequest,pendingJoinInvitation:t.pendingJoinInvitation,relation:t.relation}})})})}(e,t);case q.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:Object(L.a)({},e.views.organizationCentricView,{loadingState:R.ERROR,error:t.error,viewModel:null})})})}(e,t);case q.ORGANIZATION_CENTRIC_VIEW_UNLOAD:return function(e,t){return Object(L.a)({},e,{views:Object(L.a)({},e.views,{organizationCentricView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);default:return null}};function be(e,t){switch(t.type){case q.GLOBAL_ACCESS_NARRATIVE_SUCCESS:return function(e,t){var r=e.entities.narratives.byId;return r.set(t.narrative.workspaceId,t.narrative),Object(L.a)({},e,{entities:Object(L.a)({},e.entities,{narratives:Object(L.a)({},e.entities.narratives,{byId:r})})})}(e,t);default:return null}}var ye,De=function(e,t){return B(e,t)||H(e,t)||F(e,t)||Q(e,t)||J(e,t)||Y(e,t)||Z(e,t)||X(e,t)||fe(e,t)||Se(e,t)||Ae(e,t)||Ne(e,t)||Ie(e,t)||Te(e,t)||be(e,t)||e},Ce=(r(156),r(134)),ke=r(72),Me=r(313),Ue=(r(158),r(315)),Ve=(r(160),r(162),function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:"./nouserpic.png";case"silhouette":case"mysteryman":default:return"./nouserpic.png"}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return A.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(A.Component)),je=r(19);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(ye||(ye={}));var ze=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={view:ye.COMPACT},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case ye.COMPACT:return ye.NORMAL;case ye.NORMAL:return ye.COMPACT}}(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case ue.OWNER:return A.createElement("span",null,A.createElement(je.a,{type:"crown"})," owner");case ue.ADMIN:return A.createElement("span",null,A.createElement(je.a,{type:"unlock"})," admin");case ue.MEMBER:return A.createElement("span",null,A.createElement(je.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){return A.createElement("div",{className:"Member View-COMPACT"},A.createElement("div",{className:"avatarCol"},A.createElement(Ve,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),A.createElement("div",{className:"role"},this.renderRole()),A.createElement("div",{className:"joinedAt"},A.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt))),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===ye.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===ye.NORMAL?"up":"down")}))))}},{key:"renderNormal",value:function(){return A.createElement("div",{className:"Member View-NORMAL"},A.createElement("div",{className:"avatarCol"},A.createElement(Ve,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),A.createElement("div",{className:"role"},this.renderRole()),A.createElement("div",{className:"joinedAt"},A.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt)),A.createElement("div",{className:"title"},this.props.user.title||A.createElement("i",null,"no title in user profile")),A.createElement("div",{className:"organization"},this.props.user.organization||A.createElement("i",null,"no organization in user profile")),A.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||A.createElement("i",null,"no location information in user profile"))),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===ye.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===ye.NORMAL?"up":"down")}))))}},{key:"render",value:function(){switch(this.state.view){case ye.COMPACT:return this.renderCompact();case ye.NORMAL:return this.renderNormal()}}}]),t}(A.Component),Ge=function(){function e(t){var r=t.url,n=t.token;Object(b.a)(this,e),this.url=r,this.token=n}return Object(y.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var t=Object(te.a)(ee.a.mark(function t(r){return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.profileCache.has(r)){t.next=2;break}return t.abrupt("return",Promise.resolve(e.profileCache.get(r)));case 2:return t.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",[r]))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0][0]}));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",e))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}},{key:"getAllUsers",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:""}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}},{key:"searchUsers",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:e}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}}]),e}();function Le(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}Ge.profileCache=new Map;var Pe=function(){function e(t){Object(b.a)(this,e),this.params=t,this.userProfileClient=new Ge({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(y.a)(e,[{key:"getUser",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=Le(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return Le(e)}),a.forEach(function(e){var t=Le(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),xe=r(20),qe=function(e){function t(e){var r;if(Object(b.a)(this,t),r=Object(D.a)(this,Object(C.a)(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"callFunc",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(b.a)(this,e),this.url=r,this.token=n||null,this.module=a}return Object(y.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i,s,o;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=13;break}return e.next=3,t.json();case 3:if(r=e.sent,n=r.result,a=r.error,!n){e.next=10;break}return e.abrupt("return",[n,null]);case 10:return e.abrupt("return",[null,a]);case 11:e.next=15;break;case 13:if(204!==t.status){e.next=15;break}return e.abrupt("return",[null,null]);case 15:if(500!==t.status){e.next=28;break}if("application/json"!==t.headers.get("Content-Type")){e.next=24;break}return e.next=19,t.json();case 19:return i=e.sent,s=i.error,e.abrupt("return",[null,s]);case 24:return e.next=26,t.text();case 26:return o=e.sent,e.abrupt("return",[null,{code:0,name:"Internal Server Error (for real)",message:"The service experienced an internal error",error:o}]);case 28:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){return n.processResponse(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),We=r(73),Be=r.n(We),He=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(function(e){function t(e){var r;if(Object(b.a)(this,t),r=Object(D.a)(this,Object(C.a)(t).call(this,e)),!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(function(){function e(t){var r=t.url,n=t.token;Object(b.a)(this,e),this.url=r,this.token=n||null}return Object(y.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}()));He.module="ServiceWizard";var Qe,Fe,Je=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(b.a)(this,e),this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(y.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new Be.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var s=(new Date).getTime()-a;s>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+s))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):Be.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),Ye=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"listNarratives",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(xe.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,s=t.rpcContext;if(Object(b.a)(this,e),this.token=r,this.timeout=i||1e4,this.rpcContext=s||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(y.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return Je.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new He({url:e.url,token:e.token});return Be.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new qe({module:n.module_name,url:n.url,token:r.token});return Be.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}());function Ze(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function Ke(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:Ze(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:1===e[6],lockStatus:e[7],metadata:e[8]}}function Xe(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:Ze(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}Ye.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(Qe||(Qe={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(Fe||(Fe={}));var $e=function(){function e(t){Object(b.a)(this,e),this.params=t}return Object(y.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i,s,o,c,u,l;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ye({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new we({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),a=new de({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:return i=e.sent,s=Object(xe.a)(i,3),o=s[0],c=s[1],u=s[2],l=c.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",o.narratives.map(function(e){return{workspaceInfo:Ke(e.ws),objectInfo:Xe(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){var t;return t=-1!==l.indexOf(e.workspaceInfo.id)?Qe.ASSOCIATED:u.find(function(t){return t.resourceType===ne.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?Qe.REQUESTED:Qe.NONE,{workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,status:t,modifiedAt:e.workspaceInfo.modifiedAt}}).sort(function(e,t){return e.title.localeCompare(t.title)}));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"workspaceToNarrative",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i,s,o,c,u,l,E,d;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new qe({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,Promise.all([r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:1}],includeMetadata:1,ignoreErrors:0}]),r.callFunc("get_workspace_info",[{id:t}])]);case 4:if(n=e.sent,a=Object(xe.a)(n,2),i=Object(xe.a)(a[0],2),s=Object(xe.a)(i[0],1),s[0],o=i[1],c=Object(xe.a)(a[1],2),u=Object(xe.a)(c[0],1),l=u[0],E=c[1],!o&&!E){e.next=17;break}return console.warn("narrative not accessible",o,E),e.abrupt("return",null);case 17:return d=Ke(l),e.abrupt("return",{workspaceId:d.id,title:d.metadata.narrative_nice_name||"Unknown",permission:ge(d.userPermission,d.owner===this.params.username),isPublic:d.globalReadPermission});case 21:return e.prev=21,e.t0=e.catch(1),console.warn("narrative not accessible",e.t0),e.abrupt("return",null);case 25:case"end":return e.stop()}},e,this,[[1,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getNarrative",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i,s,o,c,u,l,E,d,m;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new qe({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,Promise.all([r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:1}],includeMetadata:1,ignoreErrors:0}]),r.callFunc("get_workspace_info",[{id:t}])]);case 4:if(n=e.sent,a=Object(xe.a)(n,2),i=Object(xe.a)(a[0],2),s=i[0],o=i[1],c=Object(xe.a)(a[1],2),u=c[0],l=c[1],!o&&!l){e.next=15;break}return console.warn("narrative not accessible",o,l),e.abrupt("return",{workspaceId:t,access:Fe.NONE});case 15:E=Ke(u[0]),d=Xe(s[0].infos[0]),e.t0=E.userPermission,e.next="n"===e.t0?20:"r"===e.t0?26:"w"===e.t0?28:"a"===e.t0?30:32;break;case 20:if(!E.globalReadPermission){e.next=25;break}return m=Fe.VIEW,e.abrupt("break",33);case 25:throw new Error("Cannot have no access and no global read permission!");case 26:return m=Fe.VIEW,e.abrupt("break",33);case 28:return m=Fe.EDIT,e.abrupt("break",33);case 30:return m=E.owner===this.params.username?Fe.OWNER:Fe.ADMIN,e.abrupt("break",33);case 32:throw new Error("Unknown workspace permission: "+E.userPermission);case 33:return e.abrupt("return",{workspaceId:E.id,access:m,isPublic:E.globalReadPermission,objectId:d.id,title:E.metadata.narrative_nice_name||"Unknown",owner:E.owner,lastSavedAt:d.savedAt,lastSavedBy:d.savedBy});case 36:throw e.prev=36,e.t1=e.catch(1),console.error("Error fetching narrative!",e.t1),e.t1;case 40:case"end":return e.stop()}},e,this,[[1,36]])}));return function(t){return e.apply(this,arguments)}}()}]),e}();function et(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,s=i.token,i.username,o=a.app.config,c=new Pe({token:s,userProfileServiceURL:o.services.UserProfile.url}),t.prev=3,t.next=6,c.getUser(e);case 6:u=t.sent,r((E=u,{type:q.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((l={code:"error",message:t.t0.message},{type:q.ENTITY_USER_LOADER_ERROR,error:l}));case 13:case"end":return t.stop()}var l,E},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}var tt=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.user?A.createElement(ze,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):(this.props.onLoad(this.props.member.username),A.createElement("div",null,"Loading user..."))}}]),t}(A.Component);var rt=Object(j.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(et(t))}}})(tt),nt=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"getAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderAvatar",value:function(e){return A.createElement("img",{style:{width:64,height:64},src:this.getAvatarUrl(e)})}},{key:"renderRelation",value:function(e){return A.createElement("div",null,"disabled")}},{key:"renderAdminInfo",value:function(e){return A.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(e){return A.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderRelationInfo",value:function(e){return A.createElement("div",null,"disabled")}},{key:"renderOrg",value:function(e,t){return A.createElement("div",{className:"row organization",key:String(t)},A.createElement("div",{className:"col2"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),A.createElement("div",{className:"col1"},A.createElement("div",{className:"orgName"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},e.name)),A.createElement("div",{className:"orgOwner"},A.createElement("span",{className:"field-label"},"owner"),A.createElement("span",{className:"field-value"},A.createElement(rt,{member:e.owner,avatarSize:30}))),A.createElement("div",{className:"orgCreated"},A.createElement("span",{className:"field-label"},"established"),A.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))))}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,r){return e.renderOrg(t,r)}):A.createElement(Ue.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return A.createElement("div",{className:"Organizations"},A.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(A.Component);var at=Object(j.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");return{organizations:e.views.browseOrgsView.viewModel.organizations}})(nt),it=(r(216),r(306)),st=r(65),ot=r(305),ct=(r(218),function(e){function t(){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).apply(this,arguments))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return A.createElement(je.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"render",value:function(){return A.createElement("div",{className:"Header"},A.createElement("div",{className:"defaultCrumbs"},A.createElement(Me.a,{to:"/"},A.createElement(je.a,{type:"team",style:{verticalAlign:"middle"}})," ",A.createElement("span",{"data-test":"orgs-label"},"Orgs")),this.buildSeparator()),A.createElement("div",{className:"userColumn"},A.createElement("div",{className:"breadcrumbs"},this.props.breadcrumbs),A.createElement("div",{className:"buttons"},this.props.buttons)))}}]),t}(A.Component)),ut=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).searchInput=A.createRef(),r.searchButton=A.createRef(),r.state={searchInput:"",showInfo:!1},r.props.onSearchOrgs([]),r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onShowInfo",value:function(){it.a.info({title:"Organizations Browser Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the organizations browser..."))})}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){this.props.onSortOrgs(e.target.value,this.props.sortDirection)}},{key:"onSortByChange2",value:function(e){this.props.onSortOrgs(e,this.props.sortDirection)}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onSortDirectionChange2",value:function(e){this.props.onSortOrgs(this.props.sortBy,e)}},{key:"onFilterChange",value:function(e){this.props.onFilterOrgs(e.target.value)}},{key:"onFilterChange2",value:function(e){this.props.onFilterOrgs(e)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?A.createElement("span",null,"No organizations in the system"):0===this.props.filteredCount?A.createElement("span",null,"No organizations found out of"," ",this.props.totalCount," ","available."):this.props.totalCount===this.props.filteredCount?A.createElement("span",null,"Showing all"," ",this.props.totalCount," ","organizations"):A.createElement("span",null,"Showing"," ",this.props.filteredCount," ","out of"," ",this.props.totalCount," ","organizations")}},{key:"renderSearchIcon",value:function(){return this.props.searching?A.createElement(je.a,{type:"loading"}):A.createElement(je.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return A.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},A.createElement("input",{placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),A.createElement(st.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),A.createElement(st.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}))}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,"Browse and Search Organizations"),A.createElement(je.a,{type:"right",style:{margin:"0 4px"}}),A.createElement("span",{style:{fontWeight:"normal",fontStyle:"italic"}},this.renderSearchFeedback())),t=A.createElement(A.Fragment,null,A.createElement(Me.a,{to:"/newOrganization"},A.createElement(st.a,{icon:"plus-circle"},"Create Organization")),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderSearchFilter",value:function(){return A.createElement("div",null,A.createElement("span",{className:"field-label"},"sort by"),A.createElement(ot.a,{onChange:this.onSortByChange2.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},A.createElement(ot.a.Option,{value:"name",key:"name"},"Org name"),A.createElement(ot.a.Option,{value:"owner",key:"owner"},"Owner"),A.createElement(ot.a.Option,{value:"created",key:"created"},"Date created")),A.createElement(ot.a,{onChange:this.onSortDirectionChange2.bind(this),style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},A.createElement(ot.a.Option,{value:O.ASCENDING,key:"name"},A.createElement(je.a,{type:"sort-ascending"}),"Ascending"),A.createElement(ot.a.Option,{value:O.DESCENDING,key:"owner"},A.createElement(je.a,{type:"sort-descending"}),"Descending")),A.createElement("span",{className:"field-label",style:{marginLeft:"10px"}},"filter"),A.createElement(ot.a,{onChange:this.onFilterChange2.bind(this),defaultValue:this.props.filter,style:{width:"16em"},dropdownMatchSelectWidth:!0},A.createElement(ot.a.Option,{value:"all",key:"all"},"All"),A.createElement(ot.a.Option,{value:"memberOf",key:"memberOf"},"You are a member of"),A.createElement(ot.a.Option,{value:"owned",key:"owned"},"Owned by you"),A.createElement(ot.a.Option,{value:"notOwned",key:"notOwned"},"Not owned by you")))}},{key:"renderOrganizations",value:function(){return this.props.error?A.createElement(Ue.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):A.createElement(at,null)}},{key:"render",value:function(){return A.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},this.renderHeader(),A.createElement("div",{className:"searchBarRow"},A.createElement("div",{className:"searchBarCol"},this.renderSearchBar()),A.createElement("div",{className:"sortCol"},this.renderSearchFilter())),A.createElement("div",{className:"bodyRow scrollable-flex-column"},A.createElement("div",{className:"col2 scrollable-flex-column"},this.renderOrganizations())))}}]),t}(A.Component);function lt(e,t){return{type:q.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t}}function Et(e){return{type:q.BROWSE_ORGS_SEARCH_ERROR,error:e}}function dt(){return function(e,t){e({type:q.BROWSE_ORGS_LOAD_START}),e(function(e){return{type:q.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:e}}({rawOrganizations:[],organizations:[],totalCount:0,filteredCount:0,sortBy:"name",sortDirection:O.ASCENDING,filter:"all",searchTerms:[],selectedOrganizationId:null,searching:!1,error:null}))}}function mt(e){return function(t,r){t({type:q.BROWSE_ORGS_SEARCH_START});var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,s=i.token,o=i.username,c=n.app.config;if(null!==a.viewModel){var u=a.viewModel,l=u.sortBy,E=u.sortDirection,d=u.filter;return new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}).queryOrgs({searchTerms:e,sortBy:l,sortDirection:E,filter:d,username:o}).then(function(e){var r=e.organizations,n=e.total;t(lt(r,n))}).catch(function(e){console.error("Error querying orgs",e.name,e.message),t(Et({code:e.name,message:e.message}))})}t(Et({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function vt(e,t){return function(r,n){r(function(e,t){return{type:q.BROWSE_ORGS_SORT_START,sortBy:e,sortDirection:t}}(e,t));var a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,c=s.username,u=a.app.config,l=new we({token:o,username:c,groupsServiceURL:u.services.Groups.url});if(null!==i.viewModel){var E=i.viewModel,d=E.searchTerms,m=E.filter;return l.queryOrgs({searchTerms:d,sortBy:e,sortDirection:t,filter:m,username:c}).then(function(e){var t=e.organizations,n=e.total;r(lt(t,n))}).catch(function(e){r(Et({code:e.name,message:e.message}))})}r(Et({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function pt(e){return function(t,r){t(function(e){return{type:q.BROWSE_ORGS_FILTER_START,filter:e}}(e));var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,s=i.token,o=i.username,c=n.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url});if(null!==a.viewModel){var l=a.viewModel,E=l.searchTerms,d=l.sortBy,m=l.sortDirection;return u.queryOrgs({searchTerms:E,sortBy:d,sortDirection:m,filter:e,username:o}).then(function(e){var r=e.organizations,n=e.total;t(lt(r,n))}).catch(function(e){t(Et({code:e.name,message:e.message}))})}t(Et({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}var ht=Object(j.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.error;return t.searchTerms,t.selectedOrganizationId,{organizations:r,totalCount:t.totalCount,filteredCount:t.filteredCount,sortBy:t.sortBy,sortDirection:t.sortDirection,filter:t.filter,error:n,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(mt(t))},onSortOrgs:function(t,r){e(vt(t,r))},onFilterOrgs:function(t){e(pt(t))}}})(ut),Ot=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Fetching your orgs and other stuff...")}},{key:"renderError",value:function(){if(this.props.view.error)return A.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return A.createElement(ht,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Rt=Object(j.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(dt())},onUnload:function(){e({type:q.BROWSE_ORGS_UNLOAD})}}})(Ot);function wt(e){return{type:q.ADD_ORG_SAVE_ERROR,error:e}}function gt(){return{type:q.ADD_ORG_EVALUATE_ERRORS}}function ft(e){return{type:q.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function St(e,t){return{type:q.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function _t(){return function(e,t){e({type:q.ADD_ORG_LOAD_START});var r,a={id:{value:"",editState:E.NONE,validationState:m.NONE,validatedAt:null,error:{type:n.NONE}},name:{value:"",editState:E.NONE,validationState:m.NONE,validatedAt:null,error:{type:n.NONE}},gravatarHash:{value:"",editState:E.NONE,validationState:m.NONE,validatedAt:null,error:{type:n.NONE}},description:{value:"",editState:E.NONE,validationState:m.NONE,validatedAt:null,error:{type:n.NONE}},isPrivate:{value:!1,editState:E.NONE,validationState:m.NONE,validatedAt:null,error:{type:n.NONE}}};e((r=a,{type:q.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(Nt())}}function At(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:q.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.addOrgView.viewModel.newOrganization,o=r.app.config,c=new we({token:a,username:i,groupsServiceURL:o.services.Groups.url});s?c.addOrg(s,i).then(function(t){e(function(e){return{type:q.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",s,t),e(wt({code:t.code||t.name,message:t.message,exception:t}))}):e(wt({code:"app",message:"The new organization data does not yet exist"}))}else e(wt({code:"invalid",message:"Unexpected condition: no view model"}))}}function Nt(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);if(a)if(a.name.validationState===m.VALID)if(a.id.validationState===m.VALID){if(a.gravatarHash.validationState===m.NONE){if(a.gravatarHash.value){var i=me.validateOrgGravatarHash(name),s=Object(xe.a)(i,2);s[0];if(s[1])return void e(gt())}}else if(a.gravatarHash.validationState!==m.VALID)return void e(gt());a.description.validationState===m.VALID?e({type:q.ADD_ORG_EVALUATE_OK}):e(gt())}else e(gt());else e(gt());else e(gt())}else e(wt({code:"invalid",message:"Unexpected condition: no view model"}))}}function It(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new we({token:r,username:n,groupsServiceURL:a.services.Groups.url})}function Tt(e){return function(t){var r=me.validateOrgName(e),a=Object(xe.a)(r,2),i=a[0],s=a[1];s.type===n.ERROR?t(function(e,t){return{type:q.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(i,s)):t(function(e){return{type:q.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(i)),t(Nt())}}function bt(e){return function(t){var r,a=me.validateOrgGravatarHash(e),i=Object(xe.a)(a,2),s=i[0],o=i[1];o.type===n.ERROR?t(function(e,t){return{type:q.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,gravatarHash:e,error:t}}(s,o)):t((r=s,{type:q.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,gravatarHash:r})),t(Nt())}}var yt=function(){function e(t,r){Object(b.a)(this,e),this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(y.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),Dt=null;function Ct(e){return function(t,r){var a=me.validateOrgId(e),i=Object(xe.a)(a,2),s=i[0],o=i[1];if(o.type===n.ERROR)return t(St(s,o)),void t(Nt());var c=r().views.addOrgView.viewModel;if(c){var u=c.newOrganization.id.validatedAt,l=(new Date).getTime();if(u)if(l-u.getTime()<500)return t(function(e){return{type:q.ADD_ORG_UPDATE_ID_PASS,id:e}}(s)),void(Dt||(Dt=new yt(500,function(){t(function(e,t){var r=t(),a=r.views.addOrgView.viewModel;if(a){var i=a.newOrganization.id,s=me.validateOrgId(i.value),o=Object(xe.a)(s,2),c=o[0],u=o[1];if(u.type===n.ERROR)return e(St(c,u)),void e(Nt());var l=It(t());l.orgExists(c).then(function(t){e(t?St(c,{type:n.ERROR,message:"This org id is already in use"}):ft(c)),e(Nt())})}})})));Dt&&Dt.cancel(),Dt=null,It(r()).orgExists(s).then(function(e){t(e?St(s,{type:n.ERROR,message:"This org id is already in use"}):ft(s)),t(Nt())})}}}function kt(e){return function(t,r){var a=It(r()).validateOrgDescription(e),i=Object(xe.a)(a,2),s=i[0],o=i[1];o.type===n.ERROR?t(function(e,t){return{type:q.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(s,o)):t(function(e){return{type:q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(s)),t(Nt())}}var Mt=r(302),Ut=r(60),Vt=r.n(Ut),jt=r(308),zt=r(309),Gt=r(87),Lt=r.n(Gt),Pt=(r(235),function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,showError:!0},r.gravatarEmail=A.createRef(),r.origin=document.location.origin,r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onShowInfo",value:function(){it.a.info({title:"New Organization Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"As a KBase user, you may create your own organizations."),A.createElement("p",null,"Once you have created an Organization, you will be the sole owner of it, forever."),A.createElement("p",null,"In order to create an Org, you need to complete the following fields."),A.createElement("dl",null,A.createElement("dt",null,"name"),A.createElement("dd",null,"The organization ",A.createElement("i",null,"name")," is whatever you wish to have your Org known as. It may be composed of any text (including unicode characters) up to 200 characters in length. You may also change it at any time."),A.createElement("dt",null,"gravatar"),A.createElement("dd",null,"You should associate your Organization with an avatar hosted with the Gravatar service. To do so, simply enter the email address associated with your gravatar into the first"),A.createElement("dt",null,"id"),A.createElement("dd",null,A.createElement("p",null,"Your Org ",A.createElement("i",null,"id")," forms a url endpoint for your org as well as the identifier used throughout KBase to, well, identify your organization uniquely among all current and future organizations. As such, the Org ID may not be changed once created."),A.createElement("p",null,"The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also restricted to 100 characters in length.")),A.createElement("dt",null,"description"),A.createElement("dd",null,A.createElement("p",null,"Up to 4000 characters, a description allows you to express to other KBase users the purpose, history, associations, and science domain of your Org."),A.createElement("p",null,'The description is in "markdown" format, and the editor will show you a preview of the rendered description.'))))})}},{key:"onGravatarEmailSync",value:function(){var e;e=this.gravatarEmail.current?this.gravatarEmail.current.value:"n/a";var t=Lt()(e);this.props.onUpdateGravatarHash(t)}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){it.a.confirm({title:"Leave the editor?",content:A.createElement("div",null,A.createElement("p",null,"You have entered information for this new organization."),A.createElement("p",null,"If you leave the editor without first saving, the new organization ",A.createElement("i",null,"will not be created"),"."),A.createElement("p",null,A.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onGravatarHashChange",value:function(e){e.persist(),this.props.onUpdateGravatarHash(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===E.EDITED&&this.props.validationState===m.VALID&&(this.props.saveState===d.NEW||this.props.saveState===d.READY||this.props.saveState===d.SAVED)}},{key:"isModified",value:function(){return this.props.editState===E.EDITED&&this.props.saveState===d.NEW}},{key:"renderForm",value:function(){return A.createElement("form",{id:"newOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"name"),A.createElement("div",{className:"col2"},A.createElement(jt.a,{value:this.props.newOrganization.name.value||"",onChange:this.onNameChange.bind(this)}),this.props.newOrganization.name.error?A.createElement("span",{style:{color:"red"}},this.props.newOrganization.name.error.message):"")),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"is private?"),A.createElement("div",{className:"col2"},A.createElement(zt.a,{checked:this.props.newOrganization.isPrivate.value,onChange:this.onIsPrivateChange.bind(this)}),this.props.newOrganization.isPrivate.error?A.createElement("span",{style:{color:"red"}},this.props.newOrganization.id.error.message):"")),A.createElement("div",{className:"row gravatarHash"},A.createElement("div",{className:"col1 field-label"},"gravatar hash"),A.createElement("div",{className:"col2"},A.createElement("div",{style:{display:"flex",flexDirection:"row",marginBottom:"4px"}},A.createElement("div",{style:{flex:"1 1 0px"}},A.createElement("input",{ref:this.gravatarEmail,placeholder:"Provide your gravatar-linked email address, if any"})),A.createElement("div",{style:{flex:"0 0 auto"}},A.createElement(st.a,{icon:"arrow-down",style:{height:"100%"},onClick:this.onGravatarEmailSync.bind(this)}))),A.createElement(jt.a,{value:this.props.newOrganization.gravatarHash.value||"",onChange:this.onGravatarHashChange.bind(this)}),this.props.newOrganization.gravatarHash.error?A.createElement("span",{style:{color:"red"}},this.props.newOrganization.gravatarHash.error.message):"")),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"id"),A.createElement("div",{className:"col2"},A.createElement(jt.a,{value:this.props.newOrganization.id.value||"",onChange:this.onIdChange.bind(this)}),this.props.newOrganization.id.error?A.createElement("span",{style:{color:"red"}},this.props.newOrganization.id.error.message):"")),A.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},A.createElement("div",{className:"col1 field-label"},"description"),A.createElement("div",{className:"col2"},A.createElement("textarea",{value:this.props.newOrganization.description.value||"",onChange:this.onDescriptionChange.bind(this)}),this.props.newOrganization.description.error?A.createElement("div",{style:{color:"red"}},this.props.newOrganization.description.error.message):"")),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"}),A.createElement("div",{className:"col2"})))}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash.value)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash.value+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return A.createElement("img",{style:{width:64,height:64},src:this.getOrgAvatarUrl(e)})}},{key:"renderPreview",value:function(){return A.createElement("form",{className:"preview"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"name"},this.props.newOrganization.name.value||""))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"gravatarHash"},this.renderOrgAvatar(this.props.newOrganization)))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"id"},A.createElement("span",{style:{color:"silver"}},this.origin,"/#orgs/organizations/"),this.props.newOrganization.id.value||A.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),A.createElement("div",{className:"row",style:{flex:"1 1 0px"}},A.createElement("div",{className:"col2"},A.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:Vt()(this.props.newOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return A.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderHeader",value:function(){var e,t=this.props.newOrganization.name.value||A.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");this.props.error&&(e=A.createElement(st.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}));var r=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(je.a,{type:"plus-circle"})," ",'Adding a New Org "',t,'"')),n=A.createElement(A.Fragment,null,A.createElement(st.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}),e);return A.createElement(ct,{breadcrumbs:r,buttons:n})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading New Org Editor...");return A.createElement(ct,{breadcrumbs:e})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return A.createElement("div",{key:"line_"+t},e)})),t&&(t=A.createElement("div",null,A.createElement("div",null,"trace"),t)),A.createElement(it.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},A.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),A.createElement("div",null,this.props.error.message),t)}}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(Mt.a,{push:!0,to:"/organizations"}):this.props.saveState===d.SAVED?A.createElement(Mt.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):this.props.newOrganization?A.createElement("div",{className:"NewOrganization"},this.renderHeader(),A.createElement("div",{className:"mainRow"},A.createElement("div",{className:"editorColumn"},A.createElement("h3",null,"Editor"),this.renderForm()),A.createElement("div",{className:"previewColumn"},A.createElement("h3",null,"Preview"),this.renderPreview())),this.renderError()):A.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(A.Component));var xt=Object(j.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(At())},onUpdateName:function(t){e(Tt(t))},onUpdateGravatarHash:function(t){e(bt(t))},onUpdateId:function(t){e(Ct(t))},onUpdateDescription:function(t){e(kt(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Nt())}}(t))}}})(Pt),qt=(r(242),function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case R.SUCCESS:default:return A.createElement(xt,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component));var Wt=Object(j.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(_t())},onUnload:function(){e({type:q.ADD_ORG_UNLOAD})}}})(qt),Bt=function(){function e(t){Object(b.a)(this,e),this.params=t}return Object(y.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i,s,o,c;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new we({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),n=new de({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(s=e.sent,(o=ve(a,this.params.username,i,s)).type!==le.ADMIN&&o.type!==le.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:c=e.sent,e.next=19;break;case 18:c=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:s,relation:o,groupRequests:c});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationsForUser",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t,r,n,a,s,o=this;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new we({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),r=new de({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,t.getOwnOrgs();case 4:return n=e.sent,e.next=7,r.getUserRequests();case 7:return a=e.sent,e.next=10,r.getUserInvitations();case 10:return s=e.sent,e.next=13,Promise.all(n.map(function(){var e=Object(te.a)(ee.a.mark(function e(t){var n,c,u,l;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.find(function(e){return e.organizationId===t.id&&e.type===i.REQUEST&&e.resourceType===ne.USER}),c=s.find(function(e){return e.organizationId===t.id&&e.type===i.INVITATION&&e.resourceType===ne.USER}),(u=ve(t,o.params.username,n||null,c)).type!==le.ADMIN&&u.type!==le.OWNER){e.next=9;break}return e.next=6,r.getPendingOrganizationRequestsForOrg(t.id);case 6:l=e.sent,e.next=10;break;case 9:l=null;case 10:return e.abrupt("return",{organization:t,request:n,invitation:c,relation:u,groupRequests:l});case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();function Ht(e){return{type:q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrative:e}}function Qt(e){return{type:q.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function Ft(e){return{type:q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e}}function Jt(e){return{type:q.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function Yt(e){return{type:q.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function Zt(){return{type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function Kt(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,v,p,h,O;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Bt({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),l=new de({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,u.getOrganizationForUser(e);case 7:if(E=t.sent,d=E.organization,(m=E.relation).type!==le.OWNER&&m.type!==le.ADMIN){t.next=19;break}return t.next=13,l.getPendingOrganizationRequestsForOrg(e);case 13:return v=t.sent,t.next=16,l.getOrganizationInvitationsForOrg(e);case 16:p=t.sent,t.next=21;break;case 19:v=null,p=null;case 21:return t.next=23,l.getRequestInboxForOrg(e);case 23:return h=t.sent,t.next=26,l.getRequestOutboxForOrg(e);case 26:O=t.sent,r((w=d,g=m,f=v,S=p,_=h,A=O,{type:q.VIEW_ORG_LOAD_SUCCESS,organization:w,relation:g,groupRequests:f,groupInvitations:S,requestInbox:_,requestOutbox:A})),t.next=33;break;case 30:t.prev=30,t.t0=t.catch(4),r((R={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_LOAD_ERROR,error:R}));case 33:case"end":return t.stop()}var R,w,g,f,S,_,A},t,this,[[4,30]])}));return function(e,r){return t.apply(this,arguments)}}()}function Xt(){return function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var a,i,s,o,c,u,l;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=r()).views.viewOrgView.viewModel){e.next=4;break}return t(Yt({type:n.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=a.views.viewOrgView.viewModel.organization,l=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),e.prev=6,e.next=9,l.requestMembershipToGroup(u.id);case 9:t({type:q.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(Kt(u.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(Yt({type:n.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,this,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function $t(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,a){var i,s,o,c,u,l,E;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_JOIN_REQUEST_START}),(i=a()).views.viewOrgView.viewModel){t.next=5;break}return r(Yt({type:n.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,i.views.viewOrgView.viewModel.organization,l=new de({token:o,username:c,groupsServiceURL:u.services.Groups.url}),t.prev=7,t.next=10,l.cancelRequest(e);case 10:E=t.sent,r({type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(Kt(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:n.ERROR,message:t.t0.message},{type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function er(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,a){var i,s,o,c,u,l,E;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Zt()),(i=a()).views.viewOrgView.viewModel){t.next=5;break}return r(Yt({type:n.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,i.views.viewOrgView.viewModel.organization,l=new de({token:o,username:c,groupsServiceURL:u.services.Groups.url}),t.prev=7,t.next=10,l.acceptJoinInvitation(e);case 10:E=t.sent,r({type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(Kt(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function tr(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,a){var i,s,o,c,u,l,E;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Zt()),(i=a()).views.viewOrgView.viewModel){t.next=5;break}return r(Yt({type:n.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,i.views.viewOrgView.viewModel.organization,l=new de({token:o,username:c,groupsServiceURL:u.services.Groups.url}),t.prev=7,t.next=10,l.rejectJoinInvitation(e);case 10:E=t.sent,r({type:q.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(Kt(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}r(244);var rr,nr=r(300),ar=r(304),ir=r(311),sr=r(307),or=r(310);r(246);!function(e){e[e.NONE=0]="NONE",e[e.MANAGE_MEMBERSHIP=1]="MANAGE_MEMBERSHIP",e[e.VIEW_MEMBERS=2]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=3]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=4]="VIEW_ORGANIZATION",e[e.EDIT_ORGANIZATION=5]="EDIT_ORGANIZATION",e[e.INVITE_USER=6]="INVITE_USER"}(rr||(rr={}));var cr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={navigateTo:rr.NONE},r.relation=r.getUserRelation(),r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"getUserRelation",value:function(){var e=this.props.currentUsername,t=this.props.organization;if(console.log("getting relation",e),e===t.owner.username)return{type:le.OWNER};var r=t.members.find(function(t){return t.username===e});if(!r)return this.props.pendingJoinRequest&&this.props.pendingJoinRequest.user===e?{type:le.MEMBER_REQUEST_PENDING,requestId:this.props.pendingJoinRequest.id}:this.props.pendingJoinInvitation&&this.props.pendingJoinInvitation.user===e?{type:le.MEMBER_INVITATION_PENDING,requestId:this.props.pendingJoinInvitation.id}:{type:le.VIEW};switch(r.type){case a.MEMBER:return{type:le.MEMBER};case a.ADMIN:return{type:le.ADMIN};case a.OWNER:return{type:le.OWNER};default:return{type:le.NONE}}}},{key:"onJoinClick",value:function(){this.props.onJoinOrg(),or.a.success("Join request has been submitted")}},{key:"onCancelJoinRequest",value:function(){var e=this.relation;this.props.onCancelJoinRequest(e.requestId),or.a.success("Submitted cancellation request")}},{key:"onAcceptInvitation",value:function(){var e=this.relation;this.props.onAcceptInvitation(e.requestId),or.a.success("Invitation acceptance has been sent")}},{key:"onRejectInvitation",value:function(){var e=this.relation;this.props.onRejectInvitation(e.requestId),or.a.success("Invitation rejection has been sent")}},{key:"onNavigateToMembership",value:function(){this.setState({navigateTo:rr.MANAGE_MEMBERSHIP})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:rr.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:rr.MANAGE_REQUESTS})}},{key:"onNavigateToEditOrganization",value:function(){this.setState({navigateTo:rr.EDIT_ORGANIZATION})}},{key:"onNavigateToInviteUser",value:function(){this.setState({navigateTo:rr.INVITE_USER})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:rr.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({navigateTo:rr.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:rr.VIEW_MEMBERS});break;case"editOrg":this.setState({navigateTo:rr.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({navigateTo:rr.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:rr.MANAGE_REQUESTS})}}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return A.createElement("img",{style:{width:64,height:64},onClick:this.onNavigateToViewOrganization.bind(this),className:"avatarImage",src:this.getOrgAvatarUrl(this.props.organization)})}},{key:"renderRelation",value:function(){this.props.organization;switch(this.relation.type){case le.NONE:return A.createElement("span",null,A.createElement(je.a,{type:"stop"}),"None");case le.VIEW:return A.createElement("div",null,A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it, you may request membership"},A.createElement("div",{style:{textAlign:"center"}},A.createElement(je.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization")),A.createElement("div",{style:{textAlign:"center"}},A.createElement(st.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization")));case le.MEMBER_REQUEST_PENDING:return A.createElement("div",null,A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have requested membership in this Organization"},"   ",A.createElement("div",{style:{textAlign:"center"}},A.createElement("span",null,A.createElement(je.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",A.createElement("b",null,"request")," is pending"," ",A.createElement(je.a,{type:"question-circle"})))),A.createElement("div",{style:{textAlign:"center"}},A.createElement(st.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case le.MEMBER_INVITATION_PENDING:return A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this Organization"},A.createElement("div",{style:{textAlign:"center"}},A.createElement("div",null,A.createElement(je.a,{type:"user",style:{color:"blue"}}),"You have been ",A.createElement("b",null,"invited")," to join this Organization"),A.createElement("div",null,A.createElement(st.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),A.createElement(st.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"))));case le.MEMBER:var e=A.createElement(ir.a,{onClick:this.onMenuClick.bind(this)},A.createElement(ir.a.Item,{key:"manageMyMembership"},"Manage My Membership"));return A.createElement("div",{className:"relationRow"},A.createElement("div",{className:"relationLabel"},A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},A.createElement("div",null,A.createElement(je.a,{type:"user"}),"You are a ",A.createElement("b",null,"member")," of this Organization"))),A.createElement("div",{className:"relationMenu"},A.createElement("div",null,A.createElement(sr.a,{overlay:e,trigger:["click"]},A.createElement(st.a,{shape:"circle"},A.createElement(je.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case le.ADMIN:var t=A.createElement(ir.a,{onClick:this.onMenuClick.bind(this)},A.createElement(ir.a.Item,{key:"manageMyMembership"},"Manage My Membership"),A.createElement(ir.a.Item,{key:"viewMembers"},"Members"),A.createElement(ir.a.Item,{key:"manageRequests"},"Requests and Invitations"),A.createElement(ir.a.Item,{key:"editOrg"},"Edit this Org"),A.createElement(ir.a.Item,{key:"inviteUser"},"Invite User"));return A.createElement("div",{className:"relationRow"},A.createElement("div",{className:"relationLabel"},A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are and Administrator for this group"},A.createElement("div",null,A.createElement(je.a,{type:"unlock"}),"You are a ",A.createElement("b",null,"administrator")," of this Organization"))),A.createElement("div",{className:"relationMenu"},A.createElement("div",null,A.createElement(sr.a,{overlay:t,trigger:["click"]},A.createElement(st.a,{shape:"circle"},A.createElement(je.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case le.OWNER:var r=A.createElement(ir.a,{onClick:this.onMenuClick.bind(this)},A.createElement(ir.a.Item,{key:"manageMyMembership"},"Manage My Membership"),A.createElement(ir.a.Item,{key:"viewMembers"},"Members"),A.createElement(ir.a.Item,{key:"manageRequests"},"Requests and Invitations"),A.createElement(ir.a.Item,{key:"editOrg"},"Edit this Org"),A.createElement(ir.a.Item,{key:"inviteUser"},"Invite User"));return A.createElement("div",{className:"relationRow"},A.createElement("div",{className:"relationLabel"},A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this group"},A.createElement("div",null,A.createElement(je.a,{type:"crown",style:{color:"gold"}})," ","You ",A.createElement("b",null,"own")," this Organization"))),A.createElement("div",{className:"relationMenu"},A.createElement("div",null,A.createElement(sr.a,{overlay:r,trigger:["click"]},A.createElement(st.a,{shape:"circle"},A.createElement(je.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))))}}},{key:"renderOrgInfo",value:function(){var e=this.props.organization;return A.createElement("div",null,A.createElement("div",{className:"name"},e.name),A.createElement("div",{className:"owner"},A.createElement("span",{className:"field-label"},"owner"),A.createElement("a",{href:"#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769"))}},{key:"getRelationClass",value:function(e){switch(this.relation.type){case le.NONE:return"relationRequest";case le.VIEW:return"relationRequest relationNonMember";case le.MEMBER_REQUEST_PENDING:return"relationRequest relationRequestPending";case le.MEMBER_INVITATION_PENDING:return"relationRequest relationInvitationPending";case le.MEMBER:return"relationRequest relationMember";case le.ADMIN:return"relationRequest relationAdmin";case le.OWNER:return"relationRequest relationOwner"}}},{key:"render",value:function(){switch(this.state.navigateTo){case rr.MANAGE_MEMBERSHIP:return A.createElement(Mt.a,{push:!0,to:"/membership/"+this.props.organization.id});case rr.VIEW_MEMBERS:return A.createElement(Mt.a,{push:!0,to:"/viewMembers/"+this.props.organization.id});case rr.EDIT_ORGANIZATION:return A.createElement(Mt.a,{push:!0,to:"/editOrganization/"+this.props.organization.id});case rr.MANAGE_REQUESTS:return A.createElement(Mt.a,{push:!0,to:"/manageOrganizationRequests/"+this.props.organization.id});case rr.INVITE_USER:return A.createElement(Mt.a,{push:!0,to:"/inviteUser/"+this.props.organization.id});case rr.VIEW_ORGANIZATION:return A.createElement(Mt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id})}return A.createElement("div",{className:"OrganizationHeader"},A.createElement("div",{className:"avatar"},this.renderOrgAvatar(this.props.organization)),A.createElement("div",{className:"orgInfo"},this.renderOrgInfo()),A.createElement("div",{className:"yourRelation "+this.getRelationClass(this.props.organization)},this.renderRelation()))}}]),t}(A.Component);var ur=Object(j.b)(function(e,t){var r=e.views.organizationCentricView.viewModel,n=e.auth.authorization.username;if(!r)throw new Error("View model is unexpectedly missing");return{organization:r.organization,pendingJoinRequest:r.pendingJoinRequest,pendingJoinInvitation:r.pendingJoinInvitation,currentUsername:n}},function(e){return{onJoinOrg:function(){e(Xt())},onCancelJoinRequest:function(t){e($t(t))},onAcceptInvitation:function(t){e(er(t))},onRejectInvitation:function(t){e(tr(t))}}})(cr);function lr(e){var t=e.organization,r=e.pendingJoinRequest,n=e.pendingJoinInvitation,a=e.relation;return{type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,organization:t,pendingJoinRequest:r,pendingJoinInvitation:n,relation:a}}var Er=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading header...")}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return A.createElement(ur,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var dr=Object(j.b)(function(e,t){return{view:e.views.organizationCentricView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,v;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),l=new de({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,u.getOrg(e);case 7:return E=t.sent,t.next=10,l.getUserRequestForOrg(e);case 10:return d=t.sent,t.next=13,l.getUserInvitationForOrg(e);case 13:m=t.sent,v=ve(E,o,d,m),r(lr({organization:E,relation:v,pendingJoinRequest:d,pendingJoinInvitation:m})),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(4),r((p={code:t.t0.name,message:t.t0.message},{type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,error:p}));case 21:case"end":return t.stop()}var p},t,this,[[4,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.ORGANIZATION_CENTRIC_VIEW_UNLOAD})}}})(Er),mr=r(312),vr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case Ee.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=A.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you can obtain personal View-Only access by clicking this button",r=A.createElement(st.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=A.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=A.createElement(st.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for Access"));break;case Ee.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=A.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=A.createElement(st.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case Ee.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=A.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=A.createElement(st.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case Ee.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=A.createElement("span",null,"Admin");break;case Ee.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=A.createElement("span",null,"Owner");break;default:t=A.createElement("span",null,"Unknown")}return A.createElement(A.Fragment,null,A.createElement(nr.a,{title:n,placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement("span",{className:"field-label"},"your permission"),t))," ",A.createElement(nr.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?A.createElement(nr.a,{title:"This narrative is viewable by all KBase users",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(je.a,{type:"globe"})," Public Narrative")):A.createElement(nr.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(je.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return e.permission===Ee.NONE?A.createElement(A.Fragment,null,A.createElement("div",{className:"title"},e.title),A.createElement("div",null,this.renderPublicPermission(e)),A.createElement("div",null,this.renderNarrativePermission(e)),A.createElement("div",null,A.createElement("i",null,"One-liner abstract?")),A.createElement("div",null,A.createElement("i",null,"created, saved info here?"))):A.createElement(A.Fragment,null,A.createElement("div",{className:"title"},A.createElement("a",{href:"https://ci.kbase.us/narrative/ws."+e.workspaceId+".obj.1",target:"_blank"},e.title)),A.createElement("div",null,this.renderPublicPermission(e)),A.createElement("div",null,this.renderNarrativePermission(e)),A.createElement("div",null,A.createElement("i",null,"One-liner abstract?")),A.createElement("div",null,A.createElement("i",null,"created, saved info here?")))}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=A.createElement(mr.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),A.createElement("div",null,this.renderNarrative(),e)}}]),t}(A.Component);function pr(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),s=Math.abs(i);if(s<7776e3){if(0===s)return"now";s<60?(t=i,r=s,n="second"):s<3600?(t=Math.round(i/60),r=Math.round(s/60),n="minute"):s<86400?(t=Math.round(i/3600),r=Math.round(s/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(s/86400),n="day"),r>1&&(n+="s");var o=null,c=null;return t<0?o="in":t>0&&(c="ago"),(o?o+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var hr;r(248);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(hr||(hr={}));var Or=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={view:hr.COMPACT},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case hr.COMPACT:return hr.NORMAL;case hr.NORMAL:return hr.COMPACT}}(this.state.view)})}},{key:"getAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderAvatar",value:function(e){return A.createElement("img",{style:{width:30,height:30},src:this.getAvatarUrl(e)})}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(e){return A.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderNormal",value:function(){var e=this.props.organization;return A.createElement("div",{className:"OrganizationCompact",key:e.id},A.createElement("div",{className:"avatarCol"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),A.createElement("div",{className:"bodyCol"},A.createElement("div",{className:"orgName"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},e.name)),A.createElement("div",{className:"orgOwner"},A.createElement("span",{className:"field-label"},"owner"),A.createElement("span",{className:"field-value"},A.createElement("a",{href:"/#people/"+e.owner.username,target:"_blank"},e.owner.username," \u2768",e.owner.username,"\u2769"))),A.createElement("div",{className:"orgCreated"},A.createElement("span",{className:"field-label"},"established"),A.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===hr.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===hr.NORMAL?"up":"down")}))))}},{key:"renderCompact",value:function(){var e=this.props.organization;return A.createElement("div",{className:"OrganizationCompact",key:e.id},A.createElement("div",{className:"avatarCol"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),A.createElement("div",{className:"bodyCol"},A.createElement("div",{className:"orgName"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},e.name))),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===hr.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===hr.NORMAL?"up":"down")}))))}},{key:"render",value:function(){switch(this.state.view){case hr.COMPACT:return A.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case hr.NORMAL:return A.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(A.Component),Rr=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.organization?A.createElement(Or,{organization:this.props.organization}):(this.props.onLoad(this.props.organizationId),A.createElement("div",null,"Loading org..."))}}]),t}(A.Component);var wr,gr=Object(j.b)(function(e,t){return{organization:e.entities.orgs.byId.get(t.organizationId)}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_ORGANIZATION_LOADER_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,u.getOrg(e);case 6:l=t.sent,r((d=l,{type:q.ENTITY_ORGANIZATION_LOADER_SUCCESS,organization:d})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:"error",message:t.t0.message},{type:q.ENTITY_ORGANIZATION_LOADER_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Rr);r(250);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(wr||(wr={}));var fr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={view:wr.COMPACT},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case wr.COMPACT:return wr.NORMAL;case wr.NORMAL:return wr.COMPACT}}(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?A.createElement(nr.a,{title:"This narrative is viewable by all KBase users",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(je.a,{type:"globe"})," Public Narrative")):A.createElement(nr.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(je.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case Fe.VIEW:t="View-Only";break;case Fe.EDIT:t="Edit";break;case Fe.ADMIN:t="Admin";break;case Fe.OWNER:t="Owner";break;default:t="Unknown"}return A.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"iconCol"},A.createElement(je.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),A.createElement("div",{className:"mainCol"},A.createElement("div",{className:"title"},e.title)),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===wr.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===wr.NORMAL?"up":"down")}))))}},{key:"renderNormal",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"iconCol"},A.createElement(je.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),A.createElement("div",{className:"mainCol"},A.createElement("div",{className:"title"},e.title),A.createElement("div",null,this.renderPublicPermission(e)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"owner"),e.owner),A.createElement("div",null,A.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===wr.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===wr.NORMAL?"up":"down")}))))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===Fe.NONE)return A.createElement("div",null,"You don't have access to this Narrative");switch(this.state.view){case wr.COMPACT:return A.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case wr.NORMAL:return A.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(A.Component),Sr=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.narrative?A.createElement(fr,{narrative:this.props.narrative}):(this.props.onLoad(this.props.workspaceId),A.createElement("div",null,"Loading narrative..."))}}]),t}(A.Component);var _r,Ar=Object(j.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new $e({token:s,username:o,workspaceServiceURL:c.services.Workspace.url,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=3,t.next=6,u.getNarrative(e);case 6:l=t.sent,r({type:q.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:l}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:q.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Sr);r(252);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(_r||(_r={}));var Nr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={view:_r.COMPACT},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:function(e){switch(e){case _r.COMPACT:return _r.NORMAL;case _r.NORMAL:return _r.COMPACT}}(this.state.view)})}},{key:"renderCompact",value:function(){return A.createElement(A.Fragment,null,A.createElement("div",{className:"avatarCol"},A.createElement(Ve,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769")),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===_r.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===_r.NORMAL?"up":"down")}))))}},{key:"renderNormal",value:function(){return A.createElement(A.Fragment,null,A.createElement("div",{className:"avatarCol"},A.createElement(Ve,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),A.createElement("div",{className:"organization"},this.props.user.organization||A.createElement("i",null,"no organization in user profile")),A.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||A.createElement("i",null,"no location information in user profile"))),A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===_r.NORMAL?"pressed":"")},A.createElement(je.a,{type:"".concat(this.state.view===_r.NORMAL?"up":"down")}))))}},{key:"render",value:function(){switch(this.state.view){case _r.COMPACT:return A.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case _r.NORMAL:return A.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(A.Component),Ir=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.user?A.createElement(Nr,{user:this.props.user,avatarSize:this.props.avatarSize}):(this.props.onLoad(this.props.userId),A.createElement("div",null,"Loading user..."))}}]),t}(A.Component);var Tr,br=Object(j.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(et(t))}}})(Ir),yr=(r(254),function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onCancelRequest",value:function(){}},{key:"onVisitOrg",value:function(){}},{key:"onAcceptInvitation",value:function(){}},{key:"onRejectInvitation",value:function(){}},{key:"onAcceptRequest",value:function(){}},{key:"onRejectRequest",value:function(){}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.APP:return"SHOW APP";case ne.USER:return"";case ne.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(Ar,{workspaceId:parseInt(e.narrativeId,10)})))}case re.INVITATION:switch(e.resourceType){case ne.USER:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(br,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return A.createElement(br,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.APP:return"REQUEST to associate App";case ne.USER:return"REQUEST to join Organization";case ne.WORKSPACE:return"REQUEST to associate Narrative"}case re.INVITATION:switch(e.resourceType){case ne.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.APP:return"SHOW APP";case ne.USER:return"";case ne.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(Ar,{workspaceId:parseInt(e.narrativeId,10)})),A.createElement("div",{className:"cardSectionHeader"},"with organization"))}case re.INVITATION:switch(e.resourceType){case ne.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),A.createElement("div",{className:"miniDetail"},A.createElement(gr,{organizationId:e.organizationId})),A.createElement("div",{className:"cardSectionHeader"},"from"),A.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),A.createElement("div",{className:"miniDetail"},A.createElement(Ar,{workspaceId:parseInt(e.narrativeId,10)})),A.createElement("div",{className:"cardSectionHeader"},"with organization"),A.createElement("div",{className:"miniDetail"},A.createElement(gr,{organizationId:e.organizationId})),A.createElement("div",{className:"cardSectionHeader"},"from"),A.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return A.createElement("div",{style:{textAlign:"center"}},A.createElement(st.a.Group,{style:{marginTop:"4px"}},A.createElement(st.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},A.createElement(je.a,{type:"check"}),"Accept"),A.createElement(st.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},A.createElement(je.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),A.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),A.createElement("div",{className:"miniDetail"},A.createElement(gr,{organizationId:e.organizationId})),A.createElement("div",{className:"cardSectionHeader"},"sent by"),A.createElement(br,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.USER:return this.renderJoinRequest(e);case ne.WORKSPACE:return this.renderWorkspaceRequest(e);case ne.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"apps not supported yet"))}case re.INVITATION:switch(e.resourceType){case ne.USER:return this.renderUserInvitation(e);case ne.WORKSPACE:case ne.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return A.createElement("div",{key:e.id,className:"InboxRequest"},A.createElement("div",{className:"requestHeader"},A.createElement("div",{className:"requestHeaderRow"},A.createElement("div",{className:"requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),A.createElement("div",{className:"requestHeaderExpireAt"},A.createElement("span",{className:"field-label"},"expires")," ",pr(e.expireAt)))),A.createElement("div",{className:"requestBody"},this.renderBody()))}}]),t}(A.Component)),Dr=(r(256),function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onCancelRequest",value:function(){}},{key:"onVisitOrg",value:function(){}},{key:"onAcceptInvitation",value:function(){}},{key:"onRejectInvitation",value:function(){}},{key:"onAcceptRequest",value:function(){}},{key:"onRejectRequest",value:function(){}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.APP:return"SHOW APP";case ne.USER:return"";case ne.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(Ar,{workspaceId:parseInt(e.narrativeId,10)})))}case re.INVITATION:switch(e.resourceType){case ne.USER:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(br,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return A.createElement(br,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.APP:return"REQUEST to associate App";case ne.USER:return"REQUEST to join Organization";case ne.WORKSPACE:return"REQUEST to associate Narrative"}case re.INVITATION:switch(e.resourceType){case ne.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.APP:return"SHOW APP";case ne.USER:return"";case ne.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(Ar,{workspaceId:parseInt(e.narrativeId,10)})),A.createElement("div",{className:"cardSectionHeader"},"with organization"))}case re.INVITATION:switch(e.resourceType){case ne.USER:return A.createElement(br,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),A.createElement("div",{className:"miniDetail"},A.createElement(gr,{organizationId:e.organizationId})),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),A.createElement("div",{className:"miniDetail"},A.createElement(Ar,{workspaceId:parseInt(e.narrativeId,10)})),A.createElement("div",{className:"cardSectionHeader"},"with organization"),A.createElement("div",{className:"miniDetail"},A.createElement(gr,{organizationId:e.organizationId})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return A.createElement("div",{style:{textAlign:"center"}},A.createElement(st.a.Group,{style:{marginTop:"4px"}},A.createElement(st.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},A.createElement(je.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),A.createElement("div",{className:"miniDetail"},A.createElement(gr,{organizationId:e.organizationId})),A.createElement("div",{className:"cardSectionHeader"},"sent to"),A.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case re.REQUEST:switch(e.resourceType){case ne.USER:return this.renderJoinRequest(e);case ne.WORKSPACE:return this.renderWorkspaceRequest(e);case ne.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"apps not supported yet"))}case re.INVITATION:switch(e.resourceType){case ne.USER:return this.renderUserInvitation(e);case ne.WORKSPACE:case ne.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return A.createElement("div",{key:e.id,className:"OutboxRequest"},A.createElement("div",{className:"requestHeader"},A.createElement("div",{className:"requestHeaderRow"},A.createElement("div",{className:"requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),A.createElement("div",{className:"requestHeaderExpireAt"},A.createElement("span",{className:"field-label"},"expires")," ",pr(e.expireAt)))),A.createElement("div",{className:"requestBody"},this.renderBody()))}}]),t}(A.Component));!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(Tr||(Tr={}));var Cr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Tr.NONE,requestAccess:{narrative:null}},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({navigateTo:Tr.REQUEST_ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){it.a.info({title:"View Organization Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the organizations viewer..."))})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return A.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.relation.type===le.ADMIN||this.props.relation.type===le.OWNER)return A.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",A.createElement(Me.a,{to:"/editOrganization/".concat(this.props.organization.id)},A.createElement(st.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.relation.type===le.ADMIN||this.props.relation.type===le.OWNER)return A.createElement(Me.a,{to:"/editOrganization/".concat(this.props.organization.id)},A.createElement(st.a,{icon:"edit"},"Edit"))}},{key:"renderOrg",value:function(){if(this.props.organization)return A.createElement("div",{className:"org"},A.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:Vt()(this.props.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return A.createElement("div",{className:"ownerTable"},A.createElement("div",{className:"proprietorCol"},A.createElement("div",{className:"owner"},A.createElement("a",{href:"#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(dr,{organizationId:this.props.organization.id})}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return A.createElement("img",{style:{width:64,height:64},src:this.getOrgAvatarUrl(e)})}},{key:"renderRelation",value:function(e){switch(e.type){case le.NONE:return A.createElement("span",null,A.createElement(je.a,{type:"stop"}),"None");case le.VIEW:return A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},A.createElement("div",null,A.createElement(je.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),A.createElement("div",{style:{marginTop:"10px"}},A.createElement(st.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case le.MEMBER_REQUEST_PENDING:return A.createElement("div",null,A.createElement("div",null,A.createElement(je.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",A.createElement("b",null,"request")," is pending"),A.createElement("div",null,A.createElement(st.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case le.MEMBER_INVITATION_PENDING:return A.createElement("div",null,A.createElement("div",null,A.createElement(je.a,{type:"user",style:{color:"blue"}}),"You have been ",A.createElement("b",null,"invited")," to join this Organization"),A.createElement("div",{style:{marginTop:"10px"}},A.createElement(st.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),A.createElement(st.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case le.MEMBER:return A.createElement("span",null,A.createElement(je.a,{type:"user"}),"Member");case le.ADMIN:return A.createElement("span",null,A.createElement(je.a,{type:"unlock"}),"Admin");case le.OWNER:return A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},A.createElement("span",null,A.createElement(je.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===le.OWNER||this.props.relation.type===le.ADMIN||this.props.relation.type===le.MEMBER)}},{key:"renderMembers",value:function(){return this.isMember()?(e=0===this.props.organization.members.length?A.createElement("p",{style:{fontStyle:"italic",textAlign:"center"}},"This organization has no members"):this.props.organization.members.map(function(e){return A.createElement("div",{className:"row",key:e.username},A.createElement("div",{className:"col0"},A.createElement(rt,{member:e,avatarSize:50})))}),A.createElement("div",{className:"infoTable"},e)):A.createElement("p",{className:"message"},"Sorry, group membership restricted to members only");var e}},{key:"renderInfo",value:function(){if(this.props.organization)return A.createElement(ar.a,{title:A.createElement("span",null,A.createElement(je.a,{type:"info-circle"})," info"),headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard"},A.createElement("div",null,A.createElement("div",null,A.createElement("div",{className:"label"},"owner")),A.createElement("div",{className:"ownerTable"},A.createElement(rt,{member:this.props.organization.owner,avatarSize:50})),A.createElement("div",{className:"infoTable"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"},A.createElement("span",{className:"label"},"established")),A.createElement("div",{className:"col2"},A.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.createdAt)))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"},A.createElement("span",{className:"label"},"last updated")),A.createElement("div",{className:"col2"},A.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.modifiedAt)))))))}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.relation,r=this.props.groupRequests,n=this.props.groupInvitations;if((t.type===le.ADMIN||t.type===le.OWNER)&&(null!==r&&null!==n))return e=r.length?A.createElement("div",null,"group has no pending requests"):A.createElement("div",null,A.createElement("div",null,A.createElement(je.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",A.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",A.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),A.createElement("div",null,A.createElement(Me.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},A.createElement(st.a,null,"Manage Requests")))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"},A.createElement("span",{className:"label"},"admin")),A.createElement("div",{className:"col2"},A.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?A.createElement("div",null,A.createElement("div",null,A.createElement(je.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",A.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",A.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),A.createElement("div",null,A.createElement(Me.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},A.createElement(st.a,null,"Manage Requests")))):A.createElement("div",null,"There are no pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case le.NONE:case le.VIEW:return"infoBox";case le.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case le.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case le.MEMBER:case le.ADMIN:case le.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return A.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.relation;if(e.type===le.ADMIN||e.type===le.OWNER){var t=this.props,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=A.createElement("span",null,A.createElement(je.a,{type:"unlock"})," ","group requests"," ",A.createElement("span",{className:"titleCount"},"(",a,")"));return A.createElement("div",{className:"adminTasksBox"},A.createElement(ar.a,{className:"slimCard adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.organization&&this.props.relation.type===le.VIEW)return A.createElement(st.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderHeader",value:function(){var e=A.createElement("div",{style:{flex:"0 0 auto"}},A.createElement("span",null,'Viewing Org "',this.props.organization&&this.props.organization.name,'"')),t=A.createElement(A.Fragment,null,this.renderEditButton(),this.renderJoinButton(),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading Org...");return A.createElement(ct,{breadcrumbs:e})}},{key:"renderMembersCard",value:function(){var e,t=[A.createElement(Me.a,{key:"viewMembers",to:"/viewMembers/".concat(this.props.organization.id)},A.createElement(st.a,{onClick:this.onViewMembers.bind(this),icon:"team"}))];if(this.props.organization)return e=this.isMember()?A.createElement("span",{className:"titleCount"},"(",this.props.organization.members.length,")"):"",A.createElement(ar.a,{className:"slimCard membersCard",headStyle:{backgroundColor:"gray",color:"white"},title:A.createElement("span",null,A.createElement(je.a,{type:"team"})," members ",e),extra:t},this.renderMembers())}},{key:"renderInboxCard",value:function(){var e=this.props.requestInbox.length,t=A.createElement("span",null,A.createElement(je.a,{type:"team"}),"inbox"," ",A.createElement("span",{className:"titleCount"},"(",e,")")),r=this.props.requestInbox.map(function(e){return A.createElement(A.Fragment,{key:e.id},A.createElement(yr,{request:e}))});return A.createElement(ar.a,{className:"slimCard outboxCard",headStyle:{backgroundColor:"gray",color:"white"},title:t,extra:[]},r)}},{key:"renderOutboxCard",value:function(){var e=this.props.requestOutbox.length,t=A.createElement("span",null,A.createElement(je.a,{type:"team"}),"outbox"," ",A.createElement("span",{className:"titleCount"},"(",e,")")),r=this.props.requestOutbox.map(function(e){return A.createElement(A.Fragment,{key:e.id},A.createElement(Dr,{request:e}))});return A.createElement(ar.a,{className:"slimCard outboxCard",headStyle:{backgroundColor:"gray",color:"white"},title:t,extra:[]},r)}},{key:"renderNarrativeMenu",value:function(e){var t,r=this,n=this.props.relation;n.type===le.OWNER||(n.type,le.ADMIN);switch(n.type){case le.NONE:break;case le.VIEW:case le.MEMBER_REQUEST_PENDING:case le.MEMBER_INVITATION_PENDING:case le.MEMBER:break;case le.ADMIN:case le.OWNER:t=A.createElement(ir.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},A.createElement(ir.a.Item,{key:"removeNarrative"},A.createElement(je.a,{type:"delete"})," Remove Narrative from Organization"))}if(t)return A.createElement(sr.a,{overlay:t,trigger:["click"]},A.createElement(st.a,{shape:"circle"},A.createElement(je.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}})))}},{key:"renderNarratives",value:function(){var e=this;if(!this.isMember())return A.createElement(ar.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:A.createElement("span",null,A.createElement(je.a,{type:"folder-open"})," narratives")},A.createElement("p",{style:{textAlign:"center",fontStyle:"italic"}},"Sorry, Narratives are restricted to members only"));var t=[A.createElement(Me.a,{key:"requestAddNarrative",to:"/requestAddNarrative/".concat(this.props.organization.id)},A.createElement(st.a,{onClick:this.onRequestAddNarrative.bind(this)},A.createElement(je.a,{type:"plus"})," Add a Narrative"))];if(0===this.props.organization.narratives.length){return A.createElement(ar.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:A.createElement("span",null,A.createElement(je.a,{type:"folder-open"})," narratives (none)"),extra:t},A.createElement(Ue.a,{type:"info",message:"Sorry, no Narratives are yet associated with this Organization"}))}var r=this.props.organization.narratives.map(function(t){return A.createElement("div",{className:"narrative",key:String(t.workspaceId)},A.createElement("div",{className:"dataCol"},A.createElement(vr,{narrative:t,onGetViewAccess:e.props.onGetViewAccess})),A.createElement("div",{className:"buttonCol"},e.renderNarrativeMenu(t)))}),n=this.props.organization.narratives.length,a=A.createElement("span",null,A.createElement(je.a,{type:"folder-open"})," ","narratives"," ",A.createElement("span",{className:"titleCount"},"(",n,")"));return A.createElement(ar.a,{className:"slimCard narratives narrativesCard scrollable-flex-column",headStyle:{backgroundColor:"gray",color:"white"},title:a,extra:t},A.createElement("div",{className:"narrativesTable"},r))}},{key:"render",value:function(){switch(this.state.navigateTo){case Tr.REQUEST_ADD_NARRATIVE:return A.createElement(Mt.a,{to:"/requestAddNarrative"});case Tr.NONE:}if(this.state.requestAccess.narrative&&this.props.organization){var e=this.props.relation;e.type===le.MEMBER||e.type===le.ADMIN||(e.type,le.OWNER)}return"undefined"!==typeof this.props.organization?A.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"mainRow  scrollable-flex-column"},A.createElement("div",{className:"mainColumn  scrollable-flex-column"},A.createElement("div",{className:"orgRow"},this.renderOrg()),A.createElement("div",{className:"narrativesRow scrollable-flex-column"},this.renderNarratives())),A.createElement("div",{className:"infoColumn"},this.renderAdminTasks(),A.createElement("div",{className:"infoBox"},this.renderInfo()),this.renderInboxCard(),this.renderOutboxCard(),this.renderMembersCard())),void 0):A.createElement("div",{className:"ViewOrganization"},this.renderLoadingHeader(),"Loading...")}}]),t}(A.Component);var kr=Object(j.b)(function(e,t){if(!e.views.viewOrgView.viewModel)throw new Error("argh, view model missing");var r=e.views.viewOrgView.viewModel;return{organization:r.organization,relation:r.relation,groupRequests:r.groupRequests,groupInvitations:r.groupInvitations,requestInbox:r.requestInbox,requestOutbox:r.requestOutbox}},function(e){return{onViewOrg:function(t){e(Kt(t))},onJoinOrg:function(){e(Xt())},onCancelJoinRequest:function(t){e($t(t))},onAcceptInvitation:function(t){e(er(t))},onRejectInvitation:function(t){e(tr(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Qt({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=a.views.viewOrgView.viewModel.organization){t.next=9;break}return r(Qt({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:return l=u.id,E=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,E.removeNarrativeFromOrg(l,e.workspaceId);case 14:r(Ht(e)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(11),r(Qt({code:t.t0.name,message:t.t0.message}));case 20:case"end":return t.stop()}},t,this,[[11,17]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Jt({code:"error",message:"No view model"})),t.abrupt("return");case 5:if(i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=a.views.viewOrgView.viewModel.organization){t.next=8;break}return t.abrupt("return");case 8:return l=u.id,E=String(e.workspaceId),d=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,d.grantNarrativeAccess(l,E);case 14:return t.next=16,d.getOrg(l);case 16:m=t.sent,r(Ft(m)),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r(Jt({code:"error",message:t.t0.message}));case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Cr),Mr=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading Your Narratives...")}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return A.createElement(kr,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Ur=Object(j.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(Kt(t))},onUnload:function(){e({type:q.VIEW_ORG_UNLOAD})}}})(Mr);function Vr(){return{type:q.EDIT_ORG_EVALUATE_ERRORS}}function jr(e){return{type:q.EDIT_ORG_SAVE_ERROR,error:e}}function zr(e){return function(t,r){t({type:q.EDIT_ORG_LOAD_START});var a=r(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config;return new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}).getOrg(e).then(function(e){var r,a,i={id:{value:e.id,validationState:m.VALID,editState:E.NONE,validatedAt:null,error:{type:n.NONE,message:""}},name:{value:e.name,validationState:m.VALID,editState:E.NONE,validatedAt:null,error:{type:n.NONE,message:""}},gravatarHash:{value:e.gravatarHash,validationState:m.VALID,editState:E.NONE,validatedAt:null,error:{type:n.NONE,message:""}},description:{value:e.description,validationState:m.VALID,editState:E.NONE,validatedAt:null,error:{type:n.NONE,message:""}},isPrivate:{value:e.isPrivate,validationState:m.VALID,editState:E.NONE,validatedAt:null,error:{type:n.NONE,message:""}}};t((r=i,a=e,{type:q.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:a}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:q.EDIT_ORG_LOAD_ERROR,error:r}))})}}function Gr(){return function(e,t){e({type:q.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.editOrgView.viewModel,o=s.organization,c=s.editedOrganization,u=r.app.config,l=new we({token:a,username:i,groupsServiceURL:u.services.Groups.url});if(c){var E={name:c.name.value,gravatarHash:c.gravatarHash.value,description:c.description.value,isPrivate:c.isPrivate.value};l.updateOrg(o.id,E).then(function(){e({type:q.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",c,t),e(jr({code:"invalid",message:t.message}))})}else e(jr({code:"app",message:"The new organization data does not yet exist"}))}}function Lr(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState===m.VALID&&n.gravatarHash.validationState===m.VALID&&n.description.validationState===m.VALID?e({type:q.EDIT_ORG_EVALUATE_OK}):e(Vr())}}function Pr(e){return function(t){var r=me.validateOrgName(e),a=Object(xe.a)(r,2),i=a[0],s=a[1];s.type===n.ERROR?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(i,s)):t(function(e){return{type:q.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(i)),t(Lr())}}function xr(e){return function(t){var r,a=me.validateOrgGravatarHash(e),i=Object(xe.a)(a,2),s=i[0],o=i[1];o.type===n.ERROR?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,gravatarHash:e,error:t}}(s,o)):t((r=s,{type:q.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,gravatarHash:r})),t(Lr())}}function qr(e){return function(t,r){var a=r(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}).validateOrgDescription(e),l=Object(xe.a)(u,2),E=l[0],d=l[1];d.type===n.ERROR?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(E,d)):t(function(e){return{type:q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(E)),t(Lr())}}var Wr;r(270);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Wr||(Wr={}));var Br=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:Wr.NONE},r.gravatarEmail=A.createRef(),r.origin=document.location.origin,r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onShowInfo",value:function(){it.a.info({title:"Organization Editor Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the organizations editor..."))})}},{key:"onGravatarEmailSync",value:function(){var e;e=this.gravatarEmail.current?this.gravatarEmail.current.value:"n/a";var t=Lt()(e);this.props.onUpdateGravatarHash(t)}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){it.a.confirm({title:"Leave the editor?",content:A.createElement("div",null,A.createElement("p",null,"You have made changes on this edit form."),A.createElement("p",null,"If you leave the editor without saving, any ",A.createElement("i",null,"changes they will be lost"),"."),A.createElement("p",null,A.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){it.a.confirm({title:"Leave the editor?",content:A.createElement("div",null,A.createElement("p",null,"You have made changes on this edit form."),A.createElement("p",null,"If you leave the editor without saving, any ",A.createElement("i",null,"changes they will be lost"),"."),A.createElement("p",null,A.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onGravatarHashChange",value:function(e){e.persist(),this.props.onUpdateGravatarHash(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===E.EDITED&&this.props.validationState===m.VALID&&(this.props.saveState===d.NEW||this.props.saveState===d.READY||this.props.saveState===d.SAVED)}},{key:"isModified",value:function(){return this.props.editState===E.EDITED&&(this.props.saveState===d.NEW||this.props.saveState===d.READY)}},{key:"renderForm",value:function(){return A.createElement("form",{id:"editOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"name"),A.createElement("div",{className:"col2"},A.createElement("input",{value:this.props.editedOrganization.name.value||"",onChange:this.onNameChange.bind(this)}),this.props.editedOrganization.name.error?A.createElement("span",{style:{color:"red"}},this.props.editedOrganization.name.error.message):"")),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"is private?"),A.createElement("div",{className:"col2"},A.createElement(zt.a,{checked:this.props.editedOrganization.isPrivate.value,onChange:this.onIsPrivateChange.bind(this)}),this.props.editedOrganization.isPrivate.error?A.createElement("span",{style:{color:"red"}},this.props.editedOrganization.isPrivate.error.message):"")),A.createElement("div",{className:"row gravatarHash"},A.createElement("div",{className:"col1 field-label"},"gravatar hash"),A.createElement("div",{className:"col2"},A.createElement("div",{style:{display:"flex",flexDirection:"row",marginBottom:"4px"}},A.createElement("div",{style:{flex:"1 1 0px"}},A.createElement("input",{ref:this.gravatarEmail,placeholder:"Provide your gravatar-linked email address, if any"})),A.createElement("div",{style:{flex:"0 0 auto"}},A.createElement(st.a,{icon:"arrow-down",style:{height:"100%"},onClick:this.onGravatarEmailSync.bind(this)}))),A.createElement("input",{value:this.props.editedOrganization.gravatarHash.value||"",onChange:this.onGravatarHashChange.bind(this)}),this.props.editedOrganization.gravatarHash.error?A.createElement("span",{style:{color:"red"}},this.props.editedOrganization.gravatarHash.error.message):"")),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"id"),A.createElement("div",{className:"col2"},A.createElement("input",{value:this.props.editedOrganization.id.value||"",onChange:this.onIdChange.bind(this)}),this.props.editedOrganization.id.error?A.createElement("span",{style:{color:"red"}},this.props.editedOrganization.id.error.message):"")),A.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},A.createElement("div",{className:"col1 field-label"},"description"),A.createElement("div",{className:"col2"},A.createElement("textarea",{value:this.props.editedOrganization.description.value||"",onChange:this.onDescriptionChange.bind(this)}),this.props.editedOrganization.description.error?A.createElement("div",{style:{color:"red"}},this.props.editedOrganization.description.error.message):"")),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"}),A.createElement("div",{className:"col2"})))}},{key:"getOrgAvatarUrl",value:function(e){if(!e.gravatarHash.value)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash.value+"?s=64&amp;r=pg&d=identicon"}},{key:"renderOrgAvatar",value:function(e){return A.createElement("img",{style:{width:64,height:64},src:this.getOrgAvatarUrl(e)})}},{key:"renderPreview",value:function(){return A.createElement("form",{className:"preview"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"name"},this.props.editedOrganization.name.value||""))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"gravatarHash"},this.renderOrgAvatar(this.props.editedOrganization)))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"id"},A.createElement("span",{style:{color:"silver"}},this.origin,"/#orgs/organizations/"),this.props.editedOrganization.id.value||A.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),A.createElement("div",{className:"row",style:{flex:"1 1 0px"}},A.createElement("div",{className:"col2"},A.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:Vt()(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return A.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(Me.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.editedOrganization.name.value))),A.createElement(je.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(je.a,{type:"tool"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Managing Org Requests"))),t=A.createElement(A.Fragment,null,A.createElement(st.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),A.createElement(st.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading Org Editor...");return A.createElement(ct,{breadcrumbs:e})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(dr,{organizationId:this.props.organization.id})}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(Mt.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(Mt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):(console.log("edit org",this.props.editedOrganization,this.props.organization),this.props.editedOrganization?A.createElement("div",{className:"EditOrganization"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"mainRow"},A.createElement("div",{className:"editorColumn"},A.createElement("h3",null,"Editor"),this.renderForm()),A.createElement("div",{className:"previewColumn"},A.createElement("h3",null,"Preview"),this.renderPreview()))):A.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader()))}}]),t}(A.Component);var Hr=Object(j.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(Gr())},onUpdateName:function(t){e(Pr(t))},onUpdateGravatarHash:function(t){e(xr(t))},onUpdateDescription:function(t){e(qr(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Lr())}}(t))}}})(Br),Qr=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Fetching your orgs and other stuff...")}},{key:"renderError",value:function(){if(this.props.view.error)return A.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return A.createElement(Hr,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Fr=Object(j.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(zr(t))},onUnload:function(){e({type:q.EDIT_ORG_UNLOAD})}}})(Qr),Jr=(r(272),function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).tokenRef=A.createRef(),r.props.checkAuth(),r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return A.createElement("div",{className:"Auth-form"},"Token: ",A.createElement("input",{ref:this.tokenRef}),A.createElement(st.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return A.createElement("div",{className:"Auth-toolbar"},"Logged in as ",A.createElement("b",null,A.createElement("span",null,this.props.authorization.authorization.realname)," (",A.createElement("span",null,this.props.authorization.authorization.username)),")"," ",A.createElement(st.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case c.NONE:case c.CHECKING:return A.createElement("div",null);case c.AUTHORIZED:return A.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case c.UNAUTHORIZED:return A.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},A.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case c.ERROR:return A.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},A.createElement("p",null,"Error"),this.props.authorization.message);default:return A.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case c.NONE:case c.CHECKING:return A.createElement("div",null);case c.AUTHORIZED:return A.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case c.UNAUTHORIZED:return A.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},A.createElement("p",null,"Not authorized!"));case c.ERROR:return A.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},A.createElement("p",null,"Error: ??"));default:return A.createElement("div",null)}}},{key:"render",value:function(){return A.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(A.Component)),Yr=r(90),Zr="",Kr="api/V2/token",Xr="api/V2/me",$r=function(){function e(t){var r=t.url;Object(b.a)(this,e),this.url=r}return Object(y.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([Zr]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([Kr]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([Xr]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function en(e){return{type:q.AUTH_CHECK_ERROR,error:e}}function tn(e,t,r,n){return{type:q.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function rn(){return{type:q.AUTH_UNAUTHORIZED}}function nn(){return function(e,t){e({type:q.AUTH_CHECK_START});var r=Yr.get("kbase_session");if(r){var n=new $r({url:"/services/auth"});Promise.all([n.getTokenInfo(r),n.getMe(r)]).then(function(t){var n=Object(xe.a)(t,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(tn(r,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(en({code:"error",message:t.message}))})}else e(rn())}}var an=Object(j.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(nn())},onRemoveAuthorization:function(){e(function(e,t){Yr.remove("kbase_session"),e(rn())})},onAddAuthorization:function(t){e(function(e){return function(t,r){Yr.set("kbase_session",e);var n=new $r({url:"/services/auth"});Promise.all([n.getTokenInfo(e),n.getMe(e)]).then(function(r){var n=Object(xe.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(tn(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(en({code:"error",message:e.message}))})}}(t))}}})(Jr),sn=r(71),on=r.n(sn),cn=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(b.a)(this,e),this.name=r,this.onSuccess=n,this.onError=a},un=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).started=new Date,r.timeout=e.timeout||5e3,r}return Object(k.a)(t,e),t}(cn),ln=function(){function e(t){var r=t.name,n=t.payload,a=t.channel;Object(b.a)(this,e),this.name=r,this.payload=n,this.id=on()(),this.created=new Date,this.channel=a,this.envelope=null}return Object(y.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channel:this.channel},name:this.name,payload:this.payload}}}]),e}(),En=function(){function e(t){if(Object(b.a)(this,e),this.window=t.window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||on()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(y.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",e));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new cn({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new ln({name:e,payload:t,channel:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new ln({name:e,payload:t,channel:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,s=function(){var r=i.value,n=(c=Object(xe.a)(r,2))[0];0===c[1].filter(function(e){if(e instanceof un){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},o=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var c;s()}}catch(u){n=!0,a=u}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new un({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new un({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),dn=function(){function e(){Object(b.a)(this,e),this.params=null,this.channel=new En({window:window,host:document.location.origin})}return Object(y.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:on()(),params:{groupsServiceURL:"services/groups",userProfileServiceURL:"services/user_profile/rpc",workspaceServiceURL:"services/ws",serviceWizardURL:"services/service_wizard",feedsServiceURL:"services/feeds"},parentHost:document.location.origin}}}]),e}(),mn=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}}]),e}();function vn(e){return{type:q.APP_SUCCESS,config:e}}r(276);var pn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).props.onAppStart(),r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.status===h.NONE?A.createElement("div",{className:"KBaseIntegration"},"Loading..."):A.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(A.Component);var hn=Object(j.b)(function(e,t){return{status:e.app.status}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new mn).getParamsFromIFrame();if(r)e(vn({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL}}}));else{var n=(new dn).getParamsFromIFrame();e(vn({baseUrl:"",services:{Groups:{url:n.params.groupsServiceURL},UserProfile:{url:n.params.userProfileServiceURL},Workspace:{url:n.params.workspaceServiceURL},ServiceWizard:{url:n.params.serviceWizardURL},Feeds:{url:n.params.feedsServiceURL}}}))}})}}})(pn);function On(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,v,p;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),l=new de({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,Promise.all([u.getOrg(e),l.getPendingOrganizationRequestsForOrg(e),l.getOrganizationInvitationsForOrg(e)]);case 6:E=t.sent,d=Object(xe.a)(E,3),m=d[0],v=d[1],p=d[2],r((O=m,R=v,w=p,{type:q.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,organization:O,requests:R,invitations:w})),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),r((h={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,error:h}));case 17:case"end":return t.stop()}var h,O,R,w},t,this,[[3,14]])}));return function(e,r){return t.apply(this,arguments)}}()}r(278);var Rn=r(301),wn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){it.a.info({title:"Manage Requests Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(Me.a,{to:"/viewOrganization/".concat(this.props.viewModel.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.viewModel.organization.name))),A.createElement(je.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(je.a,{type:"tool"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Managing Org Requests"))),t=A.createElement(A.Fragment,null,A.createElement(st.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading Org Editor...");return A.createElement(ct,{breadcrumbs:e})}},{key:"niceElapsed",value:function(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),s=Math.abs(i);if(s<7776e3){if(0===s)return"now";s<60?(t=i,r=s,n="second"):s<3600?(t=Math.round(i/60),r=Math.round(s/60),n="minute"):s<86400?(t=Math.round(i/3600),r=Math.round(s/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(s/86400),n="day"),r>1&&(n+="s");var o=null,c=null;return t<0?o="in":t>0&&(c="ago"),(o?o+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=A.createElement("span",null,A.createElement(je.a,{type:"user"}),A.createElement(je.a,{type:"arrow-right"}),A.createElement(je.a,{type:"team"})," ","Request to Join Group"),n=[A.createElement(st.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),A.createElement(st.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return A.createElement(ar.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"from"),A.createElement("td",{className:"requester"},A.createElement(br,{userId:e.requester,avatarSize:50}))),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=A.createElement("span",null,A.createElement(je.a,{type:"team"}),A.createElement(je.a,{type:"mail"}),A.createElement(je.a,{type:"arrow-right"}),A.createElement(je.a,{type:"user"})," ","Invitation to Join Group"),n=[A.createElement(st.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e.id)}},"Cancel")];return A.createElement(ar.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"invitation to"),A.createElement("td",{className:"requester"},A.createElement(br,{userId:e.user,avatarSize:30}))),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case Ee.NONE:return"None";case Ee.VIEW:return"View Only";case Ee.EDIT:return"Edit";case Ee.ADMIN:return"Admin";case Ee.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=A.createElement("span",null,A.createElement(je.a,{type:"file"}),A.createElement(je.a,{type:"arrow-right"}),A.createElement(je.a,{type:"team"})," ","Request to Add Narrative"),a=[A.createElement(st.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e.id)}},"Approve"),A.createElement(st.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e.id)}},"Deny")];return t=A.createElement(Ar,{workspaceId:parseInt(e.narrativeId,10)}),A.createElement(ar.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"from"),A.createElement("td",{className:"requester"},A.createElement(br,{userId:e.requester,avatarSize:30}))),A.createElement("tr",null,A.createElement("th",null,"narrative"),A.createElement("td",{className:"narrative"},t)),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=A.createElement("span",null,A.createElement(je.a,{type:"appstore"}),A.createElement(je.a,{type:"arrow-right"}),A.createElement(je.a,{type:"team"})," ","Request to Add App"),n=[A.createElement(st.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),A.createElement(st.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return A.createElement(ar.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"from"),A.createElement("td",{className:"requester"},A.createElement(br,{userId:e.requester,avatarSize:50}))),A.createElement("tr",null,A.createElement("th",null,"app"),A.createElement("td",{className:"requester"},e.appId)),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequest",value:function(e){switch(e.type){case i.REQUEST:switch(e.resourceType){case s.USER:return this.renderRequestJoinRequest(e);case s.WORKSPACE:return this.renderRequestNarrativeRequest(e);case s.APP:return this.renderRequestAppRequest(e);default:throw new Error("Unsupported resource type: "+e.resourceType)}case i.INVITATION:switch(e.resourceType){case s.USER:return this.renderRequestJoinInvitation(e);case s.WORKSPACE:throw new Error("Workspace invitations are not supported");case s.APP:throw new Error("App invitations are not supported");default:throw new Error("Unsupported resource type: "+e.resourceType)}}}},{key:"renderRequests",value:function(){var e=this,t=this.props.viewModel.requests;return 0===t.length?A.createElement(Ue.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending requests for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"renderInvitations",value:function(){var e=this,t=this.props.viewModel.invitations;return 0===t.length?A.createElement(Ue.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending invitations for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"render",value:function(){if(this.state.cancelToBrowser)return A.createElement(Rn.a,{push:!0,to:"/organizations"});if(this.state.cancelToViewer)return A.createElement(Rn.a,{push:!0,to:"/viewOrganization/"+this.props.viewModel.organization.id});var e=this.props.viewModel.invitations.length,t=this.props.viewModel.requests.length;return A.createElement("div",{className:"ManageGroupRequests"},this.renderHeader(),A.createElement(dr,{organizationId:this.props.viewModel.organization.id}),A.createElement("div",{className:"row"},A.createElement("div",{className:"pendingCol"},A.createElement("h2",null,"Requests (",t,")"),A.createElement("div",{className:"pendingRequests"},this.renderRequests())),A.createElement("div",{className:"historyCol"},A.createElement("h2",null,"Invitations (",e,")"),this.renderInvitations())))}}]),t}(A.Component);var gn=Object(j.b)(function(e,t){var r=e.views.manageOrganizationRequestsView;if(!r.viewModel)throw new Error("view state not loaded!");return{viewModel:r.viewModel}},function(e){return{onAcceptJoinRequest:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.views.manageOrganizationRequestsView,u=a.app.config,l=new de({token:s,username:o,groupsServiceURL:u.services.Groups.url}),c){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,t.next=7,l.acceptRequest(e);case 7:E=t.sent,r((m=E,{type:q.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,request:m})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,error:d}));case 14:case"end":return t.stop()}var d,m},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onDenyJoinRequest:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.views.manageOrganizationRequestsView,u=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return l=new de({token:s,username:o,groupsServiceURL:u.services.Groups.url}),t.prev=4,t.next=7,l.denyRequest(e);case 7:E=t.sent,r((m=E,{type:q.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,request:m})),c.viewModel&&r(On(c.viewModel.organization.id)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,error:d}));case 15:case"end":return t.stop()}var d,m},t,this,[[4,12]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onCancelJoinInvitation:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.views.manageOrganizationRequestsView,u=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return l=new de({token:s,username:o,groupsServiceURL:u.services.Groups.url}),t.prev=4,t.next=7,l.cancelRequest(e);case 7:t.sent,c.viewModel&&r(On(c.viewModel.organization.id)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((E={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,error:E}));case 14:case"end":return t.stop()}var E},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,u.grantViewAccess(e);case 6:l=t.sent,r((d=l,{type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,request:d})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(wn),fn=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.loadingState){case R.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.SUCCESS:return A.createElement(gn,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Sn=Object(j.b)(function(e,t){return{loadingState:e.views.manageOrganizationRequestsView.loadingState}},function(e){return{onLoad:function(t){e(On(t))},onUnload:function(){e({type:q.ADMIN_MANAGE_REQUESTS_UNLOAD})}}})(fn);function _n(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.VIEW_MEMBERS_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new Bt({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),t.prev=3,t.next=6,u.getOrganizationForUser(e);case 6:l=t.sent,E=l.organization,d=l.relation,r((v=E,p=d,{type:q.VIEW_MEMBERS_LOAD_SUCCESS,organization:v,relation:p})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),r((m={code:t.t0.name,message:t.t0.message},{type:q.VIEW_MEMBERS_LOAD_ERROR,error:m}));case 15:case"end":return t.stop()}var m,v,p},t,this,[[3,12]])}));return function(e,r){return t.apply(this,arguments)}}()}function An(e){return function(t,r){t({type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new we({token:i,username:s,groupsServiceURL:o.services.Groups.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function Nn(e){return function(t,r){t({type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new we({token:i,username:s,groupsServiceURL:o.services.Groups.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function In(e){return function(t,r){t({type:q.VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new we({token:i,username:s,groupsServiceURL:o.services.Groups.url}).removeMember(c.organization.id,e).then(function(){t({type:q.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS}),t(_n(c.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(131);var Tn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={over:!1},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderPromoteButton",value:function(){var e=this;switch(this.props.member.type){case ue.MEMBER:return A.createElement(st.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onPromoteMemberToAdmin(e.props.member.username)}},A.createElement(je.a,{type:"unlock"}),"Promote to Admin");case ue.ADMIN:return A.createElement(st.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onDemoteAdminToMember(e.props.member.username)}},A.createElement(je.a,{type:"user"}),"Demote to Member");case ue.OWNER:return}}},{key:"renderMemberButtons",value:function(e){var t=this;if(this.props.relation.type===le.OWNER||this.props.relation.type===le.ADMIN)return A.createElement("div",null,A.createElement("div",null,A.createElement(st.a,{type:"danger",disabled:!this.state.over,style:{width:"100%"},onClick:function(){t.props.onRemoveMember(e.username)}},A.createElement(je.a,{type:"delete"}),"Remove from Org")),A.createElement("div",null,this.renderPromoteButton()))}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.props.onRemoveMember(t.username)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=A.createElement(ir.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},A.createElement(ir.a.Item,{key:"promoteToAdmin"},A.createElement(je.a,{type:"unlock"}),"Promote to Admin"),A.createElement(ir.a.Item,{key:"removeMember"},A.createElement(je.a,{type:"delete"}),"Remove Member"));return A.createElement("div",null,A.createElement(sr.a,{overlay:r,trigger:["click"]},A.createElement(st.a,{icon:"ellipsis"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=A.createElement(ir.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},A.createElement(ir.a.Item,{key:"demoteToMember"},A.createElement(je.a,{type:"user"}),"Demote to Member"));return A.createElement("div",null,A.createElement(sr.a,{overlay:r,trigger:["click"]},A.createElement(st.a,{icon:"ellipsis"})))}},{key:"renderOwnerMenu",value:function(e){}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===le.OWNER||this.props.relation.type===le.ADMIN)switch(this.props.member.type){case ue.OWNER:return this.renderOwnerMenu(e);case ue.ADMIN:return this.renderAdminMenu(e);case ue.MEMBER:return this.renderMemberMenu(e)}}},{key:"onMouseOver",value:function(){this.setState({over:!0})}},{key:"onMouseOut",value:function(){this.setState({over:!1})}},{key:"render",value:function(){return A.createElement("div",{key:this.props.member.username,className:"memberRow",onMouseEnter:this.onMouseOver.bind(this),onMouseLeave:this.onMouseOut.bind(this)},A.createElement("div",{style:{flex:"1 1 0px"}},A.createElement(rt,{member:this.props.member,avatarSize:50,key:this.props.member.username})),A.createElement("div",{style:{flex:"0 0 10em",textAlign:"right"}},this.renderMemberOptions(this.props.member)))}}]),t}(A.Component),bn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onPromoteMemberToAdmin",value:function(e){this.props.onPromoteMemberToAdmin(e)}},{key:"onDemoteAdminToMember",value:function(e){this.props.onDemoteAdminToMember(e)}},{key:"onShowInfo",value:function(){it.a.info({title:"View Members Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the view members tool..."))})}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===le.OWNER||this.props.relation.type===le.ADMIN||this.props.relation.type===le.MEMBER)}},{key:"isAdmin",value:function(){return!!this.props.organization&&(this.props.relation.type===le.OWNER||this.props.relation.type===le.ADMIN)}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(Me.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(je.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(je.a,{type:"team"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Viewing Org Members"))),t=A.createElement(A.Fragment,null,A.createElement(st.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderMembersToolbar",value:function(){switch(this.props.relation.type){case le.NONE:return A.createElement("div",{className:"toolbar"},A.createElement(st.a,null,A.createElement(je.a,{type:"plus"}),"Join"));case le.MEMBER:return A.createElement("div",{className:"toolbar"});case le.ADMIN:case le.OWNER:return A.createElement("div",{className:"toolbar"},A.createElement(Me.a,{to:"/inviteUser/"+this.props.organization.id},A.createElement(st.a,null,A.createElement(je.a,{type:"mail"})," Invite a User")))}}},{key:"renderMembers",value:function(){var e,t=this;return this.isMember()?(e=0===this.props.organization.members.length?A.createElement("p",{className:"message"},"This organization has no members"):this.props.organization.members.map(function(e){return A.createElement(A.Fragment,{key:e.username},A.createElement(Tn,{member:e,relation:t.props.relation,organization:t.props.organization,onPromoteMemberToAdmin:t.props.onPromoteMemberToAdmin,onDemoteAdminToMember:t.props.onDemoteAdminToMember,onRemoveMember:t.props.onRemoveMember}))}),A.createElement("div",{className:"table infoTable"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col0",style:{display:"flex",flexDirection:"column",overflowY:"auto"}},e)))):A.createElement("p",{className:"message"},"Sorry, group membership restricted to members only")}},{key:"renderAdminsToolbar",value:function(){return A.createElement("div",{className:"toolbar"})}},{key:"renderOrganizationHeader",value:function(){return A.createElement(dr,{organizationId:this.props.organization.id})}},{key:"componentWillUnmount",value:function(){this.props.onViewMembersUnload()}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(Rn.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(Rn.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):A.createElement("div",{className:"ViewMembers"},this.renderHeader(),this.renderOrganizationHeader(),A.createElement("div",{className:"body"},A.createElement("div",{className:"membersCol"},A.createElement("h2",null,"Members"),this.renderMembersToolbar(),this.renderMembers()),A.createElement("div",{className:"otherCol"},A.createElement("h2",null,"Pending Members"),this.renderAdminsToolbar(),A.createElement("p",null,"This space to provide a list of user requests and invitations. This will allow this view to provide all user management tools in one place."),A.createElement("p",null,"In progress... currently renders the requests but does not provide actions (buttons)."))))}}]),t}(A.Component);var yn=Object(j.b)(function(e,t){if(!e.views.viewMembersView||null===e.views.viewMembersView.viewModel)throw new Error("Runtime Error - view members view is not defined!");var r=e.views.viewMembersView.viewModel;return{organization:r.organization,relation:r.relation}},function(e){return{onViewMembersUnload:function(){e({type:q.VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(An(t))},onDemoteAdminToMember:function(t){e(Nn(t))},onRemoveMember:function(t){e(In(t))}}})(bn),Dn=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.state){case R.NONE:return this.props.onViewMembersLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.SUCCESS:return A.createElement(yn,null)}}}]),t}(A.Component);var Cn=Object(j.b)(function(e,t){return{state:e.views.viewMembersView.loadingState}},function(e){return{onViewMembersLoad:function(t){e(_n(t))}}})(Dn);function kn(e){return{type:q.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Mn(e){return{type:q.INVITE_USER_SELECT_USER_ERROR,error:e}}function Un(e){return function(t,r){t({type:q.INVITE_USER_SELECT_USER_START});var n=r(),i=n.views.inviteUserView.viewModel,s=n.auth.authorization,o=s.token,c=(s.username,n.app.config);i?new Pe({token:o,userProfileServiceURL:c.services.UserProfile.url}).getUser(e).then(function(e){var r=function(e,t){if(e.username===t.owner.username)return le.OWNER;var r=t.members.find(function(t){return t.username===e.username});if(r)switch(r.type){case a.ADMIN:return le.ADMIN;case a.OWNER:return le.OWNER;case a.MEMBER:return le.MEMBER}return le.VIEW}(e,i.organization);t(function(e,t){return{type:q.INVITE_USER_SELECT_USER_SUCCESS,user:e,relation:t}}(e,r))}).catch(function(e){t(Mn({code:e.name,message:e.message}))}):t(Mn({code:"invalid state",message:"select user invalid state -- no view value"}))}}function Vn(){return function(e,t){e({type:q.INVITE_USER_SEND_INVITATION_START});var r=t(),n=r.auth.authorization,a=n.token,i=n.username,s=r.app.config,o=r.views.inviteUserView,c=o.loadingState,u=o.viewModel;o.error;if(c===R.SUCCESS&&null!==u){var l=u,E=l.selectedUser,d=l.organization.id;if(E)new de({token:a,username:i,groupsServiceURL:s.services.Groups.url}).inviteUserToJoinOrg(d,E.user.username).then(function(t){e({type:q.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){var r;e((r={code:t.name,message:t.message},{type:q.INVITE_USER_SEND_INVITATION_ERROR,error:r}))})}}}r(281),r(283);var jn=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return A.createElement("div",{className:"User"},A.createElement("div",{className:"avatarCol"},A.createElement(Ve,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),A.createElement("div",{className:"organization"},this.props.user.organization||A.createElement("i",null,"no organization in user profile")),A.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||A.createElement("i",null,"no location information in user profile"))))}}]),t}(A.Component),zn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).lastSearchAt=null,r.searchInput=A.createRef(),r.searchButton=A.createRef(),r.state={cancelToViewMembers:!1,cancelToBrowser:!1,cancelToViewer:!1,autocompleteMessage:""},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onClickCancelToViewMembers",value:function(){this.setState({cancelToViewMembers:!0})}},{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"onShowInfo",value:function(){it.a.info({title:"Invite User Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the invite user tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(Me.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(je.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(je.a,{type:"tool"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Invite a User to Join Org"))),t=A.createElement(A.Fragment,null,A.createElement(st.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewMembers.bind(this)},"Return to Org Members"),A.createElement(st.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Return to this Org"),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return A.createElement(Ue.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?A.createElement(Ue.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===le.NONE?A.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},A.createElement("div",{className:"name "},t.realname," (",t.username,")")):A.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},A.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return A.createElement("div",{className:"orgInfo"},A.createElement("div",{className:"name"},A.createElement("span",{className:"field-label"},"name"),A.createElement("span",null,this.props.organization.name)),A.createElement("div",{className:"description"},A.createElement("span",{className:"field-label"},"description"),A.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===le.VIEW?e=A.createElement(st.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=A.createElement(st.a,{disabled:!0,type:"primary"},"Send Invitation"),t=A.createElement("div",null,"User may not be invited because:",A.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=A.createElement(Ue.a,{type:"warning",message:t,showIcon:!0})):(e=A.createElement(st.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),A.createElement("div",{className:"invitationForm"},A.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),A.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case g.NONE:return A.createElement("div",null,"NONE");case g.EDITING:return A.createElement("div",null,"EDITING");case g.SENDABLE:return A.createElement("div",null,"SENDABLE");case g.SENDING:return A.createElement("div",null,"SENDING");case g.SUCCESS:return A.createElement("div",null,"SENT SUCCESSFULLY");case g.ERROR:return A.createElement("div",null,"ERROR SENDING");default:return A.createElement("div",null,"Bad State")}}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(dr,{organizationId:this.props.organization.id})}},{key:"renderRelation",value:function(e){switch(e){case le.NONE:return A.createElement("span",null,A.createElement(je.a,{type:"stop"}),"None");case le.VIEW:return A.createElement("span",null,A.createElement(je.a,{type:"stop"})," Not a member");case le.MEMBER_REQUEST_PENDING:return A.createElement("span",null,A.createElement(je.a,{type:"user",style:{color:"orange"}})," User's membership ",A.createElement("b",null,"request")," is pending");case le.MEMBER_INVITATION_PENDING:return A.createElement("span",null,A.createElement(je.a,{type:"user",style:{color:"blue"}})," User has been ",A.createElement("b",null,"invited")," to join");case le.MEMBER:return A.createElement("span",null,A.createElement(je.a,{type:"user"})," User is a ",A.createElement("b",null,"member")," of this organization");case le.ADMIN:return A.createElement("span",null,A.createElement(je.a,{type:"unlock"}),"User is an ",A.createElement("b",null,"admin")," of this organization");case le.OWNER:return A.createElement("span",null,A.createElement(je.a,{type:"crown"})," User is the ",A.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?A.createElement("div",{className:"selectedUser"},A.createElement("p",{className:"noSelection"},"No user yet selected")):A.createElement("div",{className:"selectedUser"},A.createElement(jn,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return A.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return A.createElement(je.a,{type:"search"})}},{key:"render",value:function(){return this.state.cancelToViewMembers?A.createElement(Mt.a,{push:!0,to:"/viewMembers/"+this.props.organization.id}):this.state.cancelToBrowser?A.createElement(Mt.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(Mt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):A.createElement("div",{className:"InviteUser scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"row scrollable-flex-column"},A.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},A.createElement("h3",null,"Select User to Invite"),A.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},A.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),A.createElement(st.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),A.createElement("div",{className:"usersTable"},this.renderUsers())),A.createElement("div",{className:"col1 lastCol"},A.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(A.Component);zn.searchDebounce=200;var Gn=zn;var Ln=Object(j.b)(function(e,t){if(!e.views.inviteUserView||null===e.views.inviteUserView.viewModel)throw new Error("Runtime Error - invite members view is not defined!");var r=e.views.inviteUserView.viewModel;return{organization:r.organization,users:r.users,selectedUser:r.selectedUser,editState:r.editState}},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var i,s,o,c,u,l,E,d,m,v,p,h,O,R;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(kn(null)),t.abrupt("return");case 4:if(i=n(),s=i.views.inviteUserView.viewModel,o=i.auth.authorization,c=o.token,o.username,u=i.app.config,null!==s){t.next=7;break}return t.abrupt("return");case 7:return l=s.organization,E=new Pe({token:c,userProfileServiceURL:u.services.UserProfile.url}),d=l.owner.username,m=[],v=[],p=[],h=[],l.members.forEach(function(e){switch(e.type){case a.MEMBER:v.push(e.username);case a.ADMIN:m.push(e.username)}}),t.prev=16,t.next=19,E.searchUsers(e);case 19:O=t.sent,R=O.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?le.OWNER:m.indexOf(t)>=0?le.ADMIN:p.indexOf(t)>=0?le.MEMBER_INVITATION_PENDING:h.indexOf(t)>=0?le.MEMBER_REQUEST_PENDING:v.indexOf(t)>=0?le.MEMBER:le.NONE}}),r(kn(R)),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(16),r((w={code:t.t0.name,message:t.t0.message},{type:q.INVITE_USER_SEARCH_USERS_ERROR,error:w}));case 27:case"end":return t.stop()}var w},t,this,[[16,24]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){e(Un(t))},onSendInvitation:function(){e(Vn())}}})(Gn),Pn=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading Users...")}},{key:"renderError",value:function(){return A.createElement("div",null,"Error!")}},{key:"render",value:function(){switch(this.props.loadingState){case R.NONE:return this.props.onInviteUserLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return A.createElement(Ln,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var xn=Object(j.b)(function(e,t){return{loadingState:e.views.inviteUserView.loadingState}},function(e){return{onInviteUserLoad:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,u.getOrg(e);case 6:l=t.sent,r((d=l,{type:q.INVITE_USER_LOAD_SUCCESS,organization:d,users:null})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:q.INVITE_USER_LOAD_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.INVITE_USER_UNLOAD})}}})(Pn),qn=(r(285),function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"doCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"doCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"doShowInfo",value:function(){it.a.info({title:"Manage My Membership Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the view to help you manage your membership..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(Me.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(je.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(je.a,{type:"user"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Manage your membership"))),t=A.createElement(A.Fragment,null,A.createElement(st.a,{icon:"undo",type:"danger",onClick:this.doCancelToViewer.bind(this)},"Return to this Org"),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(dr,{organizationId:this.props.organization.id})}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(Mt.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(Mt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):A.createElement("div",{className:"ManageMembership"},this.renderHeader(),this.renderOrgHeader(),A.createElement("h3",null,"Edit Organization Profile"),A.createElement("div",{className:"body"},A.createElement("div",{className:"col1"},A.createElement("div",{className:"editorTable"},A.createElement("div",{className:"editorTable-row"},A.createElement("div",{className:"editorTable-labelCol"},A.createElement("span",{className:"field-label"},"title")),A.createElement("div",{className:"editorTable-controlCol"},A.createElement(jt.a,null))))),A.createElement("div",{className:"col2"},A.createElement("div",null,"org user profile here"))),A.createElement("h3",null,"User Profile"),A.createElement("p",null,"Your user profile is ..."),A.createElement("h3",null,"Leave Org"),A.createElement(st.a,null,"Leave This Org"))}}]),t}(A.Component));var Wn=Object(j.b)(function(e,t){if(!e.views.manageMembershipView.viewModel)throw new Error("View model missing");return{username:e.auth.authorization.username,organization:e.views.manageMembershipView.viewModel.organization}},function(e){return{}})(qn);var Bn=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading view...")}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return A.createElement(Wn,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Hn,Qn=Object(j.b)(function(e,t){return{view:e.views.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.MANAGE_MEMBERSHIP_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,u.getOrg(e);case 6:l=t.sent,r((d=l,{type:q.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:d})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:q.MANAGE_MEMBERSHIP_LOAD_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.MANAGE_MEMBERSHIP_UNLOAD})}}})(Bn);r(287);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Hn||(Hn={}));var Fn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={navigateTo:Hn.NONE},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"doCancelToBrowser",value:function(){this.setState({navigateTo:Hn.BROWSER})}},{key:"doCancelToViewer",value:function(){this.setState({navigateTo:Hn.VIEWER})}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doShowInfo",value:function(){it.a.info({title:"Request to Add Narrative Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the view to help you request the addition of a narrative to this org..."))})}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(dr,{organizationId:this.props.organization.id})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(Me.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(je.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(je.a,{type:"plus"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Add Narrative to Org"))),t=A.createElement(A.Fragment,null,A.createElement(st.a,{icon:"undo",type:"danger",onClick:this.doCancelToViewer.bind(this)},"Return to this Org"),A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderNarratives",value:function(){var e=this;return this.props.narratives.map(function(t,r){var n=["narrative"];return!(!e.props.selectedNarrative||t.workspaceId!==e.props.selectedNarrative.workspaceId)&&n.push("selected"),t.status===f.ASSOCIATED?(n.push("narrativeInOrg"),A.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},A.createElement("div",{className:"title"},t.title||"n/a"," (associated)"))):t.status===f.REQUESTED?(n.push("narrativeInOrg"),A.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},A.createElement("div",{className:"title"},t.title||"n/a"," (request pending)"))):(n.push("narrativeNotInOrg"),A.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},A.createElement("div",{className:"title"},t.title||"n/a")))})}},{key:"onSearchSubmit",value:function(){console.log("searching...")}},{key:"renderSearchIcon",value:function(){return this.props.searching?A.createElement(je.a,{type:"loading"}):A.createElement(je.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return A.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSearchSubmit.bind(this)},A.createElement("input",{placeholder:"Search Organizations",autoFocus:!0}),A.createElement(st.a,{className:"button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"onSortByChange",value:function(){}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return A.createElement("div",{className:"filterSortBar"},A.createElement("span",{className:"field-label"},"sort by"),A.createElement(ot.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},A.createElement(ot.a.Option,{value:"title",key:"title"},"Title"),A.createElement(ot.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")),A.createElement(ot.a,{onChange:this.onSortDirectionChange.bind(this),style:{width:"4em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},A.createElement(ot.a.Option,{value:O.ASCENDING,key:"name"},A.createElement(je.a,{type:"sort-ascending"})),A.createElement(ot.a.Option,{value:O.DESCENDING,key:"owner"},A.createElement(je.a,{type:"sort-descending"}))))}},{key:"renderNarrativeSelector",value:function(){return A.createElement("div",{className:"narrativeSelector scrollable-flex-column"},A.createElement("div",{style:{display:"flex",flexDirection:"row"}},A.createElement("div",{style:{flex:"0 0 10em"}},this.renderSearchBar()),A.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),A.createElement("div",{className:"narratives scrollable-flex-column"},A.createElement("div",{className:"narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===f.ASSOCIATED?A.createElement(Ue.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===f.REQUESTED?A.createElement(Ue.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===le.ADMIN||this.props.relation.type===le.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",A.createElement(st.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?A.createElement("div",{className:"selectedNarrative"},A.createElement("div",{className:"title"},this.props.selectedNarrative.title),A.createElement("div",null,A.createElement("i",null,"last modified")," ",Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.selectedNarrative.modifiedAt))):A.createElement(Ue.a,{type:"info",message:"Select a narrative on the left to show it here and be able to add it to this organization."})}},{key:"render",value:function(){switch(this.state.navigateTo){case Hn.BROWSER:return A.createElement(Mt.a,{push:!0,to:"/organizations"});case Hn.VIEWER:return A.createElement(Mt.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id});case Hn.NONE:}return A.createElement("div",{className:"RequestNarrative scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"body scrollable-flex-column"},A.createElement("div",{className:"selectNarrativeCol scrollable-flex-column"},A.createElement("h3",null,"Select a Narrative"),this.renderNarrativeSelector()),A.createElement("div",{className:"selectedNarrativeCol"},A.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),A.createElement("div",{className:"selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),A.createElement("div",{className:"footer"}))}}]),t}(A.Component);function Jn(e){return function(t,r){t({type:q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}var Yn=Object(j.b)(function(e,t){if(null===e.views.requestNarrativeView.viewModel)throw new Error("view value is not defined!");var r=e.views.requestNarrativeView.viewModel;return{organization:r.organization,relation:r.relation,narratives:r.narratives,selectedNarrative:r.selectedNarrative,searching:!1,sortBy:"title",sortDirection:O.ASCENDING,filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(te.a)(ee.a.mark(function r(n,a){var i,s,o,c,u,l,E;return ee.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:q.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,u=i.app.config,l=new we({token:o,username:c,groupsServiceURL:u.services.Groups.url}),r.prev=3,r.next=6,l.addOrRequestNarrativeToGroup(e,t.workspaceId);case 6:E=r.sent,n((m=E,{type:q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:m})),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n((d={code:r.t0.name,message:r.t0.message},{type:q.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 13:case"end":return r.stop()}var d,m},r,this,[[3,10]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(Jn(t))}}})(Fn),Zn=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading Your Narratives...")}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(this.props.organizationId),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return A.createElement(Yn,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Kn=Object(j.b)(function(e,t){return{view:e.views.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(te.a)(ee.a.mark(function t(r,n){var a,i,s,o,c,u,l,E,d,m,v,p,h,O,R;return ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),l=new $e({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url}),E=new de({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,Promise.all([u.getOrg(e),l.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,m=Object(xe.a)(d,4),v=m[0],p=m[1],h=m[2],O=m[3],R=ve(v,o,h,O),r((g=v,f=p,S=R,{type:q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:g,narratives:f,relation:S})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((w={code:t.t0.name,message:t.t0.message},{type:q.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:w}));case 22:case"end":return t.stop()}var w,g,f,S},t,this,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(Zn),Xn=(r(289),function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.user?this.props.render(this.props.user):(this.props.onLoad(this.props.userId),A.createElement("div",null,"Loading user..."))}}]),t}(A.Component));var $n=Object(j.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(et(t))}}})(Xn),ea=(r(291),function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"getAvatarUrl",value:function(e){if(!e.gravatarHash)return"unicorn-64.png";return"https://www.gravatar.com/avatar/"+e.gravatarHash+"?s=64&amp;r=pg&d=identicon"}},{key:"renderAvatar",value:function(e){return A.createElement("img",{style:{width:64,height:64},src:this.getAvatarUrl(e)})}},{key:"renderRelation",value:function(){switch(this.props.organization.relation.type){case le.NONE:return A.createElement("span",null,A.createElement(je.a,{type:"stop"}),"None");case le.VIEW:return A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},A.createElement("span",null,A.createElement(je.a,{type:"stop"})," You are not a member - view group to join"));case le.MEMBER_REQUEST_PENDING:return A.createElement("span",null,A.createElement(je.a,{type:"user",style:{color:"orange"}})," Your membership ",A.createElement("b",null,"request")," is pending");case le.MEMBER_INVITATION_PENDING:return A.createElement("span",null,A.createElement(je.a,{type:"user",style:{color:"blue"}})," You have been ",A.createElement("b",null,"invited")," to join");case le.MEMBER:return A.createElement("span",null,A.createElement(je.a,{type:"user"})," You are a ",A.createElement("b",null,"member")," of this organization");case le.ADMIN:return A.createElement("span",null,A.createElement(je.a,{type:"unlock"}),"Admin");case le.OWNER:return A.createElement(nr.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},A.createElement("span",null,A.createElement(je.a,{type:"crown"})," You are the ",A.createElement("b",null,"owner")," of this Organization"))}}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(){var e=this.props.organization.organization;return A.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderRelationInfo",value:function(){switch(this.props.organization.relation.type){case le.NONE:case le.VIEW:return A.createElement("div",null,"Only members may view membership information");case le.MEMBER:return A.createElement("div",null,this.renderMemberCount());case le.MEMBER_REQUEST_PENDING:case le.MEMBER_INVITATION_PENDING:return A.createElement("div",null,"Only members may view membership information");case le.ADMIN:case le.OWNER:return A.createElement("div",null,this.renderMemberCount())}}},{key:"renderAdminInfo",value:function(){if(this.props.organization.relation.type===le.OWNER||this.props.organization.relation.type===le.ADMIN){var e,t=this.props.organization.groupRequests;return t&&t.length>0&&(e=A.createElement("div",null,A.createElement(je.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," ","there"," ",t.length>1?"are":"is"," ",A.createElement("b",null,t.length," pending request",t.length>1?"s":""))),A.createElement("div",{className:"admin"},e)}}},{key:"renderPrivate",value:function(){return this.props.organization.organization.isPrivate?A.createElement("span",null,A.createElement(je.a,{type:"lock"})," ","private"):A.createElement("span",null,A.createElement(je.a,{type:"global"})," ","public")}},{key:"renderMemberCompact",value:function(e){return A.createElement($n,{userId:e.username,render:function(t){return A.createElement("a",{href:"/#people/"+e.username,target:"_blank"},t.realname," \u2768",e.username,"\u2769")}})}},{key:"render",value:function(){var e=this.props.organization.organization;return A.createElement("div",{className:"OrganizationBlock",key:e.id},A.createElement("div",{className:"avatarCol"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},this.renderAvatar(e))),A.createElement("div",{className:"bodyCol"},A.createElement("div",{className:"orgName"},A.createElement(Me.a,{to:"/viewOrganization/".concat(e.id)},e.name)),A.createElement("div",null,this.renderPrivate()),A.createElement("div",null,this.renderRelation()),A.createElement("div",null,this.renderRelationInfo()),A.createElement("div",null,this.renderAdminInfo()),A.createElement("div",{className:"orgOwner"},A.createElement("span",{className:"field-label"},"owner"),A.createElement("span",{className:"field-value"},this.renderMemberCompact(e.owner))),A.createElement("div",{className:"orgCreated"},A.createElement("span",{className:"field-label"},"established"),A.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))))}}]),t}(A.Component)),ta=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderNotification",value:function(e){return A.createElement("div",{className:"notification"},A.createElement("div",null,e.actor),A.createElement("div",null,e.verb),A.createElement("div",null,e.source))}},{key:"renderNotifications",value:function(){var e=this;return 0===this.props.notifications.length?A.createElement("div",{className:"message"},"No unread notifications"):this.props.notifications.map(function(t){return e.renderNotification(t)})}},{key:"render",value:function(){return A.createElement("div",{className:"Notifications"},this.renderNotifications())}}]),t}(A.Component);var ra,na=Object(j.b)(function(e){var t=e.db.notifications.byId.values();return{notifications:Array.from(t)}},function(e){return{}})(ta);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.NEW_ORG=2]="NEW_ORG"}(ra||(ra={}));var aa=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(D.a)(this,Object(C.a)(t).call(this,e))).state={navigateTo:ra.NONE},r}return Object(k.a)(t,e),Object(y.a)(t,[{key:"onNavigateToBrowser",value:function(){this.setState({navigateTo:ra.BROWSER})}},{key:"onNavigateToNewOrg",value:function(){this.setState({navigateTo:ra.NEW_ORG})}},{key:"onShowInfo",value:function(){it.a.info({title:"Dashboard",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the dashboard..."))})}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,"Your Orgs Dashboard")),t=A.createElement(A.Fragment,null,A.createElement(st.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(ct,{breadcrumbs:e,buttons:t})}},{key:"renderOrganizations",value:function(){if(0===this.props.viewModel.organizations.length){var e=A.createElement("div",null,A.createElement("p",null,"You are not associated with any Organizations"),A.createElement("p",null,"To get started, you can create a"," ",A.createElement(st.a,{onClick:this.onNavigateToNewOrg.bind(this)},A.createElement(je.a,{type:"plus"})," ","New")," ","Organization, or"," ",A.createElement(st.a,{onClick:this.onNavigateToBrowser.bind(this)},"Browse All")," ","organizations to find one to join."));return A.createElement(Ue.a,{type:"info",message:e})}return this.props.viewModel.organizations.map(function(e){return A.createElement("div",{key:e.organization.id},A.createElement(ea,{organization:e}))})}},{key:"renderOrganizationsCard",value:function(){var e=A.createElement("div",null,A.createElement(st.a,{key:"newOrgButton",onClick:this.onNavigateToNewOrg.bind(this)},A.createElement(je.a,{type:"plus"})," ","New")," ",A.createElement(st.a,{key:"browseButton",onClick:this.onNavigateToBrowser.bind(this)},"Browse All"));return A.createElement(ar.a,{title:"Your Organizations",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard yourOrgsCard",extra:e},this.renderOrganizations())}},{key:"renderNotificationsCard",value:function(){return A.createElement(ar.a,{title:"Notifications",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard notificationsCard"},this.renderPendingNotifications())}},{key:"renderRequestRequester",value:function(e){return A.createElement(br,{userId:e.requester,avatarSize:30})}},{key:"renderPendingRequestsSentCard",value:function(){return A.createElement(ar.a,{title:"Outbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard pendingRequestsCard"},this.renderPendingRequestsSent())}},{key:"renderPendingRequestsReceivedCard",value:function(){return A.createElement(ar.a,{title:"Inbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard pendingInvitationsCard"},this.renderPendingRequestsReceived())}},{key:"isAdmin",value:function(){return this.props.viewModel.organizations.some(function(e){var t=e.relation;return t.type===le.OWNER||t.type===le.ADMIN})}},{key:"renderPendingAdminTasksCard",value:function(){if(this.isAdmin())return A.createElement(ar.a,{title:"Organization Inbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard pendingAdminTasksCard"},this.renderPendingAdminRequests())}},{key:"renderPendingNotifications",value:function(){return A.createElement(na,null)}},{key:"renderPendingRequestsSent",value:function(){return 0===this.props.viewModel.pendingRequests.length?A.createElement("div",{className:"message"},"No pending requests"):this.props.viewModel.pendingRequests.map(function(e,t){return A.createElement("div",{key:t},A.createElement(Dr,{request:e}))})}},{key:"renderPendingAdminRequests",value:function(){var e=this.props.viewModel.pendingAdminRequests;return 0===e.length?A.createElement("div",{className:"message"},"No pending organization requests"):e.map(function(e,t){return A.createElement(A.Fragment,{key:t},A.createElement(yr,{request:e}))})}},{key:"renderPendingRequestsReceived",value:function(){return 0===this.props.viewModel.pendingInvitations.length?A.createElement("div",{className:"message"},"No pending invitations"):this.props.viewModel.pendingInvitations.map(function(e){return A.createElement(yr,{request:e})})}},{key:"render",value:function(){switch(this.state.navigateTo){case ra.BROWSER:return A.createElement(Mt.a,{to:"/organizations"});case ra.NEW_ORG:return A.createElement(Mt.a,{to:"/newOrganization"})}return A.createElement("div",{className:"Dashboard scrollable-flex-column"},this.renderHeader(),A.createElement("div",{className:"body scrollable-flex-column"},A.createElement("div",{className:"col1"},this.renderOrganizationsCard()),A.createElement("div",{className:"col2"},this.renderNotificationsCard(),this.renderPendingRequestsReceivedCard(),this.renderPendingRequestsSentCard(),this.renderPendingAdminTasksCard())))}}]),t}(A.Component);var ia,sa=Object(j.b)(function(e,t){var r=e.views.dashboardView,n=e.auth.authorization.username;if(null===r.viewModel)throw new Error("view model is null!");return{viewModel:r.viewModel,currentUser:n}},function(e){return{onCancelOutboxRequest:function(e){}}})(aa),oa=function(){function e(t){Object(b.a)(this,e),this.params=t}return Object(y.a)(e,[{key:"get",value:function(){var e=Object(te.a)(ee.a.mark(function e(t){var r,n,a,i;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.params.url,"api","V1"].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.params.token,Accept:"application/json"},mode:"cors"});case 3:if("application/json"!==(n=e.sent).headers.get("Content-Type")){e.next=13;break}if(200!==n.status){e.next=10;break}return e.next=8,n.json();case 8:return a=e.sent,e.abrupt("return",a);case 10:throw new Error("Non-success response: "+n.status+": "+n.statusText);case 13:return e.next=15,n.text();case 15:throw i=e.sent,new Error("Non-JSON response"+i);case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getNotifications",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["notifications"]);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();function ca(e){switch(e){case"alert":return ia.ALERT;case"error":return ia.ERROR;case"warning":return ia.WARNING;case"request":return ia.REQUEST;default:throw new Error("Invalid level value: "+e)}}!function(e){e[e.ALERT=0]="ALERT",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.REQUEST=3]="REQUEST"}(ia||(ia={}));var ua=function(){function e(t){Object(b.a)(this,e),this.params=t,this.feedsClient=new oa({token:this.params.token,url:this.params.feedsServiceURL})}return Object(y.a)(e,[{key:"getNotifications",value:function(){var e=Object(te.a)(ee.a.mark(function e(){var t;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications();case 2:return t=e.sent,e.abrupt("return",t.user.feed.map(function(e){var t=e.id,r=e.actor,n=e.verb,a=e.object,i=e.target,s=e.source,o=e.level,c=e.seen,u=e.created,l=e.expires,E=e.external_key,d=e.context;return{id:t,actor:r,verb:n,object:a,target:i,source:s,level:ca(o),seen:c,createdAt:new Date(u),expiresAt:new Date(l),externalKey:E,context:d}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();var la=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Fetching your orgs and other stuff...")}},{key:"renderError",value:function(){if(this.props.view.error)return A.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:return this.props.onLoad(),this.renderLoading();case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return A.createElement(sa,null)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Ea=Object(j.b)(function(e,t){return{view:e.views.dashboardView}},function(e){return{onLoad:function(){e(function(){var e=Object(te.a)(ee.a.mark(function e(t,r){var n,i,s,o,c,u,l,E,d,m,v,p,h;return ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:q.DASHBOARD_LOAD_START}),(n=r()).views.dashboardView,n.entities,i=n.auth.authorization,s=i.token,o=i.username,c=n.app.config,u=new Bt({token:s,username:o,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}),l=new de({token:s,username:o,groupsServiceURL:c.services.Groups.url}),e.prev=4,e.next=7,u.getOrganizationsForUser();case 7:return E=e.sent,new Map,e.next=11,l.getUserRequests();case 11:return d=e.sent,e.next=14,l.getUserInvitations();case 14:return m=e.sent,v=E.filter(function(e){var t=e.organization;return t.owner.username===o||!!t.members.find(function(e){return e.username===o&&e.type===a.ADMIN})}).map(function(e){return e.organization.id}),e.next=18,l.getPendingOrganizationRequests(v);case 18:return p=e.sent,h=new ua({token:s,feedsServiceURL:c.services.Feeds.url}),e.next=22,h.getNotifications();case 22:e.sent,t((R=E,w=d,g=m,f=p,{type:q.DASHBOARD_LOAD_SUCCESS,organizations:R,requests:w,invitations:g,pendingGroupRequests:f})),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(4),t((O={code:"error",message:e.t0.message},{type:q.DASHBOARD_LOAD_ERROR,error:O}));case 29:case"end":return e.stop()}var O,R,w,g,f},e,this,[[4,26]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:q.DASHBOARD_UNLOAD})}}})(la),da=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map}},db:{notifications:{byId:new Map,collections:{byGroup:new Map}}},views:{browseOrgsView:{loadingState:R.NONE,error:null,viewModel:null},organizationCentricView:{loadingState:R.NONE,error:null,viewModel:null},addOrgView:{loadingState:R.NONE,error:null,viewModel:null},editOrgView:{loadingState:R.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:R.NONE,error:null,viewModel:null},viewMembersView:{loadingState:R.NONE,error:null,viewModel:null},inviteUserView:{loadingState:R.NONE,error:null,viewModel:null},manageMembershipView:{loadingState:R.NONE,error:null,viewModel:null},requestNarrativeView:{loadingState:R.NONE,error:null,viewModel:null},dashboardView:{loadingState:R.NONE,error:null,viewModel:null},viewOrgView:{loadingState:R.NONE,error:null,viewModel:null}},auth:{status:c.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:h.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Feeds:{url:""}}}},updateOrg:{pending:!1}}}}]),e}();Ce.a.add(ke.c,ke.b,ke.a,ke.d);var ma=!!window.frameElement,va=da.makeInitialState(),pa=Object(z.d)(De,va,Object(z.c)(Object(z.a)(G.a))),ha=function(e){function t(e){return Object(b.a)(this,t),Object(D.a)(this,Object(C.a)(t).call(this,e))}return Object(k.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return N.a.createElement(j.a,{store:pa},N.a.createElement(an,{hosted:ma},N.a.createElement(hn,null,N.a.createElement(V.a,{basename:"/orgs/"},N.a.createElement("div",{className:"App scrollable-flex-column"},N.a.createElement("div",{className:"App-body scrollable-flex-column"},N.a.createElement(M.a,null,N.a.createElement(U.a,{path:"/",exact:!0,component:Ea}),N.a.createElement(U.a,{path:"/organizations",component:Rt}),N.a.createElement(U.a,{path:"/newOrganization",component:Wt}),N.a.createElement(U.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Ur,{organizationId:t})}}),N.a.createElement(U.a,{path:"/editOrganization/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Fr,{organizationId:t})}}),N.a.createElement(U.a,{path:"/manageOrganizationRequests/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Sn,{organizationId:t})}}),N.a.createElement(U.a,{path:"/viewMembers/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Cn,{organizationId:t})}}),N.a.createElement(U.a,{path:"/inviteUser/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(xn,{organizationId:t})}}),N.a.createElement(U.a,{path:"/membership/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Qn,{organizationId:t})}}),N.a.createElement(U.a,{path:"/requestAddNarrative/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Kn,{organizationId:t})}}))))))))}}]),t}(A.Component);r(293),r(295),r(297);T.a.render(N.a.createElement(ha,null),document.getElementById("root"))}},[[143,2,1]]]);
//# sourceMappingURL=main.7a7cd670.chunk.js.map