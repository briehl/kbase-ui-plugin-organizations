{"version":3,"sources":["components/browseOrgs/Organizations.tsx","components/browseOrgs/OrganizationsContainer.tsx","types/index.tsx","redux/actions/index.tsx","redux/reducers/addOrg.ts","redux/reducers/editOrg.ts","redux/reducers/viewOrg.ts","redux/reducers/searchOrgs.ts","redux/reducers/auth.ts","redux/reducers/app.ts","redux/reducers/manageOrganizationRequests.ts","redux/reducers/viewMembers.ts","redux/reducers/inviteUser.ts","redux/reducers/manageMembership.ts","redux/reducers/requestAddNarrative.ts","redux/reducers/index.tsx","data/groups.ts","components/Header.tsx","components/browseOrgs/OrganizationsBrowser.tsx","data/userProfile.ts","data/serviceWizard.ts","data/serviceClient.ts","data/genericClient.ts","data/dynamicServiceClient.ts","data/narrativeService.ts","data/workspaceUtils.ts","data/model.ts","redux/actions/viewOrg.ts","redux/actions/searchOrgs.ts","components/browseOrgs/OrganizationsBrowserContainer.tsx","redux/actions/addOrg.ts","components/newOrganization/NewOrganization.tsx","components/newOrganization/container.tsx","components/organizationHeader/component.tsx","components/Avatar.tsx","components/Member.tsx","components/organizationHeader/container.tsx","components/viewOrganization/ViewOrganization.tsx","components/viewOrganization/ViewOrganizationContainer.tsx","redux/actions/editOrg.ts","components/editOrganization/component.tsx","components/editOrganization/container.tsx","components/Auth.tsx","data/auth.ts","redux/actions/auth.ts","containers/Auth.tsx","lib/windowChannel.ts","lib/IFrameSimulator.ts","lib/IFrameIntegration.ts","redux/actions/app.ts","components/KBaseIntegration.tsx","containers/KBaseIntegration.tsx","redux/actions/manageOrganizationRequests.ts","components/User.tsx","components/manageOrganizationRequests/component.tsx","components/manageOrganizationRequests/container.tsx","components/manageOrganizationRequests/loader.tsx","redux/actions/viewMembers.ts","components/viewMembers/MemberRow.tsx","components/request/component.tsx","components/viewMembers/component.tsx","components/viewMembers/container.ts","components/viewMembers/loader.tsx","redux/actions/inviteUser.ts","components/inviteUser/InviteUser.tsx","components/inviteUser/InviteUserContainer.tsx","components/inviteUser/InviteUserLoader.tsx","components/manageMembership/component.tsx","redux/actions/manageMembership.ts","components/manageMembership/loader.tsx","components/requestAddNarrative/component.tsx","redux/actions/requestAddNarrative.ts","components/requestAddNarrative/container.tsx","components/requestAddNarrative/loader.tsx","redux/state.tsx","App.tsx","index.tsx"],"names":["Organizations","_React$Component","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","searchTerms","inherits","createClass","key","value","org","gravatarHash","react","style","width","height","src","getAvatarUrl","relation","type","types","NONE","icon","VIEW","es_tooltip","placement","mouseEnterDelay","title","MEMBER_REQUEST_PENDING","color","MEMBER_INVITATION_PENDING","MEMBER","ADMIN","OWNER","requestsPending","adminRequests","length","theme","twoToneColor","className","count","singular","plural","members","pluralize","renderMemberCount","index","String","NavLink","to","concat","id","renderAvatar","name","href","owner","user","username","target","realname","Intl","DateTimeFormat","month","day","year","format","createdAt","renderRelation","renderRelationInfo","renderAdminInfo","_this2","organizations","map","renderOrg","es_alert","maxWidth","margin","message","overflowY","display","flexDirection","renderOrgs","React","connect","UIErrorType","MemberType","UserRelationToOrganization","RequestType","RequestResourceType","RequestStatus","AuthState","EditOrgState","SyncState","EditState","SaveState","ValidationState","FieldState","ViewOrgState","AppState","SortDirection","ComponentLoadingState","ViewMembersViewState","BrowseOrgsState","InviteUserViewState","UserWorkspacePermission","RequestNarrativeState","ActionFlag","browseOrgs","view","Error","reducer","action","ADD_ORG_START","objectSpread","addOrg","saveState","SAVING","addOrgStart","ADD_ORG_SUCCESS","editState","UNEDITED","SAVED","addOrgSuccess","ADD_ORG_ERROR","SAVE_ERROR","error","addOrgError","ADD_ORG_EDIT_START","validationState","NEW","newOrganization","status","description","addOrgEditStart","ADD_ORG_EDIT_FINISH","addOrgEditFinish","ADD_ORG_UPDATE_NAME_SUCCESS","EDITED","EDITED_OK","addOrgUpdateNameSuccess","ADD_ORG_UPDATE_NAME_ERROR","EDITED_ERROR","addOrgUpdateNameError","ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS","addOrgUpdateGravatarHashSuccess","ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR","addOrgUpdateGravatarHashError","ADD_ORG_UPDATE_ID_SUCCESS","addOrgUpdateIdSuccess","ADD_ORG_UPDATE_ID_ERROR","addOrgUpdateIdError","ADD_ORG_UPDATE_DESCRIPTION_SUCCESS","addOrgUpdateDescriptionSuccess","ADD_ORG_UPDATE_DESCRIPTION_ERROR","addOrgUpdateDescriptionError","ADD_ORG_EVALUATE_OK","VALID","addOrgEvaluateOk","ADD_ORG_EVALUATE_ERRORS","INVALID","addOrgEvaluateErrors","EDIT_ORG_EDIT_START","editOrg","organizationId","editedOrganization","editOrgEditStart","EDIT_ORG_EDIT_SUCCESS","organization","editOrgEditSuccess","EDIT_ORG_SAVE_START","editOrgSaveStart","EDIT_ORG_SAVE_SUCCESS","editOrgSaveSuccess","EDIT_ORG_SAVE_ERROR","editOrgSaveError","EDIT_ORG_UPDATE_NAME_SUCCESS","editOrgUpdateNameSuccess","EDIT_ORG_UPDATE_NAME_ERROR","editOrgUpdateNameError","EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS","editOrgUpdateGravatarHashSuccess","EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR","editOrgUpdateGravatarHashError","EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS","editOrgUpdateDescriptionSuccess","EDIT_ORG_UPDATE_DESCRIPTION_ERROR","editOrgUpdateDescriptionError","EDIT_ORG_EVALUATE_OK","editOrgEvaluateOk","EDIT_ORG_EVALUATE_ERRORS","editOrgEvaluateErrors","VIEW_ORG_FETCH_START","viewOrg","FETCHING","viewOrgStart","VIEW_ORG_FETCH_SUCCESS","READY","viewOrgSuccess","VIEW_ORG_FETCH_ERROR","ERROR","viewOrgError","VIEW_ORG_STOP","viewOrgStop","VIEW_ORG_REMOVE_NARRATIVE_SUCCESS","newNarratives","narratives","filter","narrative","workspaceId","removeNarrativeSuccess","SEARCH_ORGS_START","console","warn","_state$browseOrgs$vie","sortBy","sortDirection","auth","authorization","SEARCHING","selectedOrganizationId","searchOrgsStart","SEARCH_ORGS_SUCCESS","SUCCESS","totalCount","filteredCount","searchOrgsSuccess","SEARCH_ORGS_ERROR","searching","searchOrgsError","SORT_ORGS_START","_state$browseOrgs$vie2","sortOrgsStart","FILTER_ORGS_START","filterOrgsStart","AUTH_CHECK_START","CHECKING","token","roles","authCheckStart","AUTH_AUTHORIZED","AUTHORIZED","authAuthorized","AUTH_UNAUTHORIZED","UNAUTHORIZED","authUnauthorized","AUTH_CHECK_ERROR","authCheckError","APP_SUCCESS","app","config","appSuccess","ADMIN_MANAGE_REQUESTS_LOAD_START","loadStart","ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS","manageOrganizationRequestsView","viewState","requests","loadSuccess","ADMIN_MANAGE_REQUESTS_LOAD_ERROR","loadError","ADMIN_MANAGE_REQUESTS_UNLOAD","unload","VIEW_MEMBERS_LOAD_START","viewMembersView","LOADING","viewMembersLoadStart","VIEW_MEMBERS_LOAD_SUCCESS","viewMembersLoadSuccess","VIEW_MEMBERS_LOAD_ERROR","viewMembersLoadError","VIEW_MEMBERS_UNLOAD","viewMembersUnload","VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS","member","memberUsername","newState","viewMembersPromoteToAdminSuccess","VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS","viewMembersDemoteToMemberSuccess","INVITE_USER_LOAD_START","inviteUserView","loadingState","INVITE_USER_LOAD_READY","EDITING","users","selectedUser","loadReady","INVITE_USER_LOAD_ERROR","INVITE_USER_UNLOAD","INVITE_USER_SEARCH_USERS_SUCCESS","searchUsersSuccess","INVITE_USER_SELECT_USER_SUCCESS","selectUserSuccess","INVITE_USER_SEND_INVITATION_START","SENDING","sendInvitationStart","INVITE_USER_SEND_INVITATION_SUCCESS","_state$inviteUserView","newUsers","sendInvitationSuccess","INVITE_USER_SEND_INVITATION_ERROR","sendInvitationError","MANAGE_MEMBERSHIP_LOAD_START","manageMembershipView","loading","manageMembershipLoadStart","MANAGE_MEMBERSHIP_LOAD_SUCCESS","manageMembershipLoadSuccess","MANAGE_MEMBERSHIP_LOAD_ERROR","manageMembershipLoadError","sendRequestStart","requestNarrativeView","REQUEST_ADD_NARRATIVE_LOAD_START","REQUEST_ADD_NARRATIVE_LOAD_SUCCESS","LOADED","selectedNarrative","REQUEST_ADD_NARRATIVE_LOAD_ERROR","REQUEST_ADD_NARRATIVE_SEND_START","REQUEST_ADD_NARRATIVE_SEND_SUCCESS","SENT","inOrganization","sendRequestSuccess","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS","selectNarrativeSuccess","REQUEST_ADD_NARRATIVE_UNLOAD","addOrgReducer","editOrgReducer","searchOrgsReducer","viewOrgReducer","authReducer","appReducer","manageOrganizatiopRequests","viewMembers","inviteUser","manageMembership","requestAddNarrative","Header","children","fa","verticalAlign","marginLeft","marginRight","flex","data-test","alignItems","buildSeparator","OrganizationsBrowser","searchInput","searchButton","showInfo","onSearchOrgs","Modal","info","content","current","split","currentSearchInputValue","setState","e","preventDefault","doSearch","onSortOrgs","onFilterOrgs","onSearchInputChange","onSubmit","bind","placeholder","onChange","autoFocus","ref","es_button","disabled","haveSearchInput","form","htmlType","renderSearchIcon","onClick","onClearSearch","src_components_Header","fontWeight","fontStyle","renderSearchFeedback","justifyContent","shape","onShowInfo","es_select","onSortByChange2","defaultValue","dropdownMatchSelectWidth","Option","onSortDirectionChange2","ASCENDING","DESCENDING","onFilterChange2","code","OrganizationsContainer","renderHeader","renderSearchBar","renderSearchFilter","renderOrganizations","UserProfileClient","_ref","url","method","param","version","Math","random","slice","params","fetch","mode","cache","headers","Authorization","Content-Type","Accept","body","JSON","stringify","makeEmptyPayload","then","response","statusText","json","profileCache","has","Promise","resolve","get","makePayload","result","usernames","cached","profilesToFetch","forEach","push","profiles","profile","set","query","Map","GroupsClient","exists","Date","getTime","orgs","_ref2","all","group","getGroupById","newGroup","custom","gravatarhash","groupUpdate","groupId","URLSearchParams","includeClosed","append","startAt","toString","join","complete","resourceType","resourceId","_ref3","requestId","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","ServiceWizardClient","_AuthorizedServiceCli","callFunc","theResult","_ServiceClient","AuthorizedServiceClient","func","ServiceClient","constructor","module","AuthorizedGenericClient","_GenericClient","GenericClient","moduleCache","Cache","itemLifetime","monitoringFrequency","waiterTimeout","waiterFrequency","cacheLifetime","isMonitoring","window","setTimeout","newCache","cacheRenewed","keys","item","isExpired","runMonitor","cacheItem","reserved","undefined","delete","Bluebird","reject","started","waiter","reserveAndFetch","fetcher","catch","err","elapsed","_this3","reserveItem","fetchPromise","setItem","finally","isCancelled","isReserved","reserveWaiter","NarrativeServiceClient","_DynamicServiceClient","DynamicServiceClient","timeout","rpcContext","moduleId","getModule","getItemWithWait","_this4","getCached","client","getServiceStatus","module_name","funcName","_this5","lookupModule","serviceStatus","iso8601ToDate","dateString","dateParts","exec","TypeError","offset","newDateString","groupPermissionToWorkspacePermission","groupsPermission","READ","WRITE","OWN","Model","cachedOrgs","groupsClient","groupsServiceURL","getCreatedRequests","groups","getTargetedRequests","slicedToArray","invitations","request","userProfileClient","userProfile","userProfileServiceURL","requester","resourcetype","resource","getUserProfiles","requestType","INVITATION","REQUEST","stringToRequestType","USER","WORKSPACE","APP","stringToResourceType","requestStatus","OPEN","groupid","profileToUser","createdate","expireAt","expiredate","modifiedAt","moddate","workspace","getGroupRequests","groupRequests","groupAdminRequests","groupRequestToOrgRequest","memberUsernames","adminUsernames","userProfileMap","p","admin","sort","a","b","localeCompare","admins","allUsers","indexOf","getPendingAdminRequests","getPendingRequests","pendingAdminRequests","_ref6$","pendingRequests","req","pendingInvites","userProfiles","reduce","ownerProfile","getGroupMembers","fun","resources","narrname","parseInt","rid","permission","perm","isPublic","public","apps","catalogmethod","getPendingOrganizationRequests","ex","groupIds","_this6","allRequests","_this7","adminGroupIds","Array","from","_ref10","_ref11","_ref11$","profileMap","orgMembers","membersAndAdminsToMembers","_this8","getGroups","groupsToOrgs","getOrgs","direction","applySort","searchTermsRe","term","RegExp","every","termRe","test","applyOrgSearch","findIndex","applyFilter","total","jobTitle","userdata","jobTitleOther","city","country","avatarOption","synced","gravatarDefault","_this9","groupToOrg","groupExists","_ref12","newOrg","_this10","createGroup","orgUpdate","updateGroup","_this11","requestMembership","_this12","addOrRequestNarrative","deleteResource","_this13","cancelRequest","_this14","acceptRequest","_this15","denyRequest","_this16","_this17","memberToAdmin","adminToMember","removeMember","_this18","requestJoinGroup","Validation","validateOrgId","validateOrgName","validateOrgDescription","searchUsers","_ref13","excludedUsers","_ref14","_this19","getUserProfile","narrativeServiceClient","serviceWizardURL","listNarratives","getOrg","_ref15","_ref16","narrativesResult","workspacesInOrg","nar","workspaceInfo","wsInfo","ws","objectCount","userPermission","globalReadPermission","lockStatus","metadata","objectInfo","data","majorVersion","minorVersion","savedAt","savedBy","workspaceName","checksum","size","objectInfoToObject","is_temporary","objectId","narrative_nice_name","match","StaticData","removeNarrativeError","VIEW_ORG_REMOVE_NARRATIVE_ERROR","removeNarrative","dispatch","getState","VIEW_ORG_REMOVE_NARRATIVE_START","_state$auth$authoriza","services","Groups","UserProfile","workspaceServiceURL","Workspace","ServiceWizard","removeNarrativeFromGroup","viewOrgJoinRequestError","VIEW_ORG_JOIN_REQUEST_ERROR","viewOrgCancelJoinRequestError","VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR","acceptJoinInvitationStart","VIEW_ORG_ACCEPT_JOIN_INVITATION_START","acceptJoinInvitationError","VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR","viewOrgFetch","_getState","_getState$auth$author","viewOrgJoinRequest","_getState2","_getState2$auth$autho","model","requestMembershipToGroup","VIEW_ORG_JOIN_REQUEST_SUCCESS","viewOrgCancelJoinRequest","VIEW_ORG_JOIN_REQUEST_START","_getState3","_getState3$auth$autho","newRequest","VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS","acceptJoinInvitation","_getState4","_getState4$auth$autho","VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS","rejectJoinInvitation","_getState5","_getState5$auth$autho","VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS","VIEW_ORG_REJECT_JOIN_INVITATION_ERROR","searchOrgs","_browseOrgs$view","queryOrgs","sortOrgs","_browseOrgs$view2","filterOrgs","_browseOrgs$view3","storeState","_storeState$browseOrg","_storeState$browseOrg2","actions","AddOrgEvaluateErrors","addOrgEdit","addOrgEvaluate","addOrgUpdateName","_Validation$validateO","_Validation$validateO2","validatedName","addOrgUpdateGravatarHash","_Validation$validateO3","validateOrgGravatarHash","_Validation$validateO4","validateGravatarHash","addOrgUpdateId","_Validation$validateO5","_Validation$validateO6","validatedId","newModelFromState","addOrgUpdateDescription","_model$validateOrgDes","_model$validateOrgDes2","validatedDescription","NewOrganization","cancelToBrowser","gravatarEmail","origin","document","location","onAddOrgEdit","email","hashed","md5","onUpdateGravatarHash","isModified","confirm","onOk","onCancel","okText","cancelText","onAddOrg","persist","onUpdateName","onUpdateDescription","onUpdateId","onNameChange","marginBottom","onGravatarEmailSync","onGravatarHashChange","onIdChange","minHeight","maxHeight","onDescriptionChange","getOrgAvatarUrl","renderOrgAvatar","dangerouslySetInnerHTML","__html","marked","_this$props","label","orgName","canSave","onClickCancelToBrowser","Redirect","renderForm","renderPreview","renderLoadingHeader","NavigateTo","_ref$addOrg","Avatar","avatarUrl","Member","src_components_Avatar","avatarSize","renderRole","x","OrganizationHeader","navigateTo","onJoinOrg","success","onCancelJoinRequest","onAcceptInvitation","onRejectInvitation","MANAGE_MEMBERSHIP","VIEW_MEMBERS","MANAGE_REQUESTS","EDIT_ORGANIZATION","INVITE_USER","VIEW_ORGANIZATION","onNavigateToViewOrganization","textAlign","onJoinClick","spin","menu","es_menu","Item","onNavigateToMembership","dropdown","overlay","trigger","fontSize","adminMenu","onNavigateToViewMembers","onNavigateToManageRequests","onNavigateToEditOrganization","onNavigateToInviteUser","ownerMenu","renderOrgInfo","getRelationClass","ViewOrganization","onViewOrg","REQUEST_ADD_NARRATIVE","onRemoveNarrative","alert","renderEditRow","organizationHeader_container","marginTop","isMember","src_components_Member","card","renderAdminRequestsRow","renderAdminRequests","renderEditButton","renderJoinButton","memberCount","extras","onViewMembers","extra","renderMembers","shareButton","tooltip","onRequestShare","cursor","react_fontawesome_index_es","renderPublicPermission","renderNarrativePermission","onRequestAddNarrative","narrativesTable","renderNarrative","renderNarrativeMenu","narrativeCount","renderOrgHeader","renderNarratives","renderAdminTasks","renderInfo","renderMemberCard","_ref$viewOrg","EditOrgEvaluateErrors","editOrgEdit","editableOrg","UNEDITED_OK","EDIT_ORG_EDIT_ERROR","editOrgSave","_getState2$editOrg","update","updateOrg","editOrgEvaluate","editOrgUpdateName","editOrgUpdateGravatarHash","editOrgUpdateDescription","EditOrganization","cancelToViewer","onEditOrgEdit","onEditOrgSave","onClickCancelToViewer","log","_ref$editOrg","Auth","tokenRef","checkAuth","onRemoveAuthorization","onAddAuthorization","onLoginClick","onLogoutClick","buildAuthToolbar","buildAuthForm","hosted","buildAuthProd","buildAuthDev","endpoints","AuthClient","path","makePath","Cookies","getTokenInfo","getMe","account","desc","Listener","onSuccess","onError","WaitingListener","Message","payload","channel","uuidv4","created","envelope","Channel","host","channelId","awaitingResponse","waitingListeners","listeners","lastId","sentCount","receivedCount","unwelcomeReceivedCount","unwelcomeReceivedCountThreshhold","unwelcomeReceiptWarning","unwelcomeReceiptWarningCount","currentListener","messageEvent","handler","awaiting","listener","messageId","listen","postMessage","getMessage","sendMessage","sendRequest","now","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_loop","_iterator","entries","Symbol","iterator","next","done","return","startMonitor","listenOnce","sent","received","receiveMessage","addEventListener","removeEventListener","IFrameSimulator","frameId","uuid","parentHost","IFrameIntegration","frameElement","hasAttribute","getAttribute","parse","decodeURIComponent","KBaseIntegration","onAppStart","iframeParams","getParamsFromIFrame","baseUrl","fakeIframeParams","load","acceptJoinRequest","ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS","acceptJoinRequestSuccess","ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR","denyJoinRequest","ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS","denyJoinRequestSuccess","ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR","cancelJoinInvitation","ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS","cancelJoinInvitationSuccess","ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR","User","ManageGroupRequests","onAcceptJoinRequest","onDenyJoinRequest","onCancelJoinInvitation","open","someDate","measure","measureAbs","unit","nowDate","round","elapsedAbs","abs","prefix","suffix","getFullYear","hoverable","headStyle","backgroundColor","src_components_User","niceElapsed","renderRequestJoinRequest","renderRequestNarrativeRequest","renderRequestAppRequest","renderRequestJoinInvitation","padding","renderRequest","es_Redirect","renderRequests","renderInvitations","Component","Loader","onLoad","renderLoading","manageOrganizationRequests_container","onUnload","viewMembersLoad","viewMembersPromoteToAdmin","VIEW_MEMBERS_PROMOTE_TO_ADMIN_START","VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR","viewMembersDemoteToMember","VIEW_MEMBERS_DEMOTE_TO_MEMBER_START","VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR","viewMembersRemoveMember","VIEW_MEMBERS_REMOVE_MEMBER_START","VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS","VIEW_MEMBERS_REMOVE_MEMBER_ERROR","MemberRow","over","onPromoteMemberToAdmin","onDemoteAdminToMember","onRemoveMember","renderPromoteButton","renderOwnerMenu","renderAdminMenu","renderMemberMenu","onMouseEnter","onMouseOver","onMouseLeave","onMouseOut","renderMemberOptions","Request","ViewMembers","adminUsername","viewMembers_MemberRow","isAdmin","showIcon","component_Request","adminList","renderAdminButtons","onViewMembersUnload","renderOrganizationHeader","renderMembersToolbar","renderAdminsToolbar","renderPendingMembers","ViewMembersLoader","onViewMembersLoad","viewMembers_container","inviteUserLoad","inviteUserSearchUsers","INVITE_USER_SEARCH_USERS_START","adminUsers","invited","requested","orgUsers","INVITE_USER_SEARCH_USERS_ERROR","selectUserError","INVITE_USER_SELECT_USER_ERROR","isUserRequest","isUserInvitation","selectUser","selectedUsername","INVITE_USER_SELECT_USER_START","getUser","find","getUserRelation","sendInvitation","_getState4$inviteUser","groupRequest","InviteUser","lastSearchAt","cancelToViewMembers","autocompleteMessage","onSendInvitation","doSearchUsers","searchDebounce","onSearchUsers","onSelectUser","onClickCancelToViewMembers","button","SENDABLE","renderSearchButton","renderUsers","renderSelectedUser","renderInvitationForm","renderFooter","InviteUserLoader","onInviteUserLoad","renderError","InviteUserContainer","ManageMembership","doCancelToViewer","doCancelToBrowser","doShowInfo","manageMembershipLoad","ManageMembershipLoader","manageMembership_component","RequestAddNarrative","BROWSER","VIEWER","doSelectNarrative","doSendRequest","buttonLabel","canSendRequest","renderSelectNarrative","renderSelectedNarrative","renderSelectedNarrativeButton","getOwnNarratives","selectNarrative","REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START","addOrRequestNarrativeToGroup","REQUEST_ADD_NARRATIVE_SEND_ERROR","requestAddNarrative_container","StateInstances","rawOrganizations","makeEmptyEditableOrganization","pending","library","add","faSpinner","faSearch","faGlobe","faUserLock","initialState","makeInitialState","store","createStore","theReducer","compose","applyMiddleware","thunk","App","react_default","createElement","es","containers_Auth","containers_KBaseIntegration","HashRouter","basename","Switch","Route","component","ViewOrganizationContainer","editOrganization_container","loader","viewMembers_loader","inviteUser_InviteUserLoader","manageMembership_loader","requestAddNarrative_loader","exact","ReactDOM","render","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.47180447.chunk.js","sourcesContent":["import * as React from 'react';\nimport './Organizations.css';\nimport * as types from '../../types';\nimport { NavLink } from 'react-router-dom';\nimport { Alert, Icon, Tooltip } from 'antd';\nimport { Organization } from '../../types';\n\n// TODO: need more ergonomic way to resolve the common issue of data types interfering with \n// component types.\n\nexport interface OrganizationsProps {\n    organizations: Array<Organization>\n}\n\nexport interface OrganizationsState {\n    searchTerms: Array<string>\n}\n\nexport class Organizations extends React.Component<OrganizationsProps, OrganizationsState> {\n\n    constructor(props: OrganizationsProps) {\n        super(props)\n\n        this.state = {\n            searchTerms: []\n        }\n    }\n\n    getAvatarUrl(org: Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderAvatar(org: Organization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getAvatarUrl(org)} />\n        )\n    }\n\n    renderRelation(org: Organization) {\n        switch (org.relation.type) {\n            case (types.UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (types.UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org, but you may access it; you may request membership\"\n                    >\n                        <span><Icon type=\"stop\" /> You are not a member - view group to join</span>\n                    </Tooltip>\n                )\n            case (types.UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> Your membership <b>request</b> is pending</span>)\n            case (types.UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> You have been <b>invited</b> to join</span>)\n            case (types.UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" /> You are a <b>member</b> of this organization</span>)\n            case (types.UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />Admin</span>)\n            case (types.UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You own this org\"\n                    >\n                        <span><Icon type=\"crown\" /> You are the <b>owner</b> of this Organization</span>\n                    </Tooltip>\n                )\n        }\n    }\n\n    renderAdminInfo(org: Organization) {\n        if (!(org.relation.type === types.UserRelationToOrganization.OWNER ||\n            org.relation.type === types.UserRelationToOrganization.ADMIN)) {\n            return\n        }\n        let requestsPending\n        if (org.adminRequests.length > 0) {\n            requestsPending = (\n                <div>\n                    <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" />  group has <b>{org.adminRequests.length} pending request{org.adminRequests.length > 1 ? 's' : ''}</b>\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"admin\">\n                {requestsPending}\n            </div>\n        )\n    }\n\n    pluralize(count: number, singular: string, plural: string) {\n        if (count === 0 || count > 1) {\n            return plural\n        }\n        return singular\n    }\n\n    renderMemberCount(org: Organization) {\n        return (\n            <div className=\"memberCount\">\n                {org.members.length > 0 ? org.members.length : 'no'} {this.pluralize(org.members.length, 'member', 'members')}\n            </div>\n        )\n    }\n\n    renderRelationInfo(org: Organization) {\n        switch (org.relation.type) {\n            case types.UserRelationToOrganization.NONE:\n                return (\n                    <div>\n                        Only members may view membership information\n                    </div>\n                )\n                break\n            case types.UserRelationToOrganization.VIEW:\n                return (\n                    <div>Only members may view membership information</div>\n                )\n                break\n            case types.UserRelationToOrganization.MEMBER:\n                return (\n                    <div>\n                        {this.renderMemberCount(org)}\n                    </div>\n                )\n                break\n            case types.UserRelationToOrganization.MEMBER_REQUEST_PENDING:\n                return (\n                    <div>Only members may view membership information</div>\n                )\n                break\n            case types.UserRelationToOrganization.MEMBER_INVITATION_PENDING:\n                return (\n                    <div>\n                        Only members may view membership information\n                    </div>\n                )\n                break\n            case types.UserRelationToOrganization.ADMIN:\n                return (\n                    <div>\n                        {this.renderMemberCount(org)}\n                    </div>\n                )\n                break\n            case types.UserRelationToOrganization.OWNER:\n                return (\n                    <div>\n                        {this.renderMemberCount(org)}\n                    </div>\n                )\n                break\n        }\n    }\n\n    renderOrg(org: Organization, index: Number) {\n        return (\n            <div className=\"row organization\" key={String(index)}>\n                <div className=\"col2\">\n                    <NavLink to={`/viewOrganization/${org.id}`}>\n                        {this.renderAvatar(org)}\n                    </NavLink>\n                </div>\n                <div className=\"col1\">\n                    <div className=\"orgName\">\n                        <NavLink to={`/viewOrganization/${org.id}`}>\n                            {org.name}\n                        </NavLink>\n                    </div>\n                    <div className=\"orgOwner\">\n                        <span className=\"field-label\">owner</span>\n                        <span className=\"field-value\"><a href={\"/#people/\" + org.owner.user.username} target=\"_blank\">{org.owner.user.realname} ❨{org.owner.user.username}❩</a></span>\n\n                    </div>\n                    <div className=\"orgCreated\">\n                        <span className=\"field-label\">established</span>\n                        <span className=\"field-value\">{Intl.DateTimeFormat('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(org.createdAt)}</span>\n                    </div>\n\n                    <div className=\"relation\">\n                        {/* <span className=\"field-label\">you</span> */}\n                        {this.renderRelation(org)}\n                    </div>\n                    {this.renderRelationInfo(org)}\n\n                    {this.renderAdminInfo(org)}\n                </div>\n            </div>\n        )\n    }\n\n    renderOrgs() {\n        if (this.props.organizations.length > 0) {\n            return (\n                this.props.organizations.map((org: Organization, index) => {\n                    return (\n                        this.renderOrg(org, index)\n                    )\n                })\n            )\n        } else {\n            return (\n                <Alert type=\"warning\"\n                    style={{ maxWidth: '20em', margin: '20px auto 0 auto' }}\n                    message=\"Sorry, no organizations were found.\" />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Organizations\">\n                <div style={{ overflowY: 'auto', display: 'flex', flexDirection: 'column' }}>\n                    {this.renderOrgs()}\n                </div>\n            </div >\n        )\n    }\n}\n\nexport default Organizations;","import { Organizations, OrganizationsProps } from './Organizations';\nimport { StoreState } from '../../types';\nimport { connect } from 'react-redux';\n\nexport function mapStateToProps(state: StoreState): OrganizationsProps {\n    // TODO: wow, should not do this here\n    if (state.browseOrgs.view === null) {\n        throw new Error('view not ready')\n    }\n    const { browseOrgs: {\n        view: { organizations } } } = state;\n    return {\n        organizations\n    }\n}\n\nexport default connect(mapStateToProps)(Organizations);","import { ViewOrganizationState } from \"../components/viewOrganization/ViewOrganization\";\nimport { types, error } from \"util\";\nimport Organizations from \"../components/browseOrgs/OrganizationsContainer\";\n\n/* Types from the organization service (approximately) */\n\n/*\n    Organization\n*/\n\nexport interface OrganizationUpdate {\n    name: string\n    gravatarHash: string | null\n    description: string\n}\n\nexport enum UIErrorType {\n    NONE = 0,\n    INFO,\n    WARNING,\n    ERROR\n}\n\nexport interface UIError {\n    type: UIErrorType,\n    message?: string\n}\n\nexport interface EditableOrganization {\n    id: {\n        value: string,\n        status: FieldState,\n        error: UIError\n    }\n    name: {\n        value: string,\n        status: FieldState,\n        error: UIError\n    }\n    gravatarHash: {\n        value: string | null\n        status: FieldState\n        error: UIError\n    }\n    description: {\n        value: string,\n        status: FieldState,\n        error: UIError\n    }\n}\n\nexport interface User {\n    username: string\n    realname: string\n    title: string | null\n    organization: string | null\n    city: string | null\n    state: string | null\n    country: string | null\n    avatarOption: string | null\n    gravatarHash: string | null\n    gravatarDefault: string | null\n}\n\nexport enum MemberType {\n    MEMBER = 0,\n    ADMIN,\n    OWNER\n}\nexport interface Member {\n    user: User,\n    type: MemberType\n}\n\n\n\n// export interface User extends UserBase {\n\n// }\n\n// export interface Owner extends UserBase {\n\n// }\n\n// export interface Member extends UserBase {\n\n// }\n\n// export interface Admin extends UserBase {\n\n// }\n\nexport enum UserRelationToOrganization {\n    NONE = 0,\n    VIEW,\n    MEMBER_REQUEST_PENDING,\n    MEMBER_INVITATION_PENDING,\n    MEMBER,\n    ADMIN,\n    OWNER\n}\n\nexport interface UserOrgRelation {\n    type: UserRelationToOrganization\n}\n\nexport interface NoRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.NONE\n}\n\nexport interface ViewRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.VIEW\n}\n\nexport interface MembershipRequestPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n    requestId: string\n}\n\nexport interface MembershipInvitationPendingRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n    requestId: string\n}\n\nexport interface MemberRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.MEMBER\n}\n\nexport interface AdminRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.ADMIN\n}\n\nexport interface OwnerRelation extends UserOrgRelation {\n    type: UserRelationToOrganization.OWNER\n}\n\nexport interface BriefOrganization {\n    id: string\n    name: string\n    gravatarHash: string | null\n    owner: {\n        username: string\n        realname: string\n    },\n    relation: UserRelationToOrganization,\n    createdAt: Date\n    modifiedAt: Date\n}\n\nexport enum RequestType {\n    REQUEST = 0,\n    INVITATION\n}\n\nexport enum RequestResourceType {\n    USER = 0,\n    WORKSPACE,\n    APP\n}\n\nexport enum RequestStatus {\n    OPEN = 0,\n    CANCELED,\n    EXPIRED,\n    ACCEPTED,\n    DENIED\n}\n\nexport type Username = string\n\nexport interface GroupRequest {\n    id: string\n    groupId: string\n    requester: User\n    type: RequestType\n    status: RequestStatus\n    resourceType: RequestResourceType\n    // subjectUser: User | null,\n    // subjectWorkspaceId: number | null,\n    createdAt: Date\n    expireAt: Date\n    modifiedAt: Date\n}\n\nexport interface UserRequest extends GroupRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.REQUEST\n    user: User\n}\n\nexport interface UserInvitation extends GroupRequest {\n    resourceType: RequestResourceType.USER\n    type: RequestType.INVITATION\n    user: User\n}\n\n\nexport interface WorkspaceRequest extends GroupRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.REQUEST\n    workspace: string\n}\n\nexport interface WorkspaceInvitation extends GroupRequest {\n    resourceType: RequestResourceType.WORKSPACE\n    type: RequestType.INVITATION\n    workspace: string\n}\n\nexport interface AppRequest extends GroupRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.REQUEST\n    app: string\n}\n\nexport interface AppInvitation extends GroupRequest {\n    resourceType: RequestResourceType.APP\n    type: RequestType.INVITATION\n    app: string\n}\n\nexport interface App {\n    id: string,\n    module: string,\n    func: string,\n    version: string,\n    title: string,\n    category: string\n}\n\nexport interface AppResource {\n    id: string\n}\n\nexport interface Organization {\n    id: string\n    name: string\n    gravatarHash: string | null\n    description: string\n    owner: Member\n    relation: UserOrgRelation\n    createdAt: Date\n    modifiedAt: Date,\n    members: Array<Member>,\n    // admins: Array<Admin>,\n    adminRequests: Array<GroupRequest>,\n    narratives: Array<NarrativeResource>,\n    apps: Array<AppResource>\n}\n\nexport interface EditedOrganization {\n    id: {\n        value: string,\n        error?: UIError\n    }\n    name: {\n        value: string,\n        error?: UIError\n    }\n    description: {\n        value: string,\n        error?: UIError\n    }\n}\n\n/*\n    Collection of organizations\n*/\n\nexport type Organizations = Array<Organization>\n\n\n/* REDUX */\n\nexport enum AuthState {\n    NONE = 0,\n    CHECKING,\n    AUTHORIZED,\n    UNAUTHORIZED,\n    ERROR\n}\n\nexport interface UserAuthorization {\n    token: string,\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\n\nexport interface Authorization {\n    status: AuthState,\n    message: string,\n    authorization: UserAuthorization\n}\n\n// export enum Filter {\n//     All = 1,\n//     Yours\n// }\n\n\nexport enum EditOrgState {\n    NONE = 0,\n    FETCHING,\n    READY,\n    EDITING_CAN_SAVE,\n    EDITING_ERRORS,\n    SAVING,\n    SAVED,\n    ERROR\n}\n\n// export enum AddOrgState {\n//     NONE = 0,\n//     READY,\n//     UNEDITED_OK,\n//     UNEDITED_\n//     EDITED_OK,\n//     EDITED_ERRORS,\n//     SAVING,\n//     SAVED,\n//     ERROR\n// }\n\nexport enum SyncState {\n    NONE = 'NONE',\n    NEW = 'NEW',\n    DIRTY = 'DIRTY',\n    CLEAN = 'CLEAN'\n}\n\nexport enum EditState {\n    NONE = 'NONE',\n    UNEDITED = 'UNEDITED',\n    EDITED = 'EDITED'\n}\n\n// TODO: or CLEAN to replace new and saved\nexport enum SaveState {\n    NONE = 'NONE',\n    NEW = 'NEW',\n    READY = 'READY',\n    SAVING = 'SAVING',\n    SAVED = 'SAVED',\n    SAVE_ERROR = 'SAVE_ERROR'\n}\n\nexport enum ValidationState {\n    NONE = 'NONE',\n    VALID = 'VALID',\n    INVALID = 'INVALID'\n}\n\nexport enum FieldState {\n    NONE = 0,\n    UNEDITED_OK,\n    UNEDITED_ERROR,\n    EDITED_OK,\n    EDITED_ERROR,\n    EDITED_WARNING\n}\n\nexport enum ViewOrgState {\n    NONE = 0,\n    INITIAL,\n    FETCHING,\n    READY,\n    ERROR\n}\n\nexport enum AppState {\n    NONE = 0,\n    LOADING,\n    READY,\n    ERROR\n}\n\nexport enum SortDirection {\n    ASCENDING = 'asc',\n    DESCENDING = 'desc'\n}\n\nexport enum ComponentLoadingState {\n    NONE = 0,\n    LOADING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface ManageOrganizationRequestsValue {\n    organization: Organization\n    requests: Array<GroupRequest>\n}\nexport interface ManageOrganizationRequestsView {\n    state: ComponentLoadingState\n    viewState: ManageOrganizationRequestsValue | null\n    error: AppError | null\n}\nexport enum ViewMembersViewState {\n    NONE = 0,\n    LOADING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface ViewMembersView {\n    state: ViewMembersViewState,\n    error: AppError | null,\n    view: {\n        organization: Organization\n    } | null\n}\n\nexport enum BrowseOrgsState {\n    NONE = 0,\n    SEARCHING,\n    SUCCESS,\n    ERROR\n}\n\nexport interface BrowseOrgsView {\n    state: BrowseOrgsState,\n    error: AppError | null,\n    view: {\n        rawOrganizations: Array<Organization>\n        organizations: Array<Organization>\n        totalCount: number\n        filteredCount: number\n        sortBy: string\n        sortDirection: SortDirection\n        filter: string\n        searchTerms: Array<string>\n        selectedOrganizationId: string | null,\n        searching: boolean\n    } | null\n}\n\nexport enum InviteUserViewState {\n    NONE = 0,\n    EDITING,\n    SENDABLE,\n    SENDING,\n    SUCCESS,\n    ERROR\n}\n\n// user info we get out of user profile search\nexport interface BriefUser {\n    username: string\n    realname: string\n}\n\n// a user who may or may not be in an org, with org relation info\n// todo: fetch more profile info.\nexport interface OrganizationUser {\n    username: string\n    realname: string\n    relation: UserRelationToOrganization\n}\n\nexport interface InviteUserValue {\n    organization: Organization\n    users: Array<OrganizationUser> | null\n    selectedUser: {\n        user: User,\n        relation: UserRelationToOrganization\n    } | null\n    editState: InviteUserViewState\n}\n\nexport interface InviteUserView {\n    loadingState: ComponentLoadingState\n    value: InviteUserValue | null\n    error: AppError | null\n    // viewState: AppError | InviteUserValue | null\n}\n\nexport interface ManageMembershipValue {\n    organization: Organization\n}\n\nexport interface ManageMembershipView {\n    // state: ComponentLoadingState,\n    loading: boolean\n    error: AppError | null\n    value: ManageMembershipValue | null\n    // viewState: AppError | ManageMembershipValue | null\n}\n\nexport interface Narrative {\n    workspaceId: number,\n    objectId: number,\n    title: string,\n    inOrganization: boolean,\n    // createdAt: Date,\n    modifiedAt: Date\n}\n\nexport enum UserWorkspacePermission {\n    NONE = 0,\n    READ,\n    WRITE,\n    ADMIN,\n    OWN\n}\n\nexport interface NarrativeResource {\n    workspaceId: number\n    title: string\n    permission: UserWorkspacePermission\n    isPublic: boolean\n}\n\nexport enum RequestNarrativeState {\n    NONE = 0,\n    LOADING,\n    ERROR,\n    LOADED,\n    SENDING,\n    SENT\n}\n\nexport interface RequestNarrativeValue {\n    organization: Organization\n    narratives: Array<Narrative>\n    selectedNarrative: Narrative | null\n}\n\nexport interface RequestNarrativeView {\n    status: RequestNarrativeState\n    error: AppError | null\n    value: RequestNarrativeValue | null\n}\n\nexport interface StoreState {\n    browseOrgs: BrowseOrgsView,\n\n    auth: Authorization\n    error: AppError | null\n\n    app: {\n        status: AppState\n        config: AppConfig\n        error?: AppError\n    }\n    addOrg: {\n        editState: EditState\n        saveState: SaveState\n        validationState: ValidationState\n        newOrganization: EditableOrganization\n        error?: AppError\n    }\n    updateOrg: {\n        pending: boolean\n    }\n    viewOrg: {\n        state: ViewOrgState\n        organization?: Organization\n        error?: AppError\n    }\n    editOrg: {\n        organizationId: string\n        editState: EditState\n        saveState: SaveState\n        validationState: ValidationState\n        editedOrganization: EditableOrganization\n        organization: Organization | null\n        error?: AppError\n    }\n    manageOrganizationRequestsView: ManageOrganizationRequestsView\n    viewMembersView: ViewMembersView\n    inviteUserView: InviteUserView\n    manageMembershipView: ManageMembershipView\n    requestNarrativeView: RequestNarrativeView\n}\n\n/* COMPONENT PROPS */\n\n\n\n\n// ADD ORG\n\n\n\n\n// export interface EditOrganizationProps {\n//     id: string,\n//     state: EditOrgState\n//     organization?: Organization\n//     editedOrganization?: EditedOrganization\n//     error?: AppError\n//     onEditOrg: (id: string) => void\n//     onUpdateOrg: () => void\n//     onUpdateName: (name: string) => void,\n//     onUpdateDescription: (description: string) => void\n// }\n\n\nexport interface AppError {\n    code: string,\n    message: string\n}\n\nexport interface AppConfig {\n    baseUrl: string,\n    services: {\n        Groups: {\n            url: string\n        },\n        UserProfile: {\n            url: string\n        },\n        Workspace: {\n            url: string\n        },\n        ServiceWizard: {\n            url: string\n        }\n    }\n}\n\nexport interface AuthProps {\n    authorization: Authorization,\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n    hosted: boolean,\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\n","export enum ActionFlag {\n    APP = 1,\n    APP_START,\n    APP_SUCCESS,\n    // APP_SUCCESS_IFRAME,\n    // APP_SUCCESS_SOLO,\n    APP_ERROR,\n\n    SORT_ORGS,\n    SORT_ORGS_START,\n\n    FILTER_ORGS,\n    FILTER_ORGS_START,\n\n    SEARCH_ORGS,\n    SEARCH_ORGS_START,\n    SEARCH_ORGS_SUCCESS,\n    SEARCH_ORGS_ERROR,\n\n    UPDATE_ORG,\n    UPDATE_ORG_START,\n    UPDATE_ORG_SUCCESS,\n    UPDATE_ORG_ERROR,\n\n    // viewing org\n    VIEW_ORG_FETCH,\n    VIEW_ORG_FETCH_START,\n    VIEW_ORG_FETCH_SUCCESS,\n    VIEW_ORG_FETCH_ERROR,\n    VIEW_ORG_STOP,\n\n    // Joining and Such\n    VIEW_ORG_JOIN_REQUEST,\n    VIEW_ORG_JOIN_REQUEST_START,\n    VIEW_ORG_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_CANCEL_JOIN_REQUEST,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_START,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,\n    VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n\n    VIEW_ORG_ACCEPT_JOIN_INVITATION,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_START,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n\n\n    VIEW_ORG_REJECT_JOIN_INVITATION,\n    VIEW_ORG_REJECT_JOIN_INVITATION_START,\n    VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS,\n    VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n\n    VIEW_ORG_REMOVE_NARRATIVE,\n    VIEW_ORG_REMOVE_NARRATIVE_START,\n    VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n\n    // add org fields\n    ADD_ORG_EDIT,\n    ADD_ORG_EDIT_START,\n    ADD_ORG_EDIT_FINISH,\n\n    ADD_ORG_UPDATE_NAME,\n    ADD_ORG_UPDATE_NAME_SUCCESS,\n    ADD_ORG_UPDATE_NAME_ERROR,\n\n    ADD_ORG_UPDATE_GRAVATAR_HASH,\n    ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n\n    ADD_ORG_UPDATE_ID,\n    ADD_ORG_UPDATE_ID_SUCCESS,\n    ADD_ORG_UPDATE_ID_ERROR,\n\n    ADD_ORG_UPDATE_DESCRIPTION,\n    ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    ADD_ORG_EVALUATE,\n    ADD_ORG_EVALUATE_OK,\n    ADD_ORG_EVALUATE_ERRORS,\n\n    ADD_ORG,\n    ADD_ORG_START,\n    ADD_ORG_SUCCESS,\n    ADD_ORG_ERROR,\n\n    // editing org\n    EDIT_ORG_EDIT,\n    EDIT_ORG_EDIT_START,\n    EDIT_ORG_EDIT_SUCCESS,\n    EDIT_ORG_EDIT_ERROR,\n\n    EDIT_ORG_SAVE,\n    EDIT_ORG_SAVE_START,\n    EDIT_ORG_SAVE_SUCCESS,\n    EDIT_ORG_SAVE_ERROR,\n\n    // edit org, field level updates\n    EDIT_ORG_UPDATE_NAME,\n    EDIT_ORG_UPDATE_NAME_SUCCESS,\n    EDIT_ORG_UPDATE_NAME_ERROR,\n\n    EDIT_ORG_UPDATE_GRAVATAR_HASH,\n    EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n\n    EDIT_ORG_UPDATE_DESCRIPTION,\n    EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n\n    EDIT_ORG_EVALUATE,\n    EDIT_ORG_EVALUATE_OK,\n    EDIT_ORG_EVALUATE_ERRORS,\n\n    // Auth\n    AUTH_CHECK,\n    AUTH_CHECK_START,\n    AUTH_CHECK_ERROR,\n    AUTH_AUTHORIZED,\n    AUTH_UNAUTHORIZED,\n    AUTH_REMOVE_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION,\n    AUTH_ADD_AUTHORIZATION_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_LOAD,\n    ADMIN_MANAGE_REQUESTS_LOAD_START,\n    ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n    ADMIN_MANAGE_REQUESTS_UNLOAD,\n\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS,\n    ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n\n    // MEMBERS\n    VIEW_MEMBERS_LOAD,\n    VIEW_MEMBERS_LOAD_START,\n    VIEW_MEMBERS_LOAD_SUCCESS,\n    VIEW_MEMBERS_LOAD_ERROR,\n    VIEW_MEMBERS_UNLOAD,\n\n    VIEW_MEMBERS_REMOVE_MEMBER,\n    VIEW_MEMBERS_REMOVE_MEMBER_START,\n    VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS,\n    VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_START,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_START,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n\n    // INVITE USER\n    INVITE_USER_LOAD,\n    INVITE_USER_LOAD_START,\n    INVITE_USER_LOAD_READY,\n    INVITE_USER_LOAD_ERROR,\n    INVITE_USER_UNLOAD,\n\n    INVITE_USER_SEARCH_USERS,\n    INVITE_USER_SEARCH_USERS_START,\n    INVITE_USER_SEARCH_USERS_SUCCESS,\n    INVITE_USER_SEARCH_USERS_ERROR,\n\n    INVITE_USER_SELECT_USER,\n    INVITE_USER_SELECT_USER_START,\n    INVITE_USER_SELECT_USER_SUCCESS,\n    INVITE_USER_SELECT_USER_ERROR,\n\n    INVITE_USER_SEND_INVITATION,\n    INVITE_USER_SEND_INVITATION_START,\n    INVITE_USER_SEND_INVITATION_SUCCESS,\n    INVITE_USER_SEND_INVITATION_ERROR,\n\n    // Manage Membership\n    MANAGE_MEMBERSHIP_LOAD,\n    MANAGE_MEMBERSHIP_LOAD_START,\n    MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n    MANAGE_MEMBERSHIP_LOAD_ERROR,\n\n    // Narrative add requests\n    REQUEST_ADD_NARRATIVE_LOAD,\n    REQUEST_ADD_NARRATIVE_LOAD_START,\n    REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n    REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n    REQUEST_ADD_NARRATIVE_UNLOAD,\n\n    REQUEST_ADD_NARRATIVE_SEND,\n    REQUEST_ADD_NARRATIVE_SEND_START,\n    REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SEND_ERROR,\n\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n    REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR\n\n}\n","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, UIErrorType, FieldState, ValidationState } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    AddOrgEditStart, AddOrgEditFinish,\n    AddOrgUpdateNameSuccess, AddOrgUpdateNameError,\n    AddOrgUpdateIdSuccess, AddOrgUpdateIdError,\n    AddOrgUpdateDescriptionSuccess, AddOrgUpdateDescriptionError,\n    AddOrgError, AddOrgStart, AddOrgSuccess, AddOrgEvaluateOK, AddOrgEvaluateErrors, AddOrgUpdateGravatarHashError, AddOrgUpdateGravatarHashSuccess\n} from '../actions/addOrg'\n\n// ADD ORG\n\nexport function addOrgStart(state: StoreState, action: AddOrgStart): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            saveState: SaveState.SAVING\n        }\n    }\n}\n\nexport function addOrgSuccess(state: StoreState, action: AddOrgSuccess): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            editState: EditState.UNEDITED,\n            saveState: SaveState.SAVED\n        }\n    }\n}\n\nexport function addOrgError(state: StoreState, action: AddOrgError): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            saveState: SaveState.SAVE_ERROR,\n            error: action.error\n        }\n    }\n}\n\nexport function addOrgEvaluateOk(state: StoreState, action: AddOrgEvaluateOK): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            validationState: ValidationState.VALID\n        }\n    }\n}\n\nexport function addOrgEvaluateErrors(state: StoreState, action: AddOrgEvaluateErrors): StoreState {\n    return {\n        ...state,\n        addOrg: {\n            ...state.addOrg,\n            validationState: ValidationState.INVALID\n        }\n    }\n}\n\nexport function addOrgEditStart(state: StoreState, action: AddOrgEditStart) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.UNEDITED,\n            validationState: ValidationState.NONE,\n            saveState: SaveState.NEW,\n            newOrganization: {\n                id: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                name: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                gravatarHash: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                description: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgEditFinish(state: StoreState, action: AddOrgEditFinish) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.UNEDITED\n        }\n    }\n}\n\n// Name\nexport function addOrgUpdateNameSuccess(state: StoreState, action: AddOrgUpdateNameSuccess) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                name: {\n                    value: action.name,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateNameError(state: StoreState, action: AddOrgUpdateNameError) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                name: {\n                    value: action.name,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\n// Gravatar hash\nexport function addOrgUpdateGravatarHashSuccess(state: StoreState, action: AddOrgUpdateGravatarHashSuccess) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                gravatarHash: {\n                    value: action.gravatarHash,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateGravatarHashError(state: StoreState, action: AddOrgUpdateGravatarHashError) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                gravatarHash: {\n                    value: action.gravatarHash,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\n// Id\n\nexport function addOrgUpdateIdSuccess(state: StoreState, action: AddOrgUpdateIdSuccess) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                id: {\n                    value: action.id,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateIdError(state: StoreState, action: AddOrgUpdateIdError) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                id: {\n                    value: action.id,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateDescriptionSuccess(state: StoreState, action: AddOrgUpdateDescriptionSuccess) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                description: {\n                    value: action.description,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function addOrgUpdateDescriptionError(state: StoreState, action: AddOrgUpdateDescriptionError) {\n    return {\n        ...state, addOrg: {\n            ...state.addOrg,\n            editState: EditState.EDITED,\n            newOrganization: {\n                ...state.addOrg.newOrganization!,\n                description: {\n                    value: action.description,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.ADD_ORG_START:\n            return addOrgStart(state, action as AddOrgStart)\n        case ActionFlag.ADD_ORG_SUCCESS:\n            return addOrgSuccess(state, action as AddOrgSuccess)\n        case ActionFlag.ADD_ORG_ERROR:\n            return addOrgError(state, action as AddOrgError)\n        case ActionFlag.ADD_ORG_EDIT_START:\n            return addOrgEditStart(state, action as AddOrgEditStart)\n        case ActionFlag.ADD_ORG_EDIT_FINISH:\n            return addOrgEditFinish(state, action as AddOrgEditFinish)\n        case ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS:\n            return addOrgUpdateNameSuccess(state, action as AddOrgUpdateNameSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_NAME_ERROR:\n            return addOrgUpdateNameError(state, action as AddOrgUpdateNameError)\n\n        case ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:\n            return addOrgUpdateGravatarHashSuccess(state, action as AddOrgUpdateGravatarHashSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR:\n            return addOrgUpdateGravatarHashError(state, action as AddOrgUpdateGravatarHashError)\n\n        case ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS:\n            return addOrgUpdateIdSuccess(state, action as AddOrgUpdateIdSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_ID_ERROR:\n            return addOrgUpdateIdError(state, action as AddOrgUpdateIdError)\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return addOrgUpdateDescriptionSuccess(state, action as AddOrgUpdateDescriptionSuccess)\n        case ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR:\n            return addOrgUpdateDescriptionError(state, action as AddOrgUpdateDescriptionError)\n        case ActionFlag.ADD_ORG_EVALUATE_OK:\n            return addOrgEvaluateOk(state, action as AddOrgEvaluateOK)\n        case ActionFlag.ADD_ORG_EVALUATE_ERRORS:\n            return addOrgEvaluateErrors(state, action as AddOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { StoreState, EditState, SaveState, UIErrorType, FieldState, ValidationState } from '../../types';\nimport { ActionFlag } from '../actions';\nimport {\n    EditOrgEditStart, EditOrgEditSuccess, EditOrgEditError,\n    EditOrgEvaluateOK, EditOrgEvaluateErrors,\n    EditOrgSave, EditOrgSaveStart, EditOrgSaveError, EditOrgSaveSuccess,\n    EditOrgUpdateNameSuccess, EditOrgUpdateNameError,\n    // EditOrgUpdateIdSuccess, EditOrgUpdateIdError,\n    EditOrgUpdateDescriptionSuccess, EditOrgUpdateDescriptionError,\n    EditOrgUpdateGravatarHashError, EditOrgUpdateGravatarHashSuccess\n} from '../actions/editOrg'\n\n\n\n// EDIT ORG\n\n// Edit session loading\n\nexport function editOrgEditStart(state: StoreState, action: EditOrgEditStart) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editState: EditState.UNEDITED,\n            validationState: ValidationState.NONE,\n            saveState: SaveState.NEW,\n            // TODO: get rid of this...\n            organizationId: action.id,\n            editedOrganization: {\n                id: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                name: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                gravatarHash: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                },\n                description: {\n                    value: '',\n                    status: FieldState.NONE,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgEditSuccess(state: StoreState, action: EditOrgEditSuccess) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editedOrganization: action.editedOrganization,\n            organization: action.organization,\n            editState: EditState.UNEDITED\n        }\n    }\n}\n\n// save\n\nexport function editOrgSaveStart(state: StoreState, action: EditOrgSaveStart): StoreState {\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            saveState: SaveState.SAVING\n        }\n    }\n}\n\nexport function editOrgSaveSuccess(state: StoreState, action: EditOrgSaveSuccess): StoreState {\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            editState: EditState.UNEDITED,\n            saveState: SaveState.SAVED\n        }\n    }\n}\n\nexport function editOrgSaveError(state: StoreState, action: EditOrgSaveError): StoreState {\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            saveState: SaveState.SAVE_ERROR,\n            error: action.error\n        }\n    }\n}\n\n// Evaluate edit session\n\nexport function editOrgEvaluateOk(state: StoreState, action: EditOrgEvaluateOK): StoreState {\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            validationState: ValidationState.VALID\n        }\n    }\n}\n\nexport function editOrgEvaluateErrors(state: StoreState, action: EditOrgEvaluateErrors): StoreState {\n    return {\n        ...state,\n        editOrg: {\n            ...state.editOrg,\n            validationState: ValidationState.INVALID\n        }\n    }\n}\n\n\n\n// Name\nexport function editOrgUpdateNameSuccess(state: StoreState, action: EditOrgUpdateNameSuccess) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editState: EditState.EDITED,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization,\n                name: {\n                    value: action.name,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateNameError(state: StoreState, action: EditOrgUpdateNameError) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editState: EditState.EDITED,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization,\n                name: {\n                    value: action.name,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\n// Gravatar hash\nexport function editOrgUpdateGravatarHashSuccess(state: StoreState, action: EditOrgUpdateGravatarHashSuccess) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editState: EditState.EDITED,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization,\n                gravatarHash: {\n                    value: action.gravatarHash,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateGravatarHashError(state: StoreState, action: EditOrgUpdateGravatarHashError) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editState: EditState.EDITED,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization,\n                gravatarHash: {\n                    value: action.gravatarHash,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\n// Id\n\n// export function editOrgUpdateIdSuccess(state: StoreState, action: EditOrgUpdateIdSuccess) {\n//     return {\n//         ...state, editOrg: {\n//             ...state.editOrg,\n//             editState: EditState.EDITED,\n//             editedOrganization: {\n//                 ...state.editOrg.editedOrganization!,\n//                 id: {\n//                     value: action.id,\n//                     status: FieldState.EDITED_OK,\n//                     error: {\n//                         type: UIErrorType.NONE\n//                     }\n//                 }\n//             }\n//         }\n//     }\n// }\n\n// export function editOrgUpdateIdError(state: StoreState, action: EditOrgUpdateIdError) {\n//     return {\n//         ...state, editOrg: {\n//             ...state.editOrg,\n//             editState: EditState.EDITED,\n//             editedOrganization: {\n//                 ...state.editOrg.editedOrganization!,\n//                 id: {\n//                     value: action.id,\n//                     status: FieldState.EDITED_ERROR,\n//                     error: action.error\n//                 }\n//             }\n//         }\n//     }\n// }\n\nexport function editOrgUpdateDescriptionSuccess(state: StoreState, action: EditOrgUpdateDescriptionSuccess) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editState: EditState.EDITED,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization,\n                description: {\n                    value: action.description,\n                    status: FieldState.EDITED_OK,\n                    error: {\n                        type: UIErrorType.NONE\n                    }\n                }\n            }\n        }\n    }\n}\n\nexport function editOrgUpdateDescriptionError(state: StoreState, action: EditOrgUpdateDescriptionError) {\n    return {\n        ...state, editOrg: {\n            ...state.editOrg,\n            editState: EditState.EDITED,\n            editedOrganization: {\n                ...state.editOrg.editedOrganization,\n                description: {\n                    value: action.description,\n                    status: FieldState.EDITED_ERROR,\n                    error: action.error\n                }\n            }\n        }\n    }\n}\n\nexport function reducer(state: StoreState, action: Action): StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.EDIT_ORG_EDIT_START:\n            return editOrgEditStart(state, action as EditOrgEditStart)\n        case ActionFlag.EDIT_ORG_EDIT_SUCCESS:\n            return editOrgEditSuccess(state, action as EditOrgEditSuccess)\n        case ActionFlag.EDIT_ORG_SAVE_START:\n            return editOrgSaveStart(state, action as EditOrgSaveStart)\n        case ActionFlag.EDIT_ORG_SAVE_SUCCESS:\n            return editOrgSaveSuccess(state, action as EditOrgSaveSuccess)\n        case ActionFlag.EDIT_ORG_SAVE_ERROR:\n            return editOrgSaveError(state, action as EditOrgSaveError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS:\n            return editOrgUpdateNameSuccess(state, action as EditOrgUpdateNameSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR:\n            return editOrgUpdateNameError(state, action as EditOrgUpdateNameError)\n\n        case ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS:\n            return editOrgUpdateGravatarHashSuccess(state, action as EditOrgUpdateGravatarHashSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR:\n            return editOrgUpdateGravatarHashError(state, action as EditOrgUpdateGravatarHashError)\n\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS:\n        //     return editOrgUpdateIdSuccess(state, action as EditOrgUpdateIdSuccess)\n        // case ActionFlag.EDIT_ORG_UPDATE_ID_ERROR:\n        //     return editOrgUpdateIdError(state, action as EditOrgUpdateIdError)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:\n            return editOrgUpdateDescriptionSuccess(state, action as EditOrgUpdateDescriptionSuccess)\n        case ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:\n            return editOrgUpdateDescriptionError(state, action as EditOrgUpdateDescriptionError)\n        case ActionFlag.EDIT_ORG_EVALUATE_OK:\n            return editOrgEvaluateOk(state, action as EditOrgEvaluateOK)\n        case ActionFlag.EDIT_ORG_EVALUATE_ERRORS:\n            return editOrgEvaluateErrors(state, action as EditOrgEvaluateErrors)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/viewOrg'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function viewOrgStart(state: types.StoreState,\n    action: actions.ViewOrgStart): types.StoreState {\n    return {\n        ...state,\n        viewOrg: { ...state.viewOrg, state: types.ViewOrgState.FETCHING }\n    }\n}\n\nexport function viewOrgSuccess(state: types.StoreState,\n    action: actions.ViewOrgSuccess): types.StoreState {\n    return {\n        ...state,\n        viewOrg: {\n            ...state.viewOrg,\n            state: types.ViewOrgState.READY,\n            organization: action.organization\n        }\n    }\n}\n\nexport function viewOrgError(state: types.StoreState,\n    action: actions.ViewOrgError): types.StoreState {\n    return {\n        ...state,\n        viewOrg: {\n            ...state.viewOrg,\n            state: types.ViewOrgState.ERROR,\n            error: action.error\n        }\n    }\n}\n\nexport function viewOrgStop(state: types.StoreState, action: actions.ViewOrgStop): types.StoreState {\n    return {\n        ...state,\n        viewOrg: {\n            state: types.ViewOrgState.NONE\n        }\n    }\n}\n\n\nexport function removeNarrativeSuccess(state: types.StoreState, action: actions.RemoveNarrativeSuccess): types.StoreState {\n    if (!state.viewOrg.organization) {\n        return state\n    }\n    const newNarratives = state.viewOrg.organization.narratives.filter((narrative) => {\n        return (narrative.workspaceId !== action.narrative.workspaceId)\n    })\n    return {\n        ...state,\n        viewOrg: {\n            ...state.viewOrg,\n            organization: {\n                ...state.viewOrg.organization,\n                narratives: newNarratives\n            }\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_ORG_FETCH_START:\n            return viewOrgStart(state, action as actions.ViewOrgStart)\n        case ActionFlag.VIEW_ORG_FETCH_SUCCESS:\n            return viewOrgSuccess(state, action as actions.ViewOrgSuccess)\n        case ActionFlag.VIEW_ORG_FETCH_ERROR:\n            return viewOrgError(state, action as actions.ViewOrgError)\n        case ActionFlag.VIEW_ORG_STOP:\n            return viewOrgStop(state, action as actions.ViewOrgStop)\n        case ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:\n            return removeNarrativeSuccess(state, action as actions.RemoveNarrativeSuccess)\n        default:\n            return null\n    }\n}\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/searchOrgs'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\nimport { Organizations, Organization } from '../../types'\nimport { Model } from '../../data/model'\n\nexport function applyOrgSearch(orgs: Organizations, searchTerms: Array<string>) {\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTerms.every((term) => {\n            // todo : make more efficient!!!\n            return (new RegExp(term, 'i').test(org.name));\n        })\n    })\n\n    return {\n        organizations: filteredOrgs,\n        totalCount: orgs.length,\n        filteredCount: filteredOrgs.length\n    }\n}\n\n// TODO:\n// dispatch the start of the request\n// do the request\n// dispatch the success (will be same for all queries?)\n// dispatch the error\n// FOR NOW:\n// do it here...\nexport function searchOrgsStart(state: types.StoreState, action: actions.SearchOrgsStart): types.StoreState {\n    if (state.browseOrgs.view === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    const { browseOrgs: { view: { filter, sortBy, sortDirection } } } = state\n    const query: Query = {\n        searchTerms: action.searchTerms,\n        filter: filter,\n        sortBy: sortBy,\n        sortDirection: sortDirection,\n        username: state.auth.authorization.username\n    }\n    // const result = queryOrgs(state.rawOrganizations, query)\n    // rawOrganizations: Array<Organization>\n    // organizations: Array<Organization>\n    // totalCount: number\n    // filteredCount: number\n    // sortBy: string\n    // sortDirection: SortDirection\n    // filter: string\n    // searchTerms: Array<string>\n    // selectedOrganizationId: string | null\n    return {\n        ...state,\n        // organizations: result.organizations, \n        // totalCount: result.total, \n        // filteredCount: result.organizations.length,\n        browseOrgs: {\n            ...state.browseOrgs,\n            state: types.BrowseOrgsState.SEARCHING,\n            error: null,\n            view: {\n                ...state.browseOrgs.view,\n                selectedOrganizationId: null,\n                searchTerms: action.searchTerms\n            }\n        }\n    }\n}\n\nexport function searchOrgsSuccess(state: types.StoreState, action: actions.SearchOrgsSuccess): types.StoreState {\n    if (state.browseOrgs.view === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    return {\n        ...state,\n        browseOrgs: {\n            ...state.browseOrgs,\n            state: types.BrowseOrgsState.SUCCESS,\n            error: null,\n            view: {\n                ...state.browseOrgs.view,\n                organizations: action.organizations,\n                totalCount: action.totalCount,\n                filteredCount: action.organizations.length\n            }\n        }\n    }\n}\n\n// TODO: hmm, uses the global error -- this was early in the development of this (a whole two weeks ago!)\n// and this should now go in the \"browseOrgs\" (or better named \"searchOrgs\") branch.\nexport function searchOrgsError(state: types.StoreState, action: actions.SearchOrgsError): types.StoreState {\n    if (state.browseOrgs.view) {\n        return {\n            ...state,\n            browseOrgs: {\n                ...state.browseOrgs,\n                error: action.error,\n                state: types.BrowseOrgsState.ERROR,\n                view: {\n                    ...state.browseOrgs.view,\n                    searching: false\n                }\n            }\n        }\n    } else {\n        return {\n            ...state,\n            browseOrgs: {\n                ...state.browseOrgs,\n                error: action.error\n            }\n        }\n    }\n}\n\n\nexport function sortOrgsStart(state: types.StoreState, action: actions.SortOrgsStart): types.StoreState {\n    if (state.browseOrgs.view === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    const {\n        browseOrgs: { view: { searchTerms, filter } },\n        auth: { authorization: { username } }\n    } = state\n    const query: Query = {\n        searchTerms: searchTerms,\n        filter: filter,\n        sortBy: action.sortBy,\n        sortDirection: action.sortDirection,\n        username: username\n    }\n\n    return {\n        ...state,\n        browseOrgs: {\n            ...state.browseOrgs,\n            state: types.BrowseOrgsState.SEARCHING,\n            error: null,\n            view: {\n                ...state.browseOrgs.view,\n                sortBy: action.sortBy,\n                sortDirection: action.sortDirection\n            }\n        }\n    }\n}\n\n\ninterface Query {\n    searchTerms: Array<string>,\n    username: string,\n    sortBy: string,\n    sortDirection: types.SortDirection,\n    filter: string\n}\n\ninterface QueryResults {\n    organizations: Organizations,\n    total: number\n}\n\nexport function filterOrgsStart(state: types.StoreState,\n    action: actions.FilterOrgsStart): types.StoreState {\n    if (state.browseOrgs.view === null) {\n        console.warn('Cannot start browseOrgs view')\n        return state\n    }\n    const { filter } = action\n\n    return {\n        ...state,\n        browseOrgs: {\n            ...state.browseOrgs,\n            state: types.BrowseOrgsState.SEARCHING,\n            error: null,\n            view: {\n                ...state.browseOrgs.view,\n                filter\n            }\n        }\n    }\n}\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.SEARCH_ORGS_START:\n            return searchOrgsStart(state, action as actions.SearchOrgsStart)\n        case ActionFlag.SEARCH_ORGS_SUCCESS:\n            return searchOrgsSuccess(state, action as actions.SearchOrgsSuccess)\n        case ActionFlag.SEARCH_ORGS_ERROR:\n            return searchOrgsError(state, action as actions.SearchOrgsError)\n        // case ActionFlag.SORT_ORGS_STAR:\n        //     return sortOrgs(state, action as actions.SortOrgs)\n        case ActionFlag.SORT_ORGS_START:\n            return sortOrgsStart(state, action as actions.SortOrgsStart)\n        case ActionFlag.FILTER_ORGS_START:\n            return filterOrgsStart(state, action as actions.FilterOrgsStart)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\n\nimport { ActionFlag } from '../actions'\nimport { StoreState, AuthState } from '../../types'\nimport { AuthCheckStart, AuthAuthorized, AuthUnauthorized, AuthCheckError } from '../actions/auth';\n\nexport function authCheckStart(state: StoreState, action: AuthCheckStart): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.CHECKING,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authCheckError(state: StoreState, action: AuthCheckError): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.ERROR,\n            message: action.error.message,\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nexport function authAuthorized(state: StoreState, action: AuthAuthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.AUTHORIZED,\n            message: '',\n            authorization: {\n                token: action.token,\n                username: action.username,\n                realname: action.realname,\n                roles: action.roles\n            }\n        }\n    }\n}\n\nexport function authUnauthorized(state: StoreState, action: AuthUnauthorized): StoreState {\n    return {\n        ...state,\n        auth: {\n            status: AuthState.UNAUTHORIZED,\n            message: '',\n            authorization: {\n                token: '',\n                username: '',\n                realname: '',\n                roles: []\n            }\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.AUTH_CHECK_START:\n            return authCheckStart(state, action as AuthCheckStart)\n        case ActionFlag.AUTH_AUTHORIZED:\n            return authAuthorized(state, action as AuthAuthorized)\n        case ActionFlag.AUTH_UNAUTHORIZED:\n            return authUnauthorized(state, action as AuthUnauthorized)\n        case ActionFlag.AUTH_CHECK_ERROR:\n            return authCheckError(state, action as AuthCheckError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { ActionFlag } from '../actions'\nimport { AppSuccess } from '../actions/app';\nimport { StoreState, AppState } from '../../types';\n\nexport function appSuccess(state: StoreState, action: AppSuccess): StoreState {\n    return {\n        ...state,\n        app: {\n            status: AppState.READY,\n            config: action.config\n        }\n    }\n}\n\nfunction reducer(state: StoreState, action: Action): StoreState | null {\n    switch (action.type) {\n        case ActionFlag.APP_SUCCESS:\n            return appSuccess(state, action as AppSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageOrganizationRequests'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(\n    state: types.StoreState,\n    action: actions.LoadStart): types.StoreState {\n    return state\n}\n\nexport function loadSuccess(\n    state: types.StoreState,\n    action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        manageOrganizationRequestsView: {\n            viewState: {\n                organization: action.organization,\n                requests: action.requests,\n            },\n            // TODO: wtf\n            state: types.ComponentLoadingState.SUCCESS,\n            error: null\n        }\n    }\n}\n\nexport function loadError(\n    state: types.StoreState,\n    action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        manageOrganizationRequestsView: {\n            viewState: null,\n            state: types.ComponentLoadingState.ERROR,\n            error: action.error\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        manageOrganizationRequestsView: {\n            state: types.ComponentLoadingState.NONE,\n            viewState: null,\n            error: null\n        }\n    }\n}\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/viewMembers'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function viewMembersLoadStart(state: types.StoreState, action: actions.ViewMembersLoadStart) {\n    return {\n        ...state,\n        viewMembersView: {\n            ...state.viewMembersView,\n            state: types.ViewMembersViewState.LOADING,\n            view: null,\n            error: null\n        }\n    }\n}\n\nexport function viewMembersUnload(state: types.StoreState, action: actions.ViewMembersUnload) {\n    return {\n        ...state,\n        viewMembersView: {\n            ...state.viewMembersView,\n            state: types.ViewMembersViewState.NONE,\n            view: null,\n            error: null\n        }\n    }\n}\n\nexport function viewMembersLoadSuccess(state: types.StoreState, action: actions.ViewMembersLoadSuccess) {\n    return {\n        ...state,\n        viewMembersView: {\n            ...state.viewMembersView,\n            state: types.ViewMembersViewState.SUCCESS,\n            view: {\n                organization: action.organization\n            },\n            error: null\n        }\n    }\n}\n\nexport function viewMembersLoadError(state: types.StoreState, action: actions.ViewMembersLoadError) {\n    return {\n        ...state,\n        viewMembersView: {\n            ...state.viewMembersView,\n            state: types.ViewMembersViewState.ERROR,\n            view: null,\n            error: action.error\n        }\n    }\n}\n\nexport function viewMembersPromoteToAdminSuccess(state: types.StoreState, action: actions.ViewMembersPromoteToAdminSuccess): types.StoreState {\n\n    if (state.viewMembersView.view === null) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = state.viewMembersView.view.organization.members.map((member) => {\n        if (member.user.username === action.memberUsername) {\n            member.type = types.MemberType.ADMIN\n            return member\n        } else {\n            return member\n        }\n    })\n\n    const newState = { ...state }\n    newState.viewMembersView.view!.organization.members = members\n    return newState\n}\n\nexport function viewMembersDemoteToMemberSuccess(state: types.StoreState, action: actions.ViewMembersDemoteToMemberSuccess): types.StoreState {\n\n    if (state.viewMembersView.view === null) {\n        return state\n    }\n\n    // TODO: probably better is to have to have the action handler do a call to get the members\n    // and to populate the orgs membership struct from that...\n    const members = state.viewMembersView.view.organization.members.map((member) => {\n        if (member.user.username === action.memberUsername) {\n            member.type = types.MemberType.MEMBER\n            return member\n        } else {\n            return member\n        }\n    })\n\n    const newState = { ...state }\n    newState.viewMembersView.view!.organization.members = members\n    return newState\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    // NB using discriminant union nature of the ActionX types to narrow\n    // the type.\n\n    switch (action.type) {\n        case ActionFlag.VIEW_MEMBERS_LOAD_START:\n            return viewMembersLoadStart(state, action as actions.ViewMembersLoadStart)\n        case ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS:\n            return viewMembersLoadSuccess(state, action as actions.ViewMembersLoadSuccess)\n        case ActionFlag.VIEW_MEMBERS_LOAD_ERROR:\n            return viewMembersLoadError(state, action as actions.ViewMembersLoadError)\n        case ActionFlag.VIEW_MEMBERS_UNLOAD:\n            return viewMembersUnload(state, action as actions.ViewMembersUnload)\n        case ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:\n            return viewMembersPromoteToAdminSuccess(state, action as actions.ViewMembersPromoteToAdminSuccess)\n        case ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:\n            return viewMembersDemoteToMemberSuccess(state, action as actions.ViewMembersDemoteToMemberSuccess)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/inviteUser'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            loadingState: types.ComponentLoadingState.LOADING\n        }\n    }\n}\n\nexport function loadReady(state: types.StoreState, action: actions.LoadReady): types.StoreState {\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            loadingState: types.ComponentLoadingState.SUCCESS,\n            error: null,\n            value: {\n                editState: types.InviteUserViewState.EDITING,\n                users: action.users,\n                organization: action.organization,\n                selectedUser: null\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            loadingState: types.ComponentLoadingState.SUCCESS,\n            error: action.error,\n            value: null\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            loadingState: types.ComponentLoadingState.NONE,\n            error: null,\n            value: null\n        }\n    }\n}\n\nexport function searchUsersSuccess(state: types.StoreState, action: actions.SearchUsersSuccess): types.StoreState {\n    if (state.inviteUserView.value === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            value: {\n                ...state.inviteUserView.value,\n                users: action.users\n            }\n        }\n    }\n}\n\nexport function selectUserSuccess(state: types.StoreState, action: actions.SelectUserSuccess): types.StoreState {\n    if (state.inviteUserView.value === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            value: {\n                ...state.inviteUserView.value,\n                selectedUser: {\n                    user: action.user,\n                    relation: action.relation\n                }\n            }\n        }\n    }\n}\n\nexport function sendInvitationStart(state: types.StoreState, action: actions.SendInvitationStart): types.StoreState {\n    if (state.inviteUserView.value === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            value: {\n                ...state.inviteUserView.value,\n                editState: types.InviteUserViewState.SENDING\n            }\n        }\n    }\n}\n\nexport function sendInvitationSuccess(state: types.StoreState, action: actions.SendInvitationSuccess): types.StoreState {\n    if (state.inviteUserView.value === null) {\n        throw new Error('view value is null')\n    }\n\n    const { inviteUserView: { value: { selectedUser, users } } } = state\n\n    // const selectedUser = state.inviteUserView.value.selectedUser\n    if (!selectedUser) {\n        throw new Error('selected user is null')\n    }\n    selectedUser.relation = types.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n\n    if (!users) {\n        throw new Error('users is null')\n    }\n    const newUsers = users.map((user) => {\n        if (user.username === selectedUser.user.username) {\n            user.relation = types.UserRelationToOrganization.MEMBER_INVITATION_PENDING\n        }\n        return user\n    })\n\n\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            value: {\n                ...state.inviteUserView.value,\n                editState: types.InviteUserViewState.SUCCESS,\n                selectedUser: selectedUser,\n                users: newUsers\n            }\n        }\n    }\n}\n\nexport function sendInvitationError(state: types.StoreState, action: actions.SendInvitationError): types.StoreState {\n    if (state.inviteUserView.value === null) {\n        throw new Error('view value is null')\n    }\n    return {\n        ...state,\n        inviteUserView: {\n            ...state.inviteUserView,\n            value: {\n                ...state.inviteUserView.value,\n                editState: types.InviteUserViewState.ERROR\n            }\n        }\n    }\n}\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.INVITE_USER_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.INVITE_USER_LOAD_READY:\n            return loadReady(state, action as actions.LoadReady)\n        case ActionFlag.INVITE_USER_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.INVITE_USER_UNLOAD:\n            return unload(state, action as actions.Unload)\n        case ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS:\n            return searchUsersSuccess(state, action as actions.SearchUsersSuccess)\n        case ActionFlag.INVITE_USER_SELECT_USER_SUCCESS:\n            return selectUserSuccess(state, action as actions.SelectUserSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_START:\n            return sendInvitationStart(state, action as actions.SendInvitationStart)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS:\n            return sendInvitationSuccess(state, action as actions.SendInvitationSuccess)\n        case ActionFlag.INVITE_USER_SEND_INVITATION_ERROR:\n            return sendInvitationError(state, action as actions.SendInvitationError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/manageMembership'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function manageMembershipLoadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        manageMembershipView: {\n            loading: true,\n            error: null,\n            value: null\n        }\n    }\n}\n\nexport function manageMembershipLoadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        manageMembershipView: {\n            loading: false,\n            error: null,\n            value: {\n                organization: action.organization\n            }\n        }\n    }\n}\n\nexport function manageMembershipLoadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        manageMembershipView: {\n            loading: false,\n            error: action.error,\n            value: null\n        }\n    }\n}\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_START:\n            return manageMembershipLoadStart(state, action as actions.LoadStart)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS:\n            return manageMembershipLoadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR:\n            return manageMembershipLoadError(state, action as actions.LoadError)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport * as actions from '../actions/requestAddNarrative'\nimport * as types from '../../types'\nimport { ActionFlag } from '../actions'\n\nexport function loadStart(state: types.StoreState, action: actions.LoadStart): types.StoreState {\n    return {\n        ...state,\n        requestNarrativeView: {\n            ...state.requestNarrativeView,\n            status: types.RequestNarrativeState.LOADING,\n            error: null,\n            value: null\n        }\n    }\n}\n\nexport function loadSuccess(state: types.StoreState, action: actions.LoadSuccess): types.StoreState {\n    return {\n        ...state,\n        requestNarrativeView: {\n            ...state.requestNarrativeView,\n            status: types.RequestNarrativeState.LOADED,\n            error: null,\n            value: {\n                organization: action.organization,\n                narratives: action.narratives,\n                selectedNarrative: null\n            }\n        }\n    }\n}\n\nexport function loadError(state: types.StoreState, action: actions.LoadError): types.StoreState {\n    return {\n        ...state,\n        requestNarrativeView: {\n            ...state.requestNarrativeView,\n            status: types.RequestNarrativeState.ERROR,\n            error: action.error,\n            value: null\n        }\n    }\n}\n\nexport function sendRequestStart(state: types.StoreState, action: actions.SendRequestStart): types.StoreState {\n    return {\n        ...state,\n        requestNarrativeView: {\n            ...state.requestNarrativeView,\n            status: types.RequestNarrativeState.SENDING,\n        }\n    }\n}\n\nexport function sendRequestSuccess(state: types.StoreState, action: actions.SendRequestSuccess): types.StoreState {\n    const newState = {\n        ...state,\n        requestNarrativeView: {\n            ...state.requestNarrativeView,\n            status: types.RequestNarrativeState.SENT,\n        }\n    }\n\n    const selectedNarrative = newState.requestNarrativeView.value!.selectedNarrative\n\n    newState.requestNarrativeView.value!.narratives = newState.requestNarrativeView.value!.narratives.map((narrative) => {\n        if (narrative.workspaceId === selectedNarrative!.workspaceId) {\n            narrative.inOrganization = true\n        }\n        return narrative\n    })\n\n    return newState\n}\n\nexport function sendRequestError(state: types.StoreState, action: actions.SendRequestError): types.StoreState {\n    return {\n        ...state,\n        requestNarrativeView: {\n            ...state.requestNarrativeView,\n            status: types.RequestNarrativeState.SENT,\n            error: action.error,\n            value: null\n        }\n    }\n}\n\nexport function selectNarrativeSuccess(state: types.StoreState, action: actions.SelectNarrativeSuccess): types.StoreState {\n    if (state.requestNarrativeView.value === null) {\n        return state\n    }\n    return {\n        ...state,\n        requestNarrativeView: {\n            ...state.requestNarrativeView,\n            // TODO: a selected state?\n            error: null,\n            value: {\n                ...state.requestNarrativeView.value,\n                selectedNarrative: action.narrative\n            }\n        }\n    }\n}\n\nexport function unload(state: types.StoreState, action: actions.Unload): types.StoreState {\n    return {\n        ...state,\n        requestNarrativeView: {\n            status: types.RequestNarrativeState.NONE,\n            error: null,\n            value: null\n        }\n    }\n}\n\n\nfunction reducer(state: types.StoreState, action: Action): types.StoreState | null {\n    switch (action.type) {\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START:\n            return loadStart(state, action as actions.LoadStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:\n            return loadSuccess(state, action as actions.LoadSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return loadError(state, action as actions.LoadError)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:\n            return sendRequestSuccess(state, action as actions.SendRequestSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR:\n            return sendRequestStart(state, action as actions.SendRequestStart)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:\n            return selectNarrativeSuccess(state, action as actions.SelectNarrativeSuccess)\n        case ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD:\n            return unload(state, action as actions.Unload)\n        default:\n            return null\n    }\n}\n\nexport default reducer","import { Action } from 'redux'\nimport { StoreState } from '../../types'\nimport addOrgReducer from './addOrg'\nimport editOrgReducer from './editOrg'\nimport viewOrgReducer from './viewOrg'\nimport searchOrgsReducer from './searchOrgs'\nimport authReducer from './auth'\nimport appReducer from './app'\nimport manageOrganizatiopRequests from './manageOrganizationRequests';\nimport viewMembers from './viewMembers';\nimport inviteUser from './inviteUser';\nimport manageMembership from './manageMembership'\nimport requestAddNarrative from './requestAddNarrative';\n\n\nexport function reducer(state: StoreState, action: Action): StoreState {\n    return addOrgReducer(state, action) ||\n        editOrgReducer(state, action) ||\n        searchOrgsReducer(state, action) ||\n        viewOrgReducer(state, action) ||\n        authReducer(state, action) ||\n        appReducer(state, action) ||\n        manageOrganizatiopRequests(state, action) ||\n        viewMembers(state, action) ||\n        inviteUser(state, action) ||\n        manageMembership(state, action) ||\n        requestAddNarrative(state, action) ||\n        state;\n}\n\nexport default reducer","import { string, number } from \"prop-types\";\nimport { request } from \"http\";\n\nexport interface GroupsServiceInfo {\n    servname: string;\n    version: string;\n    servertime: number;\n    gitcommithash: string\n}\n\nexport interface BriefGroup {\n    id: string;\n    name: string;\n    custom: {\n        gravatarhash?: string\n    }\n    owner: string;\n    type: string;\n    // createdAt: number;\n    // modifiedAt: number\n}\n\nexport type GroupList = Array<BriefGroup>\n\nexport type Username = string;\n\nexport interface WorkspaceInfo {\n    rid: string\n    name: string\n    narrname: string\n    public: boolean\n    perm: string\n}\n\nexport interface AppInfo {\n    rid: string\n}\n\nexport interface Group {\n    id: string\n    name: string\n    owner: Username\n    type: string\n    admins: Array<Username>\n    members: Array<Username>\n    description: string\n    createdate: number\n    moddate: number\n    resources: {\n        workspace: Array<WorkspaceInfo>,\n        catalogmethod: Array<AppInfo>\n    }\n    custom: {\n        gravatarhash?: string\n    }\n}\n\nexport interface NewGroup {\n    id: string\n    name: string\n    gravatarhash: string | null\n    type: string\n    description: string\n}\n\nexport interface GroupUpdate {\n    name: string\n    gravatarhash: string | null\n    description: string\n}\n\nexport interface Request {\n    id: string\n    groupid: string\n    requester: Username\n    type: string\n    status: string\n    resource: string\n    resourcetype: string\n    createdate: number\n    expiredate: number\n    moddate: number\n}\n\nexport interface RequestWithCompletion extends Request {\n    complete: false\n}\n\nexport interface Completion {\n    complete: true\n}\n\nexport interface ErrorInfo {\n    appcode: number\n    apperror: string\n    callid: string\n    httpcode: number\n    httpstatus: string\n    message: string\n    time: number\n}\n\nexport interface ErrorResult {\n    error: ErrorInfo\n}\n\n// Error types: (appcode)\n// 10000\tAuthentication failed\n// 10010\tNo authentication token\n// 10020\tInvalid token\n// 20000\tUnauthorized\n// 30000\tMissing input parameter\n// 30001\tIllegal input parameter\n// 30010\tIllegal user name\n// 40000\tGroup already exists\n// 40010\tRequest already exists\n// 40020\tUser already group member\n// 40030\tWorkspace already in group\n// 50000\tNo such group\n// 50010\tNo such request\n// 50020\tNo such user\n// 50030\tNo such workspace\n// 60000\tUnsupported operation\n\nexport interface GroupExists {\n    exists: boolean\n}\n\n// export interface GroupRequest {\n//     id: string,\n//     groupid: string,\n//     requester: Username,\n//     type: string,\n//     status: string,\n//     resource: string\n//     resourcetype: string\n//     createdate: number,\n//     expiredate: number,\n//     moddate: number\n// }\n\nexport enum SortDirection {\n    ASCENDING = 0,\n    DESCENDING\n}\n\nexport interface GetRequestsParams {\n    includeClosed?: boolean,\n    sortDirection?: SortDirection,\n    startAt?: Date\n}\n\nexport interface RequestMemebershipParams {\n    groupId: string\n}\n\nexport interface RequestNarrativeParams {\n    workspaceId: number\n    groupId: string\n}\n\nexport class GroupsClient {\n    token: string;\n    url: string;\n\n    constructor({ token, url }: { token: string, url: string }) {\n        this.token = token\n        this.url = url\n    }\n\n    getInfo(): Promise<GroupsServiceInfo> {\n        return fetch(this.url + '/', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json();\n            })\n            .then((result) => {\n                return result as GroupsServiceInfo;\n            });\n    }\n\n    groupExists(id: string): Promise<GroupExists> {\n        return fetch(this.url + '/group/' + id + '/exists')\n            .then((response) => {\n                return response.json()\n            })\n            .then((exists) => {\n                return exists as GroupExists\n            })\n    }\n\n    // getGroups(): Promise<GroupList> {\n    //     return fetch(this.url + '/group', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json()\n    //         })\n    //         .then((result: GroupList) => {\n    //             return result.filter(({ type }) => type === 'Organization')\n    //         })\n    // }\n\n\n    getGroups(): Promise<Array<Group>> {\n        let start = new Date().getTime()\n        return fetch(this.url + '/group', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    console.error('error fetching groups', response)\n                    throw new Error('Error fetching groups')\n                }\n                return response.json()\n            })\n            .then((result: GroupList) => {\n                const orgs = result.filter(({ type }) => type === 'Organization')\n                return Promise.all(orgs.map((group) => (this.getGroupById(group.id))))\n            })\n            .then((result) => {\n                return result;\n            })\n    }\n\n    getGroupById(id: string): Promise<Group> {\n        return fetch(this.url + '/group/' + id, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status === 404) {\n                    return null\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Group\n            })\n    }\n\n    createGroup(newGroup: NewGroup): Promise<Group> {\n        return fetch(this.url + '/group/' + newGroup.id, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n            body: JSON.stringify({\n                name: newGroup.name,\n                custom: {\n                    gravatarhash: newGroup.gravatarhash\n                },\n                type: newGroup.type,\n                description: newGroup.description\n            })\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as Group\n            })\n    }\n\n    updateGroup(id: string, groupUpdate: GroupUpdate): Promise<void> {\n        return fetch(this.url + '/group/' + id + '/update', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT',\n\n            // TODO: build more intelligently\n            body: JSON.stringify({\n                name: groupUpdate.name,\n                custom: {\n                    gravatarhash: groupUpdate.gravatarhash\n                },\n                type: 'Organization',\n                description: groupUpdate.description\n            })\n        })\n            .then((response) => {\n                // response is an empty body.\n                if (response.status === 204) {\n                    return\n                }\n                throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n            })\n    }\n\n    getGroupRequests(groupId: string, params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n\n        return fetch(this.url + '/group/' + groupId + '/requests?' + params.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getTargetedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/targeted?' + params.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n    getCreatedRequests(params: GetRequestsParams): Promise<Array<Request>> {\n        const query = new URLSearchParams()\n        if (params.includeClosed) {\n            query.append('closed', 'closed')\n        }\n        if (params.sortDirection) {\n            if (params.sortDirection === SortDirection.DESCENDING) {\n                query.append('order', 'desc')\n            } else {\n                query.append('order', 'asc')\n            }\n        }\n        if (params.startAt) {\n            query.append('excludeupto', String(params.startAt.getTime()))\n        }\n        return fetch(this.url + '/request/created?' + params.toString(), {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'appcliation/json'\n            },\n            mode: 'cors',\n            method: 'GET'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    requestMembership(params: RequestMemebershipParams): Promise<Request> {\n        return fetch(this.url + '/group/' + params.groupId + '/requestmembership', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json',\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    addOrRequestNarrative(params: RequestNarrativeParams): Promise<RequestWithCompletion | Completion> {\n        const url = [\n            this.url,\n            'group',\n            params.groupId,\n            'resource',\n            'workspace',\n            String(params.workspaceId)\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                if (result.complete === false) {\n                    return result as RequestWithCompletion\n                } else {\n                    return result as Completion\n                }\n\n            })\n    }\n\n    deleteResource(groupId: string, resourceType: string, resourceId: string): Promise<void> {\n        const url = [\n            this.url,\n            'group',\n            groupId,\n            'resource',\n            resourceType,\n            resourceId\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ' : ' + response.statusText)\n                }\n            })\n    }\n\n    cancelRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/cancel', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    acceptRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/accept', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    denyRequest({ requestId }: { requestId: string }): Promise<Request> {\n        return fetch(this.url + '/request/id/' + requestId + '/deny', {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n\n    memberToAdmin({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'PUT'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    adminToMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member, 'admin'\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    removeMember({ groupId, member }: { groupId: string, member: string }): Promise<void> {\n        const url = [\n            this.url, 'group', groupId, 'user', member\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'DELETE'\n        })\n            .then((response) => {\n                if (response.status !== 204) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n\n            })\n    }\n\n    requestJoinGroup({ groupId, username }: { groupId: string, username: string }): Promise<Request> {\n        const url = [\n            this.url, 'group', groupId, 'user', username\n        ].join('/')\n        return fetch(url, {\n            headers: {\n                Authorization: this.token,\n                Accept: 'application/json'\n            },\n            mode: 'cors',\n            method: 'POST'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Unexpected response: ' + response.status + ':' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Request\n            })\n    }\n}","import * as React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport './Header.css'\nimport { FaUsers, FaChevronRight } from 'react-icons/fa'\n\nexport interface HeaderProps {\n}\n\nclass Header extends React.Component<HeaderProps, object> {\n\n    buildSeparator() {\n        if (this.props.children) {\n            return (\n                <FaChevronRight style={{ verticalAlign: 'middle', marginLeft: '4px', marginRight: '4px' }} />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Header\">\n                <div style={{ flex: '0 0 auto' }}>\n                    <NavLink to=\"/organizations\">\n                        <FaUsers style={{ verticalAlign: 'middle' }} />\n                        {' '}\n                        <span data-test=\"orgs-label\">Orgs</span>\n                    </NavLink>\n                </div>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    {this.buildSeparator()}\n                    {this.props.children}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Header;","import * as React from 'react';\nimport { NavLink } from 'react-router-dom'\n\nimport Organizations from './OrganizationsContainer';\nimport { SortDirection, AppError } from '../../types';\n\nimport './OrganizationsBrowser.css';\nimport { Button, Icon, Radio, Select, Modal, Alert } from 'antd'\nimport Header from '../Header';\nimport { RadioChangeEvent } from 'antd/lib/radio';\n\nexport interface OrganizationsBrowserProps {\n    totalCount: number;\n    filteredCount: number;\n    sortBy: string;\n    sortDirection: SortDirection;\n    filter: string;\n    searching: boolean;\n    error: AppError | null;\n    onSearchOrgs: (searchTerms: Array<string>) => void;\n    onSortOrgs: (sortBy: string, sortDirection: SortDirection) => void;\n    onFilterOrgs: (filter: string) => void;\n}\n\nexport interface OrganizationsBrowserState {\n    searchInput: string\n    showInfo: boolean\n}\nclass OrganizationsBrowser extends React.Component<OrganizationsBrowserProps, OrganizationsBrowserState> {\n\n    searchInput: React.RefObject<HTMLInputElement>;\n    searchButton: React.RefObject<Button>;\n\n    constructor(props: OrganizationsBrowserProps) {\n        super(props)\n\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.state = {\n            searchInput: '',\n            showInfo: false\n        }\n\n        this.props.onSearchOrgs([])\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Organizations Browser Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations browser...</p>\n                </div>\n            )\n        })\n    }\n\n    doSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        const searchTerms = this.searchInput.current.value.split(/[\\s+]/)\n        // dispatch the search event\n        this.props.onSearchOrgs(searchTerms);\n    }\n\n    haveSearchInput() {\n        if (this.state.searchInput && this.state.searchInput.length > 0) {\n            return true\n        }\n        return false\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.setState({ searchInput: currentSearchInputValue })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        this.doSearch()\n    }\n\n    onSortByChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(e.target.value, this.props.sortDirection)\n    }\n\n    onSortByChange2(value: string) {\n        this.props.onSortOrgs(value, this.props.sortDirection)\n    }\n\n\n    onSortDirectionChange(e: RadioChangeEvent) {\n        this.props.onSortOrgs(this.props.sortBy, e.target.value)\n    }\n\n    onSortDirectionChange2(value: string) {\n        this.props.onSortOrgs(this.props.sortBy, value as SortDirection)\n    }\n\n    onFilterChange(e: RadioChangeEvent) {\n        this.props.onFilterOrgs(e.target.value)\n    }\n\n    onFilterChange2(value: string) {\n        this.props.onFilterOrgs(value)\n    }\n\n    onClearSearch() {\n        if (this.searchInput.current === null) {\n            return\n        }\n        this.searchInput.current.value = ''\n        this.onSearchInputChange()\n        // this.searchButton.current!.handleClick(new MouseEvent<HTMLButtonElement>('click'))\n        // const event = new Event('change', { bubbles: true })\n        // this.searchInput.current.dispatchEvent(event)\n        this.doSearch()\n    }\n\n    renderSearchFeedback() {\n        if (this.props.totalCount === 0) {\n            return (\n                <span>\n                    No organizations in the system\n                </span>\n            )\n        }\n        if (this.props.filteredCount === 0) {\n            return (\n                <span>\n                    No organizations found out of\n                    {' '}\n                    {this.props.totalCount}\n                    {' '}\n                    available.\n                </span>\n            )\n\n        }\n        if (this.props.totalCount === this.props.filteredCount) {\n            return (\n                <span>\n                    Showing all\n                {' '}\n                    {this.props.totalCount}\n                    {' '}\n                    organizations\n                </span>\n            )\n        }\n\n        return (\n            <span>\n                Showing\n                {' '}\n                {this.props.filteredCount}\n                {' '}\n                out of\n                {' '}\n                {this.props.totalCount}\n                {' '}\n                organizations\n            </span>\n        )\n    }\n\n    renderSearchIcon() {\n        if (this.props.searching) {\n            return (<Icon type=\"loading\" />)\n        }\n        return (<Icon type=\"search\" />)\n    }\n\n    renderSearchBar() {\n        return (\n            <form id=\"searchForm\" className=\"OrganizationsBrowser-searchBar\" onSubmit={this.onSubmit.bind(this)}>\n                <input\n                    placeholder=\"Search Organizations\"\n                    onChange={this.onSearchInputChange.bind(this)}\n                    autoFocus\n                    ref={this.searchInput}></input>\n                {/* <Tooltip\n                    title=\"Enter one or more words to search organizations by name or owner\">\n                    <Icon type=\"info-circle\" theme=\"twoTone\" style={{ alignSelf: 'end' }} />\n                </Tooltip> */}\n                <Button\n                    disabled={!this.haveSearchInput()}\n                    ref={this.searchButton}\n                    form=\"searchForm\"\n                    key=\"submit\"\n                    htmlType=\"submit\">\n                    {this.renderSearchIcon()}\n                    {/* Search */}\n                </Button>\n                <Button\n                    onClick={this.onClearSearch.bind(this)}\n                    disabled={!this.haveSearchInput()}\n                    icon=\"close\"\n                >\n\n                    {/* Show all */}\n                </Button>\n                {/* <div className=\"message\">\n                    {this.renderSearchFeedback()}\n                </div> */}\n            </form>\n        )\n    }\n\n    renderHeader() {\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Browse and Search Organizations\n                        </span>\n                        <Icon type=\"right\" style={{ margin: '0 4px' }} />\n                        <span style={{ fontWeight: 'normal', fontStyle: 'italic' }}>\n                            {this.renderSearchFeedback()}\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end' }}>\n                        <NavLink to=\"/newOrganization\"><Button icon=\"plus-circle\">Create Organization</Button></NavLink>\n                        <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                    </div>\n\n                </div>\n            </Header>\n        )\n    }\n\n    renderSearchFilter() {\n        return (\n            <div>\n                <span className=\"field-label\">sort by</span>\n                <Select onChange={this.onSortByChange2.bind(this)}\n                    defaultValue={this.props.sortBy}\n                    style={{ width: '8em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"name\" key=\"name\">Org name</Select.Option>\n                    <Select.Option value=\"owner\" key=\"owner\">Owner</Select.Option>\n                    <Select.Option value=\"created\" key=\"created\">Date created</Select.Option>\n                </Select>\n                <Select onChange={this.onSortDirectionChange2.bind(this)}\n                    style={{ width: '10em' }}\n                    dropdownMatchSelectWidth={true}\n                    defaultValue={this.props.sortDirection}>\n                    <Select.Option value={SortDirection.ASCENDING} key=\"name\"><Icon type=\"sort-ascending\" />Ascending</Select.Option>\n                    <Select.Option value={SortDirection.DESCENDING} key=\"owner\"><Icon type=\"sort-descending\" />Descending</Select.Option>\n                </Select>\n                <span className=\"field-label\" style={{ marginLeft: '10px' }}>filter</span>\n                <Select onChange={this.onFilterChange2.bind(this)}\n                    defaultValue={this.props.filter}\n                    style={{ width: '16em' }}\n                    dropdownMatchSelectWidth={true}>\n                    <Select.Option value=\"all\" key=\"all\">All</Select.Option>\n                    <Select.Option value=\"memberOf\" key=\"memberOf\">You are a member of</Select.Option>\n                    <Select.Option value=\"owned\" key=\"owned\">Owned by you</Select.Option>\n                    <Select.Option value=\"notOwned\" key=\"notOwned\">Not owned by you</Select.Option>\n                    <Select.Option value=\"pending\" key=\"pending\">Pending request or invitation</Select.Option>\n                    <Select.Option value=\"groupPending\" key=\"groupPending\">Pending group requests</Select.Option>\n                </Select>\n            </div>\n        )\n    }\n\n    renderOrganizations() {\n        if (this.props.error) {\n            return (\n                <Alert\n                    type=\"error\"\n                    message={this.props.error.code}\n                    description={this.props.error.message} />\n            )\n        } else {\n            return (\n                <Organizations />\n            )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"OrganizationsBrowser scrollable-flex-column\">\n                {this.renderHeader()}\n                <div className=\"searchBarRow\">\n                    <div className=\"searchBarCol\">\n                        {this.renderSearchBar()}\n                    </div>\n                    <div className=\"sortCol\">\n                        {this.renderSearchFilter()}\n                    </div>\n                </div>\n                <div className=\"bodyRow scrollable-flex-column\">\n\n                    <div className=\"col2 scrollable-flex-column\">\n                        {this.renderOrganizations()}\n                    </div>\n                    {/* <div className=\"col1\">\n                        {this.renderControlArea()}\n                    </div> */}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default OrganizationsBrowser","export interface User {\n    username: string,\n    realname: string,\n    thumbnail: string\n}\n\nexport interface UserProfile {\n    user: User,\n    profile: {\n        synced: {\n            gravatarHash: string\n        },\n        userdata: {\n            jobTitle: string,\n            jobTitleOther: string,\n            organization: string\n            city: string\n            state: string\n            country: string\n            avatarOption: string\n            gravatarDefault: string\n        }\n    }\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport class UserProfileClient {\n    url: string;\n    token: string\n\n    static profileCache: Map<string, UserProfile> = new Map()\n\n    constructor({ url, token }: { url: string, token: string }) {\n        this.url = url\n        this.token = token\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'UserProfile.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: 'UserProfile.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n    getVersion(): Promise<any> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makeEmptyPayload('version'))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n\n    getUserProfile(username: string): Promise<UserProfile> {\n\n        if (UserProfileClient.profileCache.has(username)) {\n            return Promise.resolve(UserProfileClient.profileCache.get(username)!)\n        }\n\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('get_user_profile', [username]))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0][0] as UserProfile\n            })\n    }\n\n    getUserProfiles(usernames: Array<string>): Promise<Array<UserProfile>> {\n\n        const cached: Array<UserProfile> = []\n        const profilesToFetch: Array<string> = []\n\n        usernames.forEach((username) => {\n            if (UserProfileClient.profileCache.has(username)) {\n                cached.push(UserProfileClient.profileCache.get(username)!)\n            } else {\n                profilesToFetch.push(username)\n            }\n        })\n\n        if (profilesToFetch.length === 0) {\n            return Promise.resolve(cached)\n        }\n\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('get_user_profile', profilesToFetch))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0] as Array<UserProfile>\n            })\n            .then((profiles) => {\n                profiles.forEach((profile) => {\n                    UserProfileClient.profileCache.set(profile.user.username, profile)\n                })\n                return profiles.concat(cached)\n            })\n    }\n\n    getAllUsers(): Promise<Array<User>> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('filter_users', { filter: '' }))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n\n    searchUsers(query: string): Promise<Array<User>> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload('filter_users', { filter: query }))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('User profile request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result.result[0] as Array<User>\n            })\n    }\n}","import { AuthorizedServiceClient, ServiceClientParams } from './serviceClient'\n\n// types from module\n\nexport interface Service {\n    module_name: string\n    version: string | null\n}\n\nexport interface ServiceStatus {\n    module_name: string\n    version: string\n    git_commit_hash: string\n    release_tags: Array<string>\n    hash: string\n    url: string\n    up: number // aka boolean\n    status: string\n    health: string\n}\n\n// impl\n\nexport interface ServiceWizardClientParams extends ServiceClientParams {\n\n}\n\nexport interface GetServiceStatusParams extends Service { }\n\nexport interface GetServiceStatusResult extends ServiceStatus { }\n\nexport class ServiceWizardClient extends AuthorizedServiceClient {\n\n    static module: string = 'ServiceWizard'\n\n    constructor(params: ServiceWizardClientParams) {\n        super(params)\n    }\n\n\n    getServiceStatus(params: GetServiceStatusParams): Promise<GetServiceStatusResult> {\n        return this.callFunc('get_service_status', params)\n            .then((result) => {\n                if (result.result &&\n                    result.result.length > 0) {\n                    const theResult = result.result[0]\n                    if (!theResult) {\n                        throw new Error('Crazy at it seems, no result')\n                    }\n                    return theResult as GetServiceStatusResult\n                } else {\n                    throw new Error('Crazy at it seems, no result')\n                }\n            })\n    }\n\n}","export interface ServiceClientParams {\n    url: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport interface JSONResponse {\n    id: string\n    version: string\n    result: any\n    error: any\n}\n\nexport class ServiceClient {\n    url: string;\n    token: string | null;\n\n    static module: string;\n\n    constructor({ url, token }: ServiceClientParams) {\n        this.url = url\n        this.token = token || null\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: (<typeof ServiceClient>this.constructor).module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n\n}\n\nexport class AuthorizedServiceClient extends ServiceClient {\n    token: string;\n\n    constructor(params: ServiceClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    callFunc(func: string, param: any): Promise<JSONResponse> {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token!,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Request error: ' + response.status + ', ' + response.statusText)\n                }\n                return <unknown>response.json() as JSONResponse\n            })\n    }\n}\n\n","export interface GenericClientParams {\n    url: string\n    module: string\n    token?: string\n}\n\nexport interface JSONPayload {\n    version: string,\n    method: string,\n    id: string,\n    params: any\n}\n\nexport class GenericClient {\n    url: string;\n    token: string | null\n    module: string\n\n    constructor({ url, token, module }: GenericClientParams) {\n        this.url = url\n        this.token = token || null\n        this.module = module\n    }\n\n    makePayload(method: string, param: any): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: [param]\n        }\n    }\n\n    makeEmptyPayload(method: string): JSONPayload {\n        return {\n            version: '1.1',\n            method: this.module + '.' + method,\n            id: String(Math.random()).slice(2),\n            params: []\n        }\n    }\n\n\n}\n\nexport class AuthorizedGenericClient extends GenericClient {\n    token: string;\n\n    constructor(params: GenericClientParams) {\n        super(params)\n        if (!params.token) {\n            throw new Error('Authorized client requires token')\n        }\n        this.token = params.token\n    }\n\n    callFunc(func: string, param: any) {\n        return fetch(this.url, {\n            method: 'POST',\n            mode: 'cors',\n            cache: 'no-store',\n            headers: {\n                Authorization: this.token!,\n                'Content-Type': 'application/json',\n                Accept: 'application/json'\n            },\n            body: JSON.stringify(this.makePayload(func, param))\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error('Request error: ' + response.status + ', ' + response.statusText)\n                }\n                return response.json()\n            })\n    }\n}\n\n","import Bluebird from 'bluebird'\nimport { AuthorizedServiceClient } from './serviceClient'\n\nimport { ServiceWizardClient } from './serviceWizard'\nimport { GenericClient, AuthorizedGenericClient } from './genericClient'\n// now import the service wizard, and one auth generic client\n\n// type Promise<T> = Bluebird<T>\n\nexport interface CacheParams {\n    itemLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n}\n\nexport interface CacheItem<T> {\n    id: string\n    value: T | null\n    createdAt: number\n    fetcher: () => Bluebird<T>\n    reserved: boolean\n}\n\nexport class Cache<T> {\n\n    cache: Map<string, CacheItem<T>>\n    cacheLifetime: number\n    monitoringFrequency: number\n    waiterTimeout: number\n    waiterFrequency: number\n    isMonitoring: boolean\n\n    constructor({ itemLifetime, monitoringFrequency, waiterTimeout, waiterFrequency }: CacheParams) {\n        this.cache = new Map<string, CacheItem<T>>()\n\n        // 10 minute cache lifetime\n        this.cacheLifetime = itemLifetime || 1800000;\n\n        // Frequency with which to monitor the cache for expired items\n        // or refreshing them.\n        this.monitoringFrequency = monitoringFrequency || 60000;\n\n        // The waiter waits for a cache item to become available if it has\n        // been reserved. These settings determine how long to wait\n        // for a waiter to wait, and how often to check the cache item to see if it has\n        // yet been fulfilled.\n        this.waiterTimeout = waiterTimeout || 30000;\n        this.waiterFrequency = waiterFrequency || 100;\n\n        this.isMonitoring = false;\n    }\n\n    runMonitor() {\n        if (this.isMonitoring) {\n            return;\n        }\n        this.isMonitoring = true;\n        window.setTimeout(() => {\n            const newCache = new Map<string, any>();\n            let cacheRenewed = false;\n            Object.keys(this.cache).forEach((id) => {\n                const item = this.cache.get(id);\n                if (!this.isExpired(item)) {\n                    newCache.set(id, item)\n                    cacheRenewed = true\n                }\n            });\n            this.cache = newCache\n            this.isMonitoring = false\n            if (cacheRenewed) {\n                this.runMonitor()\n            }\n        }, this.monitoringFrequency)\n    }\n\n    isExpired(cacheItem: any) {\n        const now = new Date().getTime();\n        const elapsed = now - cacheItem.createdAt;\n        return (elapsed > this.cacheLifetime);\n    }\n\n    isReserved(cacheItem: any) {\n        return cacheItem.reserved;\n    }\n\n    getItem(id: string) {\n        if (this.cache.get(id) === undefined) {\n            return null\n        }\n        const cached = this.cache.get(id)\n        if (this.isExpired(cached)) {\n            this.cache.delete(id)\n            return;\n        }\n        return cached;\n    }\n\n    reserveWaiter(item: CacheItem<T>): Bluebird<CacheItem<T>> {\n        return new Bluebird<CacheItem<T>>((resolve, reject) => {\n            const started = new Date().getTime();\n            const waiting = true;\n\n            const waiter = () => {\n                if (!waiting) {\n                    return;\n                }\n                window.setTimeout(() => {\n                    if (this.cache.has(item.id)) {\n                        // If on a wait-loop cycle we discover that the\n                        // cache item has been deleted, we volunteer\n                        // to attempt to fetch it ourselves.\n                        // The only case now for this is a cancellation\n                        // of the first request to any dynamic service,\n                        // which may cancel the initial service wizard\n                        // call rather than the service call.\n                        return this.reserveAndFetch({\n                            id: item.id,\n                            fetcher: item.fetcher\n                        })\n                            .then(() => {\n                                // resolve(result);\n                                // we resolve with the cache item just\n                                // as if we had waited for it.\n                                resolve(this.cache.get(item.id))\n                            })\n                            .catch((err: Error) => {\n                                reject(err);\n                            });\n                    }\n                    if (!item.reserved) {\n                        resolve(item);\n                    } else {\n                        const elapsed = new Date().getTime() - started;\n                        if (elapsed > this.waiterTimeout) {\n                            this.cache.delete(item.id)\n                            reject(new Error(\n                                'Timed-out waiting for cache item to become available; timeout '\n                                + this.waiterTimeout + ', waited ' + elapsed));\n                        } else {\n                            waiter();\n                        }\n                    }\n                }, this.waiterFrequency);\n            };\n            waiter();\n        });\n    }\n\n    reserveAndFetch({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        // now, reserve it.\n        this.reserveItem(id, fetcher)\n\n        // and then fetch it.\n        const fetchPromise = fetcher()\n            .then((result: any) => {\n                this.setItem(id, result, fetcher)\n                return result\n            })\n            .finally(() => {\n                // If the fetch was cancelled, we need to remove\n                // the reserved item. This should signal any queued waiters\n                // to spawn their own fetch.\n                if (fetchPromise.isCancelled()) {\n                    this.cache.get(id)\n                }\n            });\n        return fetchPromise;\n    }\n\n    getItemWithWait({ id, fetcher }: { id: string, fetcher: () => Bluebird<T> }) {\n        const cached = this.cache.get(id)\n        if (cached) {\n            if (this.isExpired(cached)) {\n                this.cache.delete(id)\n            } else if (this.isReserved(cached)) {\n                return this.reserveWaiter(cached)\n                    .then((cached) => {\n                        return cached.value;\n                    });\n            } else {\n                return Bluebird.resolve(cached.value)\n            }\n        }\n\n        return this.reserveAndFetch({ id, fetcher });\n    }\n\n    reserveItem(id: string, fetcher: () => Bluebird<T>) {\n        this.cache.set(id, {\n            id: id,\n            createdAt: new Date().getTime(),\n            reserved: true,\n            value: null,\n            fetcher: fetcher\n        });\n    }\n\n    setItem(id: string, value: T, fetcher: () => Bluebird<T>) {\n        if (this.cache.has(id)) {\n            const item = this.cache.get(id)\n            if (item && item.reserved) {\n                item.reserved = false\n                item.value = value\n                item.fetcher = fetcher\n            } else {\n                // overwriting? should we allow this?\n                this.cache.set(id, {\n                    id: id,\n                    createdAt: new Date().getTime(),\n                    fetcher: fetcher,\n                    reserved: false,\n                    value: value\n                })\n            }\n        } else {\n            this.cache.set(id, {\n                id: id,\n                createdAt: new Date().getTime(),\n                fetcher: fetcher,\n                reserved: false,\n                value: value\n            })\n        }\n        this.runMonitor();\n    }\n}\nvar moduleCache = new Cache<any>({\n    itemLifetime: 1800000,\n    monitoringFrequency: 60000,\n    waiterTimeout: 30000,\n    waiterFrequency: 100\n})\n\n\n/*\n * arg is:\n * url - service wizard url\n * timeout - request timeout\n * version - service release version or tag\n * auth - auth structure\n *   token - auth token\n *   username - username\n * rpcContext\n */\n\nexport interface DynamicServiceClientParams {\n    token: string\n    url: string\n    version?: string\n    timeout?: number\n    rpcContext?: any\n}\n\nexport class DynamicServiceClient {\n    token: string\n    timeout: number\n    rpcContext: any\n    url: string\n    version: string | null\n\n    static module: string\n\n    constructor({ token, url, version, timeout, rpcContext }: DynamicServiceClientParams) {\n        // Establish an auth object which has properties token and user_id.\n        this.token = token;\n        this.timeout = timeout || 10000;\n        this.rpcContext = rpcContext || null;\n\n        if (!url) {\n            throw new Error('The service discovery url was not provided');\n        }\n        this.url = url;\n\n        this.version = version || null;\n        if (version === 'auto') {\n            this.version = null;\n        }\n    }\n\n    options() {\n        return {\n            timeout: this.timeout,\n            authorization: this.token,\n            rpcContext: this.rpcContext\n        };\n    }\n\n    getModule() {\n        return (<typeof DynamicServiceClient>this.constructor).module\n    }\n\n    moduleId() {\n        let moduleId;\n        if (!this.version) {\n            moduleId = this.getModule() + ':auto';\n        } else {\n            moduleId = this.getModule() + ':' + this.version;\n        }\n        return moduleId;\n    }\n\n    getCached(fetcher: () => Bluebird<any>) {\n        return moduleCache.getItemWithWait({\n            id: this.moduleId(),\n            fetcher: fetcher\n        });\n    }\n\n    // setCached(value: any) {\n    //     moduleCache.setItem(this.moduleId(), value);\n    // }\n\n    lookupModule() {\n        return this.getCached((): Bluebird<any> => {\n            const func = 'get_service_status';\n            const params = [{\n                module_name: this.getModule(),\n                version: this.version\n            }];\n            // NB: pass null for numRets (number of return values) so we get the\n            // full return structure.\n            const client = new ServiceWizardClient({\n                url: this.url,\n                token: this.token\n            })\n\n            return Bluebird.resolve(\n                client.getServiceStatus({\n                    module_name: this.getModule(),\n                    version: this.version\n                })\n            )\n        })\n    }\n\n    callFunc(funcName: string, params: any) {\n        return this.lookupModule()\n            .then((serviceStatus) => {\n                const client = new AuthorizedGenericClient({\n                    module: serviceStatus.module_name,\n                    url: serviceStatus.url,\n                    token: this.token\n                })\n                return Bluebird.resolve(\n                    client.callFunc(funcName, params)\n                )\n            })\n            .catch((err) => {\n                console.error('ERROR: ' + err.name + \" = \" + err.message, err)\n                throw err\n            })\n    }\n}\n","// import { AuthorizedServiceClient, ServiceClientParams, JSONPayload } from './serviceClient'\n\nimport { DynamicServiceClient, DynamicServiceClientParams } from './dynamicServiceClient'\n\nimport { RawObjectInfo, RawWorkspaceInfo, WorkspaceInfo, ObjectInfo, workspaceInfoToObject, objectInfoToObject } from './workspaceUtils'\n\nexport interface NarrativeServiceClientParams extends DynamicServiceClientParams {\n\n}\n\nexport interface ListNarrativesParams {\n    type: string\n}\n\ntype Metadata = Map<string, string>\n\n/* Information about an object, including user provided metadata.\n\n       obj_id objid - the numerical id of the object.\n       obj_name name - the name of the object.\n       type_string type - the type of the object.\n       timestamp save_date - the save date of the object.\n       obj_ver ver - the version of the object.\n       username saved_by - the user that saved or copied the object.\n       ws_id wsid - the workspace containing the object.\n       ws_name workspace - the workspace containing the object.\n       string chsum - the md5 checksum of the object.\n       int size - the size of the object in bytes.\n       usermeta meta - arbitrary user-supplied metadata about\n           the object.\n   */\n\n\n\n\nexport interface ListNarrativesResponseResult {\n    narratives: Array<{\n        ws: RawWorkspaceInfo\n        nar: RawObjectInfo\n    }>\n}\n\nexport interface ServiceResponse<T> {\n    id: string\n    version: string\n    result?: [T] | null\n    error?: any\n}\n\n\n\n// export type ListNarrativesResponse = ServiceResponse<ListNarrativesResponseResult>\n\n\n\nexport class NarrativeServiceClient extends DynamicServiceClient {\n\n    static module: string = 'NarrativeService'\n\n    constructor(params: NarrativeServiceClientParams) {\n        super(params)\n    }\n\n\n    listNarratives(type: string): Promise<ListNarrativesResponseResult> {\n\n        // note usage of unknown below -- Bluebird and native Promise!\n\n        return Promise.resolve(<unknown>this.callFunc('list_narratives', {\n            type: type\n        }) as Promise<ServiceResponse<ListNarrativesResponseResult>>)\n            .then(({ id, version, result, error }) => {\n                // should check id and version, or should call func do that?\n                if (result && result[0]) {\n                    return result[0]\n                    // return result[0].narratives.map((nar) => {\n                    //     return {\n                    //         workspaceInfo: workspaceInfoToObject(nar.ws),\n                    //         objectInfo: objectInfoToObject(nar.nar)\n                    //     }\n                    // })\n                } else {\n                    // TODO: handle error\n                    console.error('Result is missing', id, version, result, error)\n                    throw new Error('Result is missing!')\n                }\n            })\n    }\n\n}","import { MomentCreationData } from \"moment\";\n\nexport type Metadata = {}\n\nexport type RawObjectInfo = [\n    number, // objid - object id\n    string, // name - object name\n    string, // type - object type\n    string, // save_date - iso8601 timestamp when last saved\n    number, // ver - object version\n    string, // saved_by - username who saved it last\n    number, // wsid - workspace id\n    string, // workspace - workspace name,\n    string, // chsum - checksum of the object\n    number, // size - size of the object (bytes)\n    Metadata   // meta - string to string object of stuff\n]\n\nexport type RawWorkspaceInfo = [\n    number, // id - workspace id\n    string, // workspace - workspace name\n    string, // owner - username who owns it\n    string, // moddate - iso8601 timestamp when last modified\n    number, // max_objid - last object id assigned to object in workspace\n    string, // user_permission - permission of user who made reqeust wrt workspace\n    number, // globalread - int bool whether this workspace is shared globally\n    string, // lockstat - status of the workspace lock\n    Metadata // metadata\n]\n\nexport interface WorkspaceInfo {\n    id: number\n    name: string\n    owner: string\n    modifiedAt: Date\n    objectCount: number\n    userPermission: string\n    globalReadPermission: boolean\n    lockStatus: string\n    metadata: Metadata\n}\n\nexport interface ObjectInfo {\n    id: number\n    name: string\n    type: {\n        module: string\n        name: string\n        majorVersion: number\n        minorVersion: number\n        id: string\n    }\n    version: number\n    savedAt: Date\n    savedBy: string\n    workspaceId: number\n    workspaceName: string\n    checksum: string\n    size: number\n    ref: string\n    metadata: Metadata\n}\n\nfunction iso8601ToDate(dateString: string) {\n    const isoRE = /(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)T(\\d\\d):(\\d\\d):(\\d\\d)([\\+\\-])(\\d\\d)(:?[\\:]*)(\\d\\d)/;\n    const dateParts = isoRE.exec(dateString);\n    if (!dateParts) {\n        throw new TypeError('Invalid Date Format for ' + dateString);\n    }\n    // This is why we do this -- JS insists on the colon in the tz offset.\n    const offset = dateParts[7] + dateParts[8] + ':' + dateParts[10];\n    const newDateString = dateParts[1] + '-' + dateParts[2] + '-' + dateParts[3] + 'T' + dateParts[4] + ':' + dateParts[5] + ':' + dateParts[6] + offset;\n    return new Date(newDateString);\n}\n\nexport function workspaceInfoToObject(wsInfo: RawWorkspaceInfo): WorkspaceInfo {\n\n    return {\n        id: wsInfo[0],\n        name: wsInfo[1],\n        owner: wsInfo[2],\n        modifiedAt: iso8601ToDate(wsInfo[3]),\n        objectCount: wsInfo[4],\n        userPermission: wsInfo[5],\n        globalReadPermission: wsInfo[6] === 1 ? true : false,\n        lockStatus: wsInfo[7],\n        metadata: wsInfo[8]\n    }\n}\n\nexport function objectInfoToObject(data: RawObjectInfo): ObjectInfo {\n    const type = data[2].split(/[-.]/);\n\n    return {\n        id: data[0],\n        name: data[1],\n        // type: data[2],\n        type: {\n            id: data[2],\n            module: type[0],\n            name: type[1],\n            majorVersion: parseInt(type[2], 10),\n            minorVersion: parseInt(type[3], 10)\n        },\n        savedAt: iso8601ToDate(data[3]),\n        version: data[4],\n        savedBy: data[5],\n        workspaceId: data[6],\n        workspaceName: data[7],\n        checksum: data[8],\n        size: data[9],\n        metadata: data[10],\n        ref: data[6] + '/' + data[0] + '/' + data[4]\n    }\n}\n","import {\n    Organization, OrganizationUpdate,\n    UIError,\n    UIErrorType,\n    SortDirection,\n    FieldState,\n    EditableOrganization,\n    UserRelationToOrganization,\n    User,\n    Member,\n    GroupRequest,\n    RequestType,\n    RequestStatus,\n    OwnerRelation,\n    UserOrgRelation,\n    AdminRelation,\n    MemberRelation,\n    MembershipRequestPendingRelation,\n    MembershipInvitationPendingRelation,\n    ViewRelation,\n    MemberType,\n    BriefUser,\n    UserRequest,\n    RequestResourceType,\n    WorkspaceRequest,\n    AppRequest,\n    UserInvitation,\n    WorkspaceInvitation,\n    AppInvitation,\n    Narrative,\n    UserWorkspacePermission\n} from '../types';\n// import { organizations } from './data';\nimport * as userProfile from './userProfile'\nimport { GroupsClient, Group } from './groups'\nimport * as groups from './groups'\nimport { NarrativeServiceClient } from './narrativeService';\nimport { WorkspaceInfo, ObjectInfo, workspaceInfoToObject, objectInfoToObject } from './workspaceUtils';\n\nfunction stringToRequestType(type: string): RequestType {\n    switch (type) {\n        case 'Invite':\n            return RequestType.INVITATION\n        case 'Request':\n            return RequestType.REQUEST\n        default:\n            throw new Error('unknown request type: ' + type)\n    }\n}\n\nfunction stringToResourceType(type: string) {\n    switch (type) {\n        case 'user':\n            return RequestResourceType.USER\n        case 'workspace':\n            return RequestResourceType.WORKSPACE\n        case 'catalogmethod':\n            return RequestResourceType.APP\n        default:\n            throw new Error('unknown resource type: ' + type)\n    }\n}\n\nfunction stringToRequestStatus(status: string): RequestStatus {\n    return RequestStatus.OPEN\n}\n\nexport function applyOrgSearch(orgs: Array<Organization>, searchTerms: Array<string>): Array<Organization> {\n    const searchTermsRe = searchTerms.map((term) => {\n        return new RegExp(term, 'i')\n    })\n    const filteredOrgs = orgs.filter((org) => {\n        if (searchTerms.length === 0) {\n            return true;\n        }\n        return searchTermsRe.every((termRe) => {\n            return termRe.test(org.name) ||\n                termRe.test(org.owner.user.username) ||\n                termRe.test(org.owner.user.realname)\n        })\n    })\n\n    return filteredOrgs\n}\n\nfunction applySort(organizations: Array<Organization>, sortBy: string, sortDirection: SortDirection): Array<Organization> {\n    const direction = sortDirection === SortDirection.ASCENDING ? 1 : -1\n    switch (sortBy) {\n        case 'created':\n            return organizations.slice().sort((a, b) => {\n                return direction * (a.createdAt.getTime() - b.createdAt.getTime())\n            })\n        // case 'modifiedAt':\n        //     return organizations.slice().sort((a, b) => {\n        //         return direction * (a.modifiedAt.getTime() - b.modifiedAt.getTime())\n        //     })\n        case 'name':\n            return organizations.slice().sort((a, b) => {\n                return direction * a.name.localeCompare(b.name)\n            })\n        case 'owner':\n            return organizations.slice().sort((a, b) => {\n                return direction * a.owner.user.username.localeCompare(b.owner.user.username)\n            })\n        default:\n            console.warn('unimplemented sort field: ' + sortBy)\n            return organizations;\n    }\n}\n\nfunction applyFilter(organizations: Array<Organization>, filter: string, username: string): Array<Organization> {\n    switch (filter) {\n        case 'all':\n            return organizations\n        case 'memberOf':\n            return organizations.filter((org) => (\n                (org.members.findIndex((member) => (member.user.username === username)) >= 0)\n            ))\n        case 'owned':\n            return organizations.filter((org) => (org.owner.user.username === username))\n        case 'notOwned':\n            return organizations.filter((org) => (org.owner.user.username !== username))\n        case 'pending':\n            return organizations.filter((org) => (\n                org.relation.type === UserRelationToOrganization.MEMBER_INVITATION_PENDING ||\n                org.relation.type === UserRelationToOrganization.MEMBER_REQUEST_PENDING\n            ))\n        case 'groupPending':\n            return organizations.filter((org) => (\n                (org.relation.type === UserRelationToOrganization.ADMIN ||\n                    org.relation.type === UserRelationToOrganization.OWNER) &&\n                (org.adminRequests && org.adminRequests.length > 0)\n            ))\n        default:\n            console.warn('unknown filter : ' + filter)\n            return organizations\n    }\n}\n\nfunction groupPermissionToWorkspacePermission(groupsPermission: string) {\n    switch (groupsPermission) {\n        case 'None':\n            return UserWorkspacePermission.NONE\n        case 'Read':\n            return UserWorkspacePermission.READ\n        case 'Write':\n            return UserWorkspacePermission.WRITE\n        case 'Admin':\n            return UserWorkspacePermission.ADMIN\n        case 'Own':\n            return UserWorkspacePermission.OWN\n        default:\n            throw new Error('Invalid groups user permission: ' + groupsPermission)\n    }\n}\n\nexport interface Query {\n    searchTerms: Array<string>\n    username: string\n    sortBy: string\n    sortDirection: SortDirection\n    filter: string\n}\n\nexport interface QueryResults {\n    organizations: Array<Organization>\n    total: number\n}\n\nexport interface UserQuery {\n    query: string\n    excludedUsers: Array<string>\n}\n\nfunction wait(timeout: number) {\n    return new Promise((resolve) => {\n        window.setTimeout(() => {\n            resolve(true)\n        }, timeout)\n    })\n}\n\n// export function newOrg(state: StoreState, action: actions.AddOrg): StoreState {\n//     const {organizations, auth:{username}} = state;\n//     const org: Organization = {\n//         ...action.newOrg,\n//         createdAt: new Date(),\n//         modifiedAt: new Date(),\n//         owner: username\n//     }\n//     organizations.push(org)\n//     return {...state, organizations}\n// }\n\ninterface ModelParams {\n    token: string\n    username: string\n    groupsServiceURL: string\n    userProfileServiceURL: string\n    workspaceServiceURL: string\n    serviceWizardURL: string\n}\n\nfunction promiseTry<T>(fun: () => Promise<T>) {\n    return new Promise<T>((resolve, reject) => {\n        try {\n            return resolve(fun())\n        } catch (ex) {\n            reject(ex)\n        }\n    })\n}\n\ntype GroupRequestOrBoolean = GroupRequest | boolean\n\nexport class Model {\n    // organizations: Organizations\n    // token: string\n    // groupsServiceURL: string\n    // userProfileServiceURL: string\n    // workspaceServiceURL: string\n    params: ModelParams\n    cachedOrgs: Array<Organization> | null\n\n\n    constructor(params: ModelParams) {\n        // this.organizations = organizations;\n        this.params = params\n        this.cachedOrgs = null\n    }\n\n    getPendingRequests(): Promise<{ requests: Array<groups.Request>, invitations: Array<groups.Request> }> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return Promise.all([\n            groupsClient.getCreatedRequests({\n                includeClosed: false,\n                sortDirection: groups.SortDirection.DESCENDING,\n                startAt: new Date(0)\n            })\n                .then((requests) => {\n                    return requests\n                }),\n            groupsClient.getTargetedRequests({\n                includeClosed: false,\n                sortDirection: groups.SortDirection.DESCENDING,\n                startAt: new Date(0)\n            })\n                .then((requests) => {\n                    return requests\n                })\n        ])\n            .then(([createdRequests, targetedRequests]) => {\n                // here we just want to know ... does this user have any\n                // pending requests with this group!\n                return {\n                    requests: createdRequests,\n                    invitations: targetedRequests\n                }\n            })\n    }\n\n    groupRequestToOrgRequest(request: groups.Request): Promise<UserRequest | UserInvitation | WorkspaceRequest | WorkspaceInvitation | AppRequest | AppInvitation> {\n        const userProfileClient = new userProfile.UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n\n        const usernames = [request.requester]\n        if (request.resourcetype === 'user') {\n            usernames.push(request.resource)\n        }\n\n        // TODO: make different types of requests based on the resource type...\n        switch (request.resourcetype) {\n            case 'user':\n        }\n\n        return userProfileClient.getUserProfiles(usernames)\n            .then((profiles) => {\n\n                const requestType = stringToRequestType(request.type);\n                const resourceType = stringToResourceType(request.resourcetype)\n                const requestStatus = stringToRequestStatus(request.status)\n\n                switch (resourceType) {\n                    case RequestResourceType.USER:\n                        if (requestType === RequestType.REQUEST) {\n                            return {\n                                id: request.id,\n                                groupId: request.groupid,\n                                resourceType: resourceType,\n                                requester: this.profileToUser(profiles[0]),\n                                type: requestType,\n                                status: requestStatus,\n                                user: this.profileToUser(profiles[1]),\n                                createdAt: new Date(request.createdate),\n                                expireAt: new Date(request.expiredate),\n                                modifiedAt: new Date(request.moddate)\n                            } as UserRequest\n                        } else {\n                            return {\n                                id: request.id,\n                                groupId: request.groupid,\n                                resourceType: resourceType,\n                                requester: this.profileToUser(profiles[0]),\n                                type: requestType,\n                                status: requestStatus,\n                                user: this.profileToUser(profiles[1]),\n                                createdAt: new Date(request.createdate),\n                                expireAt: new Date(request.expiredate),\n                                modifiedAt: new Date(request.moddate)\n                            } as UserInvitation\n                        }\n\n                    case RequestResourceType.WORKSPACE:\n                        if (requestType === RequestType.REQUEST) {\n                            return {\n                                id: request.id,\n                                groupId: request.groupid,\n                                resourceType: resourceType,\n                                requester: this.profileToUser(profiles[0]),\n                                type: requestType,\n                                status: requestStatus,\n                                workspace: request.resource,\n                                createdAt: new Date(request.createdate),\n                                expireAt: new Date(request.expiredate),\n                                modifiedAt: new Date(request.moddate)\n                            } as WorkspaceRequest\n                        } else {\n                            return {\n                                id: request.id,\n                                groupId: request.groupid,\n                                resourceType: resourceType,\n                                requester: this.profileToUser(profiles[0]),\n                                type: requestType,\n                                status: requestStatus,\n                                workspace: request.resource,\n                                createdAt: new Date(request.createdate),\n                                expireAt: new Date(request.expiredate),\n                                modifiedAt: new Date(request.moddate)\n                            } as WorkspaceInvitation\n                        }\n                    case RequestResourceType.APP:\n                        if (requestType === RequestType.REQUEST) {\n                            return {\n                                id: request.id,\n                                groupId: request.groupid,\n                                resourceType: resourceType,\n                                requester: this.profileToUser(profiles[0]),\n                                type: requestType,\n                                status: requestStatus,\n                                app: request.resource,\n                                createdAt: new Date(request.createdate),\n                                expireAt: new Date(request.expiredate),\n                                modifiedAt: new Date(request.moddate)\n                            } as AppRequest\n                        } else {\n                            return {\n                                id: request.id,\n                                groupId: request.groupid,\n                                resourceType: resourceType,\n                                requester: this.profileToUser(profiles[0]),\n                                type: requestType,\n                                status: requestStatus,\n                                app: request.resource,\n                                createdAt: new Date(request.createdate),\n                                expireAt: new Date(request.expiredate),\n                                modifiedAt: new Date(request.moddate)\n                            } as AppInvitation\n                        }\n                    default:\n                        throw new Error('resource type not handled yet: ' + request.resourcetype)\n                }\n\n\n            })\n    }\n\n\n    getPendingOrganizationRequests(groupId: string): Promise<Array<GroupRequest>> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return Promise.all([\n            groupsClient.getGroupRequests(groupId, {\n                includeClosed: false,\n                sortDirection: groups.SortDirection.DESCENDING,\n                startAt: new Date(0)\n            }),\n            groupsClient.getCreatedRequests({\n                includeClosed: false,\n                sortDirection: groups.SortDirection.DESCENDING,\n                startAt: new Date(0)\n            })\n        ])\n\n            // return groupsClient.getGroupRequests(groupId, {\n            //     includeClosed: false,\n            //     sortDirection: groups.SortDirection.DESCENDING,\n            //     startAt: new Date(0)\n            // })\n            .then(([groupRequests, adminRequests]) => {\n\n                const groupAdminRequests = adminRequests.filter((request) => {\n                    return (request.groupid === groupId)\n                })\n\n                return Promise.all(groupRequests.concat(groupAdminRequests).map((request) => {\n                    return this.groupRequestToOrgRequest(request)\n                }))\n            })\n    }\n\n    membersAndAdminsToMembers(memberUsernames: Array<string>, adminUsernames: Array<string>, userProfileMap: Map<string, userProfile.UserProfile>): Array<Member> {\n        return memberUsernames.map((member) => {\n            const p = userProfileMap.get(member)\n            if (typeof p === 'undefined') {\n                throw new Error('Member without profile!')\n            }\n            return {\n                type: MemberType.MEMBER,\n                user: this.profileToUser(p)\n            }\n        }).concat(adminUsernames.map((admin) => {\n            const p = userProfileMap.get(admin)\n            if (typeof p === 'undefined') {\n                throw new Error('Admin without profile')\n            }\n            return {\n                type: MemberType.ADMIN,\n                user: this.profileToUser(p)\n            }\n        }))\n            .sort((a, b) => {\n                return a.user.realname.localeCompare(b.user.realname);\n            })\n\n        // return members\n    }\n\n    getGroupMembers(group: Group, userProfileMap: Map<string, userProfile.UserProfile>): Array<Member> {\n        return group.members.map((member) => {\n            const p = userProfileMap.get(member)\n            if (typeof p === 'undefined') {\n                throw new Error('Member without profile!')\n            }\n            return {\n                type: MemberType.MEMBER,\n                user: this.profileToUser(p)\n            }\n        }).concat(group.admins.map((admin) => {\n            const p = userProfileMap.get(admin)\n            if (typeof p === 'undefined') {\n                throw new Error('Admin without profile')\n            }\n            return {\n                type: MemberType.ADMIN,\n                user: this.profileToUser(p)\n            }\n        }))\n            // .concat([\n            //     {\n            //         type: MemberType.OWNER,\n            //         user: this.profileToUser(userProfileMap.get(group.owner)!)\n            //     }\n            // ])\n            .sort((a, b) => {\n                return a.user.realname.localeCompare(b.user.realname);\n            })\n\n        // return members\n    }\n\n    groupToOrg(group: Group, username: string): Promise<Organization> {\n        const { id, name, owner, description, createdate, moddate } = group\n        let relation: UserRelationToOrganization\n        // TODO: when we have access to members, admins, and group publication status, we can \n        // flesh out all user relations.\n        if (username === group.owner) {\n            relation = UserRelationToOrganization.OWNER\n        } else {\n            relation = UserRelationToOrganization.VIEW\n        }\n        const userProfileClient = new userProfile.UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n        let allUsers: Array<string> = []\n        if (group.members) {\n            allUsers = group.members.slice()\n        }\n        if (group.admins) {\n            allUsers = allUsers.concat(group.admins)\n        }\n        allUsers.push(group.owner)\n        return Promise.all([\n            ((): Promise<Map<string, GroupRequest[]>> => {\n                if (username === group.owner || group.admins.indexOf(username) >= 0) {\n                    return this.getPendingAdminRequests([group.id])\n                } else {\n                    return Promise.resolve(new Map<string, GroupRequest[]>())\n                }\n            })(),\n            this.getPendingRequests()\n        ])\n            // return this.getPendingRequests()\n            .then(([pendingAdminRequests, { requests, invitations }]) => {\n\n                // pending join requests\n                const pendingRequests = new Map<string, groups.Request>()\n                requests.forEach((req) => {\n                    if (req.type === 'Request' && req.resourcetype === 'user' && req.requester === username) {\n                        pendingRequests.set(req.groupid, req)\n                    }\n                })\n\n                // pending invitations to join\n                const pendingInvites = new Map<string, groups.Request>()\n                invitations.forEach((req) => {\n                    if (req.type === 'Invite' && req.resourcetype === 'user' && req.resource === username) {\n                        pendingInvites.set(req.groupid, req)\n                    }\n                })\n\n                return userProfileClient.getUserProfiles(allUsers)\n                    .then((userProfiles) => {\n                        const userProfileMap = userProfiles.reduce((map, profile) => {\n                            map.set(profile.user.username, profile)\n                            return map\n                        }, new Map<string, userProfile.UserProfile>())\n\n                        const ownerProfile = userProfileMap.get(group.owner)\n                        if (!ownerProfile) {\n                            throw new Error('No profile for owner!')\n                        }\n                        // TODO: if members really is always an array, we can skip this defaulting behavior\n                        // const memberUsernames = group.members || []\n                        // const adminUsernames = group.admins || []\n\n                        // TODO: the user profile map needs to be cached, etc.\n                        // const members = this.membersAndAdminsToMembers(memberUsernames, adminUsernames, userProfileMap).sort((a, b) => {\n                        //     return a.user.realname.localeCompare(b.user.realname);\n                        // })\n\n                        const members = this.getGroupMembers(group, userProfileMap).sort((a, b) => {\n                            return a.user.realname.localeCompare(b.user.realname);\n                        })\n\n                        let relation: UserOrgRelation\n                        // TODO: when we have access to members, admins, and group publication status, we can \n                        // flesh out all user relations.\n                        if (this.params.username === group.owner) {\n                            relation = {\n                                type: UserRelationToOrganization.OWNER\n                            } as OwnerRelation\n                        } else if (group.admins.indexOf(this.params.username) >= 0) {\n                            relation = {\n                                type: UserRelationToOrganization.ADMIN\n                            } as AdminRelation\n                        } else if (group.members.indexOf(this.params.username) >= 0) {\n                            relation = {\n                                type: UserRelationToOrganization.MEMBER\n                            } as MemberRelation\n                        } else if (pendingRequests.has(group.id)) {\n                            relation = {\n                                type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                                requestId: pendingRequests.get(group.id)!.id\n                            } as MembershipRequestPendingRelation\n                        } else if (pendingInvites.has(group.id)) {\n                            relation = {\n                                type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                                requestId: pendingInvites.get(group.id)!.id\n                            } as MembershipInvitationPendingRelation\n                        } else {\n                            relation = {\n                                type: UserRelationToOrganization.VIEW\n                            } as ViewRelation\n                        }\n\n                        // Get Narratives\n                        const narratives = group.resources.workspace.map((workspace) => {\n                            return {\n                                title: workspace.narrname,\n                                workspaceId: parseInt(workspace.rid, 10),\n                                permission: groupPermissionToWorkspacePermission(workspace.perm),\n                                isPublic: workspace.public ? true : false\n                            }\n                        })\n\n                        const apps = group.resources.catalogmethod.map((app) => {\n                            return {\n                                id: app.rid\n                            }\n                        })\n\n                        // Get Apps\n\n                        // perhaps get the pending admin requests\n                        return promiseTry<Organization>((): Promise<Organization> => {\n                            if (relation.type === UserRelationToOrganization.ADMIN ||\n                                relation.type === UserRelationToOrganization.OWNER) {\n                                return this.getPendingOrganizationRequests(group.id)\n                                    .then((requests) => {\n                                        return {\n                                            id: group.id,\n                                            name: group.name,\n                                            gravatarHash: group.custom ? (group.custom.gravatarhash || null) : null,\n                                            description: group.description,\n                                            createdAt: new Date(group.createdate),\n                                            modifiedAt: new Date(group.moddate),\n                                            owner: {\n                                                type: MemberType.OWNER,\n                                                user: this.profileToUser(ownerProfile)\n                                            },\n                                            relation: relation,\n                                            members: members,\n                                            // admins: admins,\n                                            adminRequests: (pendingAdminRequests.has(id) ? pendingAdminRequests.get(id)! : []),\n                                            narratives,\n                                            apps\n                                        }\n                                    })\n                            } else {\n                                return Promise.resolve({\n                                    id: group.id,\n                                    name: group.name,\n                                    gravatarHash: group.custom ? (group.custom.gravatarhash || null) : null,\n                                    description: group.description,\n                                    createdAt: new Date(group.createdate),\n                                    modifiedAt: new Date(group.moddate),\n                                    owner: {\n                                        type: MemberType.OWNER,\n                                        user: this.profileToUser(ownerProfile)\n                                    },\n                                    relation: relation,\n                                    members: members,\n                                    // admins: admins,\n                                    adminRequests: [],\n                                    narratives,\n                                    apps\n                                })\n                            }\n                        })\n\n                    })\n            })\n    }\n\n    getPendingAdminRequests(groupIds: Array<string>): Promise<Map<string, Array<GroupRequest>>> {\n\n        return Promise.all(groupIds.map((id) => {\n            return this.getPendingOrganizationRequests(id)\n                .then((requests) => {\n                    return {\n                        groupId: id,\n                        requests: requests\n                    }\n                })\n        }))\n            .then((allRequests) => {\n                const pendingRequests = new Map<string, Array<GroupRequest>>()\n                allRequests.forEach(({ groupId, requests }) => {\n                    pendingRequests.set(groupId, requests)\n                })\n                return pendingRequests\n            })\n    }\n\n    groupsToOrgs(groups: Array<Group>, username: string): Promise<Array<Organization>> {\n        const userProfileClient = new userProfile.UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n\n        const allUsers = groups.reduce((allUsers, group) => {\n            allUsers.set(group.owner, true)\n            group.members.forEach((member) => allUsers.set(member, true))\n            group.admins.forEach((admin) => allUsers.set(admin, true))\n            return allUsers;\n        }, new Map<string, boolean>()).keys()\n\n        // Note that here we are dealing with raw groups so we check whether the user is an\n        // admin by hand.\n        const adminGroupIds = groups\n            .filter(({ owner, admins }) => (owner === username || admins.indexOf(username) >= 0))\n            .map(({ id }) => id)\n\n        return Promise.all([\n            userProfileClient.getUserProfiles(Array.from(allUsers)),\n            this.getPendingRequests(),\n            this.getPendingAdminRequests(adminGroupIds)\n        ])\n            .then(([profiles, { requests, invitations }, pendingAdminRequests]) => {\n                const profileMap = profiles.reduce((profileMap, profile) => {\n                    profileMap.set(profile.user.username, profile)\n                    return profileMap\n                }, new Map<string, userProfile.UserProfile>())\n\n                // now make a per-group map out of this...\n                const pendingRequests = new Map<string, groups.Request>()\n                requests.forEach((req) => {\n                    if (req.type === 'Request' && req.resourcetype === 'user' && req.requester === username) {\n                        pendingRequests.set(req.groupid, req)\n                    }\n                })\n\n                const pendingInvites = new Map<string, groups.Request>()\n                invitations.forEach((req) => {\n                    if (req.type === 'Invite' && req.resourcetype === 'user' && req.resource === username) {\n                        pendingInvites.set(req.groupid, req)\n                    }\n                })\n\n                return Promise.all(groups.map((group) => {\n                    const { id, name, description, createdate, moddate, owner, members, admins, custom: { gravatarhash } } = group\n                    let relation: UserOrgRelation\n                    // TODO: when we have access to members, admins, and group publication status, we can \n                    // flesh out all user relations.\n                    const orgMembers: Array<Member> = this.membersAndAdminsToMembers(members, admins, profileMap)\n\n                    if (this.params.username === group.owner) {\n                        relation = {\n                            type: UserRelationToOrganization.OWNER\n                        } as OwnerRelation\n                    } else if (group.admins.indexOf(this.params.username) >= 0) {\n                        relation = {\n                            type: UserRelationToOrganization.ADMIN\n                        } as AdminRelation\n                    } else if (group.members.indexOf(this.params.username) >= 0) {\n                        relation = {\n                            type: UserRelationToOrganization.MEMBER\n                        } as MemberRelation\n                    } else if (pendingRequests.has(group.id)) {\n                        relation = {\n                            type: UserRelationToOrganization.MEMBER_REQUEST_PENDING,\n                            requestId: pendingRequests.get(group.id)!.id\n                        } as MembershipRequestPendingRelation\n                    } else if (pendingInvites.has(group.id)) {\n                        relation = {\n                            type: UserRelationToOrganization.MEMBER_INVITATION_PENDING,\n                            requestId: pendingInvites.get(group.id)!.id\n                        } as MembershipInvitationPendingRelation\n                    } else {\n                        relation = {\n                            type: UserRelationToOrganization.VIEW\n                        } as ViewRelation\n                    }\n\n                    // Get Narratives\n                    const narratives = group.resources.workspace.map((workspace) => {\n                        return {\n                            title: workspace.narrname,\n                            workspaceId: parseInt(workspace.rid, 10),\n                            permission: groupPermissionToWorkspacePermission(workspace.perm),\n                            isPublic: workspace.public ? true : false\n                        }\n                    })\n\n                    const apps = group.resources.catalogmethod.map((app) => {\n                        return {\n                            id: app.rid\n                        }\n                    })\n\n                    return {\n                        id, name, description,\n                        gravatarHash: gravatarhash || null,\n                        owner: {\n                            type: MemberType.OWNER,\n                            user: this.profileToUser(profileMap.get(group.owner)!)\n                        },\n                        createdAt: new Date(createdate),\n                        modifiedAt: new Date(moddate),\n                        relation: relation,\n                        members: orgMembers,\n                        // admins: admins.map((username) => this.profileToUser(profileMap.get(username)!)),\n                        adminRequests: (pendingAdminRequests.has(id) ? pendingAdminRequests.get(id)! : []),\n                        narratives,\n                        apps\n                    }\n                }))\n            })\n    }\n\n    getOrgs(username: string): Promise<Array<Organization>> {\n        if (this.cachedOrgs) {\n            return Promise.resolve(this.cachedOrgs)\n        }\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.getGroups()\n            .then((groups) => {\n                return this.groupsToOrgs(groups, username)\n            })\n    }\n\n    queryOrgs(query: Query): Promise<QueryResults> {\n\n        let start = new Date().getTime()\n        return this.getOrgs(query.username)\n            .then((orgs) => {\n                const filtered = applyFilter(orgs, query.filter, query.username)\n                const searched = applyOrgSearch(filtered, query.searchTerms)\n                const sorted = applySort(searched, query.sortBy, query.sortDirection)\n\n                return {\n                    organizations: sorted,\n                    total: orgs.length\n                }\n            })\n    }\n\n    profileToUser(profile: userProfile.UserProfile): User {\n        let jobTitle\n        if (!profile.profile.userdata) {\n            return {\n                username: profile.user.username,\n                realname: profile.user.realname,\n                city: null,\n                state: null,\n                country: null,\n                title: null,\n                organization: null,\n                avatarOption: null,\n                gravatarHash: null,\n                gravatarDefault: null\n            }\n        }\n        if (profile.profile.userdata.jobTitle === 'Other') {\n            jobTitle = profile.profile.userdata.jobTitleOther\n        } else {\n            jobTitle = profile.profile.userdata.jobTitle\n        }\n\n        return {\n            username: profile.user.username,\n            realname: profile.user.realname,\n            city: profile.profile.userdata.city,\n            state: profile.profile.userdata.state,\n            country: profile.profile.userdata.country,\n            title: jobTitle,\n            organization: profile.profile.userdata.organization,\n            avatarOption: profile.profile.userdata.avatarOption,\n            gravatarHash: profile.profile.synced.gravatarHash,\n            gravatarDefault: profile.profile.userdata.gravatarDefault\n        }\n    }\n\n    getOrg(id: string): Promise<Organization> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.getGroupById(id)\n            .then((group) => {\n                return this.groupToOrg(group, this.params.username)\n            })\n    }\n\n    getGroup(id: string): Promise<Group> {\n        if (id.length === 0) {\n            return Promise.reject(new Error('Group id may not be an empty string'))\n        }\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.getGroupById(id)\n            .then((group) => {\n                return group\n            })\n    }\n\n    groupExists(id: string): Promise<boolean> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n        return groupsClient.groupExists(id)\n            .then(({ exists }) => {\n                return exists\n            })\n    }\n\n    addOrg(newOrg: EditableOrganization, username: string): Promise<Organization> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n        if ((newOrg.id.error && newOrg.id.error.type === UIErrorType.ERROR) ||\n            (newOrg.name.error && newOrg.name.error.type === UIErrorType.ERROR) ||\n            (newOrg.gravatarHash.error && newOrg.gravatarHash.error.type === UIErrorType.ERROR) ||\n            (newOrg.description.error && newOrg.description.error.type === UIErrorType.ERROR)) {\n            return Promise.reject(new Error('One or more fields are invalid'))\n        }\n\n        return groupsClient.createGroup({\n            id: newOrg.id.value,\n            name: newOrg.name.value,\n            gravatarhash: newOrg.gravatarHash.value,\n            description: newOrg.description.value,\n            type: 'Organization'\n        })\n            .then((group) => {\n                return this.groupToOrg(group, username)\n            })\n    }\n\n    // TODO this is fake until update is implemented on the back end\n    updateOrg(id: string, orgUpdate: OrganizationUpdate): Promise<void> {\n\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        // do record-level validation\n\n\n        return groupsClient.updateGroup(id, {\n            name: orgUpdate.name,\n            gravatarhash: orgUpdate.gravatarHash,\n            description: orgUpdate.description\n        })\n    }\n\n    requestMembershipToGroup(id: string): Promise<GroupRequest> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.requestMembership({\n            groupId: id\n        })\n            .then((request: groups.Request) => {\n                return this.groupRequestToOrgRequest(request)\n            })\n            .catch((err) => {\n                throw err;\n            })\n    }\n\n    addOrRequestNarrativeToGroup(groupId: string, narrative: Narrative): Promise<GroupRequest | boolean> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.addOrRequestNarrative({\n            groupId: groupId,\n            workspaceId: narrative.workspaceId\n        })\n            .then((request): Promise<GroupRequest | boolean> => {\n                if (request.complete === true) {\n                    return Promise.resolve(true)\n                } else {\n                    return this.groupRequestToOrgRequest(request)\n                }\n\n            })\n            .catch((err: Error) => {\n                throw err;\n            })\n    }\n\n    removeNarrativeFromGroup(groupId: string, workspaceId: number): Promise<void> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.deleteResource(\n            groupId,\n            'workspace',\n            String(workspaceId)\n        )\n    }\n\n    cancelRequest(requestId: string): Promise<GroupRequest> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.cancelRequest({\n            requestId\n        })\n            .then((request: groups.Request) => {\n                return this.groupRequestToOrgRequest(request)\n            })\n    }\n\n    acceptRequest(requestId: string): Promise<GroupRequest> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.acceptRequest({\n            requestId\n        })\n            .then((request: groups.Request) => {\n                return this.groupRequestToOrgRequest(request)\n            })\n    }\n\n    denyRequest(requestId: string): Promise<GroupRequest> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.denyRequest({\n            requestId\n        })\n            .then((request: groups.Request) => {\n                return this.groupRequestToOrgRequest(request)\n            })\n    }\n\n    acceptJoinInvitation(requestId: string): Promise<GroupRequest> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.acceptRequest({\n            requestId\n        })\n            .then((request: groups.Request) => {\n                return this.groupRequestToOrgRequest(request)\n            })\n    }\n\n    rejectJoinInvitation(requestId: string): Promise<GroupRequest> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.denyRequest({\n            requestId\n        })\n            .then((request: groups.Request) => {\n                return this.groupRequestToOrgRequest(request)\n            })\n    }\n\n    memberToAdmin(groupId: string, member: string): Promise<void> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.memberToAdmin({\n            groupId,\n            member\n        })\n    }\n\n    adminToMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.adminToMember({\n            groupId,\n            member\n        })\n    }\n    removeMember(groupId: string, member: string): Promise<void> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.removeMember({\n            groupId,\n            member\n        })\n    }\n\n    requestJoinGroup(groupId: string, username: string): Promise<GroupRequest> {\n        const groupsClient = new GroupsClient({\n            url: this.params.groupsServiceURL,\n            token: this.params.token\n        })\n\n        return groupsClient.requestJoinGroup({\n            groupId,\n            username\n        })\n            .then((request) => {\n                return this.groupRequestToOrgRequest(request)\n            })\n    }\n\n    // Validation \n\n    validateOrgId(id: string): [string, UIError] {\n        return Validation.validateOrgId(id);\n    }\n\n    validateOrgName(name: string): [string, UIError] {\n        return Validation.validateOrgName(name)\n    }\n\n    validateOrgDescription(description: string): [string, UIError] {\n        return Validation.validateOrgDescription(description);\n    }\n\n    // Users\n\n\n\n    searchUsers(query: UserQuery): Promise<Array<BriefUser>> {\n        const userProfileClient = new userProfile.UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n\n        return userProfileClient.searchUsers(query.query)\n            .then((users) => {\n                return users\n                    .filter(({ username }) => {\n                        return (query.excludedUsers.indexOf(username) === -1)\n                    })\n                    .map(({ username, realname }) => {\n                        return {\n                            username, realname\n                        }\n                    })\n\n            })\n    }\n\n    getUser(username: string): Promise<User> {\n        const userProfileClient = new userProfile.UserProfileClient({\n            url: this.params.userProfileServiceURL,\n            token: this.params.token\n        })\n\n        return userProfileClient.getUserProfile(username)\n            .then((userProfile) => {\n                return this.profileToUser(userProfile)\n            })\n    }\n\n    // Narratives\n\n    getOwnNarratives(organizationId: string): Promise<Array<Narrative>> {\n        const narrativeServiceClient = new NarrativeServiceClient({\n            url: this.params.serviceWizardURL,\n            token: this.params.token,\n            timeout: 10000,\n        })\n\n        return Promise.all([\n            narrativeServiceClient.listNarratives('mine'),\n            this.getOrg(organizationId)\n        ])\n            .then(([narrativesResult, organization]) => {\n                const workspacesInOrg = organization.narratives.map((narrative) => {\n                    return narrative.workspaceId\n                })\n                return narrativesResult.narratives\n                    .map((nar) => {\n                        return {\n                            workspaceInfo: workspaceInfoToObject(nar.ws) as NarrativeWorkspaceInfo,\n                            objectInfo: objectInfoToObject(nar.nar)\n                        }\n                    })\n                    .filter((nar) => {\n                        return (nar.workspaceInfo.metadata.is_temporary === 'false')\n                    })\n                    .map((narrative) => {\n                        return {\n                            workspaceId: narrative.workspaceInfo.id,\n                            objectId: narrative.objectInfo.id,\n                            title: narrative.workspaceInfo.metadata.narrative_nice_name,\n                            inOrganization: (workspacesInOrg.indexOf(narrative.workspaceInfo.id) !== -1),\n                            modifiedAt: narrative.workspaceInfo.modifiedAt\n                        }\n                    })\n                    .sort((a, b) => {\n                        return (a.title.localeCompare(b.title))\n                    })\n            })\n    }\n}\n\nexport interface NarrativeWorkspaceInfo extends WorkspaceInfo {\n    metadata: {\n        narrative_nice_name: string\n        version: string\n        is_temporary: string\n    }\n}\nexport interface GetOwnNarrativesResult {\n    workspaceInfo: WorkspaceInfo\n    objectInfo: ObjectInfo\n}\n\nexport class Validation {\n    static validateOrgId(id: string): [string, UIError] {\n        // May not be empty\n        if (id.length === 0) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not be empty'\n                }]\n        }\n        // No spaces\n        if (id.match(/\\s/)) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not contain a space'\n                }]\n        }\n        // May not exceed maximum size\n        // todo: what is the real limit?\n        if (id.length > 100) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may not be longer than 100 characters'\n                }]\n        }\n\n        // May not contain non-alphanumeric and underscore\n        const alphaRe = /^[a-zA-Z0-9_]+$/\n        if (!id.match(alphaRe)) {\n            return [\n                id, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization id may only contain alphanumeric (a-z, A-Z, 0-9) and underscore (_)'\n                }\n            ]\n        }\n\n        return [id, {\n            type: UIErrorType.NONE\n        }]\n    }\n\n    static validateOrgName(name: string): [string, UIError] {\n        if (name.length === 0) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be empty'\n                }]\n        }\n        if (name.length > 256) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be longer than 256 characters'\n                }]\n        }\n        return [\n            name, {\n                type: UIErrorType.NONE\n            }]\n    }\n\n    static validateOrgGravatarHash(gravatarHash: string): [string, UIError] {\n        if (gravatarHash.length === 0) {\n            return [\n                gravatarHash, {\n                    type: UIErrorType.NONE\n                }]\n        }\n        if (gravatarHash.length > 32) {\n            return [\n                gravatarHash, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization gravatar hash may not be longer than 32 characters'\n                }]\n        }\n        return [\n            gravatarHash, {\n                type: UIErrorType.NONE\n            }]\n    }\n\n    static validateOrgDescription(name: string): [string, UIError] {\n        if (name.length === 0) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization description may not be empty'\n                }]\n        }\n        // TODO: Is there really a limit?\n        if (name.length > 4096) {\n            return [\n                name, {\n                    type: UIErrorType.ERROR,\n                    message: 'Organization name may not be longer than 4,096 characters'\n                }]\n        }\n        return [\n            name, {\n                type: UIErrorType.NONE\n            }]\n    }\n}\n\nexport class StaticData {\n    static makeEmptyEditableOrganization(): EditableOrganization {\n        return {\n            id: {\n                value: '',\n                status: FieldState.NONE,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            },\n            name: {\n                value: '',\n                status: FieldState.NONE,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            },\n            gravatarHash: {\n                value: '',\n                status: FieldState.NONE,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            },\n            description: {\n                value: '',\n                status: FieldState.NONE,\n                error: {\n                    type: UIErrorType.NONE\n                }\n            }\n        }\n    }\n\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState, Organization,\n    AppError, SortDirection, UIError, UIErrorType, Narrative, NarrativeResource\n} from '../../types'\nimport { Model } from '../../data/model'\n\n\n// Action Types\n\nexport interface ViewOrgStart extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH_START\n}\n\nexport interface ViewOrgStop extends Action {\n    type: ActionFlag.VIEW_ORG_STOP\n}\n\nexport interface ViewOrgSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH_SUCCESS,\n    organization: Organization\n}\n\nexport interface ViewOrgError extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH_ERROR,\n    error: AppError\n}\n\nexport interface ViewOrgFetch extends Action {\n    type: ActionFlag.VIEW_ORG_FETCH,\n    id: string\n}\n\n// Join Requests\n\nexport interface ViewOrgJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST,\n    requestId: string\n}\n\nexport interface ViewOrgJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR,\n    error: UIError\n}\n\n// Join Request cancellation\n\nexport interface ViewOrgCancelJoinRequest extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST\n}\n\nexport interface ViewOrgCancelJoinRequestStart extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n}\n\nexport interface ViewOrgCancelJoinRequestSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n}\n\nexport interface ViewOrgCancelJoinRequestError extends Action {\n    type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n    error: UIError\n}\n\n// Join Invitation Acceptance\n\nexport interface AcceptJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION\n}\n\nexport interface AcceptJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n}\n\nexport interface AcceptJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface AcceptJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n// Join Invitation Denial\n\nexport interface RejectJoinInvitation extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION\n}\n\nexport interface RejectJoinInvitationStart extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n}\n\nexport interface RejectJoinInvitationSuccess extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n}\n\nexport interface RejectJoinInvitationError extends Action {\n    type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n// Delete Narrative\n\nexport interface RemoveNarrative {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE\n}\n\nexport interface RemoveNarrativeStart {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n}\n\nexport interface RemoveNarrativeSuccess {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n    narrative: NarrativeResource\n}\n\nexport interface RemoveNarrativeError {\n    type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n    error: AppError\n}\n\n// Generators\n\nexport function removeNarrativeStart(): RemoveNarrativeStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_START\n    }\n}\n\nexport function removeNarrativeSuccess(narrative: NarrativeResource): RemoveNarrativeSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,\n        narrative: narrative\n    }\n}\n\nexport function removeNarrativeError(error: AppError): RemoveNarrativeError {\n    return {\n        type: ActionFlag.VIEW_ORG_REMOVE_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\n// THunk\n\nexport function removeNarrative(narrative: NarrativeResource) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeNarrativeStart())\n\n        // TODO: need to restructure this view -- this is crazy\n\n        const state = getState()\n        if (!state.viewOrg.organization) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            viewOrg: {\n                organization\n            }\n        } = state\n\n\n        if (!organization) {\n            dispatch(removeNarrativeError({\n                code: 'bad state',\n                message: 'View orgs does not have an org'\n            }))\n            return\n        }\n\n        const groupId = organization.id\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.removeNarrativeFromGroup(groupId, narrative.workspaceId)\n            .then((org) => {\n                dispatch(removeNarrativeSuccess(narrative))\n            })\n            .catch((err) => {\n                dispatch(removeNarrativeError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n\n// Generators\n\nexport function viewOrgStart() {\n    return {\n        type: ActionFlag.VIEW_ORG_FETCH_START\n    }\n}\n\nexport function viewOrgStop(): ViewOrgStop {\n    return {\n        type: ActionFlag.VIEW_ORG_STOP\n    }\n}\n\nexport function viewOrgSuccess(org: Organization): ViewOrgSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_FETCH_SUCCESS,\n        organization: org\n    }\n}\n\n\nexport function viewOrgError(error: AppError): ViewOrgError {\n    return {\n        type: ActionFlag.VIEW_ORG_FETCH_ERROR,\n        error: error\n    }\n}\n\n// Join requests\n\nexport function viewOrgJoinRequestStart(): ViewOrgJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgJoinRequestSuccess(): ViewOrgJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgJoinRequestError(error: UIError): ViewOrgJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Join Request Cancellation\n\nexport function viewOrgCancelJoinRequestStart(): ViewOrgCancelJoinRequestStart {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_START\n    }\n}\n\nexport function viewOrgCancelJoinRequestSuccess(): ViewOrgCancelJoinRequestSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS\n    }\n}\n\nexport function viewOrgCancelJoinRequestError(error: UIError): ViewOrgCancelJoinRequestError {\n    return {\n        type: ActionFlag.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Invitation Acceptance\n\nexport function acceptJoinInvitationStart(): AcceptJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_START\n    }\n}\n\nexport function acceptJoinInvitationSuccess(): AcceptJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function acceptJoinInvitationError(error: AppError): AcceptJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n// Invitation Rejection \n\nexport function rejectJoinInvitationStart(): RejectJoinInvitationStart {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_START\n    }\n}\n\nexport function rejectJoinInvitationSuccess(): RejectJoinInvitationSuccess {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS\n    }\n}\n\nexport function rejectJoinInvitationError(error: AppError): RejectJoinInvitationError {\n    return {\n        type: ActionFlag.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n\n// Join invitation acceptance\n\n// TODO\n\n// Thunks\n\nexport function viewOrgFetch(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewOrgStart())\n\n        const { auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.getOrg(id)\n            .then((org) => {\n                dispatch(viewOrgSuccess(org))\n            })\n            .catch((err) => {\n                dispatch(viewOrgError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function viewOrgJoinRequest() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        //TODO: could do a start here...\n\n        const { auth: { authorization: { token, username } },\n            app: { config },\n            viewOrg: { organization } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (typeof organization === 'undefined') {\n            dispatch(viewOrgJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Org not currently defined'\n            }))\n            return\n        }\n\n        model.requestMembershipToGroup(organization.id)\n            .then(() => {\n                dispatch(viewOrgJoinRequestSuccess())\n                // quick 'n easy\n                dispatch(viewOrgFetch((organization.id)))\n            })\n            .catch((err) => {\n                dispatch(viewOrgJoinRequestError({\n                    type: UIErrorType.ERROR,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function viewOrgCancelJoinRequest(requestId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewOrgJoinRequestStart())\n\n        const { auth: { authorization: { token, username } },\n            app: { config },\n            viewOrg: { organization } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n        if (typeof organization === 'undefined') {\n            dispatch(viewOrgCancelJoinRequestError({\n                type: UIErrorType.ERROR,\n                message: 'Org not currently defined'\n            }))\n            return\n        }\n\n        model.cancelRequest(requestId)\n            .then((newRequest) => {\n                dispatch(viewOrgCancelJoinRequestSuccess())\n                // quick 'n easy\n                dispatch(viewOrgFetch(newRequest.groupId))\n            })\n            .catch((err) => {\n                dispatch(viewOrgCancelJoinRequestError({\n                    type: UIErrorType.ERROR,\n                    message: err.message\n                }))\n            })\n\n    }\n}\n\nexport function acceptJoinInvitation(requestId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            viewOrg: { organization } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n        if (typeof organization === 'undefined') {\n            dispatch(acceptJoinInvitationError({\n                code: 'undefined',\n                message: 'Org not currently defined'\n            }))\n            return\n        }\n\n        model.acceptJoinInvitation(requestId)\n            .then((newRequest) => {\n                dispatch(acceptJoinInvitationSuccess())\n                // quick 'n easy\n                dispatch(viewOrgFetch(newRequest.groupId))\n            })\n            .catch((err) => {\n                dispatch(acceptJoinInvitationError(err))\n            })\n\n    }\n}\n\n\nexport function rejectJoinInvitation(requestId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(acceptJoinInvitationStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            viewOrg: { organization } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n        if (typeof organization === 'undefined') {\n            dispatch(acceptJoinInvitationError({\n                code: 'undefined',\n                message: 'Org not currently defined'\n            }))\n            return\n        }\n\n        model.rejectJoinInvitation(requestId)\n            .then((newRequest) => {\n                dispatch(rejectJoinInvitationSuccess())\n                // quick 'n easy\n                dispatch(viewOrgFetch(newRequest.groupId))\n            })\n            .catch((err) => {\n                dispatch(rejectJoinInvitationError(err))\n            })\n\n    }\n}\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport {\n    StoreState, Organization,\n    AppError, SortDirection\n} from '../../types'\nimport { Model } from '../../data/model'\nimport { viewOrgStop } from './viewOrg'\n\n\nexport interface SortOrgs extends Action<ActionFlag.SORT_ORGS> {\n    type: ActionFlag.SORT_ORGS,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport interface SortOrgsStart extends Action<ActionFlag.SORT_ORGS_START> {\n    type: ActionFlag.SORT_ORGS_START,\n    sortBy: string,\n    sortDirection: SortDirection\n}\n\nexport function sortOrgsStart(sortBy: string, sortDirection: SortDirection): SortOrgsStart {\n    return {\n        type: ActionFlag.SORT_ORGS_START,\n        sortBy: sortBy,\n        sortDirection: sortDirection\n    }\n}\n\n// SEARCH (FETCH) ORGS\n\n\n\n// Called upon the start of a search call\n// Sets the ui state to enable a spinner\n// and also search query data to be reflected in the ui\nexport interface SearchOrgsStart extends Action<ActionFlag.SEARCH_ORGS_START> {\n    type: ActionFlag.SEARCH_ORGS_START,\n    searchTerms: Array<string>\n}\n\nexport function searchOrgsStart(searchTerms: Array<string>): SearchOrgsStart {\n    return {\n        type: ActionFlag.SEARCH_ORGS_START,\n        searchTerms: searchTerms\n    }\n}\n\n// Called upon successful completion of a search\n// Sets the organizations found\nexport interface SearchOrgsSuccess extends Action<ActionFlag.SEARCH_ORGS_SUCCESS> {\n    type: ActionFlag.SEARCH_ORGS_SUCCESS,\n    organizations: Array<Organization>,\n    totalCount: number\n}\n\nexport function searchOrgsSuccess(organizations: Array<Organization>, totalCount: number): SearchOrgsSuccess {\n    return {\n        type: ActionFlag.SEARCH_ORGS_SUCCESS,\n        organizations: organizations,\n        totalCount: totalCount\n    }\n}\n\n// Called upon a search error\n// Sets error state\nexport interface SearchOrgsError extends Action<ActionFlag.SEARCH_ORGS_ERROR> {\n    type: ActionFlag.SEARCH_ORGS_ERROR,\n    error: AppError\n}\n\nexport function searchOrgsError(error: AppError): SearchOrgsError {\n    return {\n        type: ActionFlag.SEARCH_ORGS_ERROR,\n        error: error\n    }\n}\n\n\nexport interface SearchOrgs extends Action<ActionFlag.SEARCH_ORGS> {\n    type: ActionFlag.SEARCH_ORGS,\n    searchTerms: Array<string>\n}\n\n// TODO: proper typing here \nexport function searchOrgs(searchTerms: Array<string>) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchOrgsStart(searchTerms))\n        dispatch(viewOrgStop())\n\n        const {\n            browseOrgs: browseOrgs,\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        if (browseOrgs.view === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { view: { sortBy, sortDirection, filter } } = browseOrgs\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        return model.queryOrgs({\n            searchTerms: searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                console.error('Error querying orgs', error.name, error.message)\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function sortOrgs(sortBy: string, sortDirection: SortDirection) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sortOrgsStart(sortBy, sortDirection))\n\n        const {\n            browseOrgs: browseOrgs,\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (browseOrgs.view === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { view: { searchTerms, filter } } = browseOrgs\n\n        return model.queryOrgs({\n            searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function filterOrgs(filter: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(filterOrgsStart(filter))\n\n        const {\n            browseOrgs: browseOrgs,\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (browseOrgs.view === null) {\n            dispatch(searchOrgsError({\n                code: 'invalid-state',\n                message: 'Search orgs may not be called without a defined view'\n            }))\n            return\n        }\n\n        const { view: { searchTerms, sortBy, sortDirection } } = browseOrgs\n\n        return model.queryOrgs({\n            searchTerms,\n            sortBy, sortDirection, filter, username\n        })\n            .then(({ organizations, total }) => {\n                // TODO: also total.\n                dispatch(searchOrgsSuccess(organizations, total))\n            })\n            .catch((error) => {\n                dispatch(searchOrgsError({\n                    code: error.name,\n                    message: error.message\n                }))\n            })\n    }\n}\n\n\n\n\n// Filter orgs\nexport interface FilterOrgs extends Action<ActionFlag.FILTER_ORGS> {\n    type: ActionFlag.FILTER_ORGS,\n    filter: string\n}\n\nexport interface FilterOrgsStart extends Action<ActionFlag.FILTER_ORGS_START> {\n    type: ActionFlag.FILTER_ORGS_START,\n    filter: string\n}\n\nexport function filterOrgsStart(filter: string): FilterOrgsStart {\n    return {\n        type: ActionFlag.FILTER_ORGS_START,\n        filter: filter\n    }\n}\n\n","import OrganizationsBrowser from './OrganizationsBrowser'\nimport { StoreState, SortDirection, BrowseOrgsState, AppError } from '../../types'\nimport * as actions from '../../redux/actions/searchOrgs'\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n//\n// Typing for the mapState and mapDispatch\n//\nexport interface LinkStateProps {\n    totalCount: number,\n    filteredCount: number\n    sortBy: string,\n    sortDirection: SortDirection,\n    filter: string,\n    searching: boolean,\n    error: AppError | null\n}\n\nexport interface LinkDispatchProps {\n    onSearchOrgs: (searchTerms: Array<string>) => void,\n    onSortOrgs: (sortBy: string, sortDirection: SortDirection) => void,\n    onFilterOrgs: (filter: string) => void\n}\n\n// note second arg is the component props, but we don't have any component props to merge in.\nexport function mapStateToProps(storeState: StoreState): LinkStateProps {\n    // TODO: more insanity we must find a way of working around\n    if (storeState.browseOrgs.view) {\n        const {\n            browseOrgs: {\n                state,\n                error,\n                view: { totalCount, filteredCount, sortBy, sortDirection, filter } } } = storeState\n        return {\n            totalCount,\n            filteredCount,\n            sortBy,\n            sortDirection,\n            filter,\n            error,\n            searching: (state === BrowseOrgsState.SEARCHING)\n        }\n    } else {\n        return {\n            totalCount: 0,\n            filteredCount: 0,\n            sortBy: '',\n            sortDirection: SortDirection.ASCENDING,\n            filter: '',\n            error: null,\n            searching: (storeState.browseOrgs.state === BrowseOrgsState.SEARCHING)\n        }\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.SearchOrgs | actions.SortOrgs | actions.FilterOrgs>): LinkDispatchProps {\n    return {\n        onSearchOrgs: (searchTerms: Array<string>) => {\n            // TODO proper typing here\n            dispatch(actions.searchOrgs(searchTerms) as any)\n        },\n        onSortOrgs: (sortBy: string, sortDirection: SortDirection) => {\n            // TODO proper typing here\n            dispatch(actions.sortOrgs(sortBy, sortDirection) as any)\n        },\n        onFilterOrgs: (filter: string) => {\n            dispatch(actions.filterOrgs(filter) as any)\n        }\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OrganizationsBrowser)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, Organization, AppError, UIError, UIErrorType, FieldState } from '../../types'\nimport { Model, Validation } from '../../data/model'\n\n// ACTIONS\n\nexport interface AddOrg extends Action {\n    type: ActionFlag.ADD_ORG\n}\n\nexport interface AddOrgStart extends Action {\n    type: ActionFlag.ADD_ORG_START\n}\n\nexport interface AddOrgSuccess extends Action {\n    type: ActionFlag.ADD_ORG_SUCCESS,\n    organization: Organization\n}\n\nexport interface AddOrgError extends Action<ActionFlag.ADD_ORG_ERROR> {\n    type: ActionFlag.ADD_ORG_ERROR,\n    error: AppError\n}\n\n// Editing\n\nexport interface AddOrgEdit extends Action<ActionFlag.ADD_ORG_EDIT> {\n    type: ActionFlag.ADD_ORG_EDIT;\n}\n\nexport interface AddOrgEditStart {\n    type: ActionFlag.ADD_ORG_EDIT_START\n}\n\nexport interface AddOrgEditFinish {\n    type: ActionFlag.ADD_ORG_EDIT_FINISH\n}\n\n// Evaluating state of form \n\nexport interface AddOrgEvaluate extends Action<ActionFlag.ADD_ORG_EVALUATE> {\n    type: ActionFlag.ADD_ORG_EVALUATE\n}\n\nexport interface AddOrgEvaluateOK extends Action<ActionFlag.ADD_ORG_EVALUATE_OK> {\n    type: ActionFlag.ADD_ORG_EVALUATE_OK\n}\n\nexport interface AddOrgEvaluateErrors extends Action<ActionFlag.ADD_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n}\n\n// Updating name field\n\nexport interface AddOrgUpdateName extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface AddOrgUpdateNameSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface AddOrgUpdateNameError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: UIError\n}\n\n// Updating gravatar hash field\n\nexport interface AddOrgUpdateGravatarHash extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH,\n    name: string\n}\n\nexport interface AddOrgUpdateGravatarHashSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    gravatarHash: string\n}\n\nexport interface AddOrgUpdateGravatarHashError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n    gravatarHash: string,\n    error: UIError\n}\n\n// Updating id Field\n\nexport interface AddOrgUpdateId extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID,\n    id: string\n}\n\nexport interface AddOrgUpdateIdSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n    id: string\n}\n\nexport interface AddOrgUpdateIdError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n    id: string,\n    error: UIError\n}\n\n// Updating description field\n\nexport interface AddOrgUpdateDescription extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface AddOrgUpdateDescriptionSuccess {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface AddOrgUpdateDescriptionError extends Action {\n    type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: UIError\n}\n\n\n// ACTION CREATORS\n\nexport function addOrgStart(): AddOrgStart {\n    return {\n        type: ActionFlag.ADD_ORG_START\n    }\n}\n\nexport function addOrgSuccess(org: Organization): AddOrgSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_SUCCESS,\n        organization: org\n    }\n}\n\nexport function addOrgError(error: AppError): AddOrgError {\n    return {\n        type: ActionFlag.ADD_ORG_ERROR,\n        error: error\n    }\n}\n\nexport function addOrgEditStart() {\n    return {\n        type: ActionFlag.ADD_ORG_EDIT_START\n    }\n}\n\nexport function addOrgEditFinish() {\n    return {\n        type: ActionFlag.ADD_ORG_EDIT_FINISH\n    }\n}\n\n// Evaluate\n\nexport function addOrgEvaluateOk(): AddOrgEvaluateOK {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_OK\n    }\n}\n\nexport function AddOrgEvaluateErrors(): AddOrgEvaluateErrors {\n    return {\n        type: ActionFlag.ADD_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Update Name\n\nexport function addOrgUpdateNameSuccess(name: string): AddOrgUpdateNameSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function addOrgUpdateNameError(name: string, error: UIError): AddOrgUpdateNameError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\nexport function addOrgUpdateIdSuccess(id: string): AddOrgUpdateIdSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_SUCCESS,\n        id: id\n    }\n}\n\n// Update Gravatar Hash\n\nexport function addOrgUpdateGravatarHashSuccess(gravatarHash: string): AddOrgUpdateGravatarHashSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n        gravatarHash: gravatarHash\n    }\n}\n\nexport function addOrgUpdateGravatarHashError(gravatarHash: string, error: UIError): AddOrgUpdateGravatarHashError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n        gravatarHash: gravatarHash,\n        error: error\n    }\n}\n\n\n// Update Id\n\nexport function addOrgUpdateIdError(id: string, error: UIError): AddOrgUpdateIdError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_ID_ERROR,\n        id: id,\n        error: error\n    }\n}\n\nexport function addOrgUpdateDescriptionSuccess(description: string): AddOrgUpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function addOrgUpdateDescriptionError(description: string, error: UIError): AddOrgUpdateDescriptionError {\n    return {\n        type: ActionFlag.ADD_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function addOrgEdit() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(addOrgEditStart())\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrg() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(addOrgStart())\n\n        const { auth: { authorization: { token, username } },\n            addOrg: { newOrganization },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (!newOrganization) {\n            dispatch(addOrgError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        model.addOrg(newOrganization, username)\n            .then((org: Organization) => {\n                dispatch(addOrgSuccess(org))\n            })\n            .catch((error) => {\n                console.error('error adding', newOrganization, error)\n                dispatch(addOrgError({\n                    code: 'invalid',\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function addOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const { addOrg: { newOrganization } } = getState()\n\n        const { addOrg: editState } = getState()\n\n        if (!newOrganization) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.name.status !== FieldState.EDITED_OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.id.status !== FieldState.EDITED_OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.gravatarHash.status !== FieldState.EDITED_OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        if (newOrganization.description.status !== FieldState.EDITED_OK) {\n            dispatch(AddOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(addOrgEvaluateOk())\n    }\n}\n\nfunction newModelFromState(state: StoreState) {\n    const { auth: { authorization: { token, username } },\n        app: { config } } = state\n    return new Model({\n        token, username,\n        groupsServiceURL: config.services.Groups.url,\n        userProfileServiceURL: config.services.UserProfile.url,\n        workspaceServiceURL: config.services.Workspace.url,\n        serviceWizardURL: config.services.ServiceWizard.url\n    })\n}\n\nexport function addOrgUpdateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(addOrgUpdateNameError(validatedName, error))\n        } else {\n            dispatch(addOrgUpdateNameSuccess(validatedName))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrgUpdateGravatarHash(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validateGravatarHash, error] = Validation.validateOrgGravatarHash(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(addOrgUpdateGravatarHashError(validateGravatarHash, error))\n        } else {\n            dispatch(addOrgUpdateGravatarHashSuccess(validateGravatarHash))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}\n\nexport function addOrgUpdateId(id: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const [validatedId, error] = Validation.validateOrgId(id)\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(addOrgUpdateIdError(validatedId, error))\n            dispatch(addOrgEvaluate())\n            return\n        }\n        const model = newModelFromState(getState())\n        model.groupExists(validatedId)\n            .then((exists) => {\n                if (exists) {\n                    dispatch(addOrgUpdateIdError(validatedId, {\n                        type: UIErrorType.ERROR,\n                        message: 'This org id is already in use'\n                    }))\n                } else {\n                    dispatch(addOrgUpdateIdSuccess(validatedId))\n                }\n\n                dispatch(addOrgEvaluate())\n            })\n    }\n}\n\nexport function addOrgUpdateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>,\n        getState: () => StoreState) => {\n        const { auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n        const [validatedDescription, error] = model.validateOrgDescription(description)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(addOrgUpdateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(addOrgUpdateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(addOrgEvaluate())\n    }\n}","import * as React from 'react'\nimport { Redirect } from 'react-router-dom';\nimport marked from 'marked';\nimport { Button, Icon, Modal } from 'antd';\nimport md5 from 'md5'\n\nimport { EditableOrganization, SaveState, ValidationState, EditState } from '../../types';\n\nimport './NewOrganization.css'\n\n\nimport Header from '../Header';\n\nexport interface NewOrganizationProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    newOrganization: EditableOrganization,\n    onAddOrgEdit: () => void,\n    onAddOrg: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateGravatarHash: (gravatarHash: string) => void;\n    onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\n\nexport interface NewOrganizationState {\n    cancelToBrowser: boolean;\n}\n\nclass NewOrganization extends React.Component<NewOrganizationProps, NewOrganizationState> {\n\n    origin: string;\n    gravatarEmail: React.RefObject<HTMLInputElement>\n\n    constructor(props: NewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false\n        }\n\n        this.gravatarEmail = React.createRef()\n\n        this.origin = document.location!.origin\n\n        this.props.onAddOrgEdit()\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'New Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>\n                        As a KBase user, you may create your own organizations.\n                    </p>\n                    <p>\n                        Once you have created an Organization, you will be the sole owner of it, forever.\n                    </p>\n                    <p>\n                        In order to create an Org, you need to complete the following fields.\n                    </p>\n                    <dl>\n                        <dt>\n                            name\n                        </dt>\n                        <dd>\n                            The organization <i>name</i> is whatever you wish to have your Org known as. It may be\n                            composed of any text (including unicode characters) up to 200 characters in length. You\n                            may also change it at any time.\n                        </dd>\n                        <dt>\n                            gravatar\n                        </dt>\n                        <dd>\n                            You should associate your Organization with an avatar hosted with the Gravatar service. To do so,\n                            simply enter the email address associated with your gravatar into the first\n                        </dd>\n                        <dt>\n                            id\n                        </dt>\n                        <dd>\n                            <p>\n                                Your Org <i>id</i> forms a url endpoint for your org as well as the identifier used throughout\n                            KBase to, well, identify your organization uniquely among all current and future organizations.\n                            As such, the Org ID may not be changed once created.\n                            </p>\n                            <p>\n                                The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also\n                                restricted to 100 characters in length.\n                            </p>\n\n                        </dd>\n                        <dt>\n                            description\n                        </dt>\n                        <dd>\n                            <p>\n                                Up to 4000 characters, a description allows you to express to other KBase users the purpose,\n                            history, associations, and science domain of your Org.</p>\n                            <p>\n                                The description is in \"markdown\" format, and the editor will show you a preview of the\n                                rendered description.\n                            </p>\n                        </dd>\n                    </dl>\n                </div>\n            )\n        })\n    }\n\n    onGravatarEmailSync() {\n        let email;\n        if (this.gravatarEmail.current) {\n            email = this.gravatarEmail.current.value\n        } else {\n            email = 'n/a'\n        }\n        const hashed = md5(email)\n        this.props.onUpdateGravatarHash(hashed);\n    }\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have entered information for this new organization.</p>\n\n                    <p>If you leave the editor without first saving, the new organization <i>will not be created</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        this.props.onAddOrg();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value);\n    }\n\n    onGravatarHashChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateGravatarHash(e.target.value);\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value);\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateId(e.target.value);\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState === ValidationState.VALID &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.saveState === SaveState.NEW\n        )\n    }\n\n    renderForm() {\n        return (\n            <form id=\"newOrganizationForm\" className=\"editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">name</div>\n                    <div className=\"col2\">\n                        <input value={this.props.newOrganization.name.value || ''}\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.props.newOrganization.name.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.name.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row gravatarHash\">\n                    <div className=\"col1 field-label\">gravatar hash</div>\n                    <div className=\"col2\">\n                        <div style={{ display: 'flex', flexDirection: 'row', marginBottom: '4px' }}>\n                            <div style={{ flex: '1 1 0px' }}>\n                                <input ref={this.gravatarEmail} placeholder=\"Provide your gravatar-linked email address, if any\" />\n                            </div>\n                            <div style={{ flex: '0 0 auto' }}>\n                                <Button\n                                    icon=\"arrow-down\"\n                                    style={{ height: '100%' }}\n                                    onClick={this.onGravatarEmailSync.bind(this)} />\n                            </div>\n                        </div>\n                        <input value={this.props.newOrganization.gravatarHash.value || ''}\n                            onChange={this.onGravatarHashChange.bind(this)} />\n                        {this.props.newOrganization.gravatarHash.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.gravatarHash.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">id</div>\n                    <div className=\"col2\">\n                        <input value={this.props.newOrganization.id.value || ''}\n                            onChange={this.onIdChange.bind(this)} />\n                        {this.props.newOrganization.id.error ? (<span style={{ color: 'red' }}>{this.props.newOrganization.id.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\" style={{ flex: '1 1 0px', minHeight: '30em', maxHeight: '60em' }}>\n                    <div className=\"col1 field-label\">description</div>\n                    <div className=\"col2\">\n                        <textarea value={this.props.newOrganization.description.value || ''}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.props.newOrganization.description.error ? (<div style={{ color: 'red' }}>{this.props.newOrganization.description.error.message}</div>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\"></div>\n                    <div className=\"col2\">\n                        {/* <div className=\"footer\">\n                            <Button form=\"newOrganizationForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\">Save</Button>\n                            <Button type=\"danger\"\n                                onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n                        </div> */}\n                    </div>\n                </div>\n            </form>\n        )\n    }\n\n    getOrgAvatarUrl(org: EditableOrganization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash.value) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash.value) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash.value + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: EditableOrganization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getOrgAvatarUrl(org)} />\n        )\n    }\n\n    renderPreview() {\n        return <form className=\"preview\">\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"name\">\n                        {this.props.newOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"gravatarHash\">\n                        {this.renderOrgAvatar(this.props.newOrganization)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"id\">\n                        <span style={{ color: 'silver' }}>{this.origin}/#orgs/organizations/</span>\n                        {this.props.newOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\" style={{ flex: '1 1 0px' }}>\n                <div className=\"col2\">\n                    <div className=\"description\"\n                        dangerouslySetInnerHTML={({ __html: marked(this.props.newOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        </form>\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    renderHeader() {\n        const orgName = this.props.newOrganization!.name.value || (<span style={{ fontStyle: 'italic', color: 'gray' }}>org name will appear here when you edit the name field</span>)\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            {/* <FaPlusCircle style={{ verticalAlign: 'middle' }} /> */}\n                            <Icon type=\"plus-circle\" />\n                            {' '}\n                            Adding a New Org \"\n                            {orgName}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        {/* {this.renderState()} */}\n                        <Button icon=\"save\"\n                            form=\"newOrganizationForm\"\n                            key=\"submit\"\n                            disabled={!this.canSave.call(this)}\n                            htmlType=\"submit\">\n                            {/* <Icon type=\"save\" /> */}\n                            {/* <FaSave style={{ verticalAlign: 'center' }} /> */}\n                            Save\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToBrowser.bind(this)}>\n                            {/* <FaUndo style={{ verticalAlign: 'center' }} />  */}\n                            Return to Orgs Browser\n                        </Button>\n                        <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderLoadingHeader() {\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Loading New Org Editor...\n                        </span>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    render() {\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        // TODO: this is just a prop for today.\n        if (this.props.saveState === SaveState.SAVED) {\n            return <Redirect push to={\"/editOrganization/\" + this.props.newOrganization.id.value} />\n        }\n\n        if (!this.props.newOrganization) {\n            return (\n                <div className=\"NewOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"NewOrganization\">\n                {this.renderHeader()}\n                <div className=\"mainRow\">\n                    <div className=\"editorColumn\">\n                        <h3>Editor</h3>\n                        {this.renderForm()}\n                    </div>\n                    <div className=\"previewColumn\">\n                        <h3>Preview</h3>\n                        {this.renderPreview()}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default NewOrganization","import { Dispatch } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState } from '../../types';\nimport {\n    AddOrg, addOrg,\n    addOrgUpdateName, addOrgUpdateId, addOrgUpdateDescription, addOrgEdit, addOrgUpdateGravatarHash\n} from '../../redux/actions/addOrg';\n\nimport NewOrganization from './NewOrganization';\n\ninterface OwnProps {\n}\n\nexport interface StateProps {\n}\n\nexport interface DispatchProps {\n    onAddOrg: () => void,\n    onAddOrgEdit: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateGravatarHash: (gravatarHash: string) => void,\n    onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nexport function mapStateToProps({ addOrg: { editState, saveState, validationState, newOrganization } }: StoreState): StateProps {\n    return {\n        editState,\n        saveState,\n        validationState,\n        newOrganization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<AddOrg>): DispatchProps {\n    return {\n        onAddOrgEdit: () => {\n            dispatch(addOrgEdit() as any)\n        },\n        onAddOrg: () => {\n            dispatch(addOrg() as any)\n        },\n        onUpdateName: (name) => {\n            dispatch(addOrgUpdateName(name) as any)\n        },\n        onUpdateGravatarHash: (gravatarHash: string) => {\n            dispatch(addOrgUpdateGravatarHash(gravatarHash) as any)\n        },\n        onUpdateId: (id) => {\n            dispatch(addOrgUpdateId(id) as any)\n        },\n        onUpdateDescription: (description) => {\n            dispatch(addOrgUpdateDescription(description) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(NewOrganization)","import * as React from 'react'\nimport { Organization, UserRelationToOrganization, MembershipRequestPendingRelation } from '../../types';\nimport { Avatar } from '../Avatar';\nimport { Icon, Tooltip, Button, message, Menu, Dropdown } from 'antd';\n\nimport './component.css'\nimport { NavLink, Redirect } from 'react-router-dom';\n\nexport interface OrganizationHeaderProps {\n    organization: Organization\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n    onJoinOrg: () => void\n}\n\ninterface OrganizationHeaderState {\n    navigateTo: NavigateTo\n}\n\nenum NavigateTo {\n    NONE = 0,\n    MANAGE_MEMBERSHIP,\n    VIEW_MEMBERS,\n    MANAGE_REQUESTS,\n    VIEW_ORGANIZATION,\n    EDIT_ORGANIZATION,\n    INVITE_USER\n}\n\nexport class OrganizationHeader extends React.Component<OrganizationHeaderProps, OrganizationHeaderState> {\n    constructor(props: OrganizationHeaderProps) {\n        super(props)\n\n        this.state = {\n            navigateTo: NavigateTo.NONE\n        }\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n        message.success('Join request has been submitted')\n    }\n\n    onCancelJoinRequest() {\n        const relation = this.props.organization.relation as MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n        message.success('Submitted cancellation request')\n    }\n\n    onAcceptInvitation() {\n        const relation = this.props.organization.relation as MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n        message.success('Invitation acceptance has been sent')\n    }\n\n    onRejectInvitation() {\n        const relation = this.props.organization.relation as MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n        message.success('Invitation rejection has been sent')\n    }\n\n    onNavigateToMembership() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_MEMBERSHIP })\n    }\n\n    onNavigateToViewMembers() {\n        this.setState({ navigateTo: NavigateTo.VIEW_MEMBERS })\n    }\n\n    onNavigateToManageRequests() {\n        this.setState({ navigateTo: NavigateTo.MANAGE_REQUESTS })\n    }\n\n    onNavigateToEditOrganization() {\n        this.setState({ navigateTo: NavigateTo.EDIT_ORGANIZATION })\n    }\n\n    onNavigateToInviteUser() {\n        this.setState({ navigateTo: NavigateTo.INVITE_USER })\n    }\n\n    onNavigateToViewOrganization() {\n        this.setState({ navigateTo: NavigateTo.VIEW_ORGANIZATION })\n    }\n\n    getOrgAvatarUrl(org: Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: Organization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                onClick={this.onNavigateToViewOrganization.bind(this)}\n                className=\"avatarImage\"\n                src={this.getOrgAvatarUrl(this.props.organization)} />\n        )\n    }\n\n    renderRelation() {\n        const org = this.props.organization\n        switch (org.relation.type) {\n            case (UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (UserRelationToOrganization.VIEW):\n                return (\n                    <div>\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title=\"You are not a member of this org, but you may access it, you may request membership\"\n                        >\n                            <div style={{ textAlign: 'center' }}>\n                                <Icon type=\"eye\" style={{ marginRight: '4px' }} />You are not a member of this Organization\n                            </div>\n                        </Tooltip>\n                        <div style={{ textAlign: 'center' }}>\n                            <Button\n                                type=\"primary\"\n                                onClick={this.onJoinClick.bind(this)}>\n                                Join this Organization\n                            </Button>\n                        </div>\n                    </div>\n\n                )\n            case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <Tooltip\n                            placement=\"bottomRight\"\n                            mouseEnterDelay={0.5}\n                            title=\"You have requested membership in this Organization\"\n                        >   <div style={{ textAlign: 'center' }}>\n                                <span>\n                                    <Icon type=\"user\" style={{ color: 'orange' }} spin={true} />\n                                    Your membership <b>request</b> is pending\n                                {' '}\n                                    <Icon type=\"question-circle\" />\n                                </span>\n                            </div>\n                        </Tooltip>\n                        <div style={{ textAlign: 'center' }}>\n                            <Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button>\n                        </div>\n                    </div>\n\n                )\n            case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You have been invited to join this Organization\"\n                    >\n                        <div><Icon type=\"user\" style={{ color: 'blue' }} />You have been <b>invited</b> to join this Organization</div>\n                        <div style={{ textAlign: 'center' }}>\n                            <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                            <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                        </div>\n                    </Tooltip>\n                )\n            case (UserRelationToOrganization.MEMBER):\n                const menu = (\n                    <Menu>\n                        <Menu.Item key=\"manageMyMembership\" onClick={this.onNavigateToMembership.bind(this)}>\n                            Manage My Membership\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You are a member of this organization\"\n                            >\n                                <div><Icon type=\"user\" />You are a <b>member</b> of this Organization</div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={menu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                        {/* <div style={{ textAlign: 'center' }}>\n                            <Button type=\"default\">Manage your Profile</Button>\n                        </div> */}\n                    </div>\n                )\n            case (UserRelationToOrganization.ADMIN):\n                const adminMenu = (\n                    <Menu>\n                        <Menu.Item key=\"manageMyMembership\" onClick={this.onNavigateToMembership.bind(this)}>\n                            Manage My Membership\n                        </Menu.Item>\n                        <Menu.Item key=\"viewMembers\" onClick={this.onNavigateToViewMembers.bind(this)}>\n                            Members\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRequests\" onClick={this.onNavigateToManageRequests.bind(this)}>\n                            Requests and Invitations\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" onClick={this.onNavigateToEditOrganization.bind(this)}>\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" onClick={this.onNavigateToInviteUser.bind(this)}>\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You are and Administrator for this group\"\n                            >\n                                <div><Icon type=\"unlock\" />You are a <b>administrator</b> of this Organization</div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={adminMenu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                        {/* <div style={{ textAlign: 'center' }}>\n                            <Button type=\"default\">Manage your Profile</Button>\n                        </div> */}\n                    </div>\n                )\n            case (UserRelationToOrganization.OWNER):\n                const ownerMenu = (\n                    <Menu>\n                        <Menu.Item key=\"viewMembers\" onClick={this.onNavigateToViewMembers.bind(this)}>\n                            Members\n                        </Menu.Item>\n                        <Menu.Item key=\"manageRequests\" onClick={this.onNavigateToManageRequests.bind(this)}>\n                            Requests and Invitations\n                        </Menu.Item>\n                        <Menu.Item key=\"editOrg\" onClick={this.onNavigateToEditOrganization.bind(this)}>\n                            Edit this Org\n                        </Menu.Item>\n                        <Menu.Item key=\"inviteUser\" onClick={this.onNavigateToInviteUser.bind(this)}>\n                            Invite User\n                        </Menu.Item>\n                    </Menu>\n                )\n                return (\n                    <div className=\"relationRow\">\n                        <div className=\"relationLabel\">\n                            <Tooltip\n                                placement=\"bottomRight\"\n                                mouseEnterDelay={0.5}\n                                title=\"You own this group\"\n                            >\n                                <div>\n                                    <Icon type=\"crown\" style={{ color: 'gold' }} />\n                                    {' '}\n                                    You <b>own</b> this Organization\n                                    </div>\n                            </Tooltip>\n                        </div>\n                        <div className=\"relationMenu\">\n                            <div>\n                                <Dropdown overlay={ownerMenu} trigger={['click']}>\n                                    <Button shape=\"circle\">\n                                        <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                                    </Button>\n                                </Dropdown>\n                            </div>\n                        </div>\n                        {/* <div style={{ textAlign: 'center' }}>\n                        <Button type=\"default\">Manage your Profile</Button>\n                    </div> */}\n                    </div>\n                )\n        }\n    }\n\n    renderOrgInfo() {\n        const org = this.props.organization\n        return (\n            <div>\n                <div className=\"name\">\n                    {org.name}\n                </div>\n                {/* <div className=\"id\">\n                    <span className=\"label\">permalink</span>{' '}\n                    <span className=\"permalinkBase\">https://narrative.kbase.us#orgs/</span>{org.id}\n                </div> */}\n                <div className=\"owner\">\n                    <span className=\"field-label\">owner</span>\n                    <a href={\"#people/\" + org.owner.user.username} target=\"_blank\">{org.owner.user.realname}</a>\n                    {' '}\n                    ❨{org.owner.user.username}❩\n                                </div>\n            </div>\n        )\n    }\n\n    getRelationClass(org: Organization) {\n        switch (org.relation.type) {\n            case (UserRelationToOrganization.NONE):\n                return 'relationRequest'\n            case (UserRelationToOrganization.VIEW):\n                return 'relationRequest relationNonMember'\n            case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'relationRequest relationRequestPending'\n            case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'relationRequest relationInvitationPending'\n            case (UserRelationToOrganization.MEMBER):\n                return 'relationRequest relationMember'\n            case (UserRelationToOrganization.ADMIN):\n                return 'relationRequest relationAdmin'\n            case (UserRelationToOrganization.OWNER):\n                return 'relationRequest relationOwner'\n        }\n    }\n\n    render() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        switch (this.state.navigateTo) {\n            case NavigateTo.MANAGE_MEMBERSHIP:\n                return <Redirect push to={\"/membership/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_MEMBERS:\n                return <Redirect push to={\"/viewMembers/\" + this.props.organization.id} />\n            case NavigateTo.EDIT_ORGANIZATION:\n                return <Redirect push to={\"/editOrganization/\" + this.props.organization.id} />\n            case NavigateTo.MANAGE_REQUESTS:\n                return <Redirect push to={\"/manageOrganizationRequests/\" + this.props.organization.id} />\n            case NavigateTo.INVITE_USER:\n                return <Redirect push to={\"/inviteUser/\" + this.props.organization.id} />\n            case NavigateTo.VIEW_ORGANIZATION:\n                return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n            default:\n            // nothing, fall through\n        }\n\n        return (\n            <div className=\"OrganizationHeader\">\n                <div className=\"avatar\">\n                    {this.renderOrgAvatar(this.props.organization)}\n                </div>\n                <div className=\"orgInfo\">\n                    {this.renderOrgInfo()}\n                </div>\n                <div className={\"yourRelation \" + this.getRelationClass(this.props.organization)}>\n                    {this.renderRelation()}\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default OrganizationHeader","import * as React from 'react'\nimport './Avatar.css'\n\nimport { User } from '../types'\n\nexport interface AvatarProps {\n    user: User,\n    size: number\n}\n\ninterface AvatarState {\n\n}\n\nexport class Avatar extends React.Component<AvatarProps, AvatarState> {\n    constructor(props: AvatarProps) {\n        super(props)\n    }\n\n    getAvatarUrl(user: User) {\n        switch (user.avatarOption || 'gravatar') {\n            case 'gravatar':\n                const gravatarDefault = user.gravatarDefault || 'identicon';\n                const gravatarHash = user.gravatarHash;\n                if (gravatarHash) {\n                    return 'https://www.gravatar.com/avatar/' + gravatarHash + '?s=60&amp;r=pg&d=' + gravatarDefault;\n                } else {\n                    return './nouserpic.png';\n                }\n            case 'silhouette':\n            case 'mysteryman':\n            default:\n                return './nouserpic.png';\n        }\n    }\n\n    render() {\n        const avatarUrl = this.getAvatarUrl(this.props.user)\n        return (\n            <img\n                src={avatarUrl}\n                style={{ width: this.props.size }}\n            />\n        )\n    }\n\n}\n\nexport default Avatar","import * as React from 'react'\nimport './Member.css'\n\nimport Avatar from './Avatar'\nimport * as types from '../types';\nimport { Icon } from 'antd';\n\nexport interface MemberProps {\n    member: types.Member\n    avatarSize?: number\n}\n\ninterface MemberState {\n\n}\n\nclass Member extends React.Component<MemberProps, MemberState> {\n    constructor(props: MemberProps) {\n        super(props)\n    }\n\n    renderRole() {\n        switch (this.props.member.type) {\n            case types.MemberType.OWNER:\n                return (\n                    <span>\n                        <Icon type=\"crown\" /> owner\n                </span>\n                )\n            case types.MemberType.ADMIN:\n                return (\n                    <span>\n                        <Icon type=\"unlock\" /> admin\n                </span>\n                )\n            case types.MemberType.MEMBER:\n                return (\n                    <span>\n                        <Icon type=\"user\" /> member\n                </span>\n                )\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Member\" >\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.member.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"#people/\" + this.props.member.user.username} target=\"_blank\">{this.props.member.user.realname}</a>\n                        {' '}\n                        ❨{this.props.member.user.username}❩\n                    </div>\n                    <div className=\"role\">\n                        {this.renderRole()}\n                    </div>\n                    <div className=\"title\">\n                        {this.props.member.user.title || <i>no title in user profile</i>}\n                    </div>\n                    <div className=\"organization\">\n                        {this.props.member.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.member.user.city, this.props.member.user.state, this.props.member.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Member","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\n// we steal the view org actions...\nimport * as actions from '../../redux/actions/viewOrg'\n\nimport OrganizationHeader from './component'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {}\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.ViewOrgFetch>): DispatchProps {\n    return {\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: string) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: string) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: string) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(OrganizationHeader)\n","import * as React from 'react'\nimport marked from 'marked'\nimport { NavLink, Redirect } from 'react-router-dom'\n\nimport './ViewOrganization.css'\n\nimport { ViewOrgState, Organization, AppError, UserRelationToOrganization, MembershipRequestPendingRelation, NarrativeResource, UserWorkspacePermission } from '../../types'\nimport { Button, Modal, Icon, Tooltip, Card, Dropdown, Menu } from 'antd'\nimport Header from '../Header'\nimport Avatar from '../Avatar'\nimport Member from '../Member';\nimport OrganizationHeader from '../organizationHeader/container'\n// import faGlobe from '@fortawesome/free-solid-svg-icons/faGlobe'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nenum NavigateTo {\n    NONE = 0,\n    REQUEST_ADD_NARRATIVE\n}\n\nexport interface ViewOrganizationState {\n    showInfo: boolean,\n    navigateTo: NavigateTo\n}\n\nexport interface ViewOrganizationProps {\n    state: ViewOrgState\n    id: string\n    organization?: Organization\n    error?: AppError\n    username: string\n    onViewOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n    onRemoveNarrative: (narrative: NarrativeResource) => void\n}\n\nclass ViewOrganization extends React.Component<ViewOrganizationProps, ViewOrganizationState> {\n    constructor(props: ViewOrganizationProps) {\n        super(props)\n\n        this.state = {\n            showInfo: false,\n            navigateTo: NavigateTo.NONE\n        }\n\n        this.props.onViewOrg(this.props.id)\n    }\n\n    onViewMembers() {\n\n    }\n\n    onJoinClick() {\n        this.props.onJoinOrg()\n    }\n\n    onCancelJoinRequest() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.organization.relation as MembershipRequestPendingRelation\n        this.props.onCancelJoinRequest(relation.requestId)\n    }\n\n    onAcceptInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.organization.relation as MembershipRequestPendingRelation\n        this.props.onAcceptInvitation(relation.requestId)\n    }\n\n    onRejectInvitation() {\n        if (!this.props.organization) {\n            return\n        }\n        const relation = this.props.organization.relation as MembershipRequestPendingRelation\n        this.props.onRejectInvitation(relation.requestId)\n    }\n\n    onRequestAddNarrative() {\n        this.setState({ navigateTo: NavigateTo.REQUEST_ADD_NARRATIVE })\n    }\n\n    onRemoveNarrative(narrative: NarrativeResource) {\n        this.props.onRemoveNarrative(narrative)\n    }\n\n    onShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'View Organization Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations viewer...</p>\n                </div>\n            )\n        })\n    }\n\n    onRequestShare(narrative: NarrativeResource) {\n        alert('not yet implemented')\n    }\n\n    buildFooter() {\n        return (\n            <div>\n                {this.renderEditRow()}\n                {/* <p style={{ textAlign: 'center' }}>\n                    You may also  <NavLink to={`/organizations`}><Button type=\"danger\" icon=\"undo\">Return to Orgs</Button></NavLink> to the organizations browser.\n                </p> */}\n            </div>\n        )\n    }\n\n    renderEditRow() {\n        if (this.props.organization!.owner.user.username === this.props.username) {\n            return (\n                <p style={{ textAlign: 'center' }}>\n                    As the owner of this group, you may <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink> it.\n                </p>\n            )\n        }\n    }\n\n    renderEditButton() {\n        if (this.props.organization!.owner.user.username === this.props.username) {\n            return (\n                <NavLink to={`/editOrganization/${this.props.organization!.id}`}><Button icon=\"edit\">Edit</Button></NavLink>\n            )\n        }\n    }\n\n    renderOrg() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <div className=\"org\">\n                {/* <div className=\"nameAndLogo\">\n                    <div className=\"avatar\">\n                        {this.renderOrgAvatar(this.props.organization)}\n                    </div>\n                    <div className=\"nameAndLink\">\n                        <div className=\"name\">\n                            {this.props.organization.name}\n                        </div>\n                        <div className=\"id\">\n                            <span className=\"label\">permalink</span>{' '}\n                            <span className=\"permalinkBase\">https://narrative.kbase.us#orgs/</span>{this.props.organization.id}\n                        </div>\n                    </div>\n                </div> */}\n                <div className=\"description\"\n                    dangerouslySetInnerHTML={({ __html: marked(this.props.organization.description || '') })}\n                />\n\n            </div>\n        )\n    }\n\n    renderOwnerInfo(org: Organization) {\n        return (\n            <div className=\"ownerTable\">\n                <div className=\"avatarCol\">\n                    <Avatar user={org.owner.user} size={60} />\n                </div>\n                <div className=\"proprietorCol\">\n\n                    <div className=\"owner\">\n                        <a href={\"#people/\" + org.owner.user.username} target=\"_blank\">{org.owner.user.realname}</a>\n                        {' '}\n                        ❨{org.owner.user.username}❩\n                                </div>\n                    <div className=\"profileOrganization\">\n                        {org.owner.user.organization}\n                    </div>\n                    <div className=\"profileOrganization\">\n                        {org.owner.user.city}, {org.owner.user.state}, {org.owner.user.country}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organization={this.props.organization} />\n        )\n        // return (\n        //     <div className=\"orgHeader\">\n        //         <div className=\"avatar\">\n        //             {this.renderOrgAvatar(this.props.organization)}\n        //         </div>\n        //         <div className=\"orgInfo\">\n        //             <div className=\"name\">\n        //                 {this.props.organization.name}\n        //             </div>\n        //             <div className=\"id\">\n        //                 <span className=\"label\">permalink</span>{' '}\n        //                 <span className=\"permalinkBase\">https://narrative.kbase.us#orgs/</span>{this.props.organization.id}\n        //             </div>\n        //         </div>\n        //         <div className=\"ownerInfo\">\n        //             {this.renderOwnerInfo(this.props.organization)}\n        //         </div>\n        //         <div className=\"yourRelation\">\n        //             {this.renderRelation(this.props.organization)}\n        //         </div>\n\n        //     </div>\n        // )\n    }\n\n    getOrgAvatarUrl(org: Organization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: Organization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getOrgAvatarUrl(org)} />\n        )\n    }\n\n\n    renderRelation(org: Organization) {\n        switch (org.relation.type) {\n            case (UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (UserRelationToOrganization.VIEW):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You are not a member of this org, but you may access it; you may request membership\"\n                    >\n                        <div><Icon type=\"eye\" style={{ marginRight: '4px' }} />You are not a member of this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button\n                                onClick={this.onJoinClick.bind(this)}>\n                                Join this Organization\n                            </Button>\n                        </div>\n                    </Tooltip>\n                )\n            case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'orange' }} spin={true} />Your membership <b>request</b> is pending</div>\n                        <div><Button icon=\"delete\" type=\"danger\" onClick={this.onCancelJoinRequest.bind(this)}>Cancel Request</Button></div>\n                    </div>\n                )\n            case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (\n                    <div>\n                        <div><Icon type=\"user\" style={{ color: 'blue' }} />You have been <b>invited</b> to join this Organization</div>\n                        <div style={{ marginTop: '10px' }}>\n                            <Button icon=\"check\" type=\"default\" onClick={this.onAcceptInvitation.bind(this)}>Accept Invitation</Button>\n                            <Button icon=\"stop\" type=\"danger\" onClick={this.onRejectInvitation.bind(this)}>Reject Invitation</Button>\n                        </div>\n                    </div>\n                )\n            case (UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" />Member</span>)\n            case (UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />Admin</span>)\n            case (UserRelationToOrganization.OWNER):\n                return (\n                    <Tooltip\n                        placement=\"bottomRight\"\n                        mouseEnterDelay={0.5}\n                        title=\"You own this org\"\n                    >\n                        <span><Icon type=\"unlock\" theme=\"filled\" style={{ marginRight: '4px' }} />You own this organization</span>\n                    </Tooltip>\n                )\n        }\n    }\n\n    isMember(): boolean {\n        if (!this.props.organization) {\n            return false\n        }\n        if (this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === UserRelationToOrganization.ADMIN ||\n            this.props.organization.relation.type === UserRelationToOrganization.MEMBER) {\n            return true\n        }\n        return false\n    }\n\n    renderMembers() {\n        if (!this.props.organization) {\n            return\n        }\n        let members;\n        if (!this.isMember()) {\n            return (\n                <i>Sorry, group membership restricted to members only</i>\n            )\n        }\n        if (this.props.organization.members.length === 0) {\n            members = (\n                <p style={{ fontStyle: 'italic', textAlign: 'center' }}>\n                    This organization has no members\n                </p>\n            )\n        } else {\n            members = this.props.organization.members.map((member) => {\n                return (\n                    <React.Fragment key={member.user.username}>\n                        <Member member={member} avatarSize={50} />\n                    </React.Fragment>\n                )\n            })\n        }\n        return (\n            <div className=\"table infoTable\">\n                <div className=\"row\">\n                    <div className=\"col0\">\n                        {members}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderInfo() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <Card\n                title={<span><Icon type=\"info-circle\"></Icon> info</span>}\n                className=\"slimCard\">\n                <div>\n                    <div>\n                        <div className=\"label\">owner</div>\n                    </div>\n                    <div className=\"ownerTable\">\n                        <div className=\"avatarCol\">\n                            <Avatar user={this.props.organization.owner.user} size={60} />\n                        </div>\n                        <div className=\"proprietorCol\">\n                            <div className=\"owner\">\n                                <a href={\"#people/\" + this.props.organization.owner.user.username} target=\"_blank\">{this.props.organization.owner.user.realname}</a>\n                                {' '}\n                                ❨{this.props.organization.owner.user.username}❩\n                                        </div>\n                            <div className=\"profileOrganization\">\n                                {this.props.organization.owner.user.organization}\n                            </div>\n                            <div className=\"profileOrganization\">\n                                {this.props.organization.owner.user.city}, {this.props.organization.owner.user.state}, {this.props.organization.owner.user.country}\n                            </div>\n                        </div>\n                    </div>\n                    <div className='infoTable'>\n                        <div className=\"row\">\n                            <div className=\"col1\">\n                                <span className=\"label\">established</span>\n                            </div>\n                            <div className=\"col2\">\n                                <div className=\"createdAt\">\n                                    {Intl.DateTimeFormat('en-US', {\n                                        month: 'long',\n                                        day: 'numeric',\n                                        year: 'numeric'\n                                    }).format(this.props.organization.createdAt)}\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"row\">\n                            <div className=\"col1\">\n                                <span className=\"label\">last updated</span>\n                            </div>\n                            <div className=\"col2\">\n                                <div className=\"modifiedAt\">\n                                    {Intl.DateTimeFormat('en-US', {\n                                        month: 'long',\n                                        day: 'numeric',\n                                        year: 'numeric'\n                                    }).format(this.props.organization.modifiedAt)}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </Card>\n        )\n    }\n\n    renderAdminRequestsRow(org: Organization) {\n        if (!org) {\n            return\n        }\n        if (!org.relation) {\n            return\n        }\n        if (!(org.relation.type === UserRelationToOrganization.ADMIN ||\n            org.relation.type === UserRelationToOrganization.OWNER)) {\n            return\n        }\n        return (\n            <div className=\"row\">\n                <div className=\"col1\">\n                    <span className=\"label\">admin</span>\n                </div>\n                <div className=\"col2\">\n                    <div className=\"relation\">\n                        <div>\n                            <div>\n                                <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> group has\n                    {' '}\n                                <span style={{ fontWeight: 'bold' }}>{org.adminRequests.length}</span>\n                                {' '}\n                                pending request{org.adminRequests.length > 1 ? 's' : ''}\n                            </div>\n                            <div>\n                                <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization!.id}>\n                                    <Button>Manage Requests</Button>\n                                </NavLink>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n        )\n    }\n\n    renderAdminRequests(org: Organization) {\n        return (\n            <div>\n                <div>\n                    <Icon type=\"exclamation-circle\" theme=\"twoTone\" twoToneColor=\"orange\" /> group has\n                    {' '}\n                    <span style={{ fontWeight: 'bold' }}>{org.adminRequests.length}</span>\n                    {' '}\n                    pending request{org.adminRequests.length > 1 ? 's' : ''}\n                </div>\n                <div>\n                    <NavLink to={\"/manageOrganizationRequests/\" + this.props.organization!.id}>\n                        <Button>Manage Requests</Button>\n                    </NavLink>\n                </div>\n            </div>\n        )\n    }\n\n    renderRelationClass(org: Organization) {\n        switch (org.relation.type) {\n            case (UserRelationToOrganization.NONE):\n                return 'infoBox'\n            case (UserRelationToOrganization.VIEW):\n                return 'infoBox'\n            case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return 'infoBox relationRequestPending'\n            case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return 'infoBox relationInvitationPending'\n            case (UserRelationToOrganization.MEMBER):\n                return 'infoBox'\n            case (UserRelationToOrganization.ADMIN):\n                return 'infoBox'\n            case (UserRelationToOrganization.OWNER):\n                return 'infoBox'\n        }\n    }\n\n    renderUserRelationship() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <form className=\"table infoTable\">\n                {/* <div className=\"row\">\n                    <div className=\"col1\">\n                        <span className=\"label\">your relation</span>\n                    </div>\n                    <div className=\"col2\">\n                        <div className='relation'>\n                            {this.renderRelation(this.props.organization)}\n                        </div>\n                    </div>\n                </div> */}\n                {this.renderAdminRequestsRow(this.props.organization)}\n            </form>\n        )\n    }\n\n    renderAdminTasks() {\n        if (!this.props.organization) {\n            return\n        }\n        const org = this.props.organization\n        if (!(org.relation.type === UserRelationToOrganization.ADMIN ||\n            org.relation.type === UserRelationToOrganization.OWNER)) {\n            return\n        }\n        return (\n            <div className=\"adminTasksBox\">\n                <Card\n                    className=\"slimCard adminTasksCard\"\n                    title={<span><Icon type=\"team\" /> admin tasks</span>}\n                >\n                    {this.renderAdminRequests(this.props.organization)}\n                </Card>\n            </div>\n        )\n    }\n\n    renderJoinButton() {\n        if (!this.props.organization) {\n            return\n        }\n        if (this.props.organization.relation.type !== UserRelationToOrganization.VIEW) {\n            return\n        }\n        return (\n            <Button\n                onClick={this.onJoinClick.bind(this)}\n            >\n                Join this Organization\n                </Button>\n        )\n    }\n\n    renderHeader() {\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Viewing Org \"\n                            {this.props.organization && this.props.organization.name}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end' }}>\n                        {this.renderEditButton()}\n                        <NavLink to={`/organizations`}><Button type=\"danger\" icon=\"undo\">Return to Orgs</Button></NavLink>\n                        {this.renderJoinButton()}\n                        <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderLoadingHeader() {\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Loading Org...\n                        </span>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderMemberCard() {\n        const extras = [\n            (\n                <NavLink\n                    key=\"viewMembers\"\n                    to={`/viewMembers/${this.props.organization!.id}`}>\n                    <Button\n                        onClick={this.onViewMembers.bind(this)}\n                        icon=\"team\"></Button>\n                </NavLink>\n            )\n        ]\n        if (!this.props.organization) {\n            return\n        }\n        // if (this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n        //     this.props.organization.relation.type === UserRelationToOrganization.ADMIN) {\n        //     extras.push((\n        //         <Button icon=\"setting\"></Button>\n        //     ))\n        // }\n        let memberCount\n        if (this.isMember()) {\n            memberCount = (\n                <span style={{ color: 'rgba(150, 150, 150, 1)' }}>({this.props.organization.members.length})</span>\n            )\n        } else {\n            memberCount = ''\n        }\n        return (\n            <Card\n                className=\"slimCard membersCard\"\n                title={<span><Icon type=\"team\" /> members {memberCount}</span>}\n                extra={extras}\n            >\n                {this.renderMembers()}\n            </Card>\n        )\n    }\n\n    renderNarrativePermission(narrative: NarrativeResource) {\n        let label\n        let shareButton\n        let tooltip\n        switch (narrative.permission) {\n            case UserWorkspacePermission.NONE:\n                if (narrative.isPublic) {\n                    tooltip = \"You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it\"\n                    label = (\n                        <span>\n                            View Only (public)\n                            </span>\n                    )\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onRequestShare.call(this, narrative) }}>\n                            Request Access\n                        </Button>\n                    )\n                } else {\n                    tooltip = \"You have No access to this narrative narrative; you may not view, edit, run, or share it\"\n                    label = (\n                        <span>\n                            No Access\n                        </span>\n                    )\n                    shareButton = (\n                        <Button size=\"small\" onClick={() => { this.onRequestShare.call(this, narrative) }}>\n                            Request Access\n                        </Button>\n                    )\n                }\n                break\n            case UserWorkspacePermission.READ:\n                tooltip = \"You have View access to this narrative narrative; you may view it, but not edit, run, or share it\"\n                label = (\n                    <span>\n                        View Only\n                        </span>\n                )\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestShare.call(this, narrative) }}>\n                        Request Additional Access\n                    </Button>\n                )\n                break\n            case UserWorkspacePermission.WRITE:\n                tooltip = \"You have Edit access to this narrative narrative; you may view, edit, and run, but not share it\"\n                label = (\n                    <span>\n                        Edit\n                        </span>\n                )\n                shareButton = (\n                    <Button size=\"small\" onClick={() => { this.onRequestShare.call(this, narrative) }}>\n                        Request Admin Access\n                    </Button>\n                )\n                break\n            case UserWorkspacePermission.ADMIN:\n                tooltip = \"You have Admin access to this narrative narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Admin\n                        </span>\n                )\n                break\n            case UserWorkspacePermission.OWN:\n                tooltip = \"You are the Owner of this narrative; you may view, edit, run, and share it\"\n                label = (\n                    <span>\n                        Owner\n                        </span>\n                )\n                break\n            default:\n                label = (\n                    <span>\n                        Unknown\n                    </span>\n                )\n        }\n\n        return (\n            <Tooltip title={tooltip} placement=\"right\">\n                <span style={{ cursor: 'help' }}>\n                    <span className=\"field-label\">your permission</span>\n                    {label}{' '}{shareButton}\n                </span>\n            </Tooltip>\n        )\n    }\n\n    renderPublicPermission(narrative: NarrativeResource) {\n        if (narrative.isPublic) {\n            return (\n                <Tooltip title=\"This narrative is viewable by all KBase users\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <FontAwesomeIcon icon=\"globe\" /> Public Narrative\n                    </span>\n                </Tooltip>\n            )\n        } else {\n            return (\n                <Tooltip title=\"This narrative is only accessible to those with whom it is directly shared\" placement=\"right\">\n                    <span style={{ cursor: 'help' }}>\n                        <FontAwesomeIcon icon=\"user-lock\" /> Private Narrative\n                    </span>\n                </Tooltip>\n            )\n        }\n    }\n\n    renderNarrative(narrative: NarrativeResource) {\n        return (\n            <React.Fragment>\n                <div className=\"title\">{narrative.title}</div>\n                <div>{this.renderPublicPermission(narrative)}</div>\n                <div>{this.renderNarrativePermission(narrative)}</div>\n\n                {/* <div><i>abstract here?</i></div> */}\n                <div><i>One-liner abstract?</i></div>\n                <div><i>created, saved info here?</i></div>\n            </React.Fragment>\n        )\n    }\n\n    renderNarrativeMenu(narrative: NarrativeResource) {\n        if (!this.props.organization) {\n            return <div>\n                sorry, no org yet\n            </div>\n        }\n        const isAdmin = (this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === UserRelationToOrganization.ADMIN)\n        let menu\n        const org = this.props.organization\n        switch (org.relation.type) {\n            case (UserRelationToOrganization.NONE):\n                // should never occur\n                break;\n            case (UserRelationToOrganization.VIEW):\n            case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n            case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n            case (UserRelationToOrganization.MEMBER):\n                break;\n            case (UserRelationToOrganization.ADMIN):\n            case (UserRelationToOrganization.OWNER):\n                menu = (\n                    <Menu>\n                        <Menu.Item\n                            type=\"danger\"\n                            onClick={() => { this.onRemoveNarrative.call(this, narrative) }}\n                            key=\"removeNarrative\">\n                            <Icon type=\"delete\" /> Remove Narrative from Organization\n                        </Menu.Item>\n                    </Menu>\n                )\n        }\n        if (!menu) {\n            return\n        }\n        return (\n            <Dropdown overlay={menu} trigger={['click']}>\n                <Button shape=\"circle\">\n                    <Icon type=\"setting\" theme=\"filled\" style={{ fontSize: '120%' }} />\n                </Button>\n            </Dropdown>\n        )\n    }\n\n    renderNarratives() {\n        // const fakeNarratives = []\n        // for (let i = 0; i < 20; i += 1) {\n        //     fakeNarratives.push({\n        //         workspaceId: i,\n        //         // name: 'workspace_' + i,\n        //         title: 'Narrative Title Here ' + i,\n        //         public: Math.random() < 0.5 ? true : false,\n        //         perm: ['None', 'Read', 'Write', 'Admin', 'Own'][Math.floor(Math.random() * 4)]\n        //     })\n        // }\n\n        if (!this.isMember()) {\n            return (\n                <Card\n                    className=\"slimCard  narratives\"\n                    title={<span><Icon type=\"folder-open\" /> narratives</span>}\n                >\n                    <p style={{ textAlign: 'center', fontStyle: 'italic' }}>\n                        Sorry, Narratives are restricted to members only\n                </p>\n                </Card>\n            )\n        }\n        if (!this.props.organization) {\n            return <div>\n                sorry, no org yet\n            </div>\n        }\n        const extras = [\n            (\n                <NavLink\n                    key=\"requestAddNarrative\"\n                    to={`/requestAddNarrative/${this.props.organization!.id}`}>\n                    <Button\n                        onClick={this.onRequestAddNarrative.bind(this)}>\n                        <Icon type=\"plus\" /> Add a Narrative\n                    </Button>\n                </NavLink>\n            )\n        ]\n\n        if (this.props.organization.narratives.length === 0) {\n            return (\n                <Card\n                    className=\"slimCard  narratives\"\n                    title={<span><Icon type=\"folder-open\" /> narratives (none)</span>}\n                    extra={extras}\n                >\n                    <div>\n                        sorry, no narratives\n                </div>\n                </Card>\n            )\n\n        }\n\n        const narrativesTable = this.props.organization.narratives.map((narrative) => {\n            // create buttons or not, depending on being an admin\n\n            return (\n                <div className=\"narrative\" key={String(narrative.workspaceId)}>\n                    <div className=\"dataCol\">\n                        {this.renderNarrative(narrative)}\n                    </div>\n                    <div className=\"buttonCol\">\n                        {this.renderNarrativeMenu(narrative)}\n                    </div>\n                </div>\n            )\n        })\n\n        const narrativeCount = this.props.organization.narratives.length\n        return (\n            <Card\n                className=\"slimCard narratives narrativesCard scrollable-flex-column\"\n                title={<span><Icon type=\"folder-open\" /> narratives ({narrativeCount})</span>}\n                extra={extras}\n            >\n                <div className=\"narrativesTable\">\n                    {narrativesTable}\n                </div>\n            </Card>\n        )\n    }\n\n    render() {\n        switch (this.state.navigateTo) {\n            case NavigateTo.REQUEST_ADD_NARRATIVE:\n                return (\n                    <Redirect to={\"/requestAddNarrative\"} />\n                )\n            case NavigateTo.NONE:\n            default:\n            // do nothing.\n        }\n        if (typeof this.props.organization !== 'undefined') {\n            return (\n                <div className=\"ViewOrganization  scrollable-flex-column\">\n                    {this.renderHeader()}\n                    {this.renderOrgHeader()}\n                    <div className=\"mainRow  scrollable-flex-column\">\n                        <div className=\"mainColumn  scrollable-flex-column\">\n                            <div className=\"orgRow\">\n                                {this.renderOrg()}\n                            </div>\n                            <div className=\"narrativesRow scrollable-flex-column\">\n                                {this.renderNarratives()}\n                            </div>\n                        </div>\n                        <div className=\"infoColumn\">\n                            {/* <div className={this.renderRelationClass(this.props.organization)}>\n                                {this.renderAdminTasks()}\n                            </div> */}\n                            {this.renderAdminTasks()}\n                            <div className=\"infoBox\">\n                                {this.renderInfo()}\n                            </div>\n                            {this.renderMemberCard()}\n                            {/* <div className=\"infoBox\">\n                                {this.renderMembers()}\n                            </div> */}\n                        </div>\n                    </div>\n                </div>\n            )\n        }\n        return (\n            <div className=\"ViewOrganization\">\n                {this.renderLoadingHeader()}\n                Loading...\n            </div>\n        )\n    }\n}\n\nexport default ViewOrganization","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/viewOrg'\n\nimport ViewOrganization from './ViewOrganization'\n\n// Props for this component\n\n// The interface for this container component\nexport interface OwnProps {\n    id: string\n}\n\n// the interface for mapStateTo props\ninterface StateProps {\n    id: string,\n    state: types.ViewOrgState\n    organization?: types.Organization\n    error?: types.AppError,\n    username: string\n}\n\n// the interface for mapDispatchToProps\ninterface DispatchProps {\n    onViewOrg: (id: string) => void\n    onJoinOrg: () => void\n    onCancelJoinRequest: (requestId: string) => void\n    onAcceptInvitation: (requestId: string) => void\n    onRejectInvitation: (requestId: string) => void\n    onRemoveNarrative: (narrative: types.NarrativeResource) => void\n}\n\n// hmm this bit would be for the interface for the wrapped component.\n// can't really do that here, but _could_ export the interfaces above\n// and compose them thus in the wrapped component. But the wrapped component\n// should know nothing about this business\n// type Props = StateProps & DispatchProps & OwnProps\n\n\nfunction mapStateToProps({ viewOrg: { state, organization, error }, auth: { authorization: { username } } }: types.StoreState,\n    { id }: OwnProps): StateProps {\n    // TODO: of course this really needs to be an async fetch of the org info!\n    return {\n        id, state, organization, error, username\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.ViewOrgFetch>): DispatchProps {\n    return {\n        onViewOrg: (id: string) => {\n            dispatch(actions.viewOrgFetch(id) as any)\n        },\n        onJoinOrg: () => {\n            dispatch(actions.viewOrgJoinRequest() as any)\n        },\n        onCancelJoinRequest: (requestId: string) => {\n            dispatch(actions.viewOrgCancelJoinRequest(requestId) as any)\n        },\n        onAcceptInvitation: (requestId: string) => {\n            dispatch(actions.acceptJoinInvitation(requestId) as any)\n        },\n        onRejectInvitation: (requestId: string) => {\n            dispatch(actions.rejectJoinInvitation(requestId) as any)\n        },\n        onRemoveNarrative: (narrative: types.NarrativeResource) => {\n            dispatch(actions.removeNarrative(narrative) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(ViewOrganization)\n\n// export default connect(mapStateToProps, mapDispatchToProps)(ViewOrganization) \n\n","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport { StoreState, Organization, AppError, UIError, UIErrorType, FieldState, EditableOrganization } from '../../types'\nimport { Model, Validation } from '../../data/model'\n\n// ACTIONS\n\n// Loading the editor\nexport interface EditOrgEdit extends Action {\n    type: ActionFlag.EDIT_ORG_EDIT,\n    id: string\n}\n\nexport interface EditOrgEditStart extends Action {\n    type: ActionFlag.EDIT_ORG_EDIT_START,\n    id: string\n}\n\nexport interface EditOrgEditSuccess extends Action {\n    type: ActionFlag.EDIT_ORG_EDIT_SUCCESS,\n    editedOrganization: EditableOrganization,\n    organization: Organization\n}\n\nexport interface EditOrgEditError extends Action<ActionFlag.EDIT_ORG_EDIT_ERROR> {\n    type: ActionFlag.EDIT_ORG_EDIT_ERROR,\n    error: AppError\n}\n\n// Evaluating state of form \n\nexport interface EditOrgEvaluate extends Action<ActionFlag.EDIT_ORG_EVALUATE> {\n    type: ActionFlag.EDIT_ORG_EVALUATE\n}\n\nexport interface EditOrgEvaluateOK extends Action<ActionFlag.EDIT_ORG_EVALUATE_OK> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_OK\n}\n\nexport interface EditOrgEvaluateErrors extends Action<ActionFlag.EDIT_ORG_EVALUATE_ERRORS> {\n    type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n}\n\n// Saving\n\nexport interface EditOrgSave extends Action<ActionFlag.EDIT_ORG_SAVE> {\n    type: ActionFlag.EDIT_ORG_SAVE\n}\n\nexport interface EditOrgSaveStart extends Action<ActionFlag.EDIT_ORG_SAVE_START> {\n    type: ActionFlag.EDIT_ORG_SAVE_START\n}\n\nexport interface EditOrgSaveSuccess extends Action<ActionFlag.EDIT_ORG_SAVE_SUCCESS> {\n    type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n}\n\nexport interface EditOrgSaveError extends Action<ActionFlag.EDIT_ORG_SAVE_ERROR> {\n    type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n    error: AppError\n}\n\n// Updating name field\n\nexport interface EditOrgUpdateName extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME,\n    name: string\n}\n\nexport interface EditOrgUpdateNameSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n    name: string\n}\n\nexport interface EditOrgUpdateNameError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n    name: string,\n    error: UIError\n}\n\n// Updating gravatar hash field\n\nexport interface EditOrgUpdateGravatarHash extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH,\n    name: string\n}\n\nexport interface EditOrgUpdateGravatarHashSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n    gravatarHash: string\n}\n\nexport interface EditOrgUpdateGravatarHashError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n    gravatarHash: string,\n    error: UIError\n}\n\n// Updating id Field\n\n// export interface EditOrgUpdateId extends Action {\n//     type: ActionFlag.EDIT_ORG_UPDATE_ID,\n//     id: string\n// }\n\n// export interface EditOrgUpdateIdSuccess {\n//     type: ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS,\n//     id: string\n// }\n\n// export interface EditOrgUpdateIdError extends Action {\n//     type: ActionFlag.EDIT_ORG_UPDATE_ID_ERROR,\n//     id: string,\n//     error: UIError\n// }\n\n// Updating description field\n\nexport interface EditOrgUpdateDescription extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionSuccess {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n    description: string\n}\n\nexport interface EditOrgUpdateDescriptionError extends Action {\n    type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n    description: string,\n    error: UIError\n}\n\n\n// ACTION CREATORS\n\nexport function editOrgStart(id: string): EditOrgEditStart {\n    return {\n        type: ActionFlag.EDIT_ORG_EDIT_START,\n        id: id\n    }\n}\n\nexport function editOrgEditStart() {\n    return {\n        type: ActionFlag.EDIT_ORG_EDIT_START\n    }\n}\n\nexport function editOrgEditSuccess(editedOrganization: EditableOrganization, organization: Organization) {\n    return {\n        type: ActionFlag.EDIT_ORG_EDIT_SUCCESS,\n        editedOrganization: editedOrganization,\n        organization: organization\n    }\n}\n\nexport function editOrgEditError(error: AppError): EditOrgEditError {\n    return {\n        type: ActionFlag.EDIT_ORG_EDIT_ERROR,\n        error: error\n    }\n}\n\n// Evaluate\n\nexport function editOrgEvaluateOk(): EditOrgEvaluateOK {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_OK\n    }\n}\n\nexport function EditOrgEvaluateErrors(): EditOrgEvaluateErrors {\n    return {\n        type: ActionFlag.EDIT_ORG_EVALUATE_ERRORS\n    }\n}\n\n// Save\n\n// export function editOrgSave(): EditOrgSave {\n//     return {\n//         type: ActionFlag.EDIT_ORG_SAVE\n//     }\n// }\n\nexport function editOrgSaveStart(): EditOrgSaveStart {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_START\n    }\n}\n\nexport function editOrgSaveSuccess(): EditOrgSaveSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_SUCCESS\n    }\n}\n\nexport function editOrgSaveError(error: AppError): EditOrgSaveError {\n    return {\n        type: ActionFlag.EDIT_ORG_SAVE_ERROR,\n        error: error\n    }\n}\n\n// Update Name\n\nexport function editOrgUpdateNameSuccess(name: string): EditOrgUpdateNameSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_SUCCESS,\n        name: name\n    }\n}\n\nexport function editOrgUpdateNameError(name: string, error: UIError): EditOrgUpdateNameError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_NAME_ERROR,\n        name: name,\n        error: error\n    }\n}\n\n// export function editOrgUpdateIdSuccess(id: string): EditOrgUpdateIdSuccess {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_SUCCESS,\n//         id: id\n//     }\n// }\n\n// Update Gravatar Hash\n\nexport function editOrgUpdateGravatarHashSuccess(gravatarHash: string): EditOrgUpdateGravatarHashSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_SUCCESS,\n        gravatarHash: gravatarHash\n    }\n}\n\nexport function editOrgUpdateGravatarHashError(gravatarHash: string, error: UIError): EditOrgUpdateGravatarHashError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_GRAVATAR_HASH_ERROR,\n        gravatarHash: gravatarHash,\n        error: error\n    }\n}\n\n\n// Update Id\n\n// export function editOrgUpdateIdError(id: string, error: UIError): EditOrgUpdateIdError {\n//     return {\n//         type: ActionFlag.EDIT_ORG_UPDATE_ID_ERROR,\n//         id: id,\n//         error: error\n//     }\n// }\n\nexport function editOrgUpdateDescriptionSuccess(description: string): EditOrgUpdateDescriptionSuccess {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,\n        description: description\n    }\n}\n\nexport function editOrgUpdateDescriptionError(description: string, error: UIError): EditOrgUpdateDescriptionError {\n    return {\n        type: ActionFlag.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,\n        description: description,\n        error: error\n    }\n}\n\n// ACTION THUNKS\n\nexport function editOrgEdit(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(editOrgStart(organizationId))\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config }\n        } = getState()\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        return model.getOrg(organizationId)\n            .then((org) => {\n                const editableOrg: EditableOrganization = {\n                    id: {\n                        value: org.id,\n                        status: FieldState.UNEDITED_OK,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    },\n                    name: {\n                        value: org.name,\n                        status: FieldState.UNEDITED_OK,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    },\n                    gravatarHash: {\n                        value: org.gravatarHash,\n                        status: FieldState.UNEDITED_OK,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    },\n                    description: {\n                        value: org.description,\n                        status: FieldState.UNEDITED_OK,\n                        error: {\n                            type: UIErrorType.NONE,\n                            message: ''\n                        }\n                    }\n                }\n                dispatch(editOrgEditSuccess(editableOrg, org))\n            })\n            .catch((err) => {\n                console.error('load org error', err)\n                dispatch(editOrgEditError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n\nexport function editOrgSave() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(editOrgSaveStart())\n\n        const { auth: { authorization: { token, username } },\n            editOrg: { organizationId, editedOrganization },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (!editedOrganization) {\n            dispatch(editOrgSaveError({\n                code: 'app',\n                message: 'The new organization data does not yet exist'\n            }))\n            return;\n        }\n\n        const update = {\n            name: editedOrganization.name.value,\n            gravatarHash: editedOrganization.gravatarHash.value,\n            description: editedOrganization.description.value\n        }\n\n        model.updateOrg(organizationId, update)\n            .then(() => {\n                dispatch(editOrgSaveSuccess())\n            })\n            .catch((error) => {\n                console.error('error adding', editedOrganization, error)\n                dispatch(editOrgSaveError({\n                    code: 'invalid',\n                    message: error.message\n                }))\n            })\n    }\n}\n\nexport function editOrgEvaluate() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const { editOrg: { editedOrganization } } = getState()\n\n        const { editOrg: editState } = getState()\n\n        if (!editedOrganization) {\n            dispatch(EditOrgEvaluateErrors())\n            return\n        }\n\n        if (!(editedOrganization.name.status === FieldState.EDITED_OK ||\n            editedOrganization.name.status === FieldState.UNEDITED_OK)) {\n            dispatch(EditOrgEvaluateErrors())\n            return\n        }\n\n        // if (editedOrganization.id.status !== FieldState.EDITED_OK) {\n        //     dispatch(EditOrgEvaluateErrors())\n        //     return\n        // }\n\n        if (!(editedOrganization.gravatarHash.status === FieldState.EDITED_OK ||\n            editedOrganization.gravatarHash.status === FieldState.UNEDITED_OK)) {\n            dispatch(EditOrgEvaluateErrors())\n            return\n        }\n\n        if (!(editedOrganization.description.status === FieldState.EDITED_OK ||\n            editedOrganization.description.status === FieldState.UNEDITED_OK)) {\n            dispatch(EditOrgEvaluateErrors())\n            return\n        }\n\n        dispatch(editOrgEvaluateOk())\n    }\n}\n\nexport function editOrgUpdateName(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validatedName, error] = Validation.validateOrgName(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(editOrgUpdateNameError(validatedName, error))\n        } else {\n            dispatch(editOrgUpdateNameSuccess(validatedName))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function editOrgUpdateGravatarHash(name: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>) => {\n        const [validateGravatarHash, error] = Validation.validateOrgGravatarHash(name)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(editOrgUpdateGravatarHashError(validateGravatarHash, error))\n        } else {\n            dispatch(editOrgUpdateGravatarHashSuccess(validateGravatarHash))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}\n\nexport function editOrgUpdateDescription(description: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>,\n        getState: () => StoreState) => {\n        const { auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n        const [validatedDescription, error] = model.validateOrgDescription(description)\n\n        if (error.type === UIErrorType.ERROR) {\n            dispatch(editOrgUpdateDescriptionError(validatedDescription, error))\n        } else {\n            dispatch(editOrgUpdateDescriptionSuccess(validatedDescription))\n        }\n        dispatch(editOrgEvaluate())\n    }\n}","import * as React from 'react'\nimport { Redirect } from 'react-router-dom';\nimport marked from 'marked';\nimport { Button, Icon, Modal } from 'antd';\nimport md5 from 'md5'\n\nimport { EditableOrganization, SaveState, ValidationState, EditState, Organization } from '../../types';\n\nimport './component.css'\n\nimport Header from '../Header';\nimport OrganizationHeader from '../organizationHeader/container';\n\nexport interface EditOrganizationProps {\n    id: string\n    editState: EditState\n    saveState: SaveState\n    validationState: ValidationState\n    editedOrganization: EditableOrganization\n    organization: Organization | null\n    onEditOrgEdit: (id: string) => void\n    onEditOrgSave: () => void\n    onUpdateName: (name: string) => void\n    onUpdateGravatarHash: (gravatarHash: string) => void\n    // onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    VIEWER\n}\n\nexport interface EditOrganizationState {\n    cancelToBrowser: boolean;\n    cancelToViewer: boolean;\n    navigateTo: NavigateTo;\n}\n\nclass EditOrganization extends React.Component<EditOrganizationProps, EditOrganizationState> {\n\n    origin: string;\n\n    gravatarEmail: React.RefObject<HTMLInputElement>\n\n    constructor(props: EditOrganizationProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false,\n            navigateTo: NavigateTo.NONE\n        }\n\n        this.gravatarEmail = React.createRef()\n\n        this.origin = document.location!.origin\n\n        this.props.onEditOrgEdit(this.props.id)\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Organization Editor Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the organizations editor...</p>\n                </div>\n            )\n        })\n    }\n\n\n    onGravatarEmailSync() {\n        let email;\n        if (this.gravatarEmail.current) {\n            email = this.gravatarEmail.current.value\n        } else {\n            email = 'n/a'\n        }\n        const hashed = md5(email)\n        this.props.onUpdateGravatarHash(hashed);\n    }\n\n    onClickCancelToBrowser() {\n        if (!this.isModified()) {\n            this.setState({ cancelToBrowser: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToBrowser: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onClickCancelToViewer() {\n        if (!this.isModified()) {\n            this.setState({ cancelToViewer: true })\n            return\n        }\n\n        const confirm = () => {\n            this.setState({ cancelToViewer: true })\n        }\n        const cancel = () => {\n        }\n        Modal.confirm({\n            title: 'Leave the editor?',\n            content: (\n                <div>\n                    <p>You have made changes on this edit form.</p>\n\n                    <p>If you leave the editor without saving, any <i>changes they will be lost</i>.</p>\n\n                    <p><b>Continue to leave the editor?</b></p>\n                </div>\n            ),\n            onOk: confirm,\n            onCancel: cancel,\n            okText: 'Yes',\n            cancelText: 'No'\n        })\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault();\n        this.props.onEditOrgSave();\n    }\n\n    onNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateName(e.target.value);\n    }\n\n    onGravatarHashChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        this.props.onUpdateGravatarHash(e.target.value);\n    }\n\n    onDescriptionChange(e: React.ChangeEvent<HTMLTextAreaElement>): void {\n        e.persist()\n        this.props.onUpdateDescription(e.target.value);\n    }\n\n    onIdChange(e: React.ChangeEvent<HTMLInputElement>) {\n        e.persist();\n        // this.props.onUpdateId(e.target.value);\n        console.warn('no updating id, naughty!')\n    }\n\n    canSave() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            this.props.validationState === ValidationState.VALID &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY ||\n                this.props.saveState === SaveState.SAVED)\n        )\n    }\n\n    isModified() {\n        return (\n            this.props.editState === EditState.EDITED &&\n            (this.props.saveState === SaveState.NEW ||\n                this.props.saveState === SaveState.READY)\n        )\n    }\n\n    renderForm() {\n        return (\n            <form id=\"editOrganizationForm\" className=\"editor\" onSubmit={this.onSubmit.bind(this)}>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">name</div>\n                    <div className=\"col2\">\n                        <input value={this.props.editedOrganization.name.value || ''}\n                            onChange={this.onNameChange.bind(this)} />\n                        {this.props.editedOrganization.name.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.name.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row gravatarHash\">\n                    <div className=\"col1 field-label\">gravatar hash</div>\n                    <div className=\"col2\">\n                        <div style={{ display: 'flex', flexDirection: 'row', marginBottom: '4px' }}>\n                            <div style={{ flex: '1 1 0px' }}>\n                                <input ref={this.gravatarEmail} placeholder=\"Provide your gravatar-linked email address, if any\" />\n                            </div>\n                            <div style={{ flex: '0 0 auto' }}>\n                                <Button\n                                    icon=\"arrow-down\"\n                                    style={{ height: '100%' }}\n                                    onClick={this.onGravatarEmailSync.bind(this)} />\n                            </div>\n                        </div>\n\n                        <input value={this.props.editedOrganization.gravatarHash.value || ''}\n                            onChange={this.onGravatarHashChange.bind(this)} />\n                        {this.props.editedOrganization.gravatarHash.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.gravatarHash.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1 field-label\">id</div>\n                    <div className=\"col2\">\n                        <input value={this.props.editedOrganization.id.value || ''}\n                            onChange={this.onIdChange.bind(this)} />\n                        {this.props.editedOrganization.id.error ? (<span style={{ color: 'red' }}>{this.props.editedOrganization.id.error.message}</span>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\" style={{ flex: '1 1 0px', minHeight: '30em', maxHeight: '60em' }}>\n                    <div className=\"col1 field-label\">description</div>\n                    <div className=\"col2\">\n                        <textarea value={this.props.editedOrganization.description.value || ''}\n                            onChange={this.onDescriptionChange.bind(this)} />\n                        {this.props.editedOrganization.description.error ? (<div style={{ color: 'red' }}>{this.props.editedOrganization.description.error.message}</div>) : ''}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\"></div>\n                    <div className=\"col2\">\n                        {/* <div className=\"footer\">\n                            <Button form=\"newOrganizationForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\">Save</Button>\n                            <Button type=\"danger\"\n                                onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n                        </div> */}\n                    </div>\n                </div>\n            </form>\n        )\n    }\n\n    getOrgAvatarUrl(org: EditableOrganization) {\n        // const defaultImages = [\n        //     'orgs-64.png',\n        //     'unicorn-64.png'\n        // ]\n        // if (!org.gravatarHash.value) {\n        //     return defaultImages[Math.floor(Math.random() * 2)]\n        // }\n        if (!org.gravatarHash.value) {\n            return 'unicorn-64.png'\n        }\n        const gravatarDefault = 'identicon';\n\n        return 'https://www.gravatar.com/avatar/' + org.gravatarHash.value + '?s=64&amp;r=pg&d=' + gravatarDefault;\n    }\n\n    renderOrgAvatar(org: EditableOrganization) {\n        return (\n            <img style={{ width: 64, height: 64 }}\n                src={this.getOrgAvatarUrl(org)} />\n        )\n    }\n\n    renderPreview() {\n        return <form className=\"preview\">\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"name\">\n                        {this.props.editedOrganization.name.value || ''}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"gravatarHash\">\n                        {this.renderOrgAvatar(this.props.editedOrganization)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\">\n                <div className=\"col2\">\n                    <div className=\"id\">\n                        <span style={{ color: 'silver' }}>{this.origin}/#orgs/organizations/</span>\n                        {this.props.editedOrganization.id.value || (<span style={{ fontStyle: 'italic' }}>organization id here</span>)}\n                    </div>\n                </div>\n            </div>\n            <div className=\"row\" style={{ flex: '1 1 0px' }}>\n                <div className=\"col2\">\n                    <div className=\"description\"\n                        dangerouslySetInnerHTML={({ __html: marked(this.props.editedOrganization.description.value || '') })}\n                    />\n                </div>\n            </div>\n        </form>\n    }\n\n    renderState() {\n        const { editState, validationState, saveState } = this.props;\n        const label = 'edit: ' + editState + ', valid: ' + validationState + ', save: ' + saveState\n        return (\n            <span style={{ marginRight: '10px' }}>{label}</span>\n        )\n    }\n\n    renderHeader() {\n        const orgName = this.props.editedOrganization.name.value || (<span style={{ fontStyle: 'italic', color: 'gray' }}>org name will appear here when you edit the name field</span>)\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            {/* <FaPlusCircle style={{ verticalAlign: 'middle' }} /> */}\n                            <Icon type=\"edit\" />\n                            {' '}\n                            Editing Org \"\n                            {orgName}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        {/* {this.renderState()} */}\n                        <Button icon=\"save\"\n                            form=\"editOrganizationForm\"\n                            key=\"submit\"\n                            disabled={!this.canSave.call(this)}\n                            htmlType=\"submit\">\n                            {/* <Icon type=\"save\" /> */}\n                            {/* <FaSave style={{ verticalAlign: 'center' }} /> */}\n                            Save\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToViewer.bind(this)}>\n                            {/* <FaUndo style={{ verticalAlign: 'center' }} />  */}\n                            Return to this Org\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToBrowser.bind(this)}>\n                            {/* <FaUndo style={{ verticalAlign: 'center' }} />  */}\n                            Return to Orgs Browser\n                        </Button>\n                        <Button shape=\"circle\" icon=\"info\" onClick={this.onShowInfo.bind(this)}></Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    // renderFooter() {\n    //     return (\n    //         <div className=\"footerRow\">\n    //             <div className=\"editorColumn\">\n    //                 <div className=\"row\">\n    //                     <div className=\"col1\">\n    //                     </div>\n    //                     <div className=\"col2\">\n    //                         <div className=\"footer\">\n    //                             <Button form=\"editOrganizationForm\"\n    //                                 key=\"submit\"\n    //                                 htmlType=\"submit\">Save</Button>\n    //                             <Button type=\"danger\"\n    //                                 onClick={this.onClickCancel.bind(this)}>Cancel</Button>\n    //                         </div>\n    //                     </div>\n    //                 </div>\n    //             </div>\n    //             <div className=\"previewColumn\">\n\n    //             </div>\n    //         </div>\n    //     )\n    // }\n\n    renderLoadingHeader() {\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Loading Org Editor...\n                        </span>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    // renderHeader() {\n    //     let orgName: string\n    //     return (\n    //         <Header>\n    //             <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n    //                 <div style={{ flex: '0 0 auto' }}>\n    //                     <span>\n    //                         <Icon type=\"tool\" />\n    //                         {' '}\n    //                         Managing your membership in the Organization \"\n    //                         {this.props.organization.name}\n    //                         \"\n    //                     </span>\n    //                 </div>\n    //                 <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n    //                     <Button icon=\"undo\"\n    //                         type=\"danger\"\n    //                         onClick={this.doCancelToViewer.bind(this)}>\n    //                         Return to this Org\n    //                     </Button>\n    //                     <Button icon=\"undo\"\n    //                         type=\"danger\"\n    //                         onClick={this.doCancelToBrowser.bind(this)}>\n    //                         Return to Orgs Browser\n    //                     </Button>\n    //                     <Button\n    //                         shape=\"circle\"\n    //                         icon=\"info\"\n    //                         onClick={this.doShowInfo.bind(this)}>\n    //                     </Button>\n    //                 </div>\n    //             </div>\n    //         </Header>\n    //     )\n    // }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        console.log('org?', this.props.organization)\n        if (!this.props.organization) {\n            return\n        }\n\n        return (\n            <OrganizationHeader organization={this.props.organization} />\n        )\n    }\n\n    render() {\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.id} />\n        }\n\n        // // TODO: this is just a prop for today.\n        // if (this.props.saveState === SaveState.SAVED) {\n        //     return <Redirect push to={\"/editOrganization/\" + this.props.editedOrganization.id.value} />\n        // }\n\n        if (!this.props.editedOrganization) {\n            return (\n                <div className=\"EditOrganization\">\n                    {this.renderLoadingHeader()}\n                </div>\n            )\n        }\n\n        return (\n            <div className=\"EditOrganization\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <div className=\"mainRow\">\n                    <div className=\"editorColumn\">\n                        <h3>Editor</h3>\n                        {this.renderForm()}\n                    </div>\n                    <div className=\"previewColumn\">\n                        <h3>Preview</h3>\n                        {this.renderPreview()}\n                    </div>\n                </div>\n                {/* {this.renderFooter()} */}\n            </div>\n        )\n    }\n}\n\nexport default EditOrganization","import { Dispatch } from 'redux';\nimport { connect } from 'react-redux';\n\nimport { StoreState, EditableOrganization, EditState, SaveState, ValidationState, Organization } from '../../types';\nimport {\n    EditOrgEdit, editOrgSave,\n    editOrgUpdateName,\n    // editOrgUpdateId, \n    editOrgUpdateDescription, editOrgEdit, editOrgUpdateGravatarHash\n} from '../../redux/actions/editOrg';\n\nimport EditOrganization from './component';\n\ninterface OwnProps {\n    id: string\n}\n\nexport interface StateProps {\n    editState: EditState,\n    saveState: SaveState,\n    validationState: ValidationState,\n    editedOrganization: EditableOrganization,\n    organization: Organization | null\n}\n\nexport interface DispatchProps {\n    onEditOrgEdit: (id: string) => void,\n    onEditOrgSave: () => void,\n    onUpdateName: (name: string) => void,\n    onUpdateGravatarHash: (gravatarHash: string) => void,\n    // onUpdateId: (id: string) => void,\n    onUpdateDescription: (description: string) => void\n}\n\nexport function mapStateToProps({ editOrg: { editState, saveState, validationState, editedOrganization, organization } }: StoreState): StateProps {\n\n    return {\n        editState,\n        saveState,\n        validationState,\n        editedOrganization,\n        organization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<EditOrgEdit>): DispatchProps {\n    return {\n        onEditOrgEdit: (id: string) => {\n            dispatch(editOrgEdit(id) as any)\n        },\n        onEditOrgSave: () => {\n            dispatch(editOrgSave() as any)\n        },\n        onUpdateName: (name: string) => {\n            dispatch(editOrgUpdateName(name) as any)\n        },\n        onUpdateGravatarHash: (gravatarHash: string) => {\n            dispatch(editOrgUpdateGravatarHash(gravatarHash) as any)\n        },\n        // onUpdateId: (id) => {\n        //     dispatch(editOrgUpdateId(id) as any)\n        // },\n        onUpdateDescription: (description) => {\n            dispatch(editOrgUpdateDescription(description) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(EditOrganization)","import * as React from 'react'\nimport './Auth.css'\n\nimport * as types from '../types'\nimport { Button } from 'antd';\n\n\nexport interface AuthState {\n\n}\n\nclass Auth extends React.Component<types.AuthProps, AuthState> {\n\n    tokenRef: React.RefObject<HTMLInputElement>\n\n    constructor(props: types.AuthProps) {\n        super(props)\n\n        this.tokenRef = React.createRef()\n\n        this.props.checkAuth()\n    }\n\n    onLogoutClick() {\n        this.props.onRemoveAuthorization()\n    }\n\n    onLoginClick() {\n        if (this.tokenRef.current === null) {\n            return\n        }\n        const token = this.tokenRef.current.value\n        if (token.length === 0) {\n            return\n        }\n        this.props.onAddAuthorization(token)\n    }\n\n    buildAuthForm() {\n        return (\n            <div className=\"Auth-form\">\n                Token: <input ref={this.tokenRef} />\n                <Button\n                    icon=\"save\"\n                    htmlType=\"submit\"\n                    onClick={this.onLoginClick.bind(this)} >\n                    Assign Token\n                </Button>\n            </div>\n        )\n    }\n\n    buildAuthToolbar() {\n        return (\n            <div className=\"Auth-toolbar\">\n                Logged in as <b><span>{this.props.authorization.authorization.realname}</span> (<span>{this.props.authorization.authorization.username}</span></b>)\n                {' '}\n                <Button icon=\"logout\" onClick={this.onLogoutClick.bind(this)}>Sign out</Button>\n            </div>\n        )\n    }\n\n    buildAuthDev() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.buildAuthToolbar()}\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized! Enter a user token below</p>\n                        {this.buildAuthForm()}\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Error</p>\n                        {this.props.authorization.message}\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n    }\n\n    buildAuthProd() {\n        switch (this.props.authorization.status) {\n            case types.AuthState.NONE:\n            case types.AuthState.CHECKING:\n                return (\n                    <div></div>\n                )\n            case types.AuthState.AUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-authorized scrollable-flex-column\">\n                        {this.props.children}\n                    </div>\n                )\n            case types.AuthState.UNAUTHORIZED:\n                return (\n                    <div className=\"Auth Auth-unauthorized scrollable-flex-column\">\n                        <p>Not authorized!</p>\n                    </div>\n                )\n            case types.AuthState.ERROR:\n                return (\n                    <div className=\"Auth Auth-error scrollable-flex-column\">\n                        <p>Error: ??</p>\n                    </div>\n                )\n            default:\n                return (\n                    <div></div>\n                )\n        }\n\n    }\n\n    render() {\n        return (\n            <div className=\"Auth scrollable-flex-column\">\n                {this.props.hosted ? this.buildAuthProd() : this.buildAuthDev()}\n            </div>\n        )\n\n    }\n}\n\nexport default Auth","\nexport interface RootInfo {\n    version: string,\n    servertime: number\n}\n\ninterface AuthEndpoints {\n    root: string,\n    tokenInfo: string,\n    apiMe: string,\n    me: string,\n    loginStart: string,\n    loginChoice: string,\n    loginCreate: string,\n    loginUsernameSuggest: string,\n    loginPick: string,\n    loginCancel: string,\n    logout: string,\n    linkStart: string,\n    linkCancel: string,\n    linkChoice: string,\n    linkPick: string,\n    linkRemove: string,\n    tokens: string,\n    tokensRevoke: string,\n    tokensRevokeAll: string,\n    userSearch: string,\n    adminUserSearch: string,\n    adminUser: string\n}\n\nconst endpoints: AuthEndpoints = {\n    root: '',\n    tokenInfo: 'api/V2/token',\n    apiMe: 'api/V2/me',\n    me: 'me',\n    loginStart: 'login/start',\n    logout: 'logout',\n    loginChoice: 'login/choice',\n    loginCreate: 'login/create',\n    loginUsernameSuggest: 'login/suggestname',\n    loginPick: 'login/pick',\n    loginCancel: 'login/cancel',\n    linkStart: 'link/start',\n    linkCancel: 'link/cancel',\n    linkChoice: 'link/choice',\n    linkPick: 'link/pick',\n    linkRemove: 'me/unlink',\n    tokens: 'tokens',\n    tokensRevoke: 'tokens/revoke',\n    tokensRevokeAll: 'tokens/revokeall',\n    userSearch: 'api/V2/users/search',\n    adminUserSearch: 'api/V2/admin/search',\n    adminUser: 'api/V2/admin/user'\n}\n\nexport interface TokenInfo {\n    created: number,\n    expires: number,\n    id: string,\n    name: string | null,\n    token: string,\n    type: string,\n    user: string,\n    cachefor: number\n}\n\nexport interface Identity {\n    id: string,\n    provider: string,\n    username: string\n}\n\nexport interface Role {\n    id: string,\n    desc: string\n}\n\nexport interface Account {\n    created: number,\n    customroles: Array<string>,\n    display: string,\n    email: string,\n    idents: Array<Identity>,\n    lastLogin: number,\n    local: boolean,\n    roles: Array<Role>,\n    user: string\n}\nexport class AuthClient {\n    url: string;\n\n    constructor({ url }: { url: string }) {\n        this.url = url\n    }\n\n    makePath(path: Array<string> | string): string {\n        if (typeof path === 'string') {\n            return [this.url].concat([path]).join('/');\n        }\n        return [this.url].concat(path).join('/');\n    }\n\n\n    root(): Promise<RootInfo> {\n        return fetch(this.makePath([endpoints.root]), {\n            headers: {\n                Accept: 'application/json'\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                return response.json()\n            })\n            .then((result) => {\n                return result as RootInfo\n            })\n    }\n\n    getTokenInfo(token: string): Promise<TokenInfo> {\n        return fetch(this.makePath([endpoints.tokenInfo]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as TokenInfo\n            })\n    }\n\n    getMe(token: string): Promise<Account> {\n        return fetch(this.makePath([endpoints.apiMe]), {\n            headers: {\n                Accept: 'application/json',\n                Authorization: token\n            },\n            mode: 'cors'\n        })\n            .then((response) => {\n                if (response.status !== 200) {\n                    throw new Error(response.statusText)\n                }\n                return response.json()\n            })\n            .then((result) => {\n                return result as Account\n            })\n    }\n\n\n    // getInfo() : Promise<GroupsServiceInfo> {\n    //     return fetch(this.url + '/', {\n    //         headers: {\n    //             Authorization: this.token,\n    //             Accept: 'application/json'\n    //         },\n    //         mode: 'cors'\n    //     })\n    //         .then((response) => {\n    //             return response.json();\n    //         })\n    //         .then((result) => {\n    //             return result as GroupsServiceInfo;\n    //         });\n    // }\n\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport * as Cookies from 'es-cookie'\n\nimport { ActionFlag } from './index'\nimport { AppError, StoreState } from '../../types';\nimport { AuthClient, TokenInfo, Account } from '../../data/auth';\n\n// Action Definitions\n\nexport interface AuthCheck extends Action {\n    type: ActionFlag.AUTH_CHECK\n}\n\nexport interface AuthCheckStart extends Action {\n    type: ActionFlag.AUTH_CHECK_START\n}\n\nexport interface AuthCheckError extends Action {\n    type: ActionFlag.AUTH_CHECK_ERROR,\n    error: AppError\n}\n\nexport interface AuthAuthorized extends Action {\n    type: ActionFlag.AUTH_AUTHORIZED,\n    token: string\n    username: string,\n    realname: string,\n    roles: Array<string>\n}\n\nexport interface AuthUnauthorized extends Action {\n    type: ActionFlag.AUTH_UNAUTHORIZED\n}\n\nexport interface AuthRemoveAuthorization extends Action {\n    type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n}\n\nexport interface AuthAddAuthorization extends Action {\n    type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n    token: string\n}\n\n// Action Creators\n\n\nexport function authCheckStart(): AuthCheckStart {\n    return {\n        type: ActionFlag.AUTH_CHECK_START\n    }\n}\n\nexport function authCheckError(error: AppError): AuthCheckError {\n    return {\n        type: ActionFlag.AUTH_CHECK_ERROR,\n        error\n    }\n}\n\nexport function authAuthorized(token: string, username: string, realname: string, roles: Array<string>): AuthAuthorized {\n    return {\n        type: ActionFlag.AUTH_AUTHORIZED,\n        token, username, realname, roles\n    }\n}\n\nexport function authUnauthorized(): AuthUnauthorized {\n    return {\n        type: ActionFlag.AUTH_UNAUTHORIZED\n    }\n}\n\n// export function authRemoveAuthorization(): AuthRemoveAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_REMOVE_AUTHORIZATION\n//     }\n// }\n\n// export function authAddAuthorization(token: string): AuthAddAuthorization {\n//     return {\n//         type: ActionFlag.AUTH_ADD_AUTHORIZATION,\n//         token: token\n//     }\n// }\n\n// Action Thunks\n\nexport function checkAuth() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(authCheckStart())\n\n        // TODO: get the auth from the kbase-ui integration api, perhaps a postmessage call\n\n        const token = Cookies.get('kbase_session')\n        if (!token) {\n            dispatch(authUnauthorized())\n            return\n        }\n        const auth = new AuthClient({ url: '/services/auth' })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function authRemoveAuthorization() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // remove cookie\n        Cookies.remove('kbase_session')\n\n        // remove auth in state\n        dispatch(authUnauthorized())\n    }\n}\n\nexport function authAddAuthorization(token: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        // add cookie\n        Cookies.set('kbase_session', token)\n\n        // TODO: get auth info\n        const auth = new AuthClient({ url: '/services/auth' })\n        Promise.all([\n            auth.getTokenInfo(token),\n            auth.getMe(token)\n        ])\n            .then(([tokenInfo, account]) => {\n                const roles = account.roles.map(({ id, desc }) => id)\n                dispatch(authAuthorized(token, account.user, account.display, roles))\n            })\n            .catch((err) => {\n                console.error('auth check error', err)\n                dispatch(authCheckError({\n                    code: 'error',\n                    message: err.message\n                }))\n            })\n\n    }\n}","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport { StoreState, AuthState, Authorization } from '../types'\nimport Auth from '../components/Auth'\nimport * as actions from '../redux/actions/auth'\n\nexport interface OwnProps {\n    hosted: boolean\n}\n\ninterface StateProps {\n    authorization: Authorization\n    // authStatus: AuthState,\n    // token: string | null,\n    // username: string | null,\n    // realname: string | null,\n}\n\ninterface DispatchProps {\n    checkAuth: () => void,\n    onRemoveAuthorization: () => void,\n    onAddAuthorization: (token: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    const { auth } = state\n    return {\n        authorization: auth\n        // authStatus: status,\n        // token: authorization.token || null,\n        // username: authorization.username || null,\n        // realname: authorization.realname || null\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        checkAuth: () => {\n            dispatch(actions.checkAuth() as any)\n        },\n        onRemoveAuthorization: () => {\n            dispatch(actions.authRemoveAuthorization() as any)\n        },\n        onAddAuthorization: (token: string) => {\n            dispatch(actions.authAddAuthorization(token) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(Auth)","\nimport uuidv4 from 'uuid/v4'\n\ninterface ListenerParams {\n    name: string,\n    onSuccess: (payload: Payload) => void,\n    onError: (error: Error) => void\n}\n\nclass Listener {\n    name: string;\n    onSuccess: (payload: Payload) => void;\n    onError: (error: Error) => void;\n\n    constructor({ name, onSuccess, onError }: ListenerParams) {\n        this.name = name;\n        this.onSuccess = onSuccess;\n        this.onError = onError;\n    }\n}\n\ntype Payload = any;\n\ninterface WaitingListenerParams extends ListenerParams {\n    timeout?: number\n}\n\nclass WaitingListener extends Listener {\n    started: Date;\n    timeout: number;\n\n    constructor(params: WaitingListenerParams) {\n        super(params);\n        this.started = new Date();\n        this.timeout = params.timeout || 5000;\n    }\n}\n\ninterface Envelope {\n    channelId: string\n    id: string\n}\n\nclass Message {\n    name: string;\n    payload: any;\n    id: string;\n    created: Date;\n    channel: any\n    envelope: Envelope | null\n\n    constructor({ name, payload, channel }: { name: string, payload: any, channel: any }) {\n        this.name = name\n        this.payload = payload\n        this.id = uuidv4()\n        this.created = new Date()\n        this.channel = channel\n        this.envelope = null;\n    }\n\n    getMessage() {\n        return {\n            envelope: {\n                id: this.id,\n                created: this.created,\n                channel: this.channel\n            },\n            name: this.name,\n            payload: this.payload\n        };\n    }\n}\n\ninterface Handler {\n    started: Date,\n    handler: (response: any) => any\n}\n\ninterface ChannelParams {\n    window: Window,\n    host: string,\n    channelId?: string\n}\n\nexport class Channel {\n    window: Window\n    host: string\n    id: string\n    awaitingResponse: Map<string, Handler>\n    waitingListeners: Map<string, Array<Listener>>\n    listeners: Map<string, Array<Listener>>\n    lastId: number\n    sentCount: number\n    receivedCount: number\n    unwelcomeReceivedCount: number\n    unwelcomeReceivedCountThreshhold: number\n    unwelcomeReceiptWarning: boolean\n    unwelcomeReceiptWarningCount: number\n    currentListener: ((message: MessageEvent) => void) | null\n\n    constructor(params: ChannelParams) {\n        // The given window upon which we will listen for messages.\n        this.window = params.window;\n\n        // The host for the window; required for postmessage\n        if (this.window.document === null) {\n            throw new Error('No document')\n        }\n        if (this.window.document.location === null) {\n            throw new Error('No location')\n        }\n        this.host = params.host || this.window.document.location.origin;\n\n        // The channel id. Used to filter all messages received to\n        // this channel.\n        this.id = params.channelId || uuidv4()\n\n\n        this.awaitingResponse = new Map<string, Handler>()\n        this.waitingListeners = new Map<string, Array<Listener>>()\n        this.listeners = new Map<string, Array<Listener>>()\n\n        this.lastId = 0\n        this.sentCount = 0\n        this.receivedCount = 0\n\n        this.unwelcomeReceivedCount = 0\n        this.unwelcomeReceivedCountThreshhold = 100\n        this.unwelcomeReceiptWarning = true\n        this.unwelcomeReceiptWarningCount = 0\n        this.currentListener = null\n    }\n\n    genId() {\n        this.lastId += 1;\n        return 'msg_' + String(this.lastId);\n    }\n\n    receiveMessage(messageEvent: MessageEvent) {\n        const message = messageEvent.data as Message;\n        if (!message) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message data; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!message.envelope) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('No message envelope, not from KBase; message ignored', messageEvent);\n            }\n            return;\n        }\n        if (!(message.envelope.channelId === this.id)) {\n            this.unwelcomeReceivedCount++;\n            if (this.unwelcomeReceiptWarning) {\n                console.warn('Message envelope does not match this channel\\'s id', messageEvent);\n            }\n            return;\n        }\n        if (this.unwelcomeReceiptWarningCount > this.unwelcomeReceivedCountThreshhold) {\n            this.unwelcomeReceiptWarning = false;\n            console.warn('Unwelcome message warning disabled after ' + this.unwelcomeReceiptWarningCount + ' instances.');\n        }\n\n        // A message sent as a request will have registered a response handler\n        // in the awaitingResponse hash, using a generated id as the key.\n        // TODO: to to rethink using the message id here. Perhaps somehting like a\n        // chain of ids, the root of which is the origination id, which is the one\n        // known here when it it is sent; the message \"id\" should be assigned whenver\n        // a message is sent, but a response  message would include the original\n        // message in the \"chain\"...\n\n        // We can also have awaiting responses without an originating request.\n        // These are useful for, e.g., a promise which awaits a message to be sent\n        // within some window...\n        if (message.envelope.id && this.awaitingResponse.has(message.envelope.id)) {\n            try {\n                const response = this.awaitingResponse.get(message.envelope.id)\n                this.awaitingResponse.delete(message.envelope.id)\n                if (response) {\n                    response.handler(message.payload)\n                }\n            } catch (ex) {\n                console.error('Error handling response for message ', message, ex);\n            }\n        }\n\n        // and also awaiting by message name. Like a listener, but they are only used\n        // once.\n        if (this.waitingListeners.has(message.name)) {\n            const awaiting = this.waitingListeners.get(message.name)!\n            this.waitingListeners.delete(message.name)\n            awaiting.forEach((listener) => {\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n\n        // Otherwise, permanently registered handlers are found in the listeners for the\n        // message name.\n        if (this.listeners.has(message.name)) {\n            this.listeners.get(message.name)!.forEach((listener) => {\n                if (!listener.onSuccess) {\n                    console.warn('no handler for listener!', listener);\n                }\n                try {\n                    listener.onSuccess(message.payload);\n                } catch (ex) {\n                    console.error('Error handling listener for message', message, ex);\n                    if (listener.onError) {\n                        listener.onError(ex);\n                    }\n                }\n            });\n        }\n    }\n\n    listen(listener: Listener) {\n        if (!this.listeners.has(listener.name)) {\n            this.listeners.set(listener.name, [])\n        }\n        this.listeners.get(listener.name)!.push(listener)\n    }\n\n    on(messageId: string, success: (payload: any) => any, error: (error: Error) => void) {\n        this.listen(new Listener({\n            name: messageId,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    sendMessage(message: Message) {\n        this.window.postMessage(message.getMessage(), this.host);\n    }\n\n    send(name: string, payload: Payload) {\n        const message = new Message({ name, payload, channel: this.id });\n        this.sendMessage(message);\n    }\n\n    sendRequest(message: Message, handler: (response: any) => any) {\n        this.awaitingResponse.set('message.id', {\n            started: new Date(),\n            handler: handler\n        })\n\n        this.sendMessage(message);\n    }\n\n    request(name: string, payload: Payload) {\n        return new Promise((resolve, reject) => {\n            try {\n                this.sendRequest(new Message({ name, payload, channel: this.id }), (response: any) => {\n                    resolve(response);\n                });\n            } catch (ex) {\n                reject(ex);\n            }\n        });\n    }\n\n    startMonitor() {\n        window.setTimeout(() => {\n            const now = new Date().getTime();\n\n            // first take care of listeners awaiting a message.\n            for (const [id, listeners] of this.waitingListeners.entries()) {\n                const newListeners = listeners.filter((listener) => {\n                    if (listener instanceof WaitingListener) {\n                        const elapsed = now - listener.started.getTime();\n                        if (elapsed > listener.timeout) {\n                            try {\n                                if (listener.onError) {\n                                    listener.onError(new Error('timout after ' + elapsed));\n                                }\n                            } catch (ex) {\n                                console.error('Error calling error handler', id, ex);\n                            }\n                            return false;\n                        } else {\n                            return true;\n                        }\n                    } else {\n                        return true;\n                    }\n                });\n                if (newListeners.length === 0) {\n                    this.waitingListeners.delete(id)\n                }\n            }\n\n            if (this.waitingListeners.size > 0) {\n                this.startMonitor()\n            }\n        }, 100);\n    }\n\n    listenOnce(listener: WaitingListener) {\n        if (!this.waitingListeners.has(listener.name)) {\n            this.waitingListeners.set(listener.name, [])\n        }\n        this.waitingListeners.get(listener.name)!.push(listener);\n        if (listener.timeout) {\n            this.startMonitor();\n        }\n    }\n\n    once(name: string, success: (payload: Payload) => void, error: (error: Error) => void) {\n        this.listenOnce(new WaitingListener({\n            name: name,\n            onSuccess: success,\n            onError: error\n        }));\n    }\n\n    when(name: string, timeout: number) {\n        return new Promise((resolve, reject) => {\n            return this.listenOnce(new WaitingListener({\n                name: name,\n                timeout: timeout,\n                onSuccess: (payload) => {\n                    resolve(payload);\n                },\n                onError: (error) => {\n                    reject(error);\n                }\n            }));\n        });\n    }\n\n    stats() {\n        return {\n            sent: this.sentCount,\n            received: this.receivedCount\n        };\n    }\n\n    attach(window: Window) {\n        this.window = window;\n    }\n\n    start() {\n        this.currentListener = (message: MessageEvent) => {\n            this.receiveMessage(message);\n        };\n        this.window.addEventListener('message', this.currentListener, false);\n    }\n\n    stop() {\n        if (this.currentListener) {\n            this.window.removeEventListener('message', this.currentListener, false);\n        }\n    }\n}\n","import uuid from 'uuid/v4'\nimport { Channel } from './windowChannel'\nimport { runInThisContext } from 'vm';\n\nexport interface IFrameParams {\n    channelId: string,\n    frameId: string,\n    params: {\n        groupsServiceURL: string,\n        userProfileServiceURL: string,\n        workspaceServiceURL: string\n        serviceWizardURL: string\n    },\n    parentHost: string\n}\n/*\n channelId: \"3b33179e-8a6d-4ae9-bc95-af4c0492eaa6\"\nframeId: \"frame_kb_html_be553ee5-645c-4737-80ba-dcb642632f0c\"\nhostId: \"host_kb_html_9a3b5d5d-bb92-43ff-a443-73267aa31323\"\nparams: {}\nparentHost: \"https://ci.kbase.us\"\n\n*/\n\n/*\nIFrameSimulator\nThis little doozey allows us to create a simulated iframe. We can query it for\n the params placed on the iframe, and talk to it via the window channel -- it has \n its own window channel.\n Good thing we designed the channel for multiple channels per window.\n*/\nclass IFrameSimulator {\n    params: IFrameParams | null\n    channel: Channel\n\n    constructor() {\n        this.params = null\n\n        // create a window channel.\n\n        this.channel = new Channel({\n            window: window,\n            host: document.location!.origin\n        })\n\n    }\n\n    getParamsFromIFrame(): IFrameParams {\n        return {\n            channelId: this.channel.id,\n            frameId: uuid(),\n            params: {\n                groupsServiceURL: 'services/groups',\n                userProfileServiceURL: 'services/user_profile/rpc',\n                workspaceServiceURL: 'services/ws',\n                serviceWizardURL: 'services/service_wizard'\n            },\n            parentHost: document.location!.origin\n        }\n    }\n}\n\n\n\nexport default IFrameSimulator","export interface IFrameParams {\n    channelId: string\n    frameId: string\n    params: {\n        groupsServiceURL: string\n        userProfileServiceURL: string\n        workspaceServiceURL: string\n        serviceWizardURL: string\n    },\n    parentHost: string\n}\n\nexport class IFrameIntegration {\n    getParamsFromIFrame() {\n        if (!window.frameElement) {\n            return null\n        }\n        if (!window.frameElement.hasAttribute('data-params')) {\n            // throw new Error('No params found in window!!');\n            return null\n        }\n        const params = window.frameElement.getAttribute('data-params');\n        if (params === null) {\n            // throw new Error('No params found in window!')\n            return null\n        }\n        return JSON.parse(decodeURIComponent(params)) as IFrameParams\n    }\n}","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\nimport * as types from '../../types'\nimport IFrameSimulator, { IFrameParams } from '../../lib/IFrameSimulator';\nimport { IFrameIntegration } from '../../lib/IFrameIntegration';\n\n// Action Definitions\n\n// export interface AppStart extends Action {\n//     type: ActionFlag.APP_START,\n\n// }\n\nexport interface AppSuccess extends Action {\n    type: ActionFlag.APP_SUCCESS,\n    config: types.AppConfig\n}\n\nexport interface AppError extends Action {\n    type: ActionFlag.APP_ERROR,\n    error: AppError\n}\n\n// Action Creators\n\nexport function appSuccess(config: types.AppConfig): AppSuccess {\n    return {\n        type: ActionFlag.APP_SUCCESS,\n        config: config\n    }\n}\n\nexport function appError(error: AppError): AppError {\n    return {\n        type: ActionFlag.APP_ERROR,\n        error: error\n    }\n}\n\n// Action Thunks\n\nexport function appStart() {\n    return (dispatch: ThunkDispatch<types.StoreState, void, Action>, getState: () => types.StoreState) => {\n        // check and see if we are in an iframe\n        const iframeParams = new IFrameIntegration().getParamsFromIFrame()\n\n        if (iframeParams) {\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: iframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: iframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: iframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: iframeParams.params.serviceWizardURL\n                    }\n                }\n            }))\n        } else {\n            const fakeIframeParams = new IFrameSimulator().getParamsFromIFrame()\n            dispatch(appSuccess({\n                baseUrl: '',\n                services: {\n                    Groups: {\n                        url: fakeIframeParams.params.groupsServiceURL\n                    },\n                    UserProfile: {\n                        url: fakeIframeParams.params.userProfileServiceURL\n                    },\n                    Workspace: {\n                        url: fakeIframeParams.params.workspaceServiceURL\n                    },\n                    ServiceWizard: {\n                        url: fakeIframeParams.params.serviceWizardURL\n                    }\n                }\n            }))\n        }\n\n\n        // if so, get the params\n\n        // if not, use the fake to get it\n    }\n}\n","import * as React from 'react'\nimport './KBaseIntegration.css'\n\nimport { AppState } from '../types'\nimport { } from '../lib/IFrameSimulator'\n\nexport interface KBaseIntegrationProps {\n    status: AppState,\n    onAppStart: () => void\n}\nclass KBaseIntegration extends React.Component<KBaseIntegrationProps, object> {\n    constructor(props: KBaseIntegrationProps) {\n        super(props)\n\n        // const params = this.getParamsFromIFrame()\n\n        this.props.onAppStart()\n    }\n\n    render() {\n        // TODO: some test like \n        // {this.props.env === 'dev' ? this.buildAuthDev() : this.buildAuthProd()}\n\n        if (this.props.status === AppState.NONE) {\n            return (\n                <div className=\"KBaseIntegration\">\n                    Loading...\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"KBaseIntegration scrollable-flex-column\">\n                    {this.props.children}\n                </div>\n            )\n        }\n    }\n\n    // getParamsFromIFrame() {\n    //     if (!window.frameElement) {\n    //         return null\n    //     }\n    //     if (!window.frameElement.hasAttribute('data-params')) {\n    //         // throw new Error('No params found in window!!');\n    //         return null\n    //     }\n    //     const params = window.frameElement.getAttribute('data-params');\n    //     if (params === null) {\n    //         // throw new Error('No params found in window!')\n    //         return null\n    //     }\n    //     return JSON.parse(decodeURIComponent(params));\n    // }\n}\n\nexport default KBaseIntegration","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../types'\nimport * as actions from '../redux/actions/app'\n\nimport KBaseIntegration from '../components/KBaseIntegration'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    status: types.AppState\n}\n\ninterface DispatchProps {\n    onAppStart: () => void\n}\n\nexport function mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const { app: { status } } = state\n    return {\n        status\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onAppStart: () => {\n            dispatch(actions.appStart() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(KBaseIntegration)","import { ActionFlag } from './index'\nimport { Organization, GroupRequest, StoreState, AppError } from '../../types'\nimport { Model } from '../../data/model'\nimport { ThunkDispatch } from 'redux-thunk';\nimport { Action } from 'redux';\n\n// Action types\n\n\n// Start up requests manager\n\nexport interface Load extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,\n    organization: Organization,\n    requests: Array<GroupRequest>\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD\n}\n\n// Accept join requests\n\nexport interface AcceptJoinRequest extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST,\n    requestId: string\n}\n\nexport interface AcceptJoinRequestStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n    requestId: string\n}\n\nexport interface AcceptJoinRequestSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n    request: GroupRequest\n}\n\nexport interface AcceptJoinRequestError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n    error: AppError\n}\n\n\nexport function acceptJoinRequestStart(requestId: string): AcceptJoinRequestStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START,\n        requestId: requestId\n    }\n}\n\nexport function acceptJoinRequestSuccess(request: GroupRequest): AcceptJoinRequestSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,\n        request: request\n    }\n}\n\nexport function acceptJoinRequestError(error: AppError): AcceptJoinRequestError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Deny join requests\n\nexport interface DenyJoinRequest extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST,\n    requestId: string\n}\n\nexport interface DenyJoinRequestStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n    requestId: string\n}\n\nexport interface DenyJoinRequestSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n    request: GroupRequest\n}\n\nexport interface DenyJoinRequestError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n    error: AppError\n}\n\n\nexport function denyJoinRequestStart(requestId: string): DenyJoinRequestStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START,\n        requestId: requestId\n    }\n}\n\nexport function denyJoinRequestSuccess(request: GroupRequest): DenyJoinRequestSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,\n        request: request\n    }\n}\n\nexport function denyJoinRequestError(error: AppError): DenyJoinRequestError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,\n        error: error\n    }\n}\n\n// Cancel join invitations\n\nexport interface CancelJoinInvitation extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION\n    requestId: string\n}\n\nexport interface CancelJoinInvitationStart extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START\n}\n\nexport interface CancelJoinInvitationSuccess extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS\n    request: GroupRequest\n}\n\nexport interface CancelJoinInvitationError extends Action {\n    type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n    error: AppError\n}\n\n\nexport function cancelJoinInvitationStart(): CancelJoinInvitationStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START\n    }\n}\n\nexport function cancelJoinInvitationSuccess(request: GroupRequest): CancelJoinInvitationSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS,\n        request: request\n    }\n}\n\nexport function cancelJoinInvitationError(error: AppError): CancelJoinInvitationError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,\n        error: error\n    }\n}\n\n// Action generators\n\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: Organization, requests: Array<GroupRequest>): LoadSuccess {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,\n        organization: organization,\n        requests: requests\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.ADMIN_MANAGE_REQUESTS_UNLOAD\n    }\n}\n\n// Action thunks\n\nexport function load(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const { auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        // get requests \n        Promise.all([\n            model.getOrg(organizationId),\n            model.getPendingOrganizationRequests(organizationId)\n        ])\n            .then(([organization, requests]) => {\n                dispatch(loadSuccess(organization, requests))\n            })\n            .catch((err) => {\n                dispatch(loadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function acceptJoinRequest(requestId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            manageOrganizationRequestsView,\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (!manageOrganizationRequestsView) {\n            return\n        }\n\n        Promise.all([\n            model.acceptRequest(requestId),\n        ])\n            .then(([request]) => {\n                dispatch(acceptJoinRequestSuccess(request))\n                if (manageOrganizationRequestsView.viewState) {\n                    dispatch(load(manageOrganizationRequestsView.viewState.organization.id))\n                }\n            })\n            .catch((err) => {\n                dispatch(acceptJoinRequestError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function denyJoinRequest(requestId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            manageOrganizationRequestsView,\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (!manageOrganizationRequestsView) {\n            return\n        }\n\n        Promise.all([\n            model.denyRequest(requestId),\n        ])\n            .then(([request]) => {\n                dispatch(denyJoinRequestSuccess(request))\n                if (manageOrganizationRequestsView.viewState) {\n                    dispatch(load(manageOrganizationRequestsView.viewState.organization.id))\n                }\n            })\n            .catch((err) => {\n                dispatch(denyJoinRequestError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\nexport function cancelJoinInvitation(requestId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        const {\n            auth: { authorization: { token, username } },\n            manageOrganizationRequestsView,\n            app: { config } } = getState()\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        if (!manageOrganizationRequestsView) {\n            return\n        }\n\n        Promise.all([\n            model.cancelRequest(requestId),\n        ])\n            .then(([request]) => {\n                dispatch(cancelJoinInvitationSuccess(request))\n                if (manageOrganizationRequestsView.viewState) {\n                    dispatch(load(manageOrganizationRequestsView.viewState.organization.id))\n                }\n            })\n            .catch((err) => {\n                dispatch(cancelJoinInvitationError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\nimport './User.css'\n\nimport Avatar from './Avatar'\nimport * as types from '../types';\n\nexport interface UserProps {\n    user: types.User\n    avatarSize?: number\n}\n\ninterface UserState {\n\n}\n\nclass User extends React.Component<UserProps, UserState> {\n    constructor(props: UserProps) {\n        super(props)\n    }\n\n    render() {\n        return (\n            <div className=\"User\">\n                <div className=\"avatarCol\">\n                    <Avatar user={this.props.user} size={this.props.avatarSize || 30} />\n                </div>\n                <div className=\"infoCol\">\n                    <div className=\"name\">\n                        <a href={\"#people/\" + this.props.user.username} target=\"_blank\">{this.props.user.realname}</a>\n                        {' '}\n                        ❨{this.props.user.username}❩\n                                </div>\n                    <div className=\"organization\">\n                        {this.props.user.organization || <i>no organization in user profile</i>}\n                    </div>\n                    <div className=\"location\">\n                        {[this.props.user.city, this.props.user.state, this.props.user.country].filter(x => x).join(', ') || <i>no location information in user profile</i>}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default User","import * as React from 'react'\n\nimport './component.css'\nimport * as types from '../../types';\nimport Header from '../Header';\nimport { Icon, Button, Modal, Card } from 'antd';\nimport { Redirect } from 'react-router';\nimport User from '../User';\nimport OrganizationHeader from '../organizationHeader/container';\n\nexport interface ManageGroupRequestsProps {\n    // organizationId: string,\n    viewState: types.ManageOrganizationRequestsValue\n    // onStart: (organizationId: string) => void,\n    onAcceptJoinRequest: (requestId: string) => void,\n    onDenyJoinRequest: (requestId: string) => void,\n    onCancelJoinInvitation: (requestId: string) => void\n}\n\nexport interface ManageGroupRequestsState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\nclass ManageGroupRequests extends React.Component<ManageGroupRequestsProps, ManageGroupRequestsState> {\n\n    constructor(props: ManageGroupRequestsProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n\n        // this.props.onStart(this.props.organizationId)\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n    onAcceptJoinRequest(requestId: string) {\n        this.props.onAcceptJoinRequest(requestId)\n    }\n    onDenyJoinRequest(requestId: string) {\n        this.props.onDenyJoinRequest(requestId)\n    }\n    onCancelJoinInvitation(requestId: string) {\n        this.props.onCancelJoinInvitation(requestId)\n    }\n    onViewProfile(username: string) {\n        window.open('#people/' + username, '_blank')\n    }\n    onShowInfo() {\n        Modal.info({\n            title: 'Manage Requests Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the manage requests tool...</p>\n                </div>\n            )\n        })\n    }\n    renderHeader() {\n        let orgName: string\n        // if (this.props.manageOrganizationRequestsView && this.props.manageOrganizationRequestsView.viewState) {\n        //     orgName = this.props.manageOrganizationRequestsView.viewState.organization.name\n        // } else {\n        //     orgName = 'loading...'\n        // }\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            <Icon type=\"tool\" />\n                            {' '}\n                            Managing Requests for Org \"\n                            {this.props.viewState.organization.name}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToViewer.bind(this)}>\n                            Return to this Org\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToBrowser.bind(this)}>\n                            Return to Orgs Browser\n                        </Button>\n                        <Button\n                            shape=\"circle\"\n                            icon=\"info\"\n                            onClick={this.onShowInfo.bind(this)}>\n                        </Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderLoadingHeader() {\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            Loading Org Editor...\n                        </span>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    // renderRequestType(type: types.RequestType) {\n\n    //     switch (type) {\n    //         case types.RequestType.JOIN_GROUP_REQUEST:\n    //             return 'Join Group Request'\n    //         case types.RequestType.JOIN_GROUP_INVITE:\n    //             return 'Join Group Invitation'\n    //         case types.RequestType.ADD_WORKSPACE_REQUEST:\n    //             return 'Add Workspace Request'\n    //         case types.RequestType.ADD_WORKSPACE_INVITE:\n    //             return 'Add Workspace Invitation'\n    //     }\n    // }\n\n    niceElapsed(someDate: Date) {\n        const nowDate = new Date()\n\n        const elapsed = Math.round((nowDate.getTime() - someDate.getTime()) / 1000);\n        const elapsedAbs = Math.abs(elapsed);\n\n        let measure, measureAbs, unit;\n        const maxDays = 90\n        if (elapsedAbs < 60 * 60 * 24 * maxDays) {\n            if (elapsedAbs === 0) {\n                return 'now';\n            } else if (elapsedAbs < 60) {\n                measure = elapsed;\n                measureAbs = elapsedAbs;\n                unit = 'second';\n            } else if (elapsedAbs < 60 * 60) {\n                measure = Math.round(elapsed / 60);\n                measureAbs = Math.round(elapsedAbs / 60);\n                unit = 'minute';\n            } else if (elapsedAbs < 60 * 60 * 24) {\n                measure = Math.round(elapsed / 3600);\n                measureAbs = Math.round(elapsedAbs / 3600);\n                unit = 'hour';\n            } else {\n                measure = Math.round(elapsed / (3600 * 24));\n                measureAbs = Math.round(elapsedAbs / (3600 * 24));\n                unit = 'day';\n            }\n\n            if (measureAbs > 1) {\n                unit += 's';\n            }\n\n            let prefix = null;\n            let suffix = null;\n            if (measure < 0) {\n                prefix = 'in';\n            } else if (measure > 0) {\n                suffix = 'ago';\n            }\n\n            return (prefix ? prefix + ' ' : '') + measureAbs + ' ' + unit + (suffix ? ' ' + suffix : '');\n        } else {\n            // otherwise show the actual date, with or without the year.\n            if (nowDate.getFullYear() === nowDate.getFullYear()) {\n                return Intl.DateTimeFormat('en-US', {\n                    month: 'short',\n                    day: 'numeric'\n                }).format(someDate)\n                // return shortMonths[date.getMonth()] + ' ' + date.getDate();\n            } else {\n                return Intl.DateTimeFormat('en-US', {\n                    month: 'short',\n                    day: 'numeric',\n                    year: 'numeric'\n                }).format(someDate)\n                // return shortMonths[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();\n            }\n        }\n    }\n\n    renderRequestJoinRequest(request: types.UserRequest) {\n        const title = (\n            <span>\n                <Icon type=\"user\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User user={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestJoinInvitation(request: types.UserInvitation) {\n        const title = (\n            <span>\n                <Icon type=\"team\" />\n                <Icon type=\"mail\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"user\" />\n\n\n                {' '}\n                Invitation to Join Group\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onCancelJoinInvitation.call(this, request.id)}>\n                Cancel\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>invitation to</th>\n                            <td className=\"requester\">\n                                <User user={request.user} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestNarrativeRequest(request: types.WorkspaceRequest) {\n        const title = (\n            <span>\n                <Icon type=\"file\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add Narrative\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User user={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>narrative</th>\n                            <td className=\"narrative\">\n                                {request.workspace}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestAppRequest(request: types.AppRequest) {\n        const title = (\n            <span>\n                <Icon type=\"appstore\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add App\n            </span>\n        )\n        const actions = [\n            <Button\n                type=\"primary\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n                Approve\n            </Button>,\n            <Button\n                type=\"danger\"\n                style={{ margin: '0 5px' }}\n                onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n                Deny\n            </Button>\n        ]\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User user={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>app</th>\n                            <td className=\"requester\">\n                                {request.app}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({this.niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequest(request: types.GroupRequest) {\n        switch (request.type) {\n            case types.RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case types.RequestResourceType.USER:\n                        return this.renderRequestJoinRequest(request as types.UserRequest)\n                    case types.RequestResourceType.WORKSPACE:\n                        return this.renderRequestNarrativeRequest(request as types.WorkspaceRequest)\n                    case types.RequestResourceType.APP:\n                        return this.renderRequestAppRequest(request as types.AppRequest)\n                    default:\n                        throw new Error('Unsupported resource type: ' + request.resourceType)\n                }\n            case types.RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case types.RequestResourceType.USER:\n                        return this.renderRequestJoinInvitation(request as types.UserInvitation)\n                    case types.RequestResourceType.WORKSPACE:\n                        throw new Error('Workspace invitations are not supported')\n                    // return this.renderRequestNarrativeInvitation(request as types.WorkspaceRequest)\n                    case types.RequestResourceType.APP:\n                        throw new Error('App invitations are not supported')\n                    // return this.renderRequestAppInvitation(request as types.AppRequest)\n                    default:\n                        throw new Error('Unsupported resource type: ' + request.resourceType)\n                }\n        }\n    }\n\n    renderRequests() {\n        if (this.props.viewState.requests.length === 0) {\n            return (\n                <p style={{ textAlign: 'center', padding: '10px' }}>\n                    No pending requests for this organization\n                </p>\n            )\n        }\n        return this.props.viewState.requests\n            .filter((request) => {\n                return (request.type === types.RequestType.REQUEST)\n            })\n            .map((request) => {\n                return this.renderRequest(request)\n            })\n    }\n\n    renderInvitations() {\n        if (this.props.viewState.requests.length === 0) {\n            return (\n                <p style={{ textAlign: 'center', padding: '10px' }}>\n                    No pending requests for this organization\n                </p>\n            )\n        }\n        return this.props.viewState.requests\n            .filter((request) => {\n                return (request.type === types.RequestType.INVITATION)\n            })\n            .map((request) => {\n                return this.renderRequest(request)\n            })\n    }\n\n    render() {\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.viewState.organization.id} />\n        }\n\n        return (\n            <div className=\"ManageGroupRequests\">\n                {this.renderHeader()}\n                <OrganizationHeader organization={this.props.viewState.organization} />\n                <div className=\"row\">\n                    <div className=\"pendingCol\">\n                        <h2>Requests ({this.props.viewState.organization.adminRequests.length})</h2>\n                        <div className=\"pendingRequests\">\n                            {this.renderRequests()}\n                        </div>\n                    </div>\n                    <div className=\"historyCol\">\n                        <h2>Invitations</h2>\n                        {this.renderInvitations()}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default ManageGroupRequests","import { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/manageOrganizationRequests'\n\nimport Component from './component'\n\nexport interface OwnProps {\n    // organizationId: string\n}\n\ninterface StateProps {\n    viewState: types.ManageOrganizationRequestsValue\n}\n\ninterface DispatchProps {\n    // onStart: (organizationId: string) => void,\n    onAcceptJoinRequest: (requestId: string) => void,\n    onDenyJoinRequest: (requestId: string) => void,\n    onCancelJoinInvitation: (requestId: string) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    const {\n        manageOrganizationRequestsView\n    } = state\n    if (!manageOrganizationRequestsView.viewState) {\n        throw new Error('view state not loaded!')\n    }\n    return {\n        viewState: manageOrganizationRequestsView.viewState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        // onStart: (organizationId: string) => {\n        //     dispatch(actions.manageOrganizationRequests(organizationId) as any)\n        // },\n        onAcceptJoinRequest: (requestId: string) => {\n            dispatch(actions.acceptJoinRequest(requestId) as any)\n        },\n        onDenyJoinRequest: (requestId: string) => {\n            dispatch(actions.denyJoinRequest(requestId) as any)\n        },\n        onCancelJoinInvitation: (requestId: string) => {\n            dispatch(actions.cancelJoinInvitation(requestId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)\n\n","import * as React from 'react'\n\nimport { ComponentLoadingState } from '../../types'\nimport Container from './container'\n\nexport interface LoaderProps {\n    organizationId: string\n    loadingState: ComponentLoadingState\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface LoaderState {\n\n}\n\nclass Loader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading...\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.loadingState) {\n            case ComponentLoadingState.NONE:\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\nimport { Dispatch, Action } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/manageOrganizationRequests'\n\n// org id fed from the url\nexport interface OwnProps {\n    organizationId: string\n}\n\n// we unpack the view state?\ninterface StateProps {\n    loadingState: types.ComponentLoadingState\n}\n\n// the loader can just load this view\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        loadingState: state.manageOrganizationRequestsView.state\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\n\nimport { Organization, AppError, StoreState, MemberType } from '../../types'\nimport { Model } from '../../data/model'\n\n// LOADING\n\nexport interface ViewMembersLoad extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD,\n    organizationId: string\n}\n\nexport interface ViewMembersLoadStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD_START\n}\n\nexport interface ViewMembersUnload extends Action {\n    type: ActionFlag.VIEW_MEMBERS_UNLOAD\n}\n\nexport interface ViewMembersLoadSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS,\n    organization: Organization\n}\n\nexport interface ViewMembersLoadError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_LOAD_ERROR,\n    error: AppError\n}\n\n\nexport function viewMembersLoadStart(): ViewMembersLoadStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_LOAD_START\n    }\n}\n\nexport function viewMembersLoadSuccess(organization: Organization): ViewMembersLoadSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_LOAD_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function viewMembersLoadError(error: AppError): ViewMembersLoadError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function viewMembersUnload(): ViewMembersUnload {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_UNLOAD\n    }\n}\n\nexport function viewMembersLoad(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewMembersLoadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.getOrg(organizationId)\n            .then((org) => {\n                dispatch(viewMembersLoadSuccess(org))\n            })\n            .catch((err) => {\n                dispatch(viewMembersLoadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Promoting member to admin\n\nexport interface ViewMembersPromoteToAdmin extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN,\n    memberUsername: string\n}\n\nexport interface ViewMembersPromoteToAdminStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n}\n\nexport interface ViewMembersPromoteToAdminSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n    memberUsername: string\n}\n\nexport interface ViewMembersPromoteToAdminError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n    error: AppError\n}\n\n\nexport function viewMembersPromoteToAdminStart(): ViewMembersPromoteToAdminStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START\n    }\n}\n\nexport function viewMembersPromoteToAdminSuccess(memberUsername: string): ViewMembersPromoteToAdminSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,\n        memberUsername\n    }\n}\n\nexport function viewMembersPromoteToAdminError(error: AppError): ViewMembersPromoteToAdminError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,\n        error: error\n    }\n}\n\nexport function viewMembersPromoteToAdmin(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewMembersPromoteToAdminStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            viewMembersView: { view } } = getState()\n        if (view === null) {\n            throw new Error('view is not populated')\n        }\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.memberToAdmin(view.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(viewMembersPromoteToAdminSuccess(memberUsername))\n\n                // Brute force, update the in-store organization\n                // const { viewMembersView: { view } } = getState()\n\n                // if (!view) {\n                //     dispatch(viewMembersPromoteToAdminError({\n                //         code: 'NoView',\n                //         message: 'No view for viewMembers'\n                //     }))\n                //     return\n                // }\n\n\n                // dispatch(viewMembersLoad(view.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(viewMembersPromoteToAdminError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Demote admin to member\n\nexport interface ViewMembersDemoteToMember extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER,\n    memberUsername: string\n}\n\nexport interface ViewMembersDemoteToMemberStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n}\n\nexport interface ViewMembersDemoteToMemberSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n    memberUsername: string\n}\n\nexport interface ViewMembersDemoteToMemberError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n    error: AppError\n}\n\n\nexport function viewMembersDemoteToMemberStart(): ViewMembersDemoteToMemberStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START\n    }\n}\n\nexport function viewMembersDemoteToMemberSuccess(memberUsername: string): ViewMembersDemoteToMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,\n        memberUsername: memberUsername\n    }\n}\n\nexport function viewMembersDemoteToMemberError(error: AppError): ViewMembersDemoteToMemberError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function viewMembersDemoteToMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(viewMembersDemoteToMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            viewMembersView: { view } } = getState()\n        if (view === null) {\n            throw new Error('view is not populated')\n        }\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.adminToMember(view.organization.id, memberUsername)\n            .then((org) => {\n                dispatch(viewMembersDemoteToMemberSuccess(memberUsername))\n                // dispatch(viewMembersLoad(view.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(viewMembersDemoteToMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Remove a member\n\nexport interface ViewMembersRemoveMember extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER,\n    memberUsername: string\n}\n\ninterface RemoveMemberStart extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_START\n}\n\ninterface RemoveMemberSuccess extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS\n}\n\ninterface RemoveMemberError extends Action {\n    type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n    error: AppError\n}\n\nfunction removeMemberStart(): RemoveMemberStart {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_START\n    }\n}\n\nfunction removeMemberSuccess(): RemoveMemberSuccess {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS\n    }\n}\n\nfunction removeMemberError(error: AppError): RemoveMemberError {\n    return {\n        type: ActionFlag.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,\n        error: error\n    }\n}\n\nexport function viewMembersRemoveMember(memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(removeMemberStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            viewMembersView: { view } } = getState()\n        if (view === null) {\n            throw new Error('view is not populated')\n        }\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.removeMember(view.organization.id, memberUsername)\n            .then(() => {\n                dispatch(removeMemberSuccess())\n                dispatch(viewMembersLoad(view.organization.id))\n            })\n            .catch((err: Error) => {\n                dispatch(removeMemberError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\n\nimport './component.css'\n\nimport { Member, Organization, UserRelationToOrganization, MemberType } from '../../types'\nimport { Button, Icon, Menu, Dropdown } from 'antd';\nimport MemberComponent from '../Member';\n\ninterface MemberRowProps {\n    member: Member,\n    organization: Organization,\n    onPromoteMemberToAdmin: (memberUsername: string) => void,\n    onDemoteAdminToMember: (adminUsername: string) => void,\n    onRemoveMember: (memberUsername: string) => void\n}\n\ninterface MemberRowState {\n    over: boolean\n}\n\nclass MemberRow extends React.Component<MemberRowProps, MemberRowState> {\n    constructor(props: MemberRowProps) {\n        super(props)\n        this.state = {\n            over: false\n        }\n    }\n\n    renderPromoteButton() {\n        switch (this.props.member.type) {\n            case MemberType.MEMBER:\n                return (\n                    <Button\n                        style={{ width: '100%' }}\n                        disabled={!this.state.over}\n                        onClick={() => { this.props.onPromoteMemberToAdmin(this.props.member.user.username) }}>\n                        <Icon type=\"unlock\" />Promote to Admin\n                    </Button>\n                )\n            case MemberType.ADMIN:\n                return (<Button\n                    style={{ width: '100%' }}\n                    disabled={!this.state.over}\n                    onClick={() => { this.props.onDemoteAdminToMember(this.props.member.user.username) }}>\n                    <Icon type=\"user\" />Demote to Member\n                </Button>\n                )\n            case MemberType.OWNER:\n                return\n        }\n\n    }\n\n    renderMemberButtons(member: Member) {\n        if (!(this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === UserRelationToOrganization.ADMIN)) {\n            return\n        }\n        // if (!this.state.over) {\n        //     return\n        // }\n        return (\n            <div>\n                <div>\n                    <Button\n                        type=\"danger\"\n                        disabled={!this.state.over}\n                        style={{ width: '100%' }}\n                        onClick={() => { this.props.onRemoveMember(member.user.username) }}>\n                        <Icon type=\"delete\" />Remove from Org\n                    </Button>\n                </div>\n                <div>\n                    {this.renderPromoteButton()}\n                </div>\n            </div>\n        )\n    }\n\n    renderMemberMenu(member: Member) {\n        const menu = (\n            <Menu>\n                <Menu.Item key=\"promoteToAdmin\" onClick={() => { this.props.onPromoteMemberToAdmin(member.user.username) }} >\n                    <Icon type=\"unlock\" />Promote to Admin\n                </Menu.Item>\n                <Menu.Item key=\"removeMember\" type=\"danger\" onClick={() => { this.props.onRemoveMember(member.user.username) }}>\n                    <Icon type=\"delete\" />Remove Member\n                </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Button icon=\"ellipsis\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderAdminMenu(member: Member) {\n        const menu = (\n            <Menu>\n                <Menu.Item key=\"demoteToMember\" onClick={() => { this.props.onDemoteAdminToMember(member.user.username) }}>\n                    <Icon type=\"user\" />Demote to Member\n                    </Menu.Item>\n            </Menu>\n        )\n        return (\n            <div>\n                <Dropdown overlay={menu} trigger={['click']}>\n                    <Button icon=\"ellipsis\" />\n                </Dropdown>\n            </div>\n        )\n    }\n\n    renderOwnerMenu(member: Member) {\n        return\n    }\n\n    renderMemberOptions(member: Member) {\n        if (!(this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === UserRelationToOrganization.ADMIN)) {\n            return\n        }\n\n        switch (this.props.member.type) {\n            case MemberType.OWNER:\n                return this.renderOwnerMenu(member)\n            case MemberType.ADMIN:\n                return this.renderAdminMenu(member)\n            case MemberType.MEMBER:\n                return this.renderMemberMenu(member)\n        }\n    }\n\n    onMouseOver() {\n        this.setState({ over: true })\n    }\n\n    onMouseOut() {\n        this.setState({ over: false })\n    }\n\n    render() {\n        return (\n            <div key={this.props.member.user.username}\n                className=\"memberRow\"\n                onMouseEnter={this.onMouseOver.bind(this)}\n                onMouseLeave={this.onMouseOut.bind(this)}>\n                <div style={{ flex: '1 1 0px' }}>\n                    <MemberComponent member={this.props.member} avatarSize={50} key={this.props.member.user.username} />\n                </div>\n                <div style={{ flex: '0 0 10em', textAlign: 'right' }}>\n                    {/* {this.renderMemberButtons(this.props.member)} */}\n                    {this.renderMemberOptions(this.props.member)}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default MemberRow","import * as React from 'react'\nimport { GroupRequest, RequestType, RequestResourceType, UserRequest, WorkspaceRequest, AppRequest, UserInvitation } from '../../types';\nimport { Card, Button, Icon } from 'antd';\nimport User from '../User';\nimport './component.css'\n\nexport interface RequestProps {\n    request: GroupRequest\n}\n\nexport interface RequestState {\n\n}\n\nfunction niceElapsed(someDate: Date) {\n    const nowDate = new Date()\n\n    const elapsed = Math.round((nowDate.getTime() - someDate.getTime()) / 1000);\n    const elapsedAbs = Math.abs(elapsed);\n\n    let measure, measureAbs, unit;\n    const maxDays = 90\n    if (elapsedAbs < 60 * 60 * 24 * maxDays) {\n        if (elapsedAbs === 0) {\n            return 'now';\n        } else if (elapsedAbs < 60) {\n            measure = elapsed;\n            measureAbs = elapsedAbs;\n            unit = 'second';\n        } else if (elapsedAbs < 60 * 60) {\n            measure = Math.round(elapsed / 60);\n            measureAbs = Math.round(elapsedAbs / 60);\n            unit = 'minute';\n        } else if (elapsedAbs < 60 * 60 * 24) {\n            measure = Math.round(elapsed / 3600);\n            measureAbs = Math.round(elapsedAbs / 3600);\n            unit = 'hour';\n        } else {\n            measure = Math.round(elapsed / (3600 * 24));\n            measureAbs = Math.round(elapsedAbs / (3600 * 24));\n            unit = 'day';\n        }\n\n        if (measureAbs > 1) {\n            unit += 's';\n        }\n\n        let prefix = null;\n        let suffix = null;\n        if (measure < 0) {\n            prefix = 'in';\n        } else if (measure > 0) {\n            suffix = 'ago';\n        }\n\n        return (prefix ? prefix + ' ' : '') + measureAbs + ' ' + unit + (suffix ? ' ' + suffix : '');\n    } else {\n        // otherwise show the actual date, with or without the year.\n        if (nowDate.getFullYear() === nowDate.getFullYear()) {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric'\n            }).format(someDate)\n            // return shortMonths[date.getMonth()] + ' ' + date.getDate();\n        } else {\n            return Intl.DateTimeFormat('en-US', {\n                month: 'short',\n                day: 'numeric',\n                year: 'numeric'\n            }).format(someDate)\n            // return shortMonths[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();\n        }\n    }\n}\n\nexport class Request extends React.Component<RequestProps, RequestState> {\n    constructor(props: RequestProps) {\n        super(props)\n    }\n\n    renderRequestJoinRequest(request: UserRequest) {\n        const title = (\n            <span>\n                <Icon type=\"user\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Join Group\n            </span>\n        )\n        const actions = [\n            // <Button\n            //     type=\"primary\"\n            //     style={{ margin: '0 5px' }}\n            //     onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n            //     Approve\n            // </Button>,\n            // <Button\n            //     type=\"danger\"\n            //     style={{ margin: '0 5px' }}\n            //     onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n            //     Deny\n            // </Button>\n        ] as Array<JSX.Element>\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User user={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestJoinInvitation(request: UserInvitation) {\n        const title = (\n            <span>\n                <Icon type=\"team\" />\n                <Icon type=\"mail\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"user\" />\n\n\n                {' '}\n                Invitation to Join Group\n            </span>\n        )\n        const actions = [\n            // <Button\n            //     type=\"danger\"\n            //     style={{ margin: '0 5px' }}\n            //     onClick={() => this.onCancelJoinInvitation.call(this, request.id)}>\n            //     Cancel\n            // </Button>\n        ] as Array<JSX.Element>\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>invitation to</th>\n                            <td className=\"requester\">\n                                <User user={request.user} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestNarrativeRequest(request: WorkspaceRequest) {\n        const title = (\n            <span>\n                <Icon type=\"file\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add Narrative\n            </span>\n        )\n        const actions = [\n            // <Button\n            //     type=\"primary\"\n            //     style={{ margin: '0 5px' }}\n            //     onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n            //     Approve\n            // </Button>,\n            // <Button\n            //     type=\"danger\"\n            //     style={{ margin: '0 5px' }}\n            //     onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n            //     Deny\n            // </Button>\n        ] as Array<JSX.Element>\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User user={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>narrative</th>\n                            <td className=\"narrative\">\n                                {request.workspace}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequestAppRequest(request: AppRequest) {\n        const title = (\n            <span>\n                <Icon type=\"appstore\" />\n                <Icon type=\"arrow-right\" />\n                <Icon type=\"team\" />\n                {' '}\n                Request to Add App\n            </span>\n        )\n        const actions = [\n            // <Button\n            //     type=\"primary\"\n            //     style={{ margin: '0 5px' }}\n            //     onClick={() => this.onAcceptJoinRequest.call(this, request.id)}>\n            //     Approve\n            // </Button>,\n            // <Button\n            //     type=\"danger\"\n            //     style={{ margin: '0 5px' }}\n            //     onClick={() => this.onDenyJoinRequest.call(this, request.id)}>\n            //     Deny\n            // </Button>\n        ] as Array<JSX.Element>\n\n        return (\n            <Card key={request.id}\n                title={title}\n                hoverable={true}\n                actions={actions}\n                headStyle={{ backgroundColor: 'rgba(200, 200, 200,0.3' }}\n                style={{ marginBottom: '10px' }}>\n                <table className=\"pendingRequestsTable\">\n                    <tbody>\n                        <tr>\n                            <th>from</th>\n                            <td className=\"requester\">\n                                <User user={request.requester} avatarSize={50} />\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>app</th>\n                            <td className=\"requester\">\n                                {request.app}\n                            </td>\n                        </tr>\n                        <tr>\n                            <th>sent</th>\n                            <td className=\"createdAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.createdAt)}</td>\n                        </tr>\n                        <tr>\n                            <th>expires</th>\n                            <td className=\"expiresAt\">{Intl.DateTimeFormat('en-US', {\n                                month: 'long',\n                                day: 'numeric',\n                                year: 'numeric'\n                            }).format(request.expireAt)} ({niceElapsed(request.expireAt)})</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </Card>\n        )\n    }\n\n    renderRequest() {\n        const request = this.props.request\n        switch (request.type) {\n            case RequestType.REQUEST:\n                switch (request.resourceType) {\n                    case RequestResourceType.USER:\n                        return this.renderRequestJoinRequest(request as UserRequest)\n                    case RequestResourceType.WORKSPACE:\n                        return this.renderRequestNarrativeRequest(request as WorkspaceRequest)\n                    case RequestResourceType.APP:\n                        return this.renderRequestAppRequest(request as AppRequest)\n                    default:\n                        throw new Error('Unsupported resource type: ' + request.resourceType)\n                }\n            case RequestType.INVITATION:\n                switch (request.resourceType) {\n                    case RequestResourceType.USER:\n                        return this.renderRequestJoinInvitation(request as UserInvitation)\n                    case RequestResourceType.WORKSPACE:\n                        throw new Error('Workspace invitations are not supported')\n                    // return this.renderRequestNarrativeInvitation(request as WorkspaceRequest)\n                    case RequestResourceType.APP:\n                        throw new Error('App invitations are not supported')\n                    // return this.renderRequestAppInvitation(request as AppRequest)\n                    default:\n                        throw new Error('Unsupported resource type: ' + request.resourceType)\n                }\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"Request\">\n                {this.renderRequest()}\n            </div>\n        )\n    }\n}","import * as React from 'react'\n\nimport './component.css'\n\nimport { Member, Organization, UserRelationToOrganization, MemberType, RequestResourceType } from '../../types'\nimport Header from '../Header'\nimport { Redirect } from 'react-router'\nimport { Button, Icon, Modal, Row, Col, Menu, Dropdown, Alert } from 'antd';\nimport MemberComponent from '../Member';\nimport MemberRowComponent from './MemberRow'\nimport { NavLink } from 'react-router-dom';\nimport OrganizationHeader from '../organizationHeader/container';\nimport { Request } from '../request/component'\n\nexport interface ViewMembersProps {\n    organization: Organization,\n    onViewMembersUnload: () => void,\n    onPromoteMemberToAdmin: (memberUsername: string) => void,\n    onDemoteAdminToMember: (adminUsername: string) => void,\n    onRemoveMember: (memberUsername: string) => void\n}\n\ninterface ViewMembersState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\n\n\nclass ViewMembers extends React.Component<ViewMembersProps, ViewMembersState> {\n    constructor(props: ViewMembersProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n\n    onPromoteMemberToAdmin(memberUsername: string) {\n        this.props.onPromoteMemberToAdmin(memberUsername)\n    }\n\n    onDemoteAdminToMember(adminUsername: string) {\n        this.props.onDemoteAdminToMember(adminUsername)\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'View Members Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view members tool...</p>\n                </div>\n            )\n        })\n    }\n\n    isMember(): boolean {\n        if (!this.props.organization) {\n            return false\n        }\n        if (this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === UserRelationToOrganization.ADMIN ||\n            this.props.organization.relation.type === UserRelationToOrganization.MEMBER) {\n            return true\n        }\n        return false\n    }\n\n    isAdmin(): boolean {\n        if (!this.props.organization) {\n            return false\n        }\n        if (this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === UserRelationToOrganization.ADMIN) {\n            return true\n        }\n        return false\n    }\n\n    renderHeader() {\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            <Icon type=\"tool\" />\n                            {' '}\n                            Viewing Members for Org \"\n                            {this.props.organization.name}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToViewer.bind(this)}>\n                            Return to this Org\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToBrowser.bind(this)}>\n                            Return to Orgs Browser\n                        </Button>\n                        <Button\n                            shape=\"circle\"\n                            icon=\"info\"\n                            onClick={this.onShowInfo.bind(this)}>\n                        </Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderMembersToolbar() {\n        switch (this.props.organization.relation.type) {\n            case UserRelationToOrganization.NONE:\n                return (\n                    <div className=\"toolbar\">\n                        <Button><Icon type=\"plus\" />Join</Button>\n                    </div>\n                )\n\n            case UserRelationToOrganization.MEMBER:\n                return (\n                    <div className=\"toolbar\">\n                    </div>\n                )\n\n            case UserRelationToOrganization.ADMIN:\n                return (\n                    <div className=\"toolbar\">\n                        <NavLink to={\"/inviteUser/\" + this.props.organization.id}><Button><Icon type=\"mail\" /> Invite a User</Button></NavLink>\n                    </div>\n                )\n\n            case UserRelationToOrganization.OWNER:\n                return (\n                    <div className=\"toolbar\">\n                        <NavLink to={\"/inviteUser/\" + this.props.organization.id}><Button><Icon type=\"mail\" /> Invite a User</Button></NavLink>\n                    </div>\n                )\n\n        }\n    }\n\n    // renderMemberButtons(member: UserBase) {\n    //     if (!(this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n    //         this.props.organization.relation.type === UserRelationToOrganization.ADMIN)) {\n    //         return\n    //     }\n    //     return (\n    //         <div>\n    //             <div><Button type=\"danger\" style={{ width: '100%' }}><Icon type=\"delete\" />Remove from Org</Button></div>\n    //             <div><Button style={{ width: '100%' }} onClick={() => { this.onPromoteMemberToAdmin.call(this, member.username) }}><Icon type=\"unlock\" />Promote to Admin</Button></div>\n    //         </div>\n    //     )\n    // }\n\n    renderMembers() {\n        let members\n        if (!this.isMember()) {\n            return (\n                <p className=\"message\">\n                    Sorry, group membership restricted to members only\n                </p>\n            )\n        }\n        if (this.props.organization.members.length === 0) {\n            members = (\n                <p className=\"message\">\n                    This organization has no members\n                </p>\n            )\n        } else {\n            members = this.props.organization.members.map((member) => (\n                <React.Fragment key={member.user.username}>\n                    <MemberRowComponent\n                        member={member}\n                        organization={this.props.organization}\n                        onPromoteMemberToAdmin={this.props.onPromoteMemberToAdmin}\n                        onDemoteAdminToMember={this.props.onDemoteAdminToMember}\n                        onRemoveMember={this.props.onRemoveMember}\n                    />\n                </React.Fragment>\n            ))\n        }\n        return (\n            <div className=\"table infoTable\">\n                <div className=\"row\">\n                    <div className=\"col0\" style={{ display: 'flex', flexDirection: 'column', overflowY: 'auto' }}>\n                        {members}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderPendingMembers() {\n\n        if (!this.isAdmin()) {\n            return (\n                <Alert type=\"info\" showIcon message=\"Sorry, pending group membership restricted to admin members only\" />\n            )\n        }\n        const pendingRequests = this.props.organization.adminRequests.filter((request) => {\n            return (request.resourceType === RequestResourceType.USER)\n        })\n        if (pendingRequests.length === 0) {\n            return (\n                <Alert type=\"info\" message=\"No pending member requests or invitations\" />\n            )\n        }\n        return pendingRequests.map((request) => {\n            return (\n                <div key={request.id}>\n                    <Request request={request} />\n                </div>\n            )\n        })\n    }\n\n    renderAdminsToolbar() {\n        return (\n            <div className=\"toolbar\">\n\n            </div>\n        )\n    }\n    renderAdminButtons(admin: Member) {\n        if (!(this.props.organization.relation.type === UserRelationToOrganization.OWNER ||\n            this.props.organization.relation.type === UserRelationToOrganization.ADMIN)) {\n            return\n        }\n        return (\n            <div>\n                <div><Button type=\"danger\" style={{ width: '100%' }}><Icon type=\"delete\" />Remove from Org</Button></div>\n                <div><Button style={{ width: '100%' }} onClick={() => { this.onDemoteAdminToMember.call(this, admin.user.username) }}><Icon type=\"user\" />Demote to Member</Button></div>\n            </div>\n        )\n    }\n    renderAdmins() {\n        const admins = this.props.organization.members.filter((member) => (member.type === MemberType.ADMIN))\n        let adminList\n        if (admins.length === 0) {\n            adminList = (\n                <p style={{ fontStyle: 'italic', textAlign: 'center' }}>\n                    This organization has no admins\n                </p>\n            )\n        } else {\n            adminList = admins.map((member) => {\n                return (\n                    <div key={member.user.username} style={{ flex: '0 0 auto', display: 'flex', flexDirection: 'row' }}>\n                        <div style={{ flex: '1 1 0px' }}>\n                            <MemberComponent member={member} avatarSize={50} key={member.user.username} />\n                        </div>\n                        <div style={{ flex: '0 0 10em' }}>\n                            {this.renderAdminButtons(member)}\n                        </div>\n                    </div>\n\n                )\n            })\n        }\n        return (\n            <div className=\"table infoTable\">\n                <div className=\"row\">\n                    <div className=\"col0\" style={{ display: 'flex', flexDirection: 'column', overflowY: 'auto' }}>\n                        {adminList}\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    renderOrganizationHeader() {\n        return (\n            <OrganizationHeader organization={this.props.organization} />\n        )\n    }\n\n    componentWillUnmount() {\n        this.props.onViewMembersUnload()\n    }\n\n    render() {\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"ViewMembers\">\n                {this.renderHeader()}\n                {this.renderOrganizationHeader()}\n                <div className=\"body\">\n                    <div className=\"membersCol\">\n                        <h2>Members</h2>\n                        {this.renderMembersToolbar()}\n                        {this.renderMembers()}\n                    </div>\n                    <div className=\"otherCol\">\n                        <h2>Pending Members</h2>\n                        {this.renderAdminsToolbar()}\n\n                        <p>\n                            This space to provide a list of user requests and invitations. This will allow this view\n                            to provide all user management tools in one place.\n                        </p>\n                        <p>\n                            In progress... currently renders the requests but does not provide actions (buttons).\n                        </p>\n                        {this.renderPendingMembers()}\n\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default ViewMembers","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/viewMembers'\nimport ViewMembers from './component'\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    organization: types.Organization\n}\n\ninterface DispatchProps {\n    onViewMembersUnload: () => void,\n    onPromoteMemberToAdmin: (memberUsername: string) => void,\n    onDemoteAdminToMember: (adminUsername: string) => void,\n    onRemoveMember: (memberUsername: string) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    if (!state.viewMembersView || (state.viewMembersView.view === null)) {\n        throw new Error('Runtime Error - view members view is not defined!')\n    }\n    return {\n        organization: state.viewMembersView.view.organization\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.ViewMembersLoad>): DispatchProps {\n    return {\n        onViewMembersUnload: () => {\n            dispatch(actions.viewMembersUnload() as any)\n        },\n        onPromoteMemberToAdmin: (memberUsername: string) => {\n            dispatch(actions.viewMembersPromoteToAdmin(memberUsername) as any)\n        },\n        onDemoteAdminToMember: (adminUsername: string) => {\n            dispatch(actions.viewMembersDemoteToMember(adminUsername) as any)\n        },\n        onRemoveMember: (memberUsername: string) => {\n            dispatch(actions.viewMembersRemoveMember(memberUsername) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(ViewMembers)","import * as React from 'react'\n\nimport './component.css'\n\nimport { ViewMembersViewState } from '../../types'\nimport ViewMembersContainer from './container'\n\nexport interface ViewMemberLoaderProps {\n    organizationId: string,\n    state: ViewMembersViewState,\n    onViewMembersLoad: (organizationId: string) => void\n}\n\ninterface ViewMemberLoaderState {\n\n}\n\nclass ViewMembersLoader extends React.Component<ViewMemberLoaderProps, ViewMemberLoaderState> {\n    constructor(props: ViewMemberLoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading...\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.state) {\n            case ViewMembersViewState.NONE:\n                this.props.onViewMembersLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ViewMembersViewState.LOADING:\n                return this.renderLoading()\n            case ViewMembersViewState.SUCCESS:\n                return (\n                    <ViewMembersContainer />\n                )\n        }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/viewMembers'\n// import ViewMembers from './component'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    state: types.ViewMembersViewState\n}\n\ninterface DispatchProps {\n    onViewMembersLoad: (organizationId: string) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        state: state.viewMembersView.state\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.ViewMembersLoad>): DispatchProps {\n    return {\n        onViewMembersLoad: (organizationId: string) => {\n            dispatch(actions.viewMembersLoad(organizationId) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(ViewMembersLoader)","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\n\nimport { ActionFlag } from './index'\n\nimport { AppError, StoreState, Organization, BriefUser, User, InviteUserValue, ComponentLoadingState, RequestType, RequestResourceType, UserInvitation, UserRequest, UserRelationToOrganization, MemberType, OrganizationUser, GroupRequest } from '../../types'\nimport { Model, UserQuery } from '../../data/model'\nimport Organizations from '../../components/browseOrgs/Organizations';\n\n// View Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.INVITE_USER_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_START\n}\n\nexport interface LoadReady extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_READY,\n    organization: Organization,\n    users: Array<OrganizationUser> | null\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.INVITE_USER_LOAD_ERROR,\n    error: AppError\n}\n\nexport interface Unload extends Action {\n    type: ActionFlag.INVITE_USER_UNLOAD\n}\n\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_START\n    }\n}\n\nexport function loadReady(organization: Organization): LoadReady {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_READY,\n        organization: organization,\n        users: null\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.INVITE_USER_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.INVITE_USER_UNLOAD\n    }\n}\n\nexport function inviteUserLoad(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        Promise.all([\n            model.getOrg(organizationId),\n            null\n            // model.searchUsers({\n            //     query: '',\n            //     excludedUsers: []\n            // })\n        ])\n            .then(([org, users]) => {\n                // users.sort((a, b) => {\n                //     return a.username.localeCompare(b.username)\n                // })\n                dispatch(loadReady(org))\n            })\n            .catch((err) => {\n                dispatch(loadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n\n    }\n}\n\n// User Selection\n\n\n\nexport interface InviteUserSearchUsers extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS,\n    query: UserQuery\n}\n\ninterface SearchUsersStart extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n}\n\nexport interface SearchUsersSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n    users: Array<OrganizationUser> | null\n}\n\ninterface SearchUsersError extends Action {\n    type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n    error: AppError\n}\n\nfunction searchUsersStart(): SearchUsersStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_START\n    }\n}\n\nfunction searchUsersSuccess(users: Array<OrganizationUser> | null): SearchUsersSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_SUCCESS,\n        users: users\n    }\n}\n\nfunction searchUsersError(error: AppError): SearchUsersError {\n    return {\n        type: ActionFlag.INVITE_USER_SEARCH_USERS_ERROR,\n        error: error\n    }\n}\n\nexport function inviteUserSearchUsers(query: UserQuery) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(searchUsersStart())\n\n        if (query.query.length === 0) {\n            dispatch(searchUsersSuccess(null))\n            return\n        }\n\n        const {\n            inviteUserView: { value },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        // TODO: better form of type narrowing? \n        if (value === null) {\n            return\n        }\n        const org = value.organization\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        let excludedUsers: Array<string> = []\n\n        // excludedUsers.push(org.owner.user.username)\n\n        let owner: string = org.owner.user.username\n        let adminUsers: Array<string> = []\n        let members: Array<string> = []\n        let invited: Array<string> = []\n        let requested: Array<string> = []\n\n        org.members.forEach((member) => {\n            switch (member.type) {\n                case MemberType.MEMBER:\n                    members.push(member.user.username)\n                case MemberType.ADMIN:\n                    adminUsers.push(member.user.username)\n            }\n        })\n\n        // excludedUsers = excludedUsers.concat(org.members.map((member) => {\n        //     return member.\n        // }))\n\n        org.adminRequests.forEach((request) => {\n            if (request.resourceType === RequestResourceType.USER) {\n                switch (request.type) {\n                    case RequestType.INVITATION:\n                        invited.push((<UserInvitation>request).user.username)\n                        // excludedUsers.push((<UserInvitation>request).user.username)\n                        break\n                    case RequestType.REQUEST:\n                        requested.push((<UserRequest>request).requester.username)\n                    // excludedUsers.push((<UserRequest>request).requester.username)\n                }\n            }\n        })\n\n        Promise.all([\n            model.searchUsers(query)\n        ])\n            .then(([users]) => {\n                // const filteredUsers = users.filter((user) => {\n                //     return (excludedUsers.indexOf(user.username) === -1)\n                // })\n                const orgUsers: Array<OrganizationUser> = users.map(({ username, realname }) => {\n                    let relation: UserRelationToOrganization\n                    if (username === owner) {\n                        relation = UserRelationToOrganization.OWNER\n                    } else if (adminUsers.indexOf(username) >= 0) {\n                        relation = UserRelationToOrganization.ADMIN\n                    } else if (invited.indexOf(username) >= 0) {\n                        relation = UserRelationToOrganization.MEMBER_INVITATION_PENDING\n                    } else if (requested.indexOf(username) >= 0) {\n                        relation = UserRelationToOrganization.MEMBER_REQUEST_PENDING\n                    } else if (members.indexOf(username) >= 0) {\n                        relation = UserRelationToOrganization.MEMBER\n                    } else {\n                        relation = UserRelationToOrganization.NONE\n                    }\n                    return {\n                        username, realname,\n                        relation: relation\n                    }\n                })\n                dispatch(searchUsersSuccess(orgUsers))\n            })\n            .catch((err) => {\n                dispatch(searchUsersError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n\n}\n\n// Select a user\n\nexport interface SelectUser extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER,\n    username: string\n}\n\nexport interface SelectUserStart extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_START\n}\n\nexport interface SelectUserSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n    user: User,\n    relation: UserRelationToOrganization\n}\n\nexport interface SelectUserError extends Action {\n    type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n    error: AppError\n}\n\n\nfunction selectUserStart(): SelectUserStart {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_START\n    }\n}\n\nfunction selectUserSuccess(user: User, relation: UserRelationToOrganization): SelectUserSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_SUCCESS,\n        user: user,\n        relation: relation\n    }\n}\n\nfunction selectUserError(error: AppError): SelectUserError {\n    return {\n        type: ActionFlag.INVITE_USER_SELECT_USER_ERROR,\n        error: error\n    }\n}\n\nfunction isUserRequest(request: GroupRequest, username: string): request is UserRequest {\n    const req: UserRequest = <UserRequest>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.REQUEST &&\n        req.requester.username === username) {\n        return true\n    }\n    return false\n}\n\nfunction isUserInvitation(request: GroupRequest, username: string): request is UserRequest {\n    const req: UserInvitation = <UserInvitation>request\n    if (req.resourceType === RequestResourceType.USER &&\n        req.type === RequestType.INVITATION &&\n        req.user &&\n        req.user.username === username) {\n        return true\n    }\n    return false\n}\n\nfunction getUserRelation(user: User, organization: Organization): UserRelationToOrganization {\n    if (user.username === organization.owner.user.username) {\n        return UserRelationToOrganization.OWNER\n    }\n    const member = organization.members.find((member) => {\n        return member.user.username === user.username\n    })\n    if (member) {\n        switch (member.type) {\n            case MemberType.ADMIN:\n                return UserRelationToOrganization.ADMIN\n            case MemberType.OWNER:\n                return UserRelationToOrganization.OWNER\n            case MemberType.MEMBER:\n                return UserRelationToOrganization.MEMBER\n        }\n    }\n\n    for (const request of organization.adminRequests) {\n        if (isUserInvitation(request, user.username)) {\n            return UserRelationToOrganization.MEMBER_INVITATION_PENDING\n        } else if (isUserRequest(request, user.username)) {\n            return UserRelationToOrganization.MEMBER_REQUEST_PENDING\n        }\n    }\n\n    return UserRelationToOrganization.VIEW\n}\n\nexport function selectUser(selectedUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectUserStart())\n\n        const {\n            inviteUserView: { value },\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        if (!value) {\n            dispatch(selectUserError({\n                code: 'invalid state',\n                message: 'select user invalid state -- no view value'\n            }))\n            return\n        }\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.getUser(selectedUsername)\n            .then((user) => {\n                const relation = getUserRelation(user, value.organization)\n                dispatch(selectUserSuccess(user, relation))\n            })\n            .catch((err) => {\n                console.log('error?', err)\n                dispatch(selectUserError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Now send the invitation, whew!\n\nexport interface SendInvitation extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION\n}\n\nexport interface SendInvitationStart extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n}\n\nexport interface SendInvitationSuccess extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n}\n\nexport interface SendInvitationError extends Action {\n    type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n    error: AppError\n}\n\n\nexport function sendInvitationStart(): SendInvitationStart {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_START\n    }\n}\n\nexport function sendInvitationSuccess(): SendInvitationSuccess {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_SUCCESS\n    }\n}\n\nexport function sendInvitationError(error: AppError): SendInvitationError {\n    return {\n        type: ActionFlag.INVITE_USER_SEND_INVITATION_ERROR,\n        error: error\n    }\n}\n\nexport function sendInvitation() {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendInvitationStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config },\n            inviteUserView: { loadingState, value, error } } = getState()\n\n        if (loadingState !== ComponentLoadingState.SUCCESS) {\n            return\n        }\n\n        if (value === null) {\n            return\n        }\n\n        const { selectedUser, organization: { id } } = value as InviteUserValue\n\n        if (!selectedUser) {\n            return\n        }\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.requestJoinGroup(id, selectedUser.user.username)\n            .then((groupRequest) => {\n                dispatch(sendInvitationSuccess())\n            })\n            .catch((err) => {\n                dispatch(sendInvitationError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}","import * as React from 'react'\n\nimport './InviteUser.css'\nimport { Organization, User, InviteUserViewState, OrganizationUser, UserRelationToOrganization } from '../../types';\nimport { Button, Icon, Modal, Tooltip, Alert } from 'antd';\nimport Header from '../Header';\nimport { Redirect } from 'react-router-dom';\nimport OrganizationHeader from '../organizationHeader/container';\nimport { UserQuery } from '../../data/model';\nimport UserComponent from '../User'\n\nimport SelectUserComponent from '../selectUser/component'\n\nexport interface InviteUserProps {\n    organization: Organization,\n    selectedUser: {\n        user: User,\n        relation: UserRelationToOrganization\n    } | null\n    state: InviteUserViewState,\n    users: Array<OrganizationUser> | null\n    onSearchUsers: (query: UserQuery) => void,\n    onSelectUser: (username: string) => void,\n    onSendInvitation: () => void\n}\n\ninterface InviteUserState {\n    cancelToViewMembers: boolean\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n    autocompleteMessage: string\n}\n\nclass InviteUser extends React.Component<InviteUserProps, InviteUserState> {\n\n    lastSearchAt: Date | null\n\n    static searchDebounce: number = 200\n\n    searchInput: React.RefObject<HTMLInputElement>\n    searchButton: React.RefObject<Button>\n\n    constructor(props: InviteUserProps) {\n        super(props)\n\n        this.lastSearchAt = null\n        this.searchInput = React.createRef()\n        this.searchButton = React.createRef()\n\n        this.state = {\n            cancelToViewMembers: false,\n            cancelToBrowser: false,\n            cancelToViewer: false,\n            autocompleteMessage: ''\n        }\n    }\n\n    onClickCancelToViewMembers() {\n        this.setState({ cancelToViewMembers: true })\n    }\n\n    onClickCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    onClickCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n\n    onSendInvitation() {\n        this.props.onSendInvitation()\n    }\n\n    canSave() {\n        if (this.props.selectedUser) {\n            return true\n        }\n        return false\n    }\n\n    onSubmit(e: React.FormEvent<HTMLFormElement>) {\n        e.preventDefault()\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        this.doSearchUsers(currentSearchInputValue)\n    }\n\n    onSearchInputChange() {\n        let currentSearchInputValue;\n        if (this.searchInput.current) {\n            currentSearchInputValue = this.searchInput.current.value\n        } else {\n            currentSearchInputValue = ''\n        }\n        // this.doSearchUsers(currentSearchInputValue)\n    }\n\n    doSearchUsers(value: string) {\n        // if (value.length < 3) {\n        //     this.setState({ autocompleteMessage: 'Search begins after 3 or more characters' })\n        //     return\n        // }\n        // this.setState({ autocompleteMessage: '' })\n        // build up list of users already owning, members of, or with membership pending.\n        const excludedUsers: Array<string> = []\n\n        if (this.lastSearchAt === null ||\n            (new Date().getTime() - this.lastSearchAt.getTime() > InviteUser.searchDebounce)) {\n            this.lastSearchAt = new Date()\n            this.props.onSearchUsers({\n                query: value,\n                excludedUsers: []\n            })\n        }\n    }\n\n    onSelectUser(user: OrganizationUser) {\n        this.props.onSelectUser(user.username);\n    }\n\n    onShowInfo() {\n        Modal.info({\n            title: 'Invite User Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the invite user tool...</p>\n                </div>\n            )\n        })\n    }\n\n    // foundUsers() {\n    //     const users = this.props.users.map(({ username, realname }) => {\n    //         return {\n    //             value: username,\n    //             text: realname + ' (' + username + ')'\n    //         }\n    //     })\n    //     return users\n    // }\n\n    renderHeader() {\n        let orgName: string\n        // if (this.props.manageGroupRequestsView && this.props.manageGroupRequestsView.view) {\n        //     orgName = this.props.manageGroupRequestsView.view.organization.name\n        // } else {\n        //     orgName = 'loading...'\n        // }\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            <Icon type=\"mail\" />\n                            {' '}\n                            Invite a User to join Org \"\n                            {this.props.organization.name}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToViewMembers.bind(this)}>\n                            Return to Org Members\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToViewer.bind(this)}>\n                            Return to this Org\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.onClickCancelToBrowser.bind(this)}>\n                            Return to Orgs Browser\n                        </Button>\n                        <Button\n                            shape=\"circle\"\n                            icon=\"info\"\n                            onClick={this.onShowInfo.bind(this)}>\n                        </Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderUsers() {\n        if (!this.props.users) {\n            const message = 'Search for users by name or username to display a list of available users in this space.'\n            return (\n                <Alert type=\"info\" message={message} showIcon />\n            )\n        }\n        if (this.props.users.length === 0) {\n            return (\n                <Alert type=\"warning\" message=\"No users found\" showIcon />\n            )\n        }\n        return this.props.users.map((user) => {\n            if (user.relation === UserRelationToOrganization.NONE) {\n                return (\n                    <div\n                        className=\"user notInOrganization \"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            } else {\n                return (\n                    <div\n                        className=\"user inOrganization\"\n                        key={user.username}\n                        onClick={() => { this.onSelectUser.call(this, user) }}>\n                        <div className=\"name \"\n                        >\n                            {user.realname} ({user.username})\n                        </div>\n                    </div>\n                )\n            }\n        })\n    }\n\n    renderOrgInfo() {\n        return (\n            <div className=\"orgInfo\">\n                <div className=\"name\">\n                    <span className=\"field-label\">name</span>\n                    <span>{this.props.organization.name}</span>\n                </div>\n                <div className=\"description\">\n                    <span className=\"field-label\">description</span>\n                    <span>{this.props.organization.description}</span>\n                </div>\n            </div>\n        )\n    }\n\n\n\n    renderInvitationForm() {\n        let button\n        let message\n        if (this.props.selectedUser) {\n            // console.log('form?', this.props.selectedUser, UserRelationToOrganization.NONE, (this.props.selectedUser.relation === UserRelationToOrganization.NONE))\n            if (this.props.selectedUser.relation === UserRelationToOrganization.VIEW) {\n                button = (\n                    <Button\n                        type=\"primary\"\n                        onClick={this.onSendInvitation.bind(this)}>Send Invitation</Button>\n                )\n            } else {\n                button = (\n                    <Button\n                        disabled\n                        type=\"primary\"\n                    >Send Invitation</Button>\n                )\n                // message = 'User is a member of this organization'\n                message = (\n                    <div>\n                        User may not be invited because:<br />\n                        {this.renderRelation(this.props.selectedUser.relation)}\n                    </div>\n                )\n                message = (\n                    <Alert\n                        type=\"warning\"\n                        message={message}\n                        showIcon\n                    />\n                )\n            }\n        } else {\n            button = (\n                <Button\n                    disabled\n                    type=\"primary\"\n                >Send Invitation</Button>\n            )\n            message = 'Please select a user'\n        }\n        return (\n            <div className=\"invitationForm\">\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {button}\n                </div>\n                <div style={{ textAlign: 'center', marginTop: '10px' }}>\n                    {message}\n                </div>\n            </div>\n        )\n    }\n\n    renderInvitationStatus() {\n        switch (this.props.state) {\n            case InviteUserViewState.NONE:\n                return (\n                    <div>NONE</div>\n                )\n            case InviteUserViewState.EDITING:\n                return (\n                    <div>EDITING</div>\n                )\n            case InviteUserViewState.SENDABLE:\n                return (\n                    <div>SENDABLE</div>\n                )\n            case InviteUserViewState.SENDING:\n                return (\n                    <div>SENDING</div>\n                )\n            case InviteUserViewState.SUCCESS:\n                return (\n                    <div>SENT SUCCESSFULLY</div>\n                )\n            case InviteUserViewState.ERROR:\n                return (\n                    <div>ERROR SENDING</div>\n                )\n            default:\n                return (\n                    <div>Bad State</div>\n                )\n        }\n\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organization={this.props.organization} />\n        )\n    }\n\n    renderRelation(relation: UserRelationToOrganization) {\n        console.log('relation', relation)\n        switch (relation) {\n            case (UserRelationToOrganization.NONE):\n                return (\n                    <span><Icon type=\"stop\" />None</span>\n                )\n            case (UserRelationToOrganization.VIEW):\n                return (\n                    <span><Icon type=\"stop\" /> Not a member</span>\n                )\n            case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> User's membership <b>request</b> is pending</span>)\n            case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n                return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> User has been <b>invited</b> to join</span>)\n            case (UserRelationToOrganization.MEMBER):\n                return (<span><Icon type=\"user\" /> User is a <b>member</b> of this organization</span>)\n            case (UserRelationToOrganization.ADMIN):\n                return (<span><Icon type=\"unlock\" />User is an <b>admin</b> of this organization</span>)\n            case (UserRelationToOrganization.OWNER):\n                return (\n\n                    <span><Icon type=\"crown\" /> User is the <b>owner</b> of this Organization</span>\n                )\n        }\n    }\n\n    // renderRelationText(relation: UserRelationToOrganization) {\n    //     console.log('relation', relation)\n    //     switch (relation) {\n    //         case (UserRelationToOrganization.NONE):\n    //             return (\n    //                 <span><Icon type=\"stop\" />None</span>\n    //             )\n    //         case (UserRelationToOrganization.VIEW):\n    //             return (\n    //                 <span><Icon type=\"stop\" /> Not a member</span>\n    //             )\n    //         case (UserRelationToOrganization.MEMBER_REQUEST_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'orange' }} /> User's membership <b>request</b> is pending</span>)\n    //         case (UserRelationToOrganization.MEMBER_INVITATION_PENDING):\n    //             return (<span><Icon type=\"user\" style={{ color: 'blue' }} /> User has been <b>invited</b> to join</span>)\n    //         case (UserRelationToOrganization.MEMBER):\n    //             return (<span><Icon type=\"user\" /> User is a <b>member</b> of this organization</span>)\n    //         case (UserRelationToOrganization.ADMIN):\n    //             return (<span><Icon type=\"unlock\" />User is an <b>admin</b> of this organization</span>)\n    //         case (UserRelationToOrganization.OWNER):\n    //             return (\n    //                 <span><Icon type=\"crown\" /> User is the <b>owner</b> of this Organization</span>\n    //             )\n    //     }\n    // }\n\n    renderSelectedUser() {\n\n        if (this.props.selectedUser === null) {\n            return (\n                <div className=\"selectedUser\">\n                    <p className=\"noSelection\">\n                        No user yet selected\n                    </p>\n                </div>\n            )\n        } else {\n            return (\n                <div className=\"selectedUser\">\n                    <UserComponent user={this.props.selectedUser.user} />\n                    {this.renderRelation(this.props.selectedUser.relation)}\n                </div>\n            )\n        }\n    }\n\n    renderFooter() {\n        return (\n            <div className=\"footer\">\n            </div>\n        )\n    }\n\n    renderSearchButton() {\n        return (<Icon type=\"search\" />)\n    }\n\n    render() {\n\n        if (this.state.cancelToViewMembers) {\n            return <Redirect push to={\"/viewMembers/\" + this.props.organization.id} />\n        }\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"InviteUser scrollable-flex-column\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <div className=\"row scrollable-flex-column\">\n                    <div className=\"col1 firstCol users scrollable-flex-column\">\n                        <h3>Select User to Invite</h3>\n                        <form id=\"searchForm\" className=\"searchBar\"\n                            onSubmit={this.onSubmit.bind(this)}>\n                            <input\n                                ref={this.searchInput}\n                                autoFocus\n                                onChange={this.onSearchInputChange.bind(this)}\n                                placeholder=\"Search for a user\"\n                            />\n                            <Button\n                                className=\"searchButton\"\n                                form=\"searchForm\"\n                                key=\"submit\"\n                                htmlType=\"submit\"\n                            >\n                                {this.renderSearchButton()}\n                            </Button>\n                        </form>\n                        <div className=\"usersTable\">\n                            {this.renderUsers()}\n                        </div>\n                        {/* <SelectUserComponent\n                            users={this.props.users}\n                            selectedUser={this.props.selectedUser}\n                            onSearchUsers={this.onSearchUsers.bind(this)}\n                            onSelectUser={this.onSelectUser.bind(this)}\n                        />\n                        {this.renderInvitationForm()}\n                        {this.renderInvitationStatus()} */}\n                    </div>\n                    <div className=\"col1 lastCol\">\n                        <h3>Selected User</h3>\n                        {this.renderSelectedUser()}\n                        {this.renderInvitationForm()}\n                    </div>\n                </div>\n                {/* <div className=\"row\">\n                    <div className=\"col1\">\n                        <h3>Send Invitation</h3>\n                        {this.renderInvitationForm()}\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div className=\"col1\">\n                        <h3>Status</h3>\n                        {this.renderInvitationStatus()}\n                    </div>\n                </div> */}\n                {/* {this.renderUsers()} */}\n                {this.renderFooter()}\n            </div>\n        )\n\n        // return (\n        //     <div className=\"InviteUser\">\n        //         {this.renderHeader()}\n        //         {this.renderOrgHeader()}\n        //         <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Select User to Invite</h3>\n        //                 <SelectUserComponent\n        //                     users={this.props.users}\n        //                     selectedUser={this.props.selectedUser}\n        //                     onSearchUsers={this.onSearchUsers.bind(this)}\n        //                     onSelectUser={this.onSelectUser.bind(this)}\n        //                 />\n        //                 {this.renderInvitationForm()}\n        //                 {this.renderInvitationStatus()}\n        //             </div>\n        //         </div>\n        //         {/* <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Send Invitation</h3>\n        //                 {this.renderInvitationForm()}\n        //             </div>\n        //         </div>\n        //         <div className=\"row\">\n        //             <div className=\"col1\">\n        //                 <h3>Status</h3>\n        //                 {this.renderInvitationStatus()}\n        //             </div>\n        //         </div> */}\n        //         {/* {this.renderUsers()} */}\n        //     </div>\n        // )\n    }\n}\n\nexport default InviteUser","import { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/inviteUser'\nimport InviteUser from './InviteUser'\nimport { UserQuery } from '../../data/model';\n\nexport interface OwnProps {\n\n}\n\ninterface StateProps {\n    organization: types.Organization\n    users: Array<types.OrganizationUser> | null\n    selectedUser: {\n        user: types.User,\n        relation: types.UserRelationToOrganization\n    } | null\n    state: types.InviteUserViewState\n}\n\ninterface DispatchProps {\n    onSearchUsers: (query: UserQuery) => void\n    onSelectUser: (username: string) => void\n    onSendInvitation: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    // if (!state.viewMembersView || (state.viewMembersView.view === null)) {\n    //     throw new Error('Runtime Error - view members view is not defined!')\n    // }\n    // return {\n    //     organization: state.viewMembersView.view.organization\n    // }\n\n    return {\n        organization: (state.inviteUserView.value as types.InviteUserValue).organization,\n        users: (state.inviteUserView.value as types.InviteUserValue).users,\n        selectedUser: (state.inviteUserView.value as types.InviteUserValue).selectedUser,\n        state: (state.inviteUserView.value as types.InviteUserValue).editState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onSearchUsers: ({ query, excludedUsers }) => {\n            dispatch(actions.inviteUserSearchUsers({ query, excludedUsers }) as any)\n        },\n        onSelectUser: (username: string) => {\n            dispatch(actions.selectUser(username) as any)\n        },\n        onSendInvitation: () => {\n            dispatch(actions.sendInvitation() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(InviteUser)","import * as React from 'react'\n\nimport InviteUserContainer from './InviteUserContainer'\nimport { ComponentLoadingState } from '../../types';\n\nexport interface InviteUserLoaderProps {\n    loadingState: ComponentLoadingState\n    organizationId: string\n    onInviteUserLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface InviteUserLoaderState {\n}\n\nclass InviteUserLoader extends React.Component<InviteUserLoaderProps, InviteUserLoaderState> {\n    constructor(props: InviteUserLoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading Users...\n            </div>\n        )\n    }\n\n    renderError() {\n        return (\n            <div>\n                Error!\n            </div>\n        )\n    }\n\n    render() {\n        switch (this.props.loadingState) {\n            case ComponentLoadingState.NONE:\n                this.props.onInviteUserLoad(this.props.organizationId)\n                return this.renderLoading()\n            case ComponentLoadingState.LOADING:\n                return this.renderLoading()\n            case ComponentLoadingState.ERROR:\n                return this.renderError()\n            case ComponentLoadingState.SUCCESS:\n                return (\n                    <InviteUserContainer />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n\n}\n\n// The container component -- just in this file!\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/inviteUser'\n// import ViewMembers from './component'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    loadingState: types.ComponentLoadingState\n}\n\ninterface DispatchProps {\n    onInviteUserLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        loadingState: state.inviteUserView.loadingState\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onInviteUserLoad: (organizationId: string) => {\n            dispatch(actions.inviteUserLoad(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(InviteUserLoader)","import * as React from 'react'\nimport Header from '../Header';\nimport { Icon, Button, Modal } from 'antd';\nimport { Redirect } from 'react-router-dom';\nimport './style.css'\nimport { Organization } from '../../types';\nimport OrganizationHeader from '../organizationHeader/container';\n\nexport interface ManageMembershipProps {\n    // temp.\n    organization: Organization\n}\n\ninterface MangeMembershipState {\n    cancelToBrowser: boolean\n    cancelToViewer: boolean\n}\n\nclass ManageMembership extends React.Component<ManageMembershipProps, MangeMembershipState> {\n    constructor(props: ManageMembershipProps) {\n        super(props)\n\n        this.state = {\n            cancelToBrowser: false,\n            cancelToViewer: false\n        }\n    }\n\n    doCancelToViewer() {\n        this.setState({ cancelToViewer: true })\n    }\n\n    doCancelToBrowser() {\n        this.setState({ cancelToBrowser: true })\n    }\n\n    doShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'Manage My Membership Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view to help you manage your membership...</p>\n                </div>\n            )\n        })\n    }\n\n    renderHeader() {\n        let orgName: string\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            <Icon type=\"tool\" />\n                            {' '}\n                            Managing your membership in the Organization \"\n                            {this.props.organization.name}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.doCancelToViewer.bind(this)}>\n                            Return to this Org\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.doCancelToBrowser.bind(this)}>\n                            Return to Orgs Browser\n                        </Button>\n                        <Button\n                            shape=\"circle\"\n                            icon=\"info\"\n                            onClick={this.doShowInfo.bind(this)}>\n                        </Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organization={this.props.organization} />\n        )\n    }\n\n    render() {\n\n        if (this.state.cancelToBrowser) {\n            return <Redirect push to=\"/organizations\" />\n        }\n\n        if (this.state.cancelToViewer) {\n            return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n        }\n\n        return (\n            <div className=\"ManageMembership\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <div className=\"body\">\n                    <div className=\"col1\">\n                        <div>\n                            editing area here\n                        </div>\n                    </div>\n                    <div className=\"col2\">\n                        <div>\n                            org user profile here\n                        </div>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default ManageMembership","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport { Model } from '../../data/model'\nimport { AppError, Organization, StoreState } from '../../types';\n\n// Loading\n\nexport interface Load extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n    organization: Organization\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n    error: AppError\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: Organization): LoadSuccess {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_SUCCESS,\n        organization: organization\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.MANAGE_MEMBERSHIP_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function manageMembershipLoad(organizationId: string, memberUsername: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        model.getOrg(organizationId)\n            .then((org) => {\n                dispatch(loadSuccess(org))\n            })\n            .catch((err) => {\n                dispatch(loadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n\n}\n\n// Modify fields\n\n\n// Save","import * as React from 'react'\n\nimport Container from './component'\nimport { ComponentLoadingState, StoreState, ManageMembershipValue, AppError, ManageMembershipView } from '../../types';\n\nexport interface LoaderProps {\n    organizationId: string\n    view: ManageMembershipView\n    onLoad: (organizationId: string) => void\n}\n\ninterface LoaderState {\n\n}\n\nclass ManageMembershipLoader extends React.Component<LoaderProps, LoaderState> {\n    constructor(props: LoaderProps) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading...\n            </div>\n        )\n    }\n\n    renderError(error: AppError) {\n        return (\n            <div>\n                Error: {error.message}\n            </div>\n        )\n    }\n\n    render() {\n        if (this.props.view.loading) {\n            return this.renderLoading()\n        } else {\n            if (this.props.view.error) {\n                return this.renderError(this.props.view.error)\n            } else if (this.props.view.value) {\n                return (\n                    <Container organization={this.props.view.value.organization} />\n                )\n            } else {\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            }\n        }\n\n\n        //     case ComponentLoadingState.NONE:\n        //         this.props.onLoad(this.props.organizationId)\n        //         return this.renderLoading()\n        //     case ComponentLoadingState.LOADING:\n        //         return this.renderLoading()\n        //     case ComponentLoadingState.SUCCESS:\n        //         if (this.props.view.viewState.)\n        //         return (\n        //             <Container organization={this.props.view.viewState.organization />\n        //         )\n        // }\n    }\n}\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\nimport * as actions from '../../redux/actions/manageMembership'\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: ManageMembershipView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.manageMembershipView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            // todo: username below...\n            dispatch(actions.manageMembershipLoad(organizationId, '') as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, StoreState>(mapStateToProps, mapDispatchToProps)(ManageMembershipLoader)","import * as React from 'react'\n\nimport OrganizationHeader from '../organizationHeader/container';\nimport { Redirect } from 'react-router-dom';\nimport { Organization, Narrative, UserRelationToOrganization } from '../../types';\nimport Header from '../Header';\nimport { Icon, Button, Modal } from 'antd';\nimport './component.css'\n\n\nexport interface Props {\n    organization: Organization\n    narratives: Array<Narrative>\n    selectedNarrative: Narrative | null\n    doSendRequest: (groupId: string, narrative: Narrative) => void\n    doSelectNarrative: (narrative: Narrative) => void\n}\n\nenum NavigateTo {\n    NONE = 0,\n    BROWSER,\n    VIEWER\n}\n\ninterface State {\n    navigateTo: NavigateTo,\n    // selectedNarrative: Narrative | null\n}\n\nexport class RequestAddNarrative extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n\n        this.state = {\n            navigateTo: NavigateTo.NONE,\n            // selectedNarrative: null\n        }\n    }\n\n    doCancelToBrowser() {\n        this.setState({ navigateTo: NavigateTo.BROWSER })\n    }\n\n    doCancelToViewer() {\n        this.setState({ navigateTo: NavigateTo.VIEWER })\n    }\n\n    doSelectNarrative(narrative: Narrative) {\n        this.props.doSelectNarrative(narrative)\n    }\n\n    doShowInfo() {\n        // this.setState({ showInfo: true })\n        Modal.info({\n            title: 'Reqeust to Add Narrative Help',\n            width: '50em',\n            content: (\n                <div>\n                    <p>This is the view to help you request the addition of a narrative to this org...</p>\n                </div>\n            )\n        })\n    }\n\n    doSendRequest() {\n        if (this.props.selectedNarrative === null) {\n            console.warn('attempt to send request without selected narrative')\n            return\n        }\n        this.props.doSendRequest(this.props.organization.id, this.props.selectedNarrative)\n    }\n\n    canSendRequest() {\n        if (this.props.selectedNarrative) {\n            return true\n        }\n        return false\n    }\n\n    renderOrgHeader() {\n        // apparently TS is not smart enough to know this from the conditional branch in render()!\n        if (!this.props.organization) {\n            return\n        }\n        return (\n            <OrganizationHeader organization={this.props.organization} />\n        )\n    }\n\n    renderHeader() {\n        let orgName: string\n        return (\n            <Header>\n                <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                    <div style={{ flex: '0 0 auto' }}>\n                        <span>\n                            <Icon type=\"tool\" />\n                            {' '}\n                            Managing your membership in the Organization \"\n                            {this.props.organization.name}\n                            \"\n                        </span>\n                    </div>\n                    <div style={{ flex: '1 1 0px', display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', alignItems: 'center' }}>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.doCancelToViewer.bind(this)}>\n                            Return to this Org\n                        </Button>\n                        <Button icon=\"undo\"\n                            type=\"danger\"\n                            onClick={this.doCancelToBrowser.bind(this)}>\n                            Return to Orgs Browser\n                        </Button>\n                        <Button\n                            shape=\"circle\"\n                            icon=\"info\"\n                            onClick={this.doShowInfo.bind(this)}>\n                        </Button>\n                    </div>\n                </div>\n            </Header>\n        )\n    }\n\n    renderNarratives() {\n        return this.props.narratives.map((narrative, index) => {\n            if (narrative.inOrganization) {\n                return (\n                    <div\n                        className=\"narrative narrativeInOrg\"\n                        onClick={() => { this.doSelectNarrative.call(this, narrative) }}\n                        key={String(index)}>\n                        <div className=\"title\">\n                            {narrative.title || 'n/a'}\n                        </div>\n                    </div>\n                )\n            } else {\n                return (\n                    <div\n                        className='narrative narrativeNotInOrg'\n                        onClick={() => { this.doSelectNarrative.call(this, narrative) }}\n                        key={String(index)}>\n                        <div className=\"title\">\n                            {narrative.title || 'n/a'}\n                        </div>\n                    </div>\n                )\n            }\n\n        })\n    }\n\n    renderSelectNarrative() {\n        return (\n            <div className=\"narrativeSelector scrollable-flex-column\">\n                {/* <div className=\"control\">\n                    <input placeholder=\"Search for a Narrative You Own\" />\n                </div> */}\n                <div className=\"narratives scrollable-flex-column\">\n                    <div className=\"narrativesTable\">\n                        {this.renderNarratives()}\n                    </div>\n\n                </div>\n            </div>\n        )\n    }\n\n    renderSelectedNarrativeButton() {\n        if (!this.props.selectedNarrative) {\n            return\n        }\n        if (this.props.selectedNarrative.inOrganization) {\n            return (\n                <i>\n                    This Narrative is associated with this Organization\n                </i>\n            )\n        }\n        let buttonLabel\n        if (this.props.organization.relation.type === UserRelationToOrganization.ADMIN ||\n            this.props.organization.relation.type === UserRelationToOrganization.OWNER) {\n            buttonLabel = 'Add Selected Narrative to Organization'\n        } else {\n            buttonLabel = 'Request Addition of Selected Narrative to Organization'\n        }\n        return (\n            <Button\n                type=\"primary\"\n                onClick={this.doSendRequest.bind(this)}\n                disabled={!this.canSendRequest.call(this)}\n            >{buttonLabel}</Button>\n        )\n\n    }\n\n    renderSelectedNarrative() {\n        if (this.props.selectedNarrative) {\n            return (\n                <div className=\"selectedNarrative\">\n                    <div className=\"title\">\n                        {this.props.selectedNarrative.title}\n                    </div>\n                    <div>\n                        <i>last modified</i>\n                        {' '}\n                        {Intl.DateTimeFormat('en-US', {\n                            month: 'long',\n                            day: 'numeric',\n                            year: 'numeric'\n                        }).format(this.props.selectedNarrative.modifiedAt)}\n                    </div>\n                </div>\n            )\n        } else {\n            return (\n                <div>\n                    <i>Select a narrative on the left to show it here and be able to add it to this organization.</i>\n                </div>\n            )\n        }\n    }\n\n    render() {\n        switch (this.state.navigateTo) {\n            case NavigateTo.BROWSER:\n                return <Redirect push to=\"/organizations\" />\n            case NavigateTo.VIEWER:\n                return <Redirect push to={\"/viewOrganization/\" + this.props.organization.id} />\n            case NavigateTo.NONE:\n            default:\n            // do nothing.\n        }\n\n        // let buttonLabel\n        // if (this.props.organization.relation.type === UserRelationToOrganization.ADMIN ||\n        //     this.props.organization.relation.type === UserRelationToOrganization.OWNER) {\n        //     buttonLabel = 'Add Selected Narrative to Organization'\n        // } else {\n        //     buttonLabel = 'Request Addition of Selected Narrative to Organization'\n        // }\n\n        return (\n            <div className=\"RequestNarrative scrollable-flex-column\">\n                {this.renderHeader()}\n                {this.renderOrgHeader()}\n                <div className=\"body scrollable-flex-column\">\n                    <div className=\"selectNarrativeCol scrollable-flex-column\">\n                        <h3>Select a Narrative</h3>\n                        {this.renderSelectNarrative()}\n                    </div>\n                    <div className=\"selectedNarrativeCol\">\n                        <h3>Selected Narrative</h3>\n                        {this.renderSelectedNarrative()}\n                        <div className=\"selectedNarrativeButtonBar\">\n                            {this.renderSelectedNarrativeButton()}\n                        </div>\n                    </div>\n                </div>\n                <div className=\"footer\">\n                    {/* <Button\n                        type=\"primary\"\n                        onClick={this.doSendRequest.bind(this)}\n                        disabled={!this.canSendRequest.call(this)}\n                    >{buttonLabel}</Button> */}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default RequestAddNarrative","import { Action } from 'redux'\nimport { ThunkDispatch } from 'redux-thunk'\nimport { ActionFlag } from './index'\nimport { Model } from '../../data/model'\nimport { AppError, Organization, StoreState, Narrative, GroupRequest } from '../../types'\nimport { Group } from 'antd/lib/radio';\n\nexport interface Load extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD\n}\n\nexport interface LoadStart extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n}\n\nexport interface LoadSuccess extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n    organization: Organization,\n    narratives: Array<Narrative>\n}\n\nexport interface LoadError extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR\n    error: AppError\n}\n\nexport function loadStart(): LoadStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_START\n    }\n}\n\nexport function loadSuccess(organization: Organization, narratives: Array<Narrative>): LoadSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,\n        organization: organization,\n        narratives: narratives\n    }\n}\n\nexport function loadError(error: AppError): LoadError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_LOAD_ERROR,\n        error: error\n    }\n}\n\nexport function load(organizationId: string) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(loadStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        Promise.all([\n            model.getOrg(organizationId),\n            model.getOwnNarratives(organizationId)\n        ])\n            .then(([org, narratives]) => {\n                dispatch(loadSuccess(org, narratives))\n            })\n            .catch((err) => {\n                console.error('loading error', err)\n                dispatch(loadError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Selecting narrative\nexport interface SelectNarrative {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE,\n    narrative: Narrative\n}\n\nexport interface SelectNarrativeStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n}\n\nexport interface SelectNarrativeSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS\n    narrative: Narrative\n}\n\nexport interface SelectNarrativeError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR\n    error: AppError\n}\n\nexport function selectNarrativeStart(): SelectNarrativeStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START\n    }\n}\n\nexport function selectNarrativeSuccess(narrative: Narrative): SelectNarrativeSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,\n        narrative: narrative\n    }\n}\n\nexport function selectNarrativeError(error: AppError): SelectNarrativeError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR,\n        error: error\n    }\n}\n\nexport function selectNarrative(narrative: Narrative) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(selectNarrativeStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        // TODO: fetch narrative and populate the selected narrative accordingly...\n        dispatch(selectNarrativeSuccess(narrative))\n    }\n}\n\n// Sending Request\nexport interface SendRequest {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND\n}\n\nexport interface SendRequestStart {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n}\n\nexport interface SendRequestSuccess {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n    request: GroupRequest | boolean\n}\n\nexport interface SendRequestError {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n    error: AppError\n}\n\n\nexport function sendRequestStart(): SendRequestStart {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_START\n    }\n}\n\nexport function sendRequestSuccess(request: GroupRequest | boolean): SendRequestSuccess {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,\n        request: request\n    }\n}\n\nexport function sendRequestError(error: AppError): SendRequestError {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_SEND_ERROR,\n        error: error\n    }\n}\n\nexport function sendRequest(groupId: string, narrative: Narrative) {\n    return (dispatch: ThunkDispatch<StoreState, void, Action>, getState: () => StoreState) => {\n        dispatch(sendRequestStart())\n\n        const {\n            auth: { authorization: { token, username } },\n            app: { config } } = getState()\n\n        const model = new Model({\n            token, username,\n            groupsServiceURL: config.services.Groups.url,\n            userProfileServiceURL: config.services.UserProfile.url,\n            workspaceServiceURL: config.services.Workspace.url,\n            serviceWizardURL: config.services.ServiceWizard.url\n        })\n\n        Promise.all([\n            model.addOrRequestNarrativeToGroup(groupId, narrative)\n        ])\n            .then(([request]) => {\n                dispatch(sendRequestSuccess(request))\n            })\n            .catch((err) => {\n                console.error('loading error', err)\n                dispatch(sendRequestError({\n                    code: err.name,\n                    message: err.message\n                }))\n            })\n    }\n}\n\n// Unloading\n\nexport interface Unload extends Action {\n    type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n}\n\nexport function unload(): Unload {\n    return {\n        type: ActionFlag.REQUEST_ADD_NARRATIVE_UNLOAD\n    }\n}","import { Dispatch, Action } from 'redux'\n\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\n\nimport Component from './component'\nimport * as actions from '../../redux/actions/requestAddNarrative'\n\nexport interface OwnProps {\n}\n\ninterface StateProps {\n    organization: types.Organization\n    narratives: Array<types.Narrative>\n    selectedNarrative: types.Narrative | null\n}\n\ninterface DispatchProps {\n    doSendRequest: (groupId: string, narrative: types.Narrative) => void\n    doSelectNarrative: (narrative: types.Narrative) => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n\n    const {\n        requestNarrativeView\n    } = state\n    if (requestNarrativeView.value === null) {\n        throw new Error('view value is not defined!')\n    }\n\n    return {\n        organization: requestNarrativeView.value.organization,\n        narratives: requestNarrativeView.value.narratives,\n        selectedNarrative: requestNarrativeView.value.selectedNarrative\n    }\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<Action>): DispatchProps {\n    return {\n        doSendRequest: (groupId: string, narrative: types.Narrative) => {\n            dispatch(actions.sendRequest(groupId, narrative) as any)\n        },\n        doSelectNarrative: (narrative: types.Narrative) => {\n            dispatch(actions.selectNarrative(narrative) as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Component)","import * as React from 'react'\n\nimport Container from './container'\n\nexport interface Props {\n    organizationId: string\n    view: types.RequestNarrativeView\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\ninterface State {\n}\n\nclass Loader extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n    }\n\n    renderLoading() {\n        return (\n            <div>\n                Loading Your Narratives...\n            </div>\n        )\n    }\n\n    renderError(error: types.AppError) {\n        return (\n            <div>\n                Error!\n                <div>\n                    {error.message}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n\n        switch (this.props.view.status) {\n            case types.RequestNarrativeState.NONE:\n                this.props.onLoad(this.props.organizationId)\n                return this.renderLoading()\n            case types.RequestNarrativeState.LOADING:\n                return this.renderLoading()\n            case types.RequestNarrativeState.ERROR:\n                if (this.props.view.error) {\n                    return this.renderError(this.props.view.error)\n                } else {\n                    return this.renderError({\n                        code: 'Missing Error',\n                        message: 'The error appears to be missing'\n                    })\n                }\n            default:\n                return (\n                    <Container />\n                )\n        }\n    }\n\n    componentWillUnmount() {\n        this.props.onUnload()\n    }\n}\n\n//\n\nimport { Dispatch } from 'redux'\nimport { connect } from 'react-redux'\n\nimport * as types from '../../types'\nimport * as actions from '../../redux/actions/requestAddNarrative'\nimport RequestAddNarrative from './component';\n\nexport interface OwnProps {\n    organizationId: string\n}\n\ninterface StateProps {\n    view: types.RequestNarrativeView\n}\n\ninterface DispatchProps {\n    onLoad: (organizationId: string) => void\n    onUnload: () => void\n}\n\nfunction mapStateToProps(state: types.StoreState, props: OwnProps): StateProps {\n    return {\n        view: state.requestNarrativeView\n    }\n}\n\nexport function mapDispatchToProps(dispatch: Dispatch<actions.Load>): DispatchProps {\n    return {\n        onLoad: (organizationId: string) => {\n            dispatch(actions.load(organizationId) as any)\n        },\n        onUnload: () => {\n            dispatch(actions.unload() as any)\n        }\n    }\n}\n\nexport default connect<StateProps, DispatchProps, OwnProps, types.StoreState>(mapStateToProps, mapDispatchToProps)(Loader)","import { StoreState, SortDirection, AuthState, AppState, EditState, SaveState, ValidationState, ViewOrgState, ViewMembersViewState, BrowseOrgsState, InviteUserViewState, ComponentLoadingState, RequestNarrativeState } from \"../types\";\nimport { StaticData } from \"../data/model\";\n\nexport class StateInstances {\n    static makeInitialState(): StoreState {\n        return {\n            browseOrgs: {\n                state: BrowseOrgsState.NONE,\n                error: null,\n                view: {\n                    rawOrganizations: [],\n                    organizations: [],\n                    totalCount: 0,\n                    filteredCount: 0,\n                    sortBy: 'name',\n                    sortDirection: SortDirection.ASCENDING,\n                    filter: 'all',\n                    searchTerms: [],\n                    selectedOrganizationId: null,\n                    searching: false\n                }\n            },\n\n            auth: {\n                status: AuthState.NONE,\n                message: '',\n                authorization: {\n                    token: '',\n                    username: '',\n                    realname: '',\n                    roles: []\n                }\n            },\n            error: null,\n\n            app: {\n                status: AppState.NONE,\n                config: {\n                    baseUrl: '',\n                    services: {\n                        Groups: {\n                            url: ''\n                        },\n                        UserProfile: {\n                            url: ''\n                        },\n                        Workspace: {\n                            url: ''\n                        },\n                        ServiceWizard: {\n                            url: ''\n                        }\n                    }\n                }\n            },\n            addOrg: {\n                editState: EditState.NONE,\n                saveState: SaveState.NONE,\n                validationState: ValidationState.NONE,\n                newOrganization: StaticData.makeEmptyEditableOrganization()\n            },\n            updateOrg: {\n                pending: false\n            },\n            viewOrg: {\n                state: ViewOrgState.NONE\n            },\n            editOrg: {\n                organizationId: '',\n                editState: EditState.NONE,\n                saveState: SaveState.NONE,\n                validationState: ValidationState.NONE,\n                editedOrganization: StaticData.makeEmptyEditableOrganization(),\n                organization: null\n            },\n            manageOrganizationRequestsView: {\n                state: ComponentLoadingState.NONE,\n                error: null,\n                viewState: null\n            },\n            viewMembersView: {\n                state: ViewMembersViewState.NONE,\n                error: null,\n                view: null\n            },\n            inviteUserView: {\n                loadingState: ComponentLoadingState.NONE,\n                value: null,\n                error: null\n            },\n            manageMembershipView: {\n                loading: false,\n                error: null,\n                value: null\n            },\n            requestNarrativeView: {\n                status: RequestNarrativeState.NONE,\n                error: null,\n                value: null\n            }\n        }\n    }\n}","import React, { Component } from 'react'\nimport { Route, Switch } from 'react-router'\nimport { Redirect, HashRouter } from 'react-router-dom'\n\n// redux\nimport { Provider } from 'react-redux';\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport thunk from 'redux-thunk'\n\nimport theReducer from './redux/reducers'\n\n// the app and subcomponents\nimport './App.css';\n\n// fontawesome setup\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { faSpinner, faSearch, faGlobe, faUserLock } from '@fortawesome/free-solid-svg-icons'\nlibrary.add(faSpinner, faSearch, faGlobe, faUserLock)\n\nimport OrganizationsBrowser from './components/browseOrgs/OrganizationsBrowserContainer'\nimport NewOrganization from './components/newOrganization/container'\nimport ViewOrganization from './components/viewOrganization/ViewOrganizationContainer'\nimport EditOrganization from './components/editOrganization/container'\nimport Auth from './containers/Auth'\nimport KBaseIntegration from './containers/KBaseIntegration'\nimport ManageOrganizationRequests from './components/manageOrganizationRequests/loader'\nimport ViewMembers from './components/viewMembers/loader'\nimport InviteUser from './components/inviteUser/InviteUserLoader'\nimport ManageMembership from './components/manageMembership/loader'\nimport RequestAddNarrative from './components/requestAddNarrative/loader'\nimport { StateInstances } from './redux/state';\n\n// Put the redux store together\n// Just for prototyping --- This is super naive and will change!\n// import {organizations} from './data/temp';\n\n// TODO: determine the environment\n\nconst hosted = window.frameElement ? true : false\n\n// Set up initial state \n// TODO: move to own file\nconst initialState = StateInstances.makeInitialState()\n\n\n// TODO: remove the cast of reducer to any...\n// const middleware = [thunk]\n// const store = createStore<StoreState, SortOrgs, null, null>(theReducer as any, initialState, applyMiddleware(thunk));\nconst store = createStore(theReducer as any, initialState as any, compose(applyMiddleware(thunk)))\n\nclass App extends Component {\n  constructor(props: any) {\n    super(props)\n  }\n\n  render() {\n    return (\n      <Provider store={store}>\n        <Auth hosted={hosted}>\n          <KBaseIntegration>\n            <HashRouter basename=\"/orgs/\">\n              <div className=\"App scrollable-flex-column\">\n                <div className=\"App-body scrollable-flex-column\">\n                  <Switch>\n                    <Route path=\"/organizations\" component={OrganizationsBrowser} />\n                    <Route path=\"/newOrganization\" component={NewOrganization} />\n                    {/* The destructuring below is ugly, but effective */}\n                    <Route path=\"/viewOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ViewOrganization id={id} />} />\n                    <Route path=\"/editOrganization/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <EditOrganization id={id} />} />\n                    <Route path=\"/manageOrganizationRequests/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ManageOrganizationRequests organizationId={id} />} />\n                    <Route path=\"/viewMembers/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => <ViewMembers organizationId={id} />} />\n                    <Route path=\"/inviteUser/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<InviteUser organizationId={id} />)} />\n                    <Route path=\"/membership/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<ManageMembership organizationId={id} />)} />\n                    <Route path=\"/requestAddNarrative/:id\" component={({ match: { params: { id } } }: { match: { params: { id: string } } }) => (<RequestAddNarrative organizationId={id} />)} />\n\n                    <Redirect from=\"/\" to=\"/organizations\" exact={true} />\n                  </Switch>\n                </div>\n              </div>\n            </HashRouter>\n          </KBaseIntegration>\n        </Auth>\n      </Provider>\n    )\n  }\n}\n\nexport default App\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\nimport 'typeface-oxygen';\nimport 'normalize.css';\nimport 'antd/dist/antd.css'\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}