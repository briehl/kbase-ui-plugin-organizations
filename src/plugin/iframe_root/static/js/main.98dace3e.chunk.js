(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{109:function(e,t,n){e.exports=n(204)},114:function(e,t,n){},120:function(e,t,n){},122:function(e,t,n){},125:function(e,t,n){},127:function(e,t,n){},186:function(e,t,n){},188:function(e,t,n){},190:function(e,t,n){},192:function(e,t,n){},196:function(e,t,n){},204:function(e,t,n){"use strict";n.r(t);var r,a,i,o,s,c,u,l,d,m,E=n(0),p=n.n(E),h=n(11),O=n.n(h),f=(n(114),n(8)),R=n(9),v=n(14),g=n(13),_=n(15),S=n(206),D=n(211),A=n(210),T=n(18),N=n(40),y=n(98);!function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.FETCHING=1]="FETCHING",e[e.READY=2]="READY",e[e.EDITING_CAN_SAVE=3]="EDITING_CAN_SAVE",e[e.EDITING_ERRORS=4]="EDITING_ERRORS",e[e.SAVING=5]="SAVING",e[e.SAVED=6]="SAVED",e[e.ERROR=7]="ERROR"}(i||(i={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(o||(o={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(s||(s={})),function(e){e.NONE="NONE",e.VALID="VALID",e.INVALID="INVALID"}(c||(c={})),function(e){e[e.NONE=0]="NONE",e[e.UNEDITED_OK=1]="UNEDITED_OK",e[e.UNEDITED_ERROR=2]="UNEDITED_ERROR",e[e.EDITED_OK=3]="EDITED_OK",e[e.EDITED_ERROR=4]="EDITED_ERROR",e[e.EDITED_WARNING=5]="EDITED_WARNING"}(u||(u={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(l||(l={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(d||(d={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(m||(m={}));var w,I=n(2);!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.SORT_ORGS=5]="SORT_ORGS",e[e.SORT_ORGS_START=6]="SORT_ORGS_START",e[e.FILTER_ORGS=7]="FILTER_ORGS",e[e.FILTER_ORGS_START=8]="FILTER_ORGS_START",e[e.SEARCH_ORGS=9]="SEARCH_ORGS",e[e.SEARCH_ORGS_START=10]="SEARCH_ORGS_START",e[e.SEARCH_ORGS_SUCCESS=11]="SEARCH_ORGS_SUCCESS",e[e.SEARCH_ORGS_ERROR=12]="SEARCH_ORGS_ERROR",e[e.UPDATE_ORG=13]="UPDATE_ORG",e[e.UPDATE_ORG_START=14]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=15]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=16]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_FETCH=17]="VIEW_ORG_FETCH",e[e.VIEW_ORG_FETCH_START=18]="VIEW_ORG_FETCH_START",e[e.VIEW_ORG_FETCH_SUCCESS=19]="VIEW_ORG_FETCH_SUCCESS",e[e.VIEW_ORG_FETCH_ERROR=20]="VIEW_ORG_FETCH_ERROR",e[e.VIEW_ORG_STOP=21]="VIEW_ORG_STOP",e[e.EDIT_ORG=22]="EDIT_ORG",e[e.EDIT_ORG_START=23]="EDIT_ORG_START",e[e.EDIT_ORG_SUCCESS=24]="EDIT_ORG_SUCCESS",e[e.EDIT_ORG_ERROR=25]="EDIT_ORG_ERROR",e[e.EDIT_ORG_SAVE=26]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=27]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=28]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=29]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=30]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=31]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=32]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=33]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=34]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=35]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_EDIT=36]="ADD_ORG_EDIT",e[e.ADD_ORG_EDIT_START=37]="ADD_ORG_EDIT_START",e[e.ADD_ORG_EDIT_FINISH=38]="ADD_ORG_EDIT_FINISH",e[e.ADD_ORG_UPDATE_NAME=39]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=40]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=41]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_ID=42]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=43]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=44]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_DESCRIPTION=45]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=46]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=47]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_EVALUATE=48]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=49]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=50]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG=51]="ADD_ORG",e[e.ADD_ORG_START=52]="ADD_ORG_START",e[e.ADD_ORG_SUCCESS=53]="ADD_ORG_SUCCESS",e[e.ADD_ORG_ERROR=54]="ADD_ORG_ERROR",e[e.AUTH_CHECK=55]="AUTH_CHECK",e[e.AUTH_CHECK_START=56]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=57]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=58]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=59]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=60]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=61]="AUTH_ADD_AUTHORIZATION"}(w||(w={}));var C=function(e,t){switch(t.type){case w.ADD_ORG_START:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{saveState:s.SAVING})})}(e);case w.ADD_ORG_SUCCESS:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.UNEDITED,saveState:s.SAVED})})}(e);case w.ADD_ORG_ERROR:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{saveState:s.SAVE_ERROR,error:t.error})})}(e,t);case w.ADD_ORG_EDIT_START:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.UNEDITED,validationState:c.NONE,saveState:s.NEW,newOrganization:{id:{value:"",status:u.NONE,error:{type:r.NONE}},name:{value:"",status:u.NONE,error:{type:r.NONE}},description:{value:"",status:u.NONE,error:{type:r.NONE}}}})})}(e);case w.ADD_ORG_EDIT_FINISH:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.UNEDITED})})}(e);case w.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.EDITED,newOrganization:Object(I.a)({},e.addOrg.newOrganization,{name:{value:t.name,status:u.EDITED_OK,error:{type:r.NONE}}})})})}(e,t);case w.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.EDITED,newOrganization:Object(I.a)({},e.addOrg.newOrganization,{name:{value:t.name,status:u.EDITED_ERROR,error:t.error}})})})}(e,t);case w.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.EDITED,newOrganization:Object(I.a)({},e.addOrg.newOrganization,{id:{value:t.id,status:u.EDITED_OK,error:{type:r.NONE}}})})})}(e,t);case w.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.EDITED,newOrganization:Object(I.a)({},e.addOrg.newOrganization,{id:{value:t.id,status:u.EDITED_ERROR,error:t.error}})})})}(e,t);case w.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.EDITED,newOrganization:Object(I.a)({},e.addOrg.newOrganization,{description:{value:t.description,status:u.EDITED_OK,error:{type:r.NONE}}})})})}(e,t);case w.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{editState:o.EDITED,newOrganization:Object(I.a)({},e.addOrg.newOrganization,{description:{value:t.description,status:u.EDITED_ERROR,error:t.error}})})})}(e,t);case w.ADD_ORG_EVALUATE_OK:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{validationState:c.VALID})})}(e);case w.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return Object(I.a)({},e,{addOrg:Object(I.a)({},e.addOrg,{validationState:c.INVALID})})}(e);default:return null}};var b=function(e,t){switch(t.type){case w.EDIT_ORG_START:return function(e,t){return Object(I.a)({},e,{editOrg:{state:i.FETCHING}})}(e);case w.EDIT_ORG_SUCCESS:return function(e,t){return Object(I.a)({},e,{editOrg:{state:i.READY,editedOrganization:t.organization}})}(e,t);case w.EDIT_ORG_ERROR:return function(e,t){return Object(I.a)({},e,{editOrg:{state:i.ERROR,error:t.error}})}(e,t);case w.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return console.log("success!",t.name),Object(I.a)({},e,{editOrg:Object(I.a)({},e.editOrg,{editedOrganization:Object(I.a)({},e.editOrg.editedOrganization,{name:{value:t.name}})})})}(e,t);case w.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return Object(I.a)({},e,{editOrg:Object(I.a)({},e.editOrg,{editedOrganization:Object(I.a)({},e.editOrg.editedOrganization,{name:{value:t.name,error:t.error}})})})}(e,t);case w.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return console.log("success!",t.description),Object(I.a)({},e,{editOrg:Object(I.a)({},e.editOrg,{editedOrganization:Object(I.a)({},e.editOrg.editedOrganization,{description:{value:t.description}})})})}(e,t);case w.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return Object(I.a)({},e,{editOrg:Object(I.a)({},e.editOrg,{editedOrganization:Object(I.a)({},e.editOrg.editedOrganization,{description:{value:t.description,error:t.error}})})})}(e,t);default:return null}};var U=function(e,t){switch(t.type){case w.VIEW_ORG_FETCH_START:return function(e,t){return Object(I.a)({},e,{viewOrg:Object(I.a)({},e.viewOrg,{state:l.FETCHING})})}(e);case w.VIEW_ORG_FETCH_SUCCESS:return function(e,t){return Object(I.a)({},e,{viewOrg:Object(I.a)({},e.viewOrg,{state:l.READY,organization:t.organization})})}(e,t);case w.VIEW_ORG_FETCH_ERROR:return function(e,t){return Object(I.a)({},e,{viewOrg:Object(I.a)({},e.viewOrg,{state:l.ERROR,error:t.error})})}(e,t);case w.VIEW_ORG_STOP:return function(e,t){return Object(I.a)({},e,{viewOrg:{state:l.NONE}})}(e);default:return null}};var k=function(e,t){switch(t.type){case w.SEARCH_ORGS_START:return function(e,t){return t.searchTerms,e.filter,e.sortBy,e.sortDirection,e.auth.authorization.username,Object(I.a)({},e,{searching:!0,searchTerms:t.searchTerms})}(e,t);case w.SEARCH_ORGS_SUCCESS:return function(e,t){return Object(I.a)({},e,{searching:!1,organizations:t.organizations,totalCount:t.totalCount,filteredCount:t.organizations.length})}(e,t);case w.SEARCH_ORGS_ERROR:return function(e,t){return Object(I.a)({},e,{error:t.error})}(e,t);case w.SORT_ORGS_START:return function(e,t){return e.searchTerms,e.filter,t.sortBy,t.sortDirection,e.auth.authorization.username,Object(I.a)({},e,{searching:!0,sortBy:t.sortBy,sortDirection:t.sortDirection})}(e,t);case w.FILTER_ORGS_START:return function(e,t){var n=t.filter;return Object(I.a)({},e,{searching:!0,filter:n})}(e,t);default:return null}};var G=function(e,t){switch(t.type){case w.AUTH_CHECK_START:return function(e,t){return Object(I.a)({},e,{auth:{status:a.CHECKING,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case w.AUTH_AUTHORIZED:return function(e,t){return Object(I.a)({},e,{auth:{status:a.AUTHORIZED,authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case w.AUTH_UNAUTHORIZED:return function(e,t){return Object(I.a)({},e,{auth:{status:a.UNAUTHORIZED,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case w.AUTH_CHECK_ERROR:return function(e,t){return Object(I.a)({},e,{auth:{status:a.ERROR,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);default:return null}};var z=function(e,t){switch(t.type){case w.APP_SUCCESS:return function(e,t){return Object(I.a)({},e,{app:{status:d.READY,config:t.config}})}(e,t);default:return null}};var j=function(e,t){return C(e,t)||b(e,t)||k(e,t)||U(e,t)||G(e,t)||z(e,t)||e},P=(n(120),n(99)),H=n(77),L=n(213),x=(n(122),function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).state={searchTerms:[]},n}return Object(_.a)(t,e),Object(R.a)(t,[{key:"renderOrg",value:function(e,t){return E.createElement("div",{className:"row",key:String(t)},E.createElement("div",{className:"col1"},E.createElement("div",{className:"orgName"},E.createElement(L.a,{to:"/viewOrganization/".concat(e.id)},e.name)),E.createElement("div",{className:"orgOwner"},E.createElement("span",{className:"field-label"},"owner"),E.createElement("a",{href:"#people/{org.owner.username}",target:"_blank"},e.owner.realname," \u2768",e.owner.username,"\u2769"))),E.createElement("div",{className:"col2"}))}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,n){return e.renderOrg(t,n)}):E.createElement("div",null,"Sorry, no orgs")}},{key:"render",value:function(){return E.createElement("div",{className:"Organizations"},this.renderOrgs())}}]),t}(E.Component));var V=Object(T.b)(function(e){return{organizations:e.organizations}})(x),F=(n(125),n(209)),M=n(205),W=n(208),B=n(212),K=(n(127),n(45)),Z=function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(R.a)(t,[{key:"buildSeparator",value:function(){if(this.props.children)return E.createElement(K.a,{style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"render",value:function(){this.props.title;return E.createElement("div",{className:"Header"},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement(L.a,{to:"/organizations"},E.createElement(K.c,{style:{verticalAlign:"middle"}})," ","Orgs")),E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},this.buildSeparator(),this.props.children))}}]),t}(E.Component),Y=n(55),q=n.n(Y),J=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).searchInput=E.createRef(),n.searchButton=E.createRef(),n.state={searchInput:""},n.props.onSearchOrgs([]),n}return Object(_.a)(t,e),Object(R.a)(t,[{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){this.props.onSortOrgs(e.target.value,this.props.sortDirection)}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onFilterChange",value:function(e){this.props.onFilterOrgs(e.target.value)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderControlArea",value:function(){return E.createElement("div",{className:"OrganizationsBrowser-controlArea"},this.renderSortArea2(),this.renderFilterArea2())}},{key:"renderSortArea2",value:function(){return E.createElement("div",{className:"controlGroup"},E.createElement("div",{className:"header"},"sort"),E.createElement(q.a,{onChange:this.onSortByChange.bind(this),value:this.props.sortBy},E.createElement(F.a,{className:"radio",value:"name"},"Org name"),E.createElement(F.a,{className:"radio",value:"owner"},"Owner")),E.createElement("div",{style:{marginTop:"10px"}},E.createElement(q.a,{onChange:this.onSortDirectionChange.bind(this),value:this.props.sortDirection},E.createElement(F.a,{className:"radio",value:m.ASCENDING},E.createElement(M.a,{type:"sort-ascending"})," Ascending"),E.createElement(F.a,{className:"radio",value:m.DESCENDING},E.createElement(M.a,{type:"sort-descending"})," Descending"))))}},{key:"renderFilterArea2",value:function(){return E.createElement("div",{className:"controlGroup"},E.createElement("div",{className:"header"},"filter"),E.createElement(q.a,{onChange:this.onFilterChange.bind(this),value:this.props.filter},E.createElement(F.a,{className:"radio",value:"all"},"All"),E.createElement(F.a,{className:"radio",value:"owned"},"Owned by you"),E.createElement(F.a,{className:"radio",value:"notOwned"},"Owned by others")))}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?E.createElement("span",null,"No organizations in the system"):0===this.props.filteredCount?E.createElement("span",null,"No organizations found out of"," ",this.props.totalCount," ","available."):this.props.totalCount===this.props.filteredCount?E.createElement("span",null,"Showing all"," ",this.props.totalCount," ","organizations"):E.createElement("span",null,"Found"," ",this.props.filteredCount," ","out of"," ",this.props.totalCount," ","organizations")}},{key:"renderSearchIcon",value:function(){return this.props.searching?E.createElement(M.a,{type:"loading"}):E.createElement(M.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return E.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},E.createElement("input",{placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),E.createElement(W.a,{title:"Enter one or more words to search organizations by name or owner"},E.createElement(M.a,{type:"info-circle",theme:"twoTone",style:{alignSelf:"end"}})),E.createElement(B.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon(),"Search"),E.createElement(B.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput()},"Show all"),E.createElement("div",{className:"message"},this.renderSearchFeedback()))}},{key:"renderHeader",value:function(){return E.createElement(Z,{title:"Organizations"},E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement("span",null,"Browse and Search Organizations")),E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end"}},E.createElement(L.a,{to:"/newOrganization"},E.createElement(B.a,{icon:"plus-circle"},"Create Organization")))))}},{key:"render",value:function(){return E.createElement("div",{className:"OrganizationsBrowser"},this.renderHeader(),E.createElement("div",{className:"searchBarRow"},E.createElement("div",{className:"col1"}),E.createElement("div",{className:"col2"},this.renderSearchBar())),E.createElement("div",{className:"bodyRow"},E.createElement("div",{className:"col1"},this.renderControlArea()),E.createElement("div",{className:"col2"},E.createElement(V,null))))}}]),t}(E.Component),$=function(){function e(t){var n=t.url,r=t.token;Object(f.a)(this,e),this.url=n,this.token=r}return Object(R.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){console.log("info",e)})}},{key:"getUserProfile",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",[e]))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0][0]})}},{key:"getUserProfiles",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",e))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}}]),e}(),Q=function(){function e(t){var n=t.token,r=t.url;Object(f.a)(this,e),this.token=n,this.url=r}return Object(R.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getGroups",value:function(){return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e.filter(function(e){return"Organization"===e.type})})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"createGroup",value:function(e){return fetch(this.url+"/group/"+e.id,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify({name:e.name,type:e.type,description:e.description})}).then(function(e){return e.json()}).then(function(e){return e})}}]),e}(),X=function(){function e(t){var n=t.url,r=t.token;Object(f.a)(this,e),this.url=n,this.token=r}return Object(R.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:"Workspace."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:"Workspace."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("ver"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}}]),e}();var ee=function(){function e(t){Object(f.a)(this,e),this.params=t}return Object(R.a)(e,[{key:"groupToOrg",value:function(e,t){var n=e.id,r=e.name,a=e.owner,i=e.description,o=e.createdate,s=e.moddate;return{id:n,name:r,description:i,owner:{username:a,realname:t.user.realname},createdAt:new Date(o),modifiedAt:new Date(s)}}},{key:"briefGroupToBriefOrg",value:function(e,t){return{id:e.id,name:e.name,owner:{username:e.owner,realname:t.user.realname},createdAt:new Date,modifiedAt:new Date}}},{key:"groupsToOrgs",value:function(e,t){var n=this;return e.map(function(e){return n.briefGroupToBriefOrg(e,t.get(e.owner))})}},{key:"queryOrgs",value:function(e){var t=this,n=new Q({url:this.params.groupsServiceURL,token:this.params.token}),r=new $({url:this.params.userProfileServiceURL,token:this.params.token});new X({url:this.params.workspaceServiceURL,token:this.params.token});return n.getGroups().then(function(e){var n=e.reduce(function(e,t){return e.set(t.owner,!0),e},new Map).keys();return r.getUserProfiles(Array.from(n)).then(function(n){var r=n.reduce(function(e,t){return e.set(t.user.username,t),e},new Map);return t.groupsToOrgs(e,r)})}).then(function(t){return{organizations:function(e,t,n){var r=n===m.ASCENDING?1:-1;switch(t){case"name":return e.slice().sort(function(e,t){return r*e.name.localeCompare(t.name)});case"owner":return e.slice().sort(function(e,t){return r*e.owner.username.localeCompare(t.owner.username)});default:return console.warn("unimplemented sort field: "+t),e}}(function(e,t){var n=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||n.every(function(t){return t.test(e.name)||t.test(e.owner.username)||t.test(e.owner.realname)})})}(function(e,t,n){switch(t){case"all":return e;case"owned":return e.filter(function(e){return e.owner.username===n});case"notOwned":return e.filter(function(e){return e.owner.username!==n});default:return console.warn("unknown filter : "+t),e}}(t,e.filter,e.username),e.searchTerms),e.sortBy,e.sortDirection),total:t.length}})}},{key:"getOrg",value:function(e){var t=new Q({url:this.params.groupsServiceURL,token:this.params.token}),n=new $({url:this.params.userProfileServiceURL,token:this.params.token});return t.getGroupById(e).then(function(e){return n.getUserProfile(e.owner).then(function(t){return{id:e.id,name:e.name,description:e.description,createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),owner:{username:e.owner,realname:t.user.realname}}})})}},{key:"getGroup",value:function(e){return 0===e.length?Promise.reject(new Error("Group id may not be an empty string")):new Q({url:this.params.groupsServiceURL,token:this.params.token}).getGroupById(e).then(function(e){return e})}},{key:"addOrg",value:function(e,t){var n=this,a=new Q({url:this.params.groupsServiceURL,token:this.params.token}),i=new $({url:this.params.userProfileServiceURL,token:this.params.token});return e.id.error&&e.id.error.type===r.ERROR||e.name.error&&e.name.error.type===r.ERROR||e.description.error&&e.description.error.type===r.ERROR?Promise.reject(new Error("One or more fields are invalid")):a.createGroup({id:e.id.value,name:e.name.value,description:e.description.value,type:"Organization"}).then(function(e){return i.getUserProfile(e.owner).then(function(t){return n.groupToOrg(e,t)})})}},{key:"updateOrg",value:function(e,t){var n=this;return new Promise(function(t){return(r=200,new Promise(function(e){window.setTimeout(function(){e(!0)},r)})).then(function(){return n.getOrg(e)});var r})}},{key:"validateOrgId",value:function(e){return te.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return te.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return te.validateOrgDescription(e)}}]),e}(),te=function(){function e(){Object(f.a)(this,e)}return Object(R.a)(e,null,[{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:r.ERROR,message:"Organization id may not be empty"}];if(e.match(/\s/))return[e,{type:r.ERROR,message:"Organization id may not contain a space"}];if(e.length>100)return[e,{type:r.ERROR,message:"Organization id may not be longer than 100 characters"}];return e.match(/^[a-zA-Z0-9_]+$/)?[e,{type:r.NONE}]:[e,{type:r.ERROR,message:"Organization id may only contain alphanumeric (a-z, A-Z, 0-9) and underscore (_)"}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:r.ERROR,message:"Organization name may not be empty"}]:e.length>256?[e,{type:r.ERROR,message:"Organization name may not be longer than 256 characters"}]:[e,{type:r.NONE}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[e,{type:r.ERROR,message:"Organization description may not be empty"}]:e.length>4096?[e,{type:r.ERROR,message:"Organization name may not be longer than 4,096 characters"}]:[e,{type:r.NONE}]}}]),e}();function ne(e){return function(t,n){t({type:w.VIEW_ORG_FETCH_START});var r=n(),a=r.auth.authorization.token,i=r.app.config;return new ee({token:a,groupsServiceURL:i.services.Groups.url,userProfileServiceURL:i.services.UserProfile.url,workspaceServiceURL:i.services.Workspace.url}).getOrg(e).then(function(e){t(function(e){return{type:w.VIEW_ORG_FETCH_SUCCESS,organization:e}}(e))}).catch(function(e){var n;t((n={code:e.name,message:e.message},{type:w.VIEW_ORG_FETCH_ERROR,error:n}))})}}function re(e,t){return{type:w.SEARCH_ORGS_SUCCESS,organizations:e,totalCount:t}}function ae(e){return{type:w.SEARCH_ORGS_ERROR,error:e}}function ie(e){return function(t,n){t(function(e){return{type:w.SEARCH_ORGS_START,searchTerms:e}}(e)),t({type:w.VIEW_ORG_STOP});var r=n(),a=r.sortBy,i=r.sortDirection,o=r.filter,s=r.auth.authorization,c=s.token,u=s.username,l=r.app.config;return new ee({token:c,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url}).queryOrgs({searchTerms:e,sortBy:a,sortDirection:i,filter:o,username:u}).then(function(e){var n=e.organizations,r=e.total;t(re(n,r))}).catch(function(e){t(ae({code:e.name,message:e.message}))})}}function oe(e,t){return function(n,r){n(function(e,t){return{type:w.SORT_ORGS_START,sortBy:e,sortDirection:t}}(e,t));var a=r(),i=a.searchTerms,o=a.filter,s=a.auth.authorization,c=s.token,u=s.username,l=a.app.config;return new ee({token:c,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url}).queryOrgs({searchTerms:i,sortBy:e,sortDirection:t,filter:o,username:u}).then(function(e){var t=e.organizations,r=e.total;n(re(t,r))}).catch(function(e){n(ae({code:e.name,message:e.message}))})}}function se(e){return function(t,n){t(function(e){return{type:w.FILTER_ORGS_START,filter:e}}(e));var r=n(),a=r.searchTerms,i=r.sortBy,o=r.sortDirection,s=r.auth.authorization,c=s.token,u=s.username,l=r.app.config;return new ee({token:c,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url}).queryOrgs({searchTerms:a,sortBy:i,sortDirection:o,filter:e,username:u}).then(function(e){var n=e.organizations,r=e.total;t(re(n,r))}).catch(function(e){t(ae({code:e.name,message:e.message}))})}}var ce=Object(T.b)(function(e){return{totalCount:e.totalCount,filteredCount:e.filteredCount,sortBy:e.sortBy,sortDirection:e.sortDirection,filter:e.filter,searching:e.searching}},function(e){return{onSearchOrgs:function(t){e(ie(t))},onSortOrgs:function(t,n){e(oe(t,n))},onFilterOrgs:function(t){e(se(t))}}})(J),ue=n(20);function le(e){return{type:w.ADD_ORG_ERROR,error:e}}function de(){return{type:w.ADD_ORG_EVALUATE_ERRORS}}function me(e,t){return{type:w.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function Ee(){return function(e,t){e({type:w.ADD_ORG_EDIT_START}),e(he())}}function pe(){return function(e,t){e({type:w.ADD_ORG_START});var n=t(),r=n.auth.authorization,a=r.token,i=r.username,o=n.addOrg.newOrganization,s=n.app.config,c=new ee({token:a,groupsServiceURL:s.services.Groups.url,userProfileServiceURL:s.services.UserProfile.url,workspaceServiceURL:s.services.Workspace.url});o?c.addOrg(o,i).then(function(t){console.log("added",t),e(function(e){return{type:w.ADD_ORG_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",o,t),e(le({code:"invalid",message:t.message}))}):e(le({code:"app",message:"The new organization data does not yet exist"}))}}function he(){return function(e,t){var n=t().addOrg.newOrganization;t().addOrg;n&&n.name.status===u.EDITED_OK&&n.id.status===u.EDITED_OK&&n.description.status===u.EDITED_OK?e({type:w.ADD_ORG_EVALUATE_OK}):e(de())}}function Oe(e){return function(t){var n=te.validateOrgName(e),a=Object(ue.a)(n,2),i=a[0],o=a[1];o.type===r.ERROR?t(function(e,t){return{type:w.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(i,o)):t(function(e){return{type:w.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(i)),t(he())}}function fe(e){return function(t,n){var a=te.validateOrgId(e),i=Object(ue.a)(a,2),o=i[0],s=i[1];if(s.type===r.ERROR)return t(me(o,s)),void t(he());(function(e){var t=e.auth.authorization.token,n=e.app.config;return new ee({token:t,groupsServiceURL:n.services.Groups.url,userProfileServiceURL:n.services.UserProfile.url,workspaceServiceURL:n.services.Workspace.url})})(n()).getGroup(o).then(function(e){var n;e?(console.log("org??",e),t(me(o,{type:r.ERROR,message:"This org id is already in use"}))):t((n=o,{type:w.ADD_ORG_UPDATE_ID_SUCCESS,id:n})),t(he())})}}function Re(e){return function(t,n){var a=n(),i=a.auth.authorization.token,o=a.app.config,s=new ee({token:i,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url,workspaceServiceURL:o.services.Workspace.url}).validateOrgDescription(e),c=Object(ue.a)(s,2),u=c[0],l=c[1];l.type===r.ERROR?t(function(e,t){return{type:w.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(u,l)):t(function(e){return{type:w.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(u)),t(he())}}var ve=n(39),ge=n.n(ve),_e=(n(186),function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).state={canceling:!1},n.origin=document.location.origin,n.props.onAddOrgEdit(),n}return Object(_.a)(t,e),Object(R.a)(t,[{key:"onClickCancel",value:function(){this.setState({canceling:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),console.log("submitted"),this.props.onAddOrg()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState===c.VALID&&(this.props.saveState===s.NEW||this.props.saveState===s.READY||this.props.saveState===s.SAVED)}},{key:"renderForm",value:function(){return E.createElement("form",{id:"newOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},E.createElement("div",{className:"row"},E.createElement("div",{className:"col1 field-label"},"name"),E.createElement("div",{className:"col2"},E.createElement("input",{value:this.props.newOrganization.name.value||"",onChange:this.onNameChange.bind(this)}),this.props.newOrganization.name.error?E.createElement("span",{style:{color:"red"}},this.props.newOrganization.name.error.message):"")),E.createElement("div",{className:"row"},E.createElement("div",{className:"col1 field-label"},"id"),E.createElement("div",{className:"col2"},E.createElement("input",{value:this.props.newOrganization.id.value||"",onChange:this.onIdChange.bind(this)}),this.props.newOrganization.id.error?E.createElement("span",{style:{color:"red"}},this.props.newOrganization.id.error.message):"")),E.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},E.createElement("div",{className:"col1 field-label"},"description"),E.createElement("div",{className:"col2"},E.createElement("textarea",{value:this.props.newOrganization.description.value||"",onChange:this.onDescriptionChange.bind(this)}),this.props.newOrganization.description.error?E.createElement("div",{style:{color:"red"}},this.props.newOrganization.description.error.message):"")),E.createElement("div",{className:"row"},E.createElement("div",{className:"col1"}),E.createElement("div",{className:"col2"})))}},{key:"renderPreview",value:function(){return E.createElement("form",{className:"preview"},E.createElement("div",{className:"row"},E.createElement("div",{className:"col2"},E.createElement("div",{className:"name"},this.props.newOrganization.name.value||""))),E.createElement("div",{className:"row"},E.createElement("div",{className:"col2"},E.createElement("div",{className:"id"},E.createElement("span",{style:{color:"silver"}},this.origin,"/#orgs/organizations/"),this.props.newOrganization.id.value||E.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),E.createElement("div",{className:"row"},E.createElement("div",{className:"col2"},E.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:ge()(this.props.newOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return E.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderHeader",value:function(){var e=this.props.newOrganization.name.value||E.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");return E.createElement(Z,{title:"Organizations"},E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement("span",null,E.createElement(M.a,{type:"plus-circle"})," ",'Editing New Org "',e,'"')),E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center"}},E.createElement(B.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),E.createElement(B.a,{icon:"undo",type:"danger",onClick:this.onClickCancel.bind(this)},"Return to Orgs"))))}},{key:"renderFooter",value:function(){return E.createElement("div",{className:"footerRow"},E.createElement("div",{className:"editorColumn"},E.createElement("div",{className:"row"},E.createElement("div",{className:"col1"}),E.createElement("div",{className:"col2"},E.createElement("div",{className:"footer"},E.createElement(B.a,{form:"newOrganizationForm",key:"submit",htmlType:"submit"},"Save"),E.createElement(B.a,{type:"danger",onClick:this.onClickCancel.bind(this)},"Cancel"))))),E.createElement("div",{className:"previewColumn"}))}},{key:"renderLoadingHeader",value:function(){return E.createElement(Z,{title:"Organizations"},E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement("span",null,"Loading New Org Editor..."))))}},{key:"render",value:function(){return this.state.canceling?E.createElement(A.a,{push:!0,to:"/organizations"}):this.props.newOrganization?E.createElement("div",{className:"NewOrganization"},this.renderHeader(),E.createElement("div",{className:"mainRow"},E.createElement("div",{className:"editorColumn"},E.createElement("h3",null,"Editor"),this.renderForm()),E.createElement("div",{className:"previewColumn"},E.createElement("h3",null,"Preview"),this.renderPreview()))):E.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(E.Component));var Se=Object(T.b)(function(e){var t=e.addOrg;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization}},function(e){return{onAddOrgEdit:function(){e(Ee())},onAddOrg:function(){e(pe())},onUpdateName:function(t){e(Oe(t))},onUpdateId:function(t){e(fe(t))},onUpdateDescription:function(t){e(Re(t))}}})(_e),De=(n(188),function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).props.onViewOrg(n.props.id),n}return Object(_.a)(t,e),Object(R.a)(t,[{key:"buildFooter",value:function(){return E.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.organization.owner.username===this.props.username)return E.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",E.createElement(L.a,{to:"/editOrganization/".concat(this.props.organization.id)},E.createElement(B.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.organization.owner.username===this.props.username)return E.createElement(L.a,{to:"/editOrganization/".concat(this.props.organization.id)},E.createElement(B.a,{icon:"edit"},"Edit"))}},{key:"renderOrg",value:function(){if(this.props.organization)return E.createElement("form",{className:"table"},E.createElement("div",{className:"row"},E.createElement("div",{className:"col2"},E.createElement("div",{className:"name"},this.props.organization.name))),E.createElement("div",{className:"row"},E.createElement("div",{className:"col2"},E.createElement("div",{className:"id"},E.createElement("span",{className:"label"},"permalink")," ",E.createElement("span",{className:"permalinkBase"},"https://narrative.kbase.us/organizations/"),this.props.organization.id))),E.createElement("div",{className:"row",style:{flex:"1 1 0px"}},E.createElement("div",{className:"col2"},E.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:ge()(this.props.organization.description||"")}}))))}},{key:"renderInfo",value:function(){if(this.props.organization)return E.createElement("form",{className:"table infoTable"},E.createElement("div",{className:"row"},E.createElement("div",{className:"col1"},E.createElement("span",{className:"label"},"owner")),E.createElement("div",{className:"col2"},E.createElement("div",{className:"owner"},E.createElement("a",{href:"#people/{org.owner.username}",target:"_blank"},this.props.organization.owner.realname," \u2768",this.props.organization.owner.username,"\u2769")))),E.createElement("div",{className:"row"},E.createElement("div",{className:"col1"},E.createElement("span",{className:"label"},"established")),E.createElement("div",{className:"col2"},E.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US").format(this.props.organization.createdAt)))),E.createElement("div",{className:"row"},E.createElement("div",{className:"col1"},E.createElement("span",{className:"label"},"last updated")),E.createElement("div",{className:"col2"},E.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US").format(this.props.organization.modifiedAt)))))}},{key:"renderHeader",value:function(){return E.createElement(Z,{title:"Organizations"},E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement("span",null,'Viewing Org "',this.props.organization&&this.props.organization.name,'"')),E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end"}},this.renderEditButton(),E.createElement(L.a,{to:"/organizations"},E.createElement(B.a,{type:"danger",icon:"undo"},"Return to Orgs")))))}},{key:"renderLoadingHeader",value:function(){return E.createElement(Z,{title:"Organizations"},E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement("span",null,"Loading Org..."))))}},{key:"render",value:function(){return"undefined"!==typeof this.props.organization?E.createElement("div",{className:"ViewOrganization"},this.renderHeader(),E.createElement("div",{className:"mainRow"},E.createElement("div",{className:"mainColumn"},this.renderOrg()),E.createElement("div",{className:"infoColumn"},E.createElement("div",{className:"infoBox"},this.renderInfo())))):E.createElement("div",{className:"ViewOrganization"},this.renderLoadingHeader(),"Loading...")}}]),t}(E.Component));var Ae=Object(T.b)(function(e,t){var n=e.viewOrg,r=n.state,a=n.organization,i=n.error,o=e.auth.authorization.username;return{id:t.id,state:r,organization:a,error:i,username:o}},function(e){return{onViewOrg:function(t){e(ne(t))}}})(De);function Te(e){return{type:w.EDIT_ORG_SAVE_ERROR,error:e}}function Ne(e){return function(t,n){t({type:w.EDIT_ORG_START});var r=n(),a=r.auth.authorization.token,i=r.app.config;return new ee({token:a,groupsServiceURL:i.services.Groups.url,userProfileServiceURL:i.services.UserProfile.url,workspaceServiceURL:i.services.Workspace.url}).getOrg(e).then(function(e){var n={id:{value:e.id},name:{value:e.name},description:{value:e.description}};t(function(e){return{type:w.EDIT_ORG_SUCCESS,organization:e}}(n))}).catch(function(e){var n;t((n={code:e.name,message:e.message},{type:w.EDIT_ORG_ERROR,error:n}))})}}function ye(e){return function(t,n){var r=n(),a=r.auth.authorization.token,i=r.app.config,o=new ee({token:a,groupsServiceURL:i.services.Groups.url,userProfileServiceURL:i.services.UserProfile.url,workspaceServiceURL:i.services.Workspace.url}).validateOrgName(e),s=Object(ue.a)(o,2),c=s[0],u=s[1];null!==c&&t(function(e){return{type:w.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(c)),null!==u&&t(function(e,t){return{type:w.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(c,u))}}function we(e){return function(t,n){var r=n(),a=r.auth.authorization.token,i=r.app.config,o=new ee({token:a,groupsServiceURL:i.services.Groups.url,userProfileServiceURL:i.services.UserProfile.url,workspaceServiceURL:i.services.Workspace.url}).validateOrgDescription(e),s=Object(ue.a)(o,2),c=s[0],u=s[1];null!==c&&t(function(e){return{type:w.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(c)),null!==u&&t(function(e,t){return{type:w.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(c,u))}}function Ie(){return function(e,t){e({type:w.EDIT_ORG_SAVE_START});var n=t(),r=n.editOrg.editedOrganization,a=n.auth.authorization.token,i=n.app.config,o=new ee({token:a,groupsServiceURL:i.services.Groups.url,userProfileServiceURL:i.services.UserProfile.url,workspaceServiceURL:i.services.Workspace.url});if(r)if(r.name.error||r.description.error)e(Te({code:"invalid",message:"One or more of the edited fields have an error"}));else{var s={name:r.name.value,description:r.description.value};o.updateOrg(r.id.value,s).then(function(t){e(function(e){return{type:w.EDIT_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){e(Te({code:"error-saving",message:t.message}))})}else e(Te({code:"app",message:"Missing edited organization!"}))}}n(190);var Ce=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).state={canceling:!1},n.props.onEditOrg(n.props.id),n}return Object(_.a)(t,e),Object(R.a)(t,[{key:"onClickCancel",value:function(){this.setState({canceling:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onUpdateOrg()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist()}},{key:"renderForm",value:function(){if(this.props.editedOrganization)return E.createElement("form",{id:"editOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},E.createElement("div",{className:"row"},E.createElement("div",{className:"col1 field-label"},"name"),E.createElement("div",{className:"col2"},E.createElement("input",{value:this.props.editedOrganization.name.value,onChange:this.onNameChange.bind(this)}),this.props.editedOrganization.name.error?E.createElement("span",{style:{color:"red"}},this.props.editedOrganization.name.error.message):"")),E.createElement("div",{className:"row"},E.createElement("div",{className:"col1 field-label"},"id"),E.createElement("div",{className:"col2"},E.createElement(W.a,{title:"The id may not be changed"},E.createElement("input",{value:this.props.editedOrganization.id.value,readOnly:!0})))),E.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},E.createElement("div",{className:"col1 field-label"},"description"),E.createElement("div",{className:"col2"},E.createElement("textarea",{value:this.props.editedOrganization.description.value,onChange:this.onDescriptionChange.bind(this)}),this.props.editedOrganization.description.error?E.createElement("span",{style:{color:"red"}},this.props.editedOrganization.description.error.message):"")))}},{key:"renderPreview",value:function(){if(this.props.editedOrganization)return E.createElement("form",{className:"preview"},E.createElement("div",{className:"row"},E.createElement("div",{className:"col2"},E.createElement("div",{className:"name"},this.props.editedOrganization.name.value||""))),E.createElement("div",{className:"row"},E.createElement("div",{className:"col2"},E.createElement("div",{className:"id"},E.createElement("span",{style:{color:"silver"}},"https://narrative.kbase.us/organizations/"),this.props.editedOrganization.id.value||""))),E.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},E.createElement("div",{className:"col2"},E.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:ge()(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderHeader",value:function(){return E.createElement(Z,{title:"Organizations"},E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement("span",null,E.createElement(K.b,{style:{verticalAlign:"middle"}})," ",'Editing Org "',this.props.editedOrganization.name.value,'"')),E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",justifyContent:"flex-end"}},E.createElement(B.a,{icon:"save",form:"editOrganizationForm",key:"submit",htmlType:"submit"},"Save"),E.createElement(B.a,{type:"danger",icon:"undo",onClick:this.onClickCancel.bind(this)},"Cancel & Return to Org"))))}},{key:"renderLoadingHeader",value:function(){return E.createElement(Z,{title:"Organizations"},E.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"row",alignItems:"center"}},E.createElement("div",{style:{flex:"0 0 auto"}},E.createElement("span",null,"Loading Org..."))))}},{key:"render",value:function(){return this.state.canceling?E.createElement(A.a,{push:!0,to:"/viewOrganization/"+this.props.id}):this.props.editedOrganization?E.createElement("div",{className:"EditOrganization"},this.renderHeader(),E.createElement("div",{className:"mainRow"},E.createElement("div",{className:"editorColumn"},E.createElement("h3",null,"Editor"),this.renderForm()),E.createElement("div",{className:"previewColumn"},E.createElement("h3",null,"Preview"),this.renderPreview()))):E.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader())}}]),t}(E.Component);var be=Object(T.b)(function(e,t){var n=e.editOrg,r=n.state,a=n.error,i=n.editedOrganization;return t.id,{state:r,error:a,editedOrganization:i}},function(e){return{onEditOrg:function(t){e(Ne(t))},onUpdateOrg:function(){e(Ie())},onUpdateName:function(t){e(ye(t))},onUpdateDescription:function(t){e(we(t))}}})(Ce),Ue=(n(192),function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).tokenRef=E.createRef(),n.props.checkAuth(),n}return Object(_.a)(t,e),Object(R.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&(console.log("authorizagin with",e),this.props.onAddAuthorization(e))}}},{key:"buildAuthForm",value:function(){return E.createElement("div",{className:"Auth-form"},"Token: ",E.createElement("input",{ref:this.tokenRef}),E.createElement(B.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return E.createElement("div",{className:"Auth-toolbar"},"Logged in as ",E.createElement("b",null,E.createElement("span",null,this.props.realname)," (",E.createElement("span",null,this.props.username)),")"," ",E.createElement(B.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)},"Sign out"))}},{key:"buildAuthDev",value:function(){switch(this.props.authStatus){case a.NONE:case a.CHECKING:return E.createElement("div",null);case a.AUTHORIZED:return E.createElement("div",{className:"Auth Auth-authorized"},this.buildAuthToolbar(),this.props.children);case a.UNAUTHORIZED:return E.createElement("div",{className:"Auth Auth-unauthorized"},E.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case a.ERROR:return E.createElement("div",{className:"Auth Auth-unauthorized"},E.createElement("p",null,"Error"));default:return E.createElement("div",null)}}},{key:"buildAuthProd2",value:function(){switch(this.props.authStatus){case a.NONE:case a.CHECKING:return E.createElement("div",null);case a.AUTHORIZED:return E.createElement("div",{className:"Auth Auth-authorized"},this.props.children);case a.UNAUTHORIZED:return E.createElement("div",{className:"Auth Auth-unauthorized"},E.createElement("p",null,"Not authorized!"));case a.ERROR:return E.createElement("div",{className:"Auth Auth-error"},E.createElement("p",null,"Error: ??"));default:return E.createElement("div",null)}}},{key:"render",value:function(){return E.createElement("div",{className:"Auth"},"dev"===this.props.env?this.buildAuthDev():this.buildAuthProd2())}}]),t}(E.Component)),ke=n(56),Ge="",ze="api/V2/token",je="api/V2/me",Pe=function(){function e(t){var n=t.url;Object(f.a)(this,e),this.url=n}return Object(R.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([Ge]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return console.log("root info",e),e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([ze]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([je]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}}]),e}();function He(e,t,n,r){return{type:w.AUTH_AUTHORIZED,token:e,username:t,realname:n,roles:r}}function Le(){return{type:w.AUTH_UNAUTHORIZED}}function xe(){return function(e,t){e({type:w.AUTH_CHECK_START});var n=ke.get("kbase_session");if(n){var r=new Pe({url:"/services/auth"});Promise.all([r.getTokenInfo(n),r.getMe(n)]).then(function(t){var r=Object(ue.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(He(n,a.user,a.display,i))})}else e(Le())}}var Ve=Object(T.b)(function(e,t){var n=e.auth,r=n.status,a=n.authorization;return{authStatus:r,token:a.token||null,username:a.username||null,realname:a.realname||null}},function(e){return{checkAuth:function(){e(xe())},onRemoveAuthorization:function(){e(function(e,t){ke.remove("kbase_session"),e(Le())})},onAddAuthorization:function(t){e(function(e){return function(t,n){ke.set("kbase_session",e);var r=new Pe({url:"/services/auth"});Promise.all([r.getTokenInfo(e),r.getMe(e)]).then(function(n){var r=Object(ue.a)(n,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(He(e,a.user,a.display,i))})}}(t))}}})(Ue),Fe=n(44),Me=n.n(Fe),We=function e(t){var n=t.name,r=t.onSuccess,a=t.onError;Object(f.a)(this,e),this.name=n,this.onSuccess=r,this.onError=a},Be=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).started=new Date,n.timeout=e.timeout||5e3,n}return Object(_.a)(t,e),t}(We),Ke=function(){function e(t){var n=t.name,r=t.payload,a=t.channel;Object(f.a)(this,e),this.name=n,this.payload=r,this.id=Me()(),this.created=new Date,this.channel=a,this.envelope=null}return Object(R.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channel:this.channel},name:this.name,payload:this.payload}}}]),e}(),Ze=function(){function e(t){if(Object(f.a)(this,e),this.window=t.window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||Me()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(R.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",e));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var n=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),n&&n.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var r=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),r.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,n){this.listen(new We({name:e,onSuccess:t,onError:n}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var n=new Ke({name:e,payload:t,channel:this.id});this.sendMessage(n)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var n=this;return new Promise(function(r,a){try{n.sendRequest(new Ke({name:e,payload:t,channel:n.id}),function(e){r(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),n=!0,r=!1,a=void 0;try{for(var i,o=function(){var n=i.value,r=(c=Object(ue.a)(n,2))[0];0===c[1].filter(function(e){if(e instanceof Be){var n=t-e.started.getTime();if(n>e.timeout){try{e.onError&&e.onError(new Error("timout after "+n))}catch(a){console.error("Error calling error handler",r,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(r)},s=e.waitingListeners.entries()[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c;o()}}catch(u){r=!0,a=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,n){this.listenOnce(new Be({name:e,onSuccess:t,onError:n}))}},{key:"when",value:function(e,t){var n=this;return new Promise(function(r,a){return n.listenOnce(new Be({name:e,timeout:t,onSuccess:function(e){r(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),Ye=function(){function e(){Object(f.a)(this,e),this.params=null,this.channel=new Ze({window:window,host:document.location.origin})}return Object(R.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:Me()(),params:{groupsServiceURL:"services/groups",userProfileServiceURL:"services/user_profile/rpc",workspaceServiceURL:"services/ws"},parentHost:document.location.origin}}}]),e}(),qe=function(){function e(){Object(f.a)(this,e)}return Object(R.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}}]),e}();function Je(e){return{type:w.APP_SUCCESS,config:e}}n(196);var $e=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).props.onAppStart(),n}return Object(_.a)(t,e),Object(R.a)(t,[{key:"render",value:function(){return this.props.status===d.NONE?E.createElement("div",{className:"KBaseIntegration"},"Loading..."):E.createElement("div",{className:"KBaseIntegration"},this.props.children)}}]),t}(E.Component);var Qe=Object(T.b)(function(e,t){return{status:e.app.status}},function(e){return{onAppStart:function(){e(function(e,t){var n=(new qe).getParamsFromIFrame();if(n)e(Je({baseUrl:"",services:{Groups:{url:n.params.groupsServiceURL},UserProfile:{url:n.params.userProfileServiceURL},Workspace:{url:n.params.userProfileServiceURL}}}));else{var r=(new Ye).getParamsFromIFrame();e(Je({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL}}}))}})}}})($e);P.a.add(H.b,H.a);var Xe={rawOrganizations:[],organizations:[],totalCount:0,filteredCount:0,sortBy:"name",sortDirection:m.ASCENDING,filter:"all",searchTerms:[],selectedOrganizationId:null,auth:{status:a.NONE,authorization:{token:"",username:"",realname:"",roles:[]}},error:null,searching:!1,app:{status:d.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""}}}},addOrg:{editState:o.NONE,saveState:s.NONE,validationState:c.NONE,newOrganization:{id:{value:"",status:u.NONE,error:{type:r.NONE}},name:{value:"",status:u.NONE,error:{type:r.NONE}},description:{value:"",status:u.NONE,error:{type:r.NONE}}}},updateOrg:{pending:!1},viewOrg:{state:l.NONE},editOrg:{state:i.NONE}},et=Object(N.d)(j,Xe,Object(N.c)(Object(N.a)(y.a))),tt=function(e){function t(e){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).call(this,e))}return Object(_.a)(t,e),Object(R.a)(t,[{key:"buildInner",value:function(){}},{key:"buildDev",value:function(){}},{key:"buildProd",value:function(){}},{key:"render",value:function(){return p.a.createElement(T.a,{store:et},p.a.createElement(Ve,{env:"prod"},p.a.createElement(Qe,null,p.a.createElement(D.a,{basename:"/orgs/"},p.a.createElement("div",{className:"App"},p.a.createElement("div",{className:"App-body"},p.a.createElement(S.a,{path:"/organizations",component:ce}),p.a.createElement(S.a,{path:"/newOrganization",component:Se}),p.a.createElement(S.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return p.a.createElement(Ae,{id:t})}}),p.a.createElement(S.a,{path:"/editOrganization/:id",component:function(e){var t=e.match.params.id;return p.a.createElement(be,{id:t})}}),p.a.createElement(A.a,{from:"/",to:"/organizations",exact:!0})))))))}}]),t}(E.Component);n(198),n(200),n(202);O.a.render(p.a.createElement(tt,null),document.getElementById("root"))}},[[109,2,1]]]);
//# sourceMappingURL=main.98dace3e.chunk.js.map