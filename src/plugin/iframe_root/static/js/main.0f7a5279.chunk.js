(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{131:function(e,t,r){e.exports=r.p+"static/media/nouserpic.9af42ba9.png"},146:function(e,t,r){},158:function(e,t,r){e.exports=r(329)},163:function(e,t,r){},171:function(e,t,r){},173:function(e,t,r){},175:function(e,t,r){},179:function(e,t,r){},181:function(e,t,r){},235:function(e,t,r){},237:function(e,t,r){},246:function(e,t,r){},253:function(e,t,r){},255:function(e,t,r){},257:function(e,t,r){},259:function(e,t,r){},261:function(e,t,r){},265:function(e,t,r){},267:function(e,t,r){},269:function(e,t,r){},271:function(e,t,r){},273:function(e,t,r){},275:function(e,t,r){},289:function(e,t,r){},299:function(e,t,r){},301:function(e,t,r){},303:function(e,t,r){},306:function(e,t,r){},308:function(e,t,r){},310:function(e,t,r){},312:function(e,t,r){},315:function(e,t,r){},317:function(e,t,r){},319:function(e,t,r){},321:function(e,t,r){},329:function(e,t,r){"use strict";r.r(t);var n,a,i,o,s,c,l,u,E,d,m,p,v,h,O,R,g,w,f,_,S,A=r(0),N=r.n(A),T=r(16),I=r.n(T),b=(r(163),r(4)),y=r(5),C=r(9),D=r(7),U=r(8),k=r(335),M=r(112),V=r(331),j=r(345),z=r(15),L=r(60),G=r(148),x=r(2),P=r(65),B=r(125);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.NEW=1]="NEW",e[e.DIRTY=2]="DIRTY",e[e.CLEAN=3]="CLEAN"}(i||(i={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(o||(o={})),function(e){e[e.OK=0]="OK",e[e.ERROR=1]="ERROR",e[e.REQUIRED_MISSING=2]="REQUIRED_MISSING"}(s||(s={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(c||(c={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(l||(l={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(u||(u={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(E||(E={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(d||(d={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(p||(p={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(v||(v={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(O||(O={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(g||(g={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(f||(f={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(_||(_={})),function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR"}(S||(S={}));var q,W=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,o=e.info;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,a))).code=void 0,r.message=void 0,r.detail=void 0,r.trace=void 0,r.errors=void 0,r.info=void 0,r.name="AppException",r.code=n,r.message=a,r.detail=i,r.info=o,Error.captureStackTrace&&Error.captureStackTrace(Object(P.a)(Object(P.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(U.a)(t,e),t}(Object(B.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_JOIN_REQUEST=31]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=32]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=33]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=34]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=35]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=36]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=37]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=38]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=39]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=40]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=41]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=42]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST=43]="VIEW_ORG_ACCEPT_INBOX_REQUEST",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_START=44]="VIEW_ORG_ACCEPT_INBOX_REQUEST_START",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS=45]="VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR=46]="VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_INBOX_REQUEST=47]="VIEW_ORG_REJECT_INBOX_REQUEST",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_START=48]="VIEW_ORG_REJECT_INBOX_REQUEST_START",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS=49]="VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR=50]="VIEW_ORG_REJECT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=51]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=52]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=53]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=54]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=55]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=56]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=57]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=58]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=59]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=60]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=61]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=62]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.ADD_ORG_LOAD=63]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=64]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=65]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=66]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=67]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=68]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=69]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=70]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_LOGO_URL=71]="ADD_ORG_UPDATE_LOGO_URL",e[e.ADD_ORG_UPDATE_LOGO_URL_SUCCESS=72]="ADD_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.ADD_ORG_UPDATE_LOGO_URL_ERROR=73]="ADD_ORG_UPDATE_LOGO_URL_ERROR",e[e.ADD_ORG_UPDATE_ID=74]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=75]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=76]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=77]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=78]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=79]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=80]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=81]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=82]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=83]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=84]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_UPDATE_HOME_URL=85]="ADD_ORG_UPDATE_HOME_URL",e[e.ADD_ORG_UPDATE_HOME_URL_SUCCESS=86]="ADD_ORG_UPDATE_HOME_URL_SUCCESS",e[e.ADD_ORG_UPDATE_HOME_URL_ERROR=87]="ADD_ORG_UPDATE_HOME_URL_ERROR",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS=88]="ADD_ORG_UPDATE_RESEARCH_INTERESTS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=89]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=90]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.ADD_ORG_EVALUATE=91]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=92]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=93]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=94]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=95]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=96]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=97]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=98]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=99]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=100]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=101]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=102]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=103]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=104]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=105]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=106]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=107]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=108]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=109]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_LOGO_URL=110]="EDIT_ORG_UPDATE_LOGO_URL",e[e.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS=111]="EDIT_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_LOGO_URL_ERROR=112]="EDIT_ORG_UPDATE_LOGO_URL_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=113]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=114]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=115]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=116]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=117]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=118]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_UPDATE_HOME_URL=119]="EDIT_ORG_UPDATE_HOME_URL",e[e.EDIT_ORG_UPDATE_HOME_URL_SUCCESS=120]="EDIT_ORG_UPDATE_HOME_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_HOME_URL_ERROR=121]="EDIT_ORG_UPDATE_HOME_URL_ERROR",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS=122]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=123]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=124]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.EDIT_ORG_EVALUATE=125]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=126]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=127]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=128]="AUTH_CHECK",e[e.AUTH_CHECK_START=129]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=130]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=131]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=132]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=133]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=134]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=135]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=136]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=137]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=138]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=139]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=140]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=141]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=142]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=143]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=144]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=145]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=146]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=147]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=148]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=149]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=150]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=151]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=152]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=153]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=154]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=155]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=156]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=157]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=158]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=159]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=160]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=161]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=162]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=163]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=164]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=165]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=166]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=167]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=168]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=169]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=170]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=171]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=172]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=173]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=174]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=175]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=176]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=177]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=178]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=179]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=180]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=181]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=182]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=183]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=184]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=185]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=186]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=187]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=188]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=189]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=190]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=191]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=192]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=193]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=194]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.MANAGE_MEMBERSHIP_UNLOAD=195]="MANAGE_MEMBERSHIP_UNLOAD",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG=196]="MANAGE_MEMBERSHIP_LEAVE_ORG",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED=197]="MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_START=198]="MANAGE_MEMBERSHIP_LEAVE_ORG_START",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS=199]="MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR=200]="MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR",e[e.REQUEST_ADD_NARRATIVE_LOAD=201]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=202]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=203]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=204]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=205]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=206]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=207]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=208]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=209]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=210]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=211]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=212]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=213]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.DASHBOARD_LOAD=214]="DASHBOARD_LOAD",e[e.DASHBOARD_LOAD_START=215]="DASHBOARD_LOAD_START",e[e.DASHBOARD_LOAD_SUCCESS=216]="DASHBOARD_LOAD_SUCCESS",e[e.DASHBOARD_LOAD_ERROR=217]="DASHBOARD_LOAD_ERROR",e[e.DASHBOARD_UNLOAD=218]="DASHBOARD_UNLOAD",e[e.DASHBOARD_REFRESH=219]="DASHBOARD_REFRESH",e[e.DASHBOARD_REFRESH_START=220]="DASHBOARD_REFRESH_START",e[e.DASHBOARD_REFRESH_SUCCESS=221]="DASHBOARD_REFRESH_SUCCESS",e[e.DASHBOARD_REFRESH_ERROR=222]="DASHBOARD_REFRESH_ERROR",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST=223]="DASHBOARD_CANCEL_OUTBOX_REQUEST",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_START=224]="DASHBOARD_CANCEL_OUTBOX_REQUEST_START",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS=225]="DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS",e[e.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR=226]="DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST=227]="DASHBOARD_ACCEPT_INBOX_REQUEST",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_START=228]="DASHBOARD_ACCEPT_INBOX_REQUEST_START",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS=229]="DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR=230]="DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR",e[e.DASHBOARD_REJECT_INBOX_REQUEST=231]="DASHBOARD_REJECT_INBOX_REQUEST",e[e.DASHBOARD_REJECT_INBOX_REQUEST_START=232]="DASHBOARD_REJECT_INBOX_REQUEST_START",e[e.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS=233]="DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_REJECT_INBOX_REQUEST_ERROR=234]="DASHBOARD_REJECT_INBOX_REQUEST_ERROR",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST=235]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_START=236]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_START",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_SUCCESS=237]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_ERROR=238]="DASHBOARD_ACCEPT_ORG_INBOX_REQUEST_ERROR",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST=239]="DASHBOARD_REJECT_ORG_INBOX_REQUEST",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_START=240]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_START",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_SUCCESS=241]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_SUCCESS",e[e.DASHBOARD_REJECT_ORG_INBOX_REQUEST_ERROR=242]="DASHBOARD_REJECT_ORG_INBOX_REQUEST_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=243]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=244]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=245]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=246]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=247]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=248]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=249]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=250]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=251]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=252]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=253]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=254]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=255]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=256]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=257]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=258]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=259]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.GLOBAL_ACCESS_NARRATIVE=260]="GLOBAL_ACCESS_NARRATIVE",e[e.GLOBAL_ACCESS_NARRATIVE_START=261]="GLOBAL_ACCESS_NARRATIVE_START",e[e.GLOBAL_ACCESS_NARRATIVE_SUCCESS=262]="GLOBAL_ACCESS_NARRATIVE_SUCCESS",e[e.GLOBAL_ACCESS_NARRATIVE_ERROR=263]="GLOBAL_ACCESS_NARRATIVE_ERROR",e[e.NOTIFICATIONS_LOAD=264]="NOTIFICATIONS_LOAD",e[e.NOTIFICATIONS_LOAD_START=265]="NOTIFICATIONS_LOAD_START",e[e.NOTIFICATIONS_LOAD_SUCCESS=266]="NOTIFICATIONS_LOAD_SUCCESS",e[e.NOTIFICATIONS_LOAD_ERROR=267]="NOTIFICATIONS_LOAD_ERROR",e[e.NOTIFICATIONS_UNLOAD=268]="NOTIFICATIONS_UNLOAD",e[e.NOTIFICATIONS_READ=269]="NOTIFICATIONS_READ",e[e.NOTIFICATIONS_READ_START=270]="NOTIFICATIONS_READ_START",e[e.NOTIFICATIONS_READ_SUCCESS=271]="NOTIFICATIONS_READ_SUCCESS",e[e.NOTIFICATIONS_READ_ERROR=272]="NOTIFICATIONS_READ_ERROR"}(q||(q={}));var H=function(e,t){switch(t.type){case q.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case q.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.UNEDITED,saveState:c.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case q.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveError without view model"),e)}(e,t);case q.ADD_ORG_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:O.LOADING,error:null,viewModel:null}})})}(e);case q.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:O.SUCCESS,error:null,viewModel:{editState:o.UNEDITED,validationState:{type:s.OK,validatedAt:new Date},saveState:c.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case q.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:O.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case q.ADD_ORG_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:{loadingState:O.NONE,error:null,viewModel:null}})})}(e);case q.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Logo URL without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:t.error})})})})})}):(console.warn("attempting Logo URL error without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Home URL (success) without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:t.error})})})})})}):(console.warn("attempting update to home url without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Research Interests without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:t.error})})})})})}):(console.warn("attempting update to research interests (error) without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e);case q.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:i.DIRTY})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:Object(x.a)({},e.views.addOrgView.viewModel.newOrganization.isPrivate,{value:t.isPrivate,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case q.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case q.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{addOrgView:Object(x.a)({},e.views.addOrgView,{viewModel:Object(x.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.ERROR,message:"TODO: form error",validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};function Q(){return{type:s.OK,validatedAt:new Date}}function F(e){return e.editedOrganization.name.syncState===i.DIRTY?o.EDITED:e.editedOrganization.id.syncState===i.DIRTY?o.EDITED:e.editedOrganization.logoUrl.syncState===i.DIRTY?o.EDITED:e.editedOrganization.homeUrl.syncState===i.DIRTY?o.EDITED:e.editedOrganization.researchInterests.syncState===i.DIRTY?o.EDITED:e.editedOrganization.isPrivate.syncState===i.DIRTY?o.EDITED:e.editedOrganization.description.syncState===i.DIRTY?o.EDITED:o.UNEDITED}var J=function(e,t){switch(t.type){case q.EDIT_ORG_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:{loadingState:O.LOADING,error:null,viewModel:null}})})}(e);case q.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:{loadingState:O.SUCCESS,error:null,viewModel:{editState:o.UNEDITED,validationState:Q(),saveState:c.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case q.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:{loadingState:O.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVING})})})}):e}(e);case q.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.UNEDITED,saveState:c.SAVED,editedOrganization:{id:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.id,{syncState:i.CLEAN}),name:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{syncState:i.CLEAN}),logoUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{syncState:i.CLEAN}),homeUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{syncState:i.CLEAN}),researchInterests:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{syncState:i.CLEAN}),isPrivate:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{syncState:i.CLEAN}),description:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{syncState:i.CLEAN})}})})})}):e}(e);case q.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.name!==n.name.remoteValue?i.DIRTY:i.CLEAN;var a=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:r,validationState:Q()})})})})})}),o=F(a.views.editOrgView.viewModel);return Object(x.a)({},a,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},a.views.editOrgView,{viewModel:Object(x.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case q.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:Q()})})})})})}),n=F(r.views.editOrgView.viewModel);return Object(x.a)({},r,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},r.views.editOrgView,{viewModel:Object(x.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case q.EDIT_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:Q()})})})})})}),n=F(r.views.editOrgView.viewModel);return Object(x.a)({},r,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},r.views.editOrgView,{viewModel:Object(x.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case q.EDIT_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:Q()})})})})})}),n=F(r.views.editOrgView.viewModel);return Object(x.a)({},r,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},r.views.editOrgView,{viewModel:Object(x.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.isPrivate!==n.isPrivate.remoteValue?i.DIRTY:i.CLEAN;var a=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{value:t.isPrivate,syncState:r,validationState:Q()})})})})})}),s=F(a.views.editOrgView.viewModel);return Object(x.a)({},a,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},a.views.editOrgView,{viewModel:Object(x.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.description!==n.description.remoteValue?i.DIRTY:i.CLEAN;var a=Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:r,validationState:Q()})})})})})}),s=F(a.views.editOrgView.viewModel);return Object(x.a)({},a,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},a.views.editOrgView,{viewModel:Object(x.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(x.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case q.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):e}(e);case q.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{editOrgView:Object(x.a)({},e.views.editOrgView,{viewModel:Object(x.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.ERROR,message:"Validation errors",validatedAt:new Date}})})})}):e}(e);default:return null}};function Y(e,t){switch(t.type){case q.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}var K=function(e,t){switch(t.type){case q.VIEW_ORG_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:O.LOADING,error:null,viewModel:null}})})}(e);case q.VIEW_ORG_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:O.SUCCESS,error:null,viewModel:{organization:t.organization,relation:t.relation,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox}}})})}(e,t);case q.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:O.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.VIEW_ORG_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:{loadingState:O.NONE,error:null,viewModel:null}})})}(e);case q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrative.workspaceId});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{organization:Object(x.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r})})})})})}(e,t);case q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?(console.log("narrative access success",t),Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewOrgView:Object(x.a)({},e.views.viewOrgView,{viewModel:Object(x.a)({},e.views.viewOrgView.viewModel,{organization:t.organization})})})})):e}(e,t)}return Y(e,t)};function X(e,t){switch(t.type){case q.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.searchTerms,o=r.sortBy,s=r.sortDirection,c=r.filter,l=r.totalCount,u=r.filteredCount,E=r.selectedOrganizationId,d=r.error,m=r.searching;return Object(x.a)({},e,{loadingState:O.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,searchTerms:i,sortBy:o,sortDirection:s,filter:c,totalCount:l,filteredCount:u,selectedOrganizationId:E,error:d,searching:m}})}(e,t);case q.BROWSE_ORGS_SEARCH:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})}(e,t);case q.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{searching:!0})})}(e);case q.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{organizations:t.organizations,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})}(e,t);case q.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{searching:!1,error:t.error})})}(e,t);case q.BROWSE_ORGS_SORT_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{sortBy:t.sortBy,sortDirection:t.sortDirection,searching:!0})})}(e,t);case q.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{filter:r,searching:!0})})}(e,t);default:return null}}var Z=function(e,t){switch(t.type){case q.AUTH_CHECK_START:return function(e,t){return Object(x.a)({},e,{auth:{status:m.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case q.AUTH_AUTHORIZED:return function(e,t){return Object(x.a)({},e,{auth:{status:m.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case q.AUTH_UNAUTHORIZED:return function(e,t){return Object(x.a)({},e,{auth:{status:m.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case q.AUTH_CHECK_ERROR:return function(e,t){return Object(x.a)({},e,{auth:{status:m.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var $=function(e,t){switch(t.type){case q.APP_SUCCESS:return function(e,t){return Object(x.a)({},e,{app:{status:v.READY,config:t.config}})}(e,t);default:return null}};var ee=function(e,t){switch(t.type){case q.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case q.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:{loadingState:O.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case q.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:{loadingState:O.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:{loadingState:O.NONE,error:null,viewModel:null}})})}(e);case q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageOrganizationRequestsView:Object(x.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(x.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var te,re=function(e,t){switch(t.type){case q.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:O.LOADING,viewModel:null,error:null})})})}(e);case q.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:O.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case q.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:O.ERROR,viewModel:null,error:t.error})})})}(e,t);case q.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{loadingState:O.NONE,viewModel:null,error:null})})})}(e);case q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.ADMIN,e):e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{viewModel:Object(x.a)({},e.views.viewMembersView.viewModel,{organization:Object(x.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.MEMBER,e):e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{viewMembersView:Object(x.a)({},e.views.viewMembersView,{viewModel:Object(x.a)({},e.views.viewMembersView.viewModel,{organization:Object(x.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}},ne=r(3),ae=r.n(ne),ie=r(10);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(te||(te={}));Object(B.a)(Error);var oe,se,ce,le=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).originalError=void 0,r.name="GroupException",r.originalError=e,r}return Object(U.a)(t,e),t}(W),ue=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(U.a)(t,e),t}(W),Ee=function(){function e(t){var r=t.token,n=t.url;Object(b.a)(this,e),this.token=void 0,this.url=void 0,this.token=r,this.url=n}return Object(y.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"listGroups",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGroups",value:function(){var e=this;return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new le(e)});case"text/plain":return e.text().then(function(e){throw new ue(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,o;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new le(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new ue(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new le(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new ue(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{logourl:e.logoUrl,researchinterests:e.researchInterests,homeurl:e.homeUrl}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{logourl:t.logoUrl,homeurl:t.homeUrl,researchinterests:t.researchInterests},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"getRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===te.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===te.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===te.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r,n){var a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function de(e){var t=function(e){switch(e){case"Invite":return oe.INVITATION;case"Request":return oe.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return se.USER;case"workspace":return se.WORKSPACE;case"catalogmethod":return se.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,ce.OPEN);switch(r){case se.USER:return oe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case se.WORKSPACE:return oe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case se.APP:return oe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(oe||(oe={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(se||(se={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(ce||(ce={}));var me,pe,ve,he=function(){function e(t){Object(b.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.cache=void 0,this.params=t,this.groupsClient=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(y.a)(e,[{key:"getRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=de(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOutboundRequests",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r,n,a=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return de(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",de(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return de(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return de(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCombinedRequestInboxForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getGroupRequests(t,{includeClosed:!1,sortDirection:te.DESCENDING});case 4:e.t0=function(e){return de(e)},n=e.sent.map(e.t0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(1),n=[];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return de(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r,n,a=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return de(e)}).filter(function(e){return e.type===oe.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboundRequests",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r,n,a=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:return r=e.sent,console.log("targeted requests",r),(n=r.map(function(e){return de(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:te.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",de(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:te.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return de(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:te.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return de(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",de(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",de(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",de(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",de(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",de(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return de(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),Oe=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:s.REQUIRED_MISSING,message:"Organization id may not be empty",validatedAt:new Date}];if(e.match(/\s/))return[e,{type:s.ERROR,message:"Organization id may not contain a space",validatedAt:new Date}];if(e.length>100)return[e,{type:s.ERROR,message:"Organization id may not be longer than 100 characters",validatedAt:new Date}];return e.match(/^[a-z0-9-]+$/)?[e,{type:s.OK,validatedAt:new Date}]:[e,{type:s.ERROR,message:'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash "-"',validatedAt:new Date}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:s.REQUIRED_MISSING,message:"Organization name may not be empty",validatedAt:new Date}]:e.length>256?[e,{type:s.ERROR,message:"Organization name may not be longer than 256 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgLogoUrl",value:function(e){return null===e?[e,{type:s.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:s.ERROR,message:"Logo url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgHomeUrl",value:function(e){return null===e?[e,{type:s.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:s.ERROR,message:"Home url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgResearchInterests",value:function(e){return 0===e.length?[name,{type:s.REQUIRED_MISSING,message:"Research Interests may not be empty",validatedAt:new Date}]:e.length>280?[e,{type:s.ERROR,message:"Research Interests may not be longer than 280 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:s.ERROR,message:"Organization description may not be empty",validatedAt:new Date}]:e.length>4096?[e,{type:s.ERROR,message:"Organization description may not be longer than 4,096 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}}]),e}();function Re(e,t,r,n){if(t===e.owner.username)return{type:pe.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:pe.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:pe.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:pe.NONE};switch(a.type){case me.MEMBER:return{type:pe.MEMBER};case me.ADMIN:return{type:pe.ADMIN};case me.OWNER:return{type:pe.OWNER};default:return{type:pe.NONE}}}function ge(e){switch(e){case"None":return ve.NONE;case"Read":return ve.VIEW;case"Write":return ve.EDIT;case"Admin":return ve.ADMIN;case"Own":return ve.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}function we(e,t){var r={username:e.owner.name,joinedAt:new Date(e.owner.joined),type:me.OWNER,title:"Owner"},n=[].concat(e.admins.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:me.ADMIN,title:e.custom.title}})).concat(e.members.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),type:me.MEMBER,title:e.custom.title}})),a=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:ge(e.perm)}});return{id:e.id,name:e.name,isPrivate:e.private,isMember:"none"!==e.role,relation:Se(e.role),logoUrl:e.custom.logourl||null,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||"",description:e.custom.description,owner:r,areMembersPrivate:e.privatemembers,members:n,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),narratives:a,apps:[],memberCount:e.memcount,narrativeCount:e.rescount.workspace||0,appCount:e.rescount.catalogmethod||0}}function fe(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.owner)})})}function _e(e,t,r){var n=r===h.ASCENDING?1:-1;switch(t){case"created":return e.slice().sort(function(e,t){return n*(e.createdAt.getTime()-t.createdAt.getTime())});case"name":return e.slice().sort(function(e,t){return n*e.name.localeCompare(t.name)});case"owner":return e.slice().sort(function(e,t){return n*e.owner.localeCompare(t.owner)});default:return console.warn("unimplemented sort field: "+t),e}}function Se(e){switch(e){case"none":return pe.NONE;case"member":return pe.MEMBER;case"admin":return pe.ADMIN;case"owner":return pe.OWNER;default:throw new Error("Unknown role: "+e)}}function Ae(e,t,r){switch(t){case"all":return e;case"notMemberOf":return e.filter(function(e){return e.relation===pe.NONE});case"memberOf":return e.filter(function(e){return e.relation!==pe.NONE});case"owned":return e.filter(function(e){return e.relation===pe.OWNER});case"notOwned":return e.filter(function(e){return e.relation!==pe.OWNER});default:return console.warn("unknown filter : "+t),e}}Oe.nonPrintableRe=/[\000-\031]/,function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(me||(me={})),function(e){e.NONE="NONE",e.VIEW="VIEW",e.MEMBER_REQUEST_PENDING="MEMBER_REQUEST_PENDING",e.MEMBER_INVITATION_PENDING="MEMBER_INVITATION_PENDING",e.MEMBER="MEMBER",e.ADMIN="ADMIN",e.OWNER="OWNER"}(pe||(pe={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(ve||(ve={}));var Ne=function(){function e(t){Object(b.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.organizations=void 0,this.params=t,this.groupsClient=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),this.organizations=new Map}return Object(y.a)(e,[{key:"getOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.organizations.has(t)){e.next=2;break}return e.abrupt("return",this.organizations.get(t));case 2:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){var n=we(e,r.params.username);return r.organizations.set(t,n),n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroups();case 2:return t=e.sent,r=t.map(function(e){return e.id}),e.abrupt("return",this.getOrgs(r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return t=e.sent,r=t.filter(function(e){return e.relation!==pe.NONE}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listGroupToBriefOrganization",value:function(e){return{id:e.id,name:e.name,logoUrl:e.custom.logourl||null,private:e.private,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||null,owner:e.owner,relation:Se(e.role),createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),memberCount:e.memcount||0,narrativeCount:e.rescount.workspace||0}}},{key:"getAllOrgs2",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r,n=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.listGroups();case 2:return t=e.sent,r=t.map(function(e){return n.listGroupToBriefOrganization(e)}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=Ae(r,t.filter,t.username),a=fe(n,t.searchTerms),i=_e(a,t.sortBy,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=r.filter(function(e){return e.relation!==pe.NONE}),e.abrupt("return",{organizations:n,total:n.length});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",de(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),t.id.validationState.type===s.OK&&t.name.validationState.type===s.OK&&t.logoUrl.validationState.type===s.OK&&t.description.validationState.type===s.OK&&t.isPrivate.validationState.type===s.OK){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.abrupt("return",n.createGroup({id:t.id.value,name:t.name.value,logoUrl:t.logoUrl.value,homeUrl:t.homeUrl.value,researchInterests:t.researchInterests.value,description:t.description.value,isPrivate:t.isPrivate.value}).then(function(e){return we(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,logoUrl:r.logoUrl,homeUrl:r.homeUrl,researchInterests:r.researchInterests,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return Oe.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return Oe.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return Oe.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembershipToGroup",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",de(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ee({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",de(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(e,t){return new Ee({url:this.params.groupsServiceURL,token:this.params.token}).memberToAdmin({groupId:e,member:t})}},{key:"adminToMember",value:function(e,t){return new Ee({url:this.params.groupsServiceURL,token:this.params.token}).adminToMember({groupId:e,member:t})}},{key:"removeMember",value:function(e,t){return new Ee({url:this.params.groupsServiceURL,token:this.params.token}).removeMember({groupId:e,member:t})}}]),e}();function Te(e,t){if(t)return ve.OWNER;switch(e){case"r":return ve.VIEW;case"w":return ve.EDIT;case"a":return ve.ADMIN;default:throw new Error("Invalid workspace user permission: "+e)}}var Ie=function(e,t){switch(t.type){case q.INVITE_USER_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:O.LOADING})})})}(e);case q.INVITE_USER_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:O.SUCCESS,error:null,viewModel:{editState:g.EDITING,users:t.users,organization:t.organization,selectedUser:null}})})})}(e,t);case q.INVITE_USER_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:O.SUCCESS,error:t.error,viewModel:null})})})}(e,t);case q.INVITE_USER_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{loadingState:O.NONE,error:null,viewModel:null})})})}(e);case q.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{users:t.users})})})})}(e,t);case q.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})})})}(e,t);case q.INVITE_USER_SEND_INVITATION_START:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{editState:g.SENDING})})})})}(e);case q.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");var r=e.views.inviteUserView.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=pe.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=pe.MEMBER_INVITATION_PENDING),e});return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{editState:g.SUCCESS,selectedUser:n,users:i})})})})}(e);case q.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){if(null===e.views.inviteUserView.viewModel)throw new Error("view value is null");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{inviteUserView:Object(x.a)({},e.views.inviteUserView,{viewModel:Object(x.a)({},e.views.inviteUserView.viewModel,{editState:g.ERROR})})})})}(e);default:return null}};var be=function(e,t){switch(t.type){case q.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:O.LOADING,error:null,viewModel:null}})})}(e);case q.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:O.SUCCESS,error:null,viewModel:{organization:t.organization,editableMemberProfile:t.editableMemberProfile}}})})}(e,t);case q.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:O.ERROR,error:t.error,viewModel:null}})})}(e,t);case q.MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{manageMembershipView:{loadingState:O.NONE,error:null,viewModel:null}})})}(e);default:return null}};function ye(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{viewModel:Object(x.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVING})})})})}var Ce=function(e,t){switch(t.type){case q.REQUEST_ADD_NARRATIVE_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{loadingState:O.LOADING,error:null,viewModel:null})})})}(e);case q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{loadingState:O.SUCCESS,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,saveState:c.SAVED}})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{loadingState:O.ERROR,error:t.error,viewModel:null})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_SEND_START:return ye(e);case q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");var r=Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{viewModel:Object(x.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVED})})})}),n=r.views.requestNarrativeView.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=w.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.workspaceId===a.workspaceId&&(e.status=w.REQUESTED),e}),r}(e,t);case q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return ye(e);case q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:Object(x.a)({},e.views.requestNarrativeView,{error:null,viewModel:Object(x.a)({},e.views.requestNarrativeView.viewModel,{selectedNarrative:t.narrative})})})})}(e,t);case q.REQUEST_ADD_NARRATIVE_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{requestNarrativeView:{loadingState:O.NONE,error:null,viewModel:null}})})}(e);default:return null}};function De(e,t){switch(t.type){case q.DASHBOARD_LOAD_START:return{loadingState:O.LOADING,error:null,viewModel:null};case q.DASHBOARD_LOAD_SUCCESS:return function(e,t){return{loadingState:O.SUCCESS,error:null,viewModel:{refreshState:O.NONE,organizations:t.organizations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,pendingAdminRequests:t.pendingGroupRequests}}}(0,t);case q.DASHBOARD_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{loadingState:O.ERROR,error:t.error,viewModel:null})}(e,t);case q.DASHBOARD_UNLOAD:return{loadingState:O.NONE,error:null,viewModel:null};case q.DASHBOARD_REFRESH_START:return function(e,t){return e.viewModel?Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{refreshState:O.LOADING})}):e}(e);case q.DASHBOARD_REFRESH_SUCCESS:return function(e,t){return Object(x.a)({},e,{error:null,viewModel:{refreshState:O.SUCCESS,organizations:t.organizations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,pendingAdminRequests:t.pendingGroupRequests}})}(e,t);case q.DASHBOARD_REFRESH_ERROR:return function(e,t){return e.viewModel?Object(x.a)({},e,{error:t.error,viewModel:Object(x.a)({},e.viewModel,{refreshState:O.ERROR})}):e}(e,t);case q.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{requestOutbox:t.requests})})}(e,t);case q.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{requestInbox:t.requests,organizations:t.organizations})})}(e,t);case q.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){if(!e.viewModel)throw new Error("view model mysteriously missing in dashboard");return Object(x.a)({},e,{viewModel:Object(x.a)({},e.viewModel,{requestInbox:t.requests})})}(e,t);default:return null}}var Ue=function(e,t){switch(t.type){case q.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{users:Object(x.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case q.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{orgs:Object(x.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case q.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{narratives:{byId:new Map(r.byId)}})})}(e,t);default:return null}};var ke=function(e,t){switch(t.type){case q.ORGANIZATION_CENTRIC_VIEW_LOAD_START:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:{loadingState:O.LOADING,error:null,viewModel:null}})})}(e);case q.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:Object(x.a)({},e.views.organizationCentricView,{loadingState:O.SUCCESS,error:null,viewModel:{organization:t.organization,pendingJoinRequest:t.pendingJoinRequest,pendingJoinInvitation:t.pendingJoinInvitation,relation:t.relation}})})})}(e,t);case q.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:Object(x.a)({},e.views.organizationCentricView,{loadingState:O.ERROR,error:t.error,viewModel:null})})})}(e,t);case q.ORGANIZATION_CENTRIC_VIEW_UNLOAD:return function(e,t){return Object(x.a)({},e,{views:Object(x.a)({},e.views,{organizationCentricView:{loadingState:O.NONE,error:null,viewModel:null}})})}(e);default:return null}};function Me(e,t){switch(t.type){case q.GLOBAL_ACCESS_NARRATIVE_SUCCESS:return function(e,t){var r=e.entities.narratives.byId;return r.set(t.narrative.workspaceId,t.narrative),Object(x.a)({},e,{entities:Object(x.a)({},e.entities,{narratives:Object(x.a)({},e.entities.narratives,{byId:r})})})}(e,t);default:return null}}function Ve(e,t){switch(t.type){case q.NOTIFICATIONS_LOAD_SUCCESS:return function(e,t){var r=new Map;return t.notifications.forEach(function(e){r.set(e.id,e)}),Object(x.a)({},e,{db:Object(x.a)({},e.db,{notifications:{all:t.notifications,byId:r}})})}(e,t);case q.NOTIFICATIONS_UNLOAD:return function(e,t){return Object(x.a)({},e,{db:Object(x.a)({},e.db,{notifications:{all:[],byId:new Map}})})}(e);case q.NOTIFICATIONS_READ_SUCCESS:return function(e,t){var r=e.db.notifications,n=r.all,a=r.byId,i=n.filter(function(e){return e.id!==t.notificationId}),o=new Map(a);return o.delete(t.notificationId),Object(x.a)({},e,{db:Object(x.a)({},e.db,{notifications:{all:i,byId:o}})})}(e,t);default:return null}}var je,ze=function(e,t){return H(e,t)||J(e,t)||function(e,t){var r=X(e.views.browseOrgsView,t);return r?Object(x.a)({},e,{views:Object(x.a)({},e.views,{browseOrgsView:r})}):null}(e,t)||K(e,t)||Z(e,t)||$(e,t)||ee(e,t)||re(e,t)||Ie(e,t)||be(e,t)||Ce(e,t)||function(e,t){var r=De(e.views.dashboardView,t);return r?Object(x.a)({},e,{views:Object(x.a)({},e.views,{dashboardView:r})}):null}(e,t)||Ue(e,t)||ke(e,t)||Me(e,t)||Ve(e,t)||e},Le=(r(171),r(149)),Ge=r(116),xe=r(332),Pe=(r(173),r(348)),Be=(r(175),r(51)),qe=r.n(Be),We=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderDefault",value:function(){return A.createElement("img",{style:{width:this.props.size,height:this.props.size},src:"unicorn-64.png"})}},{key:"renderLogoUrl",value:function(){return this.props.logoUrl?A.createElement("img",{src:this.props.logoUrl,width:this.props.size}):A.createElement("span",null,"n/a")}},{key:"renderUnicornify",value:function(){var e="https://unicornify.pictures/avatar/"+qe()(this.props.organizationId)+"?s="+this.props.size;return A.createElement("img",{style:{width:this.props.size,height:this.props.size},src:e})}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultInitial",value:function(){var e=this.charAt(this.props.organizationName,0).toUpperCase(),t=qe()(this.props.organizationId).substr(0,6);return A.createElement("svg",{width:this.props.size,height:this.props.size,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},A.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:this.props.size-12,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogo",value:function(){return this.props.logoUrl?this.renderLogoUrl():this.renderDefaultInitial()}},{key:"render",value:function(){return this.renderLogo()}}]),t}(A.Component),He=r(32),Qe=r(330),Fe=(r(179),r(181),r(131)),Je=r.n(Fe),Ye=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:Je.a;case"silhouette":case"mysteryman":default:return Je.a}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return A.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(A.Component);function Ke(e){switch(e){case je.COMPACT:return je.NORMAL;case je.NORMAL:return je.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(je||(je={}));var Xe=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={view:je.COMPACT},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Ke(this.state.view)})}},{key:"renderRole",value:function(){return A.createElement("span",null,A.createElement(He.a,{type:"crown"})," owner")}},{key:"renderCompact",value:function(){return A.createElement("div",{className:"Owner View-COMPACT"},A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===je.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===je.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(Ye,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),A.createElement("div",{className:"username"},this.props.user.username)))}},{key:"renderNormal",value:function(){return A.createElement("div",{className:"Owner View-NORMAL"},A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===je.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===je.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(Ye,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),A.createElement("div",{className:"username"},this.props.user.username),A.createElement("div",{className:"role"},this.renderRole()),A.createElement("div",{className:"title"},this.props.user.title||A.createElement("i",null,"no title in user profile")),A.createElement("div",{className:"organization"},this.props.user.organization||A.createElement("i",null,"no organization in user profile")),A.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||A.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case je.COMPACT:return this.renderCompact();case je.NORMAL:return this.renderNormal()}}}]),t}(A.Component),Ze=function(){function e(t){var r=t.url,n=t.token;Object(b.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n}return Object(y.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:"UserProfile."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var t=Object(ie.a)(ae.a.mark(function t(r){return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.profileCache.has(r)){t.next=2;break}return t.abrupt("return",Promise.resolve(e.profileCache.get(r)));case 2:return t.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",[r]))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0][0]}));case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("get_user_profile",e))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}},{key:"getAllUsers",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:""}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}},{key:"searchUsers",value:function(e){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload("filter_users",{filter:e}))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()}).then(function(e){return e.result[0]})}}]),e}();function $e(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}Ze.profileCache=new Map;var et=function(){function e(t){Object(b.a)(this,e),this.params=void 0,this.userProfileClient=void 0,this.cache=void 0,this.params=t,this.userProfileClient=new Ze({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(y.a)(e,[{key:"getUser",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=$e(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return $e(e)}),a.forEach(function(e){var t=$e(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),tt=r(20),rt=function(e){function t(e){var r;if(Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"callFunc",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(b.a)(this,e),this.url=void 0,this.token=void 0,this.module=void 0,this.url=r,this.token=n||null,this.module=a}return Object(y.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,o,s;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=13;break}return e.next=3,t.json();case 3:if(r=e.sent,n=r.result,a=r.error,!n){e.next=10;break}return e.abrupt("return",[n,null]);case 10:return e.abrupt("return",[null,a]);case 11:e.next=15;break;case 13:if(204!==t.status){e.next=15;break}return e.abrupt("return",[null,null]);case 15:if(500!==t.status){e.next=28;break}if("application/json"!==t.headers.get("Content-Type")){e.next=24;break}return e.next=19,t.json();case 19:return i=e.sent,o=i.error,e.abrupt("return",[null,o]);case 24:return e.next=26,t.text();case 26:return s=e.sent,e.abrupt("return",[null,{code:0,name:"Internal Server Error (for real)",message:"The service experienced an internal error",error:s}]);case 28:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){return n.processResponse(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),nt=r(117),at=r.n(nt),it=function(){function e(t){var r=t.url,n=t.token;Object(b.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n||null}return Object(y.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}();it.module=void 0;var ot=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(function(e){function t(e){var r;if(Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(it));ot.module="ServiceWizard";var st=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(b.a)(this,e),this.cache=void 0,this.cacheLifetime=void 0,this.monitoringFrequency=void 0,this.waiterTimeout=void 0,this.waiterFrequency=void 0,this.isMonitoring=void 0,this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(y.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new at.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var o=(new Date).getTime()-a;o>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+o))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):at.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),ct=function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,o=t.rpcContext;if(Object(b.a)(this,e),this.token=void 0,this.timeout=void 0,this.rpcContext=void 0,this.url=void 0,this.version=void 0,this.token=r,this.timeout=i||1e4,this.rpcContext=o||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(y.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return st.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new ot({url:e.url,token:e.token});return at.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new rt({module:n.module_name,url:n.url,token:r.token});return at.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}();ct.module=void 0;var lt,ut,Et=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"listNarratives",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(tt.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(ct);function dt(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function mt(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:dt(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:1===e[6],lockStatus:e[7],metadata:e[8]}}function pt(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:dt(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}Et.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(lt||(lt={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(ut||(ut={}));var vt=function(){function e(t){Object(b.a)(this,e),this.params=void 0,this.params=t}return Object(y.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,o,s,c,l,u;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Et({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new Ne({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),a=new he({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:return i=e.sent,o=Object(tt.a)(i,3),s=o[0],c=o[1],l=o[2],u=c.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",s.narratives.map(function(e){return{workspaceInfo:mt(e.ws),objectInfo:pt(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){var t;return t=-1!==u.indexOf(e.workspaceInfo.id)?lt.ASSOCIATED:l.find(function(t){return t.resourceType===se.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?lt.REQUESTED:lt.NONE,{workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,status:t,modifiedAt:e.workspaceInfo.modifiedAt}}).sort(function(e,t){return e.title.localeCompare(t.title)}));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"workspaceToNarrative",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,o,s,c,l,u,E,d;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new rt({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,Promise.all([r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:1}],includeMetadata:1,ignoreErrors:0}]),r.callFunc("get_workspace_info",[{id:t}])]);case 4:if(n=e.sent,a=Object(tt.a)(n,2),i=Object(tt.a)(a[0],2),o=Object(tt.a)(i[0],1),o[0],s=i[1],c=Object(tt.a)(a[1],2),l=Object(tt.a)(c[0],1),u=l[0],E=c[1],!s&&!E){e.next=16;break}return e.abrupt("return",null);case 16:return d=mt(u),e.abrupt("return",{workspaceId:d.id,title:d.metadata.narrative_nice_name||"Unknown",permission:Te(d.userPermission,d.owner===this.params.username),isPublic:d.globalReadPermission});case 20:return e.prev=20,e.t0=e.catch(1),e.abrupt("return",null);case 23:case"end":return e.stop()}},e,this,[[1,20]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getNarrative",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,o,s,c,l,u,E,d,m;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new rt({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.callFunc("get_workspace_info",[{id:t}]);case 4:if(n=e.sent,a=Object(tt.a)(n,2),i=a[0],!a[1]){e.next=10;break}return e.abrupt("return",{workspaceId:t,access:ut.NONE});case 10:if(o=mt(i[0]),s=o.metadata.narrative){e.next=14;break}return e.abrupt("return",{workspaceId:t,access:ut.NONE});case 14:return c=parseInt(s,10),e.next=17,r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:c}],includeMetadata:1,ignoreErrors:0}]);case 17:if(l=e.sent,u=Object(tt.a)(l,2),E=u[0],!u[1]){e.next=23;break}return e.abrupt("return",{workspaceId:t,access:ut.NONE});case 23:d=pt(E[0].infos[0]),e.t0=o.userPermission,e.next="n"===e.t0?27:"r"===e.t0?33:"w"===e.t0?35:"a"===e.t0?37:39;break;case 27:if(!o.globalReadPermission){e.next=32;break}return m=ut.VIEW,e.abrupt("break",40);case 32:throw new Error("Cannot have no access and no global read permission!");case 33:return m=ut.VIEW,e.abrupt("break",40);case 35:return m=ut.EDIT,e.abrupt("break",40);case 37:return m=o.owner===this.params.username?ut.OWNER:ut.ADMIN,e.abrupt("break",40);case 39:throw new Error("Unknown workspace permission: "+o.userPermission);case 40:return e.abrupt("return",{workspaceId:o.id,access:m,isPublic:o.globalReadPermission,objectId:d.id,title:o.metadata.narrative_nice_name||"Unknown",owner:o.owner,lastSavedAt:d.savedAt,lastSavedBy:d.savedBy});case 43:throw e.prev=43,e.t1=e.catch(1),console.error("Error fetching narrative!",e.t1),e.t1;case 47:case"end":return e.stop()}},e,this,[[1,43]])}));return function(t){return e.apply(this,arguments)}}()}]),e}();function ht(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,o=i.token,i.username,s=a.app.config,c=new et({token:o,userProfileServiceURL:s.services.UserProfile.url}),t.prev=3,t.next=6,c.getUser(e);case 6:l=t.sent,r((E=l,{type:q.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((u={code:"error",message:t.t0.message},{type:q.ENTITY_USER_LOADER_ERROR,error:u}));case 13:case"end":return t.stop()}var u,E},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function Ot(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new vt({token:o,username:s,workspaceServiceURL:c.services.Workspace.url,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=3,t.next=6,l.getNarrative(e);case 6:u=t.sent,console.log("ok, got narrative",e,u),r({type:q.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:u}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),r({type:q.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 14:case"end":return t.stop()}},t,this,[[3,11]])}));return function(e,r){return t.apply(this,arguments)}}()}var Rt=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.user?A.createElement(Xe,{user:this.props.user,avatarSize:this.props.avatarSize}):A.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.username)}}]),t}(A.Component);var gt=Object(z.b)(function(e,t){return{user:e.entities.users.byId.get(t.username)}},function(e){return{onLoad:function(t){e(ht(t))}}})(Rt);function wt(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var ft=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:wt(this.state.view)})}},{key:"renderLogo",value:function(e){return A.createElement(We,{logoUrl:e.logoUrl,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(e.homeUrl)return A.createElement("div",{className:"BriefOrganization-homeUrl"},A.createElement("a",{href:e.homeUrl,target:"_blank"},A.createElement(He.a,{type:"home"})," ",e.homeUrl))}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?A.createElement("span",null,e.narrativeCount):A.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return e.memberCount?A.createElement("span",null,e.memberCount):A.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderRelation",value:function(e){switch(e.relation){case pe.NONE:return A.createElement("span",null,A.createElement(He.a,{type:"stop"})," ","You are ",A.createElement("b",null,"not a member")," of this organization");case pe.VIEW:return A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},A.createElement("span",null,A.createElement(He.a,{type:"stop"})," You are not a member - view organization to join"));case pe.MEMBER_REQUEST_PENDING:return A.createElement("span",null,A.createElement(He.a,{type:"user",style:{color:"orange"}})," Your membership ",A.createElement("b",null,"request")," is pending");case pe.MEMBER_INVITATION_PENDING:return A.createElement("span",null,A.createElement(He.a,{type:"user",style:{color:"blue"}})," You have been ",A.createElement("b",null,"invited")," to join");case pe.MEMBER:return A.createElement("span",null,A.createElement(He.a,{type:"user"})," You are a ",A.createElement("b",null,"member")," of this organization");case pe.ADMIN:return A.createElement("span",null,A.createElement(He.a,{type:"unlock"})," You are an ",A.createElement("b",null,"admin")," of this organization");case pe.OWNER:return A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},A.createElement("span",null,A.createElement(He.a,{type:"crown"})," You are the ",A.createElement("b",null,"owner")," of this Organization"))}}},{key:"renderNormal",value:function(){var e=this.props.organization;return A.createElement("div",{className:"BriefOrganization"},A.createElement("div",{className:"BriefOrganization-body"},A.createElement("div",{className:"BriefOrganization-col2"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),A.createElement("div",{className:"BriefOrganization-col1"},A.createElement("div",{className:"BriefOrganization-infoTable"},A.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},e.name)),A.createElement("div",{className:"BriefOrganization-homeUrl BriefOrganization-infoTableRow"},this.renderHomeUrl(e)),A.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),A.createElement("div",null,this.renderRelation(e)),A.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},A.createElement("div",{className:"BriefOrganization-infoTableCol1"},A.createElement("span",{className:"field-label"},"established")),A.createElement("div",{className:"BriefOrganization-infoTableCol2"},A.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))),A.createElement("div",{className:"BriefOrganization-infoTableRow"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===n.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===n.NORMAL?"up":"down")}))),A.createElement("div",{className:"BriefOrganization-orgOwner BriefOrganization-infoTableRow"},A.createElement("div",{className:"BriefOrganization-infoTableCol1"},A.createElement("span",{className:"field-label"},"owner")),A.createElement("div",{className:"BriefOrganization-infoTableCol2"},A.createElement(gt,{username:e.owner,avatarSize:30}))),A.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},A.createElement("div",{className:"BriefOrganization-infoTableCol1"},A.createElement("span",{className:"field-label"},"members")),A.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderMemberCount(e))),A.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},A.createElement("div",{className:"BriefOrganization-infoTableCol1"},A.createElement("span",{className:"field-label"},"narratives")),A.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderNarrativeCount(e)))))))}},{key:"renderCompact",value:function(){var e=this.props.organization;return A.createElement("div",{className:"BriefOrganization"},A.createElement("div",{className:"BriefOrganization-body"},A.createElement("div",{className:"BriefOrganization-col2"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),A.createElement("div",{className:"BriefOrganization-col1"},A.createElement("div",{className:"BriefOrganization-infoTable"},A.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},e.name)),A.createElement("div",{className:"BriefOrganization-homeUrl BriefOrganization-infoTableRow"},this.renderHomeUrl(e)),A.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),A.createElement("div",null,this.renderRelation(e)),A.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},A.createElement("div",{className:"BriefOrganization-infoTableCol1"},A.createElement("span",{className:"field-label"},"established")),A.createElement("div",{className:"BriefOrganization-infoTableCol2"},A.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))),A.createElement("div",{className:"BriefOrganization-infoTableRow"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===n.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===n.NORMAL?"up":"down")})))))))}},{key:"render",value:function(){switch(this.state.view){case n.NORMAL:return this.renderNormal();case n.COMPACT:return this.renderCompact()}}}]),t}(A.Component),_t=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderAdminInfo",value:function(e){return A.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderOrgs",value:function(){return this.props.organizations.length>0?this.props.organizations.map(function(e,t){return A.createElement("div",{key:String(t),className:"simpleCard"},A.createElement(ft,{organization:e}))}):A.createElement(Pe.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return A.createElement("div",{className:"Organizations"},A.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(A.Component);var St=Object(z.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");return{organizations:e.views.browseOrgsView.viewModel.organizations}})(_t),At=(r(235),r(338)),Nt=r(75),Tt=r(337),It=r(347),bt=r(232),yt=(r(237),r(346)),Ct=function(e){function t(e,r){var n;return Object(b.a)(this,t),(n=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(y.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return A.createElement(He.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"onMenuSelection",value:function(e){console.log("here",e.key)}},{key:"renderMenu",value:function(){return A.createElement(yt.a,{onClick:this.onMenuSelection.bind(this),selectedKeys:[this.state.currentMenuItem],mode:"horizontal"},A.createElement(yt.a.Item,{key:"myorgs"},"My Organizations"),A.createElement(yt.a.Item,{key:"allorgs"},"All Organizations"))}},{key:"renderMenu3",value:function(){var e=this;return Object(It.a)(function(t){var r=t.history;return A.createElement(yt.a,{onClick:function(e){!function(e){switch(e){case"myorgs":r.push("/dashboard");case"allorgs":r.push("/organizations")}}(e.key)},selectedKeys:[e.state.currentMenuItem],mode:"horizontal"},A.createElement(yt.a.Item,{key:"myorgs"},"My Organizations"),A.createElement(yt.a.Item,{key:"allorgs"},"All Organizations"))})}},{key:"renderMenu4",value:function(){return A.createElement(bt.a,{render:function(e){var t=e.history;var r=[];switch(e.location.pathname){case"/dashboard":r=["myorgs"];break;case"/organizations":r=["allorgs"]}return A.createElement(yt.a,{onClick:function(e){!function(e){switch(console.log("navigate to ...",e),e){case"myorgs":console.log("my orgs?",e,t),t.push("/dashboard");case"allorgs":t.push("/organizations")}}(e.key)},selectedKeys:r,mode:"horizontal"},A.createElement(yt.a.Item,{key:"myorgs"},"My Organizations"),A.createElement(yt.a.Item,{key:"allorgs"},"All Organizations"))}})}},{key:"renderMenu2",value:function(){return A.createElement("div",null,this.props.test,":",A.createElement("span",{style:{padding:"4px",marginRight:"4px"}},A.createElement(xe.a,{to:"/"},A.createElement("span",{"data-test":"orgs-label"},"My Organizations"))),A.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},A.createElement(xe.a,{to:"/organizations"},A.createElement("span",{"data-test":"orgs-label"},"All Organizations"))))}},{key:"renderMenu5",value:function(){return A.createElement(A.Fragment,null,A.createElement("span",{style:{padding:"4px",marginRight:"4px"}},A.createElement(xe.a,{to:"/"},A.createElement("span",{"data-test":"orgs-label"},"My Organizations"))),A.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},A.createElement(xe.a,{to:"/organizations"},A.createElement("span",{"data-test":"orgs-label"},"All Organizations"))),A.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},A.createElement(xe.a,{to:"/newOrganization"},A.createElement("span",{"data-test":"orgs-label"},"Create New Organization"))))}},{key:"render",value:function(){return A.createElement("div",{className:"Header"},A.createElement("div",{className:"Header-contextual"},A.createElement("div",{className:"Header-userColumn"},A.createElement("div",{className:"Header-breadcrumbs"},this.props.breadcrumbs),A.createElement("div",{className:"Header-buttons"},this.props.buttons))))}}]),t}(A.Component),Dt=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).searchInput=void 0,r.searchButton=void 0,r.searchInput=A.createRef(),r.searchButton=A.createRef(),r.state={searchInput:"",showInfo:!1},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearchOrgs([])}},{key:"onShowInfo",value:function(){At.a.info({title:"Organizations Browser Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the organizations browser..."))})}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){this.props.onSortOrgs(e.target.value,this.props.sortDirection)}},{key:"onSortByChange2",value:function(e){this.props.onSortOrgs(e,this.props.sortDirection)}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onSortDirectionChange2",value:function(e){this.props.onSortOrgs(this.props.sortBy,e)}},{key:"onFilterChange",value:function(e){this.props.onFilterOrgs(e.target.value)}},{key:"onFilterChange2",value:function(e){this.props.onFilterOrgs(e)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?A.createElement("span",null,"No organizations in the system"):0===this.props.filteredCount?A.createElement("span",null,"No organizations found out of"," ",this.props.totalCount," ","available."):this.props.totalCount===this.props.filteredCount?A.createElement("span",null,"Showing all"," ",this.props.totalCount," ","organizations"):A.createElement("span",null,"Showing"," ",this.props.filteredCount," ","out of"," ",this.props.totalCount," ","organizations")}},{key:"renderSearchIcon",value:function(){return this.props.searching?A.createElement(He.a,{type:"loading"}):A.createElement(He.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return A.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},A.createElement("input",{placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),A.createElement(Nt.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),A.createElement(Nt.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}))}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,"Browse and Search Organizations"),A.createElement(He.a,{type:"right",style:{margin:"0 4px"}}),A.createElement("span",{style:{fontWeight:"normal",fontStyle:"italic"}},this.renderSearchFeedback())),t=A.createElement(A.Fragment,null,A.createElement(xe.a,{to:"/newOrganization"},A.createElement(Nt.a,{icon:"plus-circle"},"Create Organization")),A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderSearchFilter",value:function(){return A.createElement("div",null,A.createElement("span",{className:"field-label"},"sort by"),A.createElement(Tt.a,{onChange:this.onSortByChange2.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},A.createElement(Tt.a.Option,{value:"name",key:"name"},"Org name"),A.createElement(Tt.a.Option,{value:"owner",key:"owner"},"Owner"),A.createElement(Tt.a.Option,{value:"created",key:"created"},"Date created")),A.createElement(Tt.a,{onChange:this.onSortDirectionChange2.bind(this),style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},A.createElement(Tt.a.Option,{value:h.ASCENDING,key:"name"},A.createElement(He.a,{type:"sort-ascending"}),"Ascending"),A.createElement(Tt.a.Option,{value:h.DESCENDING,key:"owner"},A.createElement(He.a,{type:"sort-descending"}),"Descending")),A.createElement("span",{className:"field-label",style:{marginLeft:"10px"}},"filter"),A.createElement(Tt.a,{onChange:this.onFilterChange2.bind(this),defaultValue:this.props.filter,style:{width:"16em"},dropdownMatchSelectWidth:!0},A.createElement(Tt.a.Option,{value:"all",key:"all"},"All"),A.createElement(Tt.a.Option,{value:"memberOf",key:"memberOf"},"You are a member of"),A.createElement(Tt.a.Option,{value:"notMemberOf",key:"memberOf"},"You are not a member of"),A.createElement(Tt.a.Option,{value:"owned",key:"owned"},"Owned by you"),A.createElement(Tt.a.Option,{value:"notOwned",key:"notOwned"},"Not owned by you")))}},{key:"renderOrganizations",value:function(){return this.props.error?A.createElement(Pe.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):A.createElement(St,null)}},{key:"render",value:function(){return A.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},this.renderHeader(),A.createElement("div",{className:"searchBarRow"},A.createElement("div",{className:"searchBarCol"},this.renderSearchBar()),A.createElement("div",{className:"sortCol"},this.renderSearchFilter())),A.createElement("div",{className:"bodyRow scrollable-flex-column"},A.createElement("div",{className:"col2 scrollable-flex-column"},this.renderOrganizations())))}}]),t}(A.Component);function Ut(e,t){return{type:q.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t}}function kt(e){return{type:q.BROWSE_ORGS_SEARCH_ERROR,error:e}}function Mt(){return function(e,t){e({type:q.BROWSE_ORGS_LOAD_START}),e(function(e){return{type:q.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:e}}({rawOrganizations:[],organizations:[],totalCount:0,filteredCount:0,sortBy:"name",sortDirection:h.ASCENDING,filter:"all",searchTerms:[],selectedOrganizationId:null,searching:!1,error:null}))}}function Vt(e){return function(t,r){t({type:q.BROWSE_ORGS_SEARCH_START});var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config;if(null!==a.viewModel){var l=a.viewModel,u=l.sortBy,E=l.sortDirection,d=l.filter;return new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}).queryOrgs({searchTerms:e,sortBy:u,sortDirection:E,filter:d,username:s}).then(function(e){var r=e.organizations,n=e.total;t(Ut(r,n))}).catch(function(e){console.error("Error querying orgs",e.name,e.message),t(kt({code:e.name,message:e.message}))})}t(kt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function jt(e,t){return function(r,n){r(function(e,t){return{type:q.BROWSE_ORGS_SORT_START,sortBy:e,sortDirection:t}}(e,t));var a=n(),i=a.views.browseOrgsView,o=a.auth.authorization,s=o.token,c=o.username,l=a.app.config,u=new Ne({token:s,username:c,groupsServiceURL:l.services.Groups.url});if(null!==i.viewModel){var E=i.viewModel,d=E.searchTerms,m=E.filter;return u.queryOrgs({searchTerms:d,sortBy:e,sortDirection:t,filter:m,username:c}).then(function(e){var t=e.organizations,n=e.total;r(Ut(t,n))}).catch(function(e){r(kt({code:e.name,message:e.message}))})}r(kt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}function zt(e){return function(t,r){t(function(e){return{type:q.BROWSE_ORGS_FILTER_START,filter:e}}(e));var n=r(),a=n.views.browseOrgsView,i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url});if(null!==a.viewModel){var u=a.viewModel,E=u.searchTerms,d=u.sortBy,m=u.sortDirection;return l.queryOrgs({searchTerms:E,sortBy:d,sortDirection:m,filter:e,username:s}).then(function(e){var r=e.organizations,n=e.total;t(Ut(r,n))}).catch(function(e){t(kt({code:e.name,message:e.message}))})}t(kt({code:"invalid-state",message:"Search orgs may not be called without a defined view"}))}}var Lt=Object(z.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.error;return t.searchTerms,t.selectedOrganizationId,{organizations:r,totalCount:t.totalCount,filteredCount:t.filteredCount,sortBy:t.sortBy,sortDirection:t.sortDirection,filter:t.filter,error:n,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(Vt(t))},onSortOrgs:function(t,r){e(jt(t,r))},onFilterOrgs:function(t){e(zt(t))}}})(Dt),Gt=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Fetching your orgs and other things...")}},{key:"renderError",value:function(){if(this.props.view.error)return A.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.renderError();case O.SUCCESS:return A.createElement(Lt,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var xt=Object(z.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(Mt())},onUnload:function(){e({type:q.BROWSE_ORGS_UNLOAD})}}})(Gt);function Pt(e){return{type:q.ADD_ORG_SAVE_ERROR,error:e}}function Bt(){return{type:q.ADD_ORG_EVALUATE_ERRORS}}function qt(e){return{type:q.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function Wt(e,t){return{type:q.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function Ht(){return function(e,t){e({type:q.ADD_ORG_LOAD_START});var r,n={id:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Oe.validateOrgId("")[1]},name:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Oe.validateOrgName("")[1]},logoUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Oe.validateOrgLogoUrl("")[1]},homeUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Oe.validateOrgHomeUrl("")[1]},researchInterests:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Oe.validateOrgResearchInterests("")[1]},description:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:Oe.validateOrgDescription("")[1]},isPrivate:{value:!1,remoteValue:null,syncState:i.CLEAN,validationState:{type:s.OK,validatedAt:new Date}}};e((r=n,{type:q.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(Ft())}}function Qt(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:q.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,o=r.views.addOrgView.viewModel.newOrganization,s=r.app.config,c=new Ne({token:a,username:i,groupsServiceURL:s.services.Groups.url});o?c.addOrg(o,i).then(function(t){e(function(e){return{type:q.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",o,t),e(Pt({code:t.code||t.name,message:t.message,exception:t}))}):e(Pt({code:"app",message:"The new organization data does not yet exist"}))}else e(Pt({code:"invalid",message:"Unexpected condition: no view model"}))}}function Ft(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState.type===s.OK&&a.id.validationState.type===s.OK&&a.logoUrl.validationState.type===s.OK&&a.homeUrl.validationState.type===s.OK&&a.researchInterests.validationState.type===s.OK&&a.description.validationState.type===s.OK?e({type:q.ADD_ORG_EVALUATE_OK}):e(Bt())}else e(Pt({code:"invalid",message:"Unexpected condition: no view model"}))}}function Jt(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new Ne({token:r,username:n,groupsServiceURL:a.services.Groups.url})}function Yt(e){return function(t){var r=Oe.validateOrgName(e),n=Object(tt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:q.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:q.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(Ft())}}function Kt(e){return function(t){var r,n=Oe.validateOrgLogoUrl(e),a=Object(tt.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:q.ADD_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(i,o)):t((r=i,{type:q.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:r})),t(Ft())}}var Xt=function(){function e(t,r){Object(b.a)(this,e),this.delay=void 0,this.fun=void 0,this.canceled=void 0,this.timer=void 0,this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(y.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),Zt=null;function $t(e){return function(t,r){t(function(e){return{type:q.ADD_ORG_UPDATE_ID_PASS,id:e}}(e));var n=Oe.validateOrgId(e),a=Object(tt.a)(n,2),i=a[0],o=a[1];if(o.type!==s.OK)return t(Wt(i,o)),void t(Ft());var c=r().views.addOrgView.viewModel;if(c){var l=c.newOrganization.id.validationState.validatedAt,u=(new Date).getTime();if(l)if(u-l.getTime()<500)return void(Zt||(Zt=new Xt(500,function(){t(function(e,t){var r=t(),n=r.views.addOrgView.viewModel;if(n){var a=n.newOrganization.id,i=Oe.validateOrgId(a.value),o=Object(tt.a)(i,2),c=o[0],l=o[1];if(l.type!==s.OK)return e(Wt(c,l)),void e(Ft());var u=Jt(t());u.orgExists(c).then(function(t){e(t?Wt(c,{type:s.ERROR,message:"This org id is already in use",validatedAt:new Date}):qt(c)),e(Ft())})}})})));Zt&&Zt.cancel(),Zt=null,Jt(r()).orgExists(i).then(function(e){t(e?Wt(i,{type:s.ERROR,validatedAt:new Date,message:"This org id is already in use"}):qt(i)),t(Ft())})}}}function er(e){return function(t,r){Jt(r());var n=Oe.validateOrgDescription(e),a=Object(tt.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:q.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(i,o)):t(function(e){return{type:q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(i)),t(Ft())}}var tr=r(333),rr=r(40),nr=r(340),ar=r(342),ir=(r(246),function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,showError:!0},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onShowInfo",value:function(){At.a.info({title:"New Organization Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"As a KBase user, you may create your own organizations."),A.createElement("p",null,"Once you have created an Organization, you will be the sole owner of it, forever."),A.createElement("p",null,"In order to create an Org, you need to complete the following fields."),A.createElement("dl",null,A.createElement("dt",null,"name"),A.createElement("dd",null,"The organization ",A.createElement("i",null,"name")," is whatever you wish to have your Org known as. It may be composed of any text (including unicode characters) up to 200 characters in length. You may also change it at any time."),A.createElement("dt",null,"logo"),A.createElement("dd",null,A.createElement("p",null,"Logo support has undergone a redesign, but has not yet been implemented. The new design supports direct image upload, and removes gravatar support."),A.createElement("p",null,"For now, gravatar is the only support for org logo"),A.createElement("p",null,'In order to display a custom logo for your organization, you need to associate your Organization with an avatar hosted with the Gravatar service. To do so, simply enter the email address associated with your gravatar and press the update button. This will calculate a new "gravatar hash" and associate it with your organization.')),A.createElement("dt",null,"id"),A.createElement("dd",null,A.createElement("p",null,"Your Org ",A.createElement("i",null,"id")," forms a url endpoint for your org as well as the identifier used throughout KBase to, well, identify your organization uniquely among all current and future organizations. As such, the Org ID may not be changed once created."),A.createElement("p",null,"The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also restricted to 100 characters in length.")),A.createElement("dt",null,"description"),A.createElement("dd",null,A.createElement("p",null,"Up to 4000 characters, a description allows you to express to other KBase users the purpose, history, associations, and science domain of your Org."),A.createElement("p",null,'The description is in "markdown" format, and the editor will show you a preview of the rendered description.'))))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){At.a.confirm({title:"Leave the editor?",content:A.createElement("div",null,A.createElement("p",null,"You have entered information for this new organization."),A.createElement("p",null,"If you leave the editor without first saving, the new organization ",A.createElement("i",null,"will not be created"),"."),A.createElement("p",null,A.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===o.EDITED&&this.props.saveState===c.NEW}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===i.DIRTY?A.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderForm",value:function(){return A.createElement("form",{id:"newOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"name"),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.newOrganization.name.value||"",className:this.calcFieldClass(this.props.newOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.newOrganization.name))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"id"),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.newOrganization.id.value||"",className:this.calcFieldClass(this.props.newOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.newOrganization.id))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"logo url"),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.newOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.logoUrl))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"home page url"),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.newOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.homeUrl))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"is private?"),A.createElement("div",{className:"col2"},A.createElement(ar.a,{checked:this.props.newOrganization.isPrivate.value,className:this.calcFieldClass(this.props.newOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.newOrganization.isPrivate))),A.createElement("div",{className:"row",style:{flex:"1 1 0px",height:"5em"}},A.createElement("div",{className:"col1 field-label"},"research interests"),A.createElement("div",{className:"col2"},A.createElement("textarea",{value:this.props.newOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.newOrganization.researchInterests),onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.newOrganization.researchInterests))),A.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},A.createElement("div",{className:"col1 field-label"},"description"),A.createElement("div",{className:"col2"},A.createElement("textarea",{value:this.props.newOrganization.description.value||"",className:this.calcFieldClass(this.props.newOrganization.description),onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.newOrganization.description))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"}),A.createElement("div",{className:"col2"})))}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderLogo",value:function(e){return A.createElement(We,{logoUrl:null,size:64,organizationName:e.name.value,organizationId:e.id.value})}},{key:"renderIsPrivate",value:function(e){return e?A.createElement("span",null,A.createElement(He.a,{type:"lock"})," ","Private"):A.createElement("span",null,A.createElement(He.a,{type:"global"})," ","Public")}},{key:"renderDefaultLogo",value:function(){if(!this.props.newOrganization.name.value||!this.props.newOrganization.id.value)return A.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.newOrganization.name.value,0).toUpperCase(),t=qe()(this.props.newOrganization.id.value).substr(0,6);return A.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},A.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogoPreview",value:function(){return this.props.newOrganization.logoUrl.value?A.createElement("img",{src:this.props.newOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"renderPreview",value:function(){return A.createElement("form",{className:"preview"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"name"},this.props.newOrganization.name.value||""))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"id"},A.createElement("span",{style:{color:"silver"}},this.origin,"/orgs/viewOrganization/"),this.props.newOrganization.id.value||A.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"logoUrl"},this.renderLogoPreview()))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"homeUrl",style:{height:"1em"}},this.props.newOrganization.homeUrl.value||""))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"isPrivate"},this.renderIsPrivate(this.props.newOrganization.isPrivate.value)))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"researchInterests",style:{height:"5em"}},this.props.newOrganization.researchInterests.value||""))),A.createElement("div",{className:"row",style:{flex:"1 1 0px"}},A.createElement("div",{className:"col2"},A.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:rr.Marked.parse(this.props.newOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return A.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderHeader",value:function(){var e,t=this.props.newOrganization.name.value||A.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");this.props.error&&(e=A.createElement(Nt.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}));var r=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(He.a,{type:"plus-circle"})," ",'Adding a New Org "',t,'"')),n=A.createElement(A.Fragment,null,A.createElement(Nt.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}),e);return A.createElement(Ct,{breadcrumbs:r,buttons:n})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading New Org Editor...");return A.createElement(Ct,{breadcrumbs:e})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return A.createElement("div",{key:"line_"+t},e)})),t&&(t=A.createElement("div",null,A.createElement("div",null,"trace"),t)),A.createElement(At.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},A.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),A.createElement("div",null,this.props.error.message),t)}}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(tr.a,{push:!0,to:"/organizations"}):this.props.saveState===c.SAVED?A.createElement(tr.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):this.props.newOrganization?A.createElement("div",{className:"NewOrganization"},this.renderHeader(),A.createElement("div",{className:"mainRow"},A.createElement("div",{className:"editorColumn"},A.createElement("h3",null,"Editor"),this.renderForm()),A.createElement("div",{className:"previewColumn"},A.createElement("h3",null,"Preview"),this.renderPreview())),this.renderError()):A.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(A.Component));var or=Object(z.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(Qt())},onUpdateName:function(t){e(Yt(t))},onUpdateLogoUrl:function(t){e(Kt(t))},onUpdateId:function(t){e($t(t))},onUpdateDescription:function(t){e(er(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Ft())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=Oe.validateOrgHomeUrl(e),n=Object(tt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.ADD_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:i}):t({type:q.ADD_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a})}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=Oe.validateOrgHomeUrl(e),n=Object(tt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a})}}(t))}}})(ir),sr=(r(253),function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case O.SUCCESS:default:return A.createElement(or,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component));var cr=Object(z.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(Ht())},onUnload:function(){e({type:q.ADD_ORG_UNLOAD})}}})(sr),lr=function(){function e(t){Object(b.a)(this,e),this.params=void 0,this.params=t}return Object(y.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,o,s,c;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ne({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),n=new he({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(o=e.sent,(s=Re(a,this.params.username,i,o)).type!==pe.ADMIN&&s.type!==pe.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:c=e.sent,e.next=19;break;case 18:c=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:o,relation:s,groupRequests:c});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function ur(e){return{type:q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrative:e}}function Er(e){return{type:q.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function dr(e){return{type:q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e}}function mr(e){return{type:q.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function pr(e){return{type:q.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function vr(){return{type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function hr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p,v,h,O,R,g,w;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=a.db.notifications,u=l.all,l.byId,E=new lr({token:o,username:s,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),d=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,E.getOrganizationForUser(e);case 7:if(m=t.sent,p=m.organization,(v=m.relation).type!==pe.OWNER&&v.type!==pe.ADMIN){t.next=19;break}return t.next=13,d.getPendingOrganizationRequestsForOrg(e);case 13:return h=t.sent,t.next=16,d.getOrganizationInvitationsForOrg(e);case 16:O=t.sent,t.next=21;break;case 19:h=null,O=null;case 21:return t.next=23,d.getCombinedRequestInboxForOrg(e);case 23:return R=t.sent,t.next=26,d.getRequestOutboxForOrg(e);case 26:g=t.sent,w=u.filter(function(t){return t.organizationId===e}),r((_=p,S=v,A=h,N=O,T=R,I=g,b=w,{type:q.VIEW_ORG_LOAD_SUCCESS,organization:_,relation:S,groupRequests:A,groupInvitations:N,requestInbox:T,requestOutbox:I,notifications:b})),t.next=34;break;case 31:t.prev=31,t.t0=t.catch(4),r((f={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_LOAD_ERROR,error:f}));case 34:case"end":return t.stop()}var f,_,S,A,N,T,I,b},t,this,[[4,31]])}));return function(e,r){return t.apply(this,arguments)}}()}function Or(){return function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,i,o,s,c,l,u;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r()).views.viewOrgView.viewModel){e.next=4;break}return t(pr({type:a.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=n.auth.authorization,o=i.token,s=i.username,c=n.app.config,l=n.views.viewOrgView.viewModel.organization,u=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),e.prev=6,e.next=9,u.requestMembershipToGroup(l.id);case 9:t({type:q.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(hr(l.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(pr({type:a.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,this,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function Rr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var i,o,s,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_JOIN_REQUEST_START}),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(pr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new he({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.cancelRequest(e);case 10:E=t.sent,r({type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(hr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:a.ERROR,message:t.t0.message},{type:q.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function gr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var i,o,s,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(vr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(pr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new he({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.acceptJoinInvitation(e);case 10:E=t.sent,r({type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(hr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function wr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var i,o,s,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(vr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(pr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new he({token:s,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.rejectJoinInvitation(e);case 10:E=t.sent,r({type:q.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(hr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:q.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}var fr,_r,Sr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,{code:"feeds-exception",message:e.message,detail:e.message,info:new Map}))).originalError=void 0,r.name="FeedsException",r.originalError=e,r}return Object(U.a)(t,e),t}(W),Ar=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(U.a)(t,e),t}(W),Nr=function(){function e(t){Object(b.a)(this,e),this.params=void 0,this.params=t}return Object(y.a)(e,[{key:"put",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.abrupt("return",fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(500!==e.status){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json().then(function(e){return e})}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new Sr(e)});case"text/plain":return e.text().then(function(e){throw new Ar(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,o;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new Sr(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new Ar(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"postWithResult",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,o;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.baseURLPath().concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new Sr(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new Ar(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,o,s;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.from(r.entries()).map(function(e){var t=Object(tt.a)(e,2),r=t[0],n=t[1];return[r,encodeURIComponent(n)].join("=")}).join("&"),a=this.baseURLPath().concat(t).join("/")+"?"+n,e.next=4,fetch(a,{headers:{Authorization:this.params.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 4:if(500!==(i=e.sent).status){e.next=20;break}e.t0=i.headers.get("Content-Type"),e.next="application/json"===e.t0?9:"text/plain"===e.t0?13:17;break;case 9:return e.next=11,i.json();case 11:throw o=e.sent,new Sr(o);case 13:return e.next=15,i.text();case 15:throw s=e.sent,new Ar(s);case 17:throw new Error("Unexpected content type: "+i.headers.get("Content-Type"));case 18:e.next=27;break;case 20:if(200!==i.status){e.next=26;break}return e.next=23,i.json();case 23:return e.abrupt("return",e.sent);case 26:throw new Error("Unexpected response: "+i.status+" : "+i.statusText);case 27:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"baseURLPath",value:function(){return[this.params.url,"api","V1"]}},{key:"getNotifications",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.count,(n=new Map).set("n",String(r)),e.next=5,this.get(["notifications"],n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"seeNotifications",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postWithResult(["notifications","see"],t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Tr(e){switch(e){case"alert":return fr.ALERT;case"error":return fr.ERROR;case"warning":return fr.WARNING;case"request":return fr.REQUEST;default:throw new Error("Invalid level value: "+e)}}function Ir(e){var t=e.target[0];switch(e.verb){case"requested":switch(t.type){case"user":return _r.JOIN_REQUEST;case"narrative":case"workspace":return _r.NARRATIVE_ASSOCIATION_REQUEST;case"app":return _r.APP_ASSOCIATION_REQUEST}case"updated":switch(t.type){case"narrative":case"workspace":return _r.NARRATIVE_ASSOCIATED}case"accepted":switch(t.type){case"narrative":case"workspace":return _r.NARRATIVE_ACCEPTED;case"user":return _r.USER_ACCEPTED}case"invited":switch(t.type){case"user":return _r.JOIN_INVITATION}default:return console.log("unknown??",e),_r.UNKNOWN}return _r.UNKNOWN}!function(e){e[e.ALERT=0]="ALERT",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.REQUEST=3]="REQUEST"}(fr||(fr={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JOIN_REQUEST=1]="JOIN_REQUEST",e[e.JOIN_INVITATION=2]="JOIN_INVITATION",e[e.USER_JOINED=3]="USER_JOINED",e[e.USER_ACCEPTED=4]="USER_ACCEPTED",e[e.NARRATIVE_ASSOCIATION_REQUEST=5]="NARRATIVE_ASSOCIATION_REQUEST",e[e.NARRATIVE_ASSOCIATED=6]="NARRATIVE_ASSOCIATED",e[e.NARRATIVE_ACCEPTED=7]="NARRATIVE_ACCEPTED",e[e.APP_ASSOCIATION_REQUEST=8]="APP_ASSOCIATION_REQUEST",e[e.APP_ASSOCIATED=9]="APP_ASSOCIATED",e[e.MESSAGE=10]="MESSAGE"}(_r||(_r={}));var br=function(){function e(t){Object(b.a)(this,e),this.params=void 0,this.feedsClient=void 0,this.params=t,this.feedsClient=new Nr({token:this.params.token,url:this.params.feedsServiceURL})}return Object(y.a)(e,[{key:"getNotifications",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,e.abrupt("return",t.user.feed.map(function(e){var t=e.id,r=e.actor,n=e.verb,a=e.object,i=e.target,o=e.source,s=e.level,c=e.seen,l=e.created,u=e.expires,E=e.external_key,d=e.context;return{id:t,actor:r,verb:n,object:a,target:i,source:o,level:Tr(s),seen:c,createdAt:new Date(l),expiresAt:new Date(u),externalKey:E,context:d}}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationNotifications",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.getNotifications({count:100});case 2:return t=e.sent,console.log("notifications",t),e.abrupt("return",t.user.feed.filter(function(e){var t=e.actor;return"groupsservice"===e.source&&t.id!==r.params.username}).map(function(e){return{id:e.id,from:e.actor.id,createdAt:new Date(e.created),expiresAt:new Date(e.expires),level:Tr(e.level),read:e.seen,organizationId:e.object.id,type:Ir(e),regarding:e.target}}));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"seeNotification",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.feedsClient.seeNotifications({note_ids:[t]});case 2:return r=e.sent,n=r.seen_notes,r.unauthorized_notes,e.abrupt("return",n[0]);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function yr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.NOTIFICATIONS_READ_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new br({token:o,username:s,feedsServiceURL:c.services.Feeds.url}),t.prev=3,t.next=6,l.seeNotification(e);case 6:t.sent,r({type:q.NOTIFICATIONS_READ_SUCCESS,notificationId:e}),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),console.error("error",t.t0),r({type:q.NOTIFICATIONS_READ_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 14:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}r(255);var Cr,Dr=r(336),Ur=r(341);r(257);function kr(e){switch(e){case Cr.COMPACT:return Cr.NORMAL;case Cr.NORMAL:return Cr.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Cr||(Cr={}));var Mr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={view:Cr.COMPACT},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:kr(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case me.OWNER:return A.createElement("span",null,A.createElement(He.a,{type:"crown"})," owner");case me.ADMIN:return A.createElement("span",null,A.createElement(He.a,{type:"unlock"})," admin");case me.MEMBER:return A.createElement("span",null,A.createElement(He.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){return A.createElement("div",{className:"Member View-COMPACT"},A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Cr.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===Cr.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(Ye,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),A.createElement("div",{className:"role"},this.renderRole()),A.createElement("div",{className:"joinedAt"},A.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt))))}},{key:"renderNormal",value:function(){return A.createElement("div",{className:"Member View-NORMAL"},A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Cr.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===Cr.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(Ye,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),A.createElement("div",{className:"role"},this.renderRole()),A.createElement("div",{className:"joinedAt"},A.createElement("span",{className:"field-label"},"joined")," ",Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.member.joinedAt)),A.createElement("div",{className:"title"},this.props.user.title||A.createElement("i",null,"no title in user profile")),A.createElement("div",{className:"organization"},this.props.user.organization||A.createElement("i",null,"no organization in user profile")),A.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||A.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case Cr.COMPACT:return this.renderCompact();case Cr.NORMAL:return this.renderNormal()}}}]),t}(A.Component),Vr=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.user?A.createElement(Mr,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):A.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(A.Component);var jr,zr=Object(z.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(ht(t))}}})(Vr),Lr=r(343);r(259);!function(e){e[e.NONE=0]="NONE",e[e.MANAGE_MEMBERSHIP=1]="MANAGE_MEMBERSHIP",e[e.VIEW_MEMBERS=2]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=3]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=4]="VIEW_ORGANIZATION",e[e.EDIT_ORGANIZATION=5]="EDIT_ORGANIZATION",e[e.INVITE_USER=6]="INVITE_USER"}(jr||(jr={}));var Gr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).relation=void 0,r.state={navigateTo:jr.NONE},r.relation=r.getUserRelation(),r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"getUserRelation",value:function(){var e=this.props.currentUsername,t=this.props.organization;if(e===t.owner.username)return{type:pe.OWNER};var r=t.members.find(function(t){return t.username===e});if(!r)return this.props.pendingJoinRequest&&this.props.pendingJoinRequest.user===e?{type:pe.MEMBER_REQUEST_PENDING,requestId:this.props.pendingJoinRequest.id}:this.props.pendingJoinInvitation&&this.props.pendingJoinInvitation.user===e?{type:pe.MEMBER_INVITATION_PENDING,requestId:this.props.pendingJoinInvitation.id}:{type:pe.VIEW};switch(r.type){case l.MEMBER:return{type:pe.MEMBER};case l.ADMIN:return{type:pe.ADMIN};case l.OWNER:return{type:pe.OWNER};default:return{type:pe.NONE}}}},{key:"onJoinClick",value:function(){this.props.onJoinOrg(),Lr.a.success("Join request has been submitted")}},{key:"onCancelJoinRequest",value:function(){var e=this.relation;this.props.onCancelJoinRequest(e.requestId),Lr.a.success("Submitted cancellation request")}},{key:"onAcceptInvitation",value:function(){var e=this.relation;this.props.onAcceptInvitation(e.requestId),Lr.a.success("Invitation acceptance has been sent")}},{key:"onRejectInvitation",value:function(){var e=this.relation;this.props.onRejectInvitation(e.requestId),Lr.a.success("Invitation rejection has been sent")}},{key:"onNavigateToMembership",value:function(){this.setState({navigateTo:jr.MANAGE_MEMBERSHIP})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:jr.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:jr.MANAGE_REQUESTS})}},{key:"onNavigateToEditOrganization",value:function(){this.setState({navigateTo:jr.EDIT_ORGANIZATION})}},{key:"onNavigateToInviteUser",value:function(){this.setState({navigateTo:jr.INVITE_USER})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:jr.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({navigateTo:jr.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:jr.VIEW_MEMBERS});break;case"editOrg":this.setState({navigateTo:jr.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({navigateTo:jr.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:jr.MANAGE_REQUESTS})}}},{key:"renderLogo",value:function(e){return A.createElement(We,{logoUrl:e.logoUrl,size:64,organizationName:e.name,organizationId:e.id})}},{key:"renderRelation",value:function(){this.props.organization;switch(this.relation.type){case pe.NONE:return A.createElement("span",null,A.createElement(He.a,{type:"stop"}),"None");case pe.VIEW:return A.createElement("div",null,A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it, you may request membership"},A.createElement("div",{style:{textAlign:"center"}},A.createElement(He.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization")),A.createElement("div",{style:{textAlign:"center"}},A.createElement(Nt.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization")));case pe.MEMBER_REQUEST_PENDING:return A.createElement("div",null,A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have requested membership in this Organization"},"   ",A.createElement("div",{style:{textAlign:"center"}},A.createElement("span",null,A.createElement(He.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",A.createElement("b",null,"request")," is pending"," ",A.createElement(He.a,{type:"question-circle"})))),A.createElement("div",{style:{textAlign:"center"}},A.createElement(Nt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case pe.MEMBER_INVITATION_PENDING:return A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this Organization"},A.createElement("div",{style:{textAlign:"center"}},A.createElement("div",null,A.createElement(He.a,{type:"user",style:{color:"blue"}}),"You have been ",A.createElement("b",null,"invited")," to join this Organization"),A.createElement("div",null,A.createElement(Nt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),A.createElement(Nt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"))));case pe.MEMBER:var e=A.createElement(yt.a,{onClick:this.onMenuClick.bind(this)},A.createElement(yt.a.Item,{key:"manageMyMembership"},"Manage My Membership"));return A.createElement("div",{className:"relationRow"},A.createElement("div",{className:"relationLabel"},A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},A.createElement("div",null,A.createElement(He.a,{type:"user"}),"You are a ",A.createElement("b",null,"member")," of this Organization"))),A.createElement("div",{className:"relationMenu"},A.createElement("div",null,A.createElement(Ur.a,{overlay:e,trigger:["click"]},A.createElement(Nt.a,{shape:"circle"},A.createElement(He.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case pe.ADMIN:var t=A.createElement(yt.a,{onClick:this.onMenuClick.bind(this)},A.createElement(yt.a.Item,{key:"manageMyMembership"},"Manage My Membership"),A.createElement(yt.a.Item,{key:"viewMembers"},"Members"),A.createElement(yt.a.Item,{key:"manageRequests"},"Manage Requests"),A.createElement(yt.a.Item,{key:"editOrg"},"Edit this Org"),A.createElement(yt.a.Item,{key:"inviteUser"},"Invite User"));return A.createElement("div",{className:"relationRow"},A.createElement("div",{className:"relationLabel"},A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an Administrator for this organization"},A.createElement("div",null,A.createElement(He.a,{type:"unlock"}),"You are a ",A.createElement("b",null,"administrator")," of this Organization"))),A.createElement("div",{className:"relationMenu"},A.createElement("div",null,A.createElement(Ur.a,{overlay:t,trigger:["click"]},A.createElement(Nt.a,{shape:"circle"},A.createElement(He.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))));case pe.OWNER:var r=A.createElement(yt.a,{onClick:this.onMenuClick.bind(this)},A.createElement(yt.a.Item,{key:"viewMembers"},"Members"),A.createElement(yt.a.Item,{key:"manageRequests"},"Manage Requests"),A.createElement(yt.a.Item,{key:"editOrg"},"Edit this Org"),A.createElement(yt.a.Item,{key:"inviteUser"},"Invite User"));return A.createElement("div",{className:"relationRow"},A.createElement("div",{className:"relationLabel"},A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this organization"},A.createElement("div",null,A.createElement(He.a,{type:"crown",style:{color:"gold"}})," ","You ",A.createElement("b",null,"own")," this Organization"))),A.createElement("div",{className:"relationMenu"},A.createElement("div",null,A.createElement(Ur.a,{overlay:r,trigger:["click"]},A.createElement(Nt.a,{shape:"circle"},A.createElement(He.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))))}}},{key:"renderOrgInfo",value:function(){var e=this.props.organization;return A.createElement(A.Fragment,null,A.createElement("div",{className:"name"},e.name),A.createElement("div",{className:"owner"},A.createElement(gt,{username:e.owner.username,avatarSize:20})))}},{key:"getRelationClass",value:function(e){switch(this.relation.type){case pe.NONE:return"relationRequest";case pe.VIEW:return"relationRequest relationNonMember";case pe.MEMBER_REQUEST_PENDING:return"relationRequest relationRequestPending";case pe.MEMBER_INVITATION_PENDING:return"relationRequest relationInvitationPending";case pe.MEMBER:return"relationRequest relationMember";case pe.ADMIN:return"relationRequest relationAdmin";case pe.OWNER:return"relationRequest relationOwner"}}},{key:"render",value:function(){switch(this.state.navigateTo){case jr.MANAGE_MEMBERSHIP:return A.createElement(tr.a,{push:!0,to:"/membership/"+this.props.organization.id});case jr.VIEW_MEMBERS:return A.createElement(tr.a,{push:!0,to:"/viewMembers/"+this.props.organization.id});case jr.EDIT_ORGANIZATION:return A.createElement(tr.a,{push:!0,to:"/editOrganization/"+this.props.organization.id});case jr.MANAGE_REQUESTS:return A.createElement(tr.a,{push:!0,to:"/manageOrganizationRequests/"+this.props.organization.id});case jr.INVITE_USER:return A.createElement(tr.a,{push:!0,to:"/inviteUser/"+this.props.organization.id});case jr.VIEW_ORGANIZATION:return A.createElement(tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id})}return A.createElement("div",{className:"OrganizationHeader"},A.createElement("div",{className:"avatar"},this.renderLogo(this.props.organization)),A.createElement("div",{className:"orgInfo"},this.renderOrgInfo()),A.createElement("div",{className:"yourRelation "+this.getRelationClass(this.props.organization)},this.renderRelation()))}}]),t}(A.Component);var xr=Object(z.b)(function(e,t){var r=e.views.organizationCentricView.viewModel,n=e.auth.authorization.username;if(!r)throw new Error("View model is unexpectedly missing");return{organization:r.organization,pendingJoinRequest:r.pendingJoinRequest,pendingJoinInvitation:r.pendingJoinInvitation,currentUsername:n}},function(e){return{onJoinOrg:function(){e(Or())},onCancelJoinRequest:function(t){e(Rr(t))},onAcceptInvitation:function(t){e(gr(t))},onRejectInvitation:function(t){e(wr(t))}}})(Gr);function Pr(e){var t=e.organization,r=e.pendingJoinRequest,n=e.pendingJoinInvitation,a=e.relation;return{type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS,organization:t,pendingJoinRequest:r,pendingJoinInvitation:n,relation:a}}var Br=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading header...")}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return A.createElement(xr,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var qr,Wr=Object(z.b)(function(e,t){return{view:e.views.organizationCentricView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),u=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=4,t.next=7,l.getOrg(e);case 7:return E=t.sent,t.next=10,u.getUserRequestForOrg(e);case 10:return d=t.sent,t.next=13,u.getUserInvitationForOrg(e);case 13:m=t.sent,p=Re(E,s,d,m),r(Pr({organization:E,relation:p,pendingJoinRequest:d,pendingJoinInvitation:m})),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(4),r((v={code:t.t0.name,message:t.t0.message},{type:q.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR,error:v}));case 21:case"end":return t.stop()}var v},t,this,[[4,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.ORGANIZATION_CENTRIC_VIEW_UNLOAD})}}})(Br),Hr=r(344);r(261);function Qr(e){switch(e){case qr.COMPACT:return qr.NORMAL;case qr.NORMAL:return qr.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(qr||(qr={}));var Fr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={view:qr.COMPACT},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Qr(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?A.createElement(Qe.a,{title:"This narrative is viewable by all KBase users",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(He.a,{type:"globe"})," Public Narrative")):A.createElement(Qe.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(He.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case ut.VIEW:t=A.createElement("span",null,"View-Only (",A.createElement("i",null,"visit narrative to request additional access"),")");break;case ut.EDIT:t=A.createElement("span",null,"Edit (",A.createElement("i",null,"visit narrative to request additional access"),")");break;case ut.ADMIN:t="Admin";break;case ut.OWNER:t="Owner";break;default:t="Unknown"}return A.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===qr.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===qr.NORMAL?"up":"down")}))),A.createElement("div",{className:"mainCol"},A.createElement("div",{className:"title"},A.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),A.createElement("div",null,this.renderPublicPermission(e)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e))))}},{key:"renderNormal",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===qr.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===qr.NORMAL?"up":"down")}))),A.createElement("div",{className:"mainCol"},A.createElement("div",{className:"title"},A.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),A.createElement("div",null,this.renderPublicPermission(e)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"owner"),e.owner),A.createElement("div",null,A.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===ut.NONE)return console.log("NO ACCESS",e),A.createElement("div",null,"You don't have access to this Narrative");switch(this.state.view){case qr.COMPACT:return A.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case qr.NORMAL:return A.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(A.Component),Jr=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.narrative?A.createElement(Fr,{narrative:this.props.narrative}):A.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(A.Component);var Yr=Object(z.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Ot(t))}}})(Jr),Kr=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case ve.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=A.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you can obtain personal View-Only access by clicking this button",r=A.createElement(Nt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=A.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=A.createElement(Nt.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access"));break;case ve.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=A.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=A.createElement(Nt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case ve.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=A.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=A.createElement(Nt.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case ve.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=A.createElement("span",null,"Admin");break;case ve.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=A.createElement("span",null,"Owner");break;default:t=A.createElement("span",null,"Unknown")}return A.createElement(A.Fragment,null,A.createElement(Qe.a,{title:n,placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement("span",{className:"field-label"},"your permission"),t))," ",A.createElement(Qe.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?A.createElement(Qe.a,{title:"This narrative is viewable by all KBase users",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(He.a,{type:"globe"})," Public Narrative")):A.createElement(Qe.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(He.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return e.permission===ve.NONE?A.createElement(A.Fragment,null,A.createElement("div",{className:"title"},e.title),A.createElement("div",null,this.renderNarrativePermission(e))):A.createElement(Yr,{workspaceId:e.workspaceId})}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=A.createElement(Hr.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),A.createElement("div",null,this.renderNarrative(),e)}}]),t}(A.Component),Xr=r(37),Zr=r.n(Xr);function $r(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_START}),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,l.cancelRequest(e.id);case 8:return t.sent,t.next=11,l.getOutboundRequests();case 11:u=t.sent,r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_SUCCESS,requests:u}),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),r({type:q.DASHBOARD_CANCEL_OUTBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 18:case"end":return t.stop()}},t,this,[[5,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function en(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),o=Math.abs(i);if(o<7776e3){if(0===o)return"now";o<60?(t=i,r=o,n="second"):o<3600?(t=Math.round(i/60),r=Math.round(o/60),n="minute"):o<86400?(t=Math.round(i/3600),r=Math.round(o/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(o/86400),n="day"),r>1&&(n+="s");var s=null,c=null;return t<0?s="in":t>0&&(c="ago"),(s?s+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var tn;r(265);function rn(e){switch(e){case tn.COMPACT:return tn.NORMAL;case tn.NORMAL:return tn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(tn||(tn={}));var nn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={view:tn.COMPACT},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:rn(this.state.view)})}},{key:"renderLogo",value:function(e){return A.createElement(We,{logoUrl:e.logoUrl,size:32,organizationName:e.name,organizationId:e.id})}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderMemberCount",value:function(e){return A.createElement("div",{className:"memberCount"},e.members.length>0?e.members.length:"no"," ",this.pluralize(e.members.length,"member","members"))}},{key:"renderNormal",value:function(){var e=this.props.organization;return A.createElement("div",{className:"OrganizationCompact",key:e.id},A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===tn.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===tn.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),A.createElement("div",{className:"bodyCol"},A.createElement("div",{className:"orgName"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},e.name)),A.createElement("div",{className:"orgOwner"},A.createElement("span",{className:"field-label"},"owner"),A.createElement("span",null,A.createElement(gt,{username:e.owner.username,avatarSize:30}))),A.createElement("div",{className:"orgCreated"},A.createElement("span",{className:"field-label"},"established"),A.createElement("span",{className:"field-value"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)))))}},{key:"renderCompact",value:function(){var e=this.props.organization;return A.createElement("div",{className:"OrganizationCompact",key:e.id},A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===tn.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===tn.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),A.createElement("div",{className:"bodyCol"},A.createElement("div",{className:"orgName"},A.createElement(xe.a,{to:"/viewOrganization/".concat(e.id)},e.name))))}},{key:"render",value:function(){switch(this.state.view){case tn.COMPACT:return A.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case tn.NORMAL:return A.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(A.Component),an=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.organization?A.createElement(nn,{organization:this.props.organization}):A.createElement("div",null,"Loading org...")}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(A.Component);var on,sn=Object(z.b)(function(e,t){return{organization:e.entities.orgs.byId.get(t.organizationId)}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ENTITY_ORGANIZATION_LOADER_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:u=t.sent,r((d=u,{type:q.ENTITY_ORGANIZATION_LOADER_SUCCESS,organization:d})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:"error",message:t.t0.message},{type:q.ENTITY_ORGANIZATION_LOADER_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(an);r(267);function cn(e){switch(e){case on.COMPACT:return on.NORMAL;case on.NORMAL:return on.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(on||(on={}));var ln=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={view:on.COMPACT},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:cn(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?A.createElement(Qe.a,{title:"This narrative is viewable by all KBase users",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(He.a,{type:"globe"})," Public Narrative")):A.createElement(Qe.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},A.createElement("span",{style:{cursor:"help"}},A.createElement(He.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case ut.VIEW:t=A.createElement("span",null,"View-Only (",A.createElement("i",null,"visit narrative to request additional access"),")");break;case ut.EDIT:t=A.createElement("span",null,"Edit (",A.createElement("i",null,"visit narrative to request additional access"),")");break;case ut.ADMIN:t="Admin";break;case ut.OWNER:t="Owner";break;default:t="Unknown"}return A.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===on.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===on.NORMAL?"up":"down")}))),A.createElement("div",{className:"iconCol"},A.createElement(He.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),A.createElement("div",{className:"mainCol"},A.createElement("div",{className:"title"},A.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))))}},{key:"renderNormal",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===on.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===on.NORMAL?"up":"down")}))),A.createElement("div",{className:"iconCol"},A.createElement(He.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),A.createElement("div",{className:"mainCol"},A.createElement("div",{className:"title"},A.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),A.createElement("div",null,this.renderPublicPermission(e)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"owner"),e.owner),A.createElement("div",null,A.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),A.createElement("div",null,A.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===ut.NONE)return A.createElement("div",null,A.createElement(He.a,{type:"exclamation-circle",style:{color:"orange"}})," ","You don't have access to this Narrative");switch(this.state.view){case on.COMPACT:return A.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case on.NORMAL:return A.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(A.Component),un=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.narrative?A.createElement(ln,{narrative:this.props.narrative}):A.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(A.Component);var En,dn=Object(z.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Ot(t))}}})(un);r(269);function mn(e){switch(e){case En.COMPACT:return En.NORMAL;case En.NORMAL:return En.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(En||(En={}));var pn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={view:En.COMPACT},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onToggleView",value:function(){this.setState({view:mn(this.state.view)})}},{key:"renderCompact",value:function(){return A.createElement(A.Fragment,null,A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===En.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===En.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(Ye,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),A.createElement("div",null,this.props.user.username)))}},{key:"renderNormal",value:function(){return A.createElement(A.Fragment,null,A.createElement("div",{className:"controlCol"},A.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===En.NORMAL?"pressed":"")},A.createElement(He.a,{type:"".concat(this.state.view===En.NORMAL?"up":"down")}))),A.createElement("div",{className:"avatarCol"},A.createElement(Ye,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),A.createElement("div",null,this.props.user.username),A.createElement("div",{className:"organization"},this.props.user.organization||A.createElement("i",null,"no organization in user profile")),A.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||A.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case En.COMPACT:return A.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case En.NORMAL:return A.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(A.Component),vn=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.user?A.createElement(pn,{user:this.props.user,avatarSize:this.props.avatarSize}):A.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(A.Component);var hn=Object(z.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(ht(t))}}})(vn),On=(r(271),function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onAcceptRequest",value:function(){this.props.onAcceptInboxRequest(this.props.request)}},{key:"onRejectRequest",value:function(){this.props.onRejectInboxRequest(this.props.request)}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.APP:return"SHOW APP";case se.USER:return"";case se.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(dn,{workspaceId:parseInt(e.narrativeId,10)})))}case oe.INVITATION:switch(e.resourceType){case se.USER:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(hn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return A.createElement(hn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.APP:return"REQUEST to associate App";case se.USER:return"REQUEST to join Organization";case se.WORKSPACE:return"REQUEST to associate Narrative"}case oe.INVITATION:switch(e.resourceType){case se.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.APP:return"SHOW APP";case se.USER:return"";case se.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(dn,{workspaceId:parseInt(e.narrativeId,10)})),A.createElement("div",{className:"cardSectionHeader"},"with organization"))}case oe.INVITATION:switch(e.resourceType){case se.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){var t;return this.props.showOrg&&(t=A.createElement(A.Fragment,null,A.createElement("div",{className:"miniDetail"},A.createElement(sn,{organizationId:e.organizationId})))),A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),t,A.createElement("div",{className:"cardSectionHeader"},"from"),A.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){var t;return this.props.showOrg&&(t=A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"with organization"),A.createElement("div",{className:"miniDetail"},A.createElement(sn,{organizationId:e.organizationId})))),A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),A.createElement("div",{className:"miniDetail"},A.createElement(dn,{workspaceId:parseInt(e.narrativeId,10)})),t,A.createElement("div",{className:"cardSectionHeader"},"from"),A.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return A.createElement("div",{style:{textAlign:"center"}},A.createElement(Nt.a.Group,{style:{marginTop:"4px"}},A.createElement(Nt.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},A.createElement(He.a,{type:"check"}),"Accept"),A.createElement(Nt.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},A.createElement(He.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),A.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),A.createElement("div",{className:"miniDetail"},A.createElement(sn,{organizationId:e.organizationId})),A.createElement("div",{className:"cardSectionHeader"},"from"),A.createElement(hn,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.USER:return this.renderJoinRequest(e);case se.WORKSPACE:return this.renderWorkspaceRequest(e);case se.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"apps not supported yet"))}case oe.INVITATION:switch(e.resourceType){case se.USER:return this.renderUserInvitation(e);case se.WORKSPACE:case se.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return A.createElement("div",{key:e.id,className:"InboxRequest"},A.createElement("div",{className:"requestHeader"},A.createElement("div",{className:"requestHeaderRow"},A.createElement("div",{className:"requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),A.createElement("div",{className:"requestHeaderExpireAt"},A.createElement("span",{className:"field-label"},"expires")," ",en(e.expireAt)))),A.createElement("div",{className:"requestBody"},this.renderBody()))}}]),t}(A.Component));var Rn=Object(z.b)(function(e,t){return{}},function(e){return{onRejectInboxRequest:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:q.DASHBOARD_REJECT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:q.DASHBOARD_REJECT_INBOX_REQUEST_START}),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,l.denyRequest(e.id);case 8:return t.sent,t.next=11,l.getInboundRequests();case 11:u=t.sent,r({type:q.DASHBOARD_REJECT_INBOX_REQUEST_SUCCESS,requests:u}),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),r({type:q.DASHBOARD_REJECT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 18:case"end":return t.stop()}},t,this,[[5,15]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(On),gn=(r(273),function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.APP:return"SHOW APP";case se.USER:return"";case se.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(dn,{workspaceId:parseInt(e.narrativeId,10)})))}case oe.INVITATION:switch(e.resourceType){case se.USER:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(hn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return A.createElement(hn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.APP:return"REQUEST to associate App";case se.USER:return"REQUEST to join Organization";case se.WORKSPACE:return"REQUEST to associate Narrative"}case oe.INVITATION:switch(e.resourceType){case se.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.APP:return"SHOW APP";case se.USER:return"";case se.WORKSPACE:return A.createElement("div",null,A.createElement("div",{className:"miniDetail"},A.createElement(dn,{workspaceId:parseInt(e.narrativeId,10)})),A.createElement("div",{className:"cardSectionHeader"},"with organization"))}case oe.INVITATION:switch(e.resourceType){case se.USER:return A.createElement(hn,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){var t;return this.props.showOrg&&(t=A.createElement("div",{className:"miniDetail"},A.createElement(sn,{organizationId:e.organizationId}))),A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),t,this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return this.props.showOrg&&A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"with organization"),A.createElement("div",{className:"miniDetail"},A.createElement(sn,{organizationId:e.organizationId}))),A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),A.createElement("div",{className:"miniDetail"},A.createElement(dn,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return A.createElement("div",{style:{textAlign:"center"}},A.createElement(Nt.a.Group,{style:{marginTop:"4px"}},A.createElement(Nt.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},A.createElement(He.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){var t;return this.props.showOrg&&(t=A.createElement("div",{className:"miniDetail"},A.createElement(sn,{organizationId:e.organizationId}))),A.createElement(A.Fragment,null,A.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),t,A.createElement("div",{className:"cardSectionHeader"},"sent to"),A.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case oe.REQUEST:switch(e.resourceType){case se.USER:return this.renderJoinRequest(e);case se.WORKSPACE:return this.renderWorkspaceRequest(e);case se.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"apps not supported yet"))}case oe.INVITATION:switch(e.resourceType){case se.USER:return this.renderUserInvitation(e);case se.WORKSPACE:case se.APP:return A.createElement(A.Fragment,null,A.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return A.createElement("div",{key:e.id,className:"OutboxRequest"},A.createElement("div",{className:"requestHeader"},A.createElement("div",{className:"requestHeaderRow"},A.createElement("div",{className:"requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),A.createElement("div",{className:"requestHeaderExpireAt"},A.createElement("span",{className:"field-label"},"expires")," ",en(e.expireAt)))),A.createElement("div",{className:"requestBody"},this.renderBody()))}}]),t}(A.Component));var wn,fn=Object(z.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e($r(t))}}})(gn),_n=(r(275),function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onReadNotification",value:function(e){this.props.onRead(e.id)}},{key:"renderInvitationToOrg",value:function(e){var t=this;return A.createElement("div",{className:"notification simpleCard",key:e.id},A.createElement("div",{className:"mainCol"},A.createElement("div",null,"You have been invited to Join"),A.createElement("div",null,A.createElement(sn,{organizationId:e.organizationId})),A.createElement("div",null,A.createElement("span",{className:"field-label"},"by")),A.createElement("div",null)),A.createElement("div",{className:"actionCol"},A.createElement(Nt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){t.onReadNotification.call(t,e)}})))}},{key:"renderUserAcceptedNotification",value:function(e){var t,r=this;return t=this.props.showOrg?A.createElement("div",null,A.createElement(sn,{organizationId:e.organizationId})):A.createElement("span",null,"this organization"),A.createElement("div",{className:"notification simpleCard",key:e.id},A.createElement("div",{className:"mainCol"},A.createElement("div",null,"Your membership request has been accepted for"),t),A.createElement("div",{className:"actionCol"},A.createElement(Nt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){r.onReadNotification.call(r,e)}})))}},{key:"renderRequestToJoinToOrg",value:function(e){var t,r=this;return this.props.showOrg&&(t=A.createElement("div",null,A.createElement(sn,{organizationId:e.organizationId}))),A.createElement("div",{className:"notification simpleCard",key:e.id},A.createElement("div",{className:"mainCol"},A.createElement("div",null,"Request to join your organization"),t,A.createElement("div",null,A.createElement("span",{className:"field-label"},"from")),A.createElement("div",null,A.createElement(hn,{userId:e.from,avatarSize:30}))),A.createElement("div",{className:"actionCol"},A.createElement(Nt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){r.onReadNotification.call(r,e)}})))}},{key:"renderNarrativeAssociationRequest",value:function(e){var t,r=this,n=parseInt(e.regarding[0].id,10);return this.props.showOrg&&(t=A.createElement(A.Fragment,null,A.createElement("div",null,A.createElement("span",{className:"field-label"},"with organization")),A.createElement("div",null,A.createElement(sn,{organizationId:e.organizationId})))),A.createElement("div",{className:"notification simpleCard",key:e.id},A.createElement("div",{className:"mainCol"},A.createElement("div",null,"Request to associate Narrative"),A.createElement("div",null,A.createElement(dn,{workspaceId:n})),t,A.createElement("div",null,A.createElement("span",{className:"field-label"},"from")),A.createElement("div",null,A.createElement(hn,{userId:e.from,avatarSize:30}))),A.createElement("div",{className:"actionCol"},A.createElement(Nt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){r.onReadNotification.call(r,e)}})))}},{key:"renderNarrativeAssociated",value:function(e){var t,r=this,n=parseInt(e.regarding[0].id,10);return this.props.showOrg&&(t=A.createElement(A.Fragment,null,A.createElement("div",null,A.createElement("span",{className:"field-label"},"with organization")),A.createElement("div",null,A.createElement(sn,{organizationId:e.organizationId})))),A.createElement("div",{className:"notification simpleCard",key:e.id},A.createElement("div",{className:"mainCol"},A.createElement("div",null,"New Narrative associated"),A.createElement("div",null,A.createElement(dn,{workspaceId:n})),t),A.createElement("div",{className:"actionCol"},A.createElement(Nt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){r.onReadNotification.call(r,e)}})))}},{key:"renderNarrativeAccepted",value:function(e){var t,r=this,n=parseInt(e.regarding[0].id,10);return this.props.showOrg&&(t=A.createElement(A.Fragment,null,A.createElement("div",null,A.createElement("span",{className:"field-label"},"into organization")),A.createElement("div",null,A.createElement(sn,{organizationId:e.organizationId})))),A.createElement("div",{className:"notification simpleCard",key:e.id},A.createElement("div",{className:"mainCol"},A.createElement("div",null,"Your Narrative"),A.createElement("div",null,A.createElement(dn,{workspaceId:n})),A.createElement("div",null,"was accepted"),t),A.createElement("div",{className:"actionCol"},A.createElement(Nt.a,{type:"danger",icon:"cross",size:"small",onClick:function(){r.onReadNotification.call(r,e)}})))}},{key:"renderNotification",value:function(e){switch(e.type){case _r.JOIN_INVITATION:return this.renderInvitationToOrg(e);case _r.JOIN_REQUEST:return this.renderRequestToJoinToOrg(e);case _r.UNKNOWN:return"UNKNOWN";case _r.NARRATIVE_ASSOCIATION_REQUEST:return this.renderNarrativeAssociationRequest(e);case _r.NARRATIVE_ASSOCIATED:return this.renderNarrativeAssociated(e);case _r.NARRATIVE_ACCEPTED:return this.renderNarrativeAccepted(e);case _r.APP_ASSOCIATION_REQUEST:return"Request to associate App";case _r.USER_ACCEPTED:return this.renderUserAcceptedNotification(e);default:return"UNKNOWN NOTIFICATION TYPE"}}},{key:"renderNotifications",value:function(){var e=this;return this.props.notifications.map(function(t){return e.renderNotification(t)})}},{key:"renderHeader",value:function(){return A.createElement("span",null,"You have"," ",this.props.notifications.length," ","unread notification",1===this.props.notifications.length?"":"s")}},{key:"renderMain",value:function(){return 0===this.props.notifications.length?A.createElement("div",{className:"message"},"No unread notifications"):A.createElement(A.Fragment,null,A.createElement("div",{className:"Notifications-Header"},this.renderHeader()),A.createElement("div",{className:"Notifications-Body"},this.renderNotifications()))}},{key:"render",value:function(){return A.createElement("div",{className:"Notifications"},this.renderMain())}}]),t}(A.Component));!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(wn||(wn={}));var Sn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={showInfo:!1,navigateTo:wn.NONE,requestAccess:{narrative:null}},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({navigateTo:wn.REQUEST_ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){At.a.info({title:"View Organization Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the organizations viewer..."))})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return A.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.relation.type===pe.ADMIN||this.props.relation.type===pe.OWNER)return A.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",A.createElement(xe.a,{to:"/editOrganization/".concat(this.props.organization.id)},A.createElement(Nt.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.relation.type===pe.ADMIN||this.props.relation.type===pe.OWNER)return A.createElement(xe.a,{to:"/editOrganization/".concat(this.props.organization.id)},A.createElement(Nt.a,{icon:"edit"},"Edit"))}},{key:"renderOrg",value:function(){if(this.props.organization)return A.createElement("div",{className:"org"},A.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:rr.Marked.parse(this.props.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return A.createElement("div",{className:"ownerTable"},A.createElement("div",{className:"proprietorCol"},A.createElement("div",{className:"owner"},A.createElement("a",{href:"/#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(Wr,{organizationId:this.props.organization.id})}},{key:"renderRelation",value:function(e){switch(e.type){case pe.NONE:return A.createElement("span",null,A.createElement(He.a,{type:"stop"}),"None");case pe.VIEW:return A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org, but you may access it; you may request membership"},A.createElement("div",null,A.createElement(He.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),A.createElement("div",{style:{marginTop:"10px"}},A.createElement(Nt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case pe.MEMBER_REQUEST_PENDING:return A.createElement("div",null,A.createElement("div",null,A.createElement(He.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",A.createElement("b",null,"request")," is pending"),A.createElement("div",null,A.createElement(Nt.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case pe.MEMBER_INVITATION_PENDING:return A.createElement("div",null,A.createElement("div",null,A.createElement(He.a,{type:"user",style:{color:"blue"}}),"You have been ",A.createElement("b",null,"invited")," to join this Organization"),A.createElement("div",{style:{marginTop:"10px"}},A.createElement(Nt.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),A.createElement(Nt.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case pe.MEMBER:return A.createElement("span",null,A.createElement(He.a,{type:"user"}),"Member");case pe.ADMIN:return A.createElement("span",null,A.createElement(He.a,{type:"unlock"}),"Admin");case pe.OWNER:return A.createElement(Qe.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},A.createElement("span",null,A.createElement(He.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===pe.OWNER||this.props.relation.type===pe.ADMIN||this.props.relation.type===pe.MEMBER)}},{key:"renderMembers",value:function(){if(!this.isMember())return A.createElement("p",{className:"message"},"Sorry, organization membership restricted to members only");var e,t=A.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No members, yet; what is an Organization without people?");return e=0===this.props.organization.members.length?A.createElement(Pe.a,{type:"info",message:t}):this.props.organization.members.map(function(e){return A.createElement("div",{className:"row",key:e.username},A.createElement("div",{className:"col0"},A.createElement(zr,{member:e,avatarSize:50})))}),A.createElement("div",{className:"infoTable"},e)}},{key:"renderInfo",value:function(){if(this.props.organization)return A.createElement(Dr.a,{title:A.createElement("span",null,A.createElement(He.a,{type:"info-circle"})," info"),headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard"},A.createElement("div",null,A.createElement("div",null,A.createElement("div",{className:"label"},"owner")),A.createElement("div",{className:"ownerTable"},A.createElement(zr,{member:this.props.organization.owner,avatarSize:50})),A.createElement("div",{className:"infoTable"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"},A.createElement("span",{className:"label"},"established")),A.createElement("div",{className:"col2"},A.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.createdAt)))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"},A.createElement("span",{className:"label"},"last updated")),A.createElement("div",{className:"col2"},A.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.organization.modifiedAt)))))))}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.relation,r=this.props.groupRequests,n=this.props.groupInvitations;if((t.type===pe.ADMIN||t.type===pe.OWNER)&&(null!==r&&null!==n))return e=r.length?A.createElement("div",null,"group has no pending requests"):A.createElement("div",null,A.createElement("div",null,A.createElement(He.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",A.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",A.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),A.createElement("div",null,A.createElement(xe.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},A.createElement(Nt.a,null,"Manage Requests")))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"},A.createElement("span",{className:"label"},"admin")),A.createElement("div",{className:"col2"},A.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?A.createElement("div",null,A.createElement("div",null,A.createElement(He.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",A.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",A.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),A.createElement("div",null,A.createElement(xe.a,{to:"/manageOrganizationRequests/"+this.props.organization.id},A.createElement(Nt.a,null,"Manage Requests")))):A.createElement("div",{className:"message"},"No pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case pe.NONE:case pe.VIEW:return"infoBox";case pe.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case pe.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case pe.MEMBER:case pe.ADMIN:case pe.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return A.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.relation;if(e.type===pe.ADMIN||e.type===pe.OWNER){var t=this.props,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=A.createElement("span",null,A.createElement(He.a,{type:"unlock"})," ","group requests"," ",A.createElement("span",{className:"titleCount"},"(",a,")"));return A.createElement("div",{className:"adminTasksBox"},A.createElement(Dr.a,{className:"slimCard adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.organization&&this.props.relation.type===pe.VIEW)return A.createElement(Nt.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderHeader",value:function(){var e=A.createElement("div",{style:{flex:"0 0 auto"}},A.createElement("span",null,this.props.organization&&this.props.organization.name)),t=A.createElement(A.Fragment,null,this.renderEditButton(),this.renderJoinButton(),A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading Org...");return A.createElement(Ct,{breadcrumbs:e})}},{key:"renderMembersCard",value:function(){var e=[A.createElement(xe.a,{key:"viewMembers",to:"/viewMembers/".concat(this.props.organization.id)},A.createElement(Nt.a,{onClick:this.onViewMembers.bind(this),icon:"team"}))];if(this.props.organization){var t;t=this.isMember()?A.createElement("span",{className:"titleCount"},"(",this.props.organization.members.length,")"):"";var r=A.createElement("span",null,A.createElement(He.a,{type:"team"}),"members",t);return A.createElement(Dr.a,{className:"slimCard membersCard",headStyle:{backgroundColor:"gray",color:"white"},title:r,extra:e},this.renderMembers())}}},{key:"onReadNotification",value:function(e){this.props.onReadNotification(e)}},{key:"renderNotificationsCard",value:function(){var e,t=A.createElement("span",{className:"titleCount"},"(0)"),r=A.createElement("span",null,A.createElement(He.a,{type:"notification"}),"notifications",t);return e=0===this.props.notifications.length?A.createElement("div",{className:"message"},"No notifications"):A.createElement(_n,{notifications:this.props.notifications,showOrg:!1,onRead:this.onReadNotification.bind(this)}),A.createElement(Dr.a,{className:"slimCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:r},e)}},{key:"onAcceptRequest",value:function(e){this.props.onAcceptRequest(e)}},{key:"renderInboxCard",value:function(){var e=this;if(this.props.relation.type===pe.ADMIN||this.props.relation.type===pe.OWNER){var t,r=this.props.requestInbox.length,n=A.createElement("span",null,A.createElement(He.a,{type:"inbox"}),"inbox",A.createElement("span",{className:"titleCount"},"(",r,")"));if(0===this.props.requestInbox.length)t=A.createElement("div",{className:"message"},"No pending organization requests for you");else{var a=this.props.requestInbox.map(function(t){return A.createElement("div",{key:t.id,className:"simpleCard"},A.createElement(Rn,{request:t,showOrg:!1,onAcceptInboxRequest:e.onAcceptRequest.bind(e)}))});t=A.createElement("div",{style:{maxHeight:"30em",overflowY:"auto"}},a)}return A.createElement(Dr.a,{className:"slimCard outboxCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:n,extra:[]},t)}}},{key:"renderOutboxCard",value:function(){var e,t=this.props.requestOutbox.length,r=A.createElement("span",null,A.createElement(He.a,{type:"export"}),"outbox",A.createElement("span",{className:"titleCount"},"(",t,")"));if(0===this.props.requestOutbox.length)e=A.createElement("div",{className:"message"},"No pending organization requests from you");else{var n=this.props.requestOutbox.map(function(e){return A.createElement(A.Fragment,{key:e.id},A.createElement(fn,{request:e,showOrg:!1}))});e=A.createElement("div",{style:{maxHeight:"30em",overflowY:"auto"}},n)}return A.createElement(Dr.a,{className:"slimCard outboxCard",style:{marginBottom:"10px"},headStyle:{backgroundColor:"gray",color:"white"},title:r,extra:[]},e)}},{key:"renderNarrativeMenu",value:function(e){var t,r=this,n=this.props.relation;n.type===pe.OWNER||(n.type,pe.ADMIN);switch(n.type){case pe.NONE:break;case pe.VIEW:case pe.MEMBER_REQUEST_PENDING:case pe.MEMBER_INVITATION_PENDING:case pe.MEMBER:break;case pe.ADMIN:case pe.OWNER:t=A.createElement(yt.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},A.createElement(yt.a.Item,{key:"removeNarrative"},A.createElement(He.a,{type:"delete"})," Remove Narrative from Organization"))}if(t)return A.createElement(Ur.a,{overlay:t,trigger:["click"]},A.createElement(Nt.a,{shape:"circle"},A.createElement(He.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}})))}},{key:"renderNarratives",value:function(){var e=this;if(!this.isMember())return A.createElement(Dr.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:A.createElement("span",null,A.createElement(He.a,{type:"folder-open"})," narratives")},A.createElement("p",{style:{textAlign:"center",fontStyle:"italic"}},"Sorry, Narratives are restricted to members only"));var t=[A.createElement(xe.a,{key:"requestAddNarrative",to:"/requestAddNarrative/".concat(this.props.organization.id)},A.createElement(Nt.a,{onClick:this.onRequestAddNarrative.bind(this)},A.createElement(He.a,{type:"plus"})," Add a Narrative"))];if(0===this.props.organization.narratives.length){var r=A.createElement("div",{className:"message"},"Sorry, no Narratives are yet associated with this Organization");return A.createElement(Dr.a,{className:"slimCard  narratives",headStyle:{backgroundColor:"gray",color:"white"},title:A.createElement("span",null,A.createElement(He.a,{type:"folder-open"})," narratives (none)"),extra:t},A.createElement(Pe.a,{type:"info",message:r}))}var n=this.props.organization.narratives.map(function(t){return A.createElement("div",{className:"narrative simpleCard",key:String(t.workspaceId)},A.createElement("div",{className:"dataCol"},A.createElement(Kr,{narrative:t,onGetViewAccess:e.props.onGetViewAccess})),A.createElement("div",{className:"buttonCol"},e.renderNarrativeMenu(t)))}),a=this.props.organization.narratives.length,i=A.createElement("span",null,A.createElement(He.a,{type:"folder-open"}),"narratives"," ",A.createElement("span",{className:"titleCount"},"(",a,")"));return A.createElement(Dr.a,{className:"slimCard narratives narrativesCard scrollable-flex-column",headStyle:{backgroundColor:"gray",color:"white"},title:i,extra:t},A.createElement("div",{className:"narrativesTable"},n))}},{key:"render",value:function(){switch(this.state.navigateTo){case wn.REQUEST_ADD_NARRATIVE:return A.createElement(tr.a,{to:"/requestAddNarrative"});case wn.NONE:}if(this.state.requestAccess.narrative&&this.props.organization){var e=this.props.relation;e.type===pe.MEMBER||e.type===pe.ADMIN||(e.type,pe.OWNER)}return"undefined"!==typeof this.props.organization?A.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"mainRow  scrollable-flex-column"},A.createElement("div",{className:"mainColumn  scrollable-flex-column"},A.createElement("div",{className:"orgRow"},this.renderOrg()),A.createElement("div",{className:"narrativesRow scrollable-flex-column"},this.renderNarratives())),A.createElement("div",{className:"infoColumn scrollable-flex-column"},A.createElement("div",{style:{overflowY:"auto"}},A.createElement("div",{className:"infoBox"},this.renderInfo()),this.renderNotificationsCard(),this.renderInboxCard(),this.renderOutboxCard(),this.renderMembersCard()))),void 0):A.createElement("div",{className:"ViewOrganization"},this.renderLoadingHeader(),"Loading...")}}]),t}(A.Component);var An=Object(z.b)(function(e,t){if(!e.views.viewOrgView.viewModel)throw new Error("argh, view model missing");var r=e.views.viewOrgView.viewModel,n=r.organization,a=r.relation,i=r.groupRequests,o=r.groupInvitations,s=r.requestInbox,c=r.requestOutbox,l=e.db.notifications.all.filter(function(e){return e.organizationId===n.id});return{organization:n,relation:a,groupRequests:i,groupInvitations:o,requestInbox:s,requestOutbox:c,notifications:l}},function(e){return{onViewOrg:function(t){e(hr(t))},onJoinOrg:function(){e(Or())},onCancelJoinRequest:function(t){e(Rr(t))},onAcceptInvitation:function(t){e(gr(t))},onRejectInvitation:function(t){e(wr(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Er({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=a.views.viewOrgView.viewModel.organization){t.next=9;break}return r(Er({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:return u=l.id,E=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,E.removeNarrativeFromOrg(u,e.workspaceId);case 14:r(ur(e)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(11),r(Er({code:t.t0.name,message:t.t0.message}));case 20:case"end":return t.stop()}},t,this,[[11,17]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(mr({code:"error",message:"No view model"})),t.abrupt("return");case 5:if(i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=a.views.viewOrgView.viewModel.organization){t.next=8;break}return t.abrupt("return");case 8:return u=l.id,E=String(e.workspaceId),d=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,d.grantNarrativeAccess(u,E);case 14:return t.next=16,d.getOrg(u);case 16:m=t.sent,r(Ot(e.workspaceId)),r(dr(m)),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(11),r(mr({code:"error",message:t.t0.message}));case 24:case"end":return t.stop()}},t,this,[[11,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onAcceptRequest:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_START}),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),new lr({token:o,username:s,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=6,t.next=9,l.acceptRequest(e.id);case 9:return t.sent,t.next=12,l.getCombinedRequestInboxForOrg(e.organizationId);case 12:u=t.sent,r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,requests:u}),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(6),r({type:q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 19:case"end":return t.stop()}},t,this,[[6,16]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onReadNotification:function(t){e(yr(t))}}})(Sn),Nn=r(334),Tn=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){var e=A.createElement("div",null,"Loading your Organization..."," ",A.createElement(Nn.a,null));return A.createElement(Pe.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return A.createElement(An,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var In=Object(z.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(hr(t))},onUnload:function(){e({type:q.VIEW_ORG_UNLOAD})}}})(Tn);function bn(){return{type:q.EDIT_ORG_EVALUATE_ERRORS}}function yn(e){return{type:q.EDIT_ORG_SAVE_ERROR,error:e}}function Cn(e){return function(t,r){t({type:q.EDIT_ORG_LOAD_START});var n=r(),a=n.auth.authorization,o=a.token,c=a.username,l=n.app.config;return new Ne({token:o,username:c,groupsServiceURL:l.services.Groups.url}).getOrg(e).then(function(e){var r,n,a={id:{value:e.id,remoteValue:e.id,syncState:i.NEW,validationState:Oe.validateOrgId(e.id)[1]},name:{value:e.name,remoteValue:e.name,syncState:i.NEW,validationState:Oe.validateOrgName(e.name)[1]},logoUrl:{value:e.logoUrl,remoteValue:e.logoUrl,syncState:i.NEW,validationState:Oe.validateOrgLogoUrl(e.logoUrl)[1]},homeUrl:{value:e.homeUrl,remoteValue:e.homeUrl,syncState:i.NEW,validationState:Oe.validateOrgHomeUrl(e.homeUrl)[1]},researchInterests:{value:e.researchInterests,remoteValue:e.researchInterests,syncState:i.NEW,validationState:Oe.validateOrgResearchInterests(e.researchInterests)[1]},description:{value:e.description,remoteValue:e.description,syncState:i.NEW,validationState:Oe.validateOrgDescription(e.description)[1]},isPrivate:{value:e.isPrivate,remoteValue:e.isPrivate,syncState:i.NEW,validationState:{type:s.OK,validatedAt:new Date}}};t((r=a,n=e,{type:q.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:q.EDIT_ORG_LOAD_ERROR,error:r}))})}}function Dn(){return function(e,t){e({type:q.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,o=r.views.editOrgView.viewModel,s=o.organization,c=o.editedOrganization,l=r.app.config,u=new Ne({token:a,username:i,groupsServiceURL:l.services.Groups.url});if(c){var E={name:c.name.value,logoUrl:c.logoUrl.value,description:c.description.value,isPrivate:c.isPrivate.value,homeUrl:c.homeUrl.value,researchInterests:c.researchInterests.value};u.updateOrg(s.id,E).then(function(){e({type:q.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",c,t),e(yn({code:"invalid",message:t.message}))})}else e(yn({code:"app",message:"The new organization data does not yet exist"}))}}function Un(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState.type===s.OK&&n.logoUrl.validationState.type===s.OK&&n.homeUrl.validationState.type===s.OK&&n.researchInterests.validationState.type===s.OK&&n.description.validationState.type===s.OK?e({type:q.EDIT_ORG_EVALUATE_OK}):e(bn())}}function kn(e){return function(t){var r=Oe.validateOrgName(e),n=Object(tt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:q.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(Un())}}function Mn(e){return function(t){var r=Oe.validateOrgLogoUrl(e),n=Object(tt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(a,i)):t(function(e){return{type:q.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:e}}(a)),t(Un())}}function Vn(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,o=a.username,c=n.app.config,l=(new Ne({token:i,username:o,groupsServiceURL:c.services.Groups.url}),Oe.validateOrgDescription(e)),u=Object(tt.a)(l,2),E=u[0],d=u[1];d.type!==s.OK?t(function(e,t){return{type:q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(E,d)):t(function(e){return{type:q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(E)),t(Un())}}r(289);var jn,zn=r(155),Ln=r.n(zn);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(jn||(jn={}));var Gn=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:jn.NONE},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onShowInfo",value:function(){At.a.info({title:"Organization Editor Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the organizations editor..."))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){At.a.confirm({title:"Leave the editor?",content:A.createElement("div",null,A.createElement("p",null,"You have made changes on this edit form."),A.createElement("p",null,"If you leave the editor without saving, any ",A.createElement("i",null,"changes they will be lost"),"."),A.createElement("p",null,A.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){At.a.confirm({title:"Leave the editor?",content:A.createElement("div",null,A.createElement("p",null,"You have made changes on this edit form."),A.createElement("p",null,"If you leave the editor without saving, any ",A.createElement("i",null,"changes they will be lost"),"."),A.createElement("p",null,A.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===o.EDITED&&(this.props.saveState===c.NEW||this.props.saveState===c.READY)}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===i.DIRTY?A.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderForm",value:function(){return A.createElement("form",{id:"editOrganizationForm",className:"editor",onSubmit:this.onSubmit.bind(this)},A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},A.createElement(Qe.a,{title:"This is the name for your organization as you want KBase users to see it"},"name")),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.editedOrganization.name.value||"",className:this.calcFieldClass(this.props.editedOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.name))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"id"),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.editedOrganization.id.value||"",className:this.calcFieldClass(this.props.editedOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.id))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"logo url"),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.editedOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.logoUrl))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"home page url"),A.createElement("div",{className:"col2"},A.createElement(nr.a,{value:this.props.editedOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.homeUrl))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1 field-label"},"is private?"),A.createElement("div",{className:"col2"},A.createElement(ar.a,{checked:this.props.editedOrganization.isPrivate.value,className:this.calcFieldClass(this.props.editedOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.isPrivate))),A.createElement("div",{className:"row",style:{flex:"1 1 0px",height:"5em"}},A.createElement("div",{className:"col1 field-label"},"research interests"),A.createElement("div",{className:"col2"},A.createElement("textarea",{value:this.props.editedOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.editedOrganization.researchInterests),onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.researchInterests))),A.createElement("div",{className:"row",style:{flex:"1 1 0px",minHeight:"30em",maxHeight:"60em"}},A.createElement("div",{className:"col1 field-label"},"description"),A.createElement("div",{className:"col2"},A.createElement(Ln.a,{value:this.props.editedOrganization.description.value||"",className:this.calcFieldClass(this.props.editedOrganization.description),onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.description))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col1"}),A.createElement("div",{className:"col2"})))}},{key:"renderIsPrivate",value:function(e){return e?A.createElement("span",null,A.createElement(He.a,{type:"lock"})," ","Private"):A.createElement("span",null,A.createElement(He.a,{type:"global"})," ","Public")}},{key:"renderLogoPreview",value:function(){return this.props.editedOrganization.logoUrl.value?A.createElement("img",{src:this.props.editedOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultLogo",value:function(){if(!this.props.editedOrganization.name.value||!this.props.editedOrganization.id.value)return A.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.editedOrganization.name.value,0).toUpperCase(),t=qe()(this.props.editedOrganization.id.value).substr(0,6);return A.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},A.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderPreview",value:function(){return A.createElement("form",{className:"preview"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"name"},this.props.editedOrganization.name.value||""))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"id"},A.createElement("span",{style:{color:"silver"}},this.origin,"/orgs/viewOrganization/"),this.props.editedOrganization.id.value||A.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"logoUrl"},this.renderLogoPreview()))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"homeUrl",style:{height:"1em"}},this.props.editedOrganization.homeUrl.value||""))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"isPrivate"},this.renderIsPrivate(this.props.editedOrganization.isPrivate.value)))),A.createElement("div",{className:"row"},A.createElement("div",{className:"col2"},A.createElement("div",{className:"researchInterests",style:{height:"5em"}},this.props.editedOrganization.researchInterests.value||""))),A.createElement("div",{className:"row",style:{flex:"1 1 0px"}},A.createElement("div",{className:"col2"},A.createElement("div",{className:"description",dangerouslySetInnerHTML:{__html:rr.Marked.parse(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return A.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderOrgName",value:function(e){if(0===e.length)return A.createElement("span",{style:{fontStyle:"italic"}},"org name missing");var t=e;return e.length>=25&&(t=e.slice(0,25)+"\u2026"),A.createElement(xe.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},t))}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,this.renderOrgName(this.props.editedOrganization.name.value),A.createElement(He.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(He.a,{type:"tool"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Edit Organization"))),t=A.createElement(A.Fragment,null,A.createElement(Nt.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),A.createElement(Nt.a,{icon:"undo",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Cancel"),A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading Org Editor...");return A.createElement(Ct,{breadcrumbs:e})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(Wr,{organizationId:this.props.organization.id})}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(tr.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):this.props.editedOrganization?A.createElement("div",{className:"EditOrganization"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"mainRow"},A.createElement("div",{className:"editorColumn"},A.createElement("h3",null,"Editor"),this.renderForm()),A.createElement("div",{className:"previewColumn"},A.createElement("h3",null,"Preview"),this.renderPreview()))):A.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader())}}]),t}(A.Component);var xn=Object(z.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(Dn())},onUpdateName:function(t){e(kn(t))},onUpdateLogoUrl:function(t){e(Mn(t))},onUpdateDescription:function(t){e(Vn(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Un())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=Oe.validateOrgHomeUrl(e),n=Object(tt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.EDIT_ORG_UPDATE_HOME_URL_ERROR,homeUrl:a,error:i}):t({type:q.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a}),t(Un())}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=Oe.validateOrgHomeUrl(e),n=Object(tt.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a}),t(Un())}}(t))}}})(Gn),Pn=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Fetching your organizations and other stuff...")}},{key:"renderError",value:function(){if(this.props.view.error)return A.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.renderError();case O.SUCCESS:return A.createElement(xn,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Bn=Object(z.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(Cn(t))},onUnload:function(){e({type:q.EDIT_ORG_UNLOAD})}}})(Pn),qn=(r(299),function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).tokenRef=void 0,r.tokenRef=A.createRef(),r.props.checkAuth(),r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return A.createElement("div",{className:"Auth-form"},"Token: ",A.createElement("input",{ref:this.tokenRef,style:{width:"30em"}}),A.createElement(Nt.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return A.createElement("div",{className:"Auth-toolbar"},"Logged in as ",A.createElement("b",null,A.createElement("span",null,this.props.authorization.authorization.realname)," (",A.createElement("span",null,this.props.authorization.authorization.username)),")"," ",A.createElement(Nt.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return A.createElement("div",null);case m.AUTHORIZED:return A.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case m.UNAUTHORIZED:return A.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},A.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case m.ERROR:return A.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},A.createElement("p",null,"Error"),this.props.authorization.message);default:return A.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return A.createElement("div",null);case m.AUTHORIZED:return A.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case m.UNAUTHORIZED:return A.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},A.createElement("p",null,"Not authorized!"));case m.ERROR:return A.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},A.createElement("p",null,"Error: ??"));default:return A.createElement("div",null)}}},{key:"render",value:function(){return A.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(A.Component)),Wn=r(127),Hn="",Qn="api/V2/token",Fn="api/V2/me",Jn=function(){function e(t){var r=t.url;Object(b.a)(this,e),this.url=void 0,this.url=r}return Object(y.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([Hn]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([Qn]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([Fn]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function Yn(e){return{type:q.AUTH_CHECK_ERROR,error:e}}function Kn(e,t,r,n){return{type:q.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function Xn(){return{type:q.AUTH_UNAUTHORIZED}}function Zn(){return function(e,t){e({type:q.AUTH_CHECK_START});var r=t().app.config.services.Auth.url,n=Wn.get("kbase_session");if(n){var a=new Jn({url:r});Promise.all([a.getTokenInfo(n),a.getMe(n)]).then(function(t){var r=Object(tt.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(Kn(n,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(Yn({code:"error",message:t.message}))})}else e(Xn())}}var $n=Object(z.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(Zn())},onRemoveAuthorization:function(){e(function(e,t){Wn.remove("kbase_session"),e(Xn())})},onAddAuthorization:function(t){e(function(e){return function(t,r){var n=r().app.config.services.Auth.url;Wn.set("kbase_session",e);var a=new Jn({url:n});Promise.all([a.getTokenInfo(e),a.getMe(e)]).then(function(r){var n=Object(tt.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(Kn(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(Yn({code:"error",message:e.message}))})}}(t))}}})(qn),ea=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(b.a)(this,e),this.name=void 0,this.onSuccess=void 0,this.onError=void 0,this.name=r,this.onSuccess=n,this.onError=a},ta=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).started=void 0,r.timeout=void 0,r.started=new Date,r.timeout=e.timeout||5e3,r}return Object(U.a)(t,e),t}(ea),ra=function(){function e(t){var r=t.name,n=t.payload,a=t.channel;Object(b.a)(this,e),this.name=void 0,this.payload=void 0,this.id=void 0,this.created=void 0,this.channel=void 0,this.envelope=void 0,this.name=r,this.payload=n,this.id=Zr()(),this.created=new Date,this.channel=a,this.envelope=null}return Object(y.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channel:this.channel},name:this.name,payload:this.payload}}}]),e}(),na=function(){function e(t){if(Object(b.a)(this,e),this.window=void 0,this.host=void 0,this.id=void 0,this.awaitingResponse=void 0,this.waitingListeners=void 0,this.listeners=void 0,this.lastId=void 0,this.sentCount=void 0,this.receivedCount=void 0,this.unwelcomeReceivedCount=void 0,this.unwelcomeReceivedCountThreshhold=void 0,this.unwelcomeReceiptWarning=void 0,this.unwelcomeReceiptWarningCount=void 0,this.currentListener=void 0,this.window=t.window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||Zr()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(y.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",e));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new ea({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new ra({name:e,payload:t,channel:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new ra({name:e,payload:t,channel:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,o=function(){var r=i.value,n=(c=Object(tt.a)(r,2))[0];0===c[1].filter(function(e){if(e instanceof ta){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},s=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c;o()}}catch(l){n=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new ta({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new ta({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),aa=function(){function e(){Object(b.a)(this,e),this.params=void 0,this.channel=void 0,this.params=null,this.channel=new na({window:window,host:document.location.origin})}return Object(y.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:Zr()(),params:{groupsServiceURL:"/services/groups",userProfileServiceURL:"/services/user_profile/rpc",workspaceServiceURL:"/services/ws",serviceWizardURL:"/services/service_wizard",feedsServiceURL:"/services/feeds",authServiceURL:"/services/auth",originalPath:"",view:null,viewParams:null},parentHost:document.location.origin}}}]),e}(),ia=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}}]),e}();function oa(e){return{type:q.APP_SUCCESS,config:e}}r(301);var sa=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).props.onAppStart(),r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return this.props.status===v.NONE?A.createElement("div",{className:"KBaseIntegration"},"Loading..."):A.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(A.Component);var ca=Object(z.b)(function(e,t){return{status:e.app.status}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new ia).getParamsFromIFrame();if(r)switch(e(oa({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL},Auth:{url:r.params.authServiceURL}}})),r.params.view){case"org":var n="/viewOrganization/"+r.params.viewParams.id;window.history.pushState(null,"test",n);default:console.log("hmm, defaulting to dashboard??"),window.history.pushState(null,"dashboard","/dashboard")}else e(oa({baseUrl:"",services:{Groups:{url:(r=(new aa).getParamsFromIFrame()).params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Feeds:{url:r.params.feedsServiceURL},Auth:{url:r.params.authServiceURL}}}))})}}})(sa);function la(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p,v;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),u=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,Promise.all([l.getOrg(e),u.getPendingOrganizationRequestsForOrg(e),u.getOrganizationInvitationsForOrg(e)]);case 6:E=t.sent,d=Object(tt.a)(E,3),m=d[0],p=d[1],v=d[2],r((O=m,R=p,g=v,{type:q.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS,organization:O,requests:R,invitations:g})),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),r((h={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_LOAD_ERROR,error:h}));case 17:case"end":return t.stop()}var h,O,R,g},t,this,[[3,14]])}));return function(e,r){return t.apply(this,arguments)}}()}r(303);var ua=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("/#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){At.a.info({title:"Manage Requests Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(xe.a,{to:"/viewOrganization/".concat(this.props.viewModel.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.viewModel.organization.name))),A.createElement(He.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(He.a,{type:"tool"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Managing Org Requests"))),t=A.createElement(A.Fragment,null,A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderLoadingHeader",value:function(){var e=A.createElement("span",null,"Loading Org Editor...");return A.createElement(Ct,{breadcrumbs:e})}},{key:"niceElapsed",value:function(e){var t,r,n,a=new Date,i=Math.round((a.getTime()-e.getTime())/1e3),o=Math.abs(i);if(o<7776e3){if(0===o)return"now";o<60?(t=i,r=o,n="second"):o<3600?(t=Math.round(i/60),r=Math.round(o/60),n="minute"):o<86400?(t=Math.round(i/3600),r=Math.round(o/3600),n="hour"):(t=Math.round(i/86400),r=Math.round(o/86400),n="day"),r>1&&(n+="s");var s=null,c=null;return t<0?s="in":t>0&&(c="ago"),(s?s+" ":"")+r+" "+n+(c?" "+c:"")}return a.getFullYear()===a.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=A.createElement("span",null,A.createElement(He.a,{type:"user"}),A.createElement(He.a,{type:"arrow-right"}),A.createElement(He.a,{type:"team"})," ","Request to Join Group"),n=[A.createElement(Nt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),A.createElement(Nt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return A.createElement(Dr.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"from"),A.createElement("td",{className:"requester"},A.createElement(hn,{userId:e.requester,avatarSize:50}))),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=A.createElement("span",null,A.createElement(He.a,{type:"team"}),A.createElement(He.a,{type:"mail"}),A.createElement(He.a,{type:"arrow-right"}),A.createElement(He.a,{type:"user"})," ","Invitation to Join Group"),n=[A.createElement(Nt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e.id)}},"Cancel")];return A.createElement(Dr.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"invitation to"),A.createElement("td",{className:"requester"},A.createElement(hn,{userId:e.user,avatarSize:30}))),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case ve.NONE:return"None";case ve.VIEW:return"View Only";case ve.EDIT:return"Edit";case ve.ADMIN:return"Admin";case ve.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=A.createElement("span",null,A.createElement(He.a,{type:"file"}),A.createElement(He.a,{type:"arrow-right"}),A.createElement(He.a,{type:"team"})," ","Request to Add Narrative"),a=[A.createElement(Nt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e.id)}},"Approve"),A.createElement(Nt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e.id)}},"Deny")];return t=A.createElement(dn,{workspaceId:parseInt(e.narrativeId,10)}),A.createElement(Dr.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"from"),A.createElement("td",{className:"requester"},A.createElement(hn,{userId:e.requester,avatarSize:30}))),A.createElement("tr",null,A.createElement("th",null,"narrative"),A.createElement("td",{className:"narrative"},t)),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=A.createElement("span",null,A.createElement(He.a,{type:"appstore"}),A.createElement(He.a,{type:"arrow-right"}),A.createElement(He.a,{type:"team"})," ","Request to Add App"),n=[A.createElement(Nt.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e.id)}},"Approve"),A.createElement(Nt.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e.id)}},"Deny")];return A.createElement(Dr.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},A.createElement("table",{className:"pendingRequestsTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,"from"),A.createElement("td",{className:"requester"},A.createElement(hn,{userId:e.requester,avatarSize:50}))),A.createElement("tr",null,A.createElement("th",null,"app"),A.createElement("td",{className:"requester"},e.appId)),A.createElement("tr",null,A.createElement("th",null,"sent"),A.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),A.createElement("tr",null,A.createElement("th",null,"expires"),A.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",this.niceElapsed(e.expireAt),")")))))}},{key:"renderRequest",value:function(e){switch(e.type){case u.REQUEST:switch(e.resourceType){case E.USER:return this.renderRequestJoinRequest(e);case E.WORKSPACE:return this.renderRequestNarrativeRequest(e);case E.APP:return this.renderRequestAppRequest(e);default:throw new Error("Unsupported resource type: "+e.resourceType)}case u.INVITATION:switch(e.resourceType){case E.USER:return this.renderRequestJoinInvitation(e);case E.WORKSPACE:throw new Error("Workspace invitations are not supported");case E.APP:throw new Error("App invitations are not supported");default:throw new Error("Unsupported resource type: "+e.resourceType)}}}},{key:"renderRequests",value:function(){var e=this,t=this.props.viewModel.requests;return 0===t.length?A.createElement(Pe.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending requests for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"renderInvitations",value:function(){var e=this,t=this.props.viewModel.invitations;return 0===t.length?A.createElement(Pe.a,{type:"info",showIcon:!0,style:{minWidth:"5em",maxWidth:"20em",margin:"0 auto"},message:"No pending invitations for this organization"}):t.map(function(t){return e.renderRequest(t)})}},{key:"render",value:function(){if(this.state.cancelToBrowser)return A.createElement(V.a,{push:!0,to:"/organizations"});if(this.state.cancelToViewer)return A.createElement(V.a,{push:!0,to:"/viewOrganization/"+this.props.viewModel.organization.id});var e=this.props.viewModel.invitations.length,t=this.props.viewModel.requests.length;return A.createElement("div",{className:"ManageGroupRequests"},this.renderHeader(),A.createElement(Wr,{organizationId:this.props.viewModel.organization.id}),A.createElement("div",{className:"row"},A.createElement("div",{className:"pendingCol"},A.createElement("h2",null,"Requests (",t,")"),A.createElement("div",{className:"pendingRequests"},this.renderRequests())),A.createElement("div",{className:"historyCol"},A.createElement("h2",null,"Invitations (",e,")"),this.renderInvitations())))}}]),t}(A.Component);var Ea=Object(z.b)(function(e,t){var r=e.views.manageOrganizationRequestsView;if(!r.viewModel)throw new Error("view state not loaded!");return{viewModel:r.viewModel}},function(e){return{onAcceptJoinRequest:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.views.manageOrganizationRequestsView,l=a.app.config,u=new he({token:o,username:s,groupsServiceURL:l.services.Groups.url}),c){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,t.next=7,u.acceptRequest(e);case 7:E=t.sent,r((m=E,{type:q.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS,request:m})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR,error:d}));case 14:case"end":return t.stop()}var d,m},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onDenyJoinRequest:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.views.manageOrganizationRequestsView,l=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return u=new he({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=4,t.next=7,u.denyRequest(e);case 7:E=t.sent,r((m=E,{type:q.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS,request:m})),c.viewModel&&r(la(c.viewModel.organization.id)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),r((d={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR,error:d}));case 15:case"end":return t.stop()}var d,m},t,this,[[4,12]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onCancelJoinInvitation:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.views.manageOrganizationRequestsView,l=a.app.config,c){t.next=3;break}return t.abrupt("return");case 3:return u=new he({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=4,t.next=7,u.cancelRequest(e);case 7:t.sent,c.viewModel&&r(la(c.viewModel.organization.id)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),r((E={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR,error:E}));case 14:case"end":return t.stop()}var E},t,this,[[4,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.grantViewAccess(e);case 6:u=t.sent,console.log("view access granted",u),r((d=u,{type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS,request:d})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR,error:E}));case 14:case"end":return t.stop()}var E,d},t,this,[[3,11]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(ua),da=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.SUCCESS:return A.createElement(Ea,null)}}},{key:"componentDidMount",value:function(){switch(this.props.loadingState){case O.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var ma=Object(z.b)(function(e,t){return{loadingState:e.views.manageOrganizationRequestsView.loadingState}},function(e){return{onLoad:function(t){e(la(t))},onUnload:function(){e({type:q.ADMIN_MANAGE_REQUESTS_UNLOAD})}}})(da);function pa(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.VIEW_MEMBERS_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new lr({token:o,username:s,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),t.prev=3,t.next=6,l.getOrganizationForUser(e);case 6:u=t.sent,E=u.organization,d=u.relation,r((p=E,v=d,{type:q.VIEW_MEMBERS_LOAD_SUCCESS,organization:p,relation:v})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),r((m={code:t.t0.name,message:t.t0.message},{type:q.VIEW_MEMBERS_LOAD_ERROR,error:m}));case 15:case"end":return t.stop()}var m,p,v},t,this,[[3,12]])}));return function(e,r){return t.apply(this,arguments)}}()}function va(e){return function(t,r){t({type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Ne({token:i,username:o,groupsServiceURL:s.services.Groups.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function ha(e){return function(t,r){t({type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Ne({token:i,username:o,groupsServiceURL:s.services.Groups.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function Oa(e){return function(t,r){t({type:q.VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=n.views.viewMembersView.viewModel;if(null===c)throw new Error("view is not populated");new Ne({token:i,username:o,groupsServiceURL:s.services.Groups.url}).removeMember(c.organization.id,e).then(function(){t({type:q.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS}),t(pa(c.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:q.VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(146);var Ra=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={over:!1},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderPromoteButton",value:function(){var e=this;switch(this.props.member.type){case me.MEMBER:return A.createElement(Nt.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onPromoteMemberToAdmin(e.props.member.username)}},A.createElement(He.a,{type:"unlock"}),"Promote to Admin");case me.ADMIN:return A.createElement(Nt.a,{style:{width:"100%"},disabled:!this.state.over,onClick:function(){e.props.onDemoteAdminToMember(e.props.member.username)}},A.createElement(He.a,{type:"user"}),"Demote to Member");case me.OWNER:return}}},{key:"renderMemberButtons",value:function(e){var t=this;if(this.props.relation.type===pe.OWNER||this.props.relation.type===pe.ADMIN)return A.createElement("div",null,A.createElement("div",null,A.createElement(Nt.a,{type:"danger",disabled:!this.state.over,style:{width:"100%"},onClick:function(){t.props.onRemoveMember(e.username)}},A.createElement(He.a,{type:"delete"}),"Remove from Org")),A.createElement("div",null,this.renderPromoteButton()))}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.props.onRemoveMember(t.username)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=A.createElement(yt.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},A.createElement(yt.a.Item,{key:"promoteToAdmin"},A.createElement(He.a,{type:"unlock"}),"Promote to Admin"),A.createElement(yt.a.Item,{key:"removeMember"},A.createElement(He.a,{type:"delete"}),"Remove Member"));return A.createElement("div",null,A.createElement(Ur.a,{overlay:r,trigger:["click"]},A.createElement(Nt.a,{icon:"ellipsis"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=A.createElement(yt.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},A.createElement(yt.a.Item,{key:"demoteToMember"},A.createElement(He.a,{type:"user"}),"Demote to Member"));return A.createElement("div",null,A.createElement(Ur.a,{overlay:r,trigger:["click"]},A.createElement(Nt.a,{icon:"ellipsis"})))}},{key:"renderOwnerMenu",value:function(e){}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===pe.OWNER||this.props.relation.type===pe.ADMIN)switch(this.props.member.type){case me.OWNER:return this.renderOwnerMenu(e);case me.ADMIN:return this.renderAdminMenu(e);case me.MEMBER:return this.renderMemberMenu(e)}}},{key:"onMouseOver",value:function(){this.setState({over:!0})}},{key:"onMouseOut",value:function(){this.setState({over:!1})}},{key:"render",value:function(){return A.createElement("div",{key:this.props.member.username,className:"memberRow",onMouseEnter:this.onMouseOver.bind(this),onMouseLeave:this.onMouseOut.bind(this)},A.createElement("div",{style:{flex:"1 1 0px"}},A.createElement(zr,{member:this.props.member,avatarSize:50,key:this.props.member.username})),A.createElement("div",{style:{flex:"0 0 10em",textAlign:"right"}},this.renderMemberOptions(this.props.member)))}}]),t}(A.Component),ga=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onPromoteMemberToAdmin",value:function(e){this.props.onPromoteMemberToAdmin(e)}},{key:"onDemoteAdminToMember",value:function(e){this.props.onDemoteAdminToMember(e)}},{key:"onShowInfo",value:function(){At.a.info({title:"View Members Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the view members tool..."))})}},{key:"isMember",value:function(){return!!this.props.organization&&(this.props.relation.type===pe.OWNER||this.props.relation.type===pe.ADMIN||this.props.relation.type===pe.MEMBER)}},{key:"isAdmin",value:function(){return!!this.props.organization&&(this.props.relation.type===pe.OWNER||this.props.relation.type===pe.ADMIN)}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(xe.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(He.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(He.a,{type:"team"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Viewing Org Members"))),t=A.createElement(A.Fragment,null,A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderMembersToolbar",value:function(){switch(this.props.relation.type){case pe.NONE:return A.createElement("div",{className:"toolbar"},A.createElement(Nt.a,null,A.createElement(He.a,{type:"plus"}),"Join"));case pe.MEMBER:return A.createElement("div",{className:"toolbar"});case pe.ADMIN:case pe.OWNER:return A.createElement("div",{className:"toolbar"},A.createElement(xe.a,{to:"/inviteUser/"+this.props.organization.id},A.createElement(Nt.a,null,A.createElement(He.a,{type:"mail"})," Invite a User")))}}},{key:"renderMembers",value:function(){var e,t=this;return this.isMember()?(e=0===this.props.organization.members.length?A.createElement("p",{className:"message"},"This organization has no members"):this.props.organization.members.map(function(e){return A.createElement("div",{key:e.username,className:"simpleCard"},A.createElement(Ra,{member:e,relation:t.props.relation,organization:t.props.organization,onPromoteMemberToAdmin:t.props.onPromoteMemberToAdmin,onDemoteAdminToMember:t.props.onDemoteAdminToMember,onRemoveMember:t.props.onRemoveMember}))}),A.createElement("div",{className:"table infoTable"},A.createElement("div",{className:"row"},A.createElement("div",{className:"col0",style:{display:"flex",flexDirection:"column",overflowY:"auto"}},e)))):A.createElement("p",{className:"message"},"Sorry, organization membership restricted to members only")}},{key:"renderAdminsToolbar",value:function(){return A.createElement("div",{className:"toolbar"})}},{key:"renderOrganizationHeader",value:function(){return A.createElement(Wr,{organizationId:this.props.organization.id})}},{key:"componentWillUnmount",value:function(){this.props.onViewMembersUnload()}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(V.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(V.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):A.createElement("div",{className:"ViewMembers"},this.renderHeader(),this.renderOrganizationHeader(),A.createElement("div",{className:"body"},A.createElement("div",{className:"membersCol"},A.createElement("h2",null,"Members"),this.renderMembersToolbar(),this.renderMembers()),A.createElement("div",{className:"otherCol"},A.createElement("h2",null,"Pending Members"),this.renderAdminsToolbar(),A.createElement("p",null,"This space to provide a list of user requests and invitations. This will allow this view to provide all user management tools in one place."),A.createElement("p",null,"In progress... currently renders the requests but does not provide actions (buttons)."))))}}]),t}(A.Component);var wa=Object(z.b)(function(e,t){if(!e.views.viewMembersView||null===e.views.viewMembersView.viewModel)throw new Error("Runtime Error - view members view is not defined!");var r=e.views.viewMembersView.viewModel;return{organization:r.organization,relation:r.relation}},function(e){return{onViewMembersUnload:function(){e({type:q.VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(va(t))},onDemoteAdminToMember:function(t){e(ha(t))},onRemoveMember:function(t){e(Oa(t))}}})(ga),fa=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading...")}},{key:"render",value:function(){switch(this.props.state){case O.NONE:case O.LOADING:return this.renderLoading();case O.SUCCESS:return A.createElement(wa,null)}}},{key:"componentDidMount",value:function(){switch(this.props.state){case O.NONE:this.props.onViewMembersLoad(this.props.organizationId)}}}]),t}(A.Component);var _a=Object(z.b)(function(e,t){return{state:e.views.viewMembersView.loadingState}},function(e){return{onViewMembersLoad:function(t){e(pa(t))}}})(fa);function Sa(e){return{type:q.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Aa(e){return{type:q.INVITE_USER_SELECT_USER_ERROR,error:e}}function Na(e){return function(t,r){t({type:q.INVITE_USER_SELECT_USER_START});var n=r(),a=n.views.inviteUserView.viewModel,i=n.auth.authorization,o=i.token,s=(i.username,n.app.config);a?new et({token:o,userProfileServiceURL:s.services.UserProfile.url}).getUser(e).then(function(e){var r=function(e,t){if(e.username===t.owner.username)return pe.OWNER;var r=t.members.find(function(t){return t.username===e.username});if(r)switch(r.type){case l.ADMIN:return pe.ADMIN;case l.OWNER:return pe.OWNER;case l.MEMBER:return pe.MEMBER}return pe.VIEW}(e,a.organization);t(function(e,t){return{type:q.INVITE_USER_SELECT_USER_SUCCESS,user:e,relation:t}}(e,r))}).catch(function(e){t(Aa({code:e.name,message:e.message}))}):t(Aa({code:"invalid state",message:"select user invalid state -- no view value"}))}}function Ta(){return function(e,t){e({type:q.INVITE_USER_SEND_INVITATION_START});var r=t(),n=r.auth.authorization,a=n.token,i=n.username,o=r.app.config,s=r.views.inviteUserView,c=s.loadingState,l=s.viewModel;s.error;if(c===O.SUCCESS&&null!==l){var u=l,E=u.selectedUser,d=u.organization.id;if(E)new he({token:a,username:i,groupsServiceURL:o.services.Groups.url}).inviteUserToJoinOrg(d,E.user.username).then(function(t){e({type:q.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){var r;e((r={code:t.name,message:t.message},{type:q.INVITE_USER_SEND_INVITATION_ERROR,error:r}))})}}}r(306),r(308);var Ia=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return A.createElement("div",{className:"User"},A.createElement("div",{className:"avatarCol"},A.createElement(Ye,{user:this.props.user,size:this.props.avatarSize||30})),A.createElement("div",{className:"infoCol"},A.createElement("div",{className:"name"},A.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),A.createElement("div",{className:"organization"},this.props.user.organization||A.createElement("i",null,"no organization in user profile")),A.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||A.createElement("i",null,"no location information in user profile"))))}}]),t}(A.Component),ba=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).lastSearchAt=void 0,r.searchInput=void 0,r.searchButton=void 0,r.lastSearchAt=null,r.searchInput=A.createRef(),r.searchButton=A.createRef(),r.state={cancelToViewMembers:!1,cancelToBrowser:!1,cancelToViewer:!1,autocompleteMessage:""},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onClickCancelToViewMembers",value:function(){this.setState({cancelToViewMembers:!0})}},{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"onShowInfo",value:function(){At.a.info({title:"Invite User Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the invite user tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(xe.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(He.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(He.a,{type:"tool"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Invite a User to Join Org"))),t=A.createElement(A.Fragment,null,A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return A.createElement(Pe.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?A.createElement(Pe.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===pe.NONE?A.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},A.createElement("div",{className:"name "},t.realname," (",t.username,")")):A.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},A.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return A.createElement("div",{className:"orgInfo"},A.createElement("div",{className:"name"},A.createElement("span",{className:"field-label"},"name"),A.createElement("span",null,this.props.organization.name)),A.createElement("div",{className:"description"},A.createElement("span",{className:"field-label"},"description"),A.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===pe.VIEW?e=A.createElement(Nt.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=A.createElement(Nt.a,{disabled:!0,type:"primary"},"Send Invitation"),t=A.createElement("div",null,"User may not be invited because:",A.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=A.createElement(Pe.a,{type:"warning",message:t,showIcon:!0})):(e=A.createElement(Nt.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),A.createElement("div",{className:"invitationForm"},A.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),A.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case g.NONE:return A.createElement("div",null,"NONE");case g.EDITING:return A.createElement("div",null,"EDITING");case g.SENDABLE:return A.createElement("div",null,"SENDABLE");case g.SENDING:return A.createElement("div",null,"SENDING");case g.SUCCESS:return A.createElement("div",null,"SENT SUCCESSFULLY");case g.ERROR:return A.createElement("div",null,"ERROR SENDING");default:return A.createElement("div",null,"Bad State")}}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(Wr,{organizationId:this.props.organization.id})}},{key:"renderRelation",value:function(e){switch(e){case pe.NONE:return A.createElement("span",null,A.createElement(He.a,{type:"stop"}),"None");case pe.VIEW:return A.createElement("span",null,A.createElement(He.a,{type:"stop"})," Not a member");case pe.MEMBER_REQUEST_PENDING:return A.createElement("span",null,A.createElement(He.a,{type:"user",style:{color:"orange"}})," User's membership ",A.createElement("b",null,"request")," is pending");case pe.MEMBER_INVITATION_PENDING:return A.createElement("span",null,A.createElement(He.a,{type:"user",style:{color:"blue"}})," User has been ",A.createElement("b",null,"invited")," to join");case pe.MEMBER:return A.createElement("span",null,A.createElement(He.a,{type:"user"})," User is a ",A.createElement("b",null,"member")," of this organization");case pe.ADMIN:return A.createElement("span",null,A.createElement(He.a,{type:"unlock"}),"User is an ",A.createElement("b",null,"admin")," of this organization");case pe.OWNER:return A.createElement("span",null,A.createElement(He.a,{type:"crown"})," User is the ",A.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?A.createElement("div",{className:"selectedUser"},A.createElement("p",{className:"noSelection"},"No user yet selected")):A.createElement("div",{className:"selectedUser"},A.createElement(Ia,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return A.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return A.createElement(He.a,{type:"search"})}},{key:"render",value:function(){return this.state.cancelToViewMembers?A.createElement(tr.a,{push:!0,to:"/viewMembers/"+this.props.organization.id}):this.state.cancelToBrowser?A.createElement(tr.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):A.createElement("div",{className:"InviteUser scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"row scrollable-flex-column"},A.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},A.createElement("h3",null,"Select User to Invite"),A.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},A.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),A.createElement(Nt.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),A.createElement("div",{className:"usersTable"},this.renderUsers())),A.createElement("div",{className:"col1 lastCol"},A.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(A.Component);ba.searchDebounce=200;var ya=ba;var Ca=Object(z.b)(function(e,t){if(!e.views.inviteUserView||null===e.views.inviteUserView.viewModel)throw new Error("Runtime Error - invite members view is not defined!");var r=e.views.inviteUserView.viewModel;return{organization:r.organization,users:r.users,selectedUser:r.selectedUser,editState:r.editState}},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,u,E,d,m,p,v,h,O,R;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:q.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(Sa(null)),t.abrupt("return");case 4:if(a=n(),i=a.views.inviteUserView.viewModel,o=a.auth.authorization,s=o.token,o.username,c=a.app.config,null!==i){t.next=7;break}return t.abrupt("return");case 7:return u=i.organization,E=new et({token:s,userProfileServiceURL:c.services.UserProfile.url}),d=u.owner.username,m=[],p=[],v=[],h=[],u.members.forEach(function(e){switch(e.type){case l.MEMBER:p.push(e.username);case l.ADMIN:m.push(e.username)}}),t.prev=16,t.next=19,E.searchUsers(e);case 19:O=t.sent,R=O.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?pe.OWNER:m.indexOf(t)>=0?pe.ADMIN:v.indexOf(t)>=0?pe.MEMBER_INVITATION_PENDING:h.indexOf(t)>=0?pe.MEMBER_REQUEST_PENDING:p.indexOf(t)>=0?pe.MEMBER:pe.NONE}}),r(Sa(R)),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(16),r((g={code:t.t0.name,message:t.t0.message},{type:q.INVITE_USER_SEARCH_USERS_ERROR,error:g}));case 27:case"end":return t.stop()}var g},t,this,[[16,24]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){e(Na(t))},onSendInvitation:function(){e(Ta())}}})(ya),Da=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading Users...")}},{key:"renderError",value:function(){return A.createElement("div",null,"Error!")}},{key:"render",value:function(){switch(this.props.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.renderError();case O.SUCCESS:return A.createElement(Ca,null)}}},{key:"componentDidMount",value:function(){switch(this.props.loadingState){case O.NONE:this.props.onInviteUserLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Ua=Object(z.b)(function(e,t){return{loadingState:e.views.inviteUserView.loadingState}},function(e){return{onInviteUserLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:u=t.sent,r((d=u,{type:q.INVITE_USER_LOAD_SUCCESS,organization:d,users:null})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((E={code:t.t0.name,message:t.t0.message},{type:q.INVITE_USER_LOAD_ERROR,error:E}));case 13:case"end":return t.stop()}var E,d},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.INVITE_USER_UNLOAD})}}})(Da);function ka(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,o=e.info;return{code:t,message:r,detail:n,id:Zr()(),at:new Date,history:a,trace:i,info:o}}function Ma(e){return{type:q.MANAGE_MEMBERSHIP_LOAD_ERROR,error:e}}r(310);var Va=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"doCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"doCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"doLeaveOrg",value:function(){this.props.onLeaveOrganization(this.props.organization.id)}},{key:"canSave",value:function(){return!1}},{key:"doShowInfo",value:function(){At.a.info({title:"Manage My Membership Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the view to help you manage your membership..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(xe.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(He.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(He.a,{type:"user"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Manage your membership"))),t=A.createElement(A.Fragment,null,A.createElement(Nt.a,{icon:"save",form:"editMembershipForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),A.createElement(Nt.a,{type:"danger",icon:"frown",onClick:this.doLeaveOrg.bind(this)},"Leave Organization..."),A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(Wr,{organizationId:this.props.organization.id})}},{key:"render",value:function(){return this.state.cancelToBrowser?A.createElement(tr.a,{push:!0,to:"/organizations"}):this.state.cancelToViewer?A.createElement(tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):A.createElement("div",{className:"ManageMembership"},this.renderHeader(),this.renderOrgHeader(),A.createElement("h3",null,"Edit Organization Profile"),A.createElement("div",{className:"body"},A.createElement("div",{className:"col1"},A.createElement("div",{className:"editorTable"},A.createElement("div",{className:"editorTable-row"},A.createElement("div",{className:"editorTable-labelCol"},A.createElement("span",{className:"field-label"},"title")),A.createElement("div",{className:"editorTable-controlCol"},A.createElement(nr.a,null))))),A.createElement("div",{className:"col2"},A.createElement("div",null,"org user profile here"))),A.createElement("h3",null,"User Profile"),A.createElement("p",null,"Your user profile is ..."))}}]),t}(A.Component);var ja=Object(z.b)(function(e,t){if(!e.views.manageMembershipView.viewModel)throw new Error("View model missing");return{username:e.auth.authorization.username,organization:e.views.manageMembershipView.viewModel.organization}},function(e){return{onLeaveOrganization:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r({type:q.MANAGE_MEMBERSHIP_LEAVE_ORG_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url});try{l.removeMember(e,s),r({type:q.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS})}catch(u){console.error("ERROR leaving org",u),r({type:q.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,error:{code:u.name,message:u.message}})}case 4:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Va),za=r(339),La=(r(312),function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderDetail",value:function(){return A.createElement("table",{className:"errorTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,A.createElement("span",{className:"field-label"},"generated at")),A.createElement("td",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.error.at))),A.createElement("tr",null,A.createElement("th",null,A.createElement("span",{className:"field-label"},"error id")),A.createElement("td",null,A.createElement("span",{style:{fontFamily:"monospace"}},this.props.error.id))),A.createElement("tr",null,A.createElement("th",null,A.createElement("span",{className:"field-label"},"explanation")),A.createElement("td",null,this.props.error.detail))))}},{key:"renderInfo",value:function(){return this.props.error.info?A.createElement("div",null,"additional info here ..."):A.createElement("div",{style:{textAlign:"left",fontStyle:"italic"}},"No additional information")}},{key:"render",value:function(){var e=A.createElement("div",null,A.createElement("p",null,this.props.error.message),A.createElement(za.a,{bordered:!1,style:{backgroundColor:"transparent"}},A.createElement(za.a.Panel,{header:"detail",key:"1",style:{backgroundColor:"transparent"}},this.renderDetail())),A.createElement(za.a,{bordered:!1,style:{backgroundColor:"transparent"}},A.createElement(za.a.Panel,{header:"additional info",key:"1",style:{backgroundColor:"transparent"}},this.renderInfo())));return A.createElement(Pe.a,{type:"error",showIcon:!0,message:"Error",className:"Error",description:e})}}]),t}(A.Component));var Ga=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading membership editor...")}},{key:"renderError",value:function(e){return A.createElement(La,{error:e})}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(function(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,o=e.info;return{code:t,message:r,detail:n,id:Zr()(),at:new Date,history:a,trace:i,info:o}}({code:"missing-error",message:"The error appears to be missing"}));default:return A.createElement(ja,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var xa,Pa=Object(z.b)(function(e,t){return{view:e.views.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,o,c,l,u,E,d,m,p;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.MANAGE_MEMBERSHIP_LOAD_START}),a=n(),o=a.auth.authorization,c=o.token,l=o.username,u=a.app.config,E=new Ne({token:c,username:l,groupsServiceURL:u.services.Groups.url}),t.prev=3,t.next=6,E.getOrg(e);case 6:if((d=t.sent).isMember){t.next=10;break}return r(Ma(ka({code:"notfound",message:'The user "'+l+'" is not a member of this org'}))),t.abrupt("return");case 10:if(m=d.members.find(function(e){return e.username===l})){t.next=14;break}return r(Ma(ka({code:"notfound",message:'The user "'+l+'" was not found in the members list'}))),t.abrupt("return");case 14:p={title:{value:m.title,remoteValue:m.title,syncState:i.NEW,validationState:{type:s.OK,validatedAt:new Date}}},r((v=d,h=p,{type:q.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:v,editableMemberProfile:h})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(3),console.error("Error :(",t.t0),r(Ma(ka({code:t.t0.name,message:t.t0.message})));case 22:case"end":return t.stop()}var v,h},t,this,[[3,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.MANAGE_MEMBERSHIP_UNLOAD})}}})(Ga);r(315);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(xa||(xa={}));var Ba=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={navigateTo:xa.NONE},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"doCancelToBrowser",value:function(){this.setState({navigateTo:xa.BROWSER})}},{key:"doCancelToViewer",value:function(){this.setState({navigateTo:xa.VIEWER})}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doShowInfo",value:function(){At.a.info({title:"Request to Add Narrative Help",width:"50em",content:A.createElement("div",null,A.createElement("p",null,"This is the view to help you request the addition of a narrative to this org..."))})}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgHeader",value:function(){if(this.props.organization)return A.createElement(Wr,{organizationId:this.props.organization.id})}},{key:"renderOrgName",value:function(e){return e.length<25?e:A.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,A.createElement(xe.a,{to:"/viewOrganization/".concat(this.props.organization.id)},A.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),A.createElement(He.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),A.createElement(He.a,{type:"plus"})," ",A.createElement("span",{style:{fontSize:"120%"}},"Add Narrative to Org"))),t=A.createElement(A.Fragment,null,A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.doShowInfo.bind(this)}));return A.createElement(Ct,{breadcrumbs:e,buttons:t})}},{key:"renderNarratives",value:function(){var e=this;return 0===this.props.narratives.length?A.createElement("div",{className:"message"},"You do not have any Narratives"):this.props.narratives.map(function(t,r){var n=["narrative"];return!(!e.props.selectedNarrative||t.workspaceId!==e.props.selectedNarrative.workspaceId)&&n.push("selected"),t.status===w.ASSOCIATED?(n.push("narrativeInOrg"),A.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},A.createElement("div",{className:"title"},t.title||"n/a"," (associated)"))):t.status===w.REQUESTED?(n.push("narrativeInOrg"),A.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},A.createElement("div",{className:"title"},t.title||"n/a"," (request pending)"))):(n.push("narrativeNotInOrg"),A.createElement("div",{className:n.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},A.createElement("div",{className:"title"},t.title||"n/a")))})}},{key:"onSearchSubmit",value:function(){console.log("searching...")}},{key:"renderSearchIcon",value:function(){return this.props.searching?A.createElement(He.a,{type:"loading"}):A.createElement(He.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return A.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSearchSubmit.bind(this)},A.createElement("input",{placeholder:"Search your Narratives",autoFocus:!0}),A.createElement(Nt.a,{className:"button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"onSortByChange",value:function(){}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return A.createElement("div",{className:"filterSortBar"},A.createElement("span",{className:"field-label"},"sort by"),A.createElement(Tt.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},A.createElement(Tt.a.Option,{value:"title",key:"title"},"Title"),A.createElement(Tt.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")),A.createElement(Tt.a,{onChange:this.onSortDirectionChange.bind(this),style:{width:"4em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortDirection},A.createElement(Tt.a.Option,{value:h.ASCENDING,key:"name"},A.createElement(He.a,{type:"sort-ascending"})),A.createElement(Tt.a.Option,{value:h.DESCENDING,key:"owner"},A.createElement(He.a,{type:"sort-descending"}))))}},{key:"renderNarrativeSelector",value:function(){return A.createElement("div",{className:"narrativeSelector scrollable-flex-column"},A.createElement("div",{style:{display:"flex",flexDirection:"row"}},A.createElement("div",{style:{flex:"0 0 10em"}},this.renderSearchBar()),A.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),A.createElement("div",{className:"narratives scrollable-flex-column"},A.createElement("div",{className:"narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===w.ASSOCIATED?A.createElement(Pe.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===w.REQUESTED?A.createElement(Pe.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===pe.ADMIN||this.props.relation.type===pe.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",A.createElement(Nt.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?A.createElement("div",{className:"selectedNarrative"},A.createElement("div",{className:"title"},this.props.selectedNarrative.title),A.createElement("div",null,A.createElement("i",null,"last modified")," ",Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.selectedNarrative.modifiedAt))):A.createElement(Pe.a,{type:"info",message:"Select a narrative on the left to show it here and be able to add it to this organization."})}},{key:"render",value:function(){switch(this.state.navigateTo){case xa.BROWSER:return A.createElement(tr.a,{push:!0,to:"/organizations"});case xa.VIEWER:return A.createElement(tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id});case xa.NONE:}return A.createElement("div",{className:"RequestNarrative scrollable-flex-column"},this.renderHeader(),this.renderOrgHeader(),A.createElement("div",{className:"body scrollable-flex-column"},A.createElement("div",{className:"selectNarrativeCol scrollable-flex-column"},A.createElement("h3",null,"Select a Narrative"),this.renderNarrativeSelector()),A.createElement("div",{className:"selectedNarrativeCol"},A.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),A.createElement("div",{className:"selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),A.createElement("div",{className:"footer"}))}}]),t}(A.Component);function qa(e){return function(t,r){t({type:q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}var Wa=Object(z.b)(function(e,t){if(null===e.views.requestNarrativeView.viewModel)throw new Error("view value is not defined!");var r=e.views.requestNarrativeView.viewModel;return{organization:r.organization,relation:r.relation,narratives:r.narratives,selectedNarrative:r.selectedNarrative,searching:!1,sortBy:"title",sortDirection:h.ASCENDING,filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(ie.a)(ae.a.mark(function r(n,a){var i,o,s,c,l,u,E;return ae.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:q.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),o=i.auth.authorization,s=o.token,c=o.username,l=i.app.config,u=new Ne({token:s,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=3,r.next=6,u.addOrRequestNarrativeToGroup(e,t.workspaceId);case 6:E=r.sent,n((m=E,{type:q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:m})),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n((d={code:r.t0.name,message:r.t0.message},{type:q.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 13:case"end":return r.stop()}var d,m},r,this,[[3,10]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(qa(t))}}})(Ba),Ha=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){return A.createElement("div",null,"Loading Your Narratives...")}},{key:"renderError",value:function(e){return A.createElement("div",null,"Error!",A.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return A.createElement(Wa,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var Qa=Object(z.b)(function(e,t){return{view:e.views.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d,m,p,v,h,O,R;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:q.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),u=new vt({token:o,username:s,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url}),E=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,Promise.all([l.getOrg(e),u.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,m=Object(tt.a)(d,4),p=m[0],v=m[1],h=m[2],O=m[3],R=Re(p,s,h,O),r((w=p,f=v,_=R,{type:q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:w,narratives:f,relation:_})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((g={code:t.t0.name,message:t.t0.message},{type:q.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:g}));case 22:case"end":return t.stop()}var g,w,f,_},t,this,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:q.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(Ha);r(317);var Fa,Ja=Object(z.b)(function(e){return{notifications:e.db.notifications.all}},function(e){return{onRead:function(t){e(yr(t))}}})(_n),Ya=A.createContext(null),Ka=Ya.Provider,Xa=Ya.Consumer;!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.NEW_ORG=2]="NEW_ORG"}(Fa||(Fa={}));var Za=function(e){function t(e){var r;return Object(b.a)(this,t),(r=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={navigateTo:Fa.NONE},r}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onNavigateToBrowser",value:function(){this.setState({navigateTo:Fa.BROWSER})}},{key:"onNavigateToNewOrg",value:function(){this.setState({navigateTo:Fa.NEW_ORG})}},{key:"onRefresh",value:function(){this.props.onRefresh()}},{key:"onShowInfo",value:function(){At.a.info({title:"Dashboard",width:"50em",content:A.createElement("div",null,A.createElement("div",{className:"helpTitle"},"Welcome to KBase Organizations!"),A.createElement("p",null,"This is your Organizations Dashboard. It is your quick stop to see what happening with all of your Organizations, or to get involved with new ones."),A.createElement("div",{className:"helpSectionTitle"},"Your Organizations"),A.createElement("p",null,"... to do ..."),A.createElement("div",{className:"helpSectionTitle"},"Notifications"),A.createElement("p",null,'All unready messages you have from any organization will visible in this section. Each notification may be closed (read) by clicking the red "x" in the upper right corner.'),A.createElement("p",null,"For access to all your notifications, and more control over them, visit your ",A.createElement("a",{href:"/#feeds"},"feeds"),"."),A.createElement("div",{className:"helpSectionTitle"},"Inbox"),A.createElement("p",null,"... to do ..."),A.createElement("div",{className:"helpSectionTitle"},"Outbox"),A.createElement("p",null,"... to do ..."),A.createElement("div",{className:"helpSectionTitle"},"Organization Inbox"),A.createElement("p",null,"... to do ..."),A.createElement("div",{className:"helpSectionTitle"},"+ New"),A.createElement("p",null,"... to do ..."),A.createElement("div",{className:"helpSectionTitle"},"Browse All"),A.createElement("p",null,"... to do ..."),A.createElement("div",{className:"helpSectionTitle"},"Refresh"),A.createElement("p",null,"... to do ..."))})}},{key:"renderHeader",value:function(){var e=A.createElement(A.Fragment,null,A.createElement("span",null,"My Organizations")),t=A.createElement(A.Fragment,null,A.createElement(Nt.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return A.createElement(Xa,null,function(r){return r?A.createElement(Ct,{breadcrumbs:e,buttons:t,test:r.test}):null})}},{key:"renderOrganizations",value:function(){if(0===this.props.viewModel.organizations.length){var e=A.createElement("div",null,A.createElement("p",null,"You are not associated with any Organizations"),A.createElement("p",null,"To get started, you can create a"," ",A.createElement(Nt.a,{onClick:this.onNavigateToNewOrg.bind(this)},A.createElement(He.a,{type:"plus"})," ","New")," ","Organization, or"," ",A.createElement(Nt.a,{onClick:this.onNavigateToBrowser.bind(this)},"Browse All")," ","organizations to find one to join."));return A.createElement(Pe.a,{type:"info",message:e})}return this.props.viewModel.organizations.map(function(e){return A.createElement("div",{key:e.id,className:"simpleCard"},A.createElement(ft,{organization:e}))})}},{key:"renderRefreshButton",value:function(){switch(this.props.viewModel.refreshState){case O.LOADING:return A.createElement(Nt.a,{key:"refresh"},A.createElement(He.a,{type:"sync",spin:!0}));default:return A.createElement(Nt.a,{key:"refresh",onClick:this.onRefresh.bind(this)},A.createElement(He.a,{type:"reload"}))}}},{key:"renderOrganizationsCard",value:function(){var e=A.createElement("div",null,this.renderRefreshButton());return A.createElement(Dr.a,{title:"My Organizations",headStyle:{backgroundColor:"gray",color:"white"},bodyStyle:{minHeight:"0",flex:"1 1 0px",display:"flex",flexDirection:"column"},className:"slimCard yourOrgsCard scrollable-flex-column",extra:e},A.createElement("div",{className:"scrollable-flex-column",style:{overflow:"auto"}},this.renderOrganizations()))}},{key:"renderPendingNotifications",value:function(){return A.createElement(Ja,{showOrg:!0})}},{key:"renderNotificationsCard",value:function(){var e=A.createElement("span",null,"Notifications");return A.createElement(Dr.a,{title:e,style:{display:"flex",flexDirection:"column",flex:"1 1 0px",minHeight:"30em"},headStyle:{backgroundColor:"gray",color:"white"},bodyStyle:{flex:"1 1 0px",display:"flex",flexDirection:"column",overflowY:"auto"},className:"slimCard Dashboard-notificationsCard"},this.renderPendingNotifications())}},{key:"renderRequestRequester",value:function(e){return A.createElement(hn,{userId:e.requester,avatarSize:30})}},{key:"renderOutboxCard",value:function(){var e=A.createElement("div",{style:{maxHeight:"30em",overflowY:"auto"}},this.renderPendingRequestsSent());return A.createElement(Dr.a,{title:"Outbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard Dashboard-pendingRequestsCard"},e)}},{key:"renderInboxCard",value:function(){return A.createElement(Dr.a,{title:"Inbox",style:{display:"flex",flexDirection:"column",flex:"1 1 0px",minHeight:"30em"},headStyle:{backgroundColor:"gray",color:"white"},bodyStyle:{flex:"1 1 0px",display:"flex",flexDirection:"column",overflowY:"auto"},className:"slimCard Dashboard-pendingInvitationsCard"},this.renderPendingRequestsReceived())}},{key:"isAdmin",value:function(){return this.props.viewModel.organizations.some(function(e){var t=e.relation;return t===pe.OWNER||t===pe.ADMIN})}},{key:"renderPendingAdminTasksCard",value:function(){if(this.isAdmin()){var e=A.createElement("div",{style:{overflowY:"auto",maxHeight:"30em"}},this.renderPendingAdminRequests());return A.createElement(Dr.a,{title:"Organization Inbox",headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard Dashboard-pendingAdminTasksCard"},e)}}},{key:"renderPendingRequestsSent",value:function(){return 0===this.props.viewModel.requestOutbox.length?A.createElement("div",{className:"message"},"No pending requests"):this.props.viewModel.requestOutbox.map(function(e,t){return A.createElement("div",{key:t,className:"simpleCard"},A.createElement(fn,{request:e,showOrg:!0}))})}},{key:"onAcceptInboxRequest",value:function(e){this.props.onAcceptInboxRequest(e)}},{key:"renderPendingAdminRequests",value:function(){var e=this,t=this.props.viewModel.pendingAdminRequests;return 0===t.length?A.createElement("div",{className:"message"},"No pending organization requests"):t.map(function(t,r){return A.createElement("div",{key:r,className:"simpleCard"},A.createElement(Rn,{request:t,showOrg:!0,onAcceptInboxRequest:e.onAcceptInboxRequest.bind(e)}))})}},{key:"renderPendingRequestsReceived",value:function(){var e=this;return 0===this.props.viewModel.requestInbox.length?A.createElement("div",{className:"message"},"No pending requests"):this.props.viewModel.requestInbox.map(function(t){return A.createElement("div",{key:t.id,className:"simpleCard"},A.createElement(Rn,{request:t,showOrg:!0,onAcceptInboxRequest:e.onAcceptInboxRequest.bind(e)}))})}},{key:"componentDidCatch",value:function(e,t){}},{key:"render",value:function(){switch(this.state.navigateTo){case Fa.BROWSER:return A.createElement(tr.a,{to:"/organizations"});case Fa.NEW_ORG:return A.createElement(tr.a,{to:"/newOrganization"})}return A.createElement("div",{className:"Dashboard scrollable-flex-column"},this.renderHeader(),A.createElement("div",{className:"Dashboard-body scrollable-flex-column"},A.createElement("div",{className:"Dashboard-col1 scrollable-flex-column"},this.renderOrganizationsCard()),A.createElement("div",{className:"Dashboard-col2 scrollable-flex-column"},A.createElement("div",{className:"scrollable-flex-column",style:{overflowY:"auto"}},this.renderNotificationsCard(),this.renderInboxCard()))))}}]),t}(A.Component);var $a=Object(z.b)(function(e,t){var r=e.views.dashboardView,n=e.auth.authorization.username;if(null===r.viewModel)throw new Error("view model is null!");return{viewModel:r.viewModel,currentUser:n}},function(e){return{onAcceptInboxRequest:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,o,s,c,l,u,E,d;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=n()).views.dashboardView.viewModel||r({type:q.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No dashboard view model"}}),r({type:q.DASHBOARD_ACCEPT_INBOX_REQUEST_START}),i=a.auth.authorization,o=i.token,s=i.username,c=a.app.config,l=new he({token:o,username:s,groupsServiceURL:c.services.Groups.url}),u=new Ne({token:o,username:s,groupsServiceURL:c.services.Groups.url}),t.prev=6,t.next=9,l.acceptRequest(e.id);case 9:return t.sent,t.next=12,l.getInboundRequests();case 12:return E=t.sent,t.next=15,u.getOwnOrgs();case 15:d=t.sent,r({type:q.DASHBOARD_ACCEPT_INBOX_REQUEST_SUCCESS,requests:E,organizations:d}),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(6),r({type:q.DASHBOARD_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 22:case"end":return t.stop()}},t,this,[[6,19]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onCancelOutboxRequest:function(t){e($r(t))},onRefresh:function(){e(function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,o,s,c,l,u,E,d;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:q.DASHBOARD_REFRESH_START}),(n=r()).views.dashboardView,a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new Ne({token:i,username:o,groupsServiceURL:s.services.Groups.url}),l=new he({token:i,username:o,groupsServiceURL:s.services.Groups.url}),e.prev=4,e.next=7,c.getOwnOrgs();case 7:return u=e.sent,e.next=10,l.getOutboundRequests();case 10:return E=e.sent,e.next=13,l.getInboundRequests();case 13:d=e.sent,t((p=u,v=d,h=E,O=[],{type:q.DASHBOARD_REFRESH_SUCCESS,organizations:p,requestInbox:v,requestOutbox:h,pendingGroupRequests:O})),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),t((m={code:S.ERROR,message:e.t0.message,detail:"",at:new Date,id:Zr()()},{type:q.DASHBOARD_REFRESH_ERROR,error:m}));case 21:case"end":return e.stop()}var m,p,v,h,O},e,this,[[4,18]])}));return function(t,r){return e.apply(this,arguments)}}())}}})(Za),ei=(r(319),function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderDetail",value:function(){return A.createElement("table",{className:"errorTable"},A.createElement("tbody",null,A.createElement("tr",null,A.createElement("th",null,A.createElement("span",{className:"field-label"},"generated at")),A.createElement("td",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.error.at))),A.createElement("tr",null,A.createElement("th",null,A.createElement("span",{className:"field-label"},"error id")),A.createElement("td",null,A.createElement("span",{style:{fontFamily:"monospace"}},this.props.error.id))),A.createElement("tr",null,A.createElement("th",null,A.createElement("span",{className:"field-label"},"explanation")),A.createElement("td",null,this.props.error.detail))))}},{key:"renderInfo",value:function(){return this.props.error.info?A.createElement("div",null,"additional info here ..."):A.createElement("div",{style:{textAlign:"left",fontStyle:"italic"}},"No additional information")}},{key:"render",value:function(){var e=A.createElement("div",null,A.createElement("p",null,this.props.error.message),A.createElement(za.a,{bordered:!1,style:{backgroundColor:"transparent"}},A.createElement(za.a.Panel,{header:"detail",key:"1",style:{backgroundColor:"transparent"}},this.renderDetail())),A.createElement(za.a,{bordered:!1,style:{backgroundColor:"transparent"}},A.createElement(za.a.Panel,{header:"additional info",key:"1",style:{backgroundColor:"transparent"}},this.renderInfo())));return A.createElement(Pe.a,{type:"error",showIcon:!0,message:"Error",className:"Error",description:e})}}]),t}(A.Component)),ti=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"renderLoading",value:function(){var e=A.createElement("div",{style:{textAlign:"center"}},"Loading Organizations..."," ",A.createElement(Nn.a,null));return A.createElement(Pe.a,{type:"info",message:e,style:{width:"30em",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return A.createElement(ei,{error:this.props.view.error})}},{key:"render",value:function(){switch(this.props.view.loadingState){case O.NONE:case O.LOADING:return this.renderLoading();case O.ERROR:return this.renderError();case O.SUCCESS:return A.createElement($a,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case O.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(A.Component);var ri=Object(z.b)(function(e,t){return{view:e.views.dashboardView}},function(e){return{onLoad:function(){e(function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,o,s,c,l,u,E,d,m,p,v;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:q.DASHBOARD_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new Ne({token:i,username:o,groupsServiceURL:s.services.Groups.url}),l=new he({token:i,username:o,groupsServiceURL:s.services.Groups.url}),e.prev=4,e.next=7,c.getOwnOrgs();case 7:return u=e.sent,e.next=10,l.getOutboundRequests();case 10:return E=e.sent,e.next=13,l.getInboundRequests();case 13:return d=e.sent,m=u.filter(function(e){return e.relation===pe.ADMIN||e.relation===pe.OWNER}).map(function(e){return e.id}),e.next=17,l.getPendingOrganizationRequests(m);case 17:p=e.sent,v=d.concat(p).sort(function(e,t){return e.createdAt.getTime()-t.createdAt.getTime()}),t((O=u,R=v,g=E,w=p,{type:q.DASHBOARD_LOAD_SUCCESS,organizations:O,requestInbox:R,requestOutbox:g,pendingGroupRequests:w})),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(4),t((h={code:S.ERROR,message:e.t0.message,detail:"",at:new Date,id:Zr()()},{type:q.DASHBOARD_LOAD_ERROR,error:h}));case 25:case"end":return e.stop()}var h,O,R,g,w},e,this,[[4,22]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:q.DASHBOARD_UNLOAD})}}})(ti),ni=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map}},db:{notifications:{all:[],byId:new Map}},views:{browseOrgsView:{loadingState:O.NONE,error:null,viewModel:null},organizationCentricView:{loadingState:O.NONE,error:null,viewModel:null},addOrgView:{loadingState:O.NONE,error:null,viewModel:null},editOrgView:{loadingState:O.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:O.NONE,error:null,viewModel:null},viewMembersView:{loadingState:O.NONE,error:null,viewModel:null},inviteUserView:{loadingState:O.NONE,error:null,viewModel:null},manageMembershipView:{loadingState:O.NONE,error:null,viewModel:null},requestNarrativeView:{loadingState:O.NONE,error:null,viewModel:null},dashboardView:{loadingState:O.NONE,error:null,viewModel:null},viewOrgView:{loadingState:O.NONE,error:null,viewModel:null}},auth:{status:m.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:v.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Feeds:{url:""},Auth:{url:""}}}},updateOrg:{pending:!1}}}}]),e}(),ai=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"componentWillMount",value:function(){this.props.onLoad()}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}},{key:"render",value:function(){return this.props.children}}]),t}(A.Component);var ii=Object(z.b)(function(e,t){return{}},function(e){return{onLoad:function(){e(function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,o,s,c,l;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:q.NOTIFICATIONS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,c=new br({token:i,username:o,feedsServiceURL:s.services.Feeds.url}),e.prev=3,e.next=6,c.getOrganizationNotifications();case 6:l=e.sent,t((E=l,{type:q.NOTIFICATIONS_LOAD_SUCCESS,notifications:E})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("error",e.t0),t((u={code:e.t0.name,message:e.t0.message},{type:q.NOTIFICATIONS_LOAD_ERROR,error:u}));case 14:case"end":return e.stop()}var u,E},e,this,[[3,10]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:q.NOTIFICATIONS_UNLOAD})}}})(ai),oi=r(234),si=(r(321),function(e){function t(e,r){var n;return Object(b.a)(this,t),(n=Object(C.a)(this,Object(D.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(y.a)(t,[{key:"onMenuSelection",value:function(e){console.log("here",e.key)}},{key:"renderMenu",value:function(){return A.createElement(yt.a,{onClick:this.onMenuSelection.bind(this),selectedKeys:[this.state.currentMenuItem],mode:"horizontal"},A.createElement(yt.a.Item,{key:"myorgs"},"My Organizations"),A.createElement(yt.a.Item,{key:"allorgs"},"All Organizations"))}},{key:"renderMenu3",value:function(){var e=this;return Object(It.a)(function(t){var r=t.history;return A.createElement(yt.a,{onClick:function(e){!function(e){switch(e){case"myorgs":r.push("/dashboard");case"allorgs":r.push("/organizations")}}(e.key)},selectedKeys:[e.state.currentMenuItem],mode:"horizontal"},A.createElement(yt.a.Item,{key:"myorgs"},"My Organizations"),A.createElement(yt.a.Item,{key:"allorgs"},"All Organizations"))})}},{key:"renderMenu4",value:function(){return A.createElement(bt.a,{render:function(e){var t=e.history;var r=[];switch(e.location.pathname){case"/dashboard":r=["myorgs"];break;case"/organizations":r=["allorgs"]}return A.createElement(yt.a,{onClick:function(e){!function(e){switch(console.log("navigate to ...",e),e){case"myorgs":console.log("my orgs?",e,t),t.push("/dashboard");case"allorgs":t.push("/organizations")}}(e.key)},selectedKeys:r,mode:"horizontal"},A.createElement(yt.a.Item,{key:"myorgs"},"My Organizations"),A.createElement(yt.a.Item,{key:"allorgs"},"All Organizations"))}})}},{key:"renderMenu6",value:function(){return A.createElement(bt.a,{render:function(e){e.history;var t=[];switch(e.location.pathname){case"/dashboard":t=["myorgs"];break;case"/organizations":t=["allorgs"];break;case"/newOrganization":t=["neworg"]}return A.createElement(yt.a,{selectedKeys:t,mode:"horizontal"},A.createElement(yt.a.Item,{key:"myorgs"},A.createElement(oi.a,{to:"/dashboard"},"My Organizations")),A.createElement(yt.a.Item,{key:"allorgs"},A.createElement(oi.a,{to:"/organizations"},"All Organizations")),A.createElement(yt.a.Item,{key:"neworg"},A.createElement(oi.a,{to:"/newOrganization"},"Create New Organization")))}})}},{key:"renderMenu5",value:function(){return A.createElement(A.Fragment,null,A.createElement("span",{style:{padding:"4px",marginRight:"4px"}},A.createElement(xe.a,{to:"/"},A.createElement("span",{"data-test":"orgs-label"},"My Organizations"))),A.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},A.createElement(xe.a,{to:"/organizations"},A.createElement("span",{"data-test":"orgs-label"},"All Organizations"))),A.createElement("span",{style:{padding:"4px",marginRight:"4px",marginLeft:"4px"}},A.createElement(xe.a,{to:"/newOrganization"},A.createElement("span",{"data-test":"orgs-label"},"Create New Organization"))))}},{key:"render",value:function(){return A.createElement("div",{className:"MainMenu"},A.createElement("div",{className:"MainMenu-menu"},this.renderMenu6()))}}]),t}(A.Component));Le.a.add(Ge.c,Ge.b,Ge.a,Ge.d);var ci=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"link",value:function(e,t,r){if(this.options.sanitize){var n;try{n=decodeURIComponent(this.options.unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return r}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return r}var a='<a href="'+e+'"';return t&&(a+=' title="'+t+'"'),a+=' target="_blank">'+r+"</a>"}}]),t}(rr.Renderer);(new rr.MarkedOptions).renderer=new ci,rr.Marked.setOptions({renderer:new ci});var li=!!window.frameElement,ui=ni.makeInitialState(),Ei=Object(L.d)(ze,ui,Object(L.c)(Object(L.a)(G.a))),di=function(e){function t(e){return Object(b.a)(this,t),Object(C.a)(this,Object(D.a)(t).call(this,e))}return Object(U.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return N.a.createElement(Ka,{value:{test:"ok"}},N.a.createElement(z.a,{store:Ei},N.a.createElement(ca,null,N.a.createElement($n,{hosted:li},N.a.createElement(ii,null,N.a.createElement(j.a,{basename:"/"},N.a.createElement("div",{className:"App scrollable-flex-column"},N.a.createElement("div",{className:"App-body scrollable-flex-column"},N.a.createElement(si,null),N.a.createElement(k.a,null,N.a.createElement(M.a,{path:"/dashboard",exact:!0,component:ri}),N.a.createElement(M.a,{path:"/organizations",component:xt}),N.a.createElement(M.a,{path:"/newOrganization",component:cr}),N.a.createElement(M.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(In,{organizationId:t})}}),N.a.createElement(M.a,{path:"/editOrganization/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Bn,{organizationId:t})}}),N.a.createElement(M.a,{path:"/manageOrganizationRequests/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(ma,{organizationId:t})}}),N.a.createElement(M.a,{path:"/viewMembers/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(_a,{organizationId:t})}}),N.a.createElement(M.a,{path:"/inviteUser/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Ua,{organizationId:t})}}),N.a.createElement(M.a,{path:"/membership/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Pa,{organizationId:t})}}),N.a.createElement(M.a,{path:"/requestAddNarrative/:id",component:function(e){var t=e.match.params.id;return N.a.createElement(Qa,{organizationId:t})}}),N.a.createElement(V.a,{from:"/",to:"/dashboard",exact:!0}))))))))))}}]),t}(A.Component);r(323),r(325),r(327);I.a.render(N.a.createElement(di,null),document.getElementById("root"))}},[[158,2,1]]]);
//# sourceMappingURL=main.0f7a5279.chunk.js.map