(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{117:function(e,t,r){e.exports=r.p+"static/media/nouserpic.9af42ba9.png"},160:function(e,t,r){e.exports=r(304)},165:function(e,t,r){},174:function(e,t,r){},176:function(e,t,r){},179:function(e,t,r){},180:function(e,t,r){},230:function(e,t,r){},240:function(e,t,r){},254:function(e,t,r){},263:function(e,t,r){},264:function(e,t,r){},265:function(e,t,r){},266:function(e,t,r){},267:function(e,t,r){},268:function(e,t,r){},269:function(e,t,r){},270:function(e,t,r){},275:function(e,t,r){},276:function(e,t,r){},277:function(e,t,r){},278:function(e,t,r){},279:function(e,t,r){},280:function(e,t,r){},281:function(e,t,r){},282:function(e,t,r){},283:function(e,t,r){},284:function(e,t,r){},285:function(e,t,r){},286:function(e,t,r){},287:function(e,t,r){},288:function(e,t,r){},289:function(e,t,r){},290:function(e,t,r){},291:function(e,t,r){},292:function(e,t,r){},293:function(e,t,r){},294:function(e,t,r){},295:function(e,t,r){},296:function(e,t,r){},297:function(e,t,r){},298:function(e,t,r){},299:function(e,t,r){},300:function(e,t,r){},304:function(e,t,r){"use strict";r.r(t);var n,a,i,s,o,l,c,u,E,d,m,v,p,O,h,R,w,_,g,f,A,S,N,b,I,T,y,M=r(0),D=r.n(M),C=r(16),k=r.n(C),V=(r(165),r(4)),U=r(5),z=r(8),j=r(6),G=r(7),L=r(308),P=r(91),x=r(157),B=r(317),W=r(12),q=r(69),H=r(147),F=r(2),Q=r(63),Y=r(41);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.NEW=1]="NEW",e[e.DIRTY=2]="DIRTY",e[e.CLEAN=3]="CLEAN"}(i||(i={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(s||(s={})),function(e){e[e.OK=0]="OK",e[e.ERROR=1]="ERROR",e[e.REQUIRED_MISSING=2]="REQUIRED_MISSING"}(o||(o={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(l||(l={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(c||(c={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(u||(u={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(E||(E={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(d||(d={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(v||(v={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(p||(p={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(O||(O={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(_||(_={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(g||(g={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SELECTING=4]="SELECTING",e[e.SELECTED=5]="SELECTED",e[e.SENDING=6]="SENDING",e[e.SENT=7]="SENT"}(f||(f={})),function(e){e[e.NONE=0]="NONE",e[e.SELECTING=1]="SELECTING",e[e.SELECTED=2]="SELECTED"}(A||(A={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.ASSOCIATION_PENDING=2]="ASSOCIATION_PENDING"}(S||(S={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.PRIVATE_INACCESSIBLE=1]="PRIVATE_INACCESSIBLE"}(N||(N={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS",e[e.INVITE_USER=2]="INVITE_USER",e[e.MANAGE_MEMBERSHIP=3]="MANAGE_MEMBERSHIP",e[e.EDIT_ORGANIZATION=4]="EDIT_ORGANIZATION",e[e.ADD_NARRATIVE=5]="ADD_NARRATIVE",e[e.ADD_APP=6]="ADD_APP"}(b||(b={})),function(e){e[e.NONE=0]="NONE",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS"}(I||(I={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.OK=2]="OK",e[e.ERROR=3]="ERROR"}(T||(T={})),function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR"}(y||(y={}));var J,Z=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,s=e.info;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,a))).code=void 0,r.message=void 0,r.detail=void 0,r.trace=void 0,r.errors=void 0,r.info=void 0,r.name="AppException",r.code=n,r.message=a,r.detail=i,r.info=s,Error.captureStackTrace&&Error.captureStackTrace(Object(Q.a)(r),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(G.a)(t,e),t}(Object(Y.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_RELOAD=31]="VIEW_ORG_RELOAD",e[e.VIEW_ORG_ADD_NARRATIVE=32]="VIEW_ORG_ADD_NARRATIVE",e[e.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS=33]="VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS",e[e.VIEW_ORG_LOAD_NORMAL_SUCCESS=34]="VIEW_ORG_LOAD_NORMAL_SUCCESS",e[e.VIEW_ORG_RELOAD_NORMAL_SUCCESS=35]="VIEW_ORG_RELOAD_NORMAL_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST=36]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=37]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=38]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=39]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=40]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=41]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=42]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=43]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=44]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=45]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=46]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=47]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST=48]="VIEW_ORG_ACCEPT_INBOX_REQUEST",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_START=49]="VIEW_ORG_ACCEPT_INBOX_REQUEST_START",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS=50]="VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR=51]="VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_INBOX_REQUEST=52]="VIEW_ORG_REJECT_INBOX_REQUEST",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_START=53]="VIEW_ORG_REJECT_INBOX_REQUEST_START",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS=54]="VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR=55]="VIEW_ORG_REJECT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=56]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=57]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=58]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=59]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=60]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=61]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=62]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=63]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=64]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=65]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=66]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=67]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.VIEW_ORG_SORT_NARRATIVES=68]="VIEW_ORG_SORT_NARRATIVES",e[e.VIEW_ORG_SORT_NARRATIVES_START=69]="VIEW_ORG_SORT_NARRATIVES_START",e[e.VIEW_ORG_SORT_NARRATIVES_SUCCESS=70]="VIEW_ORG_SORT_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SORT_NARRATIVES_ERROR=71]="VIEW_ORG_SORT_NARRATIVES_ERROR",e[e.VIEW_ORG_SEARCH_NARRATIVES=72]="VIEW_ORG_SEARCH_NARRATIVES",e[e.VIEW_ORG_SEARCH_NARRATIVES_START=73]="VIEW_ORG_SEARCH_NARRATIVES_START",e[e.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS=74]="VIEW_ORG_SEARCH_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SEARCH_NARRATIVES_ERROR=75]="VIEW_ORG_SEARCH_NARRATIVES_ERROR",e[e.VIEW_ORG_SORT_MEMBERS=76]="VIEW_ORG_SORT_MEMBERS",e[e.VIEW_ORG_SORT_MEMBERS_START=77]="VIEW_ORG_SORT_MEMBERS_START",e[e.VIEW_ORG_SORT_MEMBERS_SUCCESS=78]="VIEW_ORG_SORT_MEMBERS_SUCCESS",e[e.VIEW_ORG_SORT_MEMBERS_ERROR=79]="VIEW_ORG_SORT_MEMBERS_ERROR",e[e.VIEW_ORG_SEARCH_MEMBERS=80]="VIEW_ORG_SEARCH_MEMBERS",e[e.VIEW_ORG_SEARCH_MEMBERS_START=81]="VIEW_ORG_SEARCH_MEMBERS_START",e[e.VIEW_ORG_SEARCH_MEMBERS_SUCCESS=82]="VIEW_ORG_SEARCH_MEMBERS_SUCCESS",e[e.VIEW_ORG_SEARCH_MEMBERS_ERROR=83]="VIEW_ORG_SEARCH_MEMBERS_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD=84]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START=85]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS=86]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR=87]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD=88]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION=89]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION=90]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START=91]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS=92]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR=93]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=94]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=95]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=96]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=97]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=98]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=99]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=100]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=101]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH=102]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START=103]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS=104]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR=105]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST=106]="VIEW_PRIVATE_ORG_JOIN_REQUEST",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_START=107]="VIEW_PRIVATE_ORG_JOIN_REQUEST_START",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS=108]="VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR=109]="VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD=110]="VIEW_ORG_VIEW_MEMBERS_LOAD",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_START=111]="VIEW_ORG_VIEW_MEMBERS_LOAD_START",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS=112]="VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR=113]="VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_UNLOAD=114]="VIEW_ORG_VIEW_MEMBERS_UNLOAD",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER=115]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START=116]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=117]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR=118]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN=119]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=120]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=121]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=122]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER=123]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=124]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=125]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=126]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD=127]="VIEW_ORG_MANAGE_MEMBERSHIP_LOAD",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_START=128]="VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_START",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_SUCCESS=129]="VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_ERROR=130]="VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_UNLOAD=131]="VIEW_ORG_MANAGE_MEMBERSHIP_UNLOAD",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG=132]="VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED=133]="VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_START=134]="VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_START",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS=135]="VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR=136]="VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE=137]="VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_START=138]="VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_START",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS=139]="VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR=140]="VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE=141]="VIEW_ORG_MANAGE_MEMBERSHIP_SAVE",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_START=142]="VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_START",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_SUCCESS=143]="VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_SUCCESS",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_ERROR=144]="VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_ERROR",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE=145]="VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_SUCCESS=146]="VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_SUCCESS",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_ERROR=147]="VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_ERROR",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER=148]="VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_START=149]="VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_START",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_SUCCESS=150]="VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_SUCCESS",e[e.VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_ERROR=151]="VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_ERROR",e[e.VIEW_ORG_ADD_APPS_LOAD=152]="VIEW_ORG_ADD_APPS_LOAD",e[e.VIEW_ORG_ADD_APPS_LOAD_START=153]="VIEW_ORG_ADD_APPS_LOAD_START",e[e.VIEW_ORG_ADD_APPS_LOAD_SUCCESS=154]="VIEW_ORG_ADD_APPS_LOAD_SUCCESS",e[e.VIEW_ORG_ADD_APPS_LOAD_ERROR=155]="VIEW_ORG_ADD_APPS_LOAD_ERROR",e[e.VIEW_ORG_ADD_APPS_UNLOAD=156]="VIEW_ORG_ADD_APPS_UNLOAD",e[e.VIEW_ORG_ADD_APPS_SELECT=157]="VIEW_ORG_ADD_APPS_SELECT",e[e.VIEW_ORG_ADD_APPS_SELECT_SUCCESS=158]="VIEW_ORG_ADD_APPS_SELECT_SUCCESS",e[e.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP=159]="VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP",e[e.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_START=160]="VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_START",e[e.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_SUCCESS=161]="VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_SUCCESS",e[e.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_ERROR=162]="VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_ERROR",e[e.VIEW_ORG_REMOVE_APP=163]="VIEW_ORG_REMOVE_APP",e[e.VIEW_ORG_REMOVE_APP_START=164]="VIEW_ORG_REMOVE_APP_START",e[e.VIEW_ORG_REMOVE_APP_SUCCESS=165]="VIEW_ORG_REMOVE_APP_SUCCESS",e[e.VIEW_ORG_REMOVE_APP_ERROR=166]="VIEW_ORG_REMOVE_APP_ERROR",e[e.ADD_ORG_LOAD=167]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=168]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=169]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=170]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=171]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=172]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=173]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=174]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_LOGO_URL=175]="ADD_ORG_UPDATE_LOGO_URL",e[e.ADD_ORG_UPDATE_LOGO_URL_SUCCESS=176]="ADD_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.ADD_ORG_UPDATE_LOGO_URL_ERROR=177]="ADD_ORG_UPDATE_LOGO_URL_ERROR",e[e.ADD_ORG_UPDATE_ID=178]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=179]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=180]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=181]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=182]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=183]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=184]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=185]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=186]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=187]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=188]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_UPDATE_HOME_URL=189]="ADD_ORG_UPDATE_HOME_URL",e[e.ADD_ORG_UPDATE_HOME_URL_SUCCESS=190]="ADD_ORG_UPDATE_HOME_URL_SUCCESS",e[e.ADD_ORG_UPDATE_HOME_URL_ERROR=191]="ADD_ORG_UPDATE_HOME_URL_ERROR",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS=192]="ADD_ORG_UPDATE_RESEARCH_INTERESTS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=193]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=194]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.ADD_ORG_EVALUATE=195]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=196]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=197]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=198]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=199]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=200]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=201]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=202]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=203]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=204]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=205]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=206]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=207]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=208]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=209]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=210]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=211]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=212]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=213]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_LOGO_URL=214]="EDIT_ORG_UPDATE_LOGO_URL",e[e.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS=215]="EDIT_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_LOGO_URL_ERROR=216]="EDIT_ORG_UPDATE_LOGO_URL_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=217]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=218]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=219]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=220]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=221]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=222]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_UPDATE_HOME_URL=223]="EDIT_ORG_UPDATE_HOME_URL",e[e.EDIT_ORG_UPDATE_HOME_URL_SUCCESS=224]="EDIT_ORG_UPDATE_HOME_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_HOME_URL_ERROR=225]="EDIT_ORG_UPDATE_HOME_URL_ERROR",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS=226]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=227]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=228]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.EDIT_ORG_EVALUATE=229]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=230]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=231]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=232]="AUTH_CHECK",e[e.AUTH_CHECK_START=233]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=234]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=235]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=236]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=237]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=238]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=239]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=240]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=241]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=242]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=243]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=244]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=245]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=246]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=247]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=248]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=249]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=250]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=251]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=252]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=253]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=254]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=255]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=256]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=257]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=258]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=259]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=260]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=261]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=262]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=263]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=264]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=265]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=266]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=267]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=268]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=269]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=270]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=271]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=272]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=273]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=274]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=275]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=276]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=277]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=278]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=279]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=280]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=281]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=282]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=283]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=284]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=285]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=286]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=287]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=288]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=289]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=290]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=291]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=292]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=293]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=294]="INVITE_USER_SEND_INVITATION_ERROR",e[e.REQUEST_ADD_NARRATIVE_LOAD=295]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=296]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=297]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=298]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=299]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=300]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=301]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=302]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=303]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=304]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=305]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=306]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=307]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.REQUEST_ADD_NARRATIVE_SORT=308]="REQUEST_ADD_NARRATIVE_SORT",e[e.REQUEST_ADD_NARRATIVE_SORT_START=309]="REQUEST_ADD_NARRATIVE_SORT_START",e[e.REQUEST_ADD_NARRATIVE_SORT_SUCCESS=310]="REQUEST_ADD_NARRATIVE_SORT_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SORT_ERROR=311]="REQUEST_ADD_NARRATIVE_SORT_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=312]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=313]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=314]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=315]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=316]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=317]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=318]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=319]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=320]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=321]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=322]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=323]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=324]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=325]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=326]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=327]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=328]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.ENTITY_ORGANIZATION_LOAD=329]="ENTITY_ORGANIZATION_LOAD",e[e.ENTITY_ORGANIZATION_LOAD_START=330]="ENTITY_ORGANIZATION_LOAD_START",e[e.ENTITY_ORGANIZATION_LOAD_SUCCESS=331]="ENTITY_ORGANIZATION_LOAD_SUCCESS",e[e.ENTITY_ORGANIZATION_LOAD_ERROR=332]="ENTITY_ORGANIZATION_LOAD_ERROR",e[e.ENTITY_LOAD_APP=333]="ENTITY_LOAD_APP",e[e.ENTITY_LOAD_APP_START=334]="ENTITY_LOAD_APP_START",e[e.ENTITY_LOAD_APP_SUCCESS=335]="ENTITY_LOAD_APP_SUCCESS",e[e.ENTITY_LOAD_APP_ERROR=336]="ENTITY_LOAD_APP_ERROR",e[e.DATA_SERVICE_LOAD=337]="DATA_SERVICE_LOAD",e[e.DATA_SERVICE_LOAD_START=338]="DATA_SERVICE_LOAD_START",e[e.DATA_SERVICE_LOAD_SUCCESS=339]="DATA_SERVICE_LOAD_SUCCESS",e[e.DATA_SERVICE_LOAD_ERROR=340]="DATA_SERVICE_LOAD_ERROR",e[e.DATA_SERVICE_UNLOAD=341]="DATA_SERVICE_UNLOAD",e[e.DATA_SERVICE_LOAD_REFRESH=342]="DATA_SERVICE_LOAD_REFRESH",e[e.DATA_SERVICE_LOAD_REFRESH_START=343]="DATA_SERVICE_LOAD_REFRESH_START",e[e.DATA_SERVICE_LOAD_REFRESH_SUCCESS=344]="DATA_SERVICE_LOAD_REFRESH_SUCCESS",e[e.DATA_SERVICE_LOAD_REFRESH_ERROR=345]="DATA_SERVICE_LOAD_REFRESH_ERROR"}(J||(J={}));var K=function(e,t){switch(t.type){case J.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{saveState:l.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case J.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.UNEDITED,saveState:l.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case J.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{saveState:l.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveError without view model"),e)}(e,t);case J.ADD_ORG_LOAD_START:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case J.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:s.UNEDITED,validationState:{type:o.OK,validatedAt:new Date},saveState:l.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case J.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case J.ADD_ORG_UNLOAD:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case J.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Logo URL without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:t.error})})})})})}):(console.warn("attempting Logo URL error without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Home URL (success) without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:t.error})})})})})}):(console.warn("attempting update to home url without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Research Interests without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:t.error})})})})})}):(console.warn("attempting update to research interests (error) without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e);case J.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:i.DIRTY})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case J.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:Object(F.a)({},e.views.addOrgView.viewModel.newOrganization.isPrivate,{value:t.isPrivate,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case J.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{validationState:{type:o.OK,validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case J.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{addOrgView:Object(F.a)({},e.views.addOrgView,{viewModel:Object(F.a)({},e.views.addOrgView.viewModel,{validationState:{type:o.ERROR,message:"TODO: form error",validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};function X(){return{type:o.OK,validatedAt:new Date}}function $(e){return e.editedOrganization.name.syncState===i.DIRTY?s.EDITED:e.editedOrganization.id.syncState===i.DIRTY?s.EDITED:e.editedOrganization.logoUrl.syncState===i.DIRTY?s.EDITED:e.editedOrganization.homeUrl.syncState===i.DIRTY?s.EDITED:e.editedOrganization.researchInterests.syncState===i.DIRTY?s.EDITED:e.editedOrganization.isPrivate.syncState===i.DIRTY?s.EDITED:e.editedOrganization.description.syncState===i.DIRTY?s.EDITED:s.UNEDITED}var ee=function(e,t){switch(t.type){case J.EDIT_ORG_LOAD_START:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case J.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:s.UNEDITED,validationState:X(),saveState:l.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case J.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case J.EDIT_ORG_UNLOAD:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case J.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{saveState:l.SAVING})})})}):e}(e);case J.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.UNEDITED,saveState:l.SAVED,editedOrganization:{id:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.id,{syncState:i.CLEAN}),name:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{syncState:i.CLEAN}),logoUrl:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{syncState:i.CLEAN}),homeUrl:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{syncState:i.CLEAN}),researchInterests:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{syncState:i.CLEAN}),isPrivate:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{syncState:i.CLEAN}),description:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{syncState:i.CLEAN})}})})})}):e}(e);case J.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{saveState:l.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case J.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.name!==n.name.remoteValue?i.DIRTY:i.CLEAN;var a=Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:r,validationState:X()})})})})})}),s=$(a.views.editOrgView.viewModel);return Object(F.a)({},a,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},a.views.editOrgView,{viewModel:Object(F.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case J.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case J.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:X()})})})})})}),n=$(r.views.editOrgView.viewModel);return Object(F.a)({},r,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},r.views.editOrgView,{viewModel:Object(F.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case J.EDIT_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case J.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:X()})})})})})}),n=$(r.views.editOrgView.viewModel);return Object(F.a)({},r,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},r.views.editOrgView,{viewModel:Object(F.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case J.EDIT_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case J.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:X()})})})})})}),n=$(r.views.editOrgView.viewModel);return Object(F.a)({},r,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},r.views.editOrgView,{viewModel:Object(F.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case J.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case J.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.isPrivate!==n.isPrivate.remoteValue?i.DIRTY:i.CLEAN;var a=Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{value:t.isPrivate,syncState:r,validationState:X()})})})})})}),o=$(a.views.editOrgView.viewModel);return Object(F.a)({},a,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},a.views.editOrgView,{viewModel:Object(F.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case J.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.description!==n.description.remoteValue?i.DIRTY:i.CLEAN;var a=Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:r,validationState:X()})})})})})}),o=$(a.views.editOrgView.viewModel);return Object(F.a)({},a,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},a.views.editOrgView,{viewModel:Object(F.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case J.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(F.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case J.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{validationState:{type:o.OK,validatedAt:new Date}})})})}):e}(e);case J.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(F.a)({},e,{views:Object(F.a)({},e.views,{editOrgView:Object(F.a)({},e.views.editOrgView,{viewModel:Object(F.a)({},e.views.editOrgView.viewModel,{validationState:{type:o.ERROR,message:"Validation errors",validatedAt:new Date}})})})}):e}(e);default:return null}};function te(e,t){switch(t.type){case J.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}var re=function(e,t){switch(t.type){case J.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==N.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(F.a)({},e,{type:c.ADMIN}):e}),a=r.members.map(function(e){return e.username===t.memberUsername?Object(F.a)({},e,{type:c.ADMIN}):e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},r,{organization:Object(F.a)({},r.organization,{members:n}),members:a})})})})}(e,t);case J.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==N.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(F.a)({},e,{type:c.MEMBER}):e}),a=r.members.map(function(e){return e.username===t.memberUsername?Object(F.a)({},e,{type:c.MEMBER}):e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},r,{organization:Object(F.a)({},r.organization,{members:n}),members:a})})})})}(e,t);case J.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==N.NORMAL)return e;var n=r.organization.members.filter(function(e){return e.username!==t.memberUsername}),a=r.members.filter(function(e){return e.username!==t.memberUsername});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},r,{organization:Object(F.a)({},r.organization,{members:n}),members:a})})})})}(e,t);case J.VIEW_ORG_SORT_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{sortMembersBy:t.sortBy,members:t.members})})})}):e}(e,t);case J.VIEW_ORG_SEARCH_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{searchMembersBy:t.searchBy,members:t.members})})})}):e}(e,t);default:return null}};function ne(e,t){switch(t.type){case J.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}function ae(e,t){switch(t.type){case J.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{requestOutbox:t.requests})})})}):e}(e,t);default:return null}}var ie,se=r(3),oe=r.n(se),le=r(9),ce=r(19);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(ie||(ie={}));Object(Y.a)(Error);var ue,Ee,de,me=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).originalError=void 0,r.name="GroupException",r.originalError=e,r}return Object(G.a)(t,e),t}(Z),ve=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(G.a)(t,e),t}(Z),pe=function(){function e(t){var r=t.token,n=t.url;Object(V.a)(this,e),this.token=void 0,this.url=void 0,this.token=r,this.url=n}return Object(U.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"listGroups",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"});case 2:if(200===(t=e.sent).status){e.next=6;break}throw console.error("error fetching groups",t),new Error("Error fetching groups");case 6:return e.next=8,t.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200===e.status)return e.json().then(function(e){return e});if(204===e.status){return null}throw new Error("Unexpected response: "+e.status+" : "+e.statusText)}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new me(e)});case"text/plain":return e.text().then(function(e){throw new ve(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i,s;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new me(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new ve(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new me(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new ve(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{logourl:e.logoUrl,researchinterests:e.researchInterests,homeurl:e.homeUrl}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{logourl:t.logoUrl,homeurl:t.homeUrl,researchinterests:t.researchInterests},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"addRelatedGroup",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,!(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i={custom:{relatedgroups:a.join(",")}},e.next=10,this.put(["group",t,"update"],i);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRelatedGroup",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i,s;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i=a.filter(function(e){return e!==r}),s={custom:{relatedgroups:i.join(",")}},e.next=11,this.put(["group",t,"update"],s);case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getRequest",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===ie.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===ie.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===ie.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"addOrRequestResource",value:function(e){var t=[this.url,"group",e.groupId,"resource",e.type,e.resourceId].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r,n){var a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"updateMember",value:function(e){var t=e.groupId,r=e.memberUsername,n=e.update,a=["group",t,"user",r,"update"];return this.put(a,{custom:n})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}},{key:"visitGroup",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupId,n=["group",r,"visit"],e.abrupt("return",this.put(n,null));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequests",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l,c,u,E;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupIds,n=["request","groups",r.join(","),"new"],e.next=4,this.get(n);case 4:for(a=e.sent,i=new Map,s=Object.entries(a),o=0;o<s.length;o++)l=s[o],c=Object(ce.a)(l,2),u=c[0],E=c[1],i.set(u,E);return e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Oe(e){var t=function(e){switch(e){case"Invite":return ue.INVITATION;case"Request":return ue.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return Ee.USER;case"workspace":return Ee.WORKSPACE;case"catalogmethod":return Ee.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,de.OPEN);switch(r){case Ee.USER:return ue.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case Ee.WORKSPACE:return ue.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case Ee.APP:return ue.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(ue||(ue={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(Ee||(Ee={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(de||(de={}));var he=function(){function e(t){Object(V.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.cache=void 0,this.params=t,this.groupsClient=new pe({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(U.a)(e,[{key:"getRequest",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=Oe(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOutboundRequests",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r,n,a=this;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return Oe(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",Oe(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCombinedRequestInboxForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getGroupRequests(t,{includeClosed:!1,sortDirection:ie.DESCENDING});case 4:e.t0=function(e){return Oe(e)},n=e.sent.map(e.t0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(1),n=[];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r,n,a=this;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return Oe(e)}).filter(function(e){return e.type===ue.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboundRequests",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r,n,a=this;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return Oe(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:ie.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",Oe(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:ie.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return Oe(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:ie.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return Oe(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return Oe(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),Re=function(){function e(t){var r=t.url,n=t.token;Object(V.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n||null}return Object(U.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}();Re.module=void 0;var we=function(e){function t(e){var r;if(Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(Re),_e=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var e=Object(le.a)(oe.a.mark(function e(r){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.profileCache.has(r)){e.next=2;break}return e.abrupt("return",Promise.resolve(t.profileCache.get(r)));case 2:return e.abrupt("return",this.callFunc("get_user_profile",[r]).then(function(e){return e.result[0][0]}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateUserProfile",value:function(){var e=Object(le.a)(oe.a.mark(function e(r){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.profileCache.delete(r.user.username),e.abrupt("return",this.callFunc("update_user_profile",{profile:r}).then(function(){}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("get_user_profile",t).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllUsers",value:function(){var e=Object(le.a)(oe.a.mark(function e(){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:""}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:t}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(we);function ge(e,t,r){if("string"===typeof t)t=t.split(".");else if(!(t instanceof Array))throw new TypeError("Invalid type for key: "+typeof t);for(var n=0;n<t.length;n+=1){if(void 0===e||"object"!==typeof e||null===e)return r;e=e[t[n]]}return void 0===e?r:e}_e.module="UserProfile",_e.profileCache=new Map;function fe(e){var t;return e.profile.userdata?(t="Other"===ge(e,"profile.userdata.jobTitle",null)?ge(e,"profile.userdata.jobTitleOther",null):ge(e,"profile.userdata.jobTitle",null),{username:e.user.username,realname:e.user.realname,city:ge(e,"profile.userdata.city",null),state:ge(e,"profile.userdata.state",null),country:ge(e,"profile.userdata.country",null),title:t,organization:ge(e,"profile.userdata.organization",null),avatarOption:ge(e,"profile.userdata.avatarOption",null),gravatarHash:ge(e,"profile.synced.gravatarHash",null),gravatarDefault:ge(e,"profile.userdata.gravatarDefault",null)}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}var Ae,Se,Ne,be,Ie,Te=function(){function e(t){Object(V.a)(this,e),this.params=void 0,this.userProfileClient=void 0,this.cache=void 0,this.params=t,this.userProfileClient=new _e({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(U.a)(e,[{key:"getUser",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=fe(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i=this;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return fe(e)}),a.forEach(function(e){var t=fe(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),ye=function(){function e(){Object(V.a)(this,e)}return Object(U.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:o.REQUIRED_MISSING,message:"Organization id may not be empty",validatedAt:new Date}];if(e.match(/\s/))return[e,{type:o.ERROR,message:"Organization id may not contain a space",validatedAt:new Date}];if(e.length>100)return[e,{type:o.ERROR,message:"Organization id may not be longer than 100 characters",validatedAt:new Date}];return e.match(/^[a-z0-9-]+$/)?[e,{type:o.OK,validatedAt:new Date}]:[e,{type:o.ERROR,message:'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash "-"',validatedAt:new Date}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:o.REQUIRED_MISSING,message:"Organization name may not be empty",validatedAt:new Date}]:e.length>256?[e,{type:o.ERROR,message:"Organization name may not be longer than 256 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgLogoUrl",value:function(e){if(null===e||""===e)return[e,{type:o.OK,validatedAt:new Date}];if(e.length>1e3)return[e,{type:o.ERROR,message:"Logo url may not be longer than 1000 characters",validatedAt:new Date}];try{var t=new URL(e);if(!t.protocol.match(/^http[s]?:$/))return[e,{type:o.ERROR,message:"Error parsing url: "+t.protocol+" is not a valid protocol",validatedAt:new Date}];if(!t.protocol.match(/^https:$/))return[e,{type:o.ERROR,message:"Only https (secure) urls are supported",validatedAt:new Date}]}catch(r){return[e,{type:o.ERROR,message:"Error parsing url: "+r.message,validatedAt:new Date}]}return[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgHomeUrl",value:function(e){if(null===e||""===e)return[e,{type:o.OK,validatedAt:new Date}];if(e.length>1e3)return[e,{type:o.ERROR,message:"Home url may not be longer than 1000 characters",validatedAt:new Date}];try{var t=new URL(e);if(!t.protocol.match(/^http[s]?:$/))return[e,{type:o.ERROR,message:"Error parsing url: "+t.protocol+" is not a valid protocol",validatedAt:new Date}]}catch(r){return[e,{type:o.ERROR,message:"Error parsing url: "+r.message,validatedAt:new Date}]}return[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgResearchInterests",value:function(e){return 0===e.length?[name,{type:o.REQUIRED_MISSING,message:"Research Interests may not be empty",validatedAt:new Date}]:e.length>280?[e,{type:o.ERROR,message:"Research Interests may not be longer than 280 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:o.ERROR,message:"Organization description may not be empty",validatedAt:new Date}]:e.length>4096?[e,{type:o.ERROR,message:"Organization description may not be longer than 4,096 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateMemberTitle",value:function(e){return e.length>100?[e,{type:o.ERROR,message:"member title may not be longer than ".concat(100," characters"),validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}}]),e}();function Me(e,t,r,n){if(e.kind===be.INACCESSIBLE_PRIVATE)return r&&r.user===t?{type:Ae.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:Ae.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:Ae.NONE};if(t===e.owner.username)return{type:Ae.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:Ae.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:Ae.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:Ae.NONE};switch(a.type){case Se.MEMBER:return{type:Ae.MEMBER};case Se.ADMIN:return{type:Ae.ADMIN};case Se.OWNER:return{type:Ae.OWNER};default:return{type:Ae.NONE}}}function De(e){switch(e){case"None":return Ne.NONE;case"Read":return Ne.VIEW;case"Write":return Ne.EDIT;case"Admin":return Ne.ADMIN;case"Own":return Ne.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}function Ce(e,t,r){var n=e.get(t);return n?n.realname:r}function ke(e,t,r){var n={username:e.owner.name,realname:Ce(r,e.owner.name,"n/a"),joinedAt:new Date(e.owner.joined),lastVisitedAt:e.owner.lastvisit?new Date(e.owner.lastvisit):null,type:Se.OWNER,title:e.owner.custom.title},a=[].concat(e.admins.map(function(e){return{username:e.name,realname:Ce(r,e.name,"n/a"),joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:Se.ADMIN,title:e.custom.title}})).concat(e.members.map(function(e){return{username:e.name,realname:Ce(r,e.name,"n/a"),joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:Se.MEMBER,title:e.custom.title}})),i=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:De(e.perm),createdAt:new Date(e.narrcreate),updatedAt:new Date(e.moddate),description:e.description,addedAt:null===e.added?null:new Date(e.added)}}),s=e.resources.catalogmethod.map(function(e){return{appId:e.rid.split(".").join("/"),addedAt:null===e.added?null:new Date(e.added)}});return{kind:be.NORMAL,id:e.id,name:e.name,isPrivate:e.private,isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,relation:Le(e.role),logoUrl:e.custom.logourl||null,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||"",description:e.custom.description,owner:n,areMembersPrivate:e.privatemembers,members:a,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,narratives:i,apps:s,memberCount:e.memcount,narrativeCount:e.rescount.workspace||0,appCount:e.rescount.catalogmethod||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}function Ve(e,t){return{kind:be.INACCESSIBLE_PRIVATE,id:e.id,isPrivate:e.private,relation:Le(e.role)}}function Ue(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.researchInterests||"")||t.test(e.owner.username)||t.test(e.owner.realname)})})}function ze(e){var t=e.getTime();return Math.round(t/864e5)}function je(e,t,r,n){switch(e){case"created":return t*(ze(r.createdAt)-ze(n.createdAt));case"modified":case"changed":return t*(ze(r.modifiedAt)-ze(n.modifiedAt));case"name":return t*r.name.localeCompare(n.name);case"owner":return t*r.owner.username.localeCompare(n.owner.username);case"narrativeCount":return t*(r.narrativeCount-n.narrativeCount);case"memberCount":return t*(r.memberCount-n.memberCount);default:return console.warn("unimplemented sort field: "+e),0}}function Ge(e,t,r){var n=r===O.ASCENDING?1:-1;return e.slice().sort(function(e,r){return je(t,n,e,r)||je("name",1,e,r)})}function Le(e){switch(e){case"None":return Ae.NONE;case"Member":return Ae.MEMBER;case"Admin":return Ae.ADMIN;case"Owner":return Ae.OWNER;default:throw new Error("Unknown role: "+e)}}function Pe(e,t,r){var n=t.roleType,a=t.roles,i=t.privacy;return e.filter(function(e){return function(e){switch(n){case"myorgs":return[Ae.MEMBER,Ae.ADMIN,Ae.OWNER].includes(e.relation);case"notmyorgs":return![Ae.MEMBER,Ae.ADMIN,Ae.OWNER].includes(e.relation);case"all":default:return!0}}(e)&&function(e){return 0===a.length||a.some(function(t){switch(t){case"member":return e.relation===Ae.MEMBER;case"admin":return e.relation===Ae.ADMIN;case"owner":return e.relation===Ae.OWNER;default:return!1}})}(e)&&function(e){switch(i){case"public":return!e.isPrivate;case"private":return e.isPrivate;case"any":return!0;default:return!1}}(e)})}function xe(e){switch(e){case"name":return function(e,t){return e.title.localeCompare(t.title)};case"updated":return function(e,t){return t.updatedAt.getTime()-e.updatedAt.getTime()};default:case"added":return function(e,t){return null===e.addedAt?null===t.addedAt?0:1:null===t.addedAt?-1:t.addedAt.getTime()-e.addedAt.getTime()}}}function Be(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=xe(t)(e,r);return 0===n&&"name"!==t?xe("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.title)})})}(e,t.searchBy),t.sortBy)}function We(e){switch(e){case"name":return function(e,t){return e.username.localeCompare(t.username)};default:case"added":return function(e,t){return t.joinedAt.getTime()-e.joinedAt.getTime()}}}function qe(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=We(t)(e,r);return 0===n&&"name"!==t?We("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.username)||t.test(e.title||"")})})}(e,t.searchBy),t.sortBy)}ye.nonPrintableRe=/[\000-\031]/,function(e){e.NONE="NONE",e.VIEW="VIEW",e.MEMBER_REQUEST_PENDING="MEMBER_REQUEST_PENDING",e.MEMBER_INVITATION_PENDING="MEMBER_INVITATION_PENDING",e.MEMBER="MEMBER",e.ADMIN="ADMIN",e.OWNER="OWNER"}(Ae||(Ae={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(Se||(Se={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(Ne||(Ne={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.INACCESSIBLE_PRIVATE=1]="INACCESSIBLE_PRIVATE"}(be||(be={})),function(e){e.INAPPLICABLE="INAPPLICABLE",e.NONE="NONE",e.OLD="OLD",e.NEW="NEW"}(Ie||(Ie={}));var He=function(){function e(t){Object(V.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.usersClient=void 0,this.params=t,this.groupsClient=new pe({url:this.params.groupsServiceURL,token:this.params.token}),this.usersClient=new Te({userProfileServiceURL:this.params.userProfileServiceURL,token:this.params.token})}return Object(U.a)(e,[{key:"getOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroupById(t);case 2:if("None"!==(r=e.sent).role||!r.private){e.next=7;break}return e.abrupt("return",Ve(r,this.params.username));case 7:return(a=[]).push((n=r).owner.name),n.admins.forEach(function(e){a.push(e.name)}),n.members.forEach(function(e){a.push(e.name)}),e.next=14,this.usersClient.getUsers(a);case 14:return i=e.sent,e.abrupt("return",ke(n,this.params.username,i));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupUsers",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=[]).push(t.owner.name),t.admins.forEach(function(e){r.push(e.name)}),t.members.forEach(function(e){r.push(e.name)}),e.next=6,this.usersClient.getUsers(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganization",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroupById(t);case 2:if("None"!==(r=e.sent).role||!r.private){e.next=5;break}throw new Error("Inaccessible Organization");case 5:return e.next=7,this.getGroupUsers(r);case 7:return n=e.sent,e.abrupt("return",ke(r,this.params.username,n));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r=this;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return t=e.sent,r=t.filter(function(e){return e.relation!==Ae.NONE}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listGroupToBriefOrganization",value:function(e,t){return{id:e.id,name:e.name,logoUrl:e.custom.logourl||null,isPrivate:e.private,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||null,owner:{username:e.owner,realname:Ce(t,e.owner,"n/a"),lastVisitedAt:null,type:Se.OWNER,joinedAt:new Date(e.createdate),title:"Owner"},relation:Le(e.role),isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,memberCount:e.memcount||0,narrativeCount:e.rescount.workspace||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}},{key:"getAllOrgs2",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r,n,a,i=this;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:return e.next=3,this.groupsClient.listGroups();case 3:r=e.sent,t=t.concat(r);case 5:if(100===r.length){e.next=1;break}case 6:return n=new Set,t.forEach(function(e){n.add(e.owner)}),e.next=10,this.usersClient.getUsers(Array.from(n.values()));case 10:return a=e.sent,e.abrupt("return",t.map(function(e){return i.listGroupToBriefOrganization(e,a)}));case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=Pe(r,t.filter,t.username),a=Ue(n,t.searchTerms),i=Ge(a,t.sortField,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=r.filter(function(e){return e.relation!==Ae.NONE}),e.abrupt("return",{organizations:n,total:n.length});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",Oe(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),t.id.validationState.type===o.OK&&t.name.validationState.type===o.OK&&t.logoUrl.validationState.type===o.OK&&t.description.validationState.type===o.OK&&t.isPrivate.validationState.type===o.OK){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.next=5,n.createGroup({id:t.id.value,name:t.name.value,logoUrl:t.logoUrl.value,homeUrl:t.homeUrl.value,researchInterests:t.researchInterests.value,description:t.description.value,isPrivate:t.isPrivate.value});case 5:return a=e.sent,e.next=8,this.getGroupUsers(a);case 8:return i=e.sent,e.abrupt("return",ke(a,0,i));case 10:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,logoUrl:r.logoUrl,homeUrl:r.homeUrl,researchInterests:r.researchInterests,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return ye.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return ye.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return ye.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeAppFromOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),a=r.split("/").join("."),e.abrupt("return",n.deleteResource(t,"catalogmethod",a));case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembership",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",Oe(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",Oe(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"addOrRequestAppToGroup",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestResource({groupId:t,type:"catalogmethod",resourceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",Oe(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.memberToAdmin({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"adminToMember",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.adminToMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.removeMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateMember",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r,n){var a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",a.updateMember({groupId:t,memberUsername:r,update:n}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"visitOrg",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.visitGroup({groupId:r}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestsStatus",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l,c,u,E,d,m,v,p;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationIds,n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:r});case 4:for(a=e.sent,i=new Map,s=!0,o=!1,l=void 0,e.prev=9,c=a.entries()[Symbol.iterator]();!(s=(u=c.next()).done);s=!0)E=u.value,d=Object(ce.a)(E,2),m=d[0],v=d[1],p=Fe(v),i.set(m,p);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),o=!0,l=e.t0;case 17:e.prev=17,e.prev=18,s||null==c.return||c.return();case 20:if(e.prev=20,!o){e.next=23;break}throw l;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestStatus",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l,c,u,E,d;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:[r]});case 4:a=e.sent,i=!0,s=!1,o=void 0,e.prev=8,l=a.entries()[Symbol.iterator]();case 10:if(i=(c=l.next()).done){e.next=19;break}return u=c.value,E=Object(ce.a)(u,2),E[0],d=E[1],e.abrupt("return",Fe(d));case 16:i=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),s=!0,o=e.t0;case 25:e.prev=25,e.prev=26,i||null==l.return||l.return();case 28:if(e.prev=28,!s){e.next=31;break}throw o;case 31:return e.finish(28);case 32:return e.finish(25);case 33:throw new Error("expected request status, got none");case 34:case"end":return e.stop()}},e,this,[[8,21,25,33],[26,,28,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addRelatedOrganization",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.addRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeRelatedOrganization",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new pe({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.removeRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Fe(e){switch(e.new){case"None":return Ie.NONE;case"Old":return Ie.OLD;case"New":return Ie.NEW;default:throw new Error("Invalid open request status: "+e)}}var Qe=r(44),Ye=r.n(Qe);function Je(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,s=e.info;return{code:t,message:r,detail:n,id:Ye()(),at:new Date,history:a,trace:i,info:s}}function Ze(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return e.filter(function(e){var t=e.organization;return r.every(function(e){return e.test(t.name)||e.test(t.owner.username)})})}function Ke(e,t){switch(t.type){case J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:{state:T.OK,error:null,viewModel:{kind:I.MANAGE_RELATED_ORGS,relatedOrganizations:e.views.viewOrgView.viewModel.organization.relatedOrganizations,organization:e.views.viewOrgView.viewModel.organization,availableOrganizations:{organizations:t.organizations,queried:t.organizations,searchBy:""},selectedOrganization:null}}})})})})}):e}(e,t);case J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:{state:T.NONE,error:null,viewModel:null}})})})})}):e}(e);case J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,n=r.organizations.map(function(e){return e.organization.id===t.selectedOrganization.organization.id?e.isSelected=!0:e.isSelected=!1,e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{selectedOrganization:t.selectedOrganization,availableOrganizations:{organizations:n,queried:Ze(n,r.searchBy),searchBy:r.searchBy}})})})})})})})}(e,t);case J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,n=e.views.viewOrgView.viewModel.organization.relatedOrganizations.concat([t.organizationId]),a=r.organizations.map(function(e){return n.includes(e.organization.id)?e.isRelated=!0:e.isRelated=!1,e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{organization:Object(F.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:n}),subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:{organizations:a,queried:Ze(a,r.searchBy),searchBy:r.searchBy}})})})})})})})}(e,t);case J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId}),n=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,a=n.organizations.filter(function(e){return e.organization.id===t.organizationId&&(e.isRelated=!1),e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{organization:Object(F.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r}),subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:{organizations:a,queried:Ze(a,n.searchBy),searchBy:n.searchBy}})})})})})})})}(e,t);case J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:Object(F.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,{queried:t.organizations,searchBy:t.searchBy})})})})})})})}):e}(e,t);default:return null}}function Xe(e,t){switch(t.type){case J.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{organization:Object(F.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r})})})})})}(e,t);default:return null}}function $e(e,t){switch(t.type){case J.VIEW_ORG_ADD_APPS_LOAD_START:return{state:T.LOADING,viewModel:null,error:null};case J.VIEW_ORG_ADD_APPS_LOAD_SUCCESS:return function(e,t){return{state:T.OK,error:null,viewModel:{rawApps:t.rawApps,sortBy:t.sortBy,searchBy:t.searchBy,apps:t.apps,selectedApp:t.selectedApp}}}(0,t);case J.VIEW_ORG_ADD_APPS_LOAD_ERROR:return function(e,t){return{state:T.ERROR,error:t.error,viewModel:null}}(0,t);case J.VIEW_ORG_ADD_APPS_UNLOAD:return{state:T.NONE,error:null,viewModel:null};case J.VIEW_ORG_ADD_APPS_SELECT_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=e.viewModel.rawApps.slice(0);return r.forEach(function(e){e===t.selectedApp?e.selected=!0:e.selected=!1}),Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{apps:r,rawApps:r,selectedApp:t.selectedApp})})}(e,t);case J.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=e.viewModel.rawApps.slice(0);return r.forEach(function(e){e.app.id===t.appId&&(t.pending?e.relation=S.ASSOCIATION_PENDING:e.relation=S.ASSOCIATED)}),Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{apps:r,rawApps:r})})}(e,t);default:return null}}function et(e,t){if(!function(e){switch(e.type){case J.VIEW_ORG_ADD_APPS_LOAD_START:case J.VIEW_ORG_ADD_APPS_LOAD_SUCCESS:case J.VIEW_ORG_ADD_APPS_LOAD_ERROR:case J.VIEW_ORG_ADD_APPS_UNLOAD:case J.VIEW_ORG_ADD_APPS_SELECT_SUCCESS:case J.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_SUCCESS:return!0;default:return!1}}(t))return null;if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;var r=$e(e.views.viewOrgView.viewModel.subViews.addAppsView,t);return null===r?null:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{addAppsView:r})})})})})}function tt(e,t){switch(t.type){case J.VIEW_ORG_LOAD_START:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case J.VIEW_ORG_LOAD_NORMAL_SUCCESS:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{kind:N.NORMAL,organization:t.organization,relation:t.relation,openRequest:t.openRequest,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,narratives:{sortBy:t.narrativesSortBy,searchBy:"",narratives:t.narratives},apps:{sortBy:"",searchBy:"",apps:t.apps},sortMembersBy:t.sortMembersBy,members:t.members,searchMembersBy:"",subViews:{manageRelatedOrganizationsView:{state:T.NONE,viewModel:null,error:null},inviteUserView:{state:T.NONE,viewModel:null,error:null},requestNarrativeView:{state:T.NONE,viewModel:null,error:null},manageMembershipView:{state:T.NONE,viewModel:null,error:null},addAppsView:{state:T.NONE,viewModel:null,error:null}}}}})})}(e,t);case J.VIEW_ORG_RELOAD_NORMAL_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;return null===r?e:r.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{loadingState:h.SUCCESS,error:null,viewModel:{kind:N.NORMAL,organization:t.organization,relation:t.relation,openRequest:t.openRequest,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,narratives:{sortBy:t.narrativesSortBy,searchBy:"",narratives:t.narratives},apps:Object(F.a)({},r.apps,{apps:t.apps}),sortMembersBy:t.sortMembersBy,members:t.members,searchMembersBy:"",subViews:Object(F.a)({},r.subViews)}})})})}(e,t);case J.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{kind:N.PRIVATE_INACCESSIBLE,organization:t.organization,relation:t.relation,requestOutbox:t.requestOutbox}}})})}(e,t);case J.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case J.VIEW_ORG_UNLOAD:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case J.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrativeId}),n=e.views.viewOrgView.viewModel.narratives.narratives.filter(function(e){return e.workspaceId!==t.narrativeId});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{organization:Object(F.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r,narrativeCount:r.length}),narratives:Object(F.a)({},e.views.viewOrgView.viewModel.narratives,{narratives:n})})})})})}(e,t);case J.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{organization:t.organization,narratives:Object(F.a)({},e.views.viewOrgView.viewModel.narratives,{narratives:t.narratives})})})})}):e}(e,t);case J.VIEW_ORG_SORT_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{narratives:Object(F.a)({},e.views.viewOrgView.viewModel.narratives,{sortBy:t.sortBy,narratives:t.narratives})})})})}):e}(e,t);case J.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==N.NORMAL?e:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{narratives:Object(F.a)({},e.views.viewOrgView.viewModel.narratives,{searchBy:t.searchBy,narratives:t.narratives})})})})}):e}(e,t);case J.VIEW_ORG_REMOVE_APP_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.apps.filter(function(e){return e.appId!==t.appId}),n=e.views.viewOrgView.viewModel.apps.apps.filter(function(e){return e.appId!==t.appId});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{organization:Object(F.a)({},e.views.viewOrgView.viewModel.organization,{apps:r,appCount:r.length}),apps:Object(F.a)({},e.views.viewOrgView.viewModel.apps,{apps:n})})})})})}(e,t)}return te(e,t)||ne(e,t)||ae(e,t)||re(e,t)||Ke(e,t)||Xe(e,t)||Xe(e,t)||et(e,t)}function rt(e,t){switch(t.type){case J.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.openRequests,s=r.searchTerms,o=r.sortField,l=r.sortDirection,c=r.filter,u=r.totalCount,E=r.filteredCount,d=r.selectedOrganizationId,m=r.error,v=r.searching;return Object(F.a)({},e,{loadingState:h.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,openRequests:i,searchTerms:s,sortField:o,sortDirection:l,filter:c,totalCount:u,filteredCount:E,selectedOrganizationId:d,error:m,searching:v}})}(e,t);case J.BROWSE_ORGS_SEARCH:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})}(e,t);case J.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{searchTerms:t.searchTerms,searching:!0})})}(e,t);case J.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{organizations:t.organizations,openRequests:t.openRequests,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})}(e,t);case J.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{searching:!1,error:t.error})})}(e,t);case J.BROWSE_ORGS_SORT_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{sortField:t.sortField,sortDirection:t.sortDirection,searching:!0})})}(e,t);case J.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{filter:r,searching:!0})})}(e,t);case J.BROWSE_ORGS_UNLOAD:return{loadingState:h.NONE,error:null,viewModel:null};default:return null}}var nt=function(e,t){switch(t.type){case J.AUTH_CHECK_START:return function(e,t){return Object(F.a)({},e,{auth:{status:m.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case J.AUTH_AUTHORIZED:return function(e,t){return Object(F.a)({},e,{auth:{status:m.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case J.AUTH_UNAUTHORIZED:return function(e,t){return Object(F.a)({},e,{auth:{status:m.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case J.AUTH_CHECK_ERROR:return function(e,t){return Object(F.a)({},e,{auth:{status:m.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var at=function(e,t){switch(t.type){case J.APP_SUCCESS:return function(e,t){return Object(F.a)({},e,{app:{status:p.READY,config:t.config}})}(e,t);default:return null}};var it=function(e,t){switch(t.type){case J.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case J.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case J.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case J.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case J.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{manageOrganizationRequestsView:Object(F.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(F.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var st=function(e,t){switch(t.type){case J.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewMembersView:Object(F.a)({},e.views.viewMembersView,{loadingState:h.LOADING,viewModel:null,error:null})})})}(e);case J.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewMembersView:Object(F.a)({},e.views.viewMembersView,{loadingState:h.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case J.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewMembersView:Object(F.a)({},e.views.viewMembersView,{loadingState:h.ERROR,viewModel:null,error:t.error})})})}(e,t);case J.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewMembersView:Object(F.a)({},e.views.viewMembersView,{loadingState:h.NONE,viewModel:null,error:null})})})}(e);case J.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=c.ADMIN,e):e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewMembersView:Object(F.a)({},e.views.viewMembersView,{viewModel:Object(F.a)({},e.views.viewMembersView.viewModel,{organization:Object(F.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case J.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=c.MEMBER,e):e});return Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewMembersView:Object(F.a)({},e.views.viewMembersView,{viewModel:Object(F.a)({},e.views.viewMembersView.viewModel,{organization:Object(F.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}};function ot(e,t){switch(t.type){case J.INVITE_USER_LOAD_START:return{state:T.LOADING,viewModel:null,error:null};case J.INVITE_USER_LOAD_SUCCESS:return function(e,t){return{state:T.OK,error:null,viewModel:{editState:w.EDITING,users:t.users,organization:t.organization,selectedUser:null}}}(0,t);case J.INVITE_USER_LOAD_ERROR:return function(e,t){return{state:T.ERROR,error:t.error,viewModel:null}}(0,t);case J.INVITE_USER_UNLOAD:return{state:T.NONE,error:null,viewModel:null};case J.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{users:t.users})})}(e,t);case J.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})}(e,t);case J.INVITE_USER_SEND_INVITATION_START:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{editState:w.SENDING})})}(e);case J.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=e.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=Ae.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=Ae.MEMBER_INVITATION_PENDING),e});return Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{editState:w.SUCCESS,selectedUser:n,users:i})})}(e);case J.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{editState:w.ERROR})})}(e);default:return null}}var lt=function(e,t){if(!function(e){switch(e.type){case J.INVITE_USER_LOAD_START:case J.INVITE_USER_LOAD_SUCCESS:case J.INVITE_USER_LOAD_ERROR:case J.INVITE_USER_UNLOAD:case J.INVITE_USER_SEARCH_USERS_SUCCESS:case J.INVITE_USER_SELECT_USER_SUCCESS:case J.INVITE_USER_SEND_INVITATION_START:case J.INVITE_USER_SEND_INVITATION_SUCCESS:case J.INVITE_USER_SEND_INVITATION_ERROR:return!0;default:return!1}}(t))return null;if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;var r=ot(e.views.viewOrgView.viewModel.subViews.inviteUserView,t);return null===r?null:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{inviteUserView:r})})})})})};function ct(){return{type:o.OK,validatedAt:new Date}}function ut(e){return e.editableMemberProfile.title.syncState===i.DIRTY?s.EDITED:s.UNEDITED}function Et(e,t){switch(t.type){case J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(F.a)({},e,{state:T.LOADING,error:null,viewModel:null})}(e);case J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(F.a)({},e,{state:T.OK,error:null,viewModel:{organization:t.organization,editableMemberProfile:t.editableMemberProfile,editState:s.UNEDITED,saveState:l.NEW,validationState:ct()}})}(e,t);case J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return{state:T.ERROR,error:t.error,viewModel:null}}(0,t);case J.VIEW_ORG_MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{state:T.NONE,error:null,viewModel:null})}(e);case J.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r,n=e.viewModel.editableMemberProfile;r=t.title!==n.title.remoteValue?i.DIRTY:i.CLEAN;var a=Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{editableMemberProfile:Object(F.a)({},e.viewModel.editableMemberProfile,{title:{value:t.title,remoteValue:t.title,syncState:r,validationState:ct()}})})}),s=ut(a.viewModel);return Object(F.a)({},a,{viewModel:Object(F.a)({},a.viewModel,{editState:s})})}(e,t);case J.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=ut(e.viewModel);return Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{editState:r,validationState:{type:o.OK,validatedAt:new Date}})})}(e);case J.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_ERROR:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{validationState:{type:o.ERROR,message:"Validation error(s)",validatedAt:new Date}})})}(e);case J.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{editState:s.UNEDITED,saveState:l.SAVED,editableMemberProfile:Object(F.a)({},e.viewModel.editableMemberProfile,{title:Object(F.a)({},e.viewModel.editableMemberProfile.title,{syncState:i.CLEAN})})})})}(e);default:return null}}function dt(e,t){if(!function(e){switch(e.type){case J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_START:case J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_SUCCESS:case J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_ERROR:case J.VIEW_ORG_MANAGE_MEMBERSHIP_UNLOAD:case J.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:case J.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:case J.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_ERROR:case J.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_SUCCESS:return!0;default:return!1}}(t))return null;if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;var r=Et(e.views.viewOrgView.viewModel.subViews.manageMembershipView,t);return null===r?null:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{manageMembershipView:r})})})})})}function mt(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{saveState:l.SAVING})})}function vt(e,t){switch(t.type){case J.REQUEST_ADD_NARRATIVE_LOAD_START:return{state:T.LOADING,error:null,viewModel:null};case J.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return{state:T.OK,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,selectionState:A.NONE,saveState:l.SAVED}}}(0,t);case J.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return{state:T.ERROR,error:t.error,viewModel:null}}(0,t);case J.REQUEST_ADD_NARRATIVE_SEND_START:return mt(e);case J.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{saveState:l.SAVED})}),n=r.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=_.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=_.REQUESTED),e}),r}(e,t);case J.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return mt(e);case J.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{error:null,viewModel:Object(F.a)({},e.viewModel)})}(e);case J.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{error:null,viewModel:Object(F.a)({},e.viewModel,{selectedNarrative:t.narrative})})}(e,t);case J.REQUEST_ADD_NARRATIVE_UNLOAD:return{state:T.NONE,error:null,viewModel:null};case J.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(F.a)({},e,{viewModel:Object(F.a)({},e.viewModel,{narratives:t.narratives})})}(e,t);default:return null}}function pt(e,t){if(!function(e){switch(e.type){case J.REQUEST_ADD_NARRATIVE_LOAD_START:case J.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:case J.REQUEST_ADD_NARRATIVE_LOAD_ERROR:case J.REQUEST_ADD_NARRATIVE_SEND_START:case J.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:case J.REQUEST_ADD_NARRATIVE_LOAD_ERROR:case J.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:case J.REQUEST_ADD_NARRATIVE_UNLOAD:case J.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:return!0;default:return!1}}(t))return null;if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==N.NORMAL)return e;var r=vt(e.views.viewOrgView.viewModel.subViews.requestNarrativeView,t);return null===r?null:Object(F.a)({},e,{views:Object(F.a)({},e.views,{viewOrgView:Object(F.a)({},e.views.viewOrgView,{viewModel:Object(F.a)({},e.views.viewOrgView.viewModel,{subViews:Object(F.a)({},e.views.viewOrgView.viewModel.subViews,{requestNarrativeView:r})})})})})}function Ot(e,t){switch(t.type){case J.ENTITY_ORGANIZATION_LOAD_SUCCESS:return function(e,t){var r=new Map(e.entities.organizations.byId);return r.set(t.organization.id,t.organization),Object(F.a)({},e,{entities:Object(F.a)({},e.entities,{organizations:Object(F.a)({},e.entities.organizations.byId,{byId:r})})})}(e,t);default:return null}}function ht(e,t){switch(t.type){case J.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(F.a)({},e,{entities:Object(F.a)({},e.entities,{users:Object(F.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case J.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(F.a)({},e,{entities:Object(F.a)({},e.entities,{orgs:Object(F.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case J.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(F.a)({},e,{entities:Object(F.a)({},e.entities,{narratives:Object(F.a)({},e.entities.narratives,{byId:new Map(r.byId)})})})}(e,t);case J.ENTITY_LOAD_APP_SUCCESS:return function(e,t){var r=e.entities.apps;return r.byId.set(t.app.id,t.app),Object(F.a)({},e,{entities:Object(F.a)({},e.entities,{apps:Object(F.a)({},e.entities.narratives,{byId:new Map(r.byId)})})})}(e,t)}return Ot(e,t)}function Rt(e,t){switch(t.type){case J.DATA_SERVICE_LOAD_SUCCESS:return function(e,t){return Object(F.a)({},e,{db:Object(F.a)({},e.db)})}(e);default:return null}}var wt,_t=function(e,t){return K(e,t)||ee(e,t)||function(e,t){var r=rt(e.views.browseOrgsView,t);return r?Object(F.a)({},e,{views:Object(F.a)({},e.views,{browseOrgsView:r})}):null}(e,t)||tt(e,t)||nt(e,t)||at(e,t)||it(e,t)||st(e,t)||lt(e,t)||dt(e,t)||pt(e,t)||ht(e,t)||Rt(e,t)||e},gt=(r(174),r(148)),ft=r(57),At=(r(176),r(37)),St=r(320),Nt=r(322),bt=r(66),It=r.n(bt),Tt=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLogoUrl",value:function(){return this.props.logoUrl?M.createElement("img",{src:this.props.logoUrl,width:this.props.size}):M.createElement("span",null,"n/a")}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultInitial",value:function(){var e=this.charAt(this.props.organizationName,0).toUpperCase(),t=It()(this.props.organizationId).substr(0,6);return M.createElement("svg",{width:this.props.size,height:this.props.size,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},M.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:this.props.size-12,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogo",value:function(){return this.props.logoUrl?this.renderLogoUrl():this.renderDefaultInitial()}},{key:"render",value:function(){return this.renderLogo()}}]),t}(M.Component),yt=r(156),Mt=r(21),Dt=r(312),Ct=r(318),kt=r(314),Vt=(r(179),r(180),r(117)),Ut=r.n(Vt),zt=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:Ut.a;case"silhouette":case"mysteryman":default:return Ut.a}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return M.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(M.Component);function jt(e){switch(e){case wt.COMPACT:return wt.NORMAL;case wt.NORMAL:return wt.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(wt||(wt={}));var Gt=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={view:wt.COMPACT},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onToggleView",value:function(){this.setState({view:jt(this.state.view)})}},{key:"renderRole",value:function(){return M.createElement("span",null,M.createElement(Mt.a,{type:"crown"})," owner")}},{key:"renderAvatar",value:function(){if(this.props.showAvatar)return M.createElement("div",{className:"Owner-avatarCol"},M.createElement(zt,{user:this.props.user,size:this.props.avatarSize||30}))}},{key:"renderCompact",value:function(){var e=M.createElement("div",null,M.createElement("div",null,this.props.user.realname),M.createElement("div",null,M.createElement("span",null,M.createElement(zt,{user:this.props.user,size:20}))," ",M.createElement("span",null,this.props.user.username)));return M.createElement("div",{className:"Owner-owner"},this.renderAvatar(),M.createElement("div",{className:"Owner-infoCol"},M.createElement("div",{className:"Owner-name"},M.createElement(yt.a,{placement:"bottomRight",title:e},M.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))))}},{key:"renderNormal",value:function(){return M.createElement("div",{className:"Owner View-NORMAL"},M.createElement("div",{className:"Owner-controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===wt.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===wt.NORMAL?"up":"down")}))),M.createElement("div",{className:"Owner-avatarCol"},M.createElement(zt,{user:this.props.user,size:this.props.avatarSize||30})),M.createElement("div",{className:"Owner-infoCol"},M.createElement("div",{className:"Owner-name"},M.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),M.createElement("div",{className:"Owner-username"},this.props.user.username),M.createElement("div",{className:"Owner-title"},this.props.user.title||M.createElement("i",null,"no title in user profile")),M.createElement("div",{className:"Owner-organization"},this.props.user.organization||M.createElement("i",null,"no organization in user profile")),M.createElement("div",{className:"Owner-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||M.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){return this.renderCompact()}}]),t}(M.Component);function Lt(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function Pt(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:Lt(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:"r"===e[6],lockStatus:e[7],metadata:e[8]}}function xt(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:Lt(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}var Bt=function(e){function t(e){var r,n=e.name,a=e.code,i=e.message,s=e.error;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,i))).name=void 0,r.code=void 0,r.error=void 0,r.name=n,r.code=a,r.error=s,r}return Object(G.a)(t,e),t}(Object(Y.a)(Error)),Wt=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),t}(Object(Y.a)(Error)),qt=function(){function e(t){var r=t.url,n=t.token;Object(V.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n||null}return Object(U.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=9;break}return e.next=3,t.json();case 3:return r=e.sent,n=Object(ce.a)(r.result,1),a=n[0],e.abrupt("return",a);case 9:if(204!==t.status){e.next=12;break}return void 0,e.abrupt("return",void 0);case 12:if(500!==t.status){e.next=25;break}if("application/json"!==t.headers.get("Content-Type")){e.next=21;break}return e.next=16,t.json();case 16:throw i=e.sent,s=i.error,new Bt(s);case 21:return e.next=23,t.text();case 23:throw o=e.sent,new Wt(o);case 25:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 26:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Headers).set("Content-Type","application/json"),n.set("Accept","application/json"),this.token&&n.set("Authorization",this.token),e.next=6,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:n,body:JSON.stringify(this.makePayload(t,r))});case 6:return a=e.sent,e.abrupt("return",this.processResponse(a));case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}();qt.module=void 0;var Ht=function(e){function t(e){var r;if(Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"callFunc",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(qt),Ft=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"getVersion",value:function(){var e=Object(le.a)(oe.a.mark(function e(){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("ver",null));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getObjectInfo3",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.callFunc("get_object_info3",t),e.abrupt("return",r);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getWorkspaceInfo",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("get_workspace_info",t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(Ht);Ft.module="Workspace";var Qt=r(70),Yt=r.n(Qt),Jt=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"getServiceStatus",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("get_service_status",t);case 2:if(!((r=e.sent).result&&r.result.length>0)){e.next=10;break}if(n=r.result[0]){e.next=7;break}throw new Error("Crazy at it seems, no result");case 7:return e.abrupt("return",n);case 10:throw new Error("Crazy at it seems, no result");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(we);Jt.module="ServiceWizard";var Zt=function(e){function t(e){var r,n=e.name,a=e.code,i=e.message,s=e.error;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,i))).name=void 0,r.code=void 0,r.error=void 0,r.name=n,r.code=a,r.error=s,r}return Object(G.a)(t,e),t}(Object(Y.a)(Error)),Kt=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),t}(Object(Y.a)(Error)),Xt=function(e){function t(e){var r;if(Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"callFunc",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(V.a)(this,e),this.url=void 0,this.token=void 0,this.module=void 0,this.url=r,this.token=n||null,this.module=a}return Object(U.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=8;break}return e.next=3,t.json();case 3:return r=e.sent,n=r.result,e.abrupt("return",n);case 8:if(204!==t.status){e.next=11;break}return null,e.abrupt("return",null);case 11:if(500!==t.status){e.next=24;break}if("application/json"!==t.headers.get("Content-Type")){e.next=20;break}return e.next=15,t.json();case 15:throw a=e.sent,i=a.error,new Zt(i);case 20:return e.next=22,t.text();case 22:throw s=e.sent,new Kt(s);case 24:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 25:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),$t=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(V.a)(this,e),this.cache=void 0,this.cacheLifetime=void 0,this.monitoringFrequency=void 0,this.waiterTimeout=void 0,this.waiterFrequency=void 0,this.isMonitoring=void 0,this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(U.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new Yt.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var s=(new Date).getTime()-a;s>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+s))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):Yt.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),er=function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,s=t.rpcContext;if(Object(V.a)(this,e),this.token=void 0,this.timeout=void 0,this.rpcContext=void 0,this.url=void 0,this.version=void 0,this.token=r,this.timeout=i||1e4,this.rpcContext=s||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(U.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return $t.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){var t=new Jt({url:e.url,token:e.token});return Yt.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new Xt({module:n.module_name,url:n.url,token:r.token});return Yt.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}();er.module=void 0;var tr,rr,nr,ar=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"listNarratives",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:return r=e.sent,n=Object(ce.a)(r,1),a=n[0],e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(er);ar.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(tr||(tr={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(rr||(rr={})),function(e){e.TITLE="TITLE",e.LAST_SAVED="LAST_SAVED"}(nr||(nr={}));var ir,sr=function(){function e(t){Object(V.a)(this,e),this.params=void 0,this.params=t}return Object(U.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l,c,u;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ar({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new He({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL,userProfileServiceURL:this.params.userProfileServiceURL}),a=new he({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:if(i=e.sent,s=Object(ce.a)(i,3),o=s[0],l=s[1],c=s[2],l.kind!==be.INACCESSIBLE_PRIVATE){e.next=12;break}throw new Error("Cannot get own narratives for private inaccessible organization");case 12:return u=l.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",o.narratives.map(function(e){return{workspaceInfo:Pt(e.ws),objectInfo:xt(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){return{status:-1!==u.indexOf(e.workspaceInfo.id)?tr.ASSOCIATED:c.find(function(t){return t.resourceType===Ee.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?tr.REQUESTED:tr.NONE,narrative:{access:rr.OWNER,isPublic:e.workspaceInfo.globalReadPermission,workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,owner:e.workspaceInfo.owner,lastSavedAt:e.objectInfo.savedAt,lastSavedBy:e.objectInfo.savedBy}}}).sort(function(e,t){return e.narrative.title.localeCompare(t.narrative.title)}));case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSorter",value:function(e){switch(e){case nr.TITLE:return function(e,t){return e.narrative.title.localeCompare(t.narrative.title)};case nr.LAST_SAVED:return function(e,t){return t.narrative.lastSavedAt.getTime()-e.narrative.lastSavedAt.getTime()};default:throw new Error("invalid sort spec")}}},{key:"sortOrganizationNarratives",value:function(e,t){var r=this.getSorter(t);return e.sort(r).slice(0)}},{key:"getNarrative",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l,c;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ft({url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getWorkspaceInfo({id:t});case 4:if(n=e.sent,a=Pt(n),i=a.metadata.narrative){e.next=9;break}return e.abrupt("return",{workspaceId:t,access:rr.NONE});case 9:return s=parseInt(i,10),e.prev=10,e.next=13,r.getObjectInfo3({objects:[{wsid:t,objid:s}],includeMetadata:1,ignoreErrors:0});case 13:o=e.sent,e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(10),e.abrupt("return",{workspaceId:t,access:rr.NONE});case 19:l=xt(o.infos[0]),e.t1=a.userPermission,e.next="n"===e.t1?23:"r"===e.t1?29:"w"===e.t1?31:"a"===e.t1?33:35;break;case 23:if(!a.globalReadPermission){e.next=28;break}return c=rr.VIEW,e.abrupt("break",36);case 28:throw new Error("Cannot have no access and no global read permission!");case 29:return c=rr.VIEW,e.abrupt("break",36);case 31:return c=rr.EDIT,e.abrupt("break",36);case 33:return c=a.owner===this.params.username?rr.OWNER:rr.ADMIN,e.abrupt("break",36);case 35:throw new Error("Unknown workspace permission: "+a.userPermission);case 36:return e.abrupt("return",{workspaceId:a.id,access:c,isPublic:a.globalReadPermission,objectId:l.id,title:a.metadata.narrative_nice_name||"Unknown",owner:a.owner,lastSavedAt:l.savedAt,lastSavedBy:l.savedBy});case 39:throw e.prev=39,e.t2=e.catch(1),console.error("Error fetching narrative!",e.t2),e.t2;case 43:case"end":return e.stop()}},e,this,[[1,39],[10,16]])}));return function(t){return e.apply(this,arguments)}}()}]),e}(),or=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"version",value:function(){var e=Object(le.a)(oe.a.mark(function e(){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("version",void 0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"list_methods",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_methods",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"get_method_full_info",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("get_method_full_info",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(Ht);or.module="NarrativeMethodStore",function(e){e.APP="app",e.VIEWER="viewer",e.EDITOR="editor",e.ADVANCED_VIEWER="advanced_viewer"}(ir||(ir={}));var lr=function(e){return e||{url:null}},cr=function(e){switch(e){case"app":return ir.APP;case"editor":return ir.EDITOR;case"viewer":return ir.VIEWER;case"advanced_viewer":return ir.ADVANCED_VIEWER;default:throw new Error("Invalid app type: "+e)}},ur=function(e){return{relatedMethods:e.related_methods,nextMethods:e.next_methods,relatedApps:e.related_apps,nextApps:e.next_apps}},Er=function(e){return e.map(function(e){return{pubMedID:e.pmid,displayText:e.display_text,link:e.link}})};function dr(e){var t=e.id,r=e.module_name,n=e.git_commit_hash,a=e.name,i=e.ver,s=e.authors,o=e.kb_contributors,l=e.contact,c=e.subtitle,u=e.tooltip,E=e.description,d=e.technical_description,m=e.app_type,v=e.suggestions,p=e.icon,O=e.categories,h=e.screenshots,R=e.publications;return{id:t,moduleName:r,gitCommitHash:n,name:a,version:i,authors:s,kbaseContributors:o,contact:l,subtitle:c,tooltip:u,description:E,technicalDescription:d,appType:cr(m),suggestions:ur(v),icon:lr(p),categories:O,screenshots:h,publications:Er(R)}}function mr(e){var t=e.id,r=e.module_name,n=e.git_commit_hash,a=e.name,i=e.ver,s=e.subtitle,o=e.tooltip,l=e.icon,c=e.categories,u=e.loading_error,E=e.authors,d=e.input_types,m=e.output_types,v=e.app_type;return{id:t,moduleName:r,gitCommitHash:n,name:a,version:i,subtitle:s,tooltip:o,iconURL:l?l.url:null,categories:c,loadingError:u,authors:E,inputTypes:d,outputTypes:m,appType:cr(v)}}var vr=function(){function e(t){Object(V.a)(this,e),this.token=void 0,this.narrativeMethodStoreURL=void 0,this.token=t.token,this.narrativeMethodStoreURL=t.narrativeMethodStoreURL}return Object(U.a)(e,[{key:"getApp",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new or({url:this.narrativeMethodStoreURL,token:this.token}),e.next=3,r.get_method_full_info({ids:[t],tag:"release"});case 3:return n=e.sent,a=Object(ce.a)(n,1),i=a[0],e.abrupt("return",dr(i));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function pr(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,s=e.info;return{code:t,message:r,detail:n,id:Ye()(),at:new Date,history:a,trace:i,info:s}}function Or(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,s=i.token,i.username,o=a.app.config,l=new Te({token:s,userProfileServiceURL:o.services.UserProfile.url}),t.prev=3,t.next=6,l.getUser(e);case 6:c=t.sent,r((E=c,{type:J.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((u={code:"error",message:t.t0.message},{type:J.ENTITY_USER_LOADER_ERROR,error:u}));case 13:case"end":return t.stop()}var u,E},t,null,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function hr(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,c=new sr({token:s,username:o,workspaceServiceURL:l.services.Workspace.url,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,userProfileServiceURL:l.services.UserProfile.url}),t.prev=3,t.next=6,c.getNarrative(e);case 6:u=t.sent,r({type:J.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:J.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 13:case"end":return t.stop()}},t,null,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}var Rr=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).times=void 0,r.times=0,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.times+=1,this.props.user?M.createElement(Gt,{user:this.props.user,avatarSize:this.props.avatarSize,showAvatar:this.props.showAvatar}):M.createElement("div",null,M.createElement(Mt.a,{type:"loading"})," ","Loading owner...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.username)}}]),t}(M.Component);var wr=Object(W.b)(function(e,t){return{user:e.entities.users.byId.get(t.username)}},function(e){return{onLoad:function(t){e(Or(t))}}})(Rr);r(230);function _r(e){var t,r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.now||new Date,s=Math.round((i.getTime()-e.getTime())/1e3),o=Math.abs(s);if(o<86400*(a.absoluteAfter||90)){if(0===o)return"now";o<60?(t=s,r=o,n="second"):o<3600?(t=Math.round(s/60),r=Math.round(o/60),n="minute"):o<86400?(t=Math.round(s/3600),r=Math.round(o/3600),n="hour"):(t=Math.round(s/86400),r=Math.round(o/86400),n="day"),r>1&&(n+="s");var l=null,c=null;return t<0?l="in":t>0&&(c="ago"),(l?l+" ":"")+r+" "+n+(c?" "+c:"")}return a.compactDate&&i.getFullYear()===e.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var gr=[[6e4,500],[36e5,3e4],[864e5,18e5],[1/0,864e5]],fr=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).nowTimer=void 0,r.interval=void 0,r.nowTimer=null,r.state={now:new Date},r.interval=r.calcInterval(),r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"calcInterval",value:function(){for(var e=this.state.now.getTime()-this.props.time.getTime(),t=0;t<gr.length;t++){var r=gr[t],n=Object(ce.a)(r,2),a=n[0],i=n[1];if(e<a)return i}throw new Error("did not find interval")}},{key:"handleInterval",value:function(){this.setState({now:new Date});var e=this.calcInterval();this.interval!==e&&(this.interval=e,this.startIntervalTimer())}},{key:"startIntervalTimer",value:function(){var e=this;this.nowTimer&&window.clearInterval(this.nowTimer),this.nowTimer=window.setInterval(function(){e.handleInterval()},this.interval)}},{key:"componentDidMount",value:function(){this.startIntervalTimer()}},{key:"componentWillUnmount",value:function(){this.nowTimer&&window.clearInterval(this.nowTimer)}},{key:"render",value:function(){if(!1===this.props.showTooltip)return M.createElement("span",null,_r(this.props.time,{absoluteAfter:30,now:this.state.now}));var e,t=M.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(this.props.time));return e=this.props.tooltipPrefix?M.createElement("span",null,this.props.tooltipPrefix,t):t,M.createElement(yt.a,{placement:"bottomRight",title:e},_r(this.props.time,{absoluteAfter:30,now:this.state.now}))}}]),t}(M.Component);function Ar(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var Sr=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Ar(this.state.view)})}},{key:"renderLogo",value:function(e){return M.createElement(Tt,{logoUrl:e.logoUrl,size:80,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(!e.homeUrl)return M.createElement(yt.a,{placement:"bottomRight",title:"This organization has not set a home page url"},M.createElement(Mt.a,{type:"home",style:{color:"rgba(200, 200, 200, 0.3)"}}));var t=M.createElement(M.Fragment,null,M.createElement("p",null,"Home page for this Organization (external to KBase)"));return M.createElement("div",{className:"BriefOrganization-homeUrl"},M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:t},M.createElement("a",{href:e.homeUrl,target:"_blank"},M.createElement(Mt.a,{type:"home"}))))}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?M.createElement("span",null,e.narrativeCount):M.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return 1==e.memberCount?M.createElement("span",{style:{color:"gray"}},"\xd8"):M.createElement("span",null,e.memberCount-1)}},{key:"renderRelation",value:function(e){switch(e.relation){case Ae.NONE:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},M.createElement("span",null,M.createElement(Mt.a,{type:"stop"})));case Ae.VIEW:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},M.createElement(Mt.a,{type:"stop"}));case Ae.MEMBER_REQUEST_PENDING:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"Your membership request is pending"},M.createElement(Mt.a,{type:"user",style:{color:"orange"}})," Your membership ",M.createElement("b",null,"request")," is pending");case Ae.MEMBER_INVITATION_PENDING:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this organization"},M.createElement(Mt.a,{type:"user",style:{color:"blue"}}));case Ae.MEMBER:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},M.createElement(Mt.a,{type:"user"}));case Ae.ADMIN:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an administrator of this organization"},M.createElement(Mt.a,{type:"robot"}));case Ae.OWNER:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are the owner of this organization"},M.createElement(Mt.a,{type:"crown"}))}}},{key:"renderPrivacy",value:function(){return this.props.organization.isPrivate?M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is private - may only be viewed by members"},M.createElement("span",null,M.createElement(Mt.a,{type:"unlock"}))):M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is public - may be viewed by any KBase user"},M.createElement("span",null,M.createElement(Mt.a,{type:"global"})))}},{key:"renderOrgFreshness",value:function(e){var t;if(e.lastVisitedAt&&e.modifiedAt.getTime()>e.lastVisitedAt.getTime()){t=M.createElement("div",null,M.createElement(yt.a,{placement:"topRight",title:"This org has changed since your last visit to it; new or updated items are highlighted"},M.createElement("span",{style:{color:"red",fontSize:"120%"}},M.createElement(Mt.a,{type:"bell",theme:"filled"}))))}else t=M.createElement("div",null,M.createElement("span",{style:{color:"transparent",fontSize:"120%"}},M.createElement(Mt.a,{type:"bell",theme:"filled"})));var r;return r=null,M.createElement("div",null,t,r)}},{key:"renderRequests",value:function(){if(this.props.organization.relation===Ae.ADMIN||this.props.organization.relation===Ae.OWNER){var e,t;switch(this.props.openRequestsStatus){case Ie.NONE:e="There are no open requests for this organization",t="rgba(200, 200, 200, 0.3)";break;case Ie.NEW:e="There are new requests since you last visited this organization",t="red";break;case Ie.OLD:e="There are open requests for this organization",t="blue";break;case Ie.INAPPLICABLE:return;default:return void console.warn("Invalid open request status: "+this.props.openRequestsStatus)}var r=M.createElement("span",null,e);return M.createElement(yt.a,{placement:"topRight",title:r},M.createElement("span",{style:{color:t,fontSize:"80%"}},M.createElement(Mt.a,{type:"mail",theme:"filled"})))}}},{key:"renderPermalink",value:function(){var e=M.createElement("div",null,M.createElement("p",null,'Below is the "permalink" for this organization. You may copy this url and use it to access this organization in a web browser.'),M.createElement("p",{style:{fontFamily:"monospace",fontWeight:"bold"}},window.location.origin,"/#org/",this.props.organization.id)),t=M.createElement(Ct.a,{onClick:function(t){t.key;Dt.a.info({title:"Org Permalink",content:e})}},M.createElement(Ct.a.Item,{key:"view"},"View Permalink"));return M.createElement(kt.a,{overlay:t,trigger:["click","contextMenu"]},M.createElement("a",{href:"/#orgs/"+this.props.organization.id},M.createElement(Mt.a,{type:"link"})))}},{key:"renderLogoColumn",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"BriefOrganization-logoRow"},M.createElement(Nt.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),M.createElement("div",{className:"BriefOrganization-statusRow"},M.createElement("div",{className:"BriefOrganization-relationCol"},this.renderRelation(e)),M.createElement("div",{className:"BriefOrganization-privacyCol"},this.renderPrivacy()),M.createElement("div",{className:"BriefOrganization-homeLinkCol"},this.renderHomeUrl(e))),M.createElement("div",{className:"BriefOrganization-freshnessRow"},M.createElement("div",{className:"BriefOrganization-orgFreshnessCol"},this.renderOrgFreshness(e)),M.createElement("div",{className:"BriefOrganization-openRequestsCol"},this.renderRequests()),M.createElement("div",{className:"BriefOrganization-openNewRequestsCol"},this.renderPermalink())))}},{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderInfoCol",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),M.createElement("div",{className:"BriefOrganization-orgOwner BriefOrganization-infoTableRow"},M.createElement("div",{className:"BriefOrganization-infoTableCol1"},M.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"owner")),M.createElement("div",{className:"BriefOrganization-infoTableCol2"},M.createElement(wr,{username:e.owner.username,avatarSize:16,showAvatar:!1,key:e.owner.username}))),M.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},M.createElement("div",{className:"BriefOrganization-infoTableCol1"},M.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"created")),M.createElement("div",{className:"BriefOrganization-infoTableCol2"},M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:this.fullTimestamp(e.createdAt)},M.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))))))}},{key:"renderMemberRow",value:function(e){var t,r=e.memberCount-1;return t=r?1===r?M.createElement("span",null,"There is ",M.createElement("b",null,"1")," member in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,r)," members in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,"no members")," in this organization"),M.createElement(yt.a,{placement:"bottomRight",title:t},M.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},M.createElement("div",{className:"BriefOrganization-infoTableCol1"},M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"team"}))),M.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderMemberCount(e))))}},{key:"renderNarrativeRow",value:function(e){var t,r=e.narrativeCount;return t=r?1===r?M.createElement("span",null,"There is ",M.createElement("b",null,"1")," narrative in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,r)," narratives in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,"no narratives")," in this organization"),M.createElement(yt.a,{placement:"bottomRight",title:t},M.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},M.createElement("div",{className:"BriefOrganization-infoTableCol1"},M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"file"}))),M.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderNarrativeCount(e))))}},{key:"renderModifiedRow",value:function(e){var t=M.createElement("span",null,"This organization was last updated"," ",M.createElement(fr,{time:e.modifiedAt,showTooltip:!0}));return M.createElement(yt.a,{placement:"bottomRight",title:t},M.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},M.createElement("div",{className:"BriefOrganization-infoTableCol1"},M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"save"}))),M.createElement("div",{className:"BriefOrganization-infoTableCol2"},M.createElement(fr,{time:e.modifiedAt,showTooltip:!0}))))}},{key:"renderStatsCol",value:function(e){return M.createElement(M.Fragment,null,this.renderMemberRow(e),this.renderNarrativeRow(e),this.renderModifiedRow(e))}},{key:"renderNormal",value:function(){var e=this.props.organization;return M.createElement("div",{className:"BriefOrganization"},M.createElement("div",{className:"BriefOrganization-body"},M.createElement("div",{className:"BriefOrganization-logoCol"},this.renderLogoColumn(e)),M.createElement("div",{className:"BriefOrganization-infoCol"},M.createElement("div",{className:"BriefOrganization-infoCol-row"},M.createElement("div",{className:"BriefOrganization-infoCol-col1"},M.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},M.createElement(Nt.a,{to:"/viewOrganization/".concat(e.id)},e.name)))),M.createElement("div",{className:"BriefOrganization-infoCol-row"},M.createElement("div",{className:"BriefOrganization-infoCol-col1"},this.renderInfoCol(e)),M.createElement("div",{className:"BriefOrganization-infoCol-col2"},this.renderStatsCol(e))))))}},{key:"render",value:function(){return this.renderNormal()}}]),t}(M.Component),Nr=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderAdminInfo",value:function(e){return M.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderNoOrgs",value:function(){var e;M.createElement(At.a,{size:"small",type:"default"},"browse"),M.createElement(At.a,{size:"small",type:"default"},"create");return e=this.props.myOrgsUnfiltered?M.createElement("div",null,M.createElement("p",null,"You neither own nor are a member of any Organizations, so there is nothing to show you here."),M.createElement("p",null,"You may use the ",M.createElement("b",null,"Create Organization")," button on the upper right to create your own Organization, or use the ",M.createElement("b",null,"All Orgs")," filter on the right to browse and search all public Organizations.")):M.createElement("div",null,M.createElement("p",null,"Sorry, no Organizations found.")),M.createElement(St.a,{type:"warning",style:{maxWidth:"50em",margin:"20px auto 0 auto"},message:e})}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,r){var n=e.props.openRequests.get(t.id)||null;return M.createElement("div",{key:String(r),className:"SimpleCard"},M.createElement(Sr,{organization:t,openRequestsStatus:n}))}):this.renderNoOrgs()}},{key:"render",value:function(){return M.createElement("div",{className:"Organizations"},M.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(M.Component);var br=Object(W.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");var t=e.views.browseOrgsView.viewModel;return{organizations:t.organizations,openRequests:t.openRequests}},function(e){return{}})(Nr),Ir=r(310),Tr=r(316),yr=r(319),Mr=(r(240),function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).searchInput=void 0,r.searchButton=void 0,r.filterByRoleValues=void 0,r.searchInput=M.createRef(),r.searchButton=M.createRef(),r.filterByRoleValues=[{label:"Member",value:"member"},{label:"Admin",value:"admin"},{label:"Owner",value:"owner"}],r.state={searchInput:"",filterByRoleType:"myorgs",filterByRole:[],filterByPrivacy:"any",showAdvancedControls:!1},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearchOrgs([])}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){switch(e){case"owner":this.props.onSortOrgs("owner",O.ASCENDING);break;case"name":this.props.onSortOrgs("name",O.ASCENDING);break;case"recentlyAdded":this.props.onSortOrgs("created",O.DESCENDING);break;case"recentlyChanged":this.props.onSortOrgs("changed",O.DESCENDING);break;case"memberCount":this.props.onSortOrgs("memberCount",O.DESCENDING);break;case"narrativeCount":this.props.onSortOrgs("narrativeCount",O.DESCENDING)}}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onFilterByRoleTypeChange",value:function(e){var t;this.setState({filterByRoleType:e.target.value}),"select"===e.target.value?(this.setState({filterByRole:[]}),t=Object(F.a)({},this.props.filter,{roleType:e.target.value})):(t=Object(F.a)({},this.props.filter,{roleType:e.target.value,roles:[]}),this.setState({filterByRole:[]})),this.props.onFilterOrgs(t)}},{key:"onFilterByRoleChange",value:function(e){var t;this.setState({filterByRole:e}),0===e.length?(this.setState({filterByRoleType:"myorgs"}),t=Object(F.a)({},this.props.filter,{roleType:"myorgs",roles:e})):(this.setState({filterByRoleType:"select"}),t=Object(F.a)({},this.props.filter,{roleType:"select",roles:e})),this.props.onFilterOrgs(t)}},{key:"onFilterByPrivacyChange",value:function(e){this.setState({filterByPrivacy:e.target.value});var t=Object(F.a)({},this.props.filter,{privacy:e.target.value});this.props.onFilterOrgs(t)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?M.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},"None available"):0===this.props.filteredCount?M.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},"\xd8 /",this.props.totalCount," ","orgs"):this.props.totalCount===this.props.filteredCount?M.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},M.createElement("b",null,this.props.totalCount)," ","orgs"):M.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},M.createElement("b",null,this.props.filteredCount),"/",this.props.totalCount," ","orgs")}},{key:"renderSearchIcon",value:function(){return this.props.searching?M.createElement(Mt.a,{type:"loading"}):M.createElement(Mt.a,{type:"search"})}},{key:"renderSearchForm",value:function(){return M.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},M.createElement("input",{className:"OrganizationsBrowser-searchInput",placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),M.createElement(At.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),M.createElement(At.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}),this.renderSearchFeedback())}},{key:"renderSearchBar",value:function(){return M.createElement("div",{className:"OrganizationsBrowser-searchBarRow"},M.createElement("div",{className:"OrganizationsBrowser-searchBarCol1"},this.renderSearchForm()),M.createElement("div",{className:"OrganizationsBrowser-searchBarCol2"},M.createElement(Nt.a,{to:"/newOrganization"},M.createElement(At.a,{type:"primary",icon:"plus-circle",style:{marginRight:"10px"}},"Create Organization"))))}},{key:"renderSortByControl",value:function(){return M.createElement(Ir.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,dropdownMatchSelectWidth:!0,style:{width:"10em"}},M.createElement(Ir.a.Option,{value:"recentlyChanged",key:"changed"},"Date Changed"),M.createElement(Ir.a.Option,{value:"recentlyAdded",key:"recent"},"Date Established"),M.createElement(Ir.a.Option,{value:"name",key:"name"},"Org Name"),M.createElement(Ir.a.Option,{value:"memberCount",key:"memberCount"},"# members"),M.createElement(Ir.a.Option,{value:"narrativeCount",key:"narrativeCount"},"# narratives"))}},{key:"onToggleAdvanced",value:function(){if(this.state.showAdvancedControls){this.setState({showAdvancedControls:!1});var e=this.props.filter,t=e.roleType,r=e.roles;e.privacy;["myorgs","all"].includes(t)||(t="myorgs",this.setState({filterByRoleType:"myorgs"})),this.setState({filterByRole:[],filterByPrivacy:"any"}),r=[],"any",this.props.onFilterOrgs({roleType:t,roles:r,privacy:"any"})}else this.setState({showAdvancedControls:!0})}},{key:"renderAdvancedToggle",value:function(){return this.state.showAdvancedControls?M.createElement(Mt.a,{type:"ellipsis",className:"IconButton-hover-pressed",onClick:this.onToggleAdvanced.bind(this)}):M.createElement(Mt.a,{type:"ellipsis",className:"IconButton-hover",onClick:this.onToggleAdvanced.bind(this)})}},{key:"renderFilterByRole",value:function(){var e={display:"block",height:"30px",lineHeight:"30px"};return this.state.showAdvancedControls?M.createElement(M.Fragment,null,M.createElement(Tr.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},M.createElement(Tr.a,{value:"myorgs",style:e},"My Orgs"),M.createElement(Tr.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle(),M.createElement(Tr.a,{value:"notmyorgs",style:e},"Not My Orgs"),M.createElement(Tr.a,{value:"select",style:e},"Specific Role")),M.createElement(yr.a.Group,{options:this.filterByRoleValues,value:this.state.filterByRole,className:"OrganizationsBrowser-checkboxGroup",onChange:this.onFilterByRoleChange.bind(this)})):M.createElement(M.Fragment,null,M.createElement(Tr.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},M.createElement(Tr.a,{value:"myorgs",style:e},"My Orgs"),M.createElement(Tr.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle()))}},{key:"renderFilterByPrivacy",value:function(){if(this.state.showAdvancedControls){var e={display:"block",height:"30px",lineHeight:"30px",margin:"0px"};return M.createElement(M.Fragment,null,M.createElement(Tr.a.Group,{onChange:this.onFilterByPrivacyChange.bind(this),value:this.state.filterByPrivacy},M.createElement(Tr.a,{value:"any",style:e},"Any"),M.createElement(Tr.a,{value:"public",style:e},"Visible"),M.createElement(Tr.a,{value:"private",style:e},"Hidden")))}}},{key:"renderOrganizations",value:function(){return this.props.error?M.createElement(St.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):(e=!("myorgs"!==this.props.filter.roleType||0!==this.props.filter.roles.length||"any"!==this.props.filter.privacy||this.searchInput.current&&0!==this.searchInput.current.value.length),M.createElement(br,{myOrgsUnfiltered:e}));var e}},{key:"renderFilterColumn",value:function(){return M.createElement(M.Fragment,null,M.createElement("div",{className:"field-label"},"sort by"),this.renderSortByControl(),M.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"filter"),this.renderFilterByRole(),this.state.showAdvancedControls?M.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"visibility"):null,this.renderFilterByPrivacy(),M.createElement("div",{style:{marginTop:"20px",textAlign:"center"}},M.createElement("hr",{style:{border:0,borderTop:"1px solid rgba(200, 200, 200, 0.4)",width:"80%"}}),M.createElement("a",{href:"https://docs.google.com/document/d/1xRpFjD3pqPIrHBjNDGht3hX-3y6A0eQRr_v51A5j2hk",target:"_blank"},"FAQ")))}},{key:"render",value:function(){return M.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},this.renderSearchBar(),M.createElement("div",{className:"OrganizationsBrowser-bodyRow"},M.createElement("div",{className:"OrganizationsBrowser-bodyCol scrollable-flex-column"},this.renderOrganizations()),M.createElement("div",{className:"OrganizationsBrowser-filterCol"},this.renderFilterColumn())))}}]),t}(M.Component));function Dr(e,t){return{type:J.BROWSE_ORGS_SORT_START,sortField:e,sortDirection:t}}function Cr(e){return{type:J.BROWSE_ORGS_SEARCH_START,searchTerms:e}}function kr(e,t,r){return{type:J.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t,openRequests:r}}function Vr(e){return{type:J.BROWSE_ORGS_SEARCH_ERROR,error:e}}function Ur(e){return{type:J.BROWSE_ORGS_FILTER_START,filter:e}}var zr=Object(W.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.openRequests,a=t.error;return{organizations:r,openRequests:n,totalCount:t.totalCount,filteredCount:t.filteredCount,filter:t.filter,error:a,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d,m,v,p,O,h,R,w;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Cr(e)),a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,l=s.username,c=a.app.config,null!==i.viewModel){t.next=5;break}return r(Vr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 5:return u=i.viewModel,E=u.sortField,d=u.sortDirection,m=u.filter,v=new He({token:o,username:l,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url}),t.prev=7,t.next=10,v.queryOrgs({searchTerms:e,sortField:E,sortDirection:d,filter:m,username:l});case 10:if(p=t.sent,O=p.organizations,h=p.total,!((R=O.filter(function(e){return e.relation===Ae.ADMIN||e.relation===Ae.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,v.getOpenRequestsStatus({organizationIds:R});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(kr(O,h,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(Vr({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,null,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onSortOrgs:function(t,r){e(function(e,t){return function(){var r=Object(le.a)(oe.a.mark(function r(n,a){var i,s,o,l,c,u,E,d,m,v,p,O,h,R,w;return oe.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n(Dr(e,t)),i=a(),s=i.views.browseOrgsView,o=i.auth.authorization,l=o.token,c=o.username,u=i.app.config,E=new He({token:l,username:c,groupsServiceURL:u.services.Groups.url,userProfileServiceURL:u.services.UserProfile.url}),null!==s.viewModel){r.next=6;break}return n(Vr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),r.abrupt("return");case 6:return d=s.viewModel,m=d.searchTerms,v=d.filter,r.prev=7,r.next=10,E.queryOrgs({searchTerms:m,filter:v,username:c,sortField:e,sortDirection:t});case 10:if(p=r.sent,O=p.organizations,h=p.total,!((R=O.filter(function(e){return e.relation===Ae.ADMIN||e.relation===Ae.OWNER}).map(function(e){return e.id})).length>0)){r.next=20;break}return r.next=17,E.getOpenRequestsStatus({organizationIds:R});case 17:w=r.sent,r.next=21;break;case 20:w=new Map;case 21:n(kr(O,h,w)),r.next=28;break;case 24:r.prev=24,r.t0=r.catch(7),console.error("Error querying orgs",r.t0.name,r.t0.message),n(Vr({code:r.t0.name,message:r.t0.message}));case 28:case"end":return r.stop()}},r,null,[[7,24]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onFilterOrgs:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d,m,v,p,O,h,R,w;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Ur(e)),a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,l=s.username,c=a.app.config,u=new He({token:o,username:l,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url}),null!==i.viewModel){t.next=6;break}return r(Vr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 6:return E=i.viewModel,d=E.searchTerms,m=E.sortField,v=E.sortDirection,t.prev=7,t.next=10,u.queryOrgs({searchTerms:d,filter:e,username:l,sortField:m,sortDirection:v});case 10:if(p=t.sent,O=p.organizations,h=p.total,!((R=O.filter(function(e){return e.relation===Ae.ADMIN||e.relation===Ae.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,u.getOpenRequestsStatus({organizationIds:R});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(kr(O,h,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(Vr({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,null,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Mr),jr=r(306),Gr=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement("div",null,"Loading Organizations..."," ",M.createElement(jr.a,null));return M.createElement(St.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return M.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return M.createElement(zr,{sortBy:"narrativeCount"})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var Lr,Pr=Object(W.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i,s,o,l,c,u,E,d,m,v,p,h,R,w;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:J.BROWSE_ORGS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,l=new He({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url}),c=[],u="narrativeCount",E=O.DESCENDING,d={roleType:"myorgs",roles:[],privacy:"any"},e.prev=7,e.next=10,l.queryOrgs({searchTerms:c,sortField:u,sortDirection:E,filter:d,username:s});case 10:if(m=e.sent,v=m.organizations,p=m.total,!((h=v.filter(function(e){return e.relation===Ae.ADMIN||e.relation===Ae.OWNER}).map(function(e){return e.id})).length>0)){e.next=20;break}return e.next=17,l.getOpenRequestsStatus({organizationIds:h});case 17:R=e.sent,e.next=21;break;case 20:R=new Map;case 21:w={rawOrganizations:v,organizations:v,openRequests:R,totalCount:p,filteredCount:v.length,sortField:u,sortDirection:E,filter:d,searchTerms:c,selectedOrganizationId:null,searching:!1,error:null},t((_=w,{type:J.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:_})),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),console.error("Error querying orgs",e.t0.name,e.t0.message),t(Vr({code:e.t0.name,message:e.t0.message}));case 29:case"end":return e.stop()}var _},e,null,[[7,25]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:J.BROWSE_ORGS_UNLOAD})}}})(Gr),xr=function(){function e(t){var r=t.delay;Object(V.a)(this,e),this.delay=void 0,this.canceled=void 0,this.timer=void 0,this.delay=r,this.canceled=!1,this.timer=null}return Object(U.a)(e,[{key:"start",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(Object(le.a)(oe.a.mark(function t(){return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.canceled){t.next=11;break}return t.prev=1,t.next=4,e.task();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.warn("debouncing process exception: "+t.t0.message);case 9:t.next=12;break;case 11:e.canceled=!1;case 12:e.timer=null;case 13:case"end":return t.stop()}},t,null,[[1,6]])})),this.delay)}},{key:"cancel",value:function(){this.timer&&(this.canceled=!0)}}]),e}(),Br=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"checkImageURL",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l,c;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.timeout,e.next=3,this.callFunc("check_image_url",[{url:r,timeout:n}]);case 3:if(a=e.sent,i=Object(ce.a)(a,2),s=Object(ce.a)(i[0],2),o=s[0],l=s[1],!(c=i[1])){e.next=11;break}throw new Error(c.message);case 11:if(!l){e.next=13;break}throw new Error(l.message);case 13:return e.abrupt("return",o);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"checkHTMLURL",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l,c;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.timeout,e.next=3,this.callFunc("check_html_url",[{url:r,timeout:n}]);case 3:if(a=e.sent,i=Object(ce.a)(a,2),s=Object(ce.a)(i[0],2),o=s[0],l=s[1],!(c=i[1])){e.next=11;break}throw new Error(c.message);case 11:if(!l){e.next=13;break}throw new Error(l.message);case 13:return e.abrupt("return",o);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(er);function Wr(e){return{type:J.ADD_ORG_SAVE_ERROR,error:e}}function qr(){return{type:J.ADD_ORG_EVALUATE_ERRORS}}function Hr(e){return{type:J.ADD_ORG_UPDATE_ID_PASS,id:e}}function Fr(e,t){return{type:J.ADD_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}function Qr(e,t){return{type:J.ADD_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:t}}function Yr(e,t){return{type:J.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function Jr(){return function(e,t){e({type:J.ADD_ORG_LOAD_START});var r,n={id:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:ye.validateOrgId("")[1]},name:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:ye.validateOrgName("")[1]},logoUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:ye.validateOrgLogoUrl("")[1]},homeUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:ye.validateOrgHomeUrl("")[1]},researchInterests:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:ye.validateOrgResearchInterests("")[1]},description:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:ye.validateOrgDescription("")[1]},isPrivate:{value:!1,remoteValue:null,syncState:i.CLEAN,validationState:{type:o.OK,validatedAt:new Date}}};e((r=n,{type:J.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(Kr())}}function Zr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:J.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.addOrgView.viewModel.newOrganization,o=r.app.config,l=new He({token:a,username:i,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url});s?l.addOrg(s,i).then(function(t){e(function(e){return{type:J.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",s,t),e(Wr({code:t.code||t.name,message:t.message,exception:t}))}):e(Wr({code:"app",message:"The new organization data does not yet exist"}))}else e(Wr({code:"invalid",message:"Unexpected condition: no view model"}))}}function Kr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState.type===o.OK&&a.id.validationState.type===o.OK&&a.logoUrl.validationState.type===o.OK&&a.homeUrl.validationState.type===o.OK&&a.researchInterests.validationState.type===o.OK&&a.description.validationState.type===o.OK?e({type:J.ADD_ORG_EVALUATE_OK}):e(qr())}else e(Wr({code:"invalid",message:"Unexpected condition: no view model"}))}}function Xr(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new He({token:r,username:n,groupsServiceURL:a.services.Groups.url,userProfileServiceURL:a.services.UserProfile.url})}function $r(e){return function(t){var r=ye.validateOrgName(e),n=Object(ce.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:J.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:J.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(Kr())}}Br.module="UIService";var en,tn=function(e){function t(e){var r,n=e.delay,a=e.dispatch,i=e.url,s=e.timeout,o=e.serviceWizardURL,l=e.token;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,{delay:n}))).dispatch=void 0,r.url=void 0,r.timeout=void 0,r.serviceWizardURL=void 0,r.token=void 0,r.dispatch=a,r.url=i,r.serviceWizardURL=o,r.token=l,r.timeout=s,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"task",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new Br({url:this.serviceWizardURL,token:this.token}),e.next=4,t.checkImageURL({url:this.url,timeout:this.timeout});case 4:if(r=e.sent,!this.canceled){e.next=7;break}return e.abrupt("return");case 7:if(!r.is_valid){e.next=11;break}this.dispatch((n=this.url,{type:J.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:n})),e.next=22;break;case 11:e.t0=r.error.code,e.next="not-found"===e.t0?14:"invalid-content-type"===e.t0?16:"missing-content-type"===e.t0?18:20;break;case 14:return this.dispatch(Fr(this.url,{type:o.ERROR,validatedAt:new Date,message:"This logo url does not exist"})),e.abrupt("break",22);case 16:return this.dispatch(Fr(this.url,{type:o.ERROR,validatedAt:new Date,message:"Invalid content type: "+r.error.info["content-type"]})),e.abrupt("break",22);case 18:return this.dispatch(Fr(this.url,{type:o.ERROR,validatedAt:new Date,message:"Missing content type"})),e.abrupt("break",22);case 20:return this.dispatch(Fr(this.url,{type:o.ERROR,validatedAt:new Date,message:"unknown error"})),e.abrupt("break",22);case 22:e.next=29;break;case 24:if(e.prev=24,e.t1=e.catch(0),!this.canceled){e.next=28;break}return e.abrupt("return");case 28:this.dispatch(Fr(this.url,{type:o.ERROR,validatedAt:new Date,message:"Error checking logo url: "+e.t1.message}));case 29:this.dispatch(Kr());case 30:case"end":return e.stop()}var n},e,this,[[0,24]])}));return function(){return e.apply(this,arguments)}}()}]),t}(xr);var rn=function(e){function t(e){var r,n=e.delay,a=e.dispatch,i=e.url,s=e.timeout,o=e.serviceWizardURL,l=e.token;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,{delay:n}))).dispatch=void 0,r.url=void 0,r.timeout=void 0,r.serviceWizardURL=void 0,r.token=void 0,r.dispatch=a,r.url=i,r.serviceWizardURL=o,r.token=l,r.timeout=s,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"task",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new Br({url:this.serviceWizardURL,token:this.token}),e.next=4,t.checkHTMLURL({url:this.url,timeout:this.timeout});case 4:if(r=e.sent,!this.canceled){e.next=7;break}return e.abrupt("return");case 7:if(!r.is_valid){e.next=11;break}this.dispatch((n=this.url,{type:J.ADD_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:n})),e.next=22;break;case 11:e.t0=r.error.code,e.next="not-found"===e.t0?14:"invalid-content-type"===e.t0?16:"missing-content-type"===e.t0?18:20;break;case 14:return this.dispatch(Qr(this.url,{type:o.ERROR,validatedAt:new Date,message:"This home url does not exist"})),e.abrupt("break",22);case 16:return this.dispatch(Qr(this.url,{type:o.ERROR,validatedAt:new Date,message:"Invalid content type: "+r.error.info["content-type"]})),e.abrupt("break",22);case 18:return this.dispatch(Qr(this.url,{type:o.ERROR,validatedAt:new Date,message:"Missing content type"})),e.abrupt("break",22);case 20:return this.dispatch(Qr(this.url,{type:o.ERROR,validatedAt:new Date,message:"unknown error"})),e.abrupt("break",22);case 22:e.next=29;break;case 24:if(e.prev=24,e.t1=e.catch(0),!this.canceled){e.next=28;break}return e.abrupt("return");case 28:this.dispatch(Qr(this.url,{type:o.ERROR,validatedAt:new Date,message:"Error checking home url: "+e.t1.message}));case 29:this.dispatch(Kr());case 30:case"end":return e.stop()}var n},e,this,[[0,24]])}));return function(){return e.apply(this,arguments)}}()}]),t}(xr);var nn,an=function(e){function t(e){var r,n=e.delay,a=e.model,i=e.dispatch,s=e.id;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,{delay:n}))).model=void 0,r.dispatch=void 0,r.id=void 0,r.model=a,r.dispatch=i,r.id=s,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"task",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.model.orgExists(this.id);case 3:if(t=e.sent,!this.canceled){e.next=6;break}return e.abrupt("return");case 6:t?this.dispatch(Yr(this.id,{type:o.ERROR,validatedAt:new Date,message:"This org id is already in use"})):this.dispatch((r=this.id,{type:J.ADD_ORG_UPDATE_ID_SUCCESS,id:r})),e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(0),!this.canceled){e.next=13;break}return e.abrupt("return");case 13:this.dispatch(Yr(this.id,{type:o.ERROR,validatedAt:new Date,message:"Error checking for org id existence: "+e.t0.message}));case 14:this.dispatch(Kr());case 15:case"end":return e.stop()}var r},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()}]),t}(xr);function sn(e){return function(t,r){Xr(r());var n=ye.validateOrgDescription(e),a=Object(ce.a)(n,2),i=a[0],s=a[1];s.type!==o.OK?t(function(e,t){return{type:J.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(i,s)):t(function(e){return{type:J.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(i)),t(Kr())}}var on=r(307),ln=r(38),cn=r(313),un=r(311),En=r(119),dn=r(71),mn=r.n(dn),vn=(r(254),function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,showError:!0},r.origin=document.location.origin,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Dt.a.confirm({title:"Leave the editor?",content:M.createElement("div",null,M.createElement("p",null,"You have entered information for this new organization."),M.createElement("p",null,"If you leave the editor without first saving, the new organization ",M.createElement("i",null,"will not be created"),"."),M.createElement("p",null,M.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===l.NEW||this.props.saveState===l.READY||this.props.saveState===l.SAVED)}},{key:"isModified",value:function(){return this.props.editState===s.EDITED&&this.props.saveState===l.NEW}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"validation-error Lite"}switch(e.syncState){case i.DIRTY:return"sync-dirty Lite";default:return"validation-ok Lite"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===o.OK?"":e.syncState===i.DIRTY?M.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderNameRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"This is the name for your organization as you want KBase users to see it; you may change it at any time."),M.createElement("p",null,"It may be composed of ordinary text, but does not accept formatting."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1024 characters")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Name"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"Your Organization's display name",autoFocus:!0,onChange:t}),this.renderFieldError(e))))}},{key:"renderIDRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each Organization has a unique identifier. The ID is set when the organization is created, and are permanent: It may never be changed."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"100 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"a to z, 0 to 9, -")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"ID"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"A unique ID for your Organization",onChange:t}),this.renderFieldError(e))))}},{key:"renderLogoURLRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each Organization will display a logo. You may specific your own logo by entering the URL for an image, or leave this field blank and a default logo will be displayed, using the first letter of your org name and a randomly generated color (based on your org id)."),M.createElement("p",null,"Please don't use large images, and try to keep them roughly square. The logo image display will be constrained to no larger than 100 pixels wide. Non-square logos may not look good in the Orgs list or on your Org page."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"no")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1000 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"a full https:// url. E.g. https://my.org/myimage.png",M.createElement("br",null),"note that only ",M.createElement("i",null,"https")," urls are accepted.")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Logo URL"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formField"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"The URL for your Organization's logo (optional)",onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(e)),M.createElement("div",{className:"NewOrganization-formFieldPreview"},this.renderLogoPreview(e)))))}},{key:"renderBrokenHomeURL",value:function(){return M.createElement(yt.a,{title:"The Home URL is broken; either correct it or leave it empty"},M.createElement(Mt.a,{type:"exclamation-circle",style:{color:"gray"}}))}},{key:"renderHomeURLPreview",value:function(e){if(null===e.value||0===e.value.length){return M.createElement("div",{className:"NewOrganization-previewBox"},M.createElement(yt.a,{title:"When you have completed your url, you may preview it here."},M.createElement(Mt.a,{type:"link",style:{color:"gray"}})))}if(e.validationState.type!==o.OK)return M.createElement("div",{className:"NewOrganization-previewBox"},this.renderBrokenHomeURL());return M.createElement("div",{className:"NewOrganization-previewBox"},M.createElement(yt.a,{title:"Try out your url by clicking this link"},M.createElement("a",{href:e.value,target:"_blank"},M.createElement(Mt.a,{type:"link"}))))}},{key:"renderHomeURLRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each Organization may display a home page url. This should be considered the canonical home for your Organization, if it also exists outside of KBase."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"no")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1000 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"a full url. E.g. http://my.org/myimage.png",M.createElement("br",null),"note that both ",M.createElement("i",null,"http>")," and ",M.createElement("i",null,"https")," urls are accepted.")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Home Page URL"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formField"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"The url for your Organization's home page (optional)",onChange:t}),this.renderFieldError(e)),M.createElement("div",{className:"NewOrganization-formFieldPreview"},this.renderHomeURLPreview(e)))))}},{key:"renderCollapse",value:function(e){return M.createElement(un.a,{bordered:!1},M.createElement(un.a.Panel,{header:"What about inviting users?",key:"invite",style:{background:"transparent",borderRadius:0,margin:0,border:0,overflow:"hidden"}},e))}},{key:"renderPrivatePublicRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,'Set the Organization to "hidden" to prevent it from appearing in the listing and from being exposed as an Org page for any non-member.'),M.createElement("p",null,"You may invite users directly to your org. When doing so they will receive a notification with a link to the org page. When a user lands on the org page they will not be shown information about the org, but will be available to accept the invitation and instantly have access to it."),M.createElement("p",null,"A user with an invitation who lands on the org page will not see information about the org, but will be able to submit a Join request."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"no")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Hidden?"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement("div",null,M.createElement(yr.a,{checked:e.value,className:this.calcFieldClass(e),onChange:t}),this.renderIsPrivate(e.value)),this.renderFieldError(e))))}},{key:"renderResearchInterestsRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each organization must have a short description of research interests or purpose."),M.createElement("p",null,"This text is displayed in the organizations list and the organization's page. It is most helpful in the list context to help users quickly scan the list."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"200 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"unformatted text")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Research Interests"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(mn.a,{value:e.value||"",className:this.calcFieldClass(e)+" NewOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},placeholder:"List your areas of interest. Systems biology, microbial ecology, plant genomics",onChange:t}),this.renderFieldError(e))))}},{key:"renderDescriptionRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each organization must have a description which communicates the purpose of this organization."),M.createElement("p",null,"The description is in ",M.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown")," format and may be quite long. It will be presented in a scrolling area."),M.createElement("p",null,"Please be mindful of embedding large images or other content which may interfere with the display of your Organization."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1024 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"standard ",M.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown"))))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Description"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(En.a,{defaultActiveKey:"editor",animated:!1},M.createElement(En.a.TabPane,{tab:"Editor",key:"editor"},M.createElement(mn.a,{value:e.value||"",className:this.calcFieldClass(e)+" NewOrganization-control-description",autosize:{minRows:5,maxRows:15},placeholder:"Text or Markdown describing your Organization",onChange:t}),this.renderFieldError(e)),M.createElement(En.a.TabPane,{tab:"Preview",key:"preview"},M.createElement("div",{className:"NewOrganization-preview-description",dangerouslySetInnerHTML:{__html:ln.Marked.parse(e.value||"")}}))))))}},{key:"renderEditorHeader",value:function(){return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"}),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{style:{flex:"1 1 0px"}},M.createElement("h3",null,"Create Your Organization"))))}},{key:"renderEditor",value:function(){return M.createElement("form",{id:"newOrganizationForm",className:"NewOrganization-editor  scrollable-flex-column",onSubmit:this.onSubmit.bind(this)},this.renderEditorHeader(),M.createElement("div",{className:"NewOrganization-body"},this.renderNameRow(this.props.newOrganization.name,this.onNameChange.bind(this)),this.renderIDRow(this.props.newOrganization.id,this.onIdChange.bind(this)),this.renderLogoURLRow(this.props.newOrganization.logoUrl,this.onLogoUrlChange.bind(this)),this.renderHomeURLRow(this.props.newOrganization.homeUrl,this.onHomeUrlChange.bind(this)),this.renderPrivatePublicRow(this.props.newOrganization.isPrivate,this.onIsPrivateChange.bind(this)),this.renderResearchInterestsRow(this.props.newOrganization.researchInterests,this.onResearchInterestsChange.bind(this)),this.renderDescriptionRow(this.props.newOrganization.description,this.onDescriptionChange.bind(this)),M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"}),M.createElement("div",{className:"NewOrganization-col2",style:{textAlign:"center"}},M.createElement("div",{className:"ButtonSet"},M.createElement("span",{className:"ButtonSet-button"},this.renderSaveButton()),M.createElement("span",{className:"ButtonSet-button"},this.renderCancelButton()))))))}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderLogo",value:function(e){return M.createElement(Tt,{logoUrl:null,size:64,organizationName:e.name.value,organizationId:e.id.value})}},{key:"renderIsPrivate",value:function(e){return e?M.createElement("span",null,M.createElement(Mt.a,{type:"lock"})," ","Hidden - will be visible ",M.createElement("b",null,"only")," for members of this organization"):M.createElement("span",null,M.createElement(Mt.a,{type:"global"})," ","Visible - will be visible to all KBase users.")}},{key:"renderDefaultLogo",value:function(){if(!this.props.newOrganization.name.value||!this.props.newOrganization.id.value){return M.createElement(yt.a,{title:"Add a logo url or complete the name and id fields for a Default logo"},M.createElement(Mt.a,{type:"question",style:{color:"gray"}}))}var e=this.charAt(this.props.newOrganization.name.value,0).toUpperCase(),t=It()(this.props.newOrganization.id.value).substr(0,6);return M.createElement("svg",{width:30,height:30,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},M.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:18,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderBrokenLogo",value:function(){return M.createElement(yt.a,{title:"The Logo URL is broken; either correct it or empty the field for the default logo"},M.createElement(Mt.a,{type:"exclamation-circle",style:{color:"gray"}}))}},{key:"renderLogoPreview",value:function(e){return null===e.value||0===e.value.length?M.createElement("div",{className:"NewOrganization-previewBox"},this.renderDefaultLogo()):e.validationState.type!==o.OK?M.createElement("div",{className:"NewOrganization-previewBox"},this.renderBrokenLogo()):M.createElement("div",{className:"NewOrganization-previewBox"},M.createElement("img",{src:e.value,width:30}))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return M.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return M.createElement("div",{key:"line_"+t},e)})),t&&(t=M.createElement("div",null,M.createElement("div",null,"trace"),t)),M.createElement(Dt.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},M.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),M.createElement("div",null,this.props.error.message),t)}}},{key:"renderSaveButton",value:function(){return M.createElement(At.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")}},{key:"renderCancelButton",value:function(){return M.createElement(At.a,{type:"danger",onClick:this.onClickCancelToBrowser.bind(this)},M.createElement(Mt.a,{type:"close"})," ","Close")}},{key:"renderMenuButtons",value:function(){var e;return this.props.error&&(e=M.createElement("span",{className:"ButtonSet-button"},M.createElement(At.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}))),M.createElement("div",{className:"ButtonSet"},M.createElement("span",{className:"ButtonSet-button"},M.createElement(At.a,{type:"default",onClick:this.onClickCancelToBrowser.bind(this)},M.createElement(Mt.a,{type:"rollback"})," ","Back")),M.createElement("span",{className:"ButtonSet-button"},this.renderSaveButton()),e)}},{key:"render",value:function(){return this.state.cancelToBrowser?M.createElement(on.a,{push:!0,to:"/organizations"}):this.props.saveState===l.SAVED?M.createElement(on.a,{push:!0,to:"/viewOrganization/"+this.props.newOrganization.id.value}):M.createElement("div",{className:"NewOrganization scrollable-flex-column"},M.createElement("div",{className:"NewOrganization-main scrollable-flex-column"},this.renderEditor()),this.renderError())}}]),t}(M.Component));var pn=Object(W.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(Zr())},onUpdateName:function(t){e($r(t))},onUpdateLogoUrl:function(t){e(function(e){return function(t,r){Lr&&Lr.cancel();var n=ye.validateOrgLogoUrl(e),a=Object(ce.a)(n,2),i=a[0],s=a[1];if(s.type===o.OK){if(t({type:J.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:i}),t(Kr()),null!==i&&i.length>0){var l=r(),c=l.auth.authorization.token,u=l.app.config.services.ServiceWizard.url;(Lr=new tn({delay:100,url:i,timeout:1e3,dispatch:t,serviceWizardURL:u,token:c})).start()}}else t({type:J.ADD_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:s})}}(t))},onUpdateId:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,l,c;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(nn&&nn.cancel(),a=ye.validateOrgId(e),i=Object(ce.a)(a,2),s=i[0],(l=i[1]).type===o.OK){t.next=6;break}return r(Yr(s,l)),r(Kr()),t.abrupt("return");case 6:if(r(Hr(e)),n().views.addOrgView.viewModel){t.next=10;break}return t.abrupt("return");case 10:c=Xr(n()),(nn=new an({delay:100,id:s,dispatch:r,model:c})).start();case 13:case"end":return t.stop()}},t)}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUpdateDescription:function(t){e(sn(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:J.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Kr())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t,r){en&&en.cancel();var n=ye.validateOrgHomeUrl(e),a=Object(ce.a)(n,2),i=a[0],s=a[1];if(s.type===o.OK){if(t({type:J.ADD_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:i}),t(Kr()),null!==i&&i.length>0){var l=r(),c=l.auth.authorization.token,u=l.app.config.services.ServiceWizard.url;(en=new rn({delay:100,url:i,timeout:1e3,dispatch:t,serviceWizardURL:u,token:c})).start()}}else t({type:J.ADD_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:s})}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=ye.validateOrgResearchInterests(e),n=Object(ce.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:J.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:J.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a})}}(t))}}})(vn),On=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){return M.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return M.createElement("div",null,"Error!",M.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case h.SUCCESS:default:return M.createElement(pn,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var hn=Object(W.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(Jr())},onUnload:function(){e({type:J.ADD_ORG_UNLOAD})}}})(On),Rn=function(){function e(t){Object(V.a)(this,e),this.params=void 0,this.params=t}return Object(U.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(le.a)(oe.a.mark(function e(t){var r,n,a,i,s,o,l;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new He({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL,userProfileServiceURL:this.params.userProfileServiceURL}),n=new he({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(s=e.sent,(o=Me(a,this.params.username,i,s)).type!==Ae.ADMIN&&o.type!==Ae.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:l=e.sent,e.next=19;break;case 18:l=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:s,relation:o,groupRequests:l});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function wn(){return function(){var e=Object(le.a)(oe.a.mark(function e(t,r){return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:J.DATA_SERVICE_LOAD_START}),t({type:J.DATA_SERVICE_LOAD_SUCCESS});case 2:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()}function _n(e){return{type:J.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function gn(e,t){return{type:J.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e,narratives:t}}function fn(e){return{type:J.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function An(e,t,r){return{type:J.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,organization:e,relation:t,requestOutbox:r}}function Sn(e){return{type:J.VIEW_ORG_LOAD_ERROR,error:e}}function Nn(e){return{type:J.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function bn(){return{type:J.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function In(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d,m,v,p,O,h,R,w,_,g,f,A;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,c=new Rn({token:s,username:o,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url}),u=new he({token:s,username:o,groupsServiceURL:l.services.Groups.url}),E=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url}),t.prev=5,t.next=8,c.getOrganizationForUser(e);case 8:if(d=t.sent,m=d.organization,v=d.relation,m.kind===be.NORMAL){t.next=17;break}return t.next=14,u.getRequestInboxForOrg(e);case 14:return p=t.sent,r(An(m,v,p)),t.abrupt("return");case 17:if(v.type!==Ae.OWNER&&v.type!==Ae.ADMIN){t.next=32;break}return t.next=20,u.getPendingOrganizationRequestsForOrg(e);case 20:return h=t.sent,t.next=23,u.getOrganizationInvitationsForOrg(e);case 23:return R=t.sent,t.next=26,E.getOpenRequestStatus({organizationId:e});case 26:return O=t.sent,t.next=29,u.getCombinedRequestInboxForOrg(e);case 29:w=t.sent,t.next=36;break;case 32:h=null,R=null,O=Ie.INAPPLICABLE,w=[];case 36:return t.next=38,u.getRequestOutboxForOrg(e);case 38:_=t.sent,"added",g=Be(m.narratives,{sortBy:"added",searchBy:""}),f=m.apps,"added",A=qe(m.members,{sortBy:"added",searchBy:""}),r((S=m,N=v,b=O,I=h,T=R,y=w,M=_,D="added",C=g,k=f,V="added",U=A,{type:J.VIEW_ORG_LOAD_NORMAL_SUCCESS,organization:S,relation:N,openRequest:b,groupRequests:I,groupInvitations:T,requestInbox:y,requestOutbox:M,narrativesSortBy:D,narratives:C,sortMembersBy:V,members:U,apps:k})),t.next=50;break;case 47:t.prev=47,t.t0=t.catch(5),r(Sn({code:t.t0.name,message:t.t0.message}));case 50:case"end":return t.stop()}var S,N,b,I,T,y,M,D,C,k,V,U},t,null,[[5,47]])}));return function(e,r){return t.apply(this,arguments)}}()}function Tn(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d,m,v,p,O,h,R,w,_,g,f,A,S,b;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,c=new Rn({token:s,username:o,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url}),u=new he({token:s,username:o,groupsServiceURL:l.services.Groups.url}),E=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url}),t.prev=4,d=n(),m=d.views.viewOrgView.viewModel){t.next=10;break}return r(Sn({code:"error",message:"No view model"})),t.abrupt("return");case 10:if(m.kind===N.NORMAL){t.next=13;break}return r(Sn({code:"error",message:"Wrong org view model kind!"})),t.abrupt("return");case 13:return t.next=15,c.getOrganizationForUser(e);case 15:if(v=t.sent,p=v.organization,O=v.relation,p.kind===be.NORMAL){t.next=24;break}return t.next=21,u.getRequestInboxForOrg(e);case 21:return h=t.sent,r(An(p,O,h)),t.abrupt("return");case 24:if(O.type!==Ae.OWNER&&O.type!==Ae.ADMIN){t.next=36;break}return t.next=27,u.getPendingOrganizationRequestsForOrg(e);case 27:return w=t.sent,t.next=30,u.getOrganizationInvitationsForOrg(e);case 30:return _=t.sent,t.next=33,E.getOpenRequestStatus({organizationId:e});case 33:R=t.sent,t.next=39;break;case 36:w=null,_=null,R=Ie.INAPPLICABLE;case 39:return t.next=41,u.getCombinedRequestInboxForOrg(e);case 41:return g=t.sent,t.next=44,u.getRequestOutboxForOrg(e);case 44:f=t.sent,"added",A=Be(p.narratives,{sortBy:m.narratives.sortBy,searchBy:m.narratives.searchBy}),S=p.apps,"added",b=qe(p.members,{sortBy:m.sortMembersBy,searchBy:m.searchMembersBy}),r((I=p,T=O,y=R,M=w,D=_,C=g,k=f,V="added",U=A,z=S,j="added",G=b,{type:J.VIEW_ORG_RELOAD_NORMAL_SUCCESS,organization:I,relation:T,openRequest:y,groupRequests:M,groupInvitations:D,requestInbox:C,requestOutbox:k,narrativesSortBy:V,narratives:U,sortMembersBy:j,members:G,apps:z})),t.next=56;break;case 53:t.prev=53,t.t0=t.catch(4),r(Sn({code:t.t0.name,message:t.t0.message}));case 56:case"end":return t.stop()}var I,T,y,M,D,C,k,V,U,z,j,G},t,null,[[4,53]])}));return function(e,r){return t.apply(this,arguments)}}()}function yn(){return function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,i,s,o,l,c,u;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r()).views.viewOrgView.viewModel){e.next=4;break}return t(Nn({type:a.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=n.auth.authorization,s=i.token,o=i.username,l=n.app.config,c=n.views.viewOrgView.viewModel.organization,u=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url}),e.prev=6,e.next=9,u.requestMembership(c.id);case 9:t({type:J.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(In(c.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(Nn({type:a.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,null,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function Mn(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var i,s,o,l,c,u,E;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:J.VIEW_ORG_JOIN_REQUEST_START}),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Nn({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,l=s.username,c=i.app.config,i.views.viewOrgView.viewModel.organization,u=new he({token:o,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=7,t.next=10,u.cancelRequest(e);case 10:E=t.sent,r({type:J.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(In(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:a.ERROR,message:t.t0.message},{type:J.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,null,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function Dn(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var i,s,o,l,c,u,E;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(bn()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Nn({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,l=s.username,c=i.app.config,i.views.viewOrgView.viewModel.organization,u=new he({token:o,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=7,t.next=10,u.acceptJoinInvitation(e);case 10:E=t.sent,r({type:J.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(In(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:J.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,null,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function Cn(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var i,s,o,l,c,u,E;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(bn()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Nn({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,l=s.username,c=i.app.config,i.views.viewOrgView.viewModel.organization,u=new he({token:o,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=7,t.next=10,u.rejectJoinInvitation(e);case 10:E=t.sent,r({type:J.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(In(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:J.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,null,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function kn(e){return function(t,r){t({type:J.VIEW_ORG_REMOVE_APP_START});var n,a=function(e){if(!e.views.viewOrgView.viewModel)throw new Error("View orgs does not have an org");var t=e.views.viewOrgView.viewModel;if(t.kind!==N.NORMAL)throw new Error("View orgs does not have an org");return t}(r()),i=function(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new He({token:r,username:n,groupsServiceURL:a.services.Groups.url,userProfileServiceURL:a.services.UserProfile.url})}(r());try{i.removeAppFromOrg(a.organization.id,e),t(function(e){return{type:J.VIEW_ORG_REMOVE_APP_SUCCESS,appId:e}}(e))}catch(s){t((n=pr({code:"error",message:s.message}),{type:J.VIEW_ORG_REMOVE_APP_ERROR,error:n}))}}}function Vn(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===N.NORMAL){t.next=8;break}return r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_START}),s=a.auth.authorization,o=s.token,l=s.username,c=a.app.config,u=new he({token:o,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,u.acceptRequest(e);case 14:return E=t.sent,t.next=17,u.getCombinedRequestInboxForOrg(i.organization.id);case 17:d=t.sent,r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,requests:d}),r(Tn(E.organizationId)),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(11),r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 25:case"end":return t.stop()}},t,null,[[11,22]])}));return function(e,r){return t.apply(this,arguments)}}()}var Un=r(309),zn=(r(263),function(e){function t(e,r){var n;return Object(V.a)(this,t),(n=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(G.a)(t,e),Object(U.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return M.createElement(Mt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"onMenuSelection",value:function(e){}},{key:"render",value:function(){return M.createElement("div",{className:"Header"},M.createElement("div",{className:"Header-contextual"},M.createElement("div",{className:"Header-userColumn"},M.createElement("div",{className:"Header-breadcrumbs"},this.props.breadcrumbs),M.createElement("div",{className:"Header-buttons"},this.props.buttons))))}}]),t}(M.Component));function jn(e){return function(t,r){t({type:J.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,l=n.views.viewOrgView.viewModel;if(null===l)throw new Error("view is not populated");new He({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url}).memberToAdmin(l.organization.id,e).then(function(r){t(function(e){return{type:J.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:J.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function Gn(e){return function(t,r){t({type:J.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,l=n.views.viewOrgView.viewModel;if(null===l)throw new Error("view is not populated");new He({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url}).adminToMember(l.organization.id,e).then(function(r){t(function(e){return{type:J.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:J.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function Ln(e){return function(t,r){t({type:J.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,l=n.views.viewOrgView.viewModel;if(null===l)throw new Error("view is not populated");new He({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url}).removeMember(l.organization.id,e).then(function(){t(Tn(l.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:J.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}var Pn;r(264);function xn(e){switch(e){case Pn.COMPACT:return Pn.NORMAL;case Pn.NORMAL:return Pn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Pn||(Pn={}));var Bn=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={view:Pn.COMPACT},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onToggleView",value:function(){this.setState({view:xn(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case Se.OWNER:return M.createElement("span",null,M.createElement(Mt.a,{type:"crown"})," owner");case Se.ADMIN:return M.createElement("span",null,M.createElement(Mt.a,{type:"unlock"})," admin");case Se.MEMBER:return M.createElement("span",null,M.createElement(Mt.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){var e=M.createElement("div",null,this.props.member.username);return M.createElement("div",{className:"Member View-COMPACT"},M.createElement("div",{className:"Member-controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Pn.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===Pn.NORMAL?"up":"down")}))),M.createElement("div",{className:"Member-avatarCol"},M.createElement(zt,{user:this.props.user,size:this.props.avatarSize||30})),M.createElement("div",{className:"Member-infoCol"},M.createElement("div",{className:"Member-name"},M.createElement(yt.a,{placement:"bottomRight",title:e},M.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),M.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",M.createElement(fr,{time:this.props.member.joinedAt})),M.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title)))}},{key:"renderNormal",value:function(){var e=M.createElement("div",null,this.props.member.username);return M.createElement("div",{className:"Member View-NORMAL"},M.createElement("div",{className:"Member-controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Pn.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===Pn.NORMAL?"up":"down")}))),M.createElement("div",{className:"Member-avatarCol"},M.createElement(zt,{user:this.props.user,size:this.props.avatarSize||30})),M.createElement("div",{className:"Member-infoCol"},M.createElement("div",{className:"Member-name"},M.createElement(yt.a,{placement:"bottomRight",title:e},M.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),M.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",M.createElement(fr,{time:this.props.member.joinedAt})),M.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title),M.createElement("div",{className:"Member-organization"},this.props.user.organization||M.createElement("i",null,"no organization in user profile")),M.createElement("div",{className:"Member-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||M.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case Pn.COMPACT:return this.renderCompact();case Pn.NORMAL:return this.renderNormal()}}}]),t}(M.Component),Wn=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.user?M.createElement(Bn,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):M.createElement("div",null,M.createElement(Mt.a,{type:"loading"})," ","Loading member...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(M.Component);var qn=Object(W.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(Or(t))}}})(Wn),Hn=(r(265),function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={confirmMemberRemoval:null},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onConfirmRemoveMember",value:function(e){this.setState({confirmMemberRemoval:{member:e}})}},{key:"renderConfirmMemberRemoval",value:function(){var e=this;if(this.state.confirmMemberRemoval){var t=this.state.confirmMemberRemoval.member,r=M.createElement(M.Fragment,null,M.createElement("p",null,"Please confirm removal of this member from this organization."),M.createElement("div",{className:"SimpleCard",style:{marginBottom:"1em"}},M.createElement(qn,{member:t,avatarSize:20})),M.createElement("p",null,"This user as well as members of this organization will receive a notification of the removal."),M.createElement("p",null,"Any Narratives associated by this member with this Organization will be unaffected. This member will also retain any Narrative permissions granted through this Organization."));return M.createElement(Dt.a,{title:"Confirm Removal of Member",width:"50em",visible:!0,onOk:function(){e.props.onRemoveMember(t.username),e.setState({confirmMemberRemoval:null})},onCancel:function(){e.setState({confirmMemberRemoval:null})},okText:"Confirm"},r)}}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.onConfirmRemoveMember(t)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=M.createElement(Ct.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},M.createElement(Ct.a.Item,{key:"promoteToAdmin"},M.createElement(Mt.a,{type:"unlock"}),"Promote to Admin"),M.createElement(Ct.a.Item,{key:"removeMember"},M.createElement(Mt.a,{type:"delete"}),"Remove Member"));return M.createElement("div",null,M.createElement(kt.a,{overlay:r,trigger:["click"]},M.createElement(Mt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=M.createElement(Ct.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},M.createElement(Ct.a.Item,{key:"demoteToMember"},M.createElement(Mt.a,{type:"user"}),"Demote to Member"));return M.createElement("div",null,M.createElement(kt.a,{overlay:r,trigger:["click"]},M.createElement(Mt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderOwnerMenu",value:function(e){return M.createElement("div",null)}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===Ae.OWNER||this.props.relation.type===Ae.ADMIN)switch(e.type){case Se.OWNER:return this.renderOwnerMenu(e);case Se.ADMIN:return this.renderAdminMenu(e);case Se.MEMBER:return this.renderMemberMenu(e)}}},{key:"renderMembers",value:function(){var e,t=this,r=M.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No members");return e=0===this.props.members.length?M.createElement(St.a,{type:"info",message:r}):this.props.members.map(function(e){var r=["Members-row","SimpleCard"];return null!==t.props.organization.lastVisitedAt&&t.props.organization.lastVisitedAt.getTime()<e.joinedAt.getTime()&&r.push("Members-newMember"),M.createElement("div",{className:r.join(" "),key:e.username},M.createElement("div",{className:"Members-member"},M.createElement(qn,{member:e,avatarSize:50})),M.createElement("div",{className:"Members-menu"},t.renderMemberOptions(e)))}),M.createElement("div",{className:"infoTable"},e)}},{key:"renderSearchBar",value:function(){var e=this;return M.createElement("div",{style:{paddingRight:"6px"}},M.createElement(cn.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter members by name",onChange:function(t){e.props.onSearchMembers(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return M.createElement(M.Fragment,null,M.createElement("span",{className:"field-label"},"sort"),M.createElement(Ir.a,{onChange:function(t){e.props.onSortMembers(t)},style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortMembersBy},M.createElement(Ir.a.Option,{value:"name",key:"name"},"Name"),M.createElement(Ir.a.Option,{value:"added",key:"added"},"Date Joined")))}},{key:"renderHeader",value:function(){return M.createElement("div",{className:"ViewOrganizationMembers-headerRow"},M.createElement("div",{className:"ViewOrganizationMembers-searchCol"},this.renderSearchBar()),M.createElement("div",{className:"ViewOrganizationMembers-sortCol"},this.renderSortBar()))}},{key:"render",value:function(){var e;return this.state.confirmMemberRemoval&&(e=this.renderConfirmMemberRemoval()),M.createElement(M.Fragment,null,M.createElement("div",{className:"ViewOrganizationMembers scrollable-flex-column"},M.createElement("div",{className:"ViewOrganizationMembers-header"},this.renderHeader()),M.createElement("div",{className:"ViewOrganizationMembers-body scrollable-flex-column"},this.renderMembers())),e)}}]),t}(M.Component));var Fn=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==N.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onViewMembersUnload:function(){e({type:J.VIEW_ORG_VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(jn(t))},onDemoteAdminToMember:function(t){e(Gn(t))},onRemoveMember:function(t){e(Ln(t))},onSearchMembers:function(t){e(function(e){return function(t,r){t({type:J.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===N.NORMAL){var a=qe(n.organization.members,{sortBy:n.sortMembersBy,searchBy:e});t({type:J.VIEW_ORG_SEARCH_MEMBERS_SUCCESS,searchBy:e,members:a})}else t({type:J.VIEW_ORG_SORT_MEMBERS_ERROR,error:pr({code:"error",message:"Wrong org view model kind!"})});else t({type:J.VIEW_ORG_SORT_MEMBERS_ERROR,error:pr({code:"error",message:"No view model"})})}}(t))},onSortMembers:function(t){e(function(e){return function(t,r){t({type:J.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(null!==n)if(n.kind===N.NORMAL){var a=n.organization.members,i=n.searchMembersBy,s=qe(a,{sortBy:e,searchBy:i});t({type:J.VIEW_ORG_SORT_MEMBERS_SUCCESS,members:s,sortBy:e})}else t({type:J.VIEW_ORG_SORT_MEMBERS_ERROR,error:pr({code:"error",message:"Wrong org view model kind!"})});else t({type:J.VIEW_ORG_SORT_MEMBERS_ERROR,error:pr({code:"error",message:"No view model"})})}}(t))}}})(Hn);function Qn(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===N.NORMAL){t.next=8;break}return r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:J.VIEW_ORG_REJECT_INBOX_REQUEST_START}),s=a.auth.authorization,o=s.token,l=s.username,c=a.app.config,u=new he({token:o,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,u.denyRequest(e);case 14:return t.next=16,u.getRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:J.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:J.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,null,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}function Yn(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:J.VIEW_ORG_CANCEL_JOIN_REQUEST_START}),a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=6;break}return r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 6:if(i.kind===N.NORMAL){t.next=9;break}return r({type:J.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 9:return s=a.auth.authorization,o=s.token,l=s.username,c=a.app.config,u=new he({token:o,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,u.cancelRequest(e);case 14:return t.sent,t.next=17,u.getRequestOutboxForOrg(i.organization.id);case 17:E=t.sent,r({type:J.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,requests:E}),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(11),r({type:J.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:pr({code:"error",message:t.t0.message})});case 24:case"end":return t.stop()}},t,null,[[11,21]])}));return function(e,r){return t.apply(this,arguments)}}()}var Jn;r(266),r(267);function Zn(e){switch(e){case Jn.COMPACT:return Jn.NORMAL;case Jn.NORMAL:return Jn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Jn||(Jn={}));var Kn=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={view:Jn.COMPACT},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Zn(this.state.view)})}},{key:"renderCompact",value:function(){return M.createElement(M.Fragment,null,M.createElement("div",{className:"controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Jn.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===Jn.NORMAL?"up":"down")}))),M.createElement("div",{className:"avatarCol"},M.createElement(zt,{user:this.props.user,size:this.props.avatarSize||30})),M.createElement("div",{className:"infoCol"},M.createElement("div",{className:"name"},M.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),M.createElement("div",null,this.props.user.username)))}},{key:"renderNormal",value:function(){return M.createElement(M.Fragment,null,M.createElement("div",{className:"controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Jn.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===Jn.NORMAL?"up":"down")}))),M.createElement("div",{className:"avatarCol"},M.createElement(zt,{user:this.props.user,size:this.props.avatarSize||30})),M.createElement("div",{className:"infoCol"},M.createElement("div",{className:"name"},M.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),M.createElement("div",null,this.props.user.username),M.createElement("div",{className:"organization"},this.props.user.organization||M.createElement("i",null,"no organization in user profile")),M.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||M.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case Jn.COMPACT:return M.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case Jn.NORMAL:return M.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(M.Component),Xn=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.user?M.createElement(Kn,{user:this.props.user,avatarSize:this.props.avatarSize}):M.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(M.Component);var $n,ea=Object(W.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(Or(t))}}})(Xn);r(268);function ta(e){switch(e){case $n.COMPACT:return $n.NORMAL;case $n.NORMAL:return $n.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}($n||($n={}));var ra=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={view:$n.COMPACT},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onToggleView",value:function(){this.setState({view:ta(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?M.createElement(yt.a,{title:"This narrative is viewable by all KBase users",placement:"right"},M.createElement("span",{style:{cursor:"help"}},M.createElement(Mt.a,{type:"global"})," Public Narrative")):M.createElement(yt.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},M.createElement("span",{style:{cursor:"help"}},M.createElement(Mt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case rr.VIEW:t=M.createElement("span",null,"View-Only (",M.createElement("i",null,"visit narrative to request additional access"),")");break;case rr.EDIT:t=M.createElement("span",null,"Edit (",M.createElement("i",null,"visit narrative to request additional access"),")");break;case rr.ADMIN:t="Admin";break;case rr.OWNER:t="Owner";break;default:t="Unknown"}return M.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===$n.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===$n.NORMAL?"up":"down")}))),M.createElement("div",{className:"iconCol"},M.createElement(Mt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),M.createElement("div",{className:"mainCol"},M.createElement("div",{className:"Narrative-title"},M.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",M.createElement("div",{className:"Narrative-owner"},M.createElement(ea,{avatarSize:20,userId:e.owner}))))}},{key:"renderNormal",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===$n.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===$n.NORMAL?"up":"down")}))),M.createElement("div",{className:"iconCol"},M.createElement(Mt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),M.createElement("div",{className:"mainCol"},M.createElement("div",{className:"mainCol"},M.createElement("div",{className:"Narrative-title"},M.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",M.createElement("div",{className:"Narrative-owner"},M.createElement(ea,{avatarSize:20,userId:e.owner}))),M.createElement("div",{className:"Narrative-attributes"},M.createElement("div",{className:"Narrative-userPermission"},M.createElement(Mt.a,{type:"crown"})),M.createElement("div",{className:"Narrative-global"},M.createElement(Mt.a,{type:"global"}))),M.createElement("div",null,this.renderPublicPermission(e)),M.createElement("div",null,M.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),M.createElement("div",null,M.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),M.createElement("div",null,M.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===rr.NONE)return M.createElement("div",null,M.createElement(Mt.a,{type:"exclamation-circle",style:{color:"orange"}})," ","You don't have access to this Narrative");switch(this.state.view){case $n.COMPACT:return M.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case $n.NORMAL:return M.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(M.Component),na=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.narrative?M.createElement(ra,{narrative:this.props.narrative}):M.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(M.Component);var aa=Object(W.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(hr(t))}}})(na),ia=(r(269),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onAcceptRequest",value:function(){this.props.onAcceptInboxRequest(this.props.request)}},{key:"onRejectRequest",value:function(){this.props.onRejectInboxRequest(this.props.request)}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return M.createElement("div",null,M.createElement("div",{className:"miniDetail"},M.createElement(aa,{workspaceId:parseInt(e.narrativeId,10)})))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return M.createElement("div",null,M.createElement("div",{className:"miniDetail"},M.createElement(ea,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return M.createElement(ea,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"REQUEST to associate App";case Ee.USER:return"REQUEST to join Organization";case Ee.WORKSPACE:return"REQUEST to associate Narrative"}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return M.createElement("div",null,M.createElement("div",{className:"miniDetail"},M.createElement(aa,{workspaceId:parseInt(e.narrativeId,10)})),M.createElement("div",{className:"cardSectionHeader"},"with organization"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),M.createElement("div",{className:"cardSectionHeader"},"from"),M.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),M.createElement("div",{className:"miniDetail"},M.createElement(aa,{workspaceId:parseInt(e.narrativeId,10)})),M.createElement("div",{className:"cardSectionHeader"},"from"),M.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderAppRequest",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate App"),M.createElement("div",{className:"miniDetail"},M.createElement("div",null,"apps not supported yet")),M.createElement("div",{className:"cardSectionHeader"},"from"),M.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return M.createElement("div",{style:{textAlign:"center"}},M.createElement(At.a.Group,{style:{marginTop:"4px"}},M.createElement(At.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},M.createElement(Mt.a,{type:"check"}),"Accept"),M.createElement(At.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},M.createElement(Mt.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),M.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),M.createElement("div",{className:"cardSectionHeader"},"from"),M.createElement(ea,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.USER:return this.renderJoinRequest(e);case Ee.WORKSPACE:return this.renderWorkspaceRequest(e);case Ee.APP:return this.renderAppRequest(e)}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return this.renderUserInvitation(e);case Ee.WORKSPACE:case Ee.APP:return M.createElement(M.Fragment,null,M.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return M.createElement("div",{key:e.id,className:"InboxRequest kbCard"},M.createElement("div",{className:"kbCard-header"},M.createElement("div",{className:"InboxRequest-requestHeaderRow"},M.createElement("div",{className:"InboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),M.createElement("div",{className:"InboxRequest-requestHeaderExpireAt"},M.createElement("span",{className:"field-label"},"expires")," ",_r(e.expireAt)))),M.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(M.Component));var sa=Object(W.b)(function(e,t){return{}},function(e){return{onAcceptInboxRequest:function(t){e(Vn(t.id))},onRejectInboxRequest:function(t){e(Qn(t.id))}}})(ia),oa=(r(270),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return M.createElement("div",null,M.createElement("div",{className:"miniDetail"},M.createElement(aa,{workspaceId:parseInt(e.narrativeId,10)})))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return M.createElement("div",null,M.createElement("div",{className:"miniDetail"},M.createElement(ea,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return M.createElement(ea,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"REQUEST to associate App";case Ee.USER:return"REQUEST to join Organization";case Ee.WORKSPACE:return"REQUEST to associate Narrative"}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.APP:return"SHOW APP";case Ee.USER:return"";case Ee.WORKSPACE:return M.createElement("div",null,M.createElement("div",{className:"miniDetail"},M.createElement(aa,{workspaceId:parseInt(e.narrativeId,10)})),M.createElement("div",{className:"cardSectionHeader"},"with organization"))}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return M.createElement(ea,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),M.createElement("div",{className:"miniDetail"},M.createElement(aa,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderAppRequest",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate App"),M.createElement("div",{className:"miniDetail"},"Apps not supported yet"),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return M.createElement("div",{style:{textAlign:"center"}},M.createElement(At.a.Group,{style:{marginTop:"4px"}},M.createElement(At.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},M.createElement(Mt.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),M.createElement("div",{className:"cardSectionHeader"},"sent to"),M.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case ue.REQUEST:switch(e.resourceType){case Ee.USER:return this.renderJoinRequest(e);case Ee.WORKSPACE:return this.renderWorkspaceRequest(e);case Ee.APP:return this.renderAppRequest(e)}case ue.INVITATION:switch(e.resourceType){case Ee.USER:return this.renderUserInvitation(e);case Ee.WORKSPACE:case Ee.APP:return M.createElement(M.Fragment,null,M.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return M.createElement("div",{key:e.id,className:"OutboxRequest kbCard"},M.createElement("div",{className:"kbCard-header"},M.createElement("div",{className:"OutboxRequest-requestHeaderRow"},M.createElement("div",{className:"OutboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),M.createElement("div",{className:"OutboxRequest-requestHeaderExpireAt"},M.createElement("span",{className:"field-label"},"expires")," ",_r(e.expireAt)))),M.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(M.Component));var la=Object(W.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e(Yn(t.id))}}})(oa),ca=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("/#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){Dt.a.info({title:"Manage Requests Help",width:"50em",content:M.createElement("div",null,M.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:M.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderLoadingHeader",value:function(){var e=M.createElement("span",null,"Loading Org Editor...");return M.createElement(zn,{breadcrumbs:e})}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=M.createElement("span",null,M.createElement(Mt.a,{type:"user"}),M.createElement(Mt.a,{type:"arrow-right"}),M.createElement(Mt.a,{type:"team"})," ","Request to Join Group"),n=[M.createElement(At.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),M.createElement(At.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return M.createElement(Un.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},M.createElement("table",{className:"Requests-pendingRequestsTable"},M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"from"),M.createElement("td",{className:"Requests-requester"},M.createElement(ea,{userId:e.requester,avatarSize:50}))),M.createElement("tr",null,M.createElement("th",null,"sent"),M.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),M.createElement("tr",null,M.createElement("th",null,"expires"),M.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",_r(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=M.createElement("span",null,M.createElement(Mt.a,{type:"team"}),M.createElement(Mt.a,{type:"mail"}),M.createElement(Mt.a,{type:"arrow-right"}),M.createElement(Mt.a,{type:"user"})," ","Invitation to Join Group"),n=[M.createElement(At.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e)}},"Cancel")];return M.createElement(Un.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},M.createElement("table",{className:"Requests-pendingRequestsTable"},M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"invitation to"),M.createElement("td",{className:"Requests-requester"},M.createElement(ea,{userId:e.user,avatarSize:30}))),M.createElement("tr",null,M.createElement("th",null,"sent"),M.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),M.createElement("tr",null,M.createElement("th",null,"expires"),M.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",_r(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case Ne.NONE:return"None";case Ne.VIEW:return"View Only";case Ne.EDIT:return"Edit";case Ne.ADMIN:return"Admin";case Ne.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=M.createElement("span",null,M.createElement(Mt.a,{type:"file"}),M.createElement(Mt.a,{type:"arrow-right"}),M.createElement(Mt.a,{type:"team"})," ","Request to Associate Narrative"),a=[M.createElement(At.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e)}},"Approve"),M.createElement(At.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e)}},"Deny")];return t=M.createElement(aa,{workspaceId:parseInt(e.narrativeId,10)}),M.createElement(Un.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},M.createElement("table",{className:"Requests-pendingRequestsTable"},M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"from"),M.createElement("td",{className:"Requests-requester"},M.createElement(ea,{userId:e.requester,avatarSize:30}))),M.createElement("tr",null,M.createElement("th",null,"narrative"),M.createElement("td",{className:"Requests-narrative"},t)),M.createElement("tr",null,M.createElement("th",null,"sent"),M.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),M.createElement("tr",null,M.createElement("th",null,"expires"),M.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",_r(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=M.createElement("span",null,M.createElement(Mt.a,{type:"appstore"}),M.createElement(Mt.a,{type:"arrow-right"}),M.createElement(Mt.a,{type:"team"})," ","Request to Add App"),n=[M.createElement(At.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),M.createElement(At.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return M.createElement(Un.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},M.createElement("table",{className:"Requests-pendingRequestsTable"},M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"from"),M.createElement("td",{className:"Requests-requester"},M.createElement(ea,{userId:e.requester,avatarSize:50}))),M.createElement("tr",null,M.createElement("th",null,"app"),M.createElement("td",{className:"Requests-requester"},e.appId)),M.createElement("tr",null,M.createElement("th",null,"sent"),M.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),M.createElement("tr",null,M.createElement("th",null,"expires"),M.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",_r(e.expireAt),")")))))}},{key:"renderInbox",value:function(){var e;if(0===this.props.inbox.length)e=M.createElement(St.a,{type:"info",message:"No pending requests"});else{var t=this.props.inbox.map(function(e){return M.createElement("div",{key:e.id},M.createElement(sa,{request:e}))});e=M.createElement("div",{style:{overflowY:"auto"}},t)}return M.createElement(M.Fragment,null,e)}},{key:"renderOutbox",value:function(){var e;if(0===this.props.outbox.length)e=M.createElement(St.a,{type:"info",message:"No pending requests"});else{var t=this.props.outbox.map(function(e){return M.createElement("div",{key:e.id},M.createElement(la,{request:e}))});e=M.createElement("div",{style:{overflowY:"auto"}},t)}return M.createElement(M.Fragment,null,e)}},{key:"isAdmin",value:function(e){return e.type===Ae.ADMIN||e.type===Ae.OWNER}},{key:"render",value:function(){if(this.isAdmin(this.props.relation)){var e=this.props.outbox.length,t=this.props.inbox.length;return M.createElement("div",{className:"Requests"},M.createElement("div",{className:"Requests-tabPaneHeader"},"inbox (",t,")"),this.renderInbox(),M.createElement("div",{className:"Requests-tabPaneHeader"},"outbox (",e,")"),this.renderOutbox())}var r=this.props.outbox.length;return M.createElement("div",{className:"Requests"},M.createElement("div",{className:"Requests-tabPaneHeader"},"outbox (",r,")"),this.renderOutbox())}}]),t}(M.Component);var ua=Object(W.b)(function(e,t){return{}},function(e){return{onAcceptJoinRequest:function(t){e(Vn(t.id))},onDenyJoinRequest:function(t){e(Qn(t.id))},onCancelJoinInvitation:function(t){e(Yn(t.id))},onGetViewAccess:function(e){}}})(ca);r(275);function Ea(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var da=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Ea(this.state.view)})}},{key:"renderLogo",value:function(e){return M.createElement(Tt,{logoUrl:e.logoUrl,size:80,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(!e.homeUrl)return M.createElement(yt.a,{placement:"bottomRight",title:"This organization has not set a home page url"},M.createElement(Mt.a,{type:"home",style:{color:"rgba(200, 200, 200, 0.3)"}}));var t=M.createElement(M.Fragment,null,M.createElement("p",null,"Home page for this Organization (external to KBase)"));return M.createElement("div",{className:"BriefOrganizationHeader-homeUrl"},M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:t},M.createElement("a",{href:e.homeUrl,target:"_blank"},M.createElement(Mt.a,{type:"home"}))))}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?M.createElement("span",null,e.narrativeCount):M.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return 1==e.memberCount?M.createElement("span",{style:{color:"gray"}},"\xd8"):M.createElement("span",null,e.memberCount-1)}},{key:"renderRelation",value:function(e){switch(e.relation){case Ae.NONE:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},M.createElement("span",null,M.createElement(Mt.a,{type:"stop"})));case Ae.VIEW:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},M.createElement(Mt.a,{type:"stop"}));case Ae.MEMBER_REQUEST_PENDING:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"Your membership request is pending"},M.createElement(Mt.a,{type:"user",style:{color:"orange"}})," Your membership ",M.createElement("b",null,"request")," is pending");case Ae.MEMBER_INVITATION_PENDING:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this organization"},M.createElement(Mt.a,{type:"user",style:{color:"blue"}}));case Ae.MEMBER:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},M.createElement(Mt.a,{type:"user"}));case Ae.ADMIN:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an administrator of this organization"},M.createElement(Mt.a,{type:"robot"}));case Ae.OWNER:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are the owner of this organization"},M.createElement(Mt.a,{type:"crown"}))}}},{key:"renderPrivacy",value:function(){return this.props.organization.isPrivate?M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is private - may only be viewed by members"},M.createElement("span",null,M.createElement(Mt.a,{type:"unlock"}))):M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is public - may be viewed by any KBase user"},M.createElement("span",null,M.createElement(Mt.a,{type:"global"})))}},{key:"renderOrgFreshness",value:function(e){var t;if(e.lastVisitedAt&&e.modifiedAt.getTime()>e.lastVisitedAt.getTime()){t=M.createElement("div",null,M.createElement(yt.a,{placement:"topRight",title:"This org has changed since your last visit to it; new or updated items are highlighted"},M.createElement("span",{style:{color:"red",fontSize:"120%"}},M.createElement(Mt.a,{type:"bell",theme:"filled"}))))}else t=M.createElement("div",null,M.createElement("span",{style:{color:"transparent",fontSize:"120%"}},M.createElement(Mt.a,{type:"bell",theme:"filled"})));var r;return r=null,M.createElement("div",null,t,r)}},{key:"renderRequests",value:function(){if(this.props.organization.relation===Ae.ADMIN||this.props.organization.relation===Ae.OWNER){var e,t;switch(this.props.openRequestsStatus){case Ie.NONE:e="There are no open requests for this organization",t="rgba(200, 200, 200, 0.3)";break;case Ie.NEW:e="There are new requests since you last visited this organization",t="red";break;case Ie.OLD:e="There are open requests for this organization",t="blue";break;case Ie.INAPPLICABLE:return;default:return void console.warn("Invalid open request status: "+this.props.openRequestsStatus)}var r=M.createElement("span",null,e);return M.createElement(yt.a,{placement:"topRight",title:r},M.createElement("span",{style:{color:t,fontSize:"80%"}},M.createElement(Mt.a,{type:"mail",theme:"filled"})))}}},{key:"renderPermalink",value:function(){var e=M.createElement("div",null,M.createElement("p",null,'Below is the "permalink" for this organization. You may copy this url and use it to access this organization in a web browser.'),M.createElement("p",{style:{fontFamily:"monospace",fontWeight:"bold"}},window.location.origin,"/#org/",this.props.organization.id)),t=M.createElement(Ct.a,{onClick:function(t){t.key;Dt.a.info({title:"Org Permalink",content:e})}},M.createElement(Ct.a.Item,{key:"view"},"View Permalink"));return M.createElement(kt.a,{overlay:t,trigger:["click","contextMenu"]},M.createElement("a",{href:"/#orgs/"+this.props.organization.id},M.createElement(Mt.a,{type:"link"})))}},{key:"renderLogoColumn",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"BriefOrganizationHeader-logoRow"},M.createElement(Nt.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),M.createElement("div",{className:"BriefOrganizationHeader-statusRow"},M.createElement("div",{className:"BriefOrganizationHeader-relationCol"},this.renderRelation(e)),M.createElement("div",{className:"BriefOrganizationHeader-privacyCol"},this.renderPrivacy()),M.createElement("div",{className:"BriefOrganizationHeader-homeLinkCol"},this.renderHomeUrl(e))),M.createElement("div",{className:"BriefOrganizationHeader-freshnessRow"},M.createElement("div",{className:"BriefOrganizationHeader-orgFreshnessCol"},this.renderOrgFreshness(e)),M.createElement("div",{className:"BriefOrganizationHeader-openRequestsCol"},this.renderRequests()),M.createElement("div",{className:"BriefOrganizationHeader-openNewRequestsCol"},this.renderPermalink())))}},{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderInfoCol",value:function(e){M.createElement("span",null,"This organization was last updated"," ",M.createElement(fr,{time:e.modifiedAt,showTooltip:!0}));return M.createElement(M.Fragment,null,M.createElement("div",{className:"BriefOrganizationHeader-orgName BriefOrganizationHeader-infoTableRow"},M.createElement(Nt.a,{to:"/viewOrganization/".concat(e.id)},e.name)),M.createElement("div",{className:"BriefOrganizationHeader-researchInterests BriefOrganizationHeader-infoTableRow"},e.researchInterests),M.createElement("div",{className:"BriefOrganizationHeader-orgOwner BriefOrganizationHeader-infoTableRow"},M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},M.createElement("span",{className:"field-label BriefOrganizationHeader-fieldLabel"},"owner")),M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},M.createElement(wr,{username:e.owner.username,avatarSize:16,showAvatar:!1}))),M.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},M.createElement("span",{className:"field-label BriefOrganizationHeader-fieldLabel"},"created")),M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:this.fullTimestamp(e.createdAt)},M.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))))),M.createElement("div",{className:"BriefOrganizationHeader-orgOwner BriefOrganizationHeader-infoTableRow"},M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},M.createElement("span",{className:"field-label"},"updated")),M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},M.createElement(fr,{time:e.modifiedAt,tooltipPrefix:"This organization was last updated "}))))}},{key:"renderMemberRow",value:function(e){var t,r=e.memberCount-1;return t=r?1===r?M.createElement("span",null,"There is ",M.createElement("b",null,"1")," member in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,r)," members in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,"no members")," in this organization"),M.createElement(yt.a,{placement:"bottomRight",title:t},M.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"team"}))),M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},this.renderMemberCount(e))))}},{key:"renderNarrativeRow",value:function(e){var t,r=e.narrativeCount;return t=r?1===r?M.createElement("span",null,"There is ",M.createElement("b",null,"1")," narrative in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,r)," narratives in this organization"):M.createElement("span",null,"There are ",M.createElement("b",null,"no narratives")," in this organization"),M.createElement(yt.a,{placement:"bottomRight",title:t},M.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"file"}))),M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},this.renderNarrativeCount(e))))}},{key:"renderModifiedRow",value:function(e){var t=M.createElement("span",null,"This organization was last updated"," ",M.createElement(fr,{time:e.modifiedAt,showTooltip:!1}));return M.createElement(yt.a,{placement:"bottomRight",title:t},M.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"save"}))),M.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},M.createElement(fr,{time:e.modifiedAt,showTooltip:!1}))))}},{key:"renderButtonsRow",value:function(){return M.createElement("div",{className:"ButtonSet"},M.createElement("div",{className:"ButtonSet-button"},this.props.orgMenu))}},{key:"renderBackButton",value:function(){return M.createElement(At.a,{type:"danger",onClick:this.props.onNavigateToBrowser},"back")}},{key:"renderStatsCol",value:function(e){return M.createElement("div",{className:"BriefOrganizationHeader-buttonsCol"},M.createElement("div",{className:"BriefOrganizationHeader-buttonsRow",style:{marginBottom:"10px"}},M.createElement("div",{className:"ButtonSet"},this.renderBackButton())),M.createElement("div",{className:"BriefOrganizationHeader-buttonsRow"},this.renderButtonsRow()))}},{key:"renderNormal",value:function(){var e=this.props.organization;return M.createElement("div",{className:"BriefOrganization"},M.createElement("div",{className:"BriefOrganizationHeader-body"},M.createElement("div",{className:"BriefOrganizationHeader-logoCol"},this.renderLogoColumn(e)),M.createElement("div",{className:"BriefOrganizationHeader-infoCol"},M.createElement("div",{className:"BriefOrganizationHeader-infoCol-row"},M.createElement("div",{className:"BriefOrganizationHeader-infoCol-col1"},this.renderInfoCol(e)),M.createElement("div",{className:"BriefOrganizationHeader-infoCol-col2"},this.renderStatsCol(e))))))}},{key:"render",value:function(){return this.renderNormal()}}]),t}(M.Component);r(276);var ma=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderLogo",value:function(e){return M.createElement(Tt,{logoUrl:e.logoUrl,size:30,organizationName:e.name,organizationId:e.id})}},{key:"render",value:function(){var e=this.props.organization;return M.createElement("div",{className:"OrganizationEntity-Accessible "},M.createElement("div",{className:"OrganizationEntity-Accessible-logoCol"},this.renderLogo(e)),M.createElement("div",{className:"OrganizationEntity-Accessible-mainCol"},M.createElement("div",{className:"OrganizationEntity-Accessible-name"},M.createElement(Nt.a,{to:"/viewOrganization/".concat(e.id)},e.name)),M.createElement("div",{className:"OrganizationEntity-Accessible-researchInterests"},e.researchInterests),M.createElement("div",{className:"OrganizationEntity-Accessible-owner"},M.createElement(wr,{username:e.owner.username,showAvatar:!1,avatarSize:20}))))}}]),t}(M.Component),va=(r(277),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return M.createElement("div",{className:"OrganizationEntity-Inaccessible "},M.createElement("div",{className:"OrganizationEntity-Inaccessible-logoCol"},M.createElement(Mt.a,{type:"lock"})),M.createElement("div",{className:"OrganizationEntity-Inaccessible-mainCol"},M.createElement("div",{className:"OrganizationEntity-Inaccessible-name"},"Private Organization")))}}]),t}(M.Component));var pa=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){if(!this.props.organization)return M.createElement("div",null,M.createElement(Mt.a,{type:"loading"}));switch(this.props.organization.kind){case be.NORMAL:return M.createElement(ma,{organization:this.props.organization});case be.INACCESSIBLE_PRIVATE:return M.createElement(va,{organization:this.props.organization});default:return M.createElement("div",null,"Error: unrecognized org kind")}}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(M.Component);var Oa=Object(W.b)(function(e,t){return{organization:e.entities.organizations.byId.get(t.organizationId)||null}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.ENTITY_ORGANIZATION_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,c=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url}),t.prev=3,t.next=6,c.getOrg(e);case 6:u=t.sent,r({type:J.ENTITY_ORGANIZATION_LOAD_SUCCESS,organization:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:J.ENTITY_ORGANIZATION_LOAD_ERROR,error:pr({code:t.t0.name,message:t.t0.message})});case 13:case"end":return t.stop()}},t,null,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(pa),ha=r(321),Ra=(r(278),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.props.onManageRelatedOrgs()}},{key:"renderToolbar",value:function(){return M.createElement("div",{className:"RelatedOrganizations-toolbar"},M.createElement(At.a,{onClick:this.onManageRelatedOrgs.bind(this)},"Add Related Org"))}},{key:"onAdminMenu",value:function(e,t){switch(e){case"removeRelation":this.props.onRemoveRelatedOrganization(this.props.organization.id,t)}}},{key:"renderControls",value:function(e){var t=this;if(this.props.organization.isAdmin){var r=M.createElement(Ct.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},M.createElement(Ct.a.Item,{key:"removeRelation"},M.createElement(Mt.a,{type:"delete"}),"Remove"));return M.createElement("div",null,M.createElement(kt.a,{overlay:r,trigger:["click"]},M.createElement(Mt.a,{type:"ellipsis",className:"IconButton-hover"})))}}},{key:"renderBody",value:function(){var e=this;if(0===this.props.relatedOrganizations.length){var t=M.createElement("p",null,"No related organizations");return M.createElement(St.a,{type:"info",message:t})}var r=Object(ha.a)(Oa),n=this.props.relatedOrganizations.map(function(t){return M.createElement("div",{key:t,className:"RelatedOrganizations-orgRow SimpleCard"},M.createElement("div",{className:"RelatedOrganizations-orgCol"},M.createElement(r,{organizationId:t})),M.createElement("div",{className:"RelatedOrganizations-controlCol"},e.renderControls(t)))});return M.createElement("div",{className:"RelatedOrganizations-organizations"},n)}},{key:"render",value:function(){return M.createElement("div",{className:"RelatedOrganizations scrollable-flex-column"},M.createElement("div",{className:"RelatedOrganizations-bodyRow scrollable-flex-column"},this.renderBody()))}}]),t}(M.Component));var wa=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==N.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onRemoveRelatedOrganization:function(t,r){e(function(e,t){return function(){var r=Object(le.a)(oe.a.mark(function r(n,a){var i,s,o,l,c,u;return oe.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:J.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,l=s.username,c=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new He({token:o,username:l,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:J.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:J.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:Je({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,null,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))}}})(Ra),_a=(r(279),r(280),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderRelated",value:function(){if(this.props.selectableOrganization.isRelated)return M.createElement(Mt.a,{type:"check",style:{color:"green"}})}},{key:"render",value:function(){return M.createElement("div",{className:"AvailableOrganization"},M.createElement("div",{className:"AvailableOrganization-relatedCol"},this.renderRelated()),M.createElement("div",{className:"AvailableOrganization-orgCol"},M.createElement("div",{className:"AvailableOrganization-logoCol"},M.createElement(Tt,{logoUrl:this.props.selectableOrganization.organization.logoUrl,size:30,organizationName:this.props.selectableOrganization.organization.name,organizationId:this.props.selectableOrganization.organization.id})),M.createElement("div",{className:"AvailableOrganization-orgInfoCol"},M.createElement("div",{className:"AvailableOrganization-name"},this.props.selectableOrganization.organization.name),M.createElement("div",{className:"AvailableOrganization-owner"},M.createElement(wr,{username:this.props.selectableOrganization.organization.owner.username,avatarSize:20,showAvatar:!1})))),M.createElement("div",{className:"AvailableOrganization-actionCol"}))}}]),t}(M.Component)),ga=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onAddSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onAddOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"onRemoveSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onRemoveOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"onFilterChange",value:function(e){e.persist(),this.props.onSearch(e.target.value)}},{key:"renderAvailableToolbar",value:function(){return M.createElement("div",{className:"ManageRelatedOrganizations-available-toolbar"},M.createElement(cn.a,{placeholder:"Filter Available Organizations",onChange:this.onFilterChange.bind(this)}))}},{key:"renderAvailableOrgs",value:function(){var e=this;return this.props.organizations.map(function(t){var r=["SimpleCard","ManageRelatedOrganizations-availableOrganization"];return t.isSelected&&r.push("ManageRelatedOrganizations-selected"),M.createElement("div",{className:r.join(" "),onClick:function(){e.props.onSelectOrganization(t)},key:t.organization.id},M.createElement(_a,{selectableOrganization:t}))})}},{key:"renderSelectedOrg",value:function(){var e,t,r,n={marginBottom:"4px"};if(this.props.selectedOrganization)t=M.createElement("div",{className:"ManageRelatedOrganizations-selectedOrganization"},M.createElement(Sr,{organization:this.props.selectedOrganization.organization,openRequestsStatus:null})),this.props.selectedOrganization.isRelated?(r=M.createElement(St.a,{type:"warning",message:"This org is associated",style:n}),e=M.createElement(At.a,{type:"danger",disabled:null===this.props.selectedOrganization,onClick:this.onRemoveSelectedOrganization.bind(this)},"Remove Organization")):e=M.createElement(At.a,{type:"primary",disabled:null===this.props.selectedOrganization,onClick:this.onAddSelectedOrganization.bind(this)},"Add Organization");else{var a=M.createElement(M.Fragment,null,M.createElement("p",null,"When you select an organization on the left, details about it will be displayed here."));r=M.createElement(St.a,{type:"info",message:a,style:n}),e=M.createElement(At.a,{type:"primary",disabled:null===this.props.selectedOrganization,onClick:this.onAddSelectedOrganization.bind(this)},"Add Organization")}return M.createElement(M.Fragment,null,r,t,M.createElement("div",{className:"ManageRelatedOrganizations-buttonBar"},e))}},{key:"render",value:function(){var e=this;return M.createElement("div",{className:"ManageRelatedOrganizations scrollable-flex-column"},M.createElement("div",{className:"ManageRelatedOrganizations-toolbar"},M.createElement(At.a,{onClick:function(){return e.props.onFinish()},type:"danger"},M.createElement(Mt.a,{type:"rollback"})," ","Done")),M.createElement("div",{className:"ManageRelatedOrganizations-main scrollable-flex-column"},M.createElement("div",{className:"ManageRelatedOrganizations-availableOrgs"},M.createElement("h3",{style:{textAlign:"center"}},"Available Organizations"),this.renderAvailableToolbar(),M.createElement("div",{className:"ManageRelatedOrganizations-organizations"},this.renderAvailableOrgs())),M.createElement("div",{className:"ManageRelatedOrganizations-relatedOrgs"},M.createElement("h3",{style:{textAlign:"center"}},"Selected Organization"),this.renderSelectedOrg())))}}]),t}(M.Component);var fa=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==N.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.manageRelatedOrganizationsView.viewModel)throw new Error("argh, null subview view model");var n=r.subViews.manageRelatedOrganizationsView.viewModel;return{organization:n.organization,organizations:n.availableOrganizations.queried,relatedOrganizations:n.relatedOrganizations,selectedOrganization:n.selectedOrganization}},function(e){return{onSelectOrganization:function(t){e(function(e){return{type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION,selectedOrganization:e}}(t))},onAddOrganization:function(t,r){e(function(e,t){return function(){var r=Object(le.a)(oe.a.mark(function r(n,a){var i,s,o,l,c,u;return oe.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,l=s.username,c=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new He({token:o,username:l,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url}),r.prev=5,r.next=8,u.addRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,error:Je({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,null,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onRemoveOrganization:function(t,r){e(function(e,t){return function(){var r=Object(le.a)(oe.a.mark(function r(n,a){var i,s,o,l,c,u;return oe.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,l=s.username,c=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new He({token:o,username:l,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:J.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:Je({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,null,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onSearch:function(t){var r;e((r=t,function(){var e=Object(le.a)(oe.a.mark(function e(t,n){var a,i,s,o,l,c,u,E;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,null!==(c=a.views.viewOrgView.viewModel)){e.next=4;break}throw new Error("view is not populated");case 4:if(c.kind===N.NORMAL){e.next=6;break}throw new Error("view is not normal");case 6:if(null!==(u=c.subViews.manageRelatedOrganizationsView.viewModel)){e.next=9;break}throw new Error("vm is null");case 9:new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url});try{E=Ze(u.availableOrganizations.organizations,r),t({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS,organizations:E,searchBy:r})}catch(d){t({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR,error:Je({code:"error",message:d.message})})}case 11:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()))}}})(ga),Aa=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement("div",null,"Loading Related Organizations Manager..."," ",M.createElement(jr.a,null));return M.createElement(St.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return M.createElement("div",null,"Error!",M.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case T.NONE:case T.LOADING:return this.renderLoading();case T.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return M.createElement(fa,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case T.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var Sa=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==N.NORMAL)throw new Error("not the right vm");return{view:r.subViews.manageRelatedOrganizationsView}},function(e){return{onLoad:function(){e(function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i,s,o,l,c,u,E,d;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,null!==(l=n.views.viewOrgView.viewModel)){e.next=4;break}throw new Error("view is not populated");case 4:if(l.kind===N.NORMAL){e.next=6;break}throw new Error("view is not normal");case 6:return c=l.organization,u=new He({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url}),e.prev=8,e.next=11,u.getAllOrgs2();case 11:E=e.sent,d=E.map(function(e){return{isRelated:c.relatedOrganizations.includes(e.id),isSelected:!1,organization:e}}),t({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS,organizations:d}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),t({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR,error:Je({code:"error",message:e.t0.message})});case 19:case"end":return e.stop()}},e,null,[[8,16]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:J.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD})}}})(Aa);function Na(e){return{type:J.INVITE_USER_LOAD_ERROR,error:e}}function ba(e){return{type:J.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Ia(e){return{type:J.INVITE_USER_SELECT_USER_ERROR,error:e}}function Ta(e,t){var r=t.organization;if(e.username===r.owner.username)return Ae.OWNER;var n=r.members.find(function(t){return t.username===e.username});if(n)switch(n.type){case c.ADMIN:return Ae.ADMIN;case c.OWNER:return Ae.OWNER;case c.MEMBER:return Ae.MEMBER}var a=t.requestInbox,i=t.requestOutbox;return a.some(function(t){return t.resourceType===E.USER&&t.requester===e.username})?Ae.MEMBER_REQUEST_PENDING:i.some(function(t){return t.resourceType===E.USER&&t.user===e.username})?Ae.MEMBER_INVITATION_PENDING:Ae.VIEW}function ya(e){var t=e.views.viewOrgView.viewModel;if(null===t)throw new Error("select user invalid state -- no view value");if(t.kind!==N.NORMAL)throw new Error("select user invalid state -- no view value");var r=t.subViews.inviteUserView;if(null===r)throw new Error("select user invalid state -- no view value");return[t,r]}function Ma(e){return{type:J.INVITE_USER_SEND_INVITATION_ERROR,error:e}}function Da(){return function(e,t){e({type:J.INVITE_USER_SEND_INVITATION_START});var r,n=t();try{var a=ya(n);r=Object(ce.a)(a,2)[1]}catch(d){return void e(Ia(pr({code:"invalid state",message:d.message})))}var i=n.auth.authorization,s=i.token,o=i.username,l=n.app.config;if(null!==r.viewModel){var c=r.viewModel,u=c.selectedUser,E=c.organization.id;if(u)new he({token:s,username:o,groupsServiceURL:l.services.Groups.url}).inviteUserToJoinOrg(E,u.user.username).then(function(t){e({type:J.INVITE_USER_SEND_INVITATION_SUCCESS}),e(Tn(E))}).catch(function(t){e(Ma(pr({code:t.name,message:t.message})))})}else e(Ma(pr({code:"error",message:"null view model"})))}}r(281);var Ca=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return M.createElement("div",{className:"User"},M.createElement("div",{className:"avatarCol"},M.createElement(zt,{user:this.props.user,size:this.props.avatarSize||30})),M.createElement("div",{className:"infoCol"},M.createElement("div",{className:"name"},M.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),M.createElement("div",{className:"organization"},this.props.user.organization||M.createElement("i",null,"no organization in user profile")),M.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||M.createElement("i",null,"no location information in user profile"))))}}]),t}(M.Component),ka=r(153),Va=(r(282),function(e){function t(e,r){var n;return Object(V.a)(this,t),(n=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onMenuSelection",value:function(e){}},{key:"renderMenu",value:function(){return M.createElement(ka.a,{render:function(e){e.history;var t=[];switch(e.location.pathname){case"/organizations":t=["allorgs"];break;case"/newOrganization":t=["neworg"]}return M.createElement(Ct.a,{selectedKeys:t,style:{backgroundColor:"transparent"},mode:"horizontal"})}})}},{key:"render",value:function(){return M.createElement("div",{className:"MainMenu"},M.createElement("div",{className:"MainMenu-menu"},this.renderMenu()),M.createElement("div",{className:"MainMenu-buttons"},this.props.buttons))}}]),t}(M.Component)),Ua=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.render(this.props.user)}}]),t}(M.Component),za=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.user?M.createElement(Ua,{user:this.props.user,render:this.props.render}):M.createElement("div",null,M.createElement(Mt.a,{type:"loading"})," ","Loading user ",this.props.userId," ...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(M.Component);var ja=Object(W.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(Or(t))}}})(za),Ga=(r(283),function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).lastSearchAt=void 0,r.searchInput=void 0,r.searchButton=void 0,r.lastSearchAt=null,r.searchInput=M.createRef(),r.searchButton=M.createRef(),r.state={autocompleteMessage:""},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onClickCancelToViewer",value:function(){this.props.onFinish()}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"renderOrgName",value:function(e){return e.length<25?e:M.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return M.createElement(St.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}if(0===this.props.users.length)return M.createElement(St.a,{type:"warning",message:"No users found",showIcon:!0});var t=function(e){M.createElement(Ca,{user:e,avatarSize:30});return M.createElement("div",{className:"InviteUser-name"},M.createElement(zt,{user:e,size:20})," ",e.realname," (",e.username,")")};return this.props.users.map(function(r){var n,a,i,s="#000";switch(r.relation){case Ae.NONE:break;case Ae.MEMBER:n="user",a="This user is already a member of this Organization";break;case Ae.ADMIN:n="lock",a="This user is already an administrator of this Organization";break;case Ae.OWNER:n="crown",a="This user is the owner of this organization";break;case Ae.MEMBER_REQUEST_PENDING:n="inbox",a="This user has already requested membership to this Organization (check your requests inbox)",s="orange";break;case Ae.MEMBER_INVITATION_PENDING:n="mail",a="This user has already been invited to join this Organization",s="orange"}n&&(i=M.createElement(yt.a,{title:a},M.createElement(Mt.a,{type:n,style:{color:s}})));var o=["InviteUser-userRow"];return e.props.selectedUser&&r.username===e.props.selectedUser.user.username&&o.push("InviteUser-selected"),M.createElement("div",{className:o.join(" "),key:r.username,onClick:function(){e.onSelectUser.call(e,r)}},M.createElement("div",{className:"InviteUser-statusCol"},i),M.createElement("div",{className:"InviteUser-userCol"},M.createElement(ja,{userId:r.username,render:t})))})}},{key:"renderOrgInfo",value:function(){return M.createElement("div",{className:"orgInfo"},M.createElement("div",{className:"InviteUser-name"},M.createElement("span",{className:"field-label"},"name"),M.createElement("span",null,this.props.organization.name)),M.createElement("div",{className:"InviteUser-description"},M.createElement("span",{className:"field-label"},"description"),M.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===Ae.VIEW?e=M.createElement(At.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=M.createElement(At.a,{disabled:!0,type:"primary"},"Send Invitation"),t=M.createElement("div",null,"User may not be invited because:",M.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=M.createElement(St.a,{type:"warning",message:t,showIcon:!0})):(e=M.createElement(At.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),M.createElement("div",{className:"invitationForm"},M.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),M.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case w.NONE:return M.createElement("div",null,"NONE");case w.EDITING:return M.createElement("div",null,"EDITING");case w.SENDABLE:return M.createElement("div",null,"SENDABLE");case w.SENDING:return M.createElement("div",null,"SENDING");case w.SUCCESS:return M.createElement("div",null,"SENT SUCCESSFULLY");case w.ERROR:return M.createElement("div",null,"ERROR SENDING");default:return M.createElement("div",null,"Bad State")}}},{key:"renderRelation",value:function(e){switch(e){case Ae.NONE:return M.createElement("span",null,M.createElement(Mt.a,{type:"stop"}),"None");case Ae.VIEW:return M.createElement("span",null,M.createElement(Mt.a,{type:"stop"})," Not a member");case Ae.MEMBER_REQUEST_PENDING:return M.createElement("span",null,M.createElement(Mt.a,{type:"user",style:{color:"orange"}})," User's membership ",M.createElement("b",null,"request")," is pending");case Ae.MEMBER_INVITATION_PENDING:return M.createElement("span",null,M.createElement(Mt.a,{type:"user",style:{color:"blue"}})," User has been ",M.createElement("b",null,"invited")," to join");case Ae.MEMBER:return M.createElement("span",null,M.createElement(Mt.a,{type:"user"})," User is a ",M.createElement("b",null,"member")," of this organization");case Ae.ADMIN:return M.createElement("span",null,M.createElement(Mt.a,{type:"unlock"}),"User is an ",M.createElement("b",null,"admin")," of this organization");case Ae.OWNER:return M.createElement("span",null,M.createElement(Mt.a,{type:"crown"})," User is the ",M.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?M.createElement("div",{className:"InviteUser-selectedUser"},M.createElement("p",{className:"InviteUser-noSelection"},"No user yet selected")):M.createElement("div",{className:"InviteUser-selectedUser"},M.createElement(Ca,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return M.createElement("div",{className:"InviteUser-footer"})}},{key:"renderSearchButton",value:function(){return M.createElement(Mt.a,{type:"search"})}},{key:"renderMenuButtons",value:function(){return M.createElement("div",{className:"ButtonSet"},M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"rollback",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Done")))}},{key:"render",value:function(){return M.createElement("div",{className:"InviteUser scrollable-flex-column"},M.createElement(Va,{buttons:this.renderMenuButtons()}),M.createElement("div",{className:"InviteUser-row scrollable-flex-column"},M.createElement("div",{className:"InviteUser-col1 -firstCol InviteUser-users scrollable-flex-column"},M.createElement("h3",null,"Select User to Invite"),M.createElement("form",{id:"searchForm",className:"InviteUser-searchBar",onSubmit:this.onSubmit.bind(this)},M.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),M.createElement(At.a,{className:"InviteUser-searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),M.createElement("div",{className:"InviteUser-usersTable"},this.renderUsers())),M.createElement("div",{className:"InviteUser-col1 -lastCol"},M.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(M.Component));Ga.searchDebounce=200;var La=Ga;var Pa=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==N.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.inviteUserView.viewModel)throw new Error("argh, null subview view model");return r.subViews.inviteUserView.viewModel},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,u,d,m,v,p,O,h,R,w,_;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:J.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(ba(null)),t.abrupt("return");case 4:if(a=n(),i=a.auth.authorization.token,s=a.app.config,null!==(o=a.views.viewOrgView.viewModel)){t.next=7;break}throw new Error("view is not populated");case 7:if(o.kind===N.NORMAL){t.next=9;break}throw new Error("view is not normal");case 9:return l=o.organization,u=new Te({token:i,userProfileServiceURL:s.services.UserProfile.url}),d=l.owner.username,m=[],v=[],p=[],O=[],l.members.forEach(function(e){switch(e.type){case c.MEMBER:v.push(e.username);case c.ADMIN:m.push(e.username)}}),h=o.requestInbox,R=o.requestOutbox,h.forEach(function(e){e.resourceType===E.USER&&O.push(e.requester)}),R.forEach(function(e){e.resourceType===E.USER&&p.push(e.user)}),t.prev=21,t.next=24,u.searchUsers(e);case 24:w=t.sent,_=w.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?Ae.OWNER:m.indexOf(t)>=0?Ae.ADMIN:p.indexOf(t)>=0?Ae.MEMBER_INVITATION_PENDING:O.indexOf(t)>=0?Ae.MEMBER_REQUEST_PENDING:v.indexOf(t)>=0?Ae.MEMBER:Ae.NONE}}),r(ba(_)),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(21),r((g=pr({code:t.t0.name,message:t.t0.message}),{type:J.INVITE_USER_SEARCH_USERS_ERROR,error:g}));case 32:case"end":return t.stop()}var g},t,null,[[21,29]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){var r;e((r=t,function(){var e=Object(le.a)(oe.a.mark(function e(t,n){var a,i,s,o,l,c,u,E,d,m;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:J.INVITE_USER_SELECT_USER_START}),a=n(),e.prev=2,o=ya(a),l=Object(ce.a)(o,2),i=l[0],s=l[1],e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(2),t(Ia(pr({code:"invalid state",message:e.t0.message}))),e.abrupt("return");case 13:if(null!==s.viewModel){e.next=16;break}return t(Ia(pr({code:"error",message:"missing view model"}))),e.abrupt("return");case 16:return c=a.auth.authorization.token,u=a.app.config,E=new Te({token:c,userProfileServiceURL:u.services.UserProfile.url}),e.prev=18,e.next=21,E.getUser(r);case 21:d=e.sent,m=Ta(d,i),t((v=d,p=m,{type:J.INVITE_USER_SELECT_USER_SUCCESS,user:v,relation:p})),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(18),t(Ia(pr({code:e.t1.name,message:e.t1.message})));case 29:case"end":return e.stop()}var v,p},e,null,[[2,9],[18,26]])}));return function(t,r){return e.apply(this,arguments)}}()))},onSendInvitation:function(){e(Da())}}})(La),xa=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement("div",null,"Loading ..."," ",M.createElement(jr.a,null));return M.createElement(St.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return M.createElement("div",null,"Error!",M.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case T.NONE:case T.LOADING:return this.renderLoading();case T.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(pr({code:"Missing Error",message:"The error appears to be missing"}));default:return M.createElement(Pa,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case T.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var Ba=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==N.NORMAL)throw new Error("not the right vm");return{view:r.subViews.inviteUserView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,c=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url}),t.prev=3,t.next=6,c.getOrg(e);case 6:if((u=t.sent).kind===be.NORMAL){t.next=10;break}return r(Na(pr({code:"invalid state",message:'Organization kind must be "NORMAL"'}))),t.abrupt("return");case 10:r((E=u,{type:J.INVITE_USER_LOAD_SUCCESS,organization:E,users:null})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),r(Na(pr({code:t.t0.name,message:t.t0.message})));case 16:case"end":return t.stop()}var E},t,null,[[3,13]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:J.INVITE_USER_UNLOAD})}}})(xa),Wa=r(315),qa=(r(284),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){var e=M.createElement("div",null,M.createElement("div",null,this.props.user.realname),M.createElement("div",null,M.createElement("span",null,M.createElement(zt,{user:this.props.user,size:20}))," ",M.createElement("span",null,this.props.user.username)));return M.createElement("div",{className:"UserSimple"},M.createElement(yt.a,{title:e,placement:"bottomRight"},M.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))}}]),t}(M.Component)),Ha=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.user?M.createElement(qa,{user:this.props.user,avatarSize:this.props.avatarSize}):M.createElement("div",null,M.createElement(Mt.a,{type:"loading"})," ","Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(M.Component);var Fa,Qa=Object(W.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(Or(t))}}})(Ha);r(285);function Ya(e){switch(e){case Fa.COMPACT:return Fa.NORMAL;case Fa.NORMAL:return Fa.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Fa||(Fa={}));var Ja=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={view:Fa.COMPACT},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Ya(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?M.createElement(yt.a,{title:"This narrative is viewable by all KBase users",placement:"right"},M.createElement("span",{style:{cursor:"help"}},M.createElement(Mt.a,{type:"global"})," Public Narrative")):M.createElement(yt.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},M.createElement("span",{style:{cursor:"help"}},M.createElement(Mt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t,r;switch(e.access){case rr.VIEW:t="eye",r=M.createElement("span",null,"View-Only (",M.createElement("i",null,"visit narrative to request additional access"),")");break;case rr.EDIT:t="edit",r=M.createElement("span",null,"This narrative is shared with you with ",M.createElement("b",null,"edit")," access (",M.createElement("i",null,"visit narrative to request additional access"),")");break;case rr.ADMIN:t="unlock",r=M.createElement("span",null,"This narrative is shared with you with ",M.createElement("b",null,"access")," - you may edit and re-share this");break;case rr.OWNER:t="crown",r=M.createElement("span",null,"You are the owner of this Narrative")}return M.createElement(yt.a,{placement:"bottomRight",title:r},M.createElement(Mt.a,{type:t}))}},{key:"renderGlobalPermission",value:function(e){var t,r;return e.isPublic?(t="global",r="This narrative has been shared publicly - with all KBase users"):(t="lock",r="This narrative is private - only accessible to the owner any users it has been shared with"),M.createElement(yt.a,{placement:"bottomRight",title:r},M.createElement(Mt.a,{type:t}))}},{key:"renderNiceElapsed",value:function(e){var t=M.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e));return M.createElement(yt.a,{placement:"bottomRight",title:t},_r(e))}},{key:"renderCompact",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Fa.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===Fa.NORMAL?"up":"down")}))),M.createElement("div",{className:"mainCol"},M.createElement("div",null,M.createElement("div",{className:"Narrative-title"},M.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",M.createElement("div",{className:"Narrative-owner"},M.createElement(Qa,{avatarSize:20,userId:e.owner}))),M.createElement("div",{className:"Narrative-attributes"},M.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),M.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),M.createElement("div",null,M.createElement("span",{className:"field-label"},"updated"),M.createElement(fr,{time:e.lastSavedAt}))))}},{key:"renderNormal",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"controlCol"},M.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Fa.NORMAL?"pressed":"")},M.createElement(Mt.a,{type:"".concat(this.state.view===Fa.NORMAL?"up":"down")}))),M.createElement("div",{className:"mainCol"},M.createElement("div",null,M.createElement("div",{className:"Narrative-title"},M.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",M.createElement("div",{className:"Narrative-owner"},M.createElement(Qa,{avatarSize:20,userId:e.owner}))),M.createElement("div",{className:"Narrative-attributes"},M.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),M.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),M.createElement("div",null,M.createElement("span",{className:"field-label"},"last saved"),this.renderNiceElapsed(e.lastSavedAt)),M.createElement("div",null,M.createElement("span",{className:"field-label"},"by"),M.createElement(Qa,{avatarSize:20,userId:e.lastSavedBy}))))}},{key:"renderNarrative",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"mainCol"},M.createElement("div",null,M.createElement("div",{className:"Narrative-title"},M.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",M.createElement("div",{className:"Narrative-owner"},M.createElement(Qa,{avatarSize:20,userId:e.owner}))),M.createElement("div",{className:"Narrative-attributes"},M.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),M.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),M.createElement("div",null,M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"save"})),M.createElement(fr,{time:e.lastSavedAt,tooltipPrefix:"last saved "}))))}},{key:"render",value:function(){var e=this.props.narrative;return e.access===rr.NONE?M.createElement("div",null,"You don't have access to this Narrative"):this.renderNarrative(e)}}]),t}(M.Component),Za=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.narrative?M.createElement(Ja,{narrative:this.props.narrative}):M.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(M.Component);var Ka=Object(W.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(hr(t))}}})(Za),Xa=(r(286),function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case Ne.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=M.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you may obtain personal View-Only access by clicking this button",r=M.createElement(At.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=M.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=M.createElement(At.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access"));break;case Ne.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=M.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=M.createElement(At.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case Ne.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=M.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=M.createElement(At.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case Ne.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=M.createElement("span",null,"Admin");break;case Ne.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=M.createElement("span",null,"Owner");break;default:t=M.createElement("span",null,"Unknown")}return M.createElement(M.Fragment,null,M.createElement(yt.a,{title:n,placement:"right"},M.createElement("span",{style:{cursor:"help"}},M.createElement("span",{className:"field-label"},"your permission"),t))," ",M.createElement(yt.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?M.createElement(yt.a,{title:"This narrative is viewable by all KBase users",placement:"right"},M.createElement("span",{style:{cursor:"help"}},M.createElement(Mt.a,{type:"global"})," Public Narrative")):M.createElement(yt.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},M.createElement("span",{style:{cursor:"help"}},M.createElement(Mt.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return this.props.organization.isMember?e.permission!==Ne.NONE||e.isPublic?M.createElement(Ka,{workspaceId:e.workspaceId}):M.createElement(M.Fragment,null,M.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},M.createElement("div",{className:"title"},e.title)),M.createElement("div",null,this.renderNarrativePermission(e))):M.createElement(Ka,{workspaceId:e.workspaceId})}},{key:"renderResource",value:function(){return M.createElement("div",null,M.createElement("div",null,M.createElement("span",{className:"field-label"},"added"),M.createElement("span",null,M.createElement(fr,{time:this.props.narrative.createdAt}))))}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=M.createElement(Wa.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),M.createElement("div",{className:"OrganizationNarrative"},M.createElement("div",{className:"OrganizationNarrative-narrativeCol"},this.renderNarrative()),e)}}]),t}(M.Component)),$a=(r(287),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onRequestAddNarrative",value:function(){this.props.onRequestAddNarrative()}},{key:"onRemoveNarrative",value:function(e){var t=this,r=M.createElement(M.Fragment,null,M.createElement("p",null,"Please confirm the removal of this Narrative from this Organization."),M.createElement("p",null,"Any view permission granted to organization members will be unaffected by removing the Narrative."),M.createElement("p",null,"All Organization members and the Narrative owner will receive a notification."));Dt.a.confirm({title:"Confirm",content:r,width:"50em",okText:"Confirm",onOk:function(){t.props.onRemoveNarrative(e)}})}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.onRemoveNarrative(t)}}},{key:"renderNarrativeMenu",value:function(e){var t,r=this;switch(this.props.relation.type){case Ae.NONE:break;case Ae.VIEW:case Ae.MEMBER_REQUEST_PENDING:case Ae.MEMBER_INVITATION_PENDING:case Ae.MEMBER:break;case Ae.ADMIN:case Ae.OWNER:t=M.createElement(Ct.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},M.createElement(Ct.a.Item,{key:"removeNarrative"},M.createElement(Mt.a,{type:"delete",style:{color:"#f5222d"}})," Remove Narrative from Organization"))}if(t)return M.createElement(kt.a,{overlay:t,trigger:["click"]},M.createElement(Mt.a,{type:"ellipsis",className:"IconButton-hover"}))}},{key:"renderSearchBar",value:function(){var e=this;return M.createElement("div",{style:{paddingRight:"6px"}},M.createElement(cn.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter narratives by title",onChange:function(t){e.props.onSearchNarratives(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return M.createElement(M.Fragment,null,M.createElement("span",{className:"field-label"},"sort"),M.createElement(Ir.a,{onChange:function(t){e.props.onSortNarratives(t)},style:{width:"11em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortNarrativesBy},M.createElement(Ir.a.Option,{value:"name",key:"name"},"Name"),M.createElement(Ir.a.Option,{value:"added",key:"added"},"Date Added"),M.createElement(Ir.a.Option,{value:"changed",key:"changed"},"Last Changed")))}},{key:"renderMemberNarrativeRow",value:function(e){var t=this.props.organization.lastVisitedAt,r=e.addedAt,n=["ViewOrganization-Narratives-narrative","SimpleCard"];return null!==t&&(null!==r&&t.getTime()<r.getTime())&&n.push("ViewOrganization-Narratives-newNarrative"),M.createElement("div",{className:n.join(" "),key:String(e.workspaceId)},M.createElement("div",{className:"ViewOrganization-Narratives-dataCol"},M.createElement(Xa,{narrative:e,organization:this.props.organization,onGetViewAccess:this.props.onGetViewAccess})),M.createElement("div",{className:"ViewOrganization-Narratives-buttonCol"},this.renderNarrativeMenu(e)))}},{key:"renderMemberNarratives",value:function(){var e,t=this,r=[M.createElement(At.a,{key:"addNarrative",size:"small",style:{width:"100%"},onClick:this.onRequestAddNarrative.bind(this)},M.createElement(Mt.a,{type:"plus"}),"  Associate Narratives")];return e=0===this.props.narratives.length?M.createElement(St.a,{type:"info",message:"No Narratives are yet associated with this Organization"}):this.props.narratives.map(function(e){return t.renderMemberNarrativeRow(e)}),M.createElement("div",{className:"ViewOrganization-Narratives scrollable-flex-column"},M.createElement("div",{className:"ViewOrganization-Narratives-header"},M.createElement("div",{className:"ViewOrganization-Narratives-headerCol1"},r)),M.createElement("div",{className:"ViewOrganization-Narratives-toolbar"},M.createElement("div",{className:"ViewOrganization-Narratives-toolbar-searchCol"},this.renderSearchBar()),M.createElement("div",{className:"ViewOrganization-Narratives-toolbar-sortCol"},this.renderSortBar())),M.createElement("div",{className:"ViewOrganization-Narratives-narrativesList"},M.createElement("div",{className:"ViewOrganization-Narratives-narrativesTable"},e)))}},{key:"renderNonMemberNarratives",value:function(){var e,t,r=this,n=this.props.organization.narratives.length,a=this.props.organization.narrativeCount-this.props.organization.narratives.length,i={marginBottom:"10px"};if(n){if(a){var s=M.createElement(M.Fragment,null,M.createElement("p",null,"Since you are not a member of this Organization, only public Narratives are displayed."),M.createElement("p",null,a," private Narrative",1!==a?"s have ":" has "," been hidden."));e=M.createElement(St.a,{type:"info",message:s,style:i})}}else if(a){var o=M.createElement(M.Fragment,null,M.createElement("p",null,"Since you are not a member of this Organization, only public Narratives would be displayed, but this Organization has none."),M.createElement("p",null,a," private Narrative",1!==a?"s have ":" has "," been hidden."));e=M.createElement(St.a,{type:"info",message:o,style:i})}else e=M.createElement(St.a,{type:"info",message:"No Narratives are yet associated with this Organization",style:i});n&&(t=this.props.narratives.map(function(e){return M.createElement("div",{className:"ViewOrganization-Narratives-narrative SimpleCard",key:String(e.workspaceId)},M.createElement("div",{className:"ViewOrganization-Narratives-dataCol"},M.createElement(Xa,{narrative:e,organization:r.props.organization,onGetViewAccess:r.props.onGetViewAccess})),M.createElement("div",{className:"ViewOrganization-Narratives-buttonCol"},r.renderNarrativeMenu(e)))}));var l=M.createElement("span",{className:"ViewOrganization-Narratives-title"},M.createElement(Mt.a,{type:"folder-open",style:{marginRight:"8px"}}),"Narratives"," ",M.createElement("span",{className:"ViewOrganization-Narratives-titleCount"},"(",this.props.organization.narrativeCount,")"));return M.createElement("div",{className:"ViewOrganization-Narratives scrollable-flex-column"},M.createElement("div",{className:"ViewOrganization-Narratives-header"},M.createElement("div",{className:"ViewOrganization-Narratives-headerCol1"},l),M.createElement("div",{className:"ViewOrganization-Narratives-headerCol2"})),M.createElement("div",{className:"ViewOrganization-Narratives-toolbar"},M.createElement("div",{className:"ViewOrganization-Narratives-toolbar-searchCol"},this.renderSearchBar()),M.createElement("div",{className:"ViewOrganization-Narratives-toolbar-sortCol"},this.renderSortBar())),M.createElement("div",{className:"ViewOrganization-Narratives-narrativesList"},M.createElement("div",{className:"ViewOrganization-Narratives-table"},e,t)))}},{key:"render",value:function(){return this.props.organization.isMember?this.renderMemberNarratives():this.renderNonMemberNarratives()}}]),t}(M.Component));function ei(e){return{type:J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_ERROR,error:e}}function ti(e){var t=function(e){var t=e.views.viewOrgView.viewModel;if(null===t)throw new Error("invalid state -- no view value");if(t.kind!==N.NORMAL)throw new Error("invalid state -- no view value");var r=t.subViews.manageMembershipView;if(null===r)throw new Error("invalid state -- no view value");return r}(e);if(null===t.viewModel)throw new Error("invalid state -- no view model");return t.viewModel}function ri(){return function(e,t){ti(t()).editableMemberProfile.title.validationState.type===o.OK?e({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_SUCCESS}):e({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_EVALUATE_ERROR})}}function ni(e){return function(t,r){t({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,l=n.views.viewOrgView.viewModel;if(null===l)throw new Error("view is not populated");new He({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url}).adminToMember(l.organization.id,s).then(function(r){t(function(e){return{type:J.VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_SUCCESS,organizationId:e}}(e)),t(Tn(l.organization.id))}).catch(function(e){var r;t((r=pr({code:e.name,message:e.message}),{type:J.VIEW_ORG_MANAGE_MEMBERSHIP_DEMOTE_SELF_TO_MEMBER_ERROR,error:r}))})}}r(288);var ai=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"doLeaveOrg",value:function(){var e=this,t=function(){e.doLeaveOrgConfirmed()}.bind(this);Dt.a.confirm({title:"Really leave this organization?",content:M.createElement("p",null,"This is not reversible."),width:"50em",onOk:function(){t()}})}},{key:"onDone",value:function(){this.props.onFinish()}},{key:"doLeaveOrgConfirmed",value:function(){this.props.onLeaveOrganization(this.props.organization.id),this.props.onFinish()}},{key:"onDemoteSelfToMember",value:function(){var e=this,t=function(){e.onDemoteSelfToMemberConfirmed()}.bind(this);Dt.a.confirm({title:"Confirm Demotion to Regular Member",content:M.createElement("p",null,"Upon removing administrator privileges for yourself, you will not be able to restore them without the assistance of the Organization's owner or an administrator"),width:"50em",onOk:function(){t()}})}},{key:"onDemoteSelfToMemberConfirmed",value:function(){this.props.onDemoteSelfToMember(this.props.organization.id)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===l.NEW||this.props.saveState===l.READY||this.props.saveState===l.SAVED)}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onTitleChange",value:function(e){e.persist(),this.props.onUpdateTitle(e.target.value)}},{key:"renderOrgName",value:function(e){return e.length<25?e:M.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"ManageMembership-validation-error"}switch(e.syncState){case i.DIRTY:return"ManageMembership-sync-dirty";default:return"ManageMembership-validation-ok"}}},{key:"renderLeaveOrgButton",value:function(){var e;switch(this.props.organization.relation){case Ae.MEMBER:e=M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"delete",type:"danger",onClick:this.doLeaveOrg.bind(this)},"Leave Organization"));break;case Ae.ADMIN:var t=M.createElement(M.Fragment,null,M.createElement("p",null,"As an organization administrator, you may not leave the organization."),M.createElement("p",null,"In order to leave the organization, you will need to become a regular member first."));e=M.createElement("div",{className:"ButtonSet-button"},M.createElement(yt.a,{title:t},M.createElement(At.a,{icon:"stop",type:"default",disabled:!0},"Only a regular member may leave Organization")));break;case Ae.OWNER:var r=M.createElement(M.Fragment,null,M.createElement("p",null,"As an organization owner, you are the only permanent member of this organization."));e=M.createElement("div",{className:"ButtonSet-button"},M.createElement(yt.a,{title:r},M.createElement(At.a,{icon:"stop",type:"default",disabled:!0},"Cannot leave Organization")))}return e}},{key:"renderDemoteToMemberButton",value:function(){switch(this.props.organization.relation){case Ae.ADMIN:return M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"user",type:"default",onClick:this.onDemoteSelfToMember.bind(this)},"Demote Self to Member"))}}},{key:"renderTitleRow",value:function(){var e=M.createElement("p",null,"This is your title within this Organization.");return M.createElement("div",{className:"ManageMembership-editorTable-row"},M.createElement("div",{className:"ManageMembership-editCol ManageMembership-editCell"},M.createElement("div",{className:"ManageMembership-editorTable-labelCol"},M.createElement("span",{className:"field-label ManageMembership-titleLabel"},M.createElement(yt.a,{title:e},"title"))),M.createElement("div",{className:"ManageMembership-editorTable-controlCol"},M.createElement(cn.a,{value:this.props.editableMemberProfile.title.value||"",className:this.calcFieldClass(this.props.editableMemberProfile.title),onChange:this.onTitleChange.bind(this)}))))}},{key:"renderCancelButton",value:function(){return M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"delete",type:"danger",onClick:this.onDone.bind(this)},"Cancel"))}},{key:"renderSaveButton",value:function(){return M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"save",form:"editMembership",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"))}},{key:"renderEditor",value:function(){return M.createElement("form",{id:"editMembership",className:"ManageMembership-editorTable scrollable-flex-column",onSubmit:this.onSubmit.bind(this)},M.createElement("div",{className:"ManageMembership-headerRow"},M.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Edit Your Organization Profile")),M.createElement("div",{className:"ManageMembership-formRow"},this.renderTitleRow(),M.createElement("div",{className:"ManageMembership-editorFooter"},M.createElement("div",{className:"ButtonSet"},this.renderSaveButton(),this.renderCancelButton(),this.renderLeaveOrgButton(),this.renderDemoteToMemberButton()))))}},{key:"renderMenuButtons",value:function(){return M.createElement("div",{className:"ButtonSet"},M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"rollback",type:"danger",onClick:this.onDone.bind(this)},"Done")))}},{key:"render",value:function(){return M.createElement("div",{className:"ManageMembership scrollable-flex-column"},M.createElement("div",{className:"ManageMembership-body scrollable-flex-column"},M.createElement("div",{className:"ManageMembership-main scrollable-flex-column"},this.renderEditor())))}}]),t}(M.Component);var ii=Object(W.b)(function(e,t){var r=e.auth.authorization.username,n=e.views.viewOrgView.viewModel;if(!n)throw new Error("argh, view model missing");if(n.kind!==N.NORMAL)throw new Error("argh, wrong org kind");if(null===n.subViews.manageMembershipView.viewModel)throw new Error("argh, null subview view model");var a=n.subViews.manageMembershipView.viewModel;return{username:r,organization:n.organization,editableMemberProfile:a.editableMemberProfile,editState:a.editState,saveState:a.saveState,validationState:a.validationState}},function(e){return{onLeaveOrganization:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,c=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url});try{c.removeMember(e,o),r({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS}),r(Tn(e))}catch(u){console.error("ERROR leaving org",u),r({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,error:{code:u.name,message:u.message}})}case 4:case"end":return t.stop()}},t)}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUpdateTitle:function(t){e(function(e){return function(t){var r=ye.validateMemberTitle(e),n=Object(ce.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,error:pr({code:"invalid",message:i.message})}):t({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,title:a}),t(ri())}}(t))},onSave:function(){e(function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i,s,o,l,c,u,E,d;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_START}),n=ti(r()),a=n.organization,i=n.editableMemberProfile,s=r(),o=s.auth.authorization,l=o.token,c=o.username,u=s.app.config,E={title:i.title.value},d=new He({token:l,username:c,groupsServiceURL:u.services.Groups.url,userProfileServiceURL:u.services.UserProfile.url}),e.prev=6,e.next=9,d.updateMember(a.id,c,E);case 9:t({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_SUCCESS}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),console.error("error saving member profile",e.t0),t({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_SAVE_ERROR,error:pr({code:"error",message:e.t0.message})});case 16:t(ri());case 17:case"end":return e.stop()}},e,null,[[6,12]])}));return function(t,r){return e.apply(this,arguments)}}())},onDemoteSelfToMember:function(t){e(ni(t))}}})(ai),si=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement(M.Fragment,null,M.createElement(Mt.a,{type:"loading"})," ","Loading Your Membership...");return M.createElement(St.a,{type:"info",message:e,style:{padding:"20px",width:"30em",margin:"30px auto 0 auto",textAlign:"center"}})}},{key:"renderError",value:function(e){return M.createElement("div",null,"Error!",M.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case T.NONE:case T.LOADING:return this.renderLoading();case T.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(Je({code:"Missing Error",message:"The error appears to be missing"}));default:return M.createElement(ii,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case T.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var oi,li=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==N.NORMAL)throw new Error("not the right vm");return{view:r.subViews.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,s,l,c,u,E,d,m,v;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_START}),a=n(),s=a.auth.authorization,l=s.token,c=s.username,u=a.app.config,E=new He({token:l,username:c,groupsServiceURL:u.services.Groups.url,userProfileServiceURL:u.services.UserProfile.url}),t.prev=3,t.next=6,E.getOrg(e);case 6:if((d=t.sent).kind===be.NORMAL){t.next=10;break}return r(ei(pr({code:"invalid state",message:'Organization must be of kind "NORMAL"'}))),t.abrupt("return");case 10:if(d.isMember){t.next=13;break}return r(ei(pr({code:"notfound",message:'The user "'+c+'" is not a member of this org'}))),t.abrupt("return");case 13:if((m=d.members.find(function(e){return e.username===c}))||d.owner.username===c&&(m=d.owner),m){t.next=18;break}return r(ei(pr({code:"notfound",message:'The user "'+c+'" was not found in the members list'}))),t.abrupt("return");case 18:v={title:{value:m.title||"",remoteValue:m.title,syncState:i.NEW,validationState:{type:o.OK,validatedAt:new Date}}},r((p=d,O=v,{type:J.VIEW_ORG_MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:p,editableMemberProfile:O})),t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),console.error("Error :(",t.t0),r(ei(pr({code:t.t0.name,message:t.t0.message})));case 26:case"end":return t.stop()}var p,O},t,null,[[3,22]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:J.VIEW_ORG_MANAGE_MEMBERSHIP_UNLOAD})}}})(si);function ci(){return{type:J.EDIT_ORG_EVALUATE_ERRORS}}function ui(e){return{type:J.EDIT_ORG_SAVE_ERROR,error:e}}function Ei(e){return{type:J.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:e}}function di(e,t){return{type:J.EDIT_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}function mi(e){return function(t,r){t({type:J.EDIT_ORG_LOAD_START});var n=r(),a=n.auth.authorization,s=a.token,l=a.username,c=n.app.config;return new He({token:s,username:l,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url}).getOrg(e).then(function(e){if(e.kind!==be.NORMAL)throw new Error("May not edit an inaccessible private org!");var r,n,a={id:{value:e.id,remoteValue:e.id,syncState:i.NEW,validationState:ye.validateOrgId(e.id)[1]},name:{value:e.name,remoteValue:e.name,syncState:i.NEW,validationState:ye.validateOrgName(e.name)[1]},logoUrl:{value:e.logoUrl,remoteValue:e.logoUrl,syncState:i.NEW,validationState:ye.validateOrgLogoUrl(e.logoUrl)[1]},homeUrl:{value:e.homeUrl,remoteValue:e.homeUrl,syncState:i.NEW,validationState:ye.validateOrgHomeUrl(e.homeUrl)[1]},researchInterests:{value:e.researchInterests,remoteValue:e.researchInterests,syncState:i.NEW,validationState:ye.validateOrgResearchInterests(e.researchInterests)[1]},description:{value:e.description,remoteValue:e.description,syncState:i.NEW,validationState:ye.validateOrgDescription(e.description)[1]},isPrivate:{value:e.isPrivate,remoteValue:e.isPrivate,syncState:i.NEW,validationState:{type:o.OK,validatedAt:new Date}}};t((r=a,n=e,{type:J.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:J.EDIT_ORG_LOAD_ERROR,error:r}))})}}function vi(){return function(e,t){e({type:J.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.editOrgView.viewModel,o=s.organization,l=s.editedOrganization,c=r.app.config,u=new He({token:a,username:i,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url});if(l){var E={name:l.name.value,logoUrl:l.logoUrl.value,description:l.description.value,isPrivate:l.isPrivate.value,homeUrl:l.homeUrl.value,researchInterests:l.researchInterests.value};u.updateOrg(o.id,E).then(function(){e({type:J.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",l,t),e(ui({code:"invalid",message:t.message}))})}else e(ui({code:"app",message:"The new organization data does not yet exist"}))}}function pi(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState.type===o.OK&&n.logoUrl.validationState.type===o.OK&&n.homeUrl.validationState.type===o.OK&&n.researchInterests.validationState.type===o.OK&&n.description.validationState.type===o.OK?e({type:J.EDIT_ORG_EVALUATE_OK}):e(ci())}}function Oi(e){return function(t){var r=ye.validateOrgName(e),n=Object(ce.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:J.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:J.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(pi())}}var hi,Ri=function(e){function t(e){var r,n=e.delay,a=e.dispatch,i=e.url,s=e.timeout,o=e.serviceWizardURL,l=e.token;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,{delay:n}))).dispatch=void 0,r.url=void 0,r.timeout=void 0,r.serviceWizardURL=void 0,r.token=void 0,r.dispatch=a,r.url=i,r.serviceWizardURL=o,r.token=l,r.timeout=s,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"task",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new Br({url:this.serviceWizardURL,token:this.token}),e.next=4,t.checkImageURL({url:this.url,timeout:this.timeout});case 4:if(r=e.sent,!this.canceled){e.next=7;break}return e.abrupt("return");case 7:if(!r.is_valid){e.next=11;break}this.dispatch(Ei(this.url)),e.next=22;break;case 11:e.t0=r.error.code,e.next="not-found"===e.t0?14:"invalid-content-type"===e.t0?16:"missing-content-type"===e.t0?18:20;break;case 14:return this.dispatch(di(this.url,{type:o.ERROR,validatedAt:new Date,message:"This logo url does not exist"})),e.abrupt("break",22);case 16:return this.dispatch(di(this.url,{type:o.ERROR,validatedAt:new Date,message:"Invalid content type: "+r.error.info["content-type"]})),e.abrupt("break",22);case 18:return this.dispatch(di(this.url,{type:o.ERROR,validatedAt:new Date,message:"Missing content type"})),e.abrupt("break",22);case 20:return this.dispatch(di(this.url,{type:o.ERROR,validatedAt:new Date,message:"unknown error"})),e.abrupt("break",22);case 22:e.next=29;break;case 24:if(e.prev=24,e.t1=e.catch(0),!this.canceled){e.next=28;break}return e.abrupt("return");case 28:this.dispatch(di(this.url,{type:o.ERROR,validatedAt:new Date,message:"Error checking logo url: "+e.t1.message}));case 29:this.dispatch(pi());case 30:case"end":return e.stop()}},e,this,[[0,24]])}));return function(){return e.apply(this,arguments)}}()}]),t}(xr);var wi=function(e){function t(e){var r,n=e.delay,a=e.dispatch,i=e.url,s=e.timeout,o=e.serviceWizardURL,l=e.token;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,{delay:n}))).dispatch=void 0,r.url=void 0,r.timeout=void 0,r.serviceWizardURL=void 0,r.token=void 0,r.dispatch=a,r.url=i,r.serviceWizardURL=o,r.token=l,r.timeout=s,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"task",value:function(){var e=Object(le.a)(oe.a.mark(function e(){var t,r;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new Br({url:this.serviceWizardURL,token:this.token}),e.next=4,t.checkHTMLURL({url:this.url,timeout:this.timeout});case 4:if(r=e.sent,!this.canceled){e.next=7;break}return e.abrupt("return");case 7:if(!r.is_valid){e.next=11;break}this.dispatch((n=this.url,{type:J.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:n})),e.next=22;break;case 11:e.t0=r.error.code,e.next="not-found"===e.t0?14:"invalid-content-type"===e.t0?16:"missing-content-type"===e.t0?18:20;break;case 14:return this.dispatch(_i(this.url,{type:o.ERROR,validatedAt:new Date,message:"This home url does not exist"})),e.abrupt("break",22);case 16:return this.dispatch(_i(this.url,{type:o.ERROR,validatedAt:new Date,message:"Invalid content type: "+r.error.info["content-type"]})),e.abrupt("break",22);case 18:return this.dispatch(_i(this.url,{type:o.ERROR,validatedAt:new Date,message:"Missing content type"})),e.abrupt("break",22);case 20:return this.dispatch(_i(this.url,{type:o.ERROR,validatedAt:new Date,message:"unknown error"})),e.abrupt("break",22);case 22:e.next=29;break;case 24:if(e.prev=24,e.t1=e.catch(0),!this.canceled){e.next=28;break}return e.abrupt("return");case 28:this.dispatch(_i(this.url,{type:o.ERROR,validatedAt:new Date,message:"Error checking home url: "+e.t1.message}));case 29:this.dispatch(pi());case 30:case"end":return e.stop()}var n},e,this,[[0,24]])}));return function(){return e.apply(this,arguments)}}()}]),t}(xr);function _i(e,t){return{type:J.EDIT_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:t}}function gi(e){return function(t,r){var n=r(),a=n.auth.authorization,i=(a.token,a.username,n.app.config,ye.validateOrgDescription(e)),s=Object(ce.a)(i,2),l=s[0],c=s[1];c.type!==o.OK?t(function(e,t){return{type:J.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(l,c)):t(function(e){return{type:J.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(l)),t(pi())}}var fi;r(289);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(fi||(fi={}));var Ai=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:fi.NONE},r.origin=document.location.origin,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onFinish",value:function(){this.props.onFinish()}},{key:"onShowInfo",value:function(){Dt.a.info({title:"Organization Editor Help",width:"50em",content:M.createElement("div",null,M.createElement("p",null,"This is the organizations editor..."))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Dt.a.confirm({title:"Leave the editor?",content:M.createElement("div",null,M.createElement("p",null,"You have made changes on this edit form."),M.createElement("p",null,"If you leave the editor without saving, any ",M.createElement("i",null,"changes they will be lost"),"."),M.createElement("p",null,M.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){Dt.a.confirm({title:"Leave the editor?",content:M.createElement("div",null,M.createElement("p",null,"You have made changes on this edit form."),M.createElement("p",null,"If you leave the editor without saving, any ",M.createElement("i",null,"changes they will be lost"),"."),M.createElement("p",null,M.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===l.NEW||this.props.saveState===l.READY||this.props.saveState===l.SAVED)}},{key:"isModified",value:function(){return this.props.editState===s.EDITED&&(this.props.saveState===l.NEW||this.props.saveState===l.READY)}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"validation-error Lite"}switch(e.syncState){case i.DIRTY:return"sync-dirty Lite";default:return"validation-ok Lite"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===o.OK?"":e.syncState===i.DIRTY?M.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderNameRowx",value:function(){var e=M.createElement(M.Fragment,null,M.createElement("p",null,"This is the name for your organization as you want KBase users to see it; you may change it at any time."),M.createElement("p",null,"It may be composed of ordinary text, but does not accept formatting."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1024 characters")))));return M.createElement("div",{className:"EditOrganization-row"},M.createElement("div",{className:"EditOrganization-col1"},M.createElement("div",{className:"EditOrganization-formLabel field-label"},M.createElement(yt.a,{title:e},"Name"))),M.createElement("div",{className:"EditOrganization-col2"},M.createElement("div",{className:"EditOrganization-formControl"},M.createElement(cn.a,{value:this.props.editedOrganization.name.value||"",className:this.calcFieldClass(this.props.editedOrganization.name),placeholder:"Your Organization's display name",autoFocus:!0,onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.name))),M.createElement("div",{className:"EditOrganization-col3"},M.createElement("div",{className:"EditOrganization-preview-name"},this.props.editedOrganization.name.value||"")))}},{key:"renderNameRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"This is the name for your organization as you want KBase users to see it; you may change it at any time."),M.createElement("p",null,"It may be composed of ordinary text, but does not accept formatting."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1024 characters")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Name"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"Your Organization's display name",autoFocus:!0,onChange:t}),this.renderFieldError(e))))}},{key:"renderIDRowx",value:function(){var e=M.createElement(M.Fragment,null,M.createElement("p",null,"Each Organization has a unique identifier. The ID is set when the organization is created, and are permanent: It may never be changed."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"100 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"a to z, 0 to 9, -")))));return M.createElement("div",{className:"EditOrganization-row"},M.createElement("div",{className:"EditOrganization-col1"},M.createElement("div",{className:"EditOrganization-formLabel field-label"},M.createElement(yt.a,{title:e},"ID"))),M.createElement("div",{className:"EditOrganization-col2"},M.createElement("div",{className:"EditOrganization-formControl"},M.createElement(cn.a,{value:this.props.editedOrganization.id.value||"",className:this.calcFieldClass(this.props.editedOrganization.id),placeholder:"A unique ID for your Organization",onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.id))),M.createElement("div",{className:"EditOrganization-col3"},M.createElement("div",{className:"EditOrganization-preview-id"},M.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.editedOrganization.id.value||M.createElement("span",{style:{fontStyle:"italic"}},"organization id here"))))}},{key:"renderIDRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each Organization has a unique identifier. The ID is set when the organization is created, and are permanent: It may never be changed."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"100 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"a to z, 0 to 9, -")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"ID"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"A unique ID for your Organization",onChange:t}),this.renderFieldError(e))))}},{key:"renderLogoURLRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each Organization will display a logo. You may specific your own logo by entering the URL for an image, or leave this field blank and a default logo will be displayed, using the first letter of your org name and a randomly generated color (based on your org id)."),M.createElement("p",null,"Please don't use large images, and try to keep them roughly square. The logo image display will be constrained to no larger than 100 pixels wide. Non-square logos may not look good in the Orgs list or on your Org page."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"no")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1000 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"a full https:// url. E.g. https://my.org/myimage.png",M.createElement("br",null),"note that only ",M.createElement("i",null,"https")," urls are accepted.")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Logo URL"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formField"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"The URL for your Organization's logo (optional)",onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(e)),M.createElement("div",{className:"NewOrganization-formFieldPreview"},this.renderLogoPreview(e)))))}},{key:"renderBrokenHomeURL",value:function(){return M.createElement(yt.a,{title:"The Home URL is broken; either correct it or leave it empty"},M.createElement(Mt.a,{type:"exclamation-circle",style:{color:"gray"}}))}},{key:"renderHomeURLPreview",value:function(e){if(null===e.value){return M.createElement("div",{className:"NewOrganization-previewBox"},M.createElement(yt.a,{title:"When you have completed your url, you may preview it here."},M.createElement(Mt.a,{type:"link",style:{color:"gray"}})))}if(e.validationState.type!==o.OK)return M.createElement("div",{className:"NewOrganization-previewBox"},this.renderBrokenHomeURL());return M.createElement("div",{className:"NewOrganization-previewBox"},M.createElement(yt.a,{title:"Try out your url by clicking this link"},M.createElement("a",{href:e.value,target:"_blank"},M.createElement(Mt.a,{type:"link"}))))}},{key:"renderHomeURLRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each Organization may display a home page url. This should be considered the canonical home for your Organization, if it also exists outside of KBase."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"no")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1000 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"a full url. E.g. http://my.org/myimage.png",M.createElement("br",null),"note that both ",M.createElement("i",null,"http>")," and ",M.createElement("i",null,"https")," urls are accepted.")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Home Page URL"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formField"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(cn.a,{value:e.value||"",className:this.calcFieldClass(e),placeholder:"The url for your Organization's home page (optional)",onChange:t}),this.renderFieldError(e)),M.createElement("div",{className:"NewOrganization-formFieldPreview"},this.renderHomeURLPreview(e)))))}},{key:"renderCollapse",value:function(e){return M.createElement(un.a,{bordered:!1},M.createElement(un.a.Panel,{header:"What about inviting users?",key:"invite",style:{background:"transparent",borderRadius:0,margin:0,border:0,overflow:"hidden"}},e))}},{key:"renderPrivatePublicRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,'Set the Organization to "hidden" to prevent it from appearing in the listing and from being exposed as an Org page for any non-member.'),M.createElement("p",null,"You may invite users directly to your org. When doing so they will receive a notification with a link to the org page. When a user lands on the org page they will not be shown information about the org, but will be available to accept the invitation and instantly have access to it."),M.createElement("p",null,"A user with an invitation who lands on the org page will not see information about the org, but will be able to submit a Join request."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"no")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Hidden?"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement("div",null,M.createElement(yr.a,{checked:e.value,className:this.calcFieldClass(e),onChange:t}),this.renderIsPrivate(e.value)),this.renderFieldError(e))))}},{key:"renderResearchInterestsRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each organization must have a short description of research interests or purpose."),M.createElement("p",null,"This text is displayed in the organizations list and the organization's page. It is most helpful in the list context to help users quickly scan the list."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"200 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"unformatted text")))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Research Interests"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(mn.a,{value:e.value||"",className:this.calcFieldClass(e)+" NewOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},placeholder:"List your areas of interest. Systems biology, microbial ecology, plant genomics",onChange:t}),this.renderFieldError(e))))}},{key:"renderDescriptionRow",value:function(e,t){var r=M.createElement(M.Fragment,null,M.createElement("p",null,"Each organization must have a description which communicates the purpose of this organization."),M.createElement("p",null,"The description is in ",M.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown")," format and may be quite long. It will be presented in a scrolling area."),M.createElement("p",null,"Please be mindful of embedding large images or other content which may interfere with the display of your Organization."),M.createElement("table",null,M.createElement("tbody",null,M.createElement("tr",null,M.createElement("th",null,"required"),M.createElement("td",null,"yes")),M.createElement("tr",null,M.createElement("th",null,"max length"),M.createElement("td",null,"1024 characters")),M.createElement("tr",null,M.createElement("th",null,"allowed"),M.createElement("td",null,"standard ",M.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown"))))));return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"},M.createElement("div",{className:"NewOrganization-formLabel field-label"},M.createElement(yt.a,{title:r},"Description"))),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{className:"NewOrganization-formControl"},M.createElement(En.a,{defaultActiveKey:"editor",animated:!1},M.createElement(En.a.TabPane,{tab:"Editor",key:"editor"},M.createElement(mn.a,{value:e.value||"",className:this.calcFieldClass(e)+" NewOrganization-control-description",autosize:{minRows:5,maxRows:15},placeholder:"Text or Markdown describing your Organization",onChange:t}),this.renderFieldError(e)),M.createElement(En.a.TabPane,{tab:"Preview",key:"preview"},M.createElement("div",{className:"NewOrganization-preview-description",dangerouslySetInnerHTML:{__html:ln.Marked.parse(e.value||"")}}))))))}},{key:"renderSaveButton",value:function(){return M.createElement(At.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")}},{key:"renderCancelButton",value:function(){return M.createElement(At.a,{icon:"close",type:"danger",onClick:this.onFinish.bind(this)},"Cancel")}},{key:"renderEditorHeader",value:function(){return M.createElement("div",{className:"NewOrganization-row"},M.createElement("div",{className:"NewOrganization-col1"}),M.createElement("div",{className:"NewOrganization-col2"},M.createElement("div",{style:{flex:"1 1 0px"}},M.createElement("h3",null,"Edit Your Organization"))))}},{key:"renderEditor",value:function(){return M.createElement("form",{id:"editOrganizationForm",className:"EditOrganization-editor scrollable-flex-column",onSubmit:this.onSubmit.bind(this)},this.renderEditorHeader(),M.createElement("div",{className:"EditOrganization-body"},this.renderNameRow(this.props.editedOrganization.name,this.onNameChange.bind(this)),this.renderIDRow(this.props.editedOrganization.id,this.onIdChange.bind(this)),this.renderLogoURLRow(this.props.editedOrganization.logoUrl,this.onLogoUrlChange.bind(this)),this.renderHomeURLRow(this.props.editedOrganization.homeUrl,this.onHomeUrlChange.bind(this)),this.renderPrivatePublicRow(this.props.editedOrganization.isPrivate,this.onIsPrivateChange.bind(this)),this.renderResearchInterestsRow(this.props.editedOrganization.researchInterests,this.onResearchInterestsChange.bind(this)),this.renderDescriptionRow(this.props.editedOrganization.description,this.onDescriptionChange.bind(this)),M.createElement("div",{className:"EditOrganization-row"},M.createElement("div",{className:"EditOrganization-col1"}),M.createElement("div",{className:"EditOrganization-col2",style:{textAlign:"center"}},M.createElement("div",{className:"ButtonSet"},M.createElement("span",{className:"ButtonSet-button"},this.renderSaveButton()),M.createElement("span",{className:"ButtonSet-button"},this.renderCancelButton()))))))}},{key:"renderIsPrivate",value:function(e){return e?M.createElement("span",null,M.createElement(Mt.a,{type:"lock"})," ","Hidden - will be visible ",M.createElement("b",null,"only")," for members of this organization"):M.createElement("span",null,M.createElement(Mt.a,{type:"global"})," ","Visible - will be visible to all KBase users.")}},{key:"renderDefaultLogo",value:function(){if(!this.props.editedOrganization.name.value||!this.props.editedOrganization.id.value){return M.createElement(yt.a,{title:"Add a logo url or complete the name and id fields for a Default logo"},M.createElement(Mt.a,{type:"question",style:{color:"gray"}}))}var e=this.charAt(this.props.editedOrganization.name.value,0).toUpperCase(),t=It()(this.props.editedOrganization.id.value).substr(0,6);return M.createElement("svg",{width:30,height:30,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},M.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:18,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderBrokenLogo",value:function(){return M.createElement(yt.a,{title:"The Logo URL is broken; either correct it or empty the field for the default logo"},M.createElement(Mt.a,{type:"exclamation-circle",style:{color:"gray"}}))}},{key:"renderLogoPreview",value:function(e){return null===e.value?M.createElement("div",{className:"NewOrganization-previewBox"},this.renderDefaultLogo()):e.validationState.type!==o.OK?M.createElement("div",{className:"NewOrganization-previewBox"},this.renderBrokenLogo()):M.createElement("div",{className:"NewOrganization-previewBox"},M.createElement("img",{src:e.value,width:30}))}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return M.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderMenuButtons",value:function(){return M.createElement("span",{className:"ButtonSet"},M.createElement("span",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"rollback",type:"danger",onClick:this.onFinish.bind(this)},"Close")),M.createElement("span",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")))}},{key:"render",value:function(){return this.state.cancelToViewer?M.createElement(on.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):M.createElement("div",{className:"EditOrganization scrollable-flex-column"},M.createElement("div",{className:"EditOrganization-main scrollable-flex-column"},this.renderEditor()))}}]),t}(M.Component);var Si=Object(W.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(vi())},onUpdateName:function(t){e(Oi(t))},onUpdateLogoUrl:function(t){e(function(e){return function(t,r){oi&&oi.cancel();var n=ye.validateOrgLogoUrl(e),a=Object(ce.a)(n,2),i=a[0],s=a[1];if(s.type!==o.OK)return t(di(i,s)),void t(pi());if(t(Ei(i)),t(pi()),null!==i&&i.length>0){var l=r(),c=l.auth.authorization.token,u=l.app.config.services.ServiceWizard.url;(oi=new Ri({delay:100,url:i,timeout:1e3,dispatch:t,serviceWizardURL:u,token:c})).start()}}}(t))},onUpdateDescription:function(t){e(gi(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:J.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(pi())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t,r){hi&&hi.cancel();var n=ye.validateOrgHomeUrl(e),a=Object(ce.a)(n,2),i=a[0],s=a[1];if(s.type!==o.OK)return t({type:J.EDIT_ORG_UPDATE_HOME_URL_ERROR,homeUrl:i,error:s}),void t(pi());if(t({type:J.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:i}),t(pi()),null!==i&&i.length>0){var l=r(),c=l.auth.authorization.token,u=l.app.config.services.ServiceWizard.url;(hi=new wi({delay:100,url:i,timeout:1e3,dispatch:t,serviceWizardURL:u,token:c})).start()}}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=ye.validateOrgResearchInterests(e),n=Object(ce.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:J.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:J.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a}),t(pi())}}(t))}}})(Ai),Ni=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement("div",null,"Loading Editor..."," ",M.createElement(jr.a,null));return M.createElement(St.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return M.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return M.createElement(Si,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var bi=Object(W.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(mi(t))},onUnload:function(){e({type:J.EDIT_ORG_UNLOAD})}}})(Ni),Ii=(r(290),r(291),function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).ref=void 0,r.ref=M.createRef(),r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"isVisible",value:function(){if(!this.ref.current)return!1;var e=this.props.containerDimensions;if(!e)return!1;var t=this.props.buffer*this.props.approximateRowHeight,r=Math.max(e.scrollTop-t,0),n=e.scrollTop+e.clientHeight+t,a=this.ref.current.offsetHeight,i=this.ref.current.offsetTop;return i>=r&&i<=n||i+a>=r&&i+a<=n}},{key:"render",value:function(){return this.isVisible()?M.createElement("div",{className:"RowWrapper-rendered",ref:this.ref},this.props.children):M.createElement("div",{className:"RowWrapper-unrendered",style:{height:this.props.approximateRowHeight},ref:this.ref},this.props.emptyRowRenderer())}}]),t}(M.Component)),Ti=(r(292),function e(){Object(V.a)(this,e),this.currentItem=void 0,this.currentItem=0}),yi=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).wrapperContainerRef=void 0,r.listeners=void 0,r.limitingTimer=void 0,r.limitingTimeout=void 0,r.checkDimensions=function(){var e=r.calcContainerBounds();if(e){var t=r.state.containerDimensions;t&&e.offsetHeight===t.offsetHeight&&e.scrollTop===t.scrollTop&&e.clientHeight===t.clientHeight||r.setState({containerDimensions:e})}},r.state={containerDimensions:null},r.wrapperContainerRef=M.createRef(),r.listeners=[],r.limitingTimer=null,r.limitingTimeout=100,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"calcContainerBounds",value:function(){return null===this.wrapperContainerRef.current?null:{offsetHeight:this.wrapperContainerRef.current.offsetHeight,scrollTop:this.wrapperContainerRef.current.scrollTop,clientHeight:this.wrapperContainerRef.current.clientHeight}}},{key:"limiter",value:function(e){this.limitingTimer&&window.clearTimeout(this.limitingTimer),this.limitingTimer=window.setTimeout(function(){e()},this.limitingTimeout)}},{key:"componentDidMount",value:function(){var e=this;if(null===this.wrapperContainerRef.current)return!1;var t=function(){e.limiter(function(){e.checkDimensions()})};this.wrapperContainerRef.current.addEventListener("scroll",t),this.listeners.push({target:this.wrapperContainerRef.current,type:"scroll",listener:t});var r=function(){e.limiter(function(){e.checkDimensions()})};window.addEventListener("resize",r),this.listeners.push({target:window,type:"resize",listener:r}),this.checkDimensions()}},{key:"componentWillUnmount",value:function(){this.listeners.forEach(function(e){e.target.removeEventListener(e.type,e.listener)})}},{key:"render",value:function(){for(var e=this,t=[],r=0;r<this.props.renderable.size();r+=1)t.push(M.createElement(Ii,{index:r,key:String(r),containerDimensions:this.state.containerDimensions,buffer:5,approximateRowHeight:73,emptyRowRenderer:function(){return e.props.renderable.renderEmpty()}},this.props.renderable.render(r)));return M.createElement("div",{className:"FlexibleColumnWrapper",ref:this.wrapperContainerRef},t)}}]),t}(M.Component),Mi=function(e){function t(e,r){var n;return Object(V.a)(this,t),(n=Object(z.a)(this,Object(j.a)(t).call(this))).rowRenderer=void 0,n.rowCount=void 0,n.rowRenderer=e,n.rowCount=r,n}return Object(G.a)(t,e),Object(U.a)(t,[{key:"size",value:function(){return this.rowCount}},{key:"render",value:function(e){return this.rowRenderer(e)}},{key:"renderEmpty",value:function(){return M.createElement("div",{className:"RequestNarrative-narrative-skeleton"},M.createElement("div",{className:"RequestNarrative-narrative-skeleton-row",style:{width:"20em"}},"\xa0"),M.createElement("div",{className:"RequestNarrative-narrative-skeleton-row",style:{width:"5em"}},"\xa0"),M.createElement("div",{className:"RequestNarrative-narrative-skeleton-row",style:{width:"10em"}},"\xa0"))}}]),t}(Ti),Di=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={containerDimensions:null},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onFinish",value:function(){this.props.onFinish()}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative.narrative.workspaceId):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgName",value:function(e){return e.length<25?e:M.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderPermission",value:function(e){switch(e.access){case rr.VIEW:return M.createElement("span",null,M.createElement(Mt.a,{type:"eye"})," View");case rr.EDIT:return M.createElement("span",null,M.createElement(Mt.a,{type:"edit"})," Edit");case rr.ADMIN:return M.createElement("span",null,M.createElement(Mt.a,{type:"unlock"})," Admin");case rr.OWNER:return M.createElement("span",null,M.createElement(Mt.a,{type:"crown"})," Owner");default:return M.createElement("span",null,"ERROR")}}},{key:"renderPublicPermission",value:function(e){return e.isPublic?M.createElement("span",null,M.createElement(Mt.a,{type:"global"})," Public"):M.createElement("span",null,M.createElement(Mt.a,{type:"lock"})," Private")}},{key:"renderNarrative",value:function(e){return M.createElement(M.Fragment,null,M.createElement("div",{className:"RequestNarrative-title"},e.title),M.createElement("div",{className:"RequestNarrative-publicPermission"},this.renderPublicPermission(e)),M.createElement("div",{className:"RequestNarrative-modifiedAt"},M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"save"}))," ",M.createElement(fr,{time:e.lastSavedAt,tooltipPrefix:"last saved "})))}},{key:"renderOrgNarrative",value:function(e){var t,r=this,n=e.status,a=e.narrative,i=["RequestNarrative-narrativeCell"];switch(!(!this.props.selectedNarrative||a.workspaceId!==this.props.selectedNarrative.narrative.workspaceId)&&i.push("RequestNarrative-selected"),n){case _.ASSOCIATED:i.push("RequestNarrative-narrativeInOrg"),t=M.createElement(yt.a,{title:"This narrative is already associated with this organization"},M.createElement(Mt.a,{type:"check",style:{color:"green"}}));break;case _.REQUESTED:i.push("RequestNarrative-narrativeInOrg"),t=M.createElement(yt.a,{title:"You have already requested that this narrative be added to this organization"},M.createElement(Mt.a,{type:"loading",style:{color:"orange"}}));break;default:i.push("RequestNarrative-narrativeNotInOrg")}return M.createElement("div",{className:i.join(" "),onClick:function(){r.doSelectNarrative.call(r,e)}},M.createElement("div",{className:"RequestNarrative-narrativeFlag"},t),M.createElement("div",{className:"RequestNarrative-narrative"},this.renderNarrative(e.narrative)))}},{key:"renderNarratives",value:function(){var e=this;if(0===this.props.narratives.length)return M.createElement("div",{className:"message"},"You do not have any Narratives");var t=new Mi(function(t){return e.renderOrgNarrative(e.props.narratives[t])},this.props.narratives.length);return M.createElement(yi,{renderable:t})}},{key:"onSearchSubmit",value:function(){}},{key:"renderSearchIcon",value:function(){return this.props.searching?M.createElement(Mt.a,{type:"loading"}):M.createElement(Mt.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return M.createElement("form",{id:"searchForm",className:"RequestNarrative-searchBar",onSubmit:this.onSearchSubmit.bind(this)},M.createElement("input",{placeholder:"Search your Narratives",autoFocus:!0}),M.createElement(At.a,{className:"RequestNarrative-button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"renderFeedbackBar",value:function(){return M.createElement("div",null,"Showing"," ",Intl.NumberFormat("en-US",{style:"decimal",useGrouping:!0}).format(this.props.narratives.length)," ","narratives")}},{key:"onSortByChange",value:function(e){switch(e){case"title":this.props.doSortBy(nr.TITLE);break;case"savedAt":this.props.doSortBy(nr.LAST_SAVED)}}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return M.createElement("div",{className:"RequestNarrative-filterSortBar"},M.createElement("span",{className:"field-label"},"sort by"),M.createElement(Ir.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},M.createElement(Ir.a.Option,{value:"title",key:"title"},"Title"),M.createElement(Ir.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")))}},{key:"renderNarrativeSelector",value:function(){return M.createElement("div",{className:"RequestNarrative-narrativeSelector scrollable-flex-column"},M.createElement("div",{style:{display:"flex",flexDirection:"row"}},M.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),M.createElement("div",{className:"RequestNarrative-feedbackBar"},this.renderFeedbackBar()),M.createElement("div",{className:"RequestNarrative-narratives scrollable-flex-column"},M.createElement("div",{className:"RequestNarrative-narrativesTable scrollable-flex-column"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===_.ASSOCIATED?M.createElement(St.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===_.REQUESTED?M.createElement(St.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===Ae.ADMIN||this.props.relation.type===Ae.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",M.createElement(At.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){if(this.props.selectedNarrative)return M.createElement("div",{className:"RequestNarrative-selectedNarrative"},M.createElement("div",{className:"RequestNarrative-title"},this.props.selectedNarrative.narrative.title),M.createElement("div",null,M.createElement("span",{className:"field-label"},M.createElement(Mt.a,{type:"save"}))," ",M.createElement(fr,{time:this.props.selectedNarrative.narrative.lastSavedAt,tooltipPrefix:"last saved "})));if(this.props.relation.type===Ae.MEMBER){var e=M.createElement("p",null,"Select a narrative on the left to show it here and be able to request association of it with this Organization.");return M.createElement(St.a,{type:"info",message:e})}var t=M.createElement("p",null,"Select a narrative on the left to show it here and be able to associate it with this Organization.");return M.createElement(St.a,{type:"info",message:t})}},{key:"renderMenuButtons",value:function(){return M.createElement("div",{className:"ButtonSet"},M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"rollback",type:"danger",onClick:this.onFinish.bind(this)},"Done")))}},{key:"renderAlert",value:function(){if(this.props.relation.type===Ae.MEMBER){var e=M.createElement(M.Fragment,null,M.createElement("p",null,"As an Organization member, you are able to request association of any Narrative you own with this Organization."),M.createElement("p",null,"If your Narrative association request is accepted by an Organization administrator, it will appear for all members on the main Organization page."),M.createElement("p",null,"Members will be able to gain view share access to the Narrative."),M.createElement("p",null,"Only Organization administrators will be able to disassociate the Narrative from the Organization."));return M.createElement(St.a,{type:"warning",message:e,style:{marginBottom:"10px"}})}var t=M.createElement(M.Fragment,null,M.createElement("p",null,"As an Organization administrator, you will be able to immediate associate a Narrative you own with this Organization."),M.createElement("p",null,"Members will be able to gain view share access to the Narrative."),M.createElement("p",null,"Only Organization administrators will be able to disassociate the Narrative from the Organization."));return M.createElement(St.a,{type:"warning",message:t,style:{marginBottom:"10px"}})}},{key:"renderSelectedAlert",value:function(){if(this.props.selectedNarrative&&this.props.selectedNarrative.status===_.NONE&&this.props.relation.type===Ae.MEMBER){var e=M.createElement(M.Fragment,null,M.createElement("p",null,"Please be aware that if your request to associate this Narrative is accepted, you will be unable to directly remove it from the Organization."),M.createElement("p",null,"Only Organization administrators are able to remove associated Narratives from the Organization."));return M.createElement(St.a,{type:"warning",message:e,style:{marginBottom:"10px",marginTop:"10px"}})}}},{key:"render",value:function(){return M.createElement("div",{className:"RequestNarrative scrollable-flex-column"},M.createElement(Va,{buttons:this.renderMenuButtons()}),M.createElement("div",{className:"RequestNarrative-body scrollable-flex-column"},M.createElement("div",{className:"RequestNarrative-selectNarrativeCol scrollable-flex-column"},M.createElement("h3",null,"Select a Narrative to Associate with this Organization"),this.renderNarrativeSelector()),M.createElement("div",{className:"RequestNarrative-selectedNarrativeCol"},M.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),this.renderSelectedAlert(),M.createElement("div",{className:"RequestNarrative-selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),M.createElement("div",{className:"RequestNarrative-footer"}))}}]),t}(M.Component);function Ci(e){return function(t,r){t({type:J.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:J.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}function ki(e){var t=e.views.viewOrgView.viewModel;if(null===t)throw new Error("select user invalid state -- no view value");if(t.kind!==N.NORMAL)throw new Error("select user invalid state -- no view value");var r=t.subViews.requestNarrativeView;if(null===r)throw new Error("select user invalid state -- no view value");return r}var Vi=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==N.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.requestNarrativeView.viewModel)throw new Error("argh, null subview view model");var n=r.subViews.requestNarrativeView.viewModel;return{organization:n.organization,relation:n.relation,narratives:n.narratives,selectedNarrative:n.selectedNarrative,searching:!1,sortBy:"title",filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(le.a)(oe.a.mark(function r(n,a){var i,s,o,l,c,u,E;return oe.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:J.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),s=i.auth.authorization,o=s.token,l=s.username,c=i.app.config,u=new He({token:o,username:l,groupsServiceURL:c.services.Groups.url,userProfileServiceURL:c.services.UserProfile.url}),r.prev=3,r.next=6,u.addOrRequestNarrativeToGroup(e,t);case 6:E=r.sent,n((m=E,{type:J.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:m})),n(Tn(e)),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(3),n((d=Je({code:r.t0.name,message:r.t0.message}),{type:J.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 14:case"end":return r.stop()}var d,m},r,null,[[3,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(Ci(t))},doSortBy:function(t){var r;e((r=t,function(){var e=Object(le.a)(oe.a.mark(function e(t,n){var a,i,s,o,l,c,u,E;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:J.REQUEST_ADD_NARRATIVE_SORT_START}),a=n(),e.prev=2,i=ki(a),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),t({type:J.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Je({code:"error",message:e.t0.message})}),e.abrupt("return");case 10:if(null!==i.viewModel){e.next=13;break}return t({type:J.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Je({code:"error",message:"missing view model"})}),e.abrupt("return");case 13:s=a.auth.authorization,o=s.token,l=s.username,c=a.app.config,u=new sr({token:o,username:l,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url,userProfileServiceURL:c.services.UserProfile.url});try{E=u.sortOrganizationNarratives(i.viewModel.narratives,r),t({type:J.REQUEST_ADD_NARRATIVE_SORT_SUCCESS,narratives:E})}catch(d){t({type:J.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Je({code:"error",message:d.message})})}case 16:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t,r){return e.apply(this,arguments)}}()))}}})(Di),Ui=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement(M.Fragment,null,M.createElement(Mt.a,{type:"loading"})," ","Loading Your Narratives...");return M.createElement(St.a,{type:"info",message:e,style:{padding:"20px",width:"30em",margin:"30px auto 0 auto",textAlign:"center"}})}},{key:"renderError",value:function(e){return M.createElement("div",null,"Error!",M.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case T.NONE:case T.LOADING:return this.renderLoading();case T.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(pr({code:"Missing Error",message:"The error appears to be missing"}));default:return M.createElement(Vi,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case T.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var zi=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==N.NORMAL)throw new Error("not the right vm");return{view:r.subViews.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d,m,v,p,O,h,R;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,c=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url}),u=new sr({token:s,username:o,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,workspaceServiceURL:l.services.Workspace.url,userProfileServiceURL:l.services.UserProfile.url}),E=new he({token:s,username:o,groupsServiceURL:l.services.Groups.url}),t.prev=5,t.next=8,Promise.all([c.getOrganization(e),u.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,m=Object(ce.a)(d,4),v=m[0],p=m[1],O=m[2],h=m[3],R=Me(v,o,O,h),r((_=v,g=p,f=R,{type:J.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:_,narratives:g,relation:f})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((w=Je({code:t.t0.name,message:t.t0.message}),{type:J.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:w}));case 22:case"end":return t.stop()}var w,_,g,f},t,null,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:J.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(Ui),ji=(r(293),r(294),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.viewModel.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.props.onChangeSubView(b.MANAGE_MEMBERSHIP);break;case"editOrg":this.props.onChangeSubView(b.EDIT_ORGANIZATION);break;case"inviteUser":this.props.onChangeSubView(b.INVITE_USER);break;case"addNarrative":this.props.onChangeSubView(b.ADD_NARRATIVE);break;case"manageRelatedOrgs":this.props.onChangeSubView(b.MANAGE_RELATED_ORGS);break;case"addApp":this.props.onChangeSubView(b.ADD_APP)}}},{key:"renderOrgMenu",value:function(){this.props.viewModel.organization;switch(this.props.viewModel.relation.type){case Ae.NONE:case Ae.VIEW:return M.createElement(At.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization");case Ae.MEMBER_REQUEST_PENDING:return M.createElement(yt.a,{placement:"bottom",mouseEnterDelay:.5,title:"You have requested to join this Org; you may cancel your join request with this button"},M.createElement(At.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Join Request"));case Ae.MEMBER_INVITATION_PENDING:return M.createElement("div",{className:"ViewOrganization-invitationPendingCard"},M.createElement("span",null,"You have been invited to this organization: "),M.createElement(At.a,{icon:"check",type:"default",size:"small",onClick:this.onAcceptInvitation.bind(this)},"Accept"),M.createElement(At.a,{icon:"stop",type:"danger",size:"small",onClick:this.onRejectInvitation.bind(this)},"Reject"));case Ae.MEMBER:var e=M.createElement(Ct.a,{onClick:this.onMenuClick.bind(this)},M.createElement(Ct.a.Item,{key:"addApp"},M.createElement(Mt.a,{type:"appstore"})," ","Associate Apps"),M.createElement(Ct.a.Item,{key:"addNarrative"},M.createElement(Mt.a,{type:"file"})," ","Associate Narratives"),M.createElement(Ct.a.Item,{key:"manageMyMembership"},M.createElement(Mt.a,{type:"user"})," ","Manage My Membership"));return M.createElement(kt.a,{overlay:e,trigger:["click"]},M.createElement(Mt.a,{type:"setting",theme:"filled",className:"IconButton OrgMenu-menuButton"}));case Ae.ADMIN:var t=M.createElement(Ct.a,{onClick:this.onMenuClick.bind(this)},M.createElement(Ct.a.Item,{key:"addApp"},M.createElement(Mt.a,{type:"appstore"})," ","Associate Apps"),M.createElement(Ct.a.Item,{key:"addNarrative"},M.createElement(Mt.a,{type:"file"})," ","Associate Narratives"),M.createElement(Ct.a.Item,{key:"editOrg"},M.createElement(Mt.a,{type:"edit"})," ","Edit this Org"),M.createElement(Ct.a.Item,{key:"inviteUser"},M.createElement(Mt.a,{type:"mail"})," ","Invite User"),M.createElement(Ct.a.Item,{key:"manageMyMembership"},M.createElement(Mt.a,{type:"user"})," ","Manage My Membership"),M.createElement(Ct.a.Item,{key:"manageRelatedOrgs"},M.createElement(Mt.a,{type:"team"})," ","Manage Related Orgs"));return M.createElement(kt.a,{overlay:t,trigger:["click"]},M.createElement(Mt.a,{type:"setting",theme:"filled",className:"IconButton OrgMenu-menuButton"}));case Ae.OWNER:var r=M.createElement(Ct.a,{onClick:this.onMenuClick.bind(this)},M.createElement(Ct.a.Item,{key:"addApp"},M.createElement(Mt.a,{type:"appstore"})," ","Associate Apps"),M.createElement(Ct.a.Item,{key:"addNarrative"},M.createElement(Mt.a,{type:"file"})," ","Associate Narratives"),M.createElement(Ct.a.Item,{key:"editOrg"},M.createElement(Mt.a,{type:"edit"})," ","Edit this Org"),M.createElement(Ct.a.Item,{key:"inviteUser"},M.createElement(Mt.a,{type:"mail"})," ","Invite User"),M.createElement(Ct.a.Item,{key:"manageMyMembership"},M.createElement(Mt.a,{type:"user"})," ","Manage My Membership"),M.createElement(Ct.a.Item,{key:"manageRelatedOrgs"},M.createElement(Mt.a,{type:"team"})," ","Manage Related Orgs"));return M.createElement(kt.a,{overlay:r,trigger:["click"]},M.createElement(Mt.a,{type:"setting",theme:"filled",className:"IconButton OrgMenu-menuButton"}))}}},{key:"render",value:function(){return M.createElement("div",{className:"OrgMenu"},this.renderOrgMenu())}}]),t}(M.Component)),Gi=(r(295),r(296),function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderIcon",value:function(){return this.props.app.icon.url?M.createElement("img",{src:this.props.app.icon.url,className:"App-icon"}):M.createElement(Mt.a,{type:"border",style:{fontSize:"30px",color:"rgb(103, 58, 103)"}})}},{key:"renderAuthors",value:function(){var e=this.props.app.authors.length;return this.props.app.authors.map(function(t,r){var n;return r<e-1&&(n=", "),M.createElement("a",{href:"#people/".concat(t),key:t},t,n)})}},{key:"render",value:function(){return M.createElement("div",{className:"App"},M.createElement("div",{className:"App-iconCol"},this.renderIcon()),M.createElement("div",{className:"App-appCol"},M.createElement("div",{className:"App-name"},M.createElement("a",{href:"/#catalog/apps/"+this.props.app.id,target:"_blank"},this.props.app.name)),M.createElement("div",{className:"App-subtitle"},this.props.app.subtitle),M.createElement("div",{className:"App-moduleName"},M.createElement("span",{className:"field-label"},"module"),this.props.app.moduleName),M.createElement("div",{className:"App-authors"},M.createElement("span",{className:"field-label"},"by")," ",this.renderAuthors())))}}]),t}(M.Component)),Li=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return this.props.app?M.createElement(Gi,{app:this.props.app}):M.createElement("div",null,M.createElement(Mt.a,{type:"loading"})," Loading App...")}},{key:"componentDidMount",value:function(){this.props.app||this.props.onLoad(this.props.appId)}}]),t}(M.Component);var Pi=Object(W.b)(function(e,t){return{app:e.entities.apps.byId.get(t.appId)}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:J.ENTITY_LOAD_APP_START}),a=n(),i=a.auth.authorization,s=i.token,i.username,o=a.app.config,l=new vr({token:s,narrativeMethodStoreURL:o.services.NarrativeMethodStore.url}),t.prev=3,t.next=6,l.getApp(e);case 6:c=t.sent,r((E=c,{type:J.ENTITY_LOAD_APP_SUCCESS,app:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((u=pr({code:"error",message:t.t0.message}),{type:J.ENTITY_LOAD_APP_ERROR,error:u}));case 13:case"end":return t.stop()}var u,E},t,null,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Li),xi=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderButtonRow",value:function(){return M.createElement(At.a,{size:"small",style:{width:"100%"},onClick:this.props.onAssociateApp},M.createElement(Mt.a,{type:"appstore"}),"Associate Apps")}},{key:"renderSearchRow",value:function(){return M.createElement(M.Fragment,null,M.createElement("div",{className:"Apps-searchInput"},M.createElement(cn.a,{placeholder:"Filter apps by title or author"})),M.createElement("div",{className:"Apps-searchControls"},M.createElement("span",{className:"field-label"},"sort"),M.createElement(Ir.a,{style:{width:"11em"},dropdownMatchSelectWidth:!0,defaultValue:"dateAdded"},M.createElement(Ir.a.Option,{key:"dateAdded",value:"dateAdded"},"Date Added"),M.createElement(Ir.a.Option,{key:"name",value:"name"},"Name"))))}},{key:"renderBrowseRows",value:function(){var e=this;if(0===this.props.apps.apps.length)return M.createElement(St.a,{type:"info",message:"Sorry, no apps"});var t=this.props.apps.apps.map(function(t,r){var n=M.createElement(Ct.a,null,M.createElement(Ct.a.Item,{key:"removeApp",onClick:function(){return e.props.onRemoveApp(t.appId)}},M.createElement(Mt.a,{type:"delete",style:{color:"red"}}),"Remove App from Organization"));return M.createElement("div",{key:String(r),className:"Apps-appRow SimpleCard"},M.createElement("div",{className:"Apps-appColumn"},M.createElement(Pi,{appId:t.appId})),M.createElement("div",{className:"Apps-menuColumn"},M.createElement(kt.a,{overlay:n,trigger:["click"]},M.createElement(Mt.a,{type:"ellipsis"}))))});return M.createElement(M.Fragment,null,t)}},{key:"render",value:function(){return M.createElement("div",{className:"Apps"},M.createElement("div",{className:"Apps-buttonRow"},this.renderButtonRow()),M.createElement("div",{className:"Apps-searchRow"},this.renderSearchRow()),M.createElement("div",{className:"Apps-browseRow"},this.renderBrowseRows()))}}]),t}(M.Component);function Bi(e){return{type:J.VIEW_ORG_ADD_APPS_LOAD_ERROR,error:e}}function Wi(e){var t=e.views.viewOrgView.viewModel;if(!t)throw new Error("Error loading: no org view model");if(t.kind!==N.NORMAL)throw new Error("View model not NORMAL kind");var r=t.subViews.addAppsView.viewModel;if(null===r)throw new Error("Error loading: no org subview model");return[t,r]}function qi(e,t){return{type:J.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_SUCCESS,appId:e,pending:t}}r(297);var Hi=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"doSelectApp",value:function(e){this.props.onSelectApp(e.app.id)}},{key:"doRequestAssociation",value:function(){this.props.selectedApp&&this.props.onRequestAssociation(this.props.selectedApp.app.id)}},{key:"renderMenuButtons",value:function(){return M.createElement("div",{className:"ButtonSet"},M.createElement("div",{className:"ButtonSet-button"},M.createElement(At.a,{icon:"rollback",type:"danger",onClick:this.props.onFinish},"Done")))}},{key:"renderSearchBar",value:function(){return M.createElement("div",{className:"AddApps-searchBar"},M.createElement(cn.a,{style:{width:"100%"},placeholder:"Filter apps by title"}))}},{key:"renderAppStatus",value:function(e){switch(e.relation){case S.NONE:return;case S.ASSOCIATED:return M.createElement(Mt.a,{type:"check"});case S.ASSOCIATION_PENDING:return M.createElement(Mt.a,{type:"loading"})}}},{key:"renderApps",value:function(){var e=this,t=this.props.apps.map(function(t,r){var n=["AddApps-app"];return t.selected?n.push("Hoverable-selected"):n.push("Hoverable"),M.createElement("div",{className:n.join(" "),key:String(r),onClick:function(){e.doSelectApp(t)}},M.createElement("div",{className:"AddApps-app-statusColumn"},e.renderAppStatus(t)),M.createElement("div",{className:"AddApps-app-appColumn"},M.createElement(Pi,{appId:t.app.id})))});return M.createElement("div",{className:"AddApps-apps"},t)}},{key:"renderAppSelector",value:function(){return M.createElement(M.Fragment,null,this.renderSearchBar(),this.renderApps())}},{key:"renderMessage",value:function(){var e,t,r=this.props.selectedApp;if(null===r)t="Please select an App to associate",e="info";else switch(r.relation){case S.ASSOCIATED:t="This App is already associated",e="warning";break;case S.ASSOCIATION_PENDING:t="You have requested association of this App",e="warning";break;default:return}return M.createElement(St.a,{type:e,style:{marginTop:"10px"},message:t})}},{key:"renderSelectedApp",value:function(){if(null!==this.props.selectedApp)return M.createElement("div",{className:"AddApps-selectedApp"},M.createElement(Pi,{appId:this.props.selectedApp.app.id}))}},{key:"renderAppSelectionControls",value:function(){var e=this;if(null===this.props.selectedApp)return M.createElement(At.a,{disabled:!0,type:"primary"},"Associate this App");switch(this.props.selectedApp.relation){case S.NONE:return M.createElement(At.a,{onClick:function(){e.doRequestAssociation()},type:"primary"},"Associate this App");case S.ASSOCIATED:case S.ASSOCIATION_PENDING:return M.createElement(At.a,{disabled:!0,type:"primary"},"Associate this App")}}},{key:"renderAppAdder",value:function(){return M.createElement(M.Fragment,null,this.renderSelectedApp(),this.renderMessage(),M.createElement("div",{className:"AddApps-selectionControls"},this.renderAppSelectionControls()))}},{key:"render",value:function(){return M.createElement("div",{className:"AddApps"},M.createElement(Va,{buttons:this.renderMenuButtons()}),M.createElement("div",{className:"AddApps-row"},M.createElement("div",{className:"AddApps-selectColumn"},M.createElement("h3",null,"Select an App you have authored"),this.renderAppSelector()),M.createElement("div",{className:"AddApps-addColumn"},M.createElement("h3",null,"View and Add App"),this.renderAppAdder())))}}]),t}(M.Component);var Fi=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==N.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.addAppsView.viewModel)throw new Error("argh, null subview view model");var n=r.subViews.addAppsView.viewModel;return{apps:n.apps,selectedApp:n.selectedApp}},function(e){return{onSelectApp:function(t){var r;e((r=t,function(){var e=Object(le.a)(oe.a.mark(function e(t,n){var a,i,s,o,l;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n(),e.prev=1,i=Wi(a),(s=Object(ce.a)(i,2))[0],o=s[1],0!==(l=o.apps.filter(function(e){return e.app.id===r})).length){e.next=7;break}return t(Bi(pr({code:"runtime-error",message:"Strange, no matching app for selection"}))),e.abrupt("return");case 7:t((c=l[0],{type:J.VIEW_ORG_ADD_APPS_SELECT_SUCCESS,selectedApp:c})),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),t(Bi(pr({code:"runtime-error",message:e.t0.message}))),e.abrupt("return");case 14:case"end":return e.stop()}var c},e,null,[[1,10]])}));return function(t,r){return e.apply(this,arguments)}}()))},onRequestAssociation:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d,m,v,p,O;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=Wi(n()),i=Object(ce.a)(a,2),s=i[0],i[1],o=n(),l=o.auth.authorization,c=l.token,u=l.username,E=o.app.config.services,d=E.Groups.url,m=E.UserProfile.url,v=new He({groupsServiceURL:d,userProfileServiceURL:m,username:u,token:c}),p=e.split("/").join("."),t.next=7,v.addOrRequestAppToGroup(s.organization.id,p);case 7:O=t.sent,r(qi(e,!0!==O)),r(Tn(s.organization.id)),t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(0),r((h=pr({code:"runtime-error",message:t.t0.message}),{type:J.VIEW_ORG_ADD_APPS_REQUEST_ASSOCIATE_APP_ERROR,error:h})),t.abrupt("return");case 17:case"end":return t.stop()}var h},t,null,[[0,13]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Hi),Qi=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement("div",null,"Loading ..."," ",M.createElement(jr.a,null));return M.createElement(St.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return M.createElement("div",null,'Error loading "add apps" tool.',M.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case T.NONE:case T.LOADING:return this.renderLoading();case T.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(pr({code:"Missing Error",message:"The error appears to be missing"}));case T.OK:default:return M.createElement(Fi,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case T.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var Yi,Ji,Zi=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==N.NORMAL)throw new Error("not the right vm");return{view:r.subViews.addAppsView}},function(e){return{onLoad:function(){e(function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i,s,o,l,c,u,E,d,m;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:J.VIEW_ORG_ADD_APPS_LOAD_START}),n=r(),a=n.views.viewOrgView.viewModel){e.next=6;break}return t(Bi(pr({code:"load-error",message:"Error loading: no org view model"}))),e.abrupt("return");case 6:if((i=a.organization).kind===be.NORMAL){e.next=10;break}return t(Bi(pr({code:"load-error",message:"Error loading: not normal org"}))),e.abrupt("return");case 10:return s=n.auth.authorization,o=s.token,l=s.username,c=n.app.config.services.NarrativeMethodStore.url,u=new or({url:c,token:o}),e.prev=12,e.next=15,u.list_methods({tag:"release"});case 15:E=e.sent,d=i.apps,m=E.filter(function(e){return e.authors.includes(l)}).map(function(e){var t,r=e.id;return t=d.find(function(e){return e.appId===r})?S.ASSOCIATED:a.requestOutbox.find(function(e){return e.resourceType===Ee.APP&&e.type===ue.REQUEST&&e.appId===r})?S.ASSOCIATION_PENDING:S.NONE,{app:mr(e),selected:!1,relation:t,appId:r}}).sort(function(e,t){return e.app.name.localeCompare(t.app.name)}),t((v=m,{type:J.VIEW_ORG_ADD_APPS_LOAD_SUCCESS,rawApps:v,sortBy:"name",searchBy:"",apps:v,selectedApp:null})),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(12),t(Bi(pr({code:"error",message:e.t0.message})));case 24:case"end":return e.stop()}var v},e,null,[[12,21]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:J.VIEW_ORG_ADD_APPS_UNLOAD})}}})(Qi);!function(e){e[e.NONE=0]="NONE",e[e.VIEW_MEMBERS=1]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=2]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=3]="VIEW_ORGANIZATION",e[e.BROWSER=4]="BROWSER"}(Yi||(Yi={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(Ji||(Ji={}));var Ki=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Yi.NONE,requestAccess:{narrative:null},accordionState:Ji.UP,subView:b.NORMAL},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.setState({subView:b.MANAGE_RELATED_ORGS})}},{key:"onInviteUser",value:function(){this.setState({subView:b.INVITE_USER})}},{key:"onAssociateApp",value:function(){this.setState({subView:b.ADD_APP})}},{key:"onChangeSubView",value:function(e){this.setState({subView:e})}},{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.viewModel.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({subView:b.ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){Dt.a.info({title:"View Organization Help",width:"50em",content:M.createElement("div",null,"Organization help here...")})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return M.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.viewModel.relation.type===Ae.ADMIN||this.props.viewModel.relation.type===Ae.OWNER)return M.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",M.createElement(Nt.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},M.createElement(At.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.viewModel.relation.type===Ae.ADMIN||this.props.viewModel.relation.type===Ae.OWNER)return M.createElement(Nt.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},M.createElement(At.a,{icon:"edit"},"Edit This Organization"))}},{key:"renderOrg",value:function(){if(this.props.viewModel.organization)return M.createElement("div",{className:"ViewOrganization-org-description-org scrollable-flex-column"},M.createElement("div",{className:"ViewOrganization-org-description",dangerouslySetInnerHTML:{__html:ln.Marked.parse(this.props.viewModel.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return M.createElement("div",{className:"ownerTable"},M.createElement("div",{className:"proprietorCol"},M.createElement("div",{className:"owner"},M.createElement("a",{href:"/#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderRelation",value:function(e){switch(e.type){case Ae.NONE:return M.createElement("span",null,M.createElement(Mt.a,{type:"stop"}),"None");case Ae.VIEW:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},M.createElement("div",null,M.createElement(Mt.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),M.createElement("div",{style:{marginTop:"10px"}},M.createElement(At.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case Ae.MEMBER_REQUEST_PENDING:return M.createElement("div",null,M.createElement("div",null,M.createElement(Mt.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",M.createElement("b",null,"request")," is pending"),M.createElement("div",null,M.createElement(At.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case Ae.MEMBER_INVITATION_PENDING:return M.createElement("div",null,M.createElement("div",null,M.createElement(Mt.a,{type:"user",style:{color:"blue"}}),"You have been ",M.createElement("b",null,"invited")," to join this Organization"),M.createElement("div",{style:{marginTop:"10px"}},M.createElement(At.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),M.createElement(At.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case Ae.MEMBER:return M.createElement("span",null,M.createElement(Mt.a,{type:"user"}),"Member");case Ae.ADMIN:return M.createElement("span",null,M.createElement(Mt.a,{type:"unlock"}),"Admin");case Ae.OWNER:return M.createElement(yt.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},M.createElement("span",null,M.createElement(Mt.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.viewModel.organization&&(this.props.viewModel.relation.type===Ae.OWNER||this.props.viewModel.relation.type===Ae.ADMIN||this.props.viewModel.relation.type===Ae.MEMBER)}},{key:"renderMembers",value:function(){return this.isMember()?M.createElement(Fn,{organization:this.props.viewModel.organization,relation:this.props.viewModel.relation,onReloadOrg:this.props.onReloadOrg}):M.createElement(St.a,{message:"Membership is only available to members",type:"info"})}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.viewModel.relation,r=this.props.viewModel.groupRequests,n=this.props.viewModel.groupInvitations;if((t.type===Ae.ADMIN||t.type===Ae.OWNER)&&(null!==r&&null!==n))return e=r.length?M.createElement("div",null,"group has no pending requests"):M.createElement("div",null,M.createElement("div",null,M.createElement(Mt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",M.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",M.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),M.createElement("div",null,M.createElement(Nt.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},M.createElement(At.a,null,"Manage Requests")))),M.createElement("div",{className:"row"},M.createElement("div",{className:"col1"},M.createElement("span",{className:"label"},"admin")),M.createElement("div",{className:"col2"},M.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?M.createElement("div",null,M.createElement("div",null,M.createElement(Mt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",M.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",M.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),M.createElement("div",null,M.createElement(Nt.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},M.createElement(At.a,null,"Manage Requests")))):M.createElement("div",{className:"message"},"No pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case Ae.NONE:case Ae.VIEW:return"infoBox";case Ae.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case Ae.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case Ae.MEMBER:case Ae.ADMIN:case Ae.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return M.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.viewModel.relation;if(e.type===Ae.ADMIN||e.type===Ae.OWNER){var t=this.props.viewModel,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=M.createElement("span",null,M.createElement(Mt.a,{type:"unlock"})," ","group requests"," ",M.createElement("span",{className:"ViewOrganization-titleCount"},"(",a,")"));return M.createElement("div",{className:"ViewOrganization-adminTasksBox"},M.createElement(Un.a,{className:"slimCard ViewOrganization-adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.viewModel.organization&&this.props.viewModel.relation.type===Ae.VIEW)return M.createElement(At.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderLoadingHeader",value:function(){var e=M.createElement("span",null,"Loading Org...");return M.createElement(zn,{breadcrumbs:e})}},{key:"renderMembersTab",value:function(){return M.createElement("div",{className:"ViewOrganization-membersCol scrollable-flex-column"},this.renderMembersToolbar(),this.renderMembers())}},{key:"onAcceptRequest",value:function(e){this.props.onAcceptRequest(e.id)}},{key:"renderMembersToolbar",value:function(){switch(this.props.viewModel.relation.type){case Ae.NONE:case Ae.MEMBER:return;case Ae.ADMIN:case Ae.OWNER:return M.createElement("div",{className:"ViewOrganization-tabPaneToolbar"},M.createElement(yt.a,{placement:"bottomRight",title:"Invite one or more users to this organization"},M.createElement(At.a,{size:"small",style:{width:"100%"},onClick:this.onInviteUser.bind(this)},M.createElement(Mt.a,{type:"mail"}),"Invite Users")))}}},{key:"renderToolbarButtons",value:function(){switch(this.props.viewModel.relation.type){case Ae.NONE:case Ae.MEMBER:return;case Ae.ADMIN:case Ae.OWNER:return M.createElement(M.Fragment,null,M.createElement(yt.a,{placement:"bottomRight",title:"Invite a user to this organization"},M.createElement(At.a,{size:"small",onClick:this.onInviteUser.bind(this)},M.createElement(Mt.a,{type:"mail"}))))}}},{key:"renderCombo",value:function(){var e,t=this,r=this.props.viewModel.relation.type===Ae.ADMIN||this.props.viewModel.relation.type===Ae.OWNER,n=this.props.viewModel.organization.isMember,a=[];if(e=this.props.viewModel.organization.memberCount-1?String(this.props.viewModel.organization.memberCount-1):"\xd8",a.push(M.createElement(En.a.TabPane,{tab:M.createElement("span",null,M.createElement(Mt.a,{type:"team"}),"Members ",M.createElement("span",{className:"ViewOrganization-tabCount"},"(",e,")")),key:"members",style:{flexDirection:"column"}},this.renderMembersTab())),n)if(r){var i=this.props.viewModel.requestInbox.length+this.props.viewModel.requestOutbox.length,s=M.createElement("span",{className:"ViewOrganization-tabCount"},"(",i||"\xd8",")");a.push(M.createElement(En.a.TabPane,{tab:M.createElement("span",null,M.createElement(Mt.a,{type:"inbox"}),"Requests ",s," "),key:"inbox",style:{flexDirection:"column"}},M.createElement(ua,{inbox:this.props.viewModel.requestInbox,outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}else{var o,l=this.props.viewModel.requestOutbox.length;o=l?String(l):"\xd8",a.push(M.createElement(En.a.TabPane,{tab:M.createElement("span",null,M.createElement(Mt.a,{type:"inbox"}),"Requests ",M.createElement("span",{className:"ViewOrganization-tabCount"},"(",o,")")),key:"outbox",style:{flexDirection:"column"}},M.createElement(ua,{inbox:[],outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}var c=this.props.viewModel.organization.relatedOrganizations.length,u=M.createElement("span",null,M.createElement(Mt.a,{type:"team"}),"Related Orgs ",M.createElement("span",{className:"ViewOrganization-tabCount"},"(",c,")"));return a.push(M.createElement(En.a.TabPane,{tab:u,key:"relatedorgs",style:{flexDirection:"column"}},M.createElement(wa,{relatedOrganizations:this.props.viewModel.organization.relatedOrganizations,organization:this.props.viewModel.organization,onManageRelatedOrgs:function(){t.onManageRelatedOrgs()}}))),M.createElement(En.a,{defaultActiveKey:"members",className:"ViewOrganization-tabs",animated:!1,size:"small",tabPosition:"top"},a)}},{key:"renderMenuButtons",value:function(){return M.createElement("span",{className:"ButtonSet"},M.createElement("span",{className:"ButtonSet-button"},M.createElement("div",{className:"IconButton",onClick:this.onNavigateToBrowser.bind(this)},M.createElement(Mt.a,{type:"close"}))))}},{key:"onNavigateToBrowser",value:function(){this.setState({navigateTo:Yi.BROWSER})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({subView:b.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:Yi.VIEW_MEMBERS});break;case"editOrg":this.setState({subView:b.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({subView:b.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:Yi.MANAGE_REQUESTS});break;case"addNarrative":this.setState({subView:b.ADD_NARRATIVE});break;case"addApp":this.setState({subView:b.ADD_APP});break;case"manageRelatedOrgs":this.setState({subView:b.MANAGE_RELATED_ORGS})}}},{key:"toggleAccordion",value:function(){this.setState({accordionState:this.state.accordionState===Ji.UP?Ji.DOWN:Ji.UP})}},{key:"renderAccordionControl",value:function(){var e;return e=this.state.accordionState===Ji.UP?"caret-down":"caret-up",M.createElement("div",{className:"ViewOrganization-accordion",onClick:this.toggleAccordion.bind(this)},M.createElement("div",{className:"ViewOrganization-accordionCol1"},M.createElement("div",{className:"ViewOrganization-accordionRow1"}),M.createElement("div",{className:"ViewOrganization-accordionRow2"}),M.createElement("div",{className:"ViewOrganization-accordionRow3"})),M.createElement("div",{className:"ViewOrganization-accordionCol2"},M.createElement("div",{className:"ViewOrganization-accordionRow1"}),M.createElement("div",{className:"ViewOrganization-accordionRow2"},M.createElement(Mt.a,{type:e})),M.createElement("div",{className:"ViewOrganization-accordionRow3"})),M.createElement("div",{className:"ViewOrganization-accordionCol3"},M.createElement("div",{className:"ViewOrganization-accordionRow1"}),M.createElement("div",{className:"ViewOrganization-accordionRow2"}),M.createElement("div",{className:"ViewOrganization-accordionRow3"})))}},{key:"renderDescriptionTab",value:function(){if(this.props.viewModel.organization)return M.createElement("div",{className:"ViewOrganization-org-description-org scrollable-flex-column"},M.createElement("div",{className:"ViewOrganization-org-description",dangerouslySetInnerHTML:{__html:ln.Marked.parse(this.props.viewModel.organization.description||"")}}))}},{key:"renderNarrativesTab",value:function(){return M.createElement($a,{organization:this.props.viewModel.organization,narratives:this.props.viewModel.narratives.narratives,relation:this.props.viewModel.relation,sortNarrativesBy:this.props.viewModel.narratives.sortBy,searchNarrativesBy:this.props.viewModel.narratives.searchBy,onSortNarratives:this.props.onSortNarratives,onSearchNarratives:this.props.onSearchNarratives,onRemoveNarrative:this.props.onRemoveNarrative,onGetViewAccess:this.props.onGetViewAccess,onRequestAddNarrative:this.onRequestAddNarrative.bind(this)})}},{key:"renderAppsTab",value:function(){return M.createElement(xi,{organization:this.props.viewModel.organization,apps:this.props.viewModel.apps,onAssociateApp:this.onAssociateApp.bind(this),onRemoveApp:this.props.onRemoveApp.bind(this)})}},{key:"renderMainTabs",value:function(){var e=[],t=M.createElement("span",null,M.createElement(Mt.a,{type:"info-circle"}),"About");e.push(M.createElement(En.a.TabPane,{tab:t,key:"about",style:{flexDirection:"column"}},this.renderDescriptionTab()));var r=this.props.viewModel.narratives.narratives.length,n=M.createElement("span",null,M.createElement(Mt.a,{type:"file"}),"Narratives"," ",M.createElement("span",{className:"ViewOrganization-tabCount"},"(",r,")"));e.push(M.createElement(En.a.TabPane,{tab:n,key:"narratives",style:{flexDirection:"column"}},this.renderNarrativesTab()));var a,i=this.props.viewModel.organization.appCount,s=M.createElement("span",null,M.createElement(Mt.a,{type:"appstore"}),"Apps"," ",M.createElement("span",{className:"ViewOrganization-tabCount"},"(",i,")"));return e.push(M.createElement(En.a.TabPane,{tab:s,key:"apps",style:{flexDirection:"column"}},this.renderAppsTab())),a=this.props.viewModel.organization.isMember?"narratives":"about",M.createElement(En.a,{defaultActiveKey:a,className:"ViewOrganization-tabs",animated:!1,size:"small",tabPosition:"top"},e)}},{key:"renderNormalView",value:function(){return M.createElement("div",{className:"ViewOrganization-mainRow scrollable-flex-column"},M.createElement("div",{className:"ViewOrganization-mainColumn  scrollable-flex-column"},this.renderMainTabs()),M.createElement("div",{className:"ViewOrganization-infoColumn"},this.renderCombo()))}},{key:"renderManageRelatedOrgsView",value:function(){var e=this;return M.createElement(Sa,{onFinish:function(){e.setState({subView:b.NORMAL})}})}},{key:"renderInviteUsersView",value:function(){var e=this;return M.createElement(Ba,{onFinish:function(){e.setState({subView:b.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderManageMembership",value:function(){var e=this;return M.createElement(li,{onFinish:function(){e.setState({subView:b.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderEditOrganization",value:function(){var e=this;return M.createElement(bi,{onFinish:function(){e.setState({subView:b.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderAddNarrative",value:function(){var e=this;return M.createElement(zi,{onFinish:function(){e.setState({subView:b.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderAddApp",value:function(){var e=this;return M.createElement(Zi,{onFinish:function(){e.setState({subView:b.NORMAL})}})}},{key:"getSubView",value:function(){switch(this.state.subView){case b.MANAGE_RELATED_ORGS:return this.renderManageRelatedOrgsView();case b.INVITE_USER:return this.renderInviteUsersView();case b.MANAGE_MEMBERSHIP:return this.renderManageMembership();case b.EDIT_ORGANIZATION:return this.renderEditOrganization();case b.ADD_NARRATIVE:return this.renderAddNarrative();case b.ADD_APP:return this.renderAddApp();case b.NORMAL:default:return this.renderNormalView()}}},{key:"render",value:function(){switch(this.state.navigateTo){case Yi.BROWSER:return M.createElement(on.a,{push:!0,to:"/organizations"});case Yi.NONE:}var e=this.props.viewModel.organization,t=M.createElement(ji,{viewModel:this.props.viewModel,onJoinOrg:this.props.onJoinOrg,onCancelJoinRequest:this.props.onCancelJoinRequest,onAcceptInvitation:this.props.onAcceptInvitation,onRejectInvitation:this.props.onRejectInvitation,onChangeSubView:this.onChangeSubView.bind(this)});return M.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},M.createElement("div",{className:"ViewOrganization-organizationBox"},M.createElement(da,{organization:e,openRequestsStatus:this.props.viewModel.openRequest,orgMenu:t,onNavigateToBrowser:this.onNavigateToBrowser.bind(this)})),this.getSubView())}}]),t}(M.Component);var Xi,$i=Object(W.b)(function(e){var t=e.views.viewOrgView.viewModel;if(!t)throw new Error("argh, view model missing");if(t.kind!==N.NORMAL)throw new Error("argh, wrong org kind");return{viewModel:t}},function(e){return{onViewOrg:function(t){e(In(t))},onReloadOrg:function(t){e(Tn(t))},onJoinOrg:function(){e(yn())},onCancelJoinRequest:function(t){e(Mn(t))},onAcceptInvitation:function(t){e(Dn(t))},onRejectInvitation:function(t){e(Cn(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:J.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(_n({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,s=i.token,o=i.username,l=a.app.config,(c=a.views.viewOrgView.viewModel).kind===N.NORMAL){t.next=9;break}return r(_n({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:if(u=c.organization){t.next=13;break}return r(_n({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 13:return E=u.id,d=new He({token:s,username:o,groupsServiceURL:l.services.Groups.url,userProfileServiceURL:l.services.UserProfile.url}),t.prev=15,t.next=18,d.removeNarrativeFromOrg(E,e.workspaceId);case 18:r((m=e.workspaceId,{type:J.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrativeId:m})),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(15),r(_n({code:t.t0.name,message:t.t0.message}));case 24:case"end":return t.stop()}var m},t,null,[[15,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(le.a)(oe.a.mark(function t(r,n){var a,i,s,o,l,c,u,E,d,m,v,p,O,h,R,w;return oe.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:J.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(fn({code:"error",message:"No view model"})),t.abrupt("return");case 5:if((i=a.views.viewOrgView.viewModel).kind===N.NORMAL){t.next=9;break}return r(fn({code:"error",message:"Not NORMAL org"})),t.abrupt("return");case 9:return s=i.organization,o=i.narratives,l=o.sortBy,c=o.searchBy,u=a.auth.authorization,E=u.token,d=u.username,m=a.app.config,v=s.id,p=String(e.workspaceId),O=new He({token:E,username:d,groupsServiceURL:m.services.Groups.url,userProfileServiceURL:m.services.UserProfile.url}),t.prev=14,t.next=17,O.grantNarrativeAccess(v,p);case 17:return t.next=19,O.getOrg(v);case 19:if((h=t.sent).kind===be.NORMAL){t.next=23;break}return r(fn({code:"error",message:"Not a NORMAL org"})),t.abrupt("return");case 23:R=h.narratives,w=Be(R,{sortBy:l,searchBy:c}),r(hr(e.workspaceId)),r(gn(h,w)),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(14),r(fn({code:"error",message:t.t0.message}));case 32:case"end":return t.stop()}},t,null,[[14,29]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onAcceptRequest:function(t){e(Vn(t))},onSortNarratives:function(t){e(function(e){return function(t,r){t({type:J.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===N.NORMAL){var i=n.organization.narratives,s=n.narratives.searchBy,o=Be(i,{sortBy:e,searchBy:s});t({type:J.VIEW_ORG_SORT_NARRATIVES_SUCCESS,narratives:o,sortBy:e})}else t(Nn({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Nn({type:a.ERROR,message:"Now view model!"}))}}(t))},onSearchNarratives:function(t){e(function(e){return function(t,r){t({type:J.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===N.NORMAL){var i=Be(n.organization.narratives,{sortBy:n.narratives.sortBy,searchBy:e});t({type:J.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS,searchBy:e,narratives:i})}else t(Nn({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Nn({type:a.ERROR,message:"Now view model!"}))}}(t))},onRemoveApp:function(t){e(kn(t))}}})(Ki);r(298);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(Xi||(Xi={}));var es=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Xi.NONE,requestAccess:{narrative:null}},r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onShowInfo",value:function(){Dt.a.info({title:"View Organization Help",width:"50em",content:M.createElement("div",null,M.createElement("p",null,"This organization is ",M.createElement("b",null,"private"),"."),M.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),M.createElement("p",null,"Upon requesting membership, an organization administrator may grant you membership"),M.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."))})}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"renderMessage",value:function(){switch(this.props.relation.type){case Ae.NONE:return M.createElement(M.Fragment,null,M.createElement("p",null,"This organization is ",M.createElement("b",null,"private")," and you are not a member."),M.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),M.createElement("p",null,"Upon requesting membership, the organization administrators will be notified."),M.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."));case Ae.MEMBER_REQUEST_PENDING:return M.createElement(M.Fragment,null,M.createElement("p",null,"Your membership request to this private organization is pending."));case Ae.MEMBER_INVITATION_PENDING:return M.createElement(M.Fragment,null,M.createElement("p",null,"You have been invited to this private organization."));default:return M.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderOrg",value:function(){var e=M.createElement("span",null,"Private Organization"),t=M.createElement(M.Fragment,null,this.renderMessage(),M.createElement("div",null,this.renderJoinButton()));return M.createElement(St.a,{message:e,description:t,type:"info",showIcon:!0,icon:M.createElement(Mt.a,{type:"lock"}),style:{width:"50em",margin:"20px auto"},className:"ViewInaccessiblePrivateOrganization-message"})}},{key:"renderRelationClass",value:function(e){switch(e.type){case Ae.NONE:case Ae.VIEW:return"infoBox";case Ae.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case Ae.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case Ae.MEMBER:case Ae.ADMIN:case Ae.OWNER:return"infoBox"}}},{key:"renderJoinButton",value:function(){switch(this.props.relation.type){case Ae.NONE:return M.createElement(At.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization");case Ae.MEMBER_REQUEST_PENDING:return M.createElement("div",null,M.createElement("div",null,M.createElement(At.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case Ae.MEMBER_INVITATION_PENDING:return M.createElement("div",null,M.createElement(At.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation")," ",M.createElement(At.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"));default:return M.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderHeader",value:function(){var e=M.createElement("div",{style:{flex:"0 0 auto"}}),t=M.createElement(M.Fragment,null,M.createElement(At.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return M.createElement(zn,{breadcrumbs:e,buttons:t})}},{key:"render",value:function(){return M.createElement("div",{className:"ViewInaccessiblePrivateOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrg())}}]),t}(M.Component);var ts=Object(W.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==N.PRIVATE_INACCESSIBLE)throw new Error("argh, wrong org kind");return{organization:r.organization,relation:r.relation,requestOutbox:r.requestOutbox}},function(e){return{onJoinOrg:function(){e(yn())},onCancelJoinRequest:function(t){e(Mn(t))},onAcceptInvitation:function(t){e(Dn(t))},onRejectInvitation:function(t){e(Cn(t))}}})(es),rs=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).previousOrganizationId=void 0,r.previousOrganizationId=null,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"renderLoading",value:function(){var e=M.createElement("div",null,"Loading Organization..."," ",M.createElement(jr.a,null));return M.createElement(St.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return M.createElement("div",null,"Error!",M.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case h.SUCCESS:default:return null===this.props.view.viewModel?this.renderError({code:"Null Error",message:"The view model is missing, but should be available"}):this.props.view.viewModel.organization.kind===be.INACCESSIBLE_PRIVATE?M.createElement(ts,null):M.createElement($i,null)}}},{key:"componentDidUpdate",value:function(e){e.organizationId!==this.props.organizationId&&this.props.onLoad(this.props.organizationId)}},{key:"componentDidMount",value:function(){this.props.view.loadingState===h.NONE&&this.props.onLoad(this.props.organizationId)}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(M.Component);var ns=Object(W.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(In(t))},onUnload:function(){e(function(){var e=Object(le.a)(oe.a.mark(function e(t,r){var n,a,i,s,o,l,c;return oe.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,l=n.views.viewOrgView.viewModel){e.next=3;break}throw new Error("view model not defined!?!");case 3:if(c=new He({token:i,username:s,groupsServiceURL:o.services.Groups.url,userProfileServiceURL:o.services.UserProfile.url}),l.organization.relation!==Ae.MEMBER&&l.organization.relation!==Ae.ADMIN&&l.organization.relation!==Ae.OWNER){e.next=7;break}return e.next=7,c.visitOrg({organizationId:l.organization.id});case 7:t(wn()),t({type:J.VIEW_ORG_UNLOAD});case 9:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}())}}})(rs),as=(r(299),function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).tokenRef=void 0,r.tokenRef=M.createRef(),r.props.checkAuth(),r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return M.createElement("div",{className:"Auth-form"},"Token: ",M.createElement("input",{ref:this.tokenRef,style:{width:"30em"}}),M.createElement(At.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return M.createElement("div",{className:"Auth-toolbar"},"Logged in as ",M.createElement("b",null,M.createElement("span",null,this.props.authorization.authorization.realname)," (",M.createElement("span",null,this.props.authorization.authorization.username)),")"," ",M.createElement(At.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return M.createElement("div",null);case m.AUTHORIZED:return M.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case m.UNAUTHORIZED:return M.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},M.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case m.ERROR:return M.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},M.createElement("p",null,"Error"),this.props.authorization.message);default:return M.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return M.createElement("div",null);case m.AUTHORIZED:return M.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case m.UNAUTHORIZED:return M.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},M.createElement("p",null,"Not authorized!"));case m.ERROR:return M.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},M.createElement("p",null,"Error: ??"));default:return M.createElement("div",null)}}},{key:"render",value:function(){return M.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(M.Component)),is=r(96),ss="",os="api/V2/token",ls="api/V2/me",cs=function(){function e(t){var r=t.url;Object(V.a)(this,e),this.url=void 0,this.url=r}return Object(U.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([ss]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([os]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([ls]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function us(e){return{type:J.AUTH_CHECK_ERROR,error:e}}function Es(e,t,r,n){return{type:J.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function ds(){return{type:J.AUTH_UNAUTHORIZED}}function ms(){return function(e,t){e({type:J.AUTH_CHECK_START});var r=t().app.config.services.Auth.url,n=is.get("kbase_session");if(n){var a=new cs({url:r});Promise.all([a.getTokenInfo(n),a.getMe(n)]).then(function(t){var r=Object(ce.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(Es(n,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(us({code:"error",message:t.message}))})}else e(ds())}}var vs=Object(W.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(ms())},onRemoveAuthorization:function(){e(function(e,t){is.remove("kbase_session"),e(ds())})},onAddAuthorization:function(t){e(function(e){return function(t,r){var n=r().app.config.services.Auth.url;is.set("kbase_session",e);var a=new cs({url:n});Promise.all([a.getTokenInfo(e),a.getMe(e)]).then(function(r){var n=Object(ce.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(Es(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(us({code:"error",message:e.message}))})}}(t))}}})(as),ps=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(V.a)(this,e),this.name=void 0,this.onSuccess=void 0,this.onError=void 0,this.name=r,this.onSuccess=n,this.onError=a},Os=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).started=void 0,r.timeout=void 0,r.started=new Date,r.timeout=e.timeout||5e3,r}return Object(G.a)(t,e),t}(ps),hs=function(){function e(t){var r=t.name,n=t.payload,a=t.channelId;Object(V.a)(this,e),this.name=void 0,this.payload=void 0,this.id=void 0,this.created=void 0,this.channelId=void 0,this.envelope=void 0,this.name=r,this.payload=n,this.id=Ye()(),this.created=new Date,this.channelId=a,this.envelope=null}return Object(U.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channelId:this.channelId},name:this.name,payload:this.payload}}}]),e}(),Rs=function(){function e(t){if(Object(V.a)(this,e),this.window=void 0,this.host=void 0,this.id=void 0,this.awaitingResponse=void 0,this.waitingListeners=void 0,this.listeners=void 0,this.lastId=void 0,this.sentCount=void 0,this.receivedCount=void 0,this.unwelcomeReceivedCount=void 0,this.unwelcomeReceivedCountThreshhold=void 0,this.unwelcomeReceiptWarning=void 0,this.unwelcomeReceiptWarningCount=void 0,this.currentListener=void 0,this.window=t.window||window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||Ye()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(U.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("TS No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",t.envelope,t.envelope.channelId,this.id));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new ps({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new hs({name:e,payload:t,channelId:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new hs({name:e,payload:t,channelId:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,s=function(){var r=i.value,n=(l=Object(ce.a)(r,2))[0];0===l[1].filter(function(e){if(e instanceof Os){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},o=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var l;s()}}catch(c){n=!0,a=c}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new Os({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new Os({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),ws=function(){function e(){Object(V.a)(this,e),this.params=void 0,this.channel=void 0,this.params=null,this.channel=new Rs({window:window,host:document.location.origin})}return Object(U.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:Ye()(),params:{groupsServiceURL:"/services/groups",userProfileServiceURL:"/services/user_profile/rpc",workspaceServiceURL:"/services/ws",serviceWizardURL:"/services/service_wizard",authServiceURL:"/services/auth",narrativeMethodStoreURL:"/services/narrative_method_store/rpc",originalPath:"",view:null,viewParams:null},parentHost:document.location.origin}}}]),e}(),_s=function(){function e(){Object(V.a)(this,e)}return Object(U.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}},{key:"getChannelID",value:function(){return window.frameElement&&window.frameElement.hasAttribute("data-channel")?window.frameElement.getAttribute("data-channel"):null}},{key:"getIframeElement",value:function(){return window.frameElement||null}}]),e}();function gs(e){return{type:J.APP_SUCCESS,config:e}}r(300);var fs=function(e){function t(e){var r;return Object(V.a)(this,t),(r=Object(z.a)(this,Object(j.a)(t).call(this,e))).channel=void 0,r.channel=null,r}return Object(G.a)(t,e),Object(U.a)(t,[{key:"setupChannel",value:function(){this.props.channelId&&(this.channel=new Rs({channelId:this.props.channelId}),this.channel.on("navigate",function(e){e.to,e.params},function(e){console.error('Error processing "navigate" message')}),this.channel.start(),this.channel.send("ready",{channelId:this.props.channelId,greeting:"heloooo"}))}},{key:"teardownChannel",value:function(){}},{key:"componentDidMount",value:function(){this.props.onAppStart()}},{key:"componentDidUpdate",value:function(){this.setupChannel()}},{key:"componentWillUnmount",value:function(){this.teardownChannel()}},{key:"render",value:function(){return this.props.status===p.NONE?M.createElement("div",{className:"KBaseIntegration"},"Loading..."):M.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(M.Component);var As=Object(W.b)(function(e,t){var r=e.app,n=r.status,a=r.config;return{status:n,defaultPath:a.defaultPath,channelId:a.channelId}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new _s).getParamsFromIFrame();if(r){var n,a=r.channelId;switch(r.params.view){case"org":n="/viewOrganization/"+r.params.viewParams.id,window.history.pushState(null,"test",n);break;default:n="/organizations",window.history.pushState(null,"organizations","/organizations")}e(gs({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Auth:{url:r.params.authServiceURL},NarrativeMethodStore:{url:r.params.narrativeMethodStoreURL}},defaultPath:n,channelId:a}))}else e(gs({baseUrl:"",services:{Groups:{url:(r=(new ws).getParamsFromIFrame()).params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Auth:{url:r.params.authServiceURL},NarrativeMethodStore:{url:r.params.narrativeMethodStoreURL}},defaultPath:"/organizations",channelId:null}))})}}})(fs),Ss=function(){function e(){Object(V.a)(this,e)}return Object(U.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map},organizations:{byId:new Map},apps:{byId:new Map}},db:{},views:{browseOrgsView:{loadingState:h.NONE,error:null,viewModel:null},addOrgView:{loadingState:h.NONE,error:null,viewModel:null},editOrgView:{loadingState:h.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null},viewMembersView:{loadingState:h.NONE,error:null,viewModel:null},viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}},auth:{status:m.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:p.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Auth:{url:""},NarrativeMethodStore:{url:""}},defaultPath:"",channelId:null}},updateOrg:{pending:!1}}}}]),e}(),Ns=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"componentWillMount",value:function(){this.props.onLoad()}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}},{key:"render",value:function(){return this.props.children}}]),t}(M.Component);var bs=Object(W.b)(function(e,t){return{}},function(e){return{onLoad:function(){e(wn())},onUnload:function(){e({type:J.DATA_SERVICE_UNLOAD})}}})(Ns),Is=M.createContext(null),Ts=Is.Provider;Is.Consumer;gt.a.add(ft.d,ft.c,ft.b,ft.f,ft.e,ft.a);var ys=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"link",value:function(e,t,r){if(this.options.sanitize){var n;try{n=decodeURIComponent(this.options.unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return r}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return r}var a='<a href="'+e+'"';return t&&(a+=' title="'+t+'"'),a+=' target="_blank">'+r+"</a>"}}]),t}(ln.Renderer);(new ln.MarkedOptions).renderer=new ys,ln.Marked.setOptions({renderer:new ys});var Ms=!!window.frameElement,Ds=Ss.makeInitialState(),Cs=Object(q.d)(_t,Ds,Object(q.c)(Object(q.a)(H.a))),ks=function(e){return D.a.createElement(ns,{organizationId:e.match.params.id})},Vs=function(e){function t(e){return Object(V.a)(this,t),Object(z.a)(this,Object(j.a)(t).call(this,e))}return Object(G.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){return D.a.createElement(Ts,{value:{test:"ok"}},D.a.createElement(W.a,{store:Cs},D.a.createElement(As,null,D.a.createElement(vs,{hosted:Ms},D.a.createElement(bs,null,D.a.createElement(B.a,{basename:"/"},D.a.createElement("div",{className:"App scrollable-flex-column"},D.a.createElement("div",{className:"App-body scrollable-flex-column"},D.a.createElement(L.a,null,D.a.createElement(P.a,{path:"/organizations",component:Pr}),D.a.createElement(P.a,{path:"/newOrganization",component:hn}),D.a.createElement(P.a,{path:"/viewOrganization/:id",exact:!0,component:ks}),D.a.createElement(x.a,{from:"/",to:"/organizations",exact:!0}))))))))))}}]),t}(M.Component);r(301),r(302),r(303);k.a.render(D.a.createElement(Vs,null),document.getElementById("root"))}},[[160,1,2]]]);
//# sourceMappingURL=main.2d0b30c7.chunk.js.map