(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{116:function(e,t,r){e.exports=r.p+"static/media/nouserpic.9af42ba9.png"},157:function(e,t,r){e.exports=r(338)},162:function(e,t,r){},172:function(e,t,r){},174:function(e,t,r){},178:function(e,t,r){},180:function(e,t,r){},231:function(e,t,r){},242:function(e,t,r){},257:function(e,t,r){},268:function(e,t,r){},270:function(e,t,r){},272:function(e,t,r){},274:function(e,t,r){},276:function(e,t,r){},278:function(e,t,r){},280:function(e,t,r){},282:function(e,t,r){},288:function(e,t,r){},290:function(e,t,r){},292:function(e,t,r){},294:function(e,t,r){},296:function(e,t,r){},298:function(e,t,r){},300:function(e,t,r){},302:function(e,t,r){},304:function(e,t,r){},306:function(e,t,r){},308:function(e,t,r){},310:function(e,t,r){},312:function(e,t,r){},314:function(e,t,r){},316:function(e,t,r){},318:function(e,t,r){},320:function(e,t,r){},322:function(e,t,r){},324:function(e,t,r){},326:function(e,t,r){},328:function(e,t,r){},330:function(e,t,r){},338:function(e,t,r){"use strict";r.r(t);var n,a,i,o,s,l,c,u,E,d,m,v,p,O,h,R,w,g,_,f,S,A,N,b,I,T=r(0),y=r.n(T),M=r(16),C=r.n(M),D=(r(162),r(4)),V=r(5),k=r(8),U=r(6),z=r(7),j=r(345),G=r(88),L=r(341),B=r(356),P=r(15),x=r(62),W=r(147),q=r(2),H=r(69),F=r(92);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.NEW=1]="NEW",e[e.DIRTY=2]="DIRTY",e[e.CLEAN=3]="CLEAN"}(i||(i={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(o||(o={})),function(e){e[e.OK=0]="OK",e[e.ERROR=1]="ERROR",e[e.REQUIRED_MISSING=2]="REQUIRED_MISSING"}(s||(s={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(l||(l={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(c||(c={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(u||(u={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(E||(E={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(d||(d={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(v||(v={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(p||(p={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(O||(O={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(g||(g={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(_||(_={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(f||(f={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.PRIVATE_INACCESSIBLE=1]="PRIVATE_INACCESSIBLE"}(S||(S={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS",e[e.INVITE_USER=2]="INVITE_USER",e[e.MANAGE_MEMBERSHIP=3]="MANAGE_MEMBERSHIP",e[e.EDIT_ORGANIZATION=4]="EDIT_ORGANIZATION",e[e.ADD_NARRATIVE=5]="ADD_NARRATIVE"}(A||(A={})),function(e){e[e.NONE=0]="NONE",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS"}(N||(N={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.OK=2]="OK",e[e.ERROR=3]="ERROR"}(b||(b={})),function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR"}(I||(I={}));var Q,J=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,o=e.info;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,a))).code=void 0,r.message=void 0,r.detail=void 0,r.trace=void 0,r.errors=void 0,r.info=void 0,r.name="AppException",r.code=n,r.message=a,r.detail=i,r.info=o,Error.captureStackTrace&&Error.captureStackTrace(Object(H.a)(Object(H.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(z.a)(t,e),t}(Object(F.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_RELOAD=31]="VIEW_ORG_RELOAD",e[e.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS=32]="VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS",e[e.VIEW_ORG_LOAD_NORMAL_SUCCESS=33]="VIEW_ORG_LOAD_NORMAL_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST=34]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=35]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=36]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=37]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=38]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=39]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=40]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=41]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=42]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=43]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=44]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=45]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST=46]="VIEW_ORG_ACCEPT_INBOX_REQUEST",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_START=47]="VIEW_ORG_ACCEPT_INBOX_REQUEST_START",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS=48]="VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR=49]="VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_INBOX_REQUEST=50]="VIEW_ORG_REJECT_INBOX_REQUEST",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_START=51]="VIEW_ORG_REJECT_INBOX_REQUEST_START",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS=52]="VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR=53]="VIEW_ORG_REJECT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=54]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=55]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=56]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=57]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=58]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=59]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=60]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=61]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=62]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=63]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=64]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=65]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.VIEW_ORG_SORT_NARRATIVES=66]="VIEW_ORG_SORT_NARRATIVES",e[e.VIEW_ORG_SORT_NARRATIVES_START=67]="VIEW_ORG_SORT_NARRATIVES_START",e[e.VIEW_ORG_SORT_NARRATIVES_SUCCESS=68]="VIEW_ORG_SORT_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SORT_NARRATIVES_ERROR=69]="VIEW_ORG_SORT_NARRATIVES_ERROR",e[e.VIEW_ORG_SEARCH_NARRATIVES=70]="VIEW_ORG_SEARCH_NARRATIVES",e[e.VIEW_ORG_SEARCH_NARRATIVES_START=71]="VIEW_ORG_SEARCH_NARRATIVES_START",e[e.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS=72]="VIEW_ORG_SEARCH_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SEARCH_NARRATIVES_ERROR=73]="VIEW_ORG_SEARCH_NARRATIVES_ERROR",e[e.VIEW_ORG_SORT_MEMBERS=74]="VIEW_ORG_SORT_MEMBERS",e[e.VIEW_ORG_SORT_MEMBERS_START=75]="VIEW_ORG_SORT_MEMBERS_START",e[e.VIEW_ORG_SORT_MEMBERS_SUCCESS=76]="VIEW_ORG_SORT_MEMBERS_SUCCESS",e[e.VIEW_ORG_SORT_MEMBERS_ERROR=77]="VIEW_ORG_SORT_MEMBERS_ERROR",e[e.VIEW_ORG_SEARCH_MEMBERS=78]="VIEW_ORG_SEARCH_MEMBERS",e[e.VIEW_ORG_SEARCH_MEMBERS_START=79]="VIEW_ORG_SEARCH_MEMBERS_START",e[e.VIEW_ORG_SEARCH_MEMBERS_SUCCESS=80]="VIEW_ORG_SEARCH_MEMBERS_SUCCESS",e[e.VIEW_ORG_SEARCH_MEMBERS_ERROR=81]="VIEW_ORG_SEARCH_MEMBERS_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD=82]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START=83]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS=84]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR=85]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD=86]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION=87]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION=88]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START=89]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS=90]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR=91]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=92]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=93]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=94]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=95]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=96]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=97]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=98]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=99]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH=100]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START=101]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS=102]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR=103]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST=104]="VIEW_PRIVATE_ORG_JOIN_REQUEST",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_START=105]="VIEW_PRIVATE_ORG_JOIN_REQUEST_START",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS=106]="VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR=107]="VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD=108]="VIEW_ORG_VIEW_MEMBERS_LOAD",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_START=109]="VIEW_ORG_VIEW_MEMBERS_LOAD_START",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS=110]="VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR=111]="VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_UNLOAD=112]="VIEW_ORG_VIEW_MEMBERS_UNLOAD",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER=113]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START=114]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=115]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR=116]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN=117]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=118]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=119]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=120]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER=121]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=122]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=123]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=124]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.ADD_ORG_LOAD=125]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=126]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=127]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=128]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=129]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=130]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=131]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=132]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_LOGO_URL=133]="ADD_ORG_UPDATE_LOGO_URL",e[e.ADD_ORG_UPDATE_LOGO_URL_SUCCESS=134]="ADD_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.ADD_ORG_UPDATE_LOGO_URL_ERROR=135]="ADD_ORG_UPDATE_LOGO_URL_ERROR",e[e.ADD_ORG_UPDATE_ID=136]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=137]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=138]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=139]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=140]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=141]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=142]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=143]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=144]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=145]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=146]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_UPDATE_HOME_URL=147]="ADD_ORG_UPDATE_HOME_URL",e[e.ADD_ORG_UPDATE_HOME_URL_SUCCESS=148]="ADD_ORG_UPDATE_HOME_URL_SUCCESS",e[e.ADD_ORG_UPDATE_HOME_URL_ERROR=149]="ADD_ORG_UPDATE_HOME_URL_ERROR",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS=150]="ADD_ORG_UPDATE_RESEARCH_INTERESTS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=151]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=152]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.ADD_ORG_EVALUATE=153]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=154]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=155]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=156]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=157]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=158]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=159]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=160]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=161]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=162]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=163]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=164]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=165]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=166]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=167]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=168]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=169]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=170]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=171]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_LOGO_URL=172]="EDIT_ORG_UPDATE_LOGO_URL",e[e.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS=173]="EDIT_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_LOGO_URL_ERROR=174]="EDIT_ORG_UPDATE_LOGO_URL_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=175]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=176]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=177]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=178]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=179]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=180]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_UPDATE_HOME_URL=181]="EDIT_ORG_UPDATE_HOME_URL",e[e.EDIT_ORG_UPDATE_HOME_URL_SUCCESS=182]="EDIT_ORG_UPDATE_HOME_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_HOME_URL_ERROR=183]="EDIT_ORG_UPDATE_HOME_URL_ERROR",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS=184]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=185]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=186]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.EDIT_ORG_EVALUATE=187]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=188]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=189]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=190]="AUTH_CHECK",e[e.AUTH_CHECK_START=191]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=192]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=193]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=194]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=195]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=196]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=197]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=198]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=199]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=200]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=201]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=202]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=203]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=204]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=205]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=206]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=207]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=208]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=209]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=210]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=211]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=212]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=213]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=214]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=215]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=216]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=217]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=218]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=219]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=220]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=221]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=222]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=223]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=224]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=225]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=226]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=227]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=228]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=229]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=230]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=231]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=232]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=233]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=234]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=235]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=236]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=237]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=238]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=239]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=240]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=241]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=242]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=243]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=244]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=245]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=246]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=247]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=248]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=249]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=250]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=251]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=252]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=253]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=254]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=255]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=256]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.MANAGE_MEMBERSHIP_UNLOAD=257]="MANAGE_MEMBERSHIP_UNLOAD",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG=258]="MANAGE_MEMBERSHIP_LEAVE_ORG",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED=259]="MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_START=260]="MANAGE_MEMBERSHIP_LEAVE_ORG_START",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS=261]="MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR=262]="MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE=263]="MANAGE_MEMBERSHIP_UPDATE_TITLE",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_START=264]="MANAGE_MEMBERSHIP_UPDATE_TITLE_START",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS=265]="MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR=266]="MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR",e[e.MANAGE_MEMBERSHIP_SAVE=267]="MANAGE_MEMBERSHIP_SAVE",e[e.MANAGE_MEMBERSHIP_SAVE_START=268]="MANAGE_MEMBERSHIP_SAVE_START",e[e.MANAGE_MEMBERSHIP_SAVE_SUCCESS=269]="MANAGE_MEMBERSHIP_SAVE_SUCCESS",e[e.MANAGE_MEMBERSHIP_SAVE_ERROR=270]="MANAGE_MEMBERSHIP_SAVE_ERROR",e[e.MANAGE_MEMBERSHIP_EVALUATE=271]="MANAGE_MEMBERSHIP_EVALUATE",e[e.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS=272]="MANAGE_MEMBERSHIP_EVALUATE_SUCCESS",e[e.MANAGE_MEMBERSHIP_EVALUATE_ERROR=273]="MANAGE_MEMBERSHIP_EVALUATE_ERROR",e[e.REQUEST_ADD_NARRATIVE_LOAD=274]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=275]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=276]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=277]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=278]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=279]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=280]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=281]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=282]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=283]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=284]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=285]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=286]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.REQUEST_ADD_NARRATIVE_SORT=287]="REQUEST_ADD_NARRATIVE_SORT",e[e.REQUEST_ADD_NARRATIVE_SORT_START=288]="REQUEST_ADD_NARRATIVE_SORT_START",e[e.REQUEST_ADD_NARRATIVE_SORT_SUCCESS=289]="REQUEST_ADD_NARRATIVE_SORT_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SORT_ERROR=290]="REQUEST_ADD_NARRATIVE_SORT_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=291]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=292]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=293]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=294]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=295]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=296]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=297]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=298]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=299]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=300]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=301]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=302]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=303]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=304]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=305]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=306]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=307]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.ENTITY_ORGANIZATION_LOAD=308]="ENTITY_ORGANIZATION_LOAD",e[e.ENTITY_ORGANIZATION_LOAD_START=309]="ENTITY_ORGANIZATION_LOAD_START",e[e.ENTITY_ORGANIZATION_LOAD_SUCCESS=310]="ENTITY_ORGANIZATION_LOAD_SUCCESS",e[e.ENTITY_ORGANIZATION_LOAD_ERROR=311]="ENTITY_ORGANIZATION_LOAD_ERROR",e[e.DATA_SERVICE_LOAD=312]="DATA_SERVICE_LOAD",e[e.DATA_SERVICE_LOAD_START=313]="DATA_SERVICE_LOAD_START",e[e.DATA_SERVICE_LOAD_SUCCESS=314]="DATA_SERVICE_LOAD_SUCCESS",e[e.DATA_SERVICE_LOAD_ERROR=315]="DATA_SERVICE_LOAD_ERROR",e[e.DATA_SERVICE_UNLOAD=316]="DATA_SERVICE_UNLOAD",e[e.DATA_SERVICE_LOAD_REFRESH=317]="DATA_SERVICE_LOAD_REFRESH",e[e.DATA_SERVICE_LOAD_REFRESH_START=318]="DATA_SERVICE_LOAD_REFRESH_START",e[e.DATA_SERVICE_LOAD_REFRESH_SUCCESS=319]="DATA_SERVICE_LOAD_REFRESH_SUCCESS",e[e.DATA_SERVICE_LOAD_REFRESH_ERROR=320]="DATA_SERVICE_LOAD_REFRESH_ERROR"}(Q||(Q={}));var Z=function(e,t){switch(t.type){case Q.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{saveState:l.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case Q.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.UNEDITED,saveState:l.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case Q.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{saveState:l.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveError without view model"),e)}(e,t);case Q.ADD_ORG_LOAD_START:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case Q.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:o.UNEDITED,validationState:{type:s.OK,validatedAt:new Date},saveState:l.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case Q.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:{loadingState:h.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case Q.ADD_ORG_UNLOAD:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case Q.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Logo URL without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:t.error})})})})})}):(console.warn("attempting Logo URL error without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Home URL (success) without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:t.error})})})})})}):(console.warn("attempting update to home url without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Research Interests without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:t.error})})})})})}):(console.warn("attempting update to research interests (error) without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e);case Q.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:i.DIRTY})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case Q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{editState:o.EDITED,newOrganization:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:Object(q.a)({},e.views.addOrgView.viewModel.newOrganization.isPrivate,{value:t.isPrivate,syncState:i.DIRTY,validationState:{type:s.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case Q.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case Q.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{addOrgView:Object(q.a)({},e.views.addOrgView,{viewModel:Object(q.a)({},e.views.addOrgView.viewModel,{validationState:{type:s.ERROR,message:"TODO: form error",validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};function Y(){return{type:s.OK,validatedAt:new Date}}function K(e){return e.editedOrganization.name.syncState===i.DIRTY?o.EDITED:e.editedOrganization.id.syncState===i.DIRTY?o.EDITED:e.editedOrganization.logoUrl.syncState===i.DIRTY?o.EDITED:e.editedOrganization.homeUrl.syncState===i.DIRTY?o.EDITED:e.editedOrganization.researchInterests.syncState===i.DIRTY?o.EDITED:e.editedOrganization.isPrivate.syncState===i.DIRTY?o.EDITED:e.editedOrganization.description.syncState===i.DIRTY?o.EDITED:o.UNEDITED}var X=function(e,t){switch(t.type){case Q.EDIT_ORG_LOAD_START:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case Q.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{editState:o.UNEDITED,validationState:Y(),saveState:l.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case Q.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case Q.EDIT_ORG_UNLOAD:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case Q.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{saveState:l.SAVING})})})}):e}(e);case Q.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.UNEDITED,saveState:l.SAVED,editedOrganization:{id:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.id,{syncState:i.CLEAN}),name:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{syncState:i.CLEAN}),logoUrl:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{syncState:i.CLEAN}),homeUrl:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{syncState:i.CLEAN}),researchInterests:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{syncState:i.CLEAN}),isPrivate:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{syncState:i.CLEAN}),description:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{syncState:i.CLEAN})}})})})}):e}(e);case Q.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{saveState:l.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case Q.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.name!==n.name.remoteValue?i.DIRTY:i.CLEAN;var a=Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:r,validationState:Y()})})})})})}),o=K(a.views.editOrgView.viewModel);return Object(q.a)({},a,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},a.views.editOrgView,{viewModel:Object(q.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case Q.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case Q.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:Y()})})})})})}),n=K(r.views.editOrgView.viewModel);return Object(q.a)({},r,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},r.views.editOrgView,{viewModel:Object(q.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case Q.EDIT_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case Q.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:Y()})})})})})}),n=K(r.views.editOrgView.viewModel);return Object(q.a)({},r,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},r.views.editOrgView,{viewModel:Object(q.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case Q.EDIT_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case Q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:Y()})})})})})}),n=K(r.views.editOrgView.viewModel);return Object(q.a)({},r,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},r.views.editOrgView,{viewModel:Object(q.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case Q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case Q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.isPrivate!==n.isPrivate.remoteValue?i.DIRTY:i.CLEAN;var a=Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{value:t.isPrivate,syncState:r,validationState:Y()})})})})})}),s=K(a.views.editOrgView.viewModel);return Object(q.a)({},a,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},a.views.editOrgView,{viewModel:Object(q.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case Q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.description!==n.description.remoteValue?i.DIRTY:i.CLEAN;var a=Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:r,validationState:Y()})})})})})}),s=K(a.views.editOrgView.viewModel);return Object(q.a)({},a,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},a.views.editOrgView,{viewModel:Object(q.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case Q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{editState:o.EDITED,editedOrganization:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(q.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case Q.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.OK,validatedAt:new Date}})})})}):e}(e);case Q.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{editOrgView:Object(q.a)({},e.views.editOrgView,{viewModel:Object(q.a)({},e.views.editOrgView.viewModel,{validationState:{type:s.ERROR,message:"Validation errors",validatedAt:new Date}})})})}):e}(e);default:return null}};function $(e,t){switch(t.type){case Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}var ee=function(e,t){switch(t.type){case Q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==S.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(q.a)({},e,{type:c.ADMIN}):e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},r,{organization:Object(q.a)({},r.organization,{members:n})})})})})}(e,t);case Q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==S.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(q.a)({},e,{type:c.MEMBER}):e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},r,{organization:Object(q.a)({},r.organization,{members:n})})})})})}(e,t);case Q.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==S.NORMAL)return e;var n=r.organization.members.filter(function(e){return e.username!==t.memberUsername}),a=r.members.filter(function(e){return e.username!==t.memberUsername});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},r,{organization:Object(q.a)({},r.organization,{members:n}),members:a})})})})}(e,t);case Q.VIEW_ORG_SORT_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{sortMembersBy:t.sortBy,members:t.members})})})}):e}(e,t);case Q.VIEW_ORG_SEARCH_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{searchMembersBy:t.searchBy,members:t.members})})})}):e}(e,t);default:return null}};function te(e,t){switch(t.type){case Q.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}function re(e,t){switch(t.type){case Q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{requestOutbox:t.requests})})})}):e}(e,t);default:return null}}var ne,ae=r(3),ie=r.n(ae),oe=r(10),se=r(22);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(ne||(ne={}));Object(F.a)(Error);var le,ce,ue,Ee=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).originalError=void 0,r.name="GroupException",r.originalError=e,r}return Object(z.a)(t,e),t}(J),de=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(z.a)(t,e),t}(J),me=function(){function e(t){var r=t.token,n=t.url;Object(D.a)(this,e),this.token=void 0,this.url=void 0,this.token=r,this.url=n}return Object(V.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"listGroups",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGroups",value:function(){var e=this;return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200===e.status)return e.json().then(function(e){return e});if(204===e.status){return null}throw new Error("Unexpected response: "+e.status+" : "+e.statusText)}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new Ee(e)});case"text/plain":return e.text().then(function(e){throw new de(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a,i,o;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new Ee(i);case 12:return e.next=14,a.text();case 14:throw o=e.sent,new de(o);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new Ee(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new de(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{logourl:e.logoUrl,researchinterests:e.researchInterests,homeurl:e.homeUrl}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{logourl:t.logoUrl,homeurl:t.homeUrl,researchinterests:t.researchInterests},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"addRelatedGroup",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a,i;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,!(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i={custom:{relatedgroups:a.join(",")}},e.next=10,this.put(["group",t,"update"],i);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRelatedGroup",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a,i,o;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i=a.filter(function(e){return e!==r}),o={custom:{relatedgroups:i.join(",")}},e.next=11,this.put(["group",t,"update"],o);case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getRequest",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===ne.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===ne.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===ne.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r,n){var a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"updateMember",value:function(e){var t=e.groupId,r=e.memberUsername,n=e.update,a=["group",t,"user",r,"update"];return this.put(a,{custom:n})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}},{key:"visitGroup",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupId,n=["group",r,"visit"],e.abrupt("return",this.put(n,null));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequests",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i,o,s,l,c,u,E;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupIds,n=["request","groups",r.join(","),"new"],e.next=4,this.get(n);case 4:for(a=e.sent,i=new Map,o=Object.entries(a),s=0;s<o.length;s++)l=o[s],c=Object(se.a)(l,2),u=c[0],E=c[1],i.set(u,E);return e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function ve(e){var t=function(e){switch(e){case"Invite":return le.INVITATION;case"Request":return le.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return ce.USER;case"workspace":return ce.WORKSPACE;case"catalogmethod":return ce.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,ue.OPEN);switch(r){case ce.USER:return le.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ce.WORKSPACE:return le.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ce.APP:return le.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(le||(le={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(ce||(ce={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(ue||(ue={}));var pe,Oe,he,Re,we,ge=function(){function e(t){Object(D.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.cache=void 0,this.params=t,this.groupsClient=new me({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(V.a)(e,[{key:"getRequest",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=ve(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOutboundRequests",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){var t,r,n,a=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ve(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ve(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCombinedRequestInboxForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getGroupRequests(t,{includeClosed:!1,sortDirection:ne.DESCENDING});case 4:e.t0=function(e){return ve(e)},n=e.sent.map(e.t0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(1),n=[];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){var t,r,n,a=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ve(e)}).filter(function(e){return e.type===le.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboundRequests",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){var t,r,n,a=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ve(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:ne.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ve(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:ne.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:ne.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return ve(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return ve(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),_e=function(){function e(){Object(D.a)(this,e)}return Object(V.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:s.REQUIRED_MISSING,message:"Organization id may not be empty",validatedAt:new Date}];if(e.match(/\s/))return[e,{type:s.ERROR,message:"Organization id may not contain a space",validatedAt:new Date}];if(e.length>100)return[e,{type:s.ERROR,message:"Organization id may not be longer than 100 characters",validatedAt:new Date}];return e.match(/^[a-z0-9-]+$/)?[e,{type:s.OK,validatedAt:new Date}]:[e,{type:s.ERROR,message:'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash "-"',validatedAt:new Date}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:s.REQUIRED_MISSING,message:"Organization name may not be empty",validatedAt:new Date}]:e.length>256?[e,{type:s.ERROR,message:"Organization name may not be longer than 256 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgLogoUrl",value:function(e){if(null===e||""===e)return[e,{type:s.OK,validatedAt:new Date}];if(e.length>1e3)return[e,{type:s.ERROR,message:"Logo url may not be longer than 1000 characters",validatedAt:new Date}];try{var t=new URL(e);if(!t.protocol.match(/^http[s]?:$/))return[e,{type:s.ERROR,message:"Error parsing url: "+t.protocol+" is not a valid protocol",validatedAt:new Date}];if(!t.protocol.match(/^https:$/))return[e,{type:s.ERROR,message:"Only https (secure) urls are supported",validatedAt:new Date}]}catch(r){return[e,{type:s.ERROR,message:"Error parsing url: "+r.message,validatedAt:new Date}]}return[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgHomeUrl",value:function(e){if(null===e||""===e)return[e,{type:s.OK,validatedAt:new Date}];if(e.length>1e3)return[e,{type:s.ERROR,message:"Home url may not be longer than 1000 characters",validatedAt:new Date}];try{var t=new URL(e);if(!t.protocol.match(/^http[s]?:$/))return[e,{type:s.ERROR,message:"Error parsing url: "+t.protocol+" is not a valid protocol",validatedAt:new Date}];if(!t.protocol.match(/^https:$/))return[e,{type:s.ERROR,message:"Only https (secure) urls are supported",validatedAt:new Date}]}catch(r){return[e,{type:s.ERROR,message:"Error parsing url: "+r.message,validatedAt:new Date}]}return[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgResearchInterests",value:function(e){return 0===e.length?[name,{type:s.REQUIRED_MISSING,message:"Research Interests may not be empty",validatedAt:new Date}]:e.length>280?[e,{type:s.ERROR,message:"Research Interests may not be longer than 280 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:s.ERROR,message:"Organization description may not be empty",validatedAt:new Date}]:e.length>4096?[e,{type:s.ERROR,message:"Organization description may not be longer than 4,096 characters",validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}},{key:"validateMemberTitle",value:function(e){return e.length>100?[e,{type:s.ERROR,message:"member title may not be longer than ".concat(100," characters"),validatedAt:new Date}]:[e,{type:s.OK,validatedAt:new Date}]}}]),e}();function fe(e,t,r,n){if(e.kind===Re.INACCESSIBLE_PRIVATE)return r&&r.user===t?{type:pe.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:pe.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:pe.NONE};if(t===e.owner.username)return{type:pe.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:pe.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:pe.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:pe.NONE};switch(a.type){case Oe.MEMBER:return{type:pe.MEMBER};case Oe.ADMIN:return{type:pe.ADMIN};case Oe.OWNER:return{type:pe.OWNER};default:return{type:pe.NONE}}}function Se(e){switch(e){case"None":return he.NONE;case"Read":return he.VIEW;case"Write":return he.EDIT;case"Admin":return he.ADMIN;case"Own":return he.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}function Ae(e,t){var r={username:e.owner.name,joinedAt:new Date(e.owner.joined),lastVisitedAt:e.owner.lastvisit?new Date(e.owner.lastvisit):null,type:Oe.OWNER,title:e.owner.custom.title},n=[].concat(e.admins.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:Oe.ADMIN,title:e.custom.title}})).concat(e.members.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:Oe.MEMBER,title:e.custom.title}})),a=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:Se(e.perm),createdAt:new Date(e.narrcreate),updatedAt:new Date(e.moddate),description:e.description,addedAt:null===e.added?null:new Date(e.added)}});return{kind:Re.NORMAL,id:e.id,name:e.name,isPrivate:e.private,isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,relation:Me(e.role),logoUrl:e.custom.logourl||null,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||"",description:e.custom.description,owner:r,areMembersPrivate:e.privatemembers,members:n,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,narratives:a,apps:[],memberCount:e.memcount,narrativeCount:e.rescount.workspace||0,appCount:e.rescount.catalogmethod||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}function Ne(e,t){return{kind:Re.INACCESSIBLE_PRIVATE,id:e.id,isPrivate:e.private,relation:Me(e.role)}}function be(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.researchInterests||"")||t.test(e.owner.username)})})}function Ie(e){var t=e.getTime();return Math.round(t/864e5)}function Te(e,t,r,n){switch(e){case"created":return t*(Ie(r.createdAt)-Ie(n.createdAt));case"modified":case"changed":return t*(Ie(r.modifiedAt)-Ie(n.modifiedAt));case"name":return t*r.name.localeCompare(n.name);case"owner":return t*r.owner.username.localeCompare(n.owner.username);case"narrativeCount":return t*(r.narrativeCount-n.narrativeCount);case"memberCount":return t*(r.memberCount-n.memberCount);default:return console.warn("unimplemented sort field: "+e),0}}function ye(e,t,r){var n=r===O.ASCENDING?1:-1;return e.slice().sort(function(e,r){return Te(t,n,e,r)||Te("name",1,e,r)})}function Me(e){switch(e){case"None":return pe.NONE;case"Member":return pe.MEMBER;case"Admin":return pe.ADMIN;case"Owner":return pe.OWNER;default:throw new Error("Unknown role: "+e)}}function Ce(e,t,r){var n=t.roleType,a=t.roles,i=t.privacy;return e.filter(function(e){return function(e){switch(n){case"myorgs":return[pe.MEMBER,pe.ADMIN,pe.OWNER].includes(e.relation);case"notmyorgs":return![pe.MEMBER,pe.ADMIN,pe.OWNER].includes(e.relation);case"all":default:return!0}}(e)&&function(e){return 0===a.length||a.some(function(t){switch(t){case"member":return e.relation===pe.MEMBER;case"admin":return e.relation===pe.ADMIN;case"owner":return e.relation===pe.OWNER;default:return!1}})}(e)&&function(e){switch(i){case"public":return!e.isPrivate;case"private":return e.isPrivate;case"any":return!0;default:return!1}}(e)})}function De(e){switch(e){case"name":return function(e,t){return e.title.localeCompare(t.title)};case"updated":return function(e,t){return t.updatedAt.getTime()-e.updatedAt.getTime()};default:case"added":return function(e,t){return null===e.addedAt?null===t.addedAt?0:1:null===t.addedAt?-1:t.addedAt.getTime()-e.addedAt.getTime()}}}function Ve(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=De(t)(e,r);return 0===n&&"name"!==t?De("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.title)})})}(e,t.searchBy),t.sortBy)}function ke(e){switch(e){case"name":return function(e,t){return e.username.localeCompare(t.username)};default:case"added":return function(e,t){return t.joinedAt.getTime()-e.joinedAt.getTime()}}}function Ue(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=ke(t)(e,r);return 0===n&&"name"!==t?ke("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.username)||t.test(e.title||"")})})}(e,t.searchBy),t.sortBy)}_e.nonPrintableRe=/[\000-\031]/,function(e){e.NONE="NONE",e.VIEW="VIEW",e.MEMBER_REQUEST_PENDING="MEMBER_REQUEST_PENDING",e.MEMBER_INVITATION_PENDING="MEMBER_INVITATION_PENDING",e.MEMBER="MEMBER",e.ADMIN="ADMIN",e.OWNER="OWNER"}(pe||(pe={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(Oe||(Oe={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(he||(he={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.INACCESSIBLE_PRIVATE=1]="INACCESSIBLE_PRIVATE"}(Re||(Re={})),function(e){e.INAPPLICABLE="INAPPLICABLE",e.NONE="NONE",e.OLD="OLD",e.NEW="NEW"}(we||(we={}));var ze=function(){function e(t){Object(D.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.params=t,this.groupsClient=new me({url:this.params.groupsServiceURL,token:this.params.token})}return Object(V.a)(e,[{key:"getOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){return"None"===e.role&&e.private?Ne(e,r.params.username):Ae(e,r.params.username)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganization",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroupById(t);case 2:if("None"!==(r=e.sent).role||!r.private){e.next=5;break}throw new Error("Inaccessible Organization");case 5:return e.abrupt("return",Ae(r,this.params.username));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllOrgs",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){var t,r;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroups();case 2:return t=e.sent,r=t.map(function(e){return e.id}),e.abrupt("return",this.getOrgs(r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){var t,r;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return t=e.sent,r=t.filter(function(e){return e.relation!==pe.NONE}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listGroupToBriefOrganization",value:function(e){return{id:e.id,name:e.name,logoUrl:e.custom.logourl||null,isPrivate:e.private,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||null,owner:{username:e.owner,lastVisitedAt:null,type:Oe.OWNER,joinedAt:new Date(e.createdate),title:"Owner"},relation:Me(e.role),isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,memberCount:e.memcount||0,narrativeCount:e.rescount.workspace||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}},{key:"getAllOrgs2",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){var t,r=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.listGroups();case 2:return t=e.sent,e.abrupt("return",t.map(function(e){return r.listGroupToBriefOrganization(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=Ce(r,t.filter,t.username),a=be(n,t.searchTerms),i=ye(a,t.sortField,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=r.filter(function(e){return e.relation!==pe.NONE}),e.abrupt("return",{organizations:n,total:n.length});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",ve(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new me({url:this.params.groupsServiceURL,token:this.params.token}),t.id.validationState.type===s.OK&&t.name.validationState.type===s.OK&&t.logoUrl.validationState.type===s.OK&&t.description.validationState.type===s.OK&&t.isPrivate.validationState.type===s.OK){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.abrupt("return",n.createGroup({id:t.id.value,name:t.name.value,logoUrl:t.logoUrl.value,homeUrl:t.homeUrl.value,researchInterests:t.researchInterests.value,description:t.description.value,isPrivate:t.isPrivate.value}).then(function(e){return Ae(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,logoUrl:r.logoUrl,homeUrl:r.homeUrl,researchInterests:r.researchInterests,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return _e.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return _e.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return _e.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembership",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",ve(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.memberToAdmin({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"adminToMember",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.adminToMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.removeMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateMember",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r,n){var a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",a.updateMember({groupId:t,memberUsername:r,update:n}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"visitOrg",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.visitGroup({groupId:r}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestsStatus",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i,o,s,l,c,u,E,d,m,v,p;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationIds,n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:r});case 4:for(a=e.sent,i=new Map,o=!0,s=!1,l=void 0,e.prev=9,c=a.entries()[Symbol.iterator]();!(o=(u=c.next()).done);o=!0)E=u.value,d=Object(se.a)(E,2),m=d[0],v=d[1],p=je(v),i.set(m,p);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),s=!0,l=e.t0;case 17:e.prev=17,e.prev=18,o||null==c.return||c.return();case 20:if(e.prev=20,!s){e.next=23;break}throw l;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestStatus",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i,o,s,l,c,u,E,d;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:[r]});case 4:a=e.sent,i=!0,o=!1,s=void 0,e.prev=8,l=a.entries()[Symbol.iterator]();case 10:if(i=(c=l.next()).done){e.next=19;break}return u=c.value,E=Object(se.a)(u,2),E[0],d=E[1],e.abrupt("return",je(d));case 16:i=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),o=!0,s=e.t0;case 25:e.prev=25,e.prev=26,i||null==l.return||l.return();case 28:if(e.prev=28,!o){e.next=31;break}throw s;case 31:return e.finish(28);case 32:return e.finish(25);case 33:throw new Error("expected request status, got none");case 34:case"end":return e.stop()}},e,this,[[8,21,25,33],[26,,28,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addRelatedOrganization",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.addRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeRelatedOrganization",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new me({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.removeRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function je(e){switch(e.new){case"None":return we.NONE;case"Old":return we.OLD;case"New":return we.NEW;default:throw new Error("Invalid open request status: "+e)}}var Ge=r(42),Le=r.n(Ge);function Be(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,o=e.info;return{code:t,message:r,detail:n,id:Le()(),at:new Date,history:a,trace:i,info:o}}function Pe(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return e.filter(function(e){var t=e.organization;return r.every(function(e){return e.test(t.name)||e.test(t.owner.username)})})}function xe(e,t){switch(t.type){case Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:{state:b.OK,error:null,viewModel:{kind:N.MANAGE_RELATED_ORGS,relatedOrganizations:e.views.viewOrgView.viewModel.organization.relatedOrganizations,organization:e.views.viewOrgView.viewModel.organization,availableOrganizations:{organizations:t.organizations,queried:t.organizations,searchBy:""},selectedOrganization:null}}})})})})}):e}(e,t);case Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:{state:b.NONE,error:null,viewModel:null}})})})})}):e}(e);case Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,n=r.organizations.map(function(e){return e.organization.id===t.selectedOrganization.organization.id?e.isSelected=!0:e.isSelected=!1,e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{selectedOrganization:t.selectedOrganization,availableOrganizations:{organizations:n,queried:Pe(n,r.searchBy),searchBy:r.searchBy}})})})})})})})}(e,t);case Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,n=e.views.viewOrgView.viewModel.organization.relatedOrganizations.concat([t.organizationId]),a=r.organizations.map(function(e){return n.includes(e.organization.id)?e.isRelated=!0:e.isRelated=!1,e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{organization:Object(q.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:n}),subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:{organizations:a,queried:Pe(a,r.searchBy),searchBy:r.searchBy}})})})})})})})}(e,t);case Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId}),n=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,a=n.organizations.filter(function(e){return e.organization.id===t.organizationId&&(e.isRelated=!1),e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{organization:Object(q.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r}),subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:{organizations:a,queried:Pe(a,n.searchBy),searchBy:n.searchBy}})})})})})})})}(e,t);case Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:Object(q.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,{queried:t.organizations,searchBy:t.searchBy})})})})})})})}):e}(e,t);default:return null}}function We(e,t){switch(t.type){case Q.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{organization:Object(q.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r})})})})})}(e,t);default:return null}}var qe=function(e,t){switch(t.type){case Q.VIEW_ORG_LOAD_START:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case Q.VIEW_ORG_LOAD_NORMAL_SUCCESS:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{kind:S.NORMAL,organization:t.organization,relation:t.relation,openRequest:t.openRequest,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,sortNarrativesBy:t.narrativesSortBy,searchNarrativesBy:"",narratives:t.narratives,sortMembersBy:t.sortMembersBy,members:t.members,searchMembersBy:"",subViews:{manageRelatedOrganizationsView:{state:b.NONE,viewModel:null,error:null},inviteUserView:{state:b.NONE,viewModel:null,error:null},requestNarrativeView:{state:b.NONE,viewModel:null,error:null}}}}})})}(e,t);case Q.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:{loadingState:h.SUCCESS,error:null,viewModel:{kind:S.PRIVATE_INACCESSIBLE,organization:t.organization,relation:t.relation,requestOutbox:t.requestOutbox}}})})}(e,t);case Q.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case Q.VIEW_ORG_UNLOAD:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case Q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrativeId}),n=e.views.viewOrgView.viewModel.narratives.filter(function(e){return e.workspaceId!==t.narrativeId});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{organization:Object(q.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r}),narratives:n})})})})}(e,t);case Q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{organization:t.organization,narratives:t.narratives})})})}):e}(e,t);case Q.VIEW_ORG_SORT_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{sortNarrativesBy:t.sortBy,narratives:t.narratives})})})}):e}(e,t);case Q.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==S.NORMAL?e:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{searchNarrativesBy:t.searchBy,narratives:t.narratives})})})}):e}(e,t)}return $(e,t)||te(e,t)||re(e,t)||ee(e,t)||xe(e,t)||We(e,t)||We(e,t)};function He(e,t){switch(t.type){case Q.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.openRequests,o=r.searchTerms,s=r.sortField,l=r.sortDirection,c=r.filter,u=r.totalCount,E=r.filteredCount,d=r.selectedOrganizationId,m=r.error,v=r.searching;return Object(q.a)({},e,{loadingState:h.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,openRequests:i,searchTerms:o,sortField:s,sortDirection:l,filter:c,totalCount:u,filteredCount:E,selectedOrganizationId:d,error:m,searching:v}})}(e,t);case Q.BROWSE_ORGS_SEARCH:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})}(e,t);case Q.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{searching:!0})})}(e);case Q.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{organizations:t.organizations,openRequests:t.openRequests,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})}(e,t);case Q.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{searching:!1,error:t.error})})}(e,t);case Q.BROWSE_ORGS_SORT_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{sortField:t.sortField,sortDirection:t.sortDirection,searching:!0})})}(e,t);case Q.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{filter:r,searching:!0})})}(e,t);case Q.BROWSE_ORGS_UNLOAD:return{loadingState:h.NONE,error:null,viewModel:null};default:return null}}var Fe=function(e,t){switch(t.type){case Q.AUTH_CHECK_START:return function(e,t){return Object(q.a)({},e,{auth:{status:m.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case Q.AUTH_AUTHORIZED:return function(e,t){return Object(q.a)({},e,{auth:{status:m.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case Q.AUTH_UNAUTHORIZED:return function(e,t){return Object(q.a)({},e,{auth:{status:m.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case Q.AUTH_CHECK_ERROR:return function(e,t){return Object(q.a)({},e,{auth:{status:m.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var Qe=function(e,t){switch(t.type){case Q.APP_SUCCESS:return function(e,t){return Object(q.a)({},e,{app:{status:p.READY,config:t.config}})}(e,t);default:return null}};var Je=function(e,t){switch(t.type){case Q.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case Q.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case Q.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case Q.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case Q.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageOrganizationRequestsView:Object(q.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(q.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var Ze=function(e,t){switch(t.type){case Q.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewMembersView:Object(q.a)({},e.views.viewMembersView,{loadingState:h.LOADING,viewModel:null,error:null})})})}(e);case Q.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewMembersView:Object(q.a)({},e.views.viewMembersView,{loadingState:h.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case Q.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewMembersView:Object(q.a)({},e.views.viewMembersView,{loadingState:h.ERROR,viewModel:null,error:t.error})})})}(e,t);case Q.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewMembersView:Object(q.a)({},e.views.viewMembersView,{loadingState:h.NONE,viewModel:null,error:null})})})}(e);case Q.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=c.ADMIN,e):e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewMembersView:Object(q.a)({},e.views.viewMembersView,{viewModel:Object(q.a)({},e.views.viewMembersView.viewModel,{organization:Object(q.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case Q.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=c.MEMBER,e):e});return Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewMembersView:Object(q.a)({},e.views.viewMembersView,{viewModel:Object(q.a)({},e.views.viewMembersView.viewModel,{organization:Object(q.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}};function Ye(e,t){switch(t.type){case Q.INVITE_USER_LOAD_START:return{state:b.LOADING,viewModel:null,error:null};case Q.INVITE_USER_LOAD_SUCCESS:return function(e,t){return{state:b.OK,error:null,viewModel:{editState:w.EDITING,users:t.users,organization:t.organization,selectedUser:null}}}(0,t);case Q.INVITE_USER_LOAD_ERROR:return function(e,t){return{state:b.ERROR,error:t.error,viewModel:null}}(0,t);case Q.INVITE_USER_UNLOAD:return{state:b.NONE,error:null,viewModel:null};case Q.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{users:t.users})})}(e,t);case Q.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})}(e,t);case Q.INVITE_USER_SEND_INVITATION_START:return function(e,t){return null===e.viewModel?e:Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{editState:w.SENDING})})}(e);case Q.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=e.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=pe.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=pe.MEMBER_INVITATION_PENDING),e});return Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{editState:w.SUCCESS,selectedUser:n,users:i})})}(e);case Q.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){return null===e.viewModel?e:Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{editState:w.ERROR})})}(e);default:return null}}var Ke=function(e,t){if(!function(e){switch(e.type){case Q.INVITE_USER_LOAD_START:case Q.INVITE_USER_LOAD_SUCCESS:case Q.INVITE_USER_LOAD_ERROR:case Q.INVITE_USER_UNLOAD:case Q.INVITE_USER_SEARCH_USERS_SUCCESS:case Q.INVITE_USER_SELECT_USER_SUCCESS:case Q.INVITE_USER_SEND_INVITATION_START:case Q.INVITE_USER_SEND_INVITATION_SUCCESS:case Q.INVITE_USER_SEND_INVITATION_ERROR:return!0;default:return!1}}(t))return null;if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;var r=Ye(e.views.viewOrgView.viewModel.subViews.inviteUserView,t);return null===r?null:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{inviteUserView:r})})})})})};function Xe(){return{type:s.OK,validatedAt:new Date}}function $e(e){return e.editableMemberProfile.title.syncState===i.DIRTY?o.EDITED:o.UNEDITED}var et=function(e,t){switch(t.type){case Q.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:{loadingState:h.LOADING,error:null,viewModel:null}})})}(e);case Q.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:{loadingState:h.SUCCESS,error:null,viewModel:{organization:t.organization,editableMemberProfile:t.editableMemberProfile,editState:o.UNEDITED,saveState:l.NEW,validationState:Xe()}}})})}(e,t);case Q.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:{loadingState:h.ERROR,error:t.error,viewModel:null}})})}(e,t);case Q.MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:{loadingState:h.NONE,error:null,viewModel:null}})})}(e);case Q.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r,n=e.views.manageMembershipView.viewModel.editableMemberProfile;r=t.title!==n.title.remoteValue?i.DIRTY:i.CLEAN;var a=Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:Object(q.a)({},e.views.manageMembershipView,{viewModel:Object(q.a)({},e.views.manageMembershipView.viewModel,{editableMemberProfile:Object(q.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile,{title:{value:t.title,remoteValue:t.title,syncState:r,validationState:Xe()}})})})})}),o=$e(a.views.manageMembershipView.viewModel);return Object(q.a)({},a,{views:Object(q.a)({},e.views,{manageMembershipView:Object(q.a)({},a.views.manageMembershipView,{viewModel:Object(q.a)({},a.views.manageMembershipView.viewModel,{editState:o})})})})}(e,t);case Q.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r=$e(e.views.manageMembershipView.viewModel);return Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:Object(q.a)({},e.views.manageMembershipView,{viewModel:Object(q.a)({},e.views.manageMembershipView.viewModel,{editState:r,validationState:{type:s.OK,validatedAt:new Date}})})})})}(e);case Q.MANAGE_MEMBERSHIP_EVALUATE_ERROR:return function(e,t){return e.views.manageMembershipView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:Object(q.a)({},e.views.manageMembershipView,{viewModel:Object(q.a)({},e.views.manageMembershipView.viewModel,{validationState:{type:s.ERROR,message:"Validation error(s)",validatedAt:new Date}})})})}):e}(e);case Q.MANAGE_MEMBERSHIP_SAVE_SUCCESS:return function(e,t){return e.views.manageMembershipView.viewModel?Object(q.a)({},e,{views:Object(q.a)({},e.views,{manageMembershipView:Object(q.a)({},e.views.manageMembershipView,{viewModel:Object(q.a)({},e.views.manageMembershipView.viewModel,{editState:o.UNEDITED,saveState:l.SAVED,editableMemberProfile:{title:Object(q.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile.title,{syncState:i.CLEAN})}})})})}):e}(e);default:return null}};function tt(e,t){return null===e.viewModel?e:Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{saveState:l.SAVING})})}function rt(e,t){switch(t.type){case Q.REQUEST_ADD_NARRATIVE_LOAD_START:return{state:b.LOADING,error:null,viewModel:null};case Q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return{state:b.OK,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,saveState:l.SAVED}}}(0,t);case Q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return{state:b.ERROR,error:t.error,viewModel:null}}(0,t);case Q.REQUEST_ADD_NARRATIVE_SEND_START:return tt(e);case Q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{saveState:l.SAVED})}),n=r.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=g.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=g.REQUESTED),e}),r}(e,t);case Q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return tt(e);case Q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(q.a)({},e,{error:null,viewModel:Object(q.a)({},e.viewModel,{selectedNarrative:t.narrative})})}(e,t);case Q.REQUEST_ADD_NARRATIVE_UNLOAD:return{state:b.NONE,error:null,viewModel:null};case Q.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(q.a)({},e,{viewModel:Object(q.a)({},e.viewModel,{narratives:t.narratives})})}(e,t);default:return null}}function nt(e,t){if(!function(e){switch(e.type){case Q.REQUEST_ADD_NARRATIVE_LOAD_START:case Q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:case Q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:case Q.REQUEST_ADD_NARRATIVE_SEND_START:case Q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:case Q.REQUEST_ADD_NARRATIVE_LOAD_ERROR:case Q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:case Q.REQUEST_ADD_NARRATIVE_UNLOAD:case Q.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:return!0;default:return!1}}(t))return null;if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==S.NORMAL)return e;var r=rt(e.views.viewOrgView.viewModel.subViews.requestNarrativeView,t);return null===r?null:Object(q.a)({},e,{views:Object(q.a)({},e.views,{viewOrgView:Object(q.a)({},e.views.viewOrgView,{viewModel:Object(q.a)({},e.views.viewOrgView.viewModel,{subViews:Object(q.a)({},e.views.viewOrgView.viewModel.subViews,{requestNarrativeView:r})})})})})}function at(e,t){switch(t.type){case Q.ENTITY_ORGANIZATION_LOAD_SUCCESS:return function(e,t){var r=new Map(e.entities.organizations.byId);return r.set(t.organization.id,t.organization),Object(q.a)({},e,{entities:Object(q.a)({},e.entities,{organizations:Object(q.a)({},e.entities.organizations.byId,{byId:r})})})}(e,t);default:return null}}function it(e,t){switch(t.type){case Q.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(q.a)({},e,{entities:Object(q.a)({},e.entities,{users:Object(q.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case Q.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(q.a)({},e,{entities:Object(q.a)({},e.entities,{orgs:Object(q.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case Q.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(q.a)({},e,{entities:Object(q.a)({},e.entities,{narratives:Object(q.a)({},e.entities.narratives,{byId:new Map(r.byId)})})})}(e,t)}return at(e,t)}function ot(e,t){switch(t.type){case Q.DATA_SERVICE_LOAD_SUCCESS:return function(e,t){return Object(q.a)({},e,{db:Object(q.a)({},e.db)})}(e);default:return null}}var st,lt=function(e,t){return Z(e,t)||X(e,t)||function(e,t){var r=He(e.views.browseOrgsView,t);return r?Object(q.a)({},e,{views:Object(q.a)({},e.views,{browseOrgsView:r})}):null}(e,t)||qe(e,t)||Fe(e,t)||Qe(e,t)||Je(e,t)||Ze(e,t)||Ke(e,t)||et(e,t)||nt(e,t)||it(e,t)||ot(e,t)||e},ct=(r(172),r(148)),ut=r(73),Et=(r(174),r(358)),dt=r(359),mt=r(59),vt=r.n(mt),pt=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLogoUrl",value:function(){return this.props.logoUrl?T.createElement("img",{src:this.props.logoUrl,width:this.props.size}):T.createElement("span",null,"n/a")}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultInitial",value:function(){var e=this.charAt(this.props.organizationName,0).toUpperCase(),t=vt()(this.props.organizationId).substr(0,6);return T.createElement("svg",{width:this.props.size,height:this.props.size,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},T.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:this.props.size-12,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogo",value:function(){return this.props.logoUrl?this.renderLogoUrl():this.renderDefaultInitial()}},{key:"render",value:function(){return this.renderLogo()}}]),t}(T.Component),Ot=r(340),ht=r(20),Rt=r(349),wt=r(355),gt=r(351),_t=(r(178),r(180),r(116)),ft=r.n(_t),St=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:ft.a;case"silhouette":case"mysteryman":default:return ft.a}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return T.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(T.Component);function At(e){switch(e){case st.COMPACT:return st.NORMAL;case st.NORMAL:return st.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(st||(st={}));var Nt=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={view:st.COMPACT},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onToggleView",value:function(){this.setState({view:At(this.state.view)})}},{key:"renderRole",value:function(){return T.createElement("span",null,T.createElement(ht.a,{type:"crown"})," owner")}},{key:"renderAvatar",value:function(){if(this.props.showAvatar)return T.createElement("div",{className:"Owner-avatarCol"},T.createElement(St,{user:this.props.user,size:this.props.avatarSize||30}))}},{key:"renderCompact",value:function(){var e=T.createElement("div",null,T.createElement("div",null,this.props.user.realname),T.createElement("div",null,T.createElement("span",null,T.createElement(St,{user:this.props.user,size:20}))," ",T.createElement("span",null,this.props.user.username)));return T.createElement("div",{className:"Owner-owner"},this.renderAvatar(),T.createElement("div",{className:"Owner-infoCol"},T.createElement("div",{className:"Owner-name"},T.createElement(Ot.a,{placement:"bottomRight",title:e},T.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))))}},{key:"renderNormal",value:function(){return T.createElement("div",{className:"Owner View-NORMAL"},T.createElement("div",{className:"Owner-controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===st.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===st.NORMAL?"up":"down")}))),T.createElement("div",{className:"Owner-avatarCol"},T.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),T.createElement("div",{className:"Owner-infoCol"},T.createElement("div",{className:"Owner-name"},T.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),T.createElement("div",{className:"Owner-username"},this.props.user.username),T.createElement("div",{className:"Owner-title"},this.props.user.title||T.createElement("i",null,"no title in user profile")),T.createElement("div",{className:"Owner-organization"},this.props.user.organization||T.createElement("i",null,"no organization in user profile")),T.createElement("div",{className:"Owner-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||T.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){return this.renderCompact()}}]),t}(T.Component),bt=function(){function e(t){var r=t.url,n=t.token;Object(D.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n||null}return Object(V.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}();bt.module=void 0;var It=function(e){function t(e){var r;if(Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(bt),Tt=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var e=Object(oe.a)(ie.a.mark(function e(r){return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.profileCache.has(r)){e.next=2;break}return e.abrupt("return",Promise.resolve(t.profileCache.get(r)));case 2:return e.abrupt("return",this.callFunc("get_user_profile",[r]).then(function(e){return e.result[0][0]}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateUserProfile",value:function(){var e=Object(oe.a)(ie.a.mark(function e(r){return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.profileCache.delete(r.user.username),e.abrupt("return",this.callFunc("update_user_profile",{profile:r}).then(function(){}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("get_user_profile",t).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllUsers",value:function(){var e=Object(oe.a)(ie.a.mark(function e(){return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:""}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:t}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(It);function yt(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}Tt.module="UserProfile",Tt.profileCache=new Map;var Mt=function(){function e(t){Object(D.a)(this,e),this.params=void 0,this.userProfileClient=void 0,this.cache=void 0,this.params=t,this.userProfileClient=new Tt({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(V.a)(e,[{key:"getUser",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=yt(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return yt(e)}),a.forEach(function(e){var t=yt(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ct=function(e){function t(e){var r;if(Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"callFunc",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(D.a)(this,e),this.url=void 0,this.token=void 0,this.module=void 0,this.url=r,this.token=n||null,this.module=a}return Object(V.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i,o,s;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=13;break}return e.next=3,t.json();case 3:if(r=e.sent,n=r.result,a=r.error,!n){e.next=10;break}return e.abrupt("return",[n,null]);case 10:return e.abrupt("return",[null,a]);case 11:e.next=15;break;case 13:if(204!==t.status){e.next=15;break}return e.abrupt("return",[null,null]);case 15:if(500!==t.status){e.next=28;break}if("application/json"!==t.headers.get("Content-Type")){e.next=24;break}return e.next=19,t.json();case 19:return i=e.sent,o=i.error,e.abrupt("return",[null,o]);case 24:return e.next=26,t.text();case 26:return s=e.sent,e.abrupt("return",[null,{code:0,name:"Internal Server Error (for real)",message:"The service experienced an internal error",error:s}]);case 28:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n=this;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){return n.processResponse(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),Dt=r(74),Vt=r.n(Dt),kt=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(It);kt.module="ServiceWizard";var Ut=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(D.a)(this,e),this.cache=void 0,this.cacheLifetime=void 0,this.monitoringFrequency=void 0,this.waiterTimeout=void 0,this.waiterFrequency=void 0,this.isMonitoring=void 0,this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(V.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new Vt.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var o=(new Date).getTime()-a;o>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+o))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):Vt.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),zt=function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,o=t.rpcContext;if(Object(D.a)(this,e),this.token=void 0,this.timeout=void 0,this.rpcContext=void 0,this.url=void 0,this.version=void 0,this.token=r,this.timeout=i||1e4,this.rpcContext=o||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(V.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return Ut.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new kt({url:e.url,token:e.token});return Vt.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new Ct({module:n.module_name,url:n.url,token:r.token});return Vt.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}();zt.module=void 0;var jt,Gt,Lt,Bt=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"listNarratives",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(se.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(zt);function Pt(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function xt(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:Pt(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:"r"===e[6],lockStatus:e[7],metadata:e[8]}}function Wt(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:Pt(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}Bt.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(jt||(jt={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(Gt||(Gt={})),function(e){e.TITLE="TITLE",e.LAST_SAVED="LAST_SAVED"}(Lt||(Lt={}));var qt=function(){function e(t){Object(D.a)(this,e),this.params=void 0,this.params=t}return Object(V.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i,o,s,l,c,u;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Bt({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new ze({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),a=new ge({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:if(i=e.sent,o=Object(se.a)(i,3),s=o[0],l=o[1],c=o[2],l.kind!==Re.INACCESSIBLE_PRIVATE){e.next=12;break}throw new Error("Cannot get own narratives for private inaccessible organization");case 12:return u=l.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",s.narratives.map(function(e){return{workspaceInfo:xt(e.ws),objectInfo:Wt(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){return{status:-1!==u.indexOf(e.workspaceInfo.id)?jt.ASSOCIATED:c.find(function(t){return t.resourceType===ce.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?jt.REQUESTED:jt.NONE,narrative:{access:Gt.OWNER,isPublic:e.workspaceInfo.globalReadPermission,workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,owner:e.workspaceInfo.owner,lastSavedAt:e.objectInfo.savedAt,lastSavedBy:e.objectInfo.savedBy}}}).sort(function(e,t){return e.narrative.title.localeCompare(t.narrative.title)}));case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSorter",value:function(e){switch(e){case Lt.TITLE:return function(e,t){return e.narrative.title.localeCompare(t.narrative.title)};case Lt.LAST_SAVED:return function(e,t){return t.narrative.lastSavedAt.getTime()-e.narrative.lastSavedAt.getTime()};default:throw new Error("invalid sort spec")}}},{key:"sortOrganizationNarratives",value:function(e,t){var r=this.getSorter(t);return e.sort(r).slice(0)}},{key:"getNarrative",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i,o,s,l,c,u,E,d,m;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ct({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.callFunc("get_workspace_info",[{id:t}]);case 4:if(n=e.sent,a=Object(se.a)(n,2),i=a[0],!a[1]){e.next=10;break}return e.abrupt("return",{workspaceId:t,access:Gt.NONE});case 10:if(o=xt(i[0]),s=o.metadata.narrative){e.next=14;break}return e.abrupt("return",{workspaceId:t,access:Gt.NONE});case 14:return l=parseInt(s,10),e.next=17,r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:l}],includeMetadata:1,ignoreErrors:0}]);case 17:if(c=e.sent,u=Object(se.a)(c,2),E=u[0],!u[1]){e.next=23;break}return e.abrupt("return",{workspaceId:t,access:Gt.NONE});case 23:d=Wt(E[0].infos[0]),e.t0=o.userPermission,e.next="n"===e.t0?27:"r"===e.t0?33:"w"===e.t0?35:"a"===e.t0?37:39;break;case 27:if(!o.globalReadPermission){e.next=32;break}return m=Gt.VIEW,e.abrupt("break",40);case 32:throw new Error("Cannot have no access and no global read permission!");case 33:return m=Gt.VIEW,e.abrupt("break",40);case 35:return m=Gt.EDIT,e.abrupt("break",40);case 37:return m=o.owner===this.params.username?Gt.OWNER:Gt.ADMIN,e.abrupt("break",40);case 39:throw new Error("Unknown workspace permission: "+o.userPermission);case 40:return e.abrupt("return",{workspaceId:o.id,access:m,isPublic:o.globalReadPermission,objectId:d.id,title:o.metadata.narrative_nice_name||"Unknown",owner:o.owner,lastSavedAt:d.savedAt,lastSavedBy:d.savedBy});case 43:throw e.prev=43,e.t1=e.catch(1),console.error("Error fetching narrative!",e.t1),e.t1;case 47:case"end":return e.stop()}},e,this,[[1,43]])}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Ht(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:Q.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,o=i.token,i.username,s=a.app.config,l=new Mt({token:o,userProfileServiceURL:s.services.UserProfile.url}),t.prev=3,t.next=6,l.getUser(e);case 6:c=t.sent,r((E=c,{type:Q.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((u={code:"error",message:t.t0.message},{type:Q.ENTITY_USER_LOADER_ERROR,error:u}));case 13:case"end":return t.stop()}var u,E},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function Ft(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:Q.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,c=new qt({token:o,username:s,workspaceServiceURL:l.services.Workspace.url,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url}),t.prev=3,t.next=6,c.getNarrative(e);case 6:u=t.sent,r({type:Q.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:Q.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}var Qt=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return this.props.user?T.createElement(Nt,{user:this.props.user,avatarSize:this.props.avatarSize,showAvatar:this.props.showAvatar}):T.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.username)}}]),t}(T.Component);var Jt=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.username)}},function(e){return{onLoad:function(t){e(Ht(t))}}})(Qt);r(231);function Zt(e,t){var r,n,a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=new Date,s=Math.round((o.getTime()-e.getTime())/1e3),l=Math.abs(s);if(l<86400*(t||90)){if(0===l)return"now";l<60?(r=s,n=l,a="second"):l<3600?(r=Math.round(s/60),n=Math.round(l/60),a="minute"):l<86400?(r=Math.round(s/3600),n=Math.round(l/3600),a="hour"):(r=Math.round(s/86400),n=Math.round(l/86400),a="day"),n>1&&(a+="s");var c=null,u=null;return r<0?c="in":r>0&&(u="ago"),(c?c+" ":"")+n+" "+a+(u?" "+u:"")}return i&&o.getFullYear()===e.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var Yt=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){if(!1===this.props.showTooltip)return T.createElement("span",null,Zt(this.props.time,30));var e,t=T.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(this.props.time));return e=this.props.tooltipPrefix?T.createElement("span",null,this.props.tooltipPrefix,t):t,T.createElement(Ot.a,{placement:"bottomRight",title:e},Zt(this.props.time,30))}}]),t}(T.Component);function Kt(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var Xt=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Kt(this.state.view)})}},{key:"renderLogo",value:function(e){return T.createElement(pt,{logoUrl:e.logoUrl,size:80,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(!e.homeUrl)return T.createElement(Ot.a,{placement:"bottomRight",title:"This organization has not set a home page url"},T.createElement(ht.a,{type:"home",style:{color:"rgba(200, 200, 200, 0.3)"}}));var t=T.createElement(T.Fragment,null,T.createElement("p",null,"Home page for this Organization (external to KBase)"));return T.createElement("div",{className:"BriefOrganization-homeUrl"},T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:t},T.createElement("a",{href:e.homeUrl,target:"_blank"},T.createElement(ht.a,{type:"home"}))))}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?T.createElement("span",null,e.narrativeCount):T.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return 1==e.memberCount?T.createElement("span",{style:{color:"gray"}},"\xd8"):T.createElement("span",null,e.memberCount-1)}},{key:"renderRelation",value:function(e){switch(e.relation){case pe.NONE:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},T.createElement("span",null,T.createElement(ht.a,{type:"stop"})));case pe.VIEW:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},T.createElement(ht.a,{type:"stop"}));case pe.MEMBER_REQUEST_PENDING:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"Your membership request is pending"},T.createElement(ht.a,{type:"user",style:{color:"orange"}})," Your membership ",T.createElement("b",null,"request")," is pending");case pe.MEMBER_INVITATION_PENDING:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this organization"},T.createElement(ht.a,{type:"user",style:{color:"blue"}}));case pe.MEMBER:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},T.createElement(ht.a,{type:"user"}));case pe.ADMIN:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an administrator of this organization"},T.createElement(ht.a,{type:"robot"}));case pe.OWNER:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are the owner of this organization"},T.createElement(ht.a,{type:"crown"}))}}},{key:"renderPrivacy",value:function(){return this.props.organization.isPrivate?T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is private - may only be viewed by members"},T.createElement("span",null,T.createElement(ht.a,{type:"unlock"}))):T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is public - may be viewed by any KBase user"},T.createElement("span",null,T.createElement(ht.a,{type:"global"})))}},{key:"renderOrgFreshness",value:function(e){var t;if(e.lastVisitedAt&&e.modifiedAt.getTime()>e.lastVisitedAt.getTime()){t=T.createElement("div",null,T.createElement(Ot.a,{placement:"topRight",title:"This org has changed since your last visit to it; new or updated items are highlighted"},T.createElement("span",{style:{color:"red",fontSize:"120%"}},T.createElement(ht.a,{type:"bell",theme:"filled"}))))}else t=T.createElement("div",null,T.createElement("span",{style:{color:"transparent",fontSize:"120%"}},T.createElement(ht.a,{type:"bell",theme:"filled"})));var r;return r=null,T.createElement("div",null,t,r)}},{key:"renderRequests",value:function(){if(this.props.organization.relation===pe.ADMIN||this.props.organization.relation===pe.OWNER){var e,t;switch(this.props.openRequestsStatus){case we.NONE:e="There are no open requests for this organization",t="rgba(200, 200, 200, 0.3)";break;case we.NEW:e="There are new requests since you last visited this organization",t="red";break;case we.OLD:e="There are open requests for this organization",t="blue";break;case we.INAPPLICABLE:return;default:return void console.warn("Invalid open request status: "+this.props.openRequestsStatus)}var r=T.createElement("span",null,e);return T.createElement(Ot.a,{placement:"topRight",title:r},T.createElement("span",{style:{color:t,fontSize:"80%"}},T.createElement(ht.a,{type:"mail",theme:"filled"})))}}},{key:"renderPermalink",value:function(){var e=T.createElement("div",null,T.createElement("p",null,'Below is the "permalink" for this organization. You may copy this url and use it to access this organization in a web browser.'),T.createElement("p",{style:{fontFamily:"monospace",fontWeight:"bold"}},window.location.origin,"/#org/",this.props.organization.id)),t=T.createElement(wt.a,{onClick:function(t){t.key;Rt.a.info({title:"Org Permalink",content:e})}},T.createElement(wt.a.Item,{key:"view"},"View Permalink"));return T.createElement(gt.a,{overlay:t,trigger:["click","contextMenu"]},T.createElement("a",{href:"/#orgs/"+this.props.organization.id},T.createElement(ht.a,{type:"link"})))}},{key:"renderLogoColumn",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"BriefOrganization-logoRow"},T.createElement(dt.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),T.createElement("div",{className:"BriefOrganization-statusRow"},T.createElement("div",{className:"BriefOrganization-relationCol"},this.renderRelation(e)),T.createElement("div",{className:"BriefOrganization-privacyCol"},this.renderPrivacy()),T.createElement("div",{className:"BriefOrganization-homeLinkCol"},this.renderHomeUrl(e))),T.createElement("div",{className:"BriefOrganization-freshnessRow"},T.createElement("div",{className:"BriefOrganization-orgFreshnessCol"},this.renderOrgFreshness(e)),T.createElement("div",{className:"BriefOrganization-openRequestsCol"},this.renderRequests()),T.createElement("div",{className:"BriefOrganization-openNewRequestsCol"},this.renderPermalink())))}},{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderInfoCol",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),T.createElement("div",{className:"BriefOrganization-orgOwner BriefOrganization-infoTableRow"},T.createElement("div",{className:"BriefOrganization-infoTableCol1"},T.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"owner")),T.createElement("div",{className:"BriefOrganization-infoTableCol2"},T.createElement(Jt,{username:e.owner.username,avatarSize:16,showAvatar:!1}))),T.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},T.createElement("div",{className:"BriefOrganization-infoTableCol1"},T.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"created")),T.createElement("div",{className:"BriefOrganization-infoTableCol2"},T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:this.fullTimestamp(e.createdAt)},T.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))))))}},{key:"renderMemberRow",value:function(e){var t,r=e.memberCount-1;return t=r?1===r?T.createElement("span",null,"There is ",T.createElement("b",null,"1")," member in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,r)," members in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,"no members")," in this organization"),T.createElement(Ot.a,{placement:"bottomRight",title:t},T.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},T.createElement("div",{className:"BriefOrganization-infoTableCol1"},T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"team"}))),T.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderMemberCount(e))))}},{key:"renderNarrativeRow",value:function(e){var t,r=e.narrativeCount;return t=r?1===r?T.createElement("span",null,"There is ",T.createElement("b",null,"1")," narrative in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,r)," narratives in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,"no narratives")," in this organization"),T.createElement(Ot.a,{placement:"bottomRight",title:t},T.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},T.createElement("div",{className:"BriefOrganization-infoTableCol1"},T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"file"}))),T.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderNarrativeCount(e))))}},{key:"renderModifiedRow",value:function(e){var t=T.createElement("span",null,"This organization was last updated"," ",T.createElement(Yt,{time:e.modifiedAt,showTooltip:!1}));return T.createElement(Ot.a,{placement:"bottomRight",title:t},T.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},T.createElement("div",{className:"BriefOrganization-infoTableCol1"},T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"save"}))),T.createElement("div",{className:"BriefOrganization-infoTableCol2"},T.createElement(Yt,{time:e.modifiedAt,showTooltip:!1}))))}},{key:"renderStatsCol",value:function(e){return T.createElement(T.Fragment,null,this.renderMemberRow(e),this.renderNarrativeRow(e),this.renderModifiedRow(e))}},{key:"renderNormal",value:function(){var e=this.props.organization;return T.createElement("div",{className:"BriefOrganization"},T.createElement("div",{className:"BriefOrganization-body"},T.createElement("div",{className:"BriefOrganization-logoCol"},this.renderLogoColumn(e)),T.createElement("div",{className:"BriefOrganization-infoCol"},T.createElement("div",{className:"BriefOrganization-infoCol-row"},T.createElement("div",{className:"BriefOrganization-infoCol-col1"},T.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},T.createElement(dt.a,{to:"/viewOrganization/".concat(e.id)},e.name)))),T.createElement("div",{className:"BriefOrganization-infoCol-row"},T.createElement("div",{className:"BriefOrganization-infoCol-col1"},this.renderInfoCol(e)),T.createElement("div",{className:"BriefOrganization-infoCol-col2"},this.renderStatsCol(e))))))}},{key:"render",value:function(){return this.renderNormal()}}]),t}(T.Component),$t=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderAdminInfo",value:function(e){return T.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,r){var n=e.props.openRequests.get(t.id)||null;return T.createElement("div",{key:String(r),className:"simpleCard"},T.createElement(Xt,{organization:t,openRequestsStatus:n}))}):T.createElement(Et.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return T.createElement("div",{className:"Organizations"},T.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(T.Component);var er=Object(P.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");var t=e.views.browseOrgsView.viewModel;return{organizations:t.organizations,openRequests:t.openRequests}})($t),tr=r(82),rr=r(347),nr=r(352),ar=r(354),ir=(r(242),function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).searchInput=void 0,r.searchButton=void 0,r.filterByRoleValues=void 0,r.searchInput=T.createRef(),r.searchButton=T.createRef(),r.filterByRoleValues=[{label:"Member",value:"member"},{label:"Admin",value:"admin"},{label:"Owner",value:"owner"}],r.state={searchInput:"",filterByRoleType:"myorgs",filterByRole:[],filterByPrivacy:"any",showAdvancedControls:!1},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearchOrgs([])}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){switch(e){case"owner":this.props.onSortOrgs("owner",O.ASCENDING);break;case"name":this.props.onSortOrgs("name",O.ASCENDING);break;case"recentlyAdded":this.props.onSortOrgs("created",O.DESCENDING);break;case"recentlyChanged":this.props.onSortOrgs("changed",O.DESCENDING);break;case"memberCount":this.props.onSortOrgs("memberCount",O.DESCENDING);break;case"narrativeCount":this.props.onSortOrgs("narrativeCount",O.DESCENDING)}}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onFilterByRoleTypeChange",value:function(e){var t;this.setState({filterByRoleType:e.target.value}),"select"===e.target.value?(this.setState({filterByRole:[]}),t=Object(q.a)({},this.props.filter,{roleType:e.target.value})):(t=Object(q.a)({},this.props.filter,{roleType:e.target.value,roles:[]}),this.setState({filterByRole:[]})),this.props.onFilterOrgs(t)}},{key:"onFilterByRoleChange",value:function(e){var t;this.setState({filterByRole:e}),0===e.length?(this.setState({filterByRoleType:"myorgs"}),t=Object(q.a)({},this.props.filter,{roleType:"myorgs",roles:e})):(this.setState({filterByRoleType:"select"}),t=Object(q.a)({},this.props.filter,{roleType:"select",roles:e})),this.props.onFilterOrgs(t)}},{key:"onFilterByPrivacyChange",value:function(e){this.setState({filterByPrivacy:e.target.value});var t=Object(q.a)({},this.props.filter,{privacy:e.target.value});this.props.onFilterOrgs(t)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?T.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},"None available"):0===this.props.filteredCount?T.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},"\xd8 /",this.props.totalCount," ","orgs"):this.props.totalCount===this.props.filteredCount?T.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},T.createElement("b",null,this.props.totalCount)," ","orgs"):T.createElement("div",{className:"OrganizationsBrowser-searchFeedback"},T.createElement("b",null,this.props.filteredCount),"/",this.props.totalCount," ","orgs")}},{key:"renderSearchIcon",value:function(){return this.props.searching?T.createElement(ht.a,{type:"loading"}):T.createElement(ht.a,{type:"search"})}},{key:"renderSearchForm",value:function(){return T.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},T.createElement("input",{className:"OrganizationsBrowser-searchInput",placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),T.createElement(tr.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),T.createElement(tr.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}),this.renderSearchFeedback())}},{key:"renderSearchBar",value:function(){return T.createElement("div",{className:"OrganizationsBrowser-searchBarRow"},T.createElement("div",{className:"OrganizationsBrowser-searchBarCol1"},this.renderSearchForm()),T.createElement("div",{className:"OrganizationsBrowser-searchBarCol2"},T.createElement(dt.a,{to:"/newOrganization"},T.createElement(tr.a,{icon:"plus-circle",style:{marginRight:"10px"}},"Create Organization"))))}},{key:"renderSortByControl",value:function(){return T.createElement(rr.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,dropdownMatchSelectWidth:!0,style:{width:"10em"}},T.createElement(rr.a.Option,{value:"recentlyChanged",key:"changed"},"Date Changed"),T.createElement(rr.a.Option,{value:"recentlyAdded",key:"recent"},"Date Established"),T.createElement(rr.a.Option,{value:"name",key:"name"},"Org Name"),T.createElement(rr.a.Option,{value:"memberCount",key:"memberCount"},"# members"),T.createElement(rr.a.Option,{value:"narrativeCount",key:"narrativeCount"},"# narratives"))}},{key:"onToggleAdvanced",value:function(){if(this.state.showAdvancedControls){this.setState({showAdvancedControls:!1});var e=this.props.filter,t=e.roleType,r=e.roles;e.privacy;["myorgs","all"].includes(t)||(t="myorgs",this.setState({filterByRoleType:"myorgs"})),this.setState({filterByRole:[],filterByPrivacy:"any"}),r=[],"any",this.props.onFilterOrgs({roleType:t,roles:r,privacy:"any"})}else this.setState({showAdvancedControls:!0})}},{key:"renderAdvancedToggle",value:function(){return this.state.showAdvancedControls?T.createElement(ht.a,{type:"ellipsis",className:"IconButton-hover-pressed",onClick:this.onToggleAdvanced.bind(this)}):T.createElement(ht.a,{type:"ellipsis",className:"IconButton-hover",onClick:this.onToggleAdvanced.bind(this)})}},{key:"renderFilterByRole",value:function(){var e={display:"block",height:"30px",lineHeight:"30px"};return this.state.showAdvancedControls?T.createElement(T.Fragment,null,T.createElement(nr.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},T.createElement(nr.a,{value:"myorgs",style:e},"My Orgs"),T.createElement(nr.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle(),T.createElement(nr.a,{value:"notmyorgs",style:e},"Not My Orgs"),T.createElement(nr.a,{value:"select",style:e},"Specific Role")),T.createElement(ar.a.Group,{options:this.filterByRoleValues,value:this.state.filterByRole,className:"OrganizationsBrowser-checkboxGroup",onChange:this.onFilterByRoleChange.bind(this)})):T.createElement(T.Fragment,null,T.createElement(nr.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},T.createElement(nr.a,{value:"myorgs",style:e},"My Orgs"),T.createElement(nr.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle()))}},{key:"renderFilterByPrivacy",value:function(){if(this.state.showAdvancedControls){var e={display:"block",height:"30px",lineHeight:"30px",margin:"0px"};return T.createElement(T.Fragment,null,T.createElement(nr.a.Group,{onChange:this.onFilterByPrivacyChange.bind(this),value:this.state.filterByPrivacy},T.createElement(nr.a,{value:"any",style:e},"Any"),T.createElement(nr.a,{value:"public",style:e},"Visible"),T.createElement(nr.a,{value:"private",style:e},"Hidden")))}}},{key:"renderOrganizations",value:function(){return this.props.error?T.createElement(Et.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):T.createElement(er,null)}},{key:"renderFilterColumn",value:function(){return T.createElement(T.Fragment,null,T.createElement("div",{className:"field-label"},"sort by"),this.renderSortByControl(),T.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"filter"),this.renderFilterByRole(),this.state.showAdvancedControls?T.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"visibility"):null,this.renderFilterByPrivacy())}},{key:"render",value:function(){return T.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},this.renderSearchBar(),T.createElement("div",{className:"OrganizationsBrowser-bodyRow"},T.createElement("div",{className:"OrganizationsBrowser-bodyCol scrollable-flex-column"},this.renderOrganizations()),T.createElement("div",{className:"OrganizationsBrowser-filterCol"},this.renderFilterColumn())))}}]),t}(T.Component));function or(e,t){return{type:Q.BROWSE_ORGS_SORT_START,sortField:e,sortDirection:t}}function sr(e,t,r){return{type:Q.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t,openRequests:r}}function lr(e){return{type:Q.BROWSE_ORGS_SEARCH_ERROR,error:e}}function cr(e){return{type:Q.BROWSE_ORGS_FILTER_START,filter:e}}var ur=Object(P.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.openRequests,a=t.error;return{organizations:r,openRequests:n,totalCount:t.totalCount,filteredCount:t.filteredCount,filter:t.filter,error:a,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E,d,m,v,p,O,h,R,w;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:Q.BROWSE_ORGS_SEARCH_START}),a=n(),i=a.views.browseOrgsView,o=a.auth.authorization,s=o.token,l=o.username,c=a.app.config,null!==i.viewModel){t.next=5;break}return r(lr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 5:return u=i.viewModel,E=u.sortField,d=u.sortDirection,m=u.filter,v=new ze({token:s,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=7,t.next=10,v.queryOrgs({searchTerms:e,sortField:E,sortDirection:d,filter:m,username:l});case 10:if(p=t.sent,O=p.organizations,h=p.total,!((R=O.filter(function(e){return e.relation===pe.ADMIN||e.relation===pe.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,v.getOpenRequestsStatus({organizationIds:R});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(sr(O,h,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(lr({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,this,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onSortOrgs:function(t,r){e(function(e,t){return function(){var r=Object(oe.a)(ie.a.mark(function r(n,a){var i,o,s,l,c,u,E,d,m,v,p,O,h,R,w;return ie.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n(or(e,t)),i=a(),o=i.views.browseOrgsView,s=i.auth.authorization,l=s.token,c=s.username,u=i.app.config,E=new ze({token:l,username:c,groupsServiceURL:u.services.Groups.url}),null!==o.viewModel){r.next=6;break}return n(lr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),r.abrupt("return");case 6:return d=o.viewModel,m=d.searchTerms,v=d.filter,r.prev=7,r.next=10,E.queryOrgs({searchTerms:m,filter:v,username:c,sortField:e,sortDirection:t});case 10:if(p=r.sent,O=p.organizations,h=p.total,!((R=O.filter(function(e){return e.relation===pe.ADMIN||e.relation===pe.OWNER}).map(function(e){return e.id})).length>0)){r.next=20;break}return r.next=17,E.getOpenRequestsStatus({organizationIds:R});case 17:w=r.sent,r.next=21;break;case 20:w=new Map;case 21:n(sr(O,h,w)),r.next=28;break;case 24:r.prev=24,r.t0=r.catch(7),console.error("Error querying orgs",r.t0.name,r.t0.message),n(lr({code:r.t0.name,message:r.t0.message}));case 28:case"end":return r.stop()}},r,this,[[7,24]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onFilterOrgs:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E,d,m,v,p,O,h,R,w;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(cr(e)),a=n(),i=a.views.browseOrgsView,o=a.auth.authorization,s=o.token,l=o.username,c=a.app.config,u=new ze({token:s,username:l,groupsServiceURL:c.services.Groups.url}),null!==i.viewModel){t.next=6;break}return r(lr({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 6:return E=i.viewModel,d=E.searchTerms,m=E.sortField,v=E.sortDirection,t.prev=7,t.next=10,u.queryOrgs({searchTerms:d,filter:e,username:l,sortField:m,sortDirection:v});case 10:if(p=t.sent,O=p.organizations,h=p.total,!((R=O.filter(function(e){return e.relation===pe.ADMIN||e.relation===pe.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,u.getOpenRequestsStatus({organizationIds:R});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(sr(O,h,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(lr({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,this,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(ir),Er=r(343),dr=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){var e=T.createElement("div",null,"Loading Organizations..."," ",T.createElement(Er.a,null));return T.createElement(Et.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return T.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return T.createElement(ur,{sortBy:"recentlyChanged"})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var mr=Object(P.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a,i,o,s,l,c,u,E,d,m,v,p,h,R,w;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:Q.BROWSE_ORGS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,l=new ze({token:i,username:o,groupsServiceURL:s.services.Groups.url}),c=[],u="changed",E=O.DESCENDING,d={roleType:"myorgs",roles:[],privacy:"any"},e.prev=7,e.next=10,l.queryOrgs({searchTerms:c,sortField:u,sortDirection:E,filter:d,username:o});case 10:if(m=e.sent,v=m.organizations,p=m.total,!((h=v.filter(function(e){return e.relation===pe.ADMIN||e.relation===pe.OWNER}).map(function(e){return e.id})).length>0)){e.next=20;break}return e.next=17,l.getOpenRequestsStatus({organizationIds:h});case 17:R=e.sent,e.next=21;break;case 20:R=new Map;case 21:w={rawOrganizations:v,organizations:v,openRequests:R,totalCount:p,filteredCount:v.length,sortField:u,sortDirection:E,filter:d,searchTerms:c,selectedOrganizationId:null,searching:!1,error:null},t((g=w,{type:Q.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:g})),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),console.error("Error querying orgs",e.t0.name,e.t0.message),t(lr({code:e.t0.name,message:e.t0.message}));case 29:case"end":return e.stop()}var g},e,this,[[7,25]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:Q.BROWSE_ORGS_UNLOAD})}}})(dr);function vr(e){return{type:Q.ADD_ORG_SAVE_ERROR,error:e}}function pr(){return{type:Q.ADD_ORG_EVALUATE_ERRORS}}function Or(e){return{type:Q.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function hr(e,t){return{type:Q.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function Rr(){return function(e,t){e({type:Q.ADD_ORG_LOAD_START});var r,n={id:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgId("")[1]},name:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgName("")[1]},logoUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgLogoUrl("")[1]},homeUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgHomeUrl("")[1]},researchInterests:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgResearchInterests("")[1]},description:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgDescription("")[1]},isPrivate:{value:!1,remoteValue:null,syncState:i.CLEAN,validationState:{type:s.OK,validatedAt:new Date}}};e((r=n,{type:Q.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(gr())}}function wr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:Q.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,o=r.views.addOrgView.viewModel.newOrganization,s=r.app.config,l=new ze({token:a,username:i,groupsServiceURL:s.services.Groups.url});o?l.addOrg(o,i).then(function(t){e(function(e){return{type:Q.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",o,t),e(vr({code:t.code||t.name,message:t.message,exception:t}))}):e(vr({code:"app",message:"The new organization data does not yet exist"}))}else e(vr({code:"invalid",message:"Unexpected condition: no view model"}))}}function gr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState.type===s.OK&&a.id.validationState.type===s.OK&&a.logoUrl.validationState.type===s.OK&&a.homeUrl.validationState.type===s.OK&&a.researchInterests.validationState.type===s.OK&&a.description.validationState.type===s.OK?e({type:Q.ADD_ORG_EVALUATE_OK}):e(pr())}else e(vr({code:"invalid",message:"Unexpected condition: no view model"}))}}function _r(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new ze({token:r,username:n,groupsServiceURL:a.services.Groups.url})}function fr(e){return function(t){var r=_e.validateOrgName(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:Q.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:Q.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(gr())}}function Sr(e){return function(t){var r,n=_e.validateOrgLogoUrl(e),a=Object(se.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:Q.ADD_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(i,o)):t((r=i,{type:Q.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:r})),t(gr())}}var Ar=function(){function e(t,r){Object(D.a)(this,e),this.delay=void 0,this.fun=void 0,this.canceled=void 0,this.timer=void 0,this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(V.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),Nr=null;function br(e){return function(t,r){t(function(e){return{type:Q.ADD_ORG_UPDATE_ID_PASS,id:e}}(e));var n=_e.validateOrgId(e),a=Object(se.a)(n,2),i=a[0],o=a[1];if(o.type!==s.OK)return t(hr(i,o)),void t(gr());var l=r().views.addOrgView.viewModel;if(l){var c=l.newOrganization.id.validationState.validatedAt,u=(new Date).getTime();if(c)if(u-c.getTime()<500)return void(Nr||(Nr=new Ar(500,function(){t(function(e,t){var r=t(),n=r.views.addOrgView.viewModel;if(n){var a=n.newOrganization.id,i=_e.validateOrgId(a.value),o=Object(se.a)(i,2),l=o[0],c=o[1];if(c.type!==s.OK)return e(hr(l,c)),void e(gr());var u=_r(t());u.orgExists(l).then(function(t){e(t?hr(l,{type:s.ERROR,message:"This org id is already in use",validatedAt:new Date}):Or(l)),e(gr())})}})})));Nr&&Nr.cancel(),Nr=null,_r(r()).orgExists(i).then(function(e){t(e?hr(i,{type:s.ERROR,validatedAt:new Date,message:"This org id is already in use"}):Or(i)),t(gr())})}}}function Ir(e){return function(t,r){_r(r());var n=_e.validateOrgDescription(e),a=Object(se.a)(n,2),i=a[0],o=a[1];o.type!==s.OK?t(function(e,t){return{type:Q.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(i,o)):t(function(e){return{type:Q.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(i)),t(gr())}}var Tr=r(344),yr=r(40),Mr=r(350),Cr=r(348),Dr=r(63),Vr=r.n(Dr),kr=(r(257),function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,showError:!0},r.origin=document.location.origin,r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Rt.a.confirm({title:"Leave the editor?",content:T.createElement("div",null,T.createElement("p",null,"You have entered information for this new organization."),T.createElement("p",null,"If you leave the editor without first saving, the new organization ",T.createElement("i",null,"will not be created"),"."),T.createElement("p",null,T.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===l.NEW||this.props.saveState===l.READY||this.props.saveState===l.SAVED)}},{key:"isModified",value:function(){return this.props.editState===o.EDITED&&this.props.saveState===l.NEW}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error Lite"}switch(e.syncState){case i.DIRTY:return"sync-dirty Lite";default:return"validation-ok Lite"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===i.DIRTY?T.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderNameRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"This is the name for your organization as you want KBase users to see it; you may change it at any time."),T.createElement("p",null,"It may be composed of ordinary text, but does not accept formatting."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1024 characters")))));return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"},T.createElement("div",{className:"NewOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Name"))),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{className:"NewOrganization-formControl"},T.createElement(Mr.a,{value:this.props.newOrganization.name.value||"",className:this.calcFieldClass(this.props.newOrganization.name),placeholder:"Your Organization's display name",autoFocus:!0,onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.newOrganization.name))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("div",{className:"NewOrganization-preview-name"},this.props.newOrganization.name.value||"")))}},{key:"renderIDRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each Organization has a unique identifier. The ID is set when the organization is created, and are permanent: It may never be changed."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"100 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"a to z, 0 to 9, -")))));return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"},T.createElement("div",{className:"NewOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"ID"))),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{className:"NewOrganization-formControl"},T.createElement(Mr.a,{value:this.props.newOrganization.id.value||"",className:this.calcFieldClass(this.props.newOrganization.id),placeholder:"A unique ID for your Organization",onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.newOrganization.id))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("div",{className:"NewOrganization-preview-id"},T.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.newOrganization.id.value||T.createElement("span",{style:{fontStyle:"italic"}},"organization id here"))))}},{key:"renderLogoURLRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each Organization will display a logo. You may specific your own logo by entering the URL for an image, or leave this field blank and a default logo will be displayed, using the first letter of your org name and a randomly generated color (based on your org id)."),T.createElement("p",null,"Please don't use large images, and try to keep them roughly square. The logo image display will be constrained to no larger than 100 pixels wide. Non-square logos may not look good in the Orgs list or on your Org page."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"no")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1000 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"a full https:// url. E.g. https://my.org/myimage.png",T.createElement("br",null),"note that only ",T.createElement("i",null,"https")," urls are accepted.")))));return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"},T.createElement("div",{className:"NewOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Logo URL"))),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{className:"NewOrganization-formControl"},T.createElement(Mr.a,{value:this.props.newOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.logoUrl),placeholder:"The URL for your Organization's logo (optional)",onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.logoUrl))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("div",{className:"NewOrganization-preview-logo"},this.renderLogoPreview())))}},{key:"renderHomeURLRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each Organization may display a home page url. This should be considered the canonical home for your Organization, if it also exists outside of KBase."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"no")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1000 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"a full url. E.g. http://my.org/myimage.png",T.createElement("br",null),"note that both ",T.createElement("i",null,"http>")," and ",T.createElement("i",null,"https")," urls are accepted.")))));return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"},T.createElement("div",{className:"NewOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Home Page URL"))),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{className:"NewOrganization-formControl"},T.createElement(Mr.a,{value:this.props.newOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.homeUrl),placeholder:"The url for your Organization's home page (optional)",onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.homeUrl))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("div",{className:"NewOrganization-field-name"},T.createElement("a",{href:this.props.newOrganization.homeUrl.value||"",target:"_blank"},this.props.newOrganization.homeUrl.value||""))))}},{key:"renderCollapse",value:function(e){return T.createElement(Cr.a,{bordered:!1},T.createElement(Cr.a.Panel,{header:"What about inviting users?",key:"invite",style:{background:"transparent",borderRadius:0,margin:0,border:0,overflow:"hidden"}},e))}},{key:"renderPrivatePublicRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,'Set the Organization to "hidden" to prevent it from appearing in the listing and from being exposed as an Org page for any non-member.'),T.createElement("p",null,"You may invite users directly to your org. When doing so they will receive a notification with a link to the org page. When a user lands on the org page they will not be shown information about the org, but will be available to accept the invitation and instantly have access to it."),T.createElement("p",null,"A user with an invitation who lands on the org page will not see information about the org, but will be able to submit a Join request."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"no")))));return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"},T.createElement("div",{className:"NewOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Hidden?"))),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{className:"NewOrganization-formControl"},T.createElement(ar.a,{checked:this.props.newOrganization.isPrivate.value,className:this.calcFieldClass(this.props.newOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.newOrganization.isPrivate))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("div",{className:"NewOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.newOrganization.isPrivate.value))))}},{key:"renderResearchInterestsRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each organization must have a short description of research interests or purpose."),T.createElement("p",null,"This text is displayed in the organizations list and the organization's page. It is most helpful in the list context to help users quickly scan the list."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"200 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"unformatted text")))));return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"},T.createElement("div",{className:"NewOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Research Interests"))),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{className:"NewOrganization-formControl"},T.createElement(Vr.a,{value:this.props.newOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.newOrganization.researchInterests)+" NewOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},placeholder:"List your areas of interest. Systems biology, microbial ecology, plant genomics",onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.newOrganization.researchInterests))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("div",{className:"NewOrganization-preview-researchInterests"},this.props.newOrganization.researchInterests.value||"")))}},{key:"renderDescriptionRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each organization must have a description which communicates the purpose of this organization."),T.createElement("p",null,"The description is in ",T.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown")," format and may be quite long. It will be presented in a scrolling area."),T.createElement("p",null,"Please be mindful of embedding large images or other content which may interfere with the display of your Organization."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1024 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"standard ",T.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown"))))));return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"},T.createElement("div",{className:"NewOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Description"))),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{className:"NewOrganization-formControl"},T.createElement(Vr.a,{value:this.props.newOrganization.description.value||"",className:this.calcFieldClass(this.props.newOrganization.description)+" NewOrganization-control-description",autosize:{minRows:5,maxRows:15},placeholder:"Text or Markdown describing your Organization",onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.newOrganization.description))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("div",{className:"NewOrganization-preview-description",dangerouslySetInnerHTML:{__html:yr.Marked.parse(this.props.newOrganization.description.value||"")}})))}},{key:"renderEditorHeader",value:function(){return T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"}),T.createElement("div",{className:"NewOrganization-col2"},T.createElement("div",{style:{flex:"1 1 0px"}},T.createElement("h3",null,"Create Your Organization"))),T.createElement("div",{className:"NewOrganization-col3"},T.createElement("h3",null,"Preview")))}},{key:"renderEditor",value:function(){return T.createElement("form",{id:"newOrganizationForm",className:"NewOrganization-editor  scrollable-flex-column",onSubmit:this.onSubmit.bind(this)},this.renderEditorHeader(),T.createElement("div",{className:"NewOrganization-body"},this.renderNameRow(),this.renderIDRow(),this.renderLogoURLRow(),this.renderHomeURLRow(),this.renderPrivatePublicRow(),this.renderResearchInterestsRow(),this.renderDescriptionRow(),T.createElement("div",{className:"NewOrganization-row"},T.createElement("div",{className:"NewOrganization-col1"}),T.createElement("div",{className:"NewOrganization-col2",style:{textAlign:"center"}},T.createElement("div",{className:"ButtonSet"},T.createElement("span",{className:"ButtonSet-button"},this.renderSaveButton()),T.createElement("span",{className:"ButtonSet-button"},this.renderCancelButton()))),T.createElement("div",{className:"NewOrganization-col3"}))))}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderLogo",value:function(e){return T.createElement(pt,{logoUrl:null,size:64,organizationName:e.name.value,organizationId:e.id.value})}},{key:"renderIsPrivate",value:function(e){return e?T.createElement("span",null,T.createElement(ht.a,{type:"lock"})," ","Hidden - will be visible ",T.createElement("b",null,"only")," for members of this organization"):T.createElement("span",null,T.createElement(ht.a,{type:"global"})," ","Visible - will be visible to all KBase users.")}},{key:"renderDefaultLogo",value:function(){if(!this.props.newOrganization.name.value||!this.props.newOrganization.id.value)return T.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.newOrganization.name.value,0).toUpperCase(),t=vt()(this.props.newOrganization.id.value).substr(0,6);return T.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},T.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogoPreview",value:function(){return this.props.newOrganization.logoUrl.value?T.createElement("img",{src:this.props.newOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return T.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return T.createElement("div",{key:"line_"+t},e)})),t&&(t=T.createElement("div",null,T.createElement("div",null,"trace"),t)),T.createElement(Rt.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},T.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),T.createElement("div",null,this.props.error.message),t)}}},{key:"renderSaveButton",value:function(){return T.createElement(tr.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")}},{key:"renderCancelButton",value:function(){return T.createElement(tr.a,{type:"danger",onClick:this.onClickCancelToBrowser.bind(this)},T.createElement(ht.a,{type:"close"})," ","Close")}},{key:"renderMenuButtons",value:function(){var e;return this.props.error&&(e=T.createElement("span",{className:"ButtonSet-button"},T.createElement(tr.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}))),T.createElement("div",{className:"ButtonSet"},T.createElement("span",{className:"ButtonSet-button"},T.createElement(tr.a,{type:"default",onClick:this.onClickCancelToBrowser.bind(this)},T.createElement(ht.a,{type:"rollback"})," ","Back")),T.createElement("span",{className:"ButtonSet-button"},this.renderSaveButton()),e)}},{key:"render",value:function(){return this.state.cancelToBrowser?T.createElement(Tr.a,{push:!0,to:"/organizations"}):this.props.saveState===l.SAVED?T.createElement(Tr.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):T.createElement("div",{className:"NewOrganization"},this.renderEditor(),this.renderError())}}]),t}(T.Component));var Ur=Object(P.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(wr())},onUpdateName:function(t){e(fr(t))},onUpdateLogoUrl:function(t){e(Sr(t))},onUpdateId:function(t){e(br(t))},onUpdateDescription:function(t){e(Ir(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:Q.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(gr())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=_e.validateOrgHomeUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:Q.ADD_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:i}):t({type:Q.ADD_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a})}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=_e.validateOrgResearchInterests(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:Q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:Q.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a})}}(t))}}})(kr),zr=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){return T.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return T.createElement("div",null,"Error!",T.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case h.SUCCESS:default:return T.createElement(Ur,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var jr=Object(P.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(Rr())},onUnload:function(){e({type:Q.ADD_ORG_UNLOAD})}}})(zr),Gr=function(){function e(t){Object(D.a)(this,e),this.params=void 0,this.params=t}return Object(V.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(oe.a)(ie.a.mark(function e(t){var r,n,a,i,o,s,l;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ze({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),n=new ge({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(o=e.sent,(s=fe(a,this.params.username,i,o)).type!==pe.ADMIN&&s.type!==pe.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:l=e.sent,e.next=19;break;case 18:l=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:o,relation:s,groupRequests:l});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Lr(){return function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:Q.DATA_SERVICE_LOAD_START}),t({type:Q.DATA_SERVICE_LOAD_SUCCESS});case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}function Br(e){return{type:Q.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function Pr(e,t){return{type:Q.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e,narratives:t}}function xr(e){return{type:Q.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function Wr(e,t,r,n,a,i,o,s,l,c,u){return{type:Q.VIEW_ORG_LOAD_NORMAL_SUCCESS,organization:e,relation:t,openRequest:r,groupRequests:n,groupInvitations:a,requestInbox:i,requestOutbox:o,narrativesSortBy:s,narratives:l,sortMembersBy:c,members:u}}function qr(e,t,r){return{type:Q.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,organization:e,relation:t,requestOutbox:r}}function Hr(e){return{type:Q.VIEW_ORG_LOAD_ERROR,error:e}}function Fr(e){return{type:Q.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function Qr(){return{type:Q.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function Jr(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E,d,m,v,p,O,h,R,w,g,_,f;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:Q.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,c=new Gr({token:o,username:s,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url}),u=new ge({token:o,username:s,groupsServiceURL:l.services.Groups.url}),E=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=5,t.next=8,c.getOrganizationForUser(e);case 8:if(d=t.sent,m=d.organization,v=d.relation,m.kind===Re.NORMAL){t.next=17;break}return t.next=14,u.getRequestInboxForOrg(e);case 14:return p=t.sent,r(qr(m,v,p)),t.abrupt("return");case 17:if(v.type!==pe.OWNER&&v.type!==pe.ADMIN){t.next=32;break}return t.next=20,u.getPendingOrganizationRequestsForOrg(e);case 20:return h=t.sent,t.next=23,u.getOrganizationInvitationsForOrg(e);case 23:return R=t.sent,t.next=26,E.getOpenRequestStatus({organizationId:e});case 26:return O=t.sent,t.next=29,u.getCombinedRequestInboxForOrg(e);case 29:w=t.sent,t.next=36;break;case 32:h=null,R=null,O=we.INAPPLICABLE,w=[];case 36:return t.next=38,u.getRequestOutboxForOrg(e);case 38:g=t.sent,"added",_=Ve(m.narratives,{sortBy:"added",searchBy:""}),"added",f=Ue(m.members,{sortBy:"added",searchBy:""}),r(Wr(m,v,O,h,R,w,g,"added",_,"added",f)),t.next=49;break;case 46:t.prev=46,t.t0=t.catch(5),r(Hr({code:t.t0.name,message:t.t0.message}));case 49:case"end":return t.stop()}},t,this,[[5,46]])}));return function(e,r){return t.apply(this,arguments)}}()}function Zr(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E,d,m,v,p,O,h,R,w,g,_,f,A,N;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,c=new Gr({token:o,username:s,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,userProfileServiceURL:l.services.UserProfile.url,workspaceServiceURL:l.services.Workspace.url}),u=new ge({token:o,username:s,groupsServiceURL:l.services.Groups.url}),E=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=4,d=n(),m=d.views.viewOrgView.viewModel){t.next=10;break}return r(Hr({code:"error",message:"No view model"})),t.abrupt("return");case 10:if(m.kind===S.NORMAL){t.next=13;break}return r(Hr({code:"error",message:"Wrong org view model kind!"})),t.abrupt("return");case 13:return t.next=15,c.getOrganizationForUser(e);case 15:if(v=t.sent,p=v.organization,O=v.relation,p.kind===Re.NORMAL){t.next=24;break}return t.next=21,u.getRequestInboxForOrg(e);case 21:return h=t.sent,r(qr(p,O,h)),t.abrupt("return");case 24:if(O.type!==pe.OWNER&&O.type!==pe.ADMIN){t.next=36;break}return t.next=27,u.getPendingOrganizationRequestsForOrg(e);case 27:return w=t.sent,t.next=30,u.getOrganizationInvitationsForOrg(e);case 30:return g=t.sent,t.next=33,E.getOpenRequestStatus({organizationId:e});case 33:R=t.sent,t.next=39;break;case 36:w=null,g=null,R=we.INAPPLICABLE;case 39:return t.next=41,u.getCombinedRequestInboxForOrg(e);case 41:return _=t.sent,t.next=44,u.getRequestOutboxForOrg(e);case 44:f=t.sent,"added",A=Ve(p.narratives,{sortBy:m.sortNarrativesBy,searchBy:m.searchNarrativesBy}),"added",N=Ue(p.members,{sortBy:m.sortMembersBy,searchBy:m.searchMembersBy}),r(Wr(p,O,R,w,g,_,f,"added",A,"added",N)),t.next=55;break;case 52:t.prev=52,t.t0=t.catch(4),r(Hr({code:t.t0.name,message:t.t0.message}));case 55:case"end":return t.stop()}},t,this,[[4,52]])}));return function(e,r){return t.apply(this,arguments)}}()}function Yr(){return function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,i,o,s,l,c,u;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r()).views.viewOrgView.viewModel){e.next=4;break}return t(Fr({type:a.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=n.auth.authorization,o=i.token,s=i.username,l=n.app.config,c=n.views.viewOrgView.viewModel.organization,u=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url}),e.prev=6,e.next=9,u.requestMembership(c.id);case 9:t({type:Q.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(Jr(c.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(Fr({type:a.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,this,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function Kr(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var i,o,s,l,c,u,E;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:Q.VIEW_ORG_JOIN_REQUEST_START}),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Fr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,l=o.username,c=i.app.config,i.views.viewOrgView.viewModel.organization,u=new ge({token:s,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=7,t.next=10,u.cancelRequest(e);case 10:E=t.sent,r({type:Q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:a.ERROR,message:t.t0.message},{type:Q.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function Xr(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var i,o,s,l,c,u,E;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Qr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Fr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,l=o.username,c=i.app.config,i.views.viewOrgView.viewModel.organization,u=new ge({token:s,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=7,t.next=10,u.acceptJoinInvitation(e);case 10:E=t.sent,r({type:Q.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:Q.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function $r(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var i,o,s,l,c,u,E;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Qr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Fr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return o=i.auth.authorization,s=o.token,l=o.username,c=i.app.config,i.views.viewOrgView.viewModel.organization,u=new ge({token:s,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=7,t.next=10,u.rejectJoinInvitation(e);case 10:E=t.sent,r({type:Q.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:Q.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function en(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===S.NORMAL){t.next=8;break}return r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_START}),o=a.auth.authorization,s=o.token,l=o.username,c=a.app.config,u=new ge({token:s,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,u.acceptRequest(e);case 14:return t.next=16,u.getCombinedRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}var tn=r(346),rn=r(339),nn=(r(268),function(e){function t(e,r){var n;return Object(D.a)(this,t),(n=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(z.a)(t,e),Object(V.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return T.createElement(ht.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"onMenuSelection",value:function(e){}},{key:"render",value:function(){return T.createElement("div",{className:"Header"},T.createElement("div",{className:"Header-contextual"},T.createElement("div",{className:"Header-userColumn"},T.createElement("div",{className:"Header-breadcrumbs"},this.props.breadcrumbs),T.createElement("div",{className:"Header-buttons"},this.props.buttons))))}}]),t}(T.Component));function an(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,o=e.info;return{code:t,message:r,detail:n,id:Le()(),at:new Date,history:a,trace:i,info:o}}function on(e){return function(t,r){t({type:Q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,l=n.views.viewOrgView.viewModel;if(null===l)throw new Error("view is not populated");new ze({token:i,username:o,groupsServiceURL:s.services.Groups.url}).memberToAdmin(l.organization.id,e).then(function(r){t(function(e){return{type:Q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Q.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function sn(e){return function(t,r){t({type:Q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,l=n.views.viewOrgView.viewModel;if(null===l)throw new Error("view is not populated");new ze({token:i,username:o,groupsServiceURL:s.services.Groups.url}).adminToMember(l.organization.id,e).then(function(r){t(function(e){return{type:Q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Q.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function ln(e){return function(t,r){t({type:Q.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,l=n.views.viewOrgView.viewModel;if(null===l)throw new Error("view is not populated");new ze({token:i,username:o,groupsServiceURL:s.services.Groups.url}).removeMember(l.organization.id,e).then(function(){t(Zr(l.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:Q.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}var cn;r(270);function un(e){switch(e){case cn.COMPACT:return cn.NORMAL;case cn.NORMAL:return cn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(cn||(cn={}));var En=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={view:cn.COMPACT},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onToggleView",value:function(){this.setState({view:un(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case Oe.OWNER:return T.createElement("span",null,T.createElement(ht.a,{type:"crown"})," owner");case Oe.ADMIN:return T.createElement("span",null,T.createElement(ht.a,{type:"unlock"})," admin");case Oe.MEMBER:return T.createElement("span",null,T.createElement(ht.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){var e=T.createElement("div",null,this.props.member.username);return T.createElement("div",{className:"Member View-COMPACT"},T.createElement("div",{className:"Member-controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===cn.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===cn.NORMAL?"up":"down")}))),T.createElement("div",{className:"Member-avatarCol"},T.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),T.createElement("div",{className:"Member-infoCol"},T.createElement("div",{className:"Member-name"},T.createElement(Ot.a,{placement:"bottomRight",title:e},T.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),T.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",T.createElement(Yt,{time:this.props.member.joinedAt})),T.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title)))}},{key:"renderNormal",value:function(){var e=T.createElement("div",null,this.props.member.username);return T.createElement("div",{className:"Member View-NORMAL"},T.createElement("div",{className:"Member-controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===cn.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===cn.NORMAL?"up":"down")}))),T.createElement("div",{className:"Member-avatarCol"},T.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),T.createElement("div",{className:"Member-infoCol"},T.createElement("div",{className:"Member-name"},T.createElement(Ot.a,{placement:"bottomRight",title:e},T.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),T.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",T.createElement(Yt,{time:this.props.member.joinedAt})),T.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title),T.createElement("div",{className:"Member-organization"},this.props.user.organization||T.createElement("i",null,"no organization in user profile")),T.createElement("div",{className:"Member-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||T.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case cn.COMPACT:return this.renderCompact();case cn.NORMAL:return this.renderNormal()}}}]),t}(T.Component),dn=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return this.props.user?T.createElement(En,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):T.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(T.Component);var mn=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(Ht(t))}}})(dn),vn=(r(272),function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={confirmMemberRemoval:null},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onConfirmRemoveMember",value:function(e){this.setState({confirmMemberRemoval:{member:e}})}},{key:"renderConfirmMemberRemoval",value:function(){var e=this;if(this.state.confirmMemberRemoval){var t=this.state.confirmMemberRemoval.member,r=T.createElement(T.Fragment,null,T.createElement("p",null,"Please confirm removal of this member from this organization."),T.createElement("div",{className:"simpleCard",style:{marginBottom:"1em"}},T.createElement(mn,{member:t,avatarSize:20})),T.createElement("p",null,"This user as well as members of this organization will receive a notification of the removal."),T.createElement("p",null,"Any Narratives associated by this member with this Organization will be unaffected. This member will also retain any Narrative permissions granted through this Organization."));return T.createElement(Rt.a,{title:"Confirm Removal of Member",width:"50em",visible:!0,onOk:function(){e.props.onRemoveMember(t.username),e.setState({confirmMemberRemoval:null})},onCancel:function(){e.setState({confirmMemberRemoval:null})},okText:"Confirm"},r)}}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.onConfirmRemoveMember(t)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=T.createElement(wt.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},T.createElement(wt.a.Item,{key:"promoteToAdmin"},T.createElement(ht.a,{type:"unlock"}),"Promote to Admin"),T.createElement(wt.a.Item,{key:"removeMember"},T.createElement(ht.a,{type:"delete"}),"Remove Member"));return T.createElement("div",null,T.createElement(gt.a,{overlay:r,trigger:["click"]},T.createElement(ht.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=T.createElement(wt.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},T.createElement(wt.a.Item,{key:"demoteToMember"},T.createElement(ht.a,{type:"user"}),"Demote to Member"));return T.createElement("div",null,T.createElement(gt.a,{overlay:r,trigger:["click"]},T.createElement(ht.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderOwnerMenu",value:function(e){return T.createElement("div",null)}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===pe.OWNER||this.props.relation.type===pe.ADMIN)switch(e.type){case Oe.OWNER:return this.renderOwnerMenu(e);case Oe.ADMIN:return this.renderAdminMenu(e);case Oe.MEMBER:return this.renderMemberMenu(e)}}},{key:"renderMembers",value:function(){var e,t=this,r=T.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No members");return e=0===this.props.members.length?T.createElement(Et.a,{type:"info",message:r}):this.props.members.map(function(e){var r=["Members-row","simpleCard"];return null!==t.props.organization.lastVisitedAt&&t.props.organization.lastVisitedAt.getTime()<e.joinedAt.getTime()&&r.push("Members-newMember"),T.createElement("div",{className:r.join(" "),key:e.username},T.createElement("div",{className:"Members-member"},T.createElement(mn,{member:e,avatarSize:50})),T.createElement("div",{className:"Members-menu"},t.renderMemberOptions(e)))}),T.createElement("div",{className:"infoTable"},e)}},{key:"renderSearchBar",value:function(){var e=this;return T.createElement("div",{style:{paddingRight:"6px"}},T.createElement(Mr.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter members by name",onChange:function(t){e.props.onSearchMembers(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return T.createElement(T.Fragment,null,T.createElement("span",{className:"field-label"},"sort"),T.createElement(rr.a,{onChange:function(t){e.props.onSortMembers(t)},style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortMembersBy},T.createElement(rr.a.Option,{value:"name",key:"name"},"Name"),T.createElement(rr.a.Option,{value:"added",key:"added"},"Date Joined")))}},{key:"renderHeader",value:function(){return T.createElement("div",{className:"ViewOrganizationMembers-headerRow"},T.createElement("div",{className:"ViewOrganizationMembers-searchCol"},this.renderSearchBar()),T.createElement("div",{className:"ViewOrganizationMembers-sortCol"},this.renderSortBar()))}},{key:"render",value:function(){var e;return this.state.confirmMemberRemoval&&(e=this.renderConfirmMemberRemoval()),T.createElement(T.Fragment,null,T.createElement("div",{className:"ViewOrganizationMembers scrollable-flex-column"},T.createElement("div",{className:"ViewOrganizationMembers-header"},this.renderHeader()),T.createElement("div",{className:"ViewOrganizationMembers-body scrollable-flex-column"},this.renderMembers())),e)}}]),t}(T.Component));var pn=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onViewMembersUnload:function(){e({type:Q.VIEW_ORG_VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(on(t))},onDemoteAdminToMember:function(t){e(sn(t))},onRemoveMember:function(t){e(ln(t))},onSearchMembers:function(t){e(function(e){return function(t,r){t({type:Q.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===S.NORMAL){var a=Ue(n.organization.members,{sortBy:n.sortMembersBy,searchBy:e});t({type:Q.VIEW_ORG_SEARCH_MEMBERS_SUCCESS,searchBy:e,members:a})}else t({type:Q.VIEW_ORG_SORT_MEMBERS_ERROR,error:an({code:"error",message:"Wrong org view model kind!"})});else t({type:Q.VIEW_ORG_SORT_MEMBERS_ERROR,error:an({code:"error",message:"No view model"})})}}(t))},onSortMembers:function(t){e(function(e){return function(t,r){t({type:Q.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(null!==n)if(n.kind===S.NORMAL){var a=n.organization.members,i=n.searchMembersBy,o=Ue(a,{sortBy:e,searchBy:i});t({type:Q.VIEW_ORG_SORT_MEMBERS_SUCCESS,members:o,sortBy:e})}else t({type:Q.VIEW_ORG_SORT_MEMBERS_ERROR,error:an({code:"error",message:"Wrong org view model kind!"})});else t({type:Q.VIEW_ORG_SORT_MEMBERS_ERROR,error:an({code:"error",message:"No view model"})})}}(t))}}})(vn);function On(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===S.NORMAL){t.next=8;break}return r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:Q.VIEW_ORG_REJECT_INBOX_REQUEST_START}),o=a.auth.authorization,s=o.token,l=o.username,c=a.app.config,u=new ge({token:s,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,u.denyRequest(e);case 14:return t.next=16,u.getRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:Q.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:Q.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}function hn(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:Q.VIEW_ORG_CANCEL_JOIN_REQUEST_START}),a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=6;break}return r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 6:if(i.kind===S.NORMAL){t.next=9;break}return r({type:Q.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 9:return o=a.auth.authorization,s=o.token,l=o.username,c=a.app.config,u=new ge({token:s,username:l,groupsServiceURL:c.services.Groups.url}),t.prev=11,t.next=14,u.cancelRequest(e);case 14:return t.next=16,u.getRequestOutboxForOrg(i.organization.id);case 16:E=t.sent,r({type:Q.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:Q.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:an({code:"error",message:t.t0.message})});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}var Rn;r(274),r(276);function wn(e){switch(e){case Rn.COMPACT:return Rn.NORMAL;case Rn.NORMAL:return Rn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Rn||(Rn={}));var gn=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={view:Rn.COMPACT},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onToggleView",value:function(){this.setState({view:wn(this.state.view)})}},{key:"renderCompact",value:function(){return T.createElement(T.Fragment,null,T.createElement("div",{className:"controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Rn.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===Rn.NORMAL?"up":"down")}))),T.createElement("div",{className:"avatarCol"},T.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),T.createElement("div",{className:"infoCol"},T.createElement("div",{className:"name"},T.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),T.createElement("div",null,this.props.user.username)))}},{key:"renderNormal",value:function(){return T.createElement(T.Fragment,null,T.createElement("div",{className:"controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Rn.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===Rn.NORMAL?"up":"down")}))),T.createElement("div",{className:"avatarCol"},T.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),T.createElement("div",{className:"infoCol"},T.createElement("div",{className:"name"},T.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),T.createElement("div",null,this.props.user.username),T.createElement("div",{className:"organization"},this.props.user.organization||T.createElement("i",null,"no organization in user profile")),T.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||T.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case Rn.COMPACT:return T.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case Rn.NORMAL:return T.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(T.Component),_n=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return this.props.user?T.createElement(gn,{user:this.props.user,avatarSize:this.props.avatarSize}):T.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(T.Component);var fn,Sn=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(Ht(t))}}})(_n);r(278);function An(e){switch(e){case fn.COMPACT:return fn.NORMAL;case fn.NORMAL:return fn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(fn||(fn={}));var Nn=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={view:fn.COMPACT},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onToggleView",value:function(){this.setState({view:An(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?T.createElement(Ot.a,{title:"This narrative is viewable by all KBase users",placement:"right"},T.createElement("span",{style:{cursor:"help"}},T.createElement(ht.a,{type:"global"})," Public Narrative")):T.createElement(Ot.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},T.createElement("span",{style:{cursor:"help"}},T.createElement(ht.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case Gt.VIEW:t=T.createElement("span",null,"View-Only (",T.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.EDIT:t=T.createElement("span",null,"Edit (",T.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.ADMIN:t="Admin";break;case Gt.OWNER:t="Owner";break;default:t="Unknown"}return T.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===fn.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===fn.NORMAL?"up":"down")}))),T.createElement("div",{className:"iconCol"},T.createElement(ht.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),T.createElement("div",{className:"mainCol"},T.createElement("div",{className:"Narrative-title"},T.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",T.createElement("div",{className:"Narrative-owner"},T.createElement(Sn,{avatarSize:20,userId:e.owner}))))}},{key:"renderNormal",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===fn.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===fn.NORMAL?"up":"down")}))),T.createElement("div",{className:"iconCol"},T.createElement(ht.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),T.createElement("div",{className:"mainCol"},T.createElement("div",{className:"mainCol"},T.createElement("div",{className:"Narrative-title"},T.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",T.createElement("div",{className:"Narrative-owner"},T.createElement(Sn,{avatarSize:20,userId:e.owner}))),T.createElement("div",{className:"Narrative-attributes"},T.createElement("div",{className:"Narrative-userPermission"},T.createElement(ht.a,{type:"crown"})),T.createElement("div",{className:"Narrative-global"},T.createElement(ht.a,{type:"global"}))),T.createElement("div",null,this.renderPublicPermission(e)),T.createElement("div",null,T.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),T.createElement("div",null,T.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),T.createElement("div",null,T.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===Gt.NONE)return T.createElement("div",null,T.createElement(ht.a,{type:"exclamation-circle",style:{color:"orange"}})," ","You don't have access to this Narrative");switch(this.state.view){case fn.COMPACT:return T.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case fn.NORMAL:return T.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(T.Component),bn=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return this.props.narrative?T.createElement(Nn,{narrative:this.props.narrative}):T.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(T.Component);var In=Object(P.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Ft(t))}}})(bn),Tn=(r(280),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onAcceptRequest",value:function(){this.props.onAcceptInboxRequest(this.props.request)}},{key:"onRejectRequest",value:function(){this.props.onRejectInboxRequest(this.props.request)}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return T.createElement("div",null,T.createElement("div",{className:"miniDetail"},T.createElement(In,{workspaceId:parseInt(e.narrativeId,10)})))}case le.INVITATION:switch(e.resourceType){case ce.USER:return T.createElement("div",null,T.createElement("div",{className:"miniDetail"},T.createElement(Sn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return T.createElement(Sn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.APP:return"REQUEST to associate App";case ce.USER:return"REQUEST to join Organization";case ce.WORKSPACE:return"REQUEST to associate Narrative"}case le.INVITATION:switch(e.resourceType){case ce.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return T.createElement("div",null,T.createElement("div",{className:"miniDetail"},T.createElement(In,{workspaceId:parseInt(e.narrativeId,10)})),T.createElement("div",{className:"cardSectionHeader"},"with organization"))}case le.INVITATION:switch(e.resourceType){case ce.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),T.createElement("div",{className:"cardSectionHeader"},"from"),T.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),T.createElement("div",{className:"miniDetail"},T.createElement(In,{workspaceId:parseInt(e.narrativeId,10)})),T.createElement("div",{className:"cardSectionHeader"},"from"),T.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return T.createElement("div",{style:{textAlign:"center"}},T.createElement(tr.a.Group,{style:{marginTop:"4px"}},T.createElement(tr.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},T.createElement(ht.a,{type:"check"}),"Accept"),T.createElement(tr.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},T.createElement(ht.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),T.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),T.createElement("div",{className:"cardSectionHeader"},"from"),T.createElement(Sn,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.USER:return this.renderJoinRequest(e);case ce.WORKSPACE:return this.renderWorkspaceRequest(e);case ce.APP:return T.createElement(T.Fragment,null,T.createElement("div",null,"apps not supported yet"))}case le.INVITATION:switch(e.resourceType){case ce.USER:return this.renderUserInvitation(e);case ce.WORKSPACE:case ce.APP:return T.createElement(T.Fragment,null,T.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return T.createElement("div",{key:e.id,className:"InboxRequest kbCard"},T.createElement("div",{className:"kbCard-header"},T.createElement("div",{className:"InboxRequest-requestHeaderRow"},T.createElement("div",{className:"InboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),T.createElement("div",{className:"InboxRequest-requestHeaderExpireAt"},T.createElement("span",{className:"field-label"},"expires")," ",Zt(e.expireAt)))),T.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(T.Component));var yn=Object(P.b)(function(e,t){return{}},function(e){return{onAcceptInboxRequest:function(t){e(en(t.id))},onRejectInboxRequest:function(t){e(On(t.id))}}})(Tn),Mn=(r(282),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return T.createElement("div",null,T.createElement("div",{className:"miniDetail"},T.createElement(In,{workspaceId:parseInt(e.narrativeId,10)})))}case le.INVITATION:switch(e.resourceType){case ce.USER:return T.createElement("div",null,T.createElement("div",{className:"miniDetail"},T.createElement(Sn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return T.createElement(Sn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.APP:return"REQUEST to associate App";case ce.USER:return"REQUEST to join Organization";case ce.WORKSPACE:return"REQUEST to associate Narrative"}case le.INVITATION:switch(e.resourceType){case ce.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return T.createElement("div",null,T.createElement("div",{className:"miniDetail"},T.createElement(In,{workspaceId:parseInt(e.narrativeId,10)})),T.createElement("div",{className:"cardSectionHeader"},"with organization"))}case le.INVITATION:switch(e.resourceType){case ce.USER:return T.createElement(Sn,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),T.createElement("div",{className:"miniDetail"},T.createElement(In,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return T.createElement("div",{style:{textAlign:"center"}},T.createElement(tr.a.Group,{style:{marginTop:"4px"}},T.createElement(tr.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},T.createElement(ht.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),T.createElement("div",{className:"cardSectionHeader"},"sent to"),T.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case le.REQUEST:switch(e.resourceType){case ce.USER:return this.renderJoinRequest(e);case ce.WORKSPACE:return this.renderWorkspaceRequest(e);case ce.APP:return T.createElement(T.Fragment,null,T.createElement("div",null,"apps not supported yet"))}case le.INVITATION:switch(e.resourceType){case ce.USER:return this.renderUserInvitation(e);case ce.WORKSPACE:case ce.APP:return T.createElement(T.Fragment,null,T.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return T.createElement("div",{key:e.id,className:"OutboxRequest kbCard"},T.createElement("div",{className:"kbCard-header"},T.createElement("div",{className:"OutboxRequest-requestHeaderRow"},T.createElement("div",{className:"OutboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),T.createElement("div",{className:"OutboxRequest-requestHeaderExpireAt"},T.createElement("span",{className:"field-label"},"expires")," ",Zt(e.expireAt)))),T.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(T.Component));var Cn=Object(P.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e(hn(t.id))}}})(Mn),Dn=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("/#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){Rt.a.info({title:"Manage Requests Help",width:"50em",content:T.createElement("div",null,T.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:T.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderLoadingHeader",value:function(){var e=T.createElement("span",null,"Loading Org Editor...");return T.createElement(nn,{breadcrumbs:e})}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=T.createElement("span",null,T.createElement(ht.a,{type:"user"}),T.createElement(ht.a,{type:"arrow-right"}),T.createElement(ht.a,{type:"team"})," ","Request to Join Group"),n=[T.createElement(tr.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),T.createElement(tr.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return T.createElement(tn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},T.createElement("table",{className:"Requests-pendingRequestsTable"},T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"from"),T.createElement("td",{className:"Requests-requester"},T.createElement(Sn,{userId:e.requester,avatarSize:50}))),T.createElement("tr",null,T.createElement("th",null,"sent"),T.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),T.createElement("tr",null,T.createElement("th",null,"expires"),T.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=T.createElement("span",null,T.createElement(ht.a,{type:"team"}),T.createElement(ht.a,{type:"mail"}),T.createElement(ht.a,{type:"arrow-right"}),T.createElement(ht.a,{type:"user"})," ","Invitation to Join Group"),n=[T.createElement(tr.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e)}},"Cancel")];return T.createElement(tn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},T.createElement("table",{className:"Requests-pendingRequestsTable"},T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"invitation to"),T.createElement("td",{className:"Requests-requester"},T.createElement(Sn,{userId:e.user,avatarSize:30}))),T.createElement("tr",null,T.createElement("th",null,"sent"),T.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),T.createElement("tr",null,T.createElement("th",null,"expires"),T.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case he.NONE:return"None";case he.VIEW:return"View Only";case he.EDIT:return"Edit";case he.ADMIN:return"Admin";case he.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=T.createElement("span",null,T.createElement(ht.a,{type:"file"}),T.createElement(ht.a,{type:"arrow-right"}),T.createElement(ht.a,{type:"team"})," ","Request to Add Narrative"),a=[T.createElement(tr.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e)}},"Approve"),T.createElement(tr.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e)}},"Deny")];return t=T.createElement(In,{workspaceId:parseInt(e.narrativeId,10)}),T.createElement(tn.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},T.createElement("table",{className:"Requests-pendingRequestsTable"},T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"from"),T.createElement("td",{className:"Requests-requester"},T.createElement(Sn,{userId:e.requester,avatarSize:30}))),T.createElement("tr",null,T.createElement("th",null,"narrative"),T.createElement("td",{className:"Requests-narrative"},t)),T.createElement("tr",null,T.createElement("th",null,"sent"),T.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),T.createElement("tr",null,T.createElement("th",null,"expires"),T.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=T.createElement("span",null,T.createElement(ht.a,{type:"appstore"}),T.createElement(ht.a,{type:"arrow-right"}),T.createElement(ht.a,{type:"team"})," ","Request to Add App"),n=[T.createElement(tr.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),T.createElement(tr.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return T.createElement(tn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},T.createElement("table",{className:"Requests-pendingRequestsTable"},T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"from"),T.createElement("td",{className:"Requests-requester"},T.createElement(Sn,{userId:e.requester,avatarSize:50}))),T.createElement("tr",null,T.createElement("th",null,"app"),T.createElement("td",{className:"Requests-requester"},e.appId)),T.createElement("tr",null,T.createElement("th",null,"sent"),T.createElement("td",{className:"Requests-createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),T.createElement("tr",null,T.createElement("th",null,"expires"),T.createElement("td",{className:"Requests-expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderInbox",value:function(){var e;if(0===this.props.inbox.length)e=T.createElement(Et.a,{type:"info",message:"No pending requests"});else{var t=this.props.inbox.map(function(e){return T.createElement("div",{key:e.id},T.createElement(yn,{request:e}))});e=T.createElement("div",{style:{overflowY:"auto"}},t)}return T.createElement(T.Fragment,null,e)}},{key:"renderOutbox",value:function(){var e;if(0===this.props.outbox.length)e=T.createElement(Et.a,{type:"info",message:"No pending requests"});else{var t=this.props.outbox.map(function(e){return T.createElement("div",{key:e.id},T.createElement(Cn,{request:e}))});e=T.createElement("div",{style:{overflowY:"auto"}},t)}return T.createElement(T.Fragment,null,e)}},{key:"isAdmin",value:function(e){return e.type===pe.ADMIN||e.type===pe.OWNER}},{key:"render",value:function(){if(this.isAdmin(this.props.relation)){var e=this.props.outbox.length,t=this.props.inbox.length;return T.createElement("div",{className:"Requests"},T.createElement("div",{className:"Requests-tabPaneHeader"},"inbox (",t,")"),this.renderInbox(),T.createElement("div",{className:"Requests-tabPaneHeader"},"outbox (",e,")"),this.renderOutbox())}var r=this.props.outbox.length;return T.createElement("div",{className:"Requests"},T.createElement("div",{className:"Requests-tabPaneHeader"},"outbox (",r,")"),this.renderOutbox())}}]),t}(T.Component);var Vn=Object(P.b)(function(e,t){return{}},function(e){return{onAcceptJoinRequest:function(t){e(en(t.id))},onDenyJoinRequest:function(t){e(On(t.id))},onCancelJoinInvitation:function(t){e(hn(t.id))},onGetViewAccess:function(e){}}})(Dn);r(288);function kn(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var Un=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onToggleView",value:function(){this.setState({view:kn(this.state.view)})}},{key:"renderLogo",value:function(e){return T.createElement(pt,{logoUrl:e.logoUrl,size:80,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(!e.homeUrl)return T.createElement(Ot.a,{placement:"bottomRight",title:"This organization has not set a home page url"},T.createElement(ht.a,{type:"home",style:{color:"rgba(200, 200, 200, 0.3)"}}));var t=T.createElement(T.Fragment,null,T.createElement("p",null,"Home page for this Organization (external to KBase)"));return T.createElement("div",{className:"BriefOrganizationHeader-homeUrl"},T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:t},T.createElement("a",{href:e.homeUrl,target:"_blank"},T.createElement(ht.a,{type:"home"}))))}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?T.createElement("span",null,e.narrativeCount):T.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return 1==e.memberCount?T.createElement("span",{style:{color:"gray"}},"\xd8"):T.createElement("span",null,e.memberCount-1)}},{key:"renderRelation",value:function(e){switch(e.relation){case pe.NONE:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},T.createElement("span",null,T.createElement(ht.a,{type:"stop"})));case pe.VIEW:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},T.createElement(ht.a,{type:"stop"}));case pe.MEMBER_REQUEST_PENDING:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"Your membership request is pending"},T.createElement(ht.a,{type:"user",style:{color:"orange"}})," Your membership ",T.createElement("b",null,"request")," is pending");case pe.MEMBER_INVITATION_PENDING:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this organization"},T.createElement(ht.a,{type:"user",style:{color:"blue"}}));case pe.MEMBER:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},T.createElement(ht.a,{type:"user"}));case pe.ADMIN:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an administrator of this organization"},T.createElement(ht.a,{type:"robot"}));case pe.OWNER:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are the owner of this organization"},T.createElement(ht.a,{type:"crown"}))}}},{key:"renderPrivacy",value:function(){return this.props.organization.isPrivate?T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is private - may only be viewed by members"},T.createElement("span",null,T.createElement(ht.a,{type:"unlock"}))):T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is public - may be viewed by any KBase user"},T.createElement("span",null,T.createElement(ht.a,{type:"global"})))}},{key:"renderOrgFreshness",value:function(e){var t;if(e.lastVisitedAt&&e.modifiedAt.getTime()>e.lastVisitedAt.getTime()){t=T.createElement("div",null,T.createElement(Ot.a,{placement:"topRight",title:"This org has changed since your last visit to it; new or updated items are highlighted"},T.createElement("span",{style:{color:"red",fontSize:"120%"}},T.createElement(ht.a,{type:"bell",theme:"filled"}))))}else t=T.createElement("div",null,T.createElement("span",{style:{color:"transparent",fontSize:"120%"}},T.createElement(ht.a,{type:"bell",theme:"filled"})));var r;return r=null,T.createElement("div",null,t,r)}},{key:"renderRequests",value:function(){if(this.props.organization.relation===pe.ADMIN||this.props.organization.relation===pe.OWNER){var e,t;switch(this.props.openRequestsStatus){case we.NONE:e="There are no open requests for this organization",t="rgba(200, 200, 200, 0.3)";break;case we.NEW:e="There are new requests since you last visited this organization",t="red";break;case we.OLD:e="There are open requests for this organization",t="blue";break;case we.INAPPLICABLE:return;default:return void console.warn("Invalid open request status: "+this.props.openRequestsStatus)}var r=T.createElement("span",null,e);return T.createElement(Ot.a,{placement:"topRight",title:r},T.createElement("span",{style:{color:t,fontSize:"80%"}},T.createElement(ht.a,{type:"mail",theme:"filled"})))}}},{key:"renderPermalink",value:function(){var e=T.createElement("div",null,T.createElement("p",null,'Below is the "permalink" for this organization. You may copy this url and use it to access this organization in a web browser.'),T.createElement("p",{style:{fontFamily:"monospace",fontWeight:"bold"}},window.location.origin,"/#org/",this.props.organization.id)),t=T.createElement(wt.a,{onClick:function(t){t.key;Rt.a.info({title:"Org Permalink",content:e})}},T.createElement(wt.a.Item,{key:"view"},"View Permalink"));return T.createElement(gt.a,{overlay:t,trigger:["click","contextMenu"]},T.createElement("a",{href:"/#orgs/"+this.props.organization.id},T.createElement(ht.a,{type:"link"})))}},{key:"renderLogoColumn",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"BriefOrganizationHeader-logoRow"},T.createElement(dt.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),T.createElement("div",{className:"BriefOrganizationHeader-statusRow"},T.createElement("div",{className:"BriefOrganizationHeader-relationCol"},this.renderRelation(e)),T.createElement("div",{className:"BriefOrganizationHeader-privacyCol"},this.renderPrivacy()),T.createElement("div",{className:"BriefOrganizationHeader-homeLinkCol"},this.renderHomeUrl(e))),T.createElement("div",{className:"BriefOrganizationHeader-freshnessRow"},T.createElement("div",{className:"BriefOrganizationHeader-orgFreshnessCol"},this.renderOrgFreshness(e)),T.createElement("div",{className:"BriefOrganizationHeader-openRequestsCol"},this.renderRequests()),T.createElement("div",{className:"BriefOrganizationHeader-openNewRequestsCol"},this.renderPermalink())))}},{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderInfoCol",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"BriefOrganizationHeader-orgName BriefOrganizationHeader-infoTableRow"},T.createElement(dt.a,{to:"/viewOrganization/".concat(e.id)},e.name)),T.createElement("div",{className:"BriefOrganizationHeader-researchInterests BriefOrganizationHeader-infoTableRow"},e.researchInterests),T.createElement("div",{className:"BriefOrganizationHeader-orgOwner BriefOrganizationHeader-infoTableRow"},T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},T.createElement("span",{className:"field-label BriefOrganizationHeader-fieldLabel"},"owner")),T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},T.createElement(Jt,{username:e.owner.username,avatarSize:16,showAvatar:!1}))),T.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},T.createElement("span",{className:"field-label BriefOrganizationHeader-fieldLabel"},"created")),T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:this.fullTimestamp(e.createdAt)},T.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))))),T.createElement("div",{className:"BriefOrganizationHeader-orgOwner BriefOrganizationHeader-infoTableRow"},T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},T.createElement("span",{className:"field-label"},"updated")),T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},T.createElement(Yt,{time:e.modifiedAt,showTooltip:!1}))))}},{key:"renderMemberRow",value:function(e){var t,r=e.memberCount-1;return t=r?1===r?T.createElement("span",null,"There is ",T.createElement("b",null,"1")," member in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,r)," members in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,"no members")," in this organization"),T.createElement(Ot.a,{placement:"bottomRight",title:t},T.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"team"}))),T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},this.renderMemberCount(e))))}},{key:"renderNarrativeRow",value:function(e){var t,r=e.narrativeCount;return t=r?1===r?T.createElement("span",null,"There is ",T.createElement("b",null,"1")," narrative in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,r)," narratives in this organization"):T.createElement("span",null,"There are ",T.createElement("b",null,"no narratives")," in this organization"),T.createElement(Ot.a,{placement:"bottomRight",title:t},T.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"file"}))),T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},this.renderNarrativeCount(e))))}},{key:"renderModifiedRow",value:function(e){var t=T.createElement("span",null,"This organization was last updated"," ",T.createElement(Yt,{time:e.modifiedAt,showTooltip:!1}));return T.createElement(Ot.a,{placement:"bottomRight",title:t},T.createElement("div",{className:"BriefOrganizationHeader-orgCreated BriefOrganizationHeader-infoTableRow"},T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol1"},T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"save"}))),T.createElement("div",{className:"BriefOrganizationHeader-infoTableCol2"},T.createElement(Yt,{time:e.modifiedAt,showTooltip:!1}))))}},{key:"renderButtonsRow",value:function(){return T.createElement("div",{className:"ButtonSet"},T.createElement("div",{className:"ButtonSet-button"},this.props.orgMenu))}},{key:"renderStatsCol",value:function(e){return T.createElement("div",{className:"BriefOrganizationHeader-buttonsCol"},T.createElement("div",{className:"BriefOrganizationHeader-buttonsRow",style:{marginBottom:"10px"}},T.createElement("div",{className:"ButtonSet"},T.createElement("div",{className:"IconButton",onClick:this.props.onNavigateToBrowser,style:{color:"red"}},T.createElement(ht.a,{type:"close"})))),T.createElement("div",{className:"BriefOrganizationHeader-buttonsRow"},this.renderButtonsRow()))}},{key:"renderNormal",value:function(){var e=this.props.organization;return T.createElement("div",{className:"BriefOrganization"},T.createElement("div",{className:"BriefOrganizationHeader-body"},T.createElement("div",{className:"BriefOrganizationHeader-logoCol"},this.renderLogoColumn(e)),T.createElement("div",{className:"BriefOrganizationHeader-infoCol"},T.createElement("div",{className:"BriefOrganizationHeader-infoCol-row"},T.createElement("div",{className:"BriefOrganizationHeader-infoCol-col1"},this.renderInfoCol(e)),T.createElement("div",{className:"BriefOrganizationHeader-infoCol-col2"},this.renderStatsCol(e))))))}},{key:"render",value:function(){return this.renderNormal()}}]),t}(T.Component);r(290);var zn=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderLogo",value:function(e){return T.createElement(pt,{logoUrl:e.logoUrl,size:30,organizationName:e.name,organizationId:e.id})}},{key:"render",value:function(){var e=this.props.organization;return T.createElement("div",{className:"OrganizationEntity-Accessible "},T.createElement("div",{className:"OrganizationEntity-Accessible-logoCol"},this.renderLogo(e)),T.createElement("div",{className:"OrganizationEntity-Accessible-mainCol"},T.createElement("div",{className:"OrganizationEntity-Accessible-name"},T.createElement(dt.a,{to:"/viewOrganization/".concat(e.id)},e.name)),T.createElement("div",{className:"OrganizationEntity-Accessible-researchInterests"},e.researchInterests),T.createElement("div",{className:"OrganizationEntity-Accessible-owner"},T.createElement(Jt,{username:e.owner.username,showAvatar:!1,avatarSize:20}))))}}]),t}(T.Component),jn=(r(292),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return T.createElement("div",{className:"OrganizationEntity-Inaccessible "},T.createElement("div",{className:"OrganizationEntity-Inaccessible-logoCol"},T.createElement(ht.a,{type:"lock"})),T.createElement("div",{className:"OrganizationEntity-Inaccessible-mainCol"},T.createElement("div",{className:"OrganizationEntity-Inaccessible-name"},"Private Organization")))}}]),t}(T.Component));var Gn=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){if(!this.props.organization)return T.createElement("div",null,T.createElement(ht.a,{type:"loading"}));switch(this.props.organization.kind){case Re.NORMAL:return T.createElement(zn,{organization:this.props.organization});case Re.INACCESSIBLE_PRIVATE:return T.createElement(jn,{organization:this.props.organization});default:return T.createElement("div",null,"Error: unrecognized org kind")}}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(T.Component);var Ln=Object(P.b)(function(e,t){return{organization:e.entities.organizations.byId.get(t.organizationId)||null}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:Q.ENTITY_ORGANIZATION_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,c=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=3,t.next=6,c.getOrg(e);case 6:u=t.sent,r({type:Q.ENTITY_ORGANIZATION_LOAD_SUCCESS,organization:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:Q.ENTITY_ORGANIZATION_LOAD_ERROR,error:an({code:t.t0.name,message:t.t0.message})});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(Gn),Bn=r(357),Pn=(r(294),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.props.onManageRelatedOrgs()}},{key:"renderToolbar",value:function(){return T.createElement("div",{className:"RelatedOrganizations-toolbar"},T.createElement(tr.a,{onClick:this.onManageRelatedOrgs.bind(this)},"Add Related Org"))}},{key:"onAdminMenu",value:function(e,t){switch(e){case"removeRelation":this.props.onRemoveRelatedOrganization(this.props.organization.id,t)}}},{key:"renderControls",value:function(e){var t=this;if(this.props.organization.isAdmin){var r=T.createElement(wt.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},T.createElement(wt.a.Item,{key:"removeRelation"},T.createElement(ht.a,{type:"delete"}),"Remove"));return T.createElement("div",null,T.createElement(gt.a,{overlay:r,trigger:["click"]},T.createElement(ht.a,{type:"ellipsis",className:"IconButton-hover"})))}}},{key:"renderBody",value:function(){var e=this;if(0===this.props.relatedOrganizations.length){var t=T.createElement("p",null,"No related organizations");return T.createElement(Et.a,{type:"info",message:t})}var r=Object(Bn.a)(Ln),n=this.props.relatedOrganizations.map(function(t){return T.createElement("div",{key:t,className:"RelatedOrganizations-orgRow simpleCard"},T.createElement("div",{className:"RelatedOrganizations-orgCol"},T.createElement(r,{organizationId:t})),T.createElement("div",{className:"RelatedOrganizations-controlCol"},e.renderControls(t)))});return T.createElement("div",{className:"RelatedOrganizations-organizations"},n)}},{key:"render",value:function(){return T.createElement("div",{className:"RelatedOrganizations scrollable-flex-column"},T.createElement("div",{className:"RelatedOrganizations-bodyRow scrollable-flex-column"},this.renderBody()))}}]),t}(T.Component));var xn=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onRemoveRelatedOrganization:function(t,r){e(function(e,t){return function(){var r=Object(oe.a)(ie.a.mark(function r(n,a){var i,o,s,l,c,u;return ie.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:Q.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),o=i.auth.authorization,s=o.token,l=o.username,c=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new ze({token:s,username:l,groupsServiceURL:c.services.Groups.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:Q.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:Q.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:Be({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))}}})(Pn),Wn=(r(296),r(298),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderRelated",value:function(){if(this.props.selectableOrganization.isRelated)return T.createElement(ht.a,{type:"check",style:{color:"green"}})}},{key:"render",value:function(){return T.createElement("div",{className:"AvailableOrganization"},T.createElement("div",{className:"AvailableOrganization-relatedCol"},this.renderRelated()),T.createElement("div",{className:"AvailableOrganization-orgCol"},T.createElement("div",{className:"AvailableOrganization-logoCol"},T.createElement(pt,{logoUrl:this.props.selectableOrganization.organization.logoUrl,size:30,organizationName:this.props.selectableOrganization.organization.name,organizationId:this.props.selectableOrganization.organization.id})),T.createElement("div",{className:"AvailableOrganization-orgInfoCol"},T.createElement("div",{className:"AvailableOrganization-name"},this.props.selectableOrganization.organization.name),T.createElement("div",{className:"AvailableOrganization-owner"},T.createElement(Jt,{username:this.props.selectableOrganization.organization.owner.username,avatarSize:20,showAvatar:!1})))),T.createElement("div",{className:"AvailableOrganization-actionCol"}))}}]),t}(T.Component)),qn=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onAddSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onAddOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"onRemoveSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onRemoveOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"onFilterChange",value:function(e){e.persist(),this.props.onSearch(e.target.value)}},{key:"renderAvailableToolbar",value:function(){return T.createElement("div",{className:"ManageRelatedOrganizations-available-toolbar"},T.createElement(Mr.a,{placeholder:"Filter Available Organizations",onChange:this.onFilterChange.bind(this)}))}},{key:"renderAvailableOrgs",value:function(){var e=this;return this.props.organizations.map(function(t){var r=["simpleCard","ManageRelatedOrganizations-availableOrganization"];return t.isSelected&&r.push("ManageRelatedOrganizations-selected"),T.createElement("div",{className:r.join(" "),onClick:function(){e.props.onSelectOrganization(t)},key:t.organization.id},T.createElement(Wn,{selectableOrganization:t}))})}},{key:"renderSelectedOrg",value:function(){var e,t,r,n={marginBottom:"4px"};if(this.props.selectedOrganization)t=T.createElement("div",{className:"ManageRelatedOrganizations-selectedOrganization"},T.createElement(Xt,{organization:this.props.selectedOrganization.organization,openRequestsStatus:null})),this.props.selectedOrganization.isRelated?(r=T.createElement(Et.a,{type:"warning",message:"This org is associated",style:n}),e=T.createElement(tr.a,{type:"danger",disabled:null===this.props.selectedOrganization,onClick:this.onRemoveSelectedOrganization.bind(this)},"Remove Organization")):e=T.createElement(tr.a,{type:"primary",disabled:null===this.props.selectedOrganization,onClick:this.onAddSelectedOrganization.bind(this)},"Add Organization");else{var a=T.createElement(T.Fragment,null,T.createElement("p",null,"When you select an organization on the left, details about it will be displayed here."));r=T.createElement(Et.a,{type:"info",message:a,style:n}),e=T.createElement(tr.a,{type:"primary",disabled:null===this.props.selectedOrganization,onClick:this.onAddSelectedOrganization.bind(this)},"Add Organization")}return T.createElement(T.Fragment,null,r,t,T.createElement("div",{className:"ManageRelatedOrganizations-buttonBar"},e))}},{key:"render",value:function(){var e=this;return T.createElement("div",{className:"ManageRelatedOrganizations scrollable-flex-column"},T.createElement("div",{className:"ManageRelatedOrganizations-toolbar"},T.createElement(tr.a,{onClick:function(){return e.props.onFinish()},type:"danger"},T.createElement(ht.a,{type:"rollback"})," ","Done")),T.createElement("div",{className:"ManageRelatedOrganizations-main scrollable-flex-column"},T.createElement("div",{className:"ManageRelatedOrganizations-availableOrgs"},T.createElement("h3",{style:{textAlign:"center"}},"Available Organizations"),this.renderAvailableToolbar(),T.createElement("div",{className:"ManageRelatedOrganizations-organizations"},this.renderAvailableOrgs())),T.createElement("div",{className:"ManageRelatedOrganizations-relatedOrgs"},T.createElement("h3",{style:{textAlign:"center"}},"Selected Organization"),this.renderSelectedOrg())))}}]),t}(T.Component);var Hn=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.manageRelatedOrganizationsView.viewModel)throw new Error("argh, null subview view model");var n=r.subViews.manageRelatedOrganizationsView.viewModel;return{organization:n.organization,organizations:n.availableOrganizations.queried,relatedOrganizations:n.relatedOrganizations,selectedOrganization:n.selectedOrganization}},function(e){return{onSelectOrganization:function(t){e(function(e){return{type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION,selectedOrganization:e}}(t))},onAddOrganization:function(t,r){e(function(e,t){return function(){var r=Object(oe.a)(ie.a.mark(function r(n,a){var i,o,s,l,c,u;return ie.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START}),i=a(),o=i.auth.authorization,s=o.token,l=o.username,c=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new ze({token:s,username:l,groupsServiceURL:c.services.Groups.url}),r.prev=5,r.next=8,u.addRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,error:Be({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onRemoveOrganization:function(t,r){e(function(e,t){return function(){var r=Object(oe.a)(ie.a.mark(function r(n,a){var i,o,s,l,c,u;return ie.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),o=i.auth.authorization,s=o.token,l=o.username,c=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new ze({token:s,username:l,groupsServiceURL:c.services.Groups.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:Q.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:Be({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onSearch:function(t){var r;e((r=t,function(){var e=Object(oe.a)(ie.a.mark(function e(t,n){var a,i,o,s,l,c,u,E;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,null!==(c=a.views.viewOrgView.viewModel)){e.next=4;break}throw new Error("view is not populated");case 4:if(c.kind===S.NORMAL){e.next=6;break}throw new Error("view is not normal");case 6:if(null!==(u=c.subViews.manageRelatedOrganizationsView.viewModel)){e.next=9;break}throw new Error("vm is null");case 9:new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url});try{E=Pe(u.availableOrganizations.organizations,r),t({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS,organizations:E,searchBy:r})}catch(d){t({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR,error:Be({code:"error",message:d.message})})}case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()))}}})(qn),Fn=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){var e=T.createElement("div",null,"Loading Related Organizations Manager..."," ",T.createElement(Er.a,null));return T.createElement(Et.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return T.createElement("div",null,"Error!",T.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case b.NONE:case b.LOADING:return this.renderLoading();case b.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return T.createElement(Hn,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case b.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var Qn=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==S.NORMAL)throw new Error("not the right vm");return{view:r.subViews.manageRelatedOrganizationsView}},function(e){return{onLoad:function(){e(function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a,i,o,s,l,c,u,E,d;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,null!==(l=n.views.viewOrgView.viewModel)){e.next=4;break}throw new Error("view is not populated");case 4:if(l.kind===S.NORMAL){e.next=6;break}throw new Error("view is not normal");case 6:return c=l.organization,u=new ze({token:i,username:o,groupsServiceURL:s.services.Groups.url}),e.prev=8,e.next=11,u.getAllOrgs2();case 11:E=e.sent,d=E.map(function(e){return{isRelated:c.relatedOrganizations.includes(e.id),isSelected:!1,organization:e}}),t({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS,organizations:d}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),t({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR,error:Be({code:"error",message:e.t0.message})});case 19:case"end":return e.stop()}},e,this,[[8,16]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:Q.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD})}}})(Fn);function Jn(e){return{type:Q.INVITE_USER_LOAD_ERROR,error:e}}function Zn(e){return{type:Q.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Yn(e){return{type:Q.INVITE_USER_SELECT_USER_ERROR,error:e}}function Kn(e,t){if(e.username===t.owner.username)return pe.OWNER;var r=t.members.find(function(t){return t.username===e.username});if(r)switch(r.type){case c.ADMIN:return pe.ADMIN;case c.OWNER:return pe.OWNER;case c.MEMBER:return pe.MEMBER}return pe.VIEW}function Xn(e){var t=e.views.viewOrgView.viewModel;if(null===t)throw new Error("select user invalid state -- no view value");if(t.kind!==S.NORMAL)throw new Error("select user invalid state -- no view value");var r=t.subViews.inviteUserView;if(null===r)throw new Error("select user invalid state -- no view value");return r}function $n(e){return{type:Q.INVITE_USER_SEND_INVITATION_ERROR,error:e}}function ea(){return function(e,t){e({type:Q.INVITE_USER_SEND_INVITATION_START});var r,n=t();try{r=Xn(n)}catch(E){return void e(Yn(an({code:"invalid state",message:E.message})))}var a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config;if(null!==r.viewModel){var l=r.viewModel,c=l.selectedUser,u=l.organization.id;if(c)new ge({token:i,username:o,groupsServiceURL:s.services.Groups.url}).inviteUserToJoinOrg(u,c.user.username).then(function(t){e({type:Q.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){e($n(an({code:t.name,message:t.message})))})}else e($n(an({code:"error",message:"null view model"})))}}r(300),r(302);var ta=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return T.createElement("div",{className:"User"},T.createElement("div",{className:"avatarCol"},T.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),T.createElement("div",{className:"infoCol"},T.createElement("div",{className:"name"},T.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),T.createElement("div",{className:"organization"},this.props.user.organization||T.createElement("i",null,"no organization in user profile")),T.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||T.createElement("i",null,"no location information in user profile"))))}}]),t}(T.Component),ra=r(240),na=(r(304),function(e){function t(e,r){var n;return Object(D.a)(this,t),(n=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onMenuSelection",value:function(e){}},{key:"renderMenu",value:function(){return T.createElement(ra.a,{render:function(e){e.history;var t=[];switch(e.location.pathname){case"/organizations":t=["allorgs"];break;case"/newOrganization":t=["neworg"]}return T.createElement(wt.a,{selectedKeys:t,style:{backgroundColor:"transparent"},mode:"horizontal"})}})}},{key:"render",value:function(){return T.createElement("div",{className:"MainMenu"},T.createElement("div",{className:"MainMenu-menu"},this.renderMenu()),T.createElement("div",{className:"MainMenu-buttons"},this.props.buttons))}}]),t}(T.Component)),aa=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).lastSearchAt=void 0,r.searchInput=void 0,r.searchButton=void 0,r.lastSearchAt=null,r.searchInput=T.createRef(),r.searchButton=T.createRef(),r.state={autocompleteMessage:""},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onClickCancelToViewer",value:function(){this.props.onFinish()}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"renderOrgName",value:function(e){return e.length<25?e:T.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return T.createElement(Et.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?T.createElement(Et.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===pe.NONE?T.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},T.createElement("div",{className:"name "},t.realname," (",t.username,")")):T.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},T.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return T.createElement("div",{className:"orgInfo"},T.createElement("div",{className:"name"},T.createElement("span",{className:"field-label"},"name"),T.createElement("span",null,this.props.organization.name)),T.createElement("div",{className:"description"},T.createElement("span",{className:"field-label"},"description"),T.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===pe.VIEW?e=T.createElement(tr.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=T.createElement(tr.a,{disabled:!0,type:"primary"},"Send Invitation"),t=T.createElement("div",null,"User may not be invited because:",T.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=T.createElement(Et.a,{type:"warning",message:t,showIcon:!0})):(e=T.createElement(tr.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),T.createElement("div",{className:"invitationForm"},T.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),T.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case w.NONE:return T.createElement("div",null,"NONE");case w.EDITING:return T.createElement("div",null,"EDITING");case w.SENDABLE:return T.createElement("div",null,"SENDABLE");case w.SENDING:return T.createElement("div",null,"SENDING");case w.SUCCESS:return T.createElement("div",null,"SENT SUCCESSFULLY");case w.ERROR:return T.createElement("div",null,"ERROR SENDING");default:return T.createElement("div",null,"Bad State")}}},{key:"renderRelation",value:function(e){switch(e){case pe.NONE:return T.createElement("span",null,T.createElement(ht.a,{type:"stop"}),"None");case pe.VIEW:return T.createElement("span",null,T.createElement(ht.a,{type:"stop"})," Not a member");case pe.MEMBER_REQUEST_PENDING:return T.createElement("span",null,T.createElement(ht.a,{type:"user",style:{color:"orange"}})," User's membership ",T.createElement("b",null,"request")," is pending");case pe.MEMBER_INVITATION_PENDING:return T.createElement("span",null,T.createElement(ht.a,{type:"user",style:{color:"blue"}})," User has been ",T.createElement("b",null,"invited")," to join");case pe.MEMBER:return T.createElement("span",null,T.createElement(ht.a,{type:"user"})," User is a ",T.createElement("b",null,"member")," of this organization");case pe.ADMIN:return T.createElement("span",null,T.createElement(ht.a,{type:"unlock"}),"User is an ",T.createElement("b",null,"admin")," of this organization");case pe.OWNER:return T.createElement("span",null,T.createElement(ht.a,{type:"crown"})," User is the ",T.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?T.createElement("div",{className:"selectedUser"},T.createElement("p",{className:"noSelection"},"No user yet selected")):T.createElement("div",{className:"selectedUser"},T.createElement(ta,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return T.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return T.createElement(ht.a,{type:"search"})}},{key:"renderMenuButtons",value:function(){return T.createElement("div",{className:"ButtonSet"},T.createElement("div",{className:"ButtonSet-button"},T.createElement(tr.a,{icon:"rollback",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Done")))}},{key:"render",value:function(){return T.createElement("div",{className:"InviteUser scrollable-flex-column"},T.createElement(na,{buttons:this.renderMenuButtons()}),T.createElement("div",{className:"row scrollable-flex-column"},T.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},T.createElement("h3",null,"Select User to Invite"),T.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},T.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),T.createElement(tr.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),T.createElement("div",{className:"usersTable"},this.renderUsers())),T.createElement("div",{className:"col1 lastCol"},T.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(T.Component);aa.searchDebounce=200;var ia=aa;var oa=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.inviteUserView.viewModel)throw new Error("argh, null subview view model");return r.subViews.inviteUserView.viewModel},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,u,E,d,m,v,p,O,h,R;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:Q.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(Zn(null)),t.abrupt("return");case 4:if(a=n(),i=a.auth.authorization,o=i.token,i.username,s=a.app.config,null!==(l=a.views.viewOrgView.viewModel)){t.next=7;break}throw new Error("view is not populated");case 7:if(l.kind===S.NORMAL){t.next=9;break}throw new Error("view is not normal");case 9:return u=l.organization,E=new Mt({token:o,userProfileServiceURL:s.services.UserProfile.url}),d=u.owner.username,m=[],v=[],p=[],O=[],u.members.forEach(function(e){switch(e.type){case c.MEMBER:v.push(e.username);case c.ADMIN:m.push(e.username)}}),t.prev=17,t.next=20,E.searchUsers(e);case 20:h=t.sent,R=h.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?pe.OWNER:m.indexOf(t)>=0?pe.ADMIN:p.indexOf(t)>=0?pe.MEMBER_INVITATION_PENDING:O.indexOf(t)>=0?pe.MEMBER_REQUEST_PENDING:v.indexOf(t)>=0?pe.MEMBER:pe.NONE}}),r(Zn(R)),t.next=28;break;case 25:t.prev=25,t.t0=t.catch(17),r((w=an({code:t.t0.name,message:t.t0.message}),{type:Q.INVITE_USER_SEARCH_USERS_ERROR,error:w}));case 28:case"end":return t.stop()}var w},t,this,[[17,25]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){var r;e((r=t,function(){var e=Object(oe.a)(ie.a.mark(function e(t,n){var a,i,o,s,l,c,u;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:Q.INVITE_USER_SELECT_USER_START}),a=n(),e.prev=2,i=Xn(a),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),t(Yn(an({code:"invalid state",message:e.t0.message}))),e.abrupt("return");case 10:if(null!==i.viewModel){e.next=13;break}return t(Yn(an({code:"error",message:"missing view model"}))),e.abrupt("return");case 13:return o=a.auth.authorization.token,s=a.app.config,l=new Mt({token:o,userProfileServiceURL:s.services.UserProfile.url}),e.prev=15,e.next=18,l.getUser(r);case 18:c=e.sent,u=Kn(c,i.viewModel.organization),t((E=c,d=u,{type:Q.INVITE_USER_SELECT_USER_SUCCESS,user:E,relation:d})),e.next=26;break;case 23:e.prev=23,e.t1=e.catch(15),t(Yn(an({code:e.t1.name,message:e.t1.message})));case 26:case"end":return e.stop()}var E,d},e,this,[[2,6],[15,23]])}));return function(t,r){return e.apply(this,arguments)}}()))},onSendInvitation:function(){e(ea())}}})(ia),sa=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){var e=T.createElement("div",null,"Loading ..."," ",T.createElement(Er.a,null));return T.createElement(Et.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return T.createElement("div",null,"Error!",T.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case b.NONE:case b.LOADING:return this.renderLoading();case b.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(an({code:"Missing Error",message:"The error appears to be missing"}));default:return T.createElement(oa,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case b.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var la=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==S.NORMAL)throw new Error("not the right vm");return{view:r.subViews.inviteUserView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:Q.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,c=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=3,t.next=6,c.getOrg(e);case 6:if((u=t.sent).kind===Re.NORMAL){t.next=10;break}return r(Jn(an({code:"invalid state",message:'Organization kind must be "NORMAL"'}))),t.abrupt("return");case 10:r((E=u,{type:Q.INVITE_USER_LOAD_SUCCESS,organization:E,users:null})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),r(Jn(an({code:t.t0.name,message:t.t0.message})));case 16:case"end":return t.stop()}var E},t,this,[[3,13]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:Q.INVITE_USER_UNLOAD})}}})(sa),ca=(r(306),r(353)),ua=(r(308),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){var e=T.createElement("div",null,T.createElement("div",null,this.props.user.realname),T.createElement("div",null,T.createElement("span",null,T.createElement(St,{user:this.props.user,size:20}))," ",T.createElement("span",null,this.props.user.username)));return T.createElement("div",{className:"UserSimple"},T.createElement(Ot.a,{title:e,placement:"bottomRight"},T.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))}}]),t}(T.Component)),Ea=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return this.props.user?T.createElement(ua,{user:this.props.user,avatarSize:this.props.avatarSize}):T.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(T.Component);var da,ma=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(Ht(t))}}})(Ea);r(310);function va(e){switch(e){case da.COMPACT:return da.NORMAL;case da.NORMAL:return da.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(da||(da={}));var pa=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={view:da.COMPACT},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onToggleView",value:function(){this.setState({view:va(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?T.createElement(Ot.a,{title:"This narrative is viewable by all KBase users",placement:"right"},T.createElement("span",{style:{cursor:"help"}},T.createElement(ht.a,{type:"global"})," Public Narrative")):T.createElement(Ot.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},T.createElement("span",{style:{cursor:"help"}},T.createElement(ht.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t,r;switch(e.access){case Gt.VIEW:t="eye",r=T.createElement("span",null,"View-Only (",T.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.EDIT:t="edit",r=T.createElement("span",null,"This narrative is shared with you with ",T.createElement("b",null,"edit")," access (",T.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.ADMIN:t="unlock",r=T.createElement("span",null,"This narrative is shared with you with ",T.createElement("b",null,"access")," - you may edit and re-share this");break;case Gt.OWNER:t="crown",r=T.createElement("span",null,"You are the owner of this Narrative")}return T.createElement(Ot.a,{placement:"bottomRight",title:r},T.createElement(ht.a,{type:t}))}},{key:"renderGlobalPermission",value:function(e){var t,r;return e.isPublic?(t="global",r="This narrative has been shared publicly - with all KBase users"):(t="lock",r="This narrative is private - only accessible to the owner any users it has been shared with"),T.createElement(Ot.a,{placement:"bottomRight",title:r},T.createElement(ht.a,{type:t}))}},{key:"renderNiceElapsed",value:function(e){var t=T.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e));return T.createElement(Ot.a,{placement:"bottomRight",title:t},Zt(e))}},{key:"renderCompact",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===da.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===da.NORMAL?"up":"down")}))),T.createElement("div",{className:"mainCol"},T.createElement("div",null,T.createElement("div",{className:"Narrative-title"},T.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",T.createElement("div",{className:"Narrative-owner"},T.createElement(ma,{avatarSize:20,userId:e.owner}))),T.createElement("div",{className:"Narrative-attributes"},T.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),T.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),T.createElement("div",null,T.createElement("span",{className:"field-label"},"updated"),T.createElement(Yt,{time:e.lastSavedAt}))))}},{key:"renderNormal",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"controlCol"},T.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===da.NORMAL?"pressed":"")},T.createElement(ht.a,{type:"".concat(this.state.view===da.NORMAL?"up":"down")}))),T.createElement("div",{className:"mainCol"},T.createElement("div",null,T.createElement("div",{className:"Narrative-title"},T.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",T.createElement("div",{className:"Narrative-owner"},T.createElement(ma,{avatarSize:20,userId:e.owner}))),T.createElement("div",{className:"Narrative-attributes"},T.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),T.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),T.createElement("div",null,T.createElement("span",{className:"field-label"},"last saved"),this.renderNiceElapsed(e.lastSavedAt)),T.createElement("div",null,T.createElement("span",{className:"field-label"},"by"),T.createElement(ma,{avatarSize:20,userId:e.lastSavedBy}))))}},{key:"renderNarrative",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"mainCol"},T.createElement("div",null,T.createElement("div",{className:"Narrative-title"},T.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",T.createElement("div",{className:"Narrative-owner"},T.createElement(ma,{avatarSize:20,userId:e.owner}))),T.createElement("div",{className:"Narrative-attributes"},T.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),T.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),T.createElement("div",null,T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"save"})),T.createElement(Yt,{time:e.lastSavedAt,tooltipPrefix:"last saved "}))))}},{key:"render",value:function(){var e=this.props.narrative;return e.access===Gt.NONE?T.createElement("div",null,"You don't have access to this Narrative"):this.renderNarrative(e)}}]),t}(T.Component),Oa=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return this.props.narrative?T.createElement(pa,{narrative:this.props.narrative}):T.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(T.Component);var ha=Object(P.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Ft(t))}}})(Oa),Ra=(r(312),function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case he.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=T.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you may obtain personal View-Only access by clicking this button",r=T.createElement(tr.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=T.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=T.createElement(tr.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access"));break;case he.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=T.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=T.createElement(tr.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case he.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=T.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=T.createElement(tr.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case he.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=T.createElement("span",null,"Admin");break;case he.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=T.createElement("span",null,"Owner");break;default:t=T.createElement("span",null,"Unknown")}return T.createElement(T.Fragment,null,T.createElement(Ot.a,{title:n,placement:"right"},T.createElement("span",{style:{cursor:"help"}},T.createElement("span",{className:"field-label"},"your permission"),t))," ",T.createElement(Ot.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?T.createElement(Ot.a,{title:"This narrative is viewable by all KBase users",placement:"right"},T.createElement("span",{style:{cursor:"help"}},T.createElement(ht.a,{type:"global"})," Public Narrative")):T.createElement(Ot.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},T.createElement("span",{style:{cursor:"help"}},T.createElement(ht.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return this.props.organization.isMember?e.permission!==he.NONE||e.isPublic?T.createElement(ha,{workspaceId:e.workspaceId}):T.createElement(T.Fragment,null,T.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},T.createElement("div",{className:"title"},e.title)),T.createElement("div",null,this.renderNarrativePermission(e))):T.createElement(ha,{workspaceId:e.workspaceId})}},{key:"renderResource",value:function(){return T.createElement("div",null,T.createElement("div",null,T.createElement("span",{className:"field-label"},"added"),T.createElement("span",null,T.createElement(Yt,{time:this.props.narrative.createdAt}))))}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=T.createElement(ca.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),T.createElement("div",{className:"OrganizationNarrative"},T.createElement("div",{className:"OrganizationNarrative-narrativeCol"},this.renderNarrative()),e)}}]),t}(T.Component)),wa=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onRequestAddNarrative",value:function(){this.props.onRequestAddNarrative()}},{key:"onRemoveNarrative",value:function(e){var t=this,r=T.createElement(T.Fragment,null,T.createElement("p",null,"Please confirm the removal of this Narrative from this Organization."),T.createElement("p",null,"Any view permission granted to organization members will be unaffected by removing the Narrative."),T.createElement("p",null,"All Organization members and the Narrative owner will receive a notification."));Rt.a.confirm({title:"Confirm",content:r,width:"50em",okText:"Confirm",onOk:function(){t.props.onRemoveNarrative(e)}})}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.onRemoveNarrative(t)}}},{key:"renderNarrativeMenu",value:function(e){var t,r=this;switch(this.props.relation.type){case pe.NONE:break;case pe.VIEW:case pe.MEMBER_REQUEST_PENDING:case pe.MEMBER_INVITATION_PENDING:case pe.MEMBER:break;case pe.ADMIN:case pe.OWNER:t=T.createElement(wt.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},T.createElement(wt.a.Item,{key:"removeNarrative"},T.createElement(ht.a,{type:"delete"})," Remove Narrative from Organization"))}if(t)return T.createElement(gt.a,{overlay:t,trigger:["click"]},T.createElement(ht.a,{type:"ellipsis",className:"IconButton-hover"}))}},{key:"renderSearchBar",value:function(){var e=this;return T.createElement("div",{style:{paddingRight:"6px"}},T.createElement(Mr.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter narratives by title",onChange:function(t){e.props.onSearchNarratives(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return T.createElement(T.Fragment,null,T.createElement("span",{className:"field-label"},"sort"),T.createElement(rr.a,{onChange:function(t){e.props.onSortNarratives(t)},style:{width:"11em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortNarrativesBy},T.createElement(rr.a.Option,{value:"name",key:"name"},"Name"),T.createElement(rr.a.Option,{value:"added",key:"added"},"Date Added"),T.createElement(rr.a.Option,{value:"changed",key:"changed"},"Last Changed")))}},{key:"renderMemberNarratives",value:function(){var e,t=this,r=[T.createElement(tr.a,{key:"addNarrative",size:"small",onClick:this.onRequestAddNarrative.bind(this)},T.createElement(ht.a,{type:"plus"}),"  Add a Narrative")];e=0===this.props.narratives.length?T.createElement(Et.a,{type:"info",message:"No Narratives are yet associated with this Organization"}):this.props.narratives.map(function(e){var r=t.props.organization.lastVisitedAt,n=e.addedAt,a=["ViewOrganization-Narratives-narrative","simpleCard"];return null!==r&&(null!==n&&r.getTime()<n.getTime())&&a.push("ViewOrganization-Narratives-newNarrative"),T.createElement("div",{className:a.join(" "),key:String(e.workspaceId)},T.createElement("div",{className:"ViewOrganization-Narratives-dataCol"},T.createElement(Ra,{narrative:e,organization:t.props.organization,onGetViewAccess:t.props.onGetViewAccess})),T.createElement("div",{className:"ViewOrganization-Narratives-buttonCol"},t.renderNarrativeMenu(e)))});var n=this.props.organization.narrativeCount,a=T.createElement("span",{className:"ViewOrganization-Narratives-title"},T.createElement(ht.a,{type:"folder-open",style:{marginRight:"8px"}}),"Narratives"," ",T.createElement("span",{className:"ViewOrganization-Narratives-titleCount"},"(",n,")"));return T.createElement("div",{className:"ViewOrganization-Narratives scrollable-flex-column"},T.createElement("div",{className:"ViewOrganization-Narratives-header"},T.createElement("div",{className:"ViewOrganization-Narratives-headerCol1"},a),T.createElement("div",{className:"ViewOrganization-Narratives-headerCol2"},r)),T.createElement("div",{className:"ViewOrganization-Narratives-toolbar"},T.createElement("div",{className:"ViewOrganization-Narratives-toolbar-searchCol"},this.renderSearchBar()),T.createElement("div",{className:"ViewOrganization-Narratives-toolbar-sortCol"},this.renderSortBar())),T.createElement("div",{className:"ViewOrganization-Narratives-narrativesList"},T.createElement("div",{className:"ViewOrganization-Narratives-narrativesTable"},e)))}},{key:"renderNonMemberNarratives",value:function(){var e,t,r=this,n=this.props.organization.narratives.length,a=this.props.organization.narrativeCount-this.props.organization.narratives.length,i={marginBottom:"10px"};if(n){if(a){var o=T.createElement(T.Fragment,null,T.createElement("p",null,"Since you are not a member of this Organization, only public Narratives are displayed."),T.createElement("p",null,a," private Narrative",1!==a?"s have ":" has "," been hidden."));e=T.createElement(Et.a,{type:"info",message:o,style:i})}}else if(a){var s=T.createElement(T.Fragment,null,T.createElement("p",null,"Since you are not a member of this Organization, only public Narratives would be displayed, but this Organization has none."),T.createElement("p",null,a," private Narrative",1!==a?"s have ":" has "," been hidden."));e=T.createElement(Et.a,{type:"info",message:s,style:i})}else e=T.createElement(Et.a,{type:"info",message:"No Narratives are yet associated with this Organization",style:i});n&&(t=this.props.narratives.map(function(e){return T.createElement("div",{className:"ViewOrganization-Narratives-narrative simpleCard",key:String(e.workspaceId)},T.createElement("div",{className:"ViewOrganization-Narratives-dataCol"},T.createElement(Ra,{narrative:e,organization:r.props.organization,onGetViewAccess:r.props.onGetViewAccess})),T.createElement("div",{className:"ViewOrganization-Narratives-buttonCol"},r.renderNarrativeMenu(e)))}));var l=T.createElement("span",{className:"ViewOrganization-Narratives-title"},T.createElement(ht.a,{type:"folder-open",style:{marginRight:"8px"}}),"Narratives"," ",T.createElement("span",{className:"ViewOrganization-Narratives-titleCount"},"(",this.props.organization.narrativeCount,")"));return T.createElement("div",{className:"ViewOrganization-Narratives scrollable-flex-column"},T.createElement("div",{className:"ViewOrganization-Narratives-header"},T.createElement("div",{className:"ViewOrganization-Narratives-headerCol1"},l),T.createElement("div",{className:"ViewOrganization-Narratives-headerCol2"})),T.createElement("div",{className:"ViewOrganization-Narratives-toolbar"},T.createElement("div",{className:"ViewOrganization-Narratives-toolbar-searchCol"},this.renderSearchBar()),T.createElement("div",{className:"ViewOrganization-Narratives-toolbar-sortCol"},this.renderSortBar())),T.createElement("div",{className:"ViewOrganization-Narratives-narrativesList"},T.createElement("div",{className:"ViewOrganization-Narratives-table"},e,t)))}},{key:"render",value:function(){return this.props.organization.isMember?this.renderMemberNarratives():this.renderNonMemberNarratives()}}]),t}(T.Component);function ga(e){return{type:Q.MANAGE_MEMBERSHIP_LOAD_ERROR,error:e}}function _a(){return function(e,t){var r=t();if(!r.views.manageMembershipView.viewModel)throw new Error("Argh, no view model");r.views.manageMembershipView.viewModel.editableMemberProfile.title.validationState.type===s.OK?e({type:Q.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS}):e({type:Q.MANAGE_MEMBERSHIP_EVALUATE_ERROR})}}r(314);var fa=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"doLeaveOrg",value:function(){var e=this,t=function(){e.doLeaveOrgConfirmed()}.bind(this);Rt.a.confirm({title:"Really leave this organization?",content:T.createElement("p",null,"This is not reversible."),width:"50em",onOk:function(){t()}})}},{key:"onDone",value:function(){this.props.onFinish()}},{key:"doLeaveOrgConfirmed",value:function(){this.props.onLeaveOrganization(this.props.organization.id)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===l.NEW||this.props.saveState===l.READY||this.props.saveState===l.SAVED)}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onTitleChange",value:function(e){e.persist(),this.props.onUpdateTitle(e.target.value)}},{key:"renderOrgName",value:function(e){return e.length<25?e:T.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"ManageMembership-validation-error"}switch(e.syncState){case i.DIRTY:return"ManageMembership-sync-dirty";default:return"ManageMembership-validation-ok"}}},{key:"renderEditor",value:function(){return T.createElement("form",{id:"editMembership",className:"ManageMembership-editorTable",onSubmit:this.onSubmit.bind(this)},T.createElement("div",{className:"ManageMembership-headerRow"},T.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Edit"),T.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Preview")),T.createElement("div",{className:"ManageMembership-editorTable-row"},T.createElement("div",{className:"ManageMembership-editCol ManageMembership-editCell"},T.createElement("div",{className:"ManageMembership-editorTable-labelCol"},T.createElement("span",{className:"field-label ManageMembership-titleLabel"},"title")),T.createElement("div",{className:"ManageMembership-editorTable-controlCol"},T.createElement(Mr.a,{value:this.props.editableMemberProfile.title.value||"",className:this.calcFieldClass(this.props.editableMemberProfile.title),onChange:this.onTitleChange.bind(this)}))),T.createElement("div",{className:"ManageMembership-previewCol ManageMembership-previewCell"},T.createElement("div",{className:"ManageMembership-titlePreview"},this.props.editableMemberProfile.title.value))),T.createElement("div",{className:"ManageMembership-editorFooter"},T.createElement(tr.a,{icon:"save",form:"editMembership",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")))}},{key:"renderMenuButtons",value:function(){return T.createElement("div",{className:"ButtonSet"},T.createElement("div",{className:"ButtonSet-button"},T.createElement(tr.a,{icon:"rollback",type:"danger",onClick:this.onDone.bind(this)},"Done")))}},{key:"render",value:function(){return T.createElement("div",{className:"ManageMembership scrollable-flex-column"},T.createElement(na,{buttons:this.renderMenuButtons()}),T.createElement("h3",null,"Edit Your Membership Profile"),T.createElement("div",{className:"ManageMembership-body"},this.renderEditor()))}}]),t}(T.Component);var Sa=Object(P.b)(function(e,t){if(!e.views.manageMembershipView.viewModel)throw new Error("View model missing");var r=e.auth.authorization.username,n=e.views.manageMembershipView.viewModel;return{username:r,organization:n.organization,editableMemberProfile:n.editableMemberProfile,editState:n.editState,saveState:n.saveState,validationState:n.validationState}},function(e){return{onLeaveOrganization:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r({type:Q.MANAGE_MEMBERSHIP_LEAVE_ORG_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,c=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url});try{c.removeMember(e,s),r({type:Q.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS})}catch(u){console.error("ERROR leaving org",u),r({type:Q.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,error:{code:u.name,message:u.message}})}case 4:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUpdateTitle:function(t){e(function(e){return function(t){var r=_e.validateMemberTitle(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:Q.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,error:an({code:"invalid",message:i.message})}):t({type:Q.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,title:a}),t(_a())}}(t))},onSave:function(){e(function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a,i,o,s,l,c,u,E,d;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:Q.MANAGE_MEMBERSHIP_SAVE_START}),(n=r()).views.manageMembershipView.viewModel){e.next=4;break}throw new Error("Argh, no view model?!?");case 4:return a=n.auth.authorization,i=a.token,o=a.username,s=n.views.manageMembershipView.viewModel,l=s.organization,c=s.editableMemberProfile,u=n.app.config,E={title:c.title.value},d=new ze({token:i,username:o,groupsServiceURL:u.services.Groups.url}),e.prev=7,e.next=10,d.updateMember(l.id,o,E);case 10:t({type:Q.MANAGE_MEMBERSHIP_SAVE_SUCCESS}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(7),console.error("error saving member profile",e.t0),t({type:Q.MANAGE_MEMBERSHIP_SAVE_ERROR,error:an({code:"error",message:e.t0.message})});case 17:t(_a());case 18:case"end":return e.stop()}},e,this,[[7,13]])}));return function(t,r){return e.apply(this,arguments)}}())}}})(fa),Aa=(r(316),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderDetail",value:function(){return T.createElement("table",{className:"errorTable"},T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,T.createElement("span",{className:"field-label"},"generated at")),T.createElement("td",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.error.at))),T.createElement("tr",null,T.createElement("th",null,T.createElement("span",{className:"field-label"},"error id")),T.createElement("td",null,T.createElement("span",{style:{fontFamily:"monospace"}},this.props.error.id))),T.createElement("tr",null,T.createElement("th",null,T.createElement("span",{className:"field-label"},"explanation")),T.createElement("td",null,this.props.error.detail))))}},{key:"renderInfo",value:function(){return this.props.error.info?T.createElement("div",null,"additional info here ..."):T.createElement("div",{style:{textAlign:"left",fontStyle:"italic"}},"No additional information")}},{key:"render",value:function(){var e=T.createElement("div",null,T.createElement("p",null,this.props.error.message),T.createElement(Cr.a,{bordered:!1,style:{backgroundColor:"transparent"}},T.createElement(Cr.a.Panel,{header:"detail",key:"1",style:{backgroundColor:"transparent"}},this.renderDetail())),T.createElement(Cr.a,{bordered:!1,style:{backgroundColor:"transparent"}},T.createElement(Cr.a.Panel,{header:"additional info",key:"1",style:{backgroundColor:"transparent"}},this.renderInfo())));return T.createElement(Et.a,{type:"error",showIcon:!0,message:"Error",className:"Error",description:e})}}]),t}(T.Component)),Na=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){var e=T.createElement("div",null,"Loading ..."," ",T.createElement(Er.a,null));return T.createElement(Et.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return T.createElement(Aa,{error:e})}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(Be({code:"missing-error",message:"The error appears to be missing"}));default:return T.createElement(Sa,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var ba=Object(P.b)(function(e,t){return{view:e.views.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,o,l,c,u,E,d,m,v;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:Q.MANAGE_MEMBERSHIP_LOAD_START}),a=n(),o=a.auth.authorization,l=o.token,c=o.username,u=a.app.config,E=new ze({token:l,username:c,groupsServiceURL:u.services.Groups.url}),t.prev=3,t.next=6,E.getOrg(e);case 6:if((d=t.sent).kind===Re.NORMAL){t.next=10;break}return r(ga(an({code:"invalid state",message:'Organization must be of kind "NORMAL"'}))),t.abrupt("return");case 10:if(d.isMember){t.next=13;break}return r(ga(an({code:"notfound",message:'The user "'+c+'" is not a member of this org'}))),t.abrupt("return");case 13:if((m=d.members.find(function(e){return e.username===c}))||d.owner.username===c&&(m=d.owner),m){t.next=18;break}return r(ga(an({code:"notfound",message:'The user "'+c+'" was not found in the members list'}))),t.abrupt("return");case 18:v={title:{value:m.title||"",remoteValue:m.title,syncState:i.NEW,validationState:{type:s.OK,validatedAt:new Date}}},r((p=d,O=v,{type:Q.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:p,editableMemberProfile:O})),t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),console.error("Error :(",t.t0),r(ga(an({code:t.t0.name,message:t.t0.message})));case 26:case"end":return t.stop()}var p,O},t,this,[[3,22]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:Q.MANAGE_MEMBERSHIP_UNLOAD})}}})(Na);function Ia(){return{type:Q.EDIT_ORG_EVALUATE_ERRORS}}function Ta(e){return{type:Q.EDIT_ORG_SAVE_ERROR,error:e}}function ya(e){return function(t,r){t({type:Q.EDIT_ORG_LOAD_START});var n=r(),a=n.auth.authorization,o=a.token,l=a.username,c=n.app.config;return new ze({token:o,username:l,groupsServiceURL:c.services.Groups.url}).getOrg(e).then(function(e){if(e.kind!==Re.NORMAL)throw new Error("May not edit an inaccessible private org!");var r,n,a={id:{value:e.id,remoteValue:e.id,syncState:i.NEW,validationState:_e.validateOrgId(e.id)[1]},name:{value:e.name,remoteValue:e.name,syncState:i.NEW,validationState:_e.validateOrgName(e.name)[1]},logoUrl:{value:e.logoUrl,remoteValue:e.logoUrl,syncState:i.NEW,validationState:_e.validateOrgLogoUrl(e.logoUrl)[1]},homeUrl:{value:e.homeUrl,remoteValue:e.homeUrl,syncState:i.NEW,validationState:_e.validateOrgHomeUrl(e.homeUrl)[1]},researchInterests:{value:e.researchInterests,remoteValue:e.researchInterests,syncState:i.NEW,validationState:_e.validateOrgResearchInterests(e.researchInterests)[1]},description:{value:e.description,remoteValue:e.description,syncState:i.NEW,validationState:_e.validateOrgDescription(e.description)[1]},isPrivate:{value:e.isPrivate,remoteValue:e.isPrivate,syncState:i.NEW,validationState:{type:s.OK,validatedAt:new Date}}};t((r=a,n=e,{type:Q.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:Q.EDIT_ORG_LOAD_ERROR,error:r}))})}}function Ma(){return function(e,t){e({type:Q.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,o=r.views.editOrgView.viewModel,s=o.organization,l=o.editedOrganization,c=r.app.config,u=new ze({token:a,username:i,groupsServiceURL:c.services.Groups.url});if(l){var E={name:l.name.value,logoUrl:l.logoUrl.value,description:l.description.value,isPrivate:l.isPrivate.value,homeUrl:l.homeUrl.value,researchInterests:l.researchInterests.value};u.updateOrg(s.id,E).then(function(){e({type:Q.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",l,t),e(Ta({code:"invalid",message:t.message}))})}else e(Ta({code:"app",message:"The new organization data does not yet exist"}))}}function Ca(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState.type===s.OK&&n.logoUrl.validationState.type===s.OK&&n.homeUrl.validationState.type===s.OK&&n.researchInterests.validationState.type===s.OK&&n.description.validationState.type===s.OK?e({type:Q.EDIT_ORG_EVALUATE_OK}):e(Ia())}}function Da(e){return function(t){var r=_e.validateOrgName(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:Q.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:Q.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(Ca())}}function Va(e){return function(t){var r=_e.validateOrgLogoUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t(function(e,t){return{type:Q.EDIT_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(a,i)):t(function(e){return{type:Q.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:e}}(a)),t(Ca())}}function ka(e){return function(t,r){var n=r(),a=n.auth.authorization,i=(a.token,a.username,n.app.config,_e.validateOrgDescription(e)),o=Object(se.a)(i,2),l=o[0],c=o[1];c.type!==s.OK?t(function(e,t){return{type:Q.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(l,c)):t(function(e){return{type:Q.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(l)),t(Ca())}}var Ua;r(318);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Ua||(Ua={}));var za=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:Ua.NONE},r.origin=document.location.origin,r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onFinish",value:function(){this.props.onFinish()}},{key:"onShowInfo",value:function(){Rt.a.info({title:"Organization Editor Help",width:"50em",content:T.createElement("div",null,T.createElement("p",null,"This is the organizations editor..."))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Rt.a.confirm({title:"Leave the editor?",content:T.createElement("div",null,T.createElement("p",null,"You have made changes on this edit form."),T.createElement("p",null,"If you leave the editor without saving, any ",T.createElement("i",null,"changes they will be lost"),"."),T.createElement("p",null,T.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){Rt.a.confirm({title:"Leave the editor?",content:T.createElement("div",null,T.createElement("p",null,"You have made changes on this edit form."),T.createElement("p",null,"If you leave the editor without saving, any ",T.createElement("i",null,"changes they will be lost"),"."),T.createElement("p",null,T.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===o.EDITED&&this.props.validationState.type===s.OK&&(this.props.saveState===l.NEW||this.props.saveState===l.READY||this.props.saveState===l.SAVED)}},{key:"isModified",value:function(){return this.props.editState===o.EDITED&&(this.props.saveState===l.NEW||this.props.saveState===l.READY)}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case s.ERROR:case s.REQUIRED_MISSING:return"validation-error Lite"}switch(e.syncState){case i.DIRTY:return"sync-dirty Lite";default:return"validation-ok Lite"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===s.OK?"":e.syncState===i.DIRTY?T.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderNameRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"This is the name for your organization as you want KBase users to see it; you may change it at any time."),T.createElement("p",null,"It may be composed of ordinary text, but does not accept formatting."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1024 characters")))));return T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"},T.createElement("div",{className:"EditOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Name"))),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{className:"EditOrganization-formControl"},T.createElement(Mr.a,{value:this.props.editedOrganization.name.value||"",className:this.calcFieldClass(this.props.editedOrganization.name),placeholder:"Your Organization's display name",autoFocus:!0,onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.name))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("div",{className:"EditOrganization-preview-name"},this.props.editedOrganization.name.value||"")))}},{key:"renderIDRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each Organization has a unique identifier. The ID is set when the organization is created, and are permanent: It may never be changed."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"100 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"a to z, 0 to 9, -")))));return T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"},T.createElement("div",{className:"EditOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"ID"))),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{className:"EditOrganization-formControl"},T.createElement(Mr.a,{value:this.props.editedOrganization.id.value||"",className:this.calcFieldClass(this.props.editedOrganization.id),placeholder:"A unique ID for your Organization",onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.id))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("div",{className:"EditOrganization-preview-id"},T.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.editedOrganization.id.value||T.createElement("span",{style:{fontStyle:"italic"}},"organization id here"))))}},{key:"renderLogoURLRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each Organization will display a logo. You may specific your own logo by entering the URL for an image, or leave this field blank and a default logo will be displayed, using the first letter of your org name and a randomly generated color (based on your org id)."),T.createElement("p",null,"Please don't use large images, and try to keep them roughly square. The logo image display will be constrained to no larger than 100 pixels wide. Non-square logos may not look good in the Orgs list or on your Org page."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"no")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1000 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"a full https:// url. E.g. https://my.org/myimage.png",T.createElement("br",null),"note that only ",T.createElement("i",null,"https")," urls are accepted.")))));return T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"},T.createElement("div",{className:"EditOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Logo URL"))),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{className:"EditOrganization-formControl"},T.createElement(Mr.a,{value:this.props.editedOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.logoUrl),placeholder:"The URL for your Organization's logo (optional)",onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.logoUrl))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("div",{className:"EditOrganization-preview-logo"},this.renderLogoPreview())))}},{key:"renderHomeURLRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each Organization may display a home page url. This should be considered the canonical home for your Organization, if it also exists outside of KBase."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"no")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1000 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"a full url. E.g. http://my.org/myimage.png",T.createElement("br",null),"note that both ",T.createElement("i",null,"http>")," and ",T.createElement("i",null,"https")," urls are accepted.")))));return T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"},T.createElement("div",{className:"EditOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Home Page URL"))),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{className:"EditOrganization-formControl"},T.createElement(Mr.a,{value:this.props.editedOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.homeUrl),placeholder:"The URL for your Organization's home page (optional)",onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.homeUrl))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("div",{className:"EditOrganization-field-name"},T.createElement("a",{href:this.props.editedOrganization.homeUrl.value||"",target:"_blank"},this.props.editedOrganization.homeUrl.value||""))))}},{key:"renderCollapse",value:function(e){return T.createElement(Cr.a,{bordered:!1},T.createElement(Cr.a.Panel,{header:"What about inviting users?",key:"invite",style:{background:"transparent",borderRadius:0,margin:0,border:0,overflow:"hidden"}},e))}},{key:"renderPrivatePublicRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,'Set the Organization to "hidden" to prevent it from appearing in the listing and from being exposed as an Org page for any non-member.'),T.createElement("p",null,"You may invite users directly to your org. When doing so they will receive a notification with a link to the org page. When a user lands on the org page they will not be shown information about the org, but will be available to accept the invitation and instantly have access to it."),T.createElement("p",null,"A user with an invitation who lands on the org page will not see information about the org, but will be able to submit a Join request."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"no")))));return T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"},T.createElement("div",{className:"EditOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Hidden?"))),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{className:"EditOrganization-formControl"},T.createElement(ar.a,{checked:this.props.editedOrganization.isPrivate.value,className:this.calcFieldClass(this.props.editedOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.isPrivate))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("div",{className:"EditOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.editedOrganization.isPrivate.value))))}},{key:"renderResearchInterestsRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each organization must have a short description of research interests or purpose."),T.createElement("p",null,"This text is displayed in the organizations list and the organization's page. It is most helpful in the list context to help users quickly scan the list."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"200 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"unformatted text")))));return T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"},T.createElement("div",{className:"EditOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Research Interests"))),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{className:"EditOrganization-formControl"},T.createElement(Vr.a,{value:this.props.editedOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.editedOrganization.researchInterests)+" EditOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},placeholder:"List your areas of interest. Systems biology, microbial ecology, plant genomics",onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.researchInterests))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("div",{className:"EditOrganization-preview-researchInterests"},this.props.editedOrganization.researchInterests.value||"")))}},{key:"renderDescriptionRow",value:function(){var e=T.createElement(T.Fragment,null,T.createElement("p",null,"Each organization must have a description which communicates the purpose of this organization."),T.createElement("p",null,"The description is in ",T.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown")," format and may be quite long. It will be presented in a scrolling area."),T.createElement("p",null,"Please be mindful of embedding large images or other content which may interfere with the display of your Organization."),T.createElement("table",null,T.createElement("tbody",null,T.createElement("tr",null,T.createElement("th",null,"required"),T.createElement("td",null,"yes")),T.createElement("tr",null,T.createElement("th",null,"max length"),T.createElement("td",null,"1024 characters")),T.createElement("tr",null,T.createElement("th",null,"allowed"),T.createElement("td",null,"standard ",T.createElement("a",{href:"https://daringfireball.net/projects/markdown/syntax",target:"_blank"},"markdown"))))));return T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"},T.createElement("div",{className:"EditOrganization-formLabel field-label"},T.createElement(Ot.a,{title:e},"Description"))),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{className:"EditOrganization-formControl"},T.createElement(Vr.a,{value:this.props.editedOrganization.description.value||"",className:this.calcFieldClass(this.props.editedOrganization.description)+" EditOrganization-control-description",autosize:{minRows:5,maxRows:15},placeholder:"Text or Markdown describing your Organization",onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.description))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("div",{className:"EditOrganization-preview-description",dangerouslySetInnerHTML:{__html:yr.Marked.parse(this.props.editedOrganization.description.value||"")}})))}},{key:"renderSaveButton",value:function(){return T.createElement(tr.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")}},{key:"renderCancelButton",value:function(){return T.createElement(tr.a,{icon:"close",type:"danger",onClick:this.onFinish.bind(this)},"Cancel")}},{key:"renderEditor",value:function(){return T.createElement("form",{id:"editOrganizationForm",className:"EditOrganization-editor scrollable-flex-column",onSubmit:this.onSubmit.bind(this)},T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"}),T.createElement("div",{className:"EditOrganization-col2"},T.createElement("div",{style:{flex:"1 1 0px"}},T.createElement("h3",null,"Edit Your Organization"))),T.createElement("div",{className:"EditOrganization-col3"},T.createElement("h3",null,"Preview"))),T.createElement("div",{className:"EditOrganization-body"},this.renderNameRow(),this.renderIDRow(),this.renderLogoURLRow(),this.renderHomeURLRow(),this.renderPrivatePublicRow(),this.renderResearchInterestsRow(),this.renderDescriptionRow(),T.createElement("div",{className:"EditOrganization-row"},T.createElement("div",{className:"EditOrganization-col1"}),T.createElement("div",{className:"EditOrganization-col2",style:{textAlign:"center"}},T.createElement("div",{className:"ButtonSet"},T.createElement("span",{className:"ButtonSet-button"},this.renderSaveButton()),T.createElement("span",{className:"ButtonSet-button"},this.renderCancelButton()))),T.createElement("div",{className:"EditOrganization-col3"}))))}},{key:"renderIsPrivate",value:function(e){return e?T.createElement("span",null,T.createElement(ht.a,{type:"lock"})," ","Hidden - will be visible ",T.createElement("b",null,"only")," for members of this organization"):T.createElement("span",null,T.createElement(ht.a,{type:"global"})," ","Visible - will be visible to all KBase users.")}},{key:"renderLogoPreview",value:function(){return this.props.editedOrganization.logoUrl.value?T.createElement("img",{src:this.props.editedOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultLogo",value:function(){if(!this.props.editedOrganization.name.value||!this.props.editedOrganization.id.value)return T.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.editedOrganization.name.value,0).toUpperCase(),t=vt()(this.props.editedOrganization.id.value).substr(0,6);return T.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},T.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return T.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderMenuButtons",value:function(){return T.createElement("span",{className:"ButtonSet"},T.createElement("span",{className:"ButtonSet-button"},T.createElement(tr.a,{icon:"rollback",type:"danger",onClick:this.onFinish.bind(this)},"Close")),T.createElement("span",{className:"ButtonSet-button"},T.createElement(tr.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")))}},{key:"render",value:function(){return this.state.cancelToViewer?T.createElement(Tr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):T.createElement("div",{className:"EditOrganization"},T.createElement(na,{buttons:this.renderMenuButtons()}),this.renderEditor())}}]),t}(T.Component);var ja=Object(P.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(Ma())},onUpdateName:function(t){e(Da(t))},onUpdateLogoUrl:function(t){e(Va(t))},onUpdateDescription:function(t){e(ka(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:Q.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Ca())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=_e.validateOrgHomeUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:Q.EDIT_ORG_UPDATE_HOME_URL_ERROR,homeUrl:a,error:i}):t({type:Q.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a}),t(Ca())}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=_e.validateOrgResearchInterests(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==s.OK?t({type:Q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:Q.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a}),t(Ca())}}(t))}}})(za),Ga=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){var e=T.createElement("div",null,"Loading Editor..."," ",T.createElement(Er.a,null));return T.createElement(Et.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return T.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.renderError();case h.SUCCESS:return T.createElement(ja,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case h.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var La=Object(P.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(ya(t))},onUnload:function(){e({type:Q.EDIT_ORG_UNLOAD})}}})(Ga),Ba=(r(320),function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onFinish",value:function(){this.props.onFinish()}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative.narrative.workspaceId):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgName",value:function(e){return e.length<25?e:T.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderPermission",value:function(e){switch(e.access){case Gt.VIEW:return T.createElement("span",null,T.createElement(ht.a,{type:"eye"})," View");case Gt.EDIT:return T.createElement("span",null,T.createElement(ht.a,{type:"edit"})," Edit");case Gt.ADMIN:return T.createElement("span",null,T.createElement(ht.a,{type:"unlock"})," Admin");case Gt.OWNER:return T.createElement("span",null,T.createElement(ht.a,{type:"crown"})," Owner");default:return T.createElement("span",null,"ERROR")}}},{key:"renderPublicPermission",value:function(e){return e.isPublic?T.createElement("span",null,T.createElement(ht.a,{type:"global"})," Public"):T.createElement("span",null,T.createElement(ht.a,{type:"lock"})," Private")}},{key:"renderNarrative",value:function(e){return T.createElement(T.Fragment,null,T.createElement("div",{className:"RequestNarrative-title"},e.title),T.createElement("div",{className:"RequestNarrative-publicPermission"},this.renderPublicPermission(e)),T.createElement("div",{className:"RequestNarrative-modifiedAt"},T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"save"}))," ",T.createElement(Yt,{time:e.lastSavedAt,tooltipPrefix:"last saved "})))}},{key:"renderNarratives",value:function(){var e=this;return 0===this.props.narratives.length?T.createElement("div",{className:"message"},"You do not have any Narratives"):this.props.narratives.map(function(t,r){var n,a=t.status,i=t.narrative,o=["RequestNarrative-narrativeCell"];switch(!(!e.props.selectedNarrative||i.workspaceId!==e.props.selectedNarrative.narrative.workspaceId)&&o.push("RequestNarrative-selected"),a){case g.ASSOCIATED:o.push("RequestNarrative-narrativeInOrg"),n=T.createElement(Ot.a,{title:"This narrative is already associated with this organization"},T.createElement(ht.a,{type:"check",style:{color:"green"}}));break;case g.REQUESTED:o.push("RequestNarrative-narrativeInOrg"),n=T.createElement(Ot.a,{title:"You have already requested that this narrative be added to this organization"},T.createElement(ht.a,{type:"loading",style:{color:"orange"}}));break;default:o.push("RequestNarrative-narrativeNotInOrg")}return T.createElement("div",{className:o.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},T.createElement("div",{className:"RequestNarrative-narrativeFlag"},n),T.createElement("div",{className:"RequestNarrative-narrative"},e.renderNarrative(t.narrative)))})}},{key:"onSearchSubmit",value:function(){console.log("searching...")}},{key:"renderSearchIcon",value:function(){return this.props.searching?T.createElement(ht.a,{type:"loading"}):T.createElement(ht.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return T.createElement("form",{id:"searchForm",className:"RequestNarrative-searchBar",onSubmit:this.onSearchSubmit.bind(this)},T.createElement("input",{placeholder:"Search your Narratives",autoFocus:!0}),T.createElement(tr.a,{className:"RequestNarrative-button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"renderFeedbackBar",value:function(){return T.createElement("div",null,"Showing"," ",Intl.NumberFormat("en-US",{style:"decimal",useGrouping:!0}).format(this.props.narratives.length)," ","narratives")}},{key:"onSortByChange",value:function(e){switch(e){case"title":this.props.doSortBy(Lt.TITLE);break;case"savedAt":this.props.doSortBy(Lt.LAST_SAVED)}}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return T.createElement("div",{className:"RequestNarrative-filterSortBar"},T.createElement("span",{className:"field-label"},"sort by"),T.createElement(rr.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},T.createElement(rr.a.Option,{value:"title",key:"title"},"Title"),T.createElement(rr.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")))}},{key:"renderNarrativeSelector",value:function(){return T.createElement("div",{className:"RequestNarrative-narrativeSelector scrollable-flex-column"},T.createElement("div",{style:{display:"flex",flexDirection:"row"}},T.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),T.createElement("div",{className:"RequestNarrative-feedbackBar"},this.renderFeedbackBar()),T.createElement("div",{className:"RequestNarrative-narratives scrollable-flex-column"},T.createElement("div",{className:"RequestNarrative-narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===g.ASSOCIATED?T.createElement(Et.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===g.REQUESTED?T.createElement(Et.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===pe.ADMIN||this.props.relation.type===pe.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",T.createElement(tr.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?T.createElement("div",{className:"RequestNarrative-selectedNarrative"},T.createElement("div",{className:"RequestNarrative-title"},this.props.selectedNarrative.narrative.title),T.createElement("div",null,T.createElement("span",{className:"field-label"},T.createElement(ht.a,{type:"save"}))," ",T.createElement(Yt,{time:this.props.selectedNarrative.narrative.lastSavedAt,tooltipPrefix:"last saved "}))):T.createElement(Et.a,{type:"info",message:"Select a narrative on the left to show it here and be able to add it to this organization."})}},{key:"renderMenuButtons",value:function(){return T.createElement("div",{className:"ButtonSet"},T.createElement("div",{className:"ButtonSet-button"},T.createElement(tr.a,{icon:"rollback",type:"danger",onClick:this.onFinish.bind(this)},"Done")))}},{key:"render",value:function(){return T.createElement("div",{className:"RequestNarrative scrollable-flex-column"},T.createElement(na,{buttons:this.renderMenuButtons()}),T.createElement("div",{className:"RequestNarrative-body scrollable-flex-column"},T.createElement("div",{className:"RequestNarrative-selectNarrativeCol scrollable-flex-column"},T.createElement("h3",null,"Select a Narrative"),this.renderNarrativeSelector()),T.createElement("div",{className:"RequestNarrative-selectedNarrativeCol"},T.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),T.createElement("div",{className:"RequestNarrative-selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),T.createElement("div",{className:"RequestNarrative-footer"}))}}]),t}(T.Component));function Pa(e){return function(t,r){t({type:Q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:Q.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}function xa(e){var t=e.views.viewOrgView.viewModel;if(null===t)throw new Error("select user invalid state -- no view value");if(t.kind!==S.NORMAL)throw new Error("select user invalid state -- no view value");var r=t.subViews.requestNarrativeView;if(null===r)throw new Error("select user invalid state -- no view value");return r}var Wa=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.requestNarrativeView.viewModel)throw new Error("argh, null subview view model");var n=r.subViews.requestNarrativeView.viewModel;return{organization:n.organization,relation:n.relation,narratives:n.narratives,selectedNarrative:n.selectedNarrative,searching:!1,sortBy:"title",filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(oe.a)(ie.a.mark(function r(n,a){var i,o,s,l,c,u,E;return ie.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:Q.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),o=i.auth.authorization,s=o.token,l=o.username,c=i.app.config,u=new ze({token:s,username:l,groupsServiceURL:c.services.Groups.url}),r.prev=3,r.next=6,u.addOrRequestNarrativeToGroup(e,t);case 6:E=r.sent,n((m=E,{type:Q.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:m})),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n((d=Be({code:r.t0.name,message:r.t0.message}),{type:Q.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 13:case"end":return r.stop()}var d,m},r,this,[[3,10]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(Pa(t))},doSortBy:function(t){var r;e((r=t,function(){var e=Object(oe.a)(ie.a.mark(function e(t,n){var a,i,o,s,l,c,u,E;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:Q.REQUEST_ADD_NARRATIVE_SORT_START}),a=n(),e.prev=2,i=xa(a),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),t({type:Q.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Be({code:"error",message:e.t0.message})}),e.abrupt("return");case 10:if(null!==i.viewModel){e.next=13;break}return t({type:Q.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Be({code:"error",message:"missing view model"})}),e.abrupt("return");case 13:o=a.auth.authorization,s=o.token,l=o.username,c=a.app.config,u=new qt({token:s,username:l,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url});try{E=u.sortOrganizationNarratives(i.viewModel.narratives,r),t({type:Q.REQUEST_ADD_NARRATIVE_SORT_SUCCESS,narratives:E})}catch(d){t({type:Q.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Be({code:"error",message:d.message})})}case 16:case"end":return e.stop()}},e,this,[[2,6]])}));return function(t,r){return e.apply(this,arguments)}}()))}}})(Ba),qa=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){var e=T.createElement(T.Fragment,null,T.createElement(ht.a,{type:"loading"})," ","Loading Your Narratives...");return T.createElement(Et.a,{type:"info",message:e,style:{padding:"20px",width:"30em",margin:"30px auto 0 auto",textAlign:"center"}})}},{key:"renderError",value:function(e){return T.createElement("div",null,"Error!",T.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case b.NONE:case b.LOADING:return this.renderLoading();case b.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(an({code:"Missing Error",message:"The error appears to be missing"}));default:return T.createElement(Wa,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case b.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var Ha,Fa,Qa=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==S.NORMAL)throw new Error("not the right vm");return{view:r.subViews.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E,d,m,v,p,O,h,R;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:Q.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,c=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url}),u=new qt({token:o,username:s,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,workspaceServiceURL:l.services.Workspace.url}),E=new ge({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=5,t.next=8,Promise.all([c.getOrganization(e),u.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,m=Object(se.a)(d,4),v=m[0],p=m[1],O=m[2],h=m[3],R=fe(v,s,O,h),r((g=v,_=p,f=R,{type:Q.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:g,narratives:_,relation:f})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((w=Be({code:t.t0.name,message:t.t0.message}),{type:Q.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:w}));case 22:case"end":return t.stop()}var w,g,_,f},t,this,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:Q.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(qa),Ja=(r(322),r(324),function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.viewModel.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.props.onChangeSubView(A.MANAGE_MEMBERSHIP);break;case"editOrg":this.props.onChangeSubView(A.EDIT_ORGANIZATION);break;case"inviteUser":this.props.onChangeSubView(A.INVITE_USER);break;case"addNarrative":this.props.onChangeSubView(A.ADD_NARRATIVE);break;case"manageRelatedOrgs":this.props.onChangeSubView(A.MANAGE_RELATED_ORGS)}}},{key:"renderOrgMenu",value:function(){this.props.viewModel.organization;switch(this.props.viewModel.relation.type){case pe.NONE:case pe.VIEW:return T.createElement(tr.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization");case pe.MEMBER_REQUEST_PENDING:return T.createElement(Ot.a,{placement:"bottom",mouseEnterDelay:.5,title:"You have requested to join this Org; you may cancel your join request with this button"},T.createElement(tr.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Join Request"));case pe.MEMBER_INVITATION_PENDING:return T.createElement("div",{className:"ViewOrganization-invitationPendingCard"},T.createElement("span",null,"You have been invited to this organization: "),T.createElement(tr.a,{icon:"check",type:"default",size:"small",onClick:this.onAcceptInvitation.bind(this)},"Accept"),T.createElement(tr.a,{icon:"stop",type:"danger",size:"small",onClick:this.onRejectInvitation.bind(this)},"Reject"));case pe.MEMBER:var e=T.createElement(wt.a,{onClick:this.onMenuClick.bind(this)},T.createElement(wt.a.Item,{key:"manageMyMembership"},T.createElement(ht.a,{type:"user"})," ","Manage My Membership"),T.createElement(wt.a.Item,{key:"addNarrative"},T.createElement(ht.a,{type:"file"})," ","Add Narrative"));return T.createElement(gt.a,{overlay:e,trigger:["click"]},T.createElement(ht.a,{type:"setting",theme:"filled",style:{fontSize:"300%"}}));case pe.ADMIN:var t=T.createElement(wt.a,{onClick:this.onMenuClick.bind(this)},T.createElement(wt.a.Item,{key:"manageMyMembership"},T.createElement(ht.a,{type:"user"})," ","Manage My Membership"),T.createElement(wt.a.Item,{key:"editOrg"},T.createElement(ht.a,{type:"edit"})," ","Edit this Org"),T.createElement(wt.a.Item,{key:"inviteUser"},T.createElement(ht.a,{type:"mail"})," ","Invite User"),T.createElement(wt.a.Item,{key:"manageRelatedOrgs"},T.createElement(ht.a,{type:"team"})," ","Manage Related Orgs"));return T.createElement(gt.a,{overlay:t,trigger:["click"]},T.createElement(ht.a,{type:"setting",theme:"filled",className:"IconButton",style:{fontSize:"300%"}}));case pe.OWNER:var r=T.createElement(wt.a,{onClick:this.onMenuClick.bind(this)},T.createElement(wt.a.Item,{key:"manageMyMembership"},T.createElement(ht.a,{type:"user"})," ","Manage My Membership"),T.createElement(wt.a.Item,{key:"editOrg"},T.createElement(ht.a,{type:"edit"})," ","Edit this Org"),T.createElement(wt.a.Item,{key:"inviteUser"},T.createElement(ht.a,{type:"mail"})," ","Invite User"),T.createElement(wt.a.Item,{key:"addNarrative"},T.createElement(ht.a,{type:"file"})," ","Add Narrative"),T.createElement(wt.a.Item,{key:"manageRelatedOrgs"},T.createElement(ht.a,{type:"team"})," ","Manage Related Orgs"));return T.createElement(gt.a,{overlay:r,trigger:["click"]},T.createElement(ht.a,{type:"setting",theme:"filled",className:"IconButton",style:{fontSize:"300%"}}))}}},{key:"render",value:function(){return T.createElement(T.Fragment,null,this.renderOrgMenu())}}]),t}(T.Component));!function(e){e[e.NONE=0]="NONE",e[e.VIEW_MEMBERS=1]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=2]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=3]="VIEW_ORGANIZATION",e[e.BROWSER=4]="BROWSER"}(Ha||(Ha={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(Fa||(Fa={}));var Za=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Ha.NONE,requestAccess:{narrative:null},accordionState:Fa.UP,subView:A.NORMAL},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.setState({subView:A.MANAGE_RELATED_ORGS})}},{key:"onInviteUser",value:function(){this.setState({subView:A.INVITE_USER})}},{key:"onChangeSubView",value:function(e){console.log("new subview?",e),this.setState({subView:e})}},{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.viewModel.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({subView:A.ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){Rt.a.info({title:"View Organization Help",width:"50em",content:T.createElement("div",null,"Organization help here...")})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return T.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.viewModel.relation.type===pe.ADMIN||this.props.viewModel.relation.type===pe.OWNER)return T.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",T.createElement(dt.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},T.createElement(tr.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.viewModel.relation.type===pe.ADMIN||this.props.viewModel.relation.type===pe.OWNER)return T.createElement(dt.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},T.createElement(tr.a,{icon:"edit"},"Edit This Organization"))}},{key:"renderOrg",value:function(){if(this.props.viewModel.organization)return T.createElement("div",{className:"ViewOrganization-org-description-org scrollable-flex-column"},T.createElement("div",{className:"ViewOrganization-org-description",dangerouslySetInnerHTML:{__html:yr.Marked.parse(this.props.viewModel.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return T.createElement("div",{className:"ownerTable"},T.createElement("div",{className:"proprietorCol"},T.createElement("div",{className:"owner"},T.createElement("a",{href:"/#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderRelation",value:function(e){switch(e.type){case pe.NONE:return T.createElement("span",null,T.createElement(ht.a,{type:"stop"}),"None");case pe.VIEW:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},T.createElement("div",null,T.createElement(ht.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),T.createElement("div",{style:{marginTop:"10px"}},T.createElement(tr.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case pe.MEMBER_REQUEST_PENDING:return T.createElement("div",null,T.createElement("div",null,T.createElement(ht.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",T.createElement("b",null,"request")," is pending"),T.createElement("div",null,T.createElement(tr.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case pe.MEMBER_INVITATION_PENDING:return T.createElement("div",null,T.createElement("div",null,T.createElement(ht.a,{type:"user",style:{color:"blue"}}),"You have been ",T.createElement("b",null,"invited")," to join this Organization"),T.createElement("div",{style:{marginTop:"10px"}},T.createElement(tr.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),T.createElement(tr.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case pe.MEMBER:return T.createElement("span",null,T.createElement(ht.a,{type:"user"}),"Member");case pe.ADMIN:return T.createElement("span",null,T.createElement(ht.a,{type:"unlock"}),"Admin");case pe.OWNER:return T.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},T.createElement("span",null,T.createElement(ht.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.viewModel.organization&&(this.props.viewModel.relation.type===pe.OWNER||this.props.viewModel.relation.type===pe.ADMIN||this.props.viewModel.relation.type===pe.MEMBER)}},{key:"renderMembers",value:function(){return this.isMember()?T.createElement(pn,{organization:this.props.viewModel.organization,relation:this.props.viewModel.relation,onReloadOrg:this.props.onReloadOrg}):T.createElement(Et.a,{message:"Membership is only available to members",type:"info"})}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.viewModel.relation,r=this.props.viewModel.groupRequests,n=this.props.viewModel.groupInvitations;if((t.type===pe.ADMIN||t.type===pe.OWNER)&&(null!==r&&null!==n))return e=r.length?T.createElement("div",null,"group has no pending requests"):T.createElement("div",null,T.createElement("div",null,T.createElement(ht.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",T.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",T.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),T.createElement("div",null,T.createElement(dt.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},T.createElement(tr.a,null,"Manage Requests")))),T.createElement("div",{className:"row"},T.createElement("div",{className:"col1"},T.createElement("span",{className:"label"},"admin")),T.createElement("div",{className:"col2"},T.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?T.createElement("div",null,T.createElement("div",null,T.createElement(ht.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",T.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",T.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),T.createElement("div",null,T.createElement(dt.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},T.createElement(tr.a,null,"Manage Requests")))):T.createElement("div",{className:"message"},"No pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case pe.NONE:case pe.VIEW:return"infoBox";case pe.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case pe.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case pe.MEMBER:case pe.ADMIN:case pe.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return T.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.viewModel.relation;if(e.type===pe.ADMIN||e.type===pe.OWNER){var t=this.props.viewModel,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=T.createElement("span",null,T.createElement(ht.a,{type:"unlock"})," ","group requests"," ",T.createElement("span",{className:"ViewOrganization-titleCount"},"(",a,")"));return T.createElement("div",{className:"ViewOrganization-adminTasksBox"},T.createElement(tn.a,{className:"slimCard ViewOrganization-adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.viewModel.organization&&this.props.viewModel.relation.type===pe.VIEW)return T.createElement(tr.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderLoadingHeader",value:function(){var e=T.createElement("span",null,"Loading Org...");return T.createElement(nn,{breadcrumbs:e})}},{key:"renderMembersTab",value:function(){return T.createElement("div",{className:"ViewOrganization-membersCol scrollable-flex-column"},this.renderMembersToolbar(),this.renderMembers())}},{key:"onAcceptRequest",value:function(e){this.props.onAcceptRequest(e.id)}},{key:"renderMembersToolbar",value:function(){switch(this.props.viewModel.relation.type){case pe.NONE:case pe.MEMBER:return;case pe.ADMIN:case pe.OWNER:return T.createElement("div",{className:"ViewOrganization-tabPaneToolbar"},T.createElement(Ot.a,{placement:"bottomRight",title:"Invite one or more users to this organization"},T.createElement(tr.a,{size:"small",onClick:this.onInviteUser.bind(this)},T.createElement(ht.a,{type:"mail"}),"Invite Users")))}}},{key:"renderToolbarButtons",value:function(){switch(this.props.viewModel.relation.type){case pe.NONE:case pe.MEMBER:return;case pe.ADMIN:case pe.OWNER:return T.createElement(T.Fragment,null,T.createElement(Ot.a,{placement:"bottomRight",title:"Invite a user to this organization"},T.createElement(tr.a,{size:"small",onClick:this.onInviteUser.bind(this)},T.createElement(ht.a,{type:"mail"}))))}}},{key:"renderCombo",value:function(){var e,t=this,r=this.props.viewModel.relation.type===pe.ADMIN||this.props.viewModel.relation.type===pe.OWNER,n=this.props.viewModel.organization.isMember,a=[];if(e=this.props.viewModel.organization.memberCount-1?String(this.props.viewModel.organization.memberCount-1):"\xd8",a.push(T.createElement(rn.a.TabPane,{tab:T.createElement("span",null,T.createElement(ht.a,{type:"team"}),"Members ",T.createElement("span",{className:"ViewOrganization-tabCount"},"(",e,")")),key:"members",style:{flexDirection:"column"}},this.renderMembersTab())),n)if(r){var i=this.props.viewModel.requestInbox.length+this.props.viewModel.requestOutbox.length,o=T.createElement("span",{className:"ViewOrganization-tabCount"},"(",i||"\xd8",")");a.push(T.createElement(rn.a.TabPane,{tab:T.createElement("span",null,T.createElement(ht.a,{type:"inbox"}),"Requests ",o," "),key:"inbox",style:{flexDirection:"column"}},T.createElement(Vn,{inbox:this.props.viewModel.requestInbox,outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}else{var s,l=this.props.viewModel.requestOutbox.length;s=l?String(l):"\xd8",a.push(T.createElement(rn.a.TabPane,{tab:T.createElement("span",null,T.createElement(ht.a,{type:"inbox"}),"Requests ",T.createElement("span",{className:"ViewOrganization-tabCount"},"(",s,")")),key:"outbox",style:{flexDirection:"column"}},T.createElement(Vn,{inbox:[],outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}var c=this.props.viewModel.organization.relatedOrganizations.length,u=T.createElement("span",null,T.createElement(ht.a,{type:"team"}),"Related Orgs ",T.createElement("span",{className:"ViewOrganization-tabCount"},"(",c,")"));return a.push(T.createElement(rn.a.TabPane,{tab:u,key:"relatedorgs",style:{flexDirection:"column"}},T.createElement(xn,{relatedOrganizations:this.props.viewModel.organization.relatedOrganizations,organization:this.props.viewModel.organization,onManageRelatedOrgs:function(){t.onManageRelatedOrgs()}}))),T.createElement(rn.a,{defaultActiveKey:"members",className:"ViewOrganization-tabs",animated:!1,size:"small",tabPosition:"top"},a)}},{key:"renderMenuButtons",value:function(){return T.createElement("span",{className:"ButtonSet"},T.createElement("span",{className:"ButtonSet-button"},T.createElement("div",{className:"IconButton",onClick:this.onNavigateToBrowser.bind(this)},T.createElement(ht.a,{type:"close"}))))}},{key:"onNavigateToBrowser",value:function(){this.setState({navigateTo:Ha.BROWSER})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({subView:A.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:Ha.VIEW_MEMBERS});break;case"editOrg":this.setState({subView:A.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({subView:A.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:Ha.MANAGE_REQUESTS});break;case"addNarrative":this.setState({subView:A.ADD_NARRATIVE});break;case"manageRelatedOrgs":this.setState({subView:A.MANAGE_RELATED_ORGS})}}},{key:"renderOrgMenu",value:function(){this.props.viewModel.organization;switch(this.props.viewModel.relation.type){case pe.NONE:case pe.VIEW:return T.createElement("span",null,T.createElement(tr.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization"));case pe.MEMBER_REQUEST_PENDING:return T.createElement("span",null,T.createElement(Ot.a,{placement:"bottom",mouseEnterDelay:.5,title:"You have requested to join this Org; you may cancel your join request with this button"},T.createElement(tr.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Join Request")));case pe.MEMBER_INVITATION_PENDING:return T.createElement("div",{className:"ViewOrganization-invitationPendingCard"},T.createElement("span",null,"You have been invited to this organization: "),T.createElement(tr.a,{icon:"check",type:"default",size:"small",onClick:this.onAcceptInvitation.bind(this)},"Accept"),T.createElement(tr.a,{icon:"stop",type:"danger",size:"small",onClick:this.onRejectInvitation.bind(this)},"Reject"));case pe.MEMBER:var e=T.createElement(wt.a,{onClick:this.onMenuClick.bind(this)},T.createElement(wt.a.Item,{key:"manageMyMembership"},T.createElement(ht.a,{type:"user"})," ","Manage My Membership"),T.createElement(wt.a.Item,{key:"addNarrative"},T.createElement(ht.a,{type:"file"})," ","Add Narrative"));return T.createElement("span",null,T.createElement(gt.a,{overlay:e,trigger:["click"]},T.createElement(tr.a,{shape:"circle"},T.createElement(ht.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))));case pe.ADMIN:var t=T.createElement(wt.a,{onClick:this.onMenuClick.bind(this)},T.createElement(wt.a.Item,{key:"manageMyMembership"},T.createElement(ht.a,{type:"user"})," ","Manage My Membership"),T.createElement(wt.a.Item,{key:"editOrg"},T.createElement(ht.a,{type:"edit"})," ","Edit this Org"),T.createElement(wt.a.Item,{key:"inviteUser"},T.createElement(ht.a,{type:"mail"})," ","Invite User"),T.createElement(wt.a.Item,{key:"manageRelatedOrgs"},T.createElement(ht.a,{type:"team"})," ","Manage Related Orgs"));return T.createElement("span",null,T.createElement(gt.a,{overlay:t,trigger:["click"]},T.createElement(tr.a,{shape:"circle"},T.createElement(ht.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))));case pe.OWNER:var r=T.createElement(wt.a,{onClick:this.onMenuClick.bind(this)},T.createElement(wt.a.Item,{key:"manageMyMembership"},T.createElement(ht.a,{type:"user"})," ","Manage My Membership"),T.createElement(wt.a.Item,{key:"editOrg"},T.createElement(ht.a,{type:"edit"})," ","Edit this Org"),T.createElement(wt.a.Item,{key:"inviteUser"},T.createElement(ht.a,{type:"mail"})," ","Invite User"),T.createElement(wt.a.Item,{key:"addNarrative"},T.createElement(ht.a,{type:"file"})," ","Add Narrative"),T.createElement(wt.a.Item,{key:"manageRelatedOrgs"},T.createElement(ht.a,{type:"team"})," ","Manage Related Orgs"));return T.createElement("span",null,T.createElement(gt.a,{overlay:r,trigger:["click"]},T.createElement(tr.a,{shape:"circle"},T.createElement(ht.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))}}},{key:"toggleAccordion",value:function(){this.setState({accordionState:this.state.accordionState===Fa.UP?Fa.DOWN:Fa.UP})}},{key:"renderAccordionControl",value:function(){var e;return e=this.state.accordionState===Fa.UP?"caret-down":"caret-up",T.createElement("div",{className:"ViewOrganization-accordion",onClick:this.toggleAccordion.bind(this)},T.createElement("div",{className:"ViewOrganization-accordionCol1"},T.createElement("div",{className:"ViewOrganization-accordionRow1"}),T.createElement("div",{className:"ViewOrganization-accordionRow2"}),T.createElement("div",{className:"ViewOrganization-accordionRow3"})),T.createElement("div",{className:"ViewOrganization-accordionCol2"},T.createElement("div",{className:"ViewOrganization-accordionRow1"}),T.createElement("div",{className:"ViewOrganization-accordionRow2"},T.createElement(ht.a,{type:e})),T.createElement("div",{className:"ViewOrganization-accordionRow3"})),T.createElement("div",{className:"ViewOrganization-accordionCol3"},T.createElement("div",{className:"ViewOrganization-accordionRow1"}),T.createElement("div",{className:"ViewOrganization-accordionRow2"}),T.createElement("div",{className:"ViewOrganization-accordionRow3"})))}},{key:"renderNormalView",value:function(){var e,t;return this.state.accordionState===Fa.UP?(e="ViewOrganization-orgRow ViewOrganization-accordionClosed",t="ViewOrganization-narrativesRow ViewOrganization-accordionOpen"):(e="ViewOrganization-orgRow ViewOrganization-accordionOpen",t="ViewOrganization-narrativesRow ViewOrganization-accordionClosed"),e+=" scrollable-flex-column",t+=" scrollable-flex-column",T.createElement("div",{className:"ViewOrganization-mainRow scrollable-flex-column"},T.createElement("div",{className:"ViewOrganization-mainColumn  scrollable-flex-column"},T.createElement("div",{className:e,style:{minHeight:"0px"}},this.renderOrg()),T.createElement("div",{className:"ViewOrganization-accordionRow"},this.renderAccordionControl()),T.createElement("div",{className:t},T.createElement(wa,{organization:this.props.viewModel.organization,narratives:this.props.viewModel.narratives,relation:this.props.viewModel.relation,sortNarrativesBy:this.props.viewModel.sortNarrativesBy,searchNarrativesBy:this.props.viewModel.searchNarrativesBy,onSortNarratives:this.props.onSortNarratives,onSearchNarratives:this.props.onSearchNarratives,onRemoveNarrative:this.props.onRemoveNarrative,onGetViewAccess:this.props.onGetViewAccess,onRequestAddNarrative:this.onRequestAddNarrative.bind(this)}))),T.createElement("div",{className:"ViewOrganization-infoColumn"},this.renderCombo()))}},{key:"renderManageRelatedOrgsView",value:function(){var e=this;return T.createElement(Qn,{onFinish:function(){e.setState({subView:A.NORMAL})}})}},{key:"renderInviteUsersView",value:function(){var e=this;return T.createElement(la,{onFinish:function(){e.setState({subView:A.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderManageMembership",value:function(){var e=this;return T.createElement(ba,{onFinish:function(){e.setState({subView:A.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderEditOrganization",value:function(){var e=this;return T.createElement(La,{onFinish:function(){e.setState({subView:A.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderAddNarrative",value:function(){var e=this;return T.createElement(Qa,{onFinish:function(){e.setState({subView:A.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"getSubView",value:function(){switch(this.state.subView){case A.MANAGE_RELATED_ORGS:return this.renderManageRelatedOrgsView();case A.INVITE_USER:return this.renderInviteUsersView();case A.MANAGE_MEMBERSHIP:return this.renderManageMembership();case A.EDIT_ORGANIZATION:return this.renderEditOrganization();case A.ADD_NARRATIVE:return this.renderAddNarrative();case A.NORMAL:default:return this.renderNormalView()}}},{key:"render",value:function(){switch(this.state.navigateTo){case Ha.BROWSER:return T.createElement(Tr.a,{push:!0,to:"/organizations"});case Ha.NONE:}var e=this.props.viewModel.organization,t=T.createElement(Ja,{viewModel:this.props.viewModel,onJoinOrg:this.props.onJoinOrg,onCancelJoinRequest:this.props.onCancelJoinRequest,onAcceptInvitation:this.props.onAcceptInvitation,onRejectInvitation:this.props.onRejectInvitation,onChangeSubView:this.onChangeSubView.bind(this)});return T.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},T.createElement("div",{className:"ViewOrganization-organizationBox"},T.createElement(Un,{organization:e,openRequestsStatus:this.props.viewModel.openRequest,orgMenu:t,onNavigateToBrowser:this.onNavigateToBrowser.bind(this)})),this.getSubView())}}]),t}(T.Component);var Ya,Ka=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.NORMAL)throw new Error("argh, wrong org kind");return{viewModel:r}},function(e){return{onViewOrg:function(t){e(Jr(t))},onReloadOrg:function(t){e(Zr(t))},onJoinOrg:function(){e(Yr())},onCancelJoinRequest:function(t){e(Kr(t))},onAcceptInvitation:function(t){e(Xr(t))},onRejectInvitation:function(t){e($r(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E,d;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:Q.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Br({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,o=i.token,s=i.username,l=a.app.config,(c=a.views.viewOrgView.viewModel).kind===S.NORMAL){t.next=9;break}return r(Br({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:if(u=c.organization){t.next=13;break}return r(Br({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 13:return E=u.id,d=new ze({token:o,username:s,groupsServiceURL:l.services.Groups.url}),t.prev=15,t.next=18,d.removeNarrativeFromOrg(E,e.workspaceId);case 18:r((m=e.workspaceId,{type:Q.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrativeId:m})),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(15),r(Br({code:t.t0.name,message:t.t0.message}));case 24:case"end":return t.stop()}var m},t,this,[[15,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(oe.a)(ie.a.mark(function t(r,n){var a,i,o,s,l,c,u,E,d,m,v,p,O,h,R;return ie.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:Q.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(xr({code:"error",message:"No view model"})),t.abrupt("return");case 5:if((i=a.views.viewOrgView.viewModel).kind===S.NORMAL){t.next=9;break}return r(xr({code:"error",message:"Not NORMAL org"})),t.abrupt("return");case 9:return o=i.organization,s=i.sortNarrativesBy,l=i.searchNarrativesBy,c=a.auth.authorization,u=c.token,E=c.username,d=a.app.config,m=o.id,v=String(e.workspaceId),p=new ze({token:u,username:E,groupsServiceURL:d.services.Groups.url}),t.prev=14,t.next=17,p.grantNarrativeAccess(m,v);case 17:return t.next=19,p.getOrg(m);case 19:if((O=t.sent).kind===Re.NORMAL){t.next=23;break}return r(xr({code:"error",message:"Not a NORMAL org"})),t.abrupt("return");case 23:h=O.narratives,R=Ve(h,{sortBy:s,searchBy:l}),r(Ft(e.workspaceId)),r(Pr(O,R)),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(14),r(xr({code:"error",message:t.t0.message}));case 32:case"end":return t.stop()}},t,this,[[14,29]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onAcceptRequest:function(t){e(en(t))},onSortNarratives:function(t){e(function(e){return function(t,r){t({type:Q.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===S.NORMAL){var i=n.organization.narratives,o=n.searchNarrativesBy,s=Ve(i,{sortBy:e,searchBy:o});t({type:Q.VIEW_ORG_SORT_NARRATIVES_SUCCESS,narratives:s,sortBy:e})}else t(Fr({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Fr({type:a.ERROR,message:"Now view model!"}))}}(t))},onSearchNarratives:function(t){e(function(e){return function(t,r){t({type:Q.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===S.NORMAL){var i=Ve(n.organization.narratives,{sortBy:n.sortNarrativesBy,searchBy:e});t({type:Q.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS,searchBy:e,narratives:i})}else t(Fr({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Fr({type:a.ERROR,message:"Now view model!"}))}}(t))}}})(Za);r(326);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(Ya||(Ya={}));var Xa=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Ya.NONE,requestAccess:{narrative:null}},r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onShowInfo",value:function(){Rt.a.info({title:"View Organization Help",width:"50em",content:T.createElement("div",null,T.createElement("p",null,"This organization is ",T.createElement("b",null,"private"),"."),T.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),T.createElement("p",null,"Upon requesting membership, an organization administrator may grant you membership"),T.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."))})}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"renderMessage",value:function(){switch(this.props.relation.type){case pe.NONE:return T.createElement(T.Fragment,null,T.createElement("p",null,"This organization is ",T.createElement("b",null,"private")," and you are not a member."),T.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),T.createElement("p",null,"Upon requesting membership, the organization administrators will be notified."),T.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."));case pe.MEMBER_REQUEST_PENDING:return T.createElement(T.Fragment,null,T.createElement("p",null,"Your membership request to this private organization is pending."));case pe.MEMBER_INVITATION_PENDING:return T.createElement(T.Fragment,null,T.createElement("p",null,"You have been invited to this private organization."));default:return T.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderOrg",value:function(){var e=T.createElement("span",null,"Private Organization"),t=T.createElement(T.Fragment,null,this.renderMessage(),T.createElement("div",null,this.renderJoinButton()));return T.createElement(Et.a,{message:e,description:t,type:"info",showIcon:!0,icon:T.createElement(ht.a,{type:"lock"}),style:{width:"50em",margin:"20px auto"},className:"ViewInaccessiblePrivateOrganization-message"})}},{key:"renderRelationClass",value:function(e){switch(e.type){case pe.NONE:case pe.VIEW:return"infoBox";case pe.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case pe.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case pe.MEMBER:case pe.ADMIN:case pe.OWNER:return"infoBox"}}},{key:"renderJoinButton",value:function(){switch(this.props.relation.type){case pe.NONE:return T.createElement(tr.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization");case pe.MEMBER_REQUEST_PENDING:return T.createElement("div",null,T.createElement("div",null,T.createElement(tr.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case pe.MEMBER_INVITATION_PENDING:return T.createElement("div",null,T.createElement(tr.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation")," ",T.createElement(tr.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"));default:return T.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderHeader",value:function(){var e=T.createElement("div",{style:{flex:"0 0 auto"}}),t=T.createElement(T.Fragment,null,T.createElement(tr.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return T.createElement(nn,{breadcrumbs:e,buttons:t})}},{key:"render",value:function(){return T.createElement("div",{className:"ViewInaccessiblePrivateOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrg())}}]),t}(T.Component);var $a=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==S.PRIVATE_INACCESSIBLE)throw new Error("argh, wrong org kind");return{organization:r.organization,relation:r.relation,requestOutbox:r.requestOutbox}},function(e){return{onJoinOrg:function(){e(Yr())},onCancelJoinRequest:function(t){e(Kr(t))},onAcceptInvitation:function(t){e(Xr(t))},onRejectInvitation:function(t){e($r(t))}}})(Xa),ei=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).previousOrganizationId=void 0,r.previousOrganizationId=null,r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"renderLoading",value:function(){var e=T.createElement("div",null,"Loading Organization..."," ",T.createElement(Er.a,null));return T.createElement(Et.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return T.createElement("div",null,"Error!",T.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case h.NONE:case h.LOADING:return this.renderLoading();case h.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case h.SUCCESS:default:return null===this.props.view.viewModel?this.renderError({code:"Null Error",message:"The view model is missing, but should be available"}):this.props.view.viewModel.organization.kind===Re.INACCESSIBLE_PRIVATE?T.createElement($a,null):T.createElement(Ka,null)}}},{key:"componentDidUpdate",value:function(e){e.organizationId!==this.props.organizationId&&this.props.onLoad(this.props.organizationId)}},{key:"componentDidMount",value:function(){this.props.view.loadingState===h.NONE&&this.props.onLoad(this.props.organizationId)}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(T.Component);var ti=Object(P.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(Jr(t))},onUnload:function(){e(function(){var e=Object(oe.a)(ie.a.mark(function e(t,r){var n,a,i,o,s,l,c;return ie.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r(),a=n.auth.authorization,i=a.token,o=a.username,s=n.app.config,l=n.views.viewOrgView.viewModel){e.next=3;break}throw new Error("view model not defined!?!");case 3:if(c=new ze({token:i,username:o,groupsServiceURL:s.services.Groups.url}),l.organization.relation!==pe.MEMBER&&l.organization.relation!==pe.ADMIN&&l.organization.relation!==pe.OWNER){e.next=7;break}return e.next=7,c.visitOrg({organizationId:l.organization.id});case 7:t(Lr()),t({type:Q.VIEW_ORG_UNLOAD});case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}())}}})(ei),ri=(r(328),function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).tokenRef=void 0,r.tokenRef=T.createRef(),r.props.checkAuth(),r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return T.createElement("div",{className:"Auth-form"},"Token: ",T.createElement("input",{ref:this.tokenRef,style:{width:"30em"}}),T.createElement(tr.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return T.createElement("div",{className:"Auth-toolbar"},"Logged in as ",T.createElement("b",null,T.createElement("span",null,this.props.authorization.authorization.realname)," (",T.createElement("span",null,this.props.authorization.authorization.username)),")"," ",T.createElement(tr.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return T.createElement("div",null);case m.AUTHORIZED:return T.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case m.UNAUTHORIZED:return T.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},T.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case m.ERROR:return T.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},T.createElement("p",null,"Error"),this.props.authorization.message);default:return T.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case m.NONE:case m.CHECKING:return T.createElement("div",null);case m.AUTHORIZED:return T.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case m.UNAUTHORIZED:return T.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},T.createElement("p",null,"Not authorized!"));case m.ERROR:return T.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},T.createElement("p",null,"Error: ??"));default:return T.createElement("div",null)}}},{key:"render",value:function(){return T.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(T.Component)),ni=r(95),ai="",ii="api/V2/token",oi="api/V2/me",si=function(){function e(t){var r=t.url;Object(D.a)(this,e),this.url=void 0,this.url=r}return Object(V.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([ai]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([ii]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([oi]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function li(e){return{type:Q.AUTH_CHECK_ERROR,error:e}}function ci(e,t,r,n){return{type:Q.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function ui(){return{type:Q.AUTH_UNAUTHORIZED}}function Ei(){return function(e,t){e({type:Q.AUTH_CHECK_START});var r=t().app.config.services.Auth.url,n=ni.get("kbase_session");if(n){var a=new si({url:r});Promise.all([a.getTokenInfo(n),a.getMe(n)]).then(function(t){var r=Object(se.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(ci(n,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(li({code:"error",message:t.message}))})}else e(ui())}}var di=Object(P.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(Ei())},onRemoveAuthorization:function(){e(function(e,t){ni.remove("kbase_session"),e(ui())})},onAddAuthorization:function(t){e(function(e){return function(t,r){var n=r().app.config.services.Auth.url;ni.set("kbase_session",e);var a=new si({url:n});Promise.all([a.getTokenInfo(e),a.getMe(e)]).then(function(r){var n=Object(se.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(ci(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(li({code:"error",message:e.message}))})}}(t))}}})(ri),mi=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(D.a)(this,e),this.name=void 0,this.onSuccess=void 0,this.onError=void 0,this.name=r,this.onSuccess=n,this.onError=a},vi=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).started=void 0,r.timeout=void 0,r.started=new Date,r.timeout=e.timeout||5e3,r}return Object(z.a)(t,e),t}(mi),pi=function(){function e(t){var r=t.name,n=t.payload,a=t.channelId;Object(D.a)(this,e),this.name=void 0,this.payload=void 0,this.id=void 0,this.created=void 0,this.channelId=void 0,this.envelope=void 0,this.name=r,this.payload=n,this.id=Le()(),this.created=new Date,this.channelId=a,this.envelope=null}return Object(V.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channelId:this.channelId},name:this.name,payload:this.payload}}}]),e}(),Oi=function(){function e(t){if(Object(D.a)(this,e),this.window=void 0,this.host=void 0,this.id=void 0,this.awaitingResponse=void 0,this.waitingListeners=void 0,this.listeners=void 0,this.lastId=void 0,this.sentCount=void 0,this.receivedCount=void 0,this.unwelcomeReceivedCount=void 0,this.unwelcomeReceivedCountThreshhold=void 0,this.unwelcomeReceiptWarning=void 0,this.unwelcomeReceiptWarningCount=void 0,this.currentListener=void 0,this.window=t.window||window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||Le()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(V.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("TS No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",t.envelope,t.envelope.channelId,this.id));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new mi({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new pi({name:e,payload:t,channelId:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new pi({name:e,payload:t,channelId:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,o=function(){var r=i.value,n=(l=Object(se.a)(r,2))[0];0===l[1].filter(function(e){if(e instanceof vi){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},s=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l;o()}}catch(c){n=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new vi({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new vi({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),hi=function(){function e(){Object(D.a)(this,e),this.params=void 0,this.channel=void 0,this.params=null,this.channel=new Oi({window:window,host:document.location.origin})}return Object(V.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:Le()(),params:{groupsServiceURL:"/services/groups",userProfileServiceURL:"/services/user_profile/rpc",workspaceServiceURL:"/services/ws",serviceWizardURL:"/services/service_wizard",authServiceURL:"/services/auth",originalPath:"",view:null,viewParams:null},parentHost:document.location.origin}}}]),e}(),Ri=function(){function e(){Object(D.a)(this,e)}return Object(V.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}},{key:"getChannelID",value:function(){return window.frameElement&&window.frameElement.hasAttribute("data-channel")?window.frameElement.getAttribute("data-channel"):null}},{key:"getIframeElement",value:function(){return window.frameElement||null}}]),e}();function wi(e){return{type:Q.APP_SUCCESS,config:e}}r(330);var gi=function(e){function t(e){var r;return Object(D.a)(this,t),(r=Object(k.a)(this,Object(U.a)(t).call(this,e))).channel=void 0,r.channel=null,r}return Object(z.a)(t,e),Object(V.a)(t,[{key:"setupChannel",value:function(){this.props.channelId&&(this.channel=new Oi({channelId:this.props.channelId}),this.channel.on("navigate",function(e){e.to,e.params},function(e){console.error('Error processing "navigate" message')}),this.channel.start(),this.channel.send("ready",{channelId:this.props.channelId,greeting:"heloooo"}))}},{key:"teardownChannel",value:function(){}},{key:"componentDidMount",value:function(){this.props.onAppStart()}},{key:"componentDidUpdate",value:function(){this.setupChannel()}},{key:"componentWillUnmount",value:function(){this.teardownChannel()}},{key:"render",value:function(){return this.props.status===p.NONE?T.createElement("div",{className:"KBaseIntegration"},"Loading..."):T.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(T.Component);var _i=Object(P.b)(function(e,t){var r=e.app,n=r.status,a=r.config;return{status:n,defaultPath:a.defaultPath,channelId:a.channelId}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new Ri).getParamsFromIFrame();if(r){var n,a=r.channelId;switch(r.params.view){case"org":n="/viewOrganization/"+r.params.viewParams.id,window.history.pushState(null,"test",n);break;default:n="/organizations",window.history.pushState(null,"organizations","/organizations")}e(wi({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Auth:{url:r.params.authServiceURL}},defaultPath:n,channelId:a}))}else e(wi({baseUrl:"",services:{Groups:{url:(r=(new hi).getParamsFromIFrame()).params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Auth:{url:r.params.authServiceURL}},defaultPath:"/organizations",channelId:null}))})}}})(gi),fi=function(){function e(){Object(D.a)(this,e)}return Object(V.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map},organizations:{byId:new Map}},db:{},views:{browseOrgsView:{loadingState:h.NONE,error:null,viewModel:null},addOrgView:{loadingState:h.NONE,error:null,viewModel:null},editOrgView:{loadingState:h.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:h.NONE,error:null,viewModel:null},viewMembersView:{loadingState:h.NONE,error:null,viewModel:null},manageMembershipView:{loadingState:h.NONE,error:null,viewModel:null},viewOrgView:{loadingState:h.NONE,error:null,viewModel:null}},auth:{status:m.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:p.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Auth:{url:""}},defaultPath:"",channelId:null}},updateOrg:{pending:!1}}}}]),e}(),Si=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"componentWillMount",value:function(){this.props.onLoad()}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}},{key:"render",value:function(){return this.props.children}}]),t}(T.Component);var Ai=Object(P.b)(function(e,t){return{}},function(e){return{onLoad:function(){e(Lr())},onUnload:function(){e({type:Q.DATA_SERVICE_UNLOAD})}}})(Si),Ni=T.createContext(null),bi=Ni.Provider;Ni.Consumer;ct.a.add(ut.c,ut.b,ut.a,ut.d);var Ii=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"link",value:function(e,t,r){if(this.options.sanitize){var n;try{n=decodeURIComponent(this.options.unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return r}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return r}var a='<a href="'+e+'"';return t&&(a+=' title="'+t+'"'),a+=' target="_blank">'+r+"</a>"}}]),t}(yr.Renderer);(new yr.MarkedOptions).renderer=new Ii,yr.Marked.setOptions({renderer:new Ii});var Ti=!!window.frameElement,yi=fi.makeInitialState(),Mi=Object(x.d)(lt,yi,Object(x.c)(Object(x.a)(W.a))),Ci=function(e){return y.a.createElement(ti,{organizationId:e.match.params.id})},Di=function(e){function t(e){return Object(D.a)(this,t),Object(k.a)(this,Object(U.a)(t).call(this,e))}return Object(z.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return y.a.createElement(bi,{value:{test:"ok"}},y.a.createElement(P.a,{store:Mi},y.a.createElement(_i,null,y.a.createElement(di,{hosted:Ti},y.a.createElement(Ai,null,y.a.createElement(B.a,{basename:"/"},y.a.createElement("div",{className:"App scrollable-flex-column"},y.a.createElement("div",{className:"App-body scrollable-flex-column"},y.a.createElement(j.a,null,y.a.createElement(G.a,{path:"/organizations",component:mr}),y.a.createElement(G.a,{path:"/newOrganization",component:jr}),y.a.createElement(G.a,{path:"/viewOrganization/:id",exact:!0,component:Ci}),y.a.createElement(L.a,{from:"/",to:"/organizations",exact:!0}))))))))))}}]),t}(T.Component);r(332),r(334),r(336);C.a.render(y.a.createElement(Di,null),document.getElementById("root"))}},[[157,2,1]]]);
//# sourceMappingURL=main.ba5a657d.chunk.js.map