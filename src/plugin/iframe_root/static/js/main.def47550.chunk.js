(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,t,r){e.exports=r.p+"static/media/nouserpic.9af42ba9.png"},155:function(e,t,r){e.exports=r(336)},160:function(e,t,r){},170:function(e,t,r){},172:function(e,t,r){},176:function(e,t,r){},178:function(e,t,r){},229:function(e,t,r){},242:function(e,t,r){},244:function(e,t,r){},246:function(e,t,r){},261:function(e,t,r){},271:function(e,t,r){},273:function(e,t,r){},275:function(e,t,r){},277:function(e,t,r){},279:function(e,t,r){},281:function(e,t,r){},283:function(e,t,r){},285:function(e,t,r){},291:function(e,t,r){},293:function(e,t,r){},295:function(e,t,r){},297:function(e,t,r){},299:function(e,t,r){},301:function(e,t,r){},303:function(e,t,r){},305:function(e,t,r){},307:function(e,t,r){},309:function(e,t,r){},311:function(e,t,r){},313:function(e,t,r){},315:function(e,t,r){},318:function(e,t,r){},320:function(e,t,r){},322:function(e,t,r){},324:function(e,t,r){},326:function(e,t,r){},328:function(e,t,r){},336:function(e,t,r){"use strict";r.r(t);var n,a,i,s,o,c,l,u,E,d,v,m,O,p,R,h,w,_,g,S,f,A,N,I,b=r(0),T=r.n(b),y=r(16),M=r.n(y),C=(r(160),r(4)),D=r(5),V=r(10),k=r(8),U=r(9),z=r(343),G=r(240),j=r(339),L=r(353),P=r(15),B=r(63),x=r(145),W=r(2),q=r(70),H=r(91);!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.NEW=1]="NEW",e[e.DIRTY=2]="DIRTY",e[e.CLEAN=3]="CLEAN"}(i||(i={})),function(e){e.NONE="NONE",e.UNEDITED="UNEDITED",e.EDITED="EDITED"}(s||(s={})),function(e){e[e.OK=0]="OK",e[e.ERROR=1]="ERROR",e[e.REQUIRED_MISSING=2]="REQUIRED_MISSING"}(o||(o={})),function(e){e.NONE="NONE",e.NEW="NEW",e.READY="READY",e.SAVING="SAVING",e.SAVED="SAVED",e.SAVE_ERROR="SAVE_ERROR"}(c||(c={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(l||(l={})),function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(u||(u={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(E||(E={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(d||(d={})),function(e){e[e.NONE=0]="NONE",e[e.CHECKING=1]="CHECKING",e[e.AUTHORIZED=2]="AUTHORIZED",e[e.UNAUTHORIZED=3]="UNAUTHORIZED",e[e.ERROR=4]="ERROR"}(v||(v={})),function(e){e[e.NONE=0]="NONE",e[e.INITIAL=1]="INITIAL",e[e.FETCHING=2]="FETCHING",e[e.READY=3]="READY",e[e.ERROR=4]="ERROR"}(m||(m={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.ERROR=3]="ERROR"}(O||(O={})),function(e){e.ASCENDING="asc",e.DESCENDING="desc"}(p||(p={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(R||(R={})),function(e){e[e.NONE=0]="NONE",e[e.SEARCHING=1]="SEARCHING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.EDITING=1]="EDITING",e[e.SENDABLE=2]="SENDABLE",e[e.SENDING=3]="SENDING",e[e.SUCCESS=4]="SUCCESS",e[e.ERROR=5]="ERROR"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(_||(_={})),function(e){e[e.NONE=0]="NONE",e[e.PROCESSING=1]="PROCESSING",e[e.SUCCESS=2]="SUCCESS",e[e.ERROR=3]="ERROR"}(g||(g={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.ERROR=2]="ERROR",e[e.LOADED=3]="LOADED",e[e.SENDING=4]="SENDING",e[e.SENT=5]="SENT"}(S||(S={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.PRIVATE_INACCESSIBLE=1]="PRIVATE_INACCESSIBLE"}(f||(f={})),function(e){e[e.NONE=0]="NONE",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS"}(A||(A={})),function(e){e[e.NONE=0]="NONE",e[e.LOADING=1]="LOADING",e[e.OK=2]="OK",e[e.ERROR=3]="ERROR"}(N||(N={})),function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR"}(I||(I={}));var F,Q=function(e){function t(e){var r,n=e.code,a=e.message,i=e.detail,s=e.info;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,a))).code=void 0,r.message=void 0,r.detail=void 0,r.trace=void 0,r.errors=void 0,r.info=void 0,r.name="AppException",r.code=n,r.message=a,r.detail=i,r.info=s,Error.captureStackTrace&&Error.captureStackTrace(Object(q.a)(Object(q.a)(r)),t),r.stack&&(r.stack.indexOf("\n")>=0?r.trace=r.stack.split("\n"):r.trace=[r.stack]),r}return Object(U.a)(t,e),t}(Object(H.a)(Error));!function(e){e[e.APP=1]="APP",e[e.APP_START=2]="APP_START",e[e.APP_SUCCESS=3]="APP_SUCCESS",e[e.APP_ERROR=4]="APP_ERROR",e[e.BROWSE_ORGS_LOAD=5]="BROWSE_ORGS_LOAD",e[e.BROWSE_ORGS_LOAD_START=6]="BROWSE_ORGS_LOAD_START",e[e.BROWSE_ORGS_LOAD_SUCCESS=7]="BROWSE_ORGS_LOAD_SUCCESS",e[e.BROWSE_ORGS_LOAD_ERROR=8]="BROWSE_ORGS_LOAD_ERROR",e[e.BROWSE_ORGS_UNLOAD=9]="BROWSE_ORGS_UNLOAD",e[e.BROWSE_ORGS_SORT=10]="BROWSE_ORGS_SORT",e[e.BROWSE_ORGS_SORT_START=11]="BROWSE_ORGS_SORT_START",e[e.BROWSE_ORGS_SORT_SUCCESS=12]="BROWSE_ORGS_SORT_SUCCESS",e[e.BROWSE_ORGS_SORT_ERROR=13]="BROWSE_ORGS_SORT_ERROR",e[e.BROWSE_ORGS_FILTER=14]="BROWSE_ORGS_FILTER",e[e.BROWSE_ORGS_FILTER_START=15]="BROWSE_ORGS_FILTER_START",e[e.BROWSE_ORGS_FILTER_SUCCESS=16]="BROWSE_ORGS_FILTER_SUCCESS",e[e.BROWSE_ORGS_FILTER_ERROR=17]="BROWSE_ORGS_FILTER_ERROR",e[e.BROWSE_ORGS_SEARCH=18]="BROWSE_ORGS_SEARCH",e[e.BROWSE_ORGS_SEARCH_START=19]="BROWSE_ORGS_SEARCH_START",e[e.BROWSE_ORGS_SEARCH_SUCCESS=20]="BROWSE_ORGS_SEARCH_SUCCESS",e[e.BROWSE_ORGS_SEARCH_ERROR=21]="BROWSE_ORGS_SEARCH_ERROR",e[e.UPDATE_ORG=22]="UPDATE_ORG",e[e.UPDATE_ORG_START=23]="UPDATE_ORG_START",e[e.UPDATE_ORG_SUCCESS=24]="UPDATE_ORG_SUCCESS",e[e.UPDATE_ORG_ERROR=25]="UPDATE_ORG_ERROR",e[e.VIEW_ORG_LOAD=26]="VIEW_ORG_LOAD",e[e.VIEW_ORG_LOAD_START=27]="VIEW_ORG_LOAD_START",e[e.VIEW_ORG_LOAD_SUCCESS=28]="VIEW_ORG_LOAD_SUCCESS",e[e.VIEW_ORG_LOAD_ERROR=29]="VIEW_ORG_LOAD_ERROR",e[e.VIEW_ORG_UNLOAD=30]="VIEW_ORG_UNLOAD",e[e.VIEW_ORG_RELOAD=31]="VIEW_ORG_RELOAD",e[e.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS=32]="VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS",e[e.VIEW_ORG_LOAD_NORMAL_SUCCESS=33]="VIEW_ORG_LOAD_NORMAL_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST=34]="VIEW_ORG_JOIN_REQUEST",e[e.VIEW_ORG_JOIN_REQUEST_START=35]="VIEW_ORG_JOIN_REQUEST_START",e[e.VIEW_ORG_JOIN_REQUEST_SUCCESS=36]="VIEW_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_JOIN_REQUEST_ERROR=37]="VIEW_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST=38]="VIEW_ORG_CANCEL_JOIN_REQUEST",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_START=39]="VIEW_ORG_CANCEL_JOIN_REQUEST_START",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS=40]="VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS",e[e.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR=41]="VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION=42]="VIEW_ORG_ACCEPT_JOIN_INVITATION",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_START=43]="VIEW_ORG_ACCEPT_JOIN_INVITATION_START",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS=44]="VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR=45]="VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST=46]="VIEW_ORG_ACCEPT_INBOX_REQUEST",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_START=47]="VIEW_ORG_ACCEPT_INBOX_REQUEST_START",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS=48]="VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR=49]="VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_INBOX_REQUEST=50]="VIEW_ORG_REJECT_INBOX_REQUEST",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_START=51]="VIEW_ORG_REJECT_INBOX_REQUEST_START",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS=52]="VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS",e[e.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR=53]="VIEW_ORG_REJECT_INBOX_REQUEST_ERROR",e[e.VIEW_ORG_REJECT_JOIN_INVITATION=54]="VIEW_ORG_REJECT_JOIN_INVITATION",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_START=55]="VIEW_ORG_REJECT_JOIN_INVITATION_START",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS=56]="VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS",e[e.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR=57]="VIEW_ORG_REJECT_JOIN_INVITATION_ERROR",e[e.VIEW_ORG_REMOVE_NARRATIVE=58]="VIEW_ORG_REMOVE_NARRATIVE",e[e.VIEW_ORG_REMOVE_NARRATIVE_START=59]="VIEW_ORG_REMOVE_NARRATIVE_START",e[e.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS=60]="VIEW_ORG_REMOVE_NARRATIVE_SUCCESS",e[e.VIEW_ORG_REMOVE_NARRATIVE_ERROR=61]="VIEW_ORG_REMOVE_NARRATIVE_ERROR",e[e.VIEW_ORG_ACCESS_NARRATIVE=62]="VIEW_ORG_ACCESS_NARRATIVE",e[e.VIEW_ORG_ACCESS_NARRATIVE_START=63]="VIEW_ORG_ACCESS_NARRATIVE_START",e[e.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS=64]="VIEW_ORG_ACCESS_NARRATIVE_SUCCESS",e[e.VIEW_ORG_ACCESS_NARRATIVE_ERROR=65]="VIEW_ORG_ACCESS_NARRATIVE_ERROR",e[e.VIEW_ORG_SORT_NARRATIVES=66]="VIEW_ORG_SORT_NARRATIVES",e[e.VIEW_ORG_SORT_NARRATIVES_START=67]="VIEW_ORG_SORT_NARRATIVES_START",e[e.VIEW_ORG_SORT_NARRATIVES_SUCCESS=68]="VIEW_ORG_SORT_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SORT_NARRATIVES_ERROR=69]="VIEW_ORG_SORT_NARRATIVES_ERROR",e[e.VIEW_ORG_SEARCH_NARRATIVES=70]="VIEW_ORG_SEARCH_NARRATIVES",e[e.VIEW_ORG_SEARCH_NARRATIVES_START=71]="VIEW_ORG_SEARCH_NARRATIVES_START",e[e.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS=72]="VIEW_ORG_SEARCH_NARRATIVES_SUCCESS",e[e.VIEW_ORG_SEARCH_NARRATIVES_ERROR=73]="VIEW_ORG_SEARCH_NARRATIVES_ERROR",e[e.VIEW_ORG_SORT_MEMBERS=74]="VIEW_ORG_SORT_MEMBERS",e[e.VIEW_ORG_SORT_MEMBERS_START=75]="VIEW_ORG_SORT_MEMBERS_START",e[e.VIEW_ORG_SORT_MEMBERS_SUCCESS=76]="VIEW_ORG_SORT_MEMBERS_SUCCESS",e[e.VIEW_ORG_SORT_MEMBERS_ERROR=77]="VIEW_ORG_SORT_MEMBERS_ERROR",e[e.VIEW_ORG_SEARCH_MEMBERS=78]="VIEW_ORG_SEARCH_MEMBERS",e[e.VIEW_ORG_SEARCH_MEMBERS_START=79]="VIEW_ORG_SEARCH_MEMBERS_START",e[e.VIEW_ORG_SEARCH_MEMBERS_SUCCESS=80]="VIEW_ORG_SEARCH_MEMBERS_SUCCESS",e[e.VIEW_ORG_SEARCH_MEMBERS_ERROR=81]="VIEW_ORG_SEARCH_MEMBERS_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD=82]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START=83]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS=84]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR=85]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD=86]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION=87]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION=88]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START=89]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS=90]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR=91]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=92]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=93]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=94]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=95]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION=96]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START=97]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS=98]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS",e[e.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR=99]="VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH=100]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START=101]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS=102]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS",e[e.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR=103]="VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST=104]="VIEW_PRIVATE_ORG_JOIN_REQUEST",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_START=105]="VIEW_PRIVATE_ORG_JOIN_REQUEST_START",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS=106]="VIEW_PRIVATE_ORG_JOIN_REQUEST_SUCCESS",e[e.VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR=107]="VIEW_PRIVATE_ORG_JOIN_REQUEST_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD=108]="VIEW_ORG_VIEW_MEMBERS_LOAD",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_START=109]="VIEW_ORG_VIEW_MEMBERS_LOAD_START",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS=110]="VIEW_ORG_VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR=111]="VIEW_ORG_VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_UNLOAD=112]="VIEW_ORG_VIEW_MEMBERS_UNLOAD",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER=113]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START=114]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=115]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR=116]="VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN=117]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=118]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=119]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=120]="VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER=121]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=122]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=123]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=124]="VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.ADD_ORG_LOAD=125]="ADD_ORG_LOAD",e[e.ADD_ORG_LOAD_START=126]="ADD_ORG_LOAD_START",e[e.ADD_ORG_LOAD_SUCCESS=127]="ADD_ORG_LOAD_SUCCESS",e[e.ADD_ORG_LOAD_ERROR=128]="ADD_ORG_LOAD_ERROR",e[e.ADD_ORG_UNLOAD=129]="ADD_ORG_UNLOAD",e[e.ADD_ORG_UPDATE_NAME=130]="ADD_ORG_UPDATE_NAME",e[e.ADD_ORG_UPDATE_NAME_SUCCESS=131]="ADD_ORG_UPDATE_NAME_SUCCESS",e[e.ADD_ORG_UPDATE_NAME_ERROR=132]="ADD_ORG_UPDATE_NAME_ERROR",e[e.ADD_ORG_UPDATE_LOGO_URL=133]="ADD_ORG_UPDATE_LOGO_URL",e[e.ADD_ORG_UPDATE_LOGO_URL_SUCCESS=134]="ADD_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.ADD_ORG_UPDATE_LOGO_URL_ERROR=135]="ADD_ORG_UPDATE_LOGO_URL_ERROR",e[e.ADD_ORG_UPDATE_ID=136]="ADD_ORG_UPDATE_ID",e[e.ADD_ORG_UPDATE_ID_SUCCESS=137]="ADD_ORG_UPDATE_ID_SUCCESS",e[e.ADD_ORG_UPDATE_ID_ERROR=138]="ADD_ORG_UPDATE_ID_ERROR",e[e.ADD_ORG_UPDATE_ID_PASS=139]="ADD_ORG_UPDATE_ID_PASS",e[e.ADD_ORG_EVALUATE_ID=140]="ADD_ORG_EVALUATE_ID",e[e.ADD_ORG_UPDATE_DESCRIPTION=141]="ADD_ORG_UPDATE_DESCRIPTION",e[e.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS=142]="ADD_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.ADD_ORG_UPDATE_DESCRIPTION_ERROR=143]="ADD_ORG_UPDATE_DESCRIPTION_ERROR",e[e.ADD_ORG_UPDATE_IS_PRIVATE=144]="ADD_ORG_UPDATE_IS_PRIVATE",e[e.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS=145]="ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.ADD_ORG_UPDATE_IS_PRIVATE_ERROR=146]="ADD_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.ADD_ORG_UPDATE_HOME_URL=147]="ADD_ORG_UPDATE_HOME_URL",e[e.ADD_ORG_UPDATE_HOME_URL_SUCCESS=148]="ADD_ORG_UPDATE_HOME_URL_SUCCESS",e[e.ADD_ORG_UPDATE_HOME_URL_ERROR=149]="ADD_ORG_UPDATE_HOME_URL_ERROR",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS=150]="ADD_ORG_UPDATE_RESEARCH_INTERESTS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=151]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=152]="ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.ADD_ORG_EVALUATE=153]="ADD_ORG_EVALUATE",e[e.ADD_ORG_EVALUATE_OK=154]="ADD_ORG_EVALUATE_OK",e[e.ADD_ORG_EVALUATE_ERRORS=155]="ADD_ORG_EVALUATE_ERRORS",e[e.ADD_ORG_SAVE=156]="ADD_ORG_SAVE",e[e.ADD_ORG_SAVE_START=157]="ADD_ORG_SAVE_START",e[e.ADD_ORG_SAVE_SUCCESS=158]="ADD_ORG_SAVE_SUCCESS",e[e.ADD_ORG_SAVE_ERROR=159]="ADD_ORG_SAVE_ERROR",e[e.EDIT_ORG_LOAD=160]="EDIT_ORG_LOAD",e[e.EDIT_ORG_LOAD_START=161]="EDIT_ORG_LOAD_START",e[e.EDIT_ORG_LOAD_SUCCESS=162]="EDIT_ORG_LOAD_SUCCESS",e[e.EDIT_ORG_LOAD_ERROR=163]="EDIT_ORG_LOAD_ERROR",e[e.EDIT_ORG_UNLOAD=164]="EDIT_ORG_UNLOAD",e[e.EDIT_ORG_SAVE=165]="EDIT_ORG_SAVE",e[e.EDIT_ORG_SAVE_START=166]="EDIT_ORG_SAVE_START",e[e.EDIT_ORG_SAVE_SUCCESS=167]="EDIT_ORG_SAVE_SUCCESS",e[e.EDIT_ORG_SAVE_ERROR=168]="EDIT_ORG_SAVE_ERROR",e[e.EDIT_ORG_UPDATE_NAME=169]="EDIT_ORG_UPDATE_NAME",e[e.EDIT_ORG_UPDATE_NAME_SUCCESS=170]="EDIT_ORG_UPDATE_NAME_SUCCESS",e[e.EDIT_ORG_UPDATE_NAME_ERROR=171]="EDIT_ORG_UPDATE_NAME_ERROR",e[e.EDIT_ORG_UPDATE_LOGO_URL=172]="EDIT_ORG_UPDATE_LOGO_URL",e[e.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS=173]="EDIT_ORG_UPDATE_LOGO_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_LOGO_URL_ERROR=174]="EDIT_ORG_UPDATE_LOGO_URL_ERROR",e[e.EDIT_ORG_UPDATE_DESCRIPTION=175]="EDIT_ORG_UPDATE_DESCRIPTION",e[e.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS=176]="EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS",e[e.EDIT_ORG_UPDATE_DESCRIPTION_ERROR=177]="EDIT_ORG_UPDATE_DESCRIPTION_ERROR",e[e.EDIT_ORG_UPDATE_IS_PRIVATE=178]="EDIT_ORG_UPDATE_IS_PRIVATE",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS=179]="EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS",e[e.EDIT_ORG_UPDATE_IS_PRIVATE_ERROR=180]="EDIT_ORG_UPDATE_IS_PRIVATE_ERROR",e[e.EDIT_ORG_UPDATE_HOME_URL=181]="EDIT_ORG_UPDATE_HOME_URL",e[e.EDIT_ORG_UPDATE_HOME_URL_SUCCESS=182]="EDIT_ORG_UPDATE_HOME_URL_SUCCESS",e[e.EDIT_ORG_UPDATE_HOME_URL_ERROR=183]="EDIT_ORG_UPDATE_HOME_URL_ERROR",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS=184]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS=185]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS",e[e.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR=186]="EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR",e[e.EDIT_ORG_EVALUATE=187]="EDIT_ORG_EVALUATE",e[e.EDIT_ORG_EVALUATE_OK=188]="EDIT_ORG_EVALUATE_OK",e[e.EDIT_ORG_EVALUATE_ERRORS=189]="EDIT_ORG_EVALUATE_ERRORS",e[e.AUTH_CHECK=190]="AUTH_CHECK",e[e.AUTH_CHECK_START=191]="AUTH_CHECK_START",e[e.AUTH_CHECK_ERROR=192]="AUTH_CHECK_ERROR",e[e.AUTH_AUTHORIZED=193]="AUTH_AUTHORIZED",e[e.AUTH_UNAUTHORIZED=194]="AUTH_UNAUTHORIZED",e[e.AUTH_REMOVE_AUTHORIZATION=195]="AUTH_REMOVE_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION=196]="AUTH_ADD_AUTHORIZATION",e[e.AUTH_ADD_AUTHORIZATION_ERROR=197]="AUTH_ADD_AUTHORIZATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_LOAD=198]="ADMIN_MANAGE_REQUESTS_LOAD",e[e.ADMIN_MANAGE_REQUESTS_LOAD_START=199]="ADMIN_MANAGE_REQUESTS_LOAD_START",e[e.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS=200]="ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_LOAD_ERROR=201]="ADMIN_MANAGE_REQUESTS_LOAD_ERROR",e[e.ADMIN_MANAGE_REQUESTS_UNLOAD=202]="ADMIN_MANAGE_REQUESTS_UNLOAD",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST=203]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START=204]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS=205]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR=206]="ADMIN_MANAGE_REQUESTS_ACCEPT_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST=207]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START=208]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_START",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS=209]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR=210]="ADMIN_MANAGE_REQUESTS_DENY_JOIN_REQUEST_ERROR",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION=211]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START=212]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_START",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS=213]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR=214]="ADMIN_MANAGE_REQUESTS_CANCEL_JOIN_INVITATION_ERROR",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS=215]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START=216]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_START",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS=217]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS",e[e.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR=218]="ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_ERROR",e[e.VIEW_MEMBERS_LOAD=219]="VIEW_MEMBERS_LOAD",e[e.VIEW_MEMBERS_LOAD_START=220]="VIEW_MEMBERS_LOAD_START",e[e.VIEW_MEMBERS_LOAD_SUCCESS=221]="VIEW_MEMBERS_LOAD_SUCCESS",e[e.VIEW_MEMBERS_LOAD_ERROR=222]="VIEW_MEMBERS_LOAD_ERROR",e[e.VIEW_MEMBERS_UNLOAD=223]="VIEW_MEMBERS_UNLOAD",e[e.VIEW_MEMBERS_REMOVE_MEMBER=224]="VIEW_MEMBERS_REMOVE_MEMBER",e[e.VIEW_MEMBERS_REMOVE_MEMBER_START=225]="VIEW_MEMBERS_REMOVE_MEMBER_START",e[e.VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS=226]="VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_REMOVE_MEMBER_ERROR=227]="VIEW_MEMBERS_REMOVE_MEMBER_ERROR",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN=228]="VIEW_MEMBERS_PROMOTE_TO_ADMIN",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_START=229]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_START",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS=230]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS",e[e.VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR=231]="VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER=232]="VIEW_MEMBERS_DEMOTE_TO_MEMBER",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_START=233]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_START",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS=234]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS",e[e.VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR=235]="VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR",e[e.INVITE_USER_LOAD=236]="INVITE_USER_LOAD",e[e.INVITE_USER_LOAD_START=237]="INVITE_USER_LOAD_START",e[e.INVITE_USER_LOAD_SUCCESS=238]="INVITE_USER_LOAD_SUCCESS",e[e.INVITE_USER_LOAD_ERROR=239]="INVITE_USER_LOAD_ERROR",e[e.INVITE_USER_UNLOAD=240]="INVITE_USER_UNLOAD",e[e.INVITE_USER_SEARCH_USERS=241]="INVITE_USER_SEARCH_USERS",e[e.INVITE_USER_SEARCH_USERS_START=242]="INVITE_USER_SEARCH_USERS_START",e[e.INVITE_USER_SEARCH_USERS_SUCCESS=243]="INVITE_USER_SEARCH_USERS_SUCCESS",e[e.INVITE_USER_SEARCH_USERS_ERROR=244]="INVITE_USER_SEARCH_USERS_ERROR",e[e.INVITE_USER_SELECT_USER=245]="INVITE_USER_SELECT_USER",e[e.INVITE_USER_SELECT_USER_START=246]="INVITE_USER_SELECT_USER_START",e[e.INVITE_USER_SELECT_USER_SUCCESS=247]="INVITE_USER_SELECT_USER_SUCCESS",e[e.INVITE_USER_SELECT_USER_ERROR=248]="INVITE_USER_SELECT_USER_ERROR",e[e.INVITE_USER_SEND_INVITATION=249]="INVITE_USER_SEND_INVITATION",e[e.INVITE_USER_SEND_INVITATION_START=250]="INVITE_USER_SEND_INVITATION_START",e[e.INVITE_USER_SEND_INVITATION_SUCCESS=251]="INVITE_USER_SEND_INVITATION_SUCCESS",e[e.INVITE_USER_SEND_INVITATION_ERROR=252]="INVITE_USER_SEND_INVITATION_ERROR",e[e.MANAGE_MEMBERSHIP_LOAD=253]="MANAGE_MEMBERSHIP_LOAD",e[e.MANAGE_MEMBERSHIP_LOAD_START=254]="MANAGE_MEMBERSHIP_LOAD_START",e[e.MANAGE_MEMBERSHIP_LOAD_SUCCESS=255]="MANAGE_MEMBERSHIP_LOAD_SUCCESS",e[e.MANAGE_MEMBERSHIP_LOAD_ERROR=256]="MANAGE_MEMBERSHIP_LOAD_ERROR",e[e.MANAGE_MEMBERSHIP_UNLOAD=257]="MANAGE_MEMBERSHIP_UNLOAD",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG=258]="MANAGE_MEMBERSHIP_LEAVE_ORG",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED=259]="MANAGE_MEMBERSHIP_LEAVE_ORG_CONFIRMED",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_START=260]="MANAGE_MEMBERSHIP_LEAVE_ORG_START",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS=261]="MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS",e[e.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR=262]="MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE=263]="MANAGE_MEMBERSHIP_UPDATE_TITLE",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_START=264]="MANAGE_MEMBERSHIP_UPDATE_TITLE_START",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS=265]="MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS",e[e.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR=266]="MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR",e[e.MANAGE_MEMBERSHIP_SAVE=267]="MANAGE_MEMBERSHIP_SAVE",e[e.MANAGE_MEMBERSHIP_SAVE_START=268]="MANAGE_MEMBERSHIP_SAVE_START",e[e.MANAGE_MEMBERSHIP_SAVE_SUCCESS=269]="MANAGE_MEMBERSHIP_SAVE_SUCCESS",e[e.MANAGE_MEMBERSHIP_SAVE_ERROR=270]="MANAGE_MEMBERSHIP_SAVE_ERROR",e[e.MANAGE_MEMBERSHIP_EVALUATE=271]="MANAGE_MEMBERSHIP_EVALUATE",e[e.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS=272]="MANAGE_MEMBERSHIP_EVALUATE_SUCCESS",e[e.MANAGE_MEMBERSHIP_EVALUATE_ERROR=273]="MANAGE_MEMBERSHIP_EVALUATE_ERROR",e[e.REQUEST_ADD_NARRATIVE_LOAD=274]="REQUEST_ADD_NARRATIVE_LOAD",e[e.REQUEST_ADD_NARRATIVE_LOAD_START=275]="REQUEST_ADD_NARRATIVE_LOAD_START",e[e.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS=276]="REQUEST_ADD_NARRATIVE_LOAD_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_LOAD_ERROR=277]="REQUEST_ADD_NARRATIVE_LOAD_ERROR",e[e.REQUEST_ADD_NARRATIVE_UNLOAD=278]="REQUEST_ADD_NARRATIVE_UNLOAD",e[e.REQUEST_ADD_NARRATIVE_SEND=279]="REQUEST_ADD_NARRATIVE_SEND",e[e.REQUEST_ADD_NARRATIVE_SEND_START=280]="REQUEST_ADD_NARRATIVE_SEND_START",e[e.REQUEST_ADD_NARRATIVE_SEND_SUCCESS=281]="REQUEST_ADD_NARRATIVE_SEND_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SEND_ERROR=282]="REQUEST_ADD_NARRATIVE_SEND_ERROR",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE=283]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START=284]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS=285]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR=286]="REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_ERROR",e[e.REQUEST_ADD_NARRATIVE_SORT=287]="REQUEST_ADD_NARRATIVE_SORT",e[e.REQUEST_ADD_NARRATIVE_SORT_START=288]="REQUEST_ADD_NARRATIVE_SORT_START",e[e.REQUEST_ADD_NARRATIVE_SORT_SUCCESS=289]="REQUEST_ADD_NARRATIVE_SORT_SUCCESS",e[e.REQUEST_ADD_NARRATIVE_SORT_ERROR=290]="REQUEST_ADD_NARRATIVE_SORT_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD=291]="ORGANIZATION_CENTRIC_VIEW_LOAD",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_START=292]="ORGANIZATION_CENTRIC_VIEW_LOAD_START",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS=293]="ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS",e[e.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR=294]="ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR",e[e.ORGANIZATION_CENTRIC_VIEW_UNLOAD=295]="ORGANIZATION_CENTRIC_VIEW_UNLOAD",e[e.ENTITY_USER_LOADER=296]="ENTITY_USER_LOADER",e[e.ENTITY_USER_LOADER_START=297]="ENTITY_USER_LOADER_START",e[e.ENTITY_USER_LOADER_SUCCESS=298]="ENTITY_USER_LOADER_SUCCESS",e[e.ENTITY_USER_LOADER_ERROR=299]="ENTITY_USER_LOADER_ERROR",e[e.ENTITY_ORGANIZATION_LOADER=300]="ENTITY_ORGANIZATION_LOADER",e[e.ENTITY_ORGANIZATION_LOADER_START=301]="ENTITY_ORGANIZATION_LOADER_START",e[e.ENTITY_ORGANIZATION_LOADER_SUCCESS=302]="ENTITY_ORGANIZATION_LOADER_SUCCESS",e[e.ENTITY_ORGANIZATION_LOADER_ERROR=303]="ENTITY_ORGANIZATION_LOADER_ERROR",e[e.ENTITY_NARRATIVE_LOAD=304]="ENTITY_NARRATIVE_LOAD",e[e.ENTITY_NARRATIVE_LOAD_START=305]="ENTITY_NARRATIVE_LOAD_START",e[e.ENTITY_NARRATIVE_LOAD_SUCCESS=306]="ENTITY_NARRATIVE_LOAD_SUCCESS",e[e.ENTITY_NARRATIVE_LOAD_ERROR=307]="ENTITY_NARRATIVE_LOAD_ERROR",e[e.ENTITY_ORGANIZATION_LOAD=308]="ENTITY_ORGANIZATION_LOAD",e[e.ENTITY_ORGANIZATION_LOAD_START=309]="ENTITY_ORGANIZATION_LOAD_START",e[e.ENTITY_ORGANIZATION_LOAD_SUCCESS=310]="ENTITY_ORGANIZATION_LOAD_SUCCESS",e[e.ENTITY_ORGANIZATION_LOAD_ERROR=311]="ENTITY_ORGANIZATION_LOAD_ERROR",e[e.DATA_SERVICE_LOAD=312]="DATA_SERVICE_LOAD",e[e.DATA_SERVICE_LOAD_START=313]="DATA_SERVICE_LOAD_START",e[e.DATA_SERVICE_LOAD_SUCCESS=314]="DATA_SERVICE_LOAD_SUCCESS",e[e.DATA_SERVICE_LOAD_ERROR=315]="DATA_SERVICE_LOAD_ERROR",e[e.DATA_SERVICE_UNLOAD=316]="DATA_SERVICE_UNLOAD",e[e.DATA_SERVICE_LOAD_REFRESH=317]="DATA_SERVICE_LOAD_REFRESH",e[e.DATA_SERVICE_LOAD_REFRESH_START=318]="DATA_SERVICE_LOAD_REFRESH_START",e[e.DATA_SERVICE_LOAD_REFRESH_SUCCESS=319]="DATA_SERVICE_LOAD_REFRESH_SUCCESS",e[e.DATA_SERVICE_LOAD_REFRESH_ERROR=320]="DATA_SERVICE_LOAD_REFRESH_ERROR"}(F||(F={}));var Z=function(e,t){switch(t.type){case F.ADD_ORG_SAVE:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVING})})})}):(console.warn("attempting saveStart without view model"),e)}(e);case F.ADD_ORG_SAVE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.UNEDITED,saveState:c.SAVED})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case F.ADD_ORG_SAVE_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{saveState:c.SAVE_ERROR,error:t.error})})})}):(console.warn("attempting saveError without view model"),e)}(e,t);case F.ADD_ORG_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.ADD_ORG_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{editState:s.UNEDITED,validationState:{type:o.OK,validatedAt:new Date},saveState:c.NEW,error:null,newOrganization:t.newOrganization}}})})}(e,t);case F.ADD_ORG_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.SUCCESS,error:t.error,viewModel:null}})})}(e,t);case F.ADD_ORG_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.ADD_ORG_UPDATE_NAME_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateNameSuccess without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{name:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateNameError without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Logo URL without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{logoUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.logoUrl,{syncState:i.DIRTY,value:t.logoUrl,validationState:t.error})})})})})}):(console.warn("attempting Logo URL error without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Home URL (success) without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{homeUrl:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.homeUrl,{syncState:i.DIRTY,value:t.homeUrl,validationState:t.error})})})})})}):(console.warn("attempting update to home url without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting Research Interests without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{researchInterests:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.researchInterests,{syncState:i.DIRTY,value:t.researchInterests,validationState:t.error})})})})})}):(console.warn("attempting update to research interests (error) without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_ID_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e);case F.ADD_ORG_UPDATE_ID_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.id,{syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateIdError without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_ID_PASS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{id:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.id,{value:t.id,syncState:i.DIRTY})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateDescriptionSuccess without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{description:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):(console.warn("attempting updateDescriptionError without view model"),e)}(e,t);case F.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{editState:s.EDITED,newOrganization:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization,{isPrivate:Object(W.a)({},e.views.addOrgView.viewModel.newOrganization.isPrivate,{value:t.isPrivate,syncState:i.DIRTY,validationState:{type:o.OK,validatedAt:new Date}})})})})})}):(console.warn("attempting updateIdSuccess without view model"),e)}(e,t);case F.ADD_ORG_EVALUATE_OK:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{validationState:{type:o.OK,validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);case F.ADD_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.addOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{addOrgView:Object(W.a)({},e.views.addOrgView,{viewModel:Object(W.a)({},e.views.addOrgView.viewModel,{validationState:{type:o.ERROR,message:"TODO: form error",validatedAt:new Date}})})})}):(console.warn("attempting saveSuccess without view model"),e)}(e);default:return null}};function J(){return{type:o.OK,validatedAt:new Date}}function Y(e){return e.editedOrganization.name.syncState===i.DIRTY?s.EDITED:e.editedOrganization.id.syncState===i.DIRTY?s.EDITED:e.editedOrganization.logoUrl.syncState===i.DIRTY?s.EDITED:e.editedOrganization.homeUrl.syncState===i.DIRTY?s.EDITED:e.editedOrganization.researchInterests.syncState===i.DIRTY?s.EDITED:e.editedOrganization.isPrivate.syncState===i.DIRTY?s.EDITED:e.editedOrganization.description.syncState===i.DIRTY?s.EDITED:s.UNEDITED}var K=function(e,t){switch(t.type){case F.EDIT_ORG_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.EDIT_ORG_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{editState:s.UNEDITED,validationState:J(),saveState:c.NEW,organization:t.organization,saveError:null,editedOrganization:t.editedOrganization}}})})}(e,t);case F.EDIT_ORG_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.EDIT_ORG_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.EDIT_ORG_SAVE_START:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVING})})})}):e}(e);case F.EDIT_ORG_SAVE_SUCCESS:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.UNEDITED,saveState:c.SAVED,editedOrganization:{id:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.id,{syncState:i.CLEAN}),name:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{syncState:i.CLEAN}),logoUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{syncState:i.CLEAN}),homeUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{syncState:i.CLEAN}),researchInterests:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{syncState:i.CLEAN}),isPrivate:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{syncState:i.CLEAN}),description:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{syncState:i.CLEAN})}})})})}):e}(e);case F.EDIT_ORG_SAVE_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{saveState:c.SAVE_ERROR,saveError:t.error})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_NAME_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.name!==n.name.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:r,validationState:J()})})})})})}),s=Y(a.views.editOrgView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},a.views.editOrgView,{viewModel:Object(W.a)({},a.views.editOrgView.viewModel,{editState:s})})})})}(e,t);case F.EDIT_ORG_UPDATE_NAME_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{name:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.name,{value:t.name,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:J()})})})})})}),n=Y(r.views.editOrgView.viewModel);return Object(W.a)({},r,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},r.views.editOrgView,{viewModel:Object(W.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case F.EDIT_ORG_UPDATE_LOGO_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{logoUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.logoUrl,{value:t.logoUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_HOME_URL_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:J()})})})})})}),n=Y(r.views.editOrgView.viewModel);return Object(W.a)({},r,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},r.views.editOrgView,{viewModel:Object(W.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case F.EDIT_ORG_UPDATE_HOME_URL_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{homeUrl:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.homeUrl,{value:t.homeUrl,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:J()})})})})})}),n=Y(r.views.editOrgView.viewModel);return Object(W.a)({},r,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},r.views.editOrgView,{viewModel:Object(W.a)({},r.views.editOrgView.viewModel,{editState:n})})})})}(e,t);case F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{researchInterests:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.researchInterests,{value:t.researchInterests,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.isPrivate!==n.isPrivate.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{isPrivate:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.isPrivate,{value:t.isPrivate,syncState:r,validationState:J()})})})})})}),o=Y(a.views.editOrgView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},a.views.editOrgView,{viewModel:Object(W.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case F.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS:return function(e,t){if(!e.views.editOrgView.viewModel)return e;var r,n=e.views.editOrgView.viewModel.editedOrganization;r=t.description!==n.description.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:r,validationState:J()})})})})})}),o=Y(a.views.editOrgView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},a.views.editOrgView,{viewModel:Object(W.a)({},a.views.editOrgView.viewModel,{editState:o})})})})}(e,t);case F.EDIT_ORG_UPDATE_DESCRIPTION_ERROR:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{editState:s.EDITED,editedOrganization:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization,{description:Object(W.a)({},e.views.editOrgView.viewModel.editedOrganization.description,{value:t.description,syncState:i.DIRTY,validationState:t.error})})})})})}):e}(e,t);case F.EDIT_ORG_EVALUATE_OK:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{validationState:{type:o.OK,validatedAt:new Date}})})})}):e}(e);case F.EDIT_ORG_EVALUATE_ERRORS:return function(e,t){return e.views.editOrgView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{editOrgView:Object(W.a)({},e.views.editOrgView,{viewModel:Object(W.a)({},e.views.editOrgView.viewModel,{validationState:{type:o.ERROR,message:"Validation errors",validatedAt:new Date}})})})}):e}(e);default:return null}};function X(e,t){switch(t.type){case F.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}var $=function(e,t){switch(t.type){case F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==f.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(W.a)({},e,{type:l.ADMIN}):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},r,{organization:Object(W.a)({},r.organization,{members:n})})})})})}(e,t);case F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==f.NORMAL)return e;var n=r.organization.members.map(function(e){return e.username===t.memberUsername?Object(W.a)({},e,{type:l.MEMBER}):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},r,{organization:Object(W.a)({},r.organization,{members:n})})})})})}(e,t);case F.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_SUCCESS:return function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)return e;if(r.kind!==f.NORMAL)return e;var n=r.organization.members.filter(function(e){return e.username!==t.memberUsername}),a=r.members.filter(function(e){return e.username!==t.memberUsername});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},r,{organization:Object(W.a)({},r.organization,{members:n}),members:a})})})})}(e,t);case F.VIEW_ORG_SORT_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{sortMembersBy:t.sortBy,members:t.members})})})}):e}(e,t);case F.VIEW_ORG_SEARCH_MEMBERS_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{searchMembersBy:t.searchBy,members:t.members})})})}):e}(e,t);default:return null}};function ee(e,t){switch(t.type){case F.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{requestInbox:t.requests})})})}):e}(e,t);default:return null}}function te(e,t){switch(t.type){case F.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{requestOutbox:t.requests})})})}):e}(e,t);default:return null}}var re,ne=r(3),ae=r.n(ne),ie=r(7),se=r(22);!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(re||(re={}));Object(H.a)(Error);var oe,ce,le,ue=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,{code:"group-exception",message:e.apperror,detail:e.message,info:new Map([["httpcode",e.httpcode],["httpstatus",e.httpstatus],["appcode",e.appcode],["apperror",e.apperror],["message",e.message],["callid",e.callid],["time",e.time]])}))).originalError=void 0,r.name="GroupException",r.originalError=e,r}return Object(U.a)(t,e),t}(Q),Ee=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,{code:"server-exception",message:"Server Exception",detail:e}))).name="ServerException",r}return Object(U.a)(t,e),t}(Q),de=function(){function e(t){var r=t.token,n=t.url;Object(C.a)(this,e),this.token=void 0,this.url=void 0,this.token=r,this.url=n}return Object(D.a)(e,[{key:"getInfo",value:function(){return fetch(this.url+"/",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"groupExists",value:function(e){return fetch(this.url+"/group/"+e+"/exists").then(function(e){return e.json()}).then(function(e){return e})}},{key:"listGroups",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGroups",value:function(){var e=this;return fetch(this.url+"/group",{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){if(200!==e.status)throw console.error("error fetching groups",e),new Error("Error fetching groups");return e.json()}).then(function(t){return Promise.all(t.map(function(t){return e.getGroupById(t.id)}))}).then(function(e){return e})}},{key:"getGroupById",value:function(e){return fetch(this.url+"/group/"+e,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors"}).then(function(e){return 404===e.status?null:e.json()}).then(function(e){return e})}},{key:"put",value:function(e,t){var r=[this.url].concat(e).join("/");return fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(t)}).then(function(e){if(500!==e.status){if(200===e.status)return e.json().then(function(e){return e});if(204===e.status){return null}throw new Error("Unexpected response: "+e.status+" : "+e.statusText)}switch(e.headers.get("Content-Type")){case"application/json":return e.json().then(function(e){throw new ue(e)});case"text/plain":return e.text().then(function(e){throw new Ee(e)});default:throw new Error("Unexpected content type: "+e.headers.get("Content-Type"))}})}},{key:"post",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,s;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.url].concat(t).join("/"),e.next=3,fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST",body:r?JSON.stringify(r):""});case 3:if(500!==(a=e.sent).status){e.next=19;break}e.t0=a.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,a.json();case 10:throw i=e.sent,new ue(i);case 12:return e.next=14,a.text();case 14:throw s=e.sent,new Ee(s);case 16:throw new Error("Unexpected content type: "+a.headers.get("Content-Type"));case 17:e.next=30;break;case 19:if(200!==a.status){e.next=25;break}return e.next=22,a.json();case 22:return e.abrupt("return",e.sent);case 25:if(204!==a.status){e.next=29;break}return e.abrupt("return",null);case 29:throw new Error("Unexpected response: "+a.status+" : "+a.statusText);case 30:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.url].concat(t).join("/"),e.next=3,fetch(r,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"});case 3:if(500!==(n=e.sent).status){e.next=19;break}e.t0=n.headers.get("Content-Type"),e.next="application/json"===e.t0?8:"text/plain"===e.t0?12:16;break;case 8:return e.next=10,n.json();case 10:throw a=e.sent,new ue(a);case 12:return e.next=14,n.text();case 14:throw i=e.sent,new Ee(i);case 16:throw new Error("Unexpected content type: "+n.headers.get("Content-Type"));case 17:e.next=26;break;case 19:if(200!==n.status){e.next=25;break}return e.next=22,n.json();case 22:return e.abrupt("return",e.sent);case 25:throw new Error("Unexpected response: "+n.status+" : "+n.statusText);case 26:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(e){var t={name:e.name,private:e.isPrivate,custom:{logourl:e.logoUrl,researchinterests:e.researchInterests,homeurl:e.homeUrl}};return e.description.length>0&&(t.custom.description=e.description),this.put(["group",e.id],t)}},{key:"updateGroup",value:function(e,t){var r={name:t.name,custom:{logourl:t.logoUrl,homeurl:t.homeUrl,researchinterests:t.researchInterests},private:t.private};return t.description&&(r.custom.description=t.description),fetch(this.url+"/group/"+e+"/update",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT",body:JSON.stringify(r)}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"addRelatedGroup",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,!(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i={custom:{relatedgroups:a.join(",")}},e.next=10,this.put(["group",t,"update"],i);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRelatedGroup",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,s;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(["group",t]);case 2:if(n=e.sent,(a=n.custom.relatedgroups?n.custom.relatedgroups.split(","):[]).includes(r)){e.next=6;break}return e.abrupt("return",r);case 6:return a.push(r),i=a.filter(function(e){return e!==r}),s={custom:{relatedgroups:i.join(",")}},e.next=11,this.put(["group",t,"update"],s);case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["request","id",t],e.next=3,this.get(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getGroupRequests",value:function(e,t){var r=new URLSearchParams;return t.includeClosed&&r.append("closed","closed"),t.sortDirection&&(t.sortDirection===re.DESCENDING?r.append("order","desc"):r.append("order","asc")),t.startAt&&r.append("excludeupto",String(t.startAt.getTime())),fetch(this.url+"/group/"+e+"/requests?"+r.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getTargetedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===re.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/targeted?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"getCreatedRequests",value:function(e){var t=new URLSearchParams;return e.includeClosed&&t.append("closed","closed"),e.sortDirection&&(e.sortDirection===re.DESCENDING?t.append("order","desc"):t.append("order","asc")),e.startAt&&t.append("excludeupto",String(e.startAt.getTime())),fetch(this.url+"/request/created?"+t.toString(),{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"appcliation/json"},mode:"cors",method:"GET"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()})}},{key:"addOrRequestNarrative",value:function(e){var t=[this.url,"group",e.groupId,"resource","workspace",String(e.workspaceId)].join("/");return fetch(t,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e.complete,e})}},{key:"grantResourceAccess",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r,n){var a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=["group",t,"resource",r,n,"getperm"],e.abrupt("return",this.post(a,null));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e,t,r){var n=[this.url,"group",e,"resource",t,r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText)})}},{key:"cancelRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/cancel",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"acceptRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/accept",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"grantReadAccessToRequestedResource",value:function(e){var t=["request","id",e.requestId,"getperm"];return this.post(t,null)}},{key:"denyRequest",value:function(e){var t=e.requestId;return fetch(this.url+"/request/id/"+t+"/deny",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status);return e.json()}).then(function(e){return e})}},{key:"memberToAdmin",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"PUT"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"adminToMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r,"admin"].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"updateMember",value:function(e){var t=e.groupId,r=e.memberUsername,n=e.update,a=["group",t,"user",r,"update"];return this.put(a,{custom:n})}},{key:"removeMember",value:function(e){var t=e.groupId,r=e.member,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"DELETE"}).then(function(e){if(204!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText)})}},{key:"requestMembership",value:function(e){return fetch(this.url+"/group/"+e.groupId+"/requestmembership",{headers:{Authorization:this.token,Accept:"application/json","Content-Type":"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+" : "+e.statusText);return e.json()}).then(function(e){return e})}},{key:"inviteUserToGroup",value:function(e){var t=e.groupId,r=e.username,n=[this.url,"group",t,"user",r].join("/");return fetch(n,{headers:{Authorization:this.token,Accept:"application/json"},mode:"cors",method:"POST"}).then(function(e){if(200!==e.status)throw new Error("Unexpected response: "+e.status+":"+e.statusText);return e.json()}).then(function(e){return e})}},{key:"visitGroup",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupId,n=["group",r,"visit"],e.abrupt("return",this.put(n,null));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequests",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.groupIds,n=["request","groups",r.join(","),"new"],e.next=4,this.get(n);case 4:for(a=e.sent,i=new Map,s=Object.entries(a),o=0;o<s.length;o++)c=s[o],l=Object(se.a)(c,2),u=l[0],E=l[1],i.set(u,E);return e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function ve(e){var t=function(e){switch(e){case"Invite":return oe.INVITATION;case"Request":return oe.REQUEST;default:throw new Error("unknown request type: "+e)}}(e.type),r=function(e){switch(e){case"user":return ce.USER;case"workspace":return ce.WORKSPACE;case"catalogmethod":return ce.APP;default:throw new Error("unknown resource type: "+e)}}(e.resourcetype),n=(e.status,le.OPEN);switch(r){case ce.USER:return oe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,user:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ce.WORKSPACE:return oe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,narrativeId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};case ce.APP:return oe.REQUEST,{id:e.id,organizationId:e.groupid,resourceType:r,requester:e.requester,type:t,status:n,appId:e.resource,createdAt:new Date(e.createdate),expireAt:new Date(e.expiredate),modifiedAt:new Date(e.moddate)};default:throw new Error("resource type not handled yet: "+e.resourcetype)}}!function(e){e[e.REQUEST=0]="REQUEST",e[e.INVITATION=1]="INVITATION"}(oe||(oe={})),function(e){e[e.USER=0]="USER",e[e.WORKSPACE=1]="WORKSPACE",e[e.APP=2]="APP"}(ce||(ce={})),function(e){e[e.OPEN=0]="OPEN",e[e.CANCELED=1]="CANCELED",e[e.EXPIRED=2]="EXPIRED",e[e.ACCEPTED=3]="ACCEPTED",e[e.DENIED=4]="DENIED"}(le||(le={}));var me,Oe,pe,Re,he,we=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.cache=void 0,this.params=t,this.groupsClient=new de({url:this.params.groupsServiceURL,token:this.params.token}),this.cache=new Map}return Object(D.a)(e,[{key:"getRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.groupsClient.getRequest(t);case 4:return r=e.sent,n=ve(r),this.cache.set(n.id,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOutboundRequests",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r,n,a=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ve(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserRequestForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ve(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingRequestsForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestInboxForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getCombinedRequestInboxForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.getGroupRequests(t,{includeClosed:!1,sortDirection:re.DESCENDING});case 4:e.t0=function(e){return ve(e)},n=e.sent.map(e.t0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(1),n=[];case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getRequestOutboxForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getCreatedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.filter(function(e){return e.groupid===t}).map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitations",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r,n,a=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getCreatedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ve(e)}).filter(function(e){return e.type===oe.INVITATION})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOrganizationInvitationsForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrganizationInvitations();case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){return e.organizationId===t}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getInboundRequests",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r,n,a=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,t.getTargetedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:return r=e.sent,(n=r.map(function(e){return ve(e)})).forEach(function(e){a.cache.has(e.id)||a.cache.set(e.id,e)}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUserInvitationForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getTargetedRequests({includeClosed:!1,sortDirection:re.DESCENDING});case 3:if(n=e.sent,a=n.find(function(e){return e.groupid===t})){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",ve(a));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequestsForOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.getGroupRequests(t,{includeClosed:!1,sortDirection:re.DESCENDING});case 3:return n=e.sent,e.abrupt("return",n.map(function(e){return ve(e)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingOrganizationRequests",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,Promise.all(t.map(function(e){return r.getGroupRequests(e,{includeClosed:!1,sortDirection:re.DESCENDING})}));case 3:return n=e.sent,a=n.reduce(function(e,t){return e.concat(t)},[]),e.abrupt("return",a.map(function(e){return ve(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cancelRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.cancelRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"denyRequest",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"acceptJoinInvitation",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.acceptRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"rejectJoinInvitation",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.denyRequest({requestId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserToJoinOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.inviteUserToGroup({groupId:t,username:r}).then(function(e){return ve(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),_e=function(){function e(){Object(C.a)(this,e)}return Object(D.a)(e,null,[{key:"testNonPrintableCharacters",value:function(t){var r=t.search(e.nonPrintableRe);if(-1===r)return!1;var n=r-5<0?0:r-5,a=t.slice(n,r),i=t.slice(r+1,r+6);return"Non-printable character at position ".concat(r,': "').concat(a,"___").concat(i)}},{key:"validateOrgId",value:function(e){if(0===e.length)return[e,{type:o.REQUIRED_MISSING,message:"Organization id may not be empty",validatedAt:new Date}];if(e.match(/\s/))return[e,{type:o.ERROR,message:"Organization id may not contain a space",validatedAt:new Date}];if(e.length>100)return[e,{type:o.ERROR,message:"Organization id may not be longer than 100 characters",validatedAt:new Date}];return e.match(/^[a-z0-9-]+$/)?[e,{type:o.OK,validatedAt:new Date}]:[e,{type:o.ERROR,message:'Organization ID may only contain lower case letters (a-z), numeric digits (0-9) and the dash "-"',validatedAt:new Date}]}},{key:"validateOrgName",value:function(e){return 0===e.length?[e,{type:o.REQUIRED_MISSING,message:"Organization name may not be empty",validatedAt:new Date}]:e.length>256?[e,{type:o.ERROR,message:"Organization name may not be longer than 256 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgLogoUrl",value:function(e){return null===e?[e,{type:o.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:o.ERROR,message:"Logo url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgHomeUrl",value:function(e){return null===e?[e,{type:o.OK,validatedAt:new Date}]:e.length>1e3?[e,{type:o.ERROR,message:"Home url may not be longer than 1000 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgResearchInterests",value:function(e){return 0===e.length?[name,{type:o.REQUIRED_MISSING,message:"Research Interests may not be empty",validatedAt:new Date}]:e.length>280?[e,{type:o.ERROR,message:"Research Interests may not be longer than 280 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateOrgDescription",value:function(e){return 0===e.length?[name,{type:o.ERROR,message:"Organization description may not be empty",validatedAt:new Date}]:e.length>4096?[e,{type:o.ERROR,message:"Organization description may not be longer than 4,096 characters",validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}},{key:"validateMemberTitle",value:function(e){return e.length>100?[e,{type:o.ERROR,message:"member title may not be longer than ".concat(100," characters"),validatedAt:new Date}]:[e,{type:o.OK,validatedAt:new Date}]}}]),e}();function ge(e,t,r,n){if(e.kind===Re.INACCESSIBLE_PRIVATE)return r&&r.user===t?{type:me.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:me.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:me.NONE};if(t===e.owner.username)return{type:me.OWNER};var a=e.members.find(function(e){return e.username===t});if(!a)return r&&r.user===t?{type:me.MEMBER_REQUEST_PENDING,requestId:r.id}:n&&n.user===t?{type:me.MEMBER_INVITATION_PENDING,requestId:n.id}:{type:me.NONE};switch(a.type){case Oe.MEMBER:return{type:me.MEMBER};case Oe.ADMIN:return{type:me.ADMIN};case Oe.OWNER:return{type:me.OWNER};default:return{type:me.NONE}}}function Se(e){switch(e){case"None":return pe.NONE;case"Read":return pe.VIEW;case"Write":return pe.EDIT;case"Admin":return pe.ADMIN;case"Own":return pe.OWNER;default:throw new Error("Invalid groups user permission: "+e)}}function fe(e,t){var r={username:e.owner.name,joinedAt:new Date(e.owner.joined),lastVisitedAt:e.owner.lastvisit?new Date(e.owner.lastvisit):null,type:Oe.OWNER,title:e.owner.custom.title},n=[].concat(e.admins.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:Oe.ADMIN,title:e.custom.title}})).concat(e.members.map(function(e){return{username:e.name,joinedAt:new Date(e.joined),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,type:Oe.MEMBER,title:e.custom.title}})),a=e.resources.workspace.map(function(e){return{workspaceId:parseInt(e.rid,10),title:e.narrname,isPublic:e.public,permission:Se(e.perm),createdAt:new Date(e.narrcreate),updatedAt:new Date(e.moddate),description:e.description,addedAt:null===e.added?null:new Date(e.added)}});return{kind:Re.NORMAL,id:e.id,name:e.name,isPrivate:e.private,isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,relation:ye(e.role),logoUrl:e.custom.logourl||null,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||"",description:e.custom.description,owner:r,areMembersPrivate:e.privatemembers,members:n,modifiedAt:new Date(e.moddate),createdAt:new Date(e.createdate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,narratives:a,apps:[],memberCount:e.memcount,narrativeCount:e.rescount.workspace||0,appCount:e.rescount.catalogmethod||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}function Ae(e,t){return{kind:Re.INACCESSIBLE_PRIVATE,id:e.id,isPrivate:e.private,relation:ye(e.role)}}function Ne(e,t){var r=t.map(function(e){return new RegExp(e,"i")});return e.filter(function(e){return 0===t.length||r.every(function(t){return t.test(e.name)||t.test(e.researchInterests||"")||t.test(e.owner.username)})})}function Ie(e){var t=e.getTime();return Math.round(t/864e5)}function be(e,t,r,n){switch(e){case"created":return t*(Ie(r.createdAt)-Ie(n.createdAt));case"modified":case"changed":return t*(Ie(r.modifiedAt)-Ie(n.modifiedAt));case"name":return t*r.name.localeCompare(n.name);case"owner":return t*r.owner.username.localeCompare(n.owner.username);case"narrativeCount":return t*(r.narrativeCount-n.narrativeCount);case"memberCount":return t*(r.memberCount-n.memberCount);default:return console.warn("unimplemented sort field: "+e),0}}function Te(e,t,r){var n=r===p.ASCENDING?1:-1;return e.slice().sort(function(e,r){return be(t,n,e,r)||be("name",1,e,r)})}function ye(e){switch(e){case"None":return me.NONE;case"Member":return me.MEMBER;case"Admin":return me.ADMIN;case"Owner":return me.OWNER;default:throw new Error("Unknown role: "+e)}}function Me(e,t,r){var n=t.roleType,a=t.roles,i=t.privacy;return e.filter(function(e){return function(e){switch(n){case"myorgs":return[me.MEMBER,me.ADMIN,me.OWNER].includes(e.relation);case"notmyorgs":return![me.MEMBER,me.ADMIN,me.OWNER].includes(e.relation);case"all":default:return!0}}(e)&&function(e){return 0===a.length||a.some(function(t){switch(t){case"member":return e.relation===me.MEMBER;case"admin":return e.relation===me.ADMIN;case"owner":return e.relation===me.OWNER;default:return!1}})}(e)&&function(e){switch(i){case"public":return!e.isPrivate;case"private":return e.isPrivate;case"any":return!0;default:return!1}}(e)})}function Ce(e){switch(e){case"name":return function(e,t){return e.title.localeCompare(t.title)};case"updated":return function(e,t){return t.updatedAt.getTime()-e.updatedAt.getTime()};default:case"added":return function(e,t){return null===e.addedAt?null===t.addedAt?0:1:null===t.addedAt?-1:t.addedAt.getTime()-e.addedAt.getTime()}}}function De(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=Ce(t)(e,r);return 0===n&&"name"!==t?Ce("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.title)})})}(e,t.searchBy),t.sortBy)}function Ve(e){switch(e){case"name":return function(e,t){return e.username.localeCompare(t.username)};default:case"added":return function(e,t){return t.joinedAt.getTime()-e.joinedAt.getTime()}}}function ke(e,t){return function(e,t){return t?e.slice().sort(function(e,r){var n=Ve(t)(e,r);return 0===n&&"name"!==t?Ve("name")(e,r):n}):e}(function(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return 0===r.length?e:e.slice().filter(function(e){return r.every(function(t){return t.test(e.username)||t.test(e.title||"")})})}(e,t.searchBy),t.sortBy)}_e.nonPrintableRe=/[\000-\031]/,function(e){e.NONE="NONE",e.VIEW="VIEW",e.MEMBER_REQUEST_PENDING="MEMBER_REQUEST_PENDING",e.MEMBER_INVITATION_PENDING="MEMBER_INVITATION_PENDING",e.MEMBER="MEMBER",e.ADMIN="ADMIN",e.OWNER="OWNER"}(me||(me={})),function(e){e[e.MEMBER=0]="MEMBER",e[e.ADMIN=1]="ADMIN",e[e.OWNER=2]="OWNER"}(Oe||(Oe={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(pe||(pe={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.INACCESSIBLE_PRIVATE=1]="INACCESSIBLE_PRIVATE"}(Re||(Re={})),function(e){e.INAPPLICABLE="INAPPLICABLE",e.NONE="NONE",e.OLD="OLD",e.NEW="NEW"}(he||(he={}));var Ue=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.groupsClient=void 0,this.params=t,this.groupsClient=new de({url:this.params.groupsServiceURL,token:this.params.token})}return Object(D.a)(e,[{key:"getOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.groupsClient.getGroupById(t).then(function(e){return"None"===e.role&&e.private?Ae(e,r.params.username):fe(e,r.params.username)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrganization",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroupById(t);case 2:if("None"!==(r=e.sent).role||!r.private){e.next=5;break}throw new Error("Inaccessible Organization");case 5:return e.abrupt("return",fe(r,this.params.username));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map(function(e){return r.getOrg(e)})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.getGroups();case 2:return t=e.sent,r=t.map(function(e){return e.id}),e.abrupt("return",this.getOrgs(r));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getOwnOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return t=e.sent,r=t.filter(function(e){return e.relation!==me.NONE}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listGroupToBriefOrganization",value:function(e){return{id:e.id,name:e.name,logoUrl:e.custom.logourl||null,isPrivate:e.private,homeUrl:e.custom.homeurl||null,researchInterests:e.custom.researchinterests||null,owner:{username:e.owner,lastVisitedAt:null,type:Oe.OWNER,joinedAt:new Date(e.createdate),title:"Owner"},relation:ye(e.role),isMember:"None"!==e.role,isAdmin:"Admin"===e.role||"Owner"===e.role,isOwner:"Owner"===e.role,createdAt:new Date(e.createdate),modifiedAt:new Date(e.moddate),lastVisitedAt:e.lastvisit?new Date(e.lastvisit):null,memberCount:e.memcount||0,narrativeCount:e.rescount.workspace||0,relatedOrganizations:e.custom&&e.custom.relatedgroups?e.custom.relatedgroups.split(","):[]}}},{key:"getAllOrgs2",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){var t,r=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.groupsClient.listGroups();case 2:return t=e.sent,e.abrupt("return",t.map(function(e){return r.listGroupToBriefOrganization(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=Me(r,t.filter,t.username),a=Ne(n,t.searchTerms),i=Te(a,t.sortField,t.sortDirection),e.abrupt("return",{organizations:i,total:r.length});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"ownOrgs",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllOrgs2();case 2:return r=e.sent,n=r.filter(function(e){return e.relation!==me.NONE}),e.abrupt("return",{organizations:n,total:n.length});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"grantViewAccess",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.grantReadAccessToRequestedResource({requestId:t});case 3:return e.next=5,r.getRequest(t);case 5:return n=e.sent,e.abrupt("return",ve(n));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new de({url:this.params.groupsServiceURL,token:this.params.token}),t.id.validationState.type===o.OK&&t.name.validationState.type===o.OK&&t.logoUrl.validationState.type===o.OK&&t.description.validationState.type===o.OK&&t.isPrivate.validationState.type===o.OK){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("One or more fields are invalid")));case 3:return e.abrupt("return",n.createGroup({id:t.id.value,name:t.name.value,logoUrl:t.logoUrl.value,homeUrl:t.homeUrl.value,researchInterests:t.researchInterests.value,description:t.description.value,isPrivate:t.isPrivate.value}).then(function(e){return fe(e)}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"orgExists",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",r.groupExists(t).then(function(e){return e.exists}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.updateGroup(t,{name:r.name,logoUrl:r.logoUrl,homeUrl:r.homeUrl,researchInterests:r.researchInterests,description:r.description,private:r.isPrivate}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"validateOrgId",value:function(e){return _e.validateOrgId(e)}},{key:"validateOrgName",value:function(e){return _e.validateOrgName(e)}},{key:"validateOrgDescription",value:function(e){return _e.validateOrgDescription(e)}},{key:"removeNarrativeFromOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.deleteResource(t,"workspace",String(r)));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"grantNarrativeAccess",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.grantResourceAccess(t,"workspace",r);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"requestMembership",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,r.requestMembership({groupId:t});case 3:return n=e.sent,e.abrupt("return",ve(n));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrRequestNarrativeToGroup",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=3,n.addOrRequestNarrative({groupId:t,workspaceId:r});case 3:if(!0!==(a=e.sent).complete){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",ve(a));case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"memberToAdmin",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.memberToAdmin({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"adminToMember",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.adminToMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeMember",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.removeMember({groupId:t,member:r}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateMember",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r,n){var a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",a.updateMember({groupId:t,memberUsername:r,update:n}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"visitOrg",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.abrupt("return",n.visitGroup({groupId:r}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestsStatus",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E,d,v,m,O;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationIds,n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:r});case 4:for(a=e.sent,i=new Map,s=!0,o=!1,c=void 0,e.prev=9,l=a.entries()[Symbol.iterator]();!(s=(u=l.next()).done);s=!0)E=u.value,d=Object(se.a)(E,2),v=d[0],m=d[1],O=ze(m),i.set(v,O);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),o=!0,c=e.t0;case 17:e.prev=17,e.prev=18,s||null==l.return||l.return();case 20:if(e.prev=20,!o){e.next=23;break}throw c;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpenRequestStatus",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E,d;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,n.getOpenRequests({groupIds:[r]});case 4:a=e.sent,i=!0,s=!1,o=void 0,e.prev=8,c=a.entries()[Symbol.iterator]();case 10:if(i=(l=c.next()).done){e.next=19;break}return u=l.value,E=Object(se.a)(u,2),E[0],d=E[1],e.abrupt("return",ze(d));case 16:i=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),s=!0,o=e.t0;case 25:e.prev=25,e.prev=26,i||null==c.return||c.return();case 28:if(e.prev=28,!s){e.next=31;break}throw o;case 31:return e.finish(28);case 32:return e.finish(25);case 33:throw new Error("expected request status, got none");case 34:case"end":return e.stop()}},e,this,[[8,21,25,33],[26,,28,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addRelatedOrganization",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.addRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeRelatedOrganization",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.organizationId,n=t.relatedOrganizationId,a=new de({url:this.params.groupsServiceURL,token:this.params.token}),e.next=4,a.removeRelatedGroup(r,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function ze(e){switch(e.new){case"None":return he.NONE;case"Old":return he.OLD;case"New":return he.NEW;default:throw new Error("Invalid open request status: "+e)}}var Ge=r(42),je=r.n(Ge);function Le(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,s=e.info;return{code:t,message:r,detail:n,id:je()(),at:new Date,history:a,trace:i,info:s}}function Pe(e,t){var r=t.split(/\s+/).map(function(e){return new RegExp(e,"i")});return e.filter(function(e){var t=e.organization;return r.every(function(e){return e.test(t.name)||e.test(t.owner.username)})})}function Be(e,t){switch(t.type){case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:{state:N.OK,error:null,viewModel:{kind:A.MANAGE_RELATED_ORGS,relatedOrganizations:e.views.viewOrgView.viewModel.organization.relatedOrganizations,organization:e.views.viewOrgView.viewModel.organization,availableOrganizations:{organizations:t.organizations,queried:t.organizations,searchBy:""},selectedOrganization:null}}})})})})}):e}(e,t);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:{state:N.NONE,error:null,viewModel:null}})})})})}):e}(e);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,n=r.organizations.map(function(e){return e.organization.id===t.selectedOrganization.organization.id?e.isSelected=!0:e.isSelected=!1,e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{selectedOrganization:t.selectedOrganization,availableOrganizations:{organizations:n,queried:Pe(n,r.searchBy),searchBy:r.searchBy}})})})})})})})}(e,t);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,n=e.views.viewOrgView.viewModel.organization.relatedOrganizations.concat([t.organizationId]),a=r.organizations.map(function(e){return n.includes(e.organization.id)?e.isRelated=!0:e.isRelated=!1,e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:n}),subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:{organizations:a,queried:Pe(a,r.searchBy),searchBy:r.searchBy}})})})})})})})}(e,t);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;if(null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId}),n=e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,a=n.organizations.filter(function(e){return e.organization.id===t.organizationId&&(e.isRelated=!1),e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r}),subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:{organizations:a,queried:Pe(a,n.searchBy),searchBy:n.searchBy}})})})})})})})}(e,t);case F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:null===e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{manageRelatedOrganizationsView:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel,{availableOrganizations:Object(W.a)({},e.views.viewOrgView.viewModel.subViews.manageRelatedOrganizationsView.viewModel.availableOrganizations,{queried:t.organizations,searchBy:t.searchBy})})})})})})})}):e}(e,t);default:return null}}function xe(e,t){switch(t.type){case F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.relatedOrganizations.filter(function(e){return e!==t.organizationId});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{relatedOrganizations:r})})})})})}(e,t);default:return null}}var We=function(e,t){switch(t.type){case F.VIEW_ORG_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.VIEW_ORG_LOAD_NORMAL_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{kind:f.NORMAL,organization:t.organization,relation:t.relation,openRequest:t.openRequest,groupRequests:t.groupRequests,groupInvitations:t.groupInvitations,requestInbox:t.requestInbox,requestOutbox:t.requestOutbox,sortNarrativesBy:t.narrativesSortBy,searchNarrativesBy:"",narratives:t.narratives,sortMembersBy:t.sortMembersBy,members:t.members,searchMembersBy:"",subViews:{manageRelatedOrganizationsView:{state:N.NONE,viewModel:null,error:null},inviteUserView:{state:N.NONE,viewModel:null,error:null}}}}})})}(e,t);case F.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.SUCCESS,error:null,viewModel:{kind:f.PRIVATE_INACCESSIBLE,organization:t.organization,relation:t.relation,requestOutbox:t.requestOutbox}}})})}(e,t);case F.VIEW_ORG_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.VIEW_ORG_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;var r=e.views.viewOrgView.viewModel.organization.narratives.filter(function(e){return e.workspaceId!==t.narrativeId}),n=e.views.viewOrgView.viewModel.narratives.filter(function(e){return e.workspaceId!==t.narrativeId});return console.log("new narratives...",r),Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:Object(W.a)({},e.views.viewOrgView.viewModel.organization,{narratives:r}),narratives:n})})})})}(e,t);case F.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{organization:t.organization,narratives:t.narratives})})})}):e}(e,t);case F.VIEW_ORG_SORT_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{sortNarrativesBy:t.sortBy,narratives:t.narratives})})})}):e}(e,t);case F.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS:return function(e,t){return e.views.viewOrgView.viewModel?e.views.viewOrgView.viewModel.kind!==f.NORMAL?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{searchNarrativesBy:t.searchBy,narratives:t.narratives})})})}):e}(e,t)}return X(e,t)||ee(e,t)||te(e,t)||$(e,t)||Be(e,t)||xe(e,t)};function qe(e,t){switch(t.type){case F.BROWSE_ORGS_LOAD_SUCCESS:return function(e,t){var r=t.defaultViewModel,n=r.rawOrganizations,a=r.organizations,i=r.openRequests,s=r.searchTerms,o=r.sortField,c=r.sortDirection,l=r.filter,u=r.totalCount,E=r.filteredCount,d=r.selectedOrganizationId,v=r.error,m=r.searching;return Object(W.a)({},e,{loadingState:R.SUCCESS,error:null,viewModel:{rawOrganizations:n,organizations:a,openRequests:i,searchTerms:s,sortField:o,sortDirection:c,filter:l,totalCount:u,filteredCount:E,selectedOrganizationId:d,error:v,searching:m}})}(e,t);case F.BROWSE_ORGS_SEARCH:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{selectedOrganizationId:null,searchTerms:t.searchTerms,searching:!0})})}(e,t);case F.BROWSE_ORGS_SEARCH_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{searching:!0})})}(e);case F.BROWSE_ORGS_SEARCH_SUCCESS:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{organizations:t.organizations,openRequests:t.openRequests,totalCount:t.totalCount,filteredCount:t.organizations.length,searching:!1})})}(e,t);case F.BROWSE_ORGS_SEARCH_ERROR:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{searching:!1,error:t.error})})}(e,t);case F.BROWSE_ORGS_SORT_START:return function(e,t){return null===e.viewModel?(console.warn("Cannot start browseOrgs view"),e):Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{sortField:t.sortField,sortDirection:t.sortDirection,searching:!0})})}(e,t);case F.BROWSE_ORGS_FILTER_START:return function(e,t){if(null===e.viewModel)return console.warn("Cannot start browseOrgs view"),e;var r=t.filter;return Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{filter:r,searching:!0})})}(e,t);case F.BROWSE_ORGS_UNLOAD:return{loadingState:R.NONE,error:null,viewModel:null};default:return null}}var He=function(e,t){switch(t.type){case F.AUTH_CHECK_START:return function(e,t){return Object(W.a)({},e,{auth:{status:v.CHECKING,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case F.AUTH_AUTHORIZED:return function(e,t){return Object(W.a)({},e,{auth:{status:v.AUTHORIZED,message:"",authorization:{token:t.token,username:t.username,realname:t.realname,roles:t.roles}}})}(e,t);case F.AUTH_UNAUTHORIZED:return function(e,t){return Object(W.a)({},e,{auth:{status:v.UNAUTHORIZED,message:"",authorization:{token:"",username:"",realname:"",roles:[]}}})}(e);case F.AUTH_CHECK_ERROR:return function(e,t){return Object(W.a)({},e,{auth:{status:v.ERROR,message:t.error.message,authorization:{token:"",username:"",realname:"",roles:[]}}})}(e,t);default:return null}};var Fe=function(e,t){switch(t.type){case F.APP_SUCCESS:return function(e,t){return Object(W.a)({},e,{app:{status:O.READY,config:t.config}})}(e,t);default:return null}};var Qe=function(e,t){switch(t.type){case F.ADMIN_MANAGE_REQUESTS_LOAD_START:return function(e,t){return e}(e);case F.ADMIN_MANAGE_REQUESTS_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,requests:t.requests,invitations:t.invitations}}})})}(e,t);case F.ADMIN_MANAGE_REQUESTS_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.ADMIN_MANAGE_REQUESTS_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.ADMIN_MANAGE_REQUESTS_GET_VIEW_ACCESS_SUCCESS:return function(e,t){if(!e.views.manageOrganizationRequestsView.viewModel)return e;var r=e.views.manageOrganizationRequestsView.viewModel.requests.map(function(e){return(e.id=t.request.id)?t.request:e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageOrganizationRequestsView:Object(W.a)({},e.views.manageOrganizationRequestsView,{viewModel:Object(W.a)({},e.views.manageOrganizationRequestsView.viewModel,{requests:r})})})})}(e,t);default:return null}};var Ze=function(e,t){switch(t.type){case F.VIEW_MEMBERS_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.LOADING,viewModel:null,error:null})})})}(e);case F.VIEW_MEMBERS_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.SUCCESS,viewModel:{organization:t.organization,relation:t.relation},error:null})})})}(e,t);case F.VIEW_MEMBERS_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.ERROR,viewModel:null,error:t.error})})})}(e,t);case F.VIEW_MEMBERS_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{loadingState:R.NONE,viewModel:null,error:null})})})}(e);case F.VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.ADMIN,e):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{viewModel:Object(W.a)({},e.views.viewMembersView.viewModel,{organization:Object(W.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);case F.VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS:return function(e,t){if(null===e.views.viewMembersView.viewModel)return e;var r=e.views.viewMembersView.viewModel.organization.members.map(function(e){return e.username===t.memberUsername?(e.type=l.MEMBER,e):e});return Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewMembersView:Object(W.a)({},e.views.viewMembersView,{viewModel:Object(W.a)({},e.views.viewMembersView.viewModel,{organization:Object(W.a)({},e.views.viewMembersView.viewModel.organization,{members:r})})})})})}(e,t);default:return null}};function Je(e,t){switch(t.type){case F.INVITE_USER_LOAD_START:return{state:N.LOADING,viewModel:null,error:null};case F.INVITE_USER_LOAD_SUCCESS:return function(e,t){return{state:N.OK,error:null,viewModel:{editState:w.EDITING,users:t.users,organization:t.organization,selectedUser:null}}}(0,t);case F.INVITE_USER_LOAD_ERROR:return function(e,t){return{state:N.ERROR,error:t.error,viewModel:null}}(0,t);case F.INVITE_USER_UNLOAD:return{state:N.NONE,error:null,viewModel:null};case F.INVITE_USER_SEARCH_USERS_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{users:t.users})})}(e,t);case F.INVITE_USER_SELECT_USER_SUCCESS:return function(e,t){return null===e.viewModel?e:Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{selectedUser:{user:t.user,relation:t.relation}})})}(e,t);case F.INVITE_USER_SEND_INVITATION_START:return function(e,t){return null===e.viewModel?e:Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{editState:w.SENDING})})}(e);case F.INVITE_USER_SEND_INVITATION_SUCCESS:return function(e,t){if(null===e.viewModel)return e;var r=e.viewModel,n=r.selectedUser,a=r.users;if(!n)throw new Error("selected user is null");if(n.relation=me.MEMBER_INVITATION_PENDING,!a)throw new Error("users is null");var i=a.map(function(e){return e.username===n.user.username&&(e.relation=me.MEMBER_INVITATION_PENDING),e});return Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{editState:w.SUCCESS,selectedUser:n,users:i})})}(e);case F.INVITE_USER_SEND_INVITATION_ERROR:return function(e,t){return null===e.viewModel?e:Object(W.a)({},e,{viewModel:Object(W.a)({},e.viewModel,{editState:w.ERROR})})}(e);default:return null}}var Ye=function(e,t){if(!function(e){switch(e.type){case F.INVITE_USER_LOAD_START:case F.INVITE_USER_LOAD_SUCCESS:case F.INVITE_USER_LOAD_ERROR:case F.INVITE_USER_UNLOAD:case F.INVITE_USER_SEARCH_USERS_SUCCESS:case F.INVITE_USER_SELECT_USER_SUCCESS:case F.INVITE_USER_SEND_INVITATION_START:case F.INVITE_USER_SEND_INVITATION_SUCCESS:case F.INVITE_USER_SEND_INVITATION_ERROR:return!0;default:return!1}}(t))return null;if(!e.views.viewOrgView.viewModel)return e;if(e.views.viewOrgView.viewModel.kind!==f.NORMAL)return e;var r=Je(e.views.viewOrgView.viewModel.subViews.inviteUserView,t);return null===r?null:Object(W.a)({},e,{views:Object(W.a)({},e.views,{viewOrgView:Object(W.a)({},e.views.viewOrgView,{viewModel:Object(W.a)({},e.views.viewOrgView.viewModel,{subViews:Object(W.a)({},e.views.viewOrgView.viewModel.subViews,{inviteUserView:r})})})})})};function Ke(){return{type:o.OK,validatedAt:new Date}}function Xe(e){return e.editableMemberProfile.title.syncState===i.DIRTY?s.EDITED:s.UNEDITED}var $e=function(e,t){switch(t.type){case F.MANAGE_MEMBERSHIP_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.MANAGE_MEMBERSHIP_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,editableMemberProfile:t.editableMemberProfile,editState:s.UNEDITED,saveState:c.NEW,validationState:Ke()}}})})}(e,t);case F.MANAGE_MEMBERSHIP_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.ERROR,error:t.error,viewModel:null}})})}(e,t);case F.MANAGE_MEMBERSHIP_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r,n=e.views.manageMembershipView.viewModel.editableMemberProfile;r=t.title!==n.title.remoteValue?i.DIRTY:i.CLEAN;var a=Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{editableMemberProfile:Object(W.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile,{title:{value:t.title,remoteValue:t.title,syncState:r,validationState:Ke()}})})})})}),s=Xe(a.views.manageMembershipView.viewModel);return Object(W.a)({},a,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},a.views.manageMembershipView,{viewModel:Object(W.a)({},a.views.manageMembershipView.viewModel,{editState:s})})})})}(e,t);case F.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS:return function(e,t){if(!e.views.manageMembershipView.viewModel)return e;var r=Xe(e.views.manageMembershipView.viewModel);return Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{editState:r,validationState:{type:o.OK,validatedAt:new Date}})})})})}(e);case F.MANAGE_MEMBERSHIP_EVALUATE_ERROR:return function(e,t){return e.views.manageMembershipView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{validationState:{type:o.ERROR,message:"Validation error(s)",validatedAt:new Date}})})})}):e}(e);case F.MANAGE_MEMBERSHIP_SAVE_SUCCESS:return function(e,t){return e.views.manageMembershipView.viewModel?Object(W.a)({},e,{views:Object(W.a)({},e.views,{manageMembershipView:Object(W.a)({},e.views.manageMembershipView,{viewModel:Object(W.a)({},e.views.manageMembershipView.viewModel,{editState:s.UNEDITED,saveState:c.SAVED,editableMemberProfile:{title:Object(W.a)({},e.views.manageMembershipView.viewModel.editableMemberProfile.title,{syncState:i.CLEAN})}})})})}):e}(e);default:return null}};function et(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{viewModel:Object(W.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVING})})})})}var tt=function(e,t){switch(t.type){case F.REQUEST_ADD_NARRATIVE_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{loadingState:R.LOADING,error:null,viewModel:null})})})}(e);case F.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,narratives:t.narratives,selectedNarrative:null,relation:t.relation,error:null,saveState:c.SAVED}})})})}(e,t);case F.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{loadingState:R.ERROR,error:t.error,viewModel:null})})})}(e,t);case F.REQUEST_ADD_NARRATIVE_SEND_START:return et(e);case F.REQUEST_ADD_NARRATIVE_SEND_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");var r=Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{viewModel:Object(W.a)({},e.views.requestNarrativeView.viewModel,{saveState:c.SAVED})})})}),n=r.views.requestNarrativeView.viewModel;if(!n)throw new Error("view model missing");var a=n.selectedNarrative;return!0===t.request?n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=_.ASSOCIATED),e}):n.narratives=n.narratives.map(function(e){return e.narrative.workspaceId===a.narrative.workspaceId&&(e.status=_.REQUESTED),e}),r}(e,t);case F.REQUEST_ADD_NARRATIVE_LOAD_ERROR:return et(e);case F.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS:return function(e,t){if(!e.views.requestNarrativeView.viewModel)throw new Error("view model missing");return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{error:null,viewModel:Object(W.a)({},e.views.requestNarrativeView.viewModel,{selectedNarrative:t.narrative})})})})}(e,t);case F.REQUEST_ADD_NARRATIVE_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);case F.REQUEST_ADD_NARRATIVE_SORT_SUCCESS:return function(e,t){var r=e.views.requestNarrativeView.viewModel;return null===r?e:Object(W.a)({},e,{views:Object(W.a)({},e.views,{requestNarrativeView:Object(W.a)({},e.views.requestNarrativeView,{viewModel:Object(W.a)({},r,{narratives:t.narratives})})})})}(e,t);default:return null}};function rt(e,t){switch(t.type){case F.ENTITY_ORGANIZATION_LOAD_SUCCESS:return function(e,t){var r=new Map(e.entities.organizations.byId);return r.set(t.organization.id,t.organization),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{organizations:Object(W.a)({},e.entities.organizations.byId,{byId:r})})})}(e,t);default:return null}}function nt(e,t){switch(t.type){case F.ENTITY_USER_LOADER_SUCCESS:return function(e,t){var r=e.entities.users;return r.byId.set(t.user.username,t.user),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{users:Object(W.a)({},e.entities.users,{byId:new Map(r.byId)})})})}(e,t);case F.ENTITY_ORGANIZATION_LOADER_SUCCESS:return function(e,t){var r=e.entities.orgs.byId;return r.set(t.organization.id,t.organization),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{orgs:Object(W.a)({},e.entities.orgs,{byId:new Map(r)})})})}(e,t);case F.ENTITY_NARRATIVE_LOAD_SUCCESS:return function(e,t){var r=e.entities.narratives;return r.byId.set(t.narrative.workspaceId,t.narrative),Object(W.a)({},e,{entities:Object(W.a)({},e.entities,{narratives:Object(W.a)({},e.entities.narratives,{byId:new Map(r.byId)})})})}(e,t)}return rt(e,t)}var at=function(e,t){switch(t.type){case F.ORGANIZATION_CENTRIC_VIEW_LOAD_START:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:{loadingState:R.LOADING,error:null,viewModel:null}})})}(e);case F.ORGANIZATION_CENTRIC_VIEW_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:Object(W.a)({},e.views.organizationCentricView,{loadingState:R.SUCCESS,error:null,viewModel:{organization:t.organization,pendingJoinRequest:t.pendingJoinRequest,pendingJoinInvitation:t.pendingJoinInvitation,relation:t.relation}})})})}(e,t);case F.ORGANIZATION_CENTRIC_VIEW_LOAD_ERROR:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:Object(W.a)({},e.views.organizationCentricView,{loadingState:R.ERROR,error:t.error,viewModel:null})})})}(e,t);case F.ORGANIZATION_CENTRIC_VIEW_UNLOAD:return function(e,t){return Object(W.a)({},e,{views:Object(W.a)({},e.views,{organizationCentricView:{loadingState:R.NONE,error:null,viewModel:null}})})}(e);default:return null}};function it(e,t){switch(t.type){case F.DATA_SERVICE_LOAD_SUCCESS:return function(e,t){return Object(W.a)({},e,{db:Object(W.a)({},e.db)})}(e);default:return null}}var st,ot=function(e,t){return Z(e,t)||K(e,t)||function(e,t){var r=qe(e.views.browseOrgsView,t);return r?Object(W.a)({},e,{views:Object(W.a)({},e.views,{browseOrgsView:r})}):null}(e,t)||We(e,t)||He(e,t)||Fe(e,t)||Qe(e,t)||Ze(e,t)||Ye(e,t)||$e(e,t)||tt(e,t)||nt(e,t)||at(e,t)||it(e,t)||e},ct=(r(170),r(146)),lt=r(74),ut=(r(172),r(355)),Et=r(356),dt=r(60),vt=r.n(dt),mt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLogoUrl",value:function(){return this.props.logoUrl?b.createElement("img",{src:this.props.logoUrl,width:this.props.size}):b.createElement("span",null,"n/a")}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultInitial",value:function(){var e=this.charAt(this.props.organizationName,0).toUpperCase(),t=vt()(this.props.organizationId).substr(0,6);return b.createElement("svg",{width:this.props.size,height:this.props.size,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},b.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:this.props.size-12,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogo",value:function(){return this.props.logoUrl?this.renderLogoUrl():this.renderDefaultInitial()}},{key:"render",value:function(){return this.renderLogo()}}]),t}(b.Component),Ot=r(338),pt=r(20),Rt=r(347),ht=r(354),wt=r(349),_t=(r(176),r(178),r(114)),gt=r.n(_t),St=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"getAvatarUrl",value:function(e){switch(e.avatarOption||"gravatar"){case"gravatar":var t=e.gravatarDefault||"identicon",r=e.gravatarHash;return r?"https://www.gravatar.com/avatar/"+r+"?s=60&amp;r=pg&d="+t:gt.a;case"silhouette":case"mysteryman":default:return gt.a}}},{key:"render",value:function(){var e=this.getAvatarUrl(this.props.user);return b.createElement("img",{src:e,style:{width:this.props.size}})}}]),t}(b.Component);function ft(e){switch(e){case st.COMPACT:return st.NORMAL;case st.NORMAL:return st.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(st||(st={}));var At=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:st.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:ft(this.state.view)})}},{key:"renderRole",value:function(){return b.createElement("span",null,b.createElement(pt.a,{type:"crown"})," owner")}},{key:"renderAvatar",value:function(){if(this.props.showAvatar)return b.createElement("div",{className:"Owner-avatarCol"},b.createElement(St,{user:this.props.user,size:this.props.avatarSize||30}))}},{key:"renderCompact",value:function(){var e=b.createElement("div",null,b.createElement("div",null,this.props.user.realname),b.createElement("div",null,b.createElement("span",null,b.createElement(St,{user:this.props.user,size:20}))," ",b.createElement("span",null,this.props.user.username)));return b.createElement("div",{className:"Owner-owner"},this.renderAvatar(),b.createElement("div",{className:"Owner-infoCol"},b.createElement("div",{className:"Owner-name"},b.createElement(Ot.a,{placement:"bottomRight",title:e},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))))}},{key:"renderNormal",value:function(){return b.createElement("div",{className:"Owner View-NORMAL"},b.createElement("div",{className:"Owner-controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===st.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===st.NORMAL?"up":"down")}))),b.createElement("div",{className:"Owner-avatarCol"},b.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"Owner-infoCol"},b.createElement("div",{className:"Owner-name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),b.createElement("div",{className:"Owner-username"},this.props.user.username),b.createElement("div",{className:"Owner-title"},this.props.user.title||b.createElement("i",null,"no title in user profile")),b.createElement("div",{className:"Owner-organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"Owner-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){return this.renderCompact()}}]),t}(b.Component),Nt=function(){function e(t){var r=t.url,n=t.token;Object(C.a)(this,e),this.url=void 0,this.token=void 0,this.url=r,this.token=n||null}return Object(D.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[t]}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.constructor.module+"."+e,id:String(Math.random()).slice(2),params:[]}}}]),e}();Nt.module=void 0;var It=function(e){function t(e){var r;if(Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"callFunc",value:function(e,t){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(e,t))}).then(function(e){if(200!==e.status)throw new Error("Request error: "+e.status+", "+e.statusText);return e.json()})}}]),t}(Nt),bt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"getVersion",value:function(){return fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makeEmptyPayload("version"))}).then(function(e){if(200!==e.status)throw new Error("User profile request error: "+e.status+", "+e.statusText);return e.json()})}},{key:"getUserProfile",value:function(){var e=Object(ie.a)(ae.a.mark(function e(r){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.profileCache.has(r)){e.next=2;break}return e.abrupt("return",Promise.resolve(t.profileCache.get(r)));case 2:return e.abrupt("return",this.callFunc("get_user_profile",[r]).then(function(e){return e.result[0][0]}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateUserProfile",value:function(){var e=Object(ie.a)(ae.a.mark(function e(r){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.profileCache.delete(r.user.username),e.abrupt("return",this.callFunc("update_user_profile",{profile:r}).then(function(){}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserProfiles",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("get_user_profile",t).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllUsers",value:function(){var e=Object(ie.a)(ae.a.mark(function e(){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:""}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callFunc("filter_users",{filter:t}).then(function(e){return e.result[0]}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(It);function Tt(e){var t;return e.profile.userdata?(t="Other"===e.profile.userdata.jobTitle?e.profile.userdata.jobTitleOther:e.profile.userdata.jobTitle,{username:e.user.username,realname:e.user.realname,city:e.profile.userdata.city,state:e.profile.userdata.state,country:e.profile.userdata.country,title:t,organization:e.profile.userdata.organization,avatarOption:e.profile.userdata.avatarOption,gravatarHash:e.profile.synced.gravatarHash,gravatarDefault:e.profile.userdata.gravatarDefault}):{username:e.user.username,realname:e.user.realname,city:null,state:null,country:null,title:null,organization:null,avatarOption:null,gravatarHash:null,gravatarDefault:null}}bt.module="UserProfile",bt.profileCache=new Map;var yt=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.userProfileClient=void 0,this.cache=void 0,this.params=t,this.userProfileClient=new bt({url:this.params.userProfileServiceURL,token:this.params.token}),this.cache=new Map}return Object(D.a)(e,[{key:"getUser",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=2;break}return e.abrupt("return",this.cache.get(t));case 2:return e.next=4,this.userProfileClient.getUserProfile(t);case 4:return r=e.sent,n=Tt(r),this.cache.set(t,n),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,n=[],t.forEach(function(e){i.cache.has(e)?r.set(e,i.cache.get(e)):n.push(e)}),e.next=5,this.userProfileClient.getUserProfiles(n);case 5:return a=e.sent,a.map(function(e){return Tt(e)}),a.forEach(function(e){var t=Tt(e);i.cache.set(t.username,t),r.set(t.username,t)}),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"searchUsers",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userProfileClient.searchUsers(t.query);case 2:return r=e.sent,e.abrupt("return",r.filter(function(e){var r=e.username;return-1===t.excludedUsers.indexOf(r)}).map(function(e){return{username:e.username,realname:e.realname}}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),Mt=function(e){function t(e){var r;if(Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).token=void 0,!e.token)throw new Error("Authorized client requires token");return r.token=e.token,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"callFunc",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{Authorization:this.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))});case 2:return n=e.sent,e.abrupt("return",this.processResponse(n));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),t}(function(){function e(t){var r=t.url,n=t.token,a=t.module;Object(C.a)(this,e),this.url=void 0,this.token=void 0,this.module=void 0,this.url=r,this.token=n||null,this.module=a}return Object(D.a)(e,[{key:"makePayload",value:function(e,t){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:t}}},{key:"makeEmptyPayload",value:function(e){return{version:"1.1",method:this.module+"."+e,id:String(Math.random()).slice(2),params:[]}}},{key:"processResponse",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,s,o;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=13;break}return e.next=3,t.json();case 3:if(r=e.sent,n=r.result,a=r.error,!n){e.next=10;break}return e.abrupt("return",[n,null]);case 10:return e.abrupt("return",[null,a]);case 11:e.next=15;break;case 13:if(204!==t.status){e.next=15;break}return e.abrupt("return",[null,null]);case 15:if(500!==t.status){e.next=28;break}if("application/json"!==t.headers.get("Content-Type")){e.next=24;break}return e.next=19,t.json();case 19:return i=e.sent,s=i.error,e.abrupt("return",[null,s]);case 24:return e.next=26,t.text();case 26:return o=e.sent,e.abrupt("return",[null,{code:0,name:"Internal Server Error (for real)",message:"The service experienced an internal error",error:o}]);case 28:throw new Error("Unexpected response: "+t.status+", "+t.statusText);case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callFunc",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n=this;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(this.url,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(this.makePayload(t,r))}).then(function(e){return n.processResponse(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}()),Ct=r(75),Dt=r.n(Ct),Vt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"getServiceStatus",value:function(e){return this.callFunc("get_service_status",e).then(function(e){if(e.result&&e.result.length>0){var t=e.result[0];if(!t)throw new Error("Crazy at it seems, no result");return t}throw new Error("Crazy at it seems, no result")})}}]),t}(It);Vt.module="ServiceWizard";var kt=new(function(){function e(t){var r=t.itemLifetime,n=t.monitoringFrequency,a=t.waiterTimeout,i=t.waiterFrequency;Object(C.a)(this,e),this.cache=void 0,this.cacheLifetime=void 0,this.monitoringFrequency=void 0,this.waiterTimeout=void 0,this.waiterFrequency=void 0,this.isMonitoring=void 0,this.cache=new Map,this.cacheLifetime=r||18e5,this.monitoringFrequency=n||6e4,this.waiterTimeout=a||3e4,this.waiterFrequency=i||100,this.isMonitoring=!1}return Object(D.a)(e,[{key:"runMonitor",value:function(){var e=this;this.isMonitoring||(this.isMonitoring=!0,window.setTimeout(function(){var t=new Map,r=!1;Object.keys(e.cache).forEach(function(n){var a=e.cache.get(n);e.isExpired(a)||(t.set(n,a),r=!0)}),e.cache=t,e.isMonitoring=!1,r&&e.runMonitor()},this.monitoringFrequency))}},{key:"isExpired",value:function(e){return(new Date).getTime()-e.createdAt>this.cacheLifetime}},{key:"isReserved",value:function(e){return e.reserved}},{key:"getItem",value:function(e){if(void 0===this.cache.get(e))return null;var t=this.cache.get(e);if(!this.isExpired(t))return t;this.cache.delete(e)}},{key:"reserveWaiter",value:function(e){var t=this;return new Dt.a(function(r,n){var a=(new Date).getTime();!function i(){window.setTimeout(function(){if(t.cache.has(e.id))return t.reserveAndFetch({id:e.id,fetcher:e.fetcher}).then(function(){r(t.cache.get(e.id))}).catch(function(e){n(e)});if(e.reserved){var s=(new Date).getTime()-a;s>t.waiterTimeout?(t.cache.delete(e.id),n(new Error("Timed-out waiting for cache item to become available; timeout "+t.waiterTimeout+", waited "+s))):i()}else r(e)},t.waiterFrequency)}()})}},{key:"reserveAndFetch",value:function(e){var t=this,r=e.id,n=e.fetcher;this.reserveItem(r,n);var a=n().then(function(e){return t.setItem(r,e,n),e}).finally(function(){a.isCancelled()&&t.cache.get(r)});return a}},{key:"getItemWithWait",value:function(e){var t=e.id,r=e.fetcher,n=this.cache.get(t);if(n){if(!this.isExpired(n))return this.isReserved(n)?this.reserveWaiter(n).then(function(e){return e.value}):Dt.a.resolve(n.value);this.cache.delete(t)}return this.reserveAndFetch({id:t,fetcher:r})}},{key:"reserveItem",value:function(e,t){this.cache.set(e,{id:e,createdAt:(new Date).getTime(),reserved:!0,value:null,fetcher:t})}},{key:"setItem",value:function(e,t,r){if(this.cache.has(e)){var n=this.cache.get(e);n&&n.reserved?(n.reserved=!1,n.value=t,n.fetcher=r):this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t})}else this.cache.set(e,{id:e,createdAt:(new Date).getTime(),fetcher:r,reserved:!1,value:t});this.runMonitor()}}]),e}())({itemLifetime:18e5,monitoringFrequency:6e4,waiterTimeout:3e4,waiterFrequency:100}),Ut=function(){function e(t){var r=t.token,n=t.url,a=t.version,i=t.timeout,s=t.rpcContext;if(Object(C.a)(this,e),this.token=void 0,this.timeout=void 0,this.rpcContext=void 0,this.url=void 0,this.version=void 0,this.token=r,this.timeout=i||1e4,this.rpcContext=s||null,!n)throw new Error("The service discovery url was not provided");this.url=n,this.version=a||null,"auto"===a&&(this.version=null)}return Object(D.a)(e,[{key:"options",value:function(){return{timeout:this.timeout,authorization:this.token,rpcContext:this.rpcContext}}},{key:"getModule",value:function(){return this.constructor.module}},{key:"moduleId",value:function(){var e;return e=this.version?this.getModule()+":"+this.version:this.getModule()+":auto",e}},{key:"getCached",value:function(e){return kt.getItemWithWait({id:this.moduleId(),fetcher:e})}},{key:"lookupModule",value:function(){var e=this;return this.getCached(function(){e.getModule(),e.version;var t=new Vt({url:e.url,token:e.token});return Dt.a.resolve(t.getServiceStatus({module_name:e.getModule(),version:e.version}))})}},{key:"callFunc",value:function(e,t){var r=this;return this.lookupModule().then(function(n){var a=new Mt({module:n.module_name,url:n.url,token:r.token});return Dt.a.resolve(a.callFunc(e,t))}).catch(function(e){throw console.error("ERROR: "+e.name+" = "+e.message,e),e})}}]),e}();Ut.module=void 0;var zt,Gt,jt,Lt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"listNarratives",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callFunc("list_narratives",[{type:t}]);case 2:if(r=e.sent,n=Object(se.a)(r,2),a=n[0],n[1],!a||!a[0]){e.next=10;break}return e.abrupt("return",a[0]);case 10:throw new Error("Result is missing!");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(Ut);function Pt(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)([\+\-])(\d\d)(:?[\:]*)(\d\d)/.exec(e);if(!t)throw new TypeError("Invalid Date Format for "+e);var r=t[7]+t[8]+":"+t[10],n=t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+r;return new Date(n)}function Bt(e){return{id:e[0],name:e[1],owner:e[2],modifiedAt:Pt(e[3]),objectCount:e[4],userPermission:e[5],globalReadPermission:"r"===e[6],lockStatus:e[7],metadata:e[8]}}function xt(e){var t=e[2].split(/[-.]/);return{id:e[0],name:e[1],type:{id:e[2],module:t[0],name:t[1],majorVersion:parseInt(t[2],10),minorVersion:parseInt(t[3],10)},savedAt:Pt(e[3]),version:e[4],savedBy:e[5],workspaceId:e[6],workspaceName:e[7],checksum:e[8],size:e[9],metadata:e[10],ref:e[6]+"/"+e[0]+"/"+e[4]}}Lt.module="NarrativeService",function(e){e[e.NONE=0]="NONE",e[e.ASSOCIATED=1]="ASSOCIATED",e[e.REQUESTED=2]="REQUESTED"}(zt||(zt={})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.ADMIN=3]="ADMIN",e[e.OWNER=4]="OWNER"}(Gt||(Gt={})),function(e){e.TITLE="TITLE",e.LAST_SAVED="LAST_SAVED"}(jt||(jt={}));var Wt=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.params=t}return Object(D.a)(e,[{key:"getOwnNarratives",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,s,o,c,l,u;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Lt({url:this.params.serviceWizardURL,token:this.params.token,timeout:1e4}),n=new Ue({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),a=new we({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=5,Promise.all([r.listNarratives("mine"),n.getOrg(t),a.getPendingRequestsForOrg(t)]);case 5:if(i=e.sent,s=Object(se.a)(i,3),o=s[0],c=s[1],l=s[2],c.kind!==Re.INACCESSIBLE_PRIVATE){e.next=12;break}throw new Error("Cannot get own narratives for private inaccessible organization");case 12:return u=c.narratives.map(function(e){return e.workspaceId}),e.abrupt("return",o.narratives.map(function(e){return{workspaceInfo:Bt(e.ws),objectInfo:xt(e.nar)}}).filter(function(e){return"false"===e.workspaceInfo.metadata.is_temporary}).map(function(e){return{status:-1!==u.indexOf(e.workspaceInfo.id)?zt.ASSOCIATED:l.find(function(t){return t.resourceType===ce.WORKSPACE&&t.narrativeId===String(e.workspaceInfo.id)})?zt.REQUESTED:zt.NONE,narrative:{access:Gt.OWNER,isPublic:e.workspaceInfo.globalReadPermission,workspaceId:e.workspaceInfo.id,objectId:e.objectInfo.id,title:e.workspaceInfo.metadata.narrative_nice_name,owner:e.workspaceInfo.owner,lastSavedAt:e.objectInfo.savedAt,lastSavedBy:e.objectInfo.savedBy}}}).sort(function(e,t){return e.narrative.title.localeCompare(t.narrative.title)}));case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getSorter",value:function(e){switch(e){case jt.TITLE:return function(e,t){return e.narrative.title.localeCompare(t.narrative.title)};case jt.LAST_SAVED:return function(e,t){return t.narrative.lastSavedAt.getTime()-e.narrative.lastSavedAt.getTime()};default:throw new Error("invalid sort spec")}}},{key:"sortOrganizationNarratives",value:function(e,t){var r=this.getSorter(t);return e.sort(r).slice(0)}},{key:"getNarrative",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,s,o,c,l,u,E,d,v;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Mt({module:"Workspace",url:this.params.workspaceServiceURL,token:this.params.token}),e.prev=1,e.next=4,r.callFunc("get_workspace_info",[{id:t}]);case 4:if(n=e.sent,a=Object(se.a)(n,2),i=a[0],!a[1]){e.next=10;break}return e.abrupt("return",{workspaceId:t,access:Gt.NONE});case 10:if(s=Bt(i[0]),o=s.metadata.narrative){e.next=14;break}return e.abrupt("return",{workspaceId:t,access:Gt.NONE});case 14:return c=parseInt(o,10),e.next=17,r.callFunc("get_object_info3",[{objects:[{wsid:t,objid:c}],includeMetadata:1,ignoreErrors:0}]);case 17:if(l=e.sent,u=Object(se.a)(l,2),E=u[0],!u[1]){e.next=23;break}return e.abrupt("return",{workspaceId:t,access:Gt.NONE});case 23:d=xt(E[0].infos[0]),e.t0=s.userPermission,e.next="n"===e.t0?27:"r"===e.t0?33:"w"===e.t0?35:"a"===e.t0?37:39;break;case 27:if(!s.globalReadPermission){e.next=32;break}return v=Gt.VIEW,e.abrupt("break",40);case 32:throw new Error("Cannot have no access and no global read permission!");case 33:return v=Gt.VIEW,e.abrupt("break",40);case 35:return v=Gt.EDIT,e.abrupt("break",40);case 37:return v=s.owner===this.params.username?Gt.OWNER:Gt.ADMIN,e.abrupt("break",40);case 39:throw new Error("Unknown workspace permission: "+s.userPermission);case 40:return e.abrupt("return",{workspaceId:s.id,access:v,isPublic:s.globalReadPermission,objectId:d.id,title:s.metadata.narrative_nice_name||"Unknown",owner:s.owner,lastSavedAt:d.savedAt,lastSavedBy:d.savedBy});case 43:throw e.prev=43,e.t1=e.catch(1),console.error("Error fetching narrative!",e.t1),e.t1;case 47:case"end":return e.stop()}},e,this,[[1,43]])}));return function(t){return e.apply(this,arguments)}}()}]),e}();function qt(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.ENTITY_USER_LOADER_START}),a=n(),i=a.auth.authorization,s=i.token,i.username,o=a.app.config,c=new yt({token:s,userProfileServiceURL:o.services.UserProfile.url}),t.prev=3,t.next=6,c.getUser(e);case 6:l=t.sent,r((E=l,{type:F.ENTITY_USER_LOADER_SUCCESS,user:E})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r((u={code:"error",message:t.t0.message},{type:F.ENTITY_USER_LOADER_ERROR,error:u}));case 13:case"end":return t.stop()}var u,E},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}function Ht(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.ENTITY_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Wt({token:s,username:o,workspaceServiceURL:c.services.Workspace.url,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url}),t.prev=3,t.next=6,l.getNarrative(e);case 6:u=t.sent,r({type:F.ENTITY_NARRATIVE_LOAD_SUCCESS,narrative:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:F.ENTITY_NARRATIVE_LOAD_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}var Ft=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(At,{user:this.props.user,avatarSize:this.props.avatarSize,showAvatar:this.props.showAvatar}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.username)}}]),t}(b.Component);var Qt=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.username)}},function(e){return{onLoad:function(t){e(qt(t))}}})(Ft);r(229);function Zt(e,t){var r,n,a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=new Date,o=Math.round((s.getTime()-e.getTime())/1e3),c=Math.abs(o);if(c<86400*(t||90)){if(0===c)return"now";c<60?(r=o,n=c,a="second"):c<3600?(r=Math.round(o/60),n=Math.round(c/60),a="minute"):c<86400?(r=Math.round(o/3600),n=Math.round(c/3600),a="hour"):(r=Math.round(o/86400),n=Math.round(c/86400),a="day"),n>1&&(a+="s");var l=null,u=null;return r<0?l="in":r>0&&(u="ago"),(l?l+" ":"")+n+" "+a+(u?" "+u:"")}return i&&s.getFullYear()===e.getFullYear()?Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e):Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}var Jt=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){if(!1===this.props.showTooltip)return b.createElement("span",null,Zt(this.props.time,30));var e,t=b.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(this.props.time));return e=this.props.tooltipPrefix?b.createElement("span",null,this.props.tooltipPrefix,t):t,b.createElement(Ot.a,{placement:"bottomRight",title:e},Zt(this.props.time,30))}}]),t}(b.Component);function Yt(e){switch(e){case n.COMPACT:return n.NORMAL;case n.NORMAL:return n.COMPACT}}var Kt=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:n.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:Yt(this.state.view)})}},{key:"renderLogo",value:function(e){return b.createElement(mt,{logoUrl:e.logoUrl,size:80,organizationName:e.name,organizationId:e.id})}},{key:"renderHomeUrl",value:function(e){if(!e.homeUrl)return b.createElement(Ot.a,{placement:"bottomRight",title:"This organization has not set a home page url"},b.createElement(pt.a,{type:"home",style:{color:"rgba(200, 200, 200, 0.3)"}}));var t=b.createElement(b.Fragment,null,b.createElement("p",null,"Home page for this Organization (external to KBase)"));return b.createElement("div",{className:"BriefOrganization-homeUrl"},b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:t},b.createElement("a",{href:e.homeUrl,target:"_blank"},b.createElement(pt.a,{type:"home"}))))}},{key:"renderNarrativeCount",value:function(e){return e.narrativeCount?b.createElement("span",null,e.narrativeCount):b.createElement("span",{style:{color:"gray"}},"\xd8")}},{key:"renderMemberCount",value:function(e){return 1==e.memberCount?b.createElement("span",{style:{color:"gray"}},"\xd8"):b.createElement("span",null,e.memberCount-1)}},{key:"renderRelation",value:function(e){switch(e.relation){case me.NONE:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},b.createElement("span",null,b.createElement(pt.a,{type:"stop"})));case me.VIEW:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},b.createElement(pt.a,{type:"stop"}));case me.MEMBER_REQUEST_PENDING:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"Your membership request is pending"},b.createElement(pt.a,{type:"user",style:{color:"orange"}})," Your membership ",b.createElement("b",null,"request")," is pending");case me.MEMBER_INVITATION_PENDING:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You have been invited to join this organization"},b.createElement(pt.a,{type:"user",style:{color:"blue"}}));case me.MEMBER:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are a member of this organization"},b.createElement(pt.a,{type:"user"}));case me.ADMIN:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are an administrator of this organization"},b.createElement(pt.a,{type:"robot"}));case me.OWNER:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are the owner of this organization"},b.createElement(pt.a,{type:"crown"}))}}},{key:"renderPrivacy",value:function(){return this.props.organization.isPrivate?b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is private - may only be viewed by members"},b.createElement("span",null,b.createElement(pt.a,{type:"unlock"}))):b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"This organization is public - may be viewed by any KBase user"},b.createElement("span",null,b.createElement(pt.a,{type:"global"})))}},{key:"renderOrgFreshness",value:function(e){var t;if(e.lastVisitedAt&&e.modifiedAt.getTime()>e.lastVisitedAt.getTime()){t=b.createElement("div",null,b.createElement(Ot.a,{placement:"topRight",title:"This org has changed since your last visit to it; new or updated items are highlighted"},b.createElement("span",{style:{color:"red",fontSize:"120%"}},b.createElement(pt.a,{type:"bell",theme:"filled"}))))}else t=b.createElement("div",null,b.createElement("span",{style:{color:"transparent",fontSize:"120%"}},b.createElement(pt.a,{type:"bell",theme:"filled"})));var r;return r=null,b.createElement("div",null,t,r)}},{key:"renderRequests",value:function(){if(this.props.organization.relation===me.ADMIN||this.props.organization.relation===me.OWNER){var e,t;switch(this.props.openRequestsStatus){case he.NONE:e="There are no open requests for this organization",t="rgba(200, 200, 200, 0.3)";break;case he.NEW:e="There are new requests since you last visited this organization",t="red";break;case he.OLD:e="There are open requests for this organization",t="blue";break;case he.INAPPLICABLE:return;default:return void console.warn("Invalid open request status: "+this.props.openRequestsStatus)}var r=b.createElement("span",null,e);return b.createElement(Ot.a,{placement:"topRight",title:r},b.createElement("span",{style:{color:t,fontSize:"80%"}},b.createElement(pt.a,{type:"mail"})))}}},{key:"renderPermalink",value:function(){var e=b.createElement("div",null,b.createElement("p",null,'Below is the "permalink" for this organization. You may copy this url and use it to access this organization in a web browser.'),b.createElement("p",{style:{fontFamily:"monospace",fontWeight:"bold"}},window.location.origin,"/#org/",this.props.organization.id)),t=b.createElement(ht.a,{onClick:function(t){t.key;Rt.a.info({title:"Org Permalink",content:e})}},b.createElement(ht.a.Item,{key:"view"},"View Permalink"));return b.createElement(wt.a,{overlay:t,trigger:["click","contextMenu"]},b.createElement("a",{href:"/#orgs/"+this.props.organization.id},b.createElement(pt.a,{type:"link"})))}},{key:"renderLogoColumn",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"BriefOrganization-logoRow"},b.createElement(Et.a,{to:"/viewOrganization/".concat(e.id)},this.renderLogo(e))),b.createElement("div",{className:"BriefOrganization-statusRow"},b.createElement("div",{className:"BriefOrganization-relationCol"},this.renderRelation(e)),b.createElement("div",{className:"BriefOrganization-privacyCol"},this.renderPrivacy()),b.createElement("div",{className:"BriefOrganization-homeLinkCol"},this.renderHomeUrl(e))),b.createElement("div",{className:"BriefOrganization-freshnessRow"},b.createElement("div",{className:"BriefOrganization-orgFreshnessCol"},this.renderOrgFreshness(e)),b.createElement("div",{className:"BriefOrganization-openRequestsCol"},this.renderRequests()),b.createElement("div",{className:"BriefOrganization-openNewRequestsCol"},this.renderPermalink())))}},{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderInfoCol",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"BriefOrganization-researchInterests BriefOrganization-infoTableRow"},e.researchInterests),b.createElement("div",{className:"BriefOrganization-orgOwner BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"owner")),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},b.createElement(Qt,{username:e.owner.username,avatarSize:16,showAvatar:!1}))),b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label BriefOrganization-fieldLabel"},"created")),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:this.fullTimestamp(e.createdAt)},b.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt))))))}},{key:"renderMemberRow",value:function(e){var t,r=e.memberCount-1;return t=r?1===r?b.createElement("span",null,"There is ",b.createElement("b",null,"1")," member in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,r)," members in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,"no members")," in this organization"),b.createElement(Ot.a,{placement:"bottomRight",title:t},b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label"},b.createElement(pt.a,{type:"team"}))),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderMemberCount(e))))}},{key:"renderNarrativeRow",value:function(e){var t,r=e.narrativeCount;return t=r?1===r?b.createElement("span",null,"There is ",b.createElement("b",null,"1")," narrative in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,r)," narratives in this organization"):b.createElement("span",null,"There are ",b.createElement("b",null,"no narratives")," in this organization"),b.createElement(Ot.a,{placement:"bottomRight",title:t},b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label"},b.createElement(pt.a,{type:"file"}))),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},this.renderNarrativeCount(e))))}},{key:"renderModifiedRow",value:function(e){var t=b.createElement("span",null,"This organization was last updated"," ",b.createElement(Jt,{time:e.modifiedAt,showTooltip:!1}));return b.createElement(Ot.a,{placement:"bottomRight",title:t},b.createElement("div",{className:"BriefOrganization-orgCreated BriefOrganization-infoTableRow"},b.createElement("div",{className:"BriefOrganization-infoTableCol1"},b.createElement("span",{className:"field-label"},b.createElement(pt.a,{type:"save"}))),b.createElement("div",{className:"BriefOrganization-infoTableCol2"},b.createElement(Jt,{time:e.modifiedAt,showTooltip:!1}))))}},{key:"renderStatsCol",value:function(e){return b.createElement(b.Fragment,null,this.renderMemberRow(e),this.renderNarrativeRow(e),this.renderModifiedRow(e))}},{key:"renderNormal",value:function(){var e=this.props.organization;return b.createElement("div",{className:"BriefOrganization"},b.createElement("div",{className:"BriefOrganization-body"},b.createElement("div",{className:"BriefOrganization-logoCol"},this.renderLogoColumn(e)),b.createElement("div",{className:"BriefOrganization-infoCol"},b.createElement("div",{className:"BriefOrganization-infoCol-row"},b.createElement("div",{className:"BriefOrganization-infoCol-col1"},b.createElement("div",{className:"BriefOrganization-orgName BriefOrganization-infoTableRow"},b.createElement(Et.a,{to:"/viewOrganization/".concat(e.id)},e.name)))),b.createElement("div",{className:"BriefOrganization-infoCol-row"},b.createElement("div",{className:"BriefOrganization-infoCol-col1"},this.renderInfoCol(e)),b.createElement("div",{className:"BriefOrganization-infoCol-col2"},this.renderStatsCol(e))))))}},{key:"render",value:function(){return this.renderNormal()}}]),t}(b.Component),Xt=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={searchTerms:[]},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderAdminInfo",value:function(e){return b.createElement("div",null,"disabled")}},{key:"pluralize",value:function(e,t,r){return 0===e||e>1?r:t}},{key:"renderOrgs",value:function(){var e=this;return this.props.organizations.length>0?this.props.organizations.map(function(t,r){var n=e.props.openRequests.get(t.id)||null;return b.createElement("div",{key:String(r),className:"simpleCard"},b.createElement(Kt,{organization:t,openRequestsStatus:n}))}):b.createElement(ut.a,{type:"warning",style:{maxWidth:"20em",margin:"20px auto 0 auto"},message:"Sorry, no organizations were found."})}},{key:"render",value:function(){return b.createElement("div",{className:"Organizations"},b.createElement("div",{style:{overflowY:"auto",display:"flex",flexDirection:"column"}},this.renderOrgs()))}}]),t}(b.Component);var $t=Object(P.b)(function(e){if(null===e.views.browseOrgsView.viewModel)throw new Error("view not ready");var t=e.views.browseOrgsView.viewModel;return{organizations:t.organizations,openRequests:t.openRequests}})(Xt),er=(r(242),r(54)),tr=r(344),rr=r(350),nr=r(352),ar=(r(244),function(e){function t(e,r){var n;return Object(C.a)(this,t),(n=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(D.a)(t,[{key:"buildSeparator",value:function(){if(this.props.breadcrumbs)return b.createElement(pt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}})}},{key:"onMenuSelection",value:function(e){}},{key:"render",value:function(){return b.createElement("div",{className:"Header"},b.createElement("div",{className:"Header-contextual"},b.createElement("div",{className:"Header-userColumn"},b.createElement("div",{className:"Header-breadcrumbs"},this.props.breadcrumbs),b.createElement("div",{className:"Header-buttons"},this.props.buttons))))}}]),t}(b.Component)),ir=r(239),sr=(r(246),function(e){function t(e,r){var n;return Object(C.a)(this,t),(n=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={currentMenuItem:"myorgs"},n}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onMenuSelection",value:function(e){}},{key:"renderMenu",value:function(){return b.createElement(ir.a,{render:function(e){e.history;var t=[];switch(e.location.pathname){case"/organizations":t=["allorgs"];break;case"/newOrganization":t=["neworg"]}return b.createElement(ht.a,{selectedKeys:t,style:{backgroundColor:"transparent"},mode:"horizontal"})}})}},{key:"render",value:function(){return b.createElement("div",{className:"MainMenu"},b.createElement("div",{className:"MainMenu-menu"},this.renderMenu()),b.createElement("div",{className:"MainMenu-buttons"},this.props.buttons))}}]),t}(b.Component)),or=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).searchInput=void 0,r.searchButton=void 0,r.filterByRoleValues=void 0,r.searchInput=b.createRef(),r.searchButton=b.createRef(),r.filterByRoleValues=[{label:"Member",value:"member"},{label:"Admin",value:"admin"},{label:"Owner",value:"owner"}],r.state={searchInput:"",showInfo:!1,filterByRoleType:"myorgs",filterByRole:[],filterByPrivacy:"any",showAdvancedControls:!1},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"componentDidMount",value:function(){this.props.onSearchOrgs([])}},{key:"onShowInfo",value:function(){Rt.a.info({title:"Organizations Browser Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the organizations browser..."))})}},{key:"doSearch",value:function(){if(null!==this.searchInput.current){var e=this.searchInput.current.value.split(/[\s+]/);this.props.onSearchOrgs(e)}}},{key:"haveSearchInput",value:function(){return!!(this.state.searchInput&&this.state.searchInput.length>0)}},{key:"onSearchInputChange",value:function(){var e;e=this.searchInput.current?this.searchInput.current.value:"",this.setState({searchInput:e})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.doSearch()}},{key:"onSortByChange",value:function(e){switch(e){case"owner":this.props.onSortOrgs("owner",p.ASCENDING);break;case"name":this.props.onSortOrgs("name",p.ASCENDING);break;case"recentlyAdded":this.props.onSortOrgs("created",p.DESCENDING);break;case"recentlyChanged":this.props.onSortOrgs("changed",p.DESCENDING);break;case"memberCount":this.props.onSortOrgs("memberCount",p.DESCENDING);break;case"narrativeCount":this.props.onSortOrgs("narrativeCount",p.DESCENDING)}}},{key:"onSortDirectionChange",value:function(e){this.props.onSortOrgs(this.props.sortBy,e.target.value)}},{key:"onFilterByRoleTypeChange",value:function(e){var t;this.setState({filterByRoleType:e.target.value}),"select"===e.target.value?(this.setState({filterByRole:[]}),t=Object(W.a)({},this.props.filter,{roleType:e.target.value})):(t=Object(W.a)({},this.props.filter,{roleType:e.target.value,roles:[]}),this.setState({filterByRole:[]})),this.props.onFilterOrgs(t)}},{key:"onFilterByRoleChange",value:function(e){var t;this.setState({filterByRole:e}),0===e.length?(this.setState({filterByRoleType:"myorgs"}),t=Object(W.a)({},this.props.filter,{roleType:"myorgs",roles:e})):(this.setState({filterByRoleType:"select"}),t=Object(W.a)({},this.props.filter,{roleType:"select",roles:e})),this.props.onFilterOrgs(t)}},{key:"onFilterByPrivacyChange",value:function(e){this.setState({filterByPrivacy:e.target.value});var t=Object(W.a)({},this.props.filter,{privacy:e.target.value});this.props.onFilterOrgs(t)}},{key:"onClearSearch",value:function(){null!==this.searchInput.current&&(this.searchInput.current.value="",this.onSearchInputChange(),this.doSearch())}},{key:"renderSearchFeedback",value:function(){return 0===this.props.totalCount?b.createElement("span",null,"None available"):0===this.props.filteredCount?b.createElement("span",null,"\xd8 /",this.props.totalCount," ","orgs"):this.props.totalCount===this.props.filteredCount?b.createElement("span",null,b.createElement("b",null,this.props.totalCount)," ","orgs"):b.createElement("span",null,b.createElement("b",null,this.props.filteredCount),"/",this.props.totalCount," ","orgs")}},{key:"renderSearchIcon",value:function(){return this.props.searching?b.createElement(pt.a,{type:"loading"}):b.createElement(pt.a,{type:"search"})}},{key:"renderSearchForm",value:function(){return b.createElement("form",{id:"searchForm",className:"OrganizationsBrowser-searchBar",onSubmit:this.onSubmit.bind(this)},b.createElement("input",{className:"OrganizationsBrowser-searchInput",placeholder:"Search Organizations",onChange:this.onSearchInputChange.bind(this),autoFocus:!0,ref:this.searchInput}),b.createElement(er.a,{disabled:!this.haveSearchInput(),ref:this.searchButton,form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()),b.createElement(er.a,{onClick:this.onClearSearch.bind(this),disabled:!this.haveSearchInput(),icon:"close"}))}},{key:"renderSearchBar",value:function(){return b.createElement("div",{className:"OrganizationsBrowser-searchBarRow"},b.createElement("div",{className:"OrganizationsBrowser-searchBarCol1"},this.renderSearchForm()),b.createElement("div",{className:"OrganizationsBrowser-searchBarCol2"},this.renderSearchFeedback()))}},{key:"renderHeader",value:function(){var e=b.createElement(b.Fragment,null),t=b.createElement(b.Fragment,null,b.createElement(er.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return b.createElement(ar,{breadcrumbs:e,buttons:t})}},{key:"renderSortByControl",value:function(){return b.createElement(tr.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,dropdownMatchSelectWidth:!0,style:{width:"10em"}},b.createElement(tr.a.Option,{value:"recentlyChanged",key:"changed"},"Date Changed"),b.createElement(tr.a.Option,{value:"recentlyAdded",key:"recent"},"Date Established"),b.createElement(tr.a.Option,{value:"name",key:"name"},"Org Name"),b.createElement(tr.a.Option,{value:"memberCount",key:"memberCount"},"# members"),b.createElement(tr.a.Option,{value:"narrativeCount",key:"narrativeCount"},"# narratives"))}},{key:"onToggleAdvanced",value:function(){if(this.state.showAdvancedControls){this.setState({showAdvancedControls:!1});var e=this.props.filter,t=e.roleType,r=e.roles;e.privacy;["myorgs","all"].includes(t)||(t="myorgs",this.setState({filterByRoleType:"myorgs"})),this.setState({filterByRole:[],filterByPrivacy:"any"}),r=[],"any",this.props.onFilterOrgs({roleType:t,roles:r,privacy:"any"})}else this.setState({showAdvancedControls:!0})}},{key:"renderAdvancedToggle",value:function(){return this.state.showAdvancedControls?b.createElement(pt.a,{type:"ellipsis",className:"IconButton-hover-pressed",onClick:this.onToggleAdvanced.bind(this)}):b.createElement(pt.a,{type:"ellipsis",className:"IconButton-hover",onClick:this.onToggleAdvanced.bind(this)})}},{key:"renderFilterByRole",value:function(){var e={display:"block",height:"30px",lineHeight:"30px"};return this.state.showAdvancedControls?b.createElement(b.Fragment,null,b.createElement(rr.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},b.createElement(rr.a,{value:"myorgs",style:e},"My Orgs"),b.createElement(rr.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle(),b.createElement(rr.a,{value:"notmyorgs",style:e},"Not My Orgs"),b.createElement(rr.a,{value:"select",style:e},"Specific Role")),b.createElement(nr.a.Group,{options:this.filterByRoleValues,value:this.state.filterByRole,className:"OrganizationsBrowser-checkboxGroup",onChange:this.onFilterByRoleChange.bind(this)})):b.createElement(b.Fragment,null,b.createElement(rr.a.Group,{onChange:this.onFilterByRoleTypeChange.bind(this),value:this.state.filterByRoleType},b.createElement(rr.a,{value:"myorgs",style:e},"My Orgs"),b.createElement(rr.a,{value:"all",style:e},"All Orgs"),this.renderAdvancedToggle()))}},{key:"renderFilterByPrivacy",value:function(){if(this.state.showAdvancedControls){var e={display:"block",height:"30px",lineHeight:"30px",margin:"0px"};return b.createElement(b.Fragment,null,b.createElement(rr.a.Group,{onChange:this.onFilterByPrivacyChange.bind(this),value:this.state.filterByPrivacy},b.createElement(rr.a,{value:"any",style:e},"Any"),b.createElement(rr.a,{value:"public",style:e},"Public"),b.createElement(rr.a,{value:"private",style:e},"Private")))}}},{key:"renderOrganizations",value:function(){return this.props.error?b.createElement(ut.a,{type:"error",message:this.props.error.code,description:this.props.error.message}):b.createElement($t,null)}},{key:"renderFilterColumn",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:"field-label"},"sort by"),this.renderSortByControl(),b.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"filter"),this.renderFilterByRole(),this.state.showAdvancedControls?b.createElement("div",{className:"field-label",style:{marginTop:"10px"}},"by privacy"):null,this.renderFilterByPrivacy())}},{key:"renderMenuButtons",value:function(){return b.createElement(b.Fragment,null,b.createElement(Et.a,{to:"/newOrganization"},b.createElement(er.a,{icon:"plus-circle",style:{marginRight:"10px"}},"Create Organization"))," ")}},{key:"render",value:function(){return b.createElement("div",{className:"OrganizationsBrowser scrollable-flex-column"},b.createElement(sr,{buttons:this.renderMenuButtons()}),this.renderSearchBar(),b.createElement("div",{className:"OrganizationsBrowser-bodyRow"},b.createElement("div",{className:"OrganizationsBrowser-bodyCol scrollable-flex-column"},this.renderOrganizations()),b.createElement("div",{className:"OrganizationsBrowser-filterCol"},this.renderFilterColumn())))}}]),t}(b.Component);function cr(e,t){return{type:F.BROWSE_ORGS_SORT_START,sortField:e,sortDirection:t}}function lr(e,t,r){return{type:F.BROWSE_ORGS_SEARCH_SUCCESS,organizations:e,totalCount:t,openRequests:r}}function ur(e){return{type:F.BROWSE_ORGS_SEARCH_ERROR,error:e}}function Er(e){return{type:F.BROWSE_ORGS_FILTER_START,filter:e}}var dr=Object(P.b)(function(e){if(!e.views.browseOrgsView.viewModel)throw new Error("No view model!");var t=e.views.browseOrgsView.viewModel,r=t.organizations,n=t.openRequests,a=t.error;return{organizations:r,openRequests:n,totalCount:t.totalCount,filteredCount:t.filteredCount,filter:t.filter,error:a,searching:t.searching}},function(e){return{onSearchOrgs:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,O,p,R,h,w;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.BROWSE_ORGS_SEARCH_START}),a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,null!==i.viewModel){t.next=5;break}return r(ur({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 5:return u=i.viewModel,E=u.sortField,d=u.sortDirection,v=u.filter,m=new Ue({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,m.queryOrgs({searchTerms:e,sortField:E,sortDirection:d,filter:v,username:c});case 10:if(O=t.sent,p=O.organizations,R=O.total,!((h=p.filter(function(e){return e.relation===me.ADMIN||e.relation===me.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,m.getOpenRequestsStatus({organizationIds:h});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(lr(p,R,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(ur({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,this,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onSortOrgs:function(t,r){e(function(e,t){return function(){var r=Object(ie.a)(ae.a.mark(function r(n,a){var i,s,o,c,l,u,E,d,v,m,O,p,R,h,w;return ae.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n(cr(e,t)),i=a(),s=i.views.browseOrgsView,o=i.auth.authorization,c=o.token,l=o.username,u=i.app.config,E=new Ue({token:c,username:l,groupsServiceURL:u.services.Groups.url}),null!==s.viewModel){r.next=6;break}return n(ur({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),r.abrupt("return");case 6:return d=s.viewModel,v=d.searchTerms,m=d.filter,r.prev=7,r.next=10,E.queryOrgs({searchTerms:v,filter:m,username:l,sortField:e,sortDirection:t});case 10:if(O=r.sent,p=O.organizations,R=O.total,!((h=p.filter(function(e){return e.relation===me.ADMIN||e.relation===me.OWNER}).map(function(e){return e.id})).length>0)){r.next=20;break}return r.next=17,E.getOpenRequestsStatus({organizationIds:h});case 17:w=r.sent,r.next=21;break;case 20:w=new Map;case 21:n(lr(p,R,w)),r.next=28;break;case 24:r.prev=24,r.t0=r.catch(7),console.error("Error querying orgs",r.t0.name,r.t0.message),n(ur({code:r.t0.name,message:r.t0.message}));case 28:case"end":return r.stop()}},r,this,[[7,24]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onFilterOrgs:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,O,p,R,h,w;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Er(e)),a=n(),i=a.views.browseOrgsView,s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new Ue({token:o,username:c,groupsServiceURL:l.services.Groups.url}),null!==i.viewModel){t.next=6;break}return r(ur({code:"invalid-state",message:"Search orgs may not be called without a defined view"})),t.abrupt("return");case 6:return E=i.viewModel,d=E.searchTerms,v=E.sortField,m=E.sortDirection,t.prev=7,t.next=10,u.queryOrgs({searchTerms:d,filter:e,username:c,sortField:v,sortDirection:m});case 10:if(O=t.sent,p=O.organizations,R=O.total,!((h=p.filter(function(e){return e.relation===me.ADMIN||e.relation===me.OWNER}).map(function(e){return e.id})).length>0)){t.next=20;break}return t.next=17,u.getOpenRequestsStatus({organizationIds:h});case 17:w=t.sent,t.next=21;break;case 20:w=new Map;case 21:r(lr(p,R,w)),t.next=28;break;case 24:t.prev=24,t.t0=t.catch(7),console.error("Error querying orgs",t.t0.name,t.t0.message),r(ur({code:t.t0.name,message:t.t0.message}));case 28:case"end":return t.stop()}},t,this,[[7,24]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(or),vr=r(341),mr=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading Organizations..."," ",b.createElement(vr.a,null));return b.createElement(ut.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return b.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return b.createElement(dr,{sortBy:"recentlyChanged"})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var Or=Object(P.b)(function(e,t){return{view:e.views.browseOrgsView}},function(e){return{onLoad:function(){e(function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,s,o,c,l,u,E,d,v,m,O,R,h,w;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:F.BROWSE_ORGS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=new Ue({token:i,username:s,groupsServiceURL:o.services.Groups.url}),l=[],u="changed",E=p.DESCENDING,d={roleType:"myorgs",roles:[],privacy:"any"},e.prev=7,e.next=10,c.queryOrgs({searchTerms:l,sortField:u,sortDirection:E,filter:d,username:s});case 10:if(v=e.sent,m=v.organizations,O=v.total,!((R=m.filter(function(e){return e.relation===me.ADMIN||e.relation===me.OWNER}).map(function(e){return e.id})).length>0)){e.next=20;break}return e.next=17,c.getOpenRequestsStatus({organizationIds:R});case 17:h=e.sent,e.next=21;break;case 20:h=new Map;case 21:w={rawOrganizations:m,organizations:m,openRequests:h,totalCount:O,filteredCount:m.length,sortField:u,sortDirection:E,filter:d,searchTerms:l,selectedOrganizationId:null,searching:!1,error:null},t((_=w,{type:F.BROWSE_ORGS_LOAD_SUCCESS,defaultViewModel:_})),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),console.error("Error querying orgs",e.t0.name,e.t0.message),t(ur({code:e.t0.name,message:e.t0.message}));case 29:case"end":return e.stop()}var _},e,this,[[7,25]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:F.BROWSE_ORGS_UNLOAD})}}})(mr);function pr(e){return{type:F.ADD_ORG_SAVE_ERROR,error:e}}function Rr(){return{type:F.ADD_ORG_EVALUATE_ERRORS}}function hr(e){return{type:F.ADD_ORG_UPDATE_ID_SUCCESS,id:e}}function wr(e,t){return{type:F.ADD_ORG_UPDATE_ID_ERROR,id:e,error:t}}function _r(){return function(e,t){e({type:F.ADD_ORG_LOAD_START});var r,n={id:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgId("")[1]},name:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgName("")[1]},logoUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgLogoUrl("")[1]},homeUrl:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgHomeUrl("")[1]},researchInterests:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgResearchInterests("")[1]},description:{value:"",remoteValue:null,syncState:i.CLEAN,validationState:_e.validateOrgDescription("")[1]},isPrivate:{value:!1,remoteValue:null,syncState:i.CLEAN,validationState:{type:o.OK,validatedAt:new Date}}};e((r=n,{type:F.ADD_ORG_LOAD_SUCCESS,newOrganization:r})),e(Sr())}}function gr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){e({type:F.ADD_ORG_SAVE_START});var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.addOrgView.viewModel.newOrganization,o=r.app.config,c=new Ue({token:a,username:i,groupsServiceURL:o.services.Groups.url});s?c.addOrg(s,i).then(function(t){e(function(e){return{type:F.ADD_ORG_SAVE_SUCCESS,organization:e}}(t))}).catch(function(t){console.error("error adding",s,t),e(pr({code:t.code||t.name,message:t.message,exception:t}))}):e(pr({code:"app",message:"The new organization data does not yet exist"}))}else e(pr({code:"invalid",message:"Unexpected condition: no view model"}))}}function Sr(){return function(e,t){var r=t();if(r.views.addOrgView.viewModel){var n=r.views.addOrgView.viewModel,a=(n.editState,n.newOrganization);a&&a.name.validationState.type===o.OK&&a.id.validationState.type===o.OK&&a.logoUrl.validationState.type===o.OK&&a.homeUrl.validationState.type===o.OK&&a.researchInterests.validationState.type===o.OK&&a.description.validationState.type===o.OK?e({type:F.ADD_ORG_EVALUATE_OK}):e(Rr())}else e(pr({code:"invalid",message:"Unexpected condition: no view model"}))}}function fr(e){var t=e.auth.authorization,r=t.token,n=t.username,a=e.app.config;return new Ue({token:r,username:n,groupsServiceURL:a.services.Groups.url})}function Ar(e){return function(t){var r=_e.validateOrgName(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:F.ADD_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:F.ADD_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(Sr())}}function Nr(e){return function(t){var r,n=_e.validateOrgLogoUrl(e),a=Object(se.a)(n,2),i=a[0],s=a[1];s.type!==o.OK?t(function(e,t){return{type:F.ADD_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(i,s)):t((r=i,{type:F.ADD_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:r})),t(Sr())}}var Ir=function(){function e(t,r){Object(C.a)(this,e),this.delay=void 0,this.fun=void 0,this.canceled=void 0,this.timer=void 0,this.delay=t,this.fun=r,this.canceled=!1,this.timer=null,this.startWaiting()}return Object(D.a)(e,[{key:"startWaiting",value:function(){var e=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){e.fun()},this.delay)}},{key:"cancel",value:function(){this.canceled=!0}}]),e}(),br=null;function Tr(e){return function(t,r){t(function(e){return{type:F.ADD_ORG_UPDATE_ID_PASS,id:e}}(e));var n=_e.validateOrgId(e),a=Object(se.a)(n,2),i=a[0],s=a[1];if(s.type!==o.OK)return t(wr(i,s)),void t(Sr());var c=r().views.addOrgView.viewModel;if(c){var l=c.newOrganization.id.validationState.validatedAt,u=(new Date).getTime();if(l)if(u-l.getTime()<500)return void(br||(br=new Ir(500,function(){t(function(e,t){var r=t(),n=r.views.addOrgView.viewModel;if(n){var a=n.newOrganization.id,i=_e.validateOrgId(a.value),s=Object(se.a)(i,2),c=s[0],l=s[1];if(l.type!==o.OK)return e(wr(c,l)),void e(Sr());var u=fr(t());u.orgExists(c).then(function(t){e(t?wr(c,{type:o.ERROR,message:"This org id is already in use",validatedAt:new Date}):hr(c)),e(Sr())})}})})));br&&br.cancel(),br=null,fr(r()).orgExists(i).then(function(e){t(e?wr(i,{type:o.ERROR,validatedAt:new Date,message:"This org id is already in use"}):hr(i)),t(Sr())})}}}function yr(e){return function(t,r){fr(r());var n=_e.validateOrgDescription(e),a=Object(se.a)(n,2),i=a[0],s=a[1];s.type!==o.OK?t(function(e,t){return{type:F.ADD_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(i,s)):t(function(e){return{type:F.ADD_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(i)),t(Sr())}}var Mr=r(342),Cr=r(39),Dr=r(348),Vr=(r(261),r(64)),kr=r.n(Vr),Ur=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,showError:!0},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onShowInfo",value:function(){Rt.a.info({title:"New Organization Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"As a KBase user, you may create your own organizations."),b.createElement("p",null,"Once you have created an Organization, you will be the sole owner of it, forever."),b.createElement("p",null,"In order to create an Org, you need to complete the following fields."),b.createElement("dl",null,b.createElement("dt",null,"name"),b.createElement("dd",null,"The organization ",b.createElement("i",null,"name")," is whatever you wish to have your Org known as. It may be composed of any text (including unicode characters) up to 200 characters in length. You may also change it at any time."),b.createElement("dt",null,"logo"),b.createElement("dd",null,b.createElement("p",null,"Logo support has undergone a redesign, but has not yet been implemented. The new design supports direct image upload, and removes gravatar support."),b.createElement("p",null,"For now, gravatar is the only support for org logo"),b.createElement("p",null,'In order to display a custom logo for your organization, you need to associate your Organization with an avatar hosted with the Gravatar service. To do so, simply enter the email address associated with your gravatar and press the update button. This will calculate a new "gravatar hash" and associate it with your organization.')),b.createElement("dt",null,"id"),b.createElement("dd",null,b.createElement("p",null,"Your Org ",b.createElement("i",null,"id")," forms a url endpoint for your org as well as the identifier used throughout KBase to, well, identify your organization uniquely among all current and future organizations. As such, the Org ID may not be changed once created."),b.createElement("p",null,"The id may only be composed of the restricted characters a-Z, A-Z, 0-9 and _, and is also restricted to 100 characters in length.")),b.createElement("dt",null,"description"),b.createElement("dd",null,b.createElement("p",null,"Up to 4000 characters, a description allows you to express to other KBase users the purpose, history, associations, and science domain of your Org."),b.createElement("p",null,'The description is in "markdown" format, and the editor will show you a preview of the rendered description.'))))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Rt.a.confirm({title:"Leave the editor?",content:b.createElement("div",null,b.createElement("p",null,"You have entered information for this new organization."),b.createElement("p",null,"If you leave the editor without first saving, the new organization ",b.createElement("i",null,"will not be created"),"."),b.createElement("p",null,b.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),this.props.onUpdateId(e.target.value)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===s.EDITED&&this.props.saveState===c.NEW}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===o.OK?"":e.syncState===i.DIRTY?b.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderEditor",value:function(){return b.createElement("form",{id:"newOrganizationForm",className:"NewOrganization-editor",onSubmit:this.onSubmit.bind(this)},b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{style:{flex:"1 1 0px"}},b.createElement("h3",null,"Create Your Organization"))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("h3",null,"Preview"))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},b.createElement(Ot.a,{title:"This is the name for your organization as you want KBase users to see it"},"Name")),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Dr.a,{value:this.props.newOrganization.name.value||"",className:this.calcFieldClass(this.props.newOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.newOrganization.name))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-name"},this.props.newOrganization.name.value||""))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"ID"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Dr.a,{value:this.props.newOrganization.id.value||"",className:this.calcFieldClass(this.props.newOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.newOrganization.id))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-id"},b.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.newOrganization.id.value||b.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Logo URL"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Dr.a,{value:this.props.newOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.logoUrl))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-logo"},this.renderLogoPreview()))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Home Page URL"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(Dr.a,{value:this.props.newOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.newOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.newOrganization.homeUrl))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-field-name"},b.createElement("a",{href:this.props.newOrganization.homeUrl.value||"",target:"_blank"},this.props.newOrganization.homeUrl.value||"")))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Is Private?"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(nr.a,{checked:this.props.newOrganization.isPrivate.value,className:this.calcFieldClass(this.props.newOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.newOrganization.isPrivate))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.newOrganization.isPrivate.value)))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"},"Research Interests"),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(kr.a,{value:this.props.newOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.newOrganization.researchInterests)+" NewOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.newOrganization.researchInterests))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-researchInterests"},this.props.newOrganization.researchInterests.value||""))),b.createElement("div",{className:"NewOrganization-row"},b.createElement("div",{className:"NewOrganization-col1"},b.createElement("div",{className:"NewOrganization-formLabel field-label"}),b.createElement("div",{className:"NewOrganization-formControl"},b.createElement(kr.a,{value:this.props.newOrganization.description.value||"",className:this.calcFieldClass(this.props.newOrganization.description)+" NewOrganization-control-description",autosize:{minRows:5,maxRows:15},onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.newOrganization.description))),b.createElement("div",{className:"NewOrganization-col2"},b.createElement("div",{className:"NewOrganization-preview-description",dangerouslySetInnerHTML:{__html:Cr.Marked.parse(this.props.newOrganization.description.value||"")}}))))}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderLogo",value:function(e){return b.createElement(mt,{logoUrl:null,size:64,organizationName:e.name.value,organizationId:e.id.value})}},{key:"renderIsPrivate",value:function(e){return e?b.createElement("span",null,b.createElement(pt.a,{type:"lock"})," ","Private"):b.createElement("span",null,b.createElement(pt.a,{type:"global"})," ","Public")}},{key:"renderDefaultLogo",value:function(){if(!this.props.newOrganization.name.value||!this.props.newOrganization.id.value)return b.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.newOrganization.name.value,0).toUpperCase(),t=vt()(this.props.newOrganization.id.value).substr(0,6);return b.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},b.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderLogoPreview",value:function(){return this.props.newOrganization.logoUrl.value?b.createElement("img",{src:this.props.newOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return b.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"toggleError",value:function(){this.setState({showError:!this.state.showError})}},{key:"renderHeader",value:function(){var e,t=this.props.newOrganization.name.value||b.createElement("span",{style:{fontStyle:"italic",color:"gray"}},"org name will appear here when you edit the name field");this.props.error&&(e=b.createElement(er.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)}));var r=b.createElement(b.Fragment,null,b.createElement("span",null,b.createElement(pt.a,{type:"plus-circle"})," ",'Adding a New Org "',t,'"')),n=b.createElement(b.Fragment,null,b.createElement(er.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),b.createElement(er.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}),e);return b.createElement(ar,{breadcrumbs:r,buttons:n})}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading New Org Editor...");return b.createElement(ar,{breadcrumbs:e})}},{key:"renderError",value:function(){var e=this;if(this.props.error&&this.state.showError){var t;return this.props.error.trace&&(t=this.props.error.trace.map(function(e,t){return b.createElement("div",{key:"line_"+t},e)})),t&&(t=b.createElement("div",null,b.createElement("div",null,"trace"),t)),b.createElement(Rt.a,{visible:!0,title:"Error",okType:"danger",okText:"Close",cancelText:"Clear Error",onCancel:function(){e.setState({showError:!1})},onOk:function(){e.setState({showError:!1})}},b.createElement("div",{style:{fontWeight:"bold"}},this.props.error.code),b.createElement("div",null,this.props.error.message),t)}}},{key:"renderMenuButtons",value:function(){var e;return this.props.error&&(e=b.createElement(er.a,{shape:"circle",icon:"exclamation",type:"danger",onClick:this.toggleError.bind(this)})),b.createElement(b.Fragment,null,b.createElement(er.a,{icon:"save",form:"newOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save"),e)}},{key:"render",value:function(){return this.state.cancelToBrowser?b.createElement(Mr.a,{push:!0,to:"/organizations"}):this.props.saveState===c.SAVED?b.createElement(Mr.a,{push:!0,to:"/editOrganization/"+this.props.newOrganization.id.value}):this.props.newOrganization?b.createElement("div",{className:"NewOrganization"},b.createElement(sr,{buttons:this.renderMenuButtons()}),this.renderEditor(),this.renderError()):b.createElement("div",{className:"NewOrganization"},this.renderLoadingHeader())}}]),t}(b.Component);var zr=Object(P.b)(function(e){if(!e.views.addOrgView.viewModel)throw new Error("View model missing in state");var t=e.views.addOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,newOrganization:t.newOrganization,error:t.error}},function(e){return{onSave:function(){e(gr())},onUpdateName:function(t){e(Ar(t))},onUpdateLogoUrl:function(t){e(Nr(t))},onUpdateId:function(t){e(Tr(t))},onUpdateDescription:function(t){e(yr(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:F.ADD_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(Sr())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=_e.validateOrgHomeUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.ADD_ORG_UPDATE_HOME_URL_ERROR,homeUrl:e,error:i}):t({type:F.ADD_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a})}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=_e.validateOrgHomeUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:F.ADD_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a})}}(t))}}})(Ur),Gr=(r(271),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){return b.createElement("div",null,'Loading "Add New Organization" form...')}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});case R.SUCCESS:default:return b.createElement(zr,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component));var jr=Object(P.b)(function(e,t){return{view:e.views.addOrgView}},function(e){return{onLoad:function(){e(_r())},onUnload:function(){e({type:F.ADD_ORG_UNLOAD})}}})(Gr),Lr=function(){function e(t){Object(C.a)(this,e),this.params=void 0,this.params=t}return Object(D.a)(e,[{key:"getOrganizationForUser",value:function(){var e=Object(ie.a)(ae.a.mark(function e(t){var r,n,a,i,s,o,c;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Ue({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),n=new we({token:this.params.token,username:this.params.username,groupsServiceURL:this.params.groupsServiceURL}),e.next=4,r.getOrg(t);case 4:return a=e.sent,e.next=7,n.getUserRequestForOrg(t);case 7:return i=e.sent,e.next=10,n.getUserInvitationForOrg(t);case 10:if(s=e.sent,(o=ge(a,this.params.username,i,s)).type!==me.ADMIN&&o.type!==me.OWNER){e.next=18;break}return e.next=15,n.getPendingOrganizationRequestsForOrg(t);case 15:c=e.sent,e.next=19;break;case 18:c=null;case 19:return e.abrupt("return",{organization:a,request:i,invitation:s,relation:o,groupRequests:c});case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();function Pr(){return function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:F.DATA_SERVICE_LOAD_START}),t({type:F.DATA_SERVICE_LOAD_SUCCESS});case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}function Br(e){return{type:F.VIEW_ORG_REMOVE_NARRATIVE_ERROR,error:e}}function xr(e,t){return{type:F.VIEW_ORG_ACCESS_NARRATIVE_SUCCESS,organization:e,narratives:t}}function Wr(e){return{type:F.VIEW_ORG_ACCESS_NARRATIVE_ERROR,error:e}}function qr(e,t,r,n,a,i,s,o,c,l,u){return{type:F.VIEW_ORG_LOAD_NORMAL_SUCCESS,organization:e,relation:t,openRequest:r,groupRequests:n,groupInvitations:a,requestInbox:i,requestOutbox:s,narrativesSortBy:o,narratives:c,sortMembersBy:l,members:u}}function Hr(e,t,r){return{type:F.VIEW_ORG_LOAD_INACCESSIBLE_PRIVATE_SUCCESS,organization:e,relation:t,requestOutbox:r}}function Fr(e){return{type:F.VIEW_ORG_LOAD_ERROR,error:e}}function Qr(e){return{type:F.VIEW_ORG_JOIN_REQUEST_ERROR,error:e}}function Zr(){return{type:F.VIEW_ORG_ACCEPT_JOIN_INVITATION_START}}function Jr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,O,p,R,h,w,_,g,S;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.VIEW_ORG_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Lr({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),E=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,l.getOrganizationForUser(e);case 8:if(d=t.sent,v=d.organization,m=d.relation,v.kind===Re.NORMAL){t.next=17;break}return t.next=14,u.getRequestInboxForOrg(e);case 14:return O=t.sent,r(Hr(v,m,O)),t.abrupt("return");case 17:if(m.type!==me.OWNER&&m.type!==me.ADMIN){t.next=29;break}return t.next=20,u.getPendingOrganizationRequestsForOrg(e);case 20:return R=t.sent,t.next=23,u.getOrganizationInvitationsForOrg(e);case 23:return h=t.sent,t.next=26,E.getOpenRequestStatus({organizationId:e});case 26:p=t.sent,t.next=32;break;case 29:R=null,h=null,p=he.INAPPLICABLE;case 32:return t.next=34,u.getCombinedRequestInboxForOrg(e);case 34:return w=t.sent,t.next=37,u.getRequestOutboxForOrg(e);case 37:_=t.sent,"added",g=De(v.narratives,{sortBy:"added",searchBy:""}),"added",S=ke(v.members,{sortBy:"added",searchBy:""}),r(qr(v,m,p,R,h,w,_,"added",g,"added",S)),t.next=48;break;case 45:t.prev=45,t.t0=t.catch(5),r(Fr({code:t.t0.name,message:t.t0.message}));case 48:case"end":return t.stop()}},t,this,[[5,45]])}));return function(e,r){return t.apply(this,arguments)}}()}function Yr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,O,p,R,h,w,_,g,S,A,N;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Lr({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,userProfileServiceURL:c.services.UserProfile.url,workspaceServiceURL:c.services.Workspace.url}),u=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),E=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=4,d=n(),v=d.views.viewOrgView.viewModel){t.next=10;break}return r(Fr({code:"error",message:"No view model"})),t.abrupt("return");case 10:if(v.kind===f.NORMAL){t.next=13;break}return r(Fr({code:"error",message:"Wrong org view model kind!"})),t.abrupt("return");case 13:return t.next=15,l.getOrganizationForUser(e);case 15:if(m=t.sent,O=m.organization,p=m.relation,O.kind===Re.NORMAL){t.next=24;break}return t.next=21,u.getRequestInboxForOrg(e);case 21:return R=t.sent,r(Hr(O,p,R)),t.abrupt("return");case 24:if(p.type!==me.OWNER&&p.type!==me.ADMIN){t.next=36;break}return t.next=27,u.getPendingOrganizationRequestsForOrg(e);case 27:return w=t.sent,t.next=30,u.getOrganizationInvitationsForOrg(e);case 30:return _=t.sent,t.next=33,E.getOpenRequestStatus({organizationId:e});case 33:h=t.sent,t.next=39;break;case 36:w=null,_=null,h=he.INAPPLICABLE;case 39:return t.next=41,u.getCombinedRequestInboxForOrg(e);case 41:return g=t.sent,t.next=44,u.getRequestOutboxForOrg(e);case 44:S=t.sent,"added",A=De(O.narratives,{sortBy:v.sortNarrativesBy,searchBy:v.searchNarrativesBy}),"added",N=ke(O.members,{sortBy:v.sortMembersBy,searchBy:v.searchMembersBy}),r(qr(O,p,h,w,_,g,S,"added",A,"added",N)),t.next=55;break;case 52:t.prev=52,t.t0=t.catch(4),r(Fr({code:t.t0.name,message:t.t0.message}));case 55:case"end":return t.stop()}},t,this,[[4,52]])}));return function(e,r){return t.apply(this,arguments)}}()}function Kr(){return function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,i,s,o,c,l,u;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r()).views.viewOrgView.viewModel){e.next=4;break}return t(Qr({type:a.ERROR,message:"Now view model!"})),e.abrupt("return");case 4:return i=n.auth.authorization,s=i.token,o=i.username,c=n.app.config,l=n.views.viewOrgView.viewModel.organization,u=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url}),e.prev=6,e.next=9,u.requestMembership(l.id);case 9:t({type:F.VIEW_ORG_JOIN_REQUEST_SUCCESS}),t(Jr(l.id)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),t(Qr({type:a.ERROR,message:e.t0.message}));case 16:case"end":return e.stop()}},e,this,[[6,13]])}));return function(t,r){return e.apply(this,arguments)}}()}function Xr(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var i,s,o,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_JOIN_REQUEST_START}),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Qr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new we({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.cancelRequest(e);case 10:E=t.sent,r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={type:a.ERROR,message:t.t0.message},{type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function $r(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var i,s,o,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Zr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Qr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new we({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.acceptJoinInvitation(e);case 10:E=t.sent,r({type:F.VIEW_ORG_ACCEPT_JOIN_INVITATION_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:F.VIEW_ORG_ACCEPT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function en(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var i,s,o,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r(Zr()),(i=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Qr({type:a.ERROR,message:"Now view model!"})),t.abrupt("return");case 5:return s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,i.views.viewOrgView.viewModel.organization,u=new we({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=7,t.next=10,u.rejectJoinInvitation(e);case 10:E=t.sent,r({type:F.VIEW_ORG_REJECT_JOIN_INVITATION_SUCCESS}),r(Jr(E.organizationId)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),r((d={code:t.t0.name,message:t.t0.message},{type:F.VIEW_ORG_REJECT_JOIN_INVITATION_ERROR,error:d}));case 18:case"end":return t.stop()}var d},t,this,[[7,15]])}));return function(e,r){return t.apply(this,arguments)}}()}function tn(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===f.NORMAL){t.next=8;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_START}),s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new we({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.acceptRequest(e);case 14:return t.next=16,u.getCombinedRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}var rn,nn=r(345),an=r(337);r(273);function sn(e){switch(e){case rn.COMPACT:return rn.NORMAL;case rn.NORMAL:return rn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(rn||(rn={}));var on=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:rn.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:sn(this.state.view)})}},{key:"renderRole",value:function(){switch(this.props.member.type){case Oe.OWNER:return b.createElement("span",null,b.createElement(pt.a,{type:"crown"})," owner");case Oe.ADMIN:return b.createElement("span",null,b.createElement(pt.a,{type:"unlock"})," admin");case Oe.MEMBER:return b.createElement("span",null,b.createElement(pt.a,{type:"user"})," member")}}},{key:"renderCompact",value:function(){var e=b.createElement("div",null,this.props.member.username);return b.createElement("div",{className:"Member View-COMPACT"},b.createElement("div",{className:"Member-controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===rn.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===rn.NORMAL?"up":"down")}))),b.createElement("div",{className:"Member-avatarCol"},b.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"Member-infoCol"},b.createElement("div",{className:"Member-name"},b.createElement(Ot.a,{placement:"bottomRight",title:e},b.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),b.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",b.createElement(Jt,{time:this.props.member.joinedAt})),b.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title)))}},{key:"renderNormal",value:function(){var e=b.createElement("div",null,this.props.member.username);return b.createElement("div",{className:"Member View-NORMAL"},b.createElement("div",{className:"Member-controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===rn.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===rn.NORMAL?"up":"down")}))),b.createElement("div",{className:"Member-avatarCol"},b.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"Member-infoCol"},b.createElement("div",{className:"Member-name"},b.createElement(Ot.a,{placement:"bottomRight",title:e},b.createElement("a",{href:"/#people/"+this.props.member.username,target:"_blank"},this.props.user.realname))),b.createElement("div",{className:"Member-role"},this.renderRole(),", joined ",b.createElement(Jt,{time:this.props.member.joinedAt})),b.createElement("div",{className:"Member-title"},this.props.member.title||this.props.user.title),b.createElement("div",{className:"Member-organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"Member-location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case rn.COMPACT:return this.renderCompact();case rn.NORMAL:return this.renderNormal()}}}]),t}(b.Component),cn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(on,{member:this.props.member,user:this.props.user,avatarSize:this.props.avatarSize}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.member.username)}}]),t}(b.Component);var ln=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.member.username)}},function(e){return{onLoad:function(t){e(qt(t))}}})(cn);function un(e){var t=e.code,r=e.message,n=e.detail,a=e.history,i=e.trace,s=e.info;return{code:t,message:r,detail:n,id:je()(),at:new Date,history:a,trace:i,info:s}}function En(e){return function(t,r){t({type:F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new Ue({token:i,username:s,groupsServiceURL:o.services.Groups.url}).memberToAdmin(c.organization.id,e).then(function(r){t(function(e){return{type:F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:F.VIEW_ORG_VIEW_MEMBERS_PROMOTE_TO_ADMIN_ERROR,error:r}))})}}function dn(e){return function(t,r){t({type:F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new Ue({token:i,username:s,groupsServiceURL:o.services.Groups.url}).adminToMember(c.organization.id,e).then(function(r){t(function(e){return{type:F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_SUCCESS,memberUsername:e}}(e))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:F.VIEW_ORG_VIEW_MEMBERS_DEMOTE_TO_MEMBER_ERROR,error:r}))})}}function vn(e){return function(t,r){t({type:F.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_START});var n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel;if(null===c)throw new Error("view is not populated");new Ue({token:i,username:s,groupsServiceURL:o.services.Groups.url}).removeMember(c.organization.id,e).then(function(){t(Yr(c.organization.id))}).catch(function(e){var r;t((r={code:e.name,message:e.message},{type:F.VIEW_ORG_VIEW_MEMBERS_REMOVE_MEMBER_ERROR,error:r}))})}}r(275);var mn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={confirmMemberRemoval:null},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onConfirmRemoveMember",value:function(e){this.setState({confirmMemberRemoval:{member:e}})}},{key:"renderConfirmMemberRemoval",value:function(){var e=this;if(this.state.confirmMemberRemoval){var t=this.state.confirmMemberRemoval.member,r=b.createElement(b.Fragment,null,b.createElement("p",null,"Please confirm removal of this member from this organization."),b.createElement("div",{className:"simpleCard",style:{marginBottom:"1em"}},b.createElement(ln,{member:t,avatarSize:20})),b.createElement("p",null,"This user as well as members of this organization will receive a notification of the removal."),b.createElement("p",null,"Any Narratives associated by this member with this Organization will be unaffected. This member will also retain any Narrative permissions granted through this Organization."));return b.createElement(Rt.a,{title:"Confirm Removal of Member",width:"50em",visible:!0,onOk:function(){e.props.onRemoveMember(t.username),e.setState({confirmMemberRemoval:null})},onCancel:function(){e.setState({confirmMemberRemoval:null})},okText:"Confirm"},r)}}},{key:"onMemberMenu",value:function(e,t){switch(e){case"promoteToAdmin":this.props.onPromoteMemberToAdmin(t.username);break;case"removeMember":this.onConfirmRemoveMember(t)}}},{key:"onAdminMenu",value:function(e,t){switch(e){case"demoteToMember":this.props.onDemoteAdminToMember(t.username)}}},{key:"renderMemberMenu",value:function(e){var t=this,r=b.createElement(ht.a,{onClick:function(r){var n=r.key;t.onMemberMenu.call(t,n,e)}},b.createElement(ht.a.Item,{key:"promoteToAdmin"},b.createElement(pt.a,{type:"unlock"}),"Promote to Admin"),b.createElement(ht.a.Item,{key:"removeMember"},b.createElement(pt.a,{type:"delete"}),"Remove Member"));return b.createElement("div",null,b.createElement(wt.a,{overlay:r,trigger:["click"]},b.createElement(pt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderAdminMenu",value:function(e){var t=this,r=b.createElement(ht.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},b.createElement(ht.a.Item,{key:"demoteToMember"},b.createElement(pt.a,{type:"user"}),"Demote to Member"));return b.createElement("div",null,b.createElement(wt.a,{overlay:r,trigger:["click"]},b.createElement(pt.a,{type:"ellipsis",className:"IconButton-hover"})))}},{key:"renderOwnerMenu",value:function(e){return b.createElement("div",null)}},{key:"renderMemberOptions",value:function(e){if(this.props.relation.type===me.OWNER||this.props.relation.type===me.ADMIN)switch(e.type){case Oe.OWNER:return this.renderOwnerMenu(e);case Oe.ADMIN:return this.renderAdminMenu(e);case Oe.MEMBER:return this.renderMemberMenu(e)}}},{key:"renderMembers",value:function(){var e,t=this,r=b.createElement("div",{style:{fontStyle:"italic",textAlign:"center"}},"No members");return e=0===this.props.members.length?b.createElement(ut.a,{type:"info",message:r}):this.props.members.map(function(e){var r=["Members-row","simpleCard"];return null!==t.props.organization.lastVisitedAt&&t.props.organization.lastVisitedAt.getTime()<e.joinedAt.getTime()&&r.push("Members-newMember"),b.createElement("div",{className:r.join(" "),key:e.username},b.createElement("div",{className:"Members-member"},b.createElement(ln,{member:e,avatarSize:50})),b.createElement("div",{className:"Members-menu"},t.renderMemberOptions(e)))}),b.createElement("div",{className:"infoTable"},e)}},{key:"renderSearchBar",value:function(){var e=this;return b.createElement("div",{style:{paddingRight:"6px"}},b.createElement(Dr.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter members by name",onChange:function(t){e.props.onSearchMembers(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return b.createElement(b.Fragment,null,b.createElement("span",{className:"field-label"},"sort"),b.createElement(tr.a,{onChange:function(t){e.props.onSortMembers(t)},style:{width:"10em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortMembersBy},b.createElement(tr.a.Option,{value:"name",key:"name"},"Name"),b.createElement(tr.a.Option,{value:"added",key:"added"},"Date Joined")))}},{key:"renderHeader",value:function(){return b.createElement("div",{className:"ViewOrganizationMembers-headerRow"},b.createElement("div",{className:"ViewOrganizationMembers-searchCol"},this.renderSearchBar()),b.createElement("div",{className:"ViewOrganizationMembers-sortCol"},this.renderSortBar()))}},{key:"render",value:function(){var e;return this.state.confirmMemberRemoval&&(e=this.renderConfirmMemberRemoval()),b.createElement(b.Fragment,null,b.createElement("div",{className:"ViewOrganizationMembers scrollable-flex-column"},b.createElement("div",{className:"ViewOrganizationMembers-header"},this.renderHeader()),b.createElement("div",{className:"ViewOrganizationMembers-body scrollable-flex-column"},this.renderMembers())),e)}}]),t}(b.Component);var On=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onViewMembersUnload:function(){e({type:F.VIEW_ORG_VIEW_MEMBERS_UNLOAD})},onPromoteMemberToAdmin:function(t){e(En(t))},onDemoteAdminToMember:function(t){e(dn(t))},onRemoveMember:function(t){e(vn(t))},onSearchMembers:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===f.NORMAL){var a=ke(n.organization.members,{sortBy:n.sortMembersBy,searchBy:e});t({type:F.VIEW_ORG_SEARCH_MEMBERS_SUCCESS,searchBy:e,members:a})}else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:un({code:"error",message:"Wrong org view model kind!"})});else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:un({code:"error",message:"No view model"})})}}(t))},onSortMembers:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_MEMBERS_START});var n=r().views.viewOrgView.viewModel;if(null!==n)if(n.kind===f.NORMAL){var a=n.organization.members,i=n.searchMembersBy,s=ke(a,{sortBy:e,searchBy:i});t({type:F.VIEW_ORG_SORT_MEMBERS_SUCCESS,members:s,sortBy:e})}else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:un({code:"error",message:"Wrong org view model kind!"})});else t({type:F.VIEW_ORG_SORT_MEMBERS_ERROR,error:un({code:"error",message:"No view model"})})}}(t))}}})(mn);function pn(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=5;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 5:if(i.kind===f.NORMAL){t.next=8;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 8:return r({type:F.VIEW_ORG_REJECT_INBOX_REQUEST_START}),s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new we({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.denyRequest(e);case 14:return t.next=16,u.getRequestInboxForOrg(i.organization.id);case 16:E=t.sent,r({type:F.VIEW_ORG_REJECT_INBOX_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:F.VIEW_ORG_REJECT_INBOX_REQUEST_ERROR,error:{code:t.t0.name,message:t.t0.message}});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}function Rn(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_START}),a=n(),null!==(i=a.views.viewOrgView.viewModel)){t.next=6;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"error",message:"No view model"}}),t.abrupt("return");case 6:if(i.kind===f.NORMAL){t.next=9;break}return r({type:F.VIEW_ORG_ACCEPT_INBOX_REQUEST_ERROR,error:{code:"invalid state",message:"Not the right kind of view model"}}),t.abrupt("return");case 9:return s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new we({token:o,username:c,groupsServiceURL:l.services.Groups.url}),t.prev=11,t.next=14,u.cancelRequest(e);case 14:return t.next=16,u.getRequestOutboxForOrg(i.organization.id);case 16:E=t.sent,r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_SUCCESS,requests:E}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(11),r({type:F.VIEW_ORG_CANCEL_JOIN_REQUEST_ERROR,error:un({code:"error",message:t.t0.message})});case 23:case"end":return t.stop()}},t,this,[[11,20]])}));return function(e,r){return t.apply(this,arguments)}}()}var hn;r(277),r(279);function wn(e){switch(e){case hn.COMPACT:return hn.NORMAL;case hn.NORMAL:return hn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(hn||(hn={}));var _n=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:hn.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:wn(this.state.view)})}},{key:"renderCompact",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===hn.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===hn.NORMAL?"up":"down")}))),b.createElement("div",{className:"avatarCol"},b.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"infoCol"},b.createElement("div",{className:"name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),b.createElement("div",null,this.props.user.username)))}},{key:"renderNormal",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===hn.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===hn.NORMAL?"up":"down")}))),b.createElement("div",{className:"avatarCol"},b.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"infoCol"},b.createElement("div",{className:"name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)),b.createElement("div",null,this.props.user.username),b.createElement("div",{className:"organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}},{key:"render",value:function(){switch(this.state.view){case hn.COMPACT:return b.createElement("div",{className:"User View-COMPACT"},this.renderCompact());case hn.NORMAL:return b.createElement("div",{className:"User View-NORMAL"},this.renderNormal())}}}]),t}(b.Component),gn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(_n,{user:this.props.user,avatarSize:this.props.avatarSize}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(b.Component);var Sn,fn=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(qt(t))}}})(gn);r(281);function An(e){switch(e){case Sn.COMPACT:return Sn.NORMAL;case Sn.NORMAL:return Sn.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(Sn||(Sn={}));var Nn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:Sn.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:An(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement(Ot.a,{title:"This narrative is viewable by all KBase users",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(pt.a,{type:"global"})," Public Narrative")):b.createElement(Ot.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(pt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t;switch(e.access){case Gt.VIEW:t=b.createElement("span",null,"View-Only (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.EDIT:t=b.createElement("span",null,"Edit (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.ADMIN:t="Admin";break;case Gt.OWNER:t="Owner";break;default:t="Unknown"}return b.createElement("span",null,t)}},{key:"renderCompact",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Sn.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===Sn.NORMAL?"up":"down")}))),b.createElement("div",{className:"iconCol"},b.createElement(pt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),b.createElement("div",{className:"mainCol"},b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",b.createElement("div",{className:"Narrative-owner"},b.createElement(fn,{avatarSize:20,userId:e.owner}))))}},{key:"renderNormal",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===Sn.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===Sn.NORMAL?"up":"down")}))),b.createElement("div",{className:"iconCol"},b.createElement(pt.a,{type:"file",style:{fontSize:"30px",width:"30px"}})),b.createElement("div",{className:"mainCol"},b.createElement("div",{className:"mainCol"},b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title))," ",b.createElement("div",{className:"Narrative-owner"},b.createElement(fn,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},b.createElement(pt.a,{type:"crown"})),b.createElement("div",{className:"Narrative-global"},b.createElement(pt.a,{type:"global"}))),b.createElement("div",null,this.renderPublicPermission(e)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"your permission"),this.renderUserPermission(e)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"last saved"),Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.lastSavedAt)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"by"),e.lastSavedBy)))}},{key:"render",value:function(){var e=this.props.narrative;if(e.access===Gt.NONE)return b.createElement("div",null,b.createElement(pt.a,{type:"exclamation-circle",style:{color:"orange"}})," ","You don't have access to this Narrative");switch(this.state.view){case Sn.COMPACT:return b.createElement("div",{className:"Narrative View-COMPACT"},this.renderCompact(e));case Sn.NORMAL:return b.createElement("div",{className:"Narrative View-NORMAL"},this.renderNormal(e))}}}]),t}(b.Component),In=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.narrative?b.createElement(Nn,{narrative:this.props.narrative}):b.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(b.Component);var bn=Object(P.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Ht(t))}}})(In),Tn=(r(283),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onAcceptRequest",value:function(){this.props.onAcceptInboxRequest(this.props.request)}},{key:"onRejectRequest",value:function(){this.props.onRejectInboxRequest(this.props.request)}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(bn,{workspaceId:parseInt(e.narrativeId,10)})))}case oe.INVITATION:switch(e.resourceType){case ce.USER:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(fn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return b.createElement(fn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.APP:return"REQUEST to associate App";case ce.USER:return"REQUEST to join Organization";case ce.WORKSPACE:return"REQUEST to associate Narrative"}case oe.INVITATION:switch(e.resourceType){case ce.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(bn,{workspaceId:parseInt(e.narrativeId,10)})),b.createElement("div",{className:"cardSectionHeader"},"with organization"))}case oe.INVITATION:switch(e.resourceType){case ce.USER:return""}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),b.createElement("div",{className:"cardSectionHeader"},"from"),b.createElement("div",{className:"requestSubject"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),b.createElement("div",{className:"miniDetail"},b.createElement(bn,{workspaceId:parseInt(e.narrativeId,10)})),b.createElement("div",{className:"cardSectionHeader"},"from"),b.createElement("div",{className:"requester miniDetail"},this.renderRequestRequester(e)),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return b.createElement("div",{style:{textAlign:"center"}},b.createElement(er.a.Group,{style:{marginTop:"4px"}},b.createElement(er.a,{type:"default",onClick:this.onAcceptRequest.bind(this)},b.createElement(pt.a,{type:"check"}),"Accept"),b.createElement(er.a,{type:"danger",onClick:this.onRejectRequest.bind(this)},b.createElement(pt.a,{type:"cross"}),"Reject")))}},{key:"renderUserInvitation",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),b.createElement("div",{className:"requestSubject"},this.renderRequestReceivedSubject(e)),b.createElement("div",{className:"cardSectionHeader"},"from"),b.createElement(fn,{userId:e.requester,avatarSize:30}),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.USER:return this.renderJoinRequest(e);case ce.WORKSPACE:return this.renderWorkspaceRequest(e);case ce.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"apps not supported yet"))}case oe.INVITATION:switch(e.resourceType){case ce.USER:return this.renderUserInvitation(e);case ce.WORKSPACE:case ce.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return b.createElement("div",{key:e.id,className:"InboxRequest kbCard"},b.createElement("div",{className:"kbCard-header"},b.createElement("div",{className:"InboxRequest-requestHeaderRow"},b.createElement("div",{className:"InboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),b.createElement("div",{className:"InboxRequest-requestHeaderExpireAt"},b.createElement("span",{className:"field-label"},"expires")," ",Zt(e.expireAt)))),b.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(b.Component));var yn=Object(P.b)(function(e,t){return{}},function(e){return{onAcceptInboxRequest:function(t){e(tn(t.id))},onRejectInboxRequest:function(t){e(pn(t.id))}}})(Tn),Mn=(r(285),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onCancelRequest",value:function(){this.props.onCancelOutboxRequest(this.props.request)}},{key:"onAcceptInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectInvitation",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onAcceptRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"onRejectRequest",value:function(){alert("Hold your socks, not yet implemented")}},{key:"renderRequestSentSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(bn,{workspaceId:parseInt(e.narrativeId,10)})))}case oe.INVITATION:switch(e.resourceType){case ce.USER:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(fn,{userId:e.user,avatarSize:30})))}}return"unknown request"}},{key:"renderRequestRequester",value:function(e){return b.createElement(fn,{userId:e.requester,avatarSize:30})}},{key:"renderRequestReceivedType",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.APP:return"REQUEST to associate App";case ce.USER:return"REQUEST to join Organization";case ce.WORKSPACE:return"REQUEST to associate Narrative"}case oe.INVITATION:switch(e.resourceType){case ce.USER:return"INVITATION to join Organization"}}return"unknown request"}},{key:"renderRequestReceivedSubject",value:function(e){switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.APP:return"SHOW APP";case ce.USER:return"";case ce.WORKSPACE:return b.createElement("div",null,b.createElement("div",{className:"miniDetail"},b.createElement(bn,{workspaceId:parseInt(e.narrativeId,10)})),b.createElement("div",{className:"cardSectionHeader"},"with organization"))}case oe.INVITATION:switch(e.resourceType){case ce.USER:return b.createElement(fn,{userId:e.user,avatarSize:30})}}return"unknown request"}},{key:"renderJoinRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to join Organization"),this.renderRequestOptions(e))}},{key:"renderWorkspaceRequest",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"REQUEST to associate Narrative"),b.createElement("div",{className:"miniDetail"},b.createElement(bn,{workspaceId:parseInt(e.narrativeId,10)})),this.renderRequestOptions(e))}},{key:"renderRequestOptions",value:function(e){return b.createElement("div",{style:{textAlign:"center"}},b.createElement(er.a.Group,{style:{marginTop:"4px"}},b.createElement(er.a,{type:"danger",onClick:this.onCancelRequest.bind(this)},b.createElement(pt.a,{type:"cross"}),"Cancel")))}},{key:"renderUserInvitation",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"cardSectionHeader"},"INVITATION to join organization"),b.createElement("div",{className:"cardSectionHeader"},"sent to"),b.createElement("div",{className:"miniDetail"},this.renderRequestReceivedSubject(e)),this.renderRequestOptions(e))}},{key:"renderBody",value:function(){var e=this.props.request;switch(e.type){case oe.REQUEST:switch(e.resourceType){case ce.USER:return this.renderJoinRequest(e);case ce.WORKSPACE:return this.renderWorkspaceRequest(e);case ce.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"apps not supported yet"))}case oe.INVITATION:switch(e.resourceType){case ce.USER:return this.renderUserInvitation(e);case ce.WORKSPACE:case ce.APP:return b.createElement(b.Fragment,null,b.createElement("div",null,"Hmm, not supported"))}}}},{key:"render",value:function(){var e=this.props.request;return b.createElement("div",{key:e.id,className:"OutboxRequest kbCard"},b.createElement("div",{className:"kbCard-header"},b.createElement("div",{className:"OutboxRequest-requestHeaderRow"},b.createElement("div",{className:"OutboxRequest-requestHeaderCreatedAt"},Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e.createdAt)),b.createElement("div",{className:"OutboxRequest-requestHeaderExpireAt"},b.createElement("span",{className:"field-label"},"expires")," ",Zt(e.expireAt)))),b.createElement("div",{className:"kbCard-body"},this.renderBody()))}}]),t}(b.Component));var Cn=Object(P.b)(function(e,t){return{}},function(e){return{onCancelOutboxRequest:function(t){e(Rn(t.id))}}})(Mn),Dn=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={cancelToBrowser:!1,cancelToViewer:!1},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onClickCancelToBrowser",value:function(){this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){this.setState({cancelToViewer:!0})}},{key:"onAcceptJoinRequest",value:function(e){this.props.onAcceptJoinRequest(e)}},{key:"onDenyJoinRequest",value:function(e){this.props.onDenyJoinRequest(e)}},{key:"onCancelJoinInvitation",value:function(e){this.props.onCancelJoinInvitation(e)}},{key:"onGetViewAccess",value:function(e){this.props.onGetViewAccess(e)}},{key:"onViewProfile",value:function(e){window.open("/#people/"+e,"_blank")}},{key:"onShowInfo",value:function(){Rt.a.info({title:"Manage Requests Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the manage requests tool..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading Org Editor...");return b.createElement(ar,{breadcrumbs:e})}},{key:"renderRequestJoinRequest",value:function(e){var t=this,r=b.createElement("span",null,b.createElement(pt.a,{type:"user"}),b.createElement(pt.a,{type:"arrow-right"}),b.createElement(pt.a,{type:"team"})," ","Request to Join Group"),n=[b.createElement(er.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),b.createElement(er.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return b.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"from"),b.createElement("td",{className:"requester"},b.createElement(fn,{userId:e.requester,avatarSize:50}))),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderRequestJoinInvitation",value:function(e){var t=this,r=b.createElement("span",null,b.createElement(pt.a,{type:"team"}),b.createElement(pt.a,{type:"mail"}),b.createElement(pt.a,{type:"arrow-right"}),b.createElement(pt.a,{type:"user"})," ","Invitation to Join Group"),n=[b.createElement(er.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onCancelJoinInvitation.call(t,e)}},"Cancel")];return b.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"invitation to"),b.createElement("td",{className:"requester"},b.createElement(fn,{userId:e.user,avatarSize:30}))),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderNarrativePermission",value:function(e){switch(e){case pe.NONE:return"None";case pe.VIEW:return"View Only";case pe.EDIT:return"Edit";case pe.ADMIN:return"Admin";case pe.OWNER:return"Owner"}}},{key:"renderRequestNarrativeRequest",value:function(e){var t,r=this,n=b.createElement("span",null,b.createElement(pt.a,{type:"file"}),b.createElement(pt.a,{type:"arrow-right"}),b.createElement(pt.a,{type:"team"})," ","Request to Add Narrative"),a=[b.createElement(er.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return r.onAcceptJoinRequest.call(r,e)}},"Approve"),b.createElement(er.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return r.onDenyJoinRequest.call(r,e)}},"Deny")];return t=b.createElement(bn,{workspaceId:parseInt(e.narrativeId,10)}),b.createElement(nn.a,{key:e.id,title:n,hoverable:!0,actions:a,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"from"),b.createElement("td",{className:"requester"},b.createElement(fn,{userId:e.requester,avatarSize:30}))),b.createElement("tr",null,b.createElement("th",null,"narrative"),b.createElement("td",{className:"narrative"},t)),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderRequestAppRequest",value:function(e){var t=this,r=b.createElement("span",null,b.createElement(pt.a,{type:"appstore"}),b.createElement(pt.a,{type:"arrow-right"}),b.createElement(pt.a,{type:"team"})," ","Request to Add App"),n=[b.createElement(er.a,{type:"primary",style:{margin:"0 5px"},onClick:function(){return t.onAcceptJoinRequest.call(t,e)}},"Approve"),b.createElement(er.a,{type:"danger",style:{margin:"0 5px"},onClick:function(){return t.onDenyJoinRequest.call(t,e)}},"Deny")];return b.createElement(nn.a,{key:e.id,title:r,hoverable:!0,actions:n,headStyle:{backgroundColor:"rgba(200, 200, 200,0.3"},style:{marginBottom:"10px"}},b.createElement("table",{className:"pendingRequestsTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,"from"),b.createElement("td",{className:"requester"},b.createElement(fn,{userId:e.requester,avatarSize:50}))),b.createElement("tr",null,b.createElement("th",null,"app"),b.createElement("td",{className:"requester"},e.appId)),b.createElement("tr",null,b.createElement("th",null,"sent"),b.createElement("td",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.createdAt))),b.createElement("tr",null,b.createElement("th",null,"expires"),b.createElement("td",{className:"expiresAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(e.expireAt)," (",Zt(e.expireAt),")")))))}},{key:"renderInbox",value:function(){var e;if(0===this.props.inbox.length)e=b.createElement("div",{className:"Message"},"No pending requests for you");else{var t=this.props.inbox.map(function(e){return b.createElement("div",{key:e.id},b.createElement(yn,{request:e}))});e=b.createElement("div",{style:{overflowY:"auto"}},t)}return b.createElement(b.Fragment,null,e)}},{key:"renderOutbox",value:function(){var e;if(0===this.props.outbox.length)e=b.createElement("div",{className:"Message"},"No pending requests from you");else{var t=this.props.outbox.map(function(e){return b.createElement("div",{key:e.id},b.createElement(Cn,{request:e}))});e=b.createElement("div",{style:{overflowY:"auto"}},t)}return b.createElement(b.Fragment,null,e)}},{key:"isAdmin",value:function(e){return e.type===me.ADMIN||e.type===me.OWNER}},{key:"render",value:function(){if(this.isAdmin(this.props.relation)){var e=this.props.outbox.length,t=this.props.inbox.length;return b.createElement("div",{className:"Requests"},b.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"inbox (",t,")"),this.renderInbox(),b.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"outbox (",e,")"),this.renderOutbox())}var r=this.props.outbox.length;return b.createElement("div",{className:"Requests"},b.createElement("div",{className:"ViewOrganization-tabPaneHeader"},"outbox (",r,")"),this.renderOutbox())}}]),t}(b.Component);var Vn=Object(P.b)(function(e,t){return{}},function(e){return{onAcceptJoinRequest:function(t){e(tn(t.id))},onDenyJoinRequest:function(t){e(pn(t.id))},onCancelJoinInvitation:function(t){e(Rn(t.id))},onGetViewAccess:function(e){}}})(Dn);r(291);var kn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"fullTimestamp",value:function(e){return Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(e)}},{key:"renderLogo",value:function(e){return b.createElement(mt,{logoUrl:e.logoUrl,size:30,organizationName:e.name,organizationId:e.id})}},{key:"render",value:function(){var e=this.props.organization;return b.createElement("div",{className:"OrganizationEntity-Accessible "},b.createElement("div",{className:"OrganizationEntity-Accessible-logoCol"},this.renderLogo(e)),b.createElement("div",{className:"OrganizationEntity-Accessible-mainCol"},b.createElement("div",{className:"OrganizationEntity-Accessible-name"},b.createElement("a",{href:"/viewOrganization/".concat(e.id)},e.name)),b.createElement("div",{className:"OrganizationEntity-Accessible-researchInterests"},e.researchInterests),b.createElement("div",{className:"OrganizationEntity-Accessible-owner"},b.createElement(Qt,{username:e.owner.username,showAvatar:!1,avatarSize:20}))))}}]),t}(b.Component),Un=(r(293),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return b.createElement("div",{className:"OrganizationEntity-Inaccessible "},b.createElement("div",{className:"OrganizationEntity-Inaccessible-logoCol"},b.createElement(pt.a,{type:"lock"})),b.createElement("div",{className:"OrganizationEntity-Inaccessible-mainCol"},b.createElement("div",{className:"OrganizationEntity-Inaccessible-name"},"Private Organization")))}}]),t}(b.Component));var zn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){if(!this.props.organization)return b.createElement("div",null,b.createElement(pt.a,{type:"loading"}));switch(this.props.organization.kind){case Re.NORMAL:return b.createElement(kn,{organization:this.props.organization});case Re.INACCESSIBLE_PRIVATE:return b.createElement(Un,{organization:this.props.organization});default:return b.createElement("div",null,"Error: unrecognized org kind")}}},{key:"componentDidMount",value:function(){this.props.organization||this.props.onLoad(this.props.organizationId)}}]),t}(b.Component);var Gn=Object(P.b)(function(e,t){return{organization:e.entities.organizations.byId.get(t.organizationId)||null}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.ENTITY_ORGANIZATION_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:u=t.sent,r({type:F.ENTITY_ORGANIZATION_LOAD_SUCCESS,organization:u}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r({type:F.ENTITY_ORGANIZATION_LOAD_ERROR,error:un({code:t.t0.name,message:t.t0.message})});case 13:case"end":return t.stop()}},t,this,[[3,10]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))}}})(zn),jn=(r(295),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.props.onManageRelatedOrgs()}},{key:"renderToolbar",value:function(){return b.createElement("div",{className:"RelatedOrganizations-toolbar"},b.createElement(er.a,{onClick:this.onManageRelatedOrgs.bind(this)},"Add Related Org"))}},{key:"onAdminMenu",value:function(e,t){switch(e){case"removeRelation":this.props.onRemoveRelatedOrganization(this.props.organization.id,t)}}},{key:"renderControls",value:function(e){var t=this;if(this.props.organization.isAdmin){var r=b.createElement(ht.a,{onClick:function(r){var n=r.key;t.onAdminMenu.call(t,n,e)}},b.createElement(ht.a.Item,{key:"removeRelation"},b.createElement(pt.a,{type:"delete"}),"Remove"));return b.createElement("div",null,b.createElement(wt.a,{overlay:r,trigger:["click"]},b.createElement(pt.a,{type:"ellipsis",className:"IconButton-hover"})))}}},{key:"renderBody",value:function(){var e=this;if(0===this.props.relatedOrganizations.length){var t=b.createElement("p",null,"No related organizations");return b.createElement(ut.a,{type:"info",message:t})}var r=this.props.relatedOrganizations.map(function(t){return b.createElement("div",{key:t,className:"RelatedOrganizations-orgRow simpleCard"},b.createElement("div",{className:"RelatedOrganizations-orgCol"},b.createElement(Gn,{organizationId:t})),b.createElement("div",{className:"RelatedOrganizations-controlCol"},e.renderControls(t)))});return b.createElement("div",{className:"RelatedOrganizations-organizations"},r)}},{key:"render",value:function(){return b.createElement("div",{className:"RelatedOrganizations scrollable-flex-column"},b.createElement("div",{className:"RelatedOrganizations-bodyRow scrollable-flex-column"},this.renderBody()))}}]),t}(b.Component));var Ln=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");return{searchMembersBy:r.searchMembersBy,sortMembersBy:r.sortMembersBy,members:r.members}},function(e){return{onRemoveRelatedOrganization:function(t,r){e(function(e,t){return function(){var r=Object(ie.a)(ae.a.mark(function r(n,a){var i,s,o,c,l,u;return ae.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new Ue({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:Le({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))}}})(jn),Pn=(r(297),r(299),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderRelated",value:function(){if(this.props.selectableOrganization.isRelated)return b.createElement(pt.a,{type:"check",style:{color:"green"}})}},{key:"render",value:function(){return b.createElement("div",{className:"AvailableOrganization"},b.createElement("div",{className:"AvailableOrganization-relatedCol"},this.renderRelated()),b.createElement("div",{className:"AvailableOrganization-orgCol"},b.createElement("div",{className:"AvailableOrganization-logoCol"},b.createElement(mt,{logoUrl:this.props.selectableOrganization.organization.logoUrl,size:30,organizationName:this.props.selectableOrganization.organization.name,organizationId:this.props.selectableOrganization.organization.id})),b.createElement("div",{className:"AvailableOrganization-orgInfoCol"},b.createElement("div",{className:"AvailableOrganization-name"},this.props.selectableOrganization.organization.name),b.createElement("div",{className:"AvailableOrganization-owner"},b.createElement(Qt,{username:this.props.selectableOrganization.organization.owner.username,avatarSize:20,showAvatar:!1})))),b.createElement("div",{className:"AvailableOrganization-actionCol"}))}}]),t}(b.Component)),Bn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onAddSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onAddOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"onRemoveSelectedOrganization",value:function(){this.props.selectedOrganization&&this.props.onRemoveOrganization(this.props.organization.id,this.props.selectedOrganization.organization.id)}},{key:"onFilterChange",value:function(e){e.persist(),this.props.onSearch(e.target.value)}},{key:"renderAvailableToolbar",value:function(){return b.createElement("div",{className:"ManageRelatedOrganizations-available-toolbar"},b.createElement(Dr.a,{placeholder:"Filter Available Organizations",onChange:this.onFilterChange.bind(this)}))}},{key:"renderAvailableOrgs",value:function(){var e=this;return this.props.organizations.map(function(t){var r=["simpleCard","ManageRelatedOrganizations-availableOrganization"];return t.isSelected&&r.push("ManageRelatedOrganizations-selected"),b.createElement("div",{className:r.join(" "),onClick:function(){e.props.onSelectOrganization(t)},key:t.organization.id},b.createElement(Pn,{selectableOrganization:t}))})}},{key:"renderSelectedOrg",value:function(){var e;if(this.props.selectedOrganization)return this.props.selectedOrganization.isRelated?(b.createElement(ut.a,{type:"warning",message:"This org is already associated"}),e=b.createElement(er.a,{type:"danger",disabled:null===this.props.selectedOrganization,onClick:this.onRemoveSelectedOrganization.bind(this)},"Remove Organization")):e=b.createElement(er.a,{type:"primary",disabled:null===this.props.selectedOrganization,onClick:this.onAddSelectedOrganization.bind(this)},"Add Organization"),b.createElement(b.Fragment,null,b.createElement("div",{className:"ManageRelatedOrganizations-selectedOrganization"},b.createElement(Kt,{organization:this.props.selectedOrganization.organization,openRequestsStatus:null})),b.createElement("div",{className:"ManageRelatedOrganizations-buttonBar"},e))}},{key:"render",value:function(){var e=this;return b.createElement("div",{className:"ManageRelatedOrganizations scrollable-flex-column"},b.createElement("div",{className:"ManageRelatedOrganizations-toolbar"},b.createElement(er.a,{onClick:function(){return e.props.onFinish()},type:"danger"},b.createElement(pt.a,{type:"rollback"})," ","Done")),b.createElement("div",{className:"ManageRelatedOrganizations-main scrollable-flex-column"},b.createElement("div",{className:"ManageRelatedOrganizations-availableOrgs"},b.createElement("h3",{style:{textAlign:"center"}},"Available Organizations"),this.renderAvailableToolbar(),b.createElement("div",{className:"ManageRelatedOrganizations-organizations"},this.renderAvailableOrgs())),b.createElement("div",{className:"ManageRelatedOrganizations-relatedOrgs"},b.createElement("h3",{style:{textAlign:"center"}},"Selected Organization"),this.renderSelectedOrg())))}}]),t}(b.Component);var xn=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.manageRelatedOrganizationsView.viewModel)throw new Error("argh, null subview view model");var n=r.subViews.manageRelatedOrganizationsView.viewModel;return{organization:n.organization,organizations:n.availableOrganizations.queried,relatedOrganizations:n.relatedOrganizations,selectedOrganization:n.selectedOrganization}},function(e){return{onSelectOrganization:function(t){e(function(e){return{type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SELECT_ORGANIZATION,selectedOrganization:e}}(t))},onAddOrganization:function(t,r){e(function(e,t){return function(){var r=Object(ie.a)(ae.a.mark(function r(n,a){var i,s,o,c,l,u;return ae.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new Ue({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=5,r.next=8,u.addRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_ADD_ORGANIZATION_ERROR,error:Le({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onRemoveOrganization:function(t,r){e(function(e,t){return function(){var r=Object(ie.a)(ae.a.mark(function r(n,a){var i,s,o,c,l,u;return ae.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,null!==i.views.viewOrgView.viewModel){r.next=4;break}throw new Error("view is not populated");case 4:return u=new Ue({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=5,r.next=8,u.removeRelatedOrganization({organizationId:e,relatedOrganizationId:t});case 8:n({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_SUCCESS,organizationId:t}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(5),n({type:F.VIEW_ORG_RELATED_ORGANIZATIONS_REMOVE_ORGANIZATION_ERROR,error:Le({code:"error",message:r.t0.message})});case 14:case"end":return r.stop()}},r,this,[[5,11]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},onSearch:function(t){var r;e((r=t,function(){var e=Object(ie.a)(ae.a.mark(function e(t,n){var a,i,s,o,c,l,u,E;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,null!==(l=a.views.viewOrgView.viewModel)){e.next=4;break}throw new Error("view is not populated");case 4:if(l.kind===f.NORMAL){e.next=6;break}throw new Error("view is not normal");case 6:if(null!==(u=l.subViews.manageRelatedOrganizationsView.viewModel)){e.next=9;break}throw new Error("vm is null");case 9:new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url});try{E=Pe(u.availableOrganizations.organizations,r),t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_SUCCESS,organizations:E,searchBy:r})}catch(d){t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_SEARCH_ERROR,error:Le({code:"error",message:d.message})})}case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()))}}})(Bn),Wn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading Related Organizations Manager..."," ",b.createElement(vr.a,null));return b.createElement(ut.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case N.NONE:case N.LOADING:return this.renderLoading();case N.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return b.createElement(xn,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case N.NONE:this.props.onLoad()}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var qn=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==f.NORMAL)throw new Error("not the right vm");return{view:r.subViews.manageRelatedOrganizationsView}},function(e){return{onLoad:function(){e(function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,s,o,c,l,u,E,d;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_START}),n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,null!==(c=n.views.viewOrgView.viewModel)){e.next=4;break}throw new Error("view is not populated");case 4:if(c.kind===f.NORMAL){e.next=6;break}throw new Error("view is not normal");case 6:return l=c.organization,u=new Ue({token:i,username:s,groupsServiceURL:o.services.Groups.url}),e.prev=8,e.next=11,u.getAllOrgs2();case 11:E=e.sent,d=E.map(function(e){return{isRelated:l.relatedOrganizations.includes(e.id),isSelected:!1,organization:e}}),t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_SUCCESS,organizations:d}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),t({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_LOAD_ERROR,error:Le({code:"error",message:e.t0.message})});case 19:case"end":return e.stop()}},e,this,[[8,16]])}));return function(t,r){return e.apply(this,arguments)}}())},onUnload:function(){e({type:F.VIEW_ORG_MANAGE_RELATED_ORGANIZATIONS_UNLOAD})}}})(Wn);function Hn(e){return{type:F.INVITE_USER_LOAD_ERROR,error:e}}function Fn(e){return{type:F.INVITE_USER_SEARCH_USERS_SUCCESS,users:e}}function Qn(e){return{type:F.INVITE_USER_SELECT_USER_ERROR,error:e}}function Zn(e,t){if(e.username===t.owner.username)return me.OWNER;var r=t.members.find(function(t){return t.username===e.username});if(r)switch(r.type){case l.ADMIN:return me.ADMIN;case l.OWNER:return me.OWNER;case l.MEMBER:return me.MEMBER}return me.VIEW}function Jn(e){var t=e.views.viewOrgView.viewModel;if(null===t)throw new Error("select user invalid state -- no view value");if(t.kind!==f.NORMAL)throw new Error("select user invalid state -- no view value");var r=t.subViews.inviteUserView;if(null===r)throw new Error("select user invalid state -- no view value");return r}function Yn(e){return{type:F.INVITE_USER_SEND_INVITATION_ERROR,error:e}}function Kn(){return function(e,t){e({type:F.INVITE_USER_SEND_INVITATION_START});var r,n=t();try{r=Jn(n)}catch(E){return void e(Qn(un({code:"invalid state",message:E.message})))}var a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config;if(null!==r.viewModel){var c=r.viewModel,l=c.selectedUser,u=c.organization.id;if(l)new we({token:i,username:s,groupsServiceURL:o.services.Groups.url}).inviteUserToJoinOrg(u,l.user.username).then(function(t){e({type:F.INVITE_USER_SEND_INVITATION_SUCCESS})}).catch(function(t){e(Yn(un({code:t.name,message:t.message})))})}else e(Yn(un({code:"error",message:"null view model"})))}}r(301),r(303);var Xn=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return b.createElement("div",{className:"User"},b.createElement("div",{className:"avatarCol"},b.createElement(St,{user:this.props.user,size:this.props.avatarSize||30})),b.createElement("div",{className:"infoCol"},b.createElement("div",{className:"name"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)," ","\u2768",this.props.user.username,"\u2769"),b.createElement("div",{className:"organization"},this.props.user.organization||b.createElement("i",null,"no organization in user profile")),b.createElement("div",{className:"location"},[this.props.user.city,this.props.user.state,this.props.user.country].filter(function(e){return e}).join(", ")||b.createElement("i",null,"no location information in user profile"))))}}]),t}(b.Component),$n=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).lastSearchAt=void 0,r.searchInput=void 0,r.searchButton=void 0,r.lastSearchAt=null,r.searchInput=b.createRef(),r.searchButton=b.createRef(),r.state={autocompleteMessage:""},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onClickCancelToViewer",value:function(){this.props.onFinish()}},{key:"onSendInvitation",value:function(){this.props.onSendInvitation()}},{key:"canSave",value:function(){return!!this.props.selectedUser}},{key:"onSubmit",value:function(e){var t;e.preventDefault(),t=this.searchInput.current?this.searchInput.current.value:"",this.doSearchUsers(t)}},{key:"onSearchInputChange",value:function(){this.searchInput.current&&this.searchInput.current.value}},{key:"doSearchUsers",value:function(e){(null===this.lastSearchAt||(new Date).getTime()-this.lastSearchAt.getTime()>t.searchDebounce)&&(this.lastSearchAt=new Date,this.props.onSearchUsers({query:e,excludedUsers:[]}))}},{key:"onSelectUser",value:function(e){this.props.onSelectUser(e.username)}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=b.createElement(b.Fragment,null,b.createElement("span",null,b.createElement(Et.a,{to:"/viewOrganization/".concat(this.props.organization.id)},b.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),b.createElement(pt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),b.createElement(pt.a,{type:"tool"})," ",b.createElement("span",{style:{fontSize:"120%"}},"Invite a User to Join Org"))),t=b.createElement(b.Fragment,null);return b.createElement(ar,{breadcrumbs:e,buttons:t})}},{key:"renderUsers",value:function(){var e=this;if(!this.props.users){return b.createElement(ut.a,{type:"info",message:"Search for users by name or username to display a list of available users in this space.",showIcon:!0})}return 0===this.props.users.length?b.createElement(ut.a,{type:"warning",message:"No users found",showIcon:!0}):this.props.users.map(function(t){return t.relation===me.NONE?b.createElement("div",{className:"user notInOrganization ",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},b.createElement("div",{className:"name "},t.realname," (",t.username,")")):b.createElement("div",{className:"user inOrganization",key:t.username,onClick:function(){e.onSelectUser.call(e,t)}},b.createElement("div",{className:"name "},t.realname," (",t.username,")"))})}},{key:"renderOrgInfo",value:function(){return b.createElement("div",{className:"orgInfo"},b.createElement("div",{className:"name"},b.createElement("span",{className:"field-label"},"name"),b.createElement("span",null,this.props.organization.name)),b.createElement("div",{className:"description"},b.createElement("span",{className:"field-label"},"description"),b.createElement("span",null,this.props.organization.description)))}},{key:"renderInvitationForm",value:function(){var e,t;return this.props.selectedUser?this.props.selectedUser.relation===me.VIEW?e=b.createElement(er.a,{type:"primary",onClick:this.onSendInvitation.bind(this)},"Send Invitation"):(e=b.createElement(er.a,{disabled:!0,type:"primary"},"Send Invitation"),t=b.createElement("div",null,"User may not be invited because:",b.createElement("br",null),this.renderRelation(this.props.selectedUser.relation)),t=b.createElement(ut.a,{type:"warning",message:t,showIcon:!0})):(e=b.createElement(er.a,{disabled:!0,type:"primary"},"Send Invitation"),t="Please select a user"),b.createElement("div",{className:"invitationForm"},b.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},e),b.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},t))}},{key:"renderInvitationStatus",value:function(){switch(this.props.editState){case w.NONE:return b.createElement("div",null,"NONE");case w.EDITING:return b.createElement("div",null,"EDITING");case w.SENDABLE:return b.createElement("div",null,"SENDABLE");case w.SENDING:return b.createElement("div",null,"SENDING");case w.SUCCESS:return b.createElement("div",null,"SENT SUCCESSFULLY");case w.ERROR:return b.createElement("div",null,"ERROR SENDING");default:return b.createElement("div",null,"Bad State")}}},{key:"renderRelation",value:function(e){switch(e){case me.NONE:return b.createElement("span",null,b.createElement(pt.a,{type:"stop"}),"None");case me.VIEW:return b.createElement("span",null,b.createElement(pt.a,{type:"stop"})," Not a member");case me.MEMBER_REQUEST_PENDING:return b.createElement("span",null,b.createElement(pt.a,{type:"user",style:{color:"orange"}})," User's membership ",b.createElement("b",null,"request")," is pending");case me.MEMBER_INVITATION_PENDING:return b.createElement("span",null,b.createElement(pt.a,{type:"user",style:{color:"blue"}})," User has been ",b.createElement("b",null,"invited")," to join");case me.MEMBER:return b.createElement("span",null,b.createElement(pt.a,{type:"user"})," User is a ",b.createElement("b",null,"member")," of this organization");case me.ADMIN:return b.createElement("span",null,b.createElement(pt.a,{type:"unlock"}),"User is an ",b.createElement("b",null,"admin")," of this organization");case me.OWNER:return b.createElement("span",null,b.createElement(pt.a,{type:"crown"})," User is the ",b.createElement("b",null,"owner")," of this Organization")}}},{key:"renderSelectedUser",value:function(){return null===this.props.selectedUser?b.createElement("div",{className:"selectedUser"},b.createElement("p",{className:"noSelection"},"No user yet selected")):b.createElement("div",{className:"selectedUser"},b.createElement(Xn,{user:this.props.selectedUser.user}),this.renderRelation(this.props.selectedUser.relation))}},{key:"renderFooter",value:function(){return b.createElement("div",{className:"footer"})}},{key:"renderSearchButton",value:function(){return b.createElement(pt.a,{type:"search"})}},{key:"renderMenuButtons",value:function(){return b.createElement("div",{className:"ButtonSet"},b.createElement("div",{className:"ButtonSet-button"},b.createElement(er.a,{icon:"rollback",type:"danger",onClick:this.onClickCancelToViewer.bind(this)},"Done")))}},{key:"render",value:function(){return b.createElement("div",{className:"InviteUser scrollable-flex-column"},b.createElement(sr,{buttons:this.renderMenuButtons()}),b.createElement("div",{className:"row scrollable-flex-column"},b.createElement("div",{className:"col1 firstCol users scrollable-flex-column"},b.createElement("h3",null,"Select User to Invite"),b.createElement("form",{id:"searchForm",className:"searchBar",onSubmit:this.onSubmit.bind(this)},b.createElement("input",{ref:this.searchInput,autoFocus:!0,onChange:this.onSearchInputChange.bind(this),placeholder:"Search for a user"}),b.createElement(er.a,{className:"searchButton",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchButton())),b.createElement("div",{className:"usersTable"},this.renderUsers())),b.createElement("div",{className:"col1 lastCol"},b.createElement("h3",null,"Selected User"),this.renderSelectedUser(),this.renderInvitationForm())),this.renderFooter())}}]),t}(b.Component);$n.searchDebounce=200;var ea=$n;var ta=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");if(null===r.subViews.inviteUserView.viewModel)throw new Error("argh, null subview view model");return r.subViews.inviteUserView.viewModel},function(e){return{onSearchUsers:function(t){var r=t.query,n=t.excludedUsers;e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,u,E,d,v,m,O,p,R,h;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.INVITE_USER_SEARCH_USERS_START}),0!==e.query.length){t.next=4;break}return r(Fn(null)),t.abrupt("return");case 4:if(a=n(),i=a.auth.authorization,s=i.token,i.username,o=a.app.config,null!==(c=a.views.viewOrgView.viewModel)){t.next=7;break}throw new Error("view is not populated");case 7:if(c.kind===f.NORMAL){t.next=9;break}throw new Error("view is not normal");case 9:return u=c.organization,E=new yt({token:s,userProfileServiceURL:o.services.UserProfile.url}),d=u.owner.username,v=[],m=[],O=[],p=[],u.members.forEach(function(e){switch(e.type){case l.MEMBER:m.push(e.username);case l.ADMIN:v.push(e.username)}}),t.prev=17,t.next=20,E.searchUsers(e);case 20:R=t.sent,h=R.map(function(e){var t=e.username;return{username:t,realname:e.realname,relation:t===d?me.OWNER:v.indexOf(t)>=0?me.ADMIN:O.indexOf(t)>=0?me.MEMBER_INVITATION_PENDING:p.indexOf(t)>=0?me.MEMBER_REQUEST_PENDING:m.indexOf(t)>=0?me.MEMBER:me.NONE}}),r(Fn(h)),t.next=28;break;case 25:t.prev=25,t.t0=t.catch(17),r((w=un({code:t.t0.name,message:t.t0.message}),{type:F.INVITE_USER_SEARCH_USERS_ERROR,error:w}));case 28:case"end":return t.stop()}var w},t,this,[[17,25]])}));return function(e,r){return t.apply(this,arguments)}}()}({query:r,excludedUsers:n}))},onSelectUser:function(t){var r;e((r=t,function(){var e=Object(ie.a)(ae.a.mark(function e(t,n){var a,i,s,o,c,l,u;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:F.INVITE_USER_SELECT_USER_START}),a=n(),e.prev=2,i=Jn(a),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),t(Qn(un({code:"invalid state",message:e.t0.message}))),e.abrupt("return");case 10:if(null!==i.viewModel){e.next=13;break}return t(Qn(un({code:"error",message:"missing view model"}))),e.abrupt("return");case 13:return s=a.auth.authorization.token,o=a.app.config,c=new yt({token:s,userProfileServiceURL:o.services.UserProfile.url}),e.prev=15,e.next=18,c.getUser(r);case 18:l=e.sent,u=Zn(l,i.viewModel.organization),t((E=l,d=u,{type:F.INVITE_USER_SELECT_USER_SUCCESS,user:E,relation:d})),e.next=26;break;case 23:e.prev=23,e.t1=e.catch(15),t(Qn(un({code:e.t1.name,message:e.t1.message})));case 26:case"end":return e.stop()}var E,d},e,this,[[2,6],[15,23]])}));return function(t,r){return e.apply(this,arguments)}}()))},onSendInvitation:function(){e(Kn())}}})(ea),ra=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading ..."," ",b.createElement(vr.a,null));return b.createElement(ut.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.state){case N.NONE:case N.LOADING:return this.renderLoading();case N.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(un({code:"Missing Error",message:"The error appears to be missing"}));default:return b.createElement(ta,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.state){case N.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var na=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(null===r)throw new Error("vm is null");if(r.kind!==f.NORMAL)throw new Error("not the right vm");return{view:r.subViews.inviteUserView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.INVITE_USER_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=3,t.next=6,l.getOrg(e);case 6:if((u=t.sent).kind===Re.NORMAL){t.next=10;break}return r(Hn(un({code:"invalid state",message:'Organization kind must be "NORMAL"'}))),t.abrupt("return");case 10:r((E=u,{type:F.INVITE_USER_LOAD_SUCCESS,organization:E,users:null})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),r(Hn(un({code:t.t0.name,message:t.t0.message})));case 16:case"end":return t.stop()}var E},t,this,[[3,13]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:F.INVITE_USER_UNLOAD})}}})(ra),aa=(r(305),r(351)),ia=(r(307),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){var e=b.createElement("div",null,b.createElement("div",null,this.props.user.realname),b.createElement("div",null,b.createElement("span",null,b.createElement(St,{user:this.props.user,size:20}))," ",b.createElement("span",null,this.props.user.username)));return b.createElement("div",{className:"UserSimple"},b.createElement(Ot.a,{title:e,placement:"bottomRight"},b.createElement("a",{href:"/#people/"+this.props.user.username,target:"_blank"},this.props.user.realname)))}}]),t}(b.Component)),sa=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.user?b.createElement(ia,{user:this.props.user,avatarSize:this.props.avatarSize}):b.createElement("div",null,"Loading user...")}},{key:"componentDidMount",value:function(){this.props.user||this.props.onLoad(this.props.userId)}}]),t}(b.Component);var oa,ca=Object(P.b)(function(e,t){return{user:e.entities.users.byId.get(t.userId)}},function(e){return{onLoad:function(t){e(qt(t))}}})(sa);r(309);function la(e){switch(e){case oa.COMPACT:return oa.NORMAL;case oa.NORMAL:return oa.COMPACT}}!function(e){e[e.COMPACT=0]="COMPACT",e[e.NORMAL=1]="NORMAL"}(oa||(oa={}));var ua=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={view:oa.COMPACT},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onToggleView",value:function(){this.setState({view:la(this.state.view)})}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement(Ot.a,{title:"This narrative is viewable by all KBase users",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(pt.a,{type:"global"})," Public Narrative")):b.createElement(Ot.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(pt.a,{type:"lock"})," Private Narrative"))}},{key:"renderUserPermission",value:function(e){var t,r;switch(e.access){case Gt.VIEW:t="eye",r=b.createElement("span",null,"View-Only (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.EDIT:t="edit",r=b.createElement("span",null,"This narrative is shared with you with ",b.createElement("b",null,"edit")," access (",b.createElement("i",null,"visit narrative to request additional access"),")");break;case Gt.ADMIN:t="unlock",r=b.createElement("span",null,"This narrative is shared with you with ",b.createElement("b",null,"access")," - you may edit and re-share this");break;case Gt.OWNER:t="crown",r=b.createElement("span",null,"You are the owner of this Narrative")}return b.createElement(Ot.a,{placement:"bottomRight",title:r},b.createElement(pt.a,{type:t}))}},{key:"renderGlobalPermission",value:function(e){var t,r;return e.isPublic?(t="global",r="This narrative has been shared publicly - with all KBase users"):(t="lock",r="This narrative is private - only accessible to the owner any users it has been shared with"),b.createElement(Ot.a,{placement:"bottomRight",title:r},b.createElement(pt.a,{type:t}))}},{key:"renderNiceElapsed",value:function(e){var t=b.createElement("span",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e));return b.createElement(Ot.a,{placement:"bottomRight",title:t},Zt(e))}},{key:"renderCompact",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===oa.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===oa.NORMAL?"up":"down")}))),b.createElement("div",{className:"mainCol"},b.createElement("div",null,b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",b.createElement("div",{className:"Narrative-owner"},b.createElement(ca,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),b.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),b.createElement("div",null,b.createElement("span",{className:"field-label"},"updated"),b.createElement(Jt,{time:e.lastSavedAt}))))}},{key:"renderNormal",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"controlCol"},b.createElement("a",{onClick:this.onToggleView.bind(this),className:"linkButton ".concat(this.state.view===oa.NORMAL?"pressed":"")},b.createElement(pt.a,{type:"".concat(this.state.view===oa.NORMAL?"up":"down")}))),b.createElement("div",{className:"mainCol"},b.createElement("div",null,b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",b.createElement("div",{className:"Narrative-owner"},b.createElement(ca,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),b.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),b.createElement("div",null,b.createElement("span",{className:"field-label"},"last saved"),this.renderNiceElapsed(e.lastSavedAt)),b.createElement("div",null,b.createElement("span",{className:"field-label"},"by"),b.createElement(ca,{avatarSize:20,userId:e.lastSavedBy}))))}},{key:"renderNarrative",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"mainCol"},b.createElement("div",null,b.createElement("div",{className:"Narrative-title"},b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},e.title)),", ",b.createElement("div",{className:"Narrative-owner"},b.createElement(ca,{avatarSize:20,userId:e.owner}))),b.createElement("div",{className:"Narrative-attributes"},b.createElement("div",{className:"Narrative-userPermission"},this.renderUserPermission(e)),b.createElement("div",{className:"Narrative-global"},this.renderGlobalPermission(e))),b.createElement("div",null,b.createElement("span",{className:"field-label"},b.createElement(pt.a,{type:"save"})),b.createElement(Jt,{time:e.lastSavedAt,tooltipPrefix:"last saved "}))))}},{key:"render",value:function(){var e=this.props.narrative;return e.access===Gt.NONE?b.createElement("div",null,"You don't have access to this Narrative"):this.renderNarrative(e)}}]),t}(b.Component),Ea=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return this.props.narrative?b.createElement(ua,{narrative:this.props.narrative}):b.createElement("div",null,"Loading narrative...")}},{key:"componentDidMount",value:function(){this.props.narrative||this.props.onLoad(this.props.workspaceId)}}]),t}(b.Component);var da=Object(P.b)(function(e,t){return{narrative:e.entities.narratives.byId.get(t.workspaceId)||null}},function(e){return{onLoad:function(t){e(Ht(t))}}})(Ea),va=(r(311),function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={requestAccess:!1},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onGetViewAccess",value:function(){this.props.onGetViewAccess(this.props.narrative)}},{key:"onRequestAccess",value:function(){this.setState({requestAccess:!0})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:!1})}},{key:"renderNarrativePermission",value:function(e){var t,r,n,a,i=this;switch(e.permission){case pe.NONE:e.isPublic?(n="You have View access to this narrative narrative because it is shared publicly; you may view it, but not edit, run, or share it",t=b.createElement("span",null,"View Only (public)"),a="Although you have View-Only access to this Narrative due to it being shared globally, you may obtain personal View-Only access by clicking this button",r=b.createElement(er.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access")):(n="You have No access to this narrative narrative; you may not view, edit, run, or share it",t=b.createElement("span",null,"No Access"),a="You cannot access this Narrative; in order to immediately obtain View-Only access click this button.",r=b.createElement(er.a,{size:"small",onClick:function(){i.onGetViewAccess.call(i)}},"Click for View Access"));break;case pe.VIEW:n="You have View access to this narrative narrative; you may view it, but not edit, run, or share it",t=b.createElement("span",null,"View Only"),a="You already have View-Only access to this Narrative, but may request additional access",r=b.createElement(er.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Additional Access");break;case pe.EDIT:n="You have Edit access to this Narrative; you may view, edit, and run, but not share it",t=b.createElement("span",null,"Edit"),a="You already have Edit access to this Narrative, but may request additional access by clicking this button",r=b.createElement(er.a,{size:"small",onClick:function(){i.onRequestAccess.call(i)}},"Request Admin Access");break;case pe.ADMIN:n="You have Admin access to this narrative narrative; you may view, edit, run, and share it",t=b.createElement("span",null,"Admin");break;case pe.OWNER:n="You are the Owner of this narrative; you may view, edit, run, and share it",t=b.createElement("span",null,"Owner");break;default:t=b.createElement("span",null,"Unknown")}return b.createElement(b.Fragment,null,b.createElement(Ot.a,{title:n,placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement("span",{className:"field-label"},"your permission"),t))," ",b.createElement(Ot.a,{title:a,placement:"right"},r))}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement(Ot.a,{title:"This narrative is viewable by all KBase users",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(pt.a,{type:"global"})," Public Narrative")):b.createElement(Ot.a,{title:"This narrative is only accessible to those with whom it is directly shared",placement:"right"},b.createElement("span",{style:{cursor:"help"}},b.createElement(pt.a,{type:"lock"})," Private Narrative"))}},{key:"renderNarrative",value:function(){var e=this.props.narrative;return this.props.organization.isMember&&e.permission===pe.NONE?b.createElement(b.Fragment,null,b.createElement("a",{href:"/narrative/"+e.workspaceId,target:"_blank"},b.createElement("div",{className:"title"},e.title)),b.createElement("div",null,this.renderNarrativePermission(e))):b.createElement(da,{workspaceId:e.workspaceId})}},{key:"renderResource",value:function(){return b.createElement("div",null,b.createElement("div",null,b.createElement("span",{className:"field-label"},"added"),b.createElement("span",null,b.createElement(Jt,{time:this.props.narrative.createdAt}))))}},{key:"render",value:function(){var e,t=this;return this.state.requestAccess&&(e=b.createElement(aa.a,{title:"Request Access to Narrative",placement:"right",closable:!0,visible:!0,onClose:function(){t.onCloseRequestAccess.call(t)}},"Requesting access...")),b.createElement("div",{className:"OrganizationNarrative"},b.createElement("div",{className:"OrganizationNarrative-narrativeCol"},this.renderNarrative()),e)}}]),t}(b.Component)),ma=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onRequestAddNarrative",value:function(){this.props.onRequestAddNarrative()}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"renderNarrativeMenu",value:function(e){var t,r=this;switch(this.props.relation.type){case me.NONE:break;case me.VIEW:case me.MEMBER_REQUEST_PENDING:case me.MEMBER_INVITATION_PENDING:case me.MEMBER:break;case me.ADMIN:case me.OWNER:t=b.createElement(ht.a,{onClick:function(t){var n=t.key;r.onNarrativeMenu(n,e)}},b.createElement(ht.a.Item,{key:"removeNarrative"},b.createElement(pt.a,{type:"delete"})," Remove Narrative from Organization"))}if(t)return b.createElement(wt.a,{overlay:t,trigger:["click"]},b.createElement(pt.a,{type:"ellipsis",className:"IconButton-hover"}))}},{key:"renderSearchBar",value:function(){var e=this;return b.createElement("div",{style:{paddingRight:"6px"}},b.createElement(Dr.a,{style:{width:"100%",marginRight:"6px"},placeholder:"Filter narratives by title",onChange:function(t){e.props.onSearchNarratives(t.target.value)}}))}},{key:"renderSortBar",value:function(){var e=this;return b.createElement(b.Fragment,null,b.createElement("span",{className:"field-label"},"sort"),b.createElement(tr.a,{onChange:function(t){e.props.onSortNarratives(t)},style:{width:"11em"},dropdownMatchSelectWidth:!0,defaultValue:this.props.sortNarrativesBy},b.createElement(tr.a.Option,{value:"name",key:"name"},"Name"),b.createElement(tr.a.Option,{value:"added",key:"added"},"Date Added"),b.createElement(tr.a.Option,{value:"changed",key:"changed"},"Last Changed")))}},{key:"renderMemberNarratives",value:function(){var e,t=this,r=[b.createElement(er.a,{key:"addNarrative",onClick:this.onRequestAddNarrative.bind(this)},b.createElement(pt.a,{type:"plus"})," Add a Narrative")];e=0===this.props.narratives.length?b.createElement(ut.a,{type:"info",message:"No Narratives are yet associated with this Organization"}):this.props.narratives.map(function(e){var r=t.props.organization.lastVisitedAt,n=e.addedAt,a=["narrative","simpleCard"];return null!==r&&(null!==n&&r.getTime()<n.getTime())&&a.push("ViewOrganization-newNarrative"),b.createElement("div",{className:a.join(" "),key:String(e.workspaceId)},b.createElement("div",{className:"dataCol"},b.createElement(va,{narrative:e,organization:t.props.organization,onGetViewAccess:t.props.onGetViewAccess})),b.createElement("div",{className:"buttonCol"},t.renderNarrativeMenu(e)))});var n=this.props.organization.narrativeCount,a=b.createElement("span",{className:"ViewOrganization-narrativesTitle"},b.createElement(pt.a,{type:"folder-open",style:{marginRight:"8px"}}),"Narratives"," ",b.createElement("span",{className:"titleCount"},"(",n,")"));return b.createElement("div",{className:"ViewOrganization-narratives scrollable-flex-column"},b.createElement("div",{className:"ViewOrganization-narrativesHeader"},b.createElement("div",{className:"ViewOrganization-narrativesHeaderCol1"},a),b.createElement("div",{className:"ViewOrganization-narrativesHeaderCol2"},r)),b.createElement("div",{className:"ViewOrganization-narratives-toolbar"},b.createElement("div",{className:"ViewOrganization-narratives-toolbar-searchCol"},this.renderSearchBar()),b.createElement("div",{className:"ViewOrganization-narratives-toolbar-sortCol"},this.renderSortBar())),b.createElement("div",{className:"ViewOrganization-narrativesList"},b.createElement("div",{className:"narrativesTable"},e)))}},{key:"renderNonMemberNarratives",value:function(){var e,t,r=this,n=this.props.organization.narratives.length,a=this.props.organization.narrativeCount-this.props.organization.narratives.length,i={marginBottom:"10px"};if(n){if(a){var s=b.createElement(b.Fragment,null,b.createElement("p",null,"Since you are not a member of this Organization, only public Narratives are displayed."),b.createElement("p",null,a," private Narrative",1!==a?"s have ":" has "," been hidden."));e=b.createElement(ut.a,{type:"info",message:s,style:i})}}else if(a){var o=b.createElement(b.Fragment,null,b.createElement("p",null,"Since you are not a member of this Organization, only public Narratives would be displayed, but this Organization has none."),b.createElement("p",null,a," private Narrative",1!==a?"s have ":" has "," been hidden."));e=b.createElement(ut.a,{type:"info",message:o,style:i})}else e=b.createElement(ut.a,{type:"info",message:"No Narratives are yet associated with this Organization",style:i});n&&(t=this.props.narratives.map(function(e){return b.createElement("div",{className:"narrative simpleCard",key:String(e.workspaceId)},b.createElement("div",{className:"dataCol"},b.createElement(va,{narrative:e,organization:r.props.organization,onGetViewAccess:r.props.onGetViewAccess})),b.createElement("div",{className:"buttonCol"},r.renderNarrativeMenu(e)))}));var c=b.createElement("span",{className:"ViewOrganization-narrativesTitle"},b.createElement(pt.a,{type:"folder-open",style:{marginRight:"8px"}}),"Narratives"," ",b.createElement("span",{className:"titleCount"},"(",this.props.organization.narrativeCount,")"));return b.createElement("div",{className:"ViewOrganization-narratives scrollable-flex-column"},b.createElement("div",{className:"ViewOrganization-narrativesHeader"},b.createElement("div",{className:"ViewOrganization-narrativesHeaderCol1"},c),b.createElement("div",{className:"ViewOrganization-narrativesHeaderCol2"})),b.createElement("div",{className:"ViewOrganization-narratives-toolbar"},b.createElement("div",{className:"ViewOrganization-narratives-toolbar-searchCol"},this.renderSearchBar()),b.createElement("div",{className:"ViewOrganization-narratives-toolbar-sortCol"},this.renderSortBar())),b.createElement("div",{className:"ViewOrganization-narrativesList"},b.createElement("div",{className:"narrativesTable"},e,t)))}},{key:"render",value:function(){return this.props.organization.isMember?this.renderMemberNarratives():this.renderNonMemberNarratives()}}]),t}(b.Component);function Oa(e){return{type:F.MANAGE_MEMBERSHIP_LOAD_ERROR,error:e}}function pa(){return function(e,t){var r=t();if(!r.views.manageMembershipView.viewModel)throw new Error("Argh, no view model");r.views.manageMembershipView.viewModel.editableMemberProfile.title.validationState.type===o.OK?e({type:F.MANAGE_MEMBERSHIP_EVALUATE_SUCCESS}):e({type:F.MANAGE_MEMBERSHIP_EVALUATE_ERROR})}}r(313);var Ra=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"doLeaveOrg",value:function(){var e=this,t=function(){e.doLeaveOrgConfirmed()}.bind(this);Rt.a.confirm({title:"Really leave this organization?",content:b.createElement("p",null,"This is not reversible."),width:"50em",onOk:function(){t()}})}},{key:"onDone",value:function(){this.props.onFinish()}},{key:"doLeaveOrgConfirmed",value:function(){this.props.onLeaveOrganization(this.props.organization.id)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onSave()}},{key:"onTitleChange",value:function(e){e.persist(),this.props.onUpdateTitle(e.target.value)}},{key:"doShowInfo",value:function(){Rt.a.info({title:"Manage My Membership Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the view to help you manage your membership..."))})}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderHeader",value:function(){var e=b.createElement(b.Fragment,null,b.createElement("span",null,b.createElement(Et.a,{to:"/viewOrganization/".concat(this.props.organization.id)},b.createElement("span",{style:{fontWeight:"bold"}},this.renderOrgName(this.props.organization.name))),b.createElement(pt.a,{type:"right",style:{verticalAlign:"middle",marginLeft:"4px",marginRight:"4px"}}),b.createElement(pt.a,{type:"user"})," ",b.createElement("span",{style:{fontSize:"120%"}},"Manage your membership"))),t=b.createElement(b.Fragment,null,b.createElement(er.a,{type:"danger",icon:"frown",onClick:this.doLeaveOrg.bind(this)},"Leave Organization..."));return b.createElement(ar,{breadcrumbs:e,buttons:t})}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"ManageMembership-validation-error"}switch(e.syncState){case i.DIRTY:return"ManageMembership-sync-dirty";default:return"ManageMembership-validation-ok"}}},{key:"renderEditor",value:function(){return b.createElement("form",{id:"editMembership",className:"ManageMembership-editorTable",onSubmit:this.onSubmit.bind(this)},b.createElement("div",{className:"ManageMembership-headerRow"},b.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Edit"),b.createElement("div",{className:"ManageMembership-editCol ManageMembership-headerCol"},"Preview")),b.createElement("div",{className:"ManageMembership-editorTable-row"},b.createElement("div",{className:"ManageMembership-editCol ManageMembership-editCell"},b.createElement("div",{className:"ManageMembership-editorTable-labelCol"},b.createElement("span",{className:"field-label ManageMembership-titleLabel"},"title")),b.createElement("div",{className:"ManageMembership-editorTable-controlCol"},b.createElement(Dr.a,{value:this.props.editableMemberProfile.title.value||"",className:this.calcFieldClass(this.props.editableMemberProfile.title),onChange:this.onTitleChange.bind(this)}))),b.createElement("div",{className:"ManageMembership-previewCol ManageMembership-previewCell"},b.createElement("div",{className:"ManageMembership-titlePreview"},this.props.editableMemberProfile.title.value))),b.createElement("div",{className:"ManageMembership-editorFooter"},b.createElement(er.a,{icon:"save",form:"editMembership",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")))}},{key:"renderMenuButtons",value:function(){return b.createElement("div",{className:"ButtonSet"},b.createElement("div",{className:"ButtonSet-button"},b.createElement(er.a,{icon:"rollback",type:"danger",onClick:this.onDone.bind(this)},"Done")))}},{key:"render",value:function(){return b.createElement("div",{className:"ManageMembership scrollable-flex-column"},b.createElement(sr,{buttons:this.renderMenuButtons()}),b.createElement("h3",null,"Edit Your Membership Profile"),b.createElement("div",{className:"ManageMembership-body"},this.renderEditor()))}}]),t}(b.Component);var ha=Object(P.b)(function(e,t){if(!e.views.manageMembershipView.viewModel)throw new Error("View model missing");var r=e.auth.authorization.username,n=e.views.manageMembershipView.viewModel;return{username:r,organization:n.organization,editableMemberProfile:n.editableMemberProfile,editState:n.editState,saveState:n.saveState,validationState:n.validationState}},function(e){return{onLeaveOrganization:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r({type:F.MANAGE_MEMBERSHIP_LEAVE_ORG_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url});try{l.removeMember(e,o),r({type:F.MANAGE_MEMBERSHIP_LEAVE_ORG_SUCCESS})}catch(u){console.error("ERROR leaving org",u),r({type:F.MANAGE_MEMBERSHIP_LEAVE_ORG_ERROR,error:{code:u.name,message:u.message}})}case 4:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUpdateTitle:function(t){e(function(e){return function(t){var r=_e.validateMemberTitle(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.MANAGE_MEMBERSHIP_UPDATE_TITLE_ERROR,error:un({code:"invalid",message:i.message})}):t({type:F.MANAGE_MEMBERSHIP_UPDATE_TITLE_SUCCESS,title:a}),t(pa())}}(t))},onSave:function(){e(function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,s,o,c,l,u,E,d;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:F.MANAGE_MEMBERSHIP_SAVE_START}),(n=r()).views.manageMembershipView.viewModel){e.next=4;break}throw new Error("Argh, no view model?!?");case 4:return a=n.auth.authorization,i=a.token,s=a.username,o=n.views.manageMembershipView.viewModel,c=o.organization,l=o.editableMemberProfile,u=n.app.config,E={title:l.title.value},d=new Ue({token:i,username:s,groupsServiceURL:u.services.Groups.url}),e.prev=7,e.next=10,d.updateMember(c.id,s,E);case 10:t({type:F.MANAGE_MEMBERSHIP_SAVE_SUCCESS}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(7),console.error("error saving member profile",e.t0),t({type:F.MANAGE_MEMBERSHIP_SAVE_ERROR,error:un({code:"error",message:e.t0.message})});case 17:t(pa());case 18:case"end":return e.stop()}},e,this,[[7,13]])}));return function(t,r){return e.apply(this,arguments)}}())}}})(Ra),wa=r(346),_a=(r(315),function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderDetail",value:function(){return b.createElement("table",{className:"errorTable"},b.createElement("tbody",null,b.createElement("tr",null,b.createElement("th",null,b.createElement("span",{className:"field-label"},"generated at")),b.createElement("td",null,Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(this.props.error.at))),b.createElement("tr",null,b.createElement("th",null,b.createElement("span",{className:"field-label"},"error id")),b.createElement("td",null,b.createElement("span",{style:{fontFamily:"monospace"}},this.props.error.id))),b.createElement("tr",null,b.createElement("th",null,b.createElement("span",{className:"field-label"},"explanation")),b.createElement("td",null,this.props.error.detail))))}},{key:"renderInfo",value:function(){return this.props.error.info?b.createElement("div",null,"additional info here ..."):b.createElement("div",{style:{textAlign:"left",fontStyle:"italic"}},"No additional information")}},{key:"render",value:function(){var e=b.createElement("div",null,b.createElement("p",null,this.props.error.message),b.createElement(wa.a,{bordered:!1,style:{backgroundColor:"transparent"}},b.createElement(wa.a.Panel,{header:"detail",key:"1",style:{backgroundColor:"transparent"}},this.renderDetail())),b.createElement(wa.a,{bordered:!1,style:{backgroundColor:"transparent"}},b.createElement(wa.a.Panel,{header:"additional info",key:"1",style:{backgroundColor:"transparent"}},this.renderInfo())));return b.createElement(ut.a,{type:"error",showIcon:!0,message:"Error",className:"Error",description:e})}}]),t}(b.Component)),ga=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading ..."," ",b.createElement(vr.a,null));return b.createElement(ut.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return b.createElement(_a,{error:e})}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError(Le({code:"missing-error",message:"The error appears to be missing"}));default:return b.createElement(ha,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var Sa=Object(P.b)(function(e,t){return{view:e.views.manageMembershipView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,s,c,l,u,E,d,v,m;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.MANAGE_MEMBERSHIP_LOAD_START}),a=n(),s=a.auth.authorization,c=s.token,l=s.username,u=a.app.config,E=new Ue({token:c,username:l,groupsServiceURL:u.services.Groups.url}),t.prev=3,t.next=6,E.getOrg(e);case 6:if((d=t.sent).kind===Re.NORMAL){t.next=10;break}return r(Oa(un({code:"invalid state",message:'Organization must be of kind "NORMAL"'}))),t.abrupt("return");case 10:if(d.isMember){t.next=13;break}return r(Oa(un({code:"notfound",message:'The user "'+l+'" is not a member of this org'}))),t.abrupt("return");case 13:if((v=d.members.find(function(e){return e.username===l}))||d.owner.username===l&&(v=d.owner),v){t.next=18;break}return r(Oa(un({code:"notfound",message:'The user "'+l+'" was not found in the members list'}))),t.abrupt("return");case 18:m={title:{value:v.title||"",remoteValue:v.title,syncState:i.NEW,validationState:{type:o.OK,validatedAt:new Date}}},r((O=d,p=m,{type:F.MANAGE_MEMBERSHIP_LOAD_SUCCESS,organization:O,editableMemberProfile:p})),t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),console.error("Error :(",t.t0),r(Oa(un({code:t.t0.name,message:t.t0.message})));case 26:case"end":return t.stop()}var O,p},t,this,[[3,22]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:F.MANAGE_MEMBERSHIP_UNLOAD})}}})(ga);function fa(){return{type:F.EDIT_ORG_EVALUATE_ERRORS}}function Aa(e){return{type:F.EDIT_ORG_SAVE_ERROR,error:e}}function Na(e){return function(t,r){t({type:F.EDIT_ORG_LOAD_START});var n=r(),a=n.auth.authorization,s=a.token,c=a.username,l=n.app.config;return new Ue({token:s,username:c,groupsServiceURL:l.services.Groups.url}).getOrg(e).then(function(e){if(e.kind!==Re.NORMAL)throw new Error("May not edit an inaccessible private org!");var r,n,a={id:{value:e.id,remoteValue:e.id,syncState:i.NEW,validationState:_e.validateOrgId(e.id)[1]},name:{value:e.name,remoteValue:e.name,syncState:i.NEW,validationState:_e.validateOrgName(e.name)[1]},logoUrl:{value:e.logoUrl,remoteValue:e.logoUrl,syncState:i.NEW,validationState:_e.validateOrgLogoUrl(e.logoUrl)[1]},homeUrl:{value:e.homeUrl,remoteValue:e.homeUrl,syncState:i.NEW,validationState:_e.validateOrgHomeUrl(e.homeUrl)[1]},researchInterests:{value:e.researchInterests,remoteValue:e.researchInterests,syncState:i.NEW,validationState:_e.validateOrgResearchInterests(e.researchInterests)[1]},description:{value:e.description,remoteValue:e.description,syncState:i.NEW,validationState:_e.validateOrgDescription(e.description)[1]},isPrivate:{value:e.isPrivate,remoteValue:e.isPrivate,syncState:i.NEW,validationState:{type:o.OK,validatedAt:new Date}}};t((r=a,n=e,{type:F.EDIT_ORG_LOAD_SUCCESS,editedOrganization:r,organization:n}))}).catch(function(e){var r;console.error("load org error",e),t((r={code:e.name,message:e.message},{type:F.EDIT_ORG_LOAD_ERROR,error:r}))})}}function Ia(){return function(e,t){e({type:F.EDIT_ORG_SAVE_START});var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.auth.authorization,a=n.token,i=n.username,s=r.views.editOrgView.viewModel,o=s.organization,c=s.editedOrganization,l=r.app.config,u=new Ue({token:a,username:i,groupsServiceURL:l.services.Groups.url});if(c){var E={name:c.name.value,logoUrl:c.logoUrl.value,description:c.description.value,isPrivate:c.isPrivate.value,homeUrl:c.homeUrl.value,researchInterests:c.researchInterests.value};u.updateOrg(o.id,E).then(function(){e({type:F.EDIT_ORG_SAVE_SUCCESS})}).catch(function(t){console.error("error adding",c,t),e(Aa({code:"invalid",message:t.message}))})}else e(Aa({code:"app",message:"The new organization data does not yet exist"}))}}function ba(){return function(e,t){var r=t();if(!r.views.editOrgView.viewModel)throw new Error("Argh, no view model");var n=r.views.editOrgView.viewModel.editedOrganization;n&&n.name.validationState.type===o.OK&&n.logoUrl.validationState.type===o.OK&&n.homeUrl.validationState.type===o.OK&&n.researchInterests.validationState.type===o.OK&&n.description.validationState.type===o.OK?e({type:F.EDIT_ORG_EVALUATE_OK}):e(fa())}}function Ta(e){return function(t){var r=_e.validateOrgName(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:F.EDIT_ORG_UPDATE_NAME_ERROR,name:e,error:t}}(a,i)):t(function(e){return{type:F.EDIT_ORG_UPDATE_NAME_SUCCESS,name:e}}(a)),t(ba())}}function ya(e){return function(t){var r=_e.validateOrgLogoUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t(function(e,t){return{type:F.EDIT_ORG_UPDATE_LOGO_URL_ERROR,logoUrl:e,error:t}}(a,i)):t(function(e){return{type:F.EDIT_ORG_UPDATE_LOGO_URL_SUCCESS,logoUrl:e}}(a)),t(ba())}}function Ma(e){return function(t,r){var n=r(),a=n.auth.authorization,i=a.token,s=a.username,c=n.app.config,l=(new Ue({token:i,username:s,groupsServiceURL:c.services.Groups.url}),_e.validateOrgDescription(e)),u=Object(se.a)(l,2),E=u[0],d=u[1];d.type!==o.OK?t(function(e,t){return{type:F.EDIT_ORG_UPDATE_DESCRIPTION_ERROR,description:e,error:t}}(E,d)):t(function(e){return{type:F.EDIT_ORG_UPDATE_DESCRIPTION_SUCCESS,description:e}}(E)),t(ba())}}var Ca;r(318);!function(e){e[e.NONE=0]="NONE",e[e.BROWSER=1]="BROWSER",e[e.VIEWER=2]="VIEWER"}(Ca||(Ca={}));var Da=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).origin=void 0,r.state={cancelToBrowser:!1,cancelToViewer:!1,navigateTo:Ca.NONE},r.origin=document.location.origin,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onFinish",value:function(){this.props.onFinish()}},{key:"onShowInfo",value:function(){Rt.a.info({title:"Organization Editor Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This is the organizations editor..."))})}},{key:"onClickCancelToBrowser",value:function(){var e=this;if(this.isModified()){Rt.a.confirm({title:"Leave the editor?",content:b.createElement("div",null,b.createElement("p",null,"You have made changes on this edit form."),b.createElement("p",null,"If you leave the editor without saving, any ",b.createElement("i",null,"changes they will be lost"),"."),b.createElement("p",null,b.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToBrowser:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToBrowser:!0})}},{key:"onClickCancelToViewer",value:function(){var e=this;if(this.isModified()){Rt.a.confirm({title:"Leave the editor?",content:b.createElement("div",null,b.createElement("p",null,"You have made changes on this edit form."),b.createElement("p",null,"If you leave the editor without saving, any ",b.createElement("i",null,"changes they will be lost"),"."),b.createElement("p",null,b.createElement("b",null,"Continue to leave the editor?"))),onOk:function(){e.setState({cancelToViewer:!0})},onCancel:function(){},okText:"Yes",cancelText:"No"})}else this.setState({cancelToViewer:!0})}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onEditOrgSave()}},{key:"onNameChange",value:function(e){e.persist(),this.props.onUpdateName(e.target.value)}},{key:"onDescriptionChange",value:function(e){e.persist(),this.props.onUpdateDescription(e.target.value)}},{key:"onIdChange",value:function(e){e.persist(),console.warn("no updating id, naughty!")}},{key:"onIsPrivateChange",value:function(e){this.props.onUpdateIsPrivate(e.target.checked)}},{key:"onLogoUrlChange",value:function(e){e.persist(),this.props.onUpdateLogoUrl(e.target.value)}},{key:"onHomeUrlChange",value:function(e){e.persist(),this.props.onUpdateHomeUrl(e.target.value)}},{key:"onResearchInterestsChange",value:function(e){e.persist(),this.props.onUpdateResearchInterests(e.target.value)}},{key:"canSave",value:function(){return this.props.editState===s.EDITED&&this.props.validationState.type===o.OK&&(this.props.saveState===c.NEW||this.props.saveState===c.READY||this.props.saveState===c.SAVED)}},{key:"isModified",value:function(){return this.props.editState===s.EDITED&&(this.props.saveState===c.NEW||this.props.saveState===c.READY)}},{key:"calcFieldClass",value:function(e){switch(e.validationState.type){case o.ERROR:case o.REQUIRED_MISSING:return"validation-error"}switch(e.syncState){case i.DIRTY:return"sync-dirty";default:return"validation-ok"}}},{key:"renderFieldError",value:function(e){return e.validationState.type===o.OK?"":e.syncState===i.DIRTY?b.createElement("span",{style:{color:"red"}},e.validationState.message):void 0}},{key:"renderEditor",value:function(){return b.createElement("form",{id:"editOrganizationForm",className:"EditOrganization-editor",onSubmit:this.onSubmit.bind(this)},b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{style:{flex:"1 1 0px"}},b.createElement("h3",null,"Edit Your Organization"))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("h3",null,"Preview"))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},b.createElement(Ot.a,{title:"This is the name for your organization as you want KBase users to see it"},"Name")),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Dr.a,{value:this.props.editedOrganization.name.value||"",className:this.calcFieldClass(this.props.editedOrganization.name),onChange:this.onNameChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.name))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-name"},this.props.editedOrganization.name.value||""))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"ID"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Dr.a,{value:this.props.editedOrganization.id.value||"",className:this.calcFieldClass(this.props.editedOrganization.id),onChange:this.onIdChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.id))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-id"},b.createElement("span",{style:{color:"silver"}},this.origin,"/#org/"),this.props.editedOrganization.id.value||b.createElement("span",{style:{fontStyle:"italic"}},"organization id here")))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Logo URL"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Dr.a,{value:this.props.editedOrganization.logoUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.logoUrl),onChange:this.onLogoUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.logoUrl))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-logo"},this.renderLogoPreview()))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Home Page URL"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(Dr.a,{value:this.props.editedOrganization.homeUrl.value||"",className:this.calcFieldClass(this.props.editedOrganization.homeUrl),onChange:this.onHomeUrlChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.homeUrl))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-field-name"},b.createElement("a",{href:this.props.editedOrganization.homeUrl.value||"",target:"_blank"},this.props.editedOrganization.homeUrl.value||"")))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Is Private?"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(nr.a,{checked:this.props.editedOrganization.isPrivate.value,className:this.calcFieldClass(this.props.editedOrganization.isPrivate),onChange:this.onIsPrivateChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.isPrivate))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-isPrivate"},this.renderIsPrivate(this.props.editedOrganization.isPrivate.value)))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"},"Research Interests"),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(kr.a,{value:this.props.editedOrganization.researchInterests.value||"",className:this.calcFieldClass(this.props.editedOrganization.researchInterests)+" EditOrganization-control-researchInterests",autosize:{minRows:2,maxRows:2},onChange:this.onResearchInterestsChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.researchInterests))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-researchInterests"},this.props.editedOrganization.researchInterests.value||""))),b.createElement("div",{className:"EditOrganization-row"},b.createElement("div",{className:"EditOrganization-col1"},b.createElement("div",{className:"EditOrganization-formLabel field-label"}),b.createElement("div",{className:"EditOrganization-formControl"},b.createElement(kr.a,{value:this.props.editedOrganization.description.value||"",className:this.calcFieldClass(this.props.editedOrganization.description)+" EditOrganization-control-description",autosize:{minRows:5,maxRows:15},onChange:this.onDescriptionChange.bind(this)}),this.renderFieldError(this.props.editedOrganization.description))),b.createElement("div",{className:"EditOrganization-col2"},b.createElement("div",{className:"EditOrganization-preview-description",dangerouslySetInnerHTML:{__html:Cr.Marked.parse(this.props.editedOrganization.description.value||"")}}))))}},{key:"renderIsPrivate",value:function(e){return e?b.createElement("span",null,b.createElement(pt.a,{type:"lock"})," ","Private"):b.createElement("span",null,b.createElement(pt.a,{type:"global"})," ","Public")}},{key:"renderLogoPreview",value:function(){return this.props.editedOrganization.logoUrl.value?b.createElement("img",{src:this.props.editedOrganization.logoUrl.value,width:60}):this.renderDefaultLogo()}},{key:"charAt",value:function(e,t){var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var n=e.charCodeAt(t+1);if(n>56320&&n<=57343)return e.substring(t,2)}return e.substring(t,1)}},{key:"renderDefaultLogo",value:function(){if(!this.props.editedOrganization.name.value||!this.props.editedOrganization.id.value)return b.createElement("div",null,"Default logo preview available when the Organization name and id are completed");var e=this.charAt(this.props.editedOrganization.name.value,0).toUpperCase(),t=vt()(this.props.editedOrganization.id.value).substr(0,6);return b.createElement("svg",{width:60,height:60,style:{border:"1px rgba(200, 200, 200, 0.5) solid"}},b.createElement("text",{x:"50%",y:"50%",dy:4,textAnchor:"middle",dominantBaseline:"middle",fontSize:48,fill:"#"+t,fontFamily:"sans-serif"},e))}},{key:"renderState",value:function(){var e=this.props,t="edit: "+e.editState+", valid: "+e.validationState+", save: "+e.saveState;return b.createElement("span",{style:{marginRight:"10px"}},t)}},{key:"renderOrgName",value:function(e){if(0===e.length)return b.createElement("span",{style:{fontStyle:"italic"}},"org name missing");var t=e;return e.length>=25&&(t=e.slice(0,25)+"\u2026"),b.createElement(Et.a,{to:"/viewOrganization/".concat(this.props.organization.id)},b.createElement("span",{style:{fontWeight:"bold"}},t))}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading Org Editor...");return b.createElement(ar,{breadcrumbs:e})}},{key:"renderMenuButtons",value:function(){return b.createElement("span",{className:"ButtonSet"},b.createElement("span",{className:"ButtonSet-button"},b.createElement(er.a,{icon:"rollback",type:"danger",onClick:this.onFinish.bind(this)},"Close")),b.createElement("span",{className:"ButtonSet-button"},b.createElement(er.a,{icon:"save",form:"editOrganizationForm",key:"submit",disabled:!this.canSave.call(this),htmlType:"submit"},"Save")))}},{key:"render",value:function(){return this.state.cancelToViewer?b.createElement(Mr.a,{push:!0,to:"/viewOrganization/"+this.props.organization.id}):this.props.editedOrganization?b.createElement("div",{className:"EditOrganization"},b.createElement(sr,{buttons:this.renderMenuButtons()}),this.renderEditor()):b.createElement("div",{className:"EditOrganization"},this.renderLoadingHeader())}}]),t}(b.Component);var Va=Object(P.b)(function(e){if(!e.views.editOrgView.viewModel)throw new Error("What, no view model??");var t=e.views.editOrgView.viewModel;return{editState:t.editState,saveState:t.saveState,validationState:t.validationState,editedOrganization:t.editedOrganization,organization:t.organization}},function(e){return{onEditOrgSave:function(){e(Ia())},onUpdateName:function(t){e(Ta(t))},onUpdateLogoUrl:function(t){e(ya(t))},onUpdateDescription:function(t){e(Ma(t))},onUpdateIsPrivate:function(t){e(function(e){return function(t){t({type:F.EDIT_ORG_UPDATE_IS_PRIVATE_SUCCESS,isPrivate:e}),t(ba())}}(t))},onUpdateHomeUrl:function(t){e(function(e){return function(t){var r=_e.validateOrgHomeUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.EDIT_ORG_UPDATE_HOME_URL_ERROR,homeUrl:a,error:i}):t({type:F.EDIT_ORG_UPDATE_HOME_URL_SUCCESS,homeUrl:a}),t(ba())}}(t))},onUpdateResearchInterests:function(t){e(function(e){return function(t){var r=_e.validateOrgHomeUrl(e),n=Object(se.a)(r,2),a=n[0],i=n[1];i.type!==o.OK?t({type:F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_ERROR,researchInterests:a,error:i}):t({type:F.EDIT_ORG_UPDATE_RESEARCH_INTERESTS_SUCCESS,researchInterests:a}),t(ba())}}(t))}}})(Da),ka=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading Editor..."," ",b.createElement(vr.a,null));return b.createElement(ut.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(){if(this.props.view.error)return b.createElement("div",null,"Error! ",this.props.view.error.message)}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.renderError();case R.SUCCESS:return b.createElement(Va,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var Ua=Object(P.b)(function(e,t){return{view:e.views.editOrgView}},function(e){return{onLoad:function(t){e(Na(t))},onUnload:function(){e({type:F.EDIT_ORG_UNLOAD})}}})(ka),za=(r(320),function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onFinish",value:function(){this.props.onFinish()}},{key:"doSelectNarrative",value:function(e){this.props.doSelectNarrative(e)}},{key:"doSendRequest",value:function(){null!==this.props.selectedNarrative?this.props.doSendRequest(this.props.organization.id,this.props.selectedNarrative.narrative.workspaceId):console.warn("attempt to send request without selected narrative")}},{key:"canSendRequest",value:function(){return!!this.props.selectedNarrative}},{key:"renderOrgName",value:function(e){return e.length<25?e:b.createElement("span",null,e.slice(0,25),"\u2026")}},{key:"renderPermission",value:function(e){switch(e.access){case Gt.VIEW:return b.createElement("span",null,b.createElement(pt.a,{type:"eye"})," View");case Gt.EDIT:return b.createElement("span",null,b.createElement(pt.a,{type:"edit"})," Edit");case Gt.ADMIN:return b.createElement("span",null,b.createElement(pt.a,{type:"unlock"})," Admin");case Gt.OWNER:return b.createElement("span",null,b.createElement(pt.a,{type:"crown"})," Owner");default:return b.createElement("span",null,"ERROR")}}},{key:"renderPublicPermission",value:function(e){return e.isPublic?b.createElement("span",null,b.createElement(pt.a,{type:"global"})," Public"):b.createElement("span",null,b.createElement(pt.a,{type:"lock"})," Private")}},{key:"renderNarrative",value:function(e){return b.createElement(b.Fragment,null,b.createElement("div",{className:"RequestNarrative-title"},e.title),b.createElement("div",{className:"RequestNarrative-publicPermission"},this.renderPublicPermission(e)),b.createElement("div",{className:"RequestNarrative-modifiedAt"},b.createElement("span",{className:"field-label"},b.createElement(pt.a,{type:"save"}))," ",b.createElement(Jt,{time:e.lastSavedAt,tooltipPrefix:"last saved "})))}},{key:"renderNarratives",value:function(){var e=this;return 0===this.props.narratives.length?b.createElement("div",{className:"message"},"You do not have any Narratives"):this.props.narratives.map(function(t,r){var n,a=t.status,i=t.narrative,s=["RequestNarrative-narrativeCell"];switch(!(!e.props.selectedNarrative||i.workspaceId!==e.props.selectedNarrative.narrative.workspaceId)&&s.push("RequestNarrative-selected"),a){case _.ASSOCIATED:s.push("RequestNarrative-narrativeInOrg"),n=b.createElement(Ot.a,{title:"This narrative is already associated with this organization"},b.createElement(pt.a,{type:"check",style:{color:"green"}}));break;case _.REQUESTED:s.push("RequestNarrative-narrativeInOrg"),n=b.createElement(Ot.a,{title:"You have already requested that this narrative be added to this organization"},b.createElement(pt.a,{type:"loading",style:{color:"orange"}}));break;default:s.push("RequestNarrative-narrativeNotInOrg")}return b.createElement("div",{className:s.join(" "),onClick:function(){e.doSelectNarrative.call(e,t)},key:String(r)},b.createElement("div",{className:"RequestNarrative-narrativeFlag"},n),b.createElement("div",{className:"RequestNarrative-narrative"},e.renderNarrative(t.narrative)))})}},{key:"onSearchSubmit",value:function(){console.log("searching...")}},{key:"renderSearchIcon",value:function(){return this.props.searching?b.createElement(pt.a,{type:"loading"}):b.createElement(pt.a,{type:"search"})}},{key:"renderSearchBar",value:function(){return b.createElement("form",{id:"searchForm",className:"RequestNarrative-searchBar",onSubmit:this.onSearchSubmit.bind(this)},b.createElement("input",{placeholder:"Search your Narratives",autoFocus:!0}),b.createElement(er.a,{className:"RequestNarrative-button",form:"searchForm",key:"submit",htmlType:"submit"},this.renderSearchIcon()))}},{key:"renderFeedbackBar",value:function(){return b.createElement("div",null,"Showing"," ",Intl.NumberFormat("en-US",{style:"decimal",useGrouping:!0}).format(this.props.narratives.length)," ","narratives")}},{key:"onSortByChange",value:function(e){switch(e){case"title":this.props.doSortBy(jt.TITLE);break;case"savedAt":this.props.doSortBy(jt.LAST_SAVED)}}},{key:"onSortDirectionChange",value:function(){}},{key:"onFilterChange",value:function(){}},{key:"renderFilterSortBar",value:function(){return b.createElement("div",{className:"RequestNarrative-filterSortBar"},b.createElement("span",{className:"field-label"},"sort by"),b.createElement(tr.a,{onChange:this.onSortByChange.bind(this),defaultValue:this.props.sortBy,style:{width:"8em"},dropdownMatchSelectWidth:!0},b.createElement(tr.a.Option,{value:"title",key:"title"},"Title"),b.createElement(tr.a.Option,{value:"savedAt",key:"savedAt"},"Last saved")))}},{key:"renderNarrativeSelector",value:function(){return b.createElement("div",{className:"RequestNarrative-narrativeSelector scrollable-flex-column"},b.createElement("div",{style:{display:"flex",flexDirection:"row"}},b.createElement("div",{style:{flex:"1 1 0px"}},this.renderFilterSortBar())),b.createElement("div",{className:"RequestNarrative-feedbackBar"},this.renderFeedbackBar()),b.createElement("div",{className:"RequestNarrative-narratives scrollable-flex-column"},b.createElement("div",{className:"RequestNarrative-narrativesTable"},this.renderNarratives())))}},{key:"renderSelectedNarrativeButton",value:function(){var e;if(this.props.selectedNarrative)return this.props.selectedNarrative.status===_.ASSOCIATED?b.createElement(ut.a,{type:"info",message:"This Narrative is associated with this Organization"}):this.props.selectedNarrative.status===_.REQUESTED?b.createElement(ut.a,{type:"warning",message:"You have requested to associate this Narrative with this Organization"}):(e=this.props.relation.type===me.ADMIN||this.props.relation.type===me.OWNER?"Add Selected Narrative to Organization":"Request Association of Selected Narrative to Organization",b.createElement(er.a,{type:"primary",onClick:this.doSendRequest.bind(this),disabled:!this.canSendRequest.call(this)},e))}},{key:"renderSelectedNarrative",value:function(){return this.props.selectedNarrative?b.createElement("div",{className:"RequestNarrative-selectedNarrative"},b.createElement("div",{className:"RequestNarrative-title"},this.props.selectedNarrative.narrative.title),b.createElement("div",null,b.createElement("span",{className:"field-label"},b.createElement(pt.a,{type:"save"}))," ",b.createElement(Jt,{time:this.props.selectedNarrative.narrative.lastSavedAt,tooltipPrefix:"last saved "}))):b.createElement(ut.a,{type:"info",message:"Select a narrative on the left to show it here and be able to add it to this organization."})}},{key:"renderMenuButtons",value:function(){return b.createElement("div",{className:"ButtonSet"},b.createElement("div",{className:"ButtonSet-button"},b.createElement(er.a,{icon:"rollback",type:"danger",onClick:this.onFinish.bind(this)},"Done")))}},{key:"render",value:function(){return b.createElement("div",{className:"RequestNarrative scrollable-flex-column"},b.createElement(sr,{buttons:this.renderMenuButtons()}),b.createElement("div",{className:"RequestNarrative-body scrollable-flex-column"},b.createElement("div",{className:"RequestNarrative-selectNarrativeCol scrollable-flex-column"},b.createElement("h3",null,"Select a Narrative"),this.renderNarrativeSelector()),b.createElement("div",{className:"RequestNarrative-selectedNarrativeCol"},b.createElement("h3",null,"Selected Narrative"),this.renderSelectedNarrative(),b.createElement("div",{className:"RequestNarrative-selectedNarrativeButtonBar"},this.renderSelectedNarrativeButton()))),b.createElement("div",{className:"RequestNarrative-footer"}))}}]),t}(b.Component));function Ga(e){return function(t,r){t({type:F.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_START});var n=r(),a=n.auth.authorization;a.token,a.username,n.app.config;t(function(e){return{type:F.REQUEST_ADD_NARRATIVE_SELECT_NARRATIVE_SUCCESS,narrative:e}}(e))}}var ja=Object(P.b)(function(e,t){if(null===e.views.requestNarrativeView.viewModel)throw new Error("view value is not defined!");var r=e.views.requestNarrativeView.viewModel;return{organization:r.organization,relation:r.relation,narratives:r.narratives,selectedNarrative:r.selectedNarrative,searching:!1,sortBy:"title",filter:""}},function(e){return{doSendRequest:function(t,r){e(function(e,t){return function(){var r=Object(ie.a)(ae.a.mark(function r(n,a){var i,s,o,c,l,u,E;return ae.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n({type:F.REQUEST_ADD_NARRATIVE_SEND_START}),i=a(),s=i.auth.authorization,o=s.token,c=s.username,l=i.app.config,u=new Ue({token:o,username:c,groupsServiceURL:l.services.Groups.url}),r.prev=3,r.next=6,u.addOrRequestNarrativeToGroup(e,t);case 6:E=r.sent,n((v=E,{type:F.REQUEST_ADD_NARRATIVE_SEND_SUCCESS,request:v})),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n((d={code:r.t0.name,message:r.t0.message},{type:F.REQUEST_ADD_NARRATIVE_SEND_ERROR,error:d}));case 13:case"end":return r.stop()}var d,v},r,this,[[3,10]])}));return function(e,t){return r.apply(this,arguments)}}()}(t,r))},doSelectNarrative:function(t){e(Ga(t))},doSortBy:function(t){var r;e((r=t,function(){var e=Object(ie.a)(ae.a.mark(function e(t,n){var a,i,s,o,c,l,u,E;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:F.REQUEST_ADD_NARRATIVE_SORT_START}),a=n(),null!==(i=a.views.requestNarrativeView.viewModel)){e.next=6;break}return t({type:F.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Le({code:"error",message:"viewmodel missing"})}),e.abrupt("return");case 6:s=a.auth.authorization,o=s.token,c=s.username,l=a.app.config,u=new Wt({token:o,username:c,groupsServiceURL:l.services.Groups.url,serviceWizardURL:l.services.ServiceWizard.url,workspaceServiceURL:l.services.Workspace.url});try{E=u.sortOrganizationNarratives(i.narratives,r),t({type:F.REQUEST_ADD_NARRATIVE_SORT_SUCCESS,narratives:E})}catch(d){t({type:F.REQUEST_ADD_NARRATIVE_SORT_ERROR,error:Le({code:"error",message:d.message})})}case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()))}}})(za),La=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement(b.Fragment,null,b.createElement(pt.a,{type:"loading"})," ","Loading Your Narratives...");return b.createElement(ut.a,{type:"info",message:e,style:{padding:"20px",width:"30em",margin:"30px auto 0 auto",textAlign:"center"}})}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return b.createElement(ja,{onFinish:this.props.onFinish})}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var Pa,Ba,xa,Wa=Object(P.b)(function(e,t){return{view:e.views.requestNarrativeView}},function(e){return{onLoad:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,O,p,R,h;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:F.REQUEST_ADD_NARRATIVE_LOAD_START}),a=n(),i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,l=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url}),u=new Wt({token:s,username:o,groupsServiceURL:c.services.Groups.url,serviceWizardURL:c.services.ServiceWizard.url,workspaceServiceURL:c.services.Workspace.url}),E=new we({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=5,t.next=8,Promise.all([l.getOrganization(e),u.getOwnNarratives(e),E.getUserRequestForOrg(e),E.getUserInvitationForOrg(e)]);case 8:d=t.sent,v=Object(se.a)(d,4),m=v[0],O=v[1],p=v[2],R=v[3],h=ge(m,o,p,R),r((_=m,g=O,S=h,{type:F.REQUEST_ADD_NARRATIVE_LOAD_SUCCESS,organization:_,narratives:g,relation:S})),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(5),console.error("loading error",t.t0),r((w={code:t.t0.name,message:t.t0.message},{type:F.REQUEST_ADD_NARRATIVE_LOAD_ERROR,error:w}));case 22:case"end":return t.stop()}var w,_,g,S},t,this,[[5,18]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onUnload:function(){e({type:F.REQUEST_ADD_NARRATIVE_UNLOAD})}}})(La);r(322);!function(e){e[e.NONE=0]="NONE",e[e.VIEW_MEMBERS=1]="VIEW_MEMBERS",e[e.MANAGE_REQUESTS=2]="MANAGE_REQUESTS",e[e.VIEW_ORGANIZATION=3]="VIEW_ORGANIZATION",e[e.BROWSER=4]="BROWSER"}(Pa||(Pa={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(Ba||(Ba={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.MANAGE_RELATED_ORGS=1]="MANAGE_RELATED_ORGS",e[e.INVITE_USER=2]="INVITE_USER",e[e.MANAGE_MEMBERSHIP=3]="MANAGE_MEMBERSHIP",e[e.EDIT_ORGANIZATION=4]="EDIT_ORGANIZATION",e[e.ADD_NARRATIVE=5]="ADD_NARRATIVE"}(xa||(xa={}));var qa=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Pa.NONE,requestAccess:{narrative:null},accordionState:Ba.UP,subView:xa.NORMAL},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onManageRelatedOrgs",value:function(){this.setState({subView:xa.MANAGE_RELATED_ORGS})}},{key:"onInviteUser",value:function(){this.setState({subView:xa.INVITE_USER})}},{key:"onViewMembers",value:function(){}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.viewModel.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.viewModel.organization){var e=this.props.viewModel.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"onRequestAddNarrative",value:function(){this.setState({subView:xa.ADD_NARRATIVE})}},{key:"onRemoveNarrative",value:function(e){this.props.onRemoveNarrative(e)}},{key:"onNarrativeMenu",value:function(e,t){switch(e){case"removeNarrative":this.props.onRemoveNarrative(t)}}},{key:"onShowInfo",value:function(){Rt.a.info({title:"View Organization Help",width:"50em",content:b.createElement("div",null,"Organization help here...")})}},{key:"onRequestShare",value:function(e){this.setState({requestAccess:{narrative:e}})}},{key:"onCloseRequestAccess",value:function(){this.setState({requestAccess:{narrative:null}})}},{key:"buildFooter",value:function(){return b.createElement("div",null,this.renderEditRow())}},{key:"renderEditRow",value:function(){if(this.props.viewModel.relation.type===me.ADMIN||this.props.viewModel.relation.type===me.OWNER)return b.createElement("p",{style:{textAlign:"center"}},"As the owner of this group, you may ",b.createElement(Et.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},b.createElement(er.a,{icon:"edit"},"Edit"))," it.")}},{key:"renderEditButton",value:function(){if(this.props.viewModel.relation.type===me.ADMIN||this.props.viewModel.relation.type===me.OWNER)return b.createElement(Et.a,{to:"/editOrganization/".concat(this.props.viewModel.organization.id)},b.createElement(er.a,{icon:"edit"},"Edit This Organization"))}},{key:"renderOrg",value:function(){if(this.props.viewModel.organization)return b.createElement("div",{className:"ViewOrganization-org-description-org scrollable-flex-column"},b.createElement("div",{className:"ViewOrganization-org-description",dangerouslySetInnerHTML:{__html:Cr.Marked.parse(this.props.viewModel.organization.description||"")}}))}},{key:"renderOwnerInfo",value:function(e){return b.createElement("div",{className:"ownerTable"},b.createElement("div",{className:"proprietorCol"},b.createElement("div",{className:"owner"},b.createElement("a",{href:"/#people/"+e.owner.username,target:"_blank"},e.owner.username)," ","\u2768",e.owner.username,"\u2769")))}},{key:"renderRelation",value:function(e){switch(e.type){case me.NONE:return b.createElement("span",null,b.createElement(pt.a,{type:"stop"}),"None");case me.VIEW:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You are not a member of this org; you may request membership"},b.createElement("div",null,b.createElement(pt.a,{type:"eye",style:{marginRight:"4px"}}),"You are not a member of this Organization"),b.createElement("div",{style:{marginTop:"10px"}},b.createElement(er.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")));case me.MEMBER_REQUEST_PENDING:return b.createElement("div",null,b.createElement("div",null,b.createElement(pt.a,{type:"user",style:{color:"orange"},spin:!0}),"Your membership ",b.createElement("b",null,"request")," is pending"),b.createElement("div",null,b.createElement(er.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case me.MEMBER_INVITATION_PENDING:return b.createElement("div",null,b.createElement("div",null,b.createElement(pt.a,{type:"user",style:{color:"blue"}}),"You have been ",b.createElement("b",null,"invited")," to join this Organization"),b.createElement("div",{style:{marginTop:"10px"}},b.createElement(er.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation"),b.createElement(er.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation")));case me.MEMBER:return b.createElement("span",null,b.createElement(pt.a,{type:"user"}),"Member");case me.ADMIN:return b.createElement("span",null,b.createElement(pt.a,{type:"unlock"}),"Admin");case me.OWNER:return b.createElement(Ot.a,{placement:"bottomRight",mouseEnterDelay:.5,title:"You own this org"},b.createElement("span",null,b.createElement(pt.a,{type:"unlock",theme:"filled",style:{marginRight:"4px"}}),"You own this organization"))}}},{key:"isMember",value:function(){return!!this.props.viewModel.organization&&(this.props.viewModel.relation.type===me.OWNER||this.props.viewModel.relation.type===me.ADMIN||this.props.viewModel.relation.type===me.MEMBER)}},{key:"renderMembers",value:function(){return this.isMember()?b.createElement(On,{organization:this.props.viewModel.organization,relation:this.props.viewModel.relation,onReloadOrg:this.props.onReloadOrg}):b.createElement(ut.a,{message:"Membership is only available to members",type:"info"})}},{key:"renderInfo",value:function(){if(this.props.viewModel.organization)return b.createElement(nn.a,{title:b.createElement("span",null,b.createElement(pt.a,{type:"info-circle"})," info"),headStyle:{backgroundColor:"gray",color:"white"},className:"slimCard"},b.createElement("div",null,b.createElement("div",null,b.createElement("div",{className:"label"},"owner")),b.createElement("div",{className:"ViewOrganization-ownerTable"},b.createElement(ln,{member:this.props.viewModel.organization.owner,avatarSize:50})),b.createElement("div",{className:"ViewOrganization-infoTable"},b.createElement("div",{className:"row"},b.createElement("div",{className:"col1"},b.createElement("span",{className:"label"},"established")),b.createElement("div",{className:"col2"},b.createElement("div",{className:"createdAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.viewModel.organization.createdAt)))),b.createElement("div",{className:"row"},b.createElement("div",{className:"col1"},b.createElement("span",{className:"label"},"last updated")),b.createElement("div",{className:"col2"},b.createElement("div",{className:"modifiedAt"},Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(this.props.viewModel.organization.modifiedAt)))))))}},{key:"renderGroupRequestsRow",value:function(){var e,t=this.props.viewModel.relation,r=this.props.viewModel.groupRequests,n=this.props.viewModel.groupInvitations;if((t.type===me.ADMIN||t.type===me.OWNER)&&(null!==r&&null!==n))return e=r.length?b.createElement("div",null,"group has no pending requests"):b.createElement("div",null,b.createElement("div",null,b.createElement(pt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," group has"," ",b.createElement("span",{style:{fontWeight:"bold"}},r.length)," ","pending request",r.length>1?"s":""," ","and"," ",b.createElement("span",{style:{fontWeight:"bold"}},n.length)," ","pending request",n.length>1?"s":""),b.createElement("div",null,b.createElement(Et.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},b.createElement(er.a,null,"Manage Requests")))),b.createElement("div",{className:"row"},b.createElement("div",{className:"col1"},b.createElement("span",{className:"label"},"admin")),b.createElement("div",{className:"col2"},b.createElement("div",{className:"relation"},e)))}},{key:"renderGroupRequests",value:function(e,t){return e.length?b.createElement("div",null,b.createElement("div",null,b.createElement(pt.a,{type:"exclamation-circle",theme:"twoTone",twoToneColor:"orange"})," There"," ",e.length>1?"are":"is"," ",b.createElement("span",{style:{fontWeight:"bold"}},e.length)," ","pending request",e.length>1?"s":""," ","and"," ",b.createElement("span",{style:{fontWeight:"bold"}},t.length)," ","pending invitation",t.length>1?"s":""),b.createElement("div",null,b.createElement(Et.a,{to:"/manageOrganizationRequests/"+this.props.viewModel.organization.id},b.createElement(er.a,null,"Manage Requests")))):b.createElement("div",{className:"message"},"No pending group requests")}},{key:"renderRelationClass",value:function(e){switch(e.type){case me.NONE:case me.VIEW:return"infoBox";case me.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case me.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case me.MEMBER:case me.ADMIN:case me.OWNER:return"infoBox"}}},{key:"renderUserRelationship",value:function(){return b.createElement("form",{className:"infoTable"},this.renderGroupRequestsRow())}},{key:"renderAdminTasks",value:function(){var e=this.props.viewModel.relation;if(e.type===me.ADMIN||e.type===me.OWNER){var t=this.props.viewModel,r=t.groupRequests,n=t.groupInvitations;if(null!==n&&null!==r){var a=r.length+n.length,i=b.createElement("span",null,b.createElement(pt.a,{type:"unlock"})," ","group requests"," ",b.createElement("span",{className:"ViewOrganization-titleCount"},"(",a,")"));return b.createElement("div",{className:"ViewOrganization-adminTasksBox"},b.createElement(nn.a,{className:"slimCard ViewOrganization-adminTasksCard",headStyle:{backgroundColor:"gray",color:"white"},title:i},this.renderGroupRequests(r,n)))}}}},{key:"renderJoinButton",value:function(){if(this.props.viewModel.organization&&this.props.viewModel.relation.type===me.VIEW)return b.createElement(er.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization")}},{key:"renderLoadingHeader",value:function(){var e=b.createElement("span",null,"Loading Org...");return b.createElement(ar,{breadcrumbs:e})}},{key:"renderMembersTab",value:function(){return b.createElement("div",{className:"ViewOrganization-membersCol scrollable-flex-column"},this.renderMembersToolbar(),this.renderMembers())}},{key:"onAcceptRequest",value:function(e){this.props.onAcceptRequest(e.id)}},{key:"renderMembersToolbar",value:function(){switch(this.props.viewModel.relation.type){case me.NONE:case me.MEMBER:return;case me.ADMIN:case me.OWNER:return b.createElement("div",{className:"ViewOrganization-tabPaneToolbar"},b.createElement(er.a,{size:"small",onClick:this.onInviteUser.bind(this)},b.createElement(pt.a,{type:"mail"})," Invite a User"))}}},{key:"renderCombo",value:function(){var e,t=this,r=this.props.viewModel.relation.type===me.ADMIN||this.props.viewModel.relation.type===me.OWNER,n=this.props.viewModel.organization.isMember,a=[];if(e=this.props.viewModel.organization.memberCount-1?String(this.props.viewModel.organization.memberCount-1):"\xd8",a.push(b.createElement(an.a.TabPane,{tab:b.createElement("span",null,b.createElement(pt.a,{type:"team"}),"Members ",b.createElement("span",{className:"ViewOrganization-tabCount"},"(",e,")")),key:"members",style:{flexDirection:"column"}},this.renderMembersTab())),n)if(r){var i=this.props.viewModel.requestInbox.length+this.props.viewModel.requestOutbox.length,s=b.createElement("span",{className:"ViewOrganization-tabCount"},"(",i||"\xd8",")");a.push(b.createElement(an.a.TabPane,{tab:b.createElement("span",null,b.createElement(pt.a,{type:"inbox"}),"Requests ",s," "),key:"inbox",style:{flexDirection:"column"}},b.createElement(Vn,{inbox:this.props.viewModel.requestInbox,outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}else{var o,c=this.props.viewModel.requestOutbox.length;o=c?String(c):"\xd8",a.push(b.createElement(an.a.TabPane,{tab:b.createElement("span",null,b.createElement(pt.a,{type:"inbox"}),"Requests ",b.createElement("span",{className:"ViewOrganization-tabCount"},"(",o,")")),key:"outbox",style:{flexDirection:"column"}},b.createElement(Vn,{inbox:[],outbox:this.props.viewModel.requestOutbox,relation:this.props.viewModel.relation})))}var l=this.props.viewModel.organization.relatedOrganizations.length,u=b.createElement("span",null,b.createElement(pt.a,{type:"team"}),"Related Orgs ",b.createElement("span",{className:"ViewOrganization-tabCount"},"(",l,")"));return a.push(b.createElement(an.a.TabPane,{tab:u,key:"relatedorgs",style:{flexDirection:"column"}},b.createElement(Ln,{relatedOrganizations:this.props.viewModel.organization.relatedOrganizations,organization:this.props.viewModel.organization,onManageRelatedOrgs:function(){t.onManageRelatedOrgs()}}))),b.createElement(an.a,{defaultActiveKey:"members",className:"ViewOrganization-tabs",animated:!1,size:"small",tabPosition:"top"},a)}},{key:"renderMenuButtons",value:function(){return b.createElement("span",{className:"ButtonSet"},b.createElement("span",{className:"ButtonSet-button"},b.createElement(er.a,{type:"danger",onClick:this.onNavigateToBrowser.bind(this)},b.createElement(pt.a,{type:"rollback"})," ","Done")),b.createElement("span",{className:"ButtonSet-button"},this.renderOrgMenu()))}},{key:"onNavigateToBrowser",value:function(){this.setState({navigateTo:Pa.BROWSER})}},{key:"onNavigateToViewMembers",value:function(){this.setState({navigateTo:Pa.VIEW_MEMBERS})}},{key:"onNavigateToManageRequests",value:function(){this.setState({navigateTo:Pa.MANAGE_REQUESTS})}},{key:"onNavigateToViewOrganization",value:function(){this.setState({navigateTo:Pa.VIEW_ORGANIZATION})}},{key:"onMenuClick",value:function(e){switch(e.key){case"manageMyMembership":this.setState({subView:xa.MANAGE_MEMBERSHIP});break;case"viewMembers":this.setState({navigateTo:Pa.VIEW_MEMBERS});break;case"editOrg":console.log("setting state"),this.setState({subView:xa.EDIT_ORGANIZATION});break;case"inviteUser":this.setState({subView:xa.INVITE_USER});break;case"manageRequests":this.setState({navigateTo:Pa.MANAGE_REQUESTS});break;case"addNarrative":this.setState({subView:xa.ADD_NARRATIVE});break;case"manageRelatedOrgs":this.setState({subView:xa.MANAGE_RELATED_ORGS})}}},{key:"renderOrgMenu",value:function(){this.props.viewModel.organization;switch(this.props.viewModel.relation.type){case me.NONE:case me.VIEW:return b.createElement("span",null,b.createElement(er.a,{type:"primary",onClick:this.onJoinClick.bind(this)},"Join this Organization"));case me.MEMBER_REQUEST_PENDING:return b.createElement("span",null,b.createElement(Ot.a,{placement:"bottom",mouseEnterDelay:.5,title:"You have requested to join this Org; you may cancel your join request with this button"},b.createElement(er.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Join Request")));case me.MEMBER_INVITATION_PENDING:return b.createElement("div",{className:"ViewOrganization-invitationPendingCard"},b.createElement("span",null,"You have been invited to this organization: "),b.createElement(er.a,{icon:"check",type:"default",size:"small",onClick:this.onAcceptInvitation.bind(this)},"Accept"),b.createElement(er.a,{icon:"stop",type:"danger",size:"small",onClick:this.onRejectInvitation.bind(this)},"Reject"));case me.MEMBER:var e=b.createElement(ht.a,{onClick:this.onMenuClick.bind(this)},b.createElement(ht.a.Item,{key:"manageMyMembership"},b.createElement(pt.a,{type:"user"})," ","Manage My Membership"),b.createElement(ht.a.Item,{key:"addNarrative"},b.createElement(pt.a,{type:"file"})," ","Add Narrative"));return b.createElement("span",null,b.createElement(wt.a,{overlay:e,trigger:["click"]},b.createElement(er.a,{shape:"circle"},b.createElement(pt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))));case me.ADMIN:var t=b.createElement(ht.a,{onClick:this.onMenuClick.bind(this)},b.createElement(ht.a.Item,{key:"manageMyMembership"},b.createElement(pt.a,{type:"user"})," ","Manage My Membership"),b.createElement(ht.a.Item,{key:"editOrg"},b.createElement(pt.a,{type:"edit"})," ","Edit this Org"),b.createElement(ht.a.Item,{key:"inviteUser"},b.createElement(pt.a,{type:"mail"})," ","Invite User"),b.createElement(ht.a.Item,{key:"manageRelatedOrgs"},b.createElement(pt.a,{type:"team"})," ","Manage Related Orgs"));return b.createElement("span",null,b.createElement(wt.a,{overlay:t,trigger:["click"]},b.createElement(er.a,{shape:"circle"},b.createElement(pt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))));case me.OWNER:var r=b.createElement(ht.a,{onClick:this.onMenuClick.bind(this)},b.createElement(ht.a.Item,{key:"manageMyMembership"},b.createElement(pt.a,{type:"user"})," ","Manage My Membership"),b.createElement(ht.a.Item,{key:"editOrg"},b.createElement(pt.a,{type:"edit"})," ","Edit this Org"),b.createElement(ht.a.Item,{key:"inviteUser"},b.createElement(pt.a,{type:"mail"})," ","Invite User"),b.createElement(ht.a.Item,{key:"addNarrative"},b.createElement(pt.a,{type:"file"})," ","Add Narrative"),b.createElement(ht.a.Item,{key:"manageRelatedOrgs"},b.createElement(pt.a,{type:"team"})," ","Manage Related Orgs"));return b.createElement("span",null,b.createElement(wt.a,{overlay:r,trigger:["click"]},b.createElement(er.a,{shape:"circle"},b.createElement(pt.a,{type:"setting",theme:"filled",style:{fontSize:"120%"}}))))}}},{key:"toggleAccordion",value:function(){this.setState({accordionState:this.state.accordionState===Ba.UP?Ba.DOWN:Ba.UP})}},{key:"renderAccordionControl",value:function(){var e;return e=this.state.accordionState===Ba.UP?"caret-down":"caret-up",b.createElement("div",{className:"ViewOrganization-accordion",onClick:this.toggleAccordion.bind(this)},b.createElement("div",{className:"ViewOrganization-accordionCol1"},b.createElement("div",{className:"ViewOrganization-accordionRow1"}),b.createElement("div",{className:"ViewOrganization-accordionRow2"}),b.createElement("div",{className:"ViewOrganization-accordionRow3"})),b.createElement("div",{className:"ViewOrganization-accordionCol2"},b.createElement("div",{className:"ViewOrganization-accordionRow1"}),b.createElement("div",{className:"ViewOrganization-accordionRow2"},b.createElement(pt.a,{type:e})),b.createElement("div",{className:"ViewOrganization-accordionRow3"})),b.createElement("div",{className:"ViewOrganization-accordionCol3"},b.createElement("div",{className:"ViewOrganization-accordionRow1"}),b.createElement("div",{className:"ViewOrganization-accordionRow2"}),b.createElement("div",{className:"ViewOrganization-accordionRow3"})))}},{key:"renderNormalView",value:function(){var e,t;return this.state.accordionState===Ba.UP?(e="ViewOrganization-orgRow ViewOrganization-accordionClosed",t="ViewOrganization-narrativesRow ViewOrganization-accordionOpen"):(e="ViewOrganization-orgRow ViewOrganization-accordionOpen",t="ViewOrganization-narrativesRow ViewOrganization-accordionClosed"),e+=" scrollable-flex-column",t+=" scrollable-flex-column",b.createElement("div",{className:"ViewOrganization-mainRow scrollable-flex-column"},b.createElement("div",{className:"ViewOrganization-mainColumn  scrollable-flex-column"},b.createElement("div",{className:e,style:{minHeight:"0px"}},this.renderOrg()),b.createElement("div",{className:"ViewOrganization-accordionRow"},this.renderAccordionControl()),b.createElement("div",{className:t},b.createElement(ma,{organization:this.props.viewModel.organization,narratives:this.props.viewModel.narratives,relation:this.props.viewModel.relation,sortNarrativesBy:this.props.viewModel.sortNarrativesBy,searchNarrativesBy:this.props.viewModel.searchNarrativesBy,onSortNarratives:this.props.onSortNarratives,onSearchNarratives:this.props.onSearchNarratives,onRemoveNarrative:this.props.onRemoveNarrative,onGetViewAccess:this.props.onGetViewAccess,onRequestAddNarrative:this.onRequestAddNarrative.bind(this)}))),b.createElement("div",{className:"ViewOrganization-infoColumn"},this.renderCombo()))}},{key:"renderManageRelatedOrgsView",value:function(){var e=this;return b.createElement(qn,{onFinish:function(){e.setState({subView:xa.NORMAL})}})}},{key:"renderInviteUsersView",value:function(){var e=this;return b.createElement(na,{onFinish:function(){e.setState({subView:xa.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderManageMembership",value:function(){var e=this;return b.createElement(Sa,{onFinish:function(){e.setState({subView:xa.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderEditOrganization",value:function(){var e=this;return b.createElement(Ua,{onFinish:function(){e.setState({subView:xa.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"renderAddNarrative",value:function(){var e=this;return b.createElement(Wa,{onFinish:function(){e.setState({subView:xa.NORMAL})},organizationId:this.props.viewModel.organization.id})}},{key:"getSubView",value:function(){switch(console.log("get sub view",this.state.subView,this.state.subView===xa.EDIT_ORGANIZATION),this.state.subView){case xa.MANAGE_RELATED_ORGS:return this.renderManageRelatedOrgsView();case xa.INVITE_USER:return this.renderInviteUsersView();case xa.MANAGE_MEMBERSHIP:return this.renderManageMembership();case xa.EDIT_ORGANIZATION:return this.renderEditOrganization();case xa.ADD_NARRATIVE:return this.renderAddNarrative();case xa.NORMAL:default:return this.renderNormalView()}}},{key:"render",value:function(){var e=this.props.viewModel.organization;return b.createElement("div",{className:"ViewOrganization  scrollable-flex-column"},b.createElement(sr,{buttons:this.renderMenuButtons()}),b.createElement("div",{style:{borderBottom:"1px silver solid"}},b.createElement(Kt,{organization:e,openRequestsStatus:this.props.viewModel.openRequest})),this.getSubView())}}]),t}(b.Component);var Ha,Fa=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.NORMAL)throw new Error("argh, wrong org kind");return{viewModel:r}},function(e){return{onViewOrg:function(t){e(Jr(t))},onReloadOrg:function(t){e(Yr(t))},onJoinOrg:function(){e(Kr())},onCancelJoinRequest:function(t){e(Xr(t))},onAcceptInvitation:function(t){e($r(t))},onRejectInvitation:function(t){e(en(t))},onRemoveNarrative:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_REMOVE_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Br({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 5:if(i=a.auth.authorization,s=i.token,o=i.username,c=a.app.config,(l=a.views.viewOrgView.viewModel).kind===f.NORMAL){t.next=9;break}return r(Br({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 9:if(u=l.organization){t.next=13;break}return r(Br({code:"bad state",message:"View orgs does not have an org"})),t.abrupt("return");case 13:return E=u.id,d=new Ue({token:s,username:o,groupsServiceURL:c.services.Groups.url}),t.prev=15,t.next=18,d.removeNarrativeFromOrg(E,e.workspaceId);case 18:r((v=e.workspaceId,{type:F.VIEW_ORG_REMOVE_NARRATIVE_SUCCESS,narrativeId:v})),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(15),r(Br({code:t.t0.name,message:t.t0.message}));case 24:case"end":return t.stop()}var v},t,this,[[15,21]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onGetViewAccess:function(t){e(function(e){return function(){var t=Object(ie.a)(ae.a.mark(function t(r,n){var a,i,s,o,c,l,u,E,d,v,m,O,p,R,h;return ae.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r({type:F.VIEW_ORG_ACCESS_NARRATIVE_START}),(a=n()).views.viewOrgView.viewModel){t.next=5;break}return r(Wr({code:"error",message:"No view model"})),t.abrupt("return");case 5:if((i=a.views.viewOrgView.viewModel).kind===f.NORMAL){t.next=9;break}return r(Wr({code:"error",message:"Not NORMAL org"})),t.abrupt("return");case 9:return s=i.organization,o=i.sortNarrativesBy,c=i.searchNarrativesBy,l=a.auth.authorization,u=l.token,E=l.username,d=a.app.config,v=s.id,m=String(e.workspaceId),O=new Ue({token:u,username:E,groupsServiceURL:d.services.Groups.url}),t.prev=14,t.next=17,O.grantNarrativeAccess(v,m);case 17:return t.next=19,O.getOrg(v);case 19:if((p=t.sent).kind===Re.NORMAL){t.next=23;break}return r(Wr({code:"error",message:"Not a NORMAL org"})),t.abrupt("return");case 23:R=p.narratives,h=De(R,{sortBy:o,searchBy:c}),r(Ht(e.workspaceId)),r(xr(p,h)),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(14),r(Wr({code:"error",message:t.t0.message}));case 32:case"end":return t.stop()}},t,this,[[14,29]])}));return function(e,r){return t.apply(this,arguments)}}()}(t))},onAcceptRequest:function(t){e(tn(t))},onSortNarratives:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===f.NORMAL){var i=n.organization.narratives,s=n.searchNarrativesBy,o=De(i,{sortBy:e,searchBy:s});t({type:F.VIEW_ORG_SORT_NARRATIVES_SUCCESS,narratives:o,sortBy:e})}else t(Qr({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Qr({type:a.ERROR,message:"Now view model!"}))}}(t))},onSearchNarratives:function(t){e(function(e){return function(t,r){t({type:F.VIEW_ORG_SORT_NARRATIVES_START});var n=r().views.viewOrgView.viewModel;if(n)if(n.kind===f.NORMAL){var i=De(n.organization.narratives,{sortBy:n.sortNarrativesBy,searchBy:e});t({type:F.VIEW_ORG_SEARCH_NARRATIVES_SUCCESS,searchBy:e,narratives:i})}else t(Qr({type:a.ERROR,message:"Wrong org view model kind!"}));else t(Qr({type:a.ERROR,message:"Now view model!"}))}}(t))}}})(qa);r(324);!function(e){e[e.NONE=0]="NONE",e[e.REQUEST_ADD_NARRATIVE=1]="REQUEST_ADD_NARRATIVE"}(Ha||(Ha={}));var Qa=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).state={showInfo:!1,navigateTo:Ha.NONE,requestAccess:{narrative:null}},r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onShowInfo",value:function(){Rt.a.info({title:"View Organization Help",width:"50em",content:b.createElement("div",null,b.createElement("p",null,"This organization is ",b.createElement("b",null,"private"),"."),b.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),b.createElement("p",null,"Upon requesting membership, an organization administrator may grant you membership"),b.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."))})}},{key:"onJoinClick",value:function(){this.props.onJoinOrg()}},{key:"onCancelJoinRequest",value:function(){var e=this.props.relation;this.props.onCancelJoinRequest(e.requestId)}},{key:"onAcceptInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onAcceptInvitation(e.requestId)}}},{key:"onRejectInvitation",value:function(){if(this.props.organization){var e=this.props.relation;this.props.onRejectInvitation(e.requestId)}}},{key:"renderMessage",value:function(){switch(this.props.relation.type){case me.NONE:return b.createElement(b.Fragment,null,b.createElement("p",null,"This organization is ",b.createElement("b",null,"private")," and you are not a member."),b.createElement("p",null,"Although no information about this organization may be revealed to non-members, you may request membership"),b.createElement("p",null,"Upon requesting membership, the organization administrators will be notified."),b.createElement("p",null,"When your request is either accepted or denied, you will received a notification in your KBase Feed."));case me.MEMBER_REQUEST_PENDING:return b.createElement(b.Fragment,null,b.createElement("p",null,"Your membership request to this private organization is pending."));case me.MEMBER_INVITATION_PENDING:return b.createElement(b.Fragment,null,b.createElement("p",null,"You have been invited to this private organization."));default:return b.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderOrg",value:function(){var e=b.createElement("span",null,"Private Organization"),t=b.createElement(b.Fragment,null,this.renderMessage(),b.createElement("div",null,this.renderJoinButton()));return b.createElement(ut.a,{message:e,description:t,type:"info",showIcon:!0,icon:b.createElement(pt.a,{type:"lock"}),style:{width:"50em",margin:"20px auto"},className:"ViewInaccessiblePrivateOrganization-message"})}},{key:"renderRelationClass",value:function(e){switch(e.type){case me.NONE:case me.VIEW:return"infoBox";case me.MEMBER_REQUEST_PENDING:return"infoBox relationRequestPending";case me.MEMBER_INVITATION_PENDING:return"infoBox relationInvitationPending";case me.MEMBER:case me.ADMIN:case me.OWNER:return"infoBox"}}},{key:"renderJoinButton",value:function(){switch(this.props.relation.type){case me.NONE:return b.createElement(er.a,{onClick:this.onJoinClick.bind(this)},"Join this Organization");case me.MEMBER_REQUEST_PENDING:return b.createElement("div",null,b.createElement("div",null,b.createElement(er.a,{icon:"delete",type:"danger",onClick:this.onCancelJoinRequest.bind(this)},"Cancel Request")));case me.MEMBER_INVITATION_PENDING:return b.createElement("div",null,b.createElement(er.a,{icon:"check",type:"default",onClick:this.onAcceptInvitation.bind(this)},"Accept Invitation")," ",b.createElement(er.a,{icon:"stop",type:"danger",onClick:this.onRejectInvitation.bind(this)},"Reject Invitation"));default:return b.createElement("div",null,"Weird, ",this.props.relation.type,".")}}},{key:"renderHeader",value:function(){var e=b.createElement("div",{style:{flex:"0 0 auto"}}),t=b.createElement(b.Fragment,null,b.createElement(er.a,{shape:"circle",icon:"info",onClick:this.onShowInfo.bind(this)}));return b.createElement(ar,{breadcrumbs:e,buttons:t})}},{key:"render",value:function(){return b.createElement("div",{className:"ViewInaccessiblePrivateOrganization  scrollable-flex-column"},this.renderHeader(),this.renderOrg())}}]),t}(b.Component);var Za=Object(P.b)(function(e,t){var r=e.views.viewOrgView.viewModel;if(!r)throw new Error("argh, view model missing");if(r.kind!==f.PRIVATE_INACCESSIBLE)throw new Error("argh, wrong org kind");return{organization:r.organization,relation:r.relation,requestOutbox:r.requestOutbox}},function(e){return{onJoinOrg:function(){e(Kr())},onCancelJoinRequest:function(t){e(Xr(t))},onAcceptInvitation:function(t){e($r(t))},onRejectInvitation:function(t){e(en(t))}}})(Qa),Ja=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"renderLoading",value:function(){var e=b.createElement("div",null,"Loading your Organization..."," ",b.createElement(vr.a,null));return b.createElement(ut.a,{type:"info",message:e,style:{width:"20em",padding:"20px",margin:"20px auto"}})}},{key:"renderError",value:function(e){return b.createElement("div",null,"Error!",b.createElement("div",null,e.message))}},{key:"render",value:function(){switch(this.props.view.loadingState){case R.NONE:case R.LOADING:return this.renderLoading();case R.ERROR:return this.props.view.error?this.renderError(this.props.view.error):this.renderError({code:"Missing Error",message:"The error appears to be missing"});default:return null===this.props.view.viewModel?this.renderError({code:"Null Error",message:"The view model is missing, but should be available"}):this.props.view.viewModel.organization.kind===Re.INACCESSIBLE_PRIVATE?b.createElement(Za,null):b.createElement(Fa,null)}}},{key:"componentDidMount",value:function(){switch(this.props.view.loadingState){case R.NONE:this.props.onLoad(this.props.organizationId)}}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}}]),t}(b.Component);var Ya=Object(P.b)(function(e,t){return{view:e.views.viewOrgView}},function(e){return{onLoad:function(t){e(Jr(t))},onUnload:function(){e(function(){var e=Object(ie.a)(ae.a.mark(function e(t,r){var n,a,i,s,o,c,l;return ae.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r(),a=n.auth.authorization,i=a.token,s=a.username,o=n.app.config,c=n.views.viewOrgView.viewModel){e.next=3;break}throw new Error("view model not defined!?!");case 3:if(l=new Ue({token:i,username:s,groupsServiceURL:o.services.Groups.url}),c.organization.relation!==me.MEMBER&&c.organization.relation!==me.ADMIN&&c.organization.relation!==me.OWNER){e.next=7;break}return e.next=7,l.visitOrg({organizationId:c.organization.id});case 7:t(Pr()),t({type:F.VIEW_ORG_UNLOAD});case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}())}}})(Ja),Ka=(r(326),function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).tokenRef=void 0,r.tokenRef=b.createRef(),r.props.checkAuth(),r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"onLogoutClick",value:function(){this.props.onRemoveAuthorization()}},{key:"onLoginClick",value:function(){if(null!==this.tokenRef.current){var e=this.tokenRef.current.value;0!==e.length&&this.props.onAddAuthorization(e)}}},{key:"buildAuthForm",value:function(){return b.createElement("div",{className:"Auth-form"},"Token: ",b.createElement("input",{ref:this.tokenRef,style:{width:"30em"}}),b.createElement(er.a,{icon:"save",htmlType:"submit",onClick:this.onLoginClick.bind(this)},"Assign Token"))}},{key:"buildAuthToolbar",value:function(){return b.createElement("div",{className:"Auth-toolbar"},"Logged in as ",b.createElement("b",null,b.createElement("span",null,this.props.authorization.authorization.realname)," (",b.createElement("span",null,this.props.authorization.authorization.username)),")"," ",b.createElement(er.a,{icon:"logout",onClick:this.onLogoutClick.bind(this)}))}},{key:"buildAuthDev",value:function(){switch(this.props.authorization.status){case v.NONE:case v.CHECKING:return b.createElement("div",null);case v.AUTHORIZED:return b.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.buildAuthToolbar(),this.props.children);case v.UNAUTHORIZED:return b.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},b.createElement("p",null,"Not authorized! Enter a user token below"),this.buildAuthForm());case v.ERROR:return b.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},b.createElement("p",null,"Error"),this.props.authorization.message);default:return b.createElement("div",null)}}},{key:"buildAuthProd",value:function(){switch(this.props.authorization.status){case v.NONE:case v.CHECKING:return b.createElement("div",null);case v.AUTHORIZED:return b.createElement("div",{className:"Auth Auth-authorized scrollable-flex-column"},this.props.children);case v.UNAUTHORIZED:return b.createElement("div",{className:"Auth Auth-unauthorized scrollable-flex-column"},b.createElement("p",null,"Not authorized!"));case v.ERROR:return b.createElement("div",{className:"Auth Auth-error scrollable-flex-column"},b.createElement("p",null,"Error: ??"));default:return b.createElement("div",null)}}},{key:"render",value:function(){return b.createElement("div",{className:"Auth scrollable-flex-column"},this.props.hosted?this.buildAuthProd():this.buildAuthDev())}}]),t}(b.Component)),Xa=r(94),$a="",ei="api/V2/token",ti="api/V2/me",ri=function(){function e(t){var r=t.url;Object(C.a)(this,e),this.url=void 0,this.url=r}return Object(D.a)(e,[{key:"makePath",value:function(e){return"string"===typeof e?[this.url].concat([e]).join("/"):[this.url].concat(e).join("/")}},{key:"root",value:function(){return fetch(this.makePath([$a]),{headers:{Accept:"application/json"},mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e})}},{key:"getTokenInfo",value:function(e){return fetch(this.makePath([ei]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}},{key:"getMe",value:function(e){return fetch(this.makePath([ti]),{headers:{Accept:"application/json",Authorization:e},mode:"cors"}).then(function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()}).then(function(e){return e})}}]),e}();function ni(e){return{type:F.AUTH_CHECK_ERROR,error:e}}function ai(e,t,r,n){return{type:F.AUTH_AUTHORIZED,token:e,username:t,realname:r,roles:n}}function ii(){return{type:F.AUTH_UNAUTHORIZED}}function si(){return function(e,t){e({type:F.AUTH_CHECK_START});var r=t().app.config.services.Auth.url,n=Xa.get("kbase_session");if(n){var a=new ri({url:r});Promise.all([a.getTokenInfo(n),a.getMe(n)]).then(function(t){var r=Object(se.a)(t,2),a=(r[0],r[1]),i=a.roles.map(function(e){var t=e.id;e.desc;return t});e(ai(n,a.user,a.display,i))}).catch(function(t){console.error("auth check error",t),e(ni({code:"error",message:t.message}))})}else e(ii())}}var oi=Object(P.b)(function(e,t){return{authorization:e.auth}},function(e){return{checkAuth:function(){e(si())},onRemoveAuthorization:function(){e(function(e,t){Xa.remove("kbase_session"),e(ii())})},onAddAuthorization:function(t){e(function(e){return function(t,r){var n=r().app.config.services.Auth.url;Xa.set("kbase_session",e);var a=new ri({url:n});Promise.all([a.getTokenInfo(e),a.getMe(e)]).then(function(r){var n=Object(se.a)(r,2),a=(n[0],n[1]),i=a.roles.map(function(e){var t=e.id;return e.desc,t});t(ai(e,a.user,a.display,i))}).catch(function(e){console.error("auth check error",e),t(ni({code:"error",message:e.message}))})}}(t))}}})(Ka),ci=function e(t){var r=t.name,n=t.onSuccess,a=t.onError;Object(C.a)(this,e),this.name=void 0,this.onSuccess=void 0,this.onError=void 0,this.name=r,this.onSuccess=n,this.onError=a},li=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).started=void 0,r.timeout=void 0,r.started=new Date,r.timeout=e.timeout||5e3,r}return Object(U.a)(t,e),t}(ci),ui=function(){function e(t){var r=t.name,n=t.payload,a=t.channelId;Object(C.a)(this,e),this.name=void 0,this.payload=void 0,this.id=void 0,this.created=void 0,this.channelId=void 0,this.envelope=void 0,this.name=r,this.payload=n,this.id=je()(),this.created=new Date,this.channelId=a,this.envelope=null}return Object(D.a)(e,[{key:"getMessage",value:function(){return{envelope:{id:this.id,created:this.created,channelId:this.channelId},name:this.name,payload:this.payload}}}]),e}(),Ei=function(){function e(t){if(Object(C.a)(this,e),this.window=void 0,this.host=void 0,this.id=void 0,this.awaitingResponse=void 0,this.waitingListeners=void 0,this.listeners=void 0,this.lastId=void 0,this.sentCount=void 0,this.receivedCount=void 0,this.unwelcomeReceivedCount=void 0,this.unwelcomeReceivedCountThreshhold=void 0,this.unwelcomeReceiptWarning=void 0,this.unwelcomeReceiptWarningCount=void 0,this.currentListener=void 0,this.window=t.window||window,null===this.window.document)throw new Error("No document");if(null===this.window.document.location)throw new Error("No location");this.host=t.host||this.window.document.location.origin,this.id=t.channelId||je()(),this.awaitingResponse=new Map,this.waitingListeners=new Map,this.listeners=new Map,this.lastId=0,this.sentCount=0,this.receivedCount=0,this.unwelcomeReceivedCount=0,this.unwelcomeReceivedCountThreshhold=100,this.unwelcomeReceiptWarning=!0,this.unwelcomeReceiptWarningCount=0,this.currentListener=null}return Object(D.a)(e,[{key:"genId",value:function(){return this.lastId+=1,"msg_"+String(this.lastId)}},{key:"receiveMessage",value:function(e){var t=e.data;if(!t)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("TS No message data; message ignored",e));if(!t.envelope)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("No message envelope, not from KBase; message ignored",e));if(t.envelope.channelId!==this.id)return this.unwelcomeReceivedCount++,void(this.unwelcomeReceiptWarning&&console.warn("Message envelope does not match this channel's id",t.envelope,t.envelope.channelId,this.id));if(this.unwelcomeReceiptWarningCount>this.unwelcomeReceivedCountThreshhold&&(this.unwelcomeReceiptWarning=!1,console.warn("Unwelcome message warning disabled after "+this.unwelcomeReceiptWarningCount+" instances.")),t.envelope.id&&this.awaitingResponse.has(t.envelope.id))try{var r=this.awaitingResponse.get(t.envelope.id);this.awaitingResponse.delete(t.envelope.id),r&&r.handler(t.payload)}catch(a){console.error("Error handling response for message ",t,a)}if(this.waitingListeners.has(t.name)){var n=this.waitingListeners.get(t.name);this.waitingListeners.delete(t.name),n.forEach(function(e){try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}this.listeners.has(t.name)&&this.listeners.get(t.name).forEach(function(e){e.onSuccess||console.warn("no handler for listener!",e);try{e.onSuccess(t.payload)}catch(a){console.error("Error handling listener for message",t,a),e.onError&&e.onError(a)}})}},{key:"listen",value:function(e){this.listeners.has(e.name)||this.listeners.set(e.name,[]),this.listeners.get(e.name).push(e)}},{key:"on",value:function(e,t,r){this.listen(new ci({name:e,onSuccess:t,onError:r}))}},{key:"sendMessage",value:function(e){this.window.postMessage(e.getMessage(),this.host)}},{key:"send",value:function(e,t){var r=new ui({name:e,payload:t,channelId:this.id});this.sendMessage(r)}},{key:"sendRequest",value:function(e,t){this.awaitingResponse.set("message.id",{started:new Date,handler:t}),this.sendMessage(e)}},{key:"request",value:function(e,t){var r=this;return new Promise(function(n,a){try{r.sendRequest(new ui({name:e,payload:t,channelId:r.id}),function(e){n(e)})}catch(i){a(i)}})}},{key:"startMonitor",value:function(){var e=this;window.setTimeout(function(){var t=(new Date).getTime(),r=!0,n=!1,a=void 0;try{for(var i,s=function(){var r=i.value,n=(c=Object(se.a)(r,2))[0];0===c[1].filter(function(e){if(e instanceof li){var r=t-e.started.getTime();if(r>e.timeout){try{e.onError&&e.onError(new Error("timout after "+r))}catch(a){console.error("Error calling error handler",n,a)}return!1}return!0}return!0}).length&&e.waitingListeners.delete(n)},o=e.waitingListeners.entries()[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var c;s()}}catch(l){n=!0,a=l}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}e.waitingListeners.size>0&&e.startMonitor()},100)}},{key:"listenOnce",value:function(e){this.waitingListeners.has(e.name)||this.waitingListeners.set(e.name,[]),this.waitingListeners.get(e.name).push(e),e.timeout&&this.startMonitor()}},{key:"once",value:function(e,t,r){this.listenOnce(new li({name:e,onSuccess:t,onError:r}))}},{key:"when",value:function(e,t){var r=this;return new Promise(function(n,a){return r.listenOnce(new li({name:e,timeout:t,onSuccess:function(e){n(e)},onError:function(e){a(e)}}))})}},{key:"stats",value:function(){return{sent:this.sentCount,received:this.receivedCount}}},{key:"attach",value:function(e){this.window=e}},{key:"start",value:function(){var e=this;this.currentListener=function(t){e.receiveMessage(t)},this.window.addEventListener("message",this.currentListener,!1)}},{key:"stop",value:function(){this.currentListener&&this.window.removeEventListener("message",this.currentListener,!1)}}]),e}(),di=function(){function e(){Object(C.a)(this,e),this.params=void 0,this.channel=void 0,this.params=null,this.channel=new Ei({window:window,host:document.location.origin})}return Object(D.a)(e,[{key:"getParamsFromIFrame",value:function(){return{channelId:this.channel.id,frameId:je()(),params:{groupsServiceURL:"/services/groups",userProfileServiceURL:"/services/user_profile/rpc",workspaceServiceURL:"/services/ws",serviceWizardURL:"/services/service_wizard",authServiceURL:"/services/auth",originalPath:"",view:null,viewParams:null},parentHost:document.location.origin}}}]),e}(),vi=function(){function e(){Object(C.a)(this,e)}return Object(D.a)(e,[{key:"getParamsFromIFrame",value:function(){if(!window.frameElement)return null;if(!window.frameElement.hasAttribute("data-params"))return null;var e=window.frameElement.getAttribute("data-params");return null===e?null:JSON.parse(decodeURIComponent(e))}},{key:"getChannelID",value:function(){return window.frameElement&&window.frameElement.hasAttribute("data-channel")?window.frameElement.getAttribute("data-channel"):null}},{key:"getIframeElement",value:function(){return window.frameElement||null}}]),e}();function mi(e){return{type:F.APP_SUCCESS,config:e}}r(328);var Oi=function(e){function t(e){var r;return Object(C.a)(this,t),(r=Object(V.a)(this,Object(k.a)(t).call(this,e))).channel=void 0,r.channel=null,r}return Object(U.a)(t,e),Object(D.a)(t,[{key:"setupChannel",value:function(){this.props.channelId&&(this.channel=new Ei({channelId:this.props.channelId}),this.channel.on("navigate",function(e){e.to,e.params},function(e){console.error('Error processing "navigate" message')}),this.channel.start(),this.channel.send("ready",{channelId:this.props.channelId,greeting:"heloooo"}))}},{key:"teardownChannel",value:function(){}},{key:"componentDidMount",value:function(){this.props.onAppStart()}},{key:"componentDidUpdate",value:function(){this.setupChannel()}},{key:"componentWillUnmount",value:function(){this.teardownChannel()}},{key:"render",value:function(){return this.props.status===O.NONE?b.createElement("div",{className:"KBaseIntegration"},"Loading..."):b.createElement("div",{className:"KBaseIntegration scrollable-flex-column"},this.props.children)}}]),t}(b.Component);var pi=Object(P.b)(function(e,t){var r=e.app,n=r.status,a=r.config;return{status:n,defaultPath:a.defaultPath,channelId:a.channelId}},function(e){return{onAppStart:function(){e(function(e,t){var r=(new vi).getParamsFromIFrame();if(r){var n,a=r.channelId;switch(r.params.view){case"org":n="/viewOrganization/"+r.params.viewParams.id,window.history.pushState(null,"test",n);break;default:n="/organizations",window.history.pushState(null,"organizations","/organizations")}e(mi({baseUrl:"",services:{Groups:{url:r.params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Auth:{url:r.params.authServiceURL}},defaultPath:n,channelId:a}))}else e(mi({baseUrl:"",services:{Groups:{url:(r=(new di).getParamsFromIFrame()).params.groupsServiceURL},UserProfile:{url:r.params.userProfileServiceURL},Workspace:{url:r.params.workspaceServiceURL},ServiceWizard:{url:r.params.serviceWizardURL},Auth:{url:r.params.authServiceURL}},defaultPath:"/organizations",channelId:null}))})}}})(Oi),Ri=function(){function e(){Object(C.a)(this,e)}return Object(D.a)(e,null,[{key:"makeInitialState",value:function(){return{entities:{users:{byId:new Map,all:[]},orgs:{byId:new Map,all:[]},requests:{byId:new Map,all:[]},narratives:{byId:new Map},organizations:{byId:new Map}},db:{},views:{browseOrgsView:{loadingState:R.NONE,error:null,viewModel:null},organizationCentricView:{loadingState:R.NONE,error:null,viewModel:null},addOrgView:{loadingState:R.NONE,error:null,viewModel:null},editOrgView:{loadingState:R.NONE,error:null,viewModel:null},manageOrganizationRequestsView:{loadingState:R.NONE,error:null,viewModel:null},viewMembersView:{loadingState:R.NONE,error:null,viewModel:null},manageMembershipView:{loadingState:R.NONE,error:null,viewModel:null},requestNarrativeView:{loadingState:R.NONE,error:null,viewModel:null},viewOrgView:{loadingState:R.NONE,error:null,viewModel:null}},auth:{status:v.NONE,message:"",authorization:{token:"",username:"",realname:"",roles:[]}},error:null,app:{status:O.NONE,config:{baseUrl:"",services:{Groups:{url:""},UserProfile:{url:""},Workspace:{url:""},ServiceWizard:{url:""},Auth:{url:""}},defaultPath:"",channelId:null}},updateOrg:{pending:!1}}}}]),e}(),hi=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"componentWillMount",value:function(){this.props.onLoad()}},{key:"componentWillUnmount",value:function(){this.props.onUnload()}},{key:"render",value:function(){return this.props.children}}]),t}(b.Component);var wi=Object(P.b)(function(e,t){return{}},function(e){return{onLoad:function(){e(Pr())},onUnload:function(){e({type:F.DATA_SERVICE_UNLOAD})}}})(hi),_i=b.createContext(null),gi=_i.Provider;_i.Consumer;ct.a.add(lt.c,lt.b,lt.a,lt.d);var Si=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"link",value:function(e,t,r){if(this.options.sanitize){var n;try{n=decodeURIComponent(this.options.unescape(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(i){return r}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return r}var a='<a href="'+e+'"';return t&&(a+=' title="'+t+'"'),a+=' target="_blank">'+r+"</a>"}}]),t}(Cr.Renderer);(new Cr.MarkedOptions).renderer=new Si,Cr.Marked.setOptions({renderer:new Si});var fi=!!window.frameElement,Ai=Ri.makeInitialState(),Ni=Object(B.d)(ot,Ai,Object(B.c)(Object(B.a)(x.a))),Ii=function(e){function t(e){return Object(C.a)(this,t),Object(V.a)(this,Object(k.a)(t).call(this,e))}return Object(U.a)(t,e),Object(D.a)(t,[{key:"render",value:function(){return T.a.createElement(gi,{value:{test:"ok"}},T.a.createElement(P.a,{store:Ni},T.a.createElement(pi,null,T.a.createElement(oi,{hosted:fi},T.a.createElement(wi,null,T.a.createElement(L.a,{basename:"/"},T.a.createElement("div",{className:"App scrollable-flex-column"},T.a.createElement("div",{className:"App-body scrollable-flex-column"},T.a.createElement(z.a,null,T.a.createElement(G.a,{path:"/organizations",component:Or}),T.a.createElement(G.a,{path:"/newOrganization",component:jr}),T.a.createElement(G.a,{path:"/viewOrganization/:id",component:function(e){var t=e.match.params.id;return T.a.createElement(Ya,{organizationId:t})}}),T.a.createElement(j.a,{from:"/",to:"/organizations",exact:!0}))))))))))}}]),t}(b.Component);r(330),r(332),r(334);M.a.render(T.a.createElement(Ii,null),document.getElementById("root"))}},[[155,2,1]]]);
//# sourceMappingURL=main.def47550.chunk.js.map